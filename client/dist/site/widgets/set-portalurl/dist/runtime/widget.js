System.register(["jimu-core","jimu-core/emotion","jimu-theme","jimu-ui"],function(t,e){var s={},o={},n={},l={};return{setters:[function(t){s.React=t.React,s.SessionManager=t.SessionManager,s.UrlProtocol=t.UrlProtocol,s.css=t.css,s.esri=t.esri,s.portalUrlUtils=t.portalUrlUtils,s.urlUtils=t.urlUtils,s.utils=t.utils},function(t){o.jsx=t.jsx,o.jsxs=t.jsxs},function(t){n.styled=t.styled},function(t){l.Button=t.Button,l.ButtonGroup=t.ButtonGroup,l.Checkbox=t.Checkbox,l.Dropdown=t.Dropdown,l.DropdownButton=t.DropdownButton,l.DropdownItem=t.DropdownItem,l.DropdownMenu=t.DropdownMenu,l.FormFeedback=t.FormFeedback,l.FormGroup=t.FormGroup,l.InputGroup=t.InputGroup,l.Label=t.Label,l.TextInput=t.TextInput}],execute:function(){t((()=>{var t={244:t=>{"use strict";t.exports=s},321:t=>{"use strict";t.exports=l},348:function(t,e){var s,o,n;o=[e,t],s=function(t,e){"use strict";var s={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function o(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function n(t){try{delete window[t]}catch(e){window[t]=void 0}}function l(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}function r(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=t,i=e.timeout||s.timeout,a=e.jsonpCallback||s.jsonpCallback,c=void 0;return new Promise(function(s,d){var u=e.jsonpCallbackFunction||o(),h=a+"_"+u;window[u]=function(t){s({ok:!0,json:function(){return Promise.resolve(t)}}),c&&clearTimeout(c),l(h),n(u)},r+=-1===r.indexOf("?")?"?":"&";var p=document.createElement("script");p.setAttribute("src",""+r+a+"="+u),e.charset&&p.setAttribute("charset",e.charset),e.nonce&&p.setAttribute("nonce",e.nonce),e.referrerPolicy&&p.setAttribute("referrerPolicy",e.referrerPolicy),e.crossorigin&&p.setAttribute("crossorigin","true"),p.id=h,document.getElementsByTagName("head")[0].appendChild(p),c=setTimeout(function(){d(new Error("JSONP request to "+t+" timed out")),n(u),l(h),window[u]=function(){n(u)}},i),p.onerror=function(){d(new Error("JSONP request to "+t+" failed")),n(u),l(h),c&&clearTimeout(c)}})}e.exports=r},void 0===(n="function"==typeof s?s.apply(e,o):s)||(t.exports=n)},386:t=>{"use strict";t.exports=o},888:t=>{"use strict";t.exports=n}},e={};function r(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,r),n.exports}r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.p="";var i={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(i),r.d(i,{LoadStatus:()=>w,__set_webpack_public_path__:()=>C,default:()=>k});var t=r(386),e=r(244),s=r(321);const o="Sign in",n="Portal URL",l="Client ID",a="Specify the URL to your ArcGIS Online organization or ArcGIS Enterprise",c="Provide the Client ID for Experience Builder registered in the organization you specify above",d="Please enter the full URL of your ArcGIS Online organization or ArcGIS Enterprise, for example,",u="Unable to access",h="Your application domain is not allowed via Cross-Origin Resource Sharing (CORS) to access",p="A server with the specified hostname could not be found.",f="Restrict to Enterprise resources only";var g,m=r(348);!function(t){t.InvalidPortalUrl="InvalidPortalUrl",t.UnableToCorsAccess="UnableToCorsAccess",t.UnableToAccess="UnableToAccess"}(g||(g={}));class I{constructor(){this.validPortalInfos=[]}getDefaultProtalInfo(t){return{isValid:!1,invalidMessage:"",isWebTier:!1,supportsOAuth:!0,tokenInfo:{token:null,expires:null,ssl:!1,server:"",userId:""},url:this.getStandardPortalUrl(t),clientId:void 0}}getValidPortalInfo(t){let s=null;return this.validPortalInfos.some(o=>!!e.portalUrlUtils.isSamePortalUrl(t,o.url)&&(s=o,!0)),s}getStandardPortalUrl(t){if(!t)return"";const s=0===t.toLowerCase().indexOf("http://"),o=0===t.toLowerCase().indexOf("https://");return s||o||(t=e.urlUtils.setProtocol(t,e.UrlProtocol.Https)),t=e.portalUrlUtils.getStandardPortalUrl(t),t=e.urlUtils.setProtocol(t,e.UrlProtocol.Https)}validatePortalUrl(t){const e=this.getDefaultProtalInfo(t);return/www\.arcgis\.com/gi.test(t)?(e.isValid=!1,e.invalidMessage=g.InvalidPortalUrl):e.isValid=!0,e}fetcher(t,e){return fetch(t,e)}generateToken(t){const s=e.urlUtils.setProtocol(`${e.portalUrlUtils.getPortalRestUrl(t)}/generateToken?f=json`,e.UrlProtocol.Https);return this.fetcher(s,{cache:"no-cache",credentials:"include"}).then(t=>t.json()).then(t=>t,t=>null)}getPortalSelfInfo(t){const s=e.urlUtils.setProtocol(`${e.portalUrlUtils.getPortalRestUrl(t)}/portals/self?f=json`,e.UrlProtocol.Https);return this.fetcher(s,{cache:"no-cache",credentials:"include"}).then(t=>t.json()).then(t=>t).catch(t=>m(s,{jsonpCallback:"callback",timeout:3e3}).then(t=>({invalidPortalSelf:!0,invalidMessage:g.UnableToCorsAccess})).catch(t=>({invalidPortalSelf:!0,invalidMessage:g.UnableToAccess})))}getPortalInfo(t){const s=this.getDefaultProtalInfo(t);return this.getPortalSelfInfo(t).then(e=>{if(e&&!e.invalidPortalSelf&&(e.isPortal||e.urlKey))return s.isValid=!0,s.supportsOAuth=e.supportsOAuth,s.tokenInfo.userId=e.user?e.user.username:"",this.validPortalInfos.push(s),this.generateToken(t);s.isValid=!1,s.invalidMessage=(null==e?void 0:e.invalidMessage)||g.UnableToAccess}).then(o=>(o&&o.token&&(s.tokenInfo.token=o.token,s.tokenInfo.expires=o.expires,s.tokenInfo.ssl=o.ssl,s.tokenInfo.server=e.portalUrlUtils.getPortalRestUrl(t),s.isWebTier=!0,s.supportsOAuth=!1),s))}validatePortal(t){if(!t)return Promise.reject(new Error("Portal URL is empty."));let e;const s=this.getStandardPortalUrl(t);let o=this.getValidPortalInfo(s);return o?e=Promise.resolve(o):(o=this.validatePortalUrl(s),e=o.isValid?this.getPortalInfo(s):Promise.resolve(o)),e}}var P=r(888);const{useEffect:v,useState:U,Fragment:x}=e.React,j=o=>{const{intl:n,selectedPortalInfo:l}=o,[r,i]=U(!1),[a,c]=U(!1);v(()=>{const t=!u(l.url)&&l.isValid;c(t)},[l]),v(()=>{d(!1)},[a]);const d=t=>{e.utils.setLocalStorage("restrictEnterpriseOnly",`${t}`),i(t)},u=t=>!t||e.portalUrlUtils.isAGOLDomain(t);return(0,t.jsx)(x,{children:a&&(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsxs)(s.Label,{className:"d-flex align-item-center",children:[(0,t.jsx)(s.Checkbox,{onChange:()=>{d(!r)},checked:r,className:"mr-2"}),(0,t.jsx)("div",{children:n.formatMessage({id:"restrictEnterpriseOnly",defaultMessage:f})})]})})})};var w,b=function(t,e,s,o){return new(s||(s=Promise))(function(n,l){function r(t){try{a(o.next(t))}catch(t){l(t)}}function i(t){try{a(o.throw(t))}catch(t){l(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s(function(t){t(e)})).then(r,i)}a((o=o.apply(t,e||[])).next())})};!function(t){t.Pending="Pending",t.Fulfilled="Fulfilled",t.Rejected="Rejected"}(w||(w={}));const S="https://myorg.maps.arcgis.com",y="https://myportal.company.com/arcgis";class M extends e.React.PureComponent{constructor(t){super(t),this.onPortalUrlInputChange=t=>{var e,s;const o=this.portalValidator.getDefaultProtalInfo(null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.value);o.url=null===(s=null==t?void 0:t.target)||void 0===s?void 0:s.value,this.setState({selectedPortalInfo:o})},this.onClientIdInputChange=t=>{var e;this.setState({selectedPortalInfo:Object.assign(Object.assign({},this.state.selectedPortalInfo),{clientId:null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.value})})},this.checkPortalUrlOnAccept=t=>b(this,void 0,void 0,function*(){try{let e;return t?(this.setState({loadStatus:w.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(t),showUrlList:!1}),e=yield this.portalValidator.validatePortal(t)):e=this.portalValidator.getDefaultProtalInfo(),this.setState({selectedPortalInfo:e,loadStatus:w.Fulfilled}),!e||e.invalidMessage?{valid:!1}:{valid:!0}}catch(t){return this.setState({loadStatus:w.Rejected}),{valid:!1}}}),this.onSignInBtnClick=()=>{if(!this.state.selectedPortalInfo.isValid)return;const t={portalUrl:this.state.selectedPortalInfo.url,clientId:this.clientIdInput.current.value,supportsOAuth:this.state.selectedPortalInfo.supportsOAuth,isWebTier:this.state.selectedPortalInfo.isWebTier};this.addSigninInfo(t).then(()=>{this.signIn(t)})},this.onUrlListBtnClick=()=>{this.setState({showUrlList:!this.state.showUrlList})},this.onUrlListItemClick=t=>{this.selectPortalUrl(t)},this.portalValidator=new I,this.state={signinInfos:[],showUrlList:!1,loadStatus:w.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo()},this.urlInput=e.React.createRef(),this.clientIdInput=e.React.createRef()}componentDidMount(){this.fetchSigninInfo()}getDefaultPortalUrl(t){const s=window.jimuConfig.hostEnv||"dev",o=`${e.urlUtils.getFixedRootPath()}builder/setting.json`;return window.fetch(o).then(t=>t.json()).then(e=>{const o=(window.jimuConfig.isDevEdition?e.devEnv:e.env)[s];return o&&o.portalUrl||t[0]&&t[0].portalUrl||""})}fetchSigninInfo(){const t=`${window.location.origin}${window.jimuConfig.mountPath}signininfo`;return window.fetch(t,{cache:"no-cache"}).then(t=>t.json()).then(t=>(this.setState({signinInfos:t}),this.getDefaultPortalUrl(t).then(t=>{this.selectPortalUrl(t)}),t)).catch(t=>(console.error(t),t))}addSigninInfo(t){const e=`${window.location.origin}${window.jimuConfig.mountPath}signinInfo`;return window.fetch(e,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(t=>t.json()).catch(t=>{console.error(t)})}getSigninInfo(t){let s=null;return this.state.signinInfos.some(o=>!!e.portalUrlUtils.isSamePortalUrl(o.portalUrl,t)&&(s=o,!0)),s}OAuthSignIn(t){const s=t.portalUrl+"/sharing/rest/";e.SessionManager.getInstance().signIn({desUrl:s,clientId:t.clientId,popup:!1})}webTierSignIn(){const t=this.state.selectedPortalInfo.tokenInfo,s=e.esri.restRequest.ArcGISIdentityManager.fromCredential(t,{hasPortal:!1,hasServer:!1,server:""});e.SessionManager.getInstance().writeAuthInfo(s),window.location.href="/"}signIn(t){t.supportsOAuth?this.OAuthSignIn(t):this.state.selectedPortalInfo.isWebTier&&this.webTierSignIn()}validatePortal(t){return this.portalValidator.validatePortal(t)}selectPortalUrl(t,e){t?(this.setState({loadStatus:w.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(t),showUrlList:!1}),this.validatePortal(t).then(t=>{this.setState(Object.assign({selectedPortalInfo:t,loadStatus:w.Fulfilled},e))}).catch(()=>{this.setState({loadStatus:w.Rejected})})):this.setState({selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(),loadStatus:w.Fulfilled})}render(){const r=(0,P.styled)(s.Button)`
      display: block;
      margin: 0 auto;
    `,i=this.state.signinInfos.map((o,n)=>(0,t.jsx)(s.DropdownItem,{active:!!e.portalUrlUtils.isSamePortalUrl(o.portalUrl,this.state.selectedPortalInfo.url),onClick:()=>{this.onUrlListItemClick(o.portalUrl)},children:o.portalUrl},n)),f=this.getSigninInfo(this.state.selectedPortalInfo.url);let m,I,v;if(m=void 0!==this.state.selectedPortalInfo.clientId?this.state.selectedPortalInfo.clientId:f&&f.clientId||"",this.state.selectedPortalInfo.url||this.state.loadStatus===w.Pending||(I=(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:S}),(0,t.jsx)("div",{children:y})]})),this.state.selectedPortalInfo&&this.state.selectedPortalInfo.invalidMessage&&this.state.loadStatus!==w.Pending)if(this.state.selectedPortalInfo.invalidMessage===g.InvalidPortalUrl)v=(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:this.props.intl.formatMessage({id:"invalidPortalUrlMessage",defaultMessage:d})}),(0,t.jsx)("div",{className:"sample-url",children:S}),(0,t.jsx)("div",{className:"sample-url",children:y})]});else if(this.state.selectedPortalInfo.invalidMessage===g.UnableToCorsAccess){const e=this.props.intl.formatMessage({id:"unableToCorsAccessMessage",defaultMessage:h});v=(0,t.jsx)("div",{children:(0,t.jsx)("div",{children:`${e} ${this.state.selectedPortalInfo.url}`})})}else{const e=this.props.intl.formatMessage({id:"unableToAccessMessage",defaultMessage:u}),s=this.props.intl.formatMessage({id:"invalidHostNameMessage",defaultMessage:p});v=(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:`${e} ${this.state.selectedPortalInfo.url}`}),(0,t.jsx)("div",{children:s})]})}const U=this.state.selectedPortalInfo&&this.state.selectedPortalInfo.supportsOAuth?"displayed":"hidden";let x="hidden",b=!1;this.state.loadStatus===w.Pending&&(b=!0,x="displayed");const M=!this.state.selectedPortalInfo.isValid;return(0,t.jsxs)("div",{css:(k=this.props.theme,this.props.isRTL,e.css`
    max-width: 700px;
    margin: 0 auto;
    .portal-url-input{
      margin-right: 1px;
    }
    .portal-clientId.hidden{
      display: none;
    }
    .portal-clientId .jimu-input {
      input:-webkit-autofill,
      input:-webkit-autofill:focus {
        transition: background-color 0s 600000s, color 0s 600000s !important;
      }
    }
    .loading-panel {
      position: absolute;
      width: 15px;
      background-color: ${k.ref.palette.neutral[200]};

      .jimu-secondary-loading {
        left: 2px;
        top: 12px;
      }

      .jimu-secondary-loading, .jimu-secondary-loading:before, .jimu-secondary-loading:after {
        width: 2px;
        height: 5px;
        left: -27px;
      }
      .jimu-secondary-loading:before {
        left: -5px;
      }
      .jimu-secondary-loading:after {
        left: 5px;
      }
    }

    .loading-panel.hidden {
      display: none;
    }

    .dropdown-menu {
      width: 700px;
    }

    .description, .message {
      color: ${k.ref.palette.neutral[1e3]};
      width: auto;
    }

    .invalid-message {
      .sample-url {
        color: ${k.ref.palette.primary[600]};
      }
    }
    .loading-con {
      margin-left: -1px;
    }
  `),className:"widget-set-portalurl",children:[(0,t.jsxs)("div",{className:"mt-6 mb-2",children:[(0,t.jsxs)(s.Label,{id:"portalUrlLabel",className:"description",children:[" ",this.props.intl.formatMessage({id:"portalUrlDescription",defaultMessage:a})," "]}),(0,t.jsxs)(s.ButtonGroup,{className:"w-100",children:[(0,t.jsxs)(s.InputGroup,{children:[(0,t.jsx)(s.TextInput,{"aria-describedby":"portalUrlMessage1 portalUrlMessage2","aria-labelledby":"portalUrlLabel",className:"portal-url-input",disabled:b,size:"lg",placeholder:this.props.intl.formatMessage({id:"portalUrl",defaultMessage:n}),min:0,max:100,type:"text",checkValidityOnAccept:this.checkPortalUrlOnAccept,value:this.state.selectedPortalInfo.url||"",onChange:this.onPortalUrlInputChange,ref:this.urlInput}),(0,t.jsx)("div",{className:"d-flex loading-con",children:(0,t.jsx)("div",{className:`loading-panel ${x}`,children:(0,t.jsx)("div",{className:"jimu-secondary-loading"})})})]}),(0,t.jsxs)(s.Dropdown,{activeIcon:!0,className:"dropdown",isOpen:this.state.showUrlList,toggle:this.onUrlListBtnClick,children:[(0,t.jsx)(s.DropdownButton,{style:{width:"auto"},icon:!0}),(0,t.jsx)(s.DropdownMenu,{className:"dropdown-menu",zIndex:55,style:{width:"700px"},alignment:"end",children:i})]})]})]}),(0,t.jsxs)(s.FormFeedback,{id:"portalUrlMessage1",className:"message mx-2",valid:!0,children:[" ",I," "]}),(0,t.jsxs)(s.FormFeedback,{id:"portalUrlMessage2",className:"message invalid-message mx-2",valid:!0,children:[" ",v," "]}),(0,t.jsxs)(s.FormGroup,{className:`portal-clientId mt-6 ${U}`,children:[(0,t.jsxs)(s.Label,{className:"description",for:"clientIdText",children:[" ",this.props.intl.formatMessage({id:"clientIdDescription",defaultMessage:c})," "]}),(0,t.jsx)(s.TextInput,{disabled:b,size:"lg",type:"password",name:"text",id:"clientIdText",placeholder:this.props.intl.formatMessage({id:"clientId",defaultMessage:l}),value:m,ref:this.clientIdInput,onChange:this.onClientIdInputChange})]}),(0,t.jsx)(j,{selectedPortalInfo:this.state.selectedPortalInfo,intl:this.props.intl}),(0,t.jsx)(r,{disabled:b||M,size:"lg",onClick:()=>{this.onSignInBtnClick()},children:this.props.intl.formatMessage({id:"portalUrlSignIn",defaultMessage:o})})]});var k}}M.mapExtraStateProps=t=>({isRTL:t.appContext.isRTL});const k=M;function C(t){r.p=t}})(),i})())}}});