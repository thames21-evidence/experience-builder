System.register(["jimu-core","jimu-core/emotion","jimu-for-builder","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/utility-selector","jimu-ui/basic/item-selector"],function(e,t){var l={},a={},i={},s={},n={},r={},o={};return{setters:[function(e){l.Immutable=e.Immutable,l.React=e.React,l.ReactRedux=e.ReactRedux,l.ServiceManager=e.ServiceManager,l.SessionManager=e.SessionManager,l.UtilityManager=e.UtilityManager,l.classNames=e.classNames,l.css=e.css,l.focusElementInKeyboardMode=e.focusElementInKeyboardMode,l.hooks=e.hooks,l.lodash=e.lodash,l.polished=e.polished,l.portalUrlUtils=e.portalUrlUtils,l.serviceUrlUtils=e.serviceUrlUtils},function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){i.getAppConfigAction=e.getAppConfigAction},function(e){s.Button=e.Button,s.Checkbox=e.Checkbox,s.Dropdown=e.Dropdown,s.DropdownButton=e.DropdownButton,s.DropdownItem=e.DropdownItem,s.DropdownMenu=e.DropdownMenu,s.Icon=e.Icon,s.Label=e.Label,s.Link=e.Link,s.Loading=e.Loading,s.LoadingType=e.LoadingType,s.Modal=e.Modal,s.ModalBody=e.ModalBody,s.ModalFooter=e.ModalFooter,s.ModalHeader=e.ModalHeader,s.Tab=e.Tab,s.Tabs=e.Tabs,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.defaultMessages=e.defaultMessages},function(e){n.SidePopper=e.SidePopper},function(e){r.AddUtilityTabs=e.AddUtilityTabs,r.UtilityIcon=e.UtilityIcon},function(e){o.DataBadge=e.DataBadge,o.ItemDetail=e.ItemDetail}],execute:function(){e((()=>{var e={170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},1371:e=>{"use strict";e.exports=r},2185:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2V4a2 2 0 0 1 2-2h8a2 2 0 0 0-2-2z"></path><path fill="#000" fill-rule="evenodd" d="M6 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm5.489 2.938Q10.31 5.759 8.66 6.062a.402.402 0 0 0-.212.68l1.619 1.618a.4.4 0 0 1 0 .569l-1.138 1.138a.4.4 0 0 1-.569 0L6.742 8.448a.402.402 0 0 0-.68.212q-.303 1.65.876 2.829a3.22 3.22 0 0 0 3.532.688l1.588 1.587a.805.805 0 0 0 1.137 0l.57-.569a.805.805 0 0 0 0-1.137l-1.588-1.588a3.22 3.22 0 0 0-.688-3.532" clip-rule="evenodd"></path></svg>'},3529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 12c-2.667 0-5.667-1.333-7-4 1.333-2.667 4.333-4 7-4s5.667 1.333 7 4c-1.333 2.667-4.333 4-7 4m0-7c-2.618 0-4.578.967-6 3 1.422 2.033 3.382 3 6 3s4.578-.967 6-3c-1.422-2.033-3.382-3-6-3m0 5.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0-1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},3549:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.667 4.667 11.333 0 16 4.667l-4.667 4.666zM0 1.333V8h6.667V1.333zM6.667 16H0V9.333h6.667zM8 16V9.333h6.667V16z" clip-rule="evenodd"></path></svg>'},3662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},4108:e=>{"use strict";e.exports=i},4109:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.154 3.154a.527.527 0 0 1 .746 0l1.317 1.317A8.6 8.6 0 0 1 8 4c2.667 0 5.667 1.333 7 4-.696 1.393-1.847 2.422-3.168 3.087l1.014 1.013a.527.527 0 1 1-.746.746l-1.317-1.317A8.6 8.6 0 0 1 8 12c-2.667 0-5.667-1.333-7-4 .696-1.393 1.847-2.422 3.168-3.087L3.154 3.9a.527.527 0 0 1 0-.746m1.698 2.443C3.726 6.087 2.782 6.882 2 8c1.422 2.033 3.382 3 6 3a8.7 8.7 0 0 0 2.03-.225l-.675-.674A2.5 2.5 0 0 1 5.9 6.644zm6.296 4.805C12.275 9.913 13.218 9.119 14 8c-1.422-2.033-3.382-3-6-3q-1.088 0-2.03.225l.675.674a2.5 2.5 0 0 1 3.457 3.456zM6.5 8c0-.221.048-.431.134-.62l1.987 1.986A1.5 1.5 0 0 1 6.5 8m.88-1.366 1.986 1.987a1.5 1.5 0 0 0-1.987-1.987" clip-rule="evenodd"></path></svg>'},4321:e=>{"use strict";e.exports=s},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},5007:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4.751a2 2 0 0 0-.495-1.317L12.098.683A2 2 0 0 0 10.592 0zm3.325 3.077Q8.388 2.7 9.861 4.172a4.02 4.02 0 0 1 .86 4.416l1.985 1.984c.392.393.392 1.03 0 1.422l-.712.712a1.006 1.006 0 0 1-1.422 0L8.588 10.72a4.02 4.02 0 0 1-4.416-.86Q2.7 8.388 3.077 6.325a.503.503 0 0 1 .85-.265L5.95 8.083a.503.503 0 0 0 .711 0l1.422-1.422a.503.503 0 0 0 0-.71L6.06 3.926a.503.503 0 0 1 .265-.85" clip-rule="evenodd"></path></svg>'},5508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},6340:e=>{"use strict";e.exports=o},6572:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15.29 6.208 8 1 .71 6.208a.5.5 0 1 0 .58.813L2 6.515V15h12V6.514l.71.507a.5.5 0 0 0 .58-.813M13 5.8 8 2.229 3 5.8V14h3v-4h4v4h3zM9 14H7v-3h2z" clip-rule="evenodd"></path></svg>'},7386:e=>{"use strict";e.exports=a},8996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},9244:e=>{"use strict";e.exports=l},9298:e=>{"use strict";e.exports=n},9524:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 1.5a.5.5 0 0 1 1 0v2.8a.5.5 0 0 1-1 0zm6.028.874a.5.5 0 0 1 .062.705l-1.414 1.685a.5.5 0 1 1-.766-.643l1.414-1.685a.5.5 0 0 1 .704-.062m-10.352.062a.5.5 0 1 0-.766.643l1.414 1.685a.5.5 0 0 0 .766-.643zM6.244 10.6H5.43zM.961 9.8h4.88c.211 0 .359.19.359.4q0 .207.045.4a1.8 1.8 0 0 0 3.51 0h.814a2.6 2.6 0 0 1-5.139 0H.8v3.6h14.4v-3.6H9.755q.045-.194.045-.4c0-.21.148-.4.358-.4h4.881l-2.267-3.4H3.228zm11.81-4.2a.8.8 0 0 1 .666.356l2.429 3.642a.8.8 0 0 1 .134.444V14.2a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1-.8-.8v-4.158a.8.8 0 0 1 .134-.444l2.429-3.642a.8.8 0 0 1 .665-.356z" clip-rule="evenodd"></path></svg>'}},t={};function c(l){var a=t[l];if(void 0!==a)return a.exports;var i=t[l]={exports:{}};return e[l](i,i.exports,c),i.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var l in t)c.o(t,l)&&!c.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>Ne,default:()=>ke});var e=c(7386),t=c(9244),l=c(3662),a=c.n(l),i=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const s=l=>{const s=window.SVG,{className:n}=l,r=i(l,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",n);return s?(0,e.jsx)(s,Object.assign({className:o,src:a()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};var n=c(170),r=c.n(n),o=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const u=l=>{const a=window.SVG,{className:i}=l,s=o(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:r()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};var p=c(9524),m=c.n(p),g=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const v=l=>{const a=window.SVG,{className:i}=l,s=g(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:m()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};var x=c(4321),f=c(4108),h=c(9298),y=c(1371);const b={utilityService:"Utility service",noUtilityTip:"No utility in the experience.<br/>Please add at least one utility.",removeUtility:"Remove utility",removeUtilityTitle:"You are removing utility:",breakTip:"This utility is used in the following widgets and removing it may break them.",breakDesc:"Select the widgets you want to delete alongside the utility. Be aware they will be removed from all devices views. The unselected widgets will be kept and you can reconfigure them later."};var j=c(3549),w=c.n(j),k=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const N=l=>{const a=window.SVG,{className:i}=l,s=k(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:w()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};var O=c(6340),I=c(4651),S=c.n(I),R=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const C=l=>{const a=window.SVG,{className:i}=l,s=R(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:S()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};function U(l){const{widgetId:a,className:i=""}=l,s=t.ReactRedux.useSelector(e=>{var t,l,i;const s=(null===(l=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===l?void 0:l.widgets)[a];return s?"string"==typeof s.icon?s.icon:null===(i=s.icon)||void 0===i?void 0:i.svg:null}),n=t.ReactRedux.useSelector(e=>{var t,l,i;return null===(i=(null===(l=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===l?void 0:l.widgets)[a])||void 0===i?void 0:i.label});return(0,e.jsxs)("div",{className:`d-flex align-items-center ${i}`,children:[(0,e.jsx)(x.Icon,{icon:s,size:16}),(0,e.jsx)("span",{className:"ml-1",children:n})]})}function M(l){const{utilityId:a,label:i,relatedWidgetIds:s,onCancel:n,beforeRemove:r,afterRemove:o}=l,[c,d]=t.React.useState((0,t.Immutable)({})),u=t.hooks.useTranslation(x.defaultMessages,b),p=t.React.useCallback((e,t)=>{d(c.set(e,t))},[c]),m=t.React.useCallback(()=>{const e=(0,f.getAppConfigAction)(),t=Object.keys(c).filter(e=>c[e]),l=s.filter(e=>!c[e]);t.forEach(t=>{e.removeWidget(t)}),null==r||r(),e.removeUtility(a),l.forEach(t=>{const l=e.appConfig.widgets[t].useUtilities.filter(e=>e.utilityId!==a);e.editWidgetProperty(t,"useUtilities",l)}),e.exec(),o()},[c,s,a,r,o]);return(0,e.jsxs)(x.Modal,{isOpen:!0,className:"bg-default d-flex justify-content-between",role:"dialog","aria-label":u("removeUtility"),"aria-describedby":`${a}_desc`,children:[(0,e.jsx)(x.ModalHeader,{className:"d-flex justify-content-between border-color-gray-300 py-4 font-16 font-dark-600",title:u("removeUtility"),toggle:n,children:u("removeUtility")}),(0,e.jsx)(x.ModalBody,{id:`${a}_desc`,children:(0,e.jsxs)("div",{className:"px-2 py-0",children:[(0,e.jsx)("p",{className:"font-13 font-dark-600",children:u("removeUtilityTitle")}),(0,e.jsx)("p",{className:"font-14 font-dark-800 mt-4",children:i}),(0,e.jsx)("p",{className:"font-13 font-dark-600 mt-4",children:u("breakTip")}),(0,e.jsxs)("div",{role:"group","aria-label":u("relatedWidgets"),children:[(0,e.jsx)("p",{className:"font-14 font-dark-400 mt-4",children:u("relatedWidgets")}),(0,e.jsx)("div",{className:"related-widgets px-2 py-4",children:(0,e.jsx)("div",{children:s.map(t=>{var l;return(0,e.jsxs)(x.Label,{className:"d-flex align-items-center",children:[(0,e.jsx)(x.Checkbox,{className:"mr-2 font-13",onChange:(e,l)=>{p(t,l)},checked:null!==(l=c[t])&&void 0!==l&&l}),(0,e.jsx)(U,{widgetId:t})]},t)})})})]}),(0,e.jsx)("p",{className:"font-13 font-dark-600 mt-2 mb-0",children:u("breakDesc")})]})}),(0,e.jsx)(x.ModalFooter,{children:(0,e.jsxs)("div",{className:"d-flex justify-content-end mt10",children:[(0,e.jsx)(x.Button,{type:"primary",className:"mr-2",onClick:m,"aria-label":u("removeUtility"),children:u("removeUtility")}),(0,e.jsx)(x.Button,{type:"default",onClick:n,"aria-label":u("cancel"),children:u("cancel")})]})})]})}function B(l){const{onRename:a,beforeRemove:i,utilityId:s,label:n,relatedWidgetIds:r,showRemove:o=!0}=l,[c,d]=t.React.useState(!1),u=t.hooks.useTranslation(b),p=t.React.useCallback(()=>{if((null==r?void 0:r.length)>0)return void d(!0);null==i||i();const e=(0,f.getAppConfigAction)();e.removeUtility(s),e.exec()},[r,s,i]),m=t.hooks.useEventCallback(()=>{d(!1)});return(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(x.Dropdown,{className:"utility-more",direction:"down",size:"sm","aria-label":u("more"),children:[(0,e.jsx)(x.DropdownButton,{icon:!0,size:"sm",type:"tertiary",arrow:!1,children:(0,e.jsx)(C,{className:"align-baseline",size:"m"})}),(0,e.jsxs)(x.DropdownMenu,{children:[(0,e.jsx)(x.DropdownItem,{header:!1,"aria-label":u("rename"),onClick:a,a11yFocusBack:!1,children:u("rename")}),o&&(0,e.jsx)(x.DropdownItem,{header:!1,"aria-label":u("remove"),onClick:p,children:u("remove")})]})]}),c&&(0,e.jsx)(M,{utilityId:s,label:n,relatedWidgetIds:r,onCancel:m,beforeRemove:i,afterRemove:m})]})}function z(l){const{text:a,isEditing:i,className:s,onChange:n}=l,[r,o]=t.React.useState(null!=a?a:""),c=t.React.useRef(void 0);t.React.useEffect(()=>{i||a===r||o(a)},[a,r,i]),t.React.useEffect(()=>{i&&c.current&&setTimeout(()=>{(0,t.focusElementInKeyboardMode)(c.current,!0)},500)},[i]);const d=t.React.useCallback(e=>{const t=e.target.value;n(t)},[n]),u=t.hooks.useEventCallback(e=>{o(e.target.value)}),p=t.hooks.useEventCallback(e=>{e.stopPropagation()});return i?(0,e.jsx)(x.TextInput,{className:(0,t.classNames)(s,"text-truncate p-1"),onBlur:d,onPressEnter:d,onChange:u,value:r,onClick:p,ref:c}):(0,e.jsx)("div",{className:s,children:r})}var P=c(2185),E=c.n(P),T=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const L=l=>{const a=window.SVG,{className:i}=l,s=T(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:E()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};var $=c(5007),A=c.n($),V=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const D=l=>{const a=window.SVG,{className:i}=l,s=V(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:A()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};function W(e,l){const a=t.ReactRedux.useSelector(t=>{var a,i;const s=[],n=null===(i=null===(a=t.appStateInBuilder)||void 0===a?void 0:a.appConfig)||void 0===i?void 0:i.widgets;return Object.keys(null!=n?n:{}).forEach(t=>{var a;(null===(a=n[t].useUtilities)||void 0===a?void 0:a.some(t=>null!=l?t.utilityId===e&&t.task===l:t.utilityId===e))&&s.push(t)}),s.sort(),s.join(",")});return t.React.useMemo(()=>a.length>0?a.split(","):[],[a])}function _(e,l){var a,i;if(e){return`${t.portalUrlUtils.getHomeIndexUrl(l.portalUrl).replace("index.html","item.html")}?id=${l.itemId}`}if(!!(null===(a=t.ServiceManager.getInstance().getServerInfoByServiceUrl(l.url))||void 0===a?void 0:a.owningSystemUrl)){const e=null===(i=t.SessionManager.getInstance().getSessionByUrl(l.url))||void 0===i?void 0:i.token;return e?`${l.url}?token=${e}`:l.url}return l.url}function H(e,l){var a,i;if(!!(null===(a=t.ServiceManager.getInstance().getServerInfoByServiceUrl(l.url))||void 0===a?void 0:a.owningSystemUrl)){const a=null===(i=t.SessionManager.getInstance().getSessionByUrl(l.url))||void 0===i?void 0:i.token;return a?`${l.url}/${e}?token=${a}`:l.url}return`${l.url}/${e}`}var G=c(5508),F=c.n(G),K=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const q=l=>{const a=window.SVG,{className:i}=l,s=K(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:F()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};var Q=c(8996),J=c.n(Q),Y=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const X=l=>{const a=window.SVG,{className:i}=l,s=Y(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:J()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))},Z=t.css`
  .loading-container{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
  }
  .utility-more{
    margin-right: ${t.polished.rem(-8)};
  }
  .warning-icon, .warning-icon>*{
    color: var(--sys-color-error-dark);
    fill: var(--sys-color-error-dark);
  }
`;function ee(l){var a,i,s,n,r,o,c,d,u;const{utilityId:p,filter:m,total:g,onClick:v}=l,h=W(p),[b,j]=t.React.useState(!1),[w,k]=t.React.useState(!1),[I,S]=t.React.useState(null),R=t.hooks.useTranslation(x.defaultMessages),C=t.ReactRedux.useSelector(e=>e.appStateInBuilder.appConfig.utilities[p]),U=function(e,l,a){const i=t.SessionManager.getInstance().getNoPermissionResourceInfoList()||{},s=Object.keys(i).find(t=>e.includes(t)||(null==a?void 0:a.includes(t))||t.includes(l));return s?{url:s,info:i[s]}:null}(C.url,C.itemId,C.portalUrl),M=t.ReactRedux.useSelector(e=>{var t,l,a;const i=null===(l=null===(t=e.appStateInBuilder.appRuntimeInfo)||void 0===t?void 0:t.utilityStates)||void 0===l?void 0:l[p];return null===(a=null==i?void 0:i.success)||void 0===a||a}),P=t.ReactRedux.useSelector(e=>{var l;const a=e.appStateInBuilder.resourceSessions;if(!a)return null;const i=C.url&&(null===(l=t.ServiceManager.getInstance().getServerInfoByServiceUrl(C.url))||void 0===l?void 0:l.owningSystemUrl),s=C.url&&t.serviceUrlUtils.getServerRootUrl(C.url),n=t.portalUrlUtils.getStandardPortalUrl(i||s);return n?a[n]:null}),E=t.ReactRedux.useSelector(e=>{const l=e.appStateInBuilder.resourceSessions;if(!l)return null;const a=C.portalUrl&&t.portalUrlUtils.getPlatformUrlByOrgUrl(C.portalUrl),i=t.portalUrlUtils.getStandardPortalUrl(a);return i?l[i]:null}),T=t.React.useRef(P),$=t.React.useRef(E),A=t.React.useCallback(()=>{var e,t;return null!==(t=null===(e=null==U?void 0:U.info)||void 0===e?void 0:e.allowSignIn)&&void 0!==t&&t},[U]),V=null!==(i=null!==(a=C.label)&&void 0!==a?a:C.name)&&void 0!==i?i:C.sourceLabel,H=A(),G=t.React.useCallback(()=>{k(!0);const e=t.UtilityManager.getInstance().getUtilityJson(p);let l=!1;t.UtilityManager.getInstance().getUtility(p).then(t=>{if(e.portalUrl&&e.itemId)return l=!0,S(t.itemInfo),t.itemInfo}).then(l=>{if(l)return t.UtilityManager.getInstance().getUrlOfItem(e.portalUrl,e.itemId)}).then(a=>{if(l&&(null==a||a!==e.url))throw new Error("service url is not match");return t.UtilityManager.getServiceInfo(e.url)}).then(e=>{if(!e)throw new Error("service is not available");t.UtilityManager.getInstance().reportUtilityState(p,!0)}).catch(e=>{console.error(e),t.UtilityManager.getInstance().reportUtilityState(p,!1)}).finally(()=>{k(!1)})},[p]);t.hooks.useEffectOnce(()=>{G()}),t.React.useEffect(()=>{T.current===P&&$.current===E||(T.current!==P&&t.ServiceManager.getInstance().clearServiceInfo(C.url),G()),T.current=P,$.current=E},[C.url,G,P,E]);const F=t.React.useMemo(()=>_(I,C),[I,C]),K=t.React.useCallback(e=>{const l=(0,f.getAppConfigAction)();let a=l.appConfig.utilities;a=a.setIn([C.id,"label"],e),l.updateUtilities(a).exec(),t.lodash.defer(()=>{j(!1)})},[C]),Q=t.hooks.useEventCallback(()=>{j(!0)}),J=t.React.useCallback(()=>{t.SessionManager.getInstance().signInByResourceUrl(C.url,U.info.owningSystemUrl,!0)},[C.url,U]),Y=t.React.useCallback(e=>{M&&(C.itemId&&I||!C.itemId)&&v(p,e,I),!M&&H&&t.SessionManager.getInstance().signInByResourceUrl(C.url,U.info.owningSystemUrl,!0)},[v,M,H,p,C,I,U]),ee=t.React.useCallback(()=>{b||Y(0)},[b,Y]),te=t.React.useCallback(e=>{e.stopPropagation(),Y(0)},[Y]),le=t.React.useCallback(e=>{e.stopPropagation(),Y(1)},[Y]);return(0,e.jsxs)("div",{className:(0,t.classNames)("utility-card mt-4 mx-4",{"d-none":""!==m&&!V.toLowerCase().includes(m.toLowerCase()),"not-availble":!M}),css:t.css`${Z}; order: ${M?"unset":g}`,"aria-label":null!==(n=null!==(s=C.label)&&void 0!==s?s:null==I?void 0:I.title)&&void 0!==n?n:C.sourceLabel,tabIndex:0,onKeyDown:e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||ee()},role:"option",children:[w&&(0,e.jsx)("div",{className:"loading-container",children:(0,e.jsx)(x.Loading,{type:x.LoadingType.Bar})}),(0,e.jsxs)("div",{className:"d-flex align-items-center utility-card-header",children:[(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 utility-thumbnail",children:(null===(r=C.tasks)||void 0===r?void 0:r.length)>0?(0,e.jsx)(L,{size:"s",color:"var(--ref-palette-black)"}):(0,e.jsx)(y.UtilityIcon,{type:C.type,size:"s",color:"var(--ref-palette-black)"})}),(0,e.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 utility-type flex-shrink-1 text-truncate utility-type-name",children:C.type}),(0,e.jsx)("div",{className:"ml-auto flex-shrink-0",children:(0,e.jsx)(O.DataBadge,{portalUrl:C.portalUrl,itemId:C.itemId,url:C.itemId?null:C.url})}),!M&&(0,e.jsx)("div",{className:"ml-auto flex-shrink-0",children:(0,e.jsx)(x.Tooltip,{title:H?R("signInErrorEnterCredential"):(null==U?void 0:U.info)?R("signInErrorCannotEnterCredential"):R("serviceNotAvailable"),placement:"bottom",children:(0,e.jsx)(x.Button,{size:"sm",icon:!0,type:"tertiary",className:"cursor-default p-0 jimu-outline-inside",onClick:H?J:null,children:(0,e.jsx)(X,{size:"m",color:"var(--sys-color-warning-main)"})})})}),(0,e.jsx)("div",{className:"d-flex flex-shrink-0",children:(0,e.jsx)(B,{utilityId:C.id,label:null!==(o=C.label)&&void 0!==o?o:C.sourceLabel,relatedWidgetIds:h,onRename:Q})})]}),(0,e.jsx)("div",{className:"utility-card-body",css:t.css`cursor: ${b?"default":"pointer"};`,onClick:ee,children:(0,e.jsx)(z,{text:null!==(d=null!==(c=C.label)&&void 0!==c?c:null==I?void 0:I.title)&&void 0!==d?d:C.sourceLabel,isEditing:b,onChange:K,className:b?"flex-grow-1 utility-label utility-label-input":"flex-grow-1 two-line-truncate utility-label text-left"})}),(0,e.jsxs)("div",{className:"utility-card-footer",css:t.css`cursor: ${b?"default":"pointer"};`,onClick:ee,children:[(null===(u=C.tasks)||void 0===u?void 0:u.length)>0&&(0,e.jsxs)("div",{className:"d-flex align-items-center mr-4",title:R("containUtilitiesWithNum",{utilityNum:C.tasks.length}),children:[(0,e.jsx)(x.Button,{type:"tertiary",size:"sm",className:"p-0 utility-tasks",disabled:!M,onClick:te,children:(0,e.jsx)(D,{className:"mr-1",size:"m"})}),(0,e.jsx)("div",{className:"number",children:C.tasks.length})]}),(0,e.jsxs)("div",{className:"d-flex align-items-center",title:R("relatedWidgetsWithDirectlyNum",{num:h.length}),children:[(0,e.jsx)(x.Button,{type:"tertiary",size:"sm",className:"p-0 utility-related-widgets",title:R("relatedWidgetsWithDirectlyNum",{num:h.length}),"aria-label":R("relatedWidgetsWithDirectlyNum",{num:h.length}),disabled:!M,onClick:le,children:(0,e.jsx)(N,{className:"mr-1",size:"m"})}),(0,e.jsx)("div",{className:"number",children:h.length})]}),(0,e.jsx)(x.Link,{to:w?null:F,className:"p-0 utility-label-link ml-auto utility-preview",target:"_blank",children:(0,e.jsx)(x.Button,{type:"tertiary",size:"sm",disabled:!M,children:(0,e.jsx)(q,{className:"mr-0",size:"m"})})})]})]})}const te=t.css`
  .title{
    padding: 18px 16px 2px 16px !important;
    font-size: 1rem;
    font-weight: 500;
    color: var(--ref-palette-neutral-1000);
    .search-icon{
      cursor: pointer;
      width: 30px;
    }
  }

  .add-utility{
    height: ${t.polished.rem(30)};
    line-height: ${t.polished.rem(30)};
    width: 228px;
    padding: 0;
    border-radius: 2px;
    cursor: pointer;
    .add-utility-label{
      max-width: 85%;
    }
  }
  button.add-utility:hover{
    color: var(--ref-palette-black) !important;
  }
`;function le(l){const{onCardClick:a}=l,i=t.React.useRef(void 0),n=t.React.useRef(void 0),[r,o]=t.React.useState(!1),[c,d]=t.React.useState(!1),[p,m]=t.React.useState(""),g=t.React.useRef(void 0),j=t.hooks.useTranslation(x.defaultMessages,b),w=t.ReactRedux.useSelector(e=>{var t,l;return null===(l=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===l?void 0:l.utilities}),k=t.ReactRedux.useSelector(e=>{var t,l,a;return null===(a=null===(l=null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.sectionNavInfos)||void 0===l?void 0:l["opts-section"])||void 0===a?void 0:a.currentViewId});t.React.useEffect(()=>{"utility"!==k&&o(!1)},[k]),t.React.useEffect(()=>{c&&(0,t.focusElementInKeyboardMode)(g.current,!0)},[c]);const N=t.React.useMemo(()=>Object.keys(null!=w?w:{}).filter(e=>"org"!==w[e].source),[w]),O=t.React.useCallback(()=>{o(!r)},[r]),I=t.hooks.useEventCallback(e=>{(0,f.getAppConfigAction)().updateUtilities(e).exec()}),S=t.React.useCallback((e,t,l)=>{a(e,t,l)},[a]),R=t.React.useCallback(()=>{c&&m(""),d(!c)},[c]),C=t.hooks.useEventCallback(e=>{m(e.target.value)});return(0,e.jsxs)("div",{css:te,className:"jimu-widget widget-utility-setting setting-pane bg-default",ref:i,children:[(0,e.jsxs)("div",{className:"h-100",children:[(0,e.jsxs)("div",{className:"jimu-builder-panel--header title d-flex flex-row text-data-600 title justify-content-between",children:[(0,e.jsx)("div",{className:"mb-0 text-truncate text-left",title:j("utilityService"),children:j("utilityService")}),(0,e.jsx)("div",{className:"search-icon d-flex align-items-start justify-content-end",children:(0,e.jsx)(x.Button,{size:"sm",icon:!0,type:"tertiary",title:j("search"),"aria-label":j("search"),onClick:R,children:(0,e.jsx)(u,{size:"m"})})})]}),c&&(0,e.jsx)("div",{className:"mt-2 w-100 px-4",children:(0,e.jsx)(x.TextInput,{className:"w-100",allowClear:!0,placeholder:j("search"),value:p,ref:g,onChange:C})}),(0,e.jsx)("div",{className:"d-flex mx-4 mb-1 mt-4",children:(0,e.jsx)(x.Button,{ref:n,type:"primary",className:"flex-grow-1 text-center add-utility",onClick:O,title:j("addUtility"),"aria-label":j("addUtility"),children:(0,e.jsxs)("div",{className:"w-100 px-2 d-flex align-items-center justify-content-center",children:[(0,e.jsx)(s,{size:"m",className:"mr-2"}),(0,e.jsx)("div",{className:"add-utility-label text-truncate",children:j("addUtility")})]})})}),0===N.length&&(0,e.jsxs)("div",{className:"empty-placeholder w-100",children:[(0,e.jsx)("div",{className:"empty-placeholder-icon",children:(0,e.jsx)(v,{size:48})}),(0,e.jsx)("div",{className:"empty-placeholder-text",dangerouslySetInnerHTML:{__html:j("noUtilityTip")}})]}),(0,e.jsx)("div",{className:"d-flex flex-column",css:t.css`height: calc(100% - 100px); overflow: auto;`,children:N.map(t=>(0,e.jsx)(ee,{total:N.length,filter:p,utilityId:t,onClick:S},t))})]}),(0,e.jsx)(h.SidePopper,{title:j("addUtility"),position:"left",isOpen:r,toggle:O,trigger:i.current,backToFocusNode:n.current,children:(0,e.jsx)(y.AddUtilityTabs,{utilities:w,onChange:I})})]})}var ae=c(6572),ie=c.n(ae),se=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const ne=l=>{const a=window.SVG,{className:i}=l,s=se(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:ie()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};function re(l){const{widgetIdList:a,isInTab:i=!1}=l,s=t.hooks.useTranslation(x.defaultMessages);return 0===a.length?(0,e.jsxs)("div",{className:"empty-placeholder w-100",children:[(0,e.jsx)("div",{className:"empty-placeholder-icon",children:(0,e.jsx)(v,{size:48})}),(0,e.jsx)("div",{className:"empty-placeholder-text",children:s("noRelatedWidget")})]}):(0,e.jsxs)("div",{className:(0,t.classNames)("related-widgets px-4",{"pt-4":!i}),children:[!i&&(0,e.jsx)("div",{css:t.css`font-size: 14px; line-height: 19px;`,children:s("relatedWidgets")}),l.widgetIdList.map(t=>(0,e.jsx)(U,{widgetId:t,className:"mt-2 p-1"},t))]})}var oe=c(3529),ce=c.n(oe),de=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const ue=l=>{const a=window.SVG,{className:i}=l,s=de(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:ce()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))};var pe=c(4109),me=c.n(pe),ge=function(e,t){var l={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(l[a[i]]=e[a[i]])}return l};const ve=l=>{const a=window.SVG,{className:i}=l,s=ge(l,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:n,src:me()},s)):(0,e.jsx)("svg",Object.assign({className:n},s))},xe=t.css`
  &:not(.not-availble):hover{
    background-color: var(--ref-palette-neutral-600);
  }
`;function fe(l){const{utilityId:a,taskName:i,inUse:s=!1,total:n,onClick:r}=l,o=W(a,i),c=t.hooks.useTranslation(x.defaultMessages),d=t.ReactRedux.useSelector(e=>e.appStateInBuilder.appConfig.utilities[a]),u=t.React.useMemo(()=>H(i,d),[i,d]),p=t.React.useMemo(()=>{const e=d.tasks.findIndex(e=>e.name===i);return d.tasks[e].label},[d,i]),m=t.ReactRedux.useSelector(e=>{var t;return null===(t=e.appStateInBuilder.appConfig.utilities[d.id].tasks.find(e=>e.name===i).visible)||void 0===t||t}),g=t.React.useCallback(()=>{const e=(0,f.getAppConfigAction)(),t=e.appConfig.utilities[d.id],l=[];t.tasks.forEach(e=>{e.name===i?l.push(e.set("visible",null!=e.visible&&!e.visible)):l.push(e)});const a=e.appConfig.utilities.setIn([d.id,"tasks"],l);e.updateUtilities(a).exec()},[d.id,i]),v=t.React.useCallback(()=>{r(i,o)},[i,r,o]);return s&&0===o.length||!s&&o.length>0?null:(0,e.jsxs)("div",{className:(0,t.classNames)("utility-card mt-4",{"not-availble":!m}),css:t.css`
        ${xe};
        order: ${m?"initial":n+2}
      `,"aria-label":null!=p?p:i,tabIndex:0,onKeyDown:e=>{e.target!==e.currentTarget||"Enter"!==e.key&&" "!==e.key||v()},role:"option",children:[(0,e.jsxs)("div",{className:"d-flex align-items-center utility-card-header",children:[(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 utility-thumbnail",children:(0,e.jsx)(y.UtilityIcon,{type:d.type,size:"s",color:m?"var(--ref-palette-black)":"var(--ref-palette-neutral-900)"})}),(0,e.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 utility-type flex-shrink-1 text-truncate utility-type-name",children:c("geoprocessingTask")}),0===o.length&&(0,e.jsx)(x.Button,{type:"tertiary",title:c(m?"invisible":"visible"),"aria-label":c(m?"invisible":"visible"),className:"p-0 ml-auto utility-tasks align-items-center",onClick:g,children:m?(0,e.jsx)(ue,{className:"mr-0",size:"m"}):(0,e.jsx)(ve,{className:"mr-0",size:"m"})})]}),(0,e.jsx)("div",{className:"utility-card-body two-line-truncate",onClick:v,children:null!=p?p:i}),(0,e.jsxs)("div",{className:"utility-card-footer",onClick:v,children:[(0,e.jsxs)("div",{className:"d-flex align-items-center",title:c("relatedWidgetsWithDirectlyNum",{num:o.length}),children:[(0,e.jsx)(x.Button,{type:"tertiary",size:"sm",className:"p-0 utility-related-widgets",title:c("relatedWidgetsWithDirectlyNum",{num:o.length}),"aria-label":c("relatedWidgetsWithDirectlyNum",{num:o.length}),children:(0,e.jsx)(N,{className:"mr-1",size:"m",color:m?null:"var(--ref-palette-neutral-800)"})}),(0,e.jsx)("div",{className:"number",children:o.length})]}),(0,e.jsx)(x.Link,{to:u,className:"p-0 utility-label-link ml-auto utility-preview",target:"_blank",children:(0,e.jsx)(x.Button,{type:"tertiary",size:"sm",disabled:!m,children:(0,e.jsx)(q,{className:"mr-0",size:"m"})})})]})]})}const he=t.css`
  .utility-detail-header {
    display: flex;
  }
  .max-width-1{
    max-width: ${t.polished.rem(190)};
  }
  .max-width-2{
    max-width: ${t.polished.rem(90)};
  }
`;function ye(l){const{utilityId:a,taskName:i,relatedWidgets:s}=l,[n,r]=t.React.useState(!1),o=t.ReactRedux.useSelector(e=>e.appStateInBuilder.appConfig.utilities[a]),c=t.React.useMemo(()=>{const e=o.tasks.findIndex(e=>e.name===i);return o.tasks[e].label},[o,i]),[d,u]=t.React.useState(null!=c?c:i),p=t.hooks.useTranslation(x.defaultMessages),m=t.React.useMemo(()=>H(i,o),[i,o]),g=t.hooks.useEventCallback(()=>{r(!0)}),v=t.React.useCallback(e=>{const l=(0,f.getAppConfigAction)();let s=l.appConfig.utilities,n=o.tasks;const c=n.findIndex(e=>e.name===i);n=t.Immutable.set(n,c,n[c].set("label",e)),s=s.set(a,o.set("tasks",n)),l.updateUtilities(s).exec(),r(!1),u(e)},[a,o,i]);return(0,e.jsxs)("div",{className:"card-detail",css:he,children:[(0,e.jsxs)("div",{className:"px-4 pt-2 justify-content-between align-items-center utility-detail-header",children:[(0,e.jsxs)("div",{className:"d-flex align-items-center w-100",children:[(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 utility-thumbnail",children:(0,e.jsx)(y.UtilityIcon,{type:o.type,size:"s",color:"var(--ref-palette-black)"})}),(0,e.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 utility-type",children:(0,e.jsx)("div",{className:"text-truncate utility-type-name",children:p("geoprocessingTask")})})]}),(0,e.jsx)("div",{className:"d-flex",children:(0,e.jsx)(B,{utilityId:"",label:"",relatedWidgetIds:null,onRename:g,showRemove:!1})})]}),(0,e.jsxs)("div",{className:"utility-detail-body",children:[(0,e.jsx)(x.Link,{to:n?null:m,className:(0,t.classNames)("utility-label-link d-flex",{"text-decoration-none":n}),target:"_blank",children:(0,e.jsx)(z,{text:d,isEditing:n,onChange:v,className:n?"flex-grow-1 m-2 utility-label utility-label-input":"flex-grow-1 m-2 two-line-truncate utility-label text-left"})}),(0,e.jsx)(re,{widgetIdList:s})]})]})}const be=t.css`
  & > .nav {
    border-bottom: 1px solid var(--ref-palette-neutral-700);
    padding: 10px;
  }
  .utility-detail-header {
    display: flex;
  }
  .utility-detail-body{
    height: calc(100% - 80px);
  }
  .utility-relations {
    border-top: 1px solid var(--ref-palette-neutral-700);
  }
  .max-width-1{
    max-width: ${t.polished.rem(190)};
  }
  .max-width-2{
    max-width: ${t.polished.rem(90)};
  }
  .task-group {
    overflow: auto;
    height: 100%;

    .task-group-title {
      font-size: ${t.polished.rem(14)};
      color: var(--ref-palette-neutral-1000);
      font-weight: 600;
      display: none;
    }

    .task-group-title:has(+ .utility-card) {
      display: block;
    }

    .task-group-title.others:not(:last-child) {
      display: block;
    }

    .placeholder + .task-group-title.in-use {
      display: block;
    }

    .task-group-title + .task-group-title {
      display: none !important;
    }
  }
`;function je(l){var a,i,s,n,r;const{utilityId:o,item:c,onNavBack:d,defaultTab:u=0}=l,p=t.ReactRedux.useSelector(e=>e.appStateInBuilder.appConfig.utilities[o]),[m,g]=t.React.useState(!1),[v,b]=t.React.useState(!1),[j,w]=t.React.useState(!1),[k,N]=t.React.useState(null!==(i=null!==(a=null==p?void 0:p.label)&&void 0!==a?a:null==p?void 0:p.sourceLabel)&&void 0!==i?i:""),I=t.React.useRef(void 0),S=t.React.useRef(void 0),R=t.React.useRef(void 0),C=W(o),U=t.hooks.useTranslation(x.defaultMessages),M=t.React.useMemo(()=>{if(p)return _(c,p)},[c,p]),P=t.ReactRedux.useSelector(e=>{var t,l,a;return null===(a=null===(l=null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.sectionNavInfos)||void 0===l?void 0:l["opts-section"])||void 0===a?void 0:a.currentViewId});t.React.useEffect(()=>{"utility"!==P&&b(!1)},[P]);const E=t.hooks.useEventCallback(()=>{g(!0)}),T=t.React.useCallback(e=>{const t=(0,f.getAppConfigAction)();let l=t.appConfig.utilities;l=l.setIn([p.id,"label"],e),t.updateUtilities(l).exec(),g(!1),N(e)},[p]),$=t.React.useCallback(()=>{b(!v)},[v]),A=t.React.useCallback((e,t)=>{w(!0);const l=(0,f.getAppConfigAction)().appConfig.utilities[o],a=l.tasks.findIndex(t=>t.name===e),i=l.tasks[a].label;R.current={taskName:e,taskLabel:i,widgets:t}},[o]),V=t.React.useCallback(()=>{w(!1),R.current=null},[]);return p?(0,e.jsxs)("div",{className:"card-detail h-100",css:be,ref:I,children:[(0,e.jsxs)("div",{className:"nav d-flex align-items-center",children:[(0,e.jsx)(x.Button,{icon:!0,size:"sm",type:"link",onClick:d,title:U("back"),"aria-label":U("back"),children:(0,e.jsx)(ne,{})}),"/",j?(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(x.Link,{title:k,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||V()},onClick:V,role:"button",className:"text-left text-truncate max-width-2",children:k}),"/",(0,e.jsx)("span",{className:"pl-1 text-left text-truncate max-width-2",children:null!==(s=R.current.taskLabel)&&void 0!==s?s:R.current.taskName})]}):(0,e.jsx)("span",{className:"pl-1 text-left text-truncate max-width-1",children:k})]}),(0,e.jsxs)("div",{className:(0,t.classNames)("px-4 pt-2 justify-content-between align-items-center utility-detail-header",{"d-none":j}),children:[(0,e.jsxs)("div",{className:"d-flex align-items-center w-100",children:[(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 utility-thumbnail",children:(null===(n=p.tasks)||void 0===n?void 0:n.length)>1?(0,e.jsx)(L,{size:"s",color:"var(--ref-palette-black)"}):(0,e.jsx)(y.UtilityIcon,{type:p.type,size:"s",color:"var(--ref-palette-black)"})}),(0,e.jsx)("div",{className:"flex-grow-1 text-truncate pl-2 utility-type",children:(0,e.jsx)("div",{className:"text-truncate utility-type-name",children:p.type})})]}),(0,e.jsxs)("div",{className:"d-flex",children:[c&&(0,e.jsxs)(x.Button,{icon:!0,size:"sm",type:"tertiary",onClick:$,ref:S,title:U("details"),"aria-label":U("details"),children:[" ",(0,e.jsx)(q,{})," "]}),(0,e.jsx)(B,{utilityId:p.id,label:k,relatedWidgetIds:C,onRename:E,beforeRemove:d})]})]}),(0,e.jsxs)("div",{className:(0,t.classNames)("utility-detail-body",{"d-none":j}),children:[(0,e.jsx)(x.Link,{to:m?null:M,className:(0,t.classNames)("utility-label-link d-flex",{"text-decoration-none":m}),target:"_blank",children:(0,e.jsx)(z,{text:k,isEditing:m,onChange:T,className:m?"flex-grow-1 m-2 utility-label utility-label-input":"flex-grow-1 m-2 two-line-truncate utility-label text-left"})}),(null===(r=p.tasks)||void 0===r?void 0:r.length)>0&&(0,e.jsx)("div",{className:"pt-2",css:t.css`height: calc(100% - 50px); .tab-nav{margin:0 1rem;}`,children:(0,e.jsxs)(x.Tabs,{className:"h-100",type:"pills",fill:!0,defaultValue:0===u?"tasks":"widgets",children:[(0,e.jsx)(x.Tab,{id:"tasks",title:U("tasks"),children:(0,e.jsxs)("div",{className:"task-group px-4 d-flex flex-column",children:[C.length>0&&(0,e.jsx)("div",{className:"d-none placeholder"}),(0,e.jsx)("div",{className:"task-group-title in-use mt-4",children:U("inUse")}),[...p.tasks].map(t=>(0,e.jsx)(fe,{total:p.tasks.length,inUse:!0,utilityId:o,taskName:t.name,onClick:A},t.name)),(0,e.jsx)("div",{className:"task-group-title others mt-4",children:U("others")}),[...p.tasks].map(t=>(0,e.jsx)(fe,{total:p.tasks.length,utilityId:o,taskName:t.name,onClick:A},t.name))]})}),(0,e.jsx)(x.Tab,{id:"widgets",title:U("widgets"),children:(0,e.jsx)(re,{widgetIdList:C,isInTab:!0})})]})}),(null==p.tasks||0===p.tasks.length)&&(0,e.jsx)("div",{className:"utility-relations",children:(0,e.jsx)(re,{widgetIdList:C})})]}),j&&(0,e.jsx)(ye,{utilityId:o,taskName:R.current.taskName,relatedWidgets:R.current.widgets}),c&&(0,e.jsx)(h.SidePopper,{title:k,position:"left",isOpen:v&&!j,toggle:$,trigger:I.current,backToFocusNode:S.current,children:(0,e.jsx)(O.ItemDetail,{item:c,portalUrl:p.portalUrl})})]}):(d(),null)}const we=e=>t.css`
  .utility-card {
    &.not-availble {
      background-color: var(--ref-palette-neutral-500);
      .utility-thumbnail{
        background-color: var(--ref-palette-neutral-700);
      }
      .utility-card-header{
        background-color: var(--ref-palette-neutral-500);
      }
      .utility-type, .utility-card-body, .utility-card-footer, .number{
        color: var(--ref-palette-neutral-900);
      }
    }
    &:not(.not-availble):hover {
      background-color: ${t.polished.rgba(null==e?void 0:e.ref.palette.neutral[600],.8)};
    }

    background-color: var(--ref-palette-neutral-500);
    font-size: ${t.polished.rem(12)};
    border-radius: 2px;
    padding: 0;
    position: relative;
    cursor: pointer;
    .utility-card-header{
      width: 100%;
      height: ${t.polished.rem(38)};
      padding: 0 10px;
      background-color: var(--ref-palette-neutral-600);
    }
    .utility-card-body{
      max-height: 3rem;
      padding: 12px 12px 0 10px;
    }
    .two-line-truncate{
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      word-break: break-word;
      word-wrap: break-word;
    }
    .utility-card-footer {
      padding: 1rem 10px 10px;
      display: flex;
      line-height: 1;
      align-items: center;
      .utility-label-link {
        line-height: 1;
      }
      .number {
        padding-top: 3px;
        text-align: center;
        color: var(--ref-palette-neutral-1000);
      }
      .jimu-btn {
        border-width: 0;
      }
    }
    .utility-label{
      font-size: ${t.polished.rem(14)};
      color: currentColor;
    }
    .utility-type{
      font-size: ${t.polished.rem(13)};
      color: currentColor;
      max-width: ${t.polished.rem(160)};
    }
    .utility-related-widgets, .utility-child-dss{
      font-size: ${t.polished.rem(13)};
    }
    .utility-thumbnail{
      width:  ${t.polished.rem(18)};
      height:  ${t.polished.rem(18)};
      background-color: var(--sys-color-info-main);
    }
  }
  .empty-placeholder{
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    .empty-placeholder-text, .empty-placeholder-icon{
      display: table;
      margin: 0 auto;
    }
    .empty-placeholder-text{
      color: var(--ref-palette-neutral-900);
      font-size: ${t.polished.rem(14)};
      margin-top: 16px;
      text-align: center;
    }
    .empty-placeholder-icon{
      color: var(--sys-color-action-disabled-text);
    }
  }
`;function ke(l){const[a,i]=t.React.useState(0),[s,n]=t.React.useState(0),[r,o]=t.React.useState(null),c=t.React.useCallback((e,t,l)=>{o({utilityId:e,item:l}),n(t),i(1)},[]),d=t.hooks.useEventCallback(()=>{i(0)});return(0,e.jsxs)("div",{css:we(l.theme),className:"jimu-widget widget-utility-setting setting-pane bg-default",children:[(0,e.jsx)("div",{className:(0,t.classNames)("w-100 h-100",{"d-none":0!==a}),children:(0,e.jsx)(le,{onCardClick:c})}),1===a&&(0,e.jsx)(je,{utilityId:r.utilityId,item:r.item,onNavBack:d,defaultTab:s})]})}function Ne(e){c.p=e}})(),d})())}}});