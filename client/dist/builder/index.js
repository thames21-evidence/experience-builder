System.register(["jimu-layouts/layout-runtime","jimu-arcgis","jimu-for-builder","jimu-ui","jimu-for-builder/templates","jimu-core/emotion","jimu-ui/basic/guide","jimu-core","jimu-for-builder/service"],function(e,t){var n={},i={},s={},o={},d={},a={},r={},l={},u={};return{setters:[function(e){n.init=e.init,n.searchUtils=e.searchUtils},function(e){i.init=e.init},function(e){s.AppStateHistoryExtension=e.AppStateHistoryExtension,s.AppStateReduxStoreExtension=e.AppStateReduxStoreExtension,s.BuilderStateReduxStoreExtension=e.BuilderStateReduxStoreExtension,s.builderAppSync=e.builderAppSync,s.defaultMessages=e.defaultMessages,s.getAppConfigAction=e.getAppConfigAction,s.init=e.init,s.templateUtils=e.templateUtils},function(e){o.init=e.init},function(e){d.init=e.init},function(e){a.jsx=e.jsx},function(e){r.EVENTS=e.EVENTS,r.GuideComponent=e.GuideComponent,r.STATUS=e.STATUS,r.findLayoutItem=e.findLayoutItem,r.getTargetSelector=e.getTargetSelector},function(e){l.AppRoot=e.AppRoot,l.ArcGISDependencyDefineExtension=e.ArcGISDependencyDefineExtension,l.ExtensionManager=e.ExtensionManager,l.GuideLevels=e.GuideLevels,l.GuideManager=e.GuideManager,l.GuideTypes=e.GuideTypes,l.LayoutItemType=e.LayoutItemType,l.PageMode=e.PageMode,l.React=e.React,l.ReactDOMClient=e.ReactDOMClient,l.ReactRedux=e.ReactRedux,l.SessionManager=e.SessionManager,l.SystemErrorCode=e.SystemErrorCode,l.SystemErrorType=e.SystemErrorType,l.appActions=e.appActions,l.extensionSpec=e.extensionSpec,l.getAppStore=e.getAppStore,l.i18n=e.i18n,l.init=e.init,l.injectIntl=e.injectIntl,l.jimuHistory=e.jimuHistory,l.privilegeUtils=e.privilegeUtils,l.useIntl=e.useIntl,l.utils=e.utils},function(e){u.userServices=e.userServices}],execute:function(){e((()=>{"use strict";var e={1496:e=>{e.exports=n},2686:e=>{e.exports=i},4108:e=>{e.exports=s},4321:e=>{e.exports=o},5132:e=>{e.exports=JSON.parse('{"steps":[{"steps":[{"title":"${DSSelectionStep4Title}","content":"${DSSelectionStep4Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\']) .component-data-source-selector .jimu-button","requiredAction":{"type":"click"},"disableNextButton":true},{"title":"${DSSelectionStep1Title}","content":"${DSSelectionStep1Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\']) .component-data-source-selector .jimu-button","requiredAction":{"type":"click"},"disableNextButton":true}]},{"title":"${DSSelectionStep2Title}","content":{"image":{"src":"jimu-for-builder/guide-assets/add-data.gif","alt":"${DSSelectionStep2Title}","width":400,"height":220},"text":"${DSSelectionStep2Content}"},"placement":"left-end","target":".component-data-source-list .ds-add-data","requiredAction":{"type":"click"},"disableNextButton":true},{"steps":[{"title":"${DSSelectionStep5Title}","content":"${DSSelectionStep5Content}","placement":"left","target":".component-data-source-list .ds-list","spotlightClicks":true},{"title":"${DSSelectionStep3Title}","content":"${DSSelectionStep3Content}","placement":"left","target":".component-data-source-list .ds-list","spotlightClicks":true}]}]}')},6884:e=>{e.exports=d},7386:e=>{e.exports=a},8151:e=>{e.exports=r},9027:e=>{e.exports=JSON.parse('{"steps":[{"injectedGuide":"express-welcome-introduction"},{"injectedGuide":"express-map-widget"},{"injectedGuide":"express-widget-controller"},{"injectedGuide":"express-placeholder"},{"injectedGuide":"express-grid"},{"injectedGuide":"express-section"},{"injectedGuide":"express-sidebar"},{"injectedGuide":"express-window"},{"injectedGuide":"express-theme"},{"injectedGuide":"express-app-setting"},{"injectedGuide":"express-general-setting"},{"title":"${expressEndGuideTitle}","content":{"image":{"src":"builder/assets/congratulations.png","alt":"${expressEndGuideTitle}","width":183,"height":160},"text":"${expressEndGuideContent}","direction":"horizontal"},"placement":"center","width":540,"height":260,"target":"[data-widgetid=\'app-loader\']"}]}')},9244:e=>{e.exports=l},9565:e=>{e.exports=JSON.parse('{"steps":[{"type":"splash","title":"${openingGuideStep1Title}","content":{"image":{"src":"builder/assets/start-splash.svg","alt":"${openingGuideStep1Title}","width":237,"height":286},"text":"${openingGuideStep1Content}","direction":"horizontal"},"placement":"center","target":"#app","width":600},{"title":"${openingGuideStep2Title}","content":{"image":{"src":"builder/assets/start1-canvas.svg","alt":"Canvas","width":400,"height":220,"autoFlip":true},"text":"${openingGuideStep2Content}"},"target":"[data-widgetid=\'app-loader\']"},{"title":"${openingGuideStep3Title}","placement":"right","content":{"image":{"src":"builder/assets/start2-sidebar.gif","alt":"${openingGuideStep3Title}","width":400,"height":220,"border":true,"autoFlip":true},"text":"${openingGuideStep3Content}"},"target":"[data-widgetid=\'left-sidebar\'] .side"},{"injectedGuide":"insert-widget","params":{"widgetName":"arcgis-map"}},{"title":"${openingGuideStep5Title}","content":{"image":{"src":"builder/assets/resize-widget.gif","alt":"${openingGuideStep5Title}","width":400,"height":220,"autoFlip":true},"text":"${openingGuideStep5Content}"},"target":".selected.is-widget .widget-map-usemask","spotlightPadding":15,"targetInCanvas":true,"spotlightClicks":true},{"injectedGuide":"ds-selection"},{"title":"${openingGuideStep7Title}","content":"${openingGuideStep7Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-title-item:nth-child(2)","requiredAction":{"type":"click"},"disableNextButton":true},{"steps":[{"title":"${openingGuideStep8Title}","content":"${openingGuideStep8Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-content","spotlightClicks":true},{"title":"${openingGuideStep8Title2}","content":"${openingGuideStep8Content2}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-content","spotlightClicks":true}]},{"title":"${openingGuideStep9Title}","content":"${openingGuideStep9Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-title-item:nth-child(3)","requiredAction":{"type":"click"},"disableNextButton":true},{"title":"${openingGuideStep10Title}","content":{"image":{"src":"builder/assets/start-action.gif","alt":"${openingGuideStep10Title}","width":400,"height":220},"text":"${openingGuideStep10Content}"},"placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-content"},{"title":"${openingGuideStep11Title}","content":"${openingGuideStep11Content}","placement":"bottom","target":".widget-builder-header","spotlightClicks":true},{"title":"${openingGuideStep12Title}","content":"${openingGuideStep12Content}","placement":"right","target":"[data-sectionid=\'opts-section\']"},{"title":"${openingGuideStep13Title}","content":"${openingGuideStep13Content}","placement":"right","target":"[data-sectionid=\'opts-section\']"},{"title":"${openingGuideStep14Title}","content":"${openingGuideStep14Content}","placement":"right","target":"[data-sectionid=\'opts-section\']"},{"title":"${openingGuideStep15Title}","content":"${openingGuideStep15Content}","placement":"center","target":"[data-widgetid=\'app-loader\']"}]}')},9860:e=>{e.exports=u}},t={};function c(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,c),s.exports}var p=c(7386),g=c(9244),m=c(4108),S=c(2686),x=c(1496),v=c(4321),h=c(6884),I=c(9860),f=c(8151);class w extends g.React.PureComponent{constructor(e){var t,n,i,s;super(e),this.currentStep=0,this.handleChange=e=>{var t,n,i;const{index:s,nextIndex:o,event:d}=e;if(2===s?g.jimuHistory.changeView("opts-section","insert"):4===s?(0,g.getAppStore)().dispatch(g.appActions.widgetStatePropChange("right-sidebar","collapse",!0)):11===s?g.jimuHistory.changeView("opts-section","page"):12===s?g.jimuHistory.changeView("opts-section","data"):13===s&&g.jimuHistory.changeView("opts-section","theme"),2===o&&d===f.EVENTS.STEP_AFTER)(0,g.getAppStore)().dispatch(g.appActions.widgetStatePropChange("left-sidebar","collapse",!0));else if(7===o&&d===f.EVENTS.STEP_AFTER){const e=null===(t=this.props)||void 0===t?void 0:t.pageMode;this.setState({conditionalStepIndexes:Object.assign(Object.assign({},this.state.conditionalStepIndexes),{7:e===g.PageMode.AutoScroll?1:0})})}null===(i=null===(n=this.props)||void 0===n?void 0:n.onStepChange)||void 0===i||i.call(n,e)},this.handleClick=(e,t,n)=>{this.setState({stepIndex:n+1})};const o=e.intl,d=g.utils.replaceI18nPlaceholdersInObject(c(9565),o,o.messages);this.state={stepIndex:null!==(t=e.stepIndex)&&void 0!==t?t:0,steps:null!==(n=d.steps)&&void 0!==n?n:[],conditionalStepIndexes:null!==(i=e.conditionalStepIndexes)&&void 0!==i?i:{},run:null===(s=e.run)||void 0===s||s}}componentDidUpdate(e){(null==e?void 0:e.run)!==this.props.run&&this.setState({run:this.props.run}),(null==e?void 0:e.stepIndex)!==this.props.stepIndex&&this.setState({stepIndex:this.props.stepIndex})}render(){const{stepIndex:e,steps:t,run:n,conditionalStepIndexes:i}=this.state;return(0,p.jsx)(f.GuideComponent,{run:n,stepIndex:e,steps:t,conditionalStepIndexes:i,onStepChange:this.handleChange,onActionTriggered:this.handleClick})}}const C=g.ReactRedux.connect(e=>{var t,n,i,s,o,d;const a=null===(n=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo)||void 0===n?void 0:n.currentPageId;return{queryObject:e.queryObject,pageMode:null===(d=null===(o=null===(s=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig)||void 0===s?void 0:s.pages)||void 0===o?void 0:o[a])||void 0===d?void 0:d.mode}})((0,g.injectIntl)(w)),{useState:G,useEffect:T}=g.React;const y=g.ReactRedux.connect((e,t)=>{var n,i,s,o,d,a;const r=null===(n=null==t?void 0:t.widgetJson)||void 0===n?void 0:n.id,l=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig;return{layouts:null==l?void 0:l.layouts,widgets:null==l?void 0:l.widgets,sections:null==l?void 0:l.sections,messageConfigs:null==l?void 0:l.messageConfigs,controllerPanels:null==l?void 0:l.controllerPanels,placeholderInfos:null==l?void 0:l.placeholderInfos,dataSourcesInfo:null===(s=e.appStateInBuilder)||void 0===s?void 0:s.dataSourcesInfo,widgetsState:null===(o=e.appStateInBuilder)||void 0===o?void 0:o.widgetsState,widgetDs:null===(a=null===(d=null==l?void 0:l.widgets)||void 0===d?void 0:d[r])||void 0===a?void 0:a.useDataSources}})(e=>{const t=(0,g.useIntl)(),n=g.utils.replaceI18nPlaceholdersInObject(c(9027),t,t.messages),{dataSourcesInfo:i,widgetDs:s}=e,[o,d]=G(!1),[a,r]=G(0),[l,u]=G(!1),m=function(e,t){if(!e||!t)return!1;const n=Object.keys(null!=e?e:{}).length;return Object.keys(null!=t?t:{}).length>n}(function(e){const t=g.React.useRef(void 0);return T(()=>{t.current=e}),t.current}(i),i);return T(()=>{},[e.stepIndex]),T(()=>{d(e.run)},[e.run]),T(()=>{r(e.stepIndex)},[e.stepIndex]),T(()=>{o&&s&&u(!s.length),!o&&m&&(r(2),d(!0))},[s,m,o]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:o,stepIndex:a,steps:n.steps,onActionTriggered:(t,n,i)=>{var s;null===(s=null==e?void 0:e.onActionTriggered)||void 0===s||s.call(e,t,n,i)},onStepChange:t=>{null==e||e.onStepChange(t)},disabled:l}))}),{useState:j,useEffect:b,useMemo:E}=g.React,R=g.ReactRedux.connect(null)(e=>{const[t,n]=j(!1),[i,s]=j(0),o=(0,g.useIntl)(),d=e=>o.formatMessage({id:e}),a=E(()=>[{type:"splash",title:d("openingGuideStep1Title"),content:{image:{src:"builder/assets/start-splash.svg",alt:d("openingGuideStep1Title"),width:237,height:286},text:d("welcomeStep1Content"),direction:"horizontal"},placement:"center",target:"#app",width:600}],[]);return b(()=>{n(e.run)},[e.run]),b(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:a,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:M,useEffect:A,useMemo:$}=g.React,P=g.ReactRedux.connect(null)(e=>{const[t,n]=M(!1),[i,s]=M(0),o=(0,g.useIntl)(),d=$(()=>[{title:a("expressTopBarTitle"),content:{htm:a("expressTopBarContent"),direction:"horizontal"},placement:"auto",target:"div.widget-builder-header > div.d-flex.align-items-center.justify-content-end",width:480}],[]);function a(e){return o.formatMessage({id:e})}return A(()=>{n(e.run)},[e.run]),A(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:d,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:O,useEffect:D,useMemo:N}=g.React,B=g.ReactRedux.connect(null)(e=>{const[t,n]=O(!1),[i,s]=O(0),o=(0,g.useIntl)(),d=N(()=>[{title:a("expressFullEditModeTitle"),content:{text:a("expressFullEditModeContent"),direction:"horizontal"},placement:"auto",target:".tool_more_content .jimu-dropdown button",width:380}],[]);function a(e){return o.formatMessage({id:e})}return D(()=>{n(e.run)},[e.run]),D(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:d,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:L,useEffect:k,useMemo:W}=g.React,U=g.ReactRedux.connect((e,t)=>{var n,i;return{widgets:null===(i=null===(n=e.appStateInBuilder)||void 0===n?void 0:n.appConfig)||void 0===i?void 0:i.widgets}})(e=>{const[t,n]=L(!1),[i,s]=L(0),[o,d]=L(null),a=(0,g.useIntl)();function r(e){return a.formatMessage({id:e})}const l=W(()=>[{title:r("mapWidgetTitle"),content:{image:{src:"builder/assets/configure-widget-1.svg",alt:r("mapWidgetTitle"),width:340,height:220},htm:r("mapWidgetContent"),direction:"vertical"},requiredAction:{type:"click"},disableNextButton:!0,targetInCanvas:!0,placement:"bottom",target:o?`[data-widgetid="${null==o?void 0:o.id}"] .arcgis-map`:".arcgis-map",width:380,height:420},{title:r("expressSelectDataTitle"),content:{image:{src:"builder/assets/configure-map.gif",alt:r("expressSelectDataTitle"),width:340,height:220},text:r("expressSelectDataContent"),direction:"vertical"},placement:"left-start",target:"[data-widgetid='dynamic-setting'] .widget-setting-tab:not([data-is-parent='true'])",width:380},{title:r("expressMessageActionTitle"),content:{image:{src:"builder/assets/message-action.gif",alt:r("expressMessageActionTitle"),width:340,height:220},text:r("expressMessageActionContent")},placement:"left-end",target:"[data-widgetid='dynamic-setting'] .widget-setting-tab:not([data-is-parent='true']) .message-action-con .message-action-con",width:380,height:400}],[o]);return k(()=>{n(e.run)},[e.run]),k(()=>{if(!e.widgets)return;const t=Object.values(e.widgets).find(e=>"arcgis-map"===e.manifest.name);t?d(t):(d(null),e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED}))},[e.widgets]),k(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:l,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:q,useEffect:H,useMemo:_}=g.React,F=g.ReactRedux.connect(null)(e=>{const[t,n]=q(!1),[i,s]=q(0),o=(0,g.useIntl)();function d(e){return o.formatMessage({id:e})}const a=_(()=>[{type:"splash",title:d("openingGuideStep1Title"),content:{image:{src:"builder/assets/start-splash.svg",alt:d("openingGuideStep1Title"),width:237,height:286},text:d("welcomeStep1Content"),direction:"horizontal"},placement:"center",target:"#app",width:600}],[]);return H(()=>{n(e.run)},[e.run]),H(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:a,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:V,useEffect:z,useMemo:J}=g.React,X=g.ReactRedux.connect(null)(e=>{const[t,n]=V(!1),[i,s]=V(0),o=(0,g.useIntl)();function d(e){return o.formatMessage({id:e})}const a=J(()=>[{title:d("expressPlaceholderTitle"),content:{image:{src:"builder/assets/placeholder.gif",alt:d("expressPlaceholderTitle"),width:340,height:220},htm:d("expressPlaceholderContent"),direction:"vertical"},targetInCanvas:!0,placement:"auto",target:"div.builder-layout-item div.add-btn",width:380}],[]);return z(()=>{var t;const n=document.querySelector('iframe[name="_appWindow"]');(null===(t=null==n?void 0:n.contentDocument)||void 0===t?void 0:t.querySelector("div.builder-layout-item div.add-btn"))||e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED})},[]),z(()=>{n(e.run)},[e.run]),z(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:a,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:K,useEffect:Y,useMemo:Q}=g.React,Z=g.ReactRedux.connect(e=>{var t,n;return{widgets:null===(n=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===n?void 0:n.widgets}})(e=>{const[t,n]=K(!1),[i,s]=K(0),[o,d]=K(null),a=(0,g.useIntl)();function r(e){return a.formatMessage({id:e})}const l=Q(()=>[{title:r("expressSectionTitle"),content:{image:{src:"builder/assets/section-view.gif",alt:r("expressSectionTitle")},htm:r("expressSectionContent"),direction:"vertical"},targetInCanvas:!0,placement:"auto",target:o?`[data-widgetid="${null==o?void 0:o.id}"] .widget-view-navigation`:".widget-view-navigation",width:380}],[o]);return Y(()=>{if(!e.widgets)return;const t=Object.values(e.widgets).find(e=>"navigator"===e.manifest.name);t?d(t):(d(null),e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED}))},[e.widgets]),Y(()=>{n(e.run)},[e.run]),Y(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:l,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:ee,useEffect:te,useMemo:ne}=g.React,ie=g.ReactRedux.connect(e=>{var t,n,i;return{widgets:null===(n=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===n?void 0:n.widgets,widgetsState:null===(i=e.appStateInBuilder)||void 0===i?void 0:i.widgetsState}})(e=>{const[t,n]=ee(!1),[i,s]=ee(0),[o,d]=ee(null),a=(0,g.useIntl)(),r=e=>a.formatMessage({id:e}),l=ne(()=>[{title:r("expressSidebarTitle"),content:{image:{src:"builder/assets/sidebar-visible.gif",alt:r("expressSidebarTitle"),width:340,height:220},htm:r("expressSidebarContent1")+r("expressSidebarContent"),direction:"vertical"},requiredAction:{type:"click"},disableNextButton:!0,placement:"auto",target:o?`[data-widgetid="${null==o?void 0:o.id}"] .side-collapsable>div:not(.side)>div`:".side-collapsable>div:not(.side)>div",width:380,targetInCanvas:!0}],[o]);return te(()=>{var t,n;if(!e.widgets)return;const i=Object.values(e.widgets).find(e=>"sidebar"===e.manifest.name);if(i&&(null===(t=null==i?void 0:i.config)||void 0===t?void 0:t.toggleBtn)){d(i);const e=document.querySelector('iframe[name="_appWindow"]'),t=null===(n=null==e?void 0:e.contentDocument)||void 0===n?void 0:n.querySelector(`[data-widgetid="${i.id}"] .side-collapsable>div:not(.side)>div`);t&&t.classList.add("active")}else e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED})},[e.widgets]),te(()=>{n(e.run)},[e.run]),te(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:l,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:se,useEffect:oe,useMemo:de}=g.React,ae=g.ReactRedux.connect(null)(e=>{const[t,n]=se(!1),[i,s]=se(0),o=(0,g.useIntl)(),d=e=>o.formatMessage({id:e}),a=de(()=>[{title:d("expressThemeTitle"),content:{text:d("expressThemeContent"),direction:"vertical"},placement:"auto",target:'div[data-widgetid="setting-navigator"] ul',width:480}],[]);return oe(()=>{n(e.run)},[e.run]),oe(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:a,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:re,useEffect:le,useMemo:ue}=g.React,ce=g.ReactRedux.connect(e=>{var t,n;return{widgets:null===(n=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===n?void 0:n.widgets}})(e=>{const[t,n]=re(!1),[i,s]=re(0),[o,d]=re(null),a=(0,g.useIntl)(),r=e=>a.formatMessage({id:e}),l=ue(()=>[{title:r("expressTextTitle"),content:{image:{src:"builder/assets/start-splash.svg",alt:r("expressTextTitle"),width:237,height:286},text:r("expressTextContent"),direction:"horizontal"},targetInCanvas:!0,placement:"auto",target:o?`[data-widgetid="${null==o?void 0:o.id}"] .rich-displayer`:".rich-displayer",width:480}],[o]);return le(()=>{e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED})},[]),le(()=>{if(!e.widgets)return;const t=Object.values(e.widgets).find(e=>"text"===e.manifest.name);t?d(t):(d(null),e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED}))},[e.widgets]),le(()=>{n(e.run)},[e.run]),le(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:l,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:pe,useEffect:ge,useMemo:me}=g.React,Se=g.ReactRedux.connect(null)(e=>{const[t,n]=pe(!1),[i,s]=pe(0),o=(0,g.useIntl)(),d=e=>o.formatMessage({id:e}),a=me(()=>[{type:"splash",title:d("openingGuideStep1Title"),content:{image:{src:"builder/assets/guide-cover.png",alt:d("openingGuideStep1Title"),width:272,height:256},text:d("welcomeStep1Content"),direction:"horizontal"},placement:"center",target:"#app",width:600,height:350}],[]);return ge(()=>{n(e.run)},[e.run]),ge(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:a,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:xe,useEffect:ve,useMemo:he}=g.React,Ie=g.ReactRedux.connect(e=>{var t,n;return{widgets:null===(n=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===n?void 0:n.widgets}})(e=>{const[t,n]=xe(!1),[i,s]=xe(0),[o,d]=xe(null),a=(0,g.useIntl)(),r=e=>a.formatMessage({id:e}),l=he(()=>[{title:r("widgetControllerTitle"),content:{image:{src:"builder/assets/widget-controller.gif",alt:r("widgetControllerTitle"),width:340,height:220},htm:r("widgetControllerContent"),direction:"vertical"},targetInCanvas:!0,requiredAction:{type:"click"},disableNextButton:!0,placement:"auto",target:o?`[data-widgetid="${null==o?void 0:o.id}"] .widget-controller`:".widget-controller",width:380},{title:r("expressWidgetControllerAddWidgetTitle"),content:{image:{src:"builder/assets/wc-add-widget.gif",alt:r("expressWidgetControllerAddWidgetTitle"),width:340,height:220},text:r("expressWidgetControllerAddWidgetContent"),direction:"vertical"},targetInCanvas:!1,placement:"auto",target:'[data-widgetid="header"] .d-flex.align-items-center.justify-content-end div.d-flex.align-items-center',width:380}],[o]);return ve(()=>{if(!e.widgets)return;const t=Object.values(e.widgets).find(e=>"controller"===e.manifest.name);t?d(t):(d(null),e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED}))},[e.widgets]),ve(()=>{n(e.run)},[e.run]),ve(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:l,onStepChange:t=>{null==e||e.onStepChange(t)},onActionTriggered:(e,t,n)=>{if(0===n){const e=setInterval(()=>{document.querySelector('[data-widgetid="header"] [data-extname="controller-add-widget"]')&&(clearInterval(e),s(1))},100)}},isInjected:!0}))}),{useState:fe,useEffect:we,useMemo:Ce}=g.React,Ge=g.ReactRedux.connect(null)(e=>{const[t,n]=fe(!1),[i,s]=fe(0),o=(0,g.useIntl)(),d=e=>o.formatMessage({id:e}),a=Ce(()=>[{title:d("expressWindowTitle"),content:{htm:d("expressWindowContent"),direction:"horizontal"},requiredAction:{type:"click"},disableNextButton:!0,placement:"auto",target:".page-window-select",width:380,height:160},{title:d("expressWindowTitle2"),content:{image:{src:"builder/assets/configure-window-1.gif",alt:d("expressWindowTitle2"),width:340,height:220},htm:d("expressWindowContent2"),direction:"vertical"},requiredAction:{type:"click"},disableNextButton:!0,placement:"right",target:"div .popper-box div.dropdown-menu--inner div:nth-child(2)",width:380},{title:d("expressWindowTitle1"),content:{image:{src:"builder/assets/configure-window-2.gif",alt:d("expressWindowTitle1"),width:340,height:220},text:d("expressWindowContent1"),direction:"vertical"},targetInCanvas:!0,placement:"auto",target:"div.modal-content.app-dialog-content",width:380}],[]);return we(()=>{n(e.run)},[e.run]),we(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:a,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:Te,useEffect:ye,useMemo:je}=g.React,be=g.ReactRedux.connect(e=>{var t,n;return{widgets:null===(n=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===n?void 0:n.widgets}})(e=>{const[t,n]=Te(!1),[i,s]=Te(0),o=(0,g.useIntl)(),d=e=>o.formatMessage({id:e}),a=je(()=>[{title:d("expressGridTitle"),content:{image:{src:"builder/assets/manage-grids.gif",alt:d("expressGridTitle"),width:340,height:220},text:d("expressGridContent"),direction:"vertical"},placement:"auto",target:".grid-col-item:first-of-type",width:380,targetInCanvas:!0}],[]);return ye(()=>{var t;const n=document.querySelector('iframe[name="_appWindow"]');(null===(t=null==n?void 0:n.contentDocument)||void 0===t?void 0:t.querySelector(".grid-col-item"))||e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED})},[]),ye(()=>{n(e.run)},[e.run]),ye(()=>{s(e.stepIndex)},[e.stepIndex]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:t,stepIndex:i,steps:a,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}),{useState:Ee,useEffect:Re,useMemo:Me,useRef:Ae}=g.React;function $e(e,t=""){return g.i18n.getIntl().formatMessage({id:e,defaultMessage:m.defaultMessages[e]},{widgetName:t})}const Pe=g.ReactRedux.connect(e=>{var t,n,i;return{appConfig:null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig,widgetSelection:null===(i=null===(n=e.appStateInBuilder)||void 0===n?void 0:n.appRuntimeInfo)||void 0===i?void 0:i.selection}})(e=>{const{params:t,appConfig:n,widgetSelection:i}=e,s=null==t?void 0:t.widgetName,[o,d]=Ee(!1),[a,r]=Ee(0),[l,u]=Ee(!1),c=Ae(null),S=Ae(null),v=Me(()=>[{title:$e("insertWidgetStep1Title"),content:{image:{src:"jimu-for-builder/guide-assets/insert-widget-guide.gif",alt:$e("insertWidgetStep1Title"),border:!0,width:400,height:220,autoFlip:!0},text:$e("insertWidgetStep1Content")},placement:"auto",target:`[data-sectionid='opts-section'] .widget-card-item[data-widget-name='${s}']`,spotlightClicks:!0,requiredAction:{type:"custom"},disableNextButton:!0}],[s]),h=()=>{document.body.removeEventListener("dragstart",c.current),document.body.removeEventListener("dragend",S.current)};return Re(()=>{h(),d(e.run)},[e.run]),Re(()=>{r(e.stepIndex)},[e.stepIndex]),Re(()=>{if(!o){const e=x.searchUtils.findLayoutItem(n,i);let t;e&&e.type===g.LayoutItemType.Widget&&e.widgetId&&(t=null==n?void 0:n.widgets[e.widgetId]),l&&(null==t?void 0:t.manifest.name)===s&&(r(1),d(!0))}},[s,o,l,n,i]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:o,stepIndex:a,steps:v,onStepChange:t=>{const{index:n,event:i,step:s,status:o}=t,a=(0,f.getTargetSelector)(s),l=document.querySelector(a);if(l){(e=>{if(!e)return!1;const t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth;if(!(t.top>=0&&t.left>=0&&t.bottom<=n&&t.right<=i))return!1;const s=t.left+t.width/2,o=t.top+t.height/2,d=document.elementFromPoint(s,o);return d===e||e.contains(d)})(l)||l.scrollIntoView({behavior:"smooth",block:"center"}),0===n&&i===f.EVENTS.TOOLTIP&&(m.builderAppSync.publishChangeSelectionToApp(null),(0,m.getAppConfigAction)().setLockLayout(!1).exec(),((t,n)=>{c.current=e=>{var i,s;(null===(s=null===(i=e.target)||void 0===i?void 0:i.parentElement)||void 0===s?void 0:s.querySelector(n))===e.target?(d(!1),t.addEventListener("dragend",S.current)):h()},S.current=n=>{var i;"none"===(null===(i=null==n?void 0:n.dataTransfer)||void 0===i?void 0:i.dropEffect)?(r(0),d(!0)):(u(!0),e.onStepChange({isInjected:!0,status:f.STATUS.FINISHED})),t.removeEventListener("dragend",S.current),h()},t&&document.body.addEventListener("dragstart",c.current)})(l,a)),null==e||e.onStepChange(t)}else console.warn("insert widget target not found:",a);o!==f.STATUS.FINISHED&&o!==f.STATUS.SKIPPED||h()},isInjected:!0}))}),{useState:Oe,useEffect:De}=g.React;const Ne=g.ReactRedux.connect((e,t)=>{var n,i,s;const o=null===(n=e.appStateInBuilder)||void 0===n?void 0:n.appConfig,d=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appRuntimeInfo.selection;let a;if(d){const e=(0,f.findLayoutItem)(o,d);e&&e.type===g.LayoutItemType.Widget&&e.widgetId&&(a=o.widgets[e.widgetId])}return{dataSourcesInfo:null===(s=e.appStateInBuilder)||void 0===s?void 0:s.dataSourcesInfo,widgetDs:null==a?void 0:a.useDataSources,widgetJson:a}})(e=>{const t=g.utils.replaceI18nPlaceholdersInObject(c(5132),g.i18n.getIntl(),m.defaultMessages),{dataSourcesInfo:n,widgetDs:i,widgetJson:s}=e,[o,d]=Oe(!1),[a,r]=Oe(0),[l,u]=Oe(!1),[S,x]=Oe({0:0,2:0}),v=function(e,t){if(!e||!t)return!1;const n=Object.keys(null!=e?e:{}).length;return Object.keys(null!=t?t:{}).length>n}(function(e){const t=g.React.useRef(void 0);return De(()=>{t.current=e}),t.current}(n),n);return De(()=>{var t;0===e.stepIndex&&"arcgis-map"===(null===(t=null==s?void 0:s.manifest)||void 0===t?void 0:t.name)&&x({0:1,2:1})},[s,e.stepIndex]),De(()=>{d(e.run)},[e.run]),De(()=>{r(e.stepIndex)},[e.stepIndex]),De(()=>{o&&i&&u(!i.length),!o&&v&&(r(a+1),d(!0))},[i,v,o]),(0,p.jsx)(f.GuideComponent,Object.assign({},e,{run:o,stepIndex:a,steps:t.steps,conditionalStepIndexes:S,onActionTriggered:(t,n,i)=>{var s;0===i?r(1):1===i&&d(!1),null===(s=null==e?void 0:e.onActionTriggered)||void 0===s||s.call(e,t,n,i)},onStepChange:t=>{const{index:n,event:i}=t;2===n&&i===f.EVENTS.TOOLTIP&&u(!0),null==e||e.onStepChange(Object.assign(Object.assign({},t),{run:o}))},disabled:l,isInjected:!0}))});var Be=function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function d(e){try{r(i.next(e))}catch(e){o(e)}}function a(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(d,a)}r((i=i.apply(e,t||[])).next())})};const Le=()=>Be(void 0,void 0,void 0,function*(){g.GuideManager.getInstance().registerGuide({id:"insert-widget",module:Pe,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"ds-selection",module:Ne,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"opening-tour",module:C,type:g.GuideTypes.Program,level:g.GuideLevels.Builder}),g.GuideManager.getInstance().registerGuide({id:"general-express-mode",module:y,type:g.GuideTypes.Program,level:g.GuideLevels.Builder});(yield m.templateUtils.getExpressModeTemplateNames("app")).forEach(e=>{g.GuideManager.getInstance().registerGuide({id:`general-express-mode-${e}`,module:y,type:g.GuideTypes.Program,level:g.GuideLevels.Builder})}),g.GuideManager.getInstance().registerGuide({id:"express-welcome-introduction",module:Se,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-add-data",module:R,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-app-setting",module:P,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-general-setting",module:B,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-map-widget",module:U,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-message-action",module:F,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-placeholder",module:X,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-section",module:Z,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-theme",module:ae,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-title",module:ce,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-widget-controller",module:Ie,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-window",module:Ge,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-sidebar",module:ie,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0}),g.GuideManager.getInstance().registerGuide({id:"express-grid",module:be,type:g.GuideTypes.Program,level:g.GuideLevels.Common,isInjected:!0})});let ke=!1;return window.addEventListener("message",e=>{"EXB_EXTENSION_PASS_PRIVILEGE_CHECK"===e.data.type&&(ke=!0)}),window.__EXB_MESSAGE_EVENT_LISTENER_FOR_EXTENSION_READY__=!0,(0,g.init)().then(v.init).then(x.init).then(m.init).then(h.init).then(S.init).then(()=>{g.ExtensionManager.getInstance().registerExtension({epName:g.extensionSpec.ExtensionPoints.ReduxStore,extension:new m.AppStateReduxStoreExtension}),g.ExtensionManager.getInstance().registerExtension({epName:g.extensionSpec.ExtensionPoints.ReduxStore,extension:new m.AppStateHistoryExtension}),g.ExtensionManager.getInstance().registerExtension({epName:g.extensionSpec.ExtensionPoints.ReduxStore,extension:new m.BuilderStateReduxStoreExtension}),g.ExtensionManager.getInstance().registerExtension({epName:g.extensionSpec.ExtensionPoints.DependencyDefine,extension:new g.ArcGISDependencyDefineExtension}),Le(),m.builderAppSync.listenAppEvents(),function(){const e=g.SessionManager.getInstance();if(e.getMainSession())return;e.gotoSignInPage()}(),g.privilegeUtils.checkExbAccess(g.privilegeUtils.CheckTarget.Builder,ke).then(e=>{e.valid||(0,g.getAppStore)().dispatch(g.appActions.setSystemError({type:g.SystemErrorType.PrivilegeError,code:e.invalidInfo,message:e.invalidMessage}))}).catch(e=>{console.error(e),(0,g.getAppStore)().dispatch(g.appActions.setSystemError({type:g.SystemErrorType.PrivilegeError,code:g.SystemErrorCode.PrivilegeNullInfo}))}),I.userServices.initUserResource();g.ReactDOMClient.createRoot(document.getElementById("app")).render((0,p.jsx)(g.AppRoot,{}))}).catch(e=>{console.error(e)}),{}})())}}});