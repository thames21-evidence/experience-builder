/*! For license information please see index.js.LICENSE.txt */
System.register(["esri/applications/Components/reactiveUtils.js","jimu-core","calcite-components","esri/core/lang.js","esri/layers/support/FeatureTemplate.js","esri/Graphic.js","esri/identity/IdentityManager.js","esri/request.js","esri/arcade.js","esri/core/reactiveUtils.js","esri/layers/support/fieldUtils.js","esri/layers/support/FeatureReductionBinning.js","esri/layers/support/FeatureReductionCluster.js","esri/renderers/support/jsonUtils.js","esri/core/sql.js","esri/core/Accessor.js","esri/core/accessorSupport/decorators.js"],function(t,e){var i={},s={},a={},r={},o={},n={},l={},c={},d={},h={},u={},p={},f={},m={},g={},y={},v={};return{setters:[function(t){i.createObservable=t.createObservable,i.createTrackingTarget=t.createTrackingTarget,i.runTracked=t.runTracked,i.trackAccess=t.trackAccess},function(t){s.urlUtils=t.urlUtils},function(){},function(t){r.clone=t.clone},function(t){o.default=t.default},function(t){n.default=t.default},function(t){l.default=t.default},function(t){c.default=t.default},function(t){d.createArcadeExecutor=t.createArcadeExecutor},function(t){h.once=t.once,h.watch=t.watch},function(t){u.collectFeatureReductionFields=t.collectFeatureReductionFields,u.getExpressionFields=t.getExpressionFields,u.getRendererFields=t.getRendererFields},function(t){p.default=t.default},function(t){f.default=t.default},function(t){m.fromJSON=t.fromJSON},function(t){g.parseWhereClause=t.parseWhereClause},function(t){y.default=t.default},function(t){v.property=t.property,v.subclass=t.subclass}],execute:function(){t((()=>{"use strict";var t={37:t=>{t.exports=a},96:t=>{t.exports=d},110:(t,e,i)=>{i.d(e,{yr:()=>b,RY:()=>C});var s=i(333),a=i(667),r=i(435),o=(i(337),i(150));const n="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),l=new Set(n),c="en",d={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},h={},u=async(t,e)=>{const i=`${e}${t}.json`;try{const t=await fetch(i);if(t.ok)return await t.json()}catch(t){return console.error(t),{}}return t===c?{}:await u(c,e)},p=t=>{const e=(0,o.Zj)(t,"lang",globalThis.navigator?.language||c);return{lang:e,t9nLocale:f(e)}},f=t=>{const[e,i]=t.split("-"),s=e.toLowerCase();let a=s;return i&&(a=`${s}-${i.toUpperCase()}`),a=d[a]??a,l.has(a)?a:i?f(s):c},m=async(t,e,i=t.localName.split("-").slice(1).join("-"))=>{const{lang:s,t9nLocale:a}=p(t),r=`${e}/${i}/t9n`,o=null===i?{}:await(async(t,e,i="")=>{const s=`${e}/${i}`,a=`${s}${t}.json`;return h[a]??(h[a]=u(t,s)),await h[a]})(a,r,"messages.");return{lang:s,t9nLocale:a,t9nStrings:o}},g=t=>v(void 0,t);class y extends s.C{constructor(t,e){super(t);const i=this.exports;try{(0,a.s)(this.component);const t=e(this.component,this),s=this.exports!==i;if((0,a.i)(t)){s||this.setProvisionalExports(t);const e=t.then(t=>{this.exports=t,super.catchUpLifecycle()}).catch(t=>{this.P.reject(t),console.error(t)});this.onLoad(async()=>await e)}else s&&void 0===t||(this.exports=t),queueMicrotask(()=>super.catchUpLifecycle())}catch(t){this.P.reject(t),console.error(t)}}catchUpLifecycle(){}}const v=(0,r.p)(y);s.C;const b=t=>(e={})=>g((i,s)=>{const a=p(i.el),r={_lang:a.lang,_t9nLocale:a.t9nLocale,_loading:!0},n=i;s.onLifecycle(()=>((t,e,i,s)=>{let a;const r=()=>m(t,e(),s).then(t=>{a?.lang===t.lang&&a.t9nLocale===t.t9nLocale&&a.t9nStrings===t.t9nStrings||i(t),a=t}).catch(console.error);return queueMicrotask(r),(0,o.Yt)(t,["lang"],r)})(i.el,()=>t("./assets"),({t9nLocale:t,t9nStrings:e,lang:a})=>{const r={...e,_lang:a,_t9nLocale:t,_loading:!1};s.exports=r;const o=e.componentLabel;"string"==typeof o&&"label"in i&&null==i.label&&(i.label??=o),l(n.messageOverrides)},e.name));const l=t=>{const e=s.exports,i=e._original??e,a=$(i,t);t&&(a._original=i),s.exports=a};return"messageOverrides"in n&&s.onUpdate(t=>{t.has("messageOverrides")&&l(n.messageOverrides)}),e.blocking?(s.setProvisionalExports(r,!1),s.ready):r}),$=(t,e)=>{if(!e)return t;const i={...t};return Object.entries(e).forEach(([e,s])=>{i[e]="object"==typeof s?$(t[e],s):s??t[e]}),i},C=t=>w,w=(...t)=>{const e=(0,a.r)(),i=(0,s.a)("arcgisPropertyChange",void 0,e);let r=!0;return e.manager.onUpdated(s=>{if(!r&&e.el.isConnected)for(const e of t)s.has(e)&&i.emit({name:e});else r=!1}),i}},150:(t,e,i)=>{i.d(e,{Yt:()=>s,Zj:()=>n,el:()=>o});const s=(t,e,i)=>(0,r(e).subscribe)(e=>{const s=e.some(e=>((t,e)=>{let i=t;for(;i;){if(i===e)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(t,e.target));s&&i()}),a={},r=t=>{const e=t.join(","),i=a[e];if(void 0!==i)return i;const s=new Set,r=new MutationObserver(t=>s.forEach(e=>e(t)));globalThis.document&&r.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0});const o={subscribe:t=>(s.add(t),()=>{s.delete(t),0===s.size&&(r.disconnect(),a[e]=void 0)})};return a[e]=o,o},o=(t,e)=>{let i=t;for(;i;){const t=i.closest?.(e);if(t)return t;const s=i.getRootNode?.();if(s===globalThis.document)return;i=s.host}};const n=(t,e,i)=>{const s=o(t,`[${e}]`);return s?.getAttribute(e)??i}},214:(t,e,i)=>{i.d(e,{u:()=>n});var s=i(752),a=i(804),r=i(504);const o=(t,e,i)=>{const s=new Map;for(let a=e;a<=i;a++)s.set(t[a],a);return s},n=(0,a.u$)(class extends a.WL{constructor(t){if(super(t),t.type!==a.OA.CHILD)throw Error("repeat() can only be used in text expressions")}dt(t,e,i){let s;void 0===i?i=e:void 0!==e&&(s=e);const a=[],r=[];let o=0;for(const e of t)a[o]=s?s(e,o):o,r[o]=i(e,o),o++;return{values:r,keys:a}}render(t,e,i){return this.dt(t,e,i).values}update(t,[e,i,a]){const n=(0,r.cN)(t),{values:l,keys:c}=this.dt(e,i,a);if(!Array.isArray(n))return this.ut=c,l;const d=this.ut??=[],h=[];let u,p,f=0,m=n.length-1,g=0,y=l.length-1;for(;f<=m&&g<=y;)if(null===n[f])f++;else if(null===n[m])m--;else if(d[f]===c[g])h[g]=(0,r.lx)(n[f],l[g]),f++,g++;else if(d[m]===c[y])h[y]=(0,r.lx)(n[m],l[y]),m--,y--;else if(d[f]===c[y])h[y]=(0,r.lx)(n[f],l[y]),(0,r.Dx)(t,h[y+1],n[f]),f++,y--;else if(d[m]===c[g])h[g]=(0,r.lx)(n[m],l[g]),(0,r.Dx)(t,n[f],n[m]),m--,g++;else if(void 0===u&&(u=o(c,g,y),p=o(d,f,m)),u.has(d[f]))if(u.has(d[m])){const e=p.get(c[g]),i=void 0!==e?n[e]:null;if(null===i){const e=(0,r.Dx)(t,n[f]);(0,r.lx)(e,l[g]),h[g]=e}else h[g]=(0,r.lx)(i,l[g]),(0,r.Dx)(t,n[f],i),n[e]=null;g++}else(0,r.KO)(n[m]),m--;else(0,r.KO)(n[f]),f++;for(;g<=y;){const e=(0,r.Dx)(t,h[y+1]);(0,r.lx)(e,l[g]),h[g++]=e}for(;f<=m;){const t=n[f++];null!==t&&(0,r.KO)(t)}return this.ut=c,(0,r.mY)(t,h),s.c0}})},220:(t,e,i)=>{i.r(e),i.d(e,{ArcgisPortalClassificationFormElement:()=>d});var s=i(895),a=i(214),r=i(916),o=i(337),n=i(733);const l=o.AH`.spacing-y{margin:var(--calcite-spacing-md) 0}.portal-classification-form-element-tooltip{display:flex;justify-content:space-between;align-items:center}`;function c(t,e){return t.uiElement===e}class d extends r.WF{constructor(){super(...arguments),this.messages=(0,n.u)(),this.arcgisAttributeValueChange=(0,r.lh)()}static{this.properties={validationMsg:16,attributeKey:1,attribute:0,value:0,renderingInfo:0}}static{this.styles=l}willUpdate(t){t.has("renderingInfo")&&(this.validationMsg=this._getValidationMessage())}_getValidationMessage(){return this.renderingInfo.attributeValidationResult?this.renderingInfo.attributeValidationResult:this.attribute.isRequired&&!this.value?this.messages.requiredfield??"This is a required field.":void 0}renderCheckbox(){return c(this.attribute,"checkbox")?o.qy`<calcite-label class="spacing-y" .for=${this.attributeKey} layout=inline><calcite-checkbox .checked=${this.value} id=${this.attributeKey??r.s6} @calciteCheckboxChange=${t=>this.arcgisAttributeValueChange.emit({[this.attributeKey]:t.target.checked})} .required=${this.attribute.isRequired??!1} .status=${this.validationMsg?"invalid":"valid"}></calcite-checkbox>${this.attribute.label}</calcite-label>`:null}renderDateInput(){return c(this.attribute,"date")?o.qy`<calcite-label .for=${this.attributeKey}>${this.attribute.label}<calcite-input-date-picker id=${this.attributeKey??r.s6} .name=${this.attribute.label} @calciteInputDatePickerChange=${t=>this.isConnected&&this.arcgisAttributeValueChange.emit({[this.attributeKey]:t.target.value})} overlay-positioning=fixed .required=${this.attribute.isRequired} .status=${this.validationMsg?"invalid":"valid"} validation-icon=exclamation-mark-triangle .validationMessage=${this.validationMsg} .value=${this.value}></calcite-input-date-picker></calcite-label>`:null}renderTextInput(){if(!c(this.attribute,"text"))return null;const t=this.attribute.label,e=this.attribute.description;return o.qy`<calcite-label .for=${this.attributeKey}><div class="portal-classification-form-element-tooltip">${t}${this.attribute.labelTooltip&&o.qy`<div><calcite-icon scale=s icon=information .id=${`tooltip-button-${this.attribute.bannerLabel}`} text-label=${this.messages.information??"Information"??r.s6}></calcite-icon><calcite-tooltip .referenceElement=${`tooltip-button-${this.attribute.bannerLabel}`} placement=right>${this.attribute.labelTooltip}</calcite-tooltip></div>`||""}</div><calcite-input-text id=${this.attributeKey??r.s6} .label=${t} .name=${this.attributeKey} @calciteInputTextChange=${t=>this.arcgisAttributeValueChange.emit({[this.attributeKey]:t.target.value})} .placeholder=${e} .required=${this.attribute.isRequired} .status=${this.validationMsg?"invalid":"valid"} validation-icon=exclamation-mark-triangle .validationMessage=${this.validationMsg} .value=${this.value}></calcite-input-text></calcite-label>`}renderSingleSelect(){return c(this.attribute,"single-select")?o.qy`<calcite-label .for=${this.attributeKey}>${this.attribute.label}<calcite-combobox selection-mode=single id=${this.attributeKey??r.s6} .label=${this.attribute.label} .name=${this.attributeKey} @calciteComboboxChange=${t=>this.arcgisAttributeValueChange.emit({[this.attributeKey]:t.target.value})} .placeholder=${this.messages.selectanoption??"Select an option"} .required=${this.attribute.isRequired} .status=${this.validationMsg?"invalid":"valid"} overlay-positioning=fixed validation-icon=exclamation-mark-triangle .validationMessage=${this.validationMsg} .value=${this.value} data-testid=${`single-select-${this.attributeKey}`}>${this._renderSingleSelectComboboxOptions()}</calcite-combobox></calcite-label>`:null}_renderSingleSelectComboboxOptions(){if(!Array.isArray(this.renderingInfo.valueExpressionResult))return;const t=this.value;return(0,a.u)(this.renderingInfo.valueExpressionResult,t=>t.label,e=>o.qy`<calcite-combobox-item .selected=${t===e.value} text-label=${e.label??r.s6} .value=${e.value} data-testid=${`single-combobox-item-${e.value}`}></calcite-combobox-item>`)}_renderComboboxOptions(){if(!Array.isArray(this.renderingInfo.valueExpressionResult))return;const t=this.value;return this.renderingInfo.valueExpressionResult.map(e=>o.qy`<calcite-combobox-item .selected=${t?.includes(e.value)} text-label=${e.label??r.s6} .value=${e.value} data-testid=${`combobox-item-${e.value}`}></calcite-combobox-item>`)}renderMultiSelect(){return c(this.attribute,"multi-select")?o.qy`<calcite-label .for=${this.attributeKey}>${this.attribute.label}<calcite-combobox id=${this.attributeKey??r.s6} .label=${this.attribute.label} .name=${this.attributeKey} @calciteComboboxChange=${t=>{const e=t.target.value;this.arcgisAttributeValueChange.emit({[this.attributeKey]:e?Array.isArray(e)?e:[e]:void 0})}} .placeholder=${this.messages.selectoptions??"Select option(s)"} .required=${this.attribute.isRequired} .status=${this.validationMsg?"invalid":"valid"} validation-icon=exclamation-mark-triangle .validationMessage=${this.validationMsg} .value=${this.value}>${this._renderComboboxOptions()}</calcite-combobox></calcite-label>`:null}_renderGroupedComboboxOptions(){if(!this.renderingInfo.valueExpressionResult||Array.isArray(this.renderingInfo.valueExpressionResult))return;const t=this.value;return Object.entries(this.renderingInfo.valueExpressionResult).map(([e,i])=>o.qy`<calcite-combobox-item .selected=${t?.includes(e)} text-label=${e??r.s6} .value=${e}>${i.map(e=>o.qy`<calcite-combobox-item .selected=${t?.includes(e.value)} text-label=${e.label??r.s6} .value=${e.value} data-testid=${`grouped-combobox-item-${e.value}`}></calcite-combobox-item>`)}</calcite-combobox-item>`)}renderMultiGroupedSelectNested(){return c(this.attribute,"multi-grouped-select-nested")?o.qy`<calcite-label .for=${this.attributeKey}>${this.attribute.label}<calcite-combobox id=${this.attributeKey??r.s6} .label=${this.attribute.label} .name=${this.attributeKey} @calciteComboboxChange=${t=>{const e=t.target.value;this.arcgisAttributeValueChange.emit({[this.attributeKey]:e?Array.isArray(e)?e:[e]:void 0})}} .placeholder=${this.messages.selectoptions??"Select option(s)"} .required=${this.attribute.isRequired} .status=${this.validationMsg?"invalid":"valid"} validation-icon=exclamation-mark-triangle .validationMessage=${this.validationMsg} .value=${this.value}>${this._renderGroupedComboboxOptions()}</calcite-combobox></calcite-label>`:null}render(){switch(this.attribute.uiElement){case"checkbox":return this.renderCheckbox();case"date":return this.renderDateInput();case"multi-select":return this.renderMultiSelect();case"multi-grouped-select-nested":return this.renderMultiGroupedSelectNested();case"single-select":return this.renderSingleSelect();case"text":return this.renderTextInput();default:return o.qy`<div>Not Implemented Yet.</div>`}}}(0,s.c)("arcgis-portal-classification-form-element",d)},244:t=>{t.exports=s},284:t=>{t.exports=g},294:t=>{t.exports=r},312:t=>{t.exports=h},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i}).join("")},e.i=function(t,i,s,a,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var n=0;n<this.length;n++){var l=this[n][0];null!=l&&(o[l]=!0)}for(var c=0;c<t.length;c++){var d=[].concat(t[c]);s&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),e.push(d))}},e}},331:t=>{t.exports=y},333:(t,e,i)=>{i.d(e,{C:()=>f,G:()=>g,a:()=>h,c:()=>u,d:()=>c,p:()=>l,t:()=>d});var s=i(592),a=i(667),r=i(337),o=i(827);let n;const l=()=>{n?.forEach(({callbacks:t},e)=>{const i=Object.keys(e);t.forEach(t=>t(i))}),n=void 0},c=(t,e,i)=>{const a=t.manager;return a.V!==r.s6&&a.V!==i&&a.S(void 0,void 0),0===a.T.length&&queueMicrotask(()=>a.S(void 0,void 0)),a.V=i,a.T.push((t,a)=>(0,s.UF)(e,void 0,i===a?t:void 0)),i},d=(t=[(0,a.r)(),...(0,a.d)()],e,i)=>{const r=Array.isArray(t)?t:[t];let o=r.length+1;const d=t=>{o-=1,void 0!==t&&(o=Math.min(o,0)),0===o&&e(t)};r.forEach(t=>((t,e,i)=>{const a=Object.keys(t),r=a.length;void 0===n&&queueMicrotask(l),n??=new Map;let o=n.get(t);return void 0===o&&(o={callbacks:[],keyCount:r},n.set(t,o)),o.keyCount!==r&&(o.callbacks.forEach(t=>t(a)),o.callbacks=[],o.keyCount=r),o.callbacks.push(a=>{const o=t=>(0,s.UF)(e,null,t),n=a[r];void 0===n?o(void 0):t[n]===i?o(n):o(void 0)}),i})(t,e=>d(void 0===e?void 0:{key:e,host:t,isReactive:!1}),i));for(const t of r)if("manager"in t&&t.manager.component===t){c(t,e=>d(void 0===e?void 0:{key:e,host:t,isReactive:!0}),i);break}return i},h=(t="",e={},i=(0,a.r)())=>{const s={emit:s=>{""===t&&l();const a=new CustomEvent(t,{detail:s,cancelable:!0,bubbles:!0,composed:!0,...e});return i.el.dispatchEvent(a),a}};return""===t&&d(void 0,e=>t=e.key,s),s},u=h.bind(null,"");var p;p=a.c;class f{constructor(t){this.#t=[],this.#e=[],this.#i=[],this.#s=[],this.#a=[],this.#r=[],this.#o=[],this.#n=[],this.#l=[],this.#c=!1,this.P=new o.c,this.connectedCalled=!1,this.loadedCalled=!1,this[p]=!0,this.#d=[];const e=this,i=t??(0,a.r)(new.target.name);e.#h=i,e.ready=e.P.promise,e.#u=y(e),e.component=i,e.#h.addController(e);void 0===e.#h.manager||((0,a.b)(e),queueMicrotask(()=>e.catchUpLifecycle()))}#t;#e;#i;#s;#a;#r;#o;#n;#l;#c;#h;catchUpLifecycle(){const{manager:t}=this.#h;!t.connectedCalled||this.connectedCalled||this.triggerConnected();!t.#c||this.triggerLoad().then(()=>t.loadedCalled&&this.triggerLoaded()).catch(console.error)}#u;get exports(){return this.#u}set exports(t){const e=this.#u;e!==t&&(this.#u=t,this.#d.forEach(s.UF),this.connectedCalled&&!1!==this.O&&this.#h.requestUpdate(this.O,e)),this.P.resolve(t)}setProvisionalExports(t,e=!0){this.#u=e?y(t):t,this.#d.forEach(s.UF)}#d;watchExports(t){const e=()=>t(this.#u);return this.#d.push(e),()=>{this.#d.splice(this.#d.indexOf(e),1)}}get use(){return(0,a.s)(this.#h),a.u}get useRef(){return(0,a.s)(this.#h),a.k}get useRefSync(){return(0,a.s)(this.#h),a.l}controllerRemoved(){this.#h.el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(t){this.#t.push(t)}onDisconnected(t){this.#e.push(t)}onLoad(t){this.#i.push(t)}onLoaded(t){this.#s.push(t)}onUpdate(t){this.#a.push(t)}onUpdated(t){this.#r.push(t)}onDestroy(t){this.#o.push(t)}onLifecycle(t){this.#n.push(t),this.connectedCalled&&this.#h.el.isConnected&&this.#p(t)}triggerConnected(){const t=this;t.hostConnected&&(0,s.UF)(t.hostConnected,t),t.#t.forEach(s.UF),t.triggerLifecycle(),t.connectedCalled=!0}triggerDisconnected(){const t=this;t.hostDisconnected&&(0,s.UF)(t.hostDisconnected,t),t.#e.forEach(s.UF),t.#l.forEach(s.UF),t.#l=[]}async triggerLoad(){if(this.#c)return;this.#c=!0;const t=this;t.hostLoad&&await(0,s.ao)(t.hostLoad,t),this.#i.length>0&&await Promise.allSettled(this.#i.map(s.ao)),this.P.resolve(this.#u)}triggerLoaded(){this.loadedCalled||(this.hostLoaded&&(0,s.UF)(this.hostLoaded,this),this.#s.forEach(s.UF),this.loadedCalled=!0)}triggerUpdate(t){this.hostUpdate&&(0,s.UF)(this.hostUpdate,this,t),this.#a.forEach(m,t)}triggerUpdated(t){this.hostUpdated&&(0,s.UF)(this.hostUpdated,this,t),this.#r.forEach(m,t)}triggerDestroy(){this.hostDestroy&&(0,s.UF)(this.hostDestroy,this),this.#o.forEach(s.UF)}triggerLifecycle(){this.hostLifecycle&&this.#p(()=>this.hostLifecycle()),this.#n.forEach(this.#p,this)}#p(t){(0,a.s)(this.#h);const e=(0,s.UF)(t);(Array.isArray(e)?e:[e]).forEach(t=>{"function"==typeof t?this.#l.push(t):"object"==typeof t&&"function"==typeof t.remove&&this.#l.push(t.remove)})}}function m(t){(0,s.UF)(t,void 0,this)}const g=f,y=t=>{if("object"!=typeof t&&"function"!=typeof t||null===t)return t;const e=new Proxy(t,{get(t,i,s){if("exports"!==i&&"_exports"!==i||!(i in t)||t[i]!==e)return i in t||i in Promise.prototype||"symbol"==typeof i?"function"==typeof t?t[i]:Reflect.get(t,i,s):void 0}});return e}},337:(t,e,i)=>{i.d(e,{WF:()=>o,AH:()=>s.AH,qy:()=>a.qy,S$:()=>l,Ec:()=>s.Ec,s6:()=>a.s6,XX:()=>a.XX});var s=i(842),a=i(752);const r=globalThis;class o extends s.mN{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=(0,a.XX)(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return a.c0}}o._$litElement$=!0,o.finalized=!0,r.litElementHydrateSupport?.({LitElement:o});const n=r.litElementPolyfillSupport;n?.({LitElement:o});(r.litElementVersions??=[]).push("4.2.1");const l=!1},345:t=>{t.exports=c},368:t=>{t.exports=u},423:(t,e,i)=>{i.d(e,{c:()=>E,u:()=>w});var s=i(331),a=i(577),r=i(549),o=i(827),n=(i(667),i(312)),l=i(333),c=i(435),d=i(987);class h extends l.G{constructor(t,e){super(t),this.Y=new Map,this.A=void 0,this.#f=(0,d.createObservable)();const i=this;i.#m=e,i.Z(),i.setProvisionalExports(p(t,new WeakRef(i),t.M.length-1,i.instance,i.Y),!1),(0,l.d)(t,e=>{if(e){const s=(0,n.watch)(()=>t[e],e=>{if(e===i.instance)return;const s=i.instance;i.exports=e,i.instance=e,i.Y.forEach((e,i)=>t.requestUpdate(e,s[i])),i.#g&&s.destroy(),i.#g=!1},{sync:!0});i.onDestroy(s.remove)}},i.exports)}#g;#f;#m;get exports(){return(0,d.trackAccess)(this.#f),super.exports}set exports(t){super.exports=t,this.#f.notify()}Z(){const t=this;t.instance="prototype"in t.#m&&"declaredClass"in t.#m.prototype?new t.#m:t.#m(),t.#g=!0}hostConnected(){this.exports=this.instance}hostDestroy(){this.#g&&this.instance.destroy?.()}}const u=(0,c.p)(h),p=(t,e,i,s,a)=>new Proxy(s,{get:(s,r)=>{const o=s[r];if("symbol"==typeof r||a.has(r))return o;const n=t.M[i];return n.A=r,(0,l.t)(t,s=>{if(n.A=void 0,void 0!==s){const o=s.key;a.set(r,o);const n=t.constructor.getPropertyOptions(o);0;const l=r!==o&&o.toLowerCase().includes("disable");f(e,n,r,o,l),void 0===n.i&&m(n,i,r,l)}},o)}}),f=(t,e,i,s,a,r)=>r=(0,n.watch)(()=>{const e=t.deref();return void 0===e||e.component.manager.destroyed?r=r.remove():e.exports[i]},(i,o)=>{if(!r)return;const n=t.deref().component;n?.requestUpdate(s,a?!o:o),e.c=!1},{sync:!0}),m=(t,e,i,s)=>{t.d.get=function(){const t=this.M[e]?.exports[i];return s?!t:t},t.d.set=function(t){const a=this.M[e];a.A!==i&&(a.exports[i]=s?!t:t)}};var g=i(582),y=Object.defineProperty,v=Object.getOwnPropertyDescriptor,b=(t,e,i,s)=>{for(var a,r=s>1?void 0:s?v(e,i):e,o=t.length-1;o>=0;o--)(a=t[o])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&y(e,i,r),r};let $,C=class extends s.default{constructor(){super(...arguments),this.fetching=!1,this.status="idle",this.error=void 0,this.portalUrl=void 0,this._itemClassificationValidationErrors=new Map,this.fetchingPromise=new o.c}get primaryAttribute(){return this.portalClassificationSchema?.classificationMetadata.primaryAttribute}setPortalClassificationData({portalUrl:t,schema:e}){this.portalUrl=t,this.portalClassificationSchema=e,this.status="loaded",this.fetchingPromise.resolve(!0)}setFetching(t){this.fetching=t}async loadPortalClassificationData(t,{signal:e}){this.status="loading";const{result:i,error:s}=await(0,r.a)(t,e);s?"AbortError"===s.name?console.log("Request aborted."):(this.error=s,this.status="error",this.fetchingPromise.reject(s)):this.setPortalClassificationData({schema:i,portalUrl:t})}async validateClassification(t,e,i,s){if(!e)return"";const a=t?this._itemClassificationValidationErrors.get(t):void 0;if(a)return await a;const o=(async()=>{const{error:t}=await(0,r.v)(i,e,s??{});return t?t?.details.raw.messages.join(", "):""})();return t&&this._itemClassificationValidationErrors.set(t,o),t?await this._itemClassificationValidationErrors.get(t):await o}};b([(0,a.property)()],C.prototype,"portalClassificationSchema",2),b([(0,a.property)()],C.prototype,"fetching",2),b([(0,a.property)()],C.prototype,"status",2),b([(0,a.property)()],C.prototype,"error",2),b([(0,a.property)()],C.prototype,"portalUrl",2),b([(0,a.property)()],C.prototype,"_itemClassificationValidationErrors",2),C=b([(0,a.subclass)("custom.ClassificationModel")],C);const w=(A=function(t){return $??=new C(t),$},t=>u(t,A)),E=t=>new g.YZ(t,{task:async([e],{signal:i})=>{if(!e)throw new Error("Portal item is required to load classification data");e.loaded||await e.load({signal:i}),t.itemClassification=e.classification,"loading"===t.classificationModel.status&&await t.classificationModel.fetchingPromise.promise,t.portalItem?.portal.hasClassificationSchema?("idle"===t.classificationModel.status||"loaded"===t.classificationModel.status&&t.classificationModel.portalUrl!==e.portal.restUrl)&&await t.classificationModel.loadPortalClassificationData(e.portal.restUrl,{signal:i}):t.classificationModel.setPortalClassificationData({portalUrl:e.portal.restUrl,schema:void 0})},args:()=>[t.portalItem]});var A},435:(t,e,i)=>{i.d(e,{p:()=>r});var s=i(667),a=i(333);const r=t=>(...e)=>{const i=(0,s.d)(),r=new t(...e),n=r.exports;(0,s.b)(i.at(-1));const l=r.component.manager;l.W(r,n),r.watchExports(l.W.bind(l,r)),(0,s.j)(r);const c=[r.component,...i].reverse();return(0,a.t)(c,t=>void 0===t?void 0:o(r,t,n),n)},o=(t,{host:e,key:i,isReactive:a},r)=>{const o=e,n=o[i]!==t.exports,l=o[i]!==r,c=r!==t.exports;n&&!l&&c&&(o[i]=t.exports);if(e===t.component){if(a){const e=t.component.manager;l&&e.W(t,o[i]),t.onUpdate(s=>{if(s.has(i)){const s=o[i];s!==t.exports&&e.W(t,s)}})}t.O=a?void 0:i}const d=t.component.constructor.elementProperties.get(i)?.readOnly;t.watchExports(()=>{o[i]!==t.exports&&(d?(0,s.f)(()=>{o[i]=t.exports}):o[i]=t.exports)})}},438:t=>{t.exports=n},448:(t,e,i)=>{i.r(e),i.d(e,{ArcgisPortalFieldDelete:()=>V});var s=i(895),a=i(337),r=i(916),o=i(832),n=i(582),l=i(294),c=i(843),d=i(438),h=i(588),u=i(345),p=i(368),f=i(989),m=i(470),g=i(698),y=i(284),v=(t=>(t.expression="expression/",t.raster="Raster.",t.relationship="relationships/",t))(v||{});const b=["feature"];function $(t){return"fieldConfigurations"in t&&b.includes(t.type)}function C(t){return null!=t}function w(t,e,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(t))s="number";else if(e.has(t)){const i=e.get(t);s=i.type?i.type.toLowerCase():""}else if(i.has(t)){const e=i.get(t);s=e.returnType?e.returnType.toLowerCase():""}else s="number";return s}async function E(t){return new Map((await async function(t){return await new Promise((e,i)=>{switch(t.type){case"feature":case"ogc-feature":case"stream":e(t.fields);break;case"sublayer":{const s=t,a=s?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(t=>{if(t?.thematicGroup){const i=new Map(s.fields.map(t=>[t.name,t])),a=t.thematicGroup.fieldNames,r=[];a.forEach(t=>{i.has(t)&&r.push(i.get(t))}),e(r)}else e(s.fields)}).catch(t=>{i(new Error(t))}):e(s.fields);break}case"imagery":case"imagery-tile":case"wcs":e(t.rasterFields);break;default:e("fields"in t?t.fields??[]:[])}})}(t)).filter(t=>t.visible).map(t=>[t.name,t]))}function A(t){return(t=>t&&!t.endsWith("/")?`${t}/`:t)(t.restUrl)}function x(t,e){return _(t,e)||function(t,e){const i=t.owner,s="admin"===t.itemControl,a=["esri_livingatlas","esri_demographics","esri_boundaries"];return!(t.portal?.isPortal&&!_(t,e)&&s&&i?.includes("esri_")&&!a.includes(i))&&s}(t,e)}function _(t,e){return t.owner===e.username}function I(t){return t.typeKeywords?.includes("View Service")}function S(t){return t.typeKeywords?.includes("Hosted Service")}function F(t){return t.typeKeywords?.includes("Multi Services View")}function P(t){return t?.hasViews&&!t.sourceSchemaChangesAllowed}async function T(t){const e=t?.portalItem;if(!e)return await Promise.resolve(null);const i=e.portal;if(i?.user){const t=`${A(i)}community/users/${i.user.username}`;return await(0,u.default)(t,{query:{f:"json",token:e.portal.credential?.token},responseType:"json"}).then(async t=>{const e=t.data?.groups??[];return await Promise.resolve(e)},async()=>await Promise.reject(new Error("Failed to fetch user groups")))}return await Promise.resolve(null)}async function k(t){const e=t?.portalItem;if(!e)return await Promise.resolve(null);const i=`${A(e.portal)}content/items/${e.id}/groups`;return await(0,u.default)(i,{query:{f:"json",token:e.portal.credential?.token},responseType:"json"}).then(async t=>{const e=[...t.data?.admin??[],...t.data?.member??[],...t.data?.other??[]];return await Promise.resolve(e)},async()=>await Promise.reject(new Error("Failed to fetch item groups")))}async function O(t,e,{relationshipType:i,direction:s}){const a=`${A(e)}content/items/${t}/relatedItems`;return await(0,u.default)(a,{query:{f:"json",relationshipType:i,direction:s},responseType:"json"})}function D(t,e){return t?.some(t=>e?.some(e=>t.id===e.id&&t.capabilities.includes("updateitemcontrol")))}function U(t,e){return!(!t||!e)&&t.toLocaleLowerCase()===e.toLocaleLowerCase()}async function N(t,e,i,s){if(!i)return!1;const a=["feature","oriented-imagery"].includes(e.type),r=s?.item??e.portalItem,o=e.sourceJSON;if(!a||!r||!r.portal.user||!S(r)||I(r)||F(r)||P(o)||r.portal.isPortal&&function(t){return t.typeKeywords?.includes("Spatiotemporal")}(r)||["oid","global-id","geometry"].includes(i.type))return!1;const n=e.sourceJSON.geometryProperties,l=n?.shapeLengthFieldName,c=n?.shapeAreaFieldName;if(U(l,i.name)||U(c,i.name))return!1;const d=e.editFieldsInfo;if(d&&(U(d.creationDateField,i.name)||U(d.creatorField,i.name)||U(d.editDateField,i.name)||U(d.editorField,i.name))||U(e.objectIdField,i.name)||U(e.displayField,i.name)||U(e.typeIdField,i.name)||U(e.subtypeField,i.name)||e.timeInfo&&(U(e.timeInfo.startField,i.name)||U(e.timeInfo.endField,i.name)||U(e.timeInfo.trackIdField,i.name)))return!1;if(!s?.ignoreLayerRenderer&&e.featureReduction){const t=new Set;if(await p.collectFeatureReductionFields(t,e,e.featureReduction),Array.from(t).some(t=>U(t,i.name)))return!1}if(!s?.ignoreLayerRenderer&&(await p.getRendererFields(e.renderer,e.fieldsIndex)).some(t=>U(t,i.name)))return!1;if(!s?.ignoreLayerLabelingInfo){const t=e.labelingInfo?.map(t=>t.labelExpressionInfo?.expression);if(t&&((await p.getExpressionFields(e,t)).some(t=>U(t,i.name))||await M(e,i,"layer")))return!1}if(!s?.ignoreLayerDefinitionExpression&&e.definitionExpression&&(await y.parseWhereClause(e.definitionExpression,e.fieldsIndex)).fieldNames.some(t=>U(t,i.name))||await async function(t,e,i){const s=t.portalItem;if(!s)return!1;const a=`${A(s.portal)}content/items/${s.id}/data`,r=(i?.userItemInfo?.itemData??await(0,u.default)(a,{query:{f:"json"},responseType:"json"}))?.data;if(!r)return!1;if(r?.layers){const s=r.layers.find(e=>e.id===t.layerId),a=s?.layerDefinition?.drawingInfo?.renderer,o=s?.layerDefinition?.featureReduction,n=s?.layerDefinition?.definitionExpression;if(!a&&!o&&!n)return!1;if(!i?.ignoreItemRenderer&&a){const i=g.fromJSON(a);if((await p.getRendererFields(i,t.fieldsIndex)).some(t=>U(t,e.name)))return!0}if(!i?.ignoreItemFeatureReduction&&o&&await R(t,e,o)||n&&(await y.parseWhereClause(n,t.fieldsIndex)).fieldNames.some(t=>U(t,e.name)))return!0}return!1}(e,i,s)||await async function(t,e){const i=t.sourceJSON,s=i?.drawingInfo?.renderer,a=i?.featureReduction;if(!s&&!a)return!1;if(s){const i=g.fromJSON(s);if((await p.getRendererFields(i,t.fieldsIndex)).some(t=>U(t,e.name)))return!0}return!(!a||!await R(t,e,a))}(e,i))return!1;if(await async function(t,e){const i=t.sourceJSON?.drawingInfo?.labelingInfo;if(!i)return await Promise.resolve(!1);const s=i?.map(t=>t.labelExpressionInfo?.expression);if(s){if((await p.getExpressionFields(t,s)).some(t=>U(t,e.name)))return await Promise.resolve(!0);if(await M(t,e,"service"))return await Promise.resolve(!0)}return await Promise.resolve(!1)}(e,i))return await Promise.resolve(!1);if(await async function(t,e){const i=t.sourceJSON?.definitionQuery;return i&&(await y.parseWhereClause(i,t.fieldsIndex)).fieldNames.some(t=>U(t,e.name))?await Promise.resolve(!0):await Promise.resolve(!1)}(e,i))return await Promise.resolve(!1);if(function(t,e,i){if(!t)return!1;const s=t.map?.applicationProperties?.viewing?.search;if(s){const t=s.layers?.find(t=>t.id===e.id);if(t){const e=t?.field?.name;if(e)return U(e,i.name)}}return!1}(t,e,i)||e.relationships?.map(t=>t.keyField)?.some(t=>U(t,i.name)))return!1;const h=x(r,r.portal.user),f=D(s?.userItemInfo?.userGroups??await T(e)??[],s?.userItemInfo?.itemGroups??await k(e)??[]);if(!h&&!f)return!1;const m=s?.userItemInfo?.relatedItems??await O(r.id,r.portal,{relationshipType:"Service2Service"});return!(m?.data?.relatedItems&&m.data.relatedItems.some(t=>["WMTS","Map Service","Vector Tile Service"].includes(t.type)))}async function M(t,e,i){const s="layer"===i?t.labelingInfo?.filter(t=>C(t.where)):t.sourceJSON?.drawingInfo?.labelingInfo?.filter(t=>C(t.where));if(!s?.length)return!1;const a=[...await Promise.all(s.map(async e=>await y.parseWhereClause(e.where,t.fieldsIndex)))];let r=!1;for(let t=0;t<a.length;t++){const i=a[t].fieldNames?.some(t=>U(t,e.name));if(!r&&i){r=!0;break}}return await Promise.resolve(r)}async function R(t,e,i){const s="binning"===i.type?f.default.fromJSON(i):m.default.fromJSON(i),a=new Set;return await p.collectFeatureReductionFields(a,t,s),!!Array.from(a).some(t=>U(t,e.name))}var L=i(733);const j=new Map;j.set("oid","key"),j.set("guid","key"),j.set("global-id","key"),j.set("blob","binary"),j.set("integer","integer"),j.set("small-integer","integer"),j.set("big-integer","integer"),j.set("single","number"),j.set("double","number"),j.set("long","number"),j.set("number","number"),j.set("date","date-time"),j.set("date-only","calendar"),j.set("time-only","clock"),j.set("timestamp-offset","time-zone"),j.set("string","string");const q=a.AH`.dialog{--calcite-dialog-max-size-y: 60%}.dialog-content-wrapper{position:relative;min-height:100px}.hide-overflow{overflow:hidden}.field-icons{padding:0 var(--calcite-spacing-lg);display:flex;align-items:center}.warning{border-bottom:var(--calcite-border-width-sm) solid var(--calcite-color-border-3);margin-bottom:var(--calcite-spacing-md)}.warning-message{font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-bold)}.loader-container{position:absolute;height:100%;width:100%;top:0;right:0;display:none;z-index:40;overflow:hidden;background:#fffffff2;padding:0}.active{display:flex;flex-direction:column;align-items:center;justify-content:center}.loader{padding:0}.loader-text{font-weight:var(--calcite-font-weight-medium);text-align:center;margin-right:6.25rem;margin-left:6.25rem}`;class V extends r.WF{constructor(){super(...arguments),this.arcadeExpMap=new Map,this.cancelNode=(0,o._)(),this.dialogNode=(0,o._)(),this.layerFields=[],this.layerFieldsMap=new Map,this.messages=(0,L.u)({blocking:!0}),this.deleteInProgress=!1,this.fieldsAreDeletable=!1,this._propWatcherTask=new n.YZ(this,{task:async([t,e])=>{if(!C(t)||!C(e))throw console.error("Required properties are missing."),new Error;this._propWatcherTask.autoRun=!1,await this.processProps()},args:()=>[this.layer,this.fieldNames]}),this.arcgisBeforeModalClose=(0,r.lh)(),this.arcgisClose=(0,r.lh)(),this.arcgisFieldsDeleted=(0,r.lh)()}static{this.properties={config:0,fieldNames:0,layer:0,mapView:0,options:0}}static{this.styles=q}async processProps(){const{layer:t,mapView:e,fieldNames:i}=this;if(!t||!i)return void(this.fieldsAreDeletable=!1);t.loaded||await t.load(),this.layerFields=t.fields.filter(t=>i.includes(t.name));const s=i.some(e=>!t.fields.find(t=>t.name===e));if(!this.layerFields?.length||s)this.fieldsAreDeletable=!1;else{const i=await Promise.all(this.layerFields.map(async i=>await N(e,t,i,this.options)));if(this.fieldsAreDeletable=i.every(t=>t),!this.fieldsAreDeletable)return}this.layerFieldsMap=await E(t),this.options?.ignorePopupTemplate||(this.arcadeExpMap=function(t){const e=new Map;return t?.expressionInfos&&t.expressionInfos.forEach(t=>{const i=`${v.expression}${t.name}`;e.set(i,t)}),e}(t.popupTemplate)),this.portal=t.portalItem?.portal??this.options?.portal,this.item=t.portalItem??this.options?.item,this.item?await h.default.getCredential(this.item.url.replace("rest/services","rest/admin/services")):this.fieldsAreDeletable=!1}getFieldLabel(t){const{layer:e,arcadeExpMap:i}=this;if(this.options?.ignorePopupTemplate)return this.getFieldDisplayNameFromLayerFields(t);{const s=(e.popupTemplate??e.createPopupTemplate()).fieldInfos?.find(e=>e.fieldName===t);return s?function(t,e,i){const s=e.fieldName;if(s.includes(v.expression)){const t=i.get(s);return t?.title?t.title:s}return $(t)&&t.getFieldConfiguration(s)?t.getFieldAlias(s)||s:e.label||s}(e,s,i):this.getFieldDisplayNameFromLayerFields(t)}}getFieldDisplayNameFromLayerFields(t){const{layer:e}=this,i=this.layerFieldsMap.get(t);return $(e)?e.getFieldAlias(t):i.alias??i.name}async deleteFields(){const{layer:t,fieldNames:e}=this,i=`${t.url.replace("/rest/services","/rest/admin/services")}/${t.layerId}/deleteFromDefinition`,s={fields:e.map(t=>({name:t}))},a={deleteFromDefinition:JSON.stringify(s)};await(0,u.default)(i,{query:{...a,f:"json",async:!1},method:"post",responseType:"json"}).then(async i=>{if(i.data?.success){const i=`${t.url}/${t.layerId}`;e.forEach(e=>{"feature"===t.type&&t.floorInfo?.floorField===e&&(t.floorInfo=null)});const s=await(0,u.default)(i,{query:{f:"json"},responseType:"json"});if(s){const t=s.data;this.currentLayerInfo=s.data,t&&(this.updateTypesAndTemplatesOnLayer(),e.forEach(e=>{t.templates?.length?t.templates.forEach(t=>delete t.prototype.attributes[e]):t.types?.forEach(t=>{t.templates.forEach(t=>delete t.prototype.attributes[e])})}),this.updateFeatureService(t))}else this.handleError()}},()=>this.handleError())}updateTypesAndTemplatesOnLayer(){const{currentLayerInfo:t}=this,e=t;if(e.templates?.length){const t=this.updateTemplatesList(e.templates);e.templates=t}else if(e.types){const t=e.types;e.types=[],t.forEach(t=>{t.templates=this.updateTemplatesList(t.templates),this.addType(e,t)})}}updateTemplatesList(t){const{currentLayerInfo:e,messages:i}=this,s=[];return(t??[]).forEach(t=>{const a=new c.default;a.description=t.description??"",a.name=t.name||i.newFeature,a.drawingTool=t.drawingTool||"point";const r={};e.fields.forEach(e=>{let i=!1;for(let s=0;s<t.prototype.attributes.length;s++)if(t.prototype.attributes[s]===e.name){i=!0,r[e.name]=t.prototype.attributes[e.name];break}!i&&e.editable&&(r[e.name]=e.defaultValue||null)});const o=new d.default({attributes:r});a.prototype=o,s.push(a)}),s}addType(t,e){t.types?t.types.some(t=>t.id===e.id)||t.types.push(e):t.types=[e]}async updateFeatureService(t){const{layer:e,fieldNames:i}=this,s={templates:t.templates,types:t.types},a=`${e.url.replace("/rest/services","/rest/admin/services")}/${e.layerId}/updateDefinition`,r={f:"json",updateDefinition:JSON.stringify(s)};await(0,u.default)(a,{query:{...r,f:"json"},method:"post",responseType:"json"}).then(async t=>{if(t.data?.success){const t=`${A(this.portal)}content/items/${this.item.id}/data`;if(this.options?.ignorePopupTemplate||i.forEach(t=>{e.popupTemplate?.fieldInfos&&(e.popupTemplate.fieldInfos=e.popupTemplate.fieldInfos.filter(e=>e.fieldName!==t)),e.popupTemplate?.content?.forEach((i,s)=>{"fields"===i.type&&i.fieldInfos&&((e.popupTemplate?.content)[s].fieldInfos=(e.popupTemplate?.content)[s].fieldInfos?.filter(e=>e.fieldName!==t))})}),e.attributeTableTemplate){const t=e.attributeTableTemplate.clone();t.elements=t.elements.filter(t=>!("field"===t.type&&i.includes(t.fieldName))),t.orderByFields=t.orderByFields.filter(t=>!i.includes(t.field)),e.attributeTableTemplate=t}if(e.fieldConfigurations?.length){const t=l.clone(e.fieldConfigurations).filter(t=>!i.includes(t.name));e.fieldConfigurations=t}await(0,u.default)(t,{query:{f:"json"},responseType:"json"}).then(async t=>{const s=t.data;if(s?.layers||s?.tables){const t=e.isTable,a=t?s.tables:s.layers,r=a?.find(t=>t.id===e.layerId);if(i.forEach(t=>{r?.attributeTableInfo?.attributeTableElements&&(r.attributeTableInfo.attributeTableElements=r.attributeTableInfo.attributeTableElements.filter(e=>!("field"===e.type&&e.fieldName===t)),r.attributeTableInfo.orderByFields=r.attributeTableInfo.orderByFields.filter(e=>e.field!==t))}),r?.layerDefinition?.fieldConfigurations&&(r.layerDefinition.fieldConfigurations=r.layerDefinition.fieldConfigurations.filter(t=>!i.includes(t.name))),r?.popupInfo){i.forEach(t=>{r.popupInfo.fieldInfos=r.popupInfo.fieldInfos.filter(e=>e.fieldName!==t),r.popupInfo.popupElements?.forEach((e,i)=>{"fields"===e.type&&e.fieldInfos&&(r.popupInfo.popupElements[i].fieldInfos=r.popupInfo.popupElements[i].fieldInfos.filter(e=>e.fieldName!==t))})});const e=`${A(this.portal)}content/users/${this.item.owner}/items/${this.item.id}/update`,o={};t?(o.tables=a,s.layers&&(o.layers=s.layers)):(o.layers=a,s.tables&&(o.tables=s.tables));const n={f:"json",text:JSON.stringify(o)};await(0,u.default)(e,{query:{...n},method:"post",responseType:"json"}).then(t=>{t.data?.success?this.handleSuccess():this.handleError()},()=>this.handleError())}else this.handleSuccess()}else 200!==t.httpStatus||t.data&&"{}"!==JSON.stringify(t.data)?this.handleError():this.handleSuccess()},()=>this.handleError())}},()=>this.handleError())}handleSuccess(){this.arcgisFieldsDeleted.emit(),this.dialogNode?.value&&(this.dialogNode.value.open=!1),this.options?.handleCloseOnConsumer?this.arcgisBeforeModalClose.emit("success"):this.displaySuccessAlert()}handleError(t){this.dialogNode?.value&&(this.dialogNode.value.open=!1),t?this.options?.handleCloseOnConsumer?this.arcgisBeforeModalClose.emit("read-only-error"):this.displayReadOnlyErrorAlert():this.options?.handleCloseOnConsumer?this.arcgisBeforeModalClose.emit("error"):this.displayErrorAlert()}displaySuccessAlert(){const{messages:t,fieldNames:e}=this;this.successAlertNode&&(this.successAlertNode.parentElement?.removeChild(this.successAlertNode),this.successAlertNode=void 0),this.successAlertNode=(0,r.dN)(a.qy`<calcite-alert .label=${1===e.length?t.fieldDeleted:t.fieldsDeleted} kind=success icon=check-circle auto-close open><div slot=message>${1===e.length?t.fieldDeleted:t.fieldsDeleted}</div></calcite-alert>`),document.body.append(this.successAlertNode)}displayErrorAlert(){const{messages:t}=this;this.errorAlertNode&&(this.errorAlertNode.parentElement?.removeChild(this.errorAlertNode),this.errorAlertNode=void 0),this.errorAlertNode=(0,r.dN)(a.qy`<calcite-alert .label=${t.fieldDeletionUnsuccessful} kind=danger icon=exclamation-mark-triangle auto-close open><div slot=message>${t.fieldDeletionUnsuccessful}</div></calcite-alert>`),document.body.append(this.errorAlertNode)}displayReadOnlyErrorAlert(){const{messages:t,portal:e}=this;this.errorAlertNode&&(this.errorAlertNode.parentElement?.removeChild(this.errorAlertNode),this.errorAlertNode=void 0),this.errorAlertNode=(0,r.dN)(a.qy`<calcite-alert .label=${t.fieldDeletionUnsuccessful} kind=danger icon=exclamation-mark-triangle auto-close auto-close-duration=slow open><div slot=title>${t.error}</div><div slot=message>${e.isPortal?t.readOnlyErrorMessageEnterprise:t.readOnlyErrorMessage}</div>${!e.isPortal&&a.qy`<calcite-link slot=link target=_blank href=https://status.arcgis.com>${t.healthDashboard}</calcite-link>`||""}</calcite-alert>`),document.body.append(this.errorAlertNode)}render(){const{messages:t,fieldsAreDeletable:e,fieldNames:i,deleteInProgress:s}=this;return this._propWatcherTask.render({complete:()=>(e||(i?.length?1===i?.length?console.error("Field cannot be deleted"):console.error("One or more fields cannot be deleted"):console.error("You must select at least one field.")),a.qy`<calcite-dialog class="dialog" width=s open modal outside-close-disabled escape-disabled @calciteDialogClose=${()=>this.arcgisClose.emit()} .heading=${1===i?.length?t.deleteField:t.deleteFields} ${(0,o.K)(this.dialogNode)}>${e?a.qy`<div class=${"dialog-content-wrapper "+(s?"hide-overflow":"")}>${this.renderDeleteLoader()}<calcite-label>${1===i.length?t.deletePrompt:t.deleteMultiplePrompt}</calcite-label>${this.renderFieldsPreview()}</div>${this.renderCancelButton()}${this.renderDeleteButton()}`:this.renderError()}</calcite-dialog>`)})}renderError(){const{messages:t}=this;return a.qy`<div class="loader-container active"><div class="loader-text">${t.errorOccurred}</div></div>`}renderDeleteLoader(){const{messages:t,fieldNames:e,deleteInProgress:i}=this;return a.qy`<div class=${"loader-container "+(i?"active":"")}><calcite-loader class="loader" .label=${1===e.length?t.deletingField:t.deletingFields} .hidden=${!i}></calcite-loader><div class="loader-text">${1===e.length?t.deletingField:t.deletingFields}</div></div>`}renderFieldsPreview(){const{fieldNames:t,layerFields:e,layerFieldsMap:i,arcadeExpMap:s,messages:r}=this;return a.qy`<calcite-list .label=${r.fields}>${t.map(t=>{const r=e.find(e=>e.name===t);return a.qy`<calcite-list-item .label=${this.getFieldLabel(t)} .description=${`{${t}}`} .value=${t} .disabled=${!r.editable}><div slot=actions-end class="field-icons">${(({fieldType:t})=>a.qy`<calcite-icon scale=s .icon=${j.get(t)}></calcite-icon>`)({fieldType:w(t,i,s)})}</div></calcite-list-item>`})}</calcite-list>`}renderCancelButton(){const{messages:t}=this;return a.qy`<calcite-button @click=${()=>this.dialogNode.value.open=!1} slot=footer-end appearance=outline ${(0,o.K)(this.cancelNode)}>${t.cancel}</calcite-button>`}renderDeleteButton(){const{messages:t,fieldNames:e}=this;return a.qy`<calcite-button kind=danger slot=footer-end @click=${async t=>{const{portal:e}=this;t.currentTarget.disabled=!0,this.cancelNode.value.disabled=!0,this.dialogNode.value.closeDisabled=!0,e.sourceJSON?.isReadOnly?this.handleError(!0):(this.deleteInProgress=!0,this.requestUpdate(),await this.deleteFields())}}>${1===e.length?t.deleteField:t.deleteFieldsWithNumber.replace("${number}",`${e.length}`)}</calcite-button>`}}(0,s.c)("arcgis-portal-field-delete",V)},470:t=>{t.exports=f},504:(t,e,i)=>{i.d(e,{Dx:()=>n,KO:()=>u,Rt:()=>r,cN:()=>h,lx:()=>l,mY:()=>d});var s=i(752);const{I:a}=s.ge,r=t=>void 0===t.strings,o=()=>document.createComment(""),n=(t,e,i)=>{const s=t._$AA.parentNode,r=void 0===e?t._$AB:e._$AA;if(void 0===i){const e=s.insertBefore(o(),r),n=s.insertBefore(o(),r);i=new a(e,n,t,t.options)}else{const e=i._$AB.nextSibling,a=i._$AM,o=a!==t;if(o){let e;i._$AQ?.(t),i._$AM=t,void 0!==i._$AP&&(e=t._$AU)!==a._$AU&&i._$AP(e)}if(e!==r||o){let t=i._$AA;for(;t!==e;){const e=t.nextSibling;s.insertBefore(t,r),t=e}}}return i},l=(t,e,i=t)=>(t._$AI(e,i),t),c={},d=(t,e=c)=>t._$AH=e,h=t=>t._$AH,u=t=>{t._$AR(),t._$AA.remove()}},549:(t,e,i)=>{i.d(e,{a:()=>r,r:()=>n,u:()=>l,v:()=>o});var s=i(345),a=i(312);async function r(t,e){const i=`${t}/portals/self/classification/classificationSchema`,a={};try{const t=(await(0,s.default)(i,{query:{f:"json"},signal:e})).data;if("object"!=typeof t||null===t||!("classificationSchema"in t))throw new Error("Invalid response format received from the classification schema endpoint");a.result=t.classificationSchema}catch(t){a.error=t}return a}async function o(t,e,i){const a=`${t}/portals/self/classification/validateClassification`,r={classificationValue:JSON.stringify(e),f:"json"},o={};try{const t=await(0,s.default)(a,{query:r,method:"post",signal:i.signal});o.result=t.data}catch(t){console.error(t),o.error=t}return o}async function n(t){if(!t)return;t.loaded||await t.load();const e=t.portal.user??await(0,a.once)(()=>t?.portal.user);if(!e)return;const i=`${t.portal.restUrl}/community/users/${e.username}/resources/classification_favorites`,r={};try{const t=await(0,s.default)(i,{query:{f:"json"}});r.result=t.data}catch(t){console.error(t),r.error=t}return r}async function l(t,e){if(!t)return;t.loaded||await t.load();const i=t.portal.user??await(0,a.once)(()=>t?.portal.user);if(!i)return;const r=`${t.portal.restUrl}/community/users/${i.username}/addResource`,o={},n={f:"json",key:"classification_favorites",text:JSON.stringify({favorites:e}),access:"UserPrivateAllApps"};try{const t=await(0,s.default)(r,{query:n,method:"post"});o.result=t.data.success}catch(t){console.error("error: ",t),o.error=t}return o}},577:t=>{t.exports=v},582:(t,e,i)=>{i.d(e,{YZ:()=>o,e1:()=>a});var s=i(842);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class o{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((t,e)=>{this.o=t,this.h=e}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(t,e,i){this.p=0,this.i=0,(this._=t).addController(this);const s="object"==typeof e?e:{task:e,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??n,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const t=this.j();if(!Array.isArray(t))throw Error("The args function must return an array");return t}async S(){const t=this.T(),e=this.O;this.O=t,t===e||void 0===t||void 0!==e&&this.m(e,t)||await this.run(t)}async run(t){let e,i;t??=this.T(),this.O=t,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let a=!1;try{e=await this.v(t,{signal:this.q.signal})}catch(t){a=!0,i=t}if(this.p===s){if(e===r)this.i=0;else{if(!1===a){try{this.k?.(e)}catch{}this.i=2,this.o?.(e)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=e,this.l=i}this._.requestUpdate()}}abort(t){1===this.i&&this.q?.abort(t)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(t){switch(this.i){case 0:return t.initial?.();case 1:return t.pending?.();case 2:return t.complete?.(this.value);case 3:return t.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const n=(t,e)=>t===e||t.length===e.length&&t.every((t,i)=>!(0,s.Ec)(t,e[i]))},588:t=>{t.exports=l},592:(t,e,i)=>{i.d(e,{UF:()=>s,ao:()=>a});const s=(t,e,...i)=>{try{return t?.call(e,...i)}catch(e){console.error(e,t)}},a=async(t,e,...i)=>{try{const s=t?.call(e,...i);return await s}catch(e){console.error(e,t)}}},601:t=>{t.exports=function(t){return t[1]}},649:(t,e,i)=>{var s=i(601),a=i.n(s),r=i(314),o=i.n(r)()(a());o.push([t.id,"@layer{:not([hydrated]):is(arcgis-portal-classification-banner,arcgis-portal-classification-config,arcgis-portal-classification-favorite,arcgis-portal-classification-form-element,arcgis-portal-field-delete){visibility:hidden}}",""])},667:(t,e,i)=>{i.d(e,{a:()=>g,b:()=>c,c:()=>s,d:()=>d,f:()=>y,i:()=>a,j:()=>u,k:()=>f,l:()=>m,r:()=>n,s:()=>o,u:()=>p});const s=Symbol.for("controller"),a=t=>"function"==typeof t?.then;let r;const o=t=>{r!==t&&(r=t,queueMicrotask(()=>r===t?r=void 0:0))},n=t=>r;let l=[];const c=t=>{if(void 0===t)return void(l=[]);const e=l.indexOf(t);l=-1===e?[...l,t]:l.slice(0,e+1),queueMicrotask(()=>l=[])},d=()=>l;let h;const u=t=>{h!==t&&(h=t,queueMicrotask(()=>h===t?h=void 0:0))},p=async(t,e)=>{const i=m(t);if(void 0===i)return t;if(await i.ready,"function"==typeof e){0;const t=i.watchExports(i=>e(i,t))}return i.exports},f=async t=>{const e=m(t);return await e.ready,e},m=t=>{const e=n().manager.X(t);if(void 0!==e)return e;if((t=>"object"==typeof t&&null!==t&&(s in t||"hostConnected"in t||"hostDisconnected"in t||"hostUpdate"in t||"hostUpdated"in t))(t))return t;const i=(()=>{const t=h;return h=void 0,t})();return void 0!==i?i:void 0};let g=!1;const y=t=>{g=!0;try{return t()}finally{g=!1}}},698:t=>{t.exports=m},733:(t,e,i)=>{i.d(e,{u:()=>r});var s=i(110),a=i(895);const r=(0,s.yr)(a.g)},752:(t,e,i)=>{i.d(e,{XX:()=>V,c0:()=>x,ge:()=>j,qy:()=>A,s6:()=>_});const s=globalThis,a=s.trustedTypes,r=a?a.createPolicy("lit-html",{createHTML:t=>t}):void 0,o="$lit$",n=`lit$${Math.random().toFixed(9).slice(2)}$`,l="?"+n,c=`<${l}>`,d=document,h=()=>d.createComment(""),u=t=>null===t||"object"!=typeof t&&"function"!=typeof t,p=Array.isArray,f=t=>p(t)||"function"==typeof t?.[Symbol.iterator],m="[ \t\n\f\r]",g=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,y=/-->/g,v=/>/g,b=RegExp(`>|${m}(?:([^\\s"'>=/]+)(${m}*=${m}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),$=/'/g,C=/"/g,w=/^(?:script|style|textarea|title)$/i,E=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),A=E(1),x=(E(2),E(3),Symbol.for("lit-noChange")),_=Symbol.for("lit-nothing"),I=new WeakMap,S=d.createTreeWalker(d,129);function F(t,e){if(!p(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==r?r.createHTML(e):e}const P=(t,e)=>{const i=t.length-1,s=[];let a,r=2===e?"<svg>":3===e?"<math>":"",l=g;for(let e=0;e<i;e++){const i=t[e];let d,h,u=-1,p=0;for(;p<i.length&&(l.lastIndex=p,h=l.exec(i),null!==h);)p=l.lastIndex,l===g?"!--"===h[1]?l=y:void 0!==h[1]?l=v:void 0!==h[2]?(w.test(h[2])&&(a=RegExp("</"+h[2],"g")),l=b):void 0!==h[3]&&(l=b):l===b?">"===h[0]?(l=a??g,u=-1):void 0===h[1]?u=-2:(u=l.lastIndex-h[2].length,d=h[1],l=void 0===h[3]?b:'"'===h[3]?C:$):l===C||l===$?l=b:l===y||l===v?l=g:(l=b,a=void 0);const f=l===b&&t[e+1].startsWith("/>")?" ":"";r+=l===g?i+c:u>=0?(s.push(d),i.slice(0,u)+o+i.slice(u)+n+f):i+n+(-2===u?e:f)}return[F(t,r+(t[i]||"<?>")+(2===e?"</svg>":3===e?"</math>":"")),s]};class T{constructor({strings:t,_$litType$:e},i){let s;this.parts=[];let r=0,c=0;const d=t.length-1,u=this.parts,[p,f]=P(t,e);if(this.el=T.createElement(p,i),S.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(s=S.nextNode())&&u.length<d;){if(1===s.nodeType){if(s.hasAttributes())for(const t of s.getAttributeNames())if(t.endsWith(o)){const e=f[c++],i=s.getAttribute(t).split(n),a=/([.?@])?(.*)/.exec(e);u.push({type:1,index:r,name:a[2],strings:i,ctor:"."===a[1]?N:"?"===a[1]?M:"@"===a[1]?R:U}),s.removeAttribute(t)}else t.startsWith(n)&&(u.push({type:6,index:r}),s.removeAttribute(t));if(w.test(s.tagName)){const t=s.textContent.split(n),e=t.length-1;if(e>0){s.textContent=a?a.emptyScript:"";for(let i=0;i<e;i++)s.append(t[i],h()),S.nextNode(),u.push({type:2,index:++r});s.append(t[e],h())}}}else if(8===s.nodeType)if(s.data===l)u.push({type:2,index:r});else{let t=-1;for(;-1!==(t=s.data.indexOf(n,t+1));)u.push({type:7,index:r}),t+=n.length-1}r++}}static createElement(t,e){const i=d.createElement("template");return i.innerHTML=t,i}}function k(t,e,i=t,s){if(e===x)return e;let a=void 0!==s?i._$Co?.[s]:i._$Cl;const r=u(e)?void 0:e._$litDirective$;return a?.constructor!==r&&(a?._$AO?.(!1),void 0===r?a=void 0:(a=new r(t),a._$AT(t,i,s)),void 0!==s?(i._$Co??=[])[s]=a:i._$Cl=a),void 0!==a&&(e=k(t,a._$AS(t,e.values),a,s)),e}class O{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,s=(t?.creationScope??d).importNode(e,!0);S.currentNode=s;let a=S.nextNode(),r=0,o=0,n=i[0];for(;void 0!==n;){if(r===n.index){let e;2===n.type?e=new D(a,a.nextSibling,this,t):1===n.type?e=new n.ctor(a,n.name,n.strings,this,t):6===n.type&&(e=new L(a,this,t)),this._$AV.push(e),n=i[++o]}r!==n?.index&&(a=S.nextNode(),r++)}return S.currentNode=d,s}p(t){let e=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class D{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,i,s){this.type=2,this._$AH=_,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=k(this,t,e),u(t)?t===_||null==t||""===t?(this._$AH!==_&&this._$AR(),this._$AH=_):t!==this._$AH&&t!==x&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):f(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==_&&u(this._$AH)?this._$AA.nextSibling.data=t:this.T(d.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:i}=t,s="number"==typeof i?this._$AC(t):(void 0===i.el&&(i.el=T.createElement(F(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===s)this._$AH.p(e);else{const t=new O(s,this),i=t.u(this.options);t.p(e),this.T(i),this._$AH=t}}_$AC(t){let e=I.get(t.strings);return void 0===e&&I.set(t.strings,e=new T(t)),e}k(t){p(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,s=0;for(const a of t)s===e.length?e.push(i=new D(this.O(h()),this.O(h()),this,this.options)):i=e[s],i._$AI(a),s++;s<e.length&&(this._$AR(i&&i._$AB.nextSibling,s),e.length=s)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class U{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,s,a){this.type=1,this._$AH=_,this._$AN=void 0,this.element=t,this.name=e,this._$AM=s,this.options=a,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=_}_$AI(t,e=this,i,s){const a=this.strings;let r=!1;if(void 0===a)t=k(this,t,e,0),r=!u(t)||t!==this._$AH&&t!==x,r&&(this._$AH=t);else{const s=t;let o,n;for(t=a[0],o=0;o<a.length-1;o++)n=k(this,s[i+o],e,o),n===x&&(n=this._$AH[o]),r||=!u(n)||n!==this._$AH[o],n===_?t=_:t!==_&&(t+=(n??"")+a[o+1]),this._$AH[o]=n}r&&!s&&this.j(t)}j(t){t===_?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class N extends U{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===_?void 0:t}}class M extends U{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==_)}}class R extends U{constructor(t,e,i,s,a){super(t,e,i,s,a),this.type=5}_$AI(t,e=this){if((t=k(this,t,e,0)??_)===x)return;const i=this._$AH,s=t===_&&i!==_||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,a=t!==_&&(i===_||s);s&&this.element.removeEventListener(this.name,this,i),a&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class L{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){k(this,t)}}const j={M:o,P:n,A:l,C:1,L:P,R:O,D:f,V:k,I:D,H:U,N:M,U:R,B:N,F:L},q=s.litHtmlPolyfillSupport;q?.(T,D),(s.litHtmlVersions??=[]).push("3.3.1");const V=(t,e,i)=>{const s=i?.renderBefore??e;let a=s._$litPart$;if(void 0===a){const t=i?.renderBefore??null;s._$litPart$=a=new D(e.insertBefore(h(),t),t,void 0,i??{})}return a._$AI(t),a}},759:(t,e,i)=>{i.r(e),i.d(e,{ArcgisPortalClassificationFavorite:()=>h});var s=i(895),a=i(337),r=i(214),o=i(916),n=i(733),l=i(549),c=i(854);const d=a.AH`.select-favorite-label{display:flex;justify-content:space-between;align-items:center}.favorite-actions{display:flex;justify-content:flex-end;gap:1.5rem;align-items:center}.classification-favorite-dialog{--calcite-dialog-content-space: 0;--calcite-dialog-background-color: "var(--calcite-color-foreground-2)"}.save-new-favorite-button{display:flex;justify-content:flex-end;margin-top:.25rem;margin-bottom:1rem}.classification-favorite-item{display:flex;justify-content:space-between;padding-top:.5rem;padding-bottom:.5rem;border-bottom:1px solid var(--calcite-color-border-1)}.classification-favorite-list,.classification-favorite-input-section{margin:1.75rem 1rem}`;class h extends o.WF{constructor(){super(...arguments),this.messages=(0,n.u)(),this.selectFavoriteClassification=t=>{const e=t.target.value;if(e){this.hasUpdateError=!1;const t=this.favoriteClassifications.find(({name:t})=>t===e);t&&this.updateClassificationData(t)}},this.uploadFavoriteClassificationValueHandle=async t=>{const e=await(0,l.u)(this.portalItem,this.favoriteClassifications);if(this.renderFavoriteClassificationError({alertIndicatorType:"success",alertIndicatorIcon:"check",alertIndicatorInfo:t}),e){const{result:i,error:s}=e;if(s)return console.error(s),void this.renderFavoriteClassificationError({alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:this.messages.uploadClassificationFavoriteError??"Failed to upload classification favorites"});i&&this.renderFavoriteClassificationError({alertIndicatorType:"success",alertIndicatorIcon:"check",alertIndicatorInfo:t})}},this.retrieveFavoriteClassificationHandle=async()=>{const t=await(0,l.r)(this.portalItem);if(t){const{result:e,error:i}=t;if(i)return console.error(i),void this.renderFavoriteClassificationError({alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:this.messages.retrieveClassificationFavoriteError??"Failed to retrieve classification favorites"});e&&this.resetFavoriteClassification(e.favorites)}},this.changeFavoriteClassificationName=t=>{const e=t.target.value;this.newFavoriteClassificationName=e,this.hasDuplicatedClassificationError=this.favoriteClassifications.some(t=>t.name===e)},this.saveNewFavoriteClassification=async()=>{const t=this.newFavoriteClassificationName;if(this.favoriteClassifications.some(e=>e.name===t))return void(this.hasDuplicatedClassificationError=!0);if(!t)return;const e=this.deleteNonEnabledAttributes(),i={name:t,classification:e};this.favoriteClassifications=[...this.favoriteClassifications,i],await this.uploadFavoriteClassificationValueHandle(this.messages.addClassificationFavoriteSuccessMessage??"Classification Favorite added successfully"),await this.retrieveFavoriteClassificationHandle(),this.showSaveClassificationDialog=!1},this.updateFavoriteClassification=async()=>{this.selectedFavoriteClassificationName?(await this.addFavoriteClassification(this.selectedFavoriteClassificationName),await this.retrieveFavoriteClassificationHandle()):this.hasUpdateError=!0},this.deleteNonEnabledAttributes=()=>{const t=structuredClone(this.portalItem?.classification??{}),e=Object.fromEntries(Object.entries(t).filter(([t])=>!1!==this.attributeExpressionResults?.get(t)?.enabled));return{...e,...(0,c.g)(this.portalItem,e)}},this.addFavoriteClassification=async t=>{const e=this.deleteNonEnabledAttributes(),i={name:t,classification:e},s=this.favoriteClassifications.findIndex(e=>e.name===t);s>=0?this.favoriteClassifications[s].classification=e:this.favoriteClassifications=[...this.favoriteClassifications,i],await this.uploadFavoriteClassificationValueHandle(this.messages.updateClassificationFavoriteSuccessMessage??"Classification Favorite updated successfully")},this.removeFavoriteClassification=async t=>{this.favoriteClassifications=this.favoriteClassifications.filter(e=>e.name!==t),0===this.favoriteClassifications.length&&(this.showManageClassificationDialog=!1),await this.uploadFavoriteClassificationValueHandle(this.messages.removeClassificationFavoriteSuccessMessage??"Classification Favorite removed successfully"),await this.retrieveFavoriteClassificationHandle()},this.newFavoriteClassificationName="",this.showManageClassificationDialog=!1,this.showSaveClassificationDialog=!1,this.hasDuplicatedClassificationError=!1,this.hasUpdateError=!1,this.alertIndicator={alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:""},this.isNotificationModalActive=!1,this.favoriteClassifications=[],this.selectedFavoriteClassificationName="",this.resetFavoriteClassification=()=>{},this.updateClassificationData=()=>{},this.renderFavoriteClassificationError=t=>{const{alertIndicatorType:e,alertIndicatorIcon:i,alertIndicatorInfo:s}=t;return a.qy`<calcite-alert .icon=${i} .label=${this.messages.classificationNotificationHandler??"Classification notification handler"} auto-close-duration=medium open .kind=${e} @calciteAlertClose=${()=>null===this.alertIndicator}><div slot=message>${s}</div></calcite-alert>`}}static{this.properties={newFavoriteClassificationName:16,showManageClassificationDialog:16,showSaveClassificationDialog:16,hasDuplicatedClassificationError:16,hasUpdateError:16,alertIndicator:16,isNotificationModalActive:16,portalItem:0,classificationValue:0,favoriteClassifications:0,selectedFavoriteClassificationName:1,attributeExpressionResults:0,resetFavoriteClassification:0,updateClassificationData:0}}static{this.styles=d}load(){this.newFavoriteClassificationName=this.classificationValue?.banner??""}onOpenFavoriteClassificationModal(){this.newFavoriteClassificationName=this.classificationValue?.banner??"",this.showSaveClassificationDialog=!0}render(){return a.qy`<div>${this.favoriteClassifications.length>0?a.qy`<div><calcite-label><div class="select-favorite-label">${this.messages.applyClassificationFavoriteLabel}<calcite-link @click=${()=>this.showManageClassificationDialog=!0}>${this.messages.manageClassificationFavoriteBtn}</calcite-link></div><calcite-combobox label=select-calcite-combobox selection-mode=single .placeholder=${this.messages.selectFavoritePlaceholder} placeholder-icon=folder-star @calciteComboboxChange=${this.selectFavoriteClassification} .status=${this.hasUpdateError?"invalid":"idle"} .validationIcon=${this.hasUpdateError?"exclamation-mark-triangle":""} .validationMessage=${this.hasUpdateError?this.messages.updateWarning:""}>${(0,r.u)(this.favoriteClassifications,({name:t})=>t,({name:t})=>a.qy`<calcite-combobox-item .selected=${this.selectedFavoriteClassificationName===t} icon=folder-star .value=${t} .textLabel=${t}></calcite-combobox-item>`)}</calcite-combobox></calcite-label><div class="favorite-actions"><calcite-link icon-start=refresh @click=${this.updateFavoriteClassification}>${this.messages.updateClassificationFavoriteBtn}</calcite-link><calcite-link icon-start=star @click=${this.onOpenFavoriteClassificationModal}>${this.messages.saveNewClassificationBtn}</calcite-link></div></div>`:a.qy`<div class="save-new-favorite-button"><calcite-link icon-start=folder-star @click=${this.onOpenFavoriteClassificationModal}>${this.messages.saveNewClassificationFavoriteBtn}</calcite-link></div>`}<calcite-dialog class="classification-favorite-dialog" overlay-positioning=fixed .heading=${this.messages.manageClassificationFavoriteLabel} .open=${this.showManageClassificationDialog} modal placement=center scale=m outside-close-disabled @calciteDialogClose=${()=>this.showManageClassificationDialog=!1}><calcite-list class="classification-favorite-list" .label=${this.messages.classificationFavoriteListLabel??"Classification Favorite list label"} selection-appearance=border selection-mode=single-persist>${(0,r.u)(this.favoriteClassifications,({name:t})=>t,({name:t})=>a.qy`<calcite-list-item .label=${t} .value=${t} class="classification-favorite-item"><div slot=content-end><calcite-icon icon=trash scale=s @click=${async()=>await this.removeFavoriteClassification(t)}></calcite-icon></div></calcite-list-item>`)}</calcite-list><calcite-button slot=footer-end scale=l @click=${()=>this.showManageClassificationDialog=!1}><div>${this.messages.favoriteClassificationBtnDone}</div></calcite-button></calcite-dialog><calcite-dialog class="classification-favorite-dialog" overlay-positioning=fixed .heading=${this.messages.addFavoriteDialogHeading} .open=${this.showSaveClassificationDialog} modal placement=center scale=m outside-close-disabled @calciteDialogClose=${()=>this.showSaveClassificationDialog=!1}><calcite-label class="classification-favorite-input-section">${this.messages.addClassificationFavorite}<calcite-input id=classification-favorite-name name=classification-favorite-name scale=m .value=${this.newFavoriteClassificationName} @calciteInputInput=${this.changeFavoriteClassificationName} .status=${!this.newFavoriteClassificationName||this.hasDuplicatedClassificationError?"invalid":"idle"} validation-icon=exclamation-mark-triangle .validationMessage=${this.newFavoriteClassificationName?this.hasDuplicatedClassificationError?this.messages.duplicatedClassificationError:"":this.messages.emptyFavoriteError}></calcite-input></calcite-label><calcite-button scale=l slot=footer-end @click=${this.saveNewFavoriteClassification}>${this.messages.favoriteClassificationBtnDone}</calcite-button></calcite-dialog></div>`}}(0,s.c)("arcgis-portal-classification-favorite",h)},789:(t,e,i)=>{i.r(e),i.d(e,{ArcgisPortalClassificationConfig:()=>A});var s=i(895),a=i(916),r=i(337),o=i(582),n=i(832),l=i(110),c=i(150),d=i(423),h=i(96),u=i(733),p=i(854),f=i(312),m=i(549);async function g({portalClassificationSchema:t,itemClassification:e}){const i=Object.entries(t.attributes).map(async([i])=>{const s=await async function(t,e,i){const s=e?.attributes?.[t];if(!s)return!1;const{isAttributeEnabled:a}=s;return!a||await w(a,JSON.stringify(e),i)}(i,t,e);return{[i]:{enabled:s}}}),s=await Promise.all(i);return Object.assign({},...s)}async function y({portalClassificationSchema:t,itemClassification:e}){const i=Object.entries(t.attributes).map(async([i])=>{const s=await async function(t,e,i){const s=e.attributes[t];if(!s)throw Error(`Attribute ${t} not found in schema`);const a=s.valueExpression,r=s.validValues,o=s.validValuesMap;return r?.length?r:o&&Object.keys(o)?.length?o:a?await w(a,e,i,t):null}(i,t,e);return{[i]:{valueExpressionResult:s}}}),s=await Promise.all(i);return Object.assign({},...s)}async function v({portalClassificationSchema:t,itemClassification:e}){const i=Object.entries(t.attributes).map(async([i])=>{const s=await async function(t,e,i){const s=e?.attributes?.[t];if(!s)return null;const a=s?.attributeValidation;return a?await w(a,JSON.stringify(e),i,t):null}(i,t,e);return{[i]:{attributeValidationResult:s}}}),s=await Promise.all(i);return Object.assign({},...s)}const b=async(t,e)=>{const i=t?.bannerExpression;return i?.length?await w(i,t,e):$(t,e)},$=(t,e)=>{const i=Object.entries(t.attributes).sort(([,t],[,e])=>(t?.bannerOrder??0)-(e?.bannerOrder??0)),s=[],a=[];return i.forEach(([t,i])=>{const r=e?.[t];r&&i.bannerOrder&&(s.push(C({elementType:i.uiElement??"",selectionDisplayLabel:i.bannerLabel??"",labelDelimiter:i.labelDelimiter??"",classificationProp:r,valueDelimiter:i.valueDelimiter??""})),a.push(i.attributeDelimiter??""))}),s.length>0?s.reduce((t,e,i)=>0===i?e:`${t}${a[i-1]}${e}`,""):""},C=({elementType:t,selectionDisplayLabel:e,labelDelimiter:i,classificationProp:s,valueDelimiter:a})=>`${e}${i}${t.includes("multi")&&s?s.split("").join(a):s}`;async function w(t,e,i,s=""){const a={schemaJsonString:"string"==typeof e?e:JSON.stringify(e),valueJsonString:JSON.stringify(i),attributeId:s};return(await async function(t){return await(0,h.createArcadeExecutor)(t,{variables:[{name:"schemaJsonString",type:"text"},{name:"valueJsonString",type:"text"},{name:"attributeId",type:"text"}]})}(t)).execute(a)}const E=r.AH`:host{height:100%;box-sizing:border-box;display:flex;flex-direction:column}.header-section{padding:var(--calcite-spacing-sm)}.header-section__title-container{display:flex;align-items:center;justify-content:space-between}.header-section__title-text{margin:unset;font-weight:unset;font-size:var(--calcite-font-size)}.header-section__title-popover{padding:var(--calcite-spacing-md)}.form-section{display:flex;border-top:var(--calcite-border-width-sm) solid var(--calcite-color-border-1);padding:var(--calcite-spacing-sm);height:100%;overflow:hidden}.form-section__sidebar{flex:1;padding:var(--calcite-spacing-sm)}.form-section__main-content{flex:3;padding:var(--calcite-spacing-sm);overflow:auto}.danger{color:var(--calcite-color-status-danger)}.spacing-y{margin:var(--calcite-spacing-md) 0}`;class A extends a.WF{constructor(){super(),this.classificationModel=(0,d.u)(this),this.messages=(0,u.u)(),this.formMainContentRef=(0,n._)(),this._classificationDataTask=(0,d.c)(this),this._formCreationTask=new o.YZ(this,{task:async()=>{if(await this._classificationDataTask.taskComplete,!this.portalClassificationSchema||!this.portalItem)throw new Error("Portal item and classification schema are required to render the form");const t=this.portalItem.clone();if(await t.load(),!this.primaryAttribute)throw new Error("primaryAttribute is required but was undefined.");this.existingClassification=!!t.classification,t.classification=(0,p.d)(t.classification,this.primaryAttribute,this.portalClassificationSchema),t.classification&&(t.classification.banner=await b(this.portalClassificationSchema,t.classification)),this.pendingPortalItem=t,this._itemClassificationWatchHandle&&(this._itemClassificationWatchHandle.remove(),this.portalItem.removeHandles("arcgis-classification-config"),this._itemClassificationWatchHandle=void 0),this._itemClassificationWatchHandle=(0,f.watch)(()=>this.portalItem.classification,t=>{if(this.pendingPortalItem){const e=this.pendingPortalItem.clone();e.load().then(()=>{e.classification=t,this.pendingPortalItem=e}).catch(t=>{console.error(t)})}}),this.portalItem.addHandles(this._itemClassificationWatchHandle,"arcgis-classification-config"),await this.evaluateAttributeExpressions(this.portalClassificationSchema,this.pendingPortalItem),this.pendingPortalItem.classification=(0,p.a)(this.pendingPortalItem.classification,this.attributeExpressionResults),this.existingClassification&&this.validateForm()},args:()=>[this.portalItem,this.portalClassificationSchema]}),this.getFormDisplayOrder=t=>this.portalClassificationSchema?.layouts.default.layoutElements[t].formDisplayOrder??0,this.addEditInfoAttributes=()=>{if(!this.pendingPortalItem?.classification)return{};const t=structuredClone(this.pendingPortalItem.classification),e=(0,p.g)(this.pendingPortalItem,t);return{...t,...e}},this.updateFavoriteClassification=t=>{this.favoriteClassifications=t},this.updateClassificationData=async t=>{const e=t.classification;if(this.selectedFavoriteClassificationName=t.name,this.pendingPortalItem){const t=this.pendingPortalItem.clone();if(await t.load(),t.classification=(0,p.r)(this.portalClassificationSchema,e),!this.portalClassificationSchema)return;await this.evaluateAttributeExpressions(this.portalClassificationSchema,t),t.classification=(0,p.a)(t.classification,this.attributeExpressionResults),this.pendingPortalItem=t}},this.existingClassification=!1,this.portalClassificationSchema=this.classificationModel.portalClassificationSchema,this.primaryAttribute=this.classificationModel.primaryAttribute,this.attributeExpressionResults=new Map,this.formValidationErrors=[],this.remoteValidationErrors="",this.canUserConfigureClassification=!0,this.favoriteClassifications=[],this.status=this.classificationModel.status,this.values={},this.valid=!1,this.autoDestroyDisabled=!1,this.arcgisPropertyChange=(0,l.RY)()("status","values","valid")}static{this.properties={existingClassification:16,portalClassificationSchema:16,primaryAttribute:16,attributeExpressionResults:16,formValidationErrors:16,itemClassification:16,pendingPortalItem:16,selectedCategory:16,remoteValidationErrors:16,canUserConfigureClassification:16,favoriteClassifications:16,selectedFavoriteClassificationName:16,portalItem:0,status:35,values:[1,{type:Object}],valid:7,autoDestroyDisabled:5}}static{this.styles=E}async destroy(){await this.manager.destroy()}async resetForm(){if(this.existingClassification)this.pendingPortalItem=this.portalItem?.clone(),this.portalClassificationSchema&&this.pendingPortalItem&&(await this.evaluateAttributeExpressions(this.portalClassificationSchema,this.pendingPortalItem),this.pendingPortalItem.classification=(0,p.a)(this.pendingPortalItem.classification,this.attributeExpressionResults),this.validateForm());else if(this.portalItem&&this.primaryAttribute&&this.portalClassificationSchema){const t=this.portalItem.clone();await t.load(),this.pendingPortalItem=this.portalItem?.clone(),this.pendingPortalItem.classification=(0,p.d)(t.classification,this.primaryAttribute,this.portalClassificationSchema),this.portalClassificationSchema&&this.pendingPortalItem&&(await this.evaluateAttributeExpressions(this.portalClassificationSchema,this.pendingPortalItem),this.pendingPortalItem.classification=(0,p.a)(this.pendingPortalItem.classification,this.attributeExpressionResults))}}async validateForm(){this.updateFormValidationErrors(),await this.updateRemoteValidationErrors()}async load(){try{await(0,p.c)(this.portalItem)||(this.canUserConfigureClassification=!1);const t=await(0,m.r)(this.portalItem);if(t){const{result:e,error:i}=t;if(i&&"COM_1177"!==i.details.raw.messageCode)return void console.error(i);e&&(this.favoriteClassifications=e.favorites)}}catch(t){console.error("Error occured while loading arcgis-classification-config:",t)}}willUpdate(t){if(t.has("pendingPortalItem")){const t=this.addEditInfoAttributes();this.values=t}(t.has("formValidationErrors")||t.has("remoteValidationErrors"))&&(this.valid=!this.formValidationErrors.length&&!this.remoteValidationErrors)}loaded(){const t=(0,c.el)(this.el,"form");t&&(this.listenOn(t,"formdata",this.updateFormData),this.listenOn(t,"submit",this.handleFormSubmit)),this.listen("submit",this.handleFormSubmit)}async updateClassificationProperty(t){if(!this.pendingPortalItem||!this.portalClassificationSchema)return;const e=this.pendingPortalItem.clone();await e.load(),Object.entries(t??{}).forEach(([t,i])=>{if(t===this.primaryAttribute){let t=(0,p.b)(i,e.classification,this.primaryAttribute);t=(0,p.r)(this.portalClassificationSchema,t),e.classification=t}else{const s=new Map(Object.entries(e.classification??{}));if(void 0===i||""===i||Array.isArray(i)&&0===i.length)s.delete(t);else if(s.set(t,i),"fgi"===t&&!s.has("fgiOptions")){const t=this.portalClassificationSchema?.attributes?.fgiOptions?.defaultValue??[];s.set("fgiOptions",Array.isArray(t)?t:[t])}e.classification=Object.fromEntries(s)}}),e.classification&&!e.classification.fgi&&delete e.classification.fgiOptions,await this.evaluateAttributeExpressions(this.portalClassificationSchema,e),e.classification=(0,p.a)(e.classification,this.attributeExpressionResults),e.classification&&(e.classification.banner=await b(this.portalClassificationSchema,e.classification)),this.pendingPortalItem=e,this.existingClassification&&this.validateForm()}handleCategorySelectChange(t){this.selectedCategory=t.target.selectedItems[0].value}async evaluateAttributeExpressions(t,e){const i=await g({portalClassificationSchema:t,itemClassification:e.classification}),s=await y({portalClassificationSchema:t,itemClassification:e.classification}),a=await v({portalClassificationSchema:t,itemClassification:e.classification});Object.keys(t.attributes).forEach(t=>{const e=i[t]?.enabled??!0,r=s[t]?.valueExpressionResult,o=a[t]?.attributeValidationResult;this.attributeExpressionResults.set(t,{enabled:e,valueExpressionResult:r,attributeValidationResult:o})})}updateFormValidationErrors(){const t=[];Object.entries(this.portalClassificationSchema?.attributes??{})?.forEach(([e,i])=>{i.isRequired&&!this.pendingPortalItem?.classification?.[e]&&0!==this.pendingPortalItem?.classification?.[e]&&t.push({attribute:i.label,reason:this.messages.isrequired??"is required",category:i.attributeCategory}),this.attributeExpressionResults.get(e)?.attributeValidationResult&&t.push({attribute:i.label,reason:this.attributeExpressionResults.get(e)?.attributeValidationResult??"",category:i.attributeCategory})}),this.formValidationErrors=t}async updateRemoteValidationErrors(){if(!this.pendingPortalItem?.classification)return;const t=await this.classificationModel.validateClassification(void 0,this.pendingPortalItem?.classification,this.pendingPortalItem.portal.restUrl);this.remoteValidationErrors=t}async handleFormSubmit(t){this.validateForm(),this.formMainContentRef.value?.scrollIntoView()}updateFormData(t){const e=t.formData;let i=this.addEditInfoAttributes();i=(0,p.a)(i,this.attributeExpressionResults),Object.entries(i??{}).forEach(([t,i])=>{e.set(t,i)})}renderCategoryTabs(){return this._classificationDataTask.render({complete:()=>{if(this.portalClassificationSchema?.attributeCategories?.length)return this.selectedCategory||(this.selectedCategory=this.portalClassificationSchema?.attributeCategories[0]),r.qy`<calcite-list .label=${this.messages.selectcategory??"select category"} selection-appearance=border selection-mode=single-persist @calciteListChange=${this.handleCategorySelectChange}>${this.portalClassificationSchema.attributeCategories.map(t=>{const e=this.formValidationErrors.filter(e=>e.category===t).length;return r.qy`<calcite-list-item .label=${t} .value=${t} .selected=${this.selectedCategory===t} .description=${e?`${e} ${e>1?this.messages.errors:this.messages.error}`:void 0}>${e&&r.qy`<div slot=content-end class="danger"><calcite-icon icon=exclamation-mark-triangle scale=s></calcite-icon></div>`||""}</calcite-list-item>`})}</calcite-list>`}})}renderValidationErrors(){return!this.formValidationErrors.length||this.selectedCategory&&!this.formValidationErrors.some(t=>this.selectedCategory===t.category)?null:r.qy`<calcite-notice open icon=exclamation-mark-triangle class="spacing-y" kind=danger><div slot=message>${this.messages.bannererror??"Some fields are incomplete or contain errors. Check the highlighted fields for details."}</div></calcite-notice>`}renderFavoriteClassification(){const t=this.portalClassificationSchema?.attributeCategories?.[0]??"Default";return this.selectedCategory=this.portalClassificationSchema?.attributeCategories?.length?this.selectedCategory:"Default",this.selectedCategory===t?r.qy`<arcgis-portal-classification-favorite .portalItem=${this.pendingPortalItem??this.portalItem} .classificationValue=${this.pendingPortalItem?.classification} .favoriteClassifications=${this.favoriteClassifications} .selectedFavoriteClassificationName=${this.selectedFavoriteClassificationName} .attributeExpressionResults=${this.attributeExpressionResults} .resetFavoriteClassification=${t=>this.updateFavoriteClassification(t)} .updateClassificationData=${async t=>await this.updateClassificationData(t)}></arcgis-portal-classification-favorite>`:null}renderForm(){return this._formCreationTask.render({pending:()=>r.qy`<calcite-loader .label=${this.messages.loading??"loading"}></calcite-loader>`,complete:()=>{if(!this.pendingPortalItem||!this.portalClassificationSchema)return;const t=Object.entries(this.portalClassificationSchema.attributes).sort(([t],[e])=>this.getFormDisplayOrder(t)-this.getFormDisplayOrder(e));return r.qy`${this.renderValidationErrors()}${this.renderFavoriteClassification()}${t.filter(([,{attributeCategory:t}])=>this.selectedCategory===t||!t).map(([t,e])=>{if(!1===this.attributeExpressionResults.get(t)?.enabled)return null;const i=this.pendingPortalItem?.classification?.[t];return r.qy`<arcgis-portal-classification-form-element .attributeKey=${t} .attribute=${e} .value=${i} @arcgisAttributeValueChange=${t=>{this.updateClassificationProperty(t.detail)}} .renderingInfo=${this.attributeExpressionResults.get(t)}></arcgis-portal-classification-form-element>`})}`}})}renderNotice(t,e="warning"){return r.qy`<calcite-notice icon=exclamation-mark-triangle open class="spacing-y" .kind=${e}><div slot=message>${t}</div></calcite-notice>`}renderHelpTooltip(){return this.portalClassificationSchema?.helpTooltip?r.qy`<calcite-action id=portal-classification-config-tooltip-button .text=${this.portalClassificationSchema?.helpTooltip} icon=information></calcite-action><calcite-popover .label=${this.portalClassificationSchema?.helpTooltip} reference-element=portal-classification-config-tooltip-button placement=bottom-end overlay-positioning=fixed auto-close><div class="header-section__title-popover"><calcite-link .href=${this.portalClassificationSchema?.helpUrl} target=_blank id=portal-classification-config-tooltip-button>${this.portalClassificationSchema?.helpTooltip}</calcite-link></div></calcite-popover>`:null}render(){return this.portalItem?this._classificationDataTask.render({pending:()=>r.qy`<calcite-loader .label=${this.messages.loading??"loading"}></calcite-loader>`,error:()=>this.renderNotice(this.messages.anerroroccurred??"An error has occurred.","danger"),complete:()=>this.portalItem?this.canUserConfigureClassification?this.portalItem.portal.hasClassificationSchema?r.qy`<div class="header-section" role=region aria-label=${this.messages.documentbannerpreview??"documentbannerpreview"??a.s6}><div class="header-section__title-container"><h2 class="header-section__title-text">${this.messages.documentbannerpreview??"documentbannerpreview"}</h2>${this.renderHelpTooltip()}</div>${this._formCreationTask.status===o.e1.COMPLETE&&r.qy`<arcgis-portal-classification-banner .portalItem=${this.pendingPortalItem??this.portalItem} variant=preview .missingExistingClassification=${!this.existingClassification}></arcgis-portal-classification-banner>`||""}</div><div class="form-section">${this.portalClassificationSchema?.attributeCategories?.length&&r.qy`<div class="form-section__sidebar">${this.renderCategoryTabs()}</div>`||""}<div class="form-section__main-content" ${(0,n.K)(this.formMainContentRef)}>${this.renderForm()}</div></div>`:this.renderNotice(this.messages.missingclassificationschema??"Portal is missing classification schema."):this.renderNotice(this.messages.userconfigurepermissionrequired??"User configuration permission is required."):this.renderNotice(this.messages.portalitemrequired??"Portal item is required.")}):this.renderNotice(this.messages.portalitemrequired??"Portal item is required.")}}(0,s.c)("arcgis-portal-classification-config",A)},804:(t,e,i)=>{i.d(e,{OA:()=>s,WL:()=>r,u$:()=>a});const s={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},a=t=>(...e)=>({_$litDirective$:t,values:e});class r{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}},827:(t,e,i)=>{i.d(e,{c:()=>s,o:()=>a});class s{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}const a=(t,e)=>{const i=e>r?o:e/n;let s=0;const a=setInterval(()=>{s+=i,s>=e&&(clearInterval(a),t())},i);return a},r=4e3,o=2e3,n=4},832:(t,e,i)=>{i.d(e,{_:()=>p,K:()=>g});var s=i(752),a=i(504),r=i(804);const o=(t,e)=>{const i=t._$AN;if(void 0===i)return!1;for(const t of i)t._$AO?.(e,!1),o(t,e);return!0},n=t=>{let e,i;do{if(void 0===(e=t._$AM))break;i=e._$AN,i.delete(t),t=e}while(0===i?.size)},l=t=>{for(let e;e=t._$AM;t=e){let i=e._$AN;if(void 0===i)e._$AN=i=new Set;else if(i.has(t))break;i.add(t),h(e)}};function c(t){void 0!==this._$AN?(n(this),this._$AM=t,l(this)):this._$AM=t}function d(t,e=!1,i=0){const s=this._$AH,a=this._$AN;if(void 0!==a&&0!==a.size)if(e)if(Array.isArray(s))for(let t=i;t<s.length;t++)o(s[t],!1),n(s[t]);else null!=s&&(o(s,!1),n(s));else o(this,t)}const h=t=>{t.type==r.OA.CHILD&&(t._$AP??=d,t._$AQ??=c)};class u extends r.WL{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,i){super._$AT(t,e,i),l(this),this.isConnected=t._$AU}_$AO(t,e=!0){t!==this.isConnected&&(this.isConnected=t,t?this.reconnected?.():this.disconnected?.()),e&&(o(this,t),n(this))}setValue(t){if((0,a.Rt)(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}const p=()=>new f;class f{}const m=new WeakMap,g=(0,r.u$)(class extends u{render(t){return s.s6}update(t,[e]){const i=e!==this.G;return i&&void 0!==this.G&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=e,this.ht=t.options?.host,this.rt(this.ct=t.element)),s.s6}rt(t){if(this.isConnected||(t=void 0),"function"==typeof this.G){const e=this.ht??globalThis;let i=m.get(e);void 0===i&&(i=new WeakMap,m.set(e,i)),void 0!==i.get(this.G)&&this.G.call(this.ht,void 0),i.set(this.G,t),void 0!==t&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){return"function"==typeof this.G?m.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}})},842:(t,e,i)=>{i.d(e,{mN:()=>x,AH:()=>l,W3:()=>w,Ec:()=>E});const s=globalThis,a=s.ShadowRoot&&(void 0===s.ShadyCSS||s.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,r=Symbol(),o=new WeakMap;class n{constructor(t,e,i){if(this._$cssResult$=!0,i!==r)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(a&&void 0===t){const i=void 0!==e&&1===e.length;i&&(t=o.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&o.set(e,t))}return t}toString(){return this.cssText}}const l=(t,...e)=>{const i=1===t.length?t[0]:e.reduce((e,i,s)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[s+1],t[0]);return new n(i,t,r)},c=(t,e)=>{if(a)t.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const i of e){const e=document.createElement("style"),a=s.litNonce;void 0!==a&&e.setAttribute("nonce",a),e.textContent=i.cssText,t.appendChild(e)}},d=a?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return(t=>new n("string"==typeof t?t:t+"",void 0,r))(e)})(t):t,{is:h,defineProperty:u,getOwnPropertyDescriptor:p,getOwnPropertyNames:f,getOwnPropertySymbols:m,getPrototypeOf:g}=Object,y=globalThis,v=y.trustedTypes,b=v?v.emptyScript:"",$=y.reactiveElementPolyfillSupport,C=(t,e)=>t,w={toAttribute(t,e){switch(e){case Boolean:t=t?b:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},E=(t,e)=>!h(t,e),A={attribute:!0,type:String,converter:w,reflect:!1,useDefault:!1,hasChanged:E};Symbol.metadata??=Symbol("metadata"),y.litPropertyMetadata??=new WeakMap;class x extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=A){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),s=this.getPropertyDescriptor(t,i,e);void 0!==s&&u(this.prototype,t,s)}}static getPropertyDescriptor(t,e,i){const{get:s,set:a}=p(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get:s,set(e){const r=s?.call(this);a?.call(this,e),this.requestUpdate(t,r,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??A}static _$Ei(){if(this.hasOwnProperty(C("elementProperties")))return;const t=g(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(C("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(C("properties"))){const t=this.properties,e=[...f(t),...m(t)];for(const i of e)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,i]of e)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const i=this._$Eu(t,e);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)e.unshift(d(t))}else void 0!==t&&e.push(d(t));return e}static _$Eu(t,e){const i=e.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return c(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$ET(t,e){const i=this.constructor.elementProperties.get(t),s=this.constructor._$Eu(t,i);if(void 0!==s&&!0===i.reflect){const a=(void 0!==i.converter?.toAttribute?i.converter:w).toAttribute(e,i.type);this._$Em=t,null==a?this.removeAttribute(s):this.setAttribute(s,a),this._$Em=null}}_$AK(t,e){const i=this.constructor,s=i._$Eh.get(t);if(void 0!==s&&this._$Em!==s){const t=i.getPropertyOptions(s),a="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:w;this._$Em=s;const r=a.fromAttribute(e,t.type);this[s]=r??this._$Ej?.get(s)??r,this._$Em=null}}requestUpdate(t,e,i){if(void 0!==t){const s=this.constructor,a=this[t];if(i??=s.getPropertyOptions(t),!((i.hasChanged??E)(a,e)||i.useDefault&&i.reflect&&a===this._$Ej?.get(t)&&!this.hasAttribute(s._$Eu(t,i))))return;this.C(t,e,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,e,{useDefault:i,reflect:s,wrapped:a},r){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,r??e??this[t]),!0!==a||void 0!==r)||(this._$AL.has(t)||(this.hasUpdated||i||(e=void 0),this._$AL.set(t,e)),!0===s&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,i]of t){const{wrapped:t}=i,s=this[e];!0!==t||this._$AL.has(e)||void 0===s||this.C(e,void 0,i,s)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach(t=>t.hostUpdate?.()),this.update(e)):this._$EM()}catch(e){throw t=!1,this._$EM(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(t=>this._$ET(t,this[t])),this._$EM()}updated(t){}firstUpdated(t){}}x.elementStyles=[],x.shadowRootOptions={mode:"open"},x[C("elementProperties")]=new Map,x[C("finalized")]=new Map,$?.({ReactiveElement:x}),(y.reactiveElementVersions??=[]).push("2.1.1")},843:t=>{t.exports=o},854:(t,e,i)=>{i.d(e,{a:()=>n,b:()=>d,c:()=>h,d:()=>r,g:()=>g,r:()=>l});var s=i(345),a=i(312);const r=(t,e,i)=>{let s=o(t,e,i);return s=l(i,s),s},o=(t,e,i)=>{const s=i.classificationMetadata.defaultValue,a=structuredClone(t)??{[e]:s};return a[e]??=s,a},n=(t,e)=>t&&Object.fromEntries(Object.entries(t).filter(([t])=>!1!==e.get(t)?.enabled)),l=(t,e)=>{const i=structuredClone(e);return Object.entries(t.attributes).forEach(([t,e])=>{if(i?.[t])return;const{uiElement:s,defaultValue:a}=e;switch(s){case"date":i&&(i[t]=c(e));break;case"multi-select":case"multi-grouped-select-nested":a&&i&&(i[t]=[a]);break;case"checkbox":a&&i&&(i[t]="true"===a);break;case"single-select":case"text":a&&i&&(i[t]=a)}}),i?.fgi||delete i?.fgiOptions,i},c=t=>{const e=new Date,{type:i,defaultDateTimeline:s,defaultDateTimelineUnits:a}=t;if("date"===i&&s&&a)switch(a.toLowerCase()){case"years":e.setFullYear(e.getFullYear()+s);break;case"months":e.setMonth(e.getMonth()+s);break;case"days":e.setDate(e.getDate()+s)}const r=(e.getMonth()+1).toString(),o=e.getDate().toString();return`${e.getFullYear()}-${1===r.length?`0${r}`:r}-${1===o.length?`0${o}`:o}`},d=(t,e,i)=>{const s=e?.createdUser,a=e?.createdDate;return e={[i]:t,...s?{createdUser:s}:{},...a?{createdDate:a}:{}}},h=async t=>{try{if(!t)return!1;t.loaded||await t.load();const e=t.portal.user??await(0,a.once)(()=>t?.portal.user);if(!e)return!1;const i=e.privileges.includes("portal:admin:updateItems");return u(t,e)||function(t,e){const i=t.owner,s="admin"===t.itemControl,a=["esri_livingatlas","esri_demographics","esri_boundaries"];return!(t.portal?.isPortal&&!u(t,e)&&s&&i?.includes("esri_")&&!a.includes(i))&&s}(t,e)||i||"shared"===t.access&&await p(t,e)}catch(t){return console.error(t),!1}};function u(t,e){return t.owner===e.username}const p=async(t,e)=>{const i=t.portal.restUrl,s=(await f(e,i)).result??[],a=(await m(t,i)).result??[];return s?.some(t=>a?.some(e=>t.id===e.id&&t.capabilities.includes("updateitemcontrol")))},f=async(t,e)=>{const i=`${e}/community/users/${t.username}`;try{return{result:(await(0,s.default)(i,{query:{f:"json"},responseType:"json"})).data?.groups??[]}}catch{return{error:{code:"unhandledError"}}}},m=async(t,e)=>{const i=`${e}/content/items/${t.id}/groups`;try{const t=await(0,s.default)(i,{query:{f:"json",method:"post"},responseType:"json"}),e=t.data?.admin??[],a=t.data?.member??[],r=t.data?.other??[];return{result:[...e,...a,...r]}}catch{return{error:{code:"unhandledError"}}}},g=(t,e)=>{const i=Date.now(),s=t?.portal.user?.username??"",{createdUser:a=s,createdDate:r=i}=e??{};return{createdUser:a,createdDate:r,lastEditedUser:s,lastEditedDate:i}}},895:(t,e,i)=>{i.d(e,{c:()=>o,g:()=>n,r:()=>r});i(649);var s=i(916),a=i(987);const r=(0,s.le)({defaultAssetPath:"https://js.arcgis.com/4.34/portal-components/",hydratedAttribute:"hydrated"}),{customElement:o,getAssetPath:n,setAssetPath:l}=r;r.t=a.trackAccess,r.o=a.createObservable,r.c=a.createTrackingTarget,r.r=a.runTracked},916:(t,e,i)=>{i.d(e,{WF:()=>T,lh:()=>s.c,G$:()=>h,le:()=>k,s6:()=>U,dN:()=>N,zl:()=>O});var s=i(333),a=i(842);a.W3,a.Ec;const r=t=>t.replace(o,(t,e)=>`${0===e?"":"-"}${t.toLowerCase()}`),o=/[A-Z]+(?![a-z])|[A-Z]/gu;crypto;var n=i(827);const l=t=>{let e=t;for(;e=e.parentNode??e.host;)if(e?.constructor?.lumina){const i=e;return i.manager?.loadedCalled||(i.J??i._offspring).push(t),(i.I??i._postLoad).promise}return!1};const c={};function d(){}const h=(t,e)=>function(i,s){if(!globalThis.customElements)return;const a=(s??i??{}).resourcesUrl;a&&t.setAssetPath(a);for(const[i,[s,a=""]]of Object.entries(e)){if(customElements.get(i))continue;const[e,r,o]=a.split(";"),n=e?e?.split(",").map(p):void 0,l=n?.map(([t])=>t),c=class extends m{static{this.observedAttributes=n?.map(([,t])=>t).filter(t=>""!==t)}static{this.C=l}static{this.E=r?r?.split(","):void 0}static{this.D=o?.split(",")}static{this.L=i}static{this.K=t}constructor(){!c.B&&(c.B=s(),c.F()),super()}};customElements.define(i,c)}},u=Object.defineProperty,p=t=>{const e=t.split(":");return 1===e.length?[e[0],r(e[0])]:e},f=globalThis.HTMLElement??d;class m extends f{constructor(){super(),this.#y={},this.#v=[],this.I=new n.c,this.H=new n.c,this.J=[];const t=this,e=t.constructor;t._offspring=t.J,t._postLoad=t.I,e.C?.forEach(e=>{Object.hasOwn(t,e)&&(t.#y[e]=t[e],delete t[e])}),e.A?t.#b({a:e.A}):e.B.then(async i=>{await e.K.p,t.#b(await(i.default?.then(t=>"function"==typeof t?{a:t}:t)??i))}).catch(e=>{t.H.reject(e),setTimeout(()=>{throw e})})}static{this.lumina=!0}static F(){for(const t of this.C??[])u(this.prototype,t,{configurable:!0,enumerable:!0,get(){return this.#y[t]},set(e){this.#y[t]=e}});for(const t of this.E??[])u(this.prototype,t,{async value(...e){this.#$||await this.H.promise;const i=this.#$;return await i[t](...e)},configurable:!0});for(const t of this.D??[])u(this.prototype,t,{value(...e){return this.#$[t](...e)},configurable:!0})}#$;#y;#v;get manager(){return this.#$?.manager}attributeChangedCallback(t,e,i){this.#$?.attributeChangedCallback(t,e,i),this.#$||this.#v.push(t)}connectedCallback(){this.#$?this.#$.connectedCallback?.():queueMicrotask(()=>this.G=l(this))}disconnectedCallback(){this.#$?.disconnectedCallback?.()}async componentOnReady(){return await this.H.promise,this}#b(t){const e=this.constructor,i=e.L,s=this.#y,a=Object.values(t).find(t=>t.L===i);const r=`${i}--lazy`;let o=a;for(;o&&!Object.hasOwn(o,"lumina");)o=Object.getPrototypeOf(o);y(o);!e.A&&(e.A=a,customElements.define(r,a)),a.N=this;const n=document.createElement(r);a.N=void 0,this.#$=n,this.#y=n,this.#v.forEach(t=>n.attributeChangedCallback(t,null,this.getAttribute(t))),Object.entries(s).forEach(g,n);const l=this.isConnected;(l||this.G)&&(n.connectedCallback?.(),l||n.disconnectedCallback())}addController(){}requestUpdate(){this.#$?.requestUpdate()}}function g([t,e]){this[t]=e}const y=t=>{const e=t.prototype,i=Element.prototype;Object.hasOwn(e,"isConnected")||(e.setAttribute=function(t,e){i.setAttribute.call(this.el,t,e)},e.removeAttribute=function(t){i.removeAttribute.call(this.el,t)},u(e,"isConnected",{get(){return Reflect.get(i,"isConnected",this.el)}}))};var v=i(592),b=i(337),$=i(667),C=i(752),w=i(804);(0,w.u$)(class extends w.WL{constructor(t){if(super(t),t.type!==w.OA.ATTRIBUTE||"class"!==t.name||t.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(e=>t[e]).join(" ")+" "}update(t,[e]){if(void 0===this.st){this.st=new Set,void 0!==t.strings&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter(t=>""!==t)));for(const t in e)e[t]&&!this.nt?.has(t)&&this.st.add(t);return this.render(e)}const i=t.element.classList;for(const t of this.st)t in e||(i.remove(t),this.st.delete(t));for(const t in e){const s=!!e[t];s===this.st.has(t)||this.nt?.has(t)||(s?(i.add(t),this.st.add(t)):(i.remove(t),this.st.delete(t)))}return C.c0}});const E="important",A=" !"+E,x=(0,w.u$)(class extends w.WL{constructor(t){if(super(t),t.type!==w.OA.ATTRIBUTE||"style"!==t.name||t.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,i)=>{const s=t[i];return null==s?e:e+`${i=i.includes("-")?i:i.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${s};`},"")}update(t,[e]){const{style:i}=t.element;if(void 0===this.ft)return this.ft=new Set(Object.keys(e)),this.render(e);for(const t of this.ft)null==e[t]&&(this.ft.delete(t),t.includes("-")?i.removeProperty(t):i[t]=null);for(const t in e){const s=e[t];if(null!=s){this.ft.add(t);const e="string"==typeof s&&s.endsWith(A);t.includes("-")||e?i.setProperty(t,e?s.slice(0,-11):s,e?E:""):i[t]=s}}return C.c0}});var _=i(504);(0,w.u$)(class extends w.WL{constructor(t){if(super(t),t.type!==w.OA.PROPERTY&&t.type!==w.OA.ATTRIBUTE&&t.type!==w.OA.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!(0,_.Rt)(t))throw Error("`live` bindings can only contain a single expression")}render(t){return t}update(t,[e]){if(e===C.c0||e===C.s6)return e;const i=t.element,s=t.name;if(t.type===w.OA.PROPERTY){if(e===i[s])return C.c0}else if(t.type===w.OA.BOOLEAN_ATTRIBUTE){if(!!e===i.hasAttribute(s))return C.c0}else if(t.type===w.OA.ATTRIBUTE&&i.getAttribute(s)===e+"")return C.c0;return(0,_.mY)(t),e}});var I=i(832);class S extends s.G{constructor(t){super(t),this.destroyed=!1,this.R=!1,this.V=b.s6,this.T=[],this.#C=new WeakMap,this.#h=t,this.exports=void 0,this.hasDestroy=P in t&&"function"==typeof t.destroy,b.WF.prototype.addController.call(t,{hostConnected:()=>{if(this.destroyed){const e=t.el.localName;throw t.el.remove(),new Error(`The ${e} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${P} prop.`)}void 0!==this.#w&&clearTimeout(this.#w),(0,s.p)();for(const e of t.M)"triggerConnected"in e?e.triggerConnected():(0,v.UF)(e.hostConnected,e)},hostDisconnected:()=>{for(const e of t.M)"triggerDisconnected"in e?e.triggerDisconnected():(0,v.UF)(e.hostDisconnected,e);this.hasDestroy&&!this.destroyed&&this.U()},hostUpdate:()=>{for(const e of t.M)"triggerUpdate"in e?e.triggerUpdate(this.Q):(0,v.UF)(e.hostUpdate,e,this.Q)},hostUpdated:()=>{for(const e of t.M)"triggerUpdated"in e?e.triggerUpdated(this.Q):(0,v.UF)(e.hostUpdated,e,this.Q);this.Q=void 0}}),queueMicrotask(()=>this.R=!0),(0,$.s)(t)}#w;#h;async destroy(){if(!this.destroyed){this.#h.el.isConnected&&(this.hasDestroy=!1,this.#h.el.remove()),this.#w=void 0,this.destroyed=!0;for(const t of this.#h.M)"triggerDestroy"in t?t.triggerDestroy():(0,v.UF)(t.hostDestroy,t);this.#h.M.splice(0)}}U(){if(void 0!==this.#w&&clearTimeout(this.#w),!this.#h.el.isConnected&&!this.#h.autoDestroyDisabled){const t=()=>{this.#h.destroy()};this.#w=(0,n.o)(t,F)}}S(t,e){const i=this.T;this.V=b.s6,this.T=[],i.forEach(i=>i(t,e))}#C;W(t,e){("object"==typeof e&&null!==e||"function"==typeof e)&&this.#C.set(e,t)}X(t){return"object"==typeof t&&null!==t||"function"==typeof t?this.#C.get(t):void 0}}let F=1e3;const P="autoDestroyDisabled";class T extends b.WF{constructor(){super(),this.M=[],this.manager=new S(this);const t=this,e=t.constructor,i=e.N,s=e.K.o,a=T.prototype.shouldUpdate;t.#E=i?.H??new n.c,t.I=i?.I??new n.c,t.J=i?.J??[],t._offspring=t.J,t._postLoad=t.I,t.el=i??t,t.#A=t.enableUpdating,t.enableUpdating=d,t.shouldUpdate!==a&&(t.#x=t.shouldUpdate,t.shouldUpdate=a),s&&(t.#_=new Map,e.elementProperties.forEach((e,i)=>t.#_.set(i,s()))),b.S$&&t.el.setAttribute(e.K.hydratedAttribute,"")}static finalizeStyles(t){const e=super.finalizeStyles(t),i=this.shadowRootOptions===c;return void 0===this.K?.commonStyles||i?e:[this.K.commonStyles,...e]}static createProperty(t,e){const i="number"==typeof e?e:Array.isArray(e)?e[0]:0,s=Array.isArray(e)?e[1]:void 0,a=s?.hasChanged??b.Ec,o={attribute:!!(1&i&&"string"==typeof t)&&r(t),reflect:!!(2&i),type:4&i?Boolean:8&i?Number:void 0,state:!!(16&i),readOnly:!!(32&i),noAccessor:!!(64&i),c:!1,...s,hasChanged(t,e){const i=a(t,e);return o.c=i,i}};super.createProperty(t,o)}static getPropertyDescriptor(t,e,i){const a=this.K,r=super.getPropertyDescriptor(t,e,i);return i.d=r,{...r,get(){return a.t?.(this.#_.get(t)),r.get?.call(this)},set(e){const a=this.manager;if(i.readOnly&&!$.a&&(a.R||a.connectedCalled))throw Error(`Cannot assign to read-only property "${t}" of ${this.el.localName}. Trying to assign "${e}"`);r.set.call(this,e??void 0),i.c&&this.#_?.get(t)?.notify(),a.T.length>0&&((0,s.p)(),a?.S(t,e))}}}static{this.lumina=!0}#_;#x;#A;#E;#I;connectedCallback(){if(this.el.hasAttribute("defer-hydration"))return;const t=this.constructor.K.c?.(()=>this.requestUpdate());this.#I=t;const e=!this.manager.connectedCalled;super.connectedCallback(),e?queueMicrotask(()=>this.#S().catch(t=>{this.#E.reject(t),setTimeout(()=>{throw t})})):t&&this.requestUpdate()}#F(t){try{this.#I.clear(),this.constructor.K.r(this.#I,()=>super.update(t))}catch(t){throw this.#I.clear(),t}}disconnectedCallback(){super.disconnectedCallback(),this.#I?.destroy(),this.#I=void 0}createRenderRoot(){const t=this.el.shadowRoot,e=this.constructor,i=e.shadowRootOptions,s=t??(i===c?this.el:this.el.attachShadow(i));if(this.isConnected){const t=s.getRootNode();0,t.adoptedStyleSheets=[...t.adoptedStyleSheets,...e.elementStyles.map(t=>"styleSheet"in t?t.styleSheet:t)]}return s}async#S(){const t=this.el.G??l(this.el);t&&await t;const e=[];for(const t of this.M)"triggerLoad"in t?e.push(t.triggerLoad()):e.push((0,v.ao)(t.hostLoad,t));await Promise.all(e),await(this.load?.()),this.manager.hasDestroy&&this.manager.onUpdate(t=>t.has(P)&&this.manager.U()),this.#A(!0),this.performUpdate(),this.I.resolve(),await Promise.resolve();const i=this.J.filter(t=>!t.manager?.loadedCalled);i.length&&await Promise.allSettled(i.map(async t=>await t.componentOnReady())),this.J.length=0,this.el.setAttribute(this.constructor.K.hydratedAttribute,"");for(const t of this.M)"triggerLoaded"in t?t.triggerLoaded():(0,v.UF)(t.hostLoaded,t);this.loaded?.(),this.#E.resolve()}shouldUpdate(t){return this.manager.Q=t,this.#x?.(t)??!0}update(t){this.#I?this.#F(t):super.update(t)}listen(t,e,i){const s=e?.bind(this)??e;this.manager.onLifecycle(()=>(this.el.addEventListener(t,s,i),()=>this.el.removeEventListener(t,s,i)))}listenOn(t,e,i,s){const a=i?.bind(this)??i;this.manager.onLifecycle(()=>(t.addEventListener(e,a,s),()=>t.removeEventListener(e,a,s)))}async componentOnReady(){return await this.#E.promise,this}addController(t){this.M.push(t),!($.c in t)&&this.renderRoot&&this.el.isConnected&&t.hostConnected?.()}removeController(t){this.M.splice(this.M.indexOf(t),1),t.controllerRemoved?.()}}const k=t=>{let e;const i=t=>{e=new URL(t,globalThis.location?.href||void 0).href},s={...t,getAssetPath(t){const i=new URL(t,e);return i.origin!==globalThis.location?.origin?i.href:i.pathname},setAssetPath:i,customElement(t,e){e.K=s,e.L=t,customElements.get(t)||customElements.define(t,e)}};return i(t.defaultAssetPath),s},O=t=>"object"==typeof t&&null!=t?x(t):t;class D extends w.WL{#P;#T;constructor(t){super(t);const e=this;this.#T=function(t){return e.#P.call(this,t)}}render(t){return"function"==typeof t?(this.#P=t,(0,I.K)(this.#T)):(0,I.K)(t)}}(0,w.u$)(D);const U=b.s6;const N=t=>{const e=document.createElement("div");return(0,b.XX)(t,e),e.firstElementChild}},929:(t,e,i)=>{i.r(e),i.d(e,{ArcgisPortalClassificationBanner:()=>c});var s=i(895),a=i(916),r=i(423),o=i(733),n=i(337);const l=n.AH`.banner{box-sizing:border-box;width:100%;left:0;text-align:center;font-family:var(--calcite-font-family);background-color:#fff;color:#000;padding:var(--calcite-spacing-sm);font-size:var(--calcite-font-size);text-transform:uppercase;overflow-wrap:break-word}.invalid-container{background-color:#fff;color:#000;display:flex;align-items:center;justify-content:center;gap:8px}.invalid-icon{--calcite-icon-color: var(--calcite-color-status-danger)}.invalid-message{text-align:center;font-family:var(--calcite-font-family);background-color:#fff;color:#000;padding:var(--calcite-spacing-sm);font-size:var(--calcite-font-size);overflow-wrap:break-word}`;class c extends a.WF{constructor(){super(...arguments),this.classificationModel=(0,r.u)(this),this.messages=(0,o.u)(),this._classificationDataTask=(0,r.c)(this),this.portalClassificationSchema=this.classificationModel.portalClassificationSchema,this.status=this.classificationModel.status,this.missingExistingClassification=!1,this.variant="full",this.autoDestroyDisabled=!1,this.validationErrors=""}static{this.properties={portalClassificationSchema:16,status:16,itemClassification:16,portalItem:0,missingExistingClassification:5,variant:1,autoDestroyDisabled:5,validationErrors:1}}static{this.styles=l}async destroy(){await this.manager.destroy()}willUpdate(t){if(t.has("portalItem")){const{portalItem:t}=this;t?.load().then(()=>{t?.id&&t?.loaded&&t?.classification&&!this.missingExistingClassification?this.classificationModel.validateClassification("preview"===this.variant?null:t.id,t.classification,t?.portal.restUrl).catch(console.error).then(t=>{this.validationErrors=t??""}):this.validationErrors=""}).catch(console.error)}}getStyle(){const t={};if("preview"===this.variant&&(t.fontSize="var(--calcite-font-size-sm)",t.padding="var(--calcite-spacing-xs)"),this.itemClassification&&this.portalClassificationSchema){const e=this.itemClassification.classification,i=this.portalClassificationSchema.classificationMetadata.classificationValueProperties.find(({value:t})=>t===e);i?.backgroundColor&&(t.backgroundColor=i.backgroundColor),i?.textColor&&(t.color=i.textColor)}return t}render(){return this._classificationDataTask.render({pending:void 0,error:void 0,complete:()=>this.portalClassificationSchema&&"anonymous"!==this.portalItem?.portal.authMode?this.validationErrors&&"full"===this.variant?n.qy`<div class="invalid-container"><calcite-icon class="invalid-icon" scale=s icon=exclamation-mark-triangle .textLabel=${this.messages.invalidclassificationerror}></calcite-icon><span class="invalid-message">${this.messages.invalidclassificationerror}</span></div>`:n.qy`<div class="banner" style=${(0,a.zl)(this.getStyle())}>${this.itemClassification?.banner??this.messages.notyetclassified??"Not yet classified"}</div>`:""})}}(0,s.c)("arcgis-portal-classification-banner",c)},987:t=>{t.exports=i},989:t=>{t.exports=p}},e={};function b(i){var s=e[i];if(void 0!==s)return s.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,b),a.exports}b.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return b.d(e,{a:e}),e},b.d=(t,e)=>{for(var i in e)b.o(e,i)&&!b.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},b.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),b.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var $=b(895);const C=(0,b(916).G$)($.r,{"arcgis-portal-classification-banner":[()=>Promise.resolve().then(b.bind(b,929)),"autoDestroyDisabled,missingExistingClassification,portalItem:,validationErrors,variant;destroy"],"arcgis-portal-classification-config":[()=>Promise.resolve().then(b.bind(b,789)),"autoDestroyDisabled,portalItem:,status,valid,values;destroy,resetForm,validateForm"],"arcgis-portal-classification-favorite":[()=>Promise.resolve().then(b.bind(b,759)),"attributeExpressionResults:,classificationValue:,favoriteClassifications:,portalItem:,resetFavoriteClassification:,selectedFavoriteClassificationName,updateClassificationData:"],"arcgis-portal-classification-form-element":[()=>Promise.resolve().then(b.bind(b,220)),"attribute:,attributeKey,renderingInfo:,value:"],"arcgis-portal-field-delete":[()=>Promise.resolve().then(b.bind(b,448)),"config:,fieldNames:,layer:,mapView:,options:"]});var w=b(244);b(37);return C(window,{resourcesUrl:`${w.urlUtils.getFixedRootPath()}arcgis-portal-components-esm/assets`}),{}})())}}});