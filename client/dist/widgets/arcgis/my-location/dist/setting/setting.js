System.register(["jimu-core/emotion","jimu-core","jimu-for-builder","jimu-ui","jimu-ui/advanced/setting-components","esri/Graphic","jimu-arcgis","jimu-theme","jimu-ui/basic/color-picker","jimu-layouts/layout-runtime","jimu-ui/advanced/data-source-selector","jimu-ui/basic/list-tree"],function(e,t){var i={},a={},s={},o={},n={},l={},r={},c={},d={},p={},m={},g={};return{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.EsriFieldType=e.EsriFieldType,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.LayoutItemType=e.LayoutItemType,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.dateUtils=e.dateUtils,a.polished=e.polished},function(e){s.getAppConfigAction=e.getAppConfigAction},function(e){o.Button=e.Button,o.Icon=e.Icon,o.Label=e.Label,o.NumericInput=e.NumericInput,o.Select=e.Select,o.Switch=e.Switch,o.defaultMessages=e.defaultMessages},function(e){n.MapWidgetSelector=e.MapWidgetSelector,n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection},function(){},function(){},function(e){c.styled=e.styled},function(e){d.ColorPicker=e.ColorPicker},function(e){p.LayoutItemSizeModes=e.LayoutItemSizeModes,p.searchUtils=e.searchUtils},function(e){m.FieldSelector=e.FieldSelector,m.dataComponentsUtils=e.dataComponentsUtils},function(e){g.List=e.List,g.TreeItemActionType=e.TreeItemActionType}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=c},4108:e=>{"use strict";e.exports=s},13089:e=>{"use strict";e.exports=m},14321:e=>{"use strict";e.exports=o},22089:e=>{"use strict";e.exports=l},27132:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA4IiBoZWlnaHQ9IjcyIiB2aWV3Qm94PSIwIDAgMTA4IDcyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkyIiBoZWlnaHQ9IjU2IiBmaWxsPSIjMjgyODI4Ii8+DQo8cmVjdCB4PSIxMyIgeT0iNDAiIHdpZHRoPSI1MyIgaGVpZ2h0PSI2IiBmaWxsPSIjNkE2QTZBIi8+DQo8cmVjdCB4PSIxMyIgeT0iMzIiIHdpZHRoPSI4MSIgaGVpZ2h0PSIxIiBmaWxsPSIjNDQ0NDQ0Ii8+DQo8cmVjdCB4PSIxMyIgeT0iNTIiIHdpZHRoPSI4MSIgaGVpZ2h0PSI2IiBmaWxsPSIjNkE2QTZBIi8+DQo8cmVjdCB4PSIxMyIgeT0iMTQiIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgcng9IjIiIGZpbGw9IiM2QTZBNkEiLz4NCjxyZWN0IHg9IjI5IiB5PSIxNCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiByeD0iMiIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iNDUiIHk9IjE0IiB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHJ4PSIyIiBmaWxsPSIjNkE2QTZBIi8+DQo8cmVjdCB4PSI2MSIgeT0iMTQiIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgcng9IjIiIGZpbGw9IiM2QTZBNkEiLz4NCjxyZWN0IHg9Ijc3IiB5PSIxNCIgd2lkdGg9IjEiIGhlaWdodD0iMTIiIGZpbGw9IiM0NDQ0NDQiLz4NCjxyZWN0IHg9IjgyIiB5PSIxNCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiByeD0iMiIgZmlsbD0iIzZBNkE2QSIvPg0KPC9zdmc+DQo="},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},41496:e=>{"use strict";e.exports=p},54337:e=>{"use strict";e.exports=d},55677:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA4IiBoZWlnaHQ9IjcyIiB2aWV3Qm94PSIwIDAgMTA4IDcyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iMjYiIHdpZHRoPSI5MiIgaGVpZ2h0PSIyMCIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMTQiIHk9IjMwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHJ4PSIyIiBmaWxsPSIjNkE2QTZBIi8+DQo8cmVjdCB4PSIzMCIgeT0iMzAiIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgcng9IjIiIGZpbGw9IiM2QTZBNkEiLz4NCjxyZWN0IHg9IjQ2IiB5PSIzMCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiByeD0iMiIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iNjIiIHk9IjMwIiB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHJ4PSIyIiBmaWxsPSIjNkE2QTZBIi8+DQo8cmVjdCB4PSI3OCIgeT0iMzAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEyIiBmaWxsPSIjNDQ0NDQ0Ii8+DQo8cmVjdCB4PSI4MyIgeT0iMzAiIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgcng9IjIiIGZpbGw9IiM2QTZBNkEiLz4NCjwvc3ZnPg0K"},62686:e=>{"use strict";e.exports=r},67386:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=a},79298:e=>{"use strict";e.exports=n},98640:e=>{"use strict";e.exports=g}},t={};function u(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,u),s.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var i in t)u.o(t,i)&&!u.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var h={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(h),u.d(h,{__set_webpack_public_path__:()=>Oe,default:()=>Pe});var e,t,i,a,s,o=u(67386),n=u(79244),l=u(4108),r=u(14321),c=u(79298);!function(e){e.Panel="PANEL",e.Toolbar="TOOLBAR"}(e||(e={})),function(e){e.Distance="DISTANCE",e.Time="TIME"}(t||(t={})),function(e){e.ft="FT",e.m="M"}(i||(i={})),function(e){e.sec="S"}(a||(a={})),function(e){e.DD="DD",e.DMS="DMS"}(s||(s={}));const d=!1,p=e.Panel,m=!0,g=!0,I={TYPE:t.Distance,UNIT:i.ft,INTERVAL:15};var f;!function(e){e[e.location_timestamp=0]="location_timestamp",e[e.Longitude=1]="Longitude",e[e.Latitude=2]="Latitude",e[e.altitude=3]="altitude",e[e.Orientation=4]="Orientation",e[e.speed=5]="speed",e[e.Accuracy=6]="Accuracy"}(f||(f={}));const y=["OBJECTID","location_timestamp","altitude","Orientation","speed","Accuracy","Latitude","Longitude"],S=["OBJECTID","location_timestamp","altitude","Orientation","speed","Accuracy","Latitude","Longitude","LineID"];u(22089),u(62686);const j="Timestamp",b="Longitude",T="Latitude",M="Altitude",x="Orientation",v="Speed",N="Accuracy",D="Start Time",w="End Time",C="Average Altitude",L="Average Speed",A="Average Accuracy";var P;!function(e){e.CREATE="CREATE",e.ADD="ADD",e.DELETE="DELETE",e.UPDATE="UPDATE",e.CLEAR="CLEAR",e.REFRESH="REFRESH"}(P||(P={}));const O={jimuName:"OBJECTID",name:"OBJECTID",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.OID,alias:"ObjectID"},k={jimuName:"location_timestamp",name:"location_timestamp",type:n.JimuFieldType.Date,esriType:n.EsriFieldType.Date,alias:"Time",format:{dateFormat:n.dateUtils.DATE_TIME_DEFAULT_ESRI_FORMAT}},E={jimuName:"Longitude",name:"Longitude",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"Longitude"},R={jimuName:"Latitude",name:"Latitude",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"Latitude"},B={jimuName:"altitude",name:"altitude",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"Altitude"},F={jimuName:"Orientation",name:"Orientation",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"Orientation"},H={jimuName:"speed",name:"speed",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"Speed"},W={jimuName:"Accuracy",name:"Accuracy",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"Accuracy"},Z={jimuName:"LineID",name:"LineID",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Integer,alias:"LineID"},_={jimuName:"StartTime",name:"StartTime",type:n.JimuFieldType.Date,esriType:n.EsriFieldType.Date,alias:"StartTime",format:{dateFormat:n.dateUtils.DATE_TIME_DEFAULT_ESRI_FORMAT}},Q={jimuName:"EndTime",name:"EndTime",type:n.JimuFieldType.Date,esriType:n.EsriFieldType.Date,alias:"EndTime",format:{dateFormat:n.dateUtils.DATE_TIME_DEFAULT_ESRI_FORMAT}},z={jimuName:"AverageAltitude",name:"AverageAltitude",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"AverageAltitude"},G={jimuName:"AverageSpeed",name:"averageSpeed",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"AverageSpeed"},J={jimuName:"AverageAccuracy",name:"AverageAccuracy",type:n.JimuFieldType.Number,esriType:n.EsriFieldType.Double,alias:"AverageAccuracy"},V=(e,t="",i="")=>{const a=((e,t)=>{let i;return k.alias=t.formatMessage({id:"trackTime",defaultMessage:j}),E.alias=t.formatMessage({id:"trackLongitude",defaultMessage:b}),R.alias=t.formatMessage({id:"trackLatitude",defaultMessage:T}),B.alias=t.formatMessage({id:"trackAltitude",defaultMessage:M}),F.alias=t.formatMessage({id:"trackOrientation",defaultMessage:x}),H.alias=t.formatMessage({id:"trackSpeed",defaultMessage:v}),W.alias=t.formatMessage({id:"trackAccuracy",defaultMessage:N}),_.alias=t.formatMessage({id:"trackStartTime",defaultMessage:D}),Q.alias=t.formatMessage({id:"trackEndTime",defaultMessage:w}),z.alias=t.formatMessage({id:"averageAltitude",defaultMessage:C}),G.alias=t.formatMessage({id:"averageSpeed",defaultMessage:L}),J.alias=t.formatMessage({id:"averageAccuracy",defaultMessage:A}),"track"===e?i={[O.jimuName]:O,[k.jimuName]:k,[E.jimuName]:E,[R.jimuName]:R,[B.jimuName]:B,[F.jimuName]:F,[H.jimuName]:H,[W.jimuName]:W}:"trackline_point"===e?i={[O.jimuName]:O,[Z.jimuName]:Z,[k.jimuName]:k,[E.jimuName]:E,[R.jimuName]:R,[B.jimuName]:B,[F.jimuName]:F,[H.jimuName]:H,[W.jimuName]:W}:"trackline"===e&&(i={[O.jimuName]:O,[_.jimuName]:_,[Q.jimuName]:Q,[z.jimuName]:z,[G.jimuName]:G,[J.jimuName]:J}),i})(i,e);return{label:t,idField:O.jimuName,fields:a}},U=(e,t,i,a,s)=>{const o=V(e,i,a),l=t+"__layer";return{id:t,type:n.DataSourceTypes.FeatureLayer,label:i,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:o,geometryType:s,layerId:l}};var $=u(1888),K=u(54337),Y=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const q=$.styled.div`
  position: relative;
  .mask {
    position: absolute;
    width: 100%;
    height: 100%;
  }
`,X=n.React.forwardRef((e,t)=>{const{disabled:i}=e,a=Y(e,["disabled"]);return(0,o.jsxs)(q,{ref:t,children:[i&&(0,o.jsx)("div",{className:"mask"}),(0,o.jsx)(K.ColorPicker,Object.assign({},a))]})}),ee="Arrangement",te="Panel",ie="Bar",ae="General settings",se="Highlight location",oe="Symbol color",ne="Show compass orientation",le="Show location accuracy",re="Timeout (second)",ce="Select fields",de="Default activation",pe="Watch location",me="Streaming",ge="Manual path tracing",ue="Locations",he="Paths",Ie="Time",fe="Distance",ye="ft",Se="m",je="sec",be="Zoom to location",Te=n.React.memo(e=>{const t=e.intl.formatMessage({id:"symbolColorTips",defaultMessage:oe}),i=e.intl.formatMessage({id:"compassOrientationTips",defaultMessage:ne}),a=e.intl.formatMessage({id:"locationAccuracyTips",defaultMessage:le}),{symbolColor:s,showCompassOrientation:l,showLocationAccuracy:d}=e.highlightInfo;return(0,o.jsx)(n.React.Fragment,{children:(0,o.jsxs)("div",{className:"highlight-info-section",role:"group",children:[(0,o.jsx)(c.SettingRow,{label:t,className:"bold-font-label",children:(0,o.jsx)(X,{className:"",color:s,"aria-label":t,onChange:t=>{e.onHighlightInfoChange(Object.assign(Object.assign({},e.highlightInfo),{symbolColor:t}))}})}),(0,o.jsx)(c.SettingRow,{tag:"label",label:i,className:"bold-font-label",children:(0,o.jsx)(r.Switch,{checked:l,onChange:()=>{e.onHighlightInfoChange(Object.assign(Object.assign({},e.highlightInfo),{showCompassOrientation:!l}))}})}),(0,o.jsx)(c.SettingRow,{tag:"label",label:a,className:"bold-font-label",children:(0,o.jsx)(r.Switch,{checked:d,onChange:t=>{e.onHighlightInfoChange(Object.assign(Object.assign({},e.highlightInfo),{showLocationAccuracy:!d}))}})})]})})}),Me=n.React.memo(e=>{const s=e.intl.formatMessage({id:"streamingTips",defaultMessage:me}),l=e.intl.formatMessage({id:"manualPathTracingTips",defaultMessage:ge}),{manualPathTracing:d,streaming:p}=e.watchLocationSettings,m=s=>s===t.Distance?e.intl.formatMessage({id:"streamingDistance",defaultMessage:fe}):s===t.Time?e.intl.formatMessage({id:"streamingTime",defaultMessage:Ie}):s===i.ft?e.intl.formatMessage({id:"distanceFeet",defaultMessage:ye}):s===i.m?e.intl.formatMessage({id:"distanceMeters",defaultMessage:Se}):s===a.sec?e.intl.formatMessage({id:"timeSec",defaultMessage:je}):void 0;return(0,o.jsx)(n.React.Fragment,{children:(0,o.jsxs)("div",{className:"highlight-info-section",role:"group",children:[(0,o.jsx)(c.SettingRow,{label:s,className:"bold-font-label"}),(0,o.jsxs)(c.SettingRow,{className:"streaming-section",children:[(0,o.jsx)(r.Select,{size:"sm",className:"streaming-type-select",defaultValue:p.type===t.Distance?t.Distance:t.Time,value:p.type,onChange:(s,o)=>{const n=o===t.Distance?i.ft:a.sec,l=o===t.Distance?15:5;e.onTrackLocationSettingsChange(Object.assign(Object.assign({},e.watchLocationSettings),{streaming:Object.assign(Object.assign({},e.watchLocationSettings.streaming),{type:o,interval:l,unit:n})}))},"aria-label":s,children:Object.keys(t).map(e=>(0,o.jsx)("option",{value:t[e],children:m(t[e])},e))}),(0,o.jsx)(r.NumericInput,{className:"streaming-input",showHandlers:!1,min:0,defaultValue:p.type===t.Distance?15:5,value:p.interval,onAcceptValue:i=>{null===i&&(i=p.type===t.Distance?15:5),e.onTrackLocationSettingsChange(Object.assign(Object.assign({},e.watchLocationSettings),{streaming:Object.assign(Object.assign({},e.watchLocationSettings.streaming),{interval:i})}))},"aria-label":s}),(0,o.jsx)(r.Select,{size:"sm",className:"streaming-unit-select",value:p.unit,onChange:(t,i)=>{e.onTrackLocationSettingsChange(Object.assign(Object.assign({},e.watchLocationSettings),{streaming:Object.assign(Object.assign({},e.watchLocationSettings.streaming),{unit:i})}))},"aria-label":s,children:p.type===t.Distance?Object.keys(i).map(e=>(0,o.jsx)("option",{value:i[e],children:m(i[e])},e)):Object.keys(a).map(e=>(0,o.jsx)("option",{value:a[e],children:m(a[e])},e))})]}),(0,o.jsx)(c.SettingRow,{tag:"label",label:l,className:"bold-font-label",children:(0,o.jsx)(r.Switch,{checked:d,onChange:t=>{e.onTrackLocationSettingsChange(Object.assign(Object.assign({},e.watchLocationSettings),{manualPathTracing:!d}))}})})]})})});function xe(e,t){const i=e.ref.palette.neutral[300],a=e.ref.palette.neutral[1e3];return n.css`
      font-size: 13px;
      font-weight: lighter;

      .jimu-widget-setting--section {
        padding: 18px 16px;
      }

      .ui-mode-setting {
        display: flex;
      }

      /* ui-mode */
      .ui-mode-card-chooser{
        display: flex;
        align-items: start;

        .ui-mode-card-wapper {
          width: calc((100% - ${10}px - ${8}px) / 2);
        }

        .ui-mode-card-separator {
          width: ${10}px
        }
        .ui-mode-card {
          flex: 1;
          width: 100%;
          background: ${i};
          border: ${2}px solid ${i};
          margin: 0 0 0.5rem 0;

          .jimu-icon {
            margin: 0
          }
        }
        .ui-mode-card.active {
          border: ${2}px solid #00D8ED;
          background-color: ${i} !important;
        }
        .ui-mode-label {
          overflow: hidden;
          text-align: center;
        }
      }

      .placeholder-container{
        height: calc(100% - 180px);

        .placeholder{
          flex-direction: column;

          .icon{
            color: var(--ref-palette-neutral-800);
          }
          .hint{
            font-size: ${t.rem(14)};
            font-weight: ${e.ref.typeface.fontWeightBold}!important;
            color: var(--ref-palette-neutral-1000);
            max-width: ${t.rem(160)};
          }
        }

      }
      /* labels */

      .setting-label{
        font-weight: ${e.ref.typeface.fontWeightRegular};
        color:${e.ref.palette.neutral[1100]};
        letter-spacing: 4px;
      }

      /* zoom scale */
      .zoom-scale-input{
        max-width:40%;
        height: 26px!important;
        .jimu-numeric-input-input{
          height: 26px!important;
          line-height: 26px!important;
        }
      }
      .highlight-info-section{
        margin-top: 16px;
        margin-bottom: 16px;
        .bold-font-label{
          font-weight:${e.ref.typeface.fontWeightMedium}!important ;
          color: ${a} !important;
        }
        .streaming-section{
          display: flex;
          justify-content: space-between;
          align-items: center;
          .streaming-input{
            height: 26px!important;
            margin:0 0.5rem;
            .jimu-numeric-input-input{
              height: 26px!important;
              line-height: 26px!important;
            }
          }
          .streaming-type-select{
            width: 6rem;
          }
          .streaming-unit-select{
            width: 4rem;
          }
        }
      }
      .selected-fields-con{
            margin-top: 0;
            .selected-fields-list {
              flex: 1;
              max-height: 265px;
              overflow-y: auto;
            }
            .jimu-tree-item{
              background: ${e.ref.palette.neutral[300]};
              border-bottom: 1px solid ${e.ref.palette.neutral[400]};
              .jimu-tree-item__content{
                div:first-of-type{
                  padding-left: 2px;
                }
                .jimu-tree-item__body{
                  background: ${e.ref.palette.neutral[300]};
                }
              }
            }
      }
  `}var ve=u(31027),Ne=u.n(ve),De=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const we=e=>{const t=window.SVG,{className:i}=e,a=De(e,["className"]),s=(0,n.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:s,src:Ne()},a)):(0,o.jsx)("svg",Object.assign({className:s},a))};var Ce=u(41496),Le=u(13089),Ae=u(98640);class Pe extends n.React.PureComponent{constructor(t){var i;super(t),this.trackPointOutId=this.props.id+"_output_track",this.trackLinePointOutId=this.props.id+"_output_trackline_point",this.trackLinePointLabel=this.props.intl.formatMessage({id:"trackDsLabel",defaultMessage:ue}),this.trackPointOutLabel=this.props.intl.formatMessage({id:"trackDsLabel",defaultMessage:ue}),this.crateDataSources=e=>{if(e){const e=this.props.id+"_output_trackline",t=this.props.intl.formatMessage({id:"trackLineDsLabel",defaultMessage:he}),i=U(this.props.intl,this.trackLinePointOutId,this.trackLinePointLabel,"trackline_point","esriGeometryPoint"),a=U(this.props.intl,e,t,"trackline","esriGeometryPolyline");this.props.onSettingChange({id:this.props.id,useDataSources:[]},[i,a])}else{const e=U(this.props.intl,this.trackPointOutId,this.trackPointOutLabel,"track","esriGeometryPoint");this.props.onSettingChange({id:this.props.id,useDataSources:[]},[e])}},this.handleMapWidgetChange=e=>{var t;const i=!!(null==e?void 0:e[0]);this.setState({isSelectedMap:i}),this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),i&&this.crateDataSources(null!==(t=this.props.config.watchLocation)&&void 0!==t?t:d)},this.updateLayoutItemHeight=e=>{const t=(0,l.getAppConfigAction)();Ce.searchUtils.getLayoutInfosHoldContent(t.appConfig,n.LayoutItemType.Widget,this.props.id).forEach(i=>{e?t.editLayoutItemProperty(i,"setting.autoProps.height",Ce.LayoutItemSizeModes.Auto).exec():t.editLayoutItemProperty(i,"setting.autoProps.height",Ce.LayoutItemSizeModes.Custom).editLayoutItemProperty(i,"bbox.height","430px").exec()})},this.handleArrangementChange=t=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("arrangement",t)}),this.updateLayoutItemHeight(t===e.Toolbar),(0,l.getAppConfigAction)().editWidgetProperty(this.props.id,"offPanel",t===e.Toolbar).exec()},this.handleShowAdvancedSettingClick=()=>{this.setState({isShowAdvancedSetting:!this.state.isShowAdvancedSetting})},this.handleHighlightLocationChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightLocation",e)})},this.handleHighlightInfoChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightInfo",e)})},this.handleZoomScale=e=>{(e<35.2655368||e>591657527)&&(e=5e4),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("zoomScale",e)})},this.handleTimeOut=e=>{(e<1||e>60)&&(e=15),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("timeOut",e)})},this.handleFieldsChange=(e,...t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("selectedFields",e.map(e=>e.jimuName))})},this.onItemUpdated=(e,t)=>{const i=e.map(e=>e.itemStateDetailContent.jimuName);this.props.onSettingChange({id:this.props.id,config:this.props.config.set("selectedFields",i)})},this.handleDefaultActivationTipsChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultActivation",e)})},this.handleTrackLocationChange=e=>{this.crateDataSources(e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("watchLocation",e).set("selectedFields",e?S:y)})},this.handleTrackLocationSettingsChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("watchLocationSettings",e)})},this.onShowRuntimeLayersChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("showRuntimeLayers",e)})},this.getSelectorFields=e=>{const t=[];return e&&e.length>0&&e.forEach(e=>{t.push(e.jimuName)}),t},this.state={isSelectedMap:!!(null===(i=this.props.useMapWidgetIds)||void 0===i?void 0:i[0]),isShowAdvancedSetting:!1}}componentDidMount(){var e;(null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0])&&this.setState({isSelectedMap:!0})}componentDidUpdate(e){var t,i,a;(null===(t=e.useMapWidgetIds)||void 0===t?void 0:t[0])!==(null===(i=this.props.useMapWidgetIds)||void 0===i?void 0:i[0])&&this.setState({isSelectedMap:!!(null===(a=this.props.useMapWidgetIds)||void 0===a?void 0:a[0])})}render(){var t,i,a,s,l,h,f,S,j,b,T,M,x,v,N,D,w,C,L,A,P,E,R,B,F,H,W,_,Q;const z={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:Ae.TreeItemActionType.RenderOverrideItem,children:[{name:Ae.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:Ae.TreeItemActionType.RenderOverrideItemContent,children:[{name:Ae.TreeItemActionType.RenderOverrideItemBody,children:[{name:Ae.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:Ae.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:Ae.TreeItemActionType.RenderOverrideItemDragHandle},{name:Ae.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:Ae.TreeItemActionType.RenderOverrideItemIcon},{name:Ae.TreeItemActionType.RenderOverrideItemTitle},{name:Ae.TreeItemActionType.RenderOverrideItemCommands}]}]},{name:Ae.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]}]})},G=(null===(t=this.props.outputDataSources)||void 0===t?void 0:t.length)>0?{dataSourceId:null===(i=this.props.outputDataSources)||void 0===i?void 0:i[0],mainDataSourceId:null===(a=this.props.outputDataSources)||void 0===a?void 0:a[0]}:null,J=null!==(s=this.props.config.selectedFields)&&void 0!==s?s:y,U=(e=>{let t;return"track"===e?t=[O.jimuName,k.jimuName]:"trackline_point"===e?t=[O.jimuName,k.jimuName,Z.jimuName]:"trackline"===e&&(t=[]),t})((null!==(l=this.props.config.watchLocation)&&void 0!==l?l:d)?"trackline_point":"track");let $=null===(S=null===(f=n.DataSourceManager.getInstance().getDataSource(null===(h=this.props.outputDataSources)||void 0===h?void 0:h[0]))||void 0===f?void 0:f.getSchema())||void 0===S?void 0:S.fields;if(!$){const e=(null!==(j=this.props.config.watchLocation)&&void 0!==j?j:d)?null===(b=V(this.props.intl,"","trackline_point"))||void 0===b?void 0:b.fields:null===(T=V(this.props.intl,"","track"))||void 0===T?void 0:T.fields;$=(0,n.Immutable)(e)}const K=null==J?void 0:J.map(e=>(null==$?void 0:$[e])||null).filter(e=>null!==e),Y=this.props.id+"-uimode-0",q=this.props.id+"-uimode-1",X=this.props.intl.formatMessage({id:"selectMapWidget",defaultMessage:r.defaultMessages.selectMapWidget}),oe=this.props.intl.formatMessage({id:"selectMapHint",defaultMessage:r.defaultMessages.selectMapHint}),ne=this.props.intl.formatMessage({id:"arrangementTips",defaultMessage:ee}),le=this.props.intl.formatMessage({id:"panelTips",defaultMessage:te}),me=this.props.intl.formatMessage({id:"toolbarTips",defaultMessage:ie}),ge=this.props.intl.formatMessage({id:"zoomScale",defaultMessage:r.defaultMessages.zoomScale}),ue=this.props.intl.formatMessage({id:"zoomToLocation",defaultMessage:be}),he=this.props.intl.formatMessage({id:"generalSettingsTips",defaultMessage:ae}),Ie=this.props.intl.formatMessage({id:"highlightLocationTips",defaultMessage:se}),fe=this.props.intl.formatMessage({id:"timeoutTips",defaultMessage:re}),ye=this.props.intl.formatMessage({id:"selectFieldsTips",defaultMessage:ce}),Se=this.props.intl.formatMessage({id:"defaultActivationTips",defaultMessage:de}),je=this.props.intl.formatMessage({id:"trackLocationTips",defaultMessage:pe}),ve=this.props.intl.formatMessage({id:"showRuntimeLayers",defaultMessage:r.defaultMessages.showRuntimeLayers});return(0,o.jsxs)("div",{css:xe(this.props.theme,n.polished),className:"widget-setting-menu jimu-widget-setting",children:[(0,o.jsx)(c.SettingSection,{title:X,className:(0,n.classNames)("map-selector-section",{"border-0":!this.state.isSelectedMap}),role:"group","aria-label":X,children:(0,o.jsx)(c.SettingRow,{children:(0,o.jsx)(c.MapWidgetSelector,{onSelect:this.handleMapWidgetChange,useMapWidgetIds:this.props.useMapWidgetIds})})}),!this.state.isSelectedMap&&(0,o.jsx)("div",{className:"d-flex placeholder-container justify-content-center align-items-center",children:(0,o.jsxs)("div",{className:"d-flex text-center placeholder justify-content-center align-items-center ",children:[(0,o.jsx)(we,{size:48,className:"d-flex icon mb-2"}),(0,o.jsx)("p",{className:"hint",children:oe})]})}),this.state.isSelectedMap&&(0,o.jsxs)(n.React.Fragment,{children:[(0,o.jsx)(c.SettingSection,{title:ne,role:"group","aria-label":ne,children:(0,o.jsx)(c.SettingRow,{"aria-label":ne,children:(0,o.jsxs)("div",{className:"ui-mode-card-chooser",children:[(0,o.jsxs)(r.Label,{className:"d-flex flex-column ui-mode-card-wapper",children:[(0,o.jsx)(r.Button,{variant:"text",disableHoverEffect:!0,disableRipple:!0,icon:!0,className:(0,n.classNames)("ui-mode-card",{active:(null!==(M=this.props.config.arrangement)&&void 0!==M?M:p)===e.Panel}),onClick:()=>{this.handleArrangementChange(e.Panel)},"aria-label":le,title:le,children:(0,o.jsx)(r.Icon,{width:100,height:72,icon:u(27132),autoFlip:!0})}),(0,o.jsx)("div",{id:Y,className:"mx-1 text-break ui-mode-label",children:le})]}),(0,o.jsx)("div",{className:"ui-mode-card-separator"}),(0,o.jsxs)(r.Label,{className:"d-flex flex-column ui-mode-card-wapper",children:[(0,o.jsx)(r.Button,{variant:"text",disableHoverEffect:!0,disableRipple:!0,icon:!0,className:(0,n.classNames)("ui-mode-card",{active:(null!==(x=this.props.config.arrangement)&&void 0!==x?x:p)===e.Toolbar}),onClick:()=>{this.handleArrangementChange(e.Toolbar)},"aria-label":me,title:me,children:(0,o.jsx)(r.Icon,{width:100,height:72,icon:u(55677),autoFlip:!0})}),(0,o.jsx)("div",{id:q,className:"mx-1 text-break ui-mode-label",children:me})]})]})})}),(0,o.jsxs)(c.SettingSection,{title:he,role:"group",children:[(0,o.jsx)(c.SettingRow,{tag:"label",label:Ie,className:"bold-font-label",children:(0,o.jsx)(r.Switch,{checked:null!==(v=this.props.config.highlightLocation)&&void 0!==v?v:m,onChange:e=>{this.handleHighlightLocationChange(e.target.checked)}})}),(null!==(N=this.props.config.highlightLocation)&&void 0!==N?N:m)&&(0,o.jsx)(Te,{theme:this.props.theme,intl:this.props.intl,highlightInfo:null!==(w=null===(D=this.props.config.highlightInfo)||void 0===D?void 0:D.asMutable())&&void 0!==w?w:{symbolColor:"#007AC2",showCompassOrientation:false,showLocationAccuracy:false},onHighlightInfoChange:this.handleHighlightInfoChange}),(0,o.jsx)(c.SettingRow,{label:ue,className:"bold-font-label",children:(0,o.jsx)(r.Switch,{checked:null!==(C=this.props.config.zoomToLocation)&&void 0!==C?C:g,onChange:e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("zoomToLocation",e.target.checked)})}})}),(null!==(L=this.props.config.zoomToLocation)&&void 0!==L?L:g)&&(0,o.jsxs)(c.SettingRow,{label:ge,className:"bold-font-label",children:[(0,o.jsx)(r.Label,{className:"setting-label",children:"1:"})," ",(0,o.jsx)(r.NumericInput,{className:"zoom-scale-input",showHandlers:!1,defaultValue:5e4,value:null!==(A=this.props.config.zoomScale)&&void 0!==A?A:5e4,onAcceptValue:this.handleZoomScale,"aria-label":ge})]}),(0,o.jsx)(c.SettingRow,{label:fe,className:"bold-font-label",children:(0,o.jsx)(r.NumericInput,{className:"zoom-scale-input",showHandlers:!0,defaultValue:15,value:null!==(P=this.props.config.timeOut)&&void 0!==P?P:15,onAcceptValue:this.handleTimeOut,"aria-label":fe})}),(0,o.jsx)(c.SettingRow,{flow:"wrap",label:ye,className:"bold-font-label",children:(0,o.jsx)(Le.FieldSelector,{useDataSources:G?(0,n.Immutable)([G]):(0,n.Immutable)([]),css:n.css`width: 120px; .jimu-dropdown { width: 100%; }`,"aria-label":ye,onChange:this.handleFieldsChange,selectedFields:(0,n.Immutable)(J),hiddenFields:(0,n.Immutable)(U),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})}),(0,o.jsx)(c.SettingRow,{className:"selected-fields-con mt-2",children:(0,o.jsx)(Ae.List,Object.assign({className:"selected-fields-list",itemsJson:Array.from(K).map((e,t)=>({itemStateDetailContent:e,itemExpandIconShown:!1,itemStateExpanded:!1,itemKey:`${t}`,itemStateIcon:Le.dataComponentsUtils.getIconFromFieldType(e.type,this.props.theme),itemStateTitle:e.alias||e.jimuName||e.name,isCheckboxDisabled:!0,itemStateCommands:[]})),onUpdateItem:(e,t)=>{if(e.updateType===Ae.TreeItemActionType.HandleDidDrop){const{itemJsons:e}=t.props,[i,a]=e;this.onItemUpdated(a,+i.itemKey)}},dndEnabled:!0,isMultiSelection:!1},z))}),(0,o.jsx)(c.SettingRow,{tag:"label",label:je,className:"bold-font-label",children:(0,o.jsx)(r.Switch,{checked:null!==(E=this.props.config.watchLocation)&&void 0!==E?E:d,onChange:e=>{this.handleTrackLocationChange(e.target.checked)}})}),(null!==(R=this.props.config.watchLocation)&&void 0!==R?R:d)&&(0,o.jsx)(Me,{theme:this.props.theme,intl:this.props.intl,timeOut:null!==(B=this.props.config.timeOut)&&void 0!==B?B:15,watchLocationSettings:null!==(H=null===(F=this.props.config.watchLocationSettings)||void 0===F?void 0:F.asMutable())&&void 0!==H?H:{manualPathTracing:true,streaming:{type:I.TYPE,unit:I.UNIT,interval:I.INTERVAL}},onTrackLocationSettingsChange:this.handleTrackLocationSettingsChange}),(0,o.jsx)(c.SettingRow,{tag:"label",label:ve,children:(0,o.jsx)(r.Switch,{checked:null===(_=null===(W=this.props.config)||void 0===W?void 0:W.showRuntimeLayers)||void 0===_||_,onChange:e=>{this.onShowRuntimeLayersChange(e.target.checked)}})}),(0,o.jsx)(c.SettingRow,{tag:"label",label:Se,className:"bold-font-label",children:(0,o.jsx)(r.Switch,{checked:null!==(Q=this.props.config.defaultActivation)&&void 0!==Q&&Q,onChange:e=>{this.handleDefaultActivationTipsChange(e.target.checked)}})})]})]})]})}}function Oe(e){u.p=e}})(),h})())}}});