/*! For license information please see arcgis_image-collection-explorer_node_modules_arcgis_imagery-components_di-e555c2.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_image-collection-explorer_node_modules_arcgis_imagery-components_di-e555c2"],{2146:(e,t,i)=>{i.d(t,{s:()=>a});const a=(e,t=100)=>{let i;return(...a)=>{clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...a)},t)}}},7091:(e,t,i)=>{i.r(t),i.d(t,{ArcgisImageryDisplayOrder:()=>b});var a=i(3074),s=i(2288),l=i(1925),c=i(2146),o=i(459);const r=["center","northwest","lock-raster","attribute","nadir","viewpoint","seamline","none"],n=["first","last","min","max","mean","sum"],d=["double","single","long","integer","small-integer","oid","date","big-integer","date-only"],h={center:"mosaic-method-closest-to-center",northwest:"mosaic-method-north-west","lock-raster":"mosaic-method-lock-raster",attribute:"mosaic-method-by-attribute",nadir:"mosaic-method-closest-to-nadir",viewpoint:"mosaic-method-none",seamline:"mosaic-method-seamline",none:"mosaic-method-none"},u={first:"mosaic-method-first",last:"mosaic-method-last",min:"mosaic-method-minimum",max:"mosaic-method-maximum",mean:"mosaic-method-mean",sum:"mosaic-method-sum",blend:"mosaic-method-blend"},m=l.AH`:host{display:flex;height:100%}.image-display-order-lock-input{margin-top:.5rem}.image-display-order-block{border-block-end-width:0px}.image-display-order-block-without-heading{margin-block:0px}`;class b extends s.WF{constructor(){super(...arguments),this.mosaicMethodList=r,this.attributeFieldList=[],this._messages=(0,o.u)({blocking:!0}),this.debouncedHandleAttributeValueChange=(0,c.s)(e=>{this.activeMosaicRule&&(this.activeMosaicRule.sortValue=e),this.updateActiveMosaicRule()},300),this.debouncedHandleRasterIDsChange=(0,c.s)(e=>{this.activeMosaicRule&&(this.activeMosaicRule.lockRasterIds=e),this.updateActiveMosaicRule()},300),this.debouncedHandleReverseOrderChange=(0,c.s)(e=>{this.activeMosaicRule&&(this.activeMosaicRule.ascending=!e),this.updateActiveMosaicRule()},300),this.closable=!1,this.hideButtons=!1,this.arcgisClose=(0,s.lh)()}static{this.properties={activeMosaicRule:16,lockRasterIdInput:16,layer:0,panelHeading:1,closable:5,hideButtons:5}}static{this.styles=m}load(){this.init()}willUpdate(e){if(this.hasUpdated&&e.has("layer")&&this.init(),this.hasUpdated&&e.has("lockRasterIdInput")){const e=this.lockRasterIdInput?.split(",")?.map(e=>Number.parseInt(e,10))??[];this.debouncedHandleRasterIDsChange(e)}}async init(){await this.layer.load(),this.originalMosaicRule=this.getOriginalMosaicRule(),this.activeMosaicRule=this.originalMosaicRule.clone(),this.lockRasterIdInput=this.activeMosaicRule.lockRasterIds?.join(","),this.mosaicMethodList=this.getMosaicMethodList(),this.attributeFieldList=this.getAttributeFieldList()}handleMosaicMethodChange(e){const t=e.currentTarget.selectedItems[0]?.value,{lockRasterIds:i}=this.activeMosaicRule,a="attribute"===t?this.attributeFieldList?.[0]?.name:null,s="lock-raster"!==t?null:i,l="seamline"!==t,c="seamline"===t?"blend":"first";this.activeMosaicRule&&(this.activeMosaicRule.method=t,this.activeMosaicRule.sortField=a,this.activeMosaicRule.sortValue="",this.activeMosaicRule.lockRasterIds=s,this.activeMosaicRule.ascending=l,this.activeMosaicRule.operation=c),this.updateActiveMosaicRule()}handleAttributeFieldChange(e){const t=e.currentTarget.selectedOption?.value;this.activeMosaicRule&&(this.activeMosaicRule.sortField=t),this.updateActiveMosaicRule()}handleDateAttributeValueChange(e){const t=e.currentTarget.value.replace(/-/gu,"/");this.debouncedHandleAttributeValueChange(t)}handleAttributeValueChange(e){const t=+e.currentTarget.value;this.debouncedHandleAttributeValueChange(t)}handleRasterIDsChange(e){const t=e.currentTarget.value;/^[0-9]+(,[0-9]+)*$/.test(t)&&(this.lockRasterIdInput=t)}handleReverseOrderChange(e){const t=e.currentTarget?.checked;this.debouncedHandleReverseOrderChange(t)}handleMosaicOperatorChange(e){const t=e.currentTarget.selectedItems[0]?.value;this.activeMosaicRule&&(this.activeMosaicRule.operation=t),this.updateActiveMosaicRule()}handleDone(){this.activeMosaicRule&&(this.originalMosaicRule=this.activeMosaicRule.clone()),this.arcgisClose.emit("save")}handleCancel(){this.layer.mosaicRule=this.originalMosaicRule,this.activeMosaicRule=this.originalMosaicRule.clone(),this.arcgisClose.emit("cancel")}updateActiveMosaicRule(){this.activeMosaicRule&&(this.activeMosaicRule=this.activeMosaicRule.clone(),this.layer.mosaicRule=this.activeMosaicRule)}getOriginalMosaicRule(){const{mosaicRule:e,defaultMosaicRule:t}=this.layer,i=e??t;if(i){const{method:e,operation:t}=i||{};"seamline"===e?i.operation="blend":"blend"===t&&(i.operation="first")}return i}getAllowedAttributeFieldList(){const{fields:e,sourceJSON:t}=this.layer,i=e.filter(({type:e})=>d.includes(e));i.sort((e,t)=>e.alias.localeCompare(t.alias));const{sortableFields:a}=t||{};if(!a?.length)return i;const s=a?.split(",").map(e=>e.toLowerCase());return i.filter(e=>s.includes(e.name.toLocaleLowerCase()))}filterAttributeFieldList(e){return"category"!==this.layer.sourceJSON?.sortField?.toLowerCase()?e.filter(e=>"category"!==e.name.toLocaleLowerCase()):e}getAttributeFieldList(){const e=this.getAllowedAttributeFieldList();return this.filterAttributeFieldList(e)}getAllowedMosaicMethodList(){const{sourceJSON:e}=this.layer;if(!e)return r;const{currentVersion:t,allowedMosaicMethods:i}=e;if(!(t&&t>=10.1)||!(i?.length>1))return r;const a=i.split(",").map(e=>(e=>{switch(e=e.toLowerCase()){case"lockraster":case"lock-raster":return"lock-raster";case"byattribute":return"attribute";default:return e}})(e.toLowerCase())),s="none";return a.includes(s)||a.push(s),a}filteredMosaicMethodList(e){return e.filter(e=>"viewpoint"!==e)}getMosaicMethodList(){const e=this.getAllowedMosaicMethodList();return this.filteredMosaicMethodList(e)}render(){return l.qy`<calcite-panel .heading=${this.panelHeading??this._messages.imageDisplayOrder} .closable=${this.closable} .loading=${!this.activeMosaicRule} @calcitePanelClose=${this.handleCancel} class=${(0,s.CP)({panel:!0})}>${this.renderMosaicRule()}${!this.hideButtons&&this.renderFooterActions()||""}</calcite-panel>`}renderMosaicRule(){if(!this.activeMosaicRule)return null;const e=this.activeMosaicRule.method,t="attribute"===e,i="lock-raster"===e,a="seamline"!==e;return l.qy`<calcite-block class=${(0,s.CP)({"image-display-order-block":!0,"image-display-order-block-without-heading":""===this.panelHeading})} heading expanded>${this.renderMosaicMethodSelection()}${t&&this.renderAttributeFilter()||""}${i&&this.renderRasterId()||""}${a&&this.renderReverseOrder()||""}${this.renderMosaicOperatorSelection()}</calcite-block>`}renderMosaicMethodSelection(){const{method:e}=this.activeMosaicRule,{mosaicMethod:t,componentLabel:i,mosaicMethodLabel:a,mosaicMethodDescription:s}=this._messages;return l.qy`<calcite-label>${t}<calcite-combobox .label=${i.methodSelect} clear-disabled selection-mode=single-persist overlay-positioning=fixed @calciteComboboxChange=${this.handleMosaicMethodChange}>${this.mosaicMethodList.map(t=>l.qy`<calcite-combobox-item .value=${t} .icon=${h[t]} .heading=${a[t]} .description=${s[t]} .selected=${t===e}></calcite-combobox-item>`)}</calcite-combobox></calcite-label>`}renderAttributeFilter(){const{sortField:e}=this.activeMosaicRule,t=this.attributeFieldList.find(({name:t})=>t===e)?.type,i="date"===t||"date-only"===t;return l.qy`<div>${this.renderAttributeMethodSelection()}${i?this.renderAttributeDatePicker():this.renderAttributeSortValue()}</div>`}renderAttributeMethodSelection(){const{sortField:e}=this.activeMosaicRule,{attribute:t,componentLabel:i}=this._messages;return l.qy`<calcite-label>${t}<calcite-select .label=${i.attributeFieldSelect} @calciteSelectChange=${this.handleAttributeFieldChange}>${this.attributeFieldList.map(({name:t,alias:i})=>l.qy`<calcite-option .value=${t} .label=${i??""} .selected=${t===e}></calcite-option>`)}</calcite-select></calcite-label>`}renderAttributeDatePicker(){const{sortValue:e}=this.activeMosaicRule,{highestPriorityValue:t}=this._messages,i=e?.toString()?.includes("/")?e.replace(/\//gu,"-"):"";return l.qy`<calcite-label>${t}<calcite-input-date-picker placement=bottom-end overlay-positioning=fixed .value=${i} @calciteInputDatePickerChange=${this.handleDateAttributeValueChange}></calcite-input-date-picker></calcite-label>`}renderAttributeSortValue(){const{sortValue:e}=this.activeMosaicRule,{highestPriorityValue:t}=this._messages;return l.qy`<calcite-label>${t}<calcite-input type=number step=0.001 .value=${e?.toString()} @calciteInputInput=${this.handleAttributeValueChange}></calcite-input></calcite-label>`}renderRasterId(){return l.qy`<calcite-label>${this._messages.imageIDs}<calcite-input class="image-display-order-lock-input" .placeholder=${this._messages.useCommaDelimiter} .value=${this.lockRasterIdInput} @calciteInputInput=${this.handleRasterIDsChange}></calcite-input></calcite-label>`}renderReverseOrder(){const{ascending:e}=this.activeMosaicRule;return l.qy`<calcite-label layout=inline-space-between>${this._messages.reverserOrder}<calcite-switch .checked=${!e} @calciteSwitchChange=${this.handleReverseOrderChange}></calcite-switch></calcite-label>`}renderMosaicOperatorSelection(){const{method:e,operation:t}=this.activeMosaicRule,i="seamline"===e?["blend"]:n,{mosaicOperator:a,componentLabel:s,mosaicOperatorLabel:c,mosaicOperatorDescription:o}=this._messages;return l.qy`<calcite-label>${a}<calcite-combobox .label=${s.operatorSelect} clear-disabled .disabled=${"seamline"===e} selection-mode=single-persist overlay-positioning=fixed @calciteComboboxChange=${this.handleMosaicOperatorChange}>${i.map(e=>l.qy`<calcite-combobox-item .value=${e} .icon=${u[e]} .heading=${c[e]} .description=${o[e]} .selected=${e===t}></calcite-combobox-item>`)}</calcite-combobox></calcite-label>`}renderFooterActions(){return l.qy`${this.renderDoneButton()}${this.renderCancelButton()}`}renderDoneButton(){return l.qy`<calcite-button slot=footer appearance=solid width=half .disabled=${!this.activeMosaicRule} @click=${this.handleDone}>${this._messages.done}</calcite-button>`}renderCancelButton(){return l.qy`<calcite-button slot=footer appearance=outline-fill width=half .disabled=${!this.activeMosaicRule} @click=${this.handleCancel}>${this._messages.cancel}</calcite-button>`}}(0,a.c)("arcgis-imagery-display-order",b)}}]);