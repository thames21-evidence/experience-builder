/*! For license information please see arcgis_image-collection-explorer_node_modules_arcgis_imagery-components_di-7fb0e4.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_image-collection-explorer_node_modules_arcgis_imagery-components_di-7fb0e4"],{4735:(e,t,i)=>{function s(){const e=document.createElement("div");return document.body.appendChild(e),e}i.d(t,{c:()=>s})},7373:(e,t,i)=>{i.r(t),i.d(t,{ArcgisImageryMultidimensionalInfo:()=>p});var s=i(3074),n=i(9143),a=i(9903),r=i(459),o=i(1925),l=i(4476),c=i(2288),m=i(4735);const u="arcgisImageryComponents";function d(e,t){const i=h();i[e]=t,function(e){const t=JSON.stringify(e);"{}"===t?localStorage.removeItem(u):localStorage.setItem(u,t)}(i)}function h(){const e=localStorage.getItem(u);return e?JSON.parse(e):{}}const f=o.AH`:host{display:flex;flex:1 1 auto}.info{width:100%}.default-variable{font-size:var(--calcite-font-size--2)}.notice{margin-bottom:10px}`,g="imageryMultidimensionalInfoTipDismissed";class p extends c.WF{constructor(){super(...arguments),this.messages=(0,r.u)({blocking:!0}),this.variableEl=(0,l._)(),this.filterItems=[],this.selectedVariableNames=[],this.showFilterLength=10,this.showRawSourceInfo=!1,this.open=!1,this.showStatistics=!1}static{this.properties={multidimensionalInfo:16,selectedVariableNames:16,showFilterLength:9,showRawSourceInfo:5,layer:0,open:5,showStatistics:5}}static{this.styles=f}async done(){this.closePopover()}load(){this.initLayer(this.layer)}willUpdate(e){this.hasUpdated&&e.has("layer")&&(this.closePopover(),this.multidimensionalInfo=void 0,this.selectedVariableNames=[],this.initLayer(this.layer))}disconnectedCallback(){super.disconnectedCallback(),this.closePopover()}closePopover(){this.outsideContainer?.remove(),this.outsideContainer=void 0}async initLayer(e){e&&(e.loaded||await e.load(),this.multidimensionalInfo=await(0,a.g)(e,this.showRawSourceInfo),this.multidimensionalInfo&&(this.filterItems=this.multidimensionalInfo.variables.map(({name:e,dimensions:t})=>({name:e,dimensionNames:t.map(e=>e.name)}))),this.filterMessages={clear:this.messages.general.clear,label:this.messages.multidimensionalInfo.searchVariables})}render(){const{layer:e,multidimensionalInfo:t,messages:i}=this;if(!t){const t=!e?.loaded;return o.qy`<calcite-block class="info" .heading=${i.multidimensionalInfo.info} collapsible .expanded=${!!this.open} .loading=${t}>${t?o.qy`<calcite-loader class="loader" label type=indeterminate></calcite-loader>`:o.qy`<div>${i.general.unsupported}</div>`}</calcite-block>`}const{variables:s}=t,n=[];s.forEach(({dimensions:e})=>e.forEach(e=>{n.some(t=>t.name===e.name)||n.push(e)}));const a=this.showRawSourceInfo&&(r=g,!h()[r]);var r;return o.qy`<calcite-block class="info" .heading=${i.multidimensionalInfo.info} collapsible .expanded=${!!this.open} @calciteBlockClose=${()=>this.closePopover()}>${a&&this.renderNotice()||""}${this.renderVariableSelect()}<slot></slot></calcite-block>`}renderNotice(){return o.qy`<calcite-notice open closable icon scale=s class="notice" @calciteNoticeClose=${()=>d(g,!0)}><div slot=message> ${this.messages.multidimensionalInfo.tip}</div></calcite-notice>`}renderVariableFilter(){const{messages:e}=this;return o.qy`<calcite-filter .items=${this.filterItems} .messageOverrides=${this.filterMessages} .placeholder=${e.multidimensionalInfo.searchVariables} @calciteFilterChange=${e=>{const t=e.target.filteredItems;this.selectedVariableNames=t.map(({name:e})=>e)}}></calcite-filter>`}renderVariableSelect(){const{variables:e}=this.multidimensionalInfo,{serviceRasterInfo:t}=this.layer,i=(t?.keyProperties).DefaultVariable??e[0].name,s=[];e.forEach(({dimensions:e})=>e.forEach(e=>{s.some(t=>t.name===e.name)||s.push(e)}));const{multidimensionalInfo:n}=this.messages,a=s.map(({name:e,values:t})=>{const i="StdTime"===e?n.timeValues:"StdZ"===e?n.zValues:n.generalValues.replace("${dimensionName}",e),s=t?.length;return s?`${i}: ${s}`:i}).join("; "),r=this.selectedVariableNames?.length?e.filter(({name:e})=>this.selectedVariableNames.includes(e)):e;return o.qy`<div ${(0,l.K)(this.variableEl)}><calcite-label>${`${n.variables}: ${e.length}; ${a}`}</calcite-label>${e.length>=this.showFilterLength&&this.renderVariableFilter()||""}<calcite-list .label=${n.variables}>${r.map(e=>this.renderVariableListItem(e,e.name===i))}</calcite-list></div>`}renderVariableListItem(e,t){const{name:i,unit:s,description:a}=e,r=s?`${i} (${s})`:i,{general:l}=this.messages;return(0,n.D)(i,o.qy`<calcite-list-item .label=${r} .description=${a??""} @click=${()=>this.renderPickListPopover(e)}><calcite-action icon=information scale=s .text=${l.close} slot=actions-start @click=${()=>this.renderPickListPopover(e)}></calcite-action>${t?o.qy`<calcite-chip slot=actions-end .label=${l.default}><span class="default-variable">${l.default}</span></calcite-chip>`:null}</calcite-list-item>`)}renderPickListPopover(e){this.outsideContainer??=(0,m.c)();const t=this.variableEl.value?this.variableEl.value.getBoundingClientRect().top-this.el.getBoundingClientRect().top:0;(0,o.XX)(o.qy`<arcgis-imagery-multidimensional-variable-info class="js-app-flyout" .variableInfo=${e} .showStatistics=${this.showStatistics} .messages=${this.messages} open .popoverProps=${{refElement:this.el,placement:"leading-start",offsetDistance:0,offsetSkidding:t,popoverWidth:300}} @arcgisClose=${()=>this.closePopover()}></arcgis-imagery-multidimensional-variable-info>`,this.outsideContainer)}}(0,s.c)("arcgis-imagery-multidimensional-info",p)},9143:(e,t,i)=>{i.d(t,{D:()=>r});var s=i(9684),n=i(4448),a=i(284);const r=(0,n.u$)(class extends n.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,a.mY)(e),this.key=t),i}})},9903:(e,t,i)=>{i.d(t,{a:()=>h,b:()=>p,c:()=>u,d:()=>f,e:()=>m,f:()=>o,g:()=>d,h:()=>c,i:()=>g,m:()=>s,u:()=>n});const s=10.9,n=Number.MAX_VALUE-1;function a(e,t){const i=new Date(e),{useFriendlyIsoFormat:s,intl:n,format:a}=t;if(s&&n)return n.formatDate(i,{...n.convertDateFormatToIntlOptions(a??"short-date-long-time"),timeZone:"UTC"});let r=new Date(e).toISOString();return r=`${r.slice(0,r.indexOf("."))}Z`,r}function r(e,t,i="long"){const s=new Date(2022,9,10);return s.setMonth(e-1),t.formatDate(s,{month:i})}function o(e,t,i={}){if(null==e)return"";const{intl:s,useRecurringTimeLabel:n}=i;if(n&&s&&!Array.isArray(e)){const i=t.unit?.toLowerCase().trim();if(function(e){return"StdTime"===e.name&&!!e.recurring}(t)&&("months"===i||"quarters"===i))return"months"===i?r(e,s):function(e,t){return`${r(3*(e-1)+1,t,"short")} - ${r(3*e,t,"short")}`}(e,s)}const o=t.values?.[t.values.length-1];return i.useStartOrEndForRangedValue&&Array.isArray(e)&&2===e.length&&Array.isArray(o)&&(e=e.join("-")===o.join("-")?e[1]:e[0]),h(t)?(i.useFriendlyIsoFormat&&!i.format&&(i={format:l(t),...i}),Array.isArray(e)?e.map(e=>a(e,i)).join(" - "):a(e,i)):Array.isArray(e)?e.map(e=>s?.formatNumber(e)??String(e)).join(" - "):s?.formatNumber(e)??String(e)}function l(e){let t=e.intervalUnit?.toLowerCase().trim()??"";const{extent:i}=e,s=e.interval??0,n=e.values?.length;if(!["years","months","days","hours"].includes(t)&&i?.length&&n){const e=(i[1]-i[0])/n,s=864e5;t=e>=365*s?"years":e>=28*s?"months":t}switch(t){case"months":t=s>11?"years":t;break;case"days":t=s>364?"years":s>27?"months":t;break;case"hours":t="days"}return"years"===t?"year":"months"===t?"short-month-year":"short-date"}function c(e,t){const i=t?.dimensions?.find(({name:t})=>t===e.name);if(!i?.extent)return e;const s=[...i.extent],{values:n}=e;if(n?.length){const t=n.filter(e=>Array.isArray(e)?null==s[1]||s[0]===s[1]?e[0]===s[0]:e[0]>=s[0]&&e[0]<=s[1]&&e[1]>=s[0]&&e[1]<=s[1]:e>=s[0]&&e<=s[1]);if(0===t.length){const e=n[n.length-1];Array.isArray(e)&&e[1]===s[0]&&t.push(e)}return{...e,extent:s,values:t}}return{...e,extent:s}}function m(e){const{values:t,extent:i,name:s}=e;let n=t?.[0]??i?.[0];return"stdz"===s.toLowerCase()&&!e.hasRanges&&i&&Math.abs(i[1])<=Math.abs(i[0])&&(n=t?.length?t[t.length-1]:i[1]),n}function u(e){return"imagery-tile"===e.type||"wcs"===e.type?e.multidimensionalDefinition:(e.mosaicRule??e.defaultMosaicRule)?.multidimensionalDefinition}async function d(e,t=!1){if("imagery-tile"===e.type||"wcs"===e.type)return e.serviceRasterInfo?.multidimensionalInfo;const{rasterFunction:i,version:s}=e;return t||s<=10.9||!i||"none"===i.functionName?.toLowerCase()?e.serviceRasterInfo.multidimensionalInfo:(await e.generateRasterInfo(e.rasterFunction).catch(()=>e.serviceRasterInfo)).multidimensionalInfo}function h(e,t=!1){return"StdTime"===e.name&&(t||!e.recurring)}function f(e,t,i){t=c(t,i);const s=o(e.values[0],t);if(!t.values?.some(e=>s===o(e,t))){const i=m(t);e.values=null!=i?[i]:[]}}function g(e){return Array.isArray(e[0])}function p(e){return e.variables.map(({name:e,unit:t,description:i})=>({name:e,label:t?`${e} (${t})`:e,description:i}))}}}]);