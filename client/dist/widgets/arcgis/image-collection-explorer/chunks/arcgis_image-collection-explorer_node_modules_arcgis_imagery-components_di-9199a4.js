/*! For license information please see arcgis_image-collection-explorer_node_modules_arcgis_imagery-components_di-9199a4.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_image-collection-explorer_node_modules_arcgis_imagery-components_di-9199a4"],{1132:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>p,c:()=>x,d:()=>g,e:()=>f,f:()=>m,g:()=>d,h:()=>y,i:()=>l,j:()=>c,k:()=>u,l:()=>w,m:()=>$,r:()=>b});var n=r(8423),i=r(2373),s=r(1552),o=r(6295);function a(e){const t=e.find(e=>"best"===e.name.toLowerCase());if(t)return t;const r=e.find(e=>"acquisitiondate"===e.name.toLowerCase());if(r)return r;return e.find(e=>"date"===e.name.toLowerCase())||e.find(e=>"double"===e.type||"integer"===e.type)}async function l(e,t,r){return await e.queryObjectIds(t,{signal:r})}async function c(e,t,r){t.outFields=["*"],t.returnGeometry=!0;const n=await e.queryRasters(t,{signal:r,timeout:12e4});return n?.features?.length?n:null}function u(e,t){const r=e.fields;let n=r.find(e=>"name"===e.name.toLowerCase());return n||(n=r.find(t=>t.name===e.objectIdField)),n&&!t?[n]:n&&n.name!==t.name?[n,t]:[t]}function d(e){return Array.isArray(e)?e.filter(e=>o.s.has(e.type)):[]}function m(e){const{layer:t,queryField:r,queryValues:n,isIncludeOverviews:i,extent:s,selectedImageItemOids:a}=e,l=t.createQuery();if(n&&n.length>0){let e="";if("date"===r?.type&&n[0]){const t=new Date(n[0]),i=(0,o.g)(n[0],!0),s=1===n.length||n[0]===n[1]?(0,o.g)(t.setDate(t.getDate()+1),!0):(0,o.g)(n[1],!0);e=`${r.name} BETWEEN timestamp '${i}' AND timestamp '${s}'`}else{const t=n.filter(e=>"string"==typeof e||"number"==typeof e);if(1===t.length||2===t.length){const[i,s]=n,o="string"==typeof i;e=1===t.length?`${r?.name}=${o?`'${i}'`:i}`:`${r?.name} BETWEEN ${o?`'${i}'`:i} AND ${o?`'${s}'`:s}`}}l.where=e}const c="(Category = 1)";if(i)l.where=l.where?.replace(c,"");else{const e=c+(l.where?` AND (${l.where})`:"");l.where=e}let u="";return a&&a.length>0&&(u=(0,o.a)(t.objectIdField,a)),l.where=u?`${l.where} AND (${u})`:l.where,t.definitionExpression&&(l.where=l.where?`${l.where} AND (${t.definitionExpression})`:t.definitionExpression),s&&(l.geometry=s),l}function p(e){return e.extent?.clone().expand(.75)}async function f(e,t,r,n,i){if(!t)return[];const s=[{onStatisticField:t.name,outStatisticFieldName:"cnt",statisticType:"count"}],a=await h(e,r,n,s,[t.name]);if(a){const r=await e.queryRasters(a,{signal:i});if(r?.features?.length>0){const e=(0,o.i)(t.type);return r.features.map(r=>{const n=r.attributes[t.name];return e?Number(n):n})}}return[]}async function g(e,t,r,n,i){if(!t.name)return[];const s=[{statisticType:"min",onStatisticField:t.name,outStatisticFieldName:"min_field_value"},{statisticType:"max",onStatisticField:t.name,outStatisticFieldName:"max_field_value"}],o=await h(e,r,n,s);if(o){const t=await e.queryRasters(o,{signal:i});if(t?.features?.length>0){const[e]=t.features;return[e.attributes.min_field_value,e.attributes.max_field_value]}}return[]}async function h(e,t,r,n,i=[]){const s=e.createQuery();if(s.returnGeometry=!1,t===o.A.DISPLAY_EXTENT&&(s.geometry=p(r)),t===o.A.VISIBLE){const t=await S(e,r);if(!(t.length>0))return null;s.where=(0,o.a)(e.objectIdField,t)}return e.definitionExpression&&(s.where=s.where?`${s.where} AND (${e.definitionExpression})`:e.definitionExpression),s.outStatistics=n,i.length>0&&(s.groupByFieldsForStatistics=i),s}async function S(e,t){const r=[],i=function(e,t){const{extent:r,width:i,height:o}=t,a=r.width/i,l=r.height/o,c=new n.default({x:a,y:l});c.spatialReference=r.spatialReference;const u=new s.default;u.geometry=p(t),u.returnGeometry=!0,u.pixelSize=c,u.maxItemCount=e.sourceJSON?.maxMosaicImageCount,u.returnPixelValues=!1;const d=e.mosaicRule.clone();if(e.definitionExpression&&(d.where=e.definitionExpression),u.mosaicRule=d,e.useViewTime){const r=t.timeExtent?t.timeExtent.intersection(e.timeExtent):e.timeExtent;u.timeExtent=r}return!e.useViewTime&&e.timeExtent&&(u.timeExtent=e.timeExtent),u}(e,t),o=await e.identify(i,{timeout:12e4});if(!o?.catalogItems?.features||!o?.catalogItemVisibilities)return[];for(let t=0;t<o.catalogItems.features.length;t++)o.catalogItemVisibilities[t]>0&&r.push(o.catalogItems.features[t].attributes[e.objectIdField]);return r}async function y(e,t,r){const n=await S(e,t);if(!(n.length>0))return null;r.objectIds=n,r.outFields=["*"],r.returnGeometry=!0;const i=await e.queryRasters(r,{timeout:12e4});return i?.features?.length>0?i:null}function w(e,t){if(t.length){const r=new i.default;r.method="lock-raster",r.lockRasterIds=t,e.definitionExpression&&(r.where=e.definitionExpression),e.mosaicRule=r}}function b(e,t){t&&(e.mosaicRule=t.clone())}function $(e,t,r){const{title:n}=e,i=t.name;let s="";const a=r.map(e=>e.attributes[i]).map(e=>(0,o.b)(e,t.type));return a.sort((e,t)=>"number"==typeof e&&"number"==typeof t?e-t:String(e).localeCompare(String(t))),1===a.length&&(s=`(${a[0]})`),a.length>1&&(s=`(${a[0]} - ${a[a.length-1]})`),`${n} - ${i} ${s}`}function x(e,t){return Math.abs(t.extent.center.x-e.center.x)<t.resolution&&Math.abs(t.extent.center.y-e.center.y)<t.resolution}},5226:(e,t,r)=>{r.r(t),r.d(t,{ArcgisImageryItemSortPopover:()=>c});var n=r(3074),i=r(6295),s=r(1132),o=r(1925),a=r(2288);const l=o.AH`.sort-popover-wrapper{display:flex;padding:1rem;min-width:320px;max-height:50vh;background-color:var(--calcite-color-foreground-1)!important}.label-wrapper{background-color:var(--calcite-color-foreground-1);padding-top:.5rem}.field-list-wrapper{overflow-y:auto}.sort-order-chip-group{padding:0 .5rem .5rem;background-color:var(--calcite-color-foreground-1)}.button-wrapper{padding:1rem .25rem .25rem;background-color:var(--calcite-color-foreground-1)}`;class c extends a.WF{constructor(){super(...arguments),this.fields=[],this.open=!1,this.offsetSkidding=0,this.arcgisImageItemSortChangeSave=(0,a.lh)(),this.arcgisImageItemSortPopoverClose=(0,a.lh)()}static{this.properties={selectedSortField:16,selectedSortOrder:16,referenceElement:0,messages:0,fields:0,preselectedSortField:0,preselectedSortOrder:0,open:5,offsetSkidding:9}}static{this.styles=l}willUpdate(e){e.has("open")&&this.updateModal(this.open)}updateModal(e){e&&(this.selectedSortField=this.preselectedSortField,this.selectedSortOrder=this.preselectedSortOrder)}handleSortChangeSave(){const{selectedSortField:e,selectedSortOrder:t}=this;this.arcgisImageItemSortChangeSave.emit({sortField:e,sortOrder:t}),this.arcgisImageItemSortPopoverClose.emit()}render(){const{messages:e,open:t,offsetSkidding:r}=this;return o.qy`<calcite-popover auto-close .label=${e.sort} .referenceElement=${this.referenceElement} closable .heading=${e.sort} placement=auto-start overlay-positioning=fixed pointer-disabled trigger-disabled offset-distance=10 .offsetSkidding=${r} .open=${t} @calcitePopoverClose=${()=>{this.arcgisImageItemSortPopoverClose.emit()}}><calcite-panel class="sort-popover-wrapper"><calcite-label class="label-wrapper">${e.sortByField}</calcite-label>${this.renderSortFieldList()}<calcite-label class="label-wrapper">${e.sortOrder}</calcite-label>${this.renderSortOrderChipGroup()}<div class="button-wrapper"><calcite-button width=full @click=${this.handleSortChangeSave}>${e.done}</calcite-button></div></calcite-panel></calcite-popover>`}renderSortFieldList(){const{fields:e,selectedSortField:t}=this,r=(0,s.g)(e).map(e=>o.qy`<calcite-list-item .label=${e.name} .value=${e} .selected=${e.name===t?.name}></calcite-list-item>`);return o.qy`<calcite-list .label=${this.messages.sortByField} selection-mode=single-persist class="field-list-wrapper" @calciteListChange=${e=>{const t=e.target.selectedItems.map(e=>e.value);this.selectedSortField=t[0]}}>${r}</calcite-list>`}renderSortOrderChipGroup(){const{messages:e,selectedSortField:t,selectedSortOrder:r}=this,{type:n}=t||{};let s=null;"string"===n?s=[{displayText:e.alphabetical,sortOrder:i.S.ASC},{displayText:e.reverseAlphabetical,sortOrder:i.S.DESC}]:"date"===n?s=[{displayText:e.mostRecent,sortOrder:i.S.DESC},{displayText:e.leastRecent,sortOrder:i.S.ASC}]:(0,i.i)(n)&&(s=[{displayText:e.highestValue,sortOrder:i.S.DESC},{displayText:e.lowestValue,sortOrder:i.S.ASC}]);const a=s?.map(e=>{const{displayText:t,sortOrder:n}=e;return o.qy`<calcite-chip .label=${n} .selected=${r===n} appearance=outline kind=neutral>${t}</calcite-chip>`});return a&&a.length>0?o.qy`<calcite-chip-group class="sort-order-chip-group" .label=${e.sortOrder} selection-mode=single-persist @calciteChipGroupSelect=${e=>{const t=e.target.selectedItems.map(e=>e.label);this.selectedSortOrder=t[0]}}>${a}</calcite-chip-group>`:null}}(0,n.c)("arcgis-imagery-item-sort-popover",c)},6295:(e,t,r)=>{r.d(t,{A:()=>i,I:()=>s,S:()=>o,a:()=>$,b:()=>T,c:()=>b,d:()=>f,e:()=>w,f:()=>l,g:()=>h,h:()=>x,i:()=>m,j:()=>g,k:()=>E,l:()=>C,m:()=>p,n:()=>F,o:()=>I,p:()=>y,q:()=>a,r:()=>v,s:()=>d});var n=r(2797),i=(e=>(e.VISIBLE="visible",e.DISPLAY_EXTENT="displayExtent",e.ALL="all",e))(i||{}),s=(e=>(e.ALL="all",e.SELECT="select",e))(s||{}),o=(e=>(e.ASC="asc",e.DESC="desc",e))(o||{}),a=(e=>(e.BRAND="brand",e.DANGER="danger",e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e))(a||{});function l(e){return"object"==typeof e&&null!==e&&"name"in e&&"AbortError"===e.name}const c=new Set(["single","double"]),u=new Set(["small-integer","big-integer","integer","oid",...c]),d=new Set([...u,"date","string"]);function m(e){return u.has(e)}function p(e){return c.has(e)}function f(e){return!!e?.domain?.codedValues}function g(e){return f(e)&&"MosaicCatalogItemCategoryDomain"===e?.domain?.name}function h(e,t=!1){if(!e)return null;const r=new Date(e),n=t?r.getUTCFullYear():r.getFullYear(),i=t?r.getUTCMonth():r.getMonth(),s=t?r.getUTCDate():r.getDate(),o=t?r.getUTCHours():r.getHours(),a=t?r.getUTCMinutes():r.getMinutes(),l=t?r.getUTCSeconds():r.getSeconds();return`${n}-${S((i+1).toString(),2,"0")}-${S(s.toString(),2,"0")} ${S(o.toString(),2,"0")}:${S(a.toString(),2,"0")}:${S(l.toString(),2,"0")}`}function S(e,t,r){for(r=r||" ";e.length<t;)e=r+e;return e}function y(e,t,r){return e+t-1>r?r:e+t-1}function w(e,t,r="en"){return"string"==typeof e&&"string"==typeof t?e.localeCompare(t,r):e<t?-1:e>t?1:0}function b(e,t){if(!e||!t)return;let r=t.assetsPath;r.endsWith("/")||(r+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${r}esri/themes/light/main.css" />`)}function $(e,t){return`${e} IN (${t.map(e=>`${e}`).join(",")})`}const x=(e,t="en")=>{const r=e.toString();if(r.includes("e")){const[e,t]=r.split("e"),n=Math.max(0,e.length-2),i=Number.parseInt(t,10);return i<0?n-i:Math.max(0,n-i)}const n=r.indexOf(".");if(-1===n)return 0;const i=r.length-n-1;return new Intl.NumberFormat(t).formatToParts(1.1).find(e=>"decimal"===e.type)?i:0};function I(e){e?.remove()}function E(e,t){const r=Math.pow(10,t);return Math.floor(e*r)/r}function C(e,t){const r=Math.pow(10,t);return Math.ceil(e*r)/r}function v(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}function F(e,t){if(null==e)return"";const r=x(e),i=n.convertNumberFormatToIntlOptions({...r>0&&{places:t&&t>0?Math.min(t,r):r,style:"decimal"},digitSeparator:!0});return n.formatNumber(e,i)}function T(e,t){return null==e?"":"date"===t?n.formatDate(e):m(t)&&"oid"!==t?F(e,4):e.toString()}}}]);