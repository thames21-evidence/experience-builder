System.register(["jimu-core/emotion","jimu-core","jimu-core/react","jimu-ui","jimu-ui/advanced/setting-components","calcite-components","jimu-arcgis","jimu-ui/basic/list-tree"],function(e,t){var a={},i={},n={},l={},r={},o={},s={},c={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.ReactRedux=e.ReactRedux,i.SupportedJSAPILayerTypes=e.SupportedJSAPILayerTypes,i.css=e.css,i.hooks=e.hooks},function(e){n.Fragment=e.Fragment,n.useCallback=e.useCallback,n.useEffect=e.useEffect,n.useRef=e.useRef,n.useState=e.useState},function(e){l.Alert=e.Alert,l.Label=e.Label,l.Switch=e.Switch,l.defaultMessages=e.defaultMessages},function(e){r.JimuLayerViewSelector=e.JimuLayerViewSelector,r.MapWidgetSelector=e.MapWidgetSelector,r.SettingRow=e.SettingRow,r.SettingSection=e.SettingSection,r.SidePopper=e.SidePopper},function(e){o.CalciteInputNumber=e.CalciteInputNumber},function(e){s.MapViewManager=e.MapViewManager},function(e){c.List=e.List}],execute:function(){e((()=>{var e={2529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},2686:e=>{"use strict";e.exports=s},3195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},3303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},4321:e=>{"use strict";e.exports=l},7386:e=>{"use strict";e.exports=a},8640:e=>{"use strict";e.exports=c},8972:e=>{"use strict";e.exports=n},9037:e=>{"use strict";e.exports=o},9244:e=>{"use strict";e.exports=i},9298:e=>{"use strict";e.exports=r}},t={};function u(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,u),n.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var d={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(d),u.d(d,{__set_webpack_public_path__:()=>V,default:()=>L});var e=u(7386),t=u(9244),a=u(8972),i=u(4321),n=u(9298),l=u(9037),r=u(2686),o=function(e,t,a,i){return new(a||(a=Promise))(function(n,l){function r(e){try{s(i.next(e))}catch(e){l(e)}}function o(e){try{s(i.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,o)}s((i=i.apply(e,t||[])).next())})};const s=e=>{if(!((null==e?void 0:e.type)===t.SupportedJSAPILayerTypes.ImageryLayer))return!1;const{capabilities:a}=e.sourceJSON||{};return"string"==typeof a&&a.split(",").map(e=>e.trim()).includes("Catalog")},c=(e="",t="")=>`${e}-${t}`,g=e=>!s(e.layer),m=(e,t)=>{var a;return(null===(a=null==t?void 0:t[e])||void 0===a?void 0:a.isEnabled)||!1},p=(e,t)=>o(void 0,void 0,void 0,function*(){const a=((e,t)=>{var a;return null===(a=null==t?void 0:t[e])||void 0===a?void 0:a.selectedLayerViewIds})(e,t);return(yield h(e)).filter(e=>a.includes(e))}),h=e=>o(void 0,void 0,void 0,function*(){const t=yield(e=>o(void 0,void 0,void 0,function*(){var t;if(!e)return{};const a=r.MapViewManager.getInstance().getJimuMapViewById(e);return yield null==a?void 0:a.whenJimuMapViewLoaded(),null!==(t=null==a?void 0:a.jimuLayerViews)&&void 0!==t?t:{}}))(e),a=Object.keys(t);yield Promise.allSettled(a.map(e=>t[e].layer.load()));return a.filter(e=>s(t[e].layer))}),S={customizeLayer:"Customize layers",selectLayers:"Select layers",noDataSourceWarning:"The selected Map widget does not contain a Web Map or a Web Scene.",attributeFilter:"Attribute filter",spatialFilter:"Spatial filter",imageTypeFilter:"Image type filter",listSettings:"List settings",viewImageDetails:"View image details",resultStyle:"Result style",showOnMap:"Show on map",maxImageItemCountPerPage:"Max number of images per page"};var v=function(e,t,a,i){return new(a||(a=Promise))(function(n,l){function r(e){try{s(i.next(e))}catch(e){l(e)}}function o(e){try{s(i.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,o)}s((i=i.apply(e,t||[])).next())})};const b=l=>{const{jimuMapViewId:r,dataSourceId:s,settingProps:{id:c,config:u,onSettingChange:d}}=l,[b,f]=(0,a.useState)([]),w=m(r,u.customizeLayersOptions);(0,a.useEffect)(()=>{v(void 0,void 0,void 0,function*(){const e=yield((e,t)=>o(void 0,void 0,void 0,function*(){return e?m(e,t)?p(e,t):h(e):[]}))(r,u.customizeLayersOptions);f(e)})},[r,w]);const x=t.hooks.useTranslation(S),y=((e="")=>{var a,i;const n=t.DataSourceManager.getInstance().getDataSource(e);return null!==(i=null!==(a=null==n?void 0:n.getLabel())&&void 0!==a?a:null==n?void 0:n.getDataSourceJson().sourceLabel)&&void 0!==i?i:e})(s);return(0,e.jsxs)(a.Fragment,{children:[(0,e.jsx)(n.SettingRow,{tag:"label",label:x("customizeLayer"),className:"w-100 pl-4 pr-4",children:(0,e.jsx)(i.Switch,{checked:w,"aria-label":x("customizeLayer"),onChange:e=>{const t=e.target.checked;d({id:c,config:u.setIn(["customizeLayersOptions",r],{isEnabled:t,selectedLayerViewIds:t?b:[]})})}})}),w&&(0,e.jsxs)(a.Fragment,{children:[(0,e.jsx)(n.SettingRow,{className:"w-100 pl-4 pr-4",label:y,"aria-label":y}),(0,e.jsx)("div",{className:"select-jimu-layer-view-selector-container p-4",children:(0,e.jsx)(n.JimuLayerViewSelector,{isMultiSelection:!0,jimuMapViewId:r,selectedValues:b,onChange:e=>{f(e),d({id:c,config:u.setIn(["customizeLayersOptions",r],{isEnabled:!0,selectedLayerViewIds:e})})},hideLayers:g})})]})]})};var f=u(8640),w=u(3195),x=u.n(w),y=u(2529),j=u.n(y),I=u(3303),M=u.n(I),C=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const k=l=>{var o,s;const{mapWidgetId:u,sidePopperContent:d,onClick:g,"aria-describedby":m=""}=l,p=C(l,["mapWidgetId","sidePopperContent","onClick","aria-describedby"]),h=(0,a.useRef)(""),v=(0,a.useRef)(null),[b,w]=(0,a.useState)(!1),[y,I]=(0,a.useState)(null),[k,L]=(0,a.useState)(!1),V=t.ReactRedux.useSelector(e=>{var t,a,i;const n=e.appStateInBuilder;return n&&(null===(i=null===(a=null===(t=null==n?void 0:n.appConfig)||void 0===t?void 0:t.widgets)||void 0===a?void 0:a[u])||void 0===i?void 0:i.useDataSources)}),P=t.ReactRedux.useSelector(e=>{const t=e.appStateInBuilder;return t&&(null==t?void 0:t.dataSourcesInfo)},(e,t)=>{if(V){for(const a of V)if(e&&t&&e[a.dataSourceId]!==t[a.dataSourceId])return!1;return!0}return!0}),R=t.hooks.useTranslation(i.defaultMessages,S);(0,a.useEffect)(()=>{if(k)return;if(!V||0===(null==V?void 0:V.length))return void L(!0);const e=null==V?void 0:V.every(e=>{const a=null==P?void 0:P[e.dataSourceId];return a&&(a.instanceStatus===t.DataSourceStatus.Created||a.instanceStatus===t.DataSourceStatus.CreateError)});L(e)},[k,P,V]);const F=(0,a.useCallback)(()=>{const t=[];for(let e=0;e<2;e++)t.push({itemKey:e.toString(),itemStateCommands:[{iconProps:()=>({icon:" ",size:12,style:{opacity:0}})}]});return(0,e.jsx)(f.List,{className:"w-100",itemsJson:t,dndEnabled:!1})},[]),N=null===(s=null===(o=null==V?void 0:V.asMutable())||void 0===o?void 0:o.sort((e,t)=>e.dataSourceId.localeCompare(t.dataSourceId)))||void 0===s?void 0:s.map(e=>{var a,i,n,l;const o=e.dataSourceId,s=t.DataSourceManager.getInstance().getDataSource(o),d=c(u,o),g=r.MapViewManager.getInstance().getJimuMapViewById(d),m="3d"===(null===(a=null==g?void 0:g.view)||void 0===a?void 0:a.type);let p=null;if(s){p={itemStateTitle:null!==(l=null!==(i=s.getLabel())&&void 0!==i?i:null===(n=s.getDataSourceJson())||void 0===n?void 0:n.sourceLabel)&&void 0!==l?l:o,itemKey:o,itemStateIcon:{icon:m?j():x()},itemStateCommands:[{label:R("selectLayers"),iconProps:()=>({icon:M()})}]}}else p={itemStateTitle:R("none"),itemKey:o,itemStateDisabled:!0};return p}),O=(0,a.useCallback)((e,t)=>{const{itemJsons:a}=t.props,i=a[0],n=N.findIndex(e=>e.itemKey===i.itemKey),l=v.current.querySelectorAll(".jimu-tree-item__body")[n];I(l),g&&g(i.itemKey),h.current=h.current!==i.itemKey?i.itemKey:"",w(h.current===i.itemKey)},[N,g]);return(0,e.jsx)("div",{ref:v,className:"w-100 multiple-jimu-map-config-component",css:t.css`
    .jimu-tree-main {
      padding-top: 2px;
    }
    .jimu-tree-item {
      padding: 2px;
    }
    .jimu-tree-item__icon {
      width: 1rem;
      height: 1rem;
      margin-right: 0.5rem;
      svg {
        margin-right: 0!important;
      }
    }
    .jimu-tree-item__body {
      background-color: transparent!important;
    }
  `,"aria-describedby":m,children:k?(0,e.jsxs)(a.Fragment,{children:[(0,e.jsx)(f.List,Object.assign({},p,{itemsJson:N,onClickItemCommand:O})),(0,e.jsx)(n.SidePopper,{position:"right",isOpen:b,toggle:()=>{w(!1),h.current="",null==v||v.current.focus()},title:R("selectLayers"),trigger:null==v?void 0:v.current,backToFocusNode:y,children:d})]}):F()})},L=o=>{var s;const{id:u,config:d,useMapWidgetIds:g,onSettingChange:m}=o,[p,h]=(0,a.useState)(""),[v,f]=(0,a.useState)(!0),w=t.hooks.useTranslation(i.defaultMessages,S),x=(e,t)=>{m({id:u,config:d.set(e,t)})},y=e=>{const t=e.target,a="string"==typeof t.value&&""!==t.value.trim()&&Number.isInteger(Number(t.value))?parseInt(t.value):"";m({id:u,config:d.set("maxImageItemCountPerPage",a)})},j=(null==g?void 0:g.length)>0,I=null!==(s=null==g?void 0:g[0])&&void 0!==s?s:"",M=(e=>{var t,a,i;if(!e)return!0;const n=null===(t=r.MapViewManager.getInstance().getJimuMapViewGroup(e))||void 0===t?void 0:t.jimuMapViews;return!n||1===Object.keys(n).length&&!(null===(i=null===(a=Object.values(n))||void 0===a?void 0:a[0])||void 0===i?void 0:i.dataSourceId)})(I),C=c(I,p);return(0,e.jsxs)(a.Fragment,{children:[(0,e.jsxs)(n.SettingSection,{title:w("selectMapWidget"),children:[(0,e.jsx)(n.SettingRow,{className:"w-100","aria-label":w("selectMapWidget"),children:(0,e.jsx)(n.MapWidgetSelector,{useMapWidgetIds:g,onSelect:e=>{m({id:u,useMapWidgetIds:e})}})}),j&&(0,e.jsx)(n.SettingRow,{className:"w-100 mt-4","aria-label":w("selectLayers"),children:M?(0,e.jsx)(i.Alert,{type:"warning",text:w("noDataSourceWarning"),closable:!1,withIcon:!1,"aria-label":w("noDataSourceWarning")}):(0,e.jsx)(k,{mapWidgetId:null==g?void 0:g[0],sidePopperContent:(0,e.jsx)(b,{jimuMapViewId:C,dataSourceId:p,settingProps:o}),onClick:h,"aria-label":w("selectLayers")})})]}),(0,e.jsx)(n.SettingSection,{title:w("tools"),children:(0,e.jsxs)(a.Fragment,{children:[(0,e.jsx)(n.SettingRow,{tag:"label",label:w("filter"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:v,onChange:e=>{var t;t=e.target.checked,f(t),t||m({id:u,config:d.set("enableAttributeFilter",!1).set("enableSpatialFilter",!1).set("enableImageTypeFilter",!1)})}})}),v&&(0,e.jsxs)("div",{className:"d-flex flex-column pt-4 pb-4 pl-4",children:[(0,e.jsx)(n.SettingRow,{tag:"label",label:w("attributeFilter"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:d.enableAttributeFilter,onChange:e=>{x("enableAttributeFilter",e.target.checked)},defaultChecked:d.enableAttributeFilter})}),(0,e.jsx)(n.SettingRow,{tag:"label",label:w("spatialFilter"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:d.enableSpatialFilter,onChange:e=>{x("enableSpatialFilter",e.target.checked)},defaultChecked:d.enableSpatialFilter})}),(0,e.jsx)(n.SettingRow,{tag:"label",label:w("imageTypeFilter"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:d.enableImageTypeFilter,onChange:e=>{x("enableImageTypeFilter",e.target.checked)},defaultChecked:d.enableImageTypeFilter})})]}),(0,e.jsx)(n.SettingRow,{tag:"label",label:w("sort"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:d.enableSort,onChange:e=>{x("enableSort",e.target.checked)},defaultChecked:d.enableSort})}),(0,e.jsx)(n.SettingRow,{tag:"label",label:w("listSettings"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:d.enableListSettings,onChange:e=>{x("enableListSettings",e.target.checked)},defaultChecked:d.enableListSettings})})]})}),(0,e.jsxs)(n.SettingSection,{title:w("options"),children:[(0,e.jsx)(n.SettingRow,{tag:"label",label:w("viewImageDetails"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:d.enableViewImageDetails,onChange:e=>{x("enableViewImageDetails",e.target.checked)},defaultChecked:d.enableViewImageDetails})}),(0,e.jsx)(n.SettingRow,{tag:"label",label:w("SelectionZoomTo"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:d.enableZoomTo,onChange:e=>{x("enableZoomTo",e.target.checked)},defaultChecked:d.enableZoomTo})}),(0,e.jsx)(n.SettingRow,{tag:"label",label:w("showOnMap"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:d.enableAddToMap,onChange:e=>{x("enableAddToMap",e.target.checked)},defaultChecked:d.enableAddToMap})})]}),(0,e.jsxs)(n.SettingSection,{title:w("resultStyle"),children:[(0,e.jsx)(i.Label,{"aria-label":w("maxImageItemCountPerPage"),children:w("maxImageItemCountPerPage")}),(0,e.jsx)(l.CalciteInputNumber,{value:d.maxImageItemCountPerPage.toString(),onCalciteInputNumberChange:y,onCalciteInputNumberInput:y,integer:!0})]})]})};function V(e){u.p=e}})(),d})())}}});