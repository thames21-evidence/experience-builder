System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","jimu-ui","jimu-ui/advanced/chart-engine","esri/layers/GraphicsLayer","esri/geometry/Polygon","esri/request","esri/portal/PortalItem","esri/widgets/Sketch/SketchViewModel","esri/core/reactiveUtils","esri/layers/ImageryLayer","esri/layers/support/RasterFunction","esri/PopupTemplate","esri/portal/Portal"],function(e,l){var t={},r={},a={},o={},n={},i={},s={},u={},c={},d={},h={},g={},p={},w={},m={};return{setters:[function(e){t.jsx=e.jsx,t.jsxs=e.jsxs},function(e){r.React=e.React,r.classNames=e.classNames,r.css=e.css},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){o.Alert=e.Alert,o.AlertPopup=e.AlertPopup,o.Button=e.Button,o.ButtonGroup=e.ButtonGroup,o.Checkbox=e.Checkbox,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.Form=e.Form,o.FormGroup=e.FormGroup,o.Icon=e.Icon,o.Label=e.Label,o.NumericInput=e.NumericInput,o.Select=e.Select,o.Slider=e.Slider,o.Tab=e.Tab,o.Tabs=e.Tabs,o.TextArea=e.TextArea,o.TextInput=e.TextInput},function(e){n.DarkThemeAm5=e.DarkThemeAm5,n.LegendAm5=e.LegendAm5,n.PieChartAm5=e.PieChartAm5,n.PieSeriesAm5=e.PieSeriesAm5,n.ResponsiveThemeAm5=e.ResponsiveThemeAm5,n.ScrollbarAm5=e.ScrollbarAm5,n.TooltipAm5=e.TooltipAm5,n.colorAm5=e.colorAm5,n.createRoot=e.createRoot,n.percentAm5=e.percentAm5},function(e){i.default=e.default},function(e){s.default=e.default},function(e){u.default=e.default},function(e){c.default=e.default},function(e){d.default=e.default},function(e){h.watch=e.watch,h.whenOnce=e.whenOnce},function(e){g.default=e.default},function(e){p.default=e.default},function(e){w.default=e.default},function(e){m.default=e.default}],execute:function(){e((()=>{var e={6803:e=>{"use strict";e.exports=c},10540:e=>{"use strict";e.exports=function(e){var l=document.createElement("style");return e.setAttributes(l,e.attributes),e.insert(l,e.options),l}},10624:e=>{"use strict";e.exports=d},14321:e=>{"use strict";e.exports=o},19025:e=>{"use strict";e.exports=w},31526:e=>{"use strict";e.exports=s},31579:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0L6 2.982v2.162h.91l-.001-1.49 8.182-2.44v8.882H8.434V11zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},31601:e=>{"use strict";e.exports=function(e){return e[1]}},41113:e=>{"use strict";e.exports=function(e,l){if(l.styleSheet)l.styleSheet.cssText=e;else{for(;l.firstChild;)l.removeChild(l.firstChild);l.appendChild(document.createTextNode(e))}}},43315:e=>{"use strict";e.exports=p},51993:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 1.914 6.475 2.94a.5.5 0 1 1-.707-.707L8 0l2.157 2.157a.5.5 0 0 1-.707.707l-.95-.95V7.5h5.586l-1.1-1.1a.5.5 0 1 1 .706-.708L16 8l-2.232 2.232a.5.5 0 1 1-.707-.707L14.086 8.5H8.5v5.586l1.025-1.025a.5.5 0 1 1 .707.707L8 16l-2.308-2.308a.5.5 0 1 1 .707-.707l1.101 1.1V8.5H1.914l.95.95a.5.5 0 0 1-.707.707L0 8l2.232-2.232a.5.5 0 1 1 .707.707L1.914 7.5H7.5z" clip-rule="evenodd"></path></svg>'},53245:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 16"><g fill="#FFF" fill-rule="evenodd"><path d="M7.085 1a1.5 1.5 0 0 1 2.83 0H14v1H9.915a1.5 1.5 0 0 1-2.83 0H0V1zM1.085 7a1.5 1.5 0 0 1 2.83 0H8v1H3.915a1.5 1.5 0 0 1-2.83 0H0V7zM3.085 14H0v-1h3.085a1.5 1.5 0 0 1 2.83 0H8v1H5.915a1.5 1.5 0 0 1-2.83 0M13.987 15.13a.784.784 0 0 0 1.06.267l1.444-.845a.793.793 0 0 0 .256-1.125l-.945-1.506 1.13-.321a.8.8 0 0 0 .561-.657.79.79 0 0 0-.367-.78L11.72 6.63a.78.78 0 0 0-.822-.023.8.8 0 0 0-.397.69v6.267c0 .296.162.56.417.7a.79.79 0 0 0 .856-.072l1.097-.83zm.9-3.989-.64.183 1.553 2.473-1.075.63-1.3-2.06-.29-.46-1.635 1.237V7.68l4.717 3.084z"></path></g></svg>'},53640:e=>{"use strict";e.exports=u},55056:(e,l,t)=>{"use strict";e.exports=function(e){var l=t.nc;l&&e.setAttribute("nonce",l)}},59620:e=>{"use strict";e.exports=i},62243:e=>{"use strict";e.exports=h},62686:e=>{"use strict";e.exports=a},67386:e=>{"use strict";e.exports=t},70043:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.087 4.35C11.087 1.557 10.04 0 8.22 0c-1.095 0-2.323.748-3.72 2.204l.69.732.215-.22C6.542 1.584 7.49 1.033 8.221 1.033c1.19 0 1.884 1.032 1.884 3.319 0 .87.35 1.453.997 1.729.358.152.682.199 1.301.207l.787.002c.923.018 1.21.146 1.305.553.207.89-1.364 1.958-4.88 2.98l-.64.179.245.999.325-.09c4.285-1.199 6.313-2.554 5.903-4.313-.232-.997-.788-1.284-2.04-1.333l-.396-.009h-.55c-.518-.005-.772-.038-.99-.131-.266-.114-.386-.312-.386-.773M.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},71904:e=>{"use strict";e.exports=m},76314:e=>{"use strict";e.exports=function(e){var l=[];return l.toString=function(){return this.map(function(l){var t="",r=void 0!==l[5];return l[4]&&(t+="@supports (".concat(l[4],") {")),l[2]&&(t+="@media ".concat(l[2]," {")),r&&(t+="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {")),t+=e(l),r&&(t+="}"),l[2]&&(t+="}"),l[4]&&(t+="}"),t}).join("")},l.i=function(e,t,r,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(r)for(var i=0;i<this.length;i++){var s=this[i][0];null!=s&&(n[s]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&n[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),l.push(c))}},l}},77659:e=>{"use strict";var l={};e.exports=function(e,t){var r=function(e){if(void 0===l[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}l[e]=t}return l[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}},79244:e=>{"use strict";e.exports=r},85072:e=>{"use strict";var l=[];function t(e){for(var t=-1,r=0;r<l.length;r++)if(l[r].identifier===e){t=r;break}return t}function r(e,r){for(var o={},n=[],i=0;i<e.length;i++){var s=e[i],u=r.base?s[0]+r.base:s[0],c=o[u]||0,d="".concat(u," ").concat(c);o[u]=c+1;var h=t(d),g={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==h)l[h].references++,l[h].updater(g);else{var p=a(g,r);r.byIndex=i,l.splice(i,0,{identifier:d,updater:p,references:1})}n.push(d)}return n}function a(e,l){var t=l.domAPI(l);t.update(e);return function(l){if(l){if(l.css===e.css&&l.media===e.media&&l.sourceMap===e.sourceMap&&l.supports===e.supports&&l.layer===e.layer)return;t.update(e=l)}else t.remove()}}e.exports=function(e,a){var o=r(e=e||[],a=a||{});return function(e){e=e||[];for(var n=0;n<o.length;n++){var i=t(o[n]);l[i].references--}for(var s=r(e,a),u=0;u<o.length;u++){var c=t(o[u]);0===l[c].references&&(l[c].updater(),l.splice(c,1))}o=s}}},90379:e=>{"use strict";e.exports=g},95080:e=>{"use strict";e.exports=n},95852:(e,l,t)=>{"use strict";t.d(l,{A:()=>i});var r=t(31601),a=t.n(r),o=t(76314),n=t.n(o)()(a());n.push([e.id,'.widget-wro{padding:0px;width:100%;height:100%;color:var(--sys-color-surface-paper-text);background-color:var(--sys-color-surface-paper)}.widget-wro-loading-msg{margin:4px 6px}.widget-wro-loading-error-msg{margin:4px 6px;font-style:italic}.widget-wro-modeler{display:flex;flex-direction:column;width:100%;height:100%}.widget-wro-header{margin:10px 10px 5px;font-weight:bold}.widget-wro-body{flex:1 1 auto;overflow:hidden}.widget-wro-tabs{width:100%;height:100%}.widget-wro-tabs>.tab-nav{border-bottom:none}.widget-wro-tabs>.tab-content{width:100%;height:calc(100% - 71px)}.widget-wro-tabs .nav-item{width:33.33%;height:70px}.widget-wro-tabs .nav-item .nav-link.jimu-link{display:flex;flex-direction:column;justify-content:space-around;padding-left:.5rem;padding-right:.5rem;position:relative;border:none !important}.widget-wro-tabs .nav-item .jimu-link:before{width:24px;height:24px;border-radius:50px;z-index:1;color:var(--sys-color-primary);background-color:var(--sys-color-surface-paper);border:2px solid var(--sys-color-primary)}.widget-wro-tabs .nav-item .jimu-link.active:before{background-color:var(--sys-color-primary);color:var(--sys-color-surface-paper);border-color:var(--sys-color-primary)}.widget-wro-tabs .nav-item .jimu-link.disabled:before{background-color:var(--sys-color-action-disabled);color:var(--sys-color-action-disabled-text);border-color:var(--sys-color-action-disabled-text)}.widget-wro-tabs .nav-item:first-of-type .jimu-link:before{content:"1"}.widget-wro-tabs .nav-item:nth-of-type(2) .jimu-link:before{content:"2"}.widget-wro-tabs .nav-item:nth-of-type(3) .jimu-link:before{content:"3"}.widget-wro-tabs .nav-item .jimu-link:after{content:" ";width:100%;height:3px;background:var(--sys-color-primary);position:absolute;top:20px;z-index:0}.widget-wro-tabs .nav-item .jimu-link.active:after{background:var(--sys-color-primary)}.widget-wro-tabs .nav-item .jimu-link.disabled:after{background:var(--sys-color-action-disabled)}.widget-wro-tabs .nav-item .jimu-link.disabled{cursor:not-allowed}.widget-wro-tabs .nav-item .tab-title{color:var(--sys-color-surface-paper-text)}.widget-wro-tabs .nav-item .jimu-link.disabled .tab-title{color:var(--sys-color-action-disabled-text)}.widget-wro-layers-panel,.widget-wro-model-panel,.widget-wro-chart-panel{width:100%;height:100%}.widget-wro-panel-header{padding:10px;font-size:14px;font-weight:bold;line-height:32px;height:52px}.widget-wro-layers-panel{display:flex;flex-direction:column;width:100%;height:100%}.widget-wro-layers-body{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:auto}.widget-wro-layers-list{flex:1 1 auto;margin:0;padding:10px;padding-top:4px;list-style-type:none;overflow:auto}.widget-wro-layers-buttons{padding:1rem 0rem;display:flex;flex-direction:row-reverse;justify-content:space-between}.widget-wro-nav-buttons{padding:.5rem 0rem 1rem;display:flex;flex-direction:row-reverse;justify-content:space-between;width:100%}.widget-wro-layers-buttons .btn-group,.widget-wro-layers-buttons .btn-group .btn{width:100%}.widget-wro-layers-buttons .btn-group .btn svg{margin-left:.5rem;margin-right:.5rem;vertical-align:middle}.widget-wro-nav-btn{display:flex;align-items:center}.widget-wro-nav-btn.jimu-btn .jimu-icon{margin:0px 6px}.widget-wro-layer-title{margin:0 8px}.widget-wro-layer-select-all{margin:0 8px;font-weight:bold}.widget-wro-layer-select-all-label{margin-bottom:.1rem}.widget-wro-model-panel{display:flex;flex-direction:column;width:100%;height:100%}.widget-wro-model-panel-body{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:auto}.widget-wro-model-layers-list{flex:1 1 auto;margin:0;padding:0px;padding-top:4px;list-style-type:none;overflow:auto}.widget-wro-model-item{display:flex;align-items:center;justify-content:space-between;margin:6px 10px}.widget-wro-model-item-label{display:flex}.widget-wro-model-item-input-section{display:flex;align-items:center;margin:0 .3rem}.widget-wro-model-item-remap-btn{margin:0 6px}.widget-wro-model-item-percent{display:inline-block;width:1rem;text-align:center}.widget-wro-model-total{padding:10px;display:flex;justify-content:space-between;font-weight:bold;border-top:1px solid var(--sys-color-divider-primary);border-bottom:1px solid var(--sys-color-divider-primary)}.widget-wro-model-buttons{padding:1rem}.widget-wro-model-buttons .btn-group{width:100%;display:flex;justify-content:flex-end}.widget-wro-model-buttons .btn-group .btn{width:33%;margin-left:6px;margin-right:6px}.widget-wro-model-buttons .alert-panel{width:100%;margin-top:1rem}.widget-wro-input-weight{width:2.6rem}.widget-wro-remap-panel{color:var(--sys-color-surface-footer-text);background-color:var(--sys-color-surface-footer);padding:8px 18px;position:relative}.widget-wro-remap-panel:after{content:"";width:0px;height:0px;position:absolute;top:-10px;right:86px;border:5px solid transparent;border-bottom-color:var(--sys-color-surface-footer)}.jimu-rtl .widget-wro-remap-panel:after{right:auto;left:86px}.widget-wro-remap-range{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}.widget-wro-remap-range:last-of-type{margin-bottom:0px}.widget-wro-remap-slider{display:inline-block;width:120px}.widget-wro-remap-range input[type=range]:disabled{opacity:.4}.widget-wro-remap-numeric-input{display:inline-block;width:26px;margin:0 6px;text-align:right}.widget-wro-remap-numeric-input .jimu-numeric-input-input{width:26px}.widget-wro-color-dropdown-menu{max-height:300px;overflow-y:auto}.widget-wro-color-ramp{display:flex;font-size:13px;font-weight:400}.widget-wro-color-ramp .widget-wro-color-ramp-container{display:flex;align-items:center;flex-direction:row}html[dir=rtl] .widget-wro-color-ramp-container{flex-direction:row-reverse}.widget-wro-color-ramp .widget-wro-color-ramp-colors{margin-left:2px;margin-right:2px}.widget-wro-color-ramp .widget-wro-color-ramp-color{display:inline-block;width:5px;height:8px;margin-bottom:2px}.widget-wro-flex-between{display:flex;justify-content:space-between;align-items:center}.widget-wro-flex-column{display:flex;flex-direction:column}.widget-wro-chart-panel{display:flex;flex-direction:column;width:100%;height:100%}.widget-wro-chart-header{padding:10px;font-size:14px;font-weight:bold;line-height:32px}.widget-wro-chart-body{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:auto;padding:10px}.widget-wro-chart-tools{white-space:nowrap}.widget-wro-chart-button{margin-left:.2rem !important;margin-right:.2rem !important;text-decoration:none !important}.widget-wro-chart-select-layer-section{font-weight:normal;margin-top:10px;height:2rem;text-align:center}.widget-wro-chart-note{margin-top:1rem;font-style:italic}.widget-wro-model-working,.widget-wro-chart-working{margin-top:.4rem;font-weight:normal;font-size:smaller;height:.8rem;text-align:center}.widget-wro-chart-warning{margin-top:1rem;font-weight:normal;font-style:italic;height:.8rem;text-align:center}.widget-wro-chart-warning .alert-panel,.widget-wro-chart-note .alert-panel{width:100%;padding:4px 8px !important;line-height:22px}.widget-wro-model-working{margin-top:2px}.widget-wro-chart-component{width:100%;height:100%}.widget-wro-chart-buttons{padding:1rem 0rem;display:flex;justify-content:space-between}.widget-wro-export-popup .modal-content{min-width:400px;margin-bottom:200px}.widget-wro-export-popup.widget-wro-invalid-modal .modal-footer .btn.jimu-button-color-primary{color:var(--sys-color-action-disabled-text);background-color:var(--sys-color-action-disabled);border-color:var(--sys-color-action-disabled);box-shadow:none;pointer-events:none}.widget-wro-form textarea{height:4rem}.widget-wro-fadein{animation:widget-wro-kf-fadein 10s}.widget-wro-alert-container{padding:10px;display:flex;align-items:center;justify-content:center}.widget-wro-alert-container .alert-panel{width:100%}.u-hidden{display:none !important}@keyframes widget-wro-kf-fadein{0%{opacity:0}100%{opacity:1}}@keyframes widget-wro-kf-spinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',""]);const i=n},97825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var l=e.insertStyleElement(e);return{update:function(t){!function(e,l,t){var r="";t.supports&&(r+="@supports (".concat(t.supports,") {")),t.media&&(r+="@media ".concat(t.media," {"));var a=void 0!==t.layer;a&&(r+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),r+=t.css,a&&(r+="}"),t.media&&(r+="}"),t.supports&&(r+="}");var o=t.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),l.styleTagTransform(r,e,l.options)}(l,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(l)}}}},98981:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 1 0 5.5 8 10l8-4.5zm5.96 7.477-.606-.341 1.02-.574L16 8.477l-8 4.5-8-4.5 1.627-.915 1.02.574-.607.341L8 11.83zm2.04 3-1.647-.927-1.02.574.627.353L8 14.83l-5.96-3.353.628-.353-1.02-.574L0 11.477l8 4.5zM8 2.148 2.04 5.5 8 8.853 13.96 5.5z" clip-rule="evenodd"></path></svg>'}},l={};function b(t){var r=l[t];if(void 0!==r)return r.exports;var a=l[t]={id:t,exports:{}};return e[t](a,a.exports,b),a.exports}b.n=e=>{var l=e&&e.__esModule?()=>e.default:()=>e;return b.d(l,{a:l}),l},b.d=(e,l)=>{for(var t in l)b.o(l,t)&&!b.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:l[t]})},b.o=(e,l)=>Object.prototype.hasOwnProperty.call(e,l),b.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},b.p="",b.nc=void 0;var v={};return b.p=window.jimuConfig.baseUrl,(()=>{"use strict";b.r(v),b.d(v,{__set_webpack_public_path__:()=>Ve,default:()=>De});var e=b(67386),l=b(79244);const t={_widgetLabel:"Suitability Modeler",wro_general_back:"Back",wro_general_cancel:"Cancel",wro_general_clear:"Clear",wro_general_close:"Close",wro_general_export:"Export",wro_general_information:"Information",wro_general_loading:"Loading...",wro_general_next:"Next",wro_general_run:"Run",wro_general_save:"Save",wro_general_saveAs:"Save As",wro_general_warning:"Warning",wro_step_1:"1",wro_step_2:"2",wro_step_3:"3",wro_tabs_layers:"Layers",wro_tabs_model:"Model",wro_tabs_chart:"Chart",wro_main_modelIssue:"Model Issue",wro_main_runError:"Error running model",wro_main_caption:"Suitability Modeler",wro_main_browsePrompt:"Weighted overlay service",wro_main_selectLayersCaption:"Select layers",wro_main_selectLayers:"Layers",wro_main_designModelCaption:"Design model",wro_main_designModel:"Design model",wro_main_transparency:"Transparency",wro_main_visible:"Visible",wro_main_total:"Total",wro_main_unableToLoad:"Unable to load model.",wro_main_setSymbology:"Set symbology",wro_main_setScores:"Set scores",wro_layers_selectAll:"Select All",wro_remap_label:"{name} ({minmax})",wro_remap_label_noRange:"{name}",wro_popup_score:"This model has a score of {score} at the selected location.",wro_popup_layers:"The model is based on the following layers:",wro_popup_weight:"weight",wro_saveModel_save:"Export",wro_saveModel_title:"Title",wro_saveModel_titleRequired:"Title (required)",wro_saveModel_summary:"Summary",wro_saveModel_description:"Description",wro_saveModel_tags:"Tags",wro_saveModel_folder:"Folder",wro_saveModel_homeFolderPattern:"{username} (Home)",wro_saveModel_failed:"Export failed.",wro_saveModel_success_msg:"Model exported successfully.",wro_saveModel_failed_msg:"Failed to export model.",wro_chart_prompt:"Features",wro_chart_generate:"Generate chart",wro_chart_working:"Updating...",wro_chart_polygonTool:"Draw a polygon",wro_chart_freehandPolygonTool:"Draw a freehand polygon",wro_chart_selectTool:"Select from a layer",wro_chart_zoomPanTool:"Pan",wro_chart_clearButton:"Clear",wro_chart_selectLayerPlaceholder:"Choose a layer",wro_chart_noSubjectLayers:"Your map has no polygon layers.",wro_chart_noModelLayer:"The model hasn't been run",wro_chart_tipPattern:"{category} - {label}: {percent}%",wro_chart_tipPattern2:"{category}: {percent}%",wro_chart_labelPattern:"{category} - {label}",wro_chart_noData:"No model results within chart area, please create a new selection.",wro_colorRamp_low:"Low",wro_colorRamp_high:"High",wro_colorRamp_tipPattern:"{label} ({value})",wro_colorRamp_flipCaption:"Flip",wro_colorRamp_1:"Extremely Low",wro_colorRamp_2:"Very Low",wro_colorRamp_3:"Low",wro_colorRamp_4:"Low Medium",wro_colorRamp_5:"Medium",wro_colorRamp_6:"High Medium",wro_colorRamp_7:"High",wro_colorRamp_8:"Very High",wro_colorRamp_9:"Extremely High",wro_1_9_green_yellow_red:"Green Yellow Red",wro_1_9_red_yellow_green:"Red Yellow Green",wro_1_9_yellow_to_dark_red:"Yellow to Dark Red",wro_1_9_dark_red_to_yellow:"Dark Red to Yellow",wro_1_9_light_gray_to_dark_gray:"Light Gray to Dark Gray",wro_1_9_dark_gray_to_light_gray:"Dark Gray to Light Gray",wro_1_9_light_brown_to_dark_brown:"Light Brown to Dark Brown",wro_1_9_dark_brown_to_light_brown:"Dark Brown to Light Brown",wro_1_9_full_spectrum_bright_red_to_blue:"Full Spectrum - Bright Red to Blue",wro_1_9_full_spectrum_bright_blue_to_red:"Full Spectrum - Bright Blue to Red",wro_1_9_partial_spectrum_yellow_to_blue:"Partial Spectrum - Yellow to Blue",wro_1_9_partial_spectrum_blue_to_yellow:"Partial Spectrum - Blue to Yellow",wro_1_9_yellow_green_to_dark_blue:"Yellow-Green to Dark Blue",wro_1_9_dark_blue_to_yellow_green:"Dark Blue to Yellow-Green",wro_1_9_cold_to_hot_diverging:"Cold to Hot Diverging",wro_1_9_hot_to_cold_diverging:"Hot to Cold Diverging",wro_1_9_surface_low_to_high:"Surface - Low to High",wro_1_9_surface_high_to_low:"Surface - High to Low",wro_validation_validating:"Validating...",wro_validation_invalidServiceUrl:"The weighted overlay service URL is invalid.",wro_validation_undefinedItemUrl:"This item's URL is not defined.",wro_validation_errorloadingService:"Unable to load service",wro_validation_errorLoadingItem:"Unable to load chart.",wro_validation_errorLoadingItemWithMsg:"Unable to load chart. See server error message ({message}).",wro_validation_errorQueryingLayers:"Unable to query service layers",wro_validation_noLayers:"There are no modeling layers",wro_validation_noModel:"No model",wro_validation_noMap:"No map",wro_validation_notAnImageService:"This item is not an image Service",wro_validation_notAWroService:"This configured item is not a weighted overlay service",wro_validation_notAllowRasterFunction:"allowRasterFunction must be set to true",wro_validation_notNearestResampling:"defaultResamplingMethod must be Nearest",wro_validation_missingFieldPattern:"{field} is a required field",wro_validation_wroServiceNotDefined:"No weighted overlay service was configured"};var r=b(62686),a=b(14321),o=b(31579),n=b.n(o),i=function(e,l){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&l.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)l.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(t[r[a]]=e[r[a]])}return t};const s=t=>{const r=window.SVG,{className:a}=t,o=i(t,["className"]),s=(0,l.classNames)("jimu-icon jimu-icon-component",a);return r?(0,e.jsx)(r,Object.assign({className:s,src:n()},o)):(0,e.jsx)("svg",Object.assign({className:s},o))};var u=b(70043),c=b.n(u),d=function(e,l){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&l.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)l.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(t[r[a]]=e[r[a]])}return t};const h=t=>{const r=window.SVG,{className:a}=t,o=d(t,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",a);return r?(0,e.jsx)(r,Object.assign({className:n,src:c()},o)):(0,e.jsx)("svg",Object.assign({className:n},o))};var g=b(98981),p=b.n(g),w=function(e,l){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&l.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)l.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(t[r[a]]=e[r[a]])}return t};const m=t=>{const r=window.SVG,{className:a}=t,o=w(t,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",a);return r?(0,e.jsx)(r,Object.assign({className:n,src:p()},o)):(0,e.jsx)("svg",Object.assign({className:n},o))};var y=b(51993),f=b.n(y),_=function(e,l){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&l.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)l.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(t[r[a]]=e[r[a]])}return t};const x=t=>{const r=window.SVG,{className:a}=t,o=_(t,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",a);return r?(0,e.jsx)(r,Object.assign({className:n,src:f()},o)):(0,e.jsx)("svg",Object.assign({className:n},o))};var L=b(95080),M=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};class C extends l.React.PureComponent{constructor(e){super(e),this.chartRef=l.React.createRef(),this.state={needsRefresh:!1}}componentDidMount(){this.initChart5()}initChart5(e){return M(this,void 0,void 0,function*(){var l,t;this.dispose();const r=document.createElement("div");r.style.width="100%",r.style.height="100%",this.rootNode=r,this.chartRef.current.appendChild(r);const a=this.props.wroContext.getTheme(),o=!("rtl"!==(null===(l=null===document||void 0===document?void 0:document.documentElement)||void 0===l?void 0:l.dir)),n=null===(t=null===document||void 0===document?void 0:document.documentElement)||void 0===t?void 0:t.lang;let i="{category}",s="{valuePercentTotal.formatNumber('0.00p')}";"ar"===n&&(s="%{valuePercentTotal.formatNumber('#.00')}",i="  {category}"),"tr"===n&&(s="%{valuePercentTotal.formatNumber('#.00')}");const u="dark"===(null==a?void 0:a.sys.color.mode),c=yield(0,L.createRoot)(r,n);c.setThemes(u?[L.ResponsiveThemeAm5.new(c),L.DarkThemeAm5.new(c)]:[L.ResponsiveThemeAm5.new(c)]);const d=c.container.children.push(L.PieChartAm5.new(c,{layout:c.verticalLayout,radius:(0,L.percentAm5)(90)}));this.chart=d;const h=d.series.push(L.PieSeriesAm5.new(c,{name:"Series",categoryField:"label",valueField:"value",legendLabelText:i,legendValueText:s}));h.labels.template.set("forceHidden",!0),h.ticks.template.set("visible",!1),h.slices.template.set("toggleKey","none");const g=L.TooltipAm5.new(c,{getFillFromSprite:!1,labelText:"{category} {valuePercentTotal.formatNumber('0.00p')}",autoTextColor:!1,reverseChildren:!0});g.label.setAll({direction:"rtl"}),g.get("background").setAll({fill:(0,L.colorAm5)(16777215),fillOpacity:1,stroke:(0,L.colorAm5)(0),strokeOpacity:.8}),g.label.setAll({fill:(0,L.colorAm5)(0)}),h.slices.template.set("tooltip",g),e&&h.data.setAll(e),this.series=h;const p=d.children.push(L.LegendAm5.new(c,{centerX:(0,L.percentAm5)(50),x:(0,L.percentAm5)(50),layout:c.verticalLayout,height:(0,L.percentAm5)(100),clickTarget:"none",verticalScrollbar:L.ScrollbarAm5.new(c,{orientation:"vertical"}),maxHeight:130,maxWidth:540}));p.labels.template.setAll({textAlign:o?"right":"left",width:100,maxWidth:250,oversizedBehavior:"wrap"}),p.valueLabels.template.setAll({textAlign:o?"left":"right",width:50,maxWidth:90}),o&&(p.set("reverseChildren",!0),p.itemContainers.template.setAll({reverseChildren:!0})),this.series&&e&&p.data.setAll(this.series.dataItems),this.legend=p,this.root=c})}dispose(){this.root&&(this.root.dispose(),this.series=null,this.chart=null,this.legend=null,this.root=null),this.rootNode&&(this.rootNode.style.display="none",this.rootNode=null)}componentDidUpdate(e){var l;const t=this.props.wroModel,r=e.wroModel,a=t&&"chart-panel"===t.activePanel,o=r&&"chart-panel"===r.activePanel;let n;if(e.histogramData!==this.props.histogramData){n=[];const e=[],l=this.props.histogramData;(null==l?void 0:l.colorCounts)&&l.colorCounts.length>0&&l.colorCounts.forEach(l=>{const t="rgb("+l.rgb[0].toString()+","+l.rgb[1].toString()+","+l.rgb[2].toString()+")",r={label:l.label,value:l.count};e.push(t),n.push(r)}),this.series&&(this.series.get("colors").set("colors",e),this.series.data.setAll(n),this.legend&&this.legend.data.setAll(this.series.dataItems))}e.wroStatus.themeId!==this.props.wroStatus.themeId&&(n||(n=null===(l=this.chart)||void 0===l?void 0:l.data),this.initChart5(n)),a&&!o&&this.state.needsRefresh&&(this.chart,this.setState({needsRefresh:!1})),a||!o||this.state.needsRefresh||this.setState({needsRefresh:!0})}componentWillUnmount(){this.chart&&this.dispose()}render(){return(0,e.jsx)("div",{ref:this.chartRef,className:"widget-wro-chart-component"})}}var S=b(59620),j=b(31526),R=b(53640),N=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};function k(e){return N(this,void 0,void 0,function*(){var l;let t,r;if((null===(l=e.imageLayer)||void 0===l?void 0:l.rasterFunction)&&(t=e.featureSelectionGeometry?yield function(e){return N(this,void 0,void 0,function*(){var l;let t;const r=e.view,a=e.featureMapLayerId,o=e.featureSelectionGeometry,n=a&&(null===(l=null==r?void 0:r.map)||void 0===l?void 0:l.findLayerById(a));if(n&&o&&"function"==typeof n.createQuery&&"function"==typeof n.queryFeatures){I(e,r,n,null);const l=n.createQuery();l.returnGeometry=!0,l.geometry=o;const a=yield n.queryFeatures(l);if(null==a?void 0:a.features){I(e,r,n,a.features);const l=[];a.features.forEach(e=>{e.geometry&&l.push(e.geometry.clone())}),l.length>0&&(t=A(l))}}return t})}(e):yield function(e){var l;let t;const r=e.view,a=e.graphicsMapLayerId,o=a&&(null===(l=null==r?void 0:r.map)||void 0===l?void 0:l.findLayerById(a));if(null==o?void 0:o.graphics){const e=[];o.graphics.forEach(l=>{l.geometry&&"polygon"===l.geometry.type&&e.push(l.geometry.clone())}),e.length>0&&(t=A(e))}return Promise.resolve(t)}(e),t)){const l=yield function(e,l){return N(this,void 0,void 0,function*(){let t;if((null==e?void 0:e.rasterFunction)&&l){const r=`${e.url}/computeHistograms`,a=function(e,l){const t=!0;let r,a,o=0,n=0;const i=e.imageMaxWidth,s=e.imageMaxHeight,u=l.extent;o=u.width,n=u.height,o<1&&(o=1);n<1&&(n=1);const c=Math.ceil(o/i),d=Math.ceil(n/s);t?(r=Math.max(c,d),a={x:r,y:r}):a={x:c,y:d};return a}(e,l),o={f:"json"};o.geometry=JSON.stringify(l.toJSON()),o.geometryType="esriGeometryPolygon",o.renderingRule=JSON.stringify(e.rasterFunction.toJSON()),o.pixelSize=JSON.stringify(a);const n={query:o,responseType:"json"};t=yield(0,R.default)(r,n),t=null==t?void 0:t.data}return t})}(e.imageLayer,t);r=function(e,l){var t;const r=e.wroContext.nls,a={noDataCount:0,colorCounts:[]},o=e.imageLayer,n=null==o?void 0:o.rasterFunction;if(!n||!l||!l.histograms||0===l.histograms.length)return a;const i=l.histograms[0],s=Math.round(i.min),u=Math.round(i.max)-1;0===s&&i.counts>0&&(a.noDataCount=i.counts[0]);let c=0;const d=null===(t=null==n?void 0:n.functionArguments)||void 0===t?void 0:t.Colormap;d&&d.forEach(e=>{let l=0;const t=e[0];let o=null;const n=[e[1],e[2],e[3]];l=t<s||t>u?0:i.counts[t-s],c+=l;const d=r("wro_colorRamp_"+t.toString());d&&(o=r("wro_chart_labelPattern",{category:t.toString(),label:d})),l>0&&a.colorCounts.push({count:l,value:t,pct:0,label:o,rgb:n})});a.noDataCount>0&&(c+=a.noDataCount);c>0&&a.colorCounts.forEach(e=>{const l=e.count/c*100;e.pct=l});return a}(e,l)}return r})}function I(e,l,t,r){return N(this,void 0,void 0,function*(){if(e.highlightHandle&&(e.highlightHandle.remove(),e.highlightHandle=null),r&&r.length>0){const a=yield l.whenLayerView(t);a&&(e.highlightHandle=a.highlight(r))}})}function A(e){let l=null;return e&&1===e.length?l=e[0]:e&&e.length>1&&(l=new j.default({spatialReference:e[0].spatialReference}),e.forEach(e=>{e.rings&&e.rings.forEach(e=>{l.addRing(e)})})),l}var P=b(6803),T=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};function O(e){const l=E(e);return!!(null==l?void 0:l.rasterFunction)}function E(e){const l=e.wroModel,t=e.wroContext.getView();if((null==t?void 0:t.map)&&(null==l?void 0:l.mapLayerId))return t.map.findLayerById(l.mapLayerId)}var D=b(10624),V=b(62243),F=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};class H extends l.React.PureComponent{constructor(e){super(e),this.watchHandles=[],this.activateSketch=(e,l,t)=>{this.cancelSketch();const r="selectLayer"===e,a=this.props.wroContext.getView();if(null==a?void 0:a.map){this.setGraphicsLayerVisibility(this.drawGfxLayerId,!r);const e=r?this.selGfxLayerId:this.drawGfxLayerId,o=this.ensureGraphicsLayer(a,e),n=this.activeSketchViewModel=new D.default({view:a,layer:o});n.on("create",e=>{if("complete"===e.state){if(r){this.clearHighlightHandle();const l=e.graphic.geometry,t=this.newTask(a,l);this.computeHistograms(t),o.remove(e.graphic)}else{e.graphic&&(e.graphic.symbol={type:"simple-fill",color:[0,255,255,.4],style:"solid",outline:{color:[0,0,0,.6],width:1}});const l=this.newTask(a,null);this.computeHistograms(l)}n.create(l,t)}}),n.create(l,t)}},this.cancelSketch=()=>{const e=this.activeSketchViewModel;if(e){try{e.cancel(),e.destroy()}catch(e){console.error("Error canceling SketchViewModel",e)}this.activeSketchViewModel=null}},this.canComputeHistograms=()=>O(this.props),this.clearHandles=e=>{Array.isArray(e)&&e.forEach(e=>{try{e&&e.remove()}catch(e){console.error(e)}})},this.clearHighlightHandle=()=>{this.clearHandles([this.highlightHandle]),this.highlightHandle=null},this.computeHistograms=e=>F(this,void 0,void 0,function*(){this.clearHighlightHandle();const l=this.props.wroContext.nls,t=this.workingId=Date.now(),r=!!e.featureSelectionGeometry;this.setState({isWorking:!0,showWarning:!1,showError:!1});try{const a=yield k(e);if(t!==this.workingId&&e.highlightHandle&&this.clearHandles([e.highlightHandle]),t===this.workingId){let t=null;(null==a?void 0:a.colorCounts)&&0===a.colorCounts.length&&(t=l("wro_chart_noData")),e.highlightHandle&&(this.highlightHandle=e.highlightHandle),r?(this.selGeometry=e.featureSelectionGeometry,this.setState({histogramDataSelect:a,isWorking:!1,showWarning:!!t,warning:t})):(this.selGeometry=null,this.setState({histogramDataDraw:a,isWorking:!1,showWarning:!!t,warning:t}))}}catch(e){console.error("Error computing histograms",e),t===this.workingId&&this.setState({isWorking:!1,showError:!0,warning:(null==e?void 0:e.message)?l("wro_validation_errorLoadingItemWithMsg",{message:String(e.message)}):l("wro_validation_errorLoadingItem")})}}),this.ensureGraphicsLayer=(e,l)=>function(e,l){let t;return l&&(t=e.map.findLayerById(l)),t||(t=new S.default({id:l,title:l,listMode:"hide"}),e.map.add(t)),t}(e,l),this.getGraphicsLayer=e=>{const l=this.props.wroContext.getView();if(null==l?void 0:l.map)return l.map.findLayerById(e)},this.getImageLayer=()=>E(this.props),this.getLayers=()=>function(e){const l=[],t=e.wroContext.getView();return(null==t?void 0:t.map)&&(t.map.allLayers.forEach(e=>{"feature"===e.type&&"polygon"===e.geometryType&&l.push(e)}),l.reverse()),l}(this.props),this.handleClearClicked=()=>{this.workingId=null;const e=this.getGraphicsLayer(this.drawGfxLayerId);e&&e.removeAll(),this.clearHighlightHandle(),this.setState({histogramDataDraw:null,histogramDataSelect:null,showWarning:!1,showError:!1,isWorking:!1})},this.handleDrawPolygonClicked=()=>{this.clearHighlightHandle(),this.activateSketch("drawPolygon","polygon"),this.setState({activeTool:"drawPolygon",histogramDataSelect:null,showWarning:!1,showError:!1,zoomPanActive:!1})},this.handleDrawFreehandPolygonClicked=()=>{this.clearHighlightHandle(),this.activateSketch("drawFreehandPolygon","polygon",{mode:"freehand"}),this.setState({activeTool:"drawFreehandPolygon",histogramDataSelect:null,showWarning:!1,showError:!1,zoomPanActive:!1})},this.handleMapLayerSelected=e=>{let l=e.target.value;"string"==typeof l&&0!==l.length||(l=null),l!==this.state.selectedMapLayerId&&this.clearHighlightHandle(),this.setState({selectedMapLayerId:l,showWarning:!1,showError:!1,histogramDataSelect:null})},this.handleSelectLayerClicked=()=>{this.activateSketch("selectLayer","rectangle"),this.setState({activeTool:"selectLayer",showWarning:!1,showError:!1,zoomPanActive:!1})},this.handleZoomPanClicked=()=>{this.watchImageLayer(),this.cancelSketch(),this.setState({showWarning:!1,showError:!1,zoomPanActive:!0})},this.newTask=(e,l)=>{const t=function(e,l,t,r,a,o){return{wroContext:e,view:l,imageLayer:t,featureMapLayerId:r,featureSelectionGeometry:a,graphicsMapLayerId:o}}(this.props.wroContext,e,this.getImageLayer(),this.state.selectedMapLayerId,l,this.drawGfxLayerId);return t},this.resetState=()=>{this.cancelSketch(),this.clearHighlightHandle(),this.setState({activeTool:null,histogramDataDraw:null,histogramDataSelect:null,isWorking:!1,selectedMapLayerId:null,showWarning:!1,showError:!1,warning:null,zoomPanActive:!0})},this.setGraphicsLayerVisibility=(e,l)=>{const t=this.getGraphicsLayer(e);t&&(t.visible=l)},this.handlePanelClicked=()=>{const e=this.props.wroContext.modelController,l=this.props.wroModel;l&&e.setActivePanel(l,"model-panel")};const l=this.props.wroContext.getId();this.drawGfxLayerId=`${l}_drawGfxLayerId`,this.selGfxLayerId=`${l}_selGfxLayerId`,this.state={activeTool:null,histogramDataDraw:null,histogramDataSelect:null,isWorking:!1,selectedMapLayerId:null,showWarning:!1,showError:!1,warning:null,zoomPanActive:!0}}componentDidUpdate(e,l){const t=this.props.wroModel,r=e.wroModel,a=t&&"chart-panel"===t.activePanel,o=r&&"chart-panel"===r.activePanel;!a&&this.activeSketchViewModel&&this.cancelSketch();const n=null==t?void 0:t.mapLayerId,i=null==r?void 0:r.mapLayerId;if(i&&n!==i&&this.unwatchImageLayer(),n&&n!==i&&this.watchImageLayer(),e.wroStatus.viewId!==this.props.wroStatus.viewId)this.resetState(),this.watchView();else{if(this.canComputeHistograms()){if(a&&!o&&!this.state.zoomPanActive){const e=this.state.activeTool;"drawPolygon"===e?this.activateSketch("drawPolygon","polygon"):"drawFreehandPolygon"===e?this.activateSketch("drawFreehandPolygon","polygon",{mode:"freehand"}):"selectLayer"===e&&this.activateSketch("selectLayer","rectangle"),this.setState({showWarning:!1,showError:!1})}}else this.resetState(),this.watchImageLayer()}}componentWillUnmount(){this.cancelSketch(),this.unwatchView()}unwatchImageLayer(){this.imageLayerHandle&&(this.clearHandles([this.imageLayerHandle]),this.imageLayerHandle=null)}unwatchView(){this.unwatchImageLayer(),this.clearHighlightHandle(),this.clearHandles(this.watchHandles),this.watchHandles=[]}watchImageLayer(){this.unwatchImageLayer();const e=this.getImageLayer();e&&(this.imageLayerHandle=V.watch(()=>e.rasterFunction,()=>{const e=()=>{const e=this.props.wroContext.getView();if(this.state.histogramDataDraw){const l=this.newTask(e,null);this.computeHistograms(l)}},l=this.props.wroContext.getView();if(this.state.histogramDataSelect&&this.selGeometry){const t=this.newTask(l,this.selGeometry);this.computeHistograms(t).then(()=>{e()})}else e()}))}watchView(){this.unwatchView(),this.watchImageLayer();const e=this.props.wroContext.getView();if(null==e?void 0:e.map){const l=e.map.allLayers.on("change",l=>{const t=this.state.selectedMapLayerId;if(t){e.map.findLayerById(t)||this.setState({selectedMapLayerId:null})}});this.watchHandles.push(l)}}render(){const l=this.props.wroContext.nls,t=this.props.wroModel,{activeTool:r,isWorking:o,selectedMapLayerId:n,zoomPanActive:i}=this.state,u=this.canComputeHistograms();let c;if(u){if(u&&(null==t?void 0:t.mapLayerId)){const t=this.getLayers();if("selectLayer"===r)if(t&&t.length>0){const r=[];t.forEach(l=>{const t=(0,e.jsx)("option",{value:l.id,children:l.title},l.id);r.push(t)}),c=(0,e.jsx)(a.Select,{placeholder:l("wro_chart_selectLayerPlaceholder"),value:n,onChange:this.handleMapLayerSelected,children:r})}else c=(0,e.jsx)("span",{className:"widget-wro-chart-note",children:(0,e.jsx)(a.Alert,{closable:!0,form:"basic",text:l("wro_chart_noSubjectLayers"),type:"warning",withIcon:!0})})}}else c=(0,e.jsx)("span",{className:"widget-wro-chart-note",children:l("wro_chart_noModelLayer")});const d=!!c;let g=(0,e.jsx)("div",{className:"widget-wro-chart-working",children:" "});return o?g=(0,e.jsx)("div",{className:"widget-wro-chart-working",children:(0,e.jsx)("span",{children:l("wro_chart_working")})}):this.state.showWarning&&this.state.warning?g=(0,e.jsx)("div",{className:"widget-wro-chart-warning",children:(0,e.jsx)(a.Alert,{closable:!0,form:"basic",text:this.state.warning,type:"warning",withIcon:!0})}):this.state.showError&&this.state.warning&&(g=(0,e.jsx)("div",{className:"widget-wro-chart-warning",children:(0,e.jsx)(a.Alert,{closable:!0,form:"basic",text:this.state.warning,type:"error",withIcon:!0})})),(0,e.jsxs)("div",{className:"widget-wro-chart-panel",children:[(0,e.jsxs)("div",{className:"widget-wro-chart-header",children:[(0,e.jsxs)("div",{className:"widget-wro-flex-between",children:[(0,e.jsx)("span",{className:"widget-wro-chart-features-label",children:l("wro_chart_prompt")}),(0,e.jsxs)(a.ButtonGroup,{className:"widget-wro-chart-tools",gap:"0.2rem",children:[(0,e.jsx)("span",{className:"working","data-dojo-attach-point":"workingNode"}),(0,e.jsx)(a.Button,{className:"widget-wro-chart-button",active:!i&&"drawPolygon"===r,variant:i||"drawPolygon"!==r?"outlined":"contained",disabled:!u,icon:!0,title:l("wro_chart_polygonTool"),onClick:this.handleDrawPolygonClicked,children:(0,e.jsx)(s,{size:"m"})}),(0,e.jsx)(a.Button,{className:"widget-wro-chart-button",active:!i&&"drawFreehandPolygon"===r,variant:i||"drawFreehandPolygon"!==r?"outlined":"contained",disabled:!u,icon:!0,title:l("wro_chart_freehandPolygonTool"),onClick:this.handleDrawFreehandPolygonClicked,children:(0,e.jsx)(h,{size:"m"})}),(0,e.jsx)(a.Button,{className:"widget-wro-chart-button",active:!i&&"selectLayer"===r,variant:i||"selectLayer"!==r?"outlined":"contained",disabled:!u,icon:!0,title:l("wro_chart_selectTool"),onClick:this.handleSelectLayerClicked,children:(0,e.jsx)(m,{size:"m"})}),(0,e.jsx)(a.Button,{className:"widget-wro-chart-button",active:i,variant:i?"contained":"outlined",disabled:!u,icon:!0,title:l("wro_chart_zoomPanTool"),onClick:this.handleZoomPanClicked,children:(0,e.jsx)(x,{size:"m"})}),(0,e.jsx)(a.Button,{className:"widget-wro-chart-button",disabled:!u||!!o,type:"link",onClick:this.handleClearClicked,children:l("wro_general_clear")})]})]}),d&&(0,e.jsx)("div",{className:"widget-wro-chart-select-layer-section",children:c}),g]}),(0,e.jsx)("div",{className:"widget-wro-chart-body",children:this.renderChart()})]})}renderChart(){const l=this.props.wroContext,t=this.props.wroModel,r=this.props.wroStatus;let a;return a="selectLayer"===this.state.activeTool?this.state.histogramDataSelect:this.state.histogramDataDraw,(0,e.jsx)(C,{histogramData:a,wroContext:l,wroModel:t,wroStatus:r})}}class U extends l.React.PureComponent{constructor(e){super(e),this.allSelected=()=>{const e=this.props.wroModel,l=null==e?void 0:e.rasterLayers,t=this.props.wroContext.modelController;if(l&&l.length>0){let r=0;for(let a=0;a<l.length;a++){t.isLayerSelected(e,l[a].rasterLayerId)&&r++}return r===l.length}return!1},this.handlePanelClicked=()=>{const e=this.props.wroContext.modelController,l=this.props.wroModel;l&&e.setActivePanel(l,"model-panel")},this.state={selectAllChecked:!1}}render(){const l=this.props.wroContext.nls,t=this.props.wroModel,r=null==t?void 0:t.loadErrors,a=null==t?void 0:t.rasterLayers,o=!!this.props.wroStatus.viewId;let n=[];if(this.props.wroStatus.isModelLoading)n=[(0,e.jsx)("li",{className:"widget-wro-loading-msg",children:l("wro_general_loading")},"loading")];else if(r&&r.length>0)r.forEach(l=>{n.push((0,e.jsx)("li",{className:"widget-wro-loading-error-msg",children:l.message},l.message))});else if(t)if(a&&0!==a.length){if(a&&a.length>0){const e=this.renderSelectAllNone(a,t);n.push(e),a.forEach(e=>{const l=this.renderLayer(e,t);n.push(l)})}}else n=[(0,e.jsx)("li",{className:"widget-wro-loading-error-msg",children:l("wro_validation_noLayers")},"noLayers")];else{let t="wro_validation_noModel";o||(t="wro_validation_noMap"),n=[(0,e.jsx)("li",{className:"widget-wro-loading-error-msg widget-wro-fadein",children:l(t)},"noMap")]}return(0,e.jsx)("div",{className:"widget-wro-layers-panel",children:(0,e.jsxs)("div",{className:"widget-wro-layers-body",children:[(0,e.jsx)("ul",{className:"widget-wro-layers-list",children:n}),(0,e.jsx)("div",{className:"widget-wro-layers-footer"})]})})}renderSelectAllNone(l,t){const r=this.props.wroContext.modelController,o=this.props.wroContext.nls,n=this.allSelected(),i=o("wro_layers_selectAll");return(0,e.jsxs)("li",{children:[(0,e.jsxs)(a.Label,{className:"widget-wro-layer-select-all-label",children:[(0,e.jsx)(a.Checkbox,{checked:n,onChange:(e,a)=>{e&&(this.setState({selectAllChecked:a}),r.selectAllNoneLayer(t,l,!!a))}}),(0,e.jsx)("span",{className:"widget-wro-layer-select-all",children:i})]}),(0,e.jsx)("hr",{})]},"selectAll")}renderLayer(l,t){const r=this.props.wroContext.modelController,o=l.title,n=r.isLayerSelected(t,l.rasterLayerId);return(0,e.jsx)("li",{children:(0,e.jsxs)(a.Label,{children:[(0,e.jsx)(a.Checkbox,{checked:n,onChange:(e,a)=>{e&&r.selectLayer(t,l.rasterLayerId,!!a)}}),(0,e.jsx)("span",{className:"widget-wro-layer-title",children:o})]})},l.name)}}var G=b(53245),B=b.n(G);let W,z=!1;function J(e){let l;return W&&W.some(t=>(e===t.name&&(l=t),!!l)),l}function $(){return W||(W=q()),W}function q(){return[{name:"1_9_green_yellow_red",label:null,colors:[{label:null,value:1,rgb:[38,115,0]},{label:null,value:2,rgb:[86,148,0]},{label:null,value:3,rgb:[39,181,0]},{label:null,value:4,rgb:[197,219,0]},{label:null,value:5,rgb:[255,255,0]},{label:null,value:6,rgb:[255,195,0]},{label:null,value:7,rgb:[250,142,0]},{label:null,value:8,rgb:[242,85,0]},{label:null,value:9,rgb:[230,0,0]}]},{name:"1_9_red_yellow_green",label:null,colors:[{label:null,value:1,rgb:[230,0,0]},{label:null,value:2,rgb:[242,85,0]},{label:null,value:3,rgb:[250,142,0]},{label:null,value:4,rgb:[255,195,0]},{label:null,value:5,rgb:[255,255,0]},{label:null,value:6,rgb:[197,219,0]},{label:null,value:7,rgb:[39,181,0]},{label:null,value:8,rgb:[86,148,0]},{label:null,value:9,rgb:[38,115,0]}]},{name:"1_9_yellow_to_dark_red",label:null,colors:[{label:null,value:1,rgb:[255,255,128]},{label:null,value:2,rgb:[252,233,106]},{label:null,value:3,rgb:[250,209,85]},{label:null,value:4,rgb:[247,190,67]},{label:null,value:5,rgb:[242,167,46]},{label:null,value:6,rgb:[207,122,31]},{label:null,value:7,rgb:[173,83,19]},{label:null,value:8,rgb:[138,46,10]},{label:null,value:9,rgb:[107,0,0]}]},{name:"1_9_dark_red_to_yellow",label:null,colors:[{label:null,value:1,rgb:[107,0,0]},{label:null,value:2,rgb:[138,46,10]},{label:null,value:3,rgb:[173,83,19]},{label:null,value:4,rgb:[207,122,31]},{label:null,value:5,rgb:[242,167,46]},{label:null,value:6,rgb:[247,190,67]},{label:null,value:7,rgb:[250,209,85]},{label:null,value:8,rgb:[252,233,106]},{label:null,value:9,rgb:[255,255,128]}]},{name:"1_9_light_gray_to_dark_gray",label:null,colors:[{label:null,value:1,rgb:[219,219,219]},{label:null,value:2,rgb:[196,196,196]},{label:null,value:3,rgb:[176,176,176]},{label:null,value:4,rgb:[156,156,156]},{label:null,value:5,rgb:[135,135,135]},{label:null,value:6,rgb:[117,117,117]},{label:null,value:7,rgb:[99,99,99]},{label:null,value:8,rgb:[84,84,84]},{label:null,value:9,rgb:[69,69,69]}]},{name:"1_9_dark_gray_to_light_gray",label:null,colors:[{label:null,value:1,rgb:[69,69,69]},{label:null,value:2,rgb:[84,84,84]},{label:null,value:3,rgb:[99,99,99]},{label:null,value:4,rgb:[117,117,117]},{label:null,value:5,rgb:[135,135,135]},{label:null,value:6,rgb:[156,156,156]},{label:null,value:7,rgb:[176,176,176]},{label:null,value:8,rgb:[196,196,196]},{label:null,value:9,rgb:[219,219,219]}]},{name:"1_9_light_brown_to_dark_brown",label:null,colors:[{label:null,value:1,rgb:[250,233,212]},{label:null,value:2,rgb:[242,208,184]},{label:null,value:3,rgb:[235,187,160]},{label:null,value:4,rgb:[224,163,135]},{label:null,value:5,rgb:[217,144,113]},{label:null,value:6,rgb:[207,124,91]},{label:null,value:7,rgb:[194,103,70]},{label:null,value:8,rgb:[184,84,53]},{label:null,value:9,rgb:[171,65,36]}]},{name:"1_9_dark_brown_to_light_brown",label:null,colors:[{label:null,value:1,rgb:[171,65,36]},{label:null,value:2,rgb:[184,84,53]},{label:null,value:3,rgb:[194,103,70]},{label:null,value:4,rgb:[207,124,91]},{label:null,value:5,rgb:[217,144,113]},{label:null,value:6,rgb:[224,163,135]},{label:null,value:7,rgb:[235,187,160]},{label:null,value:8,rgb:[242,208,184]},{label:null,value:9,rgb:[250,233,212]}]},{name:"1_9_full_spectrum_bright_red_to_blue",label:null,colors:[{label:null,value:1,rgb:[255,0,0]},{label:null,value:2,rgb:[255,119,0]},{label:null,value:3,rgb:[255,200,0]},{label:null,value:4,rgb:[238,255,56]},{label:null,value:5,rgb:[182,255,143]},{label:null,value:6,rgb:[89,255,225]},{label:null,value:7,rgb:[51,194,255]},{label:null,value:8,rgb:[56,106,255]},{label:null,value:9,rgb:[0,0,255]}]},{name:"1_9_full_spectrum_bright_blue_to_red",label:null,colors:[{label:null,value:1,rgb:[0,0,255]},{label:null,value:2,rgb:[56,106,255]},{label:null,value:3,rgb:[51,194,255]},{label:null,value:4,rgb:[89,255,225]},{label:null,value:5,rgb:[182,255,143]},{label:null,value:6,rgb:[238,255,56]},{label:null,value:7,rgb:[255,200,0]},{label:null,value:8,rgb:[255,119,0]},{label:null,value:9,rgb:[255,0,0]}]},{name:"1_9_partial_spectrum_yellow_to_blue",label:null,colors:[{label:null,value:1,rgb:[242,241,162]},{label:null,value:2,rgb:[252,250,98]},{label:null,value:3,rgb:[255,255,0]},{label:null,value:4,rgb:[255,149,0]},{label:null,value:5,rgb:[255,0,0]},{label:null,value:6,rgb:[245,5,189]},{label:null,value:7,rgb:[176,7,237]},{label:null,value:8,rgb:[99,24,204]},{label:null,value:9,rgb:[7,29,173]}]},{name:"1_9_partial_spectrum_blue_to_yellow",label:null,colors:[{label:null,value:1,rgb:[7,29,173]},{label:null,value:2,rgb:[99,24,204]},{label:null,value:3,rgb:[176,7,237]},{label:null,value:4,rgb:[245,5,189]},{label:null,value:5,rgb:[255,0,0]},{label:null,value:6,rgb:[255,149,0]},{label:null,value:7,rgb:[255,255,0]},{label:null,value:8,rgb:[252,250,98]},{label:null,value:9,rgb:[242,241,162]}]},{name:"1_9_yellow_green_to_dark_blue",label:null,colors:[{label:null,value:1,rgb:[255,255,128]},{label:null,value:2,rgb:[182,245,88]},{label:null,value:3,rgb:[113,235,47]},{label:null,value:4,rgb:[59,214,45]},{label:null,value:5,rgb:[61,184,104]},{label:null,value:6,rgb:[42,156,154]},{label:null,value:7,rgb:[33,110,158]},{label:null,value:8,rgb:[31,62,140]},{label:null,value:9,rgb:[12,16,120]}]},{name:"1_9_dark_blue_to_yellow_green",label:null,colors:[{label:null,value:1,rgb:[12,16,120]},{label:null,value:2,rgb:[31,62,140]},{label:null,value:3,rgb:[33,110,158]},{label:null,value:4,rgb:[42,156,154]},{label:null,value:5,rgb:[61,184,104]},{label:null,value:6,rgb:[59,214,45]},{label:null,value:7,rgb:[113,235,47]},{label:null,value:8,rgb:[182,245,88]},{label:null,value:9,rgb:[255,255,128]}]},{name:"1_9_cold_to_hot_diverging",label:null,colors:[{label:null,value:1,rgb:[40,146,199]},{label:null,value:2,rgb:[109,169,179]},{label:null,value:3,rgb:[160,194,155]},{label:null,value:4,rgb:[206,222,129]},{label:null,value:5,rgb:[250,250,100]},{label:null,value:6,rgb:[252,196,76]},{label:null,value:7,rgb:[250,141,52]},{label:null,value:8,rgb:[242,89,34]},{label:null,value:9,rgb:[232,16,20]}]},{name:"1_9_hot_to_cold_diverging",label:null,colors:[{label:null,value:1,rgb:[232,16,20]},{label:null,value:2,rgb:[242,89,34]},{label:null,value:3,rgb:[250,141,52]},{label:null,value:4,rgb:[252,196,76]},{label:null,value:5,rgb:[250,250,100]},{label:null,value:6,rgb:[206,222,129]},{label:null,value:7,rgb:[160,194,155]},{label:null,value:8,rgb:[109,169,179]},{label:null,value:9,rgb:[40,146,199]}]},{name:"1_9_surface_low_to_high",label:null,colors:[{label:null,value:1,rgb:[112,153,89]},{label:null,value:2,rgb:[176,196,124]},{label:null,value:3,rgb:[242,238,162]},{label:null,value:4,rgb:[242,224,150]},{label:null,value:5,rgb:[242,206,133]},{label:null,value:6,rgb:[217,169,130]},{label:null,value:7,rgb:[194,140,124]},{label:null,value:8,rgb:[255,184,193]},{label:null,value:9,rgb:[255,242,255]}]},{name:"1_9_surface_high_to_low",label:null,colors:[{label:null,value:1,rgb:[255,242,255]},{label:null,value:2,rgb:[255,184,193]},{label:null,value:3,rgb:[194,140,124]},{label:null,value:4,rgb:[217,169,130]},{label:null,value:5,rgb:[242,206,133]},{label:null,value:6,rgb:[242,224,150]},{label:null,value:7,rgb:[242,238,162]},{label:null,value:8,rgb:[176,196,124]},{label:null,value:9,rgb:[112,153,89]}]}]}class Y extends l.React.PureComponent{render(){const t=this.props.lowLabel,r=this.props.highLabel,a=[],o=J(this.props.defName);o&&o.colors.forEach(e=>{a.push(this.renderColor(e))});const n=l.css`
      margin: 0 6px;
    `;return(0,e.jsxs)("div",{className:"widget-wro-color-ramp",children:[(0,e.jsx)("span",{css:n,children:t}),(0,e.jsx)("span",{className:"widget-wro-color-ramp-container",children:a}),(0,e.jsx)("span",{css:n,children:r})]})}renderColor(l){let t=null,r=l.label;const a=l.value.toString();if(r&&(r=r.trim()),r&&r.length>0&&a&&a.length>0){t=this.props.nls("wro_colorRamp_tipPattern",{label:r,value:a})}else r&&r.length>0?t=r:a&&a.length>0&&(t=a);const o=l.rgb,n={backgroundColor:"rgb("+o[0].toString()+","+o[1].toString()+","+o[2].toString()+")"};return(0,e.jsx)("span",{className:"widget-wro-color-ramp-color",style:n,title:t},l.value.toString())}}class Q extends l.React.PureComponent{render(){const l=this.props.wroContext.nls,t=this.props.wroModel,r=this.props.wroContext.modelController,o=l("wro_colorRamp_low"),n=l("wro_colorRamp_high");let i;const s=null==t?void 0:t.colormapName;if(s){const l=J(s);l&&(i=(0,e.jsx)(Y,{defName:l.name,lowLabel:o,highLabel:n,nls:this.props.wroContext.nls}))}const u=[],c=$();return t&&c&&c.forEach(l=>{u.push((0,e.jsx)(a.DropdownItem,{onClick:()=>{r.setColormapName(t,l.name)},children:(0,e.jsx)(Y,{defName:l.name,lowLabel:o,highLabel:n,nls:this.props.wroContext.nls})},l.name))}),(0,e.jsx)("div",{className:"widget-wro-colormap-selector",children:(0,e.jsxs)(a.Dropdown,{title:l("wro_main_setSymbology"),children:[(0,e.jsx)(a.DropdownButton,{children:i}),(0,e.jsx)(a.DropdownMenu,{className:"widget-wro-color-dropdown-menu",children:u})]})})}}class K{clear(e){return(e=Z.cloneModel(e)).colormapName="1_9_red_yellow_green",e.modelLayers&&e.modelLayers.forEach(l=>{l.selected=!1,l.remapOpen=!1,l.weight=null;const t=Z.findRasterLayer(e,l.rasterLayerId);(null==t?void 0:t.remapRanges)&&(l.remapRanges=Z.cloneRemapRanges(t.remapRanges))}),e.activePanel="layers-panel",this.onModelChange(e,!0),e}isLayerSelected(e,l){const t=Z.findModelLayer(e,l);return!!(null==t?void 0:t.selected)}isValid(e){let l=0;return(null==e?void 0:e.modelLayers)&&e.modelLayers.forEach(e=>{e.selected&&"number"==typeof e.weight&&(l+=e.weight)}),100===l}onModelChange(e,l){}onStatusChange(e){}selectLayer(e,l,t){e=Z.cloneModel(e);const r=Z.findModelLayer(e,l);if(r&&!t){const t=Z.findRasterLayer(e,l);(null==t?void 0:t.remapRanges)&&(r.remapRanges=Z.cloneRemapRanges(t.remapRanges)),r.remapOpen=!1,r.weight=null}return r&&(r.selected=!!t),this.onModelChange(e),e}selectAllNoneLayer(e,l,t){return e=Z.cloneModel(e),l.forEach(l=>{const r=l.rasterLayerId,a=Z.findModelLayer(e,r);if(a&&!t){const l=Z.findRasterLayer(e,r);(null==l?void 0:l.remapRanges)&&(a.remapRanges=Z.cloneRemapRanges(l.remapRanges)),a.remapOpen=!1,a.weight=null}a&&(a.selected=!!t)}),this.onModelChange(e),e}setActivePanel(e,l){return(e=Z.cloneModel(e)).activePanel=l,this.onModelChange(e),e}setColormapName(e,l){return(e=Z.cloneModel(e)).colormapName=l,this.onModelChange(e),e}setMapLayerId(e,l){return(e=Z.cloneModel(e)).mapLayerId=l,e.lastRun=this.stringifyCriteria(e),this.onModelChange(e),e}setRemapOpen(e,l,t){e=Z.cloneModel(e);const r=Z.findModelLayer(e,l);return r&&(r.remapOpen=!!t),this.onModelChange(e),e}setRemapOutputValue(e,l,t,r){e=Z.cloneModel(e);const a=Z.findModelLayer(e,l);return a&&(a.remapRanges[t].outputValue=r),this.onModelChange(e),e}setWeight(e,l,t){e=Z.cloneModel(e);const r=Z.findModelLayer(e,l);return r&&(r.weight=t),this.onModelChange(e),e}stringifyCriteria(e){const l=[];return e.modelLayers&&e.modelLayers.forEach(e=>{e.selected&&"number"==typeof e.weight&&e.weight>0&&l.push({remapRanges:e.remapRanges,weight:e.weight})}),JSON.stringify({colormapName:e.colormapName,mapLayerId:e.mapLayerId,modelLayers:l,serviceUrl:e.serviceUrl})}}class Z{static cloneModel(e){return e=JSON.parse(JSON.stringify(e))}static cloneRasterLayers(e){return e=JSON.parse(JSON.stringify(e))}static cloneRemapRanges(e){return e=JSON.parse(JSON.stringify(e))}static cloneStatus(e){return e=JSON.parse(JSON.stringify(e))}static findModelLayer(e,l){let t;return e.modelLayers&&e.modelLayers.some(e=>(e.rasterLayerId===l&&(t=e),!!t)),t}static findRasterLayer(e,l){let t;return e.rasterLayers&&e.rasterLayers.some(e=>(e.rasterLayerId===l&&(t=e),!!t)),t}static initModel(e,l){const t=this.newWroModel();return t.serviceUrl=e.serviceUrl,l&&l.length>0&&(t.loadErrors=JSON.parse(JSON.stringify(l))),(null==e?void 0:e.rasterLayers)&&(t.rasterLayers=this.cloneRasterLayers(e.rasterLayers),t.rasterLayers.forEach(e=>{const l=this.newModelLayer();l.rasterLayerId=e.rasterLayerId,l.title=e.title,e.remapRanges&&(l.remapRanges=this.cloneRemapRanges(e.remapRanges)),l.remapRanges&&l.remapRanges.length>0&&t.modelLayers.push(l)})),t}static newIssue(){return{detail:null,message:null}}static newModelLayer(){return{rasterLayerId:null,remapOpen:!1,remapRanges:[],selected:!1,title:null,weight:null}}static newRasterLayer(){return{metadata:null,name:null,rasterLayerId:null,remapRanges:[],title:null,url:null}}static newRemapRange(){return{inputMax:null,inputMin:null,label:null,originalOutputValue:null,outputValue:null}}static newWroModel(){return{activePanel:null,colormapName:"1_9_red_yellow_green",lastRun:null,loadErrors:[],mapLayerId:null,modelLayers:[],rasterLayers:[],serviceUrl:null}}static newWroStatus(){return{activePanel:null,isModelLoading:!1,isModelRunning:!1,themeId:null,viewId:null}}}function X(e,l){l||(l={});const t={rasterFunction:"Local",rasterFunctionArguments:{Operation:e,ExtentType:0,CellsizeType:1,Rasters:l.rasters||[]}};return l.outputPixelType&&(t.outputPixelType=l.outputPixelType),t}function ee(e,l,t,r){const a=[];let o,n,i,s=!1;return r&&(o=r.labels,n=r.noDataLabels,i=r.sortBy),Array.isArray(e)&&Array.isArray(l)&&e.length===2*l.length&&(s=Array.isArray(o)&&o.length===l.length,l.forEach((l,t)=>{const r=2*t,n=Z.newRemapRange();n.label=null,n.inputMin=e[r],n.inputMax=e[r+1],n.outputValue=l,n.originalOutputValue=l,n.label=s?o[t]:le(n.inputMin,n.inputMax),a.push(n)})),Array.isArray(t)&&t.length>0&&(s=Array.isArray(n)&&n.length===t.length/2,t.forEach((e,l)=>{if(l%2==0){const r=Z.newRemapRange();r.label=null,r.inputMin=e,r.inputMax=t[l+1],r.outputValue=0,r.originalOutputValue=0,r.label=s?n[l]:le(r.inputMin,r.inputMax),a.push(r)}})),a.length>0?(i&&a.sort((e,l)=>e[i]<l[i]?-1:e[i]>l[i]?1:0),a):void 0}function le(e,l){return e===l?`${e}`:`${e} - ${l}`}function te(e){let l;const t=e.modelLayers.filter(e=>!!(e.selected&&"number"==typeof e.weight&&e.weight>0)).map(e=>{const l=function(e){if(!e)return;const l={},t=[],r=[],a=[],o=[],n=[],i={includeLabels:!0,inputRangesArgumentName:"InputRanges",outputValuesArgumentName:"OutputValues",noDataRangesArgumentName:"NoDataRanges",labelsArgumentName:"Labels",noDataLabelsArgumentName:"NoDataLabels"};e.forEach(e=>{const l=e.label||le(e.inputMin,e.inputMax);e.outputValue?(t.push(e.inputMin),t.push(e.inputMax),r.push(e.outputValue),o.push(l)):(a.push(e.inputMin),a.push(e.inputMax),n.push(l))}),r.length>0&&(l[i.inputRangesArgumentName]=t,l[i.outputValuesArgumentName]=r,i.includeLabels&&(l[i.labelsArgumentName]=o));a.length>0&&(l[i.noDataRangesArgumentName]=a,i.includeLabels&&(l[i.noDataLabelsArgumentName]=n));return l}(e.remapRanges);return l.Raster="$"+e.rasterLayerId.toString(),l.weight=e.weight/100,l}),r=J(e.colormapName);r&&(l=r.colors.map(e=>[e.value].concat(e.rgb)));const a=function(e,l){const t=e.map(e=>{const l=function(e){return e||(e={}),{rasterFunction:"Remap",rasterFunctionArguments:{Raster:e.Raster||"$$",UseTable:!1,InputRanges:e.InputRanges||[],OutputValues:e.OutputValues||[],NoDataRanges:e.NoDataRanges||[],AllowUnmatched:!0}}}(e);return X(3,{rasters:[l,e.weight]})});t.push(-.5);const r=X(55,{rasters:t});return function(e){return e||(e={}),{rasterFunction:"Colormap",rasterFunctionArguments:{Raster:e.raster||"$$",Colormap:e.colormap||[]}}}({raster:X(49,{rasters:[r],outputPixelType:"U8"}),colormap:l})}(t,l);return a}function re(e,l){let t,r,a=l;if(t=a.rasterFunctionArguments,"Colormap"===a.rasterFunction){const e=t.Colormap;e&&(r=function(e){let l;return W&&W.some(t=>(t.colors.every((l,t)=>{let r=!1;const a=[l.value].concat(l.rgb),o=e[t];return a&&o&&a.length===o.length&&(r=a.every((e,l)=>e===o[l])),r})&&(l=t.name),!!l)),l}(e)),a=t.Raster,t=a.rasterFunctionArguments}if("Local"===a.rasterFunction&&49===t.Operation?(a=t.Rasters[0],t=a.rasterFunctionArguments):"Local"===a.rasterFunction&&48===t.Operation&&(t.Operation=49,a=t.Rasters[0],t=a.rasterFunctionArguments),"Local"===a.rasterFunction&&55===t.Operation&&t.Rasters){t.Rasters.map(l=>{var t;if(null===(t=null==l?void 0:l.rasterFunctionArguments)||void 0===t?void 0:t.Rasters){const t={};return l.rasterFunctionArguments.Rasters.forEach(l=>{if(isNaN(l)){t.id=parseInt(l.rasterFunctionArguments.Raster.substr(1),10);const r=Z.findRasterLayer(e,t.id);t.remapRanges=function(e){let l;if(e){const t={inputRangesArgumentName:"InputRanges",outputValuesArgumentName:"OutputValues",noDataRangesArgumentName:"NoDataRanges",labelsArgumentName:"Labels",noDataLabelsArgumentName:"NoDataLabels"};l=ee(e[t.inputRangesArgumentName],e[t.outputValuesArgumentName],e[t.noDataRangesArgumentName],{labels:e[t.labelsArgumentName],noDataLabels:e[t.noDataLabelsArgumentName],sortBy:"inputMin"})}return l}(l.rasterFunctionArguments),(null==r?void 0:r.remapRanges)&&r.remapRanges.forEach((e,l)=>{const r=t.remapRanges[l];r&&(r.label=e.label)})}else t.weight=100*l}),t}return null}).forEach(l=>{if(l&&"number"==typeof l.id&&"number"==typeof l.weight&&l.weight>0&&l.weight<=100){const t=Z.findModelLayer(e,l.id);t&&(t.selected=!0,t.weight=l.weight,l.remapRanges&&(t.remapRanges=l.remapRanges))}}),r&&(e.colormapName=r)}return null}var ae=b(90379),oe=b(43315),ne=b(19025),ie=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};function se(e,l){var t;return l&&(null===(t=null==e?void 0:e.map)||void 0===t?void 0:t.findLayerById(l))}function ue(e,l){let t=`<p>${e.nls("wro_popup_score",{score:"<b>{Raster.ServicePixelValue}</b>"})}</p>`;t+=`<p>${e.nls("wro_popup_layers")}</p><ul>`,l.modelLayers.forEach(l=>{l.weight&&(t+=`<li>${l.title} <i>(${e.nls("wro_popup_weight")}: ${l.weight}%)</i></li>`)}),t+="</ul>";const r={title:e.getLabel(),content:t,layerOptions:{returnTopmostRaster:!0,showNoDataRecords:!1}};return new ne.default(r)}function ce(e,l){return ie(this,void 0,void 0,function*(){const t=e.getView();if(null==t?void 0:t.map){const r=te(l),a=oe.default.fromJSON(r);let o=se(t,l.mapLayerId);return o?(o.popupTemplate=ue(e,l),o.rasterFunction=a,o.visible||(o.visible=!0),e.modelController.setMapLayerId(l,o.id)):(o=new ae.default({popupTemplate:ue(e,l),rasterFunction:a,url:l.serviceUrl}),yield o.load(),t.map.add(o,0),e.modelController.setMapLayerId(l,o.id)),o}})}var de=b(71904),he=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};class ge extends l.React.PureComponent{constructor(e){super(e),this.home="__home__",this.chk=e=>"string"==typeof e&&(e=e.trim()).length>0?e:null,this.close=()=>{this.props.close&&this.props.close()},this.exportModel=()=>{const e=this.portal,l=this.itemData,t=this.serviceUrl,{title:r,summary:a,description:o,tags:n,folder:i}=this.state;if(!e||!e.user||!r)return;const s={title:r,summary:a,description:o,tags:n,itemData:l,portal:e,serviceUrl:t};i!==this.home&&(s.folder=i),this.props.exportModel&&this.props.exportModel(s),this.close()},this.handleDescriptionChange=e=>{const l=this.chk(e.target.value);this.setState({description:l})},this.handleFolderChange=e=>{const l=this.chk(e.target.value);this.setState({folder:l})},this.handleSummaryChange=e=>{const l=this.chk(e.target.value);this.setState({summary:l})},this.handleTagsChange=e=>{const l=this.chk(e.target.value);this.setState({tags:l})},this.handleTitleChange=e=>{const l=this.chk(e.target.value);this.setState({title:l,hasTitle:!!l})},this._handleToggle=e=>{e?this.exportModel():this.close()},this.init=()=>he(this,void 0,void 0,function*(){try{const e=this.props.wroModel;this.serviceUrl=e.serviceUrl,this.itemData=Object.assign(Object.assign({},function(e){const l=te(e);if(l)return{renderingRule:l}}(e)),{popupInfo:ue(this.props.wroContext,e).toJSON()});const l=[],t=this.props.wroContext.getPortalUrl(),r=new de.default({url:t});if(yield r.load(),r.user){this.portal=r;const e=yield r.user.fetchFolders();e&&e.forEach(e=>{l.push({id:e.id,title:e.title})})}l.length>0&&this.setState({folders:l,hasPortal:!!r.user})}catch(e){console.error(e)}}),this.state={title:null,summary:null,description:null,tags:null,folder:this.home,folders:null,hasPortal:!1,hasTitle:!1}}componentDidMount(){this.init()}render(){const l=this.props.wroContext.nls,t=!!this.state.title?"widget-wro-valid-modal":"widget-wro-invalid-modal";return(0,e.jsx)("div",{children:(0,e.jsx)(a.AlertPopup,{className:`widget-wro-export-popup ${t}`,isOpen:!0,okLabel:l("wro_general_export"),title:l("wro_general_export"),toggle:this._handleToggle,children:this.renderForm()})})}renderForm(){const l=this.props.wroContext.nls,t=this.props.wroContext.getId()+"_export",r=this.props.wroContext.getUser(),o=(null==r?void 0:r.username)||"",n=!!this.state.title,i=this.home,s=[],u=l("wro_saveModel_homeFolderPattern",{username:o});s.push((0,e.jsx)("option",{value:i,children:u},i));const c=this.state.folders;c&&c.forEach(l=>{s.push((0,e.jsx)("option",{value:l.id,children:l.title},l.id))});let d="wro_saveModel_title";return n||(d="wro_saveModel_titleRequired"),(0,e.jsxs)(a.Form,{className:"widget-wro-form",children:[(0,e.jsxs)(a.FormGroup,{children:[(0,e.jsx)(a.Label,{for:t+"_title",children:l(d)}),(0,e.jsx)(a.TextInput,{id:t+"_title",type:"text",onChange:this.handleTitleChange})]}),(0,e.jsxs)(a.FormGroup,{children:[(0,e.jsx)(a.Label,{for:t+"_summary",children:l("wro_saveModel_summary")}),(0,e.jsx)(a.TextInput,{id:t+"_summary",type:"text",onChange:this.handleSummaryChange})]}),(0,e.jsxs)(a.FormGroup,{children:[(0,e.jsx)(a.Label,{for:t+"_description",children:l("wro_saveModel_description")}),(0,e.jsx)(a.TextArea,{id:t+"_description",onChange:this.handleDescriptionChange})]}),(0,e.jsxs)(a.FormGroup,{children:[(0,e.jsx)(a.Label,{for:t+"_tags",children:l("wro_saveModel_tags")}),(0,e.jsx)(a.TextInput,{id:t+"_tags",type:"text",defaultValue:"weightedOverlayModel, geodesign",onChange:this.handleTagsChange})]}),(0,e.jsxs)(a.FormGroup,{children:[(0,e.jsx)(a.Label,{for:t+"_folder",children:l("wro_saveModel_folder")}),(0,e.jsx)(a.Select,{id:t+"_folder",defaultValue:i,onChange:this.handleFolderChange,children:s})]})]})}}class pe extends l.React.PureComponent{render(){const l=this.props.wroModel,t=this.props.modelLayer,r=[],a=null==t?void 0:t.remapRanges;return a&&a.forEach((e,a)=>{r.push(this.renderRange(e,a,t,l))}),(0,e.jsx)("div",{className:"widget-wro-remap-panel",children:r})}renderRange(t,r,o,n){const i=this.props.wroContext.nls,s=this.props.wroContext.modelController,u=!!this.props.wroContext.getConfig().hideRanges,c=!!this.props.wroContext.getConfig().lockSlider,d="remap_"+o.rasterLayerId.toString()+"_"+r.toString();let h;h=t.inputMin===t.inputMax?`${t.inputMin}`:`${t.inputMin} - ${t.inputMax}`;const g=i(u?"wro_remap_label_noRange":"wro_remap_label",{name:t.label,minmax:h}),p=l.css`
      white-space: nowrap;
    `,w={disabled:c};return(0,e.jsxs)("div",{className:"widget-wro-remap-range",children:[(0,e.jsx)("div",{className:"widget-wro-remap-range-label",title:g,children:g}),(0,e.jsxs)("div",{css:p,children:[(0,e.jsx)(a.Slider,Object.assign({className:"widget-wro-remap-slider",min:0,max:9,step:1,value:t.outputValue,onChange:e=>{const l=parseInt(e.target.value);s.setRemapOutputValue(n,o.rasterLayerId,r,l)}},w),d+"_slider"),(0,e.jsx)(a.NumericInput,{className:"widget-wro-remap-numeric-input",size:"sm",min:0,max:9,precision:0,showHandlers:!1,value:t.outputValue,onChange:e=>{"number"==typeof e&&s.setRemapOutputValue(n,o.rasterLayerId,r,e)},disabled:c},d+"_input")]},d+"_inputSection")]},d+"_item")}}var we=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};class me extends l.React.PureComponent{constructor(e){super(e),this.handleClearClicked=()=>{const e=this.props.wroContext,l=this.props.wroContext.modelController,t=this.props.wroModel;t&&(!function(e,l){const t=e.getView();if(null==t?void 0:t.map){const e=se(t,l.mapLayerId);e&&(e.visible=!1,e.rasterFunction=null)}}(e,t),l.clear(t))},this.closeAlert=()=>{this.setState({alertMessage:null})},this.closeExport=()=>{this.setState({showExport:!1})},this.exportModel=e=>we(this,void 0,void 0,function*(){if(this.state.isExporting)return;this.setState({isExporting:!0,showExportSuccessMsg:!1,showExportFailedMsg:!1});const l=this.props.wroContext.nls;try{yield function(e){return T(this,void 0,void 0,function*(){const{title:l,summary:t,description:r,tags:a,folder:o}=e,{itemData:n,portal:i,serviceUrl:s}=e;let u=[];"string"==typeof a&&(u=a.split(",").filter(e=>e.length>0)),0===u.length&&(u=["weightedOverlayModel","geodesign"]);const c={item:new P.default({type:"Image Service",typeKeywords:["geodesignModelerLayer"],title:l,snippet:t,description:r,tags:u,url:s})};n&&(c.data=JSON.stringify(n)),o&&(c.folder=o),yield i.user.addItem(c)})}(e),this.setState({isExporting:!1,showExportSuccessMsg:!0})}catch(e){console.error(e),console.error("Error exporting WRO model",e);const t=(null==e?void 0:e.message)||l("wro_saveModel_failed");this.setState({isExporting:!1,alertMessage:t,showExportFailedMsg:!0})}}),this.handleExportClicked=()=>{this.state.isRunning||this.state.isExporting||this.runModel(!0)},this.handleLayersPanelClicked=()=>{const e=this.props.wroContext.modelController,l=this.props.wroModel;l&&e.setActivePanel(l,"layers-panel")},this.handleChartPanelClicked=()=>{const e=this.props.wroContext.modelController,l=this.props.wroModel;l&&e.setActivePanel(l,"chart-panel")},this.handleRunClicked=()=>{this.state.isRunning||this.runModel(!1)},this.runModel=e=>we(this,void 0,void 0,function*(){if(this.state.isRunning)return;const l=this.props.wroContext.nls,t=this.props.wroContext,r=this.props.wroModel;if(r){this.setState({isRunning:!0,isLayerRefreshing:!0});try{const l={isRunning:!1,isLayerRefreshing:!1},a=yield ce(t,r);if(a){const e=t.getView();e&&(l.isLayerRefreshing=!0,e.whenLayerView(a).then(e=>{V.whenOnce(()=>!e.updating).then(()=>{this.setState({isLayerRefreshing:!1})})}))}e&&(l.showExport=!0),this.setState(l)}catch(e){console.error("Error running WRO model",e);const t=(null==e?void 0:e.message)||l("wro_main_runError");this.setState({isRunning:!1,isLayerRefreshing:!1,alertMessage:t})}}}),this.state={alertMessage:null,isExporting:!1,isLayerRefreshing:!1,isRunning:!1,showExport:!1,showExportSuccessMsg:!1,showExportFailedMsg:!1}}componentDidUpdate(){!this.props.wroContext.getConfig().allowExport&&this.state.showExport&&this.closeExport()}render(){const l=this.props.wroContext.nls,t=this.props.wroContext,r=this.props.wroModel,o=this.props.wroStatus,n=null==r?void 0:r.modelLayers,i=[];let s;n&&n.forEach(e=>{if(e.selected){const l=this.renderLayer(e,r);i.push(l)}});const u=this.state.alertMessage;let c;return u&&(s=(0,e.jsx)(a.AlertPopup,{isOpen:!0,hideOK:!0,cancelLabel:l("wro_general_close"),title:l("wro_main_modelIssue"),toggle:this.closeAlert,children:(0,e.jsx)("div",{style:{fontSize:"small",minWidth:"300px"},children:u})})),this.state.showExport&&(c=(0,e.jsx)(ge,{wroContext:t,wroModel:r,wroStatus:o,close:this.closeExport,exportModel:this.exportModel})),(0,e.jsxs)("div",{className:"widget-wro-model-panel",children:[(0,e.jsxs)("div",{className:"widget-wro-panel-header widget-wro-flex-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:l("wro_main_designModelCaption")}),s,c]}),(0,e.jsx)(Q,{wroContext:t,wroModel:r,wroStatus:o})]}),(0,e.jsxs)("div",{className:"widget-wro-model-panel-body",children:[(0,e.jsx)("ul",{className:"widget-wro-model-layers-list",children:i}),(0,e.jsxs)("div",{className:"widget-wro-model-footer",children:[this.renderAlerts(),this.renderTotal(),this.renderButtons()]})]})]})}renderButtons(){const l=this.props.wroContext.nls,t=this.props.wroContext.modelController,r=this.props.wroModel,o=this.props.wroContext.getView(),{isExporting:n,isRunning:i}=this.state,s=!!this.props.wroStatus.viewId,u=!!r,c=[];let d=!1;r&&(d=t.isValid(r));let h=!0;if(r&&r.lastRun&&r.mapLayerId&&t.stringifyCriteria(r)===r.lastRun){const e=se(o,r.mapLayerId);e&&e.visible&&(h=!1)}let g=!1;const p=!!this.props.wroContext.getConfig().allowExport,w=this.props.wroContext.getUser();return p&&w&&w.privileges&&-1!==w.privileges.indexOf("portal:user:createItem")&&(g=!0),c.push((0,e.jsx)(a.Button,{disabled:!u,onClick:this.handleClearClicked,children:l("wro_general_clear")},"clear")),g&&c.push((0,e.jsx)(a.Button,{disabled:!d||!s||i||n||h,onClick:this.handleExportClicked,children:l("wro_general_export")},"export")),c.push((0,e.jsx)(a.Button,{type:"primary",disabled:!d||!s||i||!h,onClick:this.handleRunClicked,children:l("wro_general_run")},"run")),(0,e.jsx)("div",{children:(0,e.jsx)("div",{className:"widget-wro-model-buttons",children:(0,e.jsx)("div",{className:"widget-wro-flex-between widget-wro-flex-column",children:(0,e.jsx)(a.ButtonGroup,{children:c})})})})}renderAlerts(){const l=[],t=this.props.wroContext.nls,{showExportSuccessMsg:r,showExportFailedMsg:o}=this.state;return l.push((0,e.jsx)(a.Alert,{closable:!0,form:"basic",onClose:()=>{this.setState({showExportSuccessMsg:!1})},open:r,text:t("wro_saveModel_success_msg"),type:"success",withIcon:!0},"success"),(0,e.jsx)(a.Alert,{closable:!0,form:"basic",onClose:()=>{this.setState({showExportFailedMsg:!1})},open:o,text:t("wro_saveModel_failed_msg"),type:"error",withIcon:!0},"failed")),(0,e.jsx)("div",{className:"widget-wro-alert-container "+(r||o?"":"u-hidden"),children:l})}renderLayer(l,t){const r=this.props.wroContext.nls,o=this.props.wroContext.modelController,n=this.props.wroContext,i=this.props.wroStatus,s="layer_"+l.rasterLayerId.toString();let u=l.weight;"number"!=typeof u&&(u=0);let c;return l.remapOpen&&(c=(0,e.jsx)(pe,{modelLayer:l,wroContext:n,wroModel:t,wroStatus:i})),(0,e.jsxs)("li",{children:[(0,e.jsxs)("div",{className:"widget-wro-model-item",children:[(0,e.jsx)("div",{className:"widget-wro-model-item-label",children:l.title}),(0,e.jsxs)("div",{className:"widget-wro-model-item-input-section",children:[(0,e.jsx)(a.Button,{size:"sm",icon:!0,active:l.remapOpen,className:"widget-wro-model-item-remap-btn",onClick:()=>{o.setRemapOpen(t,l.rasterLayerId,!l.remapOpen)},title:r("wro_main_setScores"),children:(0,e.jsx)(a.Icon,{icon:B()})}),(0,e.jsx)(a.NumericInput,{className:"widget-wro-input-weight",size:"sm",min:0,max:100,precision:0,showHandlers:!1,defaultValue:u,onChange:e=>{"number"!=typeof e&&(e=null),o.setWeight(t,l.rasterLayerId,e)}},s+"_input"),(0,e.jsx)("span",{className:"widget-wro-model-item-percent",children:"%"})]},s+"_section")]},s+"_item"),c]},s+"_li")}renderTotal(){var t;const r=this.props.wroContext.nls,a=this.props.wroModel,o=!!this.props.wroStatus.viewId,{isRunning:n,isLayerRefreshing:i}=this.state,s=null===(t=null===document||void 0===document?void 0:document.documentElement)||void 0===t?void 0:t.lang;let u=0;const c=null==a?void 0:a.modelLayers;c&&c.forEach(e=>{e.selected&&"number"==typeof e.weight&&(u+=e.weight)});let d=u.toString()+"%";"ar"!==s&&"tr"!==s||(d="%"+u.toString());const h=this.props.wroContext.getTheme();let g,p;return g=100===u?l.css`
        color: ${h.sys.color.success.text};
        background-color: ${h.sys.color.success.light};
      `:l.css`
        color: ${h.sys.color.error.text};
        background-color: ${h.sys.color.error.light};
      `,o?(n||i)&&(p=(0,e.jsx)("span",{className:"widget-wro-model-working",children:r("wro_chart_working")})):p=(0,e.jsx)("span",{className:"widget-wro-chart-note",children:r("wro_validation_noMap")}),(0,e.jsxs)("div",{className:"widget-wro-model-total",css:g,children:[(0,e.jsx)("span",{children:r("wro_main_total")}),p,(0,e.jsx)("span",{children:d})]})}}class be extends l.React.PureComponent{constructor(e){super(e),this.canEnableChart=()=>O(this.props),this.canEnableDesignModel=()=>{const e=this.props.wroModel;let l=!1;return(null==e?void 0:e.modelLayers)&&(l=e.modelLayers.some(e=>!!e.selected)),l},this.chartPanelRef=l.React.createRef()}componentDidUpdate(e){const l=this.props.wroContext.modelController,t=this.props.wroModel;if(t&&e.wroModel!==t){const e=t.activePanel;("model-panel"!==e||this.canEnableDesignModel())&&("chart-panel"!==e||this.canEnableChart())||l.setActivePanel(t,"layers-panel")}}render(){const l=this.props.wroContext.nls,t=this.props.wroContext.modelController,r=this.props.wroContext,o=this.props.wroModel,n=this.props.wroStatus,i=!!o,s=(null==o?void 0:o.activePanel)||"layers-panel",u=!this.canEnableDesignModel(),c=!this.canEnableChart();return(0,e.jsxs)("div",{className:"widget-wro-modeler",children:[(0,e.jsx)("h6",{className:"widget-wro-header",style:{display:this.props.wroContext.getLabel()?"block":"none"},children:this.props.wroContext.getLabel()}),(0,e.jsx)("div",{className:"widget-wro-body",children:(0,e.jsxs)(a.Tabs,{className:"widget-wro-tabs",value:s,onChange:e=>{o&&t.setActivePanel(o,e)},type:"underline",children:[(0,e.jsx)(a.Tab,{id:"layers-panel",title:l("wro_main_selectLayersCaption"),children:(0,e.jsx)(U,{wroContext:r,wroModel:o,wroStatus:n})}),(0,e.jsx)(a.Tab,{id:"model-panel",title:l("wro_main_designModelCaption"),disabled:!i||u,children:(0,e.jsx)(me,{wroContext:r,wroModel:o,wroStatus:n})}),(0,e.jsx)(a.Tab,{id:"chart-panel",title:l("wro_chart_generate"),disabled:!i||c,children:(0,e.jsx)(H,{ref:this.chartPanelRef,wroContext:r,wroModel:o,wroStatus:n})})]})})]})}}var ve=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};class ye{checkMixedContent(e){return"string"==typeof window.location.href&&0===window.location.href.indexOf("https://")&&"string"==typeof e&&0===e.indexOf("http://")&&(e="https:"+e.substring(5)),e}loadModel(e,l,t){return ve(this,void 0,void 0,function*(){const r=e.nls,a=[];let o,n=Z.newWroModel(),i=null;t="string"==typeof t?t.trim():null;const s=(e,l)=>{const t=Z.newIssue();t.message=e,(null==l?void 0:l.message)&&(t.detail=l.message),a.push(t)};if((l="string"==typeof l?l.trim():null)||t||0!==a.length||s(r("wro_validation_wroServiceNotDefined")),!l&&t&&0===a.length){this.itemId=t,i=new P.default({id:t});try{yield i.load()}catch(e){console.error("Error loading item",t,e),s(r("wro_validation_errorLoadingItem"),e)}if(0===a.length&&(!this.serviceTitle&&i.title&&(this.serviceTitle=i.title),(l="string"==typeof i.url?i.url.trim():null)||s(r("wro_validation_undefinedItemUrl"))),0===a.length)try{const e=yield i.fetchData("json");o=null==e?void 0:e.renderingRule}catch(e){console.error("Error fetching item data",t,e),s(r("wro_validation_errorLoadingItem"),e)}}if(l&&0===a.length){if(this.serviceUrl=this.checkMixedContent(l),0!==this.serviceUrl.indexOf("http://")&&0!==this.serviceUrl.indexOf("https://"))s(r("wro_validation_invalidServiceUrl"));else try{new URL(this.serviceUrl)||s(r("wro_validation_invalidServiceUrl"))}catch(e){s(r("wro_validation_invalidServiceUrl"))}if(0===a.length)try{this.serviceJson=yield this.readServiceJson(this.serviceUrl),!this.serviceTitle&&this.serviceJson&&this.serviceJson.name&&(this.serviceTitle=this.serviceJson.name)}catch(e){console.error("Error loading service",this.serviceUrl,e),s(r("wro_validation_errorloadingService"),e)}if(0===a.length&&function(e,l,t){const r=(e,l)=>{const r=Z.newIssue();r.message=e,(null==l?void 0:l.message)&&(r.detail=l.message),t.push(r)};if(!(l.currentVersion>=10.3&&l.rasterTypeInfos))return void r(e("wro_validation_notAWroService"));l.allowRasterFunction||r(e("wro_validation_notAllowRasterFunction")),"Nearest"!==l.defaultResamplingMethod&&r(e("wro_validation_notNearestResampling"));const a=l.fields||[];["Title","Url","Description","InputRanges","OutputValues","NoDataRanges","RangeLabels","NoDataRangeLabels"].forEach(l=>{if(!a.some(e=>l===e.name)){const t=e("wro_validation_missingFieldPattern",{field:l});r(t)}})}(e.nls,this.serviceJson,a),0===a.length)try{yield this.queryRasters(this.serviceUrl)}catch(e){console.error("Error querying mosaic",this.serviceUrl,e),s(r("wro_validation_errorQueryingLayers"),e)}}const u=this.rasterLayers&&this.rasterLayers.length>0;return 0!==a.length||u||s(r("wro_validation_noLayers")),n=Z.initModel(this,a),o&&0===a.length&&re(n,o),n})}queryRasters(e){return ve(this,void 0,void 0,function*(){e+="/query";const l={query:{f:"json",where:"1=1",outFields:["*"],returnGeometry:!1},responseType:"json"};return(0,R.default)(e,l).then(e=>{var l;const t=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.features;if(t&&t.length>0&&t[0].attributes){const e="Title";t.sort((l,t)=>l.attributes[e]<t.attributes[e]?-1:l.attributes[e]>t.attributes[e]?1:0);const l=[];t.forEach(e=>{const t=function(e){try{if(e.attributes&&"ForestFragmentation_US_USFS_2002"===e.attributes.Name&&"Forest Fragmentation"===e.attributes.Title&&49===e.attributes.OBJECTID)return null}catch(e){}const l=e.attributes;let t=[],r=[],a=[],o=[],n=[],i=null;return l&&(i=Z.newRasterLayer(),i.rasterLayerId=l.OBJECTID,i.name=l.Name,i.title=l.Title,i.url=l.Url,i.metadata=l.Metadata,l.InputRanges&&"string"==typeof l.InputRanges&&l.OutputValues&&"string"==typeof l.OutputValues&&(t=l.InputRanges.split(",").map(e=>parseFloat(e.trim())),r=l.OutputValues.split(",").map(e=>parseInt(e.trim(),10)),l.RangeLabels&&"string"==typeof l.RangeLabels&&(o=function(e){e=e.trim();const l=[];let t=0,r=!1;for(let a=0;a<e.length;a++){const o=e[a],n=e[a+1];l[t]=l[t]||"",'"'===o&&'"'===n&&r?(l[t]+=o,++a):'"'!==o?","!==o||r?l[t]+=o:++t:r=!r}return l.map(e=>e.trim())}(l.RangeLabels))),l.NoDataRanges&&"string"==typeof l.NoDataRanges&&(a=l.NoDataRanges.split(",").map(e=>parseFloat(e.trim())),l.NoDataRangeLabels&&"string"==typeof l.NoDataRangeLabels&&(n=l.NoDataRangeLabels.split(",").map(e=>e.trim()))),i.remapRanges=ee(t,r,a,{labels:o,noDataLabels:n,sortBy:"inputMin"})),i}(e);t&&(t.url=this.checkMixedContent(t.url),l.push(t))}),this.rasterLayers=l}})})}readServiceJson(e){return ve(this,void 0,void 0,function*(){return(0,R.default)(e,{query:{f:"json"},responseType:"json"}).then(e=>null==e?void 0:e.data)})}}var fe=function(e,l,t,r){return new(t||(t=Promise))(function(a,o){function n(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var l;e.done?a(e.value):(l=e.value,l instanceof t?l:new t(function(e){e(l)})).then(n,i)}s((r=r.apply(e,l||[])).next())})};class _e{constructor(){this.modelController=new K,this.getConfig=()=>null,this.getId=()=>null,this.getLabel=()=>null,this.getPortal=()=>null,this.getPortalUrl=()=>null,this.getTheme=()=>null,this.getUser=()=>null,this.getView=()=>null,this.nls=(e,l)=>e}loadModel(e,l){return fe(this,void 0,void 0,function*(){const t=new ye;return yield t.loadModel(this,e,l)})}}var xe=b(85072),Le=b.n(xe),Me=b(97825),Ce=b.n(Me),Se=b(77659),je=b.n(Se),Re=b(55056),Ne=b.n(Re),ke=b(10540),Ie=b.n(ke),Ae=b(41113),Pe=b.n(Ae),Te=b(95852),Oe={};Oe.styleTagTransform=Pe(),Oe.setAttributes=Ne(),Oe.insert=je().bind(null,"head"),Oe.domAPI=Ce(),Oe.insertStyleElement=Ie();Le()(Te.A,Oe);Te.A&&Te.A.locals&&Te.A.locals;let Ee=0;class De extends l.React.PureComponent{constructor(e){super(e),this.autoRunModel=e=>{var l;const t=this.wroContext,r=this.state.wroModel,a=this.state.jimuMapView;(null===(l=null==a?void 0:a.view)||void 0===l?void 0:l.map)&&r&&(r.mapLayerId||e)&&t.modelController.isValid(r)&&ce(t,r).then(()=>{}).catch(e=>{console.error("Error running WRO model",e)})},this.clearLayers=(e,l)=>{const t=this.wroContext,r=this.props.id;if(null==e?void 0:e.map){let a=e.map.findLayerById(`${r}_drawGfxLayerId`);a&&e.map.remove(a),a=e.map.findLayerById(`${r}_selGfxLayerId`),a&&e.map.remove(a),(null==l?void 0:l.mapLayerId)&&function(e,l){const t=e.getView();if(null==t?void 0:t.map){const e=se(t,l.mapLayerId);e&&t.map.remove(e)}}(t,l)}},this.handleActiveViewChange=e=>{var l;const t=this.state.wroModel,r=this.state.jimuMapView;(null===(l=null==r?void 0:r.view)||void 0===l?void 0:l.map)&&this.clearLayers(null==r?void 0:r.view,t);const a=Z.cloneStatus(this.state.wroStatus);a.viewId=e?this.newViewId():null,this.setState({jimuMapView:e,wroStatus:a},()=>{})},this.newThemeId=()=>"themeId_"+(Ee++).toString(),this.newViewId=()=>"viewId_"+(Ee++).toString(),this.nls=(e,l)=>this.props.intl?this.props.intl.formatMessage({id:e,defaultMessage:t[e]},l):e,this.onWroModelChange=(e,l)=>{var t,r,a,o;try{if(l){const e=null===(o=null===(a=null===(r=null===(t=this.modelerRef)||void 0===t?void 0:t.current)||void 0===r?void 0:r.chartPanelRef)||void 0===a?void 0:a.current)||void 0===o?void 0:o.handleClearClicked;e&&e()}}catch(e){console.error(e)}this.setState({wroModel:e})},this.onWroStatusChange=e=>{this.setState({wroStatus:e})},this.modelerRef=l.React.createRef();const r=Z.newWroStatus();var a;this.state={jimuMapView:null,wasModelLoaded:!1,wroModel:null,wroStatus:r},a=this.nls,z||(W||(W=[{name:"1_9_green_yellow_red",label:null,colors:[{label:null,value:1,rgb:[38,115,0]},{label:null,value:2,rgb:[86,148,0]},{label:null,value:3,rgb:[39,181,0]},{label:null,value:4,rgb:[197,219,0]},{label:null,value:5,rgb:[255,255,0]},{label:null,value:6,rgb:[255,195,0]},{label:null,value:7,rgb:[250,142,0]},{label:null,value:8,rgb:[242,85,0]},{label:null,value:9,rgb:[230,0,0]}]},{name:"1_9_red_yellow_green",label:null,colors:[{label:null,value:1,rgb:[230,0,0]},{label:null,value:2,rgb:[242,85,0]},{label:null,value:3,rgb:[250,142,0]},{label:null,value:4,rgb:[255,195,0]},{label:null,value:5,rgb:[255,255,0]},{label:null,value:6,rgb:[197,219,0]},{label:null,value:7,rgb:[39,181,0]},{label:null,value:8,rgb:[86,148,0]},{label:null,value:9,rgb:[38,115,0]}]},{name:"1_9_yellow_to_dark_red",label:null,colors:[{label:null,value:1,rgb:[255,255,128]},{label:null,value:2,rgb:[252,233,106]},{label:null,value:3,rgb:[250,209,85]},{label:null,value:4,rgb:[247,190,67]},{label:null,value:5,rgb:[242,167,46]},{label:null,value:6,rgb:[207,122,31]},{label:null,value:7,rgb:[173,83,19]},{label:null,value:8,rgb:[138,46,10]},{label:null,value:9,rgb:[107,0,0]}]},{name:"1_9_dark_red_to_yellow",label:null,colors:[{label:null,value:1,rgb:[107,0,0]},{label:null,value:2,rgb:[138,46,10]},{label:null,value:3,rgb:[173,83,19]},{label:null,value:4,rgb:[207,122,31]},{label:null,value:5,rgb:[242,167,46]},{label:null,value:6,rgb:[247,190,67]},{label:null,value:7,rgb:[250,209,85]},{label:null,value:8,rgb:[252,233,106]},{label:null,value:9,rgb:[255,255,128]}]},{name:"1_9_light_gray_to_dark_gray",label:null,colors:[{label:null,value:1,rgb:[219,219,219]},{label:null,value:2,rgb:[196,196,196]},{label:null,value:3,rgb:[176,176,176]},{label:null,value:4,rgb:[156,156,156]},{label:null,value:5,rgb:[135,135,135]},{label:null,value:6,rgb:[117,117,117]},{label:null,value:7,rgb:[99,99,99]},{label:null,value:8,rgb:[84,84,84]},{label:null,value:9,rgb:[69,69,69]}]},{name:"1_9_dark_gray_to_light_gray",label:null,colors:[{label:null,value:1,rgb:[69,69,69]},{label:null,value:2,rgb:[84,84,84]},{label:null,value:3,rgb:[99,99,99]},{label:null,value:4,rgb:[117,117,117]},{label:null,value:5,rgb:[135,135,135]},{label:null,value:6,rgb:[156,156,156]},{label:null,value:7,rgb:[176,176,176]},{label:null,value:8,rgb:[196,196,196]},{label:null,value:9,rgb:[219,219,219]}]},{name:"1_9_light_brown_to_dark_brown",label:null,colors:[{label:null,value:1,rgb:[250,233,212]},{label:null,value:2,rgb:[242,208,184]},{label:null,value:3,rgb:[235,187,160]},{label:null,value:4,rgb:[224,163,135]},{label:null,value:5,rgb:[217,144,113]},{label:null,value:6,rgb:[207,124,91]},{label:null,value:7,rgb:[194,103,70]},{label:null,value:8,rgb:[184,84,53]},{label:null,value:9,rgb:[171,65,36]}]},{name:"1_9_dark_brown_to_light_brown",label:null,colors:[{label:null,value:1,rgb:[171,65,36]},{label:null,value:2,rgb:[184,84,53]},{label:null,value:3,rgb:[194,103,70]},{label:null,value:4,rgb:[207,124,91]},{label:null,value:5,rgb:[217,144,113]},{label:null,value:6,rgb:[224,163,135]},{label:null,value:7,rgb:[235,187,160]},{label:null,value:8,rgb:[242,208,184]},{label:null,value:9,rgb:[250,233,212]}]},{name:"1_9_full_spectrum_bright_red_to_blue",label:null,colors:[{label:null,value:1,rgb:[255,0,0]},{label:null,value:2,rgb:[255,119,0]},{label:null,value:3,rgb:[255,200,0]},{label:null,value:4,rgb:[238,255,56]},{label:null,value:5,rgb:[182,255,143]},{label:null,value:6,rgb:[89,255,225]},{label:null,value:7,rgb:[51,194,255]},{label:null,value:8,rgb:[56,106,255]},{label:null,value:9,rgb:[0,0,255]}]},{name:"1_9_full_spectrum_bright_blue_to_red",label:null,colors:[{label:null,value:1,rgb:[0,0,255]},{label:null,value:2,rgb:[56,106,255]},{label:null,value:3,rgb:[51,194,255]},{label:null,value:4,rgb:[89,255,225]},{label:null,value:5,rgb:[182,255,143]},{label:null,value:6,rgb:[238,255,56]},{label:null,value:7,rgb:[255,200,0]},{label:null,value:8,rgb:[255,119,0]},{label:null,value:9,rgb:[255,0,0]}]},{name:"1_9_partial_spectrum_yellow_to_blue",label:null,colors:[{label:null,value:1,rgb:[242,241,162]},{label:null,value:2,rgb:[252,250,98]},{label:null,value:3,rgb:[255,255,0]},{label:null,value:4,rgb:[255,149,0]},{label:null,value:5,rgb:[255,0,0]},{label:null,value:6,rgb:[245,5,189]},{label:null,value:7,rgb:[176,7,237]},{label:null,value:8,rgb:[99,24,204]},{label:null,value:9,rgb:[7,29,173]}]},{name:"1_9_partial_spectrum_blue_to_yellow",label:null,colors:[{label:null,value:1,rgb:[7,29,173]},{label:null,value:2,rgb:[99,24,204]},{label:null,value:3,rgb:[176,7,237]},{label:null,value:4,rgb:[245,5,189]},{label:null,value:5,rgb:[255,0,0]},{label:null,value:6,rgb:[255,149,0]},{label:null,value:7,rgb:[255,255,0]},{label:null,value:8,rgb:[252,250,98]},{label:null,value:9,rgb:[242,241,162]}]},{name:"1_9_yellow_green_to_dark_blue",label:null,colors:[{label:null,value:1,rgb:[255,255,128]},{label:null,value:2,rgb:[182,245,88]},{label:null,value:3,rgb:[113,235,47]},{label:null,value:4,rgb:[59,214,45]},{label:null,value:5,rgb:[61,184,104]},{label:null,value:6,rgb:[42,156,154]},{label:null,value:7,rgb:[33,110,158]},{label:null,value:8,rgb:[31,62,140]},{label:null,value:9,rgb:[12,16,120]}]},{name:"1_9_dark_blue_to_yellow_green",label:null,colors:[{label:null,value:1,rgb:[12,16,120]},{label:null,value:2,rgb:[31,62,140]},{label:null,value:3,rgb:[33,110,158]},{label:null,value:4,rgb:[42,156,154]},{label:null,value:5,rgb:[61,184,104]},{label:null,value:6,rgb:[59,214,45]},{label:null,value:7,rgb:[113,235,47]},{label:null,value:8,rgb:[182,245,88]},{label:null,value:9,rgb:[255,255,128]}]},{name:"1_9_cold_to_hot_diverging",label:null,colors:[{label:null,value:1,rgb:[40,146,199]},{label:null,value:2,rgb:[109,169,179]},{label:null,value:3,rgb:[160,194,155]},{label:null,value:4,rgb:[206,222,129]},{label:null,value:5,rgb:[250,250,100]},{label:null,value:6,rgb:[252,196,76]},{label:null,value:7,rgb:[250,141,52]},{label:null,value:8,rgb:[242,89,34]},{label:null,value:9,rgb:[232,16,20]}]},{name:"1_9_hot_to_cold_diverging",label:null,colors:[{label:null,value:1,rgb:[232,16,20]},{label:null,value:2,rgb:[242,89,34]},{label:null,value:3,rgb:[250,141,52]},{label:null,value:4,rgb:[252,196,76]},{label:null,value:5,rgb:[250,250,100]},{label:null,value:6,rgb:[206,222,129]},{label:null,value:7,rgb:[160,194,155]},{label:null,value:8,rgb:[109,169,179]},{label:null,value:9,rgb:[40,146,199]}]},{name:"1_9_surface_low_to_high",label:null,colors:[{label:null,value:1,rgb:[112,153,89]},{label:null,value:2,rgb:[176,196,124]},{label:null,value:3,rgb:[242,238,162]},{label:null,value:4,rgb:[242,224,150]},{label:null,value:5,rgb:[242,206,133]},{label:null,value:6,rgb:[217,169,130]},{label:null,value:7,rgb:[194,140,124]},{label:null,value:8,rgb:[255,184,193]},{label:null,value:9,rgb:[255,242,255]}]},{name:"1_9_surface_high_to_low",label:null,colors:[{label:null,value:1,rgb:[255,242,255]},{label:null,value:2,rgb:[255,184,193]},{label:null,value:3,rgb:[194,140,124]},{label:null,value:4,rgb:[217,169,130]},{label:null,value:5,rgb:[242,206,133]},{label:null,value:6,rgb:[242,224,150]},{label:null,value:7,rgb:[242,238,162]},{label:null,value:8,rgb:[176,196,124]},{label:null,value:9,rgb:[112,153,89]}]}]),W.forEach(e=>{e.label=a("wro_"+e.name)||e.name,e.colors.forEach(e=>{e.label=a("wro_colorRamp_"+e.value.toString())||""+e.value.toString()})}),z=!0);const o=this.wroContext=new _e;o.nls=this.nls,o.getConfig=()=>this.props.config,o.getId=()=>this.props.id,o.getLabel=()=>this.props.config.displayLabel?this.props.label:null,o.getPortal=()=>this.props.portalSelf,o.getPortalUrl=()=>this.props.portalUrl,o.getTheme=()=>this.props.theme,o.getUser=()=>this.props.user,o.getView=()=>{var e;return null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view},o.modelController.onModelChange=this.onWroModelChange,o.modelController.onStatusChange=this.onWroStatusChange}componentDidUpdate(e,l){var t,r;const a=this.wroContext,o=this.state.wroModel,n=this.state,i=this.props,s=i.config,u=e.config,c=s.serviceUrl,d=s.itemId,h=u.serviceUrl,g=u.itemId;let p;const w=()=>(void 0===p&&(p={}),p),m=()=>(w(),p.wroStatus||(p.wroStatus=Z.cloneStatus(n.wroStatus)),p.wroStatus);if(i.theme!==e.theme&&(m().themeId=this.newThemeId()),i.label!==e.label&&m(),s.displayLabel!==u.displayLabel&&m(),s.allowExport!==u.allowExport&&m(),s.lockSlider!==u.lockSlider&&m(),s.hideRanges!==u.hideRanges&&m(),!c&&!d)return this.clearLayers(null===(t=n.jimuMapView)||void 0===t?void 0:t.view,o),w().wroModel=null,void this.setState(p);let b=!0;if((h&&h===c||g&&g===d)&&(b=!1),!n.jimuMapView||l.jimuMapView||n.wasModelLoaded||(b=!0),b)this.clearLayers(null===(r=n.jimuMapView)||void 0===r?void 0:r.view,o),m().isModelLoading=!0,w().wroModel=null,this.setState(p),this.loadModel(a,c,d,!0);else{p&&this.setState(p);const e=n.jimuMapView;if(e&&e!==l.jimuMapView&&n.wasModelLoaded&&o&&o.mapLayerId){const e=!0;this.autoRunModel(e)}}}componentWillUnmount(){var e;const l=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view,t=this.state.wroModel;this.clearLayers(l,t)}loadModel(e,l,t,r){e.loadModel(l,t).then(e=>{const l=e,t=Z.cloneStatus(this.state.wroStatus);t.isModelLoading=!1,this.setState({wasModelLoaded:!0,wroModel:l,wroStatus:t},()=>{r&&this.autoRunModel(r)})}).catch(e=>{console.error("Error loading WRO model",e);const l=Z.cloneStatus(this.state.wroStatus);l.isModelLoading=!1,this.setState({wroStatus:l})})}render(){var l;const t=this.wroContext,a=this.state.wroModel,o=this.state.wroStatus;return(0,e.jsxs)("div",{className:"widget-wro jimu-widget",children:[(0,e.jsx)(be,{ref:this.modelerRef,wroContext:t,wroModel:a,wroStatus:o}),(0,e.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null===(l=this.props.useMapWidgetIds)||void 0===l?void 0:l[0],onActiveViewChange:this.handleActiveViewChange})]})}}function Ve(e){b.p=e}})(),v})())}}});