System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","esri/core/reactiveUtils.js","esri/widgets/FloorFilter","esri/core/asyncUtils.js","esri/core/promiseUtils.js","jimu-ui"],function(e,t){var i={},r={},o={},l={},n={},s={},a={},f={};return{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){r.ClauseLogic=e.ClauseLogic,r.ClauseOperator=e.ClauseOperator,r.React=e.React,r.dataSourceUtils=e.dataSourceUtils},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){l.watch=e.watch},function(e){n.default=e.default},function(e){s.createTask=e.createTask},function(e){a.throwIfAborted=e.throwIfAborted},function(e){f.WidgetPlaceholder=e.WidgetPlaceholder}],execute:function(){e((()=>{var e={9316:e=>{"use strict";e.exports=a},10540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},14321:e=>{"use strict";e.exports=f},31601:e=>{"use strict";e.exports=function(e){return e[1]}},36449:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var r=i(31601),o=i.n(r),l=i(76314),n=i.n(l)()(o());n.push([e.id,".widget-floorfilter{width:100%;height:100%}.widget-floorfilter-header{margin:10px 10px 5px;font-weight:bold}.widget-floorfilter-msg{padding:12px;height:48px}.widget-floorfilter-container{overflow-y:auto;height:100%}.widget-floorfilter .esri-floor-filter__zoom-button.esri-button--disabled{opacity:1}.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-items .esri-floor-filter__filter-menu-site,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-items .esri-floor-filter__filter-menu-facility,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-items .esri-floor-filter__filter-menu-site:active,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-items .esri-floor-filter__filter-menu-facility:active,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-header-back,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-header .esri-floor-filter__icon-close,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__browse-button,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__zoom-button,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__zoom-button--levels,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__minimize-toggle-button,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__levels-container .esri-floor-filter__level-button{color:var(--sys-color-surface-paper-text);background-color:var(--sys-color-surface-paper)}.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-items .esri-floor-filter__filter-menu-site:hover,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-items .esri-floor-filter__filter-menu-facility:hover,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-header-back:hover,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-header .esri-floor-filter__icon-close:hover,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__browse-button:hover,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__browse-button.esri-widget--button-active,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__zoom-button:hover,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__zoom-button--levels:hover,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__minimize-toggle-button:hover,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__levels-container .esri-floor-filter__level-button:hover{color:var(--sys-color-action-text);background-color:var(--sys-color-action-hover)}.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__levels-container .esri-floor-filter__level-button.esri-widget--button-active,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__levels-container .esri-floor-filter__level-button.esri-widget--button-active:focus{color:var(--sys-color-action-selected-text);background-color:var(--sys-color-action-selected)}.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__zoom-button{color:var(--sys-color-action-disabled-text)}.widget-floorfilter-container .esri-floor-filter.esri-widget.esri-floor-filter__layout--expanded,.widget-floorfilter-container .esri-floor-filter.esri-widget.esri-floor-filter__layout--collapsed{background-color:transparent}.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-search{box-shadow:0 .5px var(--sys-color-divider-input-field)}.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-search,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-search .esri-floor-filter__icon-close,.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-search .esri-floor-filter__filter-menu-search-input{color:var(--sys-color-action-input-field-text);background-color:var(--sys-color-action-input-field)}.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-search .esri-floor-filter__icon-close:hover{color:var(--sys-color-action-text);background-color:var(--sys-color-action-hover)}.widget-floorfilter-container .esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-search .esri-floor-filter__filter-menu-search-input::placeholder{color:var(--sys-color-action-input-field-placeholder)}",""]);const s=n},41113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},53175:e=>{"use strict";e.exports=n},54312:e=>{"use strict";e.exports=l},54802:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M16.25 11.25H15V7.5h5V20h-1.25V8.75h-2.5zm-10-5v6.25H7.5V3.75h1.25V0h3.275l1.725 2.334v8.916H12.5V2.746L11.394 1.25H10V5H8.75v15H0V8.75h1.25v-2.5zm-2.5 7.5V12.5H5v-5H2.5V10H1.25v8.75H7.5v-5zm8.75-1.25h5V20H10v-5h2.5zm1.25 1.25v2.5h-2.5v2.5h5v-5zm-10 2.5h2.5V15h-2.5z"></path></svg>'},55056:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},62686:e=>{"use strict";e.exports=o},65157:e=>{"use strict";e.exports=s},67386:e=>{"use strict";e.exports=i},76314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i="",r=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),r&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),r&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i}).join("")},t.i=function(e,i,r,o,l){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(r)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(n[a]=!0)}for(var f=0;f<e.length;f++){var c=[].concat(e[f]);r&&n[c[0]]||(void 0!==l&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=l),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},77659:e=>{"use strict";var t={};e.exports=function(e,i){var r=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(i)}},79244:e=>{"use strict";e.exports=r},85072:e=>{"use strict";var t=[];function i(e){for(var i=-1,r=0;r<t.length;r++)if(t[r].identifier===e){i=r;break}return i}function r(e,r){for(var l={},n=[],s=0;s<e.length;s++){var a=e[s],f=r.base?a[0]+r.base:a[0],c=l[f]||0,d="".concat(f," ").concat(c);l[f]=c+1;var u=i(d),v={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==u)t[u].references++,t[u].updater(v);else{var h=o(v,r);r.byIndex=s,t.splice(s,0,{identifier:d,updater:h,references:1})}n.push(d)}return n}function o(e,t){var i=t.domAPI(t);i.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,o){var l=r(e=e||[],o=o||{});return function(e){e=e||[];for(var n=0;n<l.length;n++){var s=i(l[n]);t[s].references--}for(var a=r(e,o),f=0;f<l.length;f++){var c=i(l[f]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}l=a}}},97825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var r="";i.supports&&(r+="@supports (".concat(i.supports,") {")),i.media&&(r+="@media ".concat(i.media," {"));var o=void 0!==i.layer;o&&(r+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),r+=i.css,o&&(r+="}"),i.media&&(r+="}"),i.supports&&(r+="}");var l=i.sourceMap;l&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(l))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function c(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={id:i,exports:{}};return e[i](o,o.exports,c),o.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="",c.nc=void 0;var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>V,default:()=>H});var e=c(67386),t=c(79244);const i={_widgetLabel:"Floor Filter",floorfilter_noMap:"Floor Filter",floorfilter_notFloorAware:"The selected map is not floor aware"};var r=c(62686),o=c(54312),l=function(e,t,i,r){return new(i||(i=Promise))(function(o,l){function n(e){try{a(r.next(e))}catch(e){l(e)}}function s(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,s)}a((r=r.apply(e,t||[])).next())})};class n{constructor(){this.filterDataSources=!1,this.filterByActiveFloorOnly=!1,this.autoSetOnFeatureSelection=!1,this.zoomOnAutoSet=!1}clear(){this.clearHandles(),this.jimuMapView&&this.filterDataSources&&this.updateDataSources(this.jimuMapView,this.widgetId,null,!0)}clearHandles(){try{this.jimuMapView&&this.registeredLvCreatedListener&&this.jimuMapView.removeJimuLayerViewCreatedListener(this.registeredLvCreatedListener),this.jimuMapView&&this.registeredSelChangeListener&&this.jimuMapView.removeJimuLayerViewSelectedFeaturesChangeListener(this.registeredSelChangeListener),this.ffLevelHandle&&this.ffLevelHandle.remove(),this.vwFloorsHandle&&this.vwFloorsHandle.remove()}catch(e){console.error(e)}finally{this.registeredLvCreatedListener=null,this.registeredSelChangeListener=null,this.ffLevelHandle=null,this.vwFloorsHandle=null}}init(e,t,i){var r,l,n,s,a,f,c,d,u;this.clearHandles(),this.jimuMapView=e,this.coreFloorFilterWidget=i;const v=this.widgetId=null===(r=null==t?void 0:t.props)||void 0===r?void 0:r.id,h=this.filterDataSources=!!(null===(n=null===(l=null==t?void 0:t.props)||void 0===l?void 0:l.config)||void 0===n?void 0:n.filterDataSources),p=this.filterByActiveFloorOnly=!!(null===(a=null===(s=null==t?void 0:t.props)||void 0===s?void 0:s.config)||void 0===a?void 0:a.filterByActiveFloorOnly),g=this.autoSetOnFeatureSelection=!!(null===(c=null===(f=null==t?void 0:t.props)||void 0===f?void 0:f.config)||void 0===c?void 0:c.autoSetOnFeatureSelection),m=this.zoomOnAutoSet=!!(null===(u=null===(d=null==t?void 0:t.props)||void 0===d?void 0:d.config)||void 0===u?void 0:u.zoomOnAutoSet);e&&e.view&&i&&(h||g)&&(h&&(p?this.ffLevelHandle=o.watch(()=>i.level,t=>{this.updateDataSources(e,v,t,p)}):this.vwFloorsHandle=o.watch(()=>i.view.floors,()=>{const t=i.level;this.updateDataSources(e,v,t,p)}),this.registeredLvCreatedListener=t=>{const r=i.level;this.updateDataSources(e,v,r,p,t)},e.addJimuLayerViewCreatedListener(this.registeredLvCreatedListener),this.updateDataSources(e,v,i.level,p)),g&&(this.registeredSelChangeListener=e=>{this.selectedFeaturesChangeListener(e,i,m)},e.addJimuLayerViewSelectedFeaturesChangeListener(this.registeredSelChangeListener)))}selectedFeaturesChangeListener(e,t,i){var r,o,l,n,s,a,f;const c=null==e?void 0:e.getLayerDataSource(),d=null==c?void 0:c.layer,u=null==e?void 0:e.layer;let v=(null===(r=null==d?void 0:d.floorInfo)||void 0===r?void 0:r.floorField)||(null===(o=null==u?void 0:u.floorInfo)||void 0===o?void 0:o.floorField);if(c&&v&&t){const e=null==c?void 0:c.getSelectedRecords();if(1===(null==e?void 0:e.length)&&(null===(n=null===(l=e[0])||void 0===l?void 0:l.feature)||void 0===n?void 0:n.attributes)){null===(s=null==d?void 0:d.fields)||void 0===s||s.some(e=>v.toLowerCase()===e.name.toLowerCase()&&(v=e.name,!0));const r=e[0].feature.attributes[v];if(r&&t.level!==r){const e=t.facility;if(null===(a=t.viewModel)||void 0===a?void 0:a.getLevel(r)){console.log("FloorFilter: auto changing level...",null==u?void 0:u.title,r),t.level=r;const o=t.facility,l=null===(f=t.viewModel)||void 0===f?void 0:f.getFacility(o);i&&l&&e!==o&&t.viewModel.goTo(l)}}}}}updateDataSources(e,i,r,o,n){var s,a,f,c,d,u;const v=null===(s=null==e?void 0:e.view)||void 0===s?void 0:s.floors,h=[];if("string"==typeof r&&r.startsWith("all--")){r=null;const e=null===(a=this.coreFloorFilterWidget)||void 0===a?void 0:a.facility,t=null===(u=null===(d=null===(c=null===(f=this.coreFloorFilterWidget)||void 0===f?void 0:f.viewModel)||void 0===c?void 0:c.filterFeatures)||void 0===d?void 0:d.levels)||void 0===u?void 0:u.levelsInfo;e&&t&&t.forEach(t=>{t.facilityId===e&&h.push(t.id)})}const p=(e,t)=>{let i=t;if(t&&e&&e.length>0){const r=t.toLowerCase();e.some(e=>r===e.name.toLowerCase()&&(i=e.name,!0))}return i},g=(e,i,l,n)=>{var s,a;let f=null,c=null;const d=null==i?void 0:i.getSelectedRecords();if(1===(null==d?void 0:d.length)&&(null===(a=null===(s=d[0])||void 0===s?void 0:s.feature)||void 0===a?void 0:a.attributes)&&(c=d[0].feature.attributes[e]),!o||l)if(v&&v.length>0){const r=[];if(v.forEach(i=>{if(i){const o=t.dataSourceUtils.createSQLClause(e,t.ClauseOperator.StringOperatorIs,[{value:i,label:i+""}]);r.push(o)}}),r.length>0){const o=t.dataSourceUtils.createSQLClause(e,t.ClauseOperator.StringOperatorIsBlank,[{value:null,label:"null"}]);r.push(o);const l=t.dataSourceUtils.createSQLExpression(t.ClauseLogic.Or,r,i);f={where:l.sql,sqlExpression:l}}else f={where:"1=1",sqlExpression:null}}else f={where:"1=1",sqlExpression:null};else if(o)if(r){const o=t.dataSourceUtils.createSQLClause(e,t.ClauseOperator.StringOperatorIs,[{value:r,label:r+""}]),l=t.dataSourceUtils.createSQLClause(e,t.ClauseOperator.StringOperatorIsBlank,[{value:null,label:"null"}]),n=t.dataSourceUtils.createSQLExpression(t.ClauseLogic.Or,[o,l],i);f={where:n.sql,sqlExpression:n}}else if(f={where:"1=1",sqlExpression:null},h&&h.length>0){const r=[];h.forEach(i=>{const o=t.dataSourceUtils.createSQLClause(e,t.ClauseOperator.StringOperatorIs,[{value:i,label:i+""}]);r.push(o)});const o=t.dataSourceUtils.createSQLExpression(t.ClauseLogic.Or,r,i);f={where:o.sql,sqlExpression:o}}return c&&this.autoSetOnFeatureSelection&&(console.log("FloorFilter: clearing single selection:",n,"on",c),i.clearSelection()),f},m=e=>l(this,void 0,void 0,function*(){var t,l,n,s;const a=null==e?void 0:e.getLayerDataSource(),f=!1,c=null==a?void 0:a.layer,d=null==e?void 0:e.layer;if((null===(t=null==d?void 0:d.floorInfo)||void 0===t?void 0:t.floorField)&&"function"==typeof d.when&&"loading"===d.loadStatus&&(yield d.when()),a){let e=(null===(l=null==c?void 0:c.floorInfo)||void 0===l?void 0:l.floorField)||(null===(n=null==d?void 0:d.floorInfo)||void 0===n?void 0:n.floorField);if(e&&c&&("feature"===c.type||"scene"===c.type)){e=p(c.fields,e);const t=a;if("function"==typeof t.updateQueryParams){const r=g(e,t,f,null==d?void 0:d.title);r&&t.updateQueryParams(r,i)}}}else{let e=null===(s=null==d?void 0:d.floorInfo)||void 0===s?void 0:s.floorField;if(e&&d&&("feature"===(null==d?void 0:d.type)||"scene"===(null==c?void 0:c.type))){e=p(d.fields,e);const t=((e,t)=>{let i=[];if(!o||t?v&&v.length>0&&(i=v.toArray()):o&&r?i=[r]:o&&h&&h.length>0&&(i=h),i&&i.length>0)return i=i.map(e=>{return`'${t=e,"string"==typeof t?t.replace(/'/g,"''"):t}'`;var t}),`(${e} IN (${i.join(",")}))`;return"1=1"})(e,f);((e,t)=>{e.xtnOrigDefExpr||(e.xtnOrigDefExpr=e.definitionExpression||"none"),e.xtnOrigDefExpr&&"none"!==e.xtnOrigDefExpr&&(t="("+e.xtnOrigDefExpr+") AND "+t),e.definitionExpression=t})(d,t)}}});if(n)m(n);else{const t=null==e?void 0:e.getAllJimuLayerViews();Array.isArray(t)&&t.forEach(e=>{m(e)})}}}var s=c(53175),a=c(85072),f=c.n(a),u=c(97825),v=c.n(u),h=c(77659),p=c.n(h),g=c(55056),m=c.n(g),w=c(10540),_=c.n(w),y=c(41113),b=c.n(y),x=c(36449),S={};S.styleTagTransform=b(),S.setAttributes=m(),S.insert=p().bind(null,"head"),S.domAPI=v(),S.insertStyleElement=_();f()(x.A,S);x.A&&x.A.locals&&x.A.locals;var F=c(65157),C=c(9316),L=c(14321),M=c(54802),O=c.n(M),j=function(e,t,i,r){return new(i||(i=Promise))(function(o,l){function n(e){try{a(r.next(e))}catch(e){l(e)}}function s(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,s)}a((r=r.apply(e,t||[])).next())})};class H extends t.React.PureComponent{constructor(e){super(e),this.clearHandles=e=>{Array.isArray(e)&&e.forEach(e=>{try{e&&e.remove()}catch(e){console.error(e)}})},this.handleActiveViewChange=e=>{var t;this.setState({hadMap:!(!this.state.hadMap&&!(null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.map)),jimuMapView:e})},this.hasFloorInfo=()=>{var e,t,i;return!!(null===(i=null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)||void 0===i?void 0:i.floorInfo)},this.hasMap=()=>{var e,t;return!!(null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)},this.nls=(e,t)=>this.props.intl?this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t):e,this.dsFilter=new n,this.state={hadMap:!1,jimuMapView:null,wasMounted:!1}}componentDidMount(){this.setState({wasMounted:!0})}componentDidUpdate(e,t){const i=this.state,r=this.props;i.wasMounted&&!t.wasMounted?this.loadCoreWidget():i.jimuMapView!==t.jimuMapView||r.config.filterDataSources!==e.config.filterDataSources||r.config.filterByActiveFloorOnly!==e.config.filterByActiveFloorOnly||r.config.autoSetOnFeatureSelection!==e.config.autoSetOnFeatureSelection||r.config.zoomOnAutoSet!==e.config.zoomOnAutoSet?i.wasMounted&&this.loadCoreWidget():r.config.longNames!==e.config.longNames?this.coreWidget&&(this.coreWidget.longNames=!!r.config.longNames):r.config.position!==e.config.position&&this.coreWidget&&this.coreWidget.scheduleRender()}componentWillUnmount(){this.destroyCoreWidget()}destroyCoreWidget(){if(this.dsFilter.clear(),this.coreWidget){const e=this.coreWidget.view;this.coreWidget.destroy(),this.coreWidget=null,e&&(e.floors=this.vwOriginalFloors||null)}this.vwHeightHandle&&(this.clearHandles([this.vwHeightHandle]),this.vwHeightHandle=null),this.vwWidthHandle&&(this.clearHandles([this.vwWidthHandle]),this.vwWidthHandle=null),this.gdbVersionHandle&&(this.clearHandles([this.gdbVersionHandle]),this.gdbVersionHandle=null)}fixBreakpoints(e){setTimeout(()=>{var t;const i=null===(t=this.coreWidget)||void 0===t?void 0:t.viewModel;let r="large";try{document.documentElement.classList.contains("size-mode-MEDIUM")?r="medium":document.documentElement.classList.contains("size-mode-SMALL")&&(r="xsmall")}catch(e){console.error(e)}!i||"both"!==e&&"widthBreakpoint"!==e||(i._viewWidthBreakpoint=r),!i||"both"!==e&&"heightBreakpoint"!==e||(i._viewHeightBreakpoint=r)},100)}loadCoreWidget(){if(this.coreContainer){if(this.hasFloorInfo()){this.destroyCoreWidget();const e=document.createElement("div");this.coreContainer.appendChild(e);const t=!!this.props.config.longNames,i=this.state.jimuMapView.view;this.coreWidget=new s.default({container:e,longNames:t,view:i});let r=!0;const l=o.watch(()=>this.coreWidget.viewModel.filterFeatures,()=>{var e,t,n;if(r){r=!1,this.dsFilter.init(this.state.jimuMapView,this,this.coreWidget);const l=null===(n=null===(t=null===(e=this.coreWidget)||void 0===e?void 0:e.viewModel)||void 0===t?void 0:t.filterLayers)||void 0===n?void 0:n.levelLayer;l&&(this.gdbVersionHandle=o.watch(()=>l.gdbVersion,e=>{this.refreshFloorFilterData(i,!0)}))}l.remove()});this.coreWidget._getComponentPosition=()=>this.props.config.position||"top-left",this.vwOriginalFloors=i.floors&&i.floors.clone(),this.fixBreakpoints("both"),this.vwWidthHandle=o.watch(()=>i.widthBreakpoint,()=>{this.fixBreakpoints("widthBreakpoint")}),this.vwHeightHandle=o.watch(()=>i.heightBreakpoint,()=>{this.fixBreakpoints("heightBreakpoint")})}else this.destroyCoreWidget()}}refreshFloorFilterData(e,t){e||(e=this.state.jimuMapView.view);const i=null==e?void 0:e.map,r=this.coreWidget,o=null==r?void 0:r.viewModel;return o&&i?(null!=o._updateFloorFilterTask&&(o._updateFloorFilterTask.abort(),o._updateFloorFilterTask=null),o._updateFloorFilterTask=(0,F.createTask)(e=>j(this,void 0,void 0,function*(){var l,n;yield o._updateFloorFilterFromMap(i),(0,C.throwIfAborted)(e),o.original_isOverridden||(o.original_isOverridden=o._isOverridden);try{const e=r.level;o.filterFeatures=null,o._isOverridden=e=>"filterFeatures"!==e&&(("filterLayers"!==e||!t)&&o.original_isOverridden(e));const s=o.filterMenuType,a=o.filterMenuOpen;if(yield o._setInitialViewState(i),o._isOverridden=o.original_isOverridden,e){let t=!1;const i=null===(n=null===(l=o.filterFeatures)||void 0===l?void 0:l.levels)||void 0===n?void 0:n.levelsInfo;Array.isArray(i)&&(t=i.some(t=>t.id===e&&(r.level=e,!0))),t||(r.site=null,r.facility=null,r.level=null)}o.filterMenuType=s,o.filterMenuOpen=a}finally{o._isOverridden=o.original_isOverridden}})),o._updateFloorFilterTask.promise):Promise.resolve()}render(){var i;const o=this.props.config.displayLabel?this.props.label:null,l=this.hasMap(),n=this.hasFloorInfo(),s=!n;let a;l?n||(a=this.nls("floorfilter_notFloorAware")):a=this.nls("floorfilter_noMap");let f="jimu-widget widget-floorfilter";return a&&(f+=" widget-floorfilter-nomap"),(0,e.jsxs)("div",{className:f,children:[!s&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)("h4",{className:"widget-floorfilter-header",style:{display:o?"block":"none"},children:o}),(0,e.jsxs)("div",{className:"widget-floorfilter-msg",style:{display:a?"block":"none"},children:[(0,e.jsx)("span",{className:"esri-icon esri-icon-urban-model"}),(0,e.jsx)("span",{style:{margin:"0 8px"},children:a})]}),(0,e.jsx)("div",{className:"widget-floorfilter-container",ref:e=>{this.coreContainer=e}})]}),(0,e.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null===(i=this.props.useMapWidgetIds)||void 0===i?void 0:i[0],onActiveViewChange:this.handleActiveViewChange}),s&&this.renderWidgetPlaceholder()]})}renderWidgetPlaceholder(){const t=this.hasMap(),i=this.hasFloorInfo(),r=this.nls("_widgetLabel");let o;return t&&(i||(o=this.nls("floorfilter_notFloorAware"))),(0,e.jsx)(L.WidgetPlaceholder,{direction:"vertical",iconSize:"small",icon:O(),"aria-label":r,name:r,message:o})}}function V(e){c.p=e}})(),d})())}}});