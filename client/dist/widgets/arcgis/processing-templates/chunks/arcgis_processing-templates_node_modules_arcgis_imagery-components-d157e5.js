/*! For license information please see arcgis_processing-templates_node_modules_arcgis_imagery-components-d157e5.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_processing-templates_node_modules_arcgis_imagery-components-d157e5"],{5827:(e,t,i)=>{i.r(t),i.d(t,{ArcgisImageryCollectionExplorer:()=>x});var s=i(9013),a=i(4312),r=i(3661),l=i(2797),n=i(6798),o=i(1072),m=i(3438),c=i(9327),d=i(8927),g=i(2373),h=i(7325),I=i(7370),u=i(9958),p=i(6250),y=i(8685),S=i(7516),f=i(5395),v=i(2981);function F(e){return`ImageryCollectionExplorer_${e}`}function b(e,t){const i={...P(F(e)),listSettingsOption:t};A(F(e),i)}function C(e,t,i){const s={...P(F(e)),selectedImageItems:t,selectedImageItemOids:i};A(F(e),s)}function w(e){!function(e){window.sessionStorage.removeItem(e)}(F(e))}function A(e,t){window.sessionStorage.setItem(e,JSON.stringify(t))}function P(e){const t=window.sessionStorage.getItem(e);return t&&JSON.parse(t)}const $=S.AH`:host{display:flex;flex-direction:column;flex:1 1 auto;overflow:hidden}.image-item-list-container{display:flex;flex-direction:column;flex:1 1 auto;padding:5px 5px 0;overflow-y:hidden}.image-item-card-list{width:100%;padding:0;margin:0;overflow-y:auto;list-style:none}.image-item-list-selection-button-wrapper{display:flex;align-items:center;justify-content:space-between;padding:.5rem}.image-item-info-container{display:flex;align-items:center;flex-wrap:wrap;gap:10px}.image-item-info-container>img{max-width:50%}.image-item-info-text-section{flex:1;word-break:break-word}.image-item-info-text-section>div{margin-bottom:10px;font-size:var(--calcite-font-size--1);font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1)}.list-pagination-info-wrapper{padding:.2rem 0;display:flex;justify-content:space-between;align-items:center}.image-item-inspect-button-group{text-align:start}.image-item-card-displayed-field-list{list-style-type:none;padding:0;margin:0;word-break:break-word}.sort-image-item-action-wrapper{border-inline-start:1px solid var(--calcite-color-foreground-3);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.pagination-wrapper{display:flex;justify-content:center;padding:.5rem 0;.hide{display:none}}.no-image-item-coach-wrapper{display:flex;height:100%;flex-direction:column;align-items:center;justify-content:center;text-align:center;gap:1rem}`;class x extends v.WF{constructor(){super(...arguments),this.messages=(0,I.u)({blocking:!0}),this.refCloseButtonNode=(0,f._)(),this.isSavedImageOidsMerged=!1,this.handleImageItemListSettingsPopoverClose=()=>{(0,p.o)(this.imageryItemListSettingsPopover),this.imageryItemListSettingsPopover=void 0,this.isShowingListSettingsPopover=!1},this.handleImageItemFiltersPopoverClose=()=>{(0,p.o)(this.imageryItemFiltersPopover),this.imageryItemFiltersPopover=void 0,this.isShowingFiltersPopover=!1},this.handleImageItemSortPopoverClose=()=>{(0,p.o)(this.imageryItemSortPopover),this.imageryItemSortPopover=void 0,this.isShowingSortPopover=!1},this.handleImageItemDetailsPopoverClose=()=>{(0,p.o)(this.imageryItemDetailsPopover),this.imageryItemDetailsPopover=void 0,this.isShowingImageItemDetailsPopover=!1},this.handleImageItemsSortChangeSave=async e=>{const{sortField:t,sortOrder:i}=e.detail;this.imageItemSortOrder=i,this.imageItemSortField=t;const{currentFilterDetail:s,layer:a,selectedImageItemFeatures:l,selectedImageItemFeatureOids:n}=this,{queryField:o,queryValues:m,isIncludeOverviews:c,displayExtent:d}=s,g="extent"===d?.type?d:r.default.fromJSON(d),h=(0,y.f)({layer:a,queryField:o,queryValues:m,isIncludeOverviews:c,extent:g});if(this.resetAllImageItemListPagination(),this.resetSelectedImageItemListPagination(),this.imageItemFeatures=[],await this.queryImageCollectionItemsAndCount(h),l.length===n.length&&l.every(e=>n.includes(e.attributes[a.objectIdField])))this.sortSelectedImageItems(l);else{this.selectedImageItemFeatures=[];const e=(0,y.f)({layer:this.layer,isIncludeOverviews:!0,extent:null,selectedImageItemOids:n});await this.queryImageCollectionItemsAndCount(e,!0)}(function(e,t){const i={...P(F(e)),sortingOption:t};A(F(e),i)})(a.id,e.detail),C(a.id,l,n)},this.handleImageItemListSettingsSave=e=>{const{selectedFields:t,isShowingThumbnails:i}=e.detail;this.isShowingThumbnails=i,this.imageItemCardDisplayedFields=t.length>0?t:[this.activeQueryField],b(this.layer.id,{isShowingThumbnails:i,selectedFields:this.imageItemCardDisplayedFields})},this.handleImageItemFilterApply=e=>{this.isFilterApplied=!0,this.isSelectAll=!1;const t=e.detail;this.currentFilterDetail=t,this.handleImageItemFilterQuery(t),function(e,t){const i={...P(F(e)),filterOptions:t};A(F(e),i)}(this.layer.id,t)},this.handleImageItemToInspectChange=e=>{const t=e.detail,i=this.getNewImageItemFeatureToInspect(t);this.openImageItemDetailsPopover(i)},this.activeImageItemListNavTab=p.I.ALL,this.totalImageItemCount=-1,this.imageItemFeatures=[],this.selectedImageItemFeatures=[],this.selectedImageItemFeatureOids=[],this.imageItemCardDisplayedFields=[],this.isShowingImageItemDetailsPopover=!1,this.isShowingListSettingsPopover=!1,this.isShowingFiltersPopover=!1,this.isShowingSortPopover=!1,this.isShowingThumbnails=!1,this.isQueryingImageItems=!1,this.imageItemSortOrder=p.S.ASC,this.allImageItemListCurPageStartIndex=1,this.allImageItemListPrevPageStartIndex=1,this.selectedImageItemListCurPageStartIndex=1,this.selectedImageItemListPrevPageStartIndex=1,this.isFilterApplied=!1,this.isShowingQueryFailureAlert=!1,this.isShowingExceedMaxMosaicImageCountAlert=!1,this.isShowingImageSelectionCountAlert=!1,this.isSelectAll=!1,this.maxImageItemCountPerPage=60,this.hidePanelHeader=!1,this.attributeFilterDisabled=!1,this.spatialFilterDisabled=!1,this.imageTypeFilterDisabled=!1,this.viewImageDetailsDisabled=!1,this.zoomToDisabled=!1,this.addToMapDisabled=!1,this.sortDisabled=!1,this.listSettingsDisabled=!1,this.arcgisClose=(0,v.lh)()}static{this.properties={activeQueryField:16,selectedAOI:16,activeImageItemListNavTab:16,totalImageItemCount:16,imageItemFeatures:16,selectedImageItemFeatures:16,selectedImageItemFeatureOids:16,inspectImageItemFeature:16,imageItemCardDisplayedFields:16,isShowingImageItemDetailsPopover:16,isShowingListSettingsPopover:16,isShowingFiltersPopover:16,isShowingSortPopover:16,isShowingThumbnails:16,isQueryingImageItems:16,imageItemSortOrder:16,imageItemSortField:16,allImageItemListCurPageStartIndex:16,allImageItemListPrevPageStartIndex:16,selectedImageItemListCurPageStartIndex:16,selectedImageItemListPrevPageStartIndex:16,isFilterApplied:16,currentFilterDetail:16,isShowingQueryFailureAlert:16,isShowingExceedMaxMosaicImageCountAlert:16,isShowingImageSelectionCountAlert:16,isSelectAll:16,layer:0,view:0,maxImageItemCountPerPage:9,hidePanelHeader:5,attributeFilterDisabled:5,spatialFilterDisabled:5,imageTypeFilterDisabled:5,viewImageDetailsDisabled:5,zoomToDisabled:5,addToMapDisabled:5,sortDisabled:5,listSettingsDisabled:5}}static{this.styles=$}async setFocus(){this.refCloseButtonNode.value?.setFocus()}async load(){this.init(this.layer)}willUpdate(e){if(e.has("selectedImageItemFeatureOids")&&(this.hasUpdated||this.selectedImageItemFeatureOids?.length>0)&&this.handleSelectedImageItemsChange(this.selectedImageItemFeatureOids),this.hasUpdated&&e.has("activeQueryField")&&this.handleDisplayedFieldsInImageItemCardChange(this.activeQueryField),this.hasUpdated&&(e.has("attributeFilterDisabled")||e.has("spatialFilterDisabled")||e.has("imageTypeFilterDisabled"))&&this.isShowingFiltersPopover&&this.handleImageItemFiltersPopoverClose(),this.hasUpdated&&e.has("viewImageDetailsDisabled")&&this.isShowingImageItemDetailsPopover&&this.handleImageItemDetailsPopoverClose(),this.hasUpdated&&e.has("sortDisabled")&&this.isShowingSortPopover&&this.handleImageItemSortPopoverClose(),this.hasUpdated&&e.has("listSettingsDisabled")&&this.isShowingListSettingsPopover&&this.handleImageItemSortPopoverClose(),this.hasUpdated&&e.has("layer")&&(this.closeAllPopovers(),this.init(this.layer)),this.hasUpdated&&e.has("maxImageItemCountPerPage")){if(!(this.maxImageItemCountPerPage>0))return;this.imageItemCountPerPage=Math.min(this.maxImageItemCountPerPage,this.layer?.sourceJSON?.maxRecordCount||this.maxImageItemCountPerPage),this.isFilterApplied?this.handleImageItemFilterQuery(this.currentFilterDetail):this.handleImageItemInitialQuery()}}disconnectedCallback(){super.disconnectedCallback(),(0,y.r)(this.layer,this.layerInitialMosaicRule),this.removeImageItemHighlight(),u.t.clear()}async init(e){this.locale=this.messages._t9nLocale;const{fields:t,sourceJSON:i,mosaicRule:s}=e||{},r=(0,y.g)(t),l=(0,y.a)(r);this.activeQueryField=l,this.imageItemSortField=l,this.loadSavedUIOptionsFromLocalStorage(e.id),this.currentMapExtent=this.view.extent,this.selectedAOI=this.spatialFilterDisabled?void 0:p.A.DISPLAY_EXTENT,0===this.imageItemCardDisplayedFields.length&&this.handleDisplayedFieldsInImageItemCardChange(this.activeQueryField),this.layerInitialMosaicRule=s.clone(),this.imageItemCountPerPage=Math.min(this.maxImageItemCountPerPage,i?.maxRecordCount||this.maxImageItemCountPerPage),this.handleImageItemInitialQuery(),this.manager.onLifecycle(()=>[(0,a.watch)(()=>[this.view.stationary,this.view.extent],(0,h.s)(()=>{if(this.view.stationary&&!this.spatialFilterDisabled&&!(0,y.c)(this.currentMapExtent,this.view)){this.currentMapExtent=this.view.extent,this.fetchAbortController?.abort(),this.isSelectAll=!1;const e=(0,y.b)(this.view);this.currentFilterDetail&&(this.currentFilterDetail.displayExtent=e),this.isFilterApplied?this.handleImageItemFilterQuery(this.currentFilterDetail):this.handleImageItemInitialQuery()}},300)),(0,a.watch)(()=>[this.layer.definitionExpression],()=>{this.fetchAbortController?.abort(),this.isSelectAll=!1,this.isSavedImageOidsMerged=!1,this.isFilterApplied?this.handleImageItemFilterQuery(this.currentFilterDetail):this.handleImageItemInitialQuery()})])}openImageItemDetailsPopover(e){const{messages:t,view:i,layer:s,inspectImageItemFeature:a,isShowingImageItemDetailsPopover:r}=this,l=e.attributes[s.objectIdField];a?.attributes[s.objectIdField]===l&&r?this.handleImageItemDetailsPopoverClose():(this.closeAllPopovers(),this.inspectImageItemFeature=e,this.isShowingImageItemDetailsPopover=!0,this.imageryItemDetailsPopover=(0,v.dN)(S.qy`<arcgis-imagery-item-details-popover .layer=${s} .view=${i} .referenceElement=${this.el} .messages=${t} open .imageItemFeatureGraphic=${this.inspectImageItemFeature} @arcgisImageItemToInspectChange=${this.handleImageItemToInspectChange} @arcgisImageItemDetailsPopoverClose=${this.handleImageItemDetailsPopoverClose}></arcgis-imagery-item-details-popover>`),this.imageryItemDetailsPopover&&!document.body.contains(this.imageryItemDetailsPopover)&&document.body.appendChild(this.imageryItemDetailsPopover)),this.removeImageItemHighlight()}handleSelectedImageItemsChange(e){this.isSelectAll=this.isSelectAll&&e.length>0||this.allImageItemOids?.every(e=>this.selectedImageItemFeatureOids.includes(e)),0===e.length&&(this.selectedImageItemFeatures=[],(0,y.r)(this.layer,this.layerInitialMosaicRule),this.activeImageItemListNavTab===p.I.SELECT&&this.handleImageItemListNavTabChange(p.I.ALL)),e.length>0&&(this.isShowingImageSelectionCountAlert=e.length>1e3,this.isShowingExceedMaxMosaicImageCountAlert=e.length>this.layer.sourceJSON?.maxMosaicImageCount,!this.isShowingExceedMaxMosaicImageCountAlert&&!this.isShowingImageSelectionCountAlert&&(0,y.l)(this.layer,e)),C(this.layer.id,this.selectedImageItemFeatures,this.selectedImageItemFeatureOids)}handlePanelClose(){w(this.layer.id),this.closeAllPopovers(),this.arcgisClose.emit()}handleImageItemInitialQuery(){const{view:e,layer:t,spatialFilterDisabled:i}=this,s=i?null:(0,y.b)(e);this.currentFilterDetail&&!this.currentFilterDetail.selectedAOI&&(this.currentFilterDetail.selectedAOI=this.selectedAOI),this.currentFilterDetail=this.currentFilterDetail??{selectedAOI:this.selectedAOI,isIncludeOverviews:!1,displayExtent:s};const{queryField:a,queryValues:r,isIncludeOverviews:l}=this.currentFilterDetail,n=(0,y.f)({layer:t,queryField:a,queryValues:r,isIncludeOverviews:l,extent:s});this.totalImageItemCount=-1,this.imageItemFeatures=[],this.resetAllImageItemListPagination(),this.resetSelectedImageItemListPagination(),this.queryImageCollectionItemsAndCount(n)}async handleImageItemFilterQuery(e){const{selectedAOI:t,queryField:i,queryValues:s,isIncludeOverviews:a,displayExtent:r,isRangeModeEnabled:l}=e,{layer:n}=this;this.selectedAOI=this.spatialFilterDisabled?void 0:t,this.activeQueryField=i;let o=s;(i&&s&&(0,p.i)(i.type)||"date"===i?.type)&&(o=l?s:s&&Number.isFinite(s[1])?[s[1]]:[]);const m=(0,y.f)({layer:n,queryField:i,queryValues:o,isIncludeOverviews:a,extent:this.selectedAOI===p.A.ALL?null:r});this.totalImageItemCount=-1,this.resetAllImageItemListPagination(),this.imageItemFeatures=[],this.queryImageCollectionItemsAndCount(m)}async queryImageCollectionItemsAndCount(e,t=!1){const{selectedAOI:i,layer:s,view:a,imageItemSortField:r,imageItemSortOrder:l,selectedImageItemFeatureOids:n,selectedImageItemFeatures:o,isSavedImageOidsMerged:m,fetchAbortController:c}=this;this.isShowingQueryFailureAlert=!1,this.isQueryingImageItems=!0,c&&c.abort();try{let c=null;if(this.fetchAbortController=new AbortController,e.orderByFields=[`${r.name} ${l}`],i===p.A.VISIBLE)c=await(0,y.h)(s,a,e),this.totalImageItemCount=c?.features?.length??0,this.allImageItemOids=this.getObjectIdsFromImageItemFeatures(c?.features);else{if(this.totalImageItemCount<0){const t=await(0,y.i)(s,e,this.fetchAbortController?.signal);this.totalImageItemCount=t.length,this.allImageItemOids=t}this.totalImageItemCount>=0&&(e.num=Math.min(5*this.imageItemCountPerPage,this.layer.sourceJSON?.maxRecordCount||this.imageItemCountPerPage),c=await(0,y.j)(s,e,this.fetchAbortController?.signal))}if(!m){if(n?.length>0){const e=this.getOidIntersection(n,this.allImageItemOids);this.selectedImageItemFeatureOids=e,this.selectedImageItemFeatures=o.filter(e=>this.selectedImageItemFeatureOids.includes(e.attributes[s.objectIdField]))}this.isSavedImageOidsMerged=!0}const d=this.allImageItemOids?.every(e=>this.selectedImageItemFeatureOids?.includes(e));if(this.isSelectAll=d,this.isSelectAll&&(this.selectedImageItemFeatureOids=[...new Set([...this.allImageItemOids,...this.selectedImageItemFeatureOids])]),this.isQueryingImageItems=!1,!(c&&c.features?.length>0))return void(t||(this.imageItemFeatures=[],this.inspectImageItemFeature=void 0));const g=e.start||0,h=t?this.selectedImageItemFeatures.map(e=>e.attributes[s.objectIdField]):this.imageItemFeatures.map(e=>e.attributes[s.objectIdField]),I=c.features.filter(e=>!h.includes(e.attributes[s.objectIdField]));for(let e=0;e<I.length;e++)t?this.selectedImageItemFeatures[g+e]=I[e]:this.imageItemFeatures[g+e]=I[e]}catch(e){const i=(0,p.f)(e);if(this.isQueryingImageItems=i,i)return;this.isShowingQueryFailureAlert=!0,(t?this.selectedImageItemFeatures.some(e=>!!e):this.imageItemFeatures.some(e=>!!e))?t?this.selectedImageItemListCurPageStartIndex=this.selectedImageItemListPrevPageStartIndex:this.allImageItemListCurPageStartIndex=this.allImageItemListPrevPageStartIndex:(this.totalImageItemCount=-1,t?this.selectedImageItemFeatures=[]:this.imageItemFeatures=[])}}getNewImageItemFeatureToInspect(e){const{activeImageItemListNavTab:t,inspectImageItemFeature:i,imageItemFeatures:s,layer:a,selectedImageItemFeatures:r}=this,l=t===p.I.ALL?s:r,n=l.findIndex(e=>e.attributes[a.objectIdField]===i?.attributes[a.objectIdField]);return l[("previous"===e?n-1+l.length:n+1)%l.length]}handleDisplayedFieldsInImageItemCardChange(e){const{imageItemCardDisplayedFields:t,layer:i,activeQueryField:s,isShowingThumbnails:a}=this;let r=[...t];if(e){const i=t.findIndex(t=>t.name===e.name);i>=0&&(r=[...t.splice(i,1),...t]),i<0&&r.length<4&&(r=[e,...t])}(0,y.k)(i,s).forEach(e=>{r.findIndex(t=>t.name===e?.name)<0&&r.length<4&&r.push(e)}),this.imageItemCardDisplayedFields=r,b(this.layer.id,{isShowingThumbnails:a,selectedFields:r})}closeAllPopovers(){this.handleImageItemDetailsPopoverClose(),this.handleImageItemFiltersPopoverClose(),this.handleImageItemListSettingsPopoverClose(),this.handleImageItemSortPopoverClose()}async highlightImageItem(e){const{view:t,layer:i}=this;this.removeImageItemHighlight();const s=await t.whenLayerView(i);this.highlightImageItemHandler=s.highlight(e)}removeImageItemHighlight(){this.highlightImageItemHandler?.remove()}clearAllImageItemSelections(){this.selectedImageItemFeatures=[],this.selectedImageItemFeatureOids=[]}zoomToSelectedImageItems(e){const{view:t}=this,i=e.filter(e=>!!e);t.goTo(i)}handleSelectAllButtonClick(){const{isSelectAll:e,selectedImageItemFeatureOids:t}=this;this.isSelectAll=!(e&&t.length>0),this.isSelectAll?(this.selectedImageItemFeatures=this.getUniqueImageItems(this.selectedImageItemFeatures,this.imageItemFeatures),this.selectedImageItemFeatureOids=[...new Set([...this.allImageItemOids,...t])]):(this.clearAllImageItemSelections(),this.resetSelectedImageItemListPagination())}async handleAddSelectedImageItemsAsNewLayer(e){if(!e)return;const{layer:t,view:i,activeQueryField:s,imageItemFeatures:a,selectedImageItemFeatures:r}=this,l=(0,p.a)(t.objectIdField,e),m=a.filter(e=>!!e).map(e=>e.attributes[t.objectIdField]);let c=[];c=e.every(e=>m.includes(e))?a.filter(i=>!!i&&e.includes(i.attributes[t.objectIdField])):r.filter(i=>!!i&&e.includes(i.attributes[t.objectIdField]));const d=(0,y.m)(t,s,c),h=c.map(e=>e.geometry),I=n.executeMany(h);let u;o.isLoaded()||await o.load(),I?.extent&&(u=o.execute(I.extent,this.layer.spatialReference));const S=new g.default({method:"lock-raster",lockRasterIds:e}),f=t.clone();f.title=d,f.definitionExpression=l,f.useViewTime=!1,f.mosaicRule=S,u?.extent&&(f.fullExtent=u.extent),i.map?.add(f)}handleImageItemListNavTabChange(e){this.activeImageItemListNavTab=e,this.resetAllImageItemListPagination(),this.resetSelectedImageItemListPagination(),this.isShowingImageItemDetailsPopover&&this.handleImageItemDetailsPopoverClose()}handleZoomToLayer(){const{view:e,layer:t}=this;t.fullExtent&&e.goTo(t.fullExtent)}handleImageItemListPageChange(e){if(this.activeImageItemListNavTab===p.I.ALL){const t=(0,p.p)(e,this.imageItemCountPerPage,this.totalImageItemCount);if(!this.imageItemFeatures[t-1]){const{queryField:t,queryValues:i,isIncludeOverviews:s,displayExtent:a}=this.currentFilterDetail,r=(0,y.f)({layer:this.layer,queryField:t,queryValues:i,isIncludeOverviews:s,extent:a});r.start=e-1,this.queryImageCollectionItemsAndCount(r)}}if(this.activeImageItemListNavTab===p.I.SELECT){const t=(0,p.p)(e,this.imageItemCountPerPage,this.isSelectAll?this.totalImageItemCount:this.selectedImageItemFeatureOids.length);if(!this.selectedImageItemFeatures[t-1]){const t=(0,y.f)({layer:this.layer,isIncludeOverviews:!0,extent:null,selectedImageItemOids:this.selectedImageItemFeatureOids});t.start=e-1,this.queryImageCollectionItemsAndCount(t,!0)}}}resetAllImageItemListPagination(){this.allImageItemListCurPageStartIndex=1,this.allImageItemListPrevPageStartIndex=1}resetSelectedImageItemListPagination(){this.selectedImageItemListCurPageStartIndex=1,this.selectedImageItemListPrevPageStartIndex=1}getObjectIdsFromImageItemFeatures(e){const{layer:t}=this;return Array.isArray(e)?e.filter(e=>!!e).map(e=>e.attributes[t.objectIdField]):[]}sortSelectedImageItems(e){const{imageItemSortField:t,imageItemSortOrder:i,locale:s}=this,a=e.sort((e,a)=>{const r=e.attributes[t.name],l=a.attributes[t.name];return i===p.S.ASC?(0,p.e)(r,l,s):(0,p.e)(l,r,s)});this.selectedImageItemFeatures=a}getUniqueImageItems(e,t){const i=[...e,...t],s=new Map;return i.forEach(e=>{e&&s.set(e.attributes[this.layer.objectIdField],e)}),Array.from(s.values())}getOidIntersection(e,t){const i=new Set(e);return[...new Set(t)].filter(e=>i.has(e))}loadSavedUIOptionsFromLocalStorage(e){if(!e)return;const t=(i=e,P(F(i))?.sortingOption);var i;t&&(this.imageItemSortOrder=t.sortOrder,this.imageItemSortField=d.default.fromJSON(t.sortField));const s=function(e){return P(F(e))?.listSettingsOption}(e);s&&(this.imageItemCardDisplayedFields=s.selectedFields.map(e=>d.default.fromJSON(e)),this.isShowingThumbnails=s.isShowingThumbnails);const a=function(e){return P(F(e))?.filterOptions}(e);a&&(this.currentFilterDetail={...a,queryField:d.default.fromJSON(a.queryField)},this.selectedAOI=a.selectedAOI,this.isFilterApplied=!0,this.activeQueryField=d.default.fromJSON(a.queryField));const r=function(e){return P(F(e))?.selectedImageItems}(e);if(r){const e=r.map(e=>m.default.fromJSON(e));this.selectedImageItemFeatures=e}this.selectedImageItemFeatureOids=function(e){return P(F(e))?.selectedImageItemOids??[]}(e)}handleImageSelectionCountAlertClosed(){this.isShowingImageSelectionCountAlert=!1,this.isShowingExceedMaxMosaicImageCountAlert=!1}handleExceedMaxMosaicImageCountAlertClosed(){this.isShowingExceedMaxMosaicImageCountAlert=!1}handleQueryFailedAlertClosed(){this.isShowingQueryFailureAlert=!1}toggleListSettingsPopoverOpenClose(e){const{messages:t,isShowingListSettingsPopover:i,isShowingThumbnails:s,imageItemCardDisplayedFields:a,hidePanelHeader:r,layer:l}=this;e.stopImmediatePropagation(),i?this.handleImageItemListSettingsPopoverClose():i||(this.closeAllPopovers(),this.isShowingListSettingsPopover=!0,this.imageryItemListSettingsPopover=(0,v.dN)(S.qy`<arcgis-imagery-item-list-settings-popover .offsetSkidding=${r?0:50} .referenceElement=${this.el} .messages=${t} .fields=${(0,y.g)(l.fields)} .preselectedFields=${a} .isShowingThumbnails=${s} .open=${this.isShowingListSettingsPopover&&!this.listSettingsDisabled} @arcgisImageItemListSettingsSave=${this.handleImageItemListSettingsSave} @arcgisImageItemListSettingsPopoverClose=${this.handleImageItemListSettingsPopoverClose}></arcgis-imagery-item-list-settings-popover>`),this.imageryItemListSettingsPopover&&!document.body.contains(this.imageryItemListSettingsPopover)&&document.body.appendChild(this.imageryItemListSettingsPopover))}toggleFiltersPopoverOpenClose(e){const{locale:t,view:i,messages:s,isShowingFiltersPopover:a,hidePanelHeader:r,layer:l}=this;e.stopImmediatePropagation(),a?this.handleImageItemFiltersPopoverClose():a||(this.closeAllPopovers(),this.isShowingFiltersPopover=!0,this.imageryItemFiltersPopover=(0,v.dN)(S.qy`<arcgis-imagery-item-filters-popover .locale=${t} .layer=${l} .view=${i} .referenceElement=${this.el} .messages=${s} .open=${this.isShowingFiltersPopover} .currentFilterDetail=${this.currentFilterDetail} .offsetSkidding=${r?0:50} .attributeFilterDisabled=${this.attributeFilterDisabled} .spatialFilterDisabled=${this.spatialFilterDisabled} .imageTypeFilterDisabled=${this.imageTypeFilterDisabled} @arcgisImageItemFiltersPopoverClose=${this.handleImageItemFiltersPopoverClose} @arcgisImageItemFilterApply=${this.handleImageItemFilterApply}></arcgis-imagery-item-filters-popover>`),this.imageryItemFiltersPopover&&!document.body.contains(this.imageryItemFiltersPopover)&&document.body.appendChild(this.imageryItemFiltersPopover))}toggleSortSettingsPopoverOpenClose(e){const{messages:t,isShowingSortPopover:i,imageItemSortField:s,imageItemSortOrder:a,hidePanelHeader:r,layer:l}=this;e.stopImmediatePropagation(),i?this.handleImageItemSortPopoverClose():i||(this.closeAllPopovers(),this.isShowingSortPopover=!0,this.imageryItemSortPopover=(0,v.dN)(S.qy`<arcgis-imagery-item-sort-popover .offsetSkidding=${r?0:50} open .referenceElement=${this.el} .messages=${t} .fields=${l.fields} .preselectedSortField=${s} .preselectedSortOrder=${a} @arcgisImageItemSortChangeSave=${this.handleImageItemsSortChangeSave} @arcgisImageItemSortPopoverClose=${this.handleImageItemSortPopoverClose}></arcgis-imagery-item-sort-popover>`),this.imageryItemSortPopover&&!document.body.contains(this.imageryItemSortPopover)&&document.body.appendChild(this.imageryItemSortPopover))}render(){const{messages:e,hidePanelHeader:t,isShowingQueryFailureAlert:i,isShowingExceedMaxMosaicImageCountAlert:s,isShowingImageSelectionCountAlert:a,sortDisabled:r,listSettingsDisabled:l,imageTypeFilterDisabled:n,spatialFilterDisabled:o,attributeFilterDisabled:m,layer:c}=this,d=!c?.loaded,g=!(m&&o&&n&&r&&l);return S.qy`<calcite-panel .loading=${d} .heading=${t?"":e.imageCollectionExplorer} class="panel">${!t&&this.renderPanelCloseButton()||""}${g&&this.renderActionBar()||""}${this.renderImageItemList()}</calcite-panel>${this.renderAlert("",e.filterFailedErrorMessage,p.q.DANGER,i,this.handleQueryFailedAlertClosed)}${this.renderAlert("",e.exceedMaxMosaicImageCountWarningMessage,p.q.WARNING,s&&!a,this.handleExceedMaxMosaicImageCountAlertClosed)}${this.renderAlert("",e.imageSelectionCountWarningMessage,p.q.WARNING,a,this.handleImageSelectionCountAlertClosed)}`}renderPanelCloseButton(){const{messages:e}=this;return S.qy`<calcite-action .text=${e.close} icon=x slot=header-actions-end @click=${this.handlePanelClose} ${(0,f.K)(this.refCloseButtonNode)}></calcite-action>`}renderActionBar(){const{messages:e,imageItemSortOrder:t,imageItemSortField:i,isShowingFiltersPopover:s,isShowingListSettingsPopover:a,isShowingSortPopover:r,sortDisabled:l,listSettingsDisabled:n,attributeFilterDisabled:o,spatialFilterDisabled:m,imageTypeFilterDisabled:c}=this,d=t===p.S.ASC;return S.qy`<calcite-action-bar slot=action-bar expanded expand-disabled layout=horizontal scale=l>${!(o&&m&&c)&&S.qy`<calcite-action icon=sliders text title=${e.filters??S.s6} .active=${s} @click=${this.toggleFiltersPopoverOpenClose}></calcite-action>`||""}${!n&&S.qy`<calcite-action icon=list text title=${e.listSettings??S.s6} .active=${a} @click=${this.toggleListSettingsPopoverOpenClose}></calcite-action>`||""}${!l&&S.qy`<div class="sort-image-item-action-wrapper"><calcite-action .icon=${d?"sort-ascending":"sort-descending"} text-enabled .text=${`${e.sortBy} ${i?.name}`} title=${(d?e.sortImageItemAscendingOrder:e.sortImageItemDescendingOrder)??S.s6} .active=${r} @click=${this.toggleSortSettingsPopoverOpenClose}></calcite-action></div>`||""}</calcite-action-bar>`}renderImageItemListTabs(){const{messages:e,activeImageItemListNavTab:t,selectedImageItemFeatureOids:i}=this,s=i.length>0;return S.qy`<calcite-tabs layout=center><calcite-tab-nav slot=title-group><calcite-tab-title .selected=${t===p.I.ALL} @click=${()=>this.handleImageItemListNavTabChange(p.I.ALL)}>${e.all}</calcite-tab-title><calcite-tab-title .selected=${t===p.I.SELECT} .disabled=${!s} @click=${()=>this.handleImageItemListNavTabChange(p.I.SELECT)}>${e.selected}</calcite-tab-title></calcite-tab-nav></calcite-tabs>`}renderImageItemList(){const{messages:e,isQueryingImageItems:t,totalImageItemCount:i,selectedImageItemFeatureOids:s,imageItemFeatures:a,activeImageItemListNavTab:r}=this;if(t)return S.qy`<calcite-loader .label=${e.loading} scale=m></calcite-loader>`;const l=r===p.I.ALL?i>0&&a?.length>0:s.length>0;return S.qy`<div class="image-item-list-container">${this.renderImageItemListTabs()}${s?.length>0&&this.renderImageItemListSelectionButtonGroup()||""}${!l&&this.renderNoImageItemFetchedCoachMessage()||""}${l&&this.renderImageItemListPaginationInfo()||""}${l&&this.renderImageItemCardList()||""}${l&&this.renderImageItemListPagination()||""}</div>`}renderSelectedImageItemCount(){const{messages:e,selectedImageItemFeatureOids:t}=this,i=t.length,s=e.selectedImageItemCountInfo.replace("${selectedCount}",`${i}`);return i>0&&S.qy`<calcite-chip .label=${s} kind=brand closable @calciteChipClose=${()=>this.clearAllImageItemSelections()}>${s}</calcite-chip>`||""}renderImageItemListSelectionButtonGroup(){const{messages:e,selectedImageItemFeatures:t,selectedImageItemFeatureOids:i,addToMapDisabled:s,zoomToDisabled:a}=this;return S.qy`<div class="image-item-list-selection-button-wrapper">${this.renderSelectedImageItemCount()}<div style=${(0,v.zl)({display:"flex"})}>${!s&&S.qy`<calcite-button .label=${e.addToMap} appearance=transparent icon-start=add-layer kind=neutral scale=s title=${e.addToMap??S.s6} @click=${()=>this.handleAddSelectedImageItemsAsNewLayer(i)}></calcite-button>`||""}${!a&&S.qy`<calcite-button .label=${e.zoomToSelection} appearance=transparent icon-start=zoom-to-object kind=neutral scale=s title=${e.zoomToSelection??S.s6} @click=${()=>this.zoomToSelectedImageItems(t)}></calcite-button>`||""}</div></div>`}renderImageItemListPaginationInfo(){const{messages:e,activeImageItemListNavTab:t,totalImageItemCount:i,allImageItemListCurPageStartIndex:s,selectedImageItemListCurPageStartIndex:a,selectedImageItemFeatureOids:r}=this,l=t===p.I.ALL?i:r.length,n=t===p.I.ALL?s:a,o=(0,p.p)(n,this.imageItemCountPerPage,l),m=e.imageItemPaginationAndTotalCountInfo.replace("${totalCount}",`${l}`).replace("${start}",`${n}`).replace("${end}",`${o}`);return S.qy`<div class="list-pagination-info-wrapper"><div>${m}</div>${t===p.I.ALL&&this.renderSelectAllButton()||""}</div>`}renderSelectAllButton(){const{messages:e,isSelectAll:t}=this;return S.qy`<calcite-button name=select-all kind=brand appearance=transparent @click=${this.handleSelectAllButtonClick}>${t?e.deselectAll:e.selectAll}</calcite-button>`}renderImageItemCardList(){const{messages:e,activeImageItemListNavTab:t,imageItemFeatures:i,selectedImageItemFeatures:s,selectedImageItemFeatureOids:a,layer:r,isShowingThumbnails:l,allImageItemListCurPageStartIndex:n,selectedImageItemListCurPageStartIndex:o,inspectImageItemFeature:m,isShowingImageItemDetailsPopover:c,addToMapDisabled:d,zoomToDisabled:g,viewImageDetailsDisabled:h}=this,I=t===p.I.ALL?i:s,u=t===p.I.ALL?n:o,y=(0,p.p)(u,this.imageItemCountPerPage,I.length),f=I?.slice(u-1,y).map(t=>{if(!t)return null;const i=t.attributes[r.objectIdField],n=this.isSelectAll||this.selectedImageItemFeatureOids.includes(i),o=c&&m?.attributes[r.objectIdField]===i;return S.qy`<li @mouseover=${()=>this.highlightImageItem(t)} @mouseout=${this.removeImageItemHighlight}><calcite-card><div class="image-item-info-container">${l?this.renderPreviewThumbnail(i):null}<div class="image-item-info-text-section"><div>${t.attributes.Name||t.attributes.name}</div>${this.renderFeatureAttributesInImageItemCard(t)}</div></div><div slot=footer-start style=${(0,v.zl)({"flex-wrap":"wrap"})}>${!h&&S.qy`<calcite-button kind=neutral icon-start=information .appearance=${o?"solid":"transparent"} title=${e.viewImageDetails??S.s6} @click=${()=>this.openImageItemDetailsPopover(t)}></calcite-button>`||""}${!g&&S.qy`<calcite-button kind=neutral icon-start=zoom-to-object appearance=transparent title=${e.zoomToImage??S.s6} @click=${()=>this.zoomToSelectedImageItems([t])}></calcite-button>`||""}${!d&&S.qy`<calcite-button kind=neutral icon-start=add-layer appearance=transparent title=${e.addImageToMap??S.s6} @click=${()=>this.handleAddSelectedImageItemsAsNewLayer([i])}></calcite-button>`||""}</div><div slot=footer-end><calcite-button .appearance=${n?"solid":"outline"} kind=neutral .iconEnd=${n?"x":""} @click=${()=>{n&&this.isSelectAll&&(this.isSelectAll=!1);const e=n?s.filter(e=>e?.attributes[r.objectIdField]!==i):[...s,t];this.sortSelectedImageItems(e);const l=n?a.filter(e=>e!==i):[...a,i];this.selectedImageItemFeatureOids=l}}>${n?e.selected:e.select}</calcite-button></div></calcite-card></li>`});return S.qy`<ul class="image-item-card-list">${f}</ul>`}renderPreviewThumbnail(e){const{layer:t,messages:i}=this,s=`${t.url}/${e}/thumbnail`;return S.qy`<arcgis-imagery-item-thumbnail .thumbnailUrlToFetch=${s} .messages=${i}></arcgis-imagery-item-thumbnail>`}renderFeatureAttributesInImageItemCard(e){const{imageItemCardDisplayedFields:t,layer:i,view:s}=this,a=t.map(t=>{let a=e.attributes[t.name];if("date"===t.type&&a){const{fieldInfos:e}=i.popupTemplate??{},r=Array.isArray(e)&&e.find(e=>e.fieldName===t.name);a=l.formatDate(a,{...l.convertDateFormatToIntlOptions(r&&r.format?.dateFormat?r.format.dateFormat:"short-date-short-time"),timeZone:s?.timeZone||"system"})}if((0,p.d)(t)){const e=t.domain;a="function"==typeof e.getName?e.getName(a):c.default.fromJSON(t.domain).getName(a)}if(Number.isFinite(a)&&!(0,p.d)(t)&&(0,p.i)(t.type)&&"oid"!==t.type){const{fieldInfos:e}=i.popupTemplate??{},s=Array.isArray(e)&&e.find(e=>e.fieldName===t.name);let r;if(s){const{digitSeparator:e,places:t}=s.format??{};r=l.convertNumberFormatToIntlOptions({style:"decimal",places:t,digitSeparator:e})}a=r?l.formatNumber(a,r):(0,p.n)(a)}return S.qy`<li>${`${t.name} : ${a??""}`}</li>`});return S.qy`<ul class="image-item-card-displayed-field-list">${a}</ul>`}renderImageItemListPagination(){const{messages:e,activeImageItemListNavTab:t,totalImageItemCount:i,allImageItemListCurPageStartIndex:s,selectedImageItemListCurPageStartIndex:a,selectedImageItemFeatureOids:r}=this,l=t===p.I.ALL?i:r.length,n=t===p.I.ALL?s:a;return S.qy`<div class="pagination-wrapper"><calcite-pagination @calcitePaginationChange=${e=>{const i=e.target;t===p.I.ALL&&(this.allImageItemListPrevPageStartIndex=this.allImageItemListCurPageStartIndex,this.allImageItemListCurPageStartIndex=i.startItem,this.handleImageItemListPageChange(this.allImageItemListCurPageStartIndex)),t===p.I.SELECT&&(this.selectedImageItemListPrevPageStartIndex=this.selectedImageItemListCurPageStartIndex,this.selectedImageItemListCurPageStartIndex=i.startItem,this.handleImageItemListPageChange(this.selectedImageItemListCurPageStartIndex))}} .startItem=${n} .totalItems=${l} .pageSize=${this.imageItemCountPerPage} .messageOverrides=${{next:e.next,previous:e.previous}} class=${(0,v.CP)({hide:!l||l<this.imageItemCountPerPage})}></calcite-pagination></div>`}renderNoImageItemFetchedCoachMessage(){const{messages:e,isFilterApplied:t}=this;return S.qy`<div class="no-image-item-coach-wrapper"><calcite-icon scale=l icon=overview></calcite-icon>${t?e.updateFilterOrZoomToBrowseImages:e.zoomToBrowseImages}${t?S.qy`<calcite-button kind=neutral appearance=outline @click=${this.toggleFiltersPopoverOpenClose}>${e.updateFilters}</calcite-button>`:S.qy`<calcite-button kind=neutral appearance=outline @click=${this.handleZoomToLayer}>${e.zoomToImages}</calcite-button>`}</div>`}renderAlert(e,t,i,s,a){return S.qy`<calcite-alert .kind=${i} .label=${e} .open=${s} icon=exclamation-mark-circle auto-close auto-close-duration=fast @calciteAlertClose=${a}><div slot=title>${e}</div><div slot=message>${t}</div></calcite-alert>`}}(0,s.c)("arcgis-imagery-collection-explorer",x)},6250:(e,t,i)=>{i.d(t,{A:()=>a,I:()=>r,S:()=>l,a:()=>F,b:()=>x,c:()=>v,d:()=>I,e:()=>f,f:()=>o,g:()=>p,h:()=>b,i:()=>g,j:()=>u,k:()=>w,l:()=>A,m:()=>h,n:()=>$,o:()=>C,p:()=>S,q:()=>n,r:()=>P,s:()=>d});var s=i(2797),a=(e=>(e.VISIBLE="visible",e.DISPLAY_EXTENT="displayExtent",e.ALL="all",e))(a||{}),r=(e=>(e.ALL="all",e.SELECT="select",e))(r||{}),l=(e=>(e.ASC="asc",e.DESC="desc",e))(l||{}),n=(e=>(e.BRAND="brand",e.DANGER="danger",e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e))(n||{});function o(e){return"object"==typeof e&&null!==e&&"name"in e&&"AbortError"===e.name}const m=new Set(["single","double"]),c=new Set(["small-integer","big-integer","integer","oid",...m]),d=new Set([...c,"date","string"]);function g(e){return c.has(e)}function h(e){return m.has(e)}function I(e){return!!e?.domain?.codedValues}function u(e){return I(e)&&"MosaicCatalogItemCategoryDomain"===e?.domain?.name}function p(e,t=!1){if(!e)return null;const i=new Date(e),s=t?i.getUTCFullYear():i.getFullYear(),a=t?i.getUTCMonth():i.getMonth(),r=t?i.getUTCDate():i.getDate(),l=t?i.getUTCHours():i.getHours(),n=t?i.getUTCMinutes():i.getMinutes(),o=t?i.getUTCSeconds():i.getSeconds();return`${s}-${y((a+1).toString(),2,"0")}-${y(r.toString(),2,"0")} ${y(l.toString(),2,"0")}:${y(n.toString(),2,"0")}:${y(o.toString(),2,"0")}`}function y(e,t,i){for(i=i||" ";e.length<t;)e=i+e;return e}function S(e,t,i){return e+t-1>i?i:e+t-1}function f(e,t,i="en"){return"string"==typeof e&&"string"==typeof t?e.localeCompare(t,i):e<t?-1:e>t?1:0}function v(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}function F(e,t){return`${e} IN (${t.map(e=>`${e}`).join(",")})`}const b=(e,t="en")=>{const i=e.toString();if(i.includes("e")){const[e,t]=i.split("e"),s=Math.max(0,e.length-2),a=Number.parseInt(t,10);return a<0?s-a:Math.max(0,s-a)}const s=i.indexOf(".");if(-1===s)return 0;const a=i.length-s-1;return new Intl.NumberFormat(t).formatToParts(1.1).find(e=>"decimal"===e.type)?a:0};function C(e){e?.remove()}function w(e,t){const i=Math.pow(10,t);return Math.floor(e*i)/i}function A(e,t){const i=Math.pow(10,t);return Math.ceil(e*i)/i}function P(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}function $(e,t){if(null==e)return"";const i=b(e),a=s.convertNumberFormatToIntlOptions({...i>0&&{places:t&&t>0?Math.min(t,i):i,style:"decimal"},digitSeparator:!0});return s.formatNumber(e,a)}function x(e,t){return null==e?"":"date"===t?s.formatDate(e):g(t)&&"oid"!==t?$(e,4):e.toString()}},7325:(e,t,i)=>{i.d(t,{s:()=>s});const s=(e,t=100)=>{let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...s)},t)}}},8685:(e,t,i)=>{i.d(t,{a:()=>n,b:()=>h,c:()=>b,d:()=>u,e:()=>I,f:()=>g,g:()=>d,h:()=>S,i:()=>o,j:()=>m,k:()=>c,l:()=>f,m:()=>F,r:()=>v});var s=i(8423),a=i(2373),r=i(1552),l=i(6250);function n(e){const t=e.find(e=>"best"===e.name.toLowerCase());if(t)return t;const i=e.find(e=>"acquisitiondate"===e.name.toLowerCase());if(i)return i;return e.find(e=>"date"===e.name.toLowerCase())||e.find(e=>"double"===e.type||"integer"===e.type)}async function o(e,t,i){return await e.queryObjectIds(t,{signal:i})}async function m(e,t,i){t.outFields=["*"],t.returnGeometry=!0;const s=await e.queryRasters(t,{signal:i,timeout:12e4});return s?.features?.length?s:null}function c(e,t){const i=e.fields;let s=i.find(e=>"name"===e.name.toLowerCase());return s||(s=i.find(t=>t.name===e.objectIdField)),s&&!t?[s]:s&&s.name!==t.name?[s,t]:[t]}function d(e){return Array.isArray(e)?e.filter(e=>l.s.has(e.type)):[]}function g(e){const{layer:t,queryField:i,queryValues:s,isIncludeOverviews:a,extent:r,selectedImageItemOids:n}=e,o=t.createQuery();if(s&&s.length>0){let e="";if("date"===i?.type&&s[0]){const t=new Date(s[0]),a=(0,l.g)(s[0],!0),r=1===s.length||s[0]===s[1]?(0,l.g)(t.setDate(t.getDate()+1),!0):(0,l.g)(s[1],!0);e=`${i.name} BETWEEN timestamp '${a}' AND timestamp '${r}'`}else{const t=s.filter(e=>"string"==typeof e||"number"==typeof e);if(1===t.length||2===t.length){const[a,r]=s,l="string"==typeof a;e=1===t.length?`${i?.name}=${l?`'${a}'`:a}`:`${i?.name} BETWEEN ${l?`'${a}'`:a} AND ${l?`'${r}'`:r}`}}o.where=e}const m="(Category = 1)";if(a)o.where=o.where?.replace(m,"");else{const e=m+(o.where?` AND (${o.where})`:"");o.where=e}let c="";return n&&n.length>0&&(c=(0,l.a)(t.objectIdField,n)),o.where=c?`${o.where} AND (${c})`:o.where,t.definitionExpression&&(o.where=o.where?`${o.where} AND (${t.definitionExpression})`:t.definitionExpression),r&&(o.geometry=r),o}function h(e){return e.extent?.clone().expand(.75)}async function I(e,t,i,s,a){if(!t)return[];const r=[{onStatisticField:t.name,outStatisticFieldName:"cnt",statisticType:"count"}],n=await p(e,i,s,r,[t.name]);if(n){const i=await e.queryRasters(n,{signal:a});if(i?.features?.length>0){const e=(0,l.i)(t.type);return i.features.map(i=>{const s=i.attributes[t.name];return e?Number(s):s})}}return[]}async function u(e,t,i,s,a){if(!t.name)return[];const r=[{statisticType:"min",onStatisticField:t.name,outStatisticFieldName:"min_field_value"},{statisticType:"max",onStatisticField:t.name,outStatisticFieldName:"max_field_value"}],l=await p(e,i,s,r);if(l){const t=await e.queryRasters(l,{signal:a});if(t?.features?.length>0){const[e]=t.features;return[e.attributes.min_field_value,e.attributes.max_field_value]}}return[]}async function p(e,t,i,s,a=[]){const r=e.createQuery();if(r.returnGeometry=!1,t===l.A.DISPLAY_EXTENT&&(r.geometry=h(i)),t===l.A.VISIBLE){const t=await y(e,i);if(!(t.length>0))return null;r.where=(0,l.a)(e.objectIdField,t)}return e.definitionExpression&&(r.where=r.where?`${r.where} AND (${e.definitionExpression})`:e.definitionExpression),r.outStatistics=s,a.length>0&&(r.groupByFieldsForStatistics=a),r}async function y(e,t){const i=[],a=function(e,t){const{extent:i,width:a,height:l}=t,n=i.width/a,o=i.height/l,m=new s.default({x:n,y:o});m.spatialReference=i.spatialReference;const c=new r.default;c.geometry=h(t),c.returnGeometry=!0,c.pixelSize=m,c.maxItemCount=e.sourceJSON?.maxMosaicImageCount,c.returnPixelValues=!1;const d=e.mosaicRule.clone();if(e.definitionExpression&&(d.where=e.definitionExpression),c.mosaicRule=d,e.useViewTime){const i=t.timeExtent?t.timeExtent.intersection(e.timeExtent):e.timeExtent;c.timeExtent=i}return!e.useViewTime&&e.timeExtent&&(c.timeExtent=e.timeExtent),c}(e,t),l=await e.identify(a,{timeout:12e4});if(!l?.catalogItems?.features||!l?.catalogItemVisibilities)return[];for(let t=0;t<l.catalogItems.features.length;t++)l.catalogItemVisibilities[t]>0&&i.push(l.catalogItems.features[t].attributes[e.objectIdField]);return i}async function S(e,t,i){const s=await y(e,t);if(!(s.length>0))return null;i.objectIds=s,i.outFields=["*"],i.returnGeometry=!0;const a=await e.queryRasters(i,{timeout:12e4});return a?.features?.length>0?a:null}function f(e,t){if(t.length){const i=new a.default;i.method="lock-raster",i.lockRasterIds=t,e.definitionExpression&&(i.where=e.definitionExpression),e.mosaicRule=i}}function v(e,t){t&&(e.mosaicRule=t.clone())}function F(e,t,i){const{title:s}=e,a=t.name;let r="";const n=i.map(e=>e.attributes[a]).map(e=>(0,l.b)(e,t.type));return n.sort((e,t)=>"number"==typeof e&&"number"==typeof t?e-t:String(e).localeCompare(String(t))),1===n.length&&(r=`(${n[0]})`),n.length>1&&(r=`(${n[0]} - ${n[n.length-1]})`),`${s} - ${a} ${r}`}function b(e,t){return Math.abs(t.extent.center.x-e.center.x)<t.resolution&&Math.abs(t.extent.center.y-e.center.y)<t.resolution}},9958:(e,t,i)=>{i.d(t,{t:()=>a});var s=i(4345);const a=new class{constructor(){this.cache=new Map,this.inflightJobs=new Map,this.queue=[],this.processing=!1}add(e,t){const i=this.cache.get(e);i&&i!==t&&URL.revokeObjectURL(i),this.cache.set(e,t)}clear(){for(const e of this.cache.values())URL.revokeObjectURL(e);this.cache.clear()}fetchOrGet(e){const t=this.cache.get(e);if(t)return Promise.resolve(t);const i=this.inflightJobs.get(e);if(i)return i;const a=new Promise(t=>{this.queue.push(async()=>{try{const i=await(0,s.default)(e,{responseType:"blob"});if(i?.data){const s=URL.createObjectURL(i.data);this.add(e,s),t(s)}else t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAoMBgF6k6XkAAAAASUVORK5CYII=")}catch{t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAoMBgF6k6XkAAAAASUVORK5CYII=")}finally{this.inflightJobs.delete(e)}}),this.processQueue()});return this.inflightJobs.set(e,a),a}async processQueue(){if(!this.processing){for(this.processing=!0;this.queue.length>0;)await this.queue.shift()();this.processing=!1}}}}}]);