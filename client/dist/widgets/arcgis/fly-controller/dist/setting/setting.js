System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui","jimu-ui/basic/list-tree","esri/views/3d/webgl","jimu-ui/advanced/map"],function(e,t){var i={},s={},n={},a={},r={},o={},l={},h={},d={};return{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){s.APP_FRAME_NAME_IN_BUILDER=e.APP_FRAME_NAME_IN_BUILDER,s.Immutable=e.Immutable,s.React=e.React,s.appActions=e.appActions,s.classNames=e.classNames,s.css=e.css,s.defaultMessages=e.defaultMessages,s.focusElementInKeyboardMode=e.focusElementInKeyboardMode,s.getAppStore=e.getAppStore,s.hooks=e.hooks,s.lodash=e.lodash,s.polished=e.polished,s.useIntl=e.useIntl,s.utils=e.utils,s.uuidv1=e.uuidv1},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){a.getAppConfigAction=e.getAppConfigAction},function(e){r.MapWidgetSelector=e.MapWidgetSelector,r.SettingRow=e.SettingRow,r.SettingSection=e.SettingSection},function(e){o.Badge=e.Badge,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.FloatingPanel=e.FloatingPanel,o.Icon=e.Icon,o.Label=e.Label,o.Loading=e.Loading,o.LoadingType=e.LoadingType,o.NumericInput=e.NumericInput,o.PanelHeader=e.PanelHeader,o.Radio=e.Radio,o.Select=e.Select,o.Slider=e.Slider,o.TextInput=e.TextInput,o.defaultMessages=e.defaultMessages,o.hooks=e.hooks},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType},function(e){h.fromRenderCoordinates=e.fromRenderCoordinates,h.toRenderCoordinates=e.toRenderCoordinates},function(e){d.DrawingElevationMode3D=e.DrawingElevationMode3D,d.JimuDraw=e.JimuDraw,d.JimuDrawCreationMode=e.JimuDrawCreationMode,d.JimuMap=e.JimuMap}],execute:function(){e((()=>{var e={3981:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.793 1.14a.984.984 0 0 1 1.32-.085l.094.085 5.5 5.624c.36.368.388.948.083 1.35l-.083.096-6.5 6.646a1 1 0 0 1-.576.291l-.131.009h-4a1 1 0 0 1-.608-.21l-.099-.09-3.5-3.579a1.04 1.04 0 0 1-.083-1.35l.083-.096zm.707.706-8.492 8.685q-.011.012-.007.032l.007.015 3.497 3.577h3.989l6.498-6.644c.007-.008.01-.022.007-.033l-.007-.015zM3.006 10.19l1.838-1.85 3.922 4.107.005.01q.003.016-.005.025l-.413.358h-2.85l-2.497-2.615L3 10.214q-.003-.015.005-.024" clip-rule="evenodd"></path></svg>'},4108:e=>{"use strict";e.exports=a},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},11417:e=>{"use strict";e.exports=h},12046:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},14321:e=>{"use strict";e.exports=o},20237:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.933 4.622a.6.6 0 0 0-.933.5v5.757a.6.6 0 0 0 .933.499l4.318-2.879a.6.6 0 0 0 0-.998zM10.197 8 7 10.131V5.868z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},24362:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m13.838 3-1.94-1.616.641-.768L16 3.5l-3.46 2.884-.641-.768L13.838 4H3.37C2.061 4 1 5.191 1 6.5S2.061 9 3.37 9h9.25C14.487 9 16 10.133 16 12s-1.513 3-3.38 3H1v-1h11.62c1.314 0 2.38-.686 2.38-2s-1.066-2-2.38-2H3.37C1.509 10 0 8.361 0 6.5S1.509 3 3.37 3z"></path></svg>'},26490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.154 3.154a.527.527 0 0 1 .746 0l1.317 1.317A8.6 8.6 0 0 1 8 4c2.667 0 5.667 1.333 7 4-.696 1.393-1.847 2.422-3.168 3.087l1.014 1.013a.527.527 0 1 1-.746.746l-1.317-1.317A8.6 8.6 0 0 1 8 12c-2.667 0-5.667-1.333-7-4 .696-1.393 1.847-2.422 3.168-3.087L3.154 3.9a.527.527 0 0 1 0-.746m1.698 2.443C3.726 6.087 2.782 6.882 2 8c1.422 2.033 3.382 3 6 3a8.7 8.7 0 0 0 2.03-.225l-.675-.674A2.5 2.5 0 0 1 5.9 6.644zm6.296 4.805C12.275 9.913 13.218 9.119 14 8c-1.422-2.033-3.382-3-6-3q-1.088 0-2.03.225l.675.674a2.5 2.5 0 0 1 3.457 3.456zM6.5 8c0-.221.048-.431.134-.62l1.987 1.986A1.5 1.5 0 0 1 6.5 8m.88-1.366 1.986 1.987a1.5 1.5 0 0 0-1.987-1.987" clip-rule="evenodd"></path></svg>'},26900:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.734.46 2.86 5.377v-2.99L1 0zM1.764 2.99A8 8 0 1 0 8.956.057l-.743.946a7 7 0 1 1-6.107 3.22l-.094-.992zM9 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},39815:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 1a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-4 2a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-1.812 10L11 4 3 9.328l4.438.337zM2 15a1 1 0 1 1-2 0 1 1 0 0 1 2 0m2 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3-3a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},40904:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M5 1H4v14h1zm7 0h-1v14h1z" clip-rule="evenodd"></path></svg>'},43439:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjEwOHB4IiBoZWlnaHQ9IjcycHgiIHZpZXdCb3g9IjAgMCAxMDggNzIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPGcgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMzE2LjAwMDAwMCwgLTU5Ny4wMDAwMDApIj4NCiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEzMTYuMDAwMDAwLCA1OTcuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgPGc+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgZmlsbD0iIzZBNkE2QSIgY3g9IjUzIiBjeT0iNDMiIHI9IjEwIj48L2NpcmNsZT4NCiAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBmaWxsPSIjNTI1MjUyIiBjeD0iMzEiIGN5PSI0NyIgcj0iNiI+PC9jaXJjbGU+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgZmlsbD0iIzUyNTI1MiIgY3g9IjUzIiBjeT0iMjEiIHI9IjYiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGZpbGw9IiM1MjUyNTIiIGN4PSIzNyIgY3k9IjMxIiByPSI2Ij48L2NpcmNsZT4NCiAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBmaWxsPSIjNTI1MjUyIiBjeD0iNjkiIGN5PSIzMSIgcj0iNiI+PC9jaXJjbGU+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgZmlsbD0iIzUyNTI1MiIgY3g9Ijc1IiBjeT0iNDciIHI9IjYiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgIDwvZz4NCiAgICAgICAgICAgIDwvZz4NCiAgICAgICAgPC9nPg0KICAgIDwvZz4NCjwvc3ZnPg=="},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},48993:e=>{"use strict";e.exports=d},50313:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m9.489.072.848.29-.989 2.71-.784-.465zM12.594 2.974l-2.44 1.128.25.85 2.579-1.194zM2.04 7.854l.39.784 2.578-1.191-.529-.72zM5.554 2.862 4.58.896 5.392.52l.974 1.966zM4.272 4.591l-2.624-.894-.299.82 2.805.957z"></path><path fill="#000" fill-rule="evenodd" d="m6.3 3.383 9 6.285h-3.874l2.315 4.421-2.686 1.294-2.373-4.498L6.3 14.009zM7.299 5.3v5.748l1.537-2.014 2.653 5.03.886-.427-2.601-4.97h2.347z" clip-rule="evenodd"></path></svg>'},60591:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M5 11V5h6v6zm1-5h4v4H6z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-8 7A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=n},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=i},73529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 12c-2.667 0-5.667-1.333-7-4 1.333-2.667 4.333-4 7-4s5.667 1.333 7 4c-1.333 2.667-4.333 4-7 4m0-7c-2.618 0-4.578.967-6 3 1.422 2.033 3.382 3 6 3s4.578-.967 6-3c-1.422-2.033-3.382-3-6-3m0 5.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0-1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},74919:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7 2h2a2 2 0 0 1 2 2v7.817l-3 2.812-3-2.812V4a2 2 0 0 1 2-2m5 2v8.25L8 16l-4-3.75V4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3M9 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=s},79298:e=>{"use strict";e.exports=r},86058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.582 5 11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2z"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},97408:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m2 1 12 7-12 7zm9.983 6.999L3 2.723v10.553z" clip-rule="evenodd"></path></svg>'},98640:e=>{"use strict";e.exports=l},99710:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjExMHB4IiBoZWlnaHQ9Ijc0cHgiIHZpZXdCb3g9IjAgMCAxMTAgNzQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPGcgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMTk1LjAwMDAwMCwgLTU5Ni4wMDAwMDApIj4NCiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExOTUuMDAwMDAwLCA1OTYuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgPGc+DQogICAgICAgICAgICAgICAgICAgIDxyZWN0IGZpbGw9IiMyODI4MjgiIGZpbGwtcnVsZT0ibm9uemVybyIgeD0iOSIgeT0iMjciIHdpZHRoPSI5MiIgaGVpZ2h0PSIyMCI+PC9yZWN0Pg0KICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGZpbGw9IiM2QTZBNkEiIGN4PSIxOSIgY3k9IjM3IiByPSI1Ij48L2NpcmNsZT4NCiAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBmaWxsPSIjNkE2QTZBIiBjeD0iMzMiIGN5PSIzNyIgcj0iNSI+PC9jaXJjbGU+DQogICAgICAgICAgICAgICAgICAgIDxjaXJjbGUgZmlsbD0iIzZBNkE2QSIgY3g9IjQ3IiBjeT0iMzciIHI9IjUiPjwvY2lyY2xlPg0KICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGZpbGw9IiM2QTZBNkEiIGN4PSI5MSIgY3k9IjM3IiByPSI1Ij48L2NpcmNsZT4NCiAgICAgICAgICAgICAgICAgICAgPHJlY3QgZmlsbD0iIzM2MzYzNiIgeD0iODIiIHk9IjMyIiB3aWR0aD0iMSIgaGVpZ2h0PSIxMCI+PC9yZWN0Pg0KICAgICAgICAgICAgICAgICAgICA8Y2lyY2xlIGZpbGw9IiM2QTZBNkEiIGN4PSI3NSIgY3k9IjM3IiByPSI1Ij48L2NpcmNsZT4NCiAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBmaWxsPSIjNkE2QTZBIiBjeD0iNjEiIGN5PSIzNyIgcj0iNSI+PC9jaXJjbGU+DQogICAgICAgICAgICAgICAgPC9nPg0KICAgICAgICAgICAgPC9nPg0KICAgICAgICA8L2c+DQogICAgPC9nPg0KPC9zdmc+"}},t={};function c(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var p={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(p),c.d(p,{NewFeatureMode:()=>Vi,PageMode:()=>Fi,__set_webpack_public_path__:()=>Ei,default:()=>Ui});var e,t,i,s,n,a,r,o=c(67386),l=c(79244),h=c(62686),d=c(4108),u=c(79298);!function(e){e.Rotate="ROTATE",e.Path="PATH",e.Route="ROUTE"}(e||(e={})),function(e){e.SLOW="slow",e.DEFAULT="default",e.FAST="fast"}(t||(t={})),function(e){e.Point="POINT",e.MapCenter="MAPCENTER"}(i||(i={})),function(e){e.CW="CW",e.CCW="CCW"}(s||(s={})),function(e){e.Smoothed="CURVED",e.RealPath="LINE"}(n||(n={})),function(e){e.Forward="FORWARD",e.Backward="BACKWARD"}(a||(a={})),function(e){e.Horizontal="HORIZONTAL",e.Vertical="VERTICAL",e.Palette="PALETTE"}(r||(r={}));var g=c(14321);const m={selectMap:"Select a map widget with 3D data",oneOnOneMapTips:"One map widget can only be selected for one fly controller widget",controllerStyle:"Controller style",bar:"Bar",palette:"Palette",selectStyle:"Choose fly modes",flyStyleRotate:"Rotate fly",flyStylePath:"Fly along path",flyStyleRecord:"Plan routes",styleLabelRotate:"Rotate direction",styleLabelPath:"Path style",CW:"Clockwise",CCW:"Counterclockwise",rotateMode:"Rotate mode",aroundAPoint:"Fly around a point",aroundMapCenter:"Fly around map center",pathTypeSmoothedCurve:"Smoothed path",pathTypeRealPath:"Real path",newRoute:"New route",editRoute:"Configure route",plannedRoute:"Route",pointStyle:"Point",pathStyle:"Path",newFeature:"New element",addPoint:"Draw a point",addPath:"Draw a path",triggerDrawPoint:"Draw a point",triggerDrawPath:"Draw a path",previewRoute:"Preview route",previewRouteBadge:"Preview route (with new changes)",editElement:"Edit element",previewElement:"Preview element",stopPreview:"Stop preview",closePopup:"Close without saving",saveTo:"Save to",save:"Save",startDelay:"The pause time before this element starts flying (Second)",advancedSettings:"Advanced settings",duration:"Fly time of this element (Second)",rotationAngle:"Rotation angle (Degree)",endDelay:"The pause time after this element finishes flying (Second)",chooseMapTip:"Please select a map with 3D data.",rotateSpeed:"Rotate speed",pathSpeed:"Fly speed"};var v=c(26900),f=c.n(v),y=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const w=e=>{const t=window.SVG,{className:i}=e,s=y(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:f()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var C=c(39815),I=c.n(C),M=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const S=e=>{const t=window.SVG,{className:i}=e,s=M(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:I()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var P=c(24362),b=c.n(P),R=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const x=e=>{const t=window.SVG,{className:i}=e,s=R(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:b()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var j=c(94064),A=c.n(j),L=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const T=e=>{const t=window.SVG,{className:i}=e,s=L(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:A()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var D=c(30655),G=c.n(D),N=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const F=e=>{const t=window.SVG,{className:i}=e,s=N(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:G()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))},{useEffect:V}=l.React,k=t=>{const i=(0,l.useIntl)(),{styleConfig:s,idx:n,flyModesUICollapseMap:a}=t,r=s.isInUse,h=s.name,d=a.getIn([String(n)]);V(()=>{let e=!0;e=!r,t.handleToggleFlyModesUICollapse(n,e)},[r]);const c=(t=>{switch(t){case e.Rotate:return(0,o.jsx)(w,{size:"m"});case e.Path:return(0,o.jsx)(S,{size:"m"});case e.Route:return(0,o.jsx)(x,{size:"m"})}})(h),p=(t=>{switch(t){case e.Rotate:return i.formatMessage({id:"flyStyleRotate",defaultMessage:m.flyStyleRotate});case e.Path:return i.formatMessage({id:"flyStylePath",defaultMessage:m.flyStylePath});case e.Route:return i.formatMessage({id:"flyStyleRecord",defaultMessage:m.flyStyleRecord})}})(h),v=d?(0,o.jsx)(F,{size:"s"}):(0,o.jsx)(T,{size:"s"}),f=d?i.formatMessage({id:"expand",defaultMessage:g.defaultMessages.expand}):i.formatMessage({id:"collapse",defaultMessage:g.defaultMessages.collapse});return(0,o.jsxs)(u.SettingRow,{className:"d-flex align-items-center justify-content-between",children:[(0,o.jsx)("div",{className:"d-flex align-items-center",style:{cursor:"pointer"},children:(0,o.jsxs)(g.Label,{style:{cursor:"pointer"},children:[(0,o.jsx)(g.Checkbox,{checked:r,onClick:e=>{((e,i)=>{e.stopPropagation(),t.handleFlyModesChange(!r,i)})(e,n)}}),(0,o.jsx)("div",{className:"m-2",children:c}),p]})}),(0,o.jsx)(g.Button,{icon:!0,disabled:!r,style:{backgroundColor:"transparent",border:"none"},title:f,"aria-label":p+". "+f,"aria-expanded":!d,onClick:e=>{((e,i,s)=>{s.stopPropagation(),t.handleToggleFlyModesUICollapse(i,!e)})(d,n,e)},children:v})]})},O=l.React.memo(e=>{const t=g.hooks.useTranslate(m,g.defaultMessages),s=l.React.useMemo(()=>({pauseTimeDefault:2,pauseTimeMax:30,pauseTimeMin:0}),[]),n=e.styleConfig.targetMode===i.MapCenter,a=e.styleConfig.rotationPauseTime,r=t("rotateMode"),h=t("aroundAPoint"),d=t("aroundMapCenter");return(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"fly-style-label",children:r})}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:!n,id:"aroundAPoint",style:{cursor:"pointer"},onChange:t=>{e.onEnableAroundMapCenter(i.Point,e.idx)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"aroundAPoint",className:"ml-1 text-break",children:h})]}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:n,id:"aroundMapCenter",style:{cursor:"pointer"},onChange:t=>{e.onEnableAroundMapCenter(i.MapCenter,e.idx)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"aroundMapCenter",className:"ml-1 text-break",children:d})]}),n&&(0,o.jsx)(l.React.Fragment,{children:(0,o.jsxs)(u.SettingRow,{className:"d-none justify-content-between mt-2",children:[(0,o.jsx)(g.Label,{className:"ml-1 text-break",children:"pause time"}),(0,o.jsx)(g.NumericInput,{className:"ml-2 numeric-input",size:"sm",value:a,defaultValue:s.pauseTimeDefault,min:s.pauseTimeMin,max:s.pauseTimeMax,step:.1,precision:1,onChange:t=>{e.onPauseTimeChange(t,e.idx)},required:!0})]})})]})}),U=l.React.memo(e=>{const t=l.hooks.useTranslation(m,g.defaultMessages),i=t("bar"),s=t("palette"),n=e.widgetId+"-ui-mode-description",a=e.widgetId+"-ui-mode-0",h=e.widgetId+"-ui-mode-1";return(0,o.jsx)(l.React.Fragment,{children:(0,o.jsx)(u.SettingSection,{title:t("controllerStyle"),children:(0,o.jsx)(u.SettingRow,{children:(0,o.jsxs)("div",{className:"ui-mode-card-chooser w-100","aria-label":t("controllerStyle"),role:"radiogroup",children:[(0,o.jsxs)(g.Label,{className:"d-flex flex-column ui-mode-card-wrapper",children:[(0,o.jsx)(g.Button,{icon:!0,className:(0,l.classNames)("ui-mode-card",{active:e.layout===r.Horizontal}),disableHoverEffect:!0,disableRipple:!0,onClick:()=>{e.onChange(r.Horizontal)},title:i,role:"radio","aria-checked":e.layout===r.Horizontal,"aria-label":i,"aria-labelledby":a,"aria-describedby":n,children:(0,o.jsx)(g.Icon,{width:92,height:56,icon:c(99710),autoFlip:!0})}),(0,o.jsx)("div",{id:a,className:"mx-1 text-break ui-mode-label",children:i})]}),(0,o.jsx)("div",{className:"ui-mode-card-separator"}),(0,o.jsxs)(g.Label,{className:"d-flex flex-column ui-mode-card-wrapper ml-3",children:[(0,o.jsx)(g.Button,{icon:!0,className:(0,l.classNames)("ui-mode-card",{active:e.layout===r.Palette}),disableHoverEffect:!0,disableRipple:!0,onClick:()=>{e.onChange(r.Palette)},title:s,role:"radio","aria-checked":e.layout===r.Palette,"aria-label":s,"aria-labelledby":h,"aria-describedby":n,children:(0,o.jsx)(g.Icon,{width:92,height:56,icon:c(43439),autoFlip:!0})}),(0,o.jsx)("div",{id:h,className:"mx-1 text-break ui-mode-label",children:s})]})]})})})})});var E=c(98640);class _ extends l.React.PureComponent{constructor(e){super(e),this.mapRoutesToListItems=()=>{const e=[];for(let t=0,i=this.props.placeholderNums;t<i;t++)e.push({itemKey:t.toString(),itemStateCommands:[{iconProps:()=>({icon:null,size:12,style:{opacity:0}})}]});return e},this.getStyle=()=>l.css`
    /* disable hover for skeleton-list */
    .skeleton-list .jimu-tree-main .jimu-tree-item .jimu-tree-item__body:hover {
      background-color: var(--sys-color-surface-paper);
    } `,this.state={listItems:[]}}componentDidMount(){this.setState({listItems:this.mapRoutesToListItems()})}render(){return(0,o.jsx)("div",{css:this.getStyle(),className:"d-flex",children:(0,o.jsx)(E.List,{className:"skeleton-list w-100",itemsJson:this.state.listItems,dndEnabled:!1,overrideItemBlockInfo:()=>({name:E.TreeItemActionType.RenderOverrideItem,children:[{name:E.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:E.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:E.TreeItemActionType.RenderOverrideItemBody,children:[{name:E.TreeItemActionType.RenderOverrideItemDragHandle},{name:E.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:E.TreeItemActionType.RenderOverrideItemTitle},{name:E.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})})})}}var B=c(11417);const H="Draw a point",z="Draw a path",W="Select a feature",J="Clear drawing or selection";var Z,K=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class q{constructor(){this.symbolJsonUtils=null,this.getDefaultPointSymbol=e=>this.symbolJsonUtils.fromJSON({type:"PointSymbol3D",symbolLayers:[{type:"Icon",material:{color:e},size:12,outline:{color:[255,255,255],size:.75}}],verticalOffset:{screenLength:5,minWorldLength:5,maxWorldLength:10},callout:{type:"line",color:[255,255,255],size:2,border:{color:[50,50,50]}}}),this.getDefaultLineSymbol=e=>this.symbolJsonUtils.fromJSON({type:"LineSymbol3D",symbolLayers:[{type:"Line",material:{color:e,transparency:50},join:"round",cap:"round",size:2.25}]})}setup(){return K(this,void 0,void 0,function*(){return yield(0,h.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]).then(e=>{[this.symbolJsonUtils]=e}),this})}}!function(e){e[e.Default=0]="Default",e[e.Custom=1]="Custom"}(Z||(Z={}));class Y{constructor(e){this.update(e)}update(e){const{graphics:t,isPicked:i}=e;return this.setGraphics(t),this.isPicked=i,this.symbolType=Z.Default,this}setGraphics(e){this.graphics=e}getGraphics(){return this.graphics}getMainGraphic(){return this.graphics?this.graphics[0]:null}getConfig(){var e;const t={graphics:null,isPicked:this.isPicked,symbolType:Z.Default};return t.graphics=null===(e=this.graphics)||void 0===e?void 0:e.map(e=>{const t=e.clone();if(t.symbol=null,t.toJSON)return t.toJSON()}),t}}r.Horizontal,r.Palette;const $={MIN:0,MAX:1,MULTIPLIER:8,DECIMAL:3,DEFAULT_SPEED:50},Q={MIN:0,MAX:800,STEP:10},X={MIN:0,MAX:90,STEP:1},ee={MIN:0},te={ANGLE:0,ELEV:1,TIME:1};function ie(e,t,i){const s=Me(t)?t:1,n=[];return B.toRenderCoordinates(i,e,0,null,n,0,s),n}function se(e,t,i){const s=Me(t)?t:1,n=[];return B.fromRenderCoordinates(i,e,0,n,0,null,s),n}function ne(e){return e*Math.PI/180}function ae(e){return 180*e/Math.PI}function re(e,t){const i=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2],a=i*i+s*s+n*n;return Math.sqrt(a)}function oe(e){return e<0?-1:e>0?1:0}function le(e,t,i){const s=[];return s[0]=(t[0]-e[0])*i+e[0],s[1]=(t[1]-e[1])*i+e[1],s[2]=(t[2]-e[2])*i+e[2],s}function he(e,t,i,s,n){var a,r;const o=e.prePos,l=null!==(a=e.basePos)&&void 0!==a?a:null,h=null!==(r=e.nextPos)&&void 0!==r?r:null;if(null===l||null===h)return 0;const d=i.create();t.subtract(d,l,o);const c=i.create();t.subtract(c,h,l);const p=i.create();s.renderCoordsHelper.worldUpAtPosition(l,p);return ae(n.angle(d,c,p))}function de(e,t){return ce(t.groundView.elevationSampler.queryElevation(e),t)}function ce(e,t){var i,s,n;const a=null!==(n=null===(s=null===(i=t.groundView)||void 0===i?void 0:i.elevationSampler)||void 0===s?void 0:s.noDataValue)&&void 0!==n?n:34028234663852886e21;if(null==e?void 0:e.hasZ){if("point"===e.type){e.z===a&&(e.z=0)}if("polyline"===e.type){const t=e.paths[0];t[0][2]===a&&t.forEach(e=>{e[2]=0})}}return e}function pe(e){return me((null==e?void 0:e.toFixed)?parseFloat(e.toFixed(te.ANGLE)):NaN)}function ue(e){return me((null==e?void 0:e.toFixed)?parseFloat(e.toFixed(te.ELEV)):NaN)}function ge(e){return me((null==e?void 0:e.toFixed)?parseFloat(e.toFixed(te.TIME)):NaN)}function me(e){return null===e||isNaN(e)?0:e}function ve(e,t){const i=null==e?void 0:e.find(e=>e.idx===t.routeUuid);return i}function fe(e,t){var i;const s=ve(e,t);return null===(i=null==s?void 0:s.records)||void 0===i?void 0:i.find(e=>e.idx===t.recordUuid)}function ye(e,t,i){const s=ve(e,t);return null==s?void 0:s.records[i]}function we(e,t){const i=t+" ";let s=0;return e.forEach(e=>{let t;const n=e.displayName.split(i);Me(n)&&2===n.length&&""===n[0]&&(t=n[1],/^\d+$/.test(t)&&(t=parseInt(t),s=Math.max(t,s)))}),`${i}${s+1}`}function Ce(e){return"fly__"+e}function Ie(e){return(null==e?void 0:e.startsWith("fly__"))?e.replace("fly__",""):e}function Me(e){return null!=e}var Se=c(23662),Pe=c.n(Se),be=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const Re=e=>{const t=window.SVG,{className:i}=e,s=be(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:Pe()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var xe,je=c(12046),Ae=c.n(je),Le=c(9044),Te=c.n(Le),De=c(73529),Ge=c.n(De),Ne=c(26490),Fe=c.n(Ne);class Ve extends l.React.PureComponent{constructor(e){super(e),this.handleEdit=e=>{this.props.onRouteEdit({routeUuid:e})},this.handleAddRoute=()=>{const e=this.props.intl.formatMessage({id:"plannedRoute",defaultMessage:m.plannedRoute}),t=we(this.props.routeConfig.routes,e),i={idx:(0,l.uuidv1)(),isInUse:!0,type:null,records:[],displayName:t};this.props.onRouteAdd(i,this.props.flyModeIdx)},this.handleRouteDelete=e=>{this.props.onRouteDelete({routeUuid:e})},this.handleToggleVisibility=(e,t)=>{this.props.onRouteToggleVisibilityChange({routeUuid:e},t)},this.getStyle=e=>l.css`
      .records-list {
        border: 1px solid #888;
        width: 100%;
        display: flex;
        justify-content: space-between;
        margin-bottom: ${l.polished.rem(4)};
        .record-name-input {
          padding: 3px 0;
          width: 110px;
        }
      }
      .records-list:hover {
        cursor: pointer;
        background: ${e.sys.color.secondary.main};
        border-left: 2px solid ${e.sys.color.primary.main};
      }
      `,this.mapRoutesToListItems=e=>{const t=this.props.intl.formatMessage({id:"editRoute",defaultMessage:m.editRoute}),i=this.props.intl.formatMessage({id:"delete",defaultMessage:l.defaultMessages.delete}),s=this.props.intl.formatMessage({id:"clickToHide",defaultMessage:g.defaultMessages.clickToHide}),n=this.props.intl.formatMessage({id:"clickToShow",defaultMessage:g.defaultMessages.clickToShow}),a=null==e?void 0:e.map(e=>{var a;const r=e.isInUse;return{itemKey:e.idx,itemStateTitle:null!==(a=e.displayName)&&void 0!==a?a:"",itemStateCommands:[{label:t,iconProps:()=>({icon:Ae()}),action:e=>{this.handleEdit(e.data.itemJsons[0].itemKey)}},{label:i,iconProps:()=>({icon:Te()}),action:e=>{this.handleRouteDelete(e.data.itemJsons[0].itemKey)}},{label:s,collapsed:!r,iconProps:()=>({icon:Ge()}),action:e=>{this.handleToggleVisibility(e.data.itemJsons[0].itemKey,!1)}},{label:n,collapsed:r,iconProps:()=>({icon:Fe()}),action:e=>{this.handleToggleVisibility(e.data.itemJsons[0].itemKey,!0)}}]}});return a},this.state={listItems:null}}componentDidMount(){var e;this.setState({listItems:this.mapRoutesToListItems(null===(e=this.props.routeConfig)||void 0===e?void 0:e.routes)})}componentDidUpdate(e,t){var i;l.lodash.isDeepEqual(this.props.routeConfig,e.routeConfig)||this.setState({listItems:this.mapRoutesToListItems(null===(i=this.props.routeConfig)||void 0===i?void 0:i.routes)})}render(){const{useMapWidgetIds:e,jimuMapView:t,theme:i,routeConfig:s}=this.props,{listItems:n}=this.state,a=this.props.intl.formatMessage({id:"newRoute",defaultMessage:m.newRoute}),r=Me(null==e?void 0:e.length)&&(null==e?void 0:e.length)>0,h=Me(t)&&Me(s)&&Me(n);return(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsx)(u.SettingRow,{children:(0,o.jsxs)(g.Button,{className:"w-100 d-flex align-items-center justify-content-center",title:a,"aria-label":a,disabled:!h,onClick:this.handleAddRoute,children:[(0,o.jsx)(Re,{size:"s"}),a]})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsxs)("div",{className:"w-100",css:this.getStyle(i),children:[r&&!h&&(0,o.jsx)(_,{placeholderNums:3,theme:this.props.theme}),r&&h&&(0,o.jsx)(E.List,{className:"w-100",itemsJson:n,dndEnabled:!0,onUpdateItem:(e,t)=>{if(e.updateType===E.TreeItemActionType.HandleDidDrop){const[,t]=e.itemJsons;this.props.onRoutesOrderUpdate([...t])}},overrideItemBlockInfo:()=>({name:E.TreeItemActionType.RenderOverrideItem,children:[{name:E.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:E.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:E.TreeItemActionType.RenderOverrideItemBody,children:[{name:E.TreeItemActionType.RenderOverrideItemDragHandle},{name:E.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:E.TreeItemActionType.RenderOverrideItemTitle},{name:E.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})})]})})]})}}class ke{constructor(e){this.GraphicsLayer=null,this.Point=null,this.clearAll=()=>{Me(this.auxGraphicsLayer)&&this.auxGraphicsLayer.removeAll(),Me(this.auxMovingObjLayer)&&this.auxMovingObjLayer.removeAll()},this.deposeMoving=()=>{this.auxMovingObjLayer.removeAll()},this.drawPoint=(e,t)=>{const i=Me(t)?t:"darkgreen",s=new this.Graphic({geometry:e,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:i},outline:{color:"limegreen"}}]}});return this.auxMovingObjLayer.add(s),s},this.drawPointGL=(e,t)=>{const i=se(e,1,this.sceneView),s=new this.Point({x:i[0],y:i[1],z:i[2],spatialReference:this.sceneView.spatialReference});s.z<100&&(s.z=100);const n=Me(t)?t:"darkgreen",a=new this.Graphic({geometry:s,symbol:{type:"point-3d",symbolLayers:[{type:"icon",size:12,resource:{primitive:"circle"},material:{color:n},outline:{color:"limegreen"}}]}});return this.auxMovingObjLayer.add(a),a},this.drawLine=(e,t)=>{const i=Me(t)?t:"lightblue",s=new this.Graphic({geometry:{type:"polyline",paths:e,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:i},size:3}]}});return this.auxGraphicsLayer.add(s),s},this.drawLineXY=(e,t)=>{const i=[];for(let t=0,s=e.length;t<s;t++){const s=e[t],n=s[0],a=s[1],r=s[2];0===r?i.push([n,a]):i.push([n,a,r])}const s=Me(t)?t:"lightblue",n=new this.Graphic({geometry:{type:"polyline",paths:i,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:s},size:3}]}});return this.auxGraphicsLayer.add(n),n},this.drawLineGL=(e,t,i)=>{const s=Me(i)?i:"lightblue",n=[];for(let i=0,s=e.length;i<s;i++){const s=se(e[i],1,t);n.push(s)}const a=new this.Graphic({geometry:{type:"polyline",paths:n,spatialReference:this.sceneView.spatialReference},symbol:{type:"line-3d",symbolLayers:[{type:"line",material:{color:s},size:3}]}});return this.auxGraphicsLayer.add(a),a},(0,h.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer","esri/geometry/Point","esri/Graphic","esri/views/3d/support/projectionUtils","esri/geometry/support/webMercatorUtils"]).then(e=>{[this.GraphicsLayer,this.Point,this.Graphic,this.projectionUtils,this.webMercatorUtils]=e,this.auxGraphicsLayer=new this.GraphicsLayer({listMode:"hide"}),this.sceneView.map.add(this.auxGraphicsLayer),this.auxMovingObjLayer=new this.GraphicsLayer({listMode:"hide"}),this.sceneView.map.add(this.auxMovingObjLayer)}),this.sceneView=e.sceneView}}!function(e){e[e.NONE=0]="NONE",e[e.In=1]="In",e[e.Out=2]="Out",e[e.InOut=3]="InOut",e[e.Linear=4]="Linear"}(xe||(xe={}));const Oe=(e,t,i,s)=>i*e/s+t,Ue=(e,t,i,s)=>i*(e/=s)*e+t,Ee=(e,t,i,s)=>(e/=s/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t;var _e=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class Be{constructor(){this.easing=(e,t)=>{switch(this.state.mode){case xe.In:return this.easingIn(e,t);case xe.InOut:return this.easingInOut(e,t);case xe.Linear:return this.linear(e,t);case xe.NONE:return this.uniformSpeed(e,t)}},this.uniformSpeed=(e,t)=>{this.updateCurrentDuration(e*t);const i=this.getMovementByFrame(e)*t;return this.state.progress=0,{interp:0,step:i,progress:this.state.progress}},this.linear=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=Oe(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.progress=s/this.state.interp.value.end):this.state.progress=1,{interp:s,step:n,progress:this.state.progress}},this.easingIn=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=Ue(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.interp.cache.lastStep=n):n=this.state.interp.cache.lastStep*t,this.state.progress=-1,{interp:s,step:n,progress:this.state.progress}},this.easingInOut=(e,t)=>{const i=this.updateCurrentDuration(e*t);let s=0,n=0;return i<this.state.interp.time.duration?(s=Ee(i,this.state.interp.value.start,this.state.interp.value.end,this.state.interp.time.duration),n=s-this.state.interp.cache.lastVal,this.state.interp.cache.lastVal=s,this.state.progress=s/this.state.interp.value.end):this.state.progress=1,{interp:s,step:n,progress:this.state.progress}},this.getMovementByFrame=e=>this.getSpeed()/(1e3/e)}setup(){return _e(this,void 0,void 0,function*(){return yield(0,h.loadArcGISJSAPIModules)(["esri/core/scheduling"]).then(e=>{[this.scheduling]=e}),this.state={speed:$.DEFAULT_SPEED,mode:xe.NONE,progress:0,amount:-1,interp:{time:{begin:0,currentDuration:0,duration:1e4},value:{start:0,end:0},cache:{lastVal:0,lastStep:0}}},this.animateHandler=null,this})}getState(){return this.state}setState(e){this.state=e}init(e,t,i,s){this.state.mode=e,this.state.interp.value.start=t,this.state.interp.value.end=i,this.state.interp.time.duration=s}reset(){this.state.interp.time.begin=0,this.state.interp.time.currentDuration=0,this.state.progress=0}computeDuration(){return this.state.amount/this.state.speed*1e3}getDuration(){return this.state.interp.time.duration}setAmount(e){return this.state.amount=e,this}getAmount(){return this.state.amount}getProgress(){return this.state.progress}progressForward(){return this.state.progress+=1e-4,this.state.progress}progressBackward(){return this.state.progress-1e-4}updateCurrentDuration(e){return this.state.interp.time.currentDuration=this.state.interp.time.currentDuration+e,isNaN(this.state.interp.time.currentDuration)&&(this.state.interp.time.currentDuration=0),this.state.interp.time.currentDuration}getSpeed(){return this.state.speed}setSpeed(e){this.state.speed=e}update(e){null===this.animateHandler&&(this.animateHandler=this.scheduling.addFrameTask({update:t=>{e(t)}}))}stop(){null!==this.animateHandler&&(this.animateHandler.pause(),this.animateHandler.remove(),this.animateHandler=null)}insertAnExtraFrame(e){var t;null===(t=this.scheduling)||void 0===t||t.schedule(t=>{e(t)})}}class He{constructor(){this.abort(),this.update()}destructor(){this.signalHandler&&(this.signalHandler.abort(),this.signalHandler=null)}update(){return this.signalHandler=null,this.signalHandler=new AbortController,this.signalHandler.signal}abort(){var e;(null===(e=this.signalHandler)||void 0===e?void 0:e.signal)&&this.signalHandler.abort()}}class ze{constructor(){this.DEFAULT_SPEED=($.MIN+$.MAX)/2,this.state=ze._getDefualtLiveviewSetting()}static _getDefualtLiveviewSetting(){return{speedFactor:.5,fixHeading:NaN,fixTilt:NaN,fixAltitude:0,initCamOffset:{height:60,distance:90}}}getState(){return this.state}setState(e){this.state=e}getCamOffsetHeight(){return this.state.initCamOffset.height}getCamOffsetDistance(){return this.state.initCamOffset.distance}setSpeedFactor(e){let t;t=void 0===e?this.DEFAULT_SPEED:e,this.state.speedFactor=parseFloat(t)}getSpeedFactor(){return void 0===this.state.speedFactor?.5:this.state.speedFactor}getMappingSpeedFactor(){if(void 0===this.state.speedFactor)return this.DEFAULT_SPEED;return function(e,t){const i=$.MIN,s=$.MAX,n=$.MULTIPLIER;let a;const r=(s-i)/2;return e<r?a=1/((r-e)/r*n):(a=(e-r)/(s-r)*n,0===a&&(a=1)),parseFloat(a.toFixed(Me(t)?t:$.DECIMAL))}(this.state.speedFactor)}setHeadingFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixHeading=t}getHeadingFactor(){return Me(this.state.fixHeading)?this.state.fixHeading:0}setTiltFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixTilt=t}getTiltFactor(e){return e||Me(this.state.fixTilt)?this.state.fixTilt:0}setAltitudeFactor(e){let t=0;void 0!==e&&(t=e),this.state.fixAltitude=t}getAltitudeFactor(e){return e||Me(this.state.fixAltitude)?this.state.fixAltitude:0}}var We,Je,Ze=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};!function(e){e.Rotate="ROTATE",e.Smoothed="CURVED",e.RealPath="LINE",e.AroundMapCenter="AROUND_MAP_CENTER"}(We||(We={})),function(e){e[e.INITED=-1]="INITED",e[e.PREPARING=0]="PREPARING",e[e.PREPARED=1]="PREPARED",e[e.RUNNING=2]="RUNNING",e[e.STOPPED=3]="STOPPED"}(Je||(Je={}));class Ke{constructor(){this.Camera=null,this._resume=e=>Ze(this,void 0,void 0,function*(){yield this.preparing();return!!(yield e)&&(yield this.prepared(),this._doFly(),!0)}),this.rotateBySceneMode=(e,t,i,s)=>{const n=this.vec3d.fromValues(e[0],e[1],e[2]),a=this.vec3d.create();Me(s)&&(this.vec3.negate(a,s),this.vec3.add(n,n,a));const r=this.mat4d.create();return this.mat4.rotate(r,r,ne(i),t),this.vec3.transformMat4(n,n,r),Me(s)&&this.vec3.subtract(n,n,a),n},this.queryGeometryElevInfo=e=>{var t;return Me(null===(t=this.sceneView.groundView)||void 0===t?void 0:t.elevationSampler)?ce(this.sceneView.groundView.elevationSampler.queryElevation(e),this.sceneView):e.hasZ?e:void 0},this._coordsToGeoArray=e=>{const t=[];let i;for(let s=0,n=e.length;s<n;s++)i=this.vec3d.fromValues(e[s].x,e[s].y,e[s].z),t.push(i);return t},this.getPrepareGoToOptionsBeforeTerrainLoaded=e=>{const t={animate:!0,maxDuration:4e3,easing:"out-expo",signal:this.abortSignalHandler.update()};return e&&!e.animate&&(t.animate=!1,delete t.maxDuration,delete t.easing),t},this.getPrepareGoToOptionsAfterTerrainLoaded=e=>{const t={animate:!0,maxDuration:1e3,easing:"out-expo",signal:this.abortSignalHandler.update()};return e&&!e.animate&&(t.animate=!1,delete t.maxDuration,delete t.easing),t}}setup(e){return Ze(this,void 0,void 0,function*(){return yield(0,h.loadArcGISJSAPIModules)(["esri/core/libs/gl-matrix-2/vec3f64","esri/core/libs/gl-matrix-2/mat4f64","esri/core/libs/gl-matrix-2/vec3","esri/core/libs/gl-matrix-2/mat4","esri/core/libs/gl-matrix-2/quatf64","esri/core/libs/gl-matrix-2/quat","esri/views/3d/webgl","esri/geometry/Point","esri/views/3d/support/mathUtils","esri/core/reactiveUtils","esri/Camera"]).then(t=>Ze(this,void 0,void 0,function*(){[this.libVec3f64,this.libMat4f64,this.libVec3,this.libMat4,this.libQuatf64,this.libQuat,this.apiWebGLUtils,this.Point,this.esriMathUtils,this.reactiveUtils,this.Camera]=t,this.vec3=this.libVec3.vec3,this.vec3d=this.libVec3f64.vec3f64,this.mat4=this.libMat4.mat4,this.mat4d=this.libMat4f64.mat4f64,this.quat=this.libQuat.quat,this.quatd=this.libQuatf64.quatf64,yield this.clear();const{id:i,type:s,geometry:n,direction:a,config:r,sceneView:o,flyCallbacks:l}=e;this.id=i,this.type=s,this.geometry=n,this.direction=a,this.cameraInfo=r.cameraInfo,Me(r.liveviewSettingState)&&this.liveviewSetting.setState(r.liveviewSettingState),this.sceneView=o,this.flyCallbacks=l,this._isDebug=!1,this._isDebug&&(this.auxHelper=new ke({sceneView:this.sceneView})),this.DEBUG={planTime:0,startTime:0,endTime:0},this.eventHandlers.push(this.sceneView.on("drag",e=>{this.flyState<=Je.RUNNING&&"start"===e.action&&this.handleMapInteractionStart(),"end"===e.action&&this.handleMapInteractionEnd()})),this.eventHandlers.push(this.sceneView.on("mouse-wheel",e=>{this.flyState<=Je.RUNNING&&this.handleMapInteractionStart(e)}))})),this})}destructor(){this.onStop(),this.clear()}isInited(){return this.flyState>=Je.INITED}isEnableToFly(){const e=this.flyState;return e===Je.PREPARED||e===Je.STOPPED||e===Je.PREPARING}isEnableToPause(){return this.flyState>=Je.PREPARING}init(){this.flyState=Je.INITED,this.animate.reset()}preparing(){return Ze(this,void 0,void 0,function*(){var e;return this.flyState=Je.PREPARING,"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onPreparing)&&this.flyCallbacks.onPreparing(),yield new Promise(e=>{e(null)})})}prepared(){return Ze(this,void 0,void 0,function*(){return this.flyState=Je.PREPARED,new Promise(e=>{setTimeout(()=>{e(null)},50)})})}_doFly(){this.isLiveviewMode||this.onStart()}setConfig(e){this.cameraInfo=e.cameraInfo,this.liveviewSetting.setState(e.liveviewSettingState)}getConfig(){return{cameraInfo:this.cameraInfo,liveviewSettingState:this.liveviewSetting.getState()}}pause(){return Ze(this,void 0,void 0,function*(){return!!this.isEnableToPause()&&(this.stopAnimat(),this.onPause(),yield new Promise(e=>{e(!0)}))})}resume(e){return Ze(this,void 0,void 0,function*(){})}stop(e){this.stopAnimat(),this.onStop()}clear(){return Ze(this,void 0,void 0,function*(){var e,t,i,s;Me(this.eventHandlers)&&this.eventHandlers.forEach(e=>{e.remove()}),this.eventHandlers=null,this.eventHandlers=[],this.abortSignalHandler&&this.abortSignalHandler.abort(),this.abortSignalHandler=null,this.abortSignalHandler=new He,this._isDebug&&(null===(e=this.auxHelper)||void 0===e||e.clearAll()),Me(null===(t=this._cache)||void 0===t?void 0:t.paths)&&(null===(i=this._cache)||void 0===i||i.paths.destructor()),this.id=null,this.type=null,this.geometry=null,this.direction=null,this.cameraInfo=null,this.sceneView=null,this.flyCallbacks=null,this.auxHelper=null,null===(s=this.animate)||void 0===s||s.stop(),this.animate=null,this.animate=yield(new Be).setup(),this.liveviewSetting=null,this.liveviewSetting=new ze,this.flyState=null,this.isLiveviewMode=!1,this.shownProgress=0,this._cache={paths:null,cachedGeo:null,cameraGL:{pos:null,upDir:null},lookAtTargetGL:{pos:null,upAxis:null,baseAlt:null}},this.resetCameraWhenFinishedFlag=!1,this._isDebug=!1,this.DEBUG={planTime:null,startTime:null,endTime:null}})}updateAnimat(e){return Ze(this,void 0,void 0,function*(){return yield this.animate.update(t=>{e(t)})})}stopAnimat(){var e;null===(e=this.animate)||void 0===e||e.stop(),this.updateProgressBar()}setIsLiveview(e){return Ze(this,void 0,void 0,function*(){return this.isLiveviewMode=e,e?yield this.fly({animate:!1}):yield this.pause()})}setLiveviewSettingInfo(e,t){return Ze(this,void 0,void 0,function*(){if(!Me(e))return!1;let i=!1;const s=e.altitude;void 0!==s&&(i=!0,this.liveviewSetting.setAltitudeFactor(s));const n=e.tilt;return void 0!==n&&(i=!0,this.liveviewSetting.setTiltFactor(n)),i&&Me(this.animate)&&this.isLiveviewMode&&this.animate.insertAnExtraFrame(e=>Ze(this,void 0,void 0,function*(){yield t(e)})),yield new Promise(e=>{e(!0)})})}getDefaultDuration(){return this.flyState>=Je.PREPARED?this.animate.getDuration():null}onStart(){var e;this.flyState=Je.RUNNING,this._isDebug&&(this.DEBUG.planTime=this.animate.state.interp.time.duration,this.DEBUG.startTime=(new Date).getTime()),"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onFly)&&this.flyCallbacks.onFly()}onPause(){var e;this.abortSignalHandler.abort(),this.flyState=Je.STOPPED,"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onPause)&&this.flyCallbacks.onPause()}onStop(){var e;if(this.abortSignalHandler.abort(),this.flyState=Je.STOPPED,this._isDebug){this.DEBUG.endTime=(new Date).getTime();const e=(this.DEBUG.endTime-this.DEBUG.startTime)/1e3,t=this.DEBUG.planTime/1e3;console.log("DEBUG 1.fly sum time ==> "+e.toFixed(2)+" s"),console.log("DEBUG 2.plan time ==> "+t.toFixed(2)+" s");const i=(e-t)/t*100;console.log("DEBUG 3.mistake ==> "+i.toFixed(5)+" %")}"function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onFinish)&&this.flyCallbacks.onFinish()}updateProgressBar(){var e,t;if("function"==typeof(null===(e=this.flyCallbacks)||void 0===e?void 0:e.onUpdateProgress)){const e=Math.ceil(100*this.getProgress());let i=!1;(e<=1||e>=99||Math.abs(e-this.shownProgress)>=1)&&(i=!0),i&&(this.shownProgress=e),i&&(null===(t=this.flyCallbacks)||void 0===t||t.onUpdateProgress(this.shownProgress))}}concatGeoPaths(e){let t=[];for(let i=0;i<e.paths.length;i++)t=t.concat(e.paths[i]);return t}geoCoordToRenderCoord(e){const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=ie([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t}}var qe=c(20237),Ye=c.n(qe),$e=c(60591),Qe=c.n($e),Xe=c(74919),et=c.n(Xe),tt=c(86058),it=c.n(tt);class st extends l.React.PureComponent{constructor(e){super(e),this.getStyle=()=>l.css`
      .record-list {
        .is-available{
        }
        .not-available{
          background-color: red;
        }
      }
      `,this.handleRecordEdit=e=>{this.props.onRecordEdit({routeUuid:null,recordUuid:e})},this.handleRecordPreview=e=>{this.props.onRecordPreview({routeUuid:null,recordUuid:e})},this.handlePauseRecordPreview=e=>{this.props.onPauseRecordPreview({routeUuid:null,recordUuid:e})},this.handleRecordDelete=e=>{this.props.onRecordDelete({routeUuid:null,recordUuid:e})},this.handleRecordHighlight=e=>{this.props.onRecordHighlight({routeUuid:null,recordUuid:e})},this.mapRoutesToListItems=e=>{const t=this.props.intl.formatMessage({id:"editElement",defaultMessage:m.editElement}),i=this.props.intl.formatMessage({id:"previewElement",defaultMessage:m.previewElement}),s=this.props.intl.formatMessage({id:"stopPreview",defaultMessage:m.stopPreview}),n=this.props.intl.formatMessage({id:"delete",defaultMessage:l.defaultMessages.delete});return null==e?void 0:e.map(e=>{let a;return e.type===We.Rotate?a={icon:et()}:e.type!==We.Smoothed&&e.type!==We.RealPath||(a={icon:it()}),{itemStateChecked:e.idx===this.props.highlightL2RecordId,itemStateIcon:a,itemKey:e.idx,itemStateTitle:e.displayName,itemStateDisabled:!1,itemStateCommands:[{label:t,iconProps:()=>({icon:Ae()}),action:e=>{this.handleRecordEdit(e.data.itemJsons[0].itemKey)}},{label:i,collapsed:!1,iconProps:()=>({icon:Ye()}),action:e=>{this.handleRecordPreview(e.data.itemJsons[0].itemKey)}},{label:s,collapsed:!0,iconProps:()=>({icon:Qe()}),action:e=>{this.handlePauseRecordPreview(e.data.itemJsons[0].itemKey)}},{label:n,iconProps:()=>({icon:Te()}),action:e=>{this.handleRecordDelete(e.data.itemJsons[0].itemKey)}}]}})},this.updateListItemsByPlayingInfo=()=>{var e;const t=null===(e=this.state.listItems)||void 0===e?void 0:e.map(e=>{var t;const{itemKey:i,itemStateCommands:s}=e;return i===(null===(t=this.props.playingInfo)||void 0===t?void 0:t.recordUuid)?(s[1].collapsed=!0,s[2].collapsed=!1):(s[1].collapsed=!1,s[2].collapsed=!0),e.itemStateDisabled=!this.props.isTerrainLoaded,e});this.setState({listItems:t})},this.state={listItems:null}}componentDidMount(){this.setState({listItems:this.mapRoutesToListItems(this.props.records)},()=>{this.updateListItemsByPlayingInfo()})}componentDidUpdate(e,t){l.lodash.isDeepEqual(this.props.records,e.records)||this.setState({listItems:this.mapRoutesToListItems(this.props.records)}),this.props.playingInfo!==e.playingInfo&&this.updateListItemsByPlayingInfo(),this.props.isTerrainLoaded!==e.isTerrainLoaded&&this.updateListItemsByPlayingInfo(),e.highlightL2RecordId!==this.props.highlightL2RecordId&&this.setState({listItems:this.mapRoutesToListItems(this.props.records)},()=>{this.updateListItemsByPlayingInfo()})}render(){return Me(this.state.listItems)&&(0,o.jsx)("div",{css:this.getStyle(),children:Me(this.props.records)&&(0,o.jsx)("div",{className:"record-list d-flex",children:(0,o.jsx)(E.List,{className:"w-100",itemsJson:this.state.listItems,dndEnabled:!0,onUpdateItem:(e,t)=>{if(e.updateType===E.TreeItemActionType.HandleDidDrop){const[,t]=e.itemJsons;this.props.onRecordsOrderUpdate([...t])}},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:E.TreeItemActionType.RenderOverrideItem,children:[{name:E.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:E.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:E.TreeItemActionType.RenderOverrideItemBody,children:[{name:E.TreeItemActionType.RenderOverrideItemDragHandle},{name:E.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:E.TreeItemActionType.RenderOverrideItemTitle},{name:E.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]}),onClickItemBody:(e,t)=>{const{itemJsons:i}=t.props,s=i[0].itemKey;this.handleRecordHighlight(s)}})})})}}var nt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const at=e=>{const t=window.SVG,{className:i}=e,s=nt(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:et()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var rt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const ot=e=>{const t=window.SVG,{className:i}=e,s=rt(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:it()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var lt=c(45508),ht=c.n(lt),dt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const ct=e=>{const t=window.SVG,{className:i}=e,s=dt(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:ht()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var pt=c(96300),ut=c.n(pt),gt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const mt=e=>{const t=window.SVG,{className:i}=e,s=gt(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:ut()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var vt=c(97408),ft=c.n(vt),yt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const wt=e=>{const t=window.SVG,{className:i}=e,s=yt(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:ft()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var Ct=c(40904),It=c.n(Ct),Mt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const St=e=>{const t=window.SVG,{className:i}=e,s=Mt(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:It()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};class Pt extends l.React.PureComponent{constructor(e){super(e),this.backBtnRefFor508=null,this.handleKeydown=(e,t)=>{"Enter"===e.key&&t.current.blur()},this._handleIsDisablePlayBtn=()=>this.props.routeConfig.records.length<=0,this._handleNewRecordNotify=()=>{this.setState({previewNeedToResetFlag:!0})},this.handleRecordEdit=e=>{this.props.onRecordEdit(e),this.setState({previewNeedToResetFlag:!0})},this.handleRecordPreview=e=>{this.props.onRecordPreview(e),this.handleRecordHighlight(null)},this.handleRecordDelete=e=>{this.props.onRecordDelete(e),this.setState({previewNeedToResetFlag:!0})},this.handleRecordsOrderUpdate=e=>{this.props.onRecordsOrderUpdate(e),this.setState({previewNeedToResetFlag:!0})},this.getStyle=()=>l.css`
      .map-2d-warning{
        flex-direction: column;
        margin-top: 128px;
        color: ${this.props.theme.ref.palette.neutral[800]};

        .tip {
          font-size: 14px;
        }
      }

      .description {
        height: ${l.polished.rem(40)};
      }

      .new-feature-dropdown {
        width: 190px;/*calc(100% - ${l.polished.rem(32)});*/
      }

      .del-btn-wrapper {
        position: relative;

        .delete-con {
          & {
            position: absolute;
            bottom: ${l.polished.rem(16)};
            width: 100%;
            height: ${l.polished.rem(32)};
          }
          button {
            width: calc(100% - ${l.polished.rem(32)});
          }
        }
      }
      `,this.handleBackBtnClick=()=>{this.props.onShowMapPopperChange(!1),this.props.onRouteEdit({routeUuid:null}),this.props.onSettingPageModeChange(Fi.Common)},this.handleDeleteClick=()=>{this.props.onRouteDelete({routeUuid:this.props.routeConfig.idx}),this.handleBackBtnClick()},this.handleRouteNameChange=e=>{this.props.onRouteNameChange({routeUuid:this.props.routeConfig.idx},e)},this.handleRecordHighlight=e=>{const t=null===e?null:Object.assign(Object.assign({},e),{routeUuid:this.props.routeConfig.idx});this.props.onRecordHighlight(t)},this.toggleNewFeaturePopup=()=>{this.setState({isNewFeaturePopupOpen:!this.state.isNewFeaturePopupOpen})},this.handleNewFeatureModeClick=e=>{this.props.onNewFeatureModeChange(e)},this.handlePreviewRoute=()=>{if(this.handleRecordHighlight(null),this.props.isPreviewRouteBtnPlaying)this.props.onPauseRoutePreview();else{const e=.5;this.props.onPreviewRoute(e,{routeUuid:this.props.routeConfig.idx},this.state.previewNeedToResetFlag),this.setState({previewNeedToResetFlag:!1})}},this.state={isNewFeaturePopupOpen:!1,previewNeedToResetFlag:!1,is2DJimuMapView:!1}}componentDidMount(){(0,l.focusElementInKeyboardMode)(this.backBtnRefFor508)}componentDidUpdate(e){this.props.newestRecordIdx!==e.newestRecordIdx&&this._handleNewRecordNotify(),this.props.routeConfig!==e.routeConfig&&this._handleIsDisablePlayBtn()&&this.setState({previewNeedToResetFlag:!1}),this.props.mapPopperJimuMapView!==e.mapPopperJimuMapView&&("2d"===this.props.mapPopperJimuMapView.view.type?(this.setState({is2DJimuMapView:!0}),this.setState({previewNeedToResetFlag:!1})):this.setState({is2DJimuMapView:!1}))}render(){var e;const{routeConfig:t}=this.props,i=this.props.intl.formatMessage({id:"back",defaultMessage:g.defaultMessages.back}),s=this.props.intl.formatMessage({id:"delete",defaultMessage:l.defaultMessages.delete}),n=this.props.intl.formatMessage({id:"label",defaultMessage:g.defaultMessages.label}),a=this.props.intl.formatMessage({id:"chooseMapTip",defaultMessage:m.chooseMapTip}),r=l.React.createRef(),h=t.records;return Me(t)&&(0,o.jsxs)("div",{className:"w-100 h-100",css:this.getStyle(),children:[(0,o.jsxs)("div",{className:"w-100 h-100",children:[(0,o.jsxs)(u.SettingSection,{children:[(0,o.jsxs)(g.Button,{className:"page-back-btn p-0 mt-1 mb-2",type:"tertiary",title:i,"aria-label":i,onClick:this.handleBackBtnClick,ref:e=>{this.backBtnRefFor508=e},children:[(0,o.jsx)(mt,{size:16,autoFlip:!0}),(0,o.jsx)(g.Label,{className:"m-0",children:i})]}),(0,o.jsx)(u.SettingRow,{label:n}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.TextInput,{className:"w-100",ref:r,size:"sm",required:!0,title:t.displayName,defaultValue:null!==(e=t.displayName)&&void 0!==e?e:"",onAcceptValue:this.handleRouteNameChange,onKeyDown:e=>{this.handleKeydown(e,r)}})})]}),(0,o.jsxs)(u.SettingSection,{children:[this.state.is2DJimuMapView&&(0,o.jsxs)("div",{className:"d-flex align-items-center justify-content-center map-2d-warning",children:[(0,o.jsx)(ct,{size:42}),(0,o.jsx)("div",{className:"tip text-center mt-4",children:a})]}),!this.state.is2DJimuMapView&&(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsxs)("div",{className:"d-flex justify-content-between mb-5",children:[this.renderNewFeatureContent(),this.renderPreviewContent()]}),Me(h)&&(0,o.jsx)(st,{records:h,mapPopperJimuMapView:this.props.mapPopperJimuMapView,isTerrainLoaded:this.props.isTerrainLoaded,theme:this.props.theme,intl:this.props.intl,playingInfo:this.props.playingInfo,onRecordEdit:this.handleRecordEdit,onRecordPreview:this.handleRecordPreview,onPauseRecordPreview:this.props.onPauseRecordPreview,onRecordDelete:this.handleRecordDelete,onRecordsOrderUpdate:this.handleRecordsOrderUpdate,onRecordHighlight:this.handleRecordHighlight,isRecordCanPlay:this.props.isRecordCanPlay,highlightL2RecordId:this.props.highlightL2RecordId})]})]})]}),(0,o.jsx)(u.SettingRow,{className:"del-btn-wrapper",children:(0,o.jsx)("div",{className:"d-flex w-100 justify-content-center delete-con",children:(0,o.jsx)(g.Button,{type:"secondary",title:s,"aria-label":s,onClick:this.handleDeleteClick,children:s})})})]})}renderNewFeatureContent(){const e=this.props.intl.formatMessage({id:"newFeature",defaultMessage:m.newFeature}),t=this.props.intl.formatMessage({id:"addPoint",defaultMessage:m.addPoint}),i=this.props.intl.formatMessage({id:"addPath",defaultMessage:m.addPath}),s=!this.props.isDrawHelperLoaded||this.state.is2DJimuMapView||!this.props.isTerrainLoaded;return(0,o.jsxs)(g.Dropdown,{isOpen:this.state.isNewFeaturePopupOpen,toggle:this.toggleNewFeaturePopup,className:"dropdowns",activeIcon:!0,disabled:s,menuRole:"listbox",children:[(0,o.jsx)(g.DropdownButton,{icon:!0,className:"new-feature-dropdown operation-btns",arrow:!1,role:"combobox",children:e}),(0,o.jsxs)(g.DropdownMenu,{showArrow:!1,children:[(0,o.jsxs)(g.DropdownItem,{onClick:()=>{this.handleNewFeatureModeClick(Vi.Point)},className:"dropdown-items",children:[(0,o.jsx)(at,{}),(0,o.jsx)("span",{className:"mx-2",children:t})]}),(0,o.jsxs)(g.DropdownItem,{onClick:()=>{this.handleNewFeatureModeClick(Vi.Path)},className:"dropdown-items",children:[(0,o.jsx)(ot,{}),(0,o.jsx)("span",{className:"mx-2",children:i})]})]})]})}renderPreviewContent(){let e;const t=this.props.intl.formatMessage({id:"previewRoute",defaultMessage:m.previewRoute}),i=this.props.intl.formatMessage({id:"previewRouteBadge",defaultMessage:m.previewRouteBadge}),s=this.props.intl.formatMessage({id:"pause",defaultMessage:g.defaultMessages.pause}),n=this._handleIsDisablePlayBtn()||!this.props.isDrawHelperLoaded||this.state.is2DJimuMapView||!this.props.isTerrainLoaded;if(this.props.isPreviewRouteBtnPlaying)e=(0,o.jsx)(g.Button,{icon:!0,onClick:this.handlePreviewRoute,title:s,"aria-label":s,disabled:n,children:(0,o.jsx)(St,{})});else{const s=this.state.previewNeedToResetFlag?i:t;e=(0,o.jsx)(g.Button,{icon:!0,onClick:this.handlePreviewRoute,title:s,"aria-label":s,disabled:n,children:(0,o.jsx)(wt,{})})}return(0,o.jsx)(g.Badge,{dot:!0,hideBadge:!this.state.previewNeedToResetFlag,color:"error",children:e})}}class bt extends l.React.PureComponent{constructor(e){super(e),this.backBtnRefFor508=null,this.handleKeydown=(e,t)=>{"Enter"===e.key&&t.current.blur()},this.getStyle=()=>l.css`
      .tilt-setting{
        .tilt-slider{
          width:80px
        }

        .tilt-number{
          .jimu-numeric-input {
            width: 64px;
          }
        }
      }

      .altitude-setting{
        margin-top: 1rem;
        margin-bottom: 1rem;

        .altitude-number{
          width: 90px;

          .jimu-numeric-input-input{
            width: 90px;
          }
        }
        .altitude-tips{
          text-align:right;
        }
        .small-tips{
          font-size: 12px;
          color: #A8A8A8;
        }
      }
      `,this.handleBackBtnClick=()=>{this.props.onRecordChange(this.tmpRecordConfig),this.props.onRecordEdit({routeUuid:null,recordUuid:null})},this.handleRecordChange=e=>{this.props.onRecordChange(e)},this.handleDisplayNameChange=e=>{this.tmpRecordConfig.displayName=e},this.handleDurationChange=e=>{this.tmpRecordConfig.duration=ge(e),this.setState({duration:this.tmpRecordConfig.duration})},this.handleDelayChange=e=>{this.tmpRecordConfig.endDelay=ge(e),this.setState({endDelay:this.tmpRecordConfig.endDelay})},this.handlePointDirectionChange=e=>{this.tmpRecordConfig.direction=e,this.setState({rotateDirection:e})},this.handlePointTiltChange=e=>{let t=this.tmpRecordConfig.controllerConfig.liveviewSettingState.fixTilt;t=pe(e),this.props.onLiveViewSettingChange({tilt:t}),this.setState({tilt:t})},this.handlePointAngleChange=e=>{this.tmpRecordConfig.angle=pe(e),this.setState({angle:this.tmpRecordConfig.angle})},this.renderPointDirection=()=>{const e=this.state.rotateDirection===s.CW,t=this.props.intl.formatMessage({id:"styleLabelRotate",defaultMessage:m.styleLabelRotate}),i=this.props.intl.formatMessage({id:"CW",defaultMessage:m.CW}),n=this.props.intl.formatMessage({id:"CCW",defaultMessage:m.CCW});return(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsx)(u.SettingRow,{label:t}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:e,id:"CW",style:{cursor:"pointer"},onChange:e=>{this.handlePointDirectionChange(s.CW)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"CW",className:"ml-1 text-break",children:i})]}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:!e,id:"CCW",style:{cursor:"pointer"},onChange:e=>{this.handlePointDirectionChange(s.CCW)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"CCW",className:"ml-1 text-break",children:n})]})]})},this.renderTilt=()=>{const{tilt:e}=this.state,t=this.props.intl.formatMessage({id:"tilt",defaultMessage:g.defaultMessages.tilt}),i=this.props.intl.formatMessage({id:"degree",defaultMessage:g.defaultMessages.degree});return(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsx)(u.SettingRow,{label:t}),(0,o.jsxs)(u.SettingRow,{className:"tilt-setting mt-0",children:[(0,o.jsx)(g.Slider,{className:"d-flex dropdown-item tilt-slider",value:e,min:X.MIN,max:X.MAX,step:X.STEP,onChange:e=>{this.handlePointTiltChange(parseFloat(e.target.value))}}),(0,o.jsxs)("div",{className:"d-flex tilt-number",children:[(0,o.jsx)(g.NumericInput,{className:"m-2",defaultValue:"0",size:"sm",value:e,min:X.MIN,max:X.MAX,onChange:e=>{this.handlePointTiltChange(e)}}),(0,o.jsx)(g.Label,{className:"",children:i})]})]})]})},this.renderPointsAdvancedSettings=()=>{const{duration:e,angle:t,endDelay:i}=this.state,s=this.props.intl.formatMessage({id:"advancedSettings",defaultMessage:m.advancedSettings}),n=this.props.intl.formatMessage({id:"duration",defaultMessage:m.duration}),a=this.props.intl.formatMessage({id:"rotationAngle",defaultMessage:m.rotationAngle}),r=this.props.intl.formatMessage({id:"endDelay",defaultMessage:m.endDelay});return(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsx)(u.SettingRow,{label:s}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"",children:n})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.NumericInput,{className:"w-100",size:"sm",showHandlers:!1,value:e,min:ee.MIN,onChange:e=>{this.handleDurationChange(e)}})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"",children:a})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.NumericInput,{className:"w-100",size:"sm",showHandlers:!1,value:t,min:0,onChange:e=>{this.handlePointAngleChange(e)}})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"",children:r})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.NumericInput,{className:"w-100",size:"sm",showHandlers:!1,value:i,min:ee.MIN,onChange:e=>{this.handleDelayChange(e)}})})]})},this.handlePathStyleChange=e=>{this.tmpRecordConfig.type=e,this.setState({pathStyle:e})},this.handlePathAltitudeChange=e=>{let t=this.tmpRecordConfig.controllerConfig.liveviewSettingState.fixAltitude;t=ue(e),this.props.onLiveViewSettingChange({altitude:t}),this.setState({altitude:t})},this.renderPathStyle=()=>{const e=this.state.pathStyle===We.Smoothed,t=this.props.intl.formatMessage({id:"styleLabelPath",defaultMessage:m.styleLabelPath}),i=this.props.intl.formatMessage({id:"pathTypeSmoothedCurve",defaultMessage:m.pathTypeSmoothedCurve}),s=this.props.intl.formatMessage({id:"pathTypeRealPath",defaultMessage:m.pathTypeRealPath});return(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:" text-truncate",children:t})}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:e,id:"CURVED",style:{cursor:"pointer"},onChange:e=>{this.handlePathStyleChange(We.Smoothed)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"CURVED",className:"ml-1 text-break",children:i})]}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:!e,id:"LINE",style:{cursor:"pointer"},onChange:e=>{this.handlePathStyleChange(We.RealPath)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"LINE",className:"ml-1 text-break",children:s})]})]})},this.renderAltitude=()=>{const{altitude:e}=this.state,t=this.props.intl.formatMessage({id:"altitude",defaultMessage:g.defaultMessages.altitude}),i=this.props.intl.formatMessage({id:"meterAbbr",defaultMessage:g.defaultMessages.meterAbbr}),s=this.props.intl.formatMessage({id:"ground",defaultMessage:g.defaultMessages.ground}),n=this.props.intl.formatMessage({id:"outerSpace",defaultMessage:g.defaultMessages.outerSpace}),a=this.props.intl.formatMessage({id:"relative2Ground",defaultMessage:g.defaultMessages.relative2Ground});return(0,o.jsxs)("div",{className:"altitude-setting",children:[(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"",children:t})}),(0,o.jsxs)(u.SettingRow,{className:"d-flex justify-content-between",children:[(0,o.jsxs)("div",{className:"d-flex altitude-number",children:[(0,o.jsx)(g.NumericInput,{defaultValue:"0",size:"sm",value:e,min:Q.MIN,max:Q.MAX,onChange:e=>{this.handlePathAltitudeChange(e)}}),(0,o.jsx)(g.Label,{className:"small-tips",children:i})]}),(0,o.jsx)(g.Label,{className:"small-tips altitude-tips ml-5",children:a})]}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Slider,{className:"d-flex dropdown-item",value:e,min:Q.MIN,max:Q.MAX,step:Q.STEP,onChange:e=>{this.handlePathAltitudeChange(parseFloat(e.target.value))},title:""})}),(0,o.jsxs)(u.SettingRow,{className:"d-flex mt-0 justify-content-between ",children:[(0,o.jsx)(g.Label,{className:"small-tips",children:s}),(0,o.jsx)(g.Label,{className:"small-tips",children:n})]})]})},this.renderPathAdvancedSettings=()=>{const{duration:e,endDelay:t}=this.state,i=this.props.intl.formatMessage({id:"advancedSettings",defaultMessage:m.advancedSettings}),s=this.props.intl.formatMessage({id:"duration",defaultMessage:m.duration}),n=this.props.intl.formatMessage({id:"endDelay",defaultMessage:m.endDelay});return(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsx)(u.SettingRow,{label:i}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"",children:s})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.NumericInput,{className:"w-100",size:"sm",showHandlers:!1,value:e,min:ee.MIN,onChange:e=>{this.handleDurationChange(e)}})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"",children:n})}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.NumericInput,{className:"w-100",size:"sm",showHandlers:!1,value:t,min:ee.MIN,onChange:e=>{this.handleDelayChange(e)}})})]})};const{type:t}=this.props.record.getConfig();let i,n,a,r;t===We.Rotate?(i=this.props.record.getConfig().direction,n=this.props.getCurrentLiveViewSetting().tilt):t!==We.RealPath&&t!==We.Smoothed||(a=this.props.record.getConfig().type,r=this.props.getCurrentLiveViewSetting().altitude);const h=this.props.getDefaultDuration()/1e3,d=Me(this.props.record.getConfig().duration)?this.props.record.getConfig().duration:h,c=this.props.record.getConfig().angle,p=this.props.record.getConfig().endDelay;this.state={rotateDirection:i,tilt:pe(n),angle:pe(c),pathStyle:a,altitude:ue(r),duration:ge(d),endDelay:ge(p)},this.tmpRecordConfig=this.props.record.getConfig()}componentDidMount(){(0,l.focusElementInKeyboardMode)(this.backBtnRefFor508)}render(){var e;const t=this.props.record.getConfig(),i=l.React.createRef(),s=this.props.intl.formatMessage({id:"label",defaultMessage:g.defaultMessages.label}),n=this.props.intl.formatMessage({id:"back",defaultMessage:g.defaultMessages.back}),a=null==t?void 0:t.type;return Me(t)&&(0,o.jsx)("div",{className:"w-100",css:this.getStyle(),children:(0,o.jsxs)(u.SettingSection,{children:[(0,o.jsxs)(g.Button,{className:"page-back-btn p-0 mt-1 mb-2",type:"tertiary",title:n,"aria-label":n,onClick:this.handleBackBtnClick,ref:e=>{this.backBtnRefFor508=e},children:[(0,o.jsx)(mt,{size:"m",autoFlip:!0}),(0,o.jsx)(g.Label,{className:"m-0",children:n})]}),(0,o.jsx)(u.SettingRow,{label:s}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.TextInput,{className:"w-100",ref:i,size:"sm",required:!0,title:t.displayName,defaultValue:null!==(e=t.displayName)&&void 0!==e?e:"",onAcceptValue:this.handleDisplayNameChange,onKeyDown:e=>{this.handleKeydown(e,i)}})}),a===We.Rotate&&(0,o.jsxs)(l.React.Fragment,{children:[this.renderPointDirection(),this.renderTilt(),this.renderPointsAdvancedSettings()]}),(a===We.RealPath||a===We.Smoothed)&&(0,o.jsxs)(l.React.Fragment,{children:[this.renderPathStyle(),this.renderAltitude(),this.renderPathAdvancedSettings()]})]})})}}var Rt,xt=c(48993),jt=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};!function(e){e.RelativeToGround="relative-to-ground",e.OnTheGround="on-the-ground"}(Rt||(Rt={}));class At{constructor(){this.widgetId="",this.jimuMapView=null,this.GraphicsLayer=null,this.removeAllGraphics=()=>{var e,t;null===(e=this.layersGroup.layerOnTheGround)||void 0===e||e.removeAll(),null===(t=this.layersGroup.layerRelativeToGround)||void 0===t||t.removeAll()}}setup(e,t){return jt(this,void 0,void 0,function*(){return yield(0,h.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer"]).then(i=>{[this.GraphicsLayer]=i,this.widgetId=t,this.resetJimuMapView(e),this.layersGroup={layerRelativeToGround:null,layerOnTheGround:null},this.resetGraphicsLayers()}),this})}resetJimuMapView(e){var t,i,s,n;return this.jimuMapView&&(null===(t=this.jimuMapView.view)||void 0===t||t.map.remove(null===(i=this.layersGroup)||void 0===i?void 0:i.layerRelativeToGround),null===(s=this.jimuMapView.view)||void 0===s||s.map.remove(null===(n=this.layersGroup)||void 0===n?void 0:n.layerOnTheGround)),this.jimuMapView=e,this}resetGraphicsLayers(){return this._getGraphicsLayer(Rt.RelativeToGround),this._getGraphicsLayer(Rt.OnTheGround),this}_getGraphicsLayer(e){var t;let i=null;const s=e+"-draw-layer-"+this.widgetId+"-"+this.jimuMapView.id;(null===(t=this.jimuMapView.view)||void 0===t?void 0:t.map)&&(i=this.jimuMapView.view.map.findLayerById(s),i||(i=new this.GraphicsLayer({id:s,listMode:"hide",title:s,elevationInfo:{mode:e}}),this.jimuMapView.view.map.add(i))),e===Rt.RelativeToGround?this.layersGroup.layerRelativeToGround=i:e===Rt.OnTheGround&&(this.layersGroup.layerOnTheGround=i)}}var Lt=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class Tt extends l.React.PureComponent{constructor(e){super(e),this.Graphic=null,this.Geometry=null,this.Point=null,this.handleDrawToolCreated=e=>Lt(this,void 0,void 0,function*(){this.jimuDrawToolsRef=e,yield this.jimuDrawToolsRef.completeOperation(),this.props.onDrawHelperCreated(this)}),this.handleDrawToolsActivated=e=>{null!==e&&this._drawingModeChange(e)},this.handleDrawCancel=()=>{this._drawingModeChange(zt.Null),this.props.onDrawCancel()},this._drawingModeChange=e=>{this.drawingMode=e,this.props.onDrawingModeChanged(e)},this.handleDrawStart=()=>{"function"==typeof this.props.onDrawStart&&this.props.onDrawStart()},this.handleDrawEnd=e=>{},this.handleDrawFinish=({type:e,graphics:t})=>{var i,s;if("deleted"===e||"modified"===e)return;if(this.jimuDrawToolsRef.sketch.layer&&"function"==typeof this.jimuDrawToolsRef.sketch.layer.removeAll&&this.jimuDrawToolsRef.sketch.layer.removeAll(),"aborted"===e)return void this.handleDrawCancel();const n=null===(s=null===(i=this.sceneView)||void 0===i?void 0:i.camera)||void 0===s?void 0:s.clone().toJSON(),a=t&&t[0],r=new Y({graphics:null,isPicked:!1});this.drawingMode===zt.Point&&(a.geometry.z&&(a.geometry.z=0),r.setGraphics(this.doDrawPoint(a)),this.props.onDrawFinish({graphicsInfo:r,cameraInfo:n,drawingMode:this.drawingMode}),this._drawingModeChange(zt.Null)),this.drawingMode===zt.Line&&(r.setGraphics(this.doDrawLine(a)),this.props.onDrawFinish({graphicsInfo:r,cameraInfo:n,drawingMode:this.drawingMode}),this._drawingModeChange(zt.Null))},this.getGraphicsByAttrId=e=>{let t=[];const i=this.props.layersGroup.layerOnTheGround.graphics.toArray().filter(t=>t.attributes.jimuDrawId===e);return i.length>0?(t.push(i[0]),t=t.concat(this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(t=>t.attributes.jimuDrawId===e)),t):this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(t=>t.attributes.jimuDrawId===e)},this._removeGraphicsByAttrId=e=>{let t=this.props.layersGroup.layerRelativeToGround.graphics.toArray().filter(t=>t.attributes.jimuDrawId===e.attributes.jimuDrawId);t.length>0&&this.props.layersGroup.layerRelativeToGround.removeMany(t),t=this.props.layersGroup.layerOnTheGround.graphics.toArray().filter(t=>t.attributes.jimuDrawId===e.attributes.jimuDrawId),t.length>0&&this.props.layersGroup.layerOnTheGround.removeMany(t)},this.setGeoZ=(e,t)=>{e.geometry.z=t},this._updateIds=e=>{var t,i;return void 0!==(null===(t=e.attributes)||void 0===t?void 0:t.id)&&void 0===e.attributes.jimuDrawId&&(e.attributes.jimuDrawId=null===(i=e.attributes)||void 0===i?void 0:i.id),e},this.doDrawPoint=e=>{const t=e.clone();return this._removeGraphicsByAttrId(e),this._updateIds(t),t.layer=this.props.layersGroup.layerRelativeToGround,this.props.layersGroup.layerRelativeToGround.addMany([t]),[t]},this.doDrawLine=e=>{const t=e.clone();this._removeGraphicsByAttrId(e),this._updateIds(t),t.layer=this.props.layersGroup.layerOnTheGround,this.props.layersGroup.layerOnTheGround.addMany([t]);const i=this.genStartEndPoint(t);this.props.layersGroup.layerRelativeToGround.addMany(i);let s=[];return s.push(t),s=s.concat(i),s},this.genStartEndPoint=e=>{const t=e.geometry.paths[0];return[this.genExtraPoint(t[0],e,this.materials.startPtMarker),this.genExtraPoint(t[t.length-1],e,this.materials.endPtMarker)]},this.genExtraPoint=(e,t,i)=>{let s=e;return"local"===this.sceneView.viewingMode?s=new this.Point({x:s[0],y:s[1],z:0,spatialReference:this.sceneView.spatialReference}):(s=this.webMercatorUtils.xyToLngLat(s[0],s[1]),s=new this.Point({x:s[0],y:s[1],z:s[2]})),s=new this.Graphic({geometry:s,symbol:i,layer:this.props.layersGroup.layerRelativeToGround,attributes:{jimuDrawId:t.attributes.jimuDrawId}}),s},this.updateLineByAltitude=(e,t)=>{var i;const s=0===t,n=this.getGraphicsByAttrId(e.attributes.jimuDrawId),a=n[0].clone(),r=n[1].clone(),o=n[2].clone();if(this._removeGraphicsByAttrId(a),s)a.layer=this.props.layersGroup.layerOnTheGround,this.props.layersGroup.layerOnTheGround.addMany([a]);else{a.layer=this.props.layersGroup.layerRelativeToGround;const e=a.geometry;e.hasZ=!0,Me(null===(i=e.paths)||void 0===i?void 0:i.length)&&(e.paths.forEach(e=>{e.forEach(e=>{e[2]=t})}),this.props.layersGroup.layerRelativeToGround.addMany([a]))}return r.layer=this.props.layersGroup.layerRelativeToGround,o.layer=this.props.layersGroup.layerRelativeToGround,this.setGeoZ(r,t),this.setGeoZ(o,t),this.props.layersGroup.layerRelativeToGround.addMany([r,o]),[a,r,o]},this.startDrawing=e=>{var t,i,s,n;"function"==typeof(null===(t=this.jimuDrawToolsRef)||void 0===t?void 0:t.sketch.cancel)&&(null===(i=this.jimuDrawToolsRef)||void 0===i||i.sketch.cancel()),zt.Point===e&&(this.jimuDrawToolsRef.sketch.viewModel.pointSymbol=this.defaultSymbols.getDefaultPointSymbol([54,213,22]),null===(s=this.jimuDrawToolsRef)||void 0===s||s.sketch.create(e)),zt.Line===e&&(this.jimuDrawToolsRef.sketch.viewModel.polylineSymbol=this.defaultSymbols.getDefaultLineSymbol([13,137,255]),null===(n=this.jimuDrawToolsRef)||void 0===n||n.sketch.create(e))},this.cancelDrawing=()=>{var e,t,i;this.handleDrawCancel(),"function"==typeof(null===(e=this.jimuDrawToolsRef)||void 0===e?void 0:e.sketch.cancel)&&Me(null===(t=this.jimuDrawToolsRef)||void 0===t?void 0:t.sketch.viewModel)&&(null===(i=this.jimuDrawToolsRef)||void 0===i||i.sketch.cancel())},this.createOrUpdateGraphic=(e,t,i)=>{var s,n;e.geometry.paths?e.symbol=this.materials.lineSymbol.toJSON():e.symbol=this.materials.startPtMarker.toJSON();const a="function"==typeof e.clone?e.clone():this.Graphic.fromJSON(e);if("point"===a.geometry.type)return this.doDrawPoint(a);if("polyline"===a.geometry.type){i&&((null===(s=a.layer)||void 0===s?void 0:s.id)===this.props.layersGroup.layerRelativeToGround.id&&(null===(n=a.layer)||void 0===n?void 0:n.id)===this.props.layersGroup.layerOnTheGround.id||(a.geometry=de(a.geometry,this.sceneView)));let e=this.doDrawLine(a);return Me(null==t?void 0:t.fixAltitude)&&!isNaN(null==t?void 0:t.fixAltitude)&&(e=this.updateLineByAltitude(a,null==t?void 0:t.fixAltitude)),e}},this.removeGraphics=e=>{Me(e)&&(this.props.layersGroup.layerRelativeToGround.removeMany(e),this.props.layersGroup.layerOnTheGround.removeMany(e))},this.removeAll=()=>{var e,t;null===(e=this.props.layersGroup.layerRelativeToGround)||void 0===e||e.removeAll(),null===(t=this.props.layersGroup.layerOnTheGround)||void 0===t||t.removeAll()},this.drawPickedLineStartEndPoints=e=>this.doDrawLine(e),this.removePickedLineStartEndPoints=e=>{this._removeGraphicsByAttrId(e)},this.state={apiLoaded:!1},this.drawingMode=zt.Null}componentDidMount(){var e;this.state.apiLoaded||(0,h.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Geometry","esri/geometry/Point","esri/geometry/support/webMercatorUtils"]).then(e=>Lt(this,void 0,void 0,function*(){[this.Graphic,this.Geometry,this.Point,this.webMercatorUtils]=e,this.defaultSymbols=yield(new q).setup(),this.materials={markerColor:[13,137,255],markerSize:10,outlineColor:"[128, 128, 128, 0.8]",startPtMarker:this.defaultSymbols.getDefaultPointSymbol([54,213,22]),endPtMarker:this.defaultSymbols.getDefaultPointSymbol([255,65,89]),lineColor:[13,137,255,.5],lineSymbol:this.defaultSymbols.getDefaultLineSymbol([13,137,255])},this.setState({apiLoaded:!0})})),this.sceneView=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view}componentDidUpdate(e,t){var i;this.props.jimuMapView!==e.jimuMapView&&(this.removeAll(),this.sceneView=null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view)}render(){return this.state.apiLoaded&&this.props.jimuMapView&&this.props.layersGroup.layerOnTheGround&&this.props.layersGroup.layerRelativeToGround&&(0,o.jsx)("div",{style:{display:"none"},children:(0,o.jsx)(xt.JimuDraw,{jimuMapView:this.props.jimuMapView,operatorWidgetId:this.props.widgetId,onJimuDrawCreated:this.handleDrawToolCreated,onToolsActivated:this.handleDrawToolsActivated,onDrawingStarted:this.handleDrawStart,onDrawingFinished:this.handleDrawEnd,onDrawingCanceled:this.handleDrawCancel,onDrawingUpdated:this.handleDrawFinish,drawingOptions:{creationMode:xt.JimuDrawCreationMode.Update,updateOnGraphicClick:!1,defaultCreateOptions:{hasZ:!0},defaultUpdateOptions:{enableZ:!1},drawingElevationMode3D:xt.DrawingElevationMode3D.RelativeToGround},disableSymbolSelector:!0,defaultSymbols:{pointSymbol:this.materials.startPtMarker,polylineSymbol:this.materials.lineSymbol}})})}}var Dt=c(50313),Gt=c.n(Dt),Nt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const Ft=e=>{const t=window.SVG,{className:i}=e,s=Nt(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:Gt()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};class Vt extends l.React.PureComponent{constructor(e){super(e),this.onPickBtnClick=()=>{this.props.onPickingStateChanged(!this.props.isPicking)},this.insertAttrId=e=>(Me(e)&&(Me(e.attributes)||(e.attributes={}),Me(e.attributes.id)&&!Me(e.attributes.jimuDrawId)?e.attributes.jimuDrawId=e.attributes.id:Me(e.attributes.jimuDrawId)||(e.attributes.jimuDrawId=l.utils.getUUID())),e),this.pointerMoveHandler=e=>{var t;this.props.isPicking&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.hitTest(e).then(e=>{const t=e.results.filter(e=>"graphic"===e.type);if((null==t?void 0:t.length)>0){const e=t[0].graphic;this.props.onHoverPicking([e])}}))},this.pointerClickHandler=e=>{var t;this.props.isPicking&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.hitTest(e).then(t=>{this.clickGraphicsByPick(t,e)}))},this.clickGraphicsByPick=(e,t)=>{var i,s;this.props.onPickingStateChanged(!1);const n=(null===(i=this.props.jimuMapView)||void 0===i?void 0:i.view).camera.clone().toJSON(),a=e.results;if((null==a?void 0:a.length)>0){t.stopPropagation();let e=a.filter(e=>"graphic"===e.type)[0].graphic;e=this.insertAttrId(e);const i=e.geometry;if(!i)return;if("polyline"===i.type)this.pickAndClickLine(e,n);else if("point"===i.type){let t;i.hasZ||(t=de(i,null===(s=this.props.jimuMapView)||void 0===s?void 0:s.view)),this.pickAndClickPoint(e,n,t)}}},this.pickAndClickPoint=(e,t,i)=>{const s=new Y({graphics:[e],isPicked:!0});this.props.onPicked({graphicsInfo:s,cameraInfo:t,hitPointWithZ:i,pickMode:"point"})},this.pickAndClickLine=(e,t)=>{const i=new Y({graphics:[e],isPicked:!0});this.props.onPicked({graphicsInfo:i,cameraInfo:t,hitPointWithZ:null,pickMode:"polyline"})},this.state={isPicking:!1},this._clearEvents(),this._resetEvents()}componentWillUnmount(){this._clearEvents()}_clearEvents(){Me(this.pointerMoveEvent)&&(this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),Me(this.pointerDownEvent)&&(this.pointerDownEvent.remove(),this.pointerDownEvent=null)}_resetEvents(){var e,t;this.pointerMoveEvent=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view.on("pointer-move",this.pointerMoveHandler),this.pointerDownEvent=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view.on("pointer-down",this.pointerClickHandler)}componentDidUpdate(e){this.props.jimuMapView!==e.jimuMapView&&(this._clearEvents(),this._resetEvents())}render(){const e=!this.props.isDrawHelperLoaded||this.props.isPlaying,t=this.props.intl.formatMessage({id:"triggerSelectFeature",defaultMessage:W});return(0,o.jsx)(g.Button,{icon:!0,onClick:e=>{this.onPickBtnClick()},disabled:e,active:this.props.isPicking,"aria-pressed":this.props.isPicking,title:t,"aria-label":t,className:"btns pick-btn",variant:this.props.isPicking?"contained":"text",color:this.props.isPicking?"inherit":"default",children:(0,o.jsx)(Ft,{})})}}class kt extends l.React.PureComponent{constructor(t){super(t),this._resetHighlightCache=()=>{this.highlightCache={hover:{graphic:null,handler:null},selected:{graphics:null,handler:null}}},this.removeHoverHighlightCache=()=>{Me(this.highlightCache.hover.handler)&&this.highlightCache.hover.handler.remove(),this.highlightCache.hover.graphic=null,this.highlightCache.hover.handler=null},this.cacheHoverHighlight=(e,t)=>{this.highlightCache.hover.graphic=t,this.highlightCache.hover.handler=e},this.removeSelectedHighlightCache=()=>{Me(this.highlightCache.selected.handler)&&this.highlightCache.selected.handler.remove(),this.highlightCache.selected.graphics=null,this.highlightCache.selected.handler=null},this.cacheSelectedHighlight=(e,t)=>{this.highlightCache.selected.graphics=t,this.highlightCache.selected.handler=e},this.highlightGraphicsByHover=t=>{var i,s;const n=Me(t)?t[0]:null;if(null===n)return;const a=null===(i=null==n?void 0:n.geometry)||void 0===i?void 0:i.type;("polyline"===a&&this.props.flyStyle===e.Path||"point"===a&&this.props.flyStyle===e.Rotate)&&(null===(s=this.props.jimuMapView)||void 0===s||s.view.whenLayerView(n.layer).then(e=>{const t=e;this.cacheHoverHighlight(t.highlight(n),n)}))},this.highlightGraphicsBySelect=e=>{var t;const i=Me(e)?e[0]:null;null!==i&&(null===(t=this.props.jimuMapView)||void 0===t||t.view.whenLayerView(i.layer).then(t=>{const s=t.highlight(i);this.cacheSelectedHighlight(s,e)}))},this.clear=()=>{this.removeHoverHighlightCache(),this.removeSelectedHighlightCache()},this._resetHighlightCache()}componentDidUpdate(e){this.props.hoverPickingGraphics!==e.hoverPickingGraphics&&(this.removeHoverHighlightCache(),this.highlightGraphicsByHover(this.props.hoverPickingGraphics)),this.props.selectedPickingGraphics!==e.selectedPickingGraphics&&(this.removeSelectedHighlightCache(),this.highlightGraphicsBySelect(this.props.selectedPickingGraphics))}componentWillUnmount(){this.clear(),this._resetHighlightCache()}render(){return null}}class Ot extends l.React.PureComponent{constructor(e){super(e),this.componentDidMount=()=>{this.props.onPopupHelperCreated(this)},this.componentWillUnmount=()=>{this.restoreMapPopupHighlightState()},this.clearCacheMapState=()=>{this.mapPopupState={popup:null,hightLight:null}},this.enablePopupAndHighlight=()=>{const e=this.props.jimuMapView;Me(e)&&(e.enableClickOpenPopup(),e.enableClickHighlight())},this.disablePopupAndHighlight=()=>{const e=this.props.jimuMapView;Me(e)&&(e.disableClickOpenPopup(),e.disableClickHighlight())},this.cacheMapPopupHighlightState=()=>{var e,t;this.mapPopupState.popup=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.isClickOpenPopupEnabled(),this.mapPopupState.hightLight=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.isClickHighlightEnabled()},this.restoreMapPopupHighlightState=()=>{const e=this.props.jimuMapView,t=null!==this.mapPopupState.popup&&null!==this.mapPopupState.hightLight;if(Me(e)&&(null==e?void 0:e.view)&&t){let t=!1;const i=this.mapPopupState.popup;i?(e.enableClickOpenPopup(),t=!0):i||(e.disableClickOpenPopup(),t=!0);const s=this.mapPopupState.hightLight;s?(e.enableClickHighlight(),t=!0):s||(e.disableClickHighlight(),t=!0),t&&this.clearCacheMapState()}},this.mapPopupState={popup:null,hightLight:null},this.clearCacheMapState()}render(){return null}}class Ut extends l.React.PureComponent{constructor(){super(...arguments),this.TRANSPARENT_GIF="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="}render(){const e={borderRadius:"50%",border:"none",backgroundColor:this.props.theme.ref.palette.neutral[600]};return(0,o.jsx)(l.React.Fragment,{children:(0,o.jsx)(g.Button,{icon:!0,type:"tertiary",className:"btns "+this.props.className,disabled:!0,children:(0,o.jsx)(g.Icon,{icon:this.TRANSPARENT_GIF,style:e})})})}}var Et=c(3981),_t=c.n(Et),Bt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(i[s[n]]=e[s[n]])}return i};const Ht=e=>{const t=window.SVG,{className:i}=e,s=Bt(e,["className"]),n=(0,l.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:n,src:_t()},s)):(0,o.jsx)("svg",Object.assign({className:n},s))};var zt,Wt,Jt=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};!function(e){e.Null="null",e.Point="point",e.Line="polyline"}(zt||(zt={})),function(e){e.Point="point",e.Line="polyline",e.Pick="pick",e.Clear="clear"}(Wt||(Wt={}));class Zt extends l.React.PureComponent{constructor(t){super(t),this._isInCludeShowItem=e=>this.props.showItems.includes(e),this.handleDrawHelperCreated=e=>{this.drawHelperRef=e,this.setState({isDrawHelperLoaded:!0}),this.props.onRef(this)},this.handleDrawingModeChanged=e=>{zt.Null!==e&&this.setState({isPicking:!1}),this.setState({drawingMode:e}),"function"==typeof this.props.onDrawingModeChanged&&this.props.onDrawingModeChanged(e)},this.getDrawBtnContent=()=>{const t=this._isInCludeShowItem(Wt.Point),i=this._isInCludeShowItem(Wt.Line),s=!!this.props.isDisabled||(this.props.isPlaying||!this.state.isDrawHelperLoaded),n=this.props.intl.formatMessage({id:"triggerDrawPoint",defaultMessage:H}),a=this.props.intl.formatMessage({id:"triggerDrawPath",defaultMessage:z}),r=this.props.flyStyle;return(0,o.jsxs)(l.React.Fragment,{children:[t&&(r===e.Rotate||null===r)&&(0,o.jsx)(g.Button,{icon:!0,className:"operation-btns btns draw-btn",type:"tertiary",onClick:()=>{this.onDrawBtnClick(zt.Point,{isTriggerCancel:!0})},disabled:s,title:n,"aria-label":n,active:zt.Point===this.state.drawingMode,"aria-pressed":zt.Point===this.state.drawingMode,children:(0,o.jsx)(at,{})}),i&&(r===e.Path||null===r)&&(0,o.jsx)(g.Button,{icon:!0,className:"operation-btns btns draw-btn",type:"tertiary",onClick:()=>{this.onDrawBtnClick(zt.Line,{isTriggerCancel:!0})},disabled:s,title:a,"aria-label":a,active:zt.Line===this.state.drawingMode,"aria-pressed":zt.Line===this.state.drawingMode,children:(0,o.jsx)(ot,{})})]})},this.onDrawBtnClick=(e,t)=>{var i,s;(null==t?void 0:t.isTriggerCancel)&&(null===(i=this.drawHelperRef)||void 0===i||i.cancelDrawing());e===this.state.drawingMode||zt.Point!==e&&zt.Line!==e||null===(s=this.drawHelperRef)||void 0===s||s.startDrawing(e)},this.handleDrawStart=()=>{this.beforInteract()},this.handleDrawEnd=()=>null,this.handleDrawFinish=e=>{var t;const i=e.graphicsInfo.getGraphics();null!==this.state.selectedPickingGraphics&&(null===(t=this.drawHelperRef)||void 0===t||t.removePickedLineStartEndPoints(this.state.selectedPickingGraphics[0])),this.props.onDrawFinish(e,!1),this.highlightGraphics(i),this.focusGraphics(i),this.afterInteract()},this.handleDrawCancel=()=>{this.afterInteract(),"function"==typeof this.props.onDrawCancel&&this.props.onDrawCancel()},this.getPickBtnContent=()=>(0,o.jsx)(Vt,{jimuMapView:this.props.jimuMapView,intl:this.props.intl,isPlaying:this.props.isPlaying,isDrawHelperLoaded:this.state.isDrawHelperLoaded,drawingMode:this.state.drawingMode,isPicking:this.state.isPicking,onPicked:this.handlePicked,onPickingStateChanged:this.handlePickingStateCahnged,onHoverPicking:this.handleHoverPicking,hoveredGraphic:this.state.hoveredGraphic}),this.handleHoverPicking=e=>{this.setState({hoverPickingGraphics:e})},this.handlePickingStateCahnged=e=>{e?this.drawHelperRef.cancelDrawing():e||this.setState({hoverPickingGraphics:null}),this.setState({isPicking:e})},this.handlePicked=e=>{if(!this.validPickingByType(e))return;this.clearAll();let t=e.graphicsInfo.getGraphics();const i=t[0];setTimeout(()=>{if("polyline"===i.geometry.type){const e=this.drawHelperRef.drawPickedLineStartEndPoints(i);t=[i,e[1],e[2]]}this.highlightGraphics(t),this.focusGraphics(t),this.props.onPickHandler(e)},10)},this.validPickingByType=t=>{let i=!1;return(this.props.flyStyle===e.Rotate&&"point"===t.pickMode||this.props.flyStyle===e.Path&&"polyline"===t.pickMode)&&(i=!0),i},this.highlight=e=>{null===e?this.clearHighlightGraphics():(this.highlightGraphics(e),this.focusGraphics(e))},this.clearHighlightGraphics=()=>{this.setState({selectedPickingGraphics:null}),this.setState({hoverPickingGraphics:null})},this.highlightGraphics=e=>{this.setState({selectedPickingGraphics:e})},this.getClearBtnContent=()=>{const e=this.props.intl.formatMessage({id:"triggerClear",defaultMessage:J}),t=this.props.isPlaying||null===this.props.focusedGraphic;return(0,o.jsx)(g.Button,{icon:!0,onClick:this.handleClearBtnClick,disabled:t,title:e,"aria-label":e,className:"btns clear-btn",type:"tertiary",children:(0,o.jsx)(Ht,{})})},this.focusGraphics=e=>{this.props.onFocusedGraphicChanged(null);const t=null===e?null:e[0];this.props.onFocusedGraphicChanged(t)},this.handlePopupHelperCreated=e=>{this.popupHelperRef=e},this.beforInteract=()=>{var e,t;null===(e=this.popupHelperRef)||void 0===e||e.cacheMapPopupHighlightState(),null===(t=this.popupHelperRef)||void 0===t||t.disablePopupAndHighlight()},this.afterInteract=()=>{setTimeout(()=>{this.restoreMapPopupHighlightState()},10)},this.restoreMapPopupHighlightState=()=>{var e;null===(e=this.popupHelperRef)||void 0===e||e.restoreMapPopupHighlightState()},this.handleClearBtnClick=()=>{this.clearAll(),this.focusGraphics(null),this.props.onClearBtnClick()},this.clearAll=()=>{var e,t;this.highlight(null),null===(e=this.popupHelperRef)||void 0===e||e.restoreMapPopupHighlightState(),null===(t=this.drawHelperRef)||void 0===t||t.removeAll()},this.onRenderStateChange=e=>{void 0!==(null==e?void 0:e.drawingMode)&&(this.handleDrawingModeChanged(e.drawingMode),this.onDrawBtnClick(e.drawingMode,{isTriggerCancel:!1})),null==e||e.isPicking},this.drawOrUpdateGraphics=e=>{var t;const i=e.storedGraphicsInfo.rawData,s=i.graphics[0],n=i.isPicked,a=null===(t=e.controllerConfig)||void 0===t?void 0:t.liveviewSettingState;let r;if(n){const e=s;r="polyline"===e.geometry.type||Me(e.geometry.paths)?this.drawHelperRef.createOrUpdateGraphic(e,a,n):i.graphics}else r=this.drawHelperRef.createOrUpdateGraphic(s,a,n);return new Y({graphics:r,isPicked:n})},this.removeGraphics=e=>{var t;null===(t=this.drawHelperRef)||void 0===t||t.removeGraphics(e)},this.removeAllGraphics=()=>{var e;null===(e=this.drawLayersGroup)||void 0===e||e.removeAllGraphics()},this.query=()=>null,this.state={apiLoaded:!1,layersGroup:{layerRelativeToGround:null,layerOnTheGround:null},isDrawHelperLoaded:!1,drawingMode:zt.Null,isPicking:!1,hoveredGraphic:null,hoverPickingGraphics:null,selectedPickingGraphics:null}}componentDidMount(){return Jt(this,void 0,void 0,function*(){this.state.apiLoaded||(this.drawLayersGroup=yield(new At).setup(this.props.jimuMapView,this.props.widgetId),this.setState({apiLoaded:!0}),this.setState({layersGroup:this.drawLayersGroup.layersGroup}))})}componentWillUnmount(){this.clearAll(),this.drawLayersGroup&&(this.drawLayersGroup=null),this.props.onRef(null)}componentDidUpdate(e,t){this.props.jimuMapView!==e.jimuMapView&&(this.setState({hoverPickingGraphics:null}),this.setState({selectedPickingGraphics:null}),setTimeout(()=>{var e,t;null===(e=this.drawLayersGroup)||void 0===e||e.resetJimuMapView(this.props.jimuMapView),null===(t=this.drawLayersGroup)||void 0===t||t.resetGraphicsLayers(),this.state.apiLoaded&&this.setState({layersGroup:this.drawLayersGroup.layersGroup})},20))}render(){let e=null;return e=(0,o.jsx)("div",{css:this.getBtnStyleForBuilder(),children:(0,o.jsxs)(l.React.Fragment,{children:[(!this.state.apiLoaded||!this.state.isDrawHelperLoaded)&&(0,o.jsxs)(l.React.Fragment,{children:[this._isInCludeShowItem(Wt.Point)&&(0,o.jsx)(Ut,{theme:this.props.theme,className:"draw-btn"}),this._isInCludeShowItem(Wt.Pick)&&(0,o.jsx)(Ut,{theme:this.props.theme,className:"pick-btn"}),this._isInCludeShowItem(Wt.Line)&&(0,o.jsx)(Ut,{theme:this.props.theme,className:"clear-btn"})]}),this.state.apiLoaded&&this.state.isDrawHelperLoaded&&(0,o.jsxs)(l.React.Fragment,{children:[this.getDrawBtnContent(),this._isInCludeShowItem(Wt.Pick)&&this.getPickBtnContent(),this._isInCludeShowItem(Wt.Clear)&&this.getClearBtnContent()]}),(0,o.jsx)(Tt,{jimuMapView:this.props.jimuMapView,widgetId:this.props.widgetId,onDrawHelperCreated:this.handleDrawHelperCreated,onDrawingModeChanged:this.handleDrawingModeChanged,onDrawStart:this.handleDrawStart,onDrawEnd:this.handleDrawEnd,onDrawFinish:this.handleDrawFinish,onDrawCancel:this.handleDrawCancel,layersGroup:this.state.layersGroup}),(0,o.jsx)(kt,{jimuMapView:this.props.jimuMapView,flyStyle:this.props.flyStyle,hoverPickingGraphics:this.state.hoverPickingGraphics,selectedPickingGraphics:this.state.selectedPickingGraphics}),(0,o.jsx)(Ot,{jimuMapView:this.props.jimuMapView,onPopupHelperCreated:this.handlePopupHelperCreated})]})}),e}getBtnStyleForBuilder(){return l.css`
      .btns.active {
        background-color: var(--sys-color-action-selected) !important;
      }
    `}}var Kt=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class qt extends l.React.PureComponent{constructor(e){super(e),this._isRecordsIdEqual=(e,t)=>{const i=e.records.map(e=>e.idx),s=t.records.map(e=>e.idx);return l.lodash.isDeepEqual(i,s)},this._redrawAllRecordGraphics=e=>{Me(this.graphicInteractionManagerRef)&&(this.graphicInteractionManagerRef.removeAllGraphics(),e.records.forEach(e=>{e.mapViewId===this.props.getPopperJimuMapId()&&this.graphicInteractionManagerRef.drawOrUpdateGraphics(e)}))},this.handleGraphicsUpdate=e=>Kt(this,void 0,void 0,function*(){let t;const i=(0,l.uuidv1)(),{graphicsInfo:s,cameraInfo:n,drawingMode:a}=e,r=this.getDefaultOptions(a);e.drawingMode===zt.Point?t=yield this.addPointRecord(i,r,s,n):e.drawingMode===zt.Line&&(t=yield this.addPathRecord(i,r,s,n)),this.props.onNewFeatureModeChange(Vi.Empty),"function"==typeof this.props.onDrawFinish&&this.props.onDrawFinish(t)}),this.handleDrawCancel=()=>{this.props.onNewFeatureModeChange(Vi.Empty)},this.getDefaultOptions=e=>{let t;switch(e){case zt.Point:t={direction:s.CCW};break;case zt.Line:t={direction:a.Forward,style:n.Smoothed};break;default:console.error("action-panel::getDefaultOptions")}return t},this.addPointRecord=(e,t,i,s)=>Kt(this,void 0,void 0,function*(){const n=this.props.intl.formatMessage({id:"pointStyle",defaultMessage:m.pointStyle}),a=we(this.props.activedRouteConfig.records,n);let r=this.props.buildTemporaryRecordConfig(i,s,this.props.jimuMapView);return r=Object.assign(r,{idx:e,type:We.Rotate,displayName:a,duration:10,startDelay:0,endDelay:0,angle:360,direction:t.direction,mapViewId:this.props.getPopperJimuMapId()}),yield this.props.buildDefaultRecord(r,i)}),this.addPathRecord=(e,t,i,s)=>Kt(this,void 0,void 0,function*(){const n=this.props.intl.formatMessage({id:"pathStyle",defaultMessage:m.pathStyle}),a=we(this.props.activedRouteConfig.records,n);let r=this.props.buildTemporaryRecordConfig(i,s,this.props.jimuMapView);return r=Object.assign(r,{idx:e,type:We.Smoothed,displayName:a,duration:-1,startDelay:0,endDelay:0,direction:t.direction,mapViewId:this.props.getPopperJimuMapId()}),yield this.props.buildDefaultRecord(r,i)}),this.handlePickHandler=e=>{this.handleGraphicsUpdate(e)},this.handleRefGraphicInteractionManager=e=>{this.graphicInteractionManagerRef=e,null!==e?this.setState({isLoaded:!0}):this.setState({isLoaded:!1}),this._redrawAllRecordGraphics(this.props.activedRouteConfig),this.props.onRefGraphicInteractionManager(e)},this.handleFocusedGraphicChanged=e=>{},this.handleDrawingModeChanged=e=>{this.props.stopFly()},this.state={isLoaded:!1},this._init(this.props.jimuMapView)}_init(e){Me(e)&&(this.jimuMapView=e,this._redrawAllRecordGraphics(this.props.activedRouteConfig))}componentDidUpdate(e,t){var i,s,n;this.props.jimuMapView!==e.jimuMapView&&this._init(this.props.jimuMapView),this.props.newFeatureMode!==e.newFeatureMode&&(this.props.newFeatureMode===Vi.Point?null===(i=this.graphicInteractionManagerRef)||void 0===i||i.onRenderStateChange({drawingMode:zt.Point}):this.props.newFeatureMode===Vi.Path?null===(s=this.graphicInteractionManagerRef)||void 0===s||s.onRenderStateChange({drawingMode:zt.Line}):this.props.newFeatureMode===Vi.Empty&&(null===(n=this.graphicInteractionManagerRef)||void 0===n||n.onRenderStateChange({drawingMode:zt.Null}))),Me(this.props.jimuMapView)&&!this._isRecordsIdEqual(this.props.activedRouteConfig,e.activedRouteConfig)&&this._redrawAllRecordGraphics(this.props.activedRouteConfig)}componentWillUnmount(){this.props.onRefGraphicInteractionManager(null)}render(){return(0,o.jsx)("div",{className:"d-flex align-items-center justify-content-center",children:Me(this.props.jimuMapView)&&(0,o.jsx)(Zt,{onRef:this.handleRefGraphicInteractionManager,widgetId:this.props.specifiedJimuMapId,intl:this.props.intl,theme:this.props.theme,jimuMapView:this.props.jimuMapView,showItems:[Wt.Point,Wt.Line],isDisabled:this.props.isDisableDraw||!this.props.isTerrainLoaded,flyStyle:null,isPlaying:!1,onFocusedGraphicChanged:this.handleFocusedGraphicChanged,onDrawingModeChanged:this.handleDrawingModeChanged,onDrawFinish:this.handleGraphicsUpdate,onDrawCancel:this.handleDrawCancel})})}}var Yt=c(62838),$t=c.n(Yt);class Qt extends l.React.PureComponent{constructor(e){super(e),this.Graphic=null,this.GraphicsLayer=null,this.getPoperStyle=e=>l.css`
        .popper-content {
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;

          .popper-header {
            width: 100%;
            flex-shrink: 0;
            flex-grow: 0;
            cursor: move;
          }
          .map-container {
            width: 800px;
            height: 800px;
            background-color: gray;
            display: contents;
          }
          .popper-footer {
            display: flex;
            background:${e.ref.palette.neutral[400]};
            color:${e.ref.palette.neutral[1e3]};
            padding: ${l.polished.rem(10)} ${l.polished.rem(20)};

            .left-tool {
              min-height: 32px;
            }
          }
        }
    `,this.handleClickClose=()=>{this.props.onShowMapPopperChange(!1,Fi.Common)},this.getDefaultSize=()=>{const e=this.querySelector(`div.widget-renderer[data-widgetid="${this.props.useMapWidgetIds[0]}"]`),t=Me(document.querySelector("#default"))?document.querySelector("#default").clientHeight-20:1080;let i={width:770,height:850},s={width:770,height:770};if(Me(e)){const n=e.getBoundingClientRect();let a=n.width/n.height;a=a>0?a:1;let r=1.1*n.width,o=1.1*n.height+111,l=1.1*n.width,h=1.1*n.height;r<770?(r=770,o=770/a+111,l=770,h=770/a):r>1080&&(r=1080,o=1080/a+111,l=1080,h=1080/a),o>t&&(o=t,r=(t-111)*a>770?(t-111)*a:770),h>t-111&&(h=t-111,l=(t-111)*a),i={width:r,height:o},s={width:l-2,height:h}}return{innerSize:i,innerMapSize:s}},this.getWidgetPosition=()=>{const e=(0,l.getAppStore)().getState().appStateInBuilder.appContext.isRTL;let t={x:500,y:50};const{innerSize:i}=this.getDefaultSize();return t={x:e?260:document.body.clientWidth-i.width-260,y:50},t},this.handleActiveViewChange=e=>{var t;this.props.onMapPopperJimuMapViewUpdate(e),e!==this.state.jimuMapView&&("3d"===(null===(t=e.view)||void 0===t?void 0:t.type)?this.setState({is3DView:!0}):this.setState({is3DView:!1})),this.setState({jimuMapView:e})},this.handleViewGroupCreate=e=>{this.props.onMapPopperViewGroupUpdate(e)},this.handleRefGraphicInteractionManager=e=>{this.graphicInteractionManagerRef=e,this.props.onRefGraphicInteractionManager(e)},this.handleDrawFinish=e=>{this.tmpRecordForConfirm=e,this._toggleConfirmWindow(!0)},this._toggleConfirmWindow=e=>{let t;t=void 0!==e?e:!this.state.isShowConfirmWin,this.setState({isShowConfirmWin:t,isConfirmBtnsDisabled:!1},()=>{!t&&Me(this.tmpRecordForConfirm)&&(this.tmpRecordForConfirm=null)})},this.getRecordName=()=>{var e;return null===(e=this.tmpRecordForConfirm)||void 0===e?void 0:e.getConfig().displayName},this._getConfirmWindow=()=>{var e;const{innerSize:t}=this.getDefaultSize(),{theme:i}=this.props,s=this.props.intl.formatMessage({id:"saveTo",defaultMessage:m.saveTo}),n=this.props.intl.formatMessage({id:"closePopup",defaultMessage:m.closePopup}),a=this.props.intl.formatMessage({id:"editElement",defaultMessage:m.editElement}),r=this.props.intl.formatMessage({id:"save",defaultMessage:m.save});return(0,o.jsx)("div",{css:l.css`
        position: absolute;
        z-index: 11;
        top: 0;
        left: 0;
        background-color: ${l.polished.rgba(i.sys.color.secondary.main,.65)};
        width: ${t.width}px;
        height: ${t.height}px;
        .real-container{
          background-color: ${i.sys.color.surface.background};
          border: 1px solid ${i.sys.color.secondary.dark};
          background-clip: padding-box;
          width: 480px;
          position: relative;
          top: 50%;
          margin: -60px auto 0;
        }
        .confirm-header {
          border-bottom: 1px solid ${i.ref.palette.neutral[700]};
          padding: 16px 20px;
        }
        .confirm-context {
          padding: ${l.polished.rem(20)} ${l.polished.rem(20)} 0 ${l.polished.rem(20)};
        }
        .confirm-footer {
          display: flex;
          justify-content: flex-end;
          padding: ${l.polished.rem(20)};
          button {
            cursor: pointer;
            margin-left: ${l.polished.rem(8)};
            min-width: ${l.polished.rem(100)};
          }
        }
      `,children:(0,o.jsxs)("div",{className:"real-container",children:[(0,o.jsx)(g.PanelHeader,{title:s+" "+this.props.activedRouteConfig.displayName,moveable:!1,className:"confirm-header",actions:[{name:"close",label:n,icon:$t(),onClick:this.handleConfirmWinClose}]}),(0,o.jsx)("div",{className:"confirm-context",children:(0,o.jsx)(g.TextInput,{className:"w-100",size:"sm",required:!0,defaultValue:null!==(e=this.getRecordName())&&void 0!==e?e:"",onChange:e=>{this.handleConfirmWinNameChange(e.target.value)}})}),(0,o.jsxs)("div",{className:"confirm-footer",children:[(0,o.jsx)(g.Button,{type:"primary",title:r,"aria-label":r,onClick:this.handleConfirmWinSave,disabled:this.state.isConfirmBtnsDisabled,children:r}),(0,o.jsx)(g.Button,{type:"secondary",title:a,"aria-label":a,onClick:this.handleConfirmWinEdit,disabled:this.state.isConfirmBtnsDisabled,children:a})]})]})})},this.handleConfirmWinClose=()=>{this.props.onRemoveGraphics(this.tmpRecordForConfirm.cachingGraphicsInfo.getGraphics()),this._toggleConfirmWindow(!1)},this.handleConfirmWinNameChange=e=>{e?this.setState({isConfirmBtnsDisabled:!1}):this.setState({isConfirmBtnsDisabled:!0}),this.tmpRecordForConfirm.getConfig().displayName=e},this.handleConfirmWinEdit=()=>{Me(this.tmpRecordForConfirm)&&this.props.onRecordAddAndEdit(this.tmpRecordForConfirm.getConfig()).then(()=>{this._toggleConfirmWindow(!1)})},this.handleConfirmWinSave=()=>{Me(this.tmpRecordForConfirm)&&this.props.onRecordAdd(this.tmpRecordForConfirm.getConfig()),this._toggleConfirmWindow(!1)},this.state={jimuMapView:null,jimuMapViews:null,apiLoaded:!1,is3DView:!1,isTerrainLoaded:!1,mapSize:this.getDefaultSize().innerSize,isShowConfirmWin:!1,isConfirmBtnsDisabled:!1}}componentDidMount(){this.state.apiLoaded||(0,h.loadArcGISJSAPIModules)(["esri/Graphic"]).then(e=>{[this.Graphic]=e,this.setState({apiLoaded:!0})})}componentWillUnmount(){var e,t,i,s,n,a,r;null===(i=null===(t=null===(e=this.graphicInteractionManagerRef)||void 0===e?void 0:e.drawHelperRef)||void 0===t?void 0:t.jimuDrawToolsRef)||void 0===i||i.completeOperation(),null===(r=null===(a=null===(n=null===(s=this.graphicInteractionManagerRef)||void 0===s?void 0:s.drawHelperRef)||void 0===n?void 0:n.jimuDrawToolsRef)||void 0===a?void 0:a.sketch)||void 0===r||r.destroy()}querySelector(e){var t;const i=document.querySelector(`iframe[name="${l.APP_FRAME_NAME_IN_BUILDER}"]`);if(Me(i)){return(null!==(t=i.contentDocument)&&void 0!==t?t:i.contentWindow.document).querySelector(e)}return null}render(){var e,t;const{mapSize:i}=this.state,{activedRouteConfig:s,theme:n,isShowMapPopper:a}=this.props,r=Me(this.props.useMapWidgetIds)&&this.props.useMapWidgetIds[0],h=(0,l.getAppStore)().getState().appStateInBuilder.appConfig;if(!Me(h.widgets[r]))return null;const d=h.widgets[r].useDataSources,c={canZoom:!0,canHome:!0,canCompass:!0,canLayers:!0};let p;if(Me(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.dataSourceId)){const e=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.dataSourceId;p=(0,l.Immutable)({}).set("initialMapDataSourceID",e).set("toolConfig",c)}const u=l.css`.panel-header{
          background:${n.ref.palette.neutral[400]};
          color:${n.ref.palette.neutral[1e3]};
          height: 50px;
          flex-shrink: 0;
          font-size: 1rem;
          font-weight: 500;
        }`,m=(0,o.jsx)(g.FloatingPanel,{onHeaderClose:this.handleClickClose,defaultPosition:this.getWidgetPosition(),headerTitle:s.displayName,size:i,minSize:{width:770,height:850},disableResize:!0,css:u,className:"surface-2",disableActivateOverlay:!0,dragBounds:"body",autoFocus:!1,children:(0,o.jsx)("div",{className:"rounded-1 w-100 h-100",css:this.getPoperStyle(n),children:(0,o.jsxs)("div",{className:"popper-content",children:[(0,o.jsx)("div",{className:"map-container",style:{height:"600px",width:"700px"},children:(0,o.jsx)(xt.JimuMap,{id:this.props.specifiedJimuMapId,useDataSources:d,jimuMapConfig:p,onActiveViewChange:this.handleActiveViewChange,onViewGroupCreate:this.handleViewGroupCreate})}),this.state.isShowConfirmWin&&this._getConfirmWindow(),(0,o.jsxs)("div",{className:"popper-footer",children:[(0,o.jsx)("div",{className:"left-tool",children:(0,o.jsx)(qt,{specifiedJimuMapId:this.props.specifiedJimuMapId,theme:n,intl:this.props.intl,jimuMapView:this.state.jimuMapView,isDisableDraw:!this.state.is3DView||this.props.pageMode===Fi.RecordLoading||this.props.pageMode===Fi.RecordDetails,isTerrainLoaded:this.props.isTerrainLoaded,getPopperJimuMapId:this.props.getPopperJimuMapId,onRefGraphicInteractionManager:this.handleRefGraphicInteractionManager,newFeatureMode:this.props.newFeatureMode,onNewFeatureModeChange:this.props.onNewFeatureModeChange,buildTemporaryRecordConfig:this.props.buildTemporaryRecordConfig,buildDefaultRecord:this.props.buildDefaultRecord,onDrawFinish:this.handleDrawFinish,activedRouteConfig:this.props.activedRouteConfig,playingInfo:this.props.playingInfo,isPreviewRouteBtnPlaying:this.props.isPreviewRouteBtnPlaying,stopFly:this.props.stopFly})}),(0,o.jsx)("div",{className:"float-right"})]})]})})});return(0,o.jsx)("div",{className:"w-100",children:a&&m})}}const Xt=l.React.memo(i=>{const s=(0,l.useIntl)(),n=s.formatMessage({id:"rotateSpeed",defaultMessage:m.rotateSpeed}),a=s.formatMessage({id:"pathSpeed",defaultMessage:m.pathSpeed}),r=s.formatMessage({id:"slow",defaultMessage:g.defaultMessages.slow}),h=s.formatMessage({id:"default",defaultMessage:g.defaultMessages.default}),d=s.formatMessage({id:"fast",defaultMessage:g.defaultMessages.fast}),c=i.mode===e.Rotate?n:a;return(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"fly-style-label",children:c})}),(0,o.jsx)(u.SettingRow,{className:"mt-2 radio-wrapper",children:(0,o.jsxs)(g.Select,{value:i.speed,onChange:e=>{const t=e.target.value;i.onChange(t)},size:"sm","aria-label":c,children:[(0,o.jsx)("option",{value:t.SLOW,children:r}),(0,o.jsx)("option",{value:t.DEFAULT,children:h}),(0,o.jsx)("option",{value:t.FAST,children:d})]})})]})});function ei(e){var t;const i=e.ref.palette.neutral[300];return l.css`
    .widget-setting-fly-controller{
      font-weight: lighter;
      font-size: 13px;

      .select-map-description {
        color: ${e.ref.palette.neutral[1e3]}
      }

      .fly-style-label {
        color: ${e.ref.palette.neutral[900]}
      }

      .hide {
        display: none;
      }

      .radio-wrapper > span.jimu-radio {
        flex-shrink: 0;
      }

      .map-selector-section .component-map-selector .form-control{
        width: 100%;
      }

      /* ui-mode */
      .ui-mode-card-chooser{
        display: flex;
        align-items: start;

        .ui-mode-card-wrapper {
          flex: 1;
        }
        .ui-mode-card-separator {

        }
        .ui-mode-card {

          width: 100%;
          background: ${i} !important;
          border: 2px solid ${i} !important;
          margin: 0 0 0.5rem 0;
        }
        .ui-mode-card.active {
          border: 2px solid ${null===(t=e.sys.color)||void 0===t?void 0:t.primary.main} !important;
        }
        .ui-mode-label {
          overflow: hidden;
          text-align: center;
        }
      }

      /* item-mode */
      .item-detail-wrapper {
        width: 100%;
        padding-left: 0;
        padding-right: 0;
        padding-top: 0.8rem;
      }

      /* Rotate */
      .numeric-input {
        width: 80px;
      }

      /* Planned routes */
      .page-back-btn {
        padding-left: 0;
        padding-right: 0;
      }

      /* dnd-tree */
      .jimu-tree-main__item {
        .jimu-tree-item__body {
          padding: 1px 0;
        }
        .jimu-tree-item__main-line .jimu-tree-item__title >.jimu-tree-item__title-text {
          -webkit-line-clamp: 1;
        }
      }
    }
  `}function ti(e,t,i){let s=!1;!1===e[t].isInUse&&(s=!0),s=!!i;let n="";return s&&(n="hide"),n}function ii(e,t){const i=e.state.camera.clone();let s=i.set("eye",t.eye);return s=i.set("center",t.center),s=i.set("up",t.up),s}var si=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class ni extends Ke{constructor(){super(...arguments),this._updateCameraGlByTilt=(e,t)=>{if(!Me(this._cache.lookAtTargetGL.pos))return null;e<1?e=1:e>89&&(e=89);const i=this.vec3d.create();this.vec3.subtract(i,this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos);const s=this.vec3.length(i),n=this.vec3d.create();this.vec3.normalize(n,this._cache.lookAtTargetGL.upAxis);const a=this.vec3d.create();this.vec3.scale(a,n,s);const r=this.vec3d.create();this.vec3.add(r,this._cache.lookAtTargetGL.pos,a);const o=this.vec3d.create();this.vec3.cross(o,n,i);let l=this.vec3d.create();l=this.rotateBySceneMode(r,o,e,this._cache.lookAtTargetGL.pos);const h=this.mat4d.create();this.mat4.rotate(h,h,ne(e),o);const d=this.vec3d.create();this.vec3.subtract(d,l,this._cache.lookAtTargetGL.pos);const c=this.vec3d.create();if(this.vec3.cross(c,d,o),this.vec3.normalize(c,c),this._cache.cameraGL.pos=l,this._cache.cameraGL.upDir=c,null==t?void 0:t.isUpdateCameraConfig){const e=ii(this.sceneView,{eye:this._cache.cameraGL.pos,center:this._cache.lookAtTargetGL.pos,up:this._cache.cameraGL.upDir});this.cameraInfo=this.apiWebGLUtils.fromRenderCamera(this.sceneView,e),this.cameraInfo=this.cameraInfo.toJSON()}},this._computeCurrentTilt=()=>{const e=this.vec3d.create();this.vec3.subtract(e,this._cache.cameraGL.pos,this._cache.lookAtTargetGL.pos);const t=this.vec3d.create();this.vec3.normalize(t,this._cache.lookAtTargetGL.upAxis);return ae(this.vec3.angle(e,t))},this._updateInitCamera=(e,t)=>{var i;let s,n=e;this._isDebug&&(null===(i=this.auxHelper)||void 0===i||i.drawPoint(n)),n=this.queryGeometryElevInfo(n),this._cache.lookAtTargetGL.pos=ie([n.x,n.y,n.z],null,this.sceneView),this._cache.lookAtTargetGL.upAxis=this.vec3d.create(),this._cache.lookAtTargetGL.baseAlt=n.z,this.sceneView.renderCoordsHelper.worldUpAtPosition(this._cache.lookAtTargetGL.pos,this._cache.lookAtTargetGL.upAxis),s=Me(this.cameraInfo)?this.Camera.fromJSON(this.cameraInfo):this.sceneView.camera.clone();const a=this.apiWebGLUtils.toRenderCamera(this.sceneView,s);return this._cache.cameraGL.pos=a.eye,this._cache.cameraGL.upDir=a.up,(null==t?void 0:t.isUpdateTilt)&&this._updateCameraGlByTilt(this._getTilt()),n},this.fly=e=>si(this,void 0,void 0,function*(){return Me(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),this.isInited()?this.isEnableToFly()?yield this.resume(null==e?void 0:e.animate):yield Promise.reject(new Error("isEnableToFly() === false")):(yield this.prepare(),yield this.resume(),!0)}),this.getApiCamera=()=>{const e=ii(this.sceneView,{eye:this._cache.cameraGL.pos,center:this._cache.lookAtTargetGL.pos,up:this._cache.cameraGL.upDir}),t=this.apiWebGLUtils.fromRenderCamera(this.sceneView,e);return t.position.z<0&&(t.position.z=0),t},this.resumeCamera=e=>si(this,void 0,void 0,function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}),this.getProgress=()=>0}setIsLiveview(e){const t=Object.create(null,{setIsLiveview:{get:()=>super.setIsLiveview}});return si(this,void 0,void 0,function*(){return yield t.setIsLiveview.call(this,e),yield this.setLiveviewSettingInfo(this.getLiveViewSettingInfo())})}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return si(this,void 0,void 0,function*(){return yield t.setLiveviewSettingInfo.call(this,e,()=>si(this,void 0,void 0,function*(){if(Me(e)&&Me(e.tilt)&&Me(this._cache.lookAtTargetGL.pos)&&e.tilt>=0){this._updateCameraGlByTilt(e.tilt,{isUpdateCameraConfig:!0});try{yield this.sceneView.goTo(this.getApiCamera(),{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}return!1}))})}_getTilt(){let e=this.liveviewSetting.getTiltFactor(!0);return(null==e||isNaN(e))&&(e=this._computeCurrentTilt(),this.liveviewSetting.setTiltFactor(e)),e}getLiveViewSettingInfo(){return{tilt:this._getTilt(),altitude:null,speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});return si(this,void 0,void 0,function*(){var i;const s=this.geometry;Me(e)&&(Me(e.angleLimit)?(this.optionsAngleLimit=e.angleLimit,this.angleLimitCounter=e.angleLimit):Me(this.optionsAngleLimit),Me(e.duration)&&(this.duration=e.duration)),t.preparing.call(this),this._updateInitCamera(s,{isUpdateTilt:!1}),Me(this.duration)?this.animate.init(xe.Linear,0,null!==(i=this.optionsAngleLimit)&&void 0!==i?i:360,this.duration):this.animate.init(xe.NONE,0,0,this.duration);try{yield this.sceneView.goTo(this.getApiCamera(),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name?console.log("sceneView.goTo() Aborted"):console.error(e),!1}if(null==e?void 0:e.waitingForTerrain){yield this.reactiveUtils.whenOnce(()=>!this.sceneView.groundView.updating),this._updateInitCamera(this.geometry,{isUpdateTilt:!0});try{yield this.sceneView.goTo(this.getApiCamera(),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.reactiveUtils.whenOnce(()=>!this.sceneView.groundView.updating)}return yield t.prepared.call(this),!0})}_doFly(){const e=Object.create(null,{_doFly:{get:()=>super._doFly}});return si(this,void 0,void 0,function*(){return e._doFly.call(this),yield this.updateAnimat(e=>{var t;const i=this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor());let n=i.step;const a=i.progress;if(Me(this.direction)&&this.direction===s.CW&&(n=-n),this.isLiveviewMode);else if(null===this.optionsAngleLimit||isNaN(this.optionsAngleLimit))this._rotateCam(n);else{a>=1&&(n=this.angleLimitCounter);const e=Math.min(Math.abs(n),this.angleLimitCounter);this.angleLimitCounter-=e,this.angleLimitCounter>0?this._rotateCam(n):this.stop()}this._isDebug&&(null===(t=this.auxHelper)||void 0===t||t.drawPointGL(this._cache.cameraGL.pos,"red"));const r=this.getApiCamera();this.sceneView.goTo(r,{animate:!1}).catch(function(e){if("AbortError"!==e.name)throw new Error(e);console.log("sceneView.goTo() Aborted")})})})}_rotateCam(e){const t=this._cache.lookAtTargetGL.upAxis;let i=this.vec3d.create();i=this.rotateBySceneMode(this._cache.cameraGL.pos,t,e,this._cache.lookAtTargetGL.pos),this._cache.cameraGL.pos=i;const s=this.mat4d.create();this.mat4.rotate(s,s,ne(e),t);const n=this._cache.cameraGL.upDir;this.vec3.transformMat4(n,n,s),this.vec3.normalize(n,n),this._cache.cameraGL.upDir=n}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return si(this,void 0,void 0,function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))})}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return si(this,void 0,void 0,function*(){yield e.clear.call(this),this._cache.lookAtTargetGL.pos=null})}handleMapInteractionStart(){return si(this,void 0,void 0,function*(){yield this.pause()})}handleMapInteractionEnd(){return si(this,void 0,void 0,function*(){})}}class ai{constructor(e,t){this.points=null!=e?e:[],this.points=this.normalPoints4Bspline(this.points),this.iter=null!=t?t:3}getSpline(){const e=this.bspline(this.points,this.iter);return this.mergePoints(e)}clear(){this.points=null,this.iter=null}normalPoints4Bspline(e){var t;const i=[];for(let s=0,n=e.length;s<n;s++){const n=e[s],a=n[0],r=n[1],o=null!==(t=n[2])&&void 0!==t?t:0;i.push(a,r,o)}return i}mergePoints(e){const t=[];for(let i=0,s=e.length/3;i<s;i++){const s=e[3*i],n=e[3*i+1],a=e[3*i+2],r=[];r.push(s,n,a),t.push(r)}return t}bspline(e,t){if(!Me(t)||0===t)return e;const i=e.length/3,s=[e[0],e[1],e[2]],n=.2,a=.8;for(let t=0;t<i-1;t++){const i=3*t;s[3+2*i+0]=a*e[i+0]+n*e[i+3],s[3+2*i+1]=a*e[i+1]+n*e[i+4],s[3+2*i+2]=a*e[i+2]+n*e[i+5],s[3+2*i+3]=n*e[i+0]+a*e[i+3],s[3+2*i+4]=n*e[i+1]+a*e[i+4],s[3+2*i+5]=n*e[i+2]+a*e[i+5]}return s.push(e[e.length-3],e[e.length-2],e[e.length-1]),this.bspline(s,t-1)}}function ri(e,t,i){const s=void 0!==t?t*t:1;return e=i?e:function(e,t){let i=e[0];const s=[i];let n;for(let a=1,r=e.length;a<r;a++)n=e[a],oi(n,i)>t&&(s.push(n),i=n);i!==n&&s.push(n);return s}(e,s),e=function(e,t){const i=e.length,s=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(i);let n=0,a=i-1;const r=[],o=[];let l,h,d,c;s[n]=s[a]=1;for(;Me(a)&&0!==a;){for(h=0,l=n+1;l<a;l++)d=li(e[l],e[n],e[a]),d>h&&(c=l,h=d);h>t&&(s[c]=1,r.push(n,c,c,a)),a=r.pop(),n=r.pop()}for(l=0;l<i;l++)Me(s[l])&&o.push(e[l]);return o}(e,s),e}function oi(e,t){const i=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return i*i+s*s+n*n}function li(e,t,i){let s=t[0],n=t[1],a=t[2],r=i[0]-s,o=i[1]-n,l=i[2]-a;if(0!==r||0!==o||0!==l){const t=((e[0]-s)*r+(e[1]-n)*o+(e[2]-a)*l)/(r*r+o*o+l*l);t>1?(s=i[0],n=i[1],a=i[2]):t>0&&(s+=r*t,n+=o*t,a+=l*t)}return r=e[0]-s,o=e[1]-n,l=e[2]-a,r*r+o*o+l*l}class hi{constructor(){this.c0=0,this.c1=0,this.c2=0,this.c3=0,this.init=(e,t,i,s)=>{this.c0=e,this.c1=i,this.c2=-3*e+3*t-2*i-s,this.c3=2*e-2*t+i+s},this.initCatmullRom=(e,t,i,s,n)=>{this.init(t,i,n*(i-e),n*(s-t))},this.initNonuniformCatmullRom=(e,t)=>{const{x0:i,x1:s,x2:n,x3:a}=e,{dt0:r,dt1:o,dt2:l}=t;let h=(s-i)/r-(n-i)/(r+o)+(n-s)/o,d=(n-s)/o-(a-s)/(o+l)+(a-n)/l;h*=o,d*=o,this.init(s,n,h,d)},this.calc=e=>{const t=e*e,i=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*i}}}class di{constructor(e,t,i){this.set=(e,t,i)=>(this.x=e,this.y=t,this.z=i,this),this.add=e=>(this.x+=e.x,this.y+=e.y,this.z+=e.z,this),this.subVectors=(e,t)=>(this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this),this.distanceToSquared=e=>{const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s},this.distanceTo=e=>Math.sqrt(this.distanceToSquared(e)),this.x=null!=e?e:0,this.y=null!=t?t:0,this.z=null!=i?i:0}}const ci=new di,pi=new hi,ui=new hi,gi=new hi;class mi{constructor(e,t,i,s){this._geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++)t.push(new di(e[i][0],e[i][1],e[i][2]));return t},this.getPoint=(e,t)=>{const i=null!=t?t:new di,s=this.points,n=s.length,a=(n-(!0===this.closed?0:1))*e;let r,o=Math.floor(a),l=a-o;!0===this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/n)+1)*n:0===l&&o===n-1&&(o=n-2,l=1),!0===this.closed||o>0?r=s[(o-1)%n]:(ci.subVectors(s[0],s[1]).add(s[0]),r=ci);const h=s[o%n],d=s[(o+1)%n];let c;if(!0===this.closed||o+2<n?c=s[(o+2)%n]:(ci.subVectors(s[n-1],s[n-2]).add(s[n-1]),c=ci),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(r.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(d),e),s=Math.pow(d.distanceToSquared(c),e);i<1e-4&&(i=1),t<1e-4&&(t=i),s<1e-4&&(s=i),pi.initNonuniformCatmullRom({x0:r.x,x1:h.x,x2:d.x,x3:c.x},{dt0:t,dt1:i,dt2:s}),ui.initNonuniformCatmullRom({x0:r.y,x1:h.y,x2:d.y,x3:c.y},{dt0:t,dt1:i,dt2:s}),gi.initNonuniformCatmullRom({x0:r.z,x1:h.z,x2:d.z,x3:c.z},{dt0:t,dt1:i,dt2:s})}else"catmullrom"===this.curveType&&(pi.initCatmullRom(r.x,h.x,d.x,c.x,this.tension),ui.initCatmullRom(r.y,h.y,d.y,c.y,this.tension),gi.initCatmullRom(r.z,h.z,d.z,c.z,this.tension));return i.set(pi.calc(l),ui.calc(l),gi.calc(l)),i},this.getSpacedPoints=e=>{void 0===e&&(e=5);const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},this.getPointAt=(e,t)=>{const i=this.getUtoTmapping(e);return this.getPoint(i,t)},this.getUtoTmapping=(e,t)=>{const i=this.getLengths();let s=0;const n=i.length;let a;a=Me(t)?t:e*i[n-1];let r,o=0,l=n-1;for(;o<=l;)if(s=Math.floor(o+(l-o)/2),r=i[s]-a,r<0)o=s+1;else{if(!(r>0)){l=s;break}l=s-1}if(s=l,i[s]===a)return s/(n-1);const h=i[s];return(s+(a-h)/(i[s+1]-h))/(n-1)},this.getLength=()=>{const e=this.getLengths();return e[e.length-1]},this.getLengths=e=>{if(void 0===e&&(e=this.arcLengthDivisions),Me(this.cacheArcLengths)&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s,n=this.getPoint(0),a=0;for(t.push(0),s=1;s<=e;s++)i=this.getPoint(s/e),a+=i.distanceTo(n),t.push(a),n=i;return this.cacheArcLengths=t,t},this.points=this._geoArrayToCoords(e),this.closed=null!=t&&t,this.curveType=null!=i?i:"centripetal",this.tension=null!=s?s:.3,this.arcLengthDivisions=2e4}destructor(){}}class vi{constructor(e,t,i,s,n){this.longLineProcessing={threshold:400,distance:150},this.acuteAngleProcessing={angle:90,threshold:300,distance:100},this.geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=ie([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t},this.getLength=()=>this.curve.getLength(),this.sceneView=t,this.points=this.geoArrayToCoords(e),this.vec3=i,this.vec3d=s,this.esriMathUtils=n;const a=ri(this.points,5,!0);this.points=this.preProcessing(a);const r=new ai(this.points);this.curve=new mi(r.getSpline()),r.clear()}destructor(){this.points=null,this.curve=null}getUtoTmapping(e,t){return this.curve.getUtoTmapping(0,t)}getPoint(e){return this.curve.getPoint(e)}preProcessing(e){const t=[];let i=null;for(let s=0;s<e.length-1;s++){const n=e[s],a=e[s+1],r=e[s+2],o=re(n,a),l=Me(r)?re(a,r):null;let h=!1;if(Me(o)&&Me(l)){const e=he({prePos:n,basePos:a,nextPos:r},this.vec3,this.vec3d,this.sceneView,this.esriMathUtils);h=Math.abs(e)>this.acuteAngleProcessing.angle}const d=!(0!==s),c=!(e.length-1!==s+1);let p;if(t.push(n),Me(i)&&!d&&(t.push(i),i=null),p=this._getInsertControlPointRes(o,h),!0===p.isInsert&&!d&&!c){const e=this._getInsertedPoint(n,a,"forward",p.distance);t.push(e)}p=this._getInsertControlPointRes(l,h),!0!==p.isInsert||c||(i=this._getInsertedPoint(a,r,"backward",p.distance)),c&&t.push(a)}for(let e=0,i=t.length;e<i;e++){let i=t[e];i=se(i,null,this.sceneView),t.splice(e,1,i)}return t}_getInsertControlPointRes(e,t){const i=e>this.acuteAngleProcessing.threshold,s=null!==e&&e>this.longLineProcessing.threshold;return t&&i?{isInsert:!0,distance:this.acuteAngleProcessing.distance}:s?{isInsert:!0,distance:this.longLineProcessing.distance}:{isInsert:!1,distance:0}}_getInsertedPoint(e,t,i,s){const n=this.vec3d.create(),a=this.vec3d.create(),r=this.vec3d.create(),o=this.vec3d.create();return"forward"===i?(this.vec3.subtract(n,e,t),this.vec3.normalize(a,n),this.vec3.scale(r,a,s),this.vec3.add(o,t,r)):(this.vec3.subtract(n,t,e),this.vec3.normalize(a,n),this.vec3.scale(r,a,s),this.vec3.add(o,e,r)),o}_getMidpoint(e,t,i){const s=this.vec3d.create(),n=this.vec3d.create(),a=this.vec3d.create(),r=this.vec3d.create(),o=Me(i)?i:re(e,t);return this.vec3.subtract(s,e,t),this.vec3.normalize(n,s),this.vec3.scale(a,n,o/2),this.vec3.add(r,t,a),r}}var fi=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class yi extends Ke{constructor(){super(...arguments),this._updateInitCamera=e=>{e=this.queryGeometryElevInfo(e),this._cache.cachedGeo=this.concatGeoPaths(e),this._cache.paths=new vi(this._cache.cachedGeo,this.sceneView,this.vec3,this.vec3d,this.esriMathUtils);const t=this._cache.paths.getLength();return this.animate.setAmount(t),e},this.getProgress=()=>this.animate.getProgress(),this.getCameraByProgress=()=>{let e,t;0===this.animate.getProgress()?(e=0*this.animate.getAmount(),this.animate.progressForward(),t=this.animate.getAmount()*this.animate.getProgress()):(e=this.animate.getAmount()*this.animate.progressBackward(),e<0&&(e=0,this.animate.progressForward()),t=this.animate.getAmount()*this.animate.getProgress());let i=this._cache.paths.getUtoTmapping(0,e);i=this._cache.paths.getPoint(i),i=this._coordToGeo(i);let s=this._cache.paths.getUtoTmapping(0,t);s=this._cache.paths.getPoint(s),s=this._coordToGeo(s);const n=parseFloat(i[2])+0,a=ie([i[0],i[1],n],null,this.sceneView);let r=this.getCameraPosition(i,s);Me(r)||(r=this._cache.cameraGL.pos);const o=this.vec3d.create();this.sceneView.renderCoordsHelper.worldUpAtPosition(r,o);const l=[0,0,0];l[0]=r[0],l[1]=r[1],l[2]=r[2];const h=[0,0,0];return h[0]=a[0],h[1]=a[1],h[2]=a[2],this._cache.cameraGL.pos=l,this._cache.cameraGL.upDir=o,this._cache.lookAtTargetGL.pos=h,this._cache.lookAtTargetGL.upAxis=null,this._cache.lookAtTargetGL.baseAlt=null,{lookAt:h,camPos:l,up:o}},this.getApiCamera=e=>{let t=e.camPos,i=e.lookAt;const s=e.up;if(!Me(t)||!Me(i)||!Me(s))return null;let n=0,a=se(i,1,this.sceneView),r=new this.Point({x:a[0],y:a[1],z:a[2],type:"point",spatialReference:this.sceneView.spatialReference});n=r.z,r.z=parseFloat(r.z)+this.liveviewSetting.getAltitudeFactor(),r.z<0&&(r.z=0),i=ie([r.x,r.y,r.z],null,this.sceneView),a=se(t,1,this.sceneView),r=new this.Point({x:a[0],y:a[1],z:a[2],type:"point",spatialReference:this.sceneView.spatialReference}),r.z=n+this.liveviewSetting.getAltitudeFactor()+this.liveviewSetting.getCamOffsetHeight(),t=ie([r.x,r.y,r.z],null,this.sceneView);const o=ii(this.sceneView,{eye:t,center:i,up:s});return this.apiWebGLUtils.fromRenderCamera(this.sceneView,o)},this.getCameraPosition=(e,t)=>{var i,s,n;if(e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return null;const a=null!==(i=this.liveviewSetting.getCamOffsetHeight())&&void 0!==i?i:100,r=null!==(s=this.liveviewSetting.getCamOffsetDistance())&&void 0!==s?s:100,o=ie([e[0],e[1],e[2]],null,this.sceneView),l=ie([t[0],t[1],t[2]],null,this.sceneView),h=this.vec3d.create();this.vec3.subtract(h,o,l);const d=this.vec3.length(h),c=this.vec3d.create();this.vec3.normalize(c,h);const p=d+r,u=this.vec3d.create();this.vec3.scale(u,c,p);const g=this.vec3d.create();this.vec3.add(g,l,u);const m=se(g,1,this.sceneView),v=new this.Point({x:m[0],y:m[1],z:m[2],type:"point",spatialReference:this.sceneView.spatialReference});v.z<a&&(v.z=a),v.z<0&&(v.z=0),this._isDebug&&(null===(n=this.auxHelper)||void 0===n||n.drawPoint(v));return ie([v.x,v.y,v.z],null,this.sceneView)},this.resumeCamera=e=>fi(this,void 0,void 0,function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}),this.stop=e=>{super.stop();const t=e&&e.ignoreResetCameraWhenFinished;this.resetCameraWhenFinishedFlag&&!t&&(this.sceneView.goTo(this.cameraInfo),this.resetCameraWhenFinishedFlag=!1)},this._coordToGeo=e=>Me(e)?this.vec3d.fromValues(e.x,e.y,e.z):null}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return fi(this,void 0,void 0,function*(){return yield t.setLiveviewSettingInfo.call(this,e,()=>fi(this,void 0,void 0,function*(){const e=this.getApiCamera(this.getCameraByProgress());try{yield this.sceneView.goTo(e,{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}))})}getLiveViewSettingInfo(){return{tilt:null,altitude:this.liveviewSetting.getAltitudeFactor(),speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});return fi(this,void 0,void 0,function*(){var i,s;let n=this.geometry;if("polyline"!==(null==n?void 0:n.type))return alert("Wrong geo type!"),!1;if(Me(null==e?void 0:e.duration)&&(this.duration=e.duration),t.preparing.call(this),n=this._updateInitCamera(n),!this.isLiveviewMode){const e=this.animate.computeDuration();this.animate.init(xe.Linear,0,this.animate.getAmount(),null!==(i=this.duration)&&void 0!==i?i:e)}this._isDebug&&(null===(s=this.auxHelper)||void 0===s||s.drawLineXY(this._cache.paths,"lightgreen"));try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}if(null==e?void 0:e.waitingForTerrain){yield this.reactiveUtils.whenOnce(()=>!this.sceneView.groundView.updating),n=this._updateInitCamera(n);try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.reactiveUtils.whenOnce(()=>!this.sceneView.groundView.updating)}return yield t.prepared.call(this),!0})}fly(e){const t=Object.create(null,{isEnableToFly:{get:()=>super.isEnableToFly}});return fi(this,void 0,void 0,function*(){return Me(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),Me(null==e?void 0:e.resetCameraWhenFinished)&&(this.resetCameraWhenFinishedFlag=!0),t.isEnableToFly.call(this)?yield this.resume(e.animate):yield Promise.reject(new Error(null))})}_doFly(){super._doFly(),this.updateAnimat(e=>{this.isLiveviewMode||this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor()),this.updateProgressBar();if(this.getProgress()>=1)this.animate.reset(),this.stop();else{const e=this.getCameraByProgress(),t=this.getApiCamera(e);Me(t)&&this.sceneView.goTo(t,{animate:!1})}})}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return fi(this,void 0,void 0,function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))})}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return fi(this,void 0,void 0,function*(){yield e.clear.call(this)})}handleMapInteractionStart(){return fi(this,void 0,void 0,function*(){yield this.pause()})}handleMapInteractionEnd(){return fi(this,void 0,void 0,function*(){})}}class wi{constructor(e,t,i,s,n){this.geoArrayToCoords=e=>{const t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];s=ie([s[0],s[1],s[2]],null,this.sceneView),t.push(s)}return t},this.getLength=()=>{this.points.length<2&&alert("line.length < 2");let e=0;for(let t=0,i=this.points.length;t<i-1;t++)e+=this.getLineLen(this.points[t+0],this.points[t+1]),e+=Math.abs(he({prePos:this.points[t+0],basePos:this.points[t+1],nextPos:this.points[t+2]},this.vec3,this.vec3d,this.sceneView,this.esriMathUtils));return this.length=e,e},this.sceneView=t,this.points=this.geoArrayToCoords(e),this.vec3=i,this.vec3d=s,this.esriMathUtils=n,this.points=ri(this.points,5,!0)}destructor(){this.points=null}getLineLen(e,t){return re(e,t)}getPoint(e,t){let i=0;for(let e=0,s=this.points.length;e<s-1;e++){const s=this.points[e+0],n=this.points[e+1],a=this.points[e+2],r=this.getLineLen(s,n);if(t<i+r){const e=t-i;return{type:"line",len:e,point:le(s,n,e/r)}}i+=r;const o=he({prePos:s,basePos:n,nextPos:a},this.vec3,this.vec3d,this.sceneView,this.esriMathUtils),l=Math.abs(o);if(t<i+l){return{type:"rotate",angle:(t-i)*oe(o),point:n,points:{pre:s,base:n,next:a},lastLineLen:i}}i+=l}}}var Ci=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class Ii extends Ke{constructor(){super(...arguments),this._updateInitCamera=e=>{e=this.queryGeometryElevInfo(e),this._cache.cachedGeo=this.concatGeoPaths(e),this._cache.paths=new wi(this._cache.cachedGeo,this.sceneView,this.vec3,this.vec3d,this.esriMathUtils);const t=this._cache.paths.getLength();return this.animate.setAmount(t),e},this.getProgress=()=>this.animate.getProgress(),this.getCameraByProgress=e=>{let t,i;0===this.animate.getProgress()?(t=0*this.animate.getAmount(),this.animate.progressForward(),i=this.animate.getAmount()*this.animate.getProgress()):(t=this.animate.getAmount()*this.animate.progressBackward(),i=this.animate.getAmount()*this.animate.getProgress());const s=this._cache.paths.getPoint(0,t),n=this._cache.paths.getPoint(0,i),a=[0,0,0],r=[0,0,0],o=this.vec3d.create();if("line"===s.type){const e=s.point,t=n.point,i=e;let l=this.getCameraPosition(e,t);Me(l)||(l=this._cache.cameraGL.pos),this.sceneView.renderCoordsHelper.worldUpAtPosition(l,o),a[0]=l[0],a[1]=l[1],a[2]=l[2],r[0]=i[0],r[1]=i[1],r[2]=i[2]}else if("rotate"===s.type){const e=s.points.pre,t=s.points.base,i=s.points.next,n=this.vec3d.create();this.vec3.subtract(n,t,e);const l=this.vec3d.create();this.vec3.subtract(l,i,t);const h=s.lastLineLen,d=this._cache.paths.getPoint(0,h-.02),c=this._cache.paths.getPoint(0,h-.01);let p=this.getCameraPosition(d.point,c.point);this.sceneView.renderCoordsHelper.worldUpAtPosition(t,o);const u=s.angle;p=this.rotateBySceneMode(p,o,u,t),a[0]=p[0],a[1]=p[1],a[2]=p[2],r[0]=t[0],r[1]=t[1],r[2]=t[2]}return this._cache.cameraGL.pos=a,this._cache.cameraGL.upDir=o,this._cache.lookAtTargetGL.pos=r,this._cache.lookAtTargetGL.upAxis=null,this._cache.lookAtTargetGL.baseAlt=null,{lookAt:r,camPos:a,up:o,type:s.type}},this.getApiCamera=e=>{var t;let i=e.camPos,s=e.lookAt;const n=e.up;if(!Me(i)||!Me(s)||!Me(n))return null;let a=0,r=se(s,1,this.sceneView),o=new this.Point({x:r[0],y:r[1],z:r[2],type:"point",spatialReference:this.sceneView.spatialReference});a=o.z,o.z=parseFloat(o.z)+this.liveviewSetting.getAltitudeFactor(),o.z<0&&(o.z=0),s=ie([o.x,o.y,o.z],null,this.sceneView),r=se(i,1,this.sceneView),o=new this.Point({x:r[0],y:r[1],z:r[2],type:"point",spatialReference:this.sceneView.spatialReference}),o.z=a+this.liveviewSetting.getAltitudeFactor()+this.liveviewSetting.getCamOffsetHeight(),i=ie([o.x,o.y,o.z],null,this.sceneView),this._isDebug&&(null===(t=this.auxHelper)||void 0===t||t.drawLineGL([i,s],this.sceneView,"yellow"));const l=ii(this.sceneView,{eye:i,center:s,up:n});return this.apiWebGLUtils.fromRenderCamera(this.sceneView,l)},this.resumeCamera=e=>Ci(this,void 0,void 0,function*(){const t=e;try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),{animate:t,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}),this.stop=e=>{super.stop();const t=e&&e.ignoreResetCameraWhenFinished;this.resetCameraWhenFinishedFlag&&!t&&(this.sceneView.goTo(this.cameraInfo),this.resetCameraWhenFinishedFlag=!1)}}setLiveviewSettingInfo(e){const t=Object.create(null,{setLiveviewSettingInfo:{get:()=>super.setLiveviewSettingInfo}});return Ci(this,void 0,void 0,function*(){return yield t.setLiveviewSettingInfo.call(this,e,()=>Ci(this,void 0,void 0,function*(){const e=this.getApiCamera(this.getCameraByProgress());try{yield this.sceneView.goTo(e,{animate:!1,signal:this.abortSignalHandler.update()})}catch(e){return"AbortError"===e.name&&(console.log("sceneView.goTo() Aborted"),!1)}return!0}))})}getLiveViewSettingInfo(){return{tilt:null,altitude:this.liveviewSetting.getAltitudeFactor(),speed:this.liveviewSetting.getSpeedFactor()}}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing},prepared:{get:()=>super.prepared}});return Ci(this,void 0,void 0,function*(){var i;let s=this.geometry;if("polyline"!==(null==s?void 0:s.type))return alert("Wrong geo type!"),!1;if(Me(null==e?void 0:e.duration)&&(this.duration=e.duration),t.preparing.call(this),s=this._updateInitCamera(s),!this.isLiveviewMode){const e=this.animate.computeDuration();this.animate.init(xe.Linear,0,this.animate.getAmount(),null!==(i=this.duration)&&void 0!==i?i:e)}try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsBeforeTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}if(null==e?void 0:e.waitingForTerrain){yield this.reactiveUtils.whenOnce(()=>!this.sceneView.groundView.updating),s=this._updateInitCamera(s);try{yield this.sceneView.goTo(this.getApiCamera(this.getCameraByProgress()),this.getPrepareGoToOptionsAfterTerrainLoaded(e))}catch(e){return"AbortError"===e.name&&console.log("sceneView.goTo() Aborted"),!1}yield this.reactiveUtils.whenOnce(()=>!this.sceneView.groundView.updating)}return yield t.prepared.call(this),!0})}fly(e){const t=Object.create(null,{isEnableToFly:{get:()=>super.isEnableToFly}});return Ci(this,void 0,void 0,function*(){return Me(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),Me(null==e?void 0:e.resetCameraWhenFinished)&&(this.resetCameraWhenFinishedFlag=!0),t.isEnableToFly.call(this)?yield this.resume(e.animate):yield Promise.reject(new Error(null))})}_doFly(){const e=Object.create(null,{_doFly:{get:()=>super._doFly}});return Ci(this,void 0,void 0,function*(){return e._doFly.call(this),yield this.updateAnimat(e=>{this.isLiveviewMode||this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor()),this.updateProgressBar();if(this.animate.getProgress()>=1)this.animate.reset(),this.stop();else{const e=this.getCameraByProgress(),t=this.getApiCamera(e);Me(t)&&this.sceneView.goTo(t,{animate:!1})}})})}getCameraPosition(e,t){var i,s,n;if(e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return null;const a=null!==(i=this.liveviewSetting.getCamOffsetHeight())&&void 0!==i?i:100,r=null!==(s=this.liveviewSetting.getCamOffsetDistance())&&void 0!==s?s:100,o=e,l=t,h=this.vec3d.create();this.vec3.subtract(h,o,l);const d=this.vec3.length(h),c=this.vec3d.create();this.vec3.normalize(c,h);const p=d+r,u=this.vec3d.create();this.vec3.scale(u,c,p);const g=this.vec3d.create();this.vec3.add(g,l,u);const m=se(g,1,this.sceneView),v=new this.Point({x:m[0],y:m[1],z:m[2],type:"point",spatialReference:this.sceneView.spatialReference});v.z<a&&(v.z=a),v.z<0&&(v.z=0),this._isDebug&&(null===(n=this.auxHelper)||void 0===n||n.drawPoint(v,"red"));return ie([v.x,v.y,v.z],null,this.sceneView)}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return Ci(this,void 0,void 0,function*(){return t.resume.call(this),yield this._resume(this.resumeCamera(e))})}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return Ci(this,void 0,void 0,function*(){yield e.clear.call(this)})}handleMapInteractionStart(){return Ci(this,void 0,void 0,function*(){yield this.pause()})}handleMapInteractionEnd(){return Ci(this,void 0,void 0,function*(){})}}var Mi=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class Si extends Ke{constructor(){super(),this.WAIT_TIME={DEFAULT:2e3},this.clearTimer=()=>{clearTimeout(this.waitingTimer),this.waitingTimer=null},this.fly=e=>Mi(this,void 0,void 0,function*(){yield new Promise(t=>{this.initTimer(!0,e),t(null)})}),this.doFly=e=>Mi(this,void 0,void 0,function*(){return Me(null==e?void 0:e.speedFactor)&&this.liveviewSetting.setSpeedFactor(e.speedFactor),this.isInited()?this.isEnableToFly()?yield this.resume(null==e?void 0:e.animate):this.waitingTimer&&this.flyState===Je.RUNNING?yield this.resume():void 0:(yield this.prepare(),yield this.resume(),!0)}),this.stop=()=>{super.stop(),super.clear()},this.handleMapInteractionStart=e=>Mi(this,void 0,void 0,function*(){return this._isDebug&&console.log("handleMapInteraction-Start"),this.stopAnimat(),this.clearTimer(),"mouse-wheel"===(null==e?void 0:e.type)&&this._debounceOnMouseWheel(),yield new Promise(e=>{e(null)})}),this.handleMapInteractionEnd=()=>Mi(this,void 0,void 0,function*(){return this._isDebug&&console.log("handleMapInteraction-End"),this.clearTimer(),this.flyState===Je.RUNNING&&this.initTimer(!1,null),yield new Promise(e=>{e(null)})}),this._debounceOnMouseWheel=l.lodash.debounce(()=>{this.handleMapInteractionEnd()},500),this.pauseTime=this.WAIT_TIME.DEFAULT}prepare(e){const t=Object.create(null,{preparing:{get:()=>super.preparing}});return Mi(this,void 0,void 0,function*(){return yield t.preparing.call(this),this.pauseTime=1e3*e.aroundMapCenterConfig.rotationPauseTime,!0})}_doFly(){const e=Object.create(null,{_doFly:{get:()=>super._doFly}});return Mi(this,void 0,void 0,function*(){return e._doFly.call(this),yield this.updateAnimat(e=>{let t=this.animate.easing(e.deltaTime,this.liveviewSetting.getMappingSpeedFactor()).step;Me(this.direction)&&this.direction===s.CW&&(t=-t);const i=this.sceneView.center;this.sceneView.goTo({heading:this.sceneView.camera.heading-t,center:i},{animate:!1}).catch(function(e){if("AbortError"!==e.name)throw new Error(e);console.log("sceneView.goTo() Aborted")})})})}resume(e){const t=Object.create(null,{resume:{get:()=>super.resume}});return Mi(this,void 0,void 0,function*(){return t.resume.call(this),yield this._resume(!0)})}setIsLiveview(e){return Mi(this,void 0,void 0,function*(){return Promise.resolve(!0)})}setLiveviewSettingInfo(e){return Mi(this,void 0,void 0,function*(){return Promise.resolve(!0)})}getLiveViewSettingInfo(){return{tilt:null,altitude:null,speed:null}}getProgress(){return 0}initTimer(e,t){const i=e?0:this.pauseTime;this.waitingTimer=setTimeout(()=>{this.doFly(t)},i)}pause(){const e=Object.create(null,{pause:{get:()=>super.pause}});return Mi(this,void 0,void 0,function*(){return yield e.pause.call(this),this.clearTimer(),!0})}clear(){const e=Object.create(null,{clear:{get:()=>super.clear}});return Mi(this,void 0,void 0,function*(){this.clearTimer(),yield e.clear.call(this)})}}var Pi=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class bi{static make(e){return Pi(this,void 0,void 0,function*(){let t;const i=e.type;switch(i){case We.Rotate:t=yield(new ni).setup(e);break;case We.AroundMapCenter:t=yield(new Si).setup(e);break;case We.RealPath:t=yield(new Ii).setup(e);break;case We.Smoothed:t=yield(new yi).setup(e);break;default:console.error("ControllerFactory error type:",i)}return t})}}var Ri,xi=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};!function(e){e.RawData="rawData",e.DsInfo="dsInfo"}(Ri||(Ri={}));class ji{constructor(){this.Geometry=null,this.Graphic=null}setup(e,t,i,s){return xi(this,void 0,void 0,function*(){return yield(0,h.loadArcGISJSAPIModules)(["esri/geometry","esri/Graphic"]).then(n=>xi(this,void 0,void 0,function*(){var a,r,o,l,h;[this.Geometry,this.Graphic]=n,this.recordConfig=e,this.sceneView=t,this.flyCallbacks=i,this.controller=null,this.eventHandlers=[];const d=this.recordConfig.type;switch(d){case We.Rotate:case We.AroundMapCenter:case We.RealPath:case We.Smoothed:{let n;if((null===(a=e.storedGraphicsInfo)||void 0===a?void 0:a.type)===Ri.RawData){const t=null===(o=null===(r=e.storedGraphicsInfo)||void 0===r?void 0:r.rawData)||void 0===o?void 0:o.graphics;t&&t[0]&&(n=this.Graphic.fromJSON(t[0]).geometry)}const d={id:e.idx,type:e.type,geometry:n,direction:e.direction,config:{cameraInfo:null===(l=e.controllerConfig)||void 0===l?void 0:l.cameraInfo,liveviewSettingState:null===(h=e.controllerConfig)||void 0===h?void 0:h.liveviewSettingState},sceneView:t,flyCallbacks:i};if(this.controller=yield bi.make(d),s){this.eventHandlers.push(this.sceneView.on("immediate-click",e=>{this.pause()}));const e=t.zoom,i=t.camera.heading,s=t.camera.tilt;t.goTo({target:n},{animate:!1}).then(function(){return t.goTo({zoom:e,heading:i,tilt:s},{animate:!1})})}break}default:console.error("error type: ",d)}})),this})}destructor(){var e;this.eventHandlers&&this.eventHandlers.forEach(e=>{e.remove()}),null===(e=this.controller)||void 0===e||e.destructor(),this.controller=null,this.recordConfig=null}getConfig(){var e,t;return this.recordConfig.controllerConfig=null===(e=this.controller)||void 0===e?void 0:e.getConfig(),(isNaN(this.recordConfig.duration)||this.recordConfig.duration<0)&&(null===(t=this.controller)||void 0===t?void 0:t.animate.state.amount)>=0&&(this.recordConfig.duration=this.controller.animate.getDuration()/1e3),this.cachingGraphicsInfo&&(this.recordConfig.storedGraphicsInfo.rawData=this.cachingGraphicsInfo.getConfig()),this.recordConfig}prepare(e){return xi(this,void 0,void 0,function*(){var t;return Me(e)&&!Me(e.animate)&&Object.assign(e,{animate:!0}),yield null===(t=this.controller)||void 0===t?void 0:t.prepare(e)})}fly(e){return xi(this,void 0,void 0,function*(){var t;Me(e.animate)||Object.assign(e,{animate:!0}),yield null===(t=this.controller)||void 0===t?void 0:t.fly(e)})}pause(){return xi(this,void 0,void 0,function*(){var e;return yield null===(e=this.controller)||void 0===e?void 0:e.pause()})}stop(e){return xi(this,void 0,void 0,function*(){return yield new Promise(t=>{var i;null===(i=this.controller)||void 0===i||i.stop(e),t(null)})})}setGraphicsInfo(e){this.cachingGraphicsInfo=e}getGraphicsInfo(){return this.cachingGraphicsInfo}setSpeedFactor(e){var t;null===(t=this.controller)||void 0===t||t.liveviewSetting.setSpeedFactor(e)}setIsLiveview(e){return xi(this,void 0,void 0,function*(){var t;return yield null===(t=this.controller)||void 0===t?void 0:t.setIsLiveview(e)})}setLiveviewSettingInfo(e){return xi(this,void 0,void 0,function*(){var t;if("function"==typeof(null===(t=this.controller)||void 0===t?void 0:t.setLiveviewSettingInfo))return yield this.controller.setLiveviewSettingInfo(e)})}getLiveViewSettingInfo(){var e;return null===(e=this.controller)||void 0===e?void 0:e.getLiveViewSettingInfo()}getDefaultDuration(){var e;return null===(e=this.controller)||void 0===e?void 0:e.getDefaultDuration()}}var Ai=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class Li{constructor(){this._redrawAllRecordGraphics=e=>{const t=ve(this.itemConfig.routes,e);null==t||t.records.forEach(e=>{e.mapViewId!==this.jimuMapView.id&&e.mapViewId!==Ie(this.jimuMapView.id)||this.drawOrUpdateGraphics(e)})}}setup(t,i,s,n){var a;const{itemConfig:r,recordConfig:o}=t,{flyCallbacks:l,drawOrUpdateGraphics:h,highlightGraphics:d,checkAndSwitchJimuMapBeforePlay:c,getCurrentSceneView:p}=s;switch(this.type=r.name,this.itemConfig=r,this.flyStateCallbacks=l,this.jimuMapView=i,this.record=null!=n?n:null,this.recordConfig=null!==(a=null==n?void 0:n.getConfig())&&void 0!==a?a:o,this.drawOrUpdateGraphics=h,this.highlightGraphics=d,this.checkAndSwitchJimuMapBeforePlay=c,this.getCurrentSceneView=p,this.type){case e.Rotate:case e.Path:this.itemConfig=r;break;case e.Route:this.itemConfig=this.itemConfig;break;default:console.error("error type:",this.type)}return this._resetPlayingInfo(),this}destructor(){var e;this._resetPlayingInfo(),null===(e=this.record)||void 0===e||e.destructor()}handleUpdateJimuMapView(e){var t,i;this.jimuMapView=e,(null===(t=this.playingInfo.currentIds)||void 0===t?void 0:t.ids)&&this._redrawAllRecordGraphics(null===(i=this.playingInfo.currentIds)||void 0===i?void 0:i.ids)}handleUpdateFlyCallbacks(e){this.flyStateCallbacks=e}_getFlyRecordDynamically(e,t,i){return Ai(this,void 0,void 0,function*(){this.itemConfig=this.itemConfig;const s=fe(this.itemConfig.routes,e.ids);return yield(new ji).setup(s,t,i,e.justForHighlight)})}_getLimitationParamForPrepare(e,t){var s;const n={},a=e.getConfig().type,r=e.getConfig().duration;let o;if(a===We.Rotate&&(o=e.getConfig().angle),a===We.AroundMapCenter&&this.itemConfig.targetMode===i.MapCenter){const e={rotationPauseTime:this.itemConfig.rotationPauseTime||2};Object.assign(n,{aroundMapCenterConfig:e})}if(Me(r)&&!isNaN(r)&&r>0&&Object.assign(n,{duration:r*this._computeRouteTaskTimeScale()*1e3}),Me(o)&&Object.assign(n,{angleLimit:o}),Me(t)){Object.assign(n,{animate:t.animate});const e=null===(s=t.waitingForTerrain)||void 0===s||s;Object.assign(n,{waitingForTerrain:e})}return n}highlightSpecifiedRecord(){const e=this.drawOrUpdateGraphics(this.record.getConfig());this.highlightGraphics(e.getGraphics())}playSpecifiedRecord(){return Ai(this,void 0,void 0,function*(){const e=this.drawOrUpdateGraphics(this.record.getConfig());this.highlightGraphics(e.getGraphics()),yield this.record.fly({speedFactor:this.getSpeedFactor()})})}prepare(t){return Ai(this,void 0,void 0,function*(){switch(yield this._setSpeed(null),this.type){case e.Rotate:case e.Path:{const e=this._getLimitationParamForPrepare(this.record,t);return yield this.record.prepare(e)}case e.Route:{const e=yield this.prepareSpecifiedRecord(t,this.flyStateCallbacks);return!(!e.isCanPlay||!e.prepareState)}default:return console.error("error type:",this.type),!1}})}fly(t){return Ai(this,void 0,void 0,function*(){var i;switch(yield this.setSpeedFactor(t.settingSpeed),this.type){case e.Rotate:case e.Path:yield this.record.fly(Object.assign(Object.assign({},t),{speedFactor:this.getSpeedFactor()}));break;case e.Route:if(Me(null===(i=this.playingInfo.currentIds)||void 0===i?void 0:i.ids))return this.flyStateCallbacks.onFly(),void(yield this.playTask());this.flyStateCallbacks.onFly(),!this._isPlayRoute(t.ids)&&t.isPreviewSpecifiedRecord?yield this.playSpecifiedRecord():yield this.playRouteFly({routeUuid:t.ids.routeUuid},0);break;default:console.error("error type:",this.type)}})}pause(){return Ai(this,void 0,void 0,function*(){var t;switch(this.type){case e.Rotate:case e.Path:case e.Route:yield null===(t=this.record)||void 0===t?void 0:t.pause();break;default:console.error("fly-route.pause error type:",this.type)}})}stop(){return Ai(this,arguments,void 0,function*(t={isUpdate:!1}){var i,s;switch(this.type){case e.Rotate:case e.Path:yield null===(i=this.record)||void 0===i?void 0:i.stop(t);break;case e.Route:if(t.isUpdate)return;yield this.pause(),this.interruptDelayWaiting(),this._onAllRecordsFinish(),yield null===(s=this.record)||void 0===s?void 0:s.stop();break;default:console.error("fly-route.stop error type:",this.type)}})}setSpeedFactor(t){return Ai(this,void 0,void 0,function*(){switch(this.type){case e.Rotate:case e.Path:case e.Route:}return yield this._setSpeed(t)})}getSpeedFactor(){return this.speedFactor}_setSpeed(e){return Ai(this,void 0,void 0,function*(){var t;if(null===e){e={speed:.5,tilt:0,altitude:0}.speed}this.speedFactor=e,this.playingInfo.isWaiting?(this.interruptDelayWaiting(),yield this.playTask()):null===(t=this.record)||void 0===t||t.setSpeedFactor(e)})}_computeRouteTaskTimeScale(){let e=1;switch(this.speedFactor){case 0:e=8;break;case.25:e=4;break;case.375:e=2;break;case.5:default:e=1;break;case.59375:e=1/1.5;break;case.625:e=.5;break;case.75:e=1/4;break;case 1:e=1/8}return e}setIsLiveview(t,i){return Ai(this,void 0,void 0,function*(){var s,n;switch(this.type){case e.Rotate:case e.Path:return yield this.record.setIsLiveview(t);case e.Route:if(t){const e=yield this.prepareSpecifiedRecord({ids:i},this.flyStateCallbacks);return!(!e.isCanPlay||!e.prepareState)&&(yield null===(s=this.record)||void 0===s?void 0:s.setIsLiveview(t))}return yield null===(n=this.record)||void 0===n?void 0:n.setIsLiveview(t);default:console.error("error type:",this.type)}})}getLiveViewSettingInfo(){switch(this.type){case e.Rotate:case e.Path:case e.Route:return this.record.getLiveViewSettingInfo();default:console.error("error type:",this.type)}}getDefaultDuration(){switch(this.type){case e.Rotate:case e.Path:case e.Route:return this.record.getDefaultDuration();default:console.error("error type:",this.type)}}setLiveviewSettingInfo(t,i){return Ai(this,void 0,void 0,function*(){var s,n;switch(this.type){case e.Rotate:case e.Path:case e.Route:{yield null===(s=this.record)||void 0===s?void 0:s.setLiveviewSettingInfo(t);(null===(n=null==i?void 0:i.isUpdateLine)||void 0===n||n)&&this.record.setGraphicsInfo(this.drawOrUpdateGraphics(this.record.getConfig()));const e=this.record.getGraphicsInfo();Me(null==i?void 0:i.isNeedHighlight)&&i.isNeedHighlight&&Me(e.getGraphics())&&this.highlightGraphics(e.getGraphics());break}default:console.error("error type:",this.type)}})}_isPlayRoute(e){return Me(e.routeUuid)&&!Me(e.recordUuid)}prepareSpecifiedRecord(e,t){return Ai(this,void 0,void 0,function*(){const i=e.ids;if(this._isPlayRoute(e.ids)){const t=ye(this.itemConfig.routes,e.ids,0);i.recordUuid=null==t?void 0:t.idx}const{isCanPlay:s}=yield this.checkAndSwitchJimuMapBeforePlay(e.ids);if(!s)return console.error("FlyRoute.prepareSpecifiedRecord(): JimuMap is not matched"),{isCanPlay:!1,prepareState:null};this._redrawAllRecordGraphics(e.ids);let n=t;if(!!e.isBuilderSettingFlag&&(n={onFly:()=>{"function"==typeof t.onFly&&t.onFly()},onFinish:()=>{this.highlightGraphics(null),"function"==typeof t.onFinish&&t.onFinish()},onPause:()=>{this.highlightGraphics(null),"function"==typeof t.onPause&&t.onPause()}}),this.record=yield this._getFlyRecordDynamically(e,this.getCurrentSceneView(),n),e.justForHighlight)return this.highlightSpecifiedRecord(),{isCanPlay:!1,prepareState:null};const a=this._getLimitationParamForPrepare(this.record,e);return{isCanPlay:!0,prepareState:yield this.record.prepare(a)}})}playRouteFly(e,t){return Ai(this,void 0,void 0,function*(){const i=ve(this.itemConfig.routes,e),s=i.records.length-t,n=t,a=ye(this.itemConfig.routes,e,t);this.initTask({routeUuid:i.idx,recordUuid:null==a?void 0:a.idx},n,s),yield this.playTask({init:!0})})}initTask(e,t,i){this._resetPlayingInfo(),this.playingInfo.currentIds={ids:e,orderId:t-1},this.playingInfo.maxRecordLen=i,this.playingInfo.isWaiting=!1,this.playingInfo.continueDelay=0;const s=this.getCurrentSceneView(),n=s.on("drag",e=>{this.playingInfo.isWaiting&&"start"===e.action&&(this.interruptDelayWaiting(),this.flyStateCallbacks.onPause())}),a=s.on("mouse-wheel",e=>{this.playingInfo.isWaiting&&(this.interruptDelayWaiting(),this.flyStateCallbacks.onPause())});this.playingInfo.eventHandlers.push(n),this.playingInfo.eventHandlers.push(a),this._nextPlayingInfo()}_nextPlayingInfo(){var e;this.playingInfo.currentIds.orderId++;const t={routeUuid:null===(e=this.playingInfo.currentIds.ids)||void 0===e?void 0:e.routeUuid,recordUuid:null},i=ye(this.itemConfig.routes,t,this.playingInfo.currentIds.orderId);this.playingInfo.currentIds.ids={routeUuid:t.routeUuid,recordUuid:null==i?void 0:i.idx}}playTask(e){return Ai(this,void 0,void 0,function*(){var t;if(this.playingInfo.isWaiting=!1,this.playingInfo.currentIds.orderId>=this.playingInfo.maxRecordLen)return void this._onAllRecordsFinish();const i={onFinish:this._onOneRecordFinish.bind(this,{}),onPause:this._onPause.bind(this,{})},s=ye(this.itemConfig.routes,this.playingInfo.currentIds.ids,this.playingInfo.currentIds.orderId);if((null==e?void 0:e.init)||(null===(t=this.record)||void 0===t?void 0:t.getConfig().idx)!==(null==s?void 0:s.idx)){const e=yield this.prepareSpecifiedRecord({ids:this.playingInfo.currentIds.ids},i);if(!e.isCanPlay)return console.warn("playTask: skip a record"),i.onFinish(),!1;if(!e.prepareState)return i.onPause(),!1}const n=this.record.getConfig().endDelay;Me(n)?this.playingInfo.continueDelay=n*this._computeRouteTaskTimeScale():this.playingInfo.continueDelay=0,yield this.record.fly({speedFactor:this.getSpeedFactor()})})}_onOneRecordFinish(){return Ai(this,void 0,void 0,function*(){if(this._nextPlayingInfo(),Me(this.playingInfo.continueDelay)){this.playingInfo.waitingPromise=this._abortWrapper(this.waitDelay(this.playingInfo.continueDelay));try{yield this.playingInfo.waitingPromise,yield this.playTask()}catch(e){}}else yield this.playTask()})}waitDelay(e){return Ai(this,void 0,void 0,function*(){return this.playingInfo.isWaiting=!0,yield new Promise((t,i)=>{setTimeout(()=>{t({})},1e3*e)})})}interruptDelayWaiting(){var e;Me(null===(e=this.playingInfo.waitingPromise)||void 0===e?void 0:e.abort)&&this.playingInfo.waitingPromise.abort(),this.playingInfo.isWaiting=!1,this.playingInfo.continueDelay=0}_abortWrapper(e){let t;const i=new Promise((e,i)=>t=i),s=Promise.race([e,i]);return s.abort=t,s}_onPause(){var e;null===(e=this.flyStateCallbacks)||void 0===e||e.onPause()}_onAllRecordsFinish(){var e,t;this._resetPlayingInfo(),"function"==typeof(null===(e=this.flyStateCallbacks)||void 0===e?void 0:e.onFinish)&&(null===(t=this.flyStateCallbacks)||void 0===t||t.onFinish())}_resetPlayingInfo(){var e;Me(null===(e=this.playingInfo)||void 0===e?void 0:e.eventHandlers)&&(this.playingInfo.eventHandlers.forEach(e=>{e.remove()}),this.playingInfo.eventHandlers=null,this.playingInfo.eventHandlers=[]),this.playingInfo={currentIds:{ids:null,orderId:0},maxRecordLen:0,waitingPromise:null,isWaiting:!1,continueDelay:0,eventHandlers:[]}}}var Ti=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class Di{constructor(){this.sceneView=null}setup(e){return Ti(this,void 0,void 0,function*(){return yield(0,h.loadArcGISJSAPIModules)(["esri/core/reactiveUtils"]).then(t=>{[this.reactiveUtils]=t,this.sceneView=e.sceneView,this.onTerrainLoaded=e.onTerrainLoaded,this.handleTerrainLoaded()}),this})}handleTerrainLoaded(){return Ti(this,void 0,void 0,function*(){yield Promise.race([this.getTerrainLoadedPromise(),this.getTimerPromise(1e4)]),this.onTerrainLoaded()})}getTerrainLoadedPromise(){return Ti(this,void 0,void 0,function*(){if(!this.sceneView||!this.sceneView.groundView)return!1;try{yield this.reactiveUtils.whenOnce(()=>{var e,t;return null===(t=null===(e=this.sceneView)||void 0===e?void 0:e.groundView)||void 0===t?void 0:t.updating}),yield this.reactiveUtils.whenOnce(()=>{var e,t;return!(null===(t=null===(e=this.sceneView)||void 0===e?void 0:e.groundView)||void 0===t?void 0:t.updating)})}catch(e){return!1}return!0})}getTimerPromise(e){return Ti(this,void 0,void 0,function*(){return yield new Promise(t=>setTimeout(t,e))})}}var Gi=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};class Ni{constructor(t){this.findFirstUsedItem=()=>{for(let e=0,t=this.itemsList.length;e<t;e++){const t=this.itemsList[e];if(t.config.isInUse)return t}return{config:null,routes:null}},this.findFirstRouteItem=()=>{for(const t of this.itemsList)if(t.config.isInUse&&e.Route===t.config.name)return t;return{config:null,routes:null}},this._findItemIdx=e=>this.itemsList.findIndex(t=>t.config.uuid===e),this.getActiveItem=()=>this.activatedItem,this.getActiveItemConfig=()=>{var e;return null===(e=this.activatedItem)||void 0===e?void 0:e.config},this.getFlyStyle=()=>{var e;return null===(e=this.activatedItem)||void 0===e?void 0:e.config.name},this.getRouteByIdx=e=>this.getActiveItem().routes,this.getRouteConfigByIdx=e=>{var t;const i=this.getActiveItemConfig();return null===(t=null==i?void 0:i.routes)||void 0===t?void 0:t.find(t=>t.idx===e.routeUuid)},this.getRecordConfigByIds=e=>fe(this.getActiveItemConfig().routes,e),this.getRecordByIds=e=>{var t;const i=null===(t=this.activatedItem.routes)||void 0===t?void 0:t.record;return e.recordUuid===(null==i?void 0:i.getConfig().idx)?i:null},this.isUesRouteFlyMode=()=>{const t=this.getActiveItemConfig();return(null==t?void 0:t.name)===e.Route},this.clear=()=>{},this.checkAndSwitchJimuMapBeforePlay=e=>Gi(this,void 0,void 0,function*(){const t=this.getRecordConfigByIds(e);if(!Me(t))return{isCanPlay:!1,hadSwitchedMap:!1};const i=this.isJimuMapViewInGroup(t.mapViewId),s=this.isCurrentJimuMap(t);return s?{isCanPlay:!0,hadSwitchedMap:!1}:i?s?{isCanPlay:!0,hadSwitchedMap:!1}:(this.onBeforeSwitchMap(),yield this.viewGroup.switchMap(),{isCanPlay:!0,hadSwitchedMap:!0}):(console.error("FlyManager.checkAndSwitchJimuMapBeforePlay: this RecordConfig can't fly in this JimuMap"),{isCanPlay:!1,hadSwitchedMap:!1})}),this.isRecordCanPlay=e=>{const t=this.isJimuMapViewInGroup(e.mapViewId),i=this.isCurrentJimuMap(e);return!!i||(!!t||(console.error("FlyManager.isRecordCanPlay: this RecordConfig can't fly in this JimuMap"),!1))},this.isJimuMapViewInGroup=e=>{var t;let i=null!=e?e:this.jimuMapView.id;i=Ie(i);return!!Me(Object.keys(null===(t=this.viewGroup)||void 0===t?void 0:t.jimuMapViews).find(e=>Ie(e)===i))},this.isCurrentJimuMap=e=>{var t;return e.mapViewId===Ie(null===(t=this.jimuMapView)||void 0===t?void 0:t.id)},this.getCurrentSceneView=()=>this.sceneView,this.isAroundMapCenterFlyMode=()=>{const t=this.getActiveItemConfig();return(null==t?void 0:t.name)===e.Rotate&&t.targetMode===i.MapCenter},this.stop(),this.onTerrainLoaded=t.onTerrainLoaded,this.onBeforeSwitchMap=t.onBeforeSwitchMap,this.drawOrUpdateGraphics=t.drawOrUpdateGraphics,this.highlightGraphics=t.highlightGraphics,this.onItemsUpdate=t.onItemsUpdate,this.isBuilderSettingFlag=t.isBuilderSettingFlag,this.updateViewGroup(t.viewGroup),this.updateJimuMapView(t.jimuMapView),this.uiLoadingCallbacks=t.uiLoadingCallbacks,this.flyStateCallbacks=t.flyStateCallbacks,this.updateItems(t.widgetConfig)}updateViewGroup(e){this.viewGroup=e}updateJimuMapView(e){var t;this.jimuMapView=e,this.sceneView=null===(t=this.jimuMapView)||void 0===t?void 0:t.view;const i=this.getActiveItem();Me(null==i?void 0:i.routes)&&(null==i||i.routes.handleUpdateJimuMapView(e)),this.getTerrainLoadingHelper(this.sceneView,this.onTerrainLoaded)}updateItems(e){this.itemsList=[];const t=e.itemsList.asMutable({deep:!0});for(const e of t)e.isInUse&&this.itemsList.push({config:e,routes:null});"function"==typeof this.onItemsUpdate&&this.onItemsUpdate(this.itemsList)}destructor(){this.stop()}findItemByUuid(e){var t;let i=null;return i=null===(t=this.itemsList)||void 0===t?void 0:t.find(t=>t.config.uuid===e),i}registerItem(e){const t=this.findItemByUuid(e);this.activatedItem=t}unRegisterItem(){var e;(null===(e=this.activatedItem)||void 0===e?void 0:e.routes)&&this.activatedItem.routes.destructor(),this.activatedItem=null}getControllerTypeByItemData(t){let i;return t.name===e.Rotate?i=We.Rotate:t.name===e.Path&&(i=t.style),i}getDefaultSpeedByType(i,s){var n;let a=.5;switch(null!==(n=i.defaultSpeed)&&void 0!==n?n:null){case t.SLOW:a=.25;break;case t.DEFAULT:a=.375;break;case t.FAST:s===e.Rotate?a=.5:s===e.Path&&(a=.625);break;default:a=.5}return a}buildTemporaryRecordConfig(t,i,s){const n=this.getActiveItemConfig(),a=this.getFlyStyle();let r;a===e.Rotate?r=this.isAroundMapCenterFlyMode()?We.AroundMapCenter:We.Rotate:a===e.Path&&(r=this.getControllerTypeByItemData(n));return{idx:null,type:r,defaultSpeed:this.getDefaultSpeedByType(n,a),displayName:"runtime",duration:null,startDelay:null,endDelay:null,angle:null,controllerConfig:{cameraInfo:i,liveviewSettingState:null},direction:n.direction,storedGraphicsInfo:{type:Ri.RawData,rawData:null==t?void 0:t.getConfig()},mapViewId:s.id}}buildTemporaryRecord(e,t,i,s){return Gi(this,void 0,void 0,function*(){const n=yield(new ji).setup(e,t,i);return Me(s)&&n.setGraphicsInfo(s),n})}prepareRoutePreview(e,t){return Gi(this,void 0,void 0,function*(){if(!this.isUesRouteFlyMode())return!1;const i=this.getActiveItem();return yield this.setupFly(i.config,null,null!=t?t:this.flyStateCallbacks),yield this.prepare({ids:{routeUuid:e.routeUuid},waitingForTerrain:!1})})}previewSpecifiedRoute(e,t,i){return Gi(this,void 0,void 0,function*(){if(!this.isUesRouteFlyMode())return;const s=this.getActiveItem(),n=null!=i?i:this.flyStateCallbacks;Me(s.routes)||(yield this.prepareRoutePreview(t,n)),yield this.fly({ids:t,settingSpeed:e,isPreviewSpecifiedRecord:!1},n)})}previewSpecifiedRecord(e,t){return Gi(this,void 0,void 0,function*(){if(!this.isUesRouteFlyMode())return;const{isCanPlay:i}=yield this.checkAndSwitchJimuMapBeforePlay(e);if(!i)return;const s=this.getActiveItem();yield this.setupFly(s.config,null,t);(yield this.prepare({ids:e,isBuilderSettingFlag:this.isBuilderSettingFlag}))&&(yield this.fly({ids:e,settingSpeed:null,isPreviewSpecifiedRecord:!0}))})}highlightSpecifiedRecord(e,t){return Gi(this,void 0,void 0,function*(){if(this.highlightGraphics(null),null===e)return;const i=this.getActiveItem();yield this.setupFly(i.config,null,t),yield this.prepare({ids:e,isBuilderSettingFlag:this.isBuilderSettingFlag,justForHighlight:!0})})}setIsLiveViewSpecifiedRecord(e,t){return Gi(this,void 0,void 0,function*(){if(!this.isUesRouteFlyMode())return;const i=this.getActiveItem();if(Me(i.routes)||(yield this.setupFly(i.config,null),yield this.prepare({ids:e,animate:!1})),yield this.setIsLiveview(t,e),t){const e=this.getLiveViewSettingInfo();this.onLiveViewParamChange(e,{isNeedHighlight:!0})}})}loadingForUI(e){const t=null!=e?e:this.uiLoadingCallbacks;"function"==typeof t.onLoading&&t.onLoading()}loadedForUI(e){const t=null!=e?e:this.uiLoadingCallbacks;"function"==typeof t.onLoaded&&t.onLoaded()}setupFly(e,t,i,s){return Gi(this,void 0,void 0,function*(){const n=this.getActiveItem();n.routes&&n.routes.destructor();const a=null!=i?i:this.flyStateCallbacks;return n.routes=(new Li).setup({itemConfig:e,recordConfig:t},this.jimuMapView,{flyCallbacks:a,drawOrUpdateGraphics:this.drawOrUpdateGraphics,highlightGraphics:this.highlightGraphics,checkAndSwitchJimuMapBeforePlay:this.checkAndSwitchJimuMapBeforePlay,getCurrentSceneView:this.getCurrentSceneView},s),yield new Promise(e=>{e(n)})})}prepare(e){return Gi(this,void 0,void 0,function*(){var t;const i=this.getActiveItem();return Me(i)?yield null===(t=i.routes)||void 0===t?void 0:t.prepare(e):null})}fly(e,t){return Gi(this,void 0,void 0,function*(){var i,s;const n=this.getActiveItem();if(!Me(n))return null;t&&(null===(i=n.routes)||void 0===i||i.handleUpdateFlyCallbacks(t)),yield null===(s=n.routes)||void 0===s?void 0:s.fly(e)})}pause(){return Gi(this,void 0,void 0,function*(){var e;const t=this.getActiveItem();if(!Me(t))return null;yield null===(e=t.routes)||void 0===e?void 0:e.pause()})}stop(){return Gi(this,arguments,void 0,function*(e={isUpdate:!1}){var t;const i=this.getActiveItem();if(!Me(i))return null;yield null===(t=i.routes)||void 0===t?void 0:t.stop(e)})}getProgress(){}getLiveViewSettingInfo(){const e=this.getActiveItem();if(!Me(e))return null;return e.routes.getLiveViewSettingInfo()}getDefaultDuration(){var e;const t=this.getActiveItem();return Me(t)?null===(e=t.routes)||void 0===e?void 0:e.getDefaultDuration():null}setIsLiveview(e,t){return Gi(this,void 0,void 0,function*(){var i;const s=this.getActiveItem();return Me(s)?yield null===(i=s.routes)||void 0===i?void 0:i.setIsLiveview(e,t):null})}onLiveViewParamChange(e,t){return Gi(this,void 0,void 0,function*(){var i;const s=this.getActiveItem();if(!Me(s))return null;yield null===(i=s.routes)||void 0===i?void 0:i.setLiveviewSettingInfo(e,t)})}setSpeedFactor(e){return Gi(this,void 0,void 0,function*(){var t;const i=this.getActiveItem();if(!Me(i))return null;yield null===(t=i.routes)||void 0===t?void 0:t.setSpeedFactor(e)})}getTerrainLoadingHelper(e,t){return Gi(this,void 0,void 0,function*(){this.terrainLoadingHelper=yield(new Di).setup({sceneView:e,onTerrainLoaded:t})})}}var Fi,Vi,ki=function(e,t,i,s){return new(i||(i=Promise))(function(n,a){function r(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,o)}l((s=s.apply(e,t||[])).next())})};!function(e){e.Common="flyStyle-list",e.RouteDetails="route-details",e.RecordLoading="record-loading",e.RecordDetails="record-details"}(Fi||(Fi={})),function(e){e.Empty="Empty",e.Point="Point",e.Path="Path",e.Pick="Pick"}(Vi||(Vi={}));class Oi extends l.React.PureComponent{constructor(t){super(t),this.handleMapWidgetChange=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})},this.handleActiveViewChange=e=>{var t;Me(e)&&"2d"!==e.view.type?(null===(t=this.state.jimuMapView)||void 0===t?void 0:t.id)!==e.id&&this.setState({jimuMapView:e}):this.setState({jimuMapView:null})},this.handleFlyPlay=()=>{},this.handleFlyPause=()=>{this.setState({isPreviewRouteBtnPlaying:!1})},this.handleFlyFinish=()=>{this.setState({isPreviewRouteBtnPlaying:!1})},this.handleFlyModesChange=(t,i)=>{const s=this.props.config.itemsList.asMutable({deep:!0}),n=(0,l.Immutable)(s[i]);let a;(n.name===e.Rotate||n.name===e.Path||n.name===e.Route)&&(a=n.set("isInUse",t),s.splice(i,1,a.asMutable({deep:!0}))),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleControllerLayoutChanged=e=>{const t=e;this.props.offPanel||(0,d.getAppConfigAction)().editWidgetProperty(this.props.id,"offPanel",!0).exec(),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("layout",t)})},this.handleRotateRadioChange=(t,i)=>{const s=this.props.config.itemsList.asMutable({deep:!0}),n=(0,l.Immutable)(s[i]);if(n.name===e.Rotate){const e=n.set("direction",t);s.splice(i,1,e.asMutable({deep:!0})),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})}},this.handleEnableAroundMapCenter=(t,i)=>{const s=this.props.config.itemsList.asMutable({deep:!0}),n=(0,l.Immutable)(s[i]);if(n.name===e.Rotate){const e=n.set("targetMode",t);s.splice(i,1,e.asMutable({deep:!0})),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})}},this.handleAroundMapCenterPauseTimeChange=(t,i)=>{const s=this.props.config.itemsList.asMutable({deep:!0}),n=(0,l.Immutable)(s[i]);if(n.name===e.Rotate){const e=n.set("rotationPauseTime",t);s.splice(i,1,e.asMutable({deep:!0})),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})}},this.handleDefaultSpeedChange=(t,i)=>{const s=this.props.config.itemsList.asMutable({deep:!0}),n=(0,l.Immutable)(s[i]);if(n.name===e.Rotate||n.name===e.Path){const e=n.set("defaultSpeed",t);s.splice(i,1,e.asMutable({deep:!0})),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})}},this.handlePathRadioChange=(t,i)=>{const s=this.props.config.itemsList.asMutable({deep:!0}),n=(0,l.Immutable)(s[i]);if(n.name===e.Path){const e=n.set("style",t);s.splice(i,1,e.asMutable({deep:!0})),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})}},this.renderRotateSetting=(t,i)=>{const n=t.direction===s.CW,a=t.defaultSpeed,r=ti(this.props.config.itemsList,i,this.state.flyModesUICollapseMap.getIn([String(i)])),h=this.props.intl.formatMessage({id:"styleLabelRotate",defaultMessage:m.styleLabelRotate}),d=this.props.intl.formatMessage({id:"CW",defaultMessage:m.CW}),c=this.props.intl.formatMessage({id:"CCW",defaultMessage:m.CCW});return(0,o.jsx)(l.React.Fragment,{children:(0,o.jsxs)(u.SettingSection,{className:"d-2 item-detail-wrapper "+r,children:[(0,o.jsx)(O,{styleConfig:t,idx:i,onEnableAroundMapCenter:this.handleEnableAroundMapCenter,onPauseTimeChange:this.handleAroundMapCenterPauseTimeChange}),(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"fly-style-label",children:h})}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:n,id:"CW",style:{cursor:"pointer"},onChange:e=>{this.handleRotateRadioChange(s.CW,i)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"CW",className:"ml-1 text-break",children:d})]}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:!n,id:"CCW",style:{cursor:"pointer"},onChange:e=>{this.handleRotateRadioChange(s.CCW,i)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"CCW",className:"ml-1 text-break",children:c})]}),(0,o.jsx)(Xt,{mode:e.Rotate,speed:a,onChange:e=>{this.handleDefaultSpeedChange(e,i)}})]})})},this.renderPathSetting=(t,i)=>{const s=t.style===n.Smoothed,a=t.defaultSpeed,r=ti(this.props.config.itemsList,i,this.state.flyModesUICollapseMap.getIn([String(i)])),l=this.props.intl.formatMessage({id:"styleLabelPath",defaultMessage:m.styleLabelPath}),h=this.props.intl.formatMessage({id:"pathTypeSmoothedCurve",defaultMessage:m.pathTypeSmoothedCurve}),d=this.props.intl.formatMessage({id:"pathTypeRealPath",defaultMessage:m.pathTypeRealPath});return(0,o.jsxs)(u.SettingSection,{className:"d-2 item-detail-wrapper "+r,children:[(0,o.jsx)(u.SettingRow,{children:(0,o.jsx)(g.Label,{className:"fly-style-label text-truncate",children:l})}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:s,id:"CURVED",style:{cursor:"pointer"},onChange:e=>{this.handlePathRadioChange(n.Smoothed,i)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"CURVED",className:"ml-1 text-break",children:h})]}),(0,o.jsxs)(u.SettingRow,{className:"mt-2 radio-wrapper",children:[(0,o.jsx)(g.Radio,{checked:!s,id:"LINE",style:{cursor:"pointer"},onChange:e=>{this.handlePathRadioChange(n.RealPath,i)}}),(0,o.jsx)(g.Label,{style:{cursor:"pointer"},for:"LINE",className:"ml-1 text-break",children:d})]}),(0,o.jsx)(Xt,{mode:e.Path,speed:a,onChange:e=>{this.handleDefaultSpeedChange(e,i)}})]})},this.handleRefGraphicInteractionManager=e=>{this.graphicInteractionManagerRef=e,this.setState({isDrawHelperLoaded:!0}),null===e&&this.setState({isDrawHelperLoaded:!1})},this.handleToggleFlyModesUICollapse=(e,t)=>{this.setState({flyModesUICollapseMap:this.state.flyModesUICollapseMap.setIn([String(e)],t)})},this.handleSettingPageModeChange=e=>ki(this,void 0,void 0,function*(){var t;yield this.stopFly(),this.setState({pageMode:e}),this.setState({playingInfo:null}),e===Fi.Common?(this.setState({activedRouteUuid:null,activedRecordUuid:null}),this.handleShowMapPopperChange(!1)):this.handleShowMapPopperChange(!0),e!==Fi.RouteDetails&&e!==Fi.RecordLoading&&this.setState({newestRecordIdx:null,playingInfo:null}),e===Fi.RouteDetails&&(null===(t=this.graphicInteractionManagerRef)||void 0===t||t.highlight(null))}),this.handleShowMapPopperChange=(e,t)=>ki(this,void 0,void 0,function*(){this.setState({isShowMapPopper:e}),e||(this.setState({isTerrainLoaded:!1}),Me(t)&&(yield this.handleSettingPageModeChange(t)))}),this.handleMapPopperJimuMapViewUpdate=e=>{this.setState({isTerrainLoaded:!1}),this.setState({mapPopperJimuMapView:e},()=>{var e;const{isTriggeredByFly:t,isTriggeredByMapSelf:i}=(s=this.props.widgetId,n=this.props.autoControlWidgetId,a=Ce(this.props.useMapWidgetIds[0]),{isTriggeredByFly:n===s,isTriggeredByMapSelf:n===a});var s,n,a;!t&&i&&(null===(e=this.flyManager)||void 0===e||e.stop()),Me(this.flyManager)?(this.flyManager.stop({isUpdate:!0}),this.flyManager.updateJimuMapView(this.state.mapPopperJimuMapView)):this.initFlyManager()})},this.handleAutoControlMapPublish=()=>{(0,l.getAppStore)().dispatch(l.appActions.requestAutoControlMapWidget(Ce(this.props.useMapWidgetIds[0]),this.props.widgetId))},this.handleMapPopperViewGroupUpdate=e=>{this.setState({viewGroup:e},()=>{Me(this.flyManager)?(this.flyManager.stop({isUpdate:!0}),this.flyManager.updateViewGroup(this.state.viewGroup)):this.initFlyManager()})},this.getSpecifiedJimuMapId=()=>Ce(this.props.useMapWidgetIds[0]),this.handleFlyManagerItemsUpdate=e=>{this.setState({flyManagerItems:e})},this.onTerrainLoaded=()=>{this.setState({isTerrainLoaded:!0})},this.handleRoutesOrderUpdate=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.props.config.itemsList.asMutable({deep:!0}),s=i[t],n=[];e.forEach(e=>{const t=e.itemKey,i=s.routes.find(e=>e.idx===t);n.push(i)}),s.routes=n,i.splice(t,1,s),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)})},this.handleRouteConfigPush=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.props.config.itemsList.asMutable({deep:!0}),s=i[t];s.routes.push(e),i.splice(t,1,s),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)})},this.handleRouteConfigDelete=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.props.config.itemsList.asMutable({deep:!0}),s=i[t],n=s.routes.findIndex(t=>t.idx===e);n>-1&&(s.routes.splice(n,1),i.splice(t,1,s),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",i)}))},this.handleRouteDisplayNameChange=(e,t)=>{const i=this.state.activedRecordFlyStyleIdx,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[i],a=n.routes.findIndex(t=>t.idx===e);n.routes[a].displayName=t,s.splice(i,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleRouteToggleVisibilityChange=(e,t)=>{const i=this.state.activedRecordFlyStyleIdx,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[i],a=n.routes.findIndex(t=>t.idx===e.routeUuid);n.routes[a].isInUse=t,s.splice(i,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleRecordsOrderUpdate=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.state.activedRouteUuid,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[t],a=n.routes.find(e=>e.idx===i),r=a.records,o=[];e.forEach(e=>{const t=e.itemKey,i=r.find(e=>e.idx===t);i.storedGraphicsInfo.rawData.graphics.forEach(e=>{e.symbol=null}),o.push(i)}),a.records=o,s.splice(t,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleRecordConfigPush=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.state.activedRouteUuid,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[t];n.routes.find(e=>e.idx===i).records.push(e),s.splice(t,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)})},this.handleRecordConfigDelete=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.state.activedRouteUuid,s=this.props.config.itemsList.asMutable({deep:!0}),n=s[t],a=n.routes.find(e=>e.idx===i).records,r=a.findIndex(t=>t.idx===e);r>-1&&(a.splice(r,1),s.splice(t,1,n),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",s)}))},this.handleRecordConfigUpdate=e=>{const t=this.state.activedRecordFlyStyleIdx,i=this.state.activedRouteUuid,s=e.idx,n=this.props.config.itemsList.asMutable({deep:!0}),a=n[t],r=a.routes.find(e=>e.idx===i).records,o=r.findIndex(e=>e.idx===s);o>-1&&(r.splice(o,1,e),n.splice(t,1,a),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("itemsList",n)}))},this.handleRecordModeSelected=e=>{this.setState({activedRecordFlyStyleIdx:e})},this.handleRouteAdd=e=>{this.handleRouteConfigPush(e),setTimeout(()=>{this.handleRouteEdit({routeUuid:e.idx})},100)},this.handleRouteDelete=e=>{this.handleRouteConfigDelete(e.routeUuid)},this.handleRouteEdit=e=>{this.setState({activedRouteUuid:e.routeUuid}),this.handleSettingPageModeChange(Fi.RouteDetails)},this.getCurrentRouteName=()=>{const e=this.flyManager.getRouteConfigByIdx({routeUuid:this.state.activedRouteUuid});return null==e?void 0:e.displayName},this.renderRoutesList=(e,t)=>{const{theme:i,intl:s}=this.props,n=ti(this.props.config.itemsList,t,this.state.flyModesUICollapseMap.getIn([String(t)]));return(0,o.jsx)(u.SettingSection,{className:"d-2 item-detail-wrapper "+n,children:(0,o.jsx)(Ve,{useMapWidgetIds:this.props.useMapWidgetIds,jimuMapView:this.state.jimuMapView,theme:i,intl:s,flyModeIdx:t,routeConfig:e,onRouteEdit:this.handleRouteEdit,onRouteAdd:this.handleRouteAdd,onRouteDelete:this.handleRouteDelete,onRouteToggleVisibilityChange:this.handleRouteToggleVisibilityChange,onRoutesOrderUpdate:this.handleRoutesOrderUpdate})})},this.stopFly=()=>ki(this,void 0,void 0,function*(){var e;yield null===(e=this.flyManager)||void 0===e?void 0:e.stop()}),this.handleRecordAdd=e=>ki(this,void 0,void 0,function*(){yield this.stopFly(),this.handleRecordConfigPush(e),this._handleRecordAddNotify(e.idx)}),this._handleRecordAddNotify=e=>{this.setState({newestRecordIdx:e})},this.handleRecordAddAndEdit=e=>ki(this,void 0,void 0,function*(){return yield this.stopFly(),this.handleRecordConfigPush(e),yield new Promise((t,i)=>{setTimeout(()=>{this.handleRecordEdit({routeUuid:this.state.activedRouteUuid,recordUuid:e.idx}),t(null)},100)}),!0}),this.handleRouteNameChange=(e,t)=>{this.handleRouteDisplayNameChange(e.routeUuid,t)},this.handleRecordEdit=(e,t)=>ki(this,void 0,void 0,function*(){if(yield this.stopFly(),this.setState({activedRecordUuid:e.recordUuid}),t)return;const i=null!==e.recordUuid;this.setState({delayUpdateFlyManagerFlag:i,activedRecordUuid:e.recordUuid},()=>{this.handleSettingPageModeChange(Fi.RecordLoading),this._asyncRecordEdit(i,e)})}),this._asyncRecordEdit=(e,t)=>ki(this,void 0,void 0,function*(){yield this.flyManager.setIsLiveViewSpecifiedRecord({routeUuid:this.state.activedRouteUuid,recordUuid:this.state.activedRecordUuid},e),e?this.handleSettingPageModeChange(Fi.RecordDetails):(this.initFlyManager(),this.handleSettingPageModeChange(Fi.RouteDetails))}),this._getCurrentLiveViewSetting=()=>this.flyManager.getLiveViewSettingInfo(),this.getDefaultDuration=()=>this.flyManager.getDefaultDuration(),this.handleRecordPreview=e=>ki(this,void 0,void 0,function*(){this.setState({playingInfo:e}),yield this.stopFly();const t={onFly:()=>{this.handleFlyPlay(),this.setState({playingInfo:e})},onPause:()=>ki(this,void 0,void 0,function*(){this.handleFlyPause(),yield this.handlePauseRecordPreview(null,!0)}),onFinish:()=>ki(this,void 0,void 0,function*(){this.handleFlyFinish(),yield this.handleFinishRecordPreview()})};yield this.flyManager.previewSpecifiedRecord({routeUuid:this.state.activedRouteUuid,recordUuid:e.recordUuid},t)}),this.handlePauseRecordPreview=(e,t)=>ki(this,void 0,void 0,function*(){t||(yield this.stopFly()),this.setState({playingInfo:null})}),this.handleFinishRecordPreview=()=>ki(this,void 0,void 0,function*(){return new Promise(e=>{this.setState({playingInfo:null},()=>{e(null)})})}),this.handleRecordDelete=e=>ki(this,void 0,void 0,function*(){yield this.stopFly(),this.handleRecordConfigDelete(e.recordUuid),this.setState({playingInfo:null})}),this.handlePreviewRoute=(e,t,i)=>ki(this,void 0,void 0,function*(){const s=this.state.playingInfo;s&&null===s.routeUuid&&null!==s.recordUuid&&(yield this.stopFly());const n={routeUuid:t.routeUuid};i&&(yield this.flyManager.prepareRoutePreview(n)),this.setState({isPreviewRouteBtnPlaying:!0}),this.setState({playingInfo:t}),yield this.flyManager.previewSpecifiedRoute(e,n)}),this.handlePauseRoutePreview=()=>{var e;null===(e=this.flyManager)||void 0===e||e.pause(),this.setState({isPreviewRouteBtnPlaying:!1})},this.handleNewFeatureModeChange=e=>ki(this,void 0,void 0,function*(){yield this.stopFly(),this.state.newFeatureMode!==e&&this.setState({newFeatureMode:e})}),this.handleRecordHighlight=e=>{var t,i;let s=null==e?void 0:e.recordUuid;const n=this.state.highlightL2RecordId===(null==e?void 0:e.recordUuid);if(n&&(s=null),this.setState({highlightL2RecordId:s}),n)null===(t=this.flyManager)||void 0===t||t.highlightSpecifiedRecord(null,null);else{const t={onPause:()=>{this.setState({highlightL2RecordId:null})}};null===(i=this.flyManager)||void 0===i||i.highlightSpecifiedRecord(e,t)}},this.renderRouteDetailPage=()=>{var e;let t;const{theme:i,intl:s}=this.props,{newFeatureMode:n}=this.state,a=this.flyManager.getRouteConfigByIdx({routeUuid:this.state.activedRouteUuid});return t=Me(this.state.mapPopperJimuMapView)?Me(a)&&(0,o.jsx)(Pt,{routeConfig:a,mapPopperJimuMapView:this.state.mapPopperJimuMapView,isTerrainLoaded:this.state.isTerrainLoaded,theme:i,intl:s,onShowMapPopperChange:this.handleShowMapPopperChange,onSettingPageModeChange:this.handleSettingPageModeChange,onRouteNameChange:this.handleRouteNameChange,onRouteDelete:this.handleRouteDelete,onRouteEdit:this.handleRouteEdit,newFeatureMode:n,onNewFeatureModeChange:this.handleNewFeatureModeChange,isPreviewRouteBtnPlaying:this.state.isPreviewRouteBtnPlaying,onPreviewRoute:this.handlePreviewRoute,onPauseRoutePreview:this.handlePauseRoutePreview,newestRecordIdx:this.state.newestRecordIdx,playingInfo:this.state.playingInfo,onRecordEdit:this.handleRecordEdit,onRecordPreview:this.handleRecordPreview,onPauseRecordPreview:this.handlePauseRecordPreview,onRecordDelete:this.handleRecordDelete,onRecordsOrderUpdate:this.handleRecordsOrderUpdate,highlightL2RecordId:this.state.highlightL2RecordId,onRecordHighlight:this.handleRecordHighlight,isRecordCanPlay:null===(e=this.flyManager)||void 0===e?void 0:e.isRecordCanPlay,isDrawHelperLoaded:this.state.isDrawHelperLoaded}):(0,o.jsx)(g.Loading,{type:g.LoadingType.Secondary}),t},this.buildTemporaryRecordConfig=(e,t,i)=>this.flyManager.buildTemporaryRecordConfig(e,t,i),this.buildDefaultRecord=(e,t)=>ki(this,void 0,void 0,function*(){return yield this.flyManager.buildTemporaryRecord(e,this.state.jimuMapView.view,null,t)}),this.getPopperJimuMapId=()=>Ie(this.state.mapPopperJimuMapView.id),this.handleRecordChange=e=>{this.handleRecordConfigUpdate(e)},this.handleLiveViewSettingChange=e=>{this.flyManager.onLiveViewParamChange(e,{isNeedHighlight:!0})},this.renderRecordLoadingPage=()=>(0,o.jsx)(g.Loading,{type:g.LoadingType.Secondary}),this.renderRecordDetailPage=()=>{const{theme:e,intl:t}=this.props,i=this.flyManager.getRecordByIds({routeUuid:this.state.activedRouteUuid,recordUuid:this.state.activedRecordUuid});return Me(i)&&(0,o.jsx)(bt,{record:i,mapPopperJimuMapView:this.state.mapPopperJimuMapView,theme:e,intl:t,onRecordEdit:this.handleRecordEdit,onRecordChange:this.handleRecordChange,getCurrentLiveViewSetting:this._getCurrentLiveViewSetting,onLiveViewSettingChange:this.handleLiveViewSettingChange,getDefaultDuration:this.getDefaultDuration})},this.handleDrawOrUpdateGraphics=e=>{var t;if("function"==typeof(null===(t=this.graphicInteractionManagerRef)||void 0===t?void 0:t.drawOrUpdateGraphics))return this.graphicInteractionManagerRef.drawOrUpdateGraphics(e)},this.handleRemoveGraphics=e=>{var t;null===(t=this.graphicInteractionManagerRef)||void 0===t||t.removeGraphics(e)},this.handleHighlightGraphics=e=>{var t;"function"==typeof(null===(t=this.graphicInteractionManagerRef)||void 0===t?void 0:t.highlight)&&this.graphicInteractionManagerRef.highlight(e)},this.state={jimuMapView:null,viewGroup:null,pageMode:Fi.Common,isShowMapPopper:!1,mapPopperJimuMapView:null,flyManagerItems:null,isTerrainLoaded:!1,activedRecordFlyStyleIdx:null,activedRouteUuid:null,activedRecordUuid:null,isPreviewRouteBtnPlaying:!1,playingInfo:null,newestRecordIdx:null,delayUpdateFlyManagerFlag:!1,isDrawHelperLoaded:!1,newFeatureMode:Vi.Empty,flyModesUICollapseMap:this._initFlyModesUICollapseState(),highlightL2RecordId:null}}_initFlyModesUICollapseState(){const e={};return this.props.config.itemsList.asMutable({deep:!0}).forEach((t,i)=>{t.isInUse?e[String(i)]=!1:e[String(i)]=!0}),(0,l.Immutable)(e)}componentDidMount(){this.handleRecordModeSelected(2),this.initFlyManager()}componentDidUpdate(e,t){this.props.config!==e.config&&this.initFlyManager(),this.props.settingPanelChange!==e.settingPanelChange&&(this.handleRouteEdit({routeUuid:null}),this.handleRecordEdit({routeUuid:null,recordUuid:null},!0),this.handleSettingPageModeChange(Fi.Common),this.initFlyManager())}render(){var t,i;const s=this.props.config.itemsList.asMutable({deep:!0}),n=this.props.intl.formatMessage({id:"selectMap",defaultMessage:m.selectMap}),a=this.props.intl.formatMessage({id:"selectStyle",defaultMessage:m.selectStyle}),{theme:r,useDataSources:d,useMapWidgetIds:c,config:p,intl:g}=this.props,{jimuMapView:v,isShowMapPopper:f,newFeatureMode:y}=this.state,w=null===(t=this.flyManager)||void 0===t?void 0:t.getRouteConfigByIdx({routeUuid:this.state.activedRouteUuid});return(0,o.jsx)("div",{className:" h-100",css:ei(this.props.theme),children:(0,o.jsxs)("div",{className:"widget-setting-fly-controller h-100",children:[Fi.Common===this.state.pageMode&&(0,o.jsxs)(l.React.Fragment,{children:[(0,o.jsxs)(u.SettingSection,{className:"map-selector-section",children:[(0,o.jsx)(u.SettingRow,{label:n,flow:"wrap",className:"text-break",children:(0,o.jsx)(u.MapWidgetSelector,{"aria-label":n,onSelect:this.handleMapWidgetChange,useMapWidgetIds:this.props.useMapWidgetIds})}),(0,o.jsx)("div",{className:"fly-map",children:(0,o.jsx)("div",{children:(0,o.jsx)(h.JimuMapViewComponent,{useMapWidgetId:null===(i=this.props.useMapWidgetIds)||void 0===i?void 0:i[0],onActiveViewChange:this.handleActiveViewChange})})})]}),(0,o.jsx)(U,{widgetId:this.props.id,layout:this.props.config.layout,onChange:this.handleControllerLayoutChanged}),(0,o.jsx)(u.SettingSection,{title:a,children:s.map((t,i)=>{const s=t.name;return e.Rotate===s?(0,o.jsxs)("div",{children:[(0,o.jsx)(k,{idx:i,styleConfig:t,handleFlyModesChange:this.handleFlyModesChange,flyModesUICollapseMap:this.state.flyModesUICollapseMap,handleToggleFlyModesUICollapse:this.handleToggleFlyModesUICollapse}),this.renderRotateSetting(t,i)]},i):e.Path===s?(0,o.jsxs)("div",{children:[(0,o.jsx)(k,{idx:i,styleConfig:t,handleFlyModesChange:this.handleFlyModesChange,flyModesUICollapseMap:this.state.flyModesUICollapseMap,handleToggleFlyModesUICollapse:this.handleToggleFlyModesUICollapse}),this.renderPathSetting(t,i)]},i):e.Route===s?(0,o.jsxs)("div",{children:[(0,o.jsx)(k,{idx:i,styleConfig:t,handleFlyModesChange:this.handleFlyModesChange,flyModesUICollapseMap:this.state.flyModesUICollapseMap,handleToggleFlyModesUICollapse:this.handleToggleFlyModesUICollapse}),this.renderRoutesList(t,i)]},i):null})})]}),Fi.RouteDetails===this.state.pageMode&&this.renderRouteDetailPage(),Fi.RecordLoading===this.state.pageMode&&this.renderRecordLoadingPage(),Fi.RecordDetails===this.state.pageMode&&this.renderRecordDetailPage(),this.state.isShowMapPopper&&w&&(0,o.jsx)(Qt,{specifiedJimuMapId:this.getSpecifiedJimuMapId(),theme:r,intl:g,config:p,isShowMapPopper:f,useDataSources:d,useMapWidgetIds:c,jimuMapView:v,isTerrainLoaded:this.state.isTerrainLoaded,onRefGraphicInteractionManager:this.handleRefGraphicInteractionManager,activedRouteConfig:w,pageMode:this.state.pageMode,onShowMapPopperChange:this.handleShowMapPopperChange,newFeatureMode:y,onNewFeatureModeChange:this.handleNewFeatureModeChange,onMapPopperJimuMapViewUpdate:this.handleMapPopperJimuMapViewUpdate,onMapPopperViewGroupUpdate:this.handleMapPopperViewGroupUpdate,onRecordAdd:this.handleRecordAdd,onRecordAddAndEdit:this.handleRecordAddAndEdit,buildTemporaryRecordConfig:this.buildTemporaryRecordConfig,buildDefaultRecord:this.buildDefaultRecord,getPopperJimuMapId:this.getPopperJimuMapId,playingInfo:this.state.playingInfo,isPreviewRouteBtnPlaying:this.state.isPreviewRouteBtnPlaying,onRemoveGraphics:this.handleRemoveGraphics,stopFly:this.stopFly})]})})}initFlyManager(){var e;if(this.state.delayUpdateFlyManagerFlag)return;this.flyManager=new Ni({widgetConfig:this.props.config,isBuilderSettingFlag:!0,jimuMapView:this.state.mapPopperJimuMapView,viewGroup:this.state.viewGroup,flyStateCallbacks:{onFly:this.handleFlyPlay,onPause:this.handleFlyPause,onFinish:this.handleFlyFinish},drawOrUpdateGraphics:this.handleDrawOrUpdateGraphics,highlightGraphics:this.handleHighlightGraphics,onItemsUpdate:this.handleFlyManagerItemsUpdate,onBeforeSwitchMap:this.handleAutoControlMapPublish,onTerrainLoaded:this.onTerrainLoaded}),this.flyManager.unRegisterItem();const t=this.flyManager.findFirstRouteItem();this.flyManager.registerItem(null===(e=t.config)||void 0===e?void 0:e.uuid)}}Oi.mapExtraStateProps=(e,t)=>{var i,s,n,a,r,o;const{id:l,useMapWidgetIds:h}=t,d=h&&0!==h.length?Ce(h[0]):void 0,c=e&&e.mapWidgetsInfo;return{appConfig:null===(i=null==e?void 0:e.appStateInBuilder)||void 0===i?void 0:i.appConfig,layoutInfo:null===(n=null===(s=null==e?void 0:e.appStateInBuilder)||void 0===s?void 0:s.widgetsState[l])||void 0===n?void 0:n.layoutInfo,autoControlWidgetId:d?null===(a=c[d])||void 0===a?void 0:a.autoControlWidgetId:void 0,settingPanelChange:null===(o=null===(r=null==e?void 0:e.widgetsState)||void 0===r?void 0:r[t.id])||void 0===o?void 0:o.settingPanelChange}};const Ui=Oi;function Ei(e){c.p=e}})(),p})())}}});