System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/basic/list-tree","jimu-theme","jimu-arcgis","jimu-ui/basic/sql-expression-runtime","jimu-layouts/layout-runtime"],function(e,t){var a={},n={},l={},r={},s={},o={},i={},c={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){n.BaseVersionManager=e.BaseVersionManager,n.CONSTANTS=e.CONSTANTS,n.DataLevel=e.DataLevel,n.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,n.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.Immutable=e.Immutable,n.MessageManager=e.MessageManager,n.React=e.React,n.ReactRedux=e.ReactRedux,n.RecordSetChangeType=e.RecordSetChangeType,n.appConfigUtils=e.appConfigUtils,n.classNames=e.classNames,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.focusElementInKeyboardMode=e.focusElementInKeyboardMode,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.i18n=e.i18n,n.injectIntl=e.injectIntl,n.isKeyboardMode=e.isKeyboardMode,n.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,n.lodash=e.lodash,n.moduleLoader=e.moduleLoader,n.utils=e.utils},function(e){l.Button=e.Button,l.Checkbox=e.Checkbox,l.DataActionList=e.DataActionList,l.DataActionListStyle=e.DataActionListStyle,l.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,l.FloatingPanel=e.FloatingPanel,l.Icon=e.Icon,l.Loading=e.Loading,l.LoadingType=e.LoadingType,l.MobilePanel=e.MobilePanel,l.Modal=e.Modal,l.ModalBody=e.ModalBody,l.ModalFooter=e.ModalFooter,l.NumericInput=e.NumericInput,l.Option=e.Option,l.Pagination=e.Pagination,l.PanelHeader=e.PanelHeader,l.Paper=e.Paper,l.Select=e.Select,l.Tooltip=e.Tooltip,l.WidgetPlaceholder=e.WidgetPlaceholder,l.defaultMessages=e.defaultMessages},function(e){r.List=e.List,r.TreeItemActionType=e.TreeItemActionType},function(e){s.styled=e.styled,s.withTheme=e.withTheme},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.SqlExpressionRuntime=e.SqlExpressionRuntime,i.getShownClauseNumberByExpression=e.getShownClauseNumberByExpression},function(e){c.LayoutItemSizeModes=e.LayoutItemSizeModes}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=s},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},7835:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=l},20715:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><g fill="#000" clip-path="url(#clip0_2639_816)"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm9 1H2a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path><path d="M15 13.5v-7l1-1v8a2.5 2.5 0 0 1-2.5 2.5h-8l1-1h7a1.5 1.5 0 0 0 1.5-1.5M2.964 9.328l6.364-6.364.708.708-6.364 6.364z"></path><path d="M9.328 10.036 2.964 3.672l.707-.708 6.364 6.364z"></path></g><defs><clipPath id="clip0_2639_816"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'},23001:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m4 2 8 6-8 6z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},34682:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14M8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},34700:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#fff" d="M14.417 0H0v12.888h5.607v-.805H.8V.806h12.815V6.04h.801z"></path><path fill="#fff" fill-rule="evenodd" d="M10.413 14.902a4.37 4.37 0 0 0 2.867-1.067L15.434 16l.566-.57-2.161-2.173c.612-.761.979-1.73.979-2.785 0-2.447-1.973-4.43-4.405-4.43s-4.406 1.983-4.406 4.43 1.973 4.43 4.406 4.43m0-.805c1.99 0 3.604-1.623 3.604-3.625s-1.614-3.625-3.604-3.625c-1.991 0-3.605 1.623-3.605 3.625s1.614 3.625 3.605 3.625" clip-rule="evenodd"></path><path fill="#fff" d="M2.403 2.417h9.611v.805H2.403zM7.209 4.833H2.403v.806h4.806zM2.403 7.25h2.403v.805H2.403zM4.806 9.666H2.403v.806h2.403z"></path></svg>'},35737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m14 4-6 8-6-8z"></path></svg>'},41496:e=>{"use strict";e.exports=c},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=o},67386:e=>{"use strict";e.exports=a},76117:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=n},87782:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><g fill="#000" clip-path="url(#clip0_2600_1148)"><path d="m5.854 9.06 4.353-4.353L9.5 4 5.854 7.646 4.207 6l-.707.707z"></path><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm9 1H2a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path><path d="M15 13.5v-7l1-1v8a2.5 2.5 0 0 1-2.5 2.5h-8l1-1h7a1.5 1.5 0 0 0 1.5-1.5"></path></g><defs><clipPath id="clip0_2600_1148"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},98640:e=>{"use strict";e.exports=r}},t={};function u(a){var n=t[a];if(void 0!==n)return n.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,u),l.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var d={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(d),u.d(d,{__set_webpack_public_path__:()=>xt,default:()=>St});var e,t,a,n,l,r=u(67386),s=u(79244),o=u(14321);!function(e){e.Point="Point",e.Polyline="Polyline",e.Polygon="Polygon",e.Rectangle="Rectangle",e.Circle="Circle"}(e||(e={})),function(e){e.NewSelection="NEW_SELECTION",e.AddToSelection="ADD_TO_CURRENT_SELECTION",e.RemoveFromSelection="REMOVE_FROM_CURRENT_SELECTION",e.SubsetSelection="SUBSET_FROM_CURRENT_SELECTION",e.SwitchSelection="SWITCH_CURRENT_SELECTION"}(t||(t={})),function(e){e.Block="BLOCK",e.Inline="INLINE",e.Popper="POPPER"}(a||(a={})),function(e){e.CurrentMapExtent="CurrentMapExtent",e.InteractiveDrawMode="InteractiveDrawMode",e.None=""}(n||(n={})),function(e){e.Intersect="intersects",e.Contain="contains",e.Cross="crosses",e.EnvelopeIntersect="envelope-intersects",e.IndexIntersect="index-intersects",e.Overlap="overlaps",e.Touch="touches",e.Within="within"}(l||(l={}));const i={[l.Intersect]:"esriSpatialRelIntersects",[l.Contain]:"esriSpatialRelContains",[l.Cross]:"esriSpatialRelCrosses",[l.EnvelopeIntersect]:"esriSpatialRelEnvelopeIntersects",[l.IndexIntersect]:"esriSpatialRelIndexIntersects",[l.Overlap]:"esriSpatialRelOverlaps",[l.Touch]:"esriSpatialRelTouches",[l.Within]:"esriSpatialRelWithin"};var c;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(c||(c={}));const p={[c.Miles]:"esriSRUnit_StatuteMile",[c.Kilometers]:"esriSRUnit_Kilometer",[c.Feet]:"esriSRUnit_Foot",[c.Meters]:"esriSRUnit_Meter",[c.NauticalMiles]:"esriSRUnit_NauticalMile"};var g,f,m,h,v,y;!function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(g||(g={})),function(e){e.MultiPage="MultiPage",e.LazyLoad="LazyLoad"}(f||(f={})),function(e){e.PopupSetting="PopupSetting",e.SelectAttributes="SelectAttributes"}(m||(m={})),function(e){e.Asc="Asc",e.Desc="Desc"}(h||(h={})),function(e){e.Single="Single",e.Multiple="Multiple"}(v||(v={})),function(e){e.DefaultSymbol="DefaultSymbol",e.CustomSymbol="CustomSymbol"}(y||(y={}));const S={_widgetLabel:"Query",noDataAvailable:"Error in loading data",noQueryItem:"No query",newQueryHint:'Add content by clicking the "{label}" button on the configuration panel',attributeFilter:"Attribute filter",spatialFilter:"Spatial filter",spatialFilterType_CurrentMapExtent:"Current map extent",spatialFilterType_InteractiveDrawMode:"Drawn graphic",results:"Results",featuresDisplayed:"Features displayed",clearResult:"Clear results",checkResult:"Check results",mapMustBeVisible:"Map must be visible",chooseFilterType:"Choose the filter type",chooseGeometryType:"Choose the geometry type",clearDrawing:"Clear the graphic when applying",featureFromDs:"Selecting features from data source",featureFromMap:"Geometries from a map",chooseFilterLayer:"Choose a filter layer",selectedRecords:"{num} records are selected for the filter",spatialNotAvailable:"Spatial filter is not available here.",spatialNotAvailableDesc:"Spatial filter is not supported for a data source that already contains a spatial query.",preconfigured:"Preconfigured",runtime:"Runtime",selectLoaded:"Select loaded",retrieving:"Retrieving query results..."};var x=u(28996),b=u.n(x),R=u(34682),I=u.n(R),w=u(96300),j=u.n(w),C=u(52943),M=u.n(C),D=u(9044),N=u.n(D),P=u(4651),O=u.n(P);const T=()=>({iconMap:{iconQuery:u(34700),iconWarning:b(),iconError:I(),arrowNavBack:j(),arrowRight:M(),toolDelete:N(),iconMore:O()}});class E extends s.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.5.0",description:"1.5.0",upgrader:e=>{var t;let a=e;return null===(t=e.queryItems)||void 0===t||t.forEach((e,t)=>{null==e.useAttributeFilter&&(a=a.setIn(["queryItems",t,"useAttributeFilter"],!0)),null==e.useSpatialFilter&&(a=a.setIn(["queryItems",t,"useSpatialFilter"],!0))}),a}},{version:"1.6.0",description:"1.6.0",upgrader:e=>{var t;let a=e;if((null===(t=e.queryItems)||void 0===t?void 0:t.length)>0){const t=e.queryItems[0];a=a.set("resultListDirection",t.resultListDirection),a=a.set("resultPagingStyle",t.resultPagingStyle)}return a}}]}}const k=new E;var L=u(98640),A=u(1888);const{useState:B}=s.React;(0,A.withTheme)(e=>{const{theme:t,panelVisible:a,setPanelVisible:n,getI18nMessage:l,isModal:i=!0,title:c=l("queryMessage"),bodyContent:u="",hasHeader:d=!0,hasFooter:p=!0}=e,g=()=>{n(!1)},f=()=>(0,r.jsxs)(s.React.Fragment,{children:[d&&(0,r.jsx)(o.PanelHeader,{className:"py-2",title:c,onClose:g}),(0,r.jsx)(o.ModalBody,{children:u}),p&&(0,r.jsx)(o.ModalFooter,{children:(0,r.jsx)(o.Button,{onClick:g,children:l("ok")})})]}),m="ui-unit-dialog-panel";return i?(0,r.jsx)(o.Modal,{className:m,isOpen:a,toggle:g,backdrop:"static",children:f()}):(0,r.jsx)("div",{className:`${m} modal-dialog ${a?"":"collapse"}`,css:s.css`
      &.ui-unit-dialog-panel.modal-dialog {
        margin: 0;
        width: 100%;
        .modal-content {
          background-color: ${t.ref.palette.neutral[600]};
          color: ${t.ref.palette.black};
          font-size: .75rem;
          font-weight: 400;
          border: none;
          .panel-header {
            font-size: .8125rem;
            padding: .625rem;
          }
          .modal-body {
            padding: 0 .625rem .75rem;
            white-space: normal;
          }
        }
      }
    `,children:(0,r.jsx)("div",{className:"modal-content",children:f()})})});var z;!function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(z||(z={}));const F=(0,A.withTheme)(e=>{const{theme:t,className:a,title:n,statusType:l}=e;return l&&(0,r.jsx)("div",{className:`${null!=a?a:""} ui-unit-status-indicator ui-unit-status-indicator_status-type-${l}`,title:n,css:s.css`
    &.ui-unit-status-indicator {
      display: flex;
      &.ui-unit-status-indicator_status-type-loading {
        &:before {
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          content: '';
          width: 1rem;
          height: 1rem;
          display: block;
          border: 1px solid ${null===(i=null===(o=null==t?void 0:t.ref.palette)||void 0===o?void 0:o.neutral)||void 0===i?void 0:i[500]};
          border-radius: 50%;
          border-top: 1px solid ${null===(u=null===(c=null==t?void 0:t.sys.color)||void 0===c?void 0:c.primary)||void 0===u?void 0:u.main};
          box-sizing: border-box;
          animation: loading 2s infinite linear;
          margin-right: .25rem;
        }
      }
    }
  `});var o,i,c,u});function _(e){const{widgetId:t,useDataSourceId:a}=e;return s.ReactRedux.useSelector(e=>{var n;let l;l=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig;return(null!==(n=l.widgets[t].useDataSources)&&void 0!==n?n:[]).some(e=>e.dataSourceId===a)})}function q(e){var t,a,n;const{widgetId:l,useDataSource:i,onStatusChange:c,onDataSourceCreated:u,showMessage:d=!1}=e,p=s.hooks.useTranslation(o.defaultMessages),g=_({widgetId:l,useDataSourceId:i.dataSourceId}),[f,m]=s.React.useState(null),[h,v]=s.React.useState(null),y=s.React.useCallback(e=>{if(e){const{status:t,instanceStatus:a}=e;a===s.DataSourceStatus.NotCreated?(m("creating"),null==c||c(!1)):a===s.DataSourceStatus.CreateError||t===s.DataSourceStatus.LoadError?(m("error"),null==c||c(!1)):t===s.DataSourceStatus.NotReady?(m("warning"),null==c||c(!1)):(m(null),null==c||c(!0))}},[c]),S=s.React.useCallback(e=>{v(e),null==u||u(e)},[u]),x=s.React.useCallback(()=>{v(null),m("error"),null==c||c(!1)},[c]);let R,w,j;if("creating"===f)R=I(),w=p("loading");else if(g&&"error"!==f){if("warning"===f){let e="";const l=null===(t=null==h?void 0:h.getOriginDataSources())||void 0===t?void 0:t[0];l?e=l.getLabel()||l.getDataSourceJson().sourceLabel:h&&(e=h.getLabel()||h.getDataSourceJson().label);const r=s.appConfigUtils.getWidgetIdByOutputDataSource(i),o=null===(n=((null===(a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===a?void 0:a.isBuilder)?(0,s.getAppStore)().getState().appStateInBuilder:(0,s.getAppStore)().getState()).appConfig.widgets[r])||void 0===n?void 0:n.label;j="var(--sys-color-warning-dark)",R=b(),w=p("outputDataIsNotGenerated",{outputDsLabel:null!=e?e:"",sourceWidgetName:null!=o?o:""})}}else R=I(),w=p("dataSourceCreateError"),j="var(--sys-color-error-main)";return(0,r.jsxs)(s.React.Fragment,{children:[g&&(0,r.jsx)(s.DataSourceComponent,{useDataSource:i,onDataSourceInfoChange:y,onDataSourceCreated:S,onCreateDataSourceFailed:x}),"creating"===f&&(0,r.jsx)(F,{statusType:z.Loading,title:w}),(!g||"error"===f||"warning"===f)&&(0,r.jsxs)("div",{className:"d-flex align-items-center",children:[(0,r.jsx)(o.Tooltip,{title:w,children:(0,r.jsx)(o.Button,{size:"sm",type:"tertiary",icon:!0,children:(0,r.jsx)(o.Icon,{icon:R,color:j})})}),d&&(0,r.jsx)("div",{className:"status-message",children:w})]})]})}const U=s.css`
  font-weight: 500;
  font-size: 0.875rem;
`;function G(e){const{icon:t,name:a}=e;return(0,r.jsxs)("div",{className:"d-flex align-items-center text-truncate",css:U,children:[t&&(0,r.jsx)(o.Icon,{className:"query-task-icon mr-2",icon:t.svg}),(0,r.jsx)("div",{className:"text-truncate",title:a,children:a})]})}const V={icon:null,displayLabel:!0,sqlExprObj:null,useAttributeFilter:!0,useSpatialFilter:!0,spatialMapWidgetIds:[],spatialFilterTypes:[],spatialInteractiveCreateToolTypes:[e.Point,e.Polyline,e.Polygon,e.Rectangle,e.Circle],spatialInteractiveEnableBuffer:!1,spatialInteractiveBufferDistance:0,spatialInteractiveBufferUnit:c.Meters,spatialRelations:[l.Intersect],spatialRelationUseDataSources:[],spatialRelationEnableSelectTool:!1,spatialRelationEnableBuffer:!1,spatialRelationBufferDistance:0,spatialRelationBufferUnit:c.Meters,resultListDirection:g.Vertical,resultPagingStyle:f.MultiPage,resultFieldsType:m.PopupSetting,resultSymbolType:y.DefaultSymbol,resultCustomSymbol:{angle:0,color:[255,255,255,255],outline:{color:[255,255,255,255],style:"esriSLSSolid",type:"esriSLS",width:1},size:6,style:"esriSMSCircle",type:"esriSMS",xoffset:0,yoffset:0},resultAllowChangeSymbol:!1,allowExport:!1,sortOptions:[],itemSizeMap:{arrangementHorizontalPopper:{minSize:{width:300,height:300},defaultSize:{width:360,height:480}}}},{iconMap:$}=T(),J=s.css`
  height: 32px;
  .jimu-btn {
    min-width: 26px;
  }
`;function W(e){const{widgetId:t,queryItem:a,onStatusChange:n}=e,[l,i]=s.React.useState(!0),c=Object.assign({},V,a),{icon:u,name:d,useDataSource:p}=c;return(0,r.jsxs)("div",{className:"d-flex align-items-center pl-2 pr-1 w-100",css:J,children:[(0,r.jsx)(G,{icon:u,name:d}),(0,r.jsx)("div",{className:"ml-auto",children:(0,r.jsx)(q,{widgetId:t,useDataSource:p,onStatusChange:e=>{i(e),n(e)}})}),(0,r.jsx)(o.Button,{"aria-label":d,className:"ml-2",size:"sm",type:"tertiary",disabled:!l,icon:!0,children:(0,r.jsx)(o.Icon,{size:16,icon:$.arrowRight,autoFlip:!0})})]})}var H=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const K=e=>{const t=window.SVG,{className:a}=e,n=H(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,r.jsx)(t,Object.assign({className:l,src:N()},n)):(0,r.jsx)("svg",Object.assign({className:l},n))};var Q=u(62686),Y=u(76117);const Z=s.React.createContext({resetSymbol:null});function X(e){const{distance:t=0,unit:a=c.Meters,onBufferChange:n}=e,l=s.hooks.useTranslation(o.defaultMessages,S),[i,u]=s.React.useState(t),[d,p]=s.React.useState(a),g=s.React.useContext(Z),f=s.React.useRef(g.resetSymbol);s.React.useEffect(()=>{let e=!1;t!==i&&(u(t),e=!0),a!==d&&(p(a),e=!0),e&&n(t,a)},[t,a]),s.React.useEffect(()=>{g.resetSymbol&&g.resetSymbol!==f.current&&(f.current=g.resetSymbol,u(t),p(a),n(t,a))},[g.resetSymbol,t,a,n]);const m=s.React.useCallback(e=>{u(e)},[]),h=s.React.useCallback(e=>{u(e),n(e,d)},[n,d]),v=s.React.useCallback(e=>{p(e.target.value),n(i,e.target.value)},[n,i]);return(0,r.jsxs)(s.React.Fragment,{children:[(0,r.jsx)(o.NumericInput,{"aria-label":l("theBufferDistance"),className:"mr-1",value:i,onChange:m,onAcceptValue:h}),(0,r.jsx)(o.Select,{"aria-label":l("unit"),value:d,onChange:v,children:Object.values(c).map(e=>(0,r.jsx)("option",{value:e,children:l(`unit_${e}`)},e))})]})}const ee=s.css`margin-top: 0.75rem;`;function te(e){var t;const{onSelectionChange:a,useDataSources:n=[],useRuntimeData:i,spatialRelations:c,enableBuffer:u,bufferDistance:d,bufferUnit:p,onBufferChange:g,onRelationChange:f}=e,m=s.hooks.useTranslation(o.defaultMessages,S),[h,v]=s.React.useState(n[0]),[y,x]=s.React.useState(),[b,R]=s.React.useState(0),[I,w]=s.React.useState(null==c?void 0:c[0]),j=s.React.useContext(Z),C=s.React.useRef(j.resetSymbol),M=s.hooks.useTranslation(),D=s.React.useMemo(()=>Object.entries(l).map(([e,t])=>({value:t,label:m(`spatialRelation_${e}`)})),[m]),N=s.ReactRedux.useSelector(e=>{const t=[];return n.forEach(a=>{var n,l;(null===(l=null===(n=e.dataSourcesInfo)||void 0===n?void 0:n[a.mainDataSourceId])||void 0===l?void 0:l.instanceStatus)===s.DataSourceStatus.Created&&t.push(a.dataSourceId)}),t.length>0?t.join(","):""}),P=s.ReactRedux.useSelector(e=>{var t;return i?Object.keys(null!==(t=e.dataSourcesInfo)&&void 0!==t?t:{}).filter(t=>e.dataSourcesInfo[t].instanceStatus===s.DataSourceStatus.Created).length:0}),O=s.React.useMemo(()=>{if(P>0)return function(){const e={};let t=!1;const a=s.DataSourceManager.getInstance().getDataSources();return Object.keys(a).forEach(n=>{const l=a[n];null==l.getGeometryType()||l.isInAppConfig()||l.getMainDataSource().id!==n||l.getDataSourceJson().isOutputFromWidget||(e[n]=l,t=!0)}),t?e:null}()},[P]),T=Object.keys(null!=O?O:{}).length;s.hooks.useEffectOnce(()=>{(null==c?void 0:c.length)>0&&f(c[0]),u&&g(d,p)}),s.React.useEffect(()=>{j.resetSymbol&&j.resetSymbol!==C.current&&(C.current=j.resetSymbol,w(null==c?void 0:c[0]),f(null==c?void 0:c[0]))},[j.resetSymbol,f,c]),s.React.useEffect(()=>{c?c.includes(I)||(w(c[0]),f(c[0])):w(null)},[c,I,f]);const E=s.React.useCallback(e=>{const t=n.find(t=>t.dataSourceId===e);v((0,s.Immutable)(t)),x(null)},[n]),k=s.React.useCallback(e=>{const t=s.DataSourceManager.getInstance().getDataSource(e);x(t),v(null)},[]),L=s.React.useCallback(()=>{var e;const t=s.DataSourceManager.getInstance().getDataSource(null!==(e=null==h?void 0:h.dataSourceId)&&void 0!==e?e:null==y?void 0:y.id),n=null==t?void 0:t.getSelectedRecords();if((null==n?void 0:n.length)>0){const e=n.map(e=>e.getJSAPIGeometry());a(e),R(n.length)}else a(null),R(0)},[null==h?void 0:h.dataSourceId,null==y?void 0:y.id,a]),A=s.React.useCallback(e=>{w(e.target.value),f(e.target.value)},[f]);return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{css:ee,className:"title3",children:m("chooseFilterLayer")}),(0,r.jsxs)(o.Select,{"aria-label":m("chooseFilterLayer"),value:null!==(t=null==h?void 0:h.dataSourceId)&&void 0!==t?t:null==y?void 0:y.id,children:[T>0&&n.length>0&&(0,r.jsx)(o.Option,{header:!0,children:m("preconfigured")}),n.map(e=>{const t=s.DataSourceManager.getInstance().getDataSource(e.dataSourceId);return N.includes(e.dataSourceId)||(null==t?void 0:t.getLabel())?(0,r.jsx)(o.Option,{value:e.dataSourceId,onClick:()=>{E(e.dataSourceId)},children:null==t?void 0:t.getLabel()},e.dataSourceId):(0,r.jsx)(o.Option,{children:M("loading")},e.dataSourceId)}),T>0&&n.length>0&&(0,r.jsx)(o.Option,{divider:!0}),T>0&&(0,r.jsx)(o.Option,{header:!0,children:m("runtime")}),Object.keys(null!=O?O:{}).map(e=>{const t=O[e];return(0,r.jsx)(o.Option,{value:e,onClick:()=>{k(e)},children:t.getLabel()},e)})]}),(0,r.jsx)("div",{className:"mt-1 font-italic",css:s.css`color: var(--sys-color-surface-paper-hint);`,children:m("selectedRecords",{num:b})}),(null==c?void 0:c.length)>0&&(0,r.jsxs)("div",{css:ee,children:[(0,r.jsx)("div",{className:"text-truncate title3 mb-0",children:m("relationship")}),(0,r.jsx)(o.Select,{"aria-label":m("relationship"),value:I,onChange:A,children:c.map(e=>{return(0,r.jsx)("option",{value:e,children:(t=e,D.find(e=>e.value===t).label)},e);var t})})]}),u&&(0,r.jsxs)("div",{role:"group","aria-label":m("theBufferDistance"),css:ee,children:[(0,r.jsx)("div",{className:"title3 text-truncate",children:m("theBufferDistance")}),(0,r.jsx)("div",{className:"d-flex mt-1",children:(0,r.jsx)(X,{distance:d,unit:p,onBufferChange:g})})]}),(0,r.jsx)(s.DataSourceComponent,{useDataSource:h,dataSource:y,onDataSourceInfoChange:L}),n.map(e=>(0,r.jsx)(s.DataSourceComponent,{useDataSource:e},e.dataSourceId))]})}function ae(e){const{onGeometryChange:t,mapWidgetIds:a}=e,[n,l]=s.React.useState(null),o=s.React.useRef(null);s.React.useEffect(()=>{if(null==n?void 0:n.view){let e;return(0,s.loadArcGISJSAPIModule)("esri/core/reactiveUtils").then(a=>{e=a.watch(()=>n.view.extent,e=>{o.current?t(o.current.fromExtent(e)):(0,Q.loadArcGISJSAPIModules)(["esri/geometry/Polygon"]).then(a=>{o.current=a[0],t(o.current.fromExtent(e))})}),t(n.view.extent)}),()=>{e&&e.remove()}}},[n,t]);const i=s.React.useCallback(e=>{l(null!=(null==e?void 0:e.view)?e:null)},[]);return(0,r.jsx)(s.React.Fragment,{children:null==a?void 0:a.map((e,t)=>(0,r.jsx)(Q.JimuMapViewComponent,{useMapWidgetId:e,onActiveViewChange:i},t))})}const ne={[e.Point]:{drawToolName:"point",esriClassName:"esri-icon-point",toolIndex:0},[e.Polyline]:{drawToolName:"polyline",esriClassName:"esri-icon-polyline",toolIndex:4},[e.Polygon]:{drawToolName:"polygon",esriClassName:"esri-icon-polygon",toolIndex:2},[e.Rectangle]:{drawToolName:"rectangle",esriClassName:"esri-icon-checkbox-unchecked",toolIndex:1},[e.Circle]:{drawToolName:"circle",esriClassName:"esri-icon-radio-unchecked",toolIndex:3}};function le(e){const{toolTypes:t=[],jimuMapView:a,onDrawEnd:n,widgetId:l}=e,i=s.hooks.useTranslation(S),[c,u]=s.React.useState(null),d=s.React.useRef(null),p=s.React.useRef(null),[g,f]=s.React.useState(!1),m=s.React.useMemo(()=>({createTools:Object.entries(ne).reduce((e,[a,n])=>Object.assign(Object.assign({},e),{[n.drawToolName]:t.includes(a)}),{point:!1}),selectionTools:{"lasso-selection":!1,"rectangle-selection":!1},settingsMenu:!1,undoRedoMenu:!1,deleteButton:!0}),[t]);s.hooks.useEffectOnce(()=>{s.moduleLoader.loadModule("jimu-ui/advanced/map").then(e=>{u(e)})});const h=s.React.useCallback(e=>{d.current=e.getGraphicsLayer},[]),v=s.React.useCallback(()=>{d.current&&d.current().removeAll()},[]),y=s.React.useCallback(e=>{p.current=e,n(e,d.current,g)},[n,g]),x=s.React.useCallback(()=>{p.current=null,n(null)},[n]),b=s.React.useCallback(e=>{p.current&&n(p.current,d.current,e.target.checked),f(e.target.checked)},[n]),R=null==c?void 0:c.JimuDraw;if(!R)return(0,r.jsx)(F,{statusType:z.Loading});return Object.keys(m.createTools).some(e=>m.createTools[e])?(0,r.jsxs)("div",{children:[(0,r.jsx)(R,{jimuMapView:a,operatorWidgetId:l,disableSymbolSelector:!0,drawingOptions:{creationMode:c.JimuDrawCreationMode.Single,updateOnGraphicClick:!1,visibleElements:m},uiOptions:{isHideBorder:!0},onJimuDrawCreated:h,onDrawingStarted:v,onDrawingFinished:y,onDrawingCleared:x}),(0,r.jsxs)("label",{className:"d-flex align-items-center",children:[(0,r.jsx)(o.Checkbox,{checked:g,onChange:b,className:"mr-2"}),i("clearDrawing")]})]}):null}var re=function(e,t,a,n){return new(a||(a=Promise))(function(l,r){function s(e){try{i(n.next(e))}catch(e){r(e)}}function o(e){try{i(n.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,o)}i((n=n.apply(e,t||[])).next())})};function se(e){const{onGeometryChange:t,createToolTypes:a,mapWidgetIds:n,enableBuffer:l,bufferDistance:i,bufferUnit:c,onBufferChange:u,widgetId:d}=e,[p,g]=s.React.useState(null),f=s.hooks.useTranslation(o.defaultMessages,S),m=s.React.useContext(Z),h=s.React.useRef(m.resetSymbol),v=s.React.useRef(null),y=s.React.useRef(null),x=s.React.useRef(null),b=s.React.useRef(null),R=s.React.useRef(null),I=s.React.useRef(i),w=s.React.useRef(c),j=s.React.useRef(null);s.hooks.useEffectOnce(()=>{l&&s.lodash.defer(()=>{u(i,c)}),(0,Q.loadArcGISJSAPIModules)(["esri/Graphic"]).then(e=>{const t=e[0];j.current=new t({symbol:{type:"simple-fill",color:[51,51,204,.5],style:"solid",outline:{color:[51,51,204,.8],width:1}}})})});const C=s.React.useCallback(()=>re(this,void 0,void 0,function*(){var e,t,a,n,r,o;if(!R.current||!l||0===I.current)return void(j.current.geometry=null);const i=("point"===(null===(e=R.current)||void 0===e?void 0:e.type)||"multipoint"===(null===(t=R.current)||void 0===t?void 0:t.type))&&I.current<0,c="polyline"===(null===(a=R.current)||void 0===a?void 0:a.type)&&I.current<0;if(i||c)return void(j.current.geometry=null);const u=R.current;if((null===(n=u.spatialReference)||void 0===n?void 0:n.isGeographic)&&!u.spatialReference.isWGS84){const e=s.utils.getGeometryService();if(!b.current){const e=yield(0,Q.loadArcGISJSAPIModules)(["esri/rest/geometryService","esri/rest/support/BufferParameters"]);b.current={geometryService:e[0],bufferParameters:e[1]}}const{geometryService:t,bufferParameters:a}=b.current,n=yield t.buffer(e,new a({distances:[I.current],unit:s.lodash.kebabCase(w.current),geodesic:!0,bufferSpatialReference:u.spatialReference,outSpatialReference:u.spatialReference,geometries:[u]}));j.current.geometry=n[0]}else(null===(r=u.spatialReference)||void 0===r?void 0:r.isWGS84)||(null===(o=u.spatialReference)||void 0===o?void 0:o.isWebMercator)?(x.current||(x.current=yield(0,s.loadArcGISJSAPIModule)("esri/geometry/operators/geodesicBufferOperator")),x.current.isLoaded()||(yield x.current.load()),j.current.geometry=x.current.execute(u,I.current,{unit:s.lodash.kebabCase(w.current)})):(y.current||(y.current=yield(0,s.loadArcGISJSAPIModule)("esri/geometry/operators/bufferOperator")),j.current.geometry=y.current.execute(u,I.current,{unit:s.lodash.kebabCase(w.current)}))}),[l]);s.React.useEffect(()=>{m.resetSymbol&&m.resetSymbol!==h.current&&(h.current=m.resetSymbol,v.current&&v.current().removeAll(),t(null))},[m.resetSymbol,t]);const M=s.React.useCallback(e=>{const a=v.current&&v.current();a&&(a.removeAll(),t(null)),g(null!=(null==e?void 0:e.view)?e:null)},[t]),D=s.React.useCallback((e,t)=>{I.current=e,w.current=t,C(),u(e,t)},[u,C]),N=s.React.useCallback((e,a,n)=>{v.current=a;const l=v.current&&v.current();R.current!==(null==e?void 0:e.geometry)&&(R.current=null==e?void 0:e.geometry,C().then(()=>{j.current.geometry&&(null==l||l.add(j.current))})),t(null==e?void 0:e.geometry,l,e,n)},[t,C]);return(0,r.jsxs)(s.React.Fragment,{children:[null==n?void 0:n.map((e,t)=>(0,r.jsx)(Q.JimuMapViewComponent,{useMapWidgetId:e,onActiveViewChange:M},t)),(null==p?void 0:p.view)&&(0,r.jsxs)(s.React.Fragment,{children:[(0,r.jsx)(le,{jimuMapView:p,widgetId:d,toolTypes:a,onDrawEnd:N}),l&&(0,r.jsxs)("div",{role:"group",className:"title3","aria-label":f("theBufferDistance"),css:s.css`margin-top: 0.75rem;`,children:[(0,r.jsx)("div",{className:"text-truncate",children:f("theBufferDistance")}),(0,r.jsx)("div",{className:"d-flex mt-1",children:(0,r.jsx)(X,{distance:i,unit:c,onBufferChange:D})})]})]})]})}var oe=u(45508),ie=u.n(oe),ce=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const ue=e=>{const t=window.SVG,{className:a}=e,n=ce(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,r.jsx)(t,Object.assign({className:l,src:ie()},n)):(0,r.jsx)("svg",Object.assign({className:l},n))};function de(e){var t;const{label:a,desc:l,filterTypes:i,mapWidgetIds:u,onFilterChange:d,onRelationChange:p,onBufferChange:g,useDataSources:f,spatialRelations:m,useRuntimeData:h,dsEnableBuffer:v,dsBufferDistance:y,dsBufferUnit:x,drawEnableBuffer:b,drawBufferDistance:R,drawBufferUnit:I,createToolTypes:w,widgetId:j}=e,C=s.hooks.useTranslation(S),M=s.React.useRef(null),D=s.ReactRedux.useSelector(e=>{if((null==u?void 0:u.length)>0){const t=u[0];return null!=e.appConfig.widgets[t]}return!1}),N=s.React.useMemo(()=>D&&((null==i?void 0:i.includes(n.CurrentMapExtent))||(null==i?void 0:i.includes(n.InteractiveDrawMode))),[i,D]),P=s.React.useMemo(()=>{const e=[];return((null==f?void 0:f.length)>0||h)&&e.push({value:"data",label:C("featureFromDs")}),N&&(null==i?void 0:i.includes(n.CurrentMapExtent))&&e.push({value:"map",label:C(`spatialFilterType_${n.CurrentMapExtent}`)}),N&&(null==i?void 0:i.includes(n.InteractiveDrawMode))&&e.push({value:"draw",label:C(`spatialFilterType_${n.InteractiveDrawMode}`)}),e},[N,f,h,C,i]),[O,T]=s.React.useState(null===(t=null==P?void 0:P[0])||void 0===t?void 0:t.value);s.React.useEffect(()=>{var e;"none"===O||P.find(e=>e.value===O)||T(null===(e=null==P?void 0:P[0])||void 0===e?void 0:e.value)},[O,P]),s.React.useEffect(()=>{"map"!==O&&"draw"!==O&&"none"!==O||(p(null),g(0,c.Meters),d({geometry:null})),"data"===O&&null==M.current&&d({geometry:null})},[O,p,g,d]);const E=s.React.useCallback(e=>{T(e.target.value)},[]),k=s.React.useCallback((e,t,a,n)=>{d({geometry:e,graphic:a,layer:t,clearAfterApply:n})},[d]),L=s.React.useCallback(e=>{M.current=e,d({geometry:e})},[d]);return(null==f?void 0:f.length)>0||h||N?(0,r.jsxs)("div",{role:"group",className:"px-4 pb-4","aria-label":a,children:[(0,r.jsxs)("div",{className:(0,s.classNames)("form-title my-2 d-flex align-items-center",{"d-none":!a&&!l}),children:[a&&(0,r.jsx)("div",{className:"mr-2 title2",children:a}),l&&(0,r.jsx)(o.Tooltip,{placement:"bottom",css:s.css`white-space: pre-line;`,title:l,children:(0,r.jsx)(o.Button,{size:"sm",icon:!0,type:"tertiary",children:(0,r.jsx)(ue,{color:"var(--sys-color-primary-main)",size:"s"})})})]}),P.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"title3",children:C("chooseFilterType")}),(0,r.jsxs)(o.Select,{"aria-label":C("chooseFilterType"),css:s.css`height: 32px;`,value:O,onChange:E,children:[(0,r.jsx)("option",{value:"none",children:"-"},"-"),P.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),"data"===O&&(0,r.jsx)(te,{enableBuffer:v,bufferDistance:y,bufferUnit:x,spatialRelations:m,useDataSources:f,useRuntimeData:h,onSelectionChange:L,onRelationChange:p,onBufferChange:g}),"map"===O&&(0,r.jsx)(ae,{mapWidgetIds:u,createToolTypes:w,onGeometryChange:k}),"draw"===O&&(0,r.jsx)(se,{enableBuffer:b,bufferDistance:R,bufferUnit:I,mapWidgetIds:u,widgetId:j,createToolTypes:w,onGeometryChange:k,onBufferChange:g})]}):null}var pe=u(41496);const ge=s.React.createContext(null);function fe(){const e=s.React.useContext(ge);let t,a;if(e.includes(":")){const n=e.split(":");t=n[0],a=n[1]}return s.ReactRedux.useSelector(e=>{var n,l,r,s;const o=null===(l=null===(n=e.appConfig.layouts[t])||void 0===n?void 0:n.content)||void 0===l?void 0:l[a];return(null===(s=null===(r=null==o?void 0:o.setting)||void 0===r?void 0:r.autoProps)||void 0===s?void 0:s.height)===pe.LayoutItemSizeModes.Auto})}const me=e=>s.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .form-title {
      color: var(--sys-color-surface-paper-text);
      font-weight: 500;
      font-size: 0.8125rem;
      line-height: 1.5;
    }
    .query-form__content {
      flex: 1 1 ${e?"auto":0};
      max-height: ${e?"61.8vh":"none"};
      overflow: auto;
    }
  `;function he(e){const{widgetId:t,configId:a,outputDS:n,spatialFilterEnabled:i,datasourceReady:c,onFormSubmit:u,dataActionFilter:d}=e,p=s.hooks.usePrevious(d),g=s.ReactRedux.useSelector(e=>e.appConfig.widgets[t].config.queryItems.find(e=>e.configId===a)),f=Object.assign({},V,g),m=s.hooks.useTranslation(S),[h,v]=s.React.useState(null),{useAttributeFilter:y,useSpatialFilter:x,spatialFilterTypes:b,sqlExprObj:R,spatialMapWidgetIds:I,spatialInteractiveCreateToolTypes:w,spatialRelationUseDataSources:j,spatialIncludeRuntimeData:C,spatialRelations:M,spatialRelationEnableBuffer:D,spatialRelationBufferDistance:N,spatialRelationBufferUnit:P,spatialInteractiveEnableBuffer:O,spatialInteractiveBufferDistance:T,spatialInteractiveBufferUnit:E,attributeFilterLabel:k=m("attributeFilter"),spatialFilterLabel:L=m("spatialFilter"),attributeFilterDesc:A,spatialFilterDesc:B}=f,[z,F]=s.React.useState(R),_=s.React.useRef(null),q=s.React.useRef(l.Intersect),U=s.React.useRef(null),G=fe(),$=s.React.useRef((0,Y.getShownClauseNumberByExpression)(R)),J=null==n?void 0:n.getOriginDataSources()[0];s.React.useEffect(()=>{R?($.current=(0,Y.getShownClauseNumberByExpression)(R),F(R)):($.current=0,F(null))},[R]);const W=s.React.useCallback(()=>{var e,t,a;if(null===(e=null==n?void 0:n.selectRecordsByIds)||void 0===e||e.call(n,[]),n){const e=n.getOriginDataSources()[0];if(e){const t=e.getDataViewConfig(),a=null==t?void 0:t.maximum;null!=a&&a>0&&s.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(n,n.getDataSourceJson().setIn(["query","maximum"],a))}}let r=q.current;(null===(t=_.current)||void 0===t?void 0:t.geometry)&&null==r&&(r=l.Intersect),Array.isArray(null===(a=_.current)||void 0===a?void 0:a.geometry)?1===_.current.geometry.length?u(z,Object.assign(Object.assign({},_.current),{geometry:_.current.geometry[0],relation:r,buffer:U.current})):(0,Q.loadArcGISJSAPIModules)(["esri/geometry/operators/unionOperator"]).then(e=>{const t=e[0].executeMany(_.current.geometry);u(z,Object.assign(Object.assign({},_.current),{geometry:t,relation:r,buffer:U.current}))}):u(z,Object.assign(Object.assign({},_.current),{relation:r,buffer:U.current}))},[u,n,z]);s.React.useEffect(()=>{d&&d.where!==(null==p?void 0:p.where)&&W()},[d,null==p?void 0:p.where,W]);const H=s.React.useCallback(()=>{$.current=(0,Y.getShownClauseNumberByExpression)(R),F(R),v(Symbol())},[R]),K=s.React.useCallback(e=>{$.current=(0,Y.getShownClauseNumberByExpression)(e),F(e)},[]),X=s.React.useCallback(e=>{_.current=e},[]),ee=s.React.useCallback(e=>{q.current=e},[]),te=s.React.useCallback((e,t)=>{U.current={distance:e,unit:t}},[]),ae=y&&null!=R,ne=i&&x&&(b.length>0||C||(null==j?void 0:j.length)>0);return(0,r.jsx)(Z.Provider,{value:{resetSymbol:h},children:(0,r.jsxs)("div",{className:"query-form",css:me(G),children:[(0,r.jsxs)("div",{className:"query-form__content",children:[ae&&(0,r.jsxs)("div",{role:"group",className:"px-4","aria-label":k,children:[(0,r.jsxs)("div",{className:(0,s.classNames)("form-title my-2 d-flex align-items-center",{"d-none":!k&&!A}),children:[k&&(0,r.jsx)("div",{className:"mr-2 title2",children:k}),A&&(0,r.jsx)(o.Tooltip,{placement:"bottom",css:s.css`white-space: pre-line;`,title:A,children:(0,r.jsx)(o.Button,{size:"sm",icon:!0,type:"tertiary",children:(0,r.jsx)(ue,{color:"var(--sys-color-primary-main)",size:"s"})})})]}),J&&(0,r.jsx)(Y.SqlExpressionRuntime,{widgetId:t,dataSource:J,expression:z,onChange:K})]}),ae&&ne&&(0,r.jsx)("hr",{className:"m-4",css:s.css`border: none; height: 1px; background-color: var(--sys-color-divider-secondary);`}),ne&&(0,r.jsx)(de,{widgetId:t,label:L,desc:B,filterTypes:b,mapWidgetIds:I,createToolTypes:w,onFilterChange:X,onRelationChange:ee,onBufferChange:te,spatialRelations:M,dsEnableBuffer:D,dsBufferDistance:N,dsBufferUnit:P,drawEnableBuffer:O,drawBufferDistance:T,drawBufferUnit:E,useDataSources:j,useRuntimeData:C})]}),(0,r.jsxs)("div",{className:"query-form__actions px-4 d-flex align-items-center",children:[(0,r.jsx)(o.Button,{color:"primary",className:"ml-auto",disabled:!c,onClick:W,children:m("apply")}),($.current>0||ne)&&(0,r.jsx)(o.Button,{className:"ml-2",onClick:H,children:m("reset")})]})]})})}var ve=u(23001),ye=u.n(ve),Se=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const xe=e=>{const t=window.SVG,{className:a}=e,n=Se(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,r.jsx)(t,Object.assign({className:l,src:ye()},n)):(0,r.jsx)("svg",Object.assign({className:l},n))};var be=u(35737),Re=u.n(be),Ie=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const we=e=>{const t=window.SVG,{className:a}=e,n=Ie(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,r.jsx)(t,Object.assign({className:l,src:Re()},n)):(0,r.jsx)("svg",Object.assign({className:l},n))};var je;!function(e){e.Pending="Pending",e.Fulfilled="Fulfilled",e.Rejected="Rejected"}(je||(je={}));const Ce=s.css`
  border: 1px solid var(--sys-color-divider-secondary);
  .esri-widget__heading {
    font-size: 0.875rem !important;
    font-weight: 500 !important;
    margin: 0;
    color: var(--sys-color-surface-paper-text);
  }

  .esri-feature__content-element {
    padding: 0;
  }

  .jimu-btn.expanded {
    align-self: flex-start;
  }

  .esri-feature.esri-widget {
    background-color: transparent;
  }
`;class Me extends s.React.PureComponent{constructor(e){super(e),this.toggleExpanded=e=>{e.stopPropagation(),this.setState({showContent:!this.state.showContent})};const{togglable:t=!1,expandByDefault:a}=this.props;this.featureContainer=s.React.createRef(),this.state={showContent:!t||a,loadStatus:je.Pending}}componentDidMount(){this.createFeature()}componentDidUpdate(e){this.feature&&(e.popupTemplate!==this.props.popupTemplate||e.defaultPopupTemplate!==this.props.defaultPopupTemplate||e.graphic!==this.props.graphic?(this.destroyFeature(),this.createFeature()):this.feature.visibleElements=this.getVisibleElements())}destroyFeature(){this.feature&&!this.feature.destroyed&&this.feature.destroy()}getVisibleElements(){const{togglable:e=!1}=this.props,{showContent:t}=this.state,a=!e||t;return{title:!0,content:{fields:a,text:a,media:a,attachments:a},lastEditedInfo:!1}}createFeature(){let e;return e=this.Feature?Promise.resolve():(0,Q.loadArcGISJSAPIModules)(["esri/widgets/Feature"]).then(e=>{[this.Feature]=e}),e.then(()=>{var e,t,a,n;const l=document&&document.createElement("div");l.className="jimu-widget",this.featureContainer.current.appendChild(l);const r=this.props.dataSource.getOriginDataSources(),s=null===(e=null==r?void 0:r[0])||void 0===e?void 0:e.getRootDataSource();this.destroyFeature();const o=this.props.graphic.layer;this.props.popupTemplate?this.props.graphic.popupTemplate=this.props.popupTemplate:this.props.graphic.popupTemplate=o&&null!==(t=o.popupTemplate)&&void 0!==t?t:this.props.defaultPopupTemplate,o&&!o.popupTemplate&&(o.popupTemplate=this.props.popupTemplate||this.props.defaultPopupTemplate),this.feature=new this.Feature({container:l,defaultPopupTemplateEnabled:!0,spatialReference:(null===(n=null===(a=this.props.dataSource)||void 0===a?void 0:a.layer)||void 0===n?void 0:n.spatialReference)||null,map:(null==s?void 0:s.map)||null,graphic:this.props.graphic,visibleElements:this.getVisibleElements()})}).then(()=>{this.setState({loadStatus:je.Fulfilled})})}render(){const{togglable:e=!1,intl:t}=this.props,{showContent:a}=this.state;return(0,r.jsxs)("div",{className:"feature-info-component d-flex align-items-center p-2",css:Ce,children:[e&&(0,r.jsx)(o.Button,{"aria-label":t.formatMessage({id:a?"collapse":"expand"}),className:(0,s.classNames)("p-0 jimu-outline-inside flex-shrink-0",{expanded:a}),variant:"text",color:"inherit",icon:!0,size:"sm",onClick:this.toggleExpanded,children:a?(0,r.jsx)(we,{size:"s"}):(0,r.jsx)(xe,{size:"s",autoFlip:!0})}),(0,r.jsx)("div",{className:"flex-grow-1",ref:this.featureContainer})]})}}const De=(0,s.injectIntl)(Me),Ne=s.css`
  overflow: auto;
  flex-flow: row;
  cursor: pointer;
  flex-shrink: 0;
  min-height: 2rem;
  &.selected {
    outline: 2px solid var(--sys-color-primary-main);
  }
`,Pe=e=>{const{widgetId:t,data:a,dataSource:n,popupTemplate:l,defaultPopupTemplate:o,onClick:i,expandByDefault:c=!1}=e,u=s.ReactRedux.useSelector(e=>{var t,l,r;return null===(r=null===(l=null===(t=e.dataSourcesInfo)||void 0===t?void 0:t[n.id])||void 0===l?void 0:l.selectedIds)||void 0===r?void 0:r.includes(a.getId())}),d=s.ReactRedux.useSelector(e=>e.appConfig.widgets[t].config.resultListDirection!==g.Horizontal),p=s.React.useCallback(()=>{i(a)},[i,a]),f=s.React.useCallback(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),p())},[p]);return(0,r.jsx)("div",{className:(0,s.classNames)("query-result-item",{selected:u}),onClick:p,onKeyUp:f,css:Ne,role:"option","aria-selected":u,tabIndex:0,children:(0,r.jsx)(De,{graphic:a.feature,popupTemplate:l,defaultPopupTemplate:o,togglable:d,expandByDefault:c,dataSource:n})})};var Oe=function(e,t,a,n){return new(a||(a=Promise))(function(l,r){function s(e){try{i(n.next(e))}catch(e){r(e)}}function o(e){try{i(n.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,o)}i((n=n.apply(e,t||[])).next())})};function Te(e,t,a){const n=new Set;if(null==e||e.forEach(e=>n.add(e)),t){const e=t.match(/\{\w*\}/g);(null==e?void 0:e.length)>0&&e.forEach(e=>n.add(e.substring(1,e.length-1)))}return a&&n.add(a),Array.from(n)}function Ee(e,t){return Oe(this,void 0,void 0,function*(){var a;const{resultFieldsType:n,resultDisplayFields:l,resultTitleExpression:r=""}=t,s=e.getOriginDataSources()[0],o=s.getPopupInfo();if(n===m.SelectAttributes){let t;if(null==l){const a=function(e){var t;const a=[];return(null===(t=null==e?void 0:e.popupElements)||void 0===t?void 0:t.length)>0&&e.popupElements.forEach(e=>{var t;"fields"===e.type&&(null===(t=e.fieldInfos)||void 0===t?void 0:t.length)>0&&a.push(...e.fieldInfos)}),a}(o);if(a.length>0){const e=new Set(a.map(e=>e.fieldName));t=Array.from(e)}else{const a=e.getSchema();t=(null==a?void 0:a.fields)?Object.values(a.fields).map(e=>e.jimuName):[]}}else t=l.asMutable({deep:!0});if(o){const e=[];return t.forEach(t=>{const a=o.fieldInfos.find(e=>e.fieldName===t);a?(a.visible=!0,e.push(a)):e.push({fieldName:t,label:t})}),{popupTemplate:{fieldInfos:e,content:[{type:"fields"}],title:r}}}return{popupTemplate:{fieldInfos:t.map(e=>({fieldName:e,label:e})),content:[{type:"fields"}],title:r}}}let i;return i=s.layer?s.layer:yield s.createJSAPILayerByDataSource(),i&&(yield i.load()),{defaultPopupTemplate:(null===(a=null==i?void 0:i.associatedLayer)||void 0===a?void 0:a.defaultPopupTemplate)||(null==i?void 0:i.defaultPopupTemplate)}})}function ke(e,t,a,n){return Oe(this,void 0,void 0,function*(){const t=a.getPopupInfo(),l=a.getLayerDefinition(),r=(e=>{return e.length?e:[{fieldName:null!==(t=null==l?void 0:l.objectIdField)&&void 0!==t?t:"objectid",label:"OBJECTID",tooltip:"",visible:!0}];var t})(((null==t?void 0:t.fieldInfos)||[]).filter(e=>e.visible));let o=yield a.load(n,{widgetId:e});null==o&&(o=[]);const i=a.getOriginDataSources()[0],c=yield function(e){return Oe(this,void 0,void 0,function*(){const t=yield e.createJSAPILayerByDataSource();return t&&(yield t.load()),t})}(i);o.forEach(e=>{const t=e.feature;c&&(t.sourceLayer=c.associatedLayer||c),t.layer=t.sourceLayer});const u={records:o,fields:r.map(e=>e.fieldName)},d=new s.DataRecordSetChangeMessage(e,s.RecordSetChangeType.CreateUpdate,[{records:a.getAllLoadedRecords(),fields:u.fields,dataSource:a,name:a.id,label:a.getLabel()}]);return s.MessageManager.getInstance().publishMessage(d),u})}var Le=function(e,t,a,n){return new(a||(a=Promise))(function(l,r){function s(e){try{i(n.next(e))}catch(e){r(e)}}function o(e){try{i(n.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,o)}i((n=n.apply(e,t||[])).next())})};const{useRef:Ae,useState:Be}=s.React,ze=e=>s.css`
    display: flex;
    flex: 1 1 ${e?"auto":0};
    overflow: auto;
    max-height: ${e?"calc(61.8vh - 100px)":"none"};

    .query-result-item + .query-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.vertical {
      flex-direction: column;
      .list-items {
        position: relative;
        flex-direction: column;
      }

      .feature-info-component {
        width: 100%;
      }

      .query-result-item + .query-result-item {
        margin-left: 0;
        margin-top: 0.5rem;
      }
    }
    .list-items {
      display: flex;
    }
    .lazyload-detector {
      height: 2px;
      width: 2px;
      opacity: 0;
    }
  `;function Fe(e){const{widgetId:t,outputDS:a,queryParams:n,resultCount:l,records:i,queryItem:c,direction:u,onRenderDone:d,onEscape:p,onSelectChange:f,defaultPageSize:m=s.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE}=e,[h,v]=Be(i),[y,S]=Be(),[x,b]=Be(),[R,I]=Be(z.Init),w=s.hooks.useLatest(h),j=s.hooks.useLatest(l),C=s.hooks.useLatest(R),M=s.hooks.useLatest((null==h?void 0:h.length)===l),D=Ae(0),N=Ae(void 0),P=Ae(null),O=fe();s.React.useEffect(()=>{D.current=1,N.current.scrollTop=0,v(i)},[i]);const T=()=>Le(this,void 0,void 0,function*(){if(M.current||C.current===z.Loading)return;D.current=D.current+1,I(z.Loading),n.pageSize||(n.pageSize=m);const{records:e}=yield ke(t,0,a,Object.assign(Object.assign({},n),{page:D.current}));j.current>0&&w.current.length+e.length>=j.current&&(M.current=!0);const l=w.current.concat(e);v(l),null==d||d({dataItems:a.getAllLoadedRecords()}),I(z.Loaded)});s.React.useEffect(()=>{Ee(a,c).then(e=>{S(e.popupTemplate),b(e.defaultPopupTemplate)})},[a,c]),s.hooks.useEffectOnce(()=>{const e=null==P?void 0:P.current;if(e){const t=new IntersectionObserver(e=>{e[0].isIntersecting&&T()});return null==t||t.observe(e),()=>{null==t||t.disconnect()}}});const E=s.React.useCallback(e=>{"Escape"===e.key&&(e.stopPropagation(),p())},[p]),k=s.React.useCallback(e=>{" "===e.key&&e.preventDefault()},[]);return(0,r.jsxs)("div",{onKeyUp:E,onKeyDown:k,className:(0,s.classNames)({vertical:u===g.Vertical}),css:ze(O),ref:N,children:[(0,r.jsx)("div",{className:"list-items px-4 py-1",role:"listbox",children:null==h?void 0:h.map(e=>(0,r.jsx)(Pe,{data:e,dataSource:a,widgetId:t,popupTemplate:y,defaultPopupTemplate:x,expandByDefault:c.resultExpandByDefault,onClick:f},e.getId()))}),(0,r.jsx)("div",{ref:P,className:"lazyload-detector",children:"\xa0"}),R===z.Loading&&(0,r.jsx)(o.Loading,{type:o.LoadingType.Donut})]})}var _e=function(e,t,a,n){return new(a||(a=Promise))(function(l,r){function s(e){try{i(n.next(e))}catch(e){r(e)}}function o(e){try{i(n.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,o)}i((n=n.apply(e,t||[])).next())})};const{useRef:qe,useState:Ue}=s.React,Ge=e=>s.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .list_items {
      flex: 1 1 ${e?"auto":0};
      max-height: ${e?"calc(61.8vh - 100px)":"none"};
      overflow: auto;
      display: flex;
      flex-direction: row;
    }

    .query-result-item + .query-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.vertical {
      .list_items {
        flex-direction: column;
      }
      .feature-info-component {
        width: 100%;
      }
      .query-result-item + .query-result-item {
        margin-top: 0.5rem;
        margin-left: 0;
      }
    }
    .page-size-selector {
      width: auto;
    }

    .query-editable-select {
      .jimu-numeric-input {
        width: 60px;
      }
    }
  `;function Ve(e){const{widgetId:t,outputDS:a,queryItem:n,queryParams:l,resultCount:i,records:c,onRenderDone:u,onSelectChange:d,direction:p,onEscape:f,defaultPageSize:m=s.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE}=e,[h,v]=Ue(c),[y,S]=Ue(),[x,b]=Ue(),[R,I]=Ue(z.Init),w=qe(1),j=qe(m),[C,M]=Ue(m),D=fe(),N=s.React.useMemo(()=>{const e=[m];return Math.round(m/2)!==e[0]&&e.push(Math.round(m/2)),Math.round(m/5)!==e[1]&&e.push(Math.round(m/5)),e.reverse()},[m]);s.React.useEffect(()=>{w.current=1,v(c),M(j.current)},[c]),s.React.useEffect(()=>{Ee(a,n).then(e=>{S(e.popupTemplate),b(e.defaultPopupTemplate)})},[a,n]);const P=s.React.useCallback((e,n)=>_e(this,void 0,void 0,function*(){w.current=e,I(z.Loading);const r=yield ke(t,0,a,Object.assign(Object.assign({},l),{page:e,pageSize:n}));v(r.records),null==u||u({dataItems:a.getAllLoadedRecords(),pageSize:n,page:w.current}),I(z.Loaded)}),[u,a,n,l,t]);s.React.useEffect(()=>{m!==j.current&&(m<j.current?v(h.slice(0,m)):P(1,m),j.current=m,M(m))},[m,h,P]);const O=s.React.useCallback(e=>{"Escape"===e.key&&(e.stopPropagation(),f())},[f]),T=s.React.useCallback(e=>{" "===e.key&&e.preventDefault()},[]);return(0,r.jsxs)("div",{onKeyUp:O,onKeyDown:T,className:(0,s.classNames)({vertical:p===g.Vertical}),css:Ge(D),children:[(0,r.jsx)("div",{className:"list_items mb-2 px-4 py-1",role:"listbox",children:null==h?void 0:h.map(e=>(0,r.jsx)(Pe,{data:e,dataSource:a,widgetId:t,popupTemplate:y,defaultPopupTemplate:x,expandByDefault:n.resultExpandByDefault,onClick:d},e.getId()))}),R===z.Loading&&(0,r.jsx)(o.Loading,{type:o.LoadingType.Donut}),i>0&&(0,r.jsx)("div",{className:"d-flex justify-content-between align-items-center px-4",children:(0,r.jsx)(o.Pagination,{className:"d-flex justify-content-end",disabled:R===z.Loading,current:w.current,totalPage:Math.ceil(i/C),onChangePage:e=>P(e,C),pageSize:C,maxPageSize:1e3,pageSizeOptions:N,onPageSizeChange:e=>{e>0&&(M(e),P(1,e))},showSizeChanger:!0})})]})}var $e=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const Je=e=>{const t=window.SVG,{className:a}=e,n=$e(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,r.jsx)(t,Object.assign({className:l,src:j()},n)):(0,r.jsx)("svg",Object.assign({className:l},n))};var We=u(87782),He=u.n(We),Ke=u(20715),Qe=u.n(Ke);const{iconMap:Ye}=T(),Ze=s.css`
  display: flex;
  flex-direction: column;

  .query-result__header {
    color: var(--sys-color-surface-paper-text);
    font-weight: 500;
    font-size: 0.875rem;
    line-height: 1.5;
    border-bottom: 1px solid var(--sys-color-divider-secondary);
    margin-bottom: 6px;
    padding-bottom: 8px;
  }

  .query-result-container {
    flex: 1 1 0;
    display: flex;
    flex-direction: column;
  }

  .query-result-info {
    height: 18px;
  }
`;function Xe(e){var t;const{queryItem:a,queryParams:n,resultCount:l,maxPerPage:i,records:c,defaultPageSize:u,widgetId:d,outputDS:p,onNavBack:h}=e,y=s.hooks.useTranslation(S),[x,b]=s.React.useState(null),[R,I]=s.React.useState([]),w=s.React.useRef(void 0),j=s.React.useMemo(()=>function(e){return[{id:"query-select-loaded",label:s.i18n.getIntl(e).formatMessage({id:"selectLoaded",defaultMessage:S.selectLoaded}),intl:s.i18n.getIntl(e),icon:He(),destroy:()=>{},isSupported:(e,t)=>Promise.resolve(t===s.DataLevel.Records),onExecute:(e,t,a)=>{const n=e[0],{dataSource:l}=n;return l.selectAllLoadedRecords(),s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(a,l.getAllLoadedRecords(),[l.id])),Promise.resolve(!0)}},{id:"query-clear-selection",label:s.i18n.getIntl(e).formatMessage({id:"clearSelection",defaultMessage:o.defaultMessages.clearSelection}),intl:s.i18n.getIntl(e),icon:Qe(),destroy:()=>{},isSupported:(e,t)=>{if(t!==s.DataLevel.Records)return Promise.resolve(!1);const a=e[0],{dataSource:n}=a;return 0===n.getSelectedRecordIds().length?Promise.resolve(!1):Promise.resolve(!0)},onExecute:(e,t,a)=>{const n=e[0],{dataSource:l}=n;return l.clearSelection(),s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(a,[],[l.id])),Promise.resolve(!0)}}]}(d),[d]),C=s.ReactRedux.useSelector(e=>{var t;return null===(t=e.appConfig.widgets[d].enableDataAction)||void 0===t||t}),M=s.ReactRedux.useSelector(e=>e.appConfig.widgets[d].config.resultPagingStyle),D=s.ReactRedux.useSelector(e=>e.appConfig.widgets[d].config.resultListDirection),N=Object.assign({},V,a),P=null!=M?M:f.MultiPage,O=null!=D?D:g.Vertical,T=s.React.useMemo(()=>{const e={dataSource:p,type:(null==R?void 0:R.length)>0?"selected":"loaded",records:(null==R?void 0:R.length)>0?R:(null==x?void 0:x.records)||[],name:null==p?void 0:p.id,label:null==p?void 0:p.getLabel()};if(N.resultFieldsType===m.SelectAttributes&&null!=N.resultDisplayFields)e.fields=Te(N.resultDisplayFields,N.resultTitleExpression);else if(p&&"getPopupInfo"in p){const t=p.getPopupInfo();(null==t?void 0:t.fieldInfos)&&(e.fields=t.fieldInfos.filter(e=>e.visible).map(e=>e.fieldName))}return e},[R,p,x,N]);s.hooks.useEffectOnce(()=>{(0,s.focusElementInKeyboardMode)(w.current)}),s.React.useEffect(()=>{b({records:c,pageSize:u,page:1})},[c,u]),s.React.useEffect(()=>{var e;p&&(s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(d,[],[p.id])),null===(e=p.selectRecordsByIds)||void 0===e||e.call(p,[]))},[a.resultSelectMode,p,d]);const E=s.React.useCallback(({dataItems:e,pageSize:t,page:a})=>{b({records:e,pageSize:t,page:a})},[]),k=s.React.useCallback(()=>{var e;const t=s.DataSourceManager.getInstance().getDataSource(null==p?void 0:p.id),a=null==t?void 0:t.getSelectedRecords(),n=null!==(e=null==t?void 0:t.getSelectedRecordIds())&&void 0!==e?e:[];let l=!1;l=n.length!==(null==R?void 0:R.length)||n.some(e=>null==R.find(t=>t.getId()===e)),l&&I(a)},[null==p?void 0:p.id,R]),L=s.React.useMemo(()=>(0,s.Immutable)({dataSourceId:a.outputDataSourceId,mainDataSourceId:a.outputDataSourceId}),[null==a?void 0:a.outputDataSourceId]),A=s.React.useCallback(()=>{(0,s.focusElementInKeyboardMode)(w.current)},[]),B=s.React.useCallback(e=>{var t,n,l;const r=e.getId();let o=null!==(t=p.getSelectedRecords())&&void 0!==t?t:[];const i=null!==(n=p.getSelectedRecordIds())&&void 0!==n?n:[];a.resultSelectMode===v.Multiple?i.includes(r)?o=o.filter(e=>e.getId()!==r):o.push(e):o=i.includes(r)?[]:[e],s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(d,o,[p.id])),null===(l=p.selectRecordsByIds)||void 0===l||l.call(p,o.map(e=>e.getId()))},[p,a.resultSelectMode,d]);return(0,r.jsxs)("div",{className:"query-result h-100",css:Ze,role:"listbox","aria-label":y("results"),children:[(0,r.jsx)(s.DataSourceComponent,{useDataSource:L,onDataSourceInfoChange:k}),(0,r.jsxs)("div",{className:"query-result__header d-flex align-items-center mx-4",children:[(0,r.jsx)(o.Button,{"aria-label":y("back"),ref:w,className:"p-0 mr-2",size:"sm",variant:"text",color:"inherit",icon:!0,onClick:()=>{h()},children:(0,r.jsx)(Je,{autoFlip:!0})}),null!==(t=N.resultsLabel)&&void 0!==t?t:y("results"),(0,r.jsxs)(s.React.Fragment,{children:[(0,r.jsx)(o.Tooltip,{title:y("clearResult"),placement:"bottom",children:(0,r.jsx)(o.Button,{className:"ml-auto",icon:!0,size:"sm",variant:"text",color:"inherit",onClick:()=>{var e;h(!0),b(null),null===(e=p.selectRecordsByIds)||void 0===e||e.call(p,[])},"aria-label":y("clearResult"),children:(0,r.jsx)(o.Icon,{icon:Ye.toolDelete})})}),C&&p&&(0,r.jsxs)(s.React.Fragment,{children:[(0,r.jsx)("div",{css:s.css`width: 1px; height: 16px; background-color: var(--sys-color-divider-input);`}),(0,r.jsx)(o.DataActionList,{widgetId:d,dataSets:[T],listStyle:o.DataActionListStyle.Dropdown,buttonSize:"sm",buttonType:"tertiary",extraActions:j})]})]})]}),(0,r.jsxs)("div",{className:"query-result-container mt-1",children:[(0,r.jsx)("div",{className:"query-result-info mb-2 px-4",role:"alert","aria-live":"polite",children:(()=>{var e;if(x){if(P===f.LazyLoad)return`${y("featuresDisplayed")}: ${null===(e=null==x?void 0:x.records)||void 0===e?void 0:e.length} / ${l}`;const{page:t=1,pageSize:a=u}=x,n=(t-1)*a+1,r=n+a-1;return l>0?`${y("featuresDisplayed")}: ${n} - ${Math.min(r,l)} / ${l}`:`${y("featuresDisplayed")}: 0 - 0 / 0`}return""})()}),P===f.LazyLoad&&l>0&&(0,r.jsx)(Fe,{widgetId:d,queryItem:a,outputDS:p,queryParams:n,resultCount:l,records:c,direction:O,onRenderDone:E,onEscape:A,onSelectChange:B}),P===f.MultiPage&&l>0&&(0,r.jsx)(Ve,{widgetId:d,queryItem:a,outputDS:p,queryParams:n,resultCount:l,maxPerPage:i,records:c,direction:O,onRenderDone:E,onEscape:A,defaultPageSize:u,onSelectChange:B})]})]})}var et=u(7835),tt=u.n(et),at=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const nt=e=>{const t=window.SVG,{className:a}=e,n=at(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?(0,r.jsx)(t,Object.assign({className:l,src:tt()},n)):(0,r.jsx)("svg",Object.assign({className:l},n))},lt=A.styled.div`
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  left: 0;
  z-index: 2;

  .loading-content {
    .loading-tip {
      position: relative;
    }
  }
`;function rt(){const e=s.hooks.useTranslation(S);return(0,r.jsx)(lt,{children:(0,r.jsxs)("div",{className:"loading-content w-100 px-4 d-flex flex-column justify-content-center align-items-center",children:[(0,r.jsx)("div",{role:"alert","aria-live":"assertive",className:"text-paper",children:e("retrieving")}),(0,r.jsx)(o.Loading,{className:"loading-tip mt-8",type:o.LoadingType.Donut})]})})}var st=function(e,t,a,n){return new(a||(a=Promise))(function(l,r){function s(e){try{i(n.next(e))}catch(e){r(e)}}function o(e){try{i(n.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,o)}i((n=n.apply(e,t||[])).next())})},ot=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const it=s.css`
  &.wrapped .query-form {
    height: 100%;
  }
  .query-task__content {
    display: flex;
    flex-direction: column;
    width: 100%;
    padding-top: 8px;
    &:has(> .query-form__header > div:not(.d-none)), &:has(> .query-result) {
      padding-top: 16px;
    }
  }
  .query-form__header {
    display: flex;
    &.has-content {
      border-bottom: 1px solid var(--sys-color-divider-secondary);
      margin-bottom: 6px;
      padding-bottom: 8px;
    }
    .nav-action {
      flex: 1 1 0;
      overflow: hidden;
      display: flex;
      .jimu-btn {
        min-width: 26px;
      }
    }
    .result-menu {
      display: flex;
    }
  }
`;function ct(e){var t,a,n;const{queryItem:c,onNavBack:u,total:d,isInPopper:g=!1,defaultPageSize:h=s.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE,wrappedInPopper:v=!1,className:y="",index:x}=e,b=ot(e,["queryItem","onNavBack","total","isInPopper","defaultPageSize","wrappedInPopper","className","index"]),R=s.hooks.useTranslation(S),[I,w]=s.React.useState(0),[j,C]=s.React.useState(!0),[M,D]=s.React.useState(0),N=s.React.useRef(null),P=s.React.useRef(null),[O,T]=s.React.useState(null),[E,k]=s.React.useState(null),[L,A]=s.React.useState(!0),B=s.React.useRef(c.sqlExprObj),z=s.React.useRef(null),F=s.React.useRef(void 0),[U,$]=s.React.useState(null),J=Object.assign({},V,c),{icon:W,name:H,displayLabel:Q}=J,Y=_({widgetId:e.widgetId,useDataSourceId:null===(t=J.useDataSource)||void 0===t?void 0:t.dataSourceId});s.hooks.useEffectOnce(()=>{(0,s.focusElementInKeyboardMode)(F.current)});const Z=s.ReactRedux.useSelector(t=>t.appConfig.widgets[e.widgetId].config.resultPagingStyle);s.React.useEffect(()=>{var e;(null===(e=c.useDataSource)||void 0===e?void 0:e.dataSourceId)&&s.DataSourceManager.getInstance().destroyDataSource(c.outputDataSourceId)},[null===(a=c.useDataSource)||void 0===a?void 0:a.dataSourceId,c.outputDataSourceId]);const X=s.React.useMemo(()=>(0,s.Immutable)({dataSourceId:c.outputDataSourceId,mainDataSourceId:c.outputDataSourceId}),[c.outputDataSourceId]),ee=s.React.useCallback(e=>{var t,a;const n=null!=e?e:E;if(null===(t=null==n?void 0:n.getDataSourceJson())||void 0===t?void 0:t.isOutputFromWidget){const e=n;null!=(null===(a=e.getCurrentQueryParams)||void 0===a?void 0:a.call(e)).geometry?A(!1):A(!0)}},[E]),te=s.React.useCallback(e=>{C(e),ee()},[ee]),ae=s.React.useCallback((e,t)=>{const a=c.outputDataSourceId,n=(null==e?void 0:e.widgetQueries)?e.widgetQueries[`setFilter-${a}`]:null;if(null==n)return;const l=(null==t?void 0:t.widgetQueries)?t.widgetQueries[`setFilter-${a}`]:null;(null==n?void 0:n.where)!==(null==l?void 0:l.where)&&$(n)},[c.outputDataSourceId]),ne=s.React.useCallback(()=>st(this,void 0,void 0,function*(){if(!O)return;const t=new s.DataRecordSetChangeMessage(e.widgetId,s.RecordSetChangeType.Remove,[O.id]);s.MessageManager.getInstance().publishMessage(t),yield s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(e.widgetId,[],[O.id]))}),[e.widgetId,O]),le=s.React.useCallback(()=>{P.current=null,null==O||O.setStatus(s.DataSourceStatus.NotReady),D(0),ne()},[O,ne]),re=s.React.useCallback(e=>{le(),k(e),ee(e),w(0)},[ee,le]),se=s.React.useCallback(e=>{T(e)},[]),oe=s.React.useCallback((e=!1)=>{e&&(P.current=null,null==O||O.setStatus(s.DataSourceStatus.NotReady),D(0),ne()),w(0),s.lodash.defer(()=>{(0,s.focusElementInKeyboardMode)(F.current)})},[O,ne]),ie=s.React.useCallback(()=>{w(1)},[]),ce=s.React.useCallback((t,a)=>st(this,void 0,void 0,function*(){B.current=t,z.current=a;const n=O;w(2),yield ne();let r=h;Z===f.LazyLoad&&(r=s.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE);const o=function(e,t,a,n,r,o){var c,u,d;const g=e.getDataSourceJson(),f=e.getOriginDataSources()[0];(null==g?void 0:g.isDataInDataSourceInstance)&&e.setSourceRecords(f.getSourceRecords());const{useAttributeFilter:h,useSpatialFilter:v,sortOptions:y,resultFieldsType:S,resultDisplayFields:x,resultTitleExpression:b}=n;let R=x;if(null==x){const t=e.getSchema();R=(null==t?void 0:t.fields)?Object.values(t.fields).map(e=>e.jimuName):[]}const I=e.mergeQueryParams(null!==(c=f.getCurrentQueryParams())&&void 0!==c?c:{},{where:h&&(null==t?void 0:t.sql)?s.dataSourceUtils.getArcGISSQL(t,e).sql:"1=1",sqlExpression:h&&(null==t?void 0:t.sql)?t:null}),w=Object.assign({returnGeometry:!0,page:r,pageSize:o},I);if(v&&(null==a?void 0:a.geometry)){const{geometry:e,relation:t=l.Intersect,buffer:n}=a,r={geometryType:s.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(e.type),geometry:e.toJSON(),spatialRel:i[t],distance:null==n?void 0:n.distance,units:(null==n?void 0:n.unit)?p[n.unit]:void 0};Object.assign(w,r)}if((null==y?void 0:y.length)>0&&Object.assign(w,{orderByFields:y.map(e=>`${e.jimuFieldName} ${e.order}`)}),S===m.SelectAttributes){const t=Te(R,b,e.getIdField());Object.assign(w,{outFields:t})}else{const e=f.getPopupInfo(),t=Object.values(null!==(u=f.getSchema().fields)&&void 0!==u?u:{}).map(e=>e.name),a=null===(d=null==e?void 0:e.fieldInfos)||void 0===d?void 0:d.filter(e=>!1!==e.visible&&t.includes(e.fieldName));Object.assign(w,{outFields:null==a?void 0:a.map(e=>e.fieldName)})}return w}(n,t,a,J,1,r);N.current=o,n.setStatus(s.DataSourceStatus.Unloaded),n.setCountStatus(s.DataSourceStatus.Unloaded),function(e,t,a){return Oe(this,void 0,void 0,function*(){const n=yield t.loadCount(a,{widgetId:e,refresh:!0});return null!=n?n:0})}(e.widgetId,n,o).then(t=>(D(t),n.updateQueryParams(N.current,e.widgetId),ke(e.widgetId,0,n,N.current))).then(e=>{P.current=e.records}).finally(()=>{(null==a?void 0:a.layer)&&(null==a?void 0:a.clearAfterApply)&&a.layer.removeAll(),w(1)})}),[J,c,e.widgetId,O,h,Z,ne]),{useAttributeFilter:ue,sqlExprObj:de,useSpatialFilter:pe,spatialFilterTypes:ge,spatialIncludeRuntimeData:fe,spatialRelationUseDataSources:me}=J,ve=ue&&null!=de,ye=L&&pe&&(ge.length>0||fe||(null==me?void 0:me.length)>0);return(0,r.jsxs)("div",{className:(0,s.classNames)("query-task h-100 d-flex",y,{wrapped:v}),css:it,children:[(0,r.jsxs)("div",{className:(0,s.classNames)("query-task__content",{"d-none":0!==I,[o.FOCUSABLE_CONTAINER_CLASS]:1!==I&&g}),children:[(0,r.jsx)(s.DataSourceComponent,{useDataSource:X,onDataSourceCreated:se,onDataSourceInfoChange:ae}),(0,r.jsxs)("div",{className:(0,s.classNames)("query-form__header mx-4 align-items-center",{"in-popper":g,"has-content":ve||ye}),children:[(0,r.jsxs)("div",{className:(0,s.classNames)("nav-action align-items-center",{"d-none":v}),children:[(0,r.jsx)(o.Button,{className:(0,s.classNames)("p-0 mr-2",{"d-none":1===d}),size:"sm",type:"tertiary",icon:!0,onClick:u,"aria-label":R("back"),ref:F,children:(0,r.jsx)(Je,{autoFlip:!0})}),(0,r.jsx)(G,{icon:W,name:Q?H:""})]}),(0,r.jsxs)("div",{className:(0,s.classNames)("result-menu ml-auto align-items-center",{"d-none":0===M}),children:[(0,r.jsx)(o.Tooltip,{title:R("checkResult"),placement:"bottom",children:(0,r.jsx)(o.Button,{size:"sm",type:"tertiary","aria-label":R("checkResult"),icon:!0,className:"py-0",onClick:ie,children:(0,r.jsx)(nt,{})})}),(0,r.jsx)("div",{css:s.css`width: 1px; height: 16px; background-color: var(--sys-color-divider-input);`}),(0,r.jsx)(o.Tooltip,{title:R("clearResult"),placement:"bottom",children:(0,r.jsx)(o.Button,{size:"sm",type:"tertiary","aria-label":R("clearResult"),icon:!0,className:"py-0",onClick:le,children:(0,r.jsx)(K,{})})})]})]}),j&&Y&&(0,r.jsx)(he,Object.assign({},b,{configId:c.configId,outputDS:O,datasourceReady:null!=E,spatialFilterEnabled:L,dataActionFilter:U,onFormSubmit:ce})),(0,r.jsx)(q,{widgetId:e.widgetId,useDataSource:c.useDataSource,showMessage:!0,onStatusChange:te,onDataSourceCreated:re})]}),(0,r.jsx)("div",{className:(0,s.classNames)("query-task__content",{"d-none":1!==I,[o.FOCUSABLE_CONTAINER_CLASS]:1===I&&g}),children:(0,r.jsx)(Xe,{widgetId:e.widgetId,queryItem:c,queryParams:N.current,resultCount:M,maxPerPage:null===(n=null==E?void 0:E.getMaxRecordCount)||void 0===n?void 0:n.call(E),records:P.current,defaultPageSize:h,outputDS:O,onNavBack:oe},c.configId)}),2===I&&(0,r.jsx)(rt,{})]})}const ut=()=>({name:L.TreeItemActionType.RenderOverrideItem,children:[{name:L.TreeItemActionType.RenderOverrideItemBody,children:[{name:L.TreeItemActionType.RenderOverrideItemMainLine}]}]});function dt(e){var t;const{queryItems:a,widgetId:n,defaultPageSize:l,isInPopper:i=!1,className:c=""}=e,[u,d]=s.React.useState(0),[p,g]=s.React.useState((0,s.Immutable)({})),[f,m]=s.React.useState({index:0,id:null===(t=null==a?void 0:a[0])||void 0===t?void 0:t.configId}),h=s.React.useMemo(()=>{var e;const{index:t,id:n}=f;if(t>=0){if((null===(e=a[t])||void 0===e?void 0:e.configId)===n)return t;let l=-1;return a.find((e,t)=>e.configId===n&&(l=t,!0)),-1===l&&(d(0),m({index:-1,id:null})),l}return t},[a,f]);return(0,r.jsxs)("div",{className:`runtime-query__query-list h-100 ${c}`,css:s.css`.jimu-tree-item__body {width: 100%;}`,children:[0===u&&a.length>1&&(0,r.jsx)(L.List,{itemsJson:Array.from(a).map((e,t)=>{var a;return{itemStateDetailContent:e,itemStateDisabled:null!==(a=p[e.configId])&&void 0!==a&&a,itemKey:`${t}`}}),overrideItemBlockInfo:ut,onClickItemBody:(e,t)=>{const{itemJsons:a}=t.props,n=a[0];((e,t)=>{d(1),m({index:e,id:t})})(+n.itemKey,n.itemStateDetailContent.configId)},renderOverrideItemMainLine:(e,t)=>{const{itemJsons:l}=t.props,s=l[0],o=s.itemStateDetailContent,i=+s.itemKey;return(0,r.jsx)(W,{widgetId:n,index:i,queryItem:o,onStatusChange:e=>{((e,t)=>{const n=a[e].configId;g(e=>e.set(n,!t))})(i,e)}},o.configId)},className:`pt-4 px-4 ${i?o.FOCUSABLE_CONTAINER_CLASS:""}`}),(1===u||1===a.length)&&(0,r.jsx)(ct,{widgetId:n,index:a.length>1&&h>=0?h:0,total:a.length,queryItem:a[a.length>1&&h>=0?h:0],onNavBack:()=>{d(0),m({index:-1,id:null})},defaultPageSize:l,isInPopper:i})]})}const pt={padding:1};function gt(e){const{id:t,icon:a,label:n,forceClose:l,onOpenedChange:i,popperTitle:c,minSize:u,defaultSize:d,onWidthChange:p,buttonType:g="tertiary",children:f}=e,m=s.React.useRef(void 0),h=s.React.useRef(0),[v,y]=s.React.useState(!1),[S,x]=s.React.useState(0),b=s.hooks.useCheckSmallBrowserSizeMode();s.React.useEffect(()=>{l&&y(!1)},[l]),s.hooks.useEffectOnce(()=>{if("function"==typeof p){h.current=Math.round(m.current.clientWidth),p(t,h.current);const e=new ResizeObserver(s.lodash.throttle(e=>{const a=Math.round(e[0].contentRect.width);h.current!==a&&(h.current=a,p(t,a))},200));return e.observe(m.current),()=>{e.disconnect()}}});const R=s.React.useCallback(()=>{"function"==typeof i&&i(t,!v),y(!v),x(S+1),v&&setTimeout(()=>{(0,s.isKeyboardMode)()&&(0,s.focusElementInKeyboardMode)(m.current)},200)},[t,v,S,i]);return(0,r.jsxs)("div",{className:"runtime-query__widget-popper",children:[(0,r.jsxs)(o.Button,{title:n,"aria-label":n,icon:!0,size:"sm",variant:"tertiary"===g?"text":void 0,color:"tertiary"===g?"inherit":void 0,type:"tertiary"===g?void 0:g,ref:m,onClick:R,children:[a&&(0,r.jsx)(o.Icon,Object.assign({size:16},"string"==typeof a?{icon:a}:{icon:a.svg,color:"tertiary"===g?void 0:a.properties.color})),n&&(0,r.jsx)("div",{css:s.css`
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            word-break: break-word;
            word-wrap: break-word;
            line-height: 1.2;
          `,className:(0,s.classNames)({"ml-2":null!=a}),children:n})]}),b?(0,r.jsx)(o.MobilePanel,{open:v,title:c,onClose:R,children:f}):(0,r.jsx)(o.FloatingPanel,{className:"ui-unit-popper ui-unit-popper_k-arrangement-icon flex-grow-1",headerClassName:o.FOCUSABLE_CONTAINER_CLASS,open:v,onHeaderClose:R,toggle:R,headerTitle:c,minSize:u,defaultSize:d,dragBounds:"body",version:S,reference:m,placement:"bottom-start",shiftOptions:pt,children:f})]})}const{iconMap:ft}=T(),mt=s.css`
  > div {
    margin-right: 8px;
  }
`;function ht(e){const{queryItems:t,widgetId:a,minSize:n,defaultSize:l,defaultPageSize:o,widgetLabel:i,wrap:c=!1}=e,u=s.React.useRef(void 0),d=s.React.useRef(0),p=s.React.useRef({}),[g,f]=s.React.useState(t.length),[m,h]=s.React.useState(-1),v=s.React.useRef(null),y=s.React.useCallback(()=>{let e=0;for(let a=0;a<g;a++){const n=t[a],l=p.current[n.configId];if(!(l>0))return;if(e+=l+8,e>=d.current&&g!==a)return void f(a)}f(t.length)},[g,t]);s.React.useEffect(()=>(v.current&&v.current.disconnect(),v.current=new ResizeObserver(s.lodash.throttle(e=>{const t=Math.round(e[0].contentRect.width);d.current!==t&&(d.current=t,y())},200)),v.current.observe(u.current),()=>{v.current.disconnect()}),[y]),s.hooks.useEffectOnce(()=>{var e;d.current=null===(e=u.current)||void 0===e?void 0:e.clientWidth,y()});const S=s.React.useCallback((e,a)=>{const n=t[e];p.current[n.configId]!==a&&(p.current[n.configId]=a,y())},[t,y]),x=s.React.useCallback((e,t)=>{t?h(e):e===m&&h(-1)},[m]),[b,R]=s.React.useMemo(()=>{const e=[],a=[];for(let n=0;n<t.length;n++)n<g?e.push(t[n]):a.push(t[n]);return[e,a]},[t,g]);return(0,r.jsxs)("div",{ref:u,css:mt,className:(0,s.classNames)("runtime-query__query-list h-100 d-flex",{"flex-wrap":c,"align-content-start":c}),children:[b.map((e,t)=>{const s=Object.assign({},V,e);return(0,r.jsx)(gt,{id:t,icon:s.icon,buttonType:"default",label:s.displayLabel?s.name:void 0,popperTitle:s.name,onWidthChange:S,minSize:n,defaultSize:l,onOpenedChange:x,forceClose:m>=0&&m!==t,children:(0,r.jsx)(ct,{widgetId:a,index:t,total:1,isInPopper:!0,queryItem:s,wrappedInPopper:!0,className:"pb-4",defaultPageSize:o})},s.configId)}),R.length>0&&(0,r.jsx)(gt,{id:b.length+1,icon:ft.iconMore,minSize:n,buttonType:"default",popperTitle:i,defaultSize:l,onOpenedChange:x,forceClose:m>=0&&m!==b.length+1,children:(0,r.jsx)(dt,{widgetId:a,isInPopper:!0,defaultPageSize:o,queryItems:R,className:"pb-4"})})]})}const{iconMap:vt}=T();class yt extends s.React.PureComponent{render(){var e,t,n,l,s,i,c,u,d;const{config:p,id:g,icon:f,label:m,layoutId:h,layoutItemId:v,controllerWidgetId:y}=this.props,x=this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:S._widgetLabel});return(null===(e=p.queryItems)||void 0===e?void 0:e.length)?p.arrangeType!==a.Popper||y?p.arrangeType!==a.Inline||y?(0,r.jsx)(o.Paper,{variant:"flat",className:"jimu-widget runtime-query pb-4",children:(0,r.jsx)(ge.Provider,{value:`${h}:${v}`,children:(0,r.jsx)(dt,{widgetId:g,queryItems:p.queryItems,defaultPageSize:p.defaultPageSize})})}):(0,r.jsx)(ge.Provider,{value:`${h}:${v}`,children:(0,r.jsx)(ht,{widgetId:g,widgetLabel:m,wrap:p.arrangeWrap,queryItems:p.queryItems,minSize:null===(c=null===(i=p.sizeMap)||void 0===i?void 0:i.arrangementIconPopper)||void 0===c?void 0:c.minSize,defaultSize:null===(d=null===(u=p.sizeMap)||void 0===u?void 0:u.arrangementIconPopper)||void 0===d?void 0:d.defaultSize,defaultPageSize:p.defaultPageSize})}):(0,r.jsx)(ge.Provider,{value:`${h}:${v}`,children:(0,r.jsx)(gt,{id:0,icon:f,popperTitle:m,minSize:null===(n=null===(t=p.sizeMap)||void 0===t?void 0:t.arrangementIconPopper)||void 0===n?void 0:n.minSize,defaultSize:null===(s=null===(l=p.sizeMap)||void 0===l?void 0:l.arrangementIconPopper)||void 0===s?void 0:s.defaultSize,children:(0,r.jsx)(dt,{widgetId:g,isInPopper:!0,queryItems:p.queryItems,defaultPageSize:p.defaultPageSize,className:"pb-4"})})}):(0,r.jsx)(o.WidgetPlaceholder,{icon:vt.iconQuery,widgetId:this.props.id,name:x})}}yt.versionManager=k;const St=yt;function xt(e){u.p=e}})(),d})())}}});