/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-64d05c.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-64d05c"],{36486:(e,t,i)=>{i.d(t,{u:()=>r});var a=i(83552),s=i(73679);const r=(0,a.yr)(s.g)},42855:(e,t,i)=>{i.d(t,{a:()=>n,f:()=>a,l:()=>s,s:()=>r});var a=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(a||{}),s=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(s||{}),r=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(r||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},47640:(e,t,i)=>{i.d(t,{YZ:()=>n,e1:()=>s});var a=i(4836);const s={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const a="object"==typeof t?t:{task:t,args:i};this.v=a.task,this.j=a.args,this.m=a.argsEqual??l,this.k=a.onComplete,this.A=a.onError,this.autoRun=a.autoRun??!0,"initialValue"in a&&(this.u=a.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const a=++this.p;this.q=new AbortController;let s=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){s=!0,i=e}if(this.p===a){if(t===r)this.i=0;else{if(!1===s){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const l=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,a.Ec)(e,t[i]))},66228:(e,t,i)=>{i.d(t,{a:()=>w,b:()=>C,c:()=>_,d:()=>q,e:()=>k,f:()=>P,g:()=>g,h:()=>f,i:()=>h,j:()=>m,k:()=>F,l:()=>R,m:()=>I,n:()=>d,o:()=>x,p:()=>N,q:()=>$,r:()=>L,s:()=>v,t:()=>E,u:()=>b});var a=i(63438),s=i(18423),r=i(96086),n=i(91813),l=i(21255),o=i(13078),c=i(21303),u=i(12627),p=i(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],y=["feature"];function h(e){return null!=e}function m(e,t,i){const a=t.fieldName;if(a.includes(p.f.expression)){const e=i.get(a);return e?.title?e.title:a}return v(e)&&e.getFieldConfiguration(a)?e.getFieldAlias(a)||a:t.label||a}async function g(e){return new Map((await F(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function f(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${p.f.expression}${e.name}`;t.set(i,e)}),t}function w(e){return"map-image"===e?.layer?.type?p.s.mapImage:"subtype-sublayer"===e?.type?p.s.subtype:"tile"===e?.layer?.type?p.s.tile:"scene"===e?.type?p.s.scene:"ogc-feature"===e?.type?p.s.ogcFeature:"imagery"===e?.type?p.s.imagery:"imagery-tile"===e?.type?p.s.imageryTile:"wfs"===e?.type?p.s.wfs:"wcs"===e?.type?p.s.wcs:"wms"===e?.layer?.type?p.s.wms:"csv"===e?.type?p.s.csv:"geojson"===e?.type?p.s.geojson:"stream"===e?.type?p.s.stream:"oriented-imagery"===e?.type?p.s.orientedImagery:"catalog"===e?.type?p.s.catalog:"catalog-footprint"===e?.type?p.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?p.s.knowledgeGraphSublayer:"voxel"===e?.type?p.s.voxel:"parquet"===e?.type?p.s.parquet:p.s.feature}function b(e){const t=w(e);let i;return t===p.s.wms||t===p.s.mapImage?i=e?.layer.version:(t===p.s.imagery||t===p.s.feature||t===p.s.scene)&&(i=e.version),Number.parseFloat(i)}function v(e){return"fieldConfigurations"in e&&y.includes(e.type)}async function F(e){return await new Promise((t,i)=>{switch(w(e)){case p.s.feature:case p.s.ogcFeature:case p.s.stream:t(e.fields);break;case p.s.mapImage:{const a=e,s=a?.layer;s?.portalItem&&s.url.includes("https://demographics")&&s.url.includes(".arcgis.com")?s.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(a.fields.map(e=>[e.name,e])),s=e.thematicGroup.fieldNames,r=[];s.forEach(e=>{i.has(e)&&r.push(i.get(e))}),t(r)}else t(a.fields)}).catch(e=>{i(new Error(e))}):t(a.fields);break}case p.s.imagery:case p.s.imageryTile:case p.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function x(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function I(e){return Number((100*(1-e)).toFixed(1))}function E(e){return Number((1-e/100).toFixed(3))}const q=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(p.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},C=async(e,t)=>{const i=new u.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},k=async(e,t,i)=>{const a=await(await e.whenLayerView(t)).queryAggregates();return await T(i,a.features?.[0])},T=async(e,t)=>{let i;if(t)i=t.clone();else{i=new a.default;const t=q(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const r=new s.default;i.geometry=r}return i};function $(e,t){const i=t.startsWith("#"),a=t.startsWith(".");for((a||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(a){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function _(e){if(w(e)===p.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===p.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function R(e,t,i){let a="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))a="number";else if(t.has(e)){const i=t.get(e);a=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);a=t.returnType?t.returnType.toLowerCase():""}else a="number";return a}async function P(e,t){try{const i=w(e);if(i===p.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await C(e,t)||await O(e,t)]};if(i===p.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await O(e,t)]};const a=i===p.s.ogcFeature||i===p.s.stream?await t.whenLayerView(e):e,s=a.createQuery();s.where=a.definitionExpression||"1=1",s.outFields=["*"],s.returnM="hasM"in e&&e.hasM,s.returnZ="hasZ"in e&&e.hasZ,s.outSpatialReference=t.spatialReference,s.returnGeometry=!0,(a.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===p.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=t.spatialReference;const r=await a.queryFeatures(s);return r?.features?.length||(r.features[0]=await O(e,t)),r}catch(e){console.error(e)}}async function O(e,t){return await new Promise(i=>{const s=new a.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),s.attributes=t}const c=t.extent;let u;"polygon"===e.geometryType?u=l.default.fromExtent(c):"point"===e.geometryType?u=c.center.clone():"multipoint"===e.geometryType?u=new r.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(u=new n.default({spatialReference:t.spatialReference.clone()}),u.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(u=o.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),s.geometry=u,i(s)})}function L(e){return w(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function N(e){return w(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},75477:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigDisplayFilter:()=>d});var a=i(73679),s=i(4395),r=i(54312),n=i(73801),l=i(47640),o=i(60701),c=i(36486),u=i(66228);const p=s.AH`.disabled{opacity:var(--calcite-opacity-disabled)}.wrapper-node{margin:var(--calcite-spacing-sm) var(--calcite-spacing-xs) 0}.mapview-level-label{border-bottom:1px solid var(--calcite-color-border-3)}.filter-description-padding{margin-left:var(--calcite-spacing-md)}:dir(rtl){.filter-description-padding{margin-right:var(--calcite-spacing-md)}}`;class d extends n.WF{constructor(){super(...arguments),this._propWatcherTask=new l.YZ(this,{task:async([e])=>{if(!(0,u.i)(e))throw console.error("[arcgis-map-config-display-filter] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,this.init()},args:()=>[this.mapView]}),this._messages=(0,c.u)({blocking:!0}),this.arcgisChange=(0,n.lh)()}static{this.properties={mapView:0,layer:0}}static{this.styles=p}disconnectedCallback(){super.disconnectedCallback(),this.layersHandle?.remove(),this.displayFilterEnabledHandle?.remove()}init(){this.layersHandle||(this.layersHandle=r.watch(()=>this.mapView.map?.allLayers?.length,()=>this.requestUpdate())),this.displayFilterEnabledHandle||(this.displayFilterEnabledHandle=r.watch(()=>this.mapView.displayFilterEnabled,e=>{e||this.requestUpdate()}))}render(){return this._propWatcherTask.render({complete:()=>{const{_messages:e,mapView:t,layer:i}=this,{map:a}=t,r=a?.allLayers,l=(i?.displayFilterInfo?[i]:r?.filter(e=>(0,u.i)(e.displayFilterInfo)).toArray()).map(e=>this.renderDisplayFilterLayerInfo(e));return l?.length?s.qy`${this.renderDisplayFilterMapViewInfo()}<div class=${(0,n.CP)(t.displayFilterEnabled?"":"disabled")}>${l}</div>`:s.qy`<div>${e.noDisplayFilters}</div>`}})}renderDisplayFilterMapViewInfo(){const{mapView:e,layer:t,_messages:i}=this;return t?"":s.qy`<calcite-label class="mapview-level-label" layout=inline-space-between>${i.enableDisplayFilters}<calcite-switch .checked=${e.displayFilterEnabled} @calciteSwitchChange=${()=>{e.displayFilterEnabled=!e.displayFilterEnabled,this.requestUpdate(),this.arcgisChange.emit()}}></calcite-switch></calcite-label>`}renderDisplayFilterLayerInfo(e){const{_messages:t}=this,i=!(0,u.i)(this.layer),{displayFilterInfo:a}=e,{mode:r}=a;if("manual"===r&&!a.filters.some(e=>e.id===a.activeFilterId)){e.displayFilterEnabled=!1;const t=a.clone();t.activeFilterId=t.filters.getItemAt(0).id,e.displayFilterInfo=t,this.arcgisChange.emit()}return s.qy`<div class="wrapper-node"><calcite-label layout=inline-space-between>${i?e.title:t.enableDisplayFilter}<calcite-switch .checked=${e.displayFilterEnabled} .disabled=${!this.mapView.displayFilterEnabled} @calciteSwitchChange=${()=>{e.displayFilterEnabled=!e.displayFilterEnabled,this.requestUpdate(),this.arcgisChange.emit()}}></calcite-switch></calcite-label>${this.renderLayerControls(e)}</div>`}renderLayerControls(e){const{_messages:t}=this,{displayFilterEnabled:i,displayFilterInfo:a}=e,{mode:r}=a;if(!i)return"";if("manual"===r){const t=a.filters.map(e=>s.qy`<calcite-label layout=inline><calcite-radio-button .disabled=${!this.mapView.displayFilterEnabled} .value=${e.id} .checked=${a.activeFilterId===e.id}></calcite-radio-button>${e.title}</calcite-label>`);return s.qy`<div class="filter-description-padding"><calcite-radio-button-group .disabled=${!this.mapView.displayFilterEnabled} layout=vertical .name=${`manual-filters-${(0,o.DA)()}`} @calciteRadioButtonGroupChange=${t=>{const i=t.target.selectedItem.value,s=a.clone();s.activeFilterId=i,e.displayFilterInfo=s,this.requestUpdate(),this.arcgisChange.emit()}}>${t.toArray()}</calcite-radio-button-group></div>`}return s.qy`<div class="filter-description-padding">${t.scaleDisplayFilterDescription}</div>`}}(0,a.c)("arcgis-map-config-display-filter",d)}}]);