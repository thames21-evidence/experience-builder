/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_query--5033d2.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_query--5033d2"],{14270:(e,t,r)=>{r.d(t,{M:()=>G,a:()=>Y,b:()=>B,c:()=>te,d:()=>K,e:()=>Q,f:()=>Z,g:()=>N,h:()=>U,i:()=>H,j:()=>f,k:()=>ee,q:()=>V,u:()=>S});var n=r(52995),i=r(29599),o=r(88878),a=r(96295),s=r(83692),l=r(4429),c=r(41473),u=r(94737),p=r(44388),d=r(63263),g=r(1536),y=r(80562),m=r(18944);async function f(e){const t=(0,c.e)(e),{collaborations:r}=await(0,s.r)(`${t}portals/self/collaborationsSummary`,{includeParticipantInfo:!0});return r}async function v(e,t,r,n,i){return async function(e,t,r,n,i){const o=(0,c.e)(r);return await(0,s.r)(`${o}portals/self/collaboratedItems`,Object.assign(Object.assign({collaborationId:e},t?{participantId:t}:{}),{start:n,num:i}))}(e,t,r,n,i)}function b(e,t){const r=S(e).scopes[t];if(!r)throw new Error(`No query found for scope: ${t}`);return function(e){const t=e.filters.map(k),r=A(t.filter($),"AND"),n=function(e,t){let r=null;const n=t.filter(t=>t.predicates.find(t=>!O(t[e])));if(n.length>1)throw new Error(`Only 1 IFilter can have a '${e}' predicate but ${n.length} were detected`);if(n.length){const t=n[0],i=t.predicates.filter(t=>!O(t[e]));if(i.length>1)throw new Error(`Only 1 '${e}' predicate is allowed but ${i.length} were detected`);if("AND"!==t.operation&&t.predicates.length>1)throw new Error(`'${e}' predicates cannot be OR'd to other predicates`);const o=i[0],a=o[e];if(!("string"==typeof a||"boolean"==typeof a))throw new Error(`'${e}' predicate must be a string or boolean primitive. string[] and IMatchOptions are not allowed.`);r=o}return r}("bbox",e.filters);n&&(r.params={bbox:n.bbox});return r}(function(e){const t=function(e){const t=structuredClone(e);return t.filters=t.filters.map(e=>{let t=!1;return e.predicates=e.predicates.reduce((e,r)=>{if(function(e){let t=!1;"string"==typeof e&&(t=e in L);return t}(r.type)){const i=(n=r.type,L[n]);e=[...e,...i],t=!0}else r.type&&"string"!=typeof r.type&&!Array.isArray(r.type)?(Object.keys(r.type).forEach(e=>{const t=r.type[e];Array.isArray(t)&&(r.type[e]=t.reduce((e,t)=>{if(function(e){let t=!1;e&&"$"===e.charAt(0)&&W.includes(e.slice(1))&&(t=!0);return t}(t)){const r=function(e){let t;switch(e.toLowerCase()){case"content":t=x("other"),t=t.concat(["CAD Drawing","Feature Collection Template","Report Template"]);break;case"template":t=[...x("template"),...x("solution")];break;case"dataset":t=x(e.toLowerCase()).filter(e=>"Feature Collection Template"!==e&&"Raster Layer"!==e&&"Microsoft Excel"!==e),t=t.concat("Image Service");break;case"map":t=x(e.toLowerCase()).filter(e=>"Image Service"!==e),t=t.concat(["Raster Layer"]);break;case"document":t=x(e.toLowerCase()).filter(e=>"CAD Drawing"!==e&&"Report Template"!==e),t=t.concat("Microsoft Excel");break;case"project":t=["Hub Project"];break;case"discussion":t=["Discussion"];break;case"initiative":t=["Hub Initiative"];break;default:t=x(e.toLowerCase())}return t}(t.slice(1));e=[...e,...r]}else e.push(t);return e},[]))}),e.push(r)):e.push(r);var n;return e},[]),t&&(e.operation="OR"),e}),t}(e);return function(e){const t=structuredClone(e);return t.filters=t.filters.map(e=>(e.predicates=e.predicates.map(T),e)),t}(t)}(r))}const h=1;function S(e){if(D(e,"schemaVersion")===h)return e;{let t=structuredClone(e);return t=function(e){if(D(e,"schemaVersion")>1)return e;{const t={schemaVersion:1,title:"Default Catalog",scopes:{item:{targetEntity:"item",filters:[]},event:{targetEntity:"event",filters:[]}},collections:[]},r=D(e,"groups")||[];let n=[];Array.isArray(r)&&r.length?n=r:"string"==typeof r&&(n=[r]),n.length&&(t.scopes=Object.entries(t.scopes).reduce((e,t)=>Object.assign(Object.assign({},e),{[t[0]]:Object.assign(Object.assign({},t[1]),{filters:[{predicates:[{group:n}]}]})}),{}));const i=D(e,"orgId");return i&&(t.scopes.item={targetEntity:"item",filters:[]},t.scopes.event={targetEntity:"event",filters:[]},t.scopes=Object.entries(t.scopes).reduce((e,t)=>{const r=t[0],n=t[1];return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},n),{filters:[{operation:"AND",predicates:w[r](i)}]})})},{})),t}}(t),t}}const w={item:e=>[{orgid:[e]},{type:{not:["Code Attachment"]}}],event:e=>[{orgId:e}],group:e=>[{orgid:e}],user:e=>[{orgid:e}]};function k(e){const t=e.operation||"AND",r=e.predicates.map(T),n=A(r.map(M).filter(e=>null!=e),t);return r.length>1&&(n.q=`(${n.q})`),n}function A(e,t){return e.reduce((e,r)=>(Object.entries(r).forEach(([r,n])=>{e[r]&&""!==n?e[r]=`${e[r]} ${t} ${n}`:""!==n&&(e[r]=n)}),e),{q:""})}function P(e,t,r){let n="";return Array.isArray(r)&&r.length?(n=`${t}:"${r.join(`" ${e} ${t}:"`)}"`,r.length>1&&(n=`(${n})`)):n=`${t}:"${r}"`,n}function $(e){return!(null==e||""===e)}function M(e){const t=["created","modified"],r=["isopendata","isviewonly"],n=["searchUserAccess","searchUserName","memberType","name","categoriesAsParam","categoryFilter","bbox","joined"],i=["filterType","term",...t,...r,...n],o=["access","capabilities","created","categories","categoriesAsParam","categoryFilter","description","disabled","email","emailstatus","firstname","fullname","group","id","isInvitationOnly","isopendata","joined","lastlogin","lastname","memberType","modified","name","orgid","orgIds","owner","provider","role","searchUserAccess","searchUserName","snippet","tags","term","title","type","typekeywords","userlicensetype","username","isviewonly"],a=Object.entries(e).map(([e,a])=>{if(o.includes(e)){const o={q:""};return i.includes(e)||"term"===e||(o.q=function(e,t){var r,n,i;let o="";return(null===(r=t.any)||void 0===r?void 0:r.length)&&(o=`${P("OR",e,t.any)}`),(null===(n=t.all)||void 0===n?void 0:n.length)&&(o=(o?o+" AND ":"")+`${P("AND",e,t.all)}`),(null===(i=t.not)||void 0===i?void 0:i.length)&&(o=(o?o+" AND ":"")+`${P("OR",`-${e}`,t.not)}`),o}(e,a)),(t.includes(e)||function(e){return"object"==typeof e&&null!==e&&["from","to"].every(t=>void 0!==e[t])}(a))&&(o.q=function(e,t){return`${e}:[${t.from} TO ${t.to}]`}(e,a)),r.includes(e)&&(o.q=`${e}:${a}`),n.includes(e)&&(o[e]="joined"===e?`${a.from},${a.to}`:a),"term"===e&&(o.q=a),o}}).filter($);if(a.length){const e=A(a,"AND");return e.q&&(e.q=`(${e.q})`),e}return null}function O(e){return null==e||""===e}const j=["created","modified","lastlogin"],C=["bbox","categoriesAsParam","categoryFilter","filterType","isopendata","isviewonly","memberType","name","searchUserAccess","searchUserName","term","openData"];const I=[...j,...C];function T(e){const t={};return Object.entries(e).forEach(([r,n])=>{if(I.includes(r)||E(r,function(e){let t={};Array.isArray(e)?t={any:e}:("string"==typeof e&&(t={any:[e]}),"object"==typeof e&&(t=e));return t}(n),t),j.includes(r)){const n=structuredClone(D(e,r));"relative-date"===D(e,`${r}.type`)?E(r,function(e){const t={min:6e4,hours:36e5,days:864e5,weeks:6048e5},r=new Date,n={type:"date-range",from:r.getTime(),to:r.getTime()};switch(e.unit){case"hours":case"days":case"weeks":n.from=n.to-t[e.unit]*e.num;break;case"months":r.setMonth(r.getMonth()-e.num),n.from=r.getTime();break;case"years":r.setFullYear(r.getFullYear()-e.num),n.from=r.getTime()}return n}(n),t):E(r,n,t)}C.includes(r)&&Object.prototype.hasOwnProperty.call(e,r)&&E(r,n,t)}),t}function E(e,t,r,n=!1){Array.isArray(e)&&(e=e.join(".")),function(e,t,r={},n=!1){const i=t.split(".");let o=e;const a=i.length-1;i.forEach((e,t)=>{o.hasOwnProperty(e)&&null!=o[e]?t===a&&("object"!=typeof o[e]||Array.isArray(o[e])?o[e]=r:o[e]=n?structuredClone(r):Object.assign(o[e],structuredClone(r))):o[e]=t===a?r:{},o=o[e]})}(r,e,t,n)}function D(e,t){return t.split(".").reduce(function(t,r){const n=r.match(/\[(.*?)\]$/);if(n){const e=n[1],i=r.replace(n[0],"");if(parseInt(e,10)>-1){const r=parseInt(e,10);return Array.isArray(t[i])&&t[i][r]?t[i][r]:void 0}return function(e,t){const r=t.split("(");if(!r||2!==r.length)return;let n;const i=r[0],o=r[1].replace(")","").split(",").map(e=>e.trim());if("findBy"===i){const t=o[0];let r;a=o[1],r=isNaN(parseFloat(a))?o[1].replace(/'/g,""):parseFloat(o[1]),n=e.find(e=>e[t]===r)}else n=void 0;var a;return n}(t[i],e)}return t&&void 0!==t[r]?null!==t[r]&&t[r].$use?D(e,t[r].$use):t[r]:void 0},e)}const L={$application:[{type:{any:["Web Mapping Application","Application","Insights","Web Experience"],not:["Insights Theme","Insights Model"]},typekeywords:{not:["hubSite","Story Map"]}},{type:"Web Mapping Experience",typekeywords:"EXB Experience"}],$dashboard:[{type:{any:["Dashboard"],not:["Operation View"]},typekeywords:{not:["Extension","ArcGIS Operation View"]}}],$dataset:[{type:{any:["Scene Service","Feature Collection","Route Layer","Layer","Explorer Layer","Tile Package","Vector Tile Package","Scene Package","Layer Package","Feature Service","Stream Service","Map Service","Vector Tile Service","Image Service","WMS","WFS","WMTS","KML","KML Collection","Globe Service","CSV","Shapefile","GeoJson","Service Definition","File Geodatabase","CAD Drawing","Relational Database Connection"],not:["Web Mapping Application","Geodata Service"]}},{typekeywords:["OGC","Geodata Service"]}],$document:[{type:["PDF","Microsoft Excel","Microsoft Word","Microsoft Powerpoint","iWork Keynote","iWork Pages","iWork Numbers","Visio Document","Document Link"]}],$initiative:[{type:"Hub Initiative",typekeywords:"hubInitiativeV2"}],$experience:[{type:"Web Experience"}],$feedback:[{type:"Form"}],$page:[{typekeywords:"hubPage"}],$site:[{type:["Hub Site Application","Site Application"]}],$storymap:[{type:"Storymap"},{type:"Web Mapping Application",typekeywords:"Story Map"}],$template:[{type:["Web Mapping Application","Hub Initiative","Hub Initiative Template","Solution"],typekeywords:{any:["hubInitiativeTemplate","hubSolutionTemplate","Template"],not:"Deployed"}}],$webmap:[{type:{any:["Web Map","Web Scene"],not:"Web Mapping Application"}}]};const W=["app","content","dataset","document","event","feedback","initiative","map","people","site","team","template","project","channel","discussion","eventAttendee","organization"];const F={app:["Application","City Engine Web Scene","CityEngine Web Scene","Dashboard","Insights Page","Insights Workbook","Operation View","Web Mapping Application","StoryMap","Web Experience","Urban Model"],dataset:["CSV Collection","CSV","Feature Collection Template","Feature Collection","Feature Layer","Feature Service","File Geodatabase","GeoJSON","GeoJson","KML Collection","KML","Microsoft Excel","Raster Layer","Shapefile","Stream Service","Table"],document:["CAD Drawing","Document Link","Hub Page","Site Page","Image","iWork Keynote","iWork Numbers","iWork Pages","Microsoft Powerpoint","Microsoft Visio","Microsoft Word","Notebook","PDF","Pro Map","Report Template"],event:["Hub Event"],feedback:["Form","Quick Capture Project"],initiative:["Hub Initiative"],template:["Hub Initiative Template"],solution:["Solution"],map:["Image Collection","Image Service","Map Service Layer","Map Service","Scene Service","Scene Layer","Vector Tile Service","Web Map Service","Web Map Tile Service","Web Map","Web Scene","WFS","WMS","WMTS"],other:["360 VR Experience","3DTiles Package","3DTiles Service","API Key","Activity","Addin Package","Administrative Report","AllSource Project","Analysis Model","Apache Parquet","App Bundle","AppBuilder Extension","AppBuilder Widget Package","Application Configuration","Application SDK","ArcGIS Pro Add In","ArcGIS Pro Configuration","ArcPad Package","Arcade Module","Basemap Package","Big Data Analytic","Big Data File Share","Code Attachment","Code Sample","Color Set","Compact Tile Package","Content Category Set","Data Package Collection","Data Pipeline","Data Store","Deep Learning Package","Deep Learning Studio Project","Desktop Add In","Desktop Application","Desktop Application Template","Desktop Style","Earth Configuration","Esri Classification Schema","Esri Classifier Definition","Excalibur Imagery Project","Experience Builder Widget","Experience Builder Widget Package","Explorer Add In","Explorer Layer","Explorer Map","Export Package","Featured Items","Feed","GML","GeoBIM Application","GeoBIM Project","GeoPackage","Geocoding Service","Geodata Service","Geoenrichment Service","Geometry Service","Geoprocessing Package","Geoprocessing Sample","Geoprocessing Service","Globe Document","Globe Service","Group Layer","IPS Configuration","Indoors Map Configuration","Insights Data Engineering Model","Insights Data Engineering Workbook","Insights Model","Insights Script","Insights Theme","Insights Workbook Package","Kernel Gateway Connection","Knowledge Graph","Knowledge Graph Layer","Knowledge Graph Web Investigation","Knowledge Studio Project","Layer","Layer File","Layer Package","Layer Template","Layout","Legend","Living Atlas Export Package","Locator Package","Map Area","Map Document","Map Package","Map Service Definition","Map Template","Media Layer","Mission","Mission Report","Mission Template","Mobile Application","Mobile Basemap Package","Mobile Map Package","Mobile Scene Package","Native Application","Native Application Installer","Native Application Template","Network Analysis Service","Notebook Code Snippet Library","Notebook Code Snippets","OGCFeatureServer","Operations Dashboard Add In","Operations Dashboard Extension","Oriented Imagery Catalog","Ortho Mapping Project","Ortho Mapping Template","Pro Presentation","Pro Project","Pro Report","Pro Report Template","Project Package","Project Template","Published Map","QuickCapture Project","Raster Function Template","Real Time Analytic","Reality Mapping Project","Reality Studio Project","Relational Database Connection","Replication Package","Rule Package","SMX Item","SMX Map","SMX Theme","SQLite Geodatabase","Scene Document","Scene Package","Scene Package Part","Server","Service Definition","Statistical Data Collection","StoryMap Theme","Style","Suitability Model","Survey123 Add In","Symbol Service","Symbol Set","Task File","Tile Package","Urban Project","User License Type Extension","Vector Tile Package","Video Service","Viewer Configuration","Visio Document","WCS","Web AppBuilder Widget","Web Experience Template","Web Link Chart","Windows Mobile Package","Windows Viewer Add In","Workflow","Workflow Manager Package","Workflow Manager Service","Workforce Project","netCDF"],site:["Hub Site Application","Site Application"]},x=e=>{if(!e)return;const t=e.toLocaleLowerCase();return F[t]};const G=175,q=["nonspatial","point","polygon","multipoint","polyline"];let R;function N(e,t,r){var n;const i={};null===(n=e.results)||void 0===n||n.forEach(e=>{var t;null===(t=(0,y.a)(null==e?void 0:e.tags))||void 0===t||t.forEach(e=>{e&&(i[e]=(i[e]||0)+1)})});const o=Object.entries(i).sort((e,t)=>t[1]-e[1]).map(([e])=>e);return(0,l.b)([...t||[],...o||[],...r||[]])}async function V({portal:e,query:t,user:r,catalog:n,contentUser:l,userContentGroups:u,store:d,vector:g,config:y,allowedSubscriptionContentTypes:m,groupId:f,showHiddenItems:h}){var S,w,k,A,P,$,M,O,j,C;let I=(0,c.g)(e),T={};const{num:E,start:D,sortOrder:L,sortField:W,filters:F,baseQuery:x,baseFilter:N,searchTerm:V,bucket:B,allowedGeometries:K}=t;if((null==R?void 0:R.signal)&&R.abort(),d.state.recycleBin)return R=new AbortController,"my"===B?X({query:t,portal:e,user:l||r}):z({query:t,portal:e});if("group"===B&&u&&0===u.length||"catalog"===B&&!n)return{highlights:[],nextStart:-1,num:60,results:[],start:1,total:0};const J=f||"group"===B&&(null===(S=null==F?void 0:F.group)||void 0===S?void 0:S.id)&&"all"!==(null===(w=null==F?void 0:F.group)||void 0===w?void 0:w.group)&&(null===(k=null==F?void 0:F.group)||void 0===k?void 0:k.group)||"living atlas"===B&&(null!==(A=null==d?void 0:d.state.livingAtlasGroupId)&&void 0!==A?A:await async function(e,t){var r,n;const o=await(0,i.q)({q:e.livingAtlasGroupQuery,num:1,sortField:"title",sortOrder:"asc"},e),a=(null===(n=null===(r=o.results)||void 0===r?void 0:r[0])||void 0===n?void 0:n.id)||"";t&&(t.state.livingAtlasGroupId=a);return a}(e,d))||"living atlas analysis"===B&&(null!==(P=null==d?void 0:d.state.livingAtlasAnalysisGroupId)&&void 0!==P?P:await async function(e,t){var r,n;const o=await(0,i.q)({q:_(e),num:1,sortField:"title",sortOrder:"asc"},e),a=(null===(n=null===(r=o.results)||void 0===r?void 0:r[0])||void 0===n?void 0:n.id)||"";t&&(t.state.livingAtlasAnalysisGroupId=a);return a}(e,d));if("subscription content"===B)return U(e,r,m);await H(e,B)&&(I="https://www.arcgis.com/sharing/rest/",T.addTokenManually=!1);const Q=J?`content/groups/${J}/`:"",Y=`${I}${Q}search`,Z=function(e,t){if(!(null==e?void 0:e.length)||e.length===(null==q?void 0:q.length)||(null==t?void 0:t.isPortal))return"";return`((-typekeywords:"Hosted Service") OR (typekeywords:"Hosted Service" AND geometrytype:(${e.map(e=>`"${e}"`).join(" OR ")})))`}(K,e),ee=(null===($=null==e?void 0:e.sourceJSON)||void 0===$?void 0:$.vectorSearchEnabled)&&g&&!Q,te=Object.keys(F||{}),re=B?await async function({bucket:e,contentUser:t,catalog:r,user:n,portal:i,filters:a}){switch(e){case"my":return{filter:`owner: ${(t||n).username}`};case"org":return{q:`orgid:${i.id} ${i.isPortal?"-owner:esri_apps -owner:esri_webstyles -owner:esri_nav -owner:esri_livingatlas":""}`};case"favorites":return{filter:`group: ${await(0,o.e)()}`};case"group":if(!(null==a?void 0:a.group)||"all"===(null==a?void 0:a.group.group)){const e=await(0,o.h)(n);return(null==e?void 0:e.length)>G?{}:{filter:`group:(${null==e?void 0:e.map(({id:e})=>e).join(" OR ")})`}}return{};case"catalog":if(!r||!r.source)return{};try{const e=b(r.source,"item"),{q:t,filter:n}=e||{};return{q:t,filter:n}}catch(e){return{}}default:return{}}}({bucket:B,user:r,contentUser:l,catalog:n,portal:e,store:d,filters:F}):{q:"",filter:""},ne=V&&(null===(M=(0,p.c)(V))||void 0===M?void 0:M.length)?`(${(0,p.c)(V)}) `:"",ie=!(!(null==y?void 0:y.semanticSearchEnabled)||!(null===(O=null==e?void 0:e.portalProperties)||void 0===O?void 0:O.semanticSearchEnabled))||r&&!r.orgId,oe=N?`(${N})`:"",ae=Object.assign(Object.assign(Object.assign(Object.assign({},ie?{enriched:!0}:{}),{q:`${re.q||""} ${ne} ${x||""}`,filter:`${re.filter||""} ${oe} ${Z} ${h?"":a.H}`}),ee?{mode:"vector"}:{}),{displaySublayers:!0,displayHighlights:!0,displayServiceProperties:!0}),se=Boolean(F.collaborations);let le;se&&(le=await async function(e,t,r,n){var i,o,a;const s=t.collaboration.id,l=null===(a=null===(o=null===(i=t.additionalParams)||void 0===i?void 0:i.origin)||void 0===o?void 0:o.split("__"))||void 0===a?void 0:a[1],c=await v(s,l,e,r,n),u=(null==c?void 0:c.collaboratedItems.map(e=>Object.keys(e)[0]))||[];return t.value=u.length?`id:(${u.join(" OR ")})`:"",c}(e,F.collaborations,D,E));const ce=[],ue=te.reduce((e,t)=>{const{param:r,value:n,additionalParams:i}=F[t];if(B&&"group"===t&&"group"!==B||"group"===t&&Q||"folder"===t&&"my"!==B||"contentType"===t||"region"===t&&!["living atlas","living atlas analysis"].includes(B))return e;"categories"===t&&n&&ce.push(F[t].category),"region"===t&&n&&ce.push(F[t].categoryValue);const o="categories"===r?{}:{[r]:`${e[r]||""} ${n}`};return Object.assign(Object.assign(Object.assign({},e),o),null!=i?i:{})},ae),pe=Object.assign(Object.assign({num:E,start:se?1:D},"relevance"===W?{}:{sortField:W,sortOrder:L}),ue||{}),de=ce.length?ce.map(e=>`categories=${encodeURIComponent(JSON.stringify([e]))}`).join("&"):"",ge=ce.length?"?":"";try{const e=await(0,s.r)(`${Y}${ge}${de}`,pe,T);let t=Object.assign(Object.assign({},e),{queryParams:pe});return F.collaborations&&le&&(null===(j=t.results)||void 0===j?void 0:j.length)&&(t=function(e,t){const{start:r,num:n,nextStart:i,total:o}=t;if(null!=r&&null!=n&&null!=o&&null!=i){const t=Object.assign(Object.assign({},e),{start:r,num:n,total:o});return t.queryParams.start=r,t.queryParams.num=n,t}return e}(t,le)),t}catch(e){if(498===(null===(C=null==e?void 0:e.details)||void 0===C?void 0:C.httpStatus)&&"Invalid token."===(null==e?void 0:e.message)){const e=await(0,s.r)(`${Y}${ge}${de}`,pe,Object.assign(Object.assign({},T),{addTokenManually:!1}));return Object.assign(Object.assign({},e),{queryParams:pe})}}}function B(e,t){if(!t.deepLayerSearchEnabled)return{};const r={};return(e.highlights||[]).forEach(t=>{var n;const i=null===(n=e.results)||void 0===n?void 0:n.find(e=>e.id===t.id);if(!(null==i?void 0:i.sublayers))return;const o=Object.keys(t).filter(e=>"id"!==e&&e.includes("sublayers.")).reduce((e,r)=>{const n=function(e){const t=e.replace("sublayers.","");return{fieldaliases:"fieldAliases",title:"title"}[t]||t}(r);return e[n]=t[r].map(e=>e.replaceAll("<em>","").replaceAll("</em>","")),e},{}),a=i.sublayers.filter(e=>Object.keys(e).some(t=>{var r;return null===(r=o[t])||void 0===r?void 0:r.some(r=>e[t].includes(r))})).map(e=>e.id);r[t.id]=Object.assign(Object.assign({},t),{sublayers:a})}),r}function _(e){return`title:"Living Atlas Analysis Layers" AND owner:${!0===e.isPortal?"esri_livingatlas":"esri"}`}async function H(e,t){var r;if((null==e?void 0:e.isPortal)&&"all"===t){const t=await(0,i.e)(e);if(null===(r=null==t?void 0:t.portalConfigProperties)||void 0===r?void 0:r.searchArcGISOnlineEnabled)return!0}return!1}async function K(e,t){return e&&t?(0,s.f)(async()=>{const r=`${(0,c.g)(t)}community/users/${e.username}/provisionedListings`;return(0,u.f)(r,{},"provisionedListings")},"provisionedListings",`${t.id}-${e.username}`):[]}async function U(e,t,r){return t?(0,s.f)(async()=>{const i=await K(t,e);if(!(null==i?void 0:i.length))return{total:0,results:[],start:-1,num:100,nextStart:0};const o=null==i?void 0:i.map(e=>e.itemId),a=await Promise.all(o.map(t=>async function(e,t){try{return(0,d.d)(e,t)}catch(e){return null}}(t,e))),s=await Promise.all(null==o?void 0:o.map(t=>async function(e,t){var r;try{return null!==(r=(await(0,n.c)(e,t,{relationshipType:"Listed2ImplicitlyListed",direction:"forward"})).relatedItems)&&void 0!==r?r:[]}catch(e){return[]}}(t,e))),l=s.reduce((e,t)=>e.concat(t),a).filter(e=>function(e,t){return null!=t||(t=["Map Service","Image Service","Feature Service","Stream Service","Vector Tile Service","WMS","WFS","WMTS","KML","Feature Collection","Feed"]),t.includes(null==e?void 0:e.type)}(e,r));return{total:l.length,results:l,start:l.length?1:0,num:100,nextStart:0}},"subscriptionContent",`${e.id}-${t.username}`):{total:0,results:[],start:0,num:100,nextStart:0}}async function J(e,t){return new Promise(async(r,n)=>{var i;null===(i=null==R?void 0:R.signal)||void 0===i||i.addEventListener("abort",()=>{n(new DOMException("Aborted","AbortError"))});const{start:o,num:l,sortField:c,sortOrder:u,searchTerm:p}=e,d=await(0,s.r)(t,{foldersContent:!0,inRecycleBin:!0,ignoreTypes:a.R,start:o,num:l,sortField:c,sortOrder:u}),g=p?d.items.filter(e=>e.title.toLowerCase().includes(p.toLowerCase())):d.items,y=!!p&&g.length!==d.items.length;return r(Object.assign(Object.assign({},d),{results:g,num:l,queryParams:e,partial:y}))})}const Q=async({portal:e,user:t,forOrg:r})=>{var n;const i={start:0,num:100,sortField:"size",sortOrder:"desc"},o=r?await z({portal:e,query:i}):await X({query:i,portal:e,user:t});return null===(n=null==o?void 0:o.results)||void 0===n?void 0:n.reduce((e,t)=>e+t.size,0)};async function X({query:e,portal:t,user:r}){return J(e,`${(0,c.g)(t)}content/users/${r.username}/`)}async function z({query:e,portal:t}){return J(e,`${(0,c.g)(t)}content/portals/${t.id}/`)}async function Y(e,t,r){if(!(null==t?void 0:t.length)||!(null==r?void 0:r.length))return{result:{}};try{const n=[];(0,l.g)(t,100).forEach(t=>{n.push((0,s.r)(`${(0,c.g)(e)}content/itemsgroups`,{items:r.map(e=>e.id).join(","),groups:t.map(e=>e.id).join(",")}))});const i=(await Promise.all(n)).reduce((e,t)=>(Object.values(t).forEach(t=>{const{groupId:r,items:n}=t;n.forEach(({itemId:t})=>{e[t]=[...e[t]||[],r]})},{}),e),{});return{result:i}}catch(e){return{result:{}}}}async function Z(e,t){try{const r=`${(0,c.g)(e)}search`;return{result:(await(0,s.r)(r,{q:`id:(${t.join(" OR ")})`})).results}}catch(e){return{result:[]}}}async function ee(e,t,r,n){var i;const o=await H(t,n.state.bucket),a=o?`https://www.arcgis.com/sharing/rest/content/items/${e.id}`:(0,g.g)(e.id,t),l=o||!r?{disableIdentityLookup:!0,addTokenManually:!1}:{};try{return{result:await(0,s.r)(a,{},l)}}catch(e){if("SB_0005"===(null===(i=null==e?void 0:e.details)||void 0===i?void 0:i.messageCode))return{error:{code:"disabledSubscription"}}}return{error:{code:"unhandledError"}}}function te({bucket:e,oldBucket:t,filters:r,user:n,switchingBucket:i,keepSpecialFilters:o}){var a,s,l,c;const u=Object.assign({},r);"my"===e||o&&"recycle"!==(null===(a=u.folder)||void 0===a?void 0:a.folder)||delete u.folder,"org"!==e&&("recycle"===(null===(s=u.contentType)||void 0===s?void 0:s.contentType)?u.contentType.contentType="all":o||delete u.contentType),"group"===e||o||delete u.group;const p="recycle"===(null===(l=null==r?void 0:r.folder)||void 0===l?void 0:l.folder)||"recycle"===(null===(c=null==r?void 0:r.contentType)||void 0===c?void 0:c.contentType);if((0,m.u)(n,e,p)||delete u.deleteProtection,i){const r=["group","living atlas","living atlas analysis","subscription content"];(r.includes(e)||r.includes(t))&&delete u.categories,"living atlas"===e?(delete u.modified,delete u.created,delete u.sharing,delete u.collaborations):delete u.region}return u}},18944:(e,t,r)=>{r.d(t,{u:()=>i});var n=r(10578);function i(e,t,r){return!!e&&(!t||["my","org"].includes(t))&&!r&&("org"!==t||(0,n.q)(e))}},44388:(e,t,r)=>{r.d(t,{c:()=>i,r:()=>o});var n=r(15332);function i(e=""){return(0,n.s)(e).replace(/[<>\/\\?]/g,"\\$&").trim()}function o(e,{start:t,end:r,total:n}){const i="rtl"===document.documentElement.dir;return e.replace("${start}",i?r:t).replace("${end}",i?t:r).replace("${total}",n)}},94737:(e,t,r)=>{r.d(t,{f:()=>i});var n=r(83692);async function i(e,t,r="results",i=!1){let o,a,s,l,c=1,u=[];t.start=c,t.num||(t.num=100);try{const p=await(0,n.r)(e,t);if(!(null==p?void 0:p[r]))return u;for(u=[...u,...p[r]],c=p.nextStart,o=p.total-u.length,a=Math.ceil(o/t.num),s=[],l=0;l<a;l++)if(t.start=c+l*t.num,i){const i=await(0,n.r)(e,t);(null==i?void 0:i[r])&&(u=[...u,...i[r]])}else s.push((0,n.r)(e,Object.assign({},t)));if(!i){(await Promise.all(s)).forEach(e=>{u=[...u,...e[r]]})}return u}catch(e){return u}}},96295:(e,t,r)=>{r.d(t,{H:()=>n,R:()=>i});const n='-typekeywords:("MapAreaPackage") -type:("Map Area" OR "Indoors Map Configuration" OR "Code Attachment")',i="Indoors Map Configuration,Code Attachment"}}]);