/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-b3643b.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-b3643b"],{36486:(e,t,i)=>{i.d(t,{u:()=>n});var s=i(83552),r=i(73679);const n=(0,s.yr)(r.g)},42855:(e,t,i)=>{i.d(t,{a:()=>a,f:()=>s,l:()=>r,s:()=>n});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),r=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(r||{}),n=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(n||{}),a=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(a||{})},46317:(e,t,i)=>{i.d(t,{D:()=>a});var s=i(85282),r=i(34670),n=i(42466);const a=(0,r.u$)(class extends r.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,n.mY)(e),this.key=t),i}})},47640:(e,t,i)=>{i.d(t,{YZ:()=>a,e1:()=>r});var s=i(4836);const r={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},n=Symbol();class a{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??o,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let r=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){r=!0,i=e}if(this.p===s){if(t===n)this.i=0;else{if(!1===r){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},66228:(e,t,i)=>{i.d(t,{a:()=>b,b:()=>I,c:()=>C,d:()=>x,e:()=>R,f:()=>S,g:()=>y,h:()=>m,i:()=>g,j:()=>f,k:()=>v,l:()=>O,m:()=>k,n:()=>p,o:()=>P,p:()=>$,q:()=>N,r:()=>D,s:()=>F,t:()=>L,u:()=>w});var s=i(63438),r=i(18423),n=i(96086),a=i(91813),o=i(21255),l=i(13078),d=i(21303),c=i(12627),h=i(42855);const p=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],u=["feature"];function g(e){return null!=e}function f(e,t,i){const s=t.fieldName;if(s.includes(h.f.expression)){const e=i.get(s);return e?.title?e.title:s}return F(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function y(e){return new Map((await v(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function m(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${h.f.expression}${e.name}`;t.set(i,e)}),t}function b(e){return"map-image"===e?.layer?.type?h.s.mapImage:"subtype-sublayer"===e?.type?h.s.subtype:"tile"===e?.layer?.type?h.s.tile:"scene"===e?.type?h.s.scene:"ogc-feature"===e?.type?h.s.ogcFeature:"imagery"===e?.type?h.s.imagery:"imagery-tile"===e?.type?h.s.imageryTile:"wfs"===e?.type?h.s.wfs:"wcs"===e?.type?h.s.wcs:"wms"===e?.layer?.type?h.s.wms:"csv"===e?.type?h.s.csv:"geojson"===e?.type?h.s.geojson:"stream"===e?.type?h.s.stream:"oriented-imagery"===e?.type?h.s.orientedImagery:"catalog"===e?.type?h.s.catalog:"catalog-footprint"===e?.type?h.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?h.s.knowledgeGraphSublayer:"voxel"===e?.type?h.s.voxel:"parquet"===e?.type?h.s.parquet:h.s.feature}function w(e){const t=b(e);let i;return t===h.s.wms||t===h.s.mapImage?i=e?.layer.version:(t===h.s.imagery||t===h.s.feature||t===h.s.scene)&&(i=e.version),Number.parseFloat(i)}function F(e){return"fieldConfigurations"in e&&u.includes(e.type)}async function v(e){return await new Promise((t,i)=>{switch(b(e)){case h.s.feature:case h.s.ogcFeature:case h.s.stream:t(e.fields);break;case h.s.mapImage:{const s=e,r=s?.layer;r?.portalItem&&r.url.includes("https://demographics")&&r.url.includes(".arcgis.com")?r.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),r=e.thematicGroup.fieldNames,n=[];r.forEach(e=>{i.has(e)&&n.push(i.get(e))}),t(n)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case h.s.imagery:case h.s.imageryTile:case h.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function P(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function k(e){return Number((100*(1-e)).toFixed(1))}function L(e){return Number((1-e/100).toFixed(3))}const x=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(h.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},I=async(e,t)=>{const i=new c.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await d.identify(e.layer.url,i))?.results?.[0]?.feature},R=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await T(i,s.features?.[0])},T=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=x(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const n=new r.default;i.geometry=n}return i};function N(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function C(e){if(b(e)===h.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(b(e)===h.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function O(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function S(e,t){try{const i=b(e);if(i===h.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await I(e,t)||await _(e,t)]};if(i===h.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await _(e,t)]};const s=i===h.s.ogcFeature||i===h.s.stream?await t.whenLayerView(e):e,r=s.createQuery();r.where=s.definitionExpression||"1=1",r.outFields=["*"],r.returnM="hasM"in e&&e.hasM,r.returnZ="hasZ"in e&&e.hasZ,r.outSpatialReference=t.spatialReference,r.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===h.s.ogcFeature)&&(r.start=0,r.num=1),r.outSpatialReference=t.spatialReference;const n=await s.queryFeatures(r);return n?.features?.length||(n.features[0]=await _(e,t)),n}catch(e){console.error(e)}}async function _(e,t){return await new Promise(i=>{const r=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),r.attributes=t}const d=t.extent;let c;"polygon"===e.geometryType?c=o.default.fromExtent(d):"point"===e.geometryType?c=d.center.clone():"multipoint"===e.geometryType?c=new n.default({points:[[d.center.x,d.center.y]],spatialReference:d.center.spatialReference.clone()}):"polyline"===e.geometryType?(c=new a.default({spatialReference:t.spatialReference.clone()}),c.addPath([[d.xmin,d.ymin],[d.xmax,d.ymax]])):"mesh"===e.geometryType&&(c=l.default.createBox(d.center.clone(),{size:{width:50,height:50,depth:50}})),r.geometry=c,i(r)})}function D(e){return b(e)===h.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function $(e){return b(e)===h.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},71379:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigDisplayOrder:()=>g});var s=i(73679),r=i(4395),n=i(85643),a=i(46317),o=i(36486),l=i(73801),d=i(47640),c=i(66228),h=(e=>(e.Ascending="sort-ascending-arrow",e.Descending="sort-descending-arrow",e))(h||{}),p=(e=>(e.AscendingDate="sortLeastRecent",e.AscendingNumber="smallToLarge",e.DescendingDate="sortMostRecent",e.DescendingNumber="largeToSmall",e))(p||{});const u=r.AH`.button-label{--calcite-label-margin-bottom: 2px}.field-selection{display:flex;gap:.5rem}.field-selection-button{min-width:0px;align-self:center}.infoPopover{width:340px;font-size:12px}.information{margin:0 0 1em}`;class g extends l.WF{constructor(){super(...arguments),this.infoString="",this._messages=(0,o.u)({blocking:!0}),this.fieldPickListChanges=e=>{e.stopPropagation();const t=e.detail?.selectedFields?.[0];t&&t!==this.selectedField.name&&(this.selectedField=t!==this.getRendererFieldName()?this.toPickListFieldInfo(this.findField(t)):this.getRendererFieldInfo()),this.onHideFieldPickList()},this._initialized=!1,this._loaded=!1,this._propWatcherTask=new d.YZ(this,{task:([e])=>{if(!(0,c.i)(e))throw console.error("[arcgis-map-config-display-order] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,this.init()},args:()=>[this.layer]}),this.ascending=!1,this.closedOnLoad=!1,this.disabled=!1,this.fieldTypes=["integer","small-integer","big-integer","single","double","long","date"],this.arcgisChange=(0,l.lh)()}static{this.properties={ascending:16,selectedField:16,view:0,layer:0,closedOnLoad:5,disabled:5,popoverProps:0,fieldTypes:0}}static{this.styles=u}async done(){this.disableContainer(!1),this.destroyFieldsPickList()}updated(){this._propWatcherTask.status===d.e1.COMPLETE&&this._initialized&&!this._loaded&&(this._loaded=!0,this.tooltipNode&&this.sortActionNode&&(this.tooltipNode.referenceElement=this.sortActionNode))}disconnectedCallback(){super.disconnectedCallback(),this.destroyFieldsPickList()}init(){const{layer:e,pickListFields:t}=this,{type:i}=e;this.infoString="catalog"===i?this._messages.orderByTooltipCatalogLayer:this._messages.orderByTooltip;const s=t||this.createPickListFields();if("catalog"!==i&&this.isRendererOrder())this.selectedField=this.getRendererFieldInfo();else{const{orderBy:t}=e,i=Array.isArray(t)?t[0]:t;this.ascending="ascending"===i?.order,this.orderByField=i?.field||this.findOIDField(s)?.name||s[0].name;const r=this.orderByField;this.selectedField=this.toPickListFieldInfo(this.findField(r))}}tooltipRefHandler(e){e&&(this.tooltipNode=e)}buttonRefHandler(e){e&&(this.fieldSelectionNode=e)}actionRefHandler(e){e&&(this.sortActionNode=e)}onChange(){const e=this.getValue(),t="renderer"===e;if(this.layer.orderBy=t?void 0:e,"feature"===this.layer.type){this.layer.renderer.orderByClassesEnabled=t||void 0}this.arcgisChange.emit()}async onShowFieldPickList(e){e.stopPropagation(),this.disableContainer(!0),this.fieldPickList?this.destroyFieldsPickList():this.createFieldPickList()}async onHideFieldPickList(){this.disableContainer(!1),this.destroyFieldsPickList(),await(this.fieldSelectionNode?.setFocus()),this.onChange()}onToggleSortDirection(e){e.stopPropagation(),this.ascending=!this.ascending,this.onChange()}onShowTooltip(e){this.tooltipNode&&(this.tooltipNode.open=e)}createFieldPickList(){const{layer:e,pickListFields:t,view:i,_messages:s}=this,n=t||this.createPickListFields(),a=this.fieldSelectionNode;this.fieldSelectionNode?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});const o=this.createPopoverProps(a),d=this.selectedField||(this.isRendererOrder()?this.getRendererFieldInfo():n[0]);this.fieldPickList=(0,l.dN)(r.qy`<arcgis-field-pick-list .heading=${s.orderBy} show-field-name .mapView=${i} .layer=${e} .fields=${n} .selectedFields=${[d.name]} .popoverProps=${o} @arcgisClose=${this.fieldPickListChanges}></arcgis-field-pick-list>`),document.body.appendChild(this.fieldPickList)}destroyFieldsPickList(){this.fieldPickList&&(this.fieldPickList.remove(),this.fieldPickList=void 0)}createPopoverProps(e){return{placement:this.popoverProps?.placement||"auto",offsetDistance:this.popoverProps?.offsetDistance??5,offsetSkidding:this.popoverProps?.offsetSkidding??0,pointerDisabled:!0,triggerDisabled:this.popoverProps?.triggerDisabled??!0,popoverWidth:this.popoverProps?.popoverWidth??this.getPopoverWidth(),overlayPositioning:this.popoverProps?.overlayPositioning??"absolute",refElement:e}}createPickListFields(){let{pickListFields:e}=this;if(!e){const{layer:t,fieldTypes:i}=this,s=t.fields;this.pickListFields=s.filter(e=>i.includes(e?.type)).map(e=>this.toPickListFieldInfo(e)),e=this.pickListFields;const r=this.getOIDField();if(r){const t=this.toPickListFieldInfo(r);e.unshift(t)}if(this.hasTypesOrPredominanceRenderer()){const t=this.getRendererFieldInfo();e.unshift(t)}}return e}toPickListFieldInfo(e){return{name:e.name,hideFieldName:"oid"===e.type,alias:this.getFieldAlias(e),type:e.type}}getPopoverWidth(){return this.el.getBoundingClientRect().width+30||280}getFieldAlias(e){const{_messages:t}=this;return"oid"===e.type?t.defaultDataOrder:this.findFieldInfoFromPopup(e)?.label||e.alias||e.name}findFieldInfoFromPopup(e){const{popupTemplate:t}=this.layer;return(t?.fieldInfos||[]).find(t=>t.fieldName===e.name)}getOIDField(){const{layer:e}=this;return e.fields.find(t=>t.name===e.objectIdField||"oid"===t.type)}findOIDField(e){const{layer:t}=this;return e.find(e=>e.name===t.objectIdField||"oid"===e.type)}findField(e){const{layer:t}=this,i=t.fields;return i.find(t=>t.name===e)||i[0]}getSortDirectionIcon(){return this.ascending?h.Ascending:h.Descending}getSortDirectionTooltip(){const{ascending:e,selectedField:t,_messages:i}=this,s=t?.type;let r="sortLeastRecent";return r="date"===s?e?p.AscendingDate:p.DescendingDate:e?p.AscendingNumber:p.DescendingNumber,i[r]}hasTypesOrPredominanceRenderer(){const{layer:e}=this,{renderer:t}=e;return!!t&&("unique-value"===t?.type&&(!t?.authoringInfo?.type||"predominance"===t?.authoringInfo?.type))}isRendererOrder(){const{layer:e}=this,{renderer:t}=e;return!!t&&(this.hasTypesOrPredominanceRenderer()&&!0===t?.orderByClassesEnabled)}getRendererFieldName(){const{layer:e}=this,{renderer:t}=e;return t&&this.hasTypesOrPredominanceRenderer()&&(t.field||t.valueExpressionTitle)||null}getRendererFieldInfo(){return{name:this.getRendererFieldName(),alias:this._messages.styleOrder,type:"renderer"}}disableContainer(e){const t=this.el.closest("calcite-flow-item");t&&(t.disabled=e)}getValue(){const{selectedField:e}=this;return"oid"===e.type?null:"renderer"===e.type?"renderer":[{order:this.ascending?"ascending":"descending",field:this.selectedField.name}]}render(){return this._propWatcherTask.render({complete:()=>{const{_messages:e,closedOnLoad:t,disabled:i,layer:s}=this,{type:a}=s,o="catalog"===a?e.headingCatalogLayer:e.heading;return r.qy`<calcite-block .heading=${o} collapsible .disabled=${i} .expanded=${!t&&!i}><p class="information">${this.infoString}</p>${this.renderFieldSelectionButton()}</calcite-block><calcite-tooltip .referenceElement=${this.sortActionNode} placement=auto overlay-positioning=fixed ${(0,n.K)(this.tooltipRefHandler)}>${this.getSortDirectionTooltip()}</calcite-tooltip>`}})}renderFieldSelectionButton(){const{selectedField:e,_messages:t}=this,i=this.createPickListFields();return r.qy`<calcite-label class="button-label">${t.orderBy} </calcite-label><div class="field-selection">${(0,a.D)("selected-field-button",r.qy`<calcite-button class="field-selection-button" appearance=outline-fill kind=neutral width=full alignment=icon-end-space-between .disabled=${i.length<=1} icon-end=chevron-down @click=${this.onShowFieldPickList} ${(0,n.K)(this.buttonRefHandler)}>${e?.alias||i[0].alias}</calcite-button>`)}<calcite-action class="sort-button" appearance=transparent .icon=${this.getSortDirectionIcon()} icon-flip-rtl @click=${this.onToggleSortDirection} @mouseover=${()=>this.onShowTooltip(!0)} @mouseout=${()=>this.onShowTooltip(!1)} .text=${this.infoString} .disabled=${"oid"===e.type||"renderer"===e.type} ${(0,n.K)(this.actionRefHandler)}></calcite-action></div>`}}(0,s.c)("arcgis-map-config-display-order",g)}}]);