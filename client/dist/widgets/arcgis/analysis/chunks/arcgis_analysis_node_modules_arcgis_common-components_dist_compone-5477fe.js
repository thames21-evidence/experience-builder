/*! For license information please see arcgis_analysis_node_modules_arcgis_common-components_dist_compone-5477fe.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_common-components_dist_compone-5477fe"],{22398:(e,t,r)=>{r.r(t),r.d(t,{ArcgisCommonSqlExpressionConfig:()=>M});var s=r(22229),a=r(4395),i=r(73801),o=r(85643),n=r(47640),l=r(5294),p=r(54312),c=r(6550),u=r(59102),d=r(5077),h=r(80666),f=(r(52797),r(24186)),g=r(34031),m=r(53550),y=r(43284),$=r(42984);function b(e){let t="";if(!e.expressions?.length)return;let r="",s=0;for(let a=0;a<e.expressions.length;a++){const i=v(e.expressions[a],e);i.length&&(0===s?t=i:1===s?(r=` ${e.logicalOperatorForExpressions===h.l.OR?"OR":"AND"} `,t=`(${t})${r}(${i})`):t+=`${r}(${i})`,s++)}return t.length?t:void 0}function v(e,t){let r="";if(1===e.conditions.length)r=E(e.conditions[0],t);else{let s="";for(let a=0;a<e.conditions.length;a++){const i=E(e.conditions[a],t);i.length&&(r+=s+i,s=` ${e.logicalOperatorForConditions===h.l.OR?"OR":"AND"} `)}}return r}function E(e,t){const{layer:r,_messages:s}=t,a=e.fieldName,i=e.operator;let o=e.value,n=e.value2;const l=e.values||[],p=e.unit,c=(0,f.g)(a,t);if(!c||(0,f.i)(t,i)&&!(0,h.i)(n))return"";if((0,f.a)(t,i)&&!l.length)return"";if((0,f.b)(t,i)&&!(0,h.i)(o))return"";if(!((0,h.i)(o)||l.length||(0,f.c)(t,i)||(0,f.d)(t,i)||(0,f.e)(t,i)))return"";let u="";if(c.simpleFieldType===h.s.STRING||c.simpleFieldType===h.s.GUID){const i=(0,f.f)(c),n=(0,f.h)(c),p=(0,f.j)(c),d=(0,f.k)(c),g=(0,f.l)(c),y=(0,f.m)(c),$=i&&(0,h.i)(o)&&t.isHosted&&function(e){if("number"==typeof e)return!1;for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(o)?"N":"",b=o?.toString().replace(/'/gu,"''"),v=e=>{let s="";if(i)s=e?.toString().replace(/'/gu,"''"),s=`${$}'${s}'`;else if(n)s=`'${e}'`;else if(p)s=e.toString();else if(d){s=`${t.supportsStandardizedQuery?"timestamp ":""}'${I(e,r.fieldsIndex.getTimeZone(a)||"UTC")}'`}else if(g){const r=t.supportsStandardizedQuery?"DATE ":"";let a;a="number"==typeof e?(0,m.u)(e):e,s=`${r}'${a}'`}else y&&(s=`${t.supportsStandardizedQuery?"TIME ":""}'${"number"==typeof e?(0,m.a)(e):e}'`);return s};switch(e.operator){case s.operators.stringOperatorIs:u=`${a} = ${v(o)}`;break;case s.operators.stringOperatorIsNot:u=`${a} <> ${v(o)}`;break;case s.operators.stringOperatorStartsWith:u=`${a} LIKE ${$}'${b}%'`;break;case s.operators.stringOperatorEndsWith:u=`${a} LIKE ${$}'%${b}'`;break;case s.operators.stringOperatorContains:u=`${a} LIKE ${$}'%${b}%'`;break;case s.operators.stringOperatorDoesNotContain:u=`${a} NOT LIKE ${$}'%${b}%'`;break;case s.operators.stringOperatorIncludes:u=`${a} IN (${l.map(e=>v(e))})`;break;case s.operators.stringOperatorExcludes:u=`${a} NOT IN (${l.map(e=>v(e))})`;break;case s.operators.stringOperatorIsBlank:u=`${a} IS NULL`;break;case s.operators.stringOperatorIsNotBlank:u=`${a} IS NOT NULL`;break;case s.operators.stringOperatorIsEmpty:u=`${a} = ''`;break;case s.operators.stringOperatorIsNotEmpty:u=`${a} <> ''`;break;case s.operators.stringOperatorIsCurrentUser:u=`${a} = CURRENT_USER`;break;case s.operators.stringOperatorIsNotCurrentUser:u=`${a} <> CURRENT_USER`}}else if(c.simpleFieldType===h.s.NUMBER||c.simpleFieldType===h.s.OID)switch(i){case s.operators.numberOperatorIs:u=`${a} = ${o}`;break;case s.operators.numberOperatorIsNot:u=`${a} <> ${o}`;break;case s.operators.numberOperatorIsAtLeast:u=`${a} >= ${o}`;break;case s.operators.numberOperatorIsLessThan:u=`${a} < ${o}`;break;case s.operators.numberOperatorIsAtMost:u=`${a} <= ${o}`;break;case s.operators.numberOperatorIsGreaterThan:u=`${a} > ${o}`;break;case s.operators.numberOperatorIsBetween:u=`${a} BETWEEN ${o} AND ${n}`;break;case s.operators.numberOperatorIsNotBetween:u=`${a} NOT BETWEEN ${o} AND ${n}`;break;case s.operators.numberOperatorIncludes:u=`${a} IN (${l.toString()})`;break;case s.operators.numberOperatorExcludes:u=`${a} NOT IN (${l.toString()})`;break;case s.operators.numberOperatorIsBlank:u=`${a} IS NULL`;break;case s.operators.numberOperatorIsNotBlank:u=`${a} IS NOT NULL`}else if(c.simpleFieldType===h.s.DATE_ONLY){const e=t.supportsStandardizedQuery?"DATE ":"";let r,d;switch(r="number"==typeof o?(0,m.u)(o):o,(0,h.i)(n)&&"number"==typeof n?d=(0,m.u)(n):(0,h.i)(n)&&(d=n),i){case s.operators.dateOperatorIsOn:u=`${a} = ${e}'${r}'`;break;case s.operators.dateOperatorIsNotOn:u=`${a} <> ${e}'${r}'`;break;case s.operators.dateOperatorIsBefore:u=`${a} < ${e}'${r}'`;break;case s.operators.dateOperatorIsAfter:u=`${a} > ${e}'${r}'`;break;case s.operators.dateOperatorInTheLast:u=`${a} BETWEEN ${N(t,c,o,p)}`;break;case s.operators.dateOperatorNotInTheLast:u=`${a} NOT BETWEEN ${N(t,c,o,p)}`;break;case s.operators.dateOperatorIsBetween:u=`${a} BETWEEN ${e}'${r}' AND ${e}'${d}'`;break;case s.operators.dateOperatorIsNotBetween:u=`${a} NOT BETWEEN ${e}'${r}' AND ${e}'${d}'`;break;case s.operators.dateOperatorIncludes:case s.operators.dateOperatorExcludes:{let t="",r="";l.forEach(s=>{const a="number"==typeof s?(0,m.u)(s):s;t+=`${r}${e}'${a}'`,r=","}),u=i===s.operators.numberOperatorIncludes?`${a} IN (${t})`:`${a} NOT IN (${t})`;break}case s.operators.dateOperatorIsBlank:u=`${a} IS NULL`;break;case s.operators.dateOperatorIsNotBlank:u=`${a} IS NOT NULL`}}else if(c.simpleFieldType===h.s.TIME_ONLY){const e=t.supportsStandardizedQuery?"TIME ":"";switch("number"==typeof o&&(o=(0,m.a)(o)),(0,h.i)(n)&&"number"==typeof n&&(n=(0,m.a)(n)),i){case s.operators.dateOperatorIsOn:u=`${a} = ${e}'${o}'`;break;case s.operators.dateOperatorIsNotOn:u=`${a} <> ${e}'${o}'`;break;case s.operators.dateOperatorIsBefore:u=`${a} < ${e}'${o}'`;break;case s.operators.dateOperatorIsAfter:u=`${a} > ${e}'${o}'`;break;case s.operators.dateOperatorIsBeforeOrEqual:u=`${a} <= ${e}'${o}'`;break;case s.operators.dateOperatorIsAfterOrEqual:u=`${a} >= ${e}'${o}'`;break;case s.operators.dateOperatorIsBetween:u=`${a} BETWEEN ${e}'${o}' AND ${e}'${n}'`;break;case s.operators.dateOperatorIsNotBetween:u=`${a} NOT BETWEEN ${e}'${o}' AND ${e}'${n}'`;break;case s.operators.dateOperatorIncludes:case s.operators.dateOperatorExcludes:{let t="",r="";l.forEach(s=>{t+=`${r}${e}'${"number"==typeof s?(0,m.a)(s):s}'`,r=","}),u=i===s.operators.numberOperatorIncludes?`${a} IN (${t})`:`${a} NOT IN (${t})`;break}case s.operators.dateOperatorIsBlank:u=`${a} IS NULL`;break;case s.operators.dateOperatorIsNotBlank:u=`${a} IS NOT NULL`}}else{const e=t.supportsStandardizedQuery?"timestamp ":"",d=r.fieldsIndex.getTimeZone(a)||"UTC",h=I(o,d),f=I(n,d);switch(i){case s.operators.dateOperatorIsOn:u=`${a} = ${e}'${h}'`;break;case s.operators.dateOperatorIsNotOn:u=`${a} <> ${e}'${h}'`;break;case s.operators.dateOperatorIsBefore:u=`${a} < ${e}'${h}'`;break;case s.operators.dateOperatorIsAfter:u=`${a} > ${e}'${h}'`;break;case s.operators.dateOperatorIsBeforeOrEqual:u=`${a} <= ${e}'${h}'`;break;case s.operators.dateOperatorIsAfterOrEqual:u=`${a} >= ${e}'${h}'`;break;case s.operators.dateOperatorInTheLast:u=`${a} BETWEEN ${N(t,c,o,p)}`;break;case s.operators.dateOperatorNotInTheLast:u=`${a} NOT BETWEEN ${N(t,c,o,p)}`;break;case s.operators.dateOperatorIsBetween:u=`${a} BETWEEN ${e}'${h}' AND ${e}'${f}'`;break;case s.operators.dateOperatorIsNotBetween:u=`${a} NOT BETWEEN ${e}'${h}' AND ${e}'${f}'`;break;case s.operators.dateOperatorIncludes:case s.operators.dateOperatorExcludes:{let t="",r="";l.forEach(s=>{t+=`${r}${e}'${I(s,d)}'`,r=","}),u=i===s.operators.dateOperatorIncludes?`${a} IN (${t})`:`${a} NOT IN (${t})`;break}case s.operators.dateOperatorIsBlank:u=`${a} IS NULL`;break;case s.operators.dateOperatorIsNotBlank:u=`${a} IS NOT NULL`}}return u}function I(e,t){const r=new Date(e),s=new Date(r.toLocaleString("en-US",{timeZone:t})),a=e=>String(e).padStart(2,"0"),i=a(s.getMonth()+1),o=a(s.getDate());return`${s.getFullYear()}-${i}-${o} ${a(s.getHours())}:${a(s.getMinutes())}:${a(s.getSeconds())}`}function N(e,t,r,s){const a=(0,f.l)(t)?"CURRENT_DATE":"CURRENT_TIMESTAMP";if(e.isHosted){let e=0;return e="year"===s?365*r:"month"===s?30*r:"week"===s?7*r:"day"===s?r:"hour"===s?r/24:r/1440,`${a} - ${e} AND ${a}`}{let e=0;return"year"===s?(e=365*r,`${a} - INTERVAL '${e}' DAY AND ${a}`):"month"===s?(e=30*r,`${a} - INTERVAL '${e}' DAY AND ${a}`):"week"===s?(e=7*r,`${a} - INTERVAL '${e}' DAY AND ${a}`):"day"===s?(e=r,`${a} - INTERVAL '${e}' DAY AND ${a}`):"hour"===s?`${a} - INTERVAL '${r}' HOUR AND ${a}`:`${a} - INTERVAL '${r}' MINUTE AND ${a}`}}async function O(e,t){const{layer:r}=t;return!e?.length||await(0,y.parseWhereClause)(e,r.fieldsIndex).then(e=>{const r=(0,l.clone)(e);if(!r.isStandardized)return!1;t.expressions=[{conditions:[]}];const s=function(e,t){return!!t.expressions&&(w(e)?x(e,t.expressions[0].conditions,t):(t.logicalOperatorForExpressions=T(e),x(e,t.expressions[0],t)))}(r.parseTree,t);return t.expressions=(0,h.f)(t.expressions),s},e=>(console.error("SQLParser - error:",e),!1))}function x(e,t,r){const{layer:s}=r;if(w(e)){if("column-reference"===e.left.type){const a=(0,f.g)(e.left.column,r),i=a?function(e,t,r,s){const{supportsCurrentUser:a,_messages:i}=e;if(!r)return"";if(r.simpleFieldType===h.s.STRING||r.simpleFieldType===h.s.GUID)switch(t){case"=":return""===s.value?i.operators.stringOperatorIsEmpty:"current-user"===s.type?a?i.operators.stringOperatorIsCurrentUser:"":i.operators.stringOperatorIs;case"<>":return""===s.value?i.operators.stringOperatorIsNotEmpty:"current-user"===s.type?a?i.operators.stringOperatorIsNotCurrentUser:"":i.operators.stringOperatorIsNot;case"LIKE":return s.value.startsWith("%")&&s.value.endsWith("%")?(s.value=s.value.substring(1,s.value.length-1),i.operators.stringOperatorContains):s.value.endsWith("%")?(s.value=s.value.substring(0,s.value.length-1),i.operators.stringOperatorStartsWith):s.value.startsWith("%")?(s.value=s.value.substring(1),i.operators.stringOperatorEndsWith):i.operators.stringOperatorIs;case"NOT LIKE":return s.value.startsWith("%")&&s.value.endsWith("%")?s.value=s.value.substring(1,s.value.length-1):s.value.endsWith("%")?s.value=s.value.substring(0,s.value.length-1):s.value.startsWith("%")&&(s.value=s.value.substring(1)),i.operators.stringOperatorDoesNotContain;case"IS":return"null"===s.type?i.operators.stringOperatorIsBlank:i.operators.stringOperatorIs;case"ISNOT":case"IS NOT":return"null"===s.type?i.operators.stringOperatorIsNotBlank:i.operators.stringOperatorIs;case"IN":return i.operators.stringOperatorIncludes;case"NOT IN":case"NOTIN":return i.operators.stringOperatorExcludes}else if("number"===r.simpleFieldType||"oid"===r.simpleFieldType)switch(t){case"=":return i.operators.numberOperatorIs;case"<>":return i.operators.numberOperatorIsNot;case">=":return i.operators.numberOperatorIsAtLeast;case"<":return i.operators.numberOperatorIsLessThan;case"<=":return i.operators.numberOperatorIsAtMost;case">":return i.operators.numberOperatorIsGreaterThan;case"BETWEEN":return i.operators.numberOperatorIsBetween;case"NOT BETWEEN":case"NOTBETWEEN":return i.operators.numberOperatorIsNotBetween;case"IS":return"null"===s.type?i.operators.numberOperatorIsBlank:i.operators.numberOperatorIs;case"ISNOT":case"IS NOT":return"null"===s.type?i.operators.numberOperatorIsNotBlank:i.operators.numberOperatorIs;case"IN":return i.operators.numberOperatorIncludes;case"NOT IN":case"NOTIN":return i.operators.numberOperatorExcludes}else switch(t){case"=":return i.operators.dateOperatorIsOn;case"<>":return i.operators.dateOperatorIsNotOn;case"<":return i.operators.dateOperatorIsBefore;case">":return i.operators.dateOperatorIsAfter;case"<=":return i.operators.dateOperatorIsBeforeOrEqual;case">=":return i.operators.dateOperatorIsAfterOrEqual;case"BETWEEN":return"current-time"===s.value[0]?.left?.type?i.operators.dateOperatorInTheLast:i.operators.dateOperatorIsBetween;case"NOT BETWEEN":case"NOTBETWEEN":return"current-time"===s.value[0]?.left?.type?i.operators.dateOperatorNotInTheLast:i.operators.dateOperatorIsNotBetween;case"IS":if("null"===s.type)return i.operators.dateOperatorIsBlank;break;case"ISNOT":case"IS NOT":if("null"===s.type)return i.operators.dateOperatorIsNotBlank;break;case"IN":return i.operators.dateOperatorIncludes;case"NOT IN":case"NOTIN":return i.operators.dateOperatorExcludes}return""}(r,e.operator,a,e.right):void 0;if(!a||!i)return!1;{let o;if("null"===e.right.type)o={fieldName:a.layerField.name,operator:i};else{if("column-reference"===e.right.type)return!1;if("expression-list"===e.right.type&&(0,f.a)(r,i))if((0,f.k)(a)){const t=s.fieldsIndex.getTimeZone(a.layerField.name)||"UTC";o={fieldName:a.layerField.name,operator:i,values:e.right.value.map(e=>k(e.value,t))}}else o=(0,f.l)(a)?{fieldName:a.layerField.name,operator:i,values:e.right.value.map(e=>C(e.value))}:(0,f.m)(a)?{fieldName:a.layerField.name,operator:i,values:e.right.value.map(e=>F(e.value))}:{fieldName:a.layerField.name,operator:i,values:e.right.value.map(e=>e.value)};else if("expression-list"===e.right.type&&(0,f.b)(r,i)){const t=function(e){const t=e.right.value[0].right;let r=t.value;if("interval"!==t.type){if(Number.isNaN(r))return null;if(r%365==0)return{value:r/365,unit:"year"};if(r%30==0)return{value:r/30,unit:"month"};if(r%7==0)return{value:r/7,unit:"week"};if(r%1==0)return{value:r,unit:"day"};{const e=Math.round(24*r*60);return e%60==0?{value:Math.round(24*r),unit:"hour"}:{value:e,unit:"minute"}}}if(r="string"===t.value.type?Number.parseFloat(t.value.value):t.value.value,"day"===t.qualifier.period){if(r%365==0)return{value:r/365,unit:"year"};if(r%30==0)return{value:r/30,unit:"month"};if(r%7==0)return{value:r/7,unit:"week"};if(r%1==0)return{value:r,unit:"day"}}else{if("hour"===t.qualifier.period)return{value:r,unit:"hour"};if("minute"===t.qualifier.period)return{value:r,unit:"minute"}}}(e);if(!t)return!1;o={fieldName:a.layerField.name,operator:i,value:t.value,unit:t.unit}}else if("expression-list"===e.right.type&&(0,f.i)(r,i))if((0,f.k)(a)){const t=s.fieldsIndex.getTimeZone(a.layerField.name)||"UTC";o={fieldName:a.layerField.name,operator:i,value:k(e.right.value[0].value,t),value2:k(e.right.value[1].value,t)}}else o=(0,f.l)(a)?{fieldName:a.layerField.name,operator:i,value:C(e.right.value[0].value),value2:C(e.right.value[1].value)}:(0,f.m)(a)?{fieldName:a.layerField.name,operator:i,value:F(e.right.value[0].value),value2:F(e.right.value[1].value)}:{fieldName:a.layerField.name,operator:i,value:e.right.value[0].value,value2:e.right.value[1].value};else if("timestamp"===e.right.type)if(a.simpleFieldType===h.s.DATE_ONLY)o={fieldName:a.layerField.name,operator:i,value:e.right.value?.substring(0,10)};else{const t=s.fieldsIndex.getTimeZone(a.layerField.name)||"UTC";o={fieldName:a.layerField.name,operator:i,value:k(e.right.value,t)}}else if("date"===e.right.type)if("date-only"===a.layerField.type)o={fieldName:a.layerField.name,operator:i,value:(0,f.n)(a)?e.right.value:C(e.right.value)};else{const t=s.fieldsIndex.getTimeZone(a.layerField.name)||"UTC";o={fieldName:a.layerField.name,operator:i,value:k(e.right.value,t)}}else o="time"===e.right.type?{fieldName:a.layerField.name,operator:i,value:(0,f.n)(a)?e.right.value:F(e.right.value)}:{fieldName:a.layerField.name,operator:i,value:e.right.value}}t.push(o)}return!0}return!1}{let s;if(r.expressions=r.expressions||[],w(e.left)&&w(e.right))t.logicalOperatorForConditions=T(e),s=x(e.left,t.conditions,r),s=s&&x(e.right,t.conditions,r);else if(w(e.left))if(e.operator===e.right.operator&&w(e.right.left)&&w(e.right.right))t.logicalOperatorForConditions=T(e),s=x(e.left,t.conditions,r),s=s&&x(e.right,t,r);else{s=x(e.left,t.conditions,r);const a={conditions:[]};r.expressions.push(a),s=s&&x(e.right,a,r)}else if(w(e.right))if(e.operator===e.left.operator&&w(e.left.right)&&(w(e.left.left)||e.left.operator===e.left.left?.operator))t.logicalOperatorForConditions=T(e),s=x(e.left,t,r),s=s&&x(e.right,t.conditions,r);else{s=x(e.left,t,r);const a={conditions:[]};r.expressions.push(a),s=s&&x(e.right,a.conditions,r)}else if(e.operator===e.right.operator&&e.operator===e.left.operator&&(w(e.left.left)||!w(e.left.left)&&e.left.left.operator===e.operator))t.logicalOperatorForConditions=T(e),s=x(e.left,t,r),s=s&&x(e.right,t,r);else{s=x(e.left,t,r);const a={conditions:[]};r.expressions.push(a),s=s&&x(e.right,a,r)}return s}}function w(e){return!("binary-expression"===e.type&&("OR"===e.operator||"AND"===e.operator))}function T(e){return"OR"===e.operator.toUpperCase()?h.l.OR:h.l.AND}function k(e,t){return m.D.fromFormat(e,"yyyy-MM-dd TT",{numberingSystem:"latn",zone:t}).toMillis()}function F(e){return(0,m.t)(e)}function C(e){return new Date(`${e} 00:00:00`).getTime()}const L=a.AH`:host{display:flex;flex:1 1 auto;overflow:hidden}:host([selected]){display:flex!important}:host.flow-item-host{display:none}.disabled{cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled);pointer-events:none}.content-div{width:100%}.fab-padding{padding-bottom:var(--calcite-spacing-lg)}.fab-without-panel{padding:var(--calcite-spacing-lg);display:flex;flex-direction:row;justify-content:center}.notice{margin:var(--calcite-spacing-sm)}.empty-msg{margin:40px var(--calcite-spacing-sm-plus) 0 var(--calcite-spacing-sm-plus)}.msg-icon,.tip-msg{display:flex;justify-content:center;align-items:center;width:100%;margin-bottom:30px}.tip-msg{display:flex;justify-content:center;align-items:center;text-align:center}.header-info{padding:var(--calcite-spacing-sm) 0 var(--calcite-spacing-sm) 15px}.match-expression-dropdown{width:100%}.match-expression-msg{padding:var(--calcite-spacing-md)}.match-type{display:flex;align-items:flex-start;margin:var(--calcite-spacing-sm-plus) 22px var(--calcite-spacing-sm) 22px}:dir(rtl){.match-type{align-items:flex-end}.header-info{padding-left:0;padding-right:15px}}.heading{--calcite-label-margin-bottom: 0;font-weight:700}.clear{margin:0 var(--calcite-spacing-xxs)}.footer-buttons{width:100%;display:flex;flex-direction:row}`,S="empty-msg",B="msg-icon",A="tip-msg",R="header-info",D="match-expression-msg",q="match-expression-dropdown",W="match-type",U="notice";class M extends i.WF{constructor(){super(...arguments),this.fabNode=(0,o._)(),this.layerHasFeatureEffect=!1,this.properClose=!1,this._propWatcherTask=new n.YZ(this,{task:async([e])=>{if(!(0,h.i)(e))throw console.error("[arcgis-common-sql-expression-config] Required properties are missing."),new Error("Required properties are missing.");await this.processProps()},args:()=>[this.layer]}),this._messages=(0,$.u)({blocking:!0}),this.reRender=!1,this.componentStateInvalid=!1,this.hideLayerTitle=!1,this.defaultExpression=!1,this.hideButtons=!1,this.closable=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisCancel=(0,i.lh)(),this.arcgisChange=(0,i.lh)(),this.arcgisClose=(0,i.lh)(),this.arcgisDone=(0,i.lh)(),this.arcgisPanelBackClick=(0,i.lh)(),this.arcgisSave=(0,i.lh)()}static{this.properties={props:16,reRender:16,componentStateInvalid:16,view:0,layer:0,labelClass:0,mode:1,whereClause:1,hideLayerTitle:5,panelHeading:1,noFilterMsg:1,invalidHeading:1,invalidMsg:1,newButtonLabel:1,clearText:1,leadingText:1,defaultFieldName:1,defaultOperator:1,defaultExpression:5,hideButtons:5,panelMaxHeight:1,closable:5,menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=L}async done(){this.componentStateInvalid||(this.applyFilter(),this.properClose=!0,this.arcgisDone.emit())}async openPanel(){"closed"in this.panelNode&&(this.panelNode.closed=!1)}async setFocus(){this.panelNode&&"setFocus"in this.panelNode?this.panelNode.setFocus():this.panelNode?.focus()}async closePopover(){this.el.shadowRoot?.querySelectorAll("arcgis-common-sql-expression-config-expression")?.forEach(e=>e.closePopover())}disconnectedCallback(){super.disconnectedCallback(),this.properClose||(this.closable&&this.applyFilter(),"layer-view"===this.props.mode&&(0,f.o)(this.props)),this.editsHandle?.remove()}setPanelRef(e){const{props:t}=this;this.panelNode=e,t.panelNode=e}async processProps(){if(!this.layer)return;let e=!1;(function(e,t,r){if(e?.tagName===t.toUpperCase()||r)return e;{let s=e?.parentElement;for(;s;){if(s.tagName===t.toUpperCase()||r)return s;if("BODY"===s.tagName)break;s=s.parentElement}}})(this.el,"calcite-dialog")&&(e=!0),"subtype-sublayer"===this.layer.type&&"basic"!==this.mode&&(console.error('SubtypeSublayer is only supported with mode "basic"'),this.componentStateInvalid=!0),this.props={expressions:void 0,logicalOperatorForExpressions:"and",fields:[],operators:void 0,invalidFilter:!1,featureCount:-1,stringFieldsCount:0,dateFieldsCount:0,numberFieldsCount:0,isHosted:!1,supportsStandardizedQuery:!1,supportedSqlParserVersion:!1,supportsCurrentUser:!1,layer:this.layer,view:this.view,labelClass:this.labelClass,_messages:this._messages,inputDefinitionExpression:void 0,backgroundTheme:"light",lastWhere:void 0,defaultFieldName:this.defaultFieldName,defaultOperator:this.defaultOperator,mode:this.mode,insideDialog:e};const{view:t,layer:r,mode:s}=this,{props:a}=this,i=r;if("esri.layers.support.Sublayer"===i.declaredClass){const e=i;t&&await(0,p.whenOnce)(()=>!t.updating);const r=await e.createFeatureLayer();await r.load(),this.props={...a,layer:r,mapImageSublayer:e}}else if("imagery"===i.type||"subtype-group"===i.type||"subtype-sublayer"===i.type||"catalog"===i.type||"catalog-footprint"===i.type)this.props={...a,layer:i};else if("basic"!==s&&(!t||"feature"===i.type&&i.isTable)){let e;e=new c.default({url:i.url,layerId:i.layerId,popupTemplate:i.popupTemplate}),await e.load(),this.props={...a,layer:e,originalLayer:i}}else this.props={...a,layer:i};const{labelClass:o}=this.props,n="feature-reduction"===s?r.featureReduction.labelingInfo:r.labelingInfo;if((0,h.i)(o)&&!n?.length)return void console.log("can't find labelClass");await this.processLayer();const{defaultExpression:l}=this;!this.props.expressions?.length&&l&&this.onAddExpression(),requestAnimationFrame(()=>this.setFocus()),this.watchForEdits()}handleDisablePanel(e){this.panelNode&&("disabled"in this.panelNode?this.panelNode.disabled=e:e?(this.panelNode.classList.add("disabled"),this.blockInteraction()):(this.panelNode.classList.remove("disabled"),this.restoreInteraction()))}handleExpressionChange(e){const{props:t}=this,{expressions:r}=t;if("copy"===e.type){const s=e.expression;let a;t.expressions=t.expressions.map(e=>e.uid===s.uid?s:e),t.expressions=r.map(e=>({...e,conditions:e.conditions.map(e=>({...e,hasFocus:!1}))})),t.expressions.forEach(t=>{t.uid===e.uid&&(a=(0,l.clone)({...t}),a.conditions[0].hasFocus=!0)}),t.expressions=(0,h.f)([...t.expressions,a]),this.reRender=!this.reRender}else if("delete"===e.type){let s=0;r.forEach((t,r)=>{t.uid===e.uid?s=r:t.conditions.forEach(e=>e.hasFocus=!1)}),t.expressions=r.filter(t=>t.uid!==e.uid),t.expressions?.length?(t.expressions[Math.max(0,s-1)].conditions[0].hasFocus=!0,t.expressions=(0,h.f)([...t.expressions]),setTimeout(()=>this.focusByClass(),500)):setTimeout(()=>this.fabNode.value?.setFocus(),500),this.reRender=!this.reRender}else{const r=e.expression;t.expressions=t.expressions.map(e=>e.uid===r.uid?{...r}:e)}this.applyFilterToLayer()}async processLayer(){const{props:e,whereClause:t,hideButtons:r}=this,{layer:s,mapImageSublayer:a,originalLayer:i,view:o,labelClass:n,mode:l}=e;if(o&&!a&&"imagery"!==s.type&&"subtype-group"!==s.type&&"subtype-sublayer"!==s.type&&"sublayer"!==s.type&&"catalog"!==s.type&&"catalog-footprint"!==s.type&&!("feature"===s.type&&s.isTable)&&(e.layerView=await o.whenLayerView(s)),(0,h.c)(e),await(0,f.p)(e),await async function(e){const{layer:t}=e;if(["feature","sublayer","wfs","csv","geojson","subtype-group","oriented-imagery","catalog","catalog-footprint","knowledge-graph"].includes(t.type)){const r=t,s=new g.default({where:"1=1"});e.featureCount=await r.queryFeatureCount(s)}}(e),(0,f.q)(e),e.backgroundTheme=o&&await(0,d.getBackgroundColorTheme)(o)||"light",this.layerHasFeatureEffect=s.featureEffect,"basic"===l||"subtype-sublayer"===s.type){e.inputDefinitionExpression=t,e.lastWhere=e.inputDefinitionExpression;const r=await O(e.inputDefinitionExpression,e);e.invalidFilter=!r,this.reRender=!this.reRender}else if((0,h.i)(n)&&n.where){e.inputDefinitionExpression=n.where,e.lastWhere=e.inputDefinitionExpression;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,this.reRender=!this.reRender}else if("layer-view"===l){if(t){const r=await O(t,e);e.invalidFilter=!r,r&&this.applyFilterToLayer(!0),this.reRender=!this.reRender}}else if("effects"===l){if(e.invalidFilter=!1,s.featureEffect){e.inputDefinitionExpression=s.featureEffect.filter?.where,e.lastWhere=e.inputDefinitionExpression;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,this.reRender=!this.reRender}}else if((0,h.i)(n)||!(0,h.i)(s.definitionExpression)&&!(0,h.i)(i?.definitionExpression))if(r){e.inputDefinitionExpression=s.definitionExpression??void 0,e.lastWhere=e.inputDefinitionExpression;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,this.reRender=!this.reRender}else e.invalidFilter=!1;else{e.inputDefinitionExpression=(i||s).definitionExpression??void 0;const t=await O(e.inputDefinitionExpression,e);e.invalidFilter=!t,t&&this.applyFilterToLayer(!0),this.reRender=!this.reRender,o&&"imagery"!==s.type&&"subtype-group"!==s.type&&"catalog"!==s.type&&"catalog-footprint"!==s.type&&("feature"!==s.type||!s.isTable)&&(s.definitionExpression=null)}"imagery"===s.type&&(e.fieldPickListLayer=s.clone(),e.fieldPickListLayer.definitionExpression=null,e.fieldPickListLayer.load())}applyFilter(){const{props:e}=this,{layerView:t,layer:r,labelClass:s,originalLayer:a,mode:i}=e;if("basic"===i){const t=b(e);this.properClose=!0,this.arcgisSave.emit(t)}else if((0,h.i)(s))this.properClose=!0,this.arcgisSave.emit(void 0);else if("layer-view"===i){const t=b(e);this.properClose=!0,this.arcgisSave.emit(t)}else if("effects"!==i&&r){const s=b(e);(a||r).definitionExpression=s,"featureEffect"in r&&this.isAllowedFeatureEffect()?r.featureEffect=null:t&&"filter"in t&&(t.filter=null),(0,f.o)(e),this.properClose=!0,this.arcgisSave.emit(void 0),this.componentStateInvalid=!0}}cancelFilter(){this.revertFilter(),this.properClose=!0,this.arcgisCancel.emit()}closeFilter(){this.applyFilter(),this.properClose=!0,this.arcgisClose.emit()}revertFilter(){const{props:e,whereClause:t}=this,{layer:r,layerView:s,labelClass:a,inputDefinitionExpression:i,mapImageSublayer:o,originalLayer:n,backgroundTheme:p,mode:c}=e,d=this.getLabelClassIndex();if("basic"!==c)if("imagery"!==r.type&&"subtype-group"!==r.type&&"subtype-sublayer"!==r.type&&"catalog"!==r.type&&"catalog-footprint"!==r.type&&"sublayer"!==r.type&&(0,h.i)(a))a.where=i,"feature-reduction"===c?(r.featureReduction=(0,l.clone)(r.featureReduction),e.labelClass=r.featureReduction.labelingInfo[d]):r.labelingInfo=(0,l.clone)(r.labelingInfo),o&&(o.labelingInfo=r.labelingInfo);else if("layer-view"===c){if("feature"===r.type)if(t)if((0,h.a)(r.featureEffect)){const e="light"===p?100:65;r.featureEffect=new u.default({filter:{where:t},excludedEffect:`grayscale(100%) opacity(30%) brightness(${e}%)`})}else r.featureEffect.filter.where=t,r.featureEffect=r.featureEffect.clone();else r.featureEffect?.filter?.where?(r.featureEffect.filter.where=null,(0,h.a)(r.featureEffect)?r.featureEffect=null:r.featureEffect=r.featureEffect.clone()):r.featureEffect=null}else if("effects"!==c&&r){if(o?o.definitionExpression=i:(n||r).definitionExpression=i,this.isAllowedFeatureEffect()){const e=r;e.featureEffect?.filter?.where&&(e.featureEffect.filter.where=null,(0,h.a)(e.featureEffect)?e.featureEffect=null:e.featureEffect=e.featureEffect.clone())}else s&&"filter"in s&&(s.filter=null);this.componentStateInvalid=!0}}applyFilterToLayer(e){const{props:t,layerViewWaitHandler:r,hideButtons:s,mode:a}=this,{backgroundTheme:i,labelClass:o,layer:n,view:l,layerView:p,mapImageSublayer:c,originalLayer:d,lastWhere:f}=t,g=b(t)||void 0;if(!e&&g!==f&&this.arcgisChange.emit(g),t.lastWhere=g,"basic"!==a){if((0,h.i)(o))return;if("imagery"===n.type||"subtype-group"===n.type||"catalog"===n.type||"catalog-footprint"===n.type)return void(n.definitionExpression=g);if(s)return;if(c)return void(c.definitionExpression=g);if(!l||"feature"===n.type&&n.isTable)return void(d.definitionExpression=b(t));if(r&&(clearTimeout(r),this.layerViewWaitHandler=void 0),!p)return void(this.layerViewWaitHandler=setTimeout(()=>{this.applyFilterToLayer()},500));if(g?.length)if("featureEffect"in n&&this.isAllowedFeatureEffect())if((0,h.a)(n.featureEffect)){const e="light"===i?100:65;n.featureEffect=new u.default({filter:{where:g},excludedEffect:`grayscale(100%) opacity(30%) brightness(${e}%)`})}else n.featureEffect.filter=n.featureEffect.filter||{},n.featureEffect.filter.where=g,n.featureEffect=n.featureEffect.clone();else"filter"in p&&(p.filter={where:g});else"featureEffect"in n&&this.isAllowedFeatureEffect()?n.featureEffect?.filter?.where&&(n.featureEffect.filter.where=null,(0,h.a)(n.featureEffect)?n.featureEffect=null:n.featureEffect=n.featureEffect.clone()):"filter"in p&&(p.filter=null)}}isAllowedFeatureEffect(){const{props:e,layerHasFeatureEffect:t}=this,{layer:r,featureCount:s,mode:a}=e;return!(s>5e5)&&(["feature","geojson","ogc-feature","wfs","csv","stream","knowledge-graph-sublayer"].includes(r.type)&&!r.featureReduction&&"effects"!==a&&"basic"!==a&&(!t||"layer-view"===a))}getLabelClassIndex(){const{props:e}=this,{layer:t,labelClass:r,mode:s}=e;let a=-1;const i="feature"===t.type&&("feature-reduction"===s?t.featureReduction.labelingInfo:t.labelingInfo);return r&&i.forEach((e,t)=>{JSON.stringify(e.toJSON())===JSON.stringify(r.toJSON())&&(a=t)}),a}onAddExpression(){const{props:e}=this,{expressions:t}=e,r=(0,f.r)(e);if(!r)return;const s=(0,f.s)(e,r),a=(0,f.t)(e,r,s),i={conditions:[{fieldName:r.layerField.name,operator:s,...a,hasFocus:!0}]};e.expressions=t?(0,h.f)([...t.map(e=>({...e,conditions:e.conditions.map(e=>({...e,hasFocus:!1}))})),i]):(0,h.f)([i]),(0,h.i)(a.value)&&this.handleExpressionChange({type:"replace",expression:i}),this.reRender=!this.reRender}onMatchSelect(e){const{props:t}=this,r=e.target;t.logicalOperatorForExpressions=r.selectedOption.value,this.reRender=!this.reRender,this.applyFilterToLayer()}onRemoveFilter(){const{props:e}=this;e.invalidFilter=!1,e.expressions=void 0,this.reRender=!this.reRender,this.applyFilterToLayer()}focusByClass(){const e=this.el.querySelector("arcgis-common-sql-expression-config .autofocus");e&&(e.nodeName.startsWith("CALCITE-")?e.setFocus():e?.focus())}watchForEdits(){const{props:e}=this,{layer:t}=e;if("feature"===t.type||"subtype-group"===t.type||"subtype-sublayer"===t.type){let r;r="subtype-sublayer"===t.type?t.parent:t,r?.editingEnabled&&(this.editsHandle?.remove(),this.editsHandle=r?.on("edits",t=>{(t.updatedFeatures?.length||t.addedFeatures?.length||t.deletedFeatures?.length)&&(e.fields.forEach(e=>{e.statisticsStatus=h.b.MISSING,e.histogramStatus=h.b.MISSING,e.uniqueValuesStatus=h.b.MISSING}),this.el.shadowRoot?.querySelectorAll("arcgis-common-sql-expression-config-expression").forEach(e=>e.onEdits()))}))}}blockInteraction(){this.panelNode.onclick=this.interceptedClick,this.addInteractionListeners(this.panelNode)}addInteractionListeners(e){e.addEventListener("pointerdown",this.onPointerDown,{capture:!0}),["mousedown","mouseup","click"].forEach(t=>e.addEventListener(t,this.onNonBubblingWhenDisabledMouseEvent,{capture:!0}))}restoreInteraction(){delete this.panelNode.onclick,this.removeInteractionListeners(this.panelNode)}removeInteractionListeners(e){e.removeEventListener("pointerdown",this.onPointerDown,{capture:!0}),["mousedown","mouseup","click"].forEach(t=>e.removeEventListener(t,this.onNonBubblingWhenDisabledMouseEvent,{capture:!0}))}onPointerDown(e){e.preventDefault()}onNonBubblingWhenDisabledMouseEvent(e){e.stopImmediatePropagation(),e.preventDefault()}interceptedClick(){}render(){return this._propWatcherTask.render({complete:()=>{const{props:e,hideLayerTitle:t,panelHeading:r,componentStateInvalid:s,closable:n,el:l,panelMaxHeight:p,showBackButton:c}=this,{layer:u,mapImageSublayer:d,invalidFilter:h,mode:f,_messages:g}=e,m=d?d.title:u.title;return s?a.qy`<div></div>`:u?h?this.renderInvalidFilter():"basic"===f?a.qy`<div class="content-div" ${(0,o.K)(this.setPanelRef)}>${this.renderContent()}</div>`:"CALCITE-FLOW"===l.parentElement?.tagName||"CALCITE-FLOW"===l.parentElement?.parentElement?.tagName||c?(this.el.classList.add("flow-item-host"),a.qy`<calcite-flow-item .heading=${r||g.title} .description=${t?void 0:m??void 0} style=${(0,i.zl)(p?{maxHeight:p}:void 0)} .closable=${n} .selected=${this.selected} .showBackButton=${!n} @calciteFlowItemBack=${()=>{if("layer-view"===f){const t=b(e);this.arcgisPanelBackClick.emit(t)}else this.arcgisPanelBackClick.emit(void 0)}} @calciteFlowItemClose=${()=>this.closeFilter()} ${(0,o.K)(this.setPanelRef)}>${this.renderContent()}</calcite-flow-item>`):(this.selected=!0,a.qy`<calcite-panel .heading=${r||g.title} .description=${t?void 0:m??void 0} style=${(0,i.zl)(p?{maxHeight:p}:void 0)} .closable=${n} @calcitePanelClose=${()=>this.closeFilter()} ${(0,o.K)(this.setPanelRef)}>${this.renderContent()}</calcite-panel>`):this.renderLoading()}})}renderContent(){return a.qy`${this.renderFooterButtons()}${this.renderHeaderInfo()}${this.renderMatchExpressionMsg()}${this.renderExpressions()}${this.renderTip()}${this.renderAddExpression()}`}renderFooterButtons(){const{props:e,hideButtons:t}=this,{labelClass:r,mode:s}=e,i=(0,h.i)(r);if(!(t||i||s&&["layer-view","basic"].includes(s)))return a.qy`<div slot=footer class="footer-buttons">${this.renderSaveButton()}${this.renderCancelButton()}</div>`}renderSaveButton(){const{props:e}=this,{_messages:t}=e;return a.qy`<calcite-button @click=${this.applyFilter} appearance=solid width=half .label=${t.save}>${t.save}</calcite-button>`}renderCancelButton(){const{props:e}=this,{_messages:t}=e;return a.qy`<calcite-button @click=${this.cancelFilter} appearance=outline-fill width=half .label=${t.cancel}>${t.cancel}</calcite-button>`}renderHeaderInfo(){const{props:e,leadingText:t,clearText:r}=this,{_messages:s,expressions:o}=e;if(o?.length)return a.qy`<div class=${(0,i.CP)(R)}><calcite-label class="heading" layout=inline-space-between>${t||s.showFeaturesWhere}<calcite-button class="clear" appearance=transparent @click=${this.onRemoveFilter}>${r||s.clearAll}</calcite-button></calcite-label></div>`}renderLoading(){const{props:e,hideLayerTitle:t,panelHeading:r}=this,{layer:s,mapImageSublayer:i,mode:o,_messages:n}=e,l=i?i.title:s.title;return"basic"===o?a.qy`<div></div>`:a.qy`<calcite-panel .heading=${r||n.title} .description=${t?void 0:l??void 0} loading></calcite-panel>`}renderInvalidFilter(){const{props:e,hideLayerTitle:t,closable:r,panelHeading:s,el:i}=this,{layer:n,mapImageSublayer:l,mode:p,_messages:c}=e,u=l?l.title:n.title;return"basic"===p?a.qy`<div ${(0,o.K)(this.focusByClass)}>${this.renderInvalidContent()}</div>`:"CALCITE-FLOW"===i.parentElement?.tagName||"CALCITE-FLOW"===i.parentElement?.parentElement?.tagName?a.qy`<calcite-flow-item .heading=${s||c.title} .description=${t?void 0:u??void 0} .closable=${r} @calciteFlowItemBack=${()=>{this.arcgisPanelBackClick.emit(void 0)}} @calciteFlowItemClose=${()=>this.closeFilter()} ${(0,o.K)(this.focusByClass)}>${this.renderInvalidContent()}</calcite-flow-item>`:a.qy`<calcite-panel .heading=${s||c.title} .description=${t?void 0:u??void 0} .closable=${r} @calcitePanelClose=${()=>this.closeFilter()} ${(0,o.K)(this.focusByClass)}>${this.renderInvalidContent()}</calcite-panel>`}renderInvalidContent(){return a.qy`${this.renderFooterButtons()}${this.renderInvalidFilterMsg()}`}renderInvalidFilterMsg(){const{invalidHeading:e,invalidMsg:t,newButtonLabel:r,props:s}=this,{_messages:o}=s;return a.qy`<div class=${(0,i.CP)(U)}><calcite-notice scale=s width=full kind=danger icon=exclamation-mark-triangle open><div slot=title>${e||o.errors.problemDisplayingFilter}</div><div slot=message>${t||o.errors.problemDisplayingFilterMsg}</div><calcite-link slot=link @click=${this.onRemoveFilter}>${r||o.createNewFilter}</calcite-link></calcite-notice></div>`}renderMatchExpressionMsg(){const{props:e}=this,{expressions:t,logicalOperatorForExpressions:r,_messages:s}=e;if(!t?.length)return;const o=r===h.l.AND;return t.length>1?a.qy`<div class=${(0,i.CP)(D)}><calcite-label class="no-space" scale=m><calcite-select width=full scale=m .label=${s.accessibility.matchType} class=${(0,i.CP)(q)} @calciteSelectChange=${this.onMatchSelect}><calcite-option .value=${h.l.AND} .label=${s.matchAll} .selected=${o}></calcite-option><calcite-option .value=${h.l.OR} .label=${s.matchAtLeastOne} .selected=${!o}></calcite-option></calcite-select></calcite-label></div>`:null}renderExpressions(){const{props:e}=this,{expressions:t}=e;if(t?.length)return a.qy`<div>${t.map((e,t)=>this.renderExpression(e,t))}</div>`}renderExpression(e,t){const{props:r}=this;return a.qy`<div>${this.renderLogicalOperatorExpression(t)}<arcgis-common-sql-expression-config-expression .props=${r} .uid=${e.uid} .conditions=${e.conditions} .logicalOperatorForConditions=${e.logicalOperatorForConditions} @arcgisExpressionChanged=${e=>{const t=e.detail;this.handleExpressionChange(t)}} @arcgisDisablePanel=${e=>{const t=e.detail;this.handleDisablePanel(t)}} ${(0,o.K)(this.focusByClass)}></arcgis-common-sql-expression-config-expression></div>`}renderLogicalOperatorExpression(e){const{props:t}=this,{logicalOperatorForExpressions:r,_messages:s}=t;if(0!==e)return a.qy`<div class=${(0,i.CP)(W)}><span>${r===h.l.OR?s.or:s.and}</span></div>`}renderAddExpression(){const{props:e}=this,{mode:t}=e;return"basic"===t?a.qy`<div class="fab-without-panel">${this.renderAddExpressionFab()}</div>`:this.renderAddExpressionFab()}renderAddExpressionFab(){const{props:e,hideButtons:t}=this,{expressions:r,_messages:s}=e;return a.qy`<calcite-fab class=${(0,i.CP)({autofocus:!r?.length,"fab-padding":t})} slot=fab appearance=outline-fill kind=neutral icon=plus text-enabled .text=${s.addNew} @click=${this.onAddExpression} ${(0,o.K)(this.fabNode)}></calcite-fab>`}renderTip(){const{props:e,noFilterMsg:t}=this,{mapImageSublayer:r,expressions:s,labelClass:o,mode:n,_messages:l}=e;if(s?.length)return;const p=(0,h.i)(o);return a.qy`<div class=${(0,i.CP)(S)}>${!t&&a.qy`<calcite-icon class=${(0,i.CP)(B)} icon=layer-filter></calcite-icon>`||""}<div class=${(0,i.CP)(A)}>${t||(p?l.tips.emptyMsgLabels:r||"layer-view"===n?l.tips.emptyMsgMS:l.tips.emptyMsg)}</div></div>`}}(0,s.c)("arcgis-common-sql-expression-config",M)},42984:(e,t,r)=>{r.d(t,{u:()=>i});var s=r(83552),a=r(22229);const i=(0,s.yr)(a.g)},47640:(e,t,r)=>{r.d(t,{YZ:()=>o,e1:()=>a});var s=r(4836);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},i=Symbol();class o{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,r){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:r};this.v=s.task,this.j=s.args,this.m=s.argsEqual??n,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,r;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let a=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){a=!0,r=e}if(this.p===s){if(t===i)this.i=0;else{if(!1===a){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(r)}catch{}this.i=3,this.h?.(r)}this.u=t,this.l=r}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const n=(e,t)=>e===t||e.length===t.length&&e.every((e,r)=>!(0,s.Ec)(e,t[r]))}}]);