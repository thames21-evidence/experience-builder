/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-04b3bd.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-04b3bd"],{4265:(e,t,i)=>{i.d(t,{a:()=>s,d:()=>a,t:()=>n});const a=(e,t)=>{let i,a="idle";const s=async(...s)=>await new Promise(n=>{switch(a){case"flushed":a="idle",i?(clearTimeout(i),n(e(...s))):n(null);break;case"invoked":clearTimeout(i),a="idle",n(e(...s));break;case"cancelled":clearTimeout(i),a="idle",n(null);break;default:i&&clearTimeout(i),a="pending",i=setTimeout(()=>{a="idle",n(e(...s))},t)}});return s.flush=async function(...e){return a="flushed",await s(...e)},s.invoke=async function(...e){return a="invoked",await s(...e)},s.cancel=async function(...e){return a="cancelled",await s(...e)},s.getStatus=function(){return a},s},s=(e,t)=>{let i;return async(...a)=>await new Promise(s=>{i||(i=setTimeout(()=>{clearTimeout(i),i=void 0,s(e(...a))},t))})};function n(e){return new Promise(t=>setTimeout(t,e))}},5464:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigCustomizeMap:()=>u});var a=i(73679),s=i(4395),n=i(36486),r=i(44345),l=i(51072),o=i(4265),c=i(73801),h=i(47640),m=i(66228),p=i(85643);const d=s.AH`@layer{arcgis-map-config-customize-map{.action-switch{padding-right:5px}arcgis-embedded-map{--calcite-panel-space: 0}.actions{padding-top:16px}.bottom-padding-sm{padding-bottom:8px}.bottom-padding-md{padding-bottom:12px}.code-input-box{width:100%}.config-panel{--calcite-panel-background-color: white}.customize-map-content{height:750px;display:flex}.embed-dialog{--calcite-dialog-background-color: white}.embedded-map-container{width:250%;position:relative}.footer{display:flex;width:100%;column-gap:10px}.info-icon{color:var(--calcite-color-brand)}.map-view-config{display:flex;align-items:center;padding-bottom:12px}.map-view-config-label{margin-left:var(--calcite-spacing-sm);margin-right:var(--calcite-spacing-xxs);--calcite-label-margin-bottom: 0}.map-scale-info-icon:hover{cursor:pointer}.mode-tiles{padding-bottom:16px}.section-title{font-weight:500}.shorten-url{margin:0 20px;--calcite-label-margin-bottom: 0px;min-width:fit-content}.size-info{margin-top:10px;margin-bottom:10px}.size-select{margin-right:10px}.tooltip-content{width:340px}.width-full{width:100%}}}`;class u extends c.WF{constructor(){super(...arguments),this.center=[],this.extent=void 0,this.mapConfig={bookmarksEnabled:!1,legendEnabled:!1,headingEnabled:!1,mapSummaryEnabled:!1,mapView:"scale",shareEnabled:!1,theme:"light",scrollEnabled:!1},this.scriptType="component",this.scaleTooltipButton=(0,p._)(),this.shortenURL=!1,this.shortenUrlCheckbox=(0,p._)(),this._messages=(0,n.u)({blocking:!0}),this.handleMapViewChange=(0,o.d)(async e=>{if(this.scale=e.scale,this.extent=e.extent?this.formatExtent(e.extent):void 0,e.extent&&!e.extent.spatialReference.wkid){await l.load();const t=l.execute(e.extent,{wkid:4326});t?.extent&&(this.extent=this.formatExtent(t.extent))}if(this.center=Array.isArray(e.center)?e.center:e.center.longitude&&e.center.latitude?[e.center.longitude,e.center.latitude]:[e.center.x,e.center.y],"spatialReference"in e.center&&(!e.center.spatialReference.wkid||!e.center.spatialReference.isGeographic)){await l.load();const t=l.execute(e.center,{wkid:4326});"point"===t?.type&&t.longitude&&t.latitude&&(this.center=[t.longitude,t.latitude])}this.generateCustomOutput()},300),this._propWatcherTask=new h.YZ(this,{task:async([e,t])=>{if(!(0,m.i)(e)||!(0,m.i)(t))throw console.error("[arcgis-map-config-customize-map] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.config,this.webmap]}),this.copied=!1,this.output="",this.showPermissionsNotice=!1,this.mode="embed",this.arcgisUpdatePermissions=(0,c.lh)()}static{this.properties={copied:16,output:16,showPermissionsNotice:16,config:0,mapView:0,mode:1,webmap:0}}static{this.styles=d}static{this.shadowRootOptions=c.Iq}async refreshAccess(){if(!this.webmap?.portalItem?.access)return;const e=this.webmap.portalItem.clone();await e.reload(),this.showPermissionsNotice="public"!==e.access}async init(){if(this.showPermissionsNotice="public"!==this.webmap.portalItem?.access,this.mapView&&(this.initialCenter=this.mapView.center,this.initialScale=this.mapView.scale,!this.mapView?.center.spatialReference.wkid||!this.mapView?.center.spatialReference.isGeographic)){await l.load();const e=l.execute(this.mapView.center,{wkid:4326},{areaOfInterestExtent:this.mapView.extent});"point"===e?.type&&(this.initialCenter=e)}await this.generateCustomOutput()}embeddedMapRefHandler(e){e&&(this.initialCenter&&(e.center=this.initialCenter),this.initialScale&&(e.scale=this.initialScale),this.listen("arcgisViewChange",()=>{this.handleMapViewChange(e)}))}formatExtent(e){return`${e.xmin},${e.ymin},${e.xmax},${e.ymax},${e.spatialReference.wkid}`}async generateCustomOutput(){this.shortenUrlCheckbox.value&&(this.shortenUrlCheckbox.value.checked=!1),"embed"===this.mode?this.output="component"===this.scriptType?this.getEmbedHTML():await this.getIframeEmbedHTML():"link"===this.mode&&(this.output=await this.getSimpleViewLink()),this.copied=!1,this.shortenURL=!1}getEmbedHTML(){const{mapConfig:e}=this,t="\x3c!-- Add script to the <head> of your page to load the embeddable map component --\x3e\n";let i=`\n    <arcgis-embedded-map\n    style="height:600px; width:700px;"\n    item-id="${this.webmap.portalItem?.id}"\n    theme="${e.theme}"\n    \n    ${e.bookmarksEnabled?"bookmarks-enabled":""}\n    ${e.headingEnabled?"heading-enabled":""}\n    ${e.legendEnabled?"legend-enabled":""}\n    ${e.mapSummaryEnabled?"information-enabled":""}\n    ${e.shareEnabled?"share-enabled":""}\n    ${e.scrollEnabled?"scroll-enabled":""}\n    ${"content"===e.mapView&&this.extent?`extent="${this.extent}"`:"scale"===e.mapView&&this.center&&this.scale?`center="${this.center.toString()}" scale="${this.scale}"`:""}\n    ${this.webmap.portalItem?.portal.url?`portal-url="${this.webmap.portalItem.portal.url}"`:""}></arcgis-embedded-map>`.replaceAll(" ","").replaceAll(/(?<newLine>\n)\1{0,}/gu," ");return i=t.concat('<script type="module" src="https://js.arcgis.com/4.34/embeddable-components/"><\/script>\n').concat("\x3c!-- Add custom element to <body> of your page --\x3e\n").concat(i),i}async getIframeEmbedHTML(){const e=await this.getSimpleViewLink();return`<iframe\n      width="700"\n      height="600"\n      allow="local-network-access; geolocation"\n      title="${this.webmap?.portalItem?.title}"\n      src="${e}"\n    ></iframe>`.replaceAll("  ","").replaceAll(/(?<newLine>\n)\1{0,}/gu," ")}async getShortenedURL(e){return(await(0,r.default)("https://arcg.is/prod/shorten",{query:{longUrl:e,f:"json"}}))?.data?.data?.url??void 0}async getSimpleViewLink(){const{mapConfig:e}=this;let t=`${this.webmap.portalItem?.portal.url}/apps/mapviewer/index.html?\n    configurableview=true\n    &webmap=${this.webmap.portalItem?.id}\n    &theme=${e.theme}\n    ${e.bookmarksEnabled?"&bookmarks=true":""}\n    ${e.headingEnabled?"&heading=true":""}\n    ${e.legendEnabled?"&legend=true":""}\n    ${e.mapSummaryEnabled?"&information=true":""}\n    ${e.shareEnabled?"&share=true":""}\n    ${"embed"!==this.mode||e.scrollEnabled?"":"&scroll=false"}\n    ${"content"===e.mapView&&this.extent?`&extent=${this.extent}`:"scale"===e.mapView&&this.center&&this.scale?`&center=${this.center.toString()}&scale=${this.scale}`:""}`.replaceAll(" ","").replaceAll(/(?<newLine>\n)\1{0,}/gu,"");return this.shortenURL&&(t=await this.getShortenedURL(t)??t),this.shortenURL=!1,t}render(){return this._propWatcherTask.render({complete:()=>s.qy`<calcite-dialog class="customize-map-dialog" .heading=${"embed"===this.mode?this._messages.embed:this._messages.createLink} modal open width=l><div class="customize-map-content">${this.renderConfigPanel()}${this.renderPreviewPanel()}</div><div slot=footer class="footer">${this.renderShareOutput()}</div></calcite-dialog>`})}renderConfigPanel(){return s.qy`<calcite-panel class="config-panel">${this.renderMode()}${this.renderMapElements()}${this.renderMapActions()}${this.renderMapView()}</calcite-panel>`}renderMode(){return s.qy`<calcite-label class="mode-tiles section-title">${this._messages.mode}<calcite-tile-group alignment=center .label=${this._messages.mode} selection-appearance=border selection-mode=single><calcite-tile alignment=center selected @calciteTileSelect=${()=>{this.mapConfig.theme="light",this.generateCustomOutput()}}><div class="width-full" slot=content-top><calcite-label alignment=center><calcite-icon class="width-full" icon=brightness></calcite-icon>${this._messages.light}</calcite-label></div></calcite-tile><calcite-tile alignment=center @calciteTileSelect=${()=>{this.mapConfig.theme="dark",this.generateCustomOutput()}}><div class="width-full" slot=content-top><calcite-label alignment=center><calcite-icon class="width-full" icon=moon></calcite-icon>${this._messages.dark}</calcite-label></div></calcite-tile></calcite-tile-group></calcite-label>`}renderMapView(){const e=(0,a.g)("./assets/map-config-customize-map/images/centerscale.png");return s.qy`<calcite-label class="section-title">${this._messages.mapView}</calcite-label><div class="map-view-config"><calcite-switch .checked=${"scale"===this.mapConfig.mapView} class="action-switch" @calciteSwitchChange=${e=>{this.mapConfig.mapView=e.target.checked?"scale":"content",this.generateCustomOutput()}}></calcite-switch><calcite-label class="map-view-config-label">${this._messages.preserveScale}</calcite-label><calcite-button class="map-view-config-icon" scale=s icon-start=information kind=neutral appearance=transparent ${(0,p.K)(this.scaleTooltipButton)}></calcite-button></div><calcite-popover .heading=${this._messages.preserveScale} closable overlay-positioning=fixed .referenceElement=${this.scaleTooltipButton.value} .label=${this._messages.preserveScale} @calcitePopoverClose=${()=>setTimeout(()=>{this.scaleTooltipButton.value?.setFocus()},100)}><calcite-panel><div class="tooltip-content"><img src=${e??c.s6}>${this._messages.preserveScaleTooltip}</div>${this.config.helpBase&&this.config.helpMap&&s.qy`<calcite-button slot=footer-end target=_blank .href=${`${this.config.helpBase}${this.config.helpMap[120004664]}`}>${this._messages.learnMore}</calcite-button>`||""}</calcite-panel></calcite-popover>${"embed"===this.mode&&s.qy`<div class="map-view-config"><calcite-switch .checked=${!this.mapConfig.scrollEnabled} class="action-switch" @calciteSwitchChange=${e=>{this.mapConfig.scrollEnabled=!e.target.checked,this.generateCustomOutput()}}></calcite-switch><calcite-label class="map-view-config-label">${this._messages.disableScrollZoom}</calcite-label></div>`||""}`}renderMapElements(){return s.qy`<calcite-label class="section-title"> ${this._messages.mapElements}</calcite-label><calcite-label class="bottom-padding-sm" layout=inline><calcite-checkbox @calciteCheckboxChange=${e=>{this.mapConfig.headingEnabled=e.target.checked,this.generateCustomOutput()}}></calcite-checkbox>${this._messages.mapTitle}</calcite-label><calcite-label class="bottom-padding-sm" layout=inline><calcite-checkbox @calciteCheckboxChange=${e=>{this.mapConfig.legendEnabled=e.target.checked,this.generateCustomOutput()}}></calcite-checkbox>${this._messages.legend}</calcite-label><calcite-label class="bottom-padding-sm" layout=inline><calcite-checkbox @calciteCheckboxChange=${e=>{this.mapConfig.mapSummaryEnabled=e.target.checked,this.generateCustomOutput()}}></calcite-checkbox>${this._messages.mapSummary}</calcite-label><calcite-label class="bottom-padding-sm" layout=inline><calcite-checkbox @calciteCheckboxChange=${e=>{this.mapConfig.bookmarksEnabled=e.target.checked,this.generateCustomOutput()}}></calcite-checkbox>${this._messages.bookmarks}</calcite-label>`}renderMapActions(){return s.qy`<calcite-label class="actions section-title">${this._messages.availableActions} </calcite-label><calcite-label class="bottom-padding-md" layout=inline><calcite-switch class="action-switch" @calciteSwitchChange=${e=>{this.mapConfig.shareEnabled=e.target.checked,this.generateCustomOutput()}}></calcite-switch>${this._messages.openInMapViewer}</calcite-label>`}renderPreviewPanel(){const{mapConfig:e}=this;return s.qy`<calcite-panel class="embedded-map-container"><calcite-notice class="bottom-padding-sm permissions-notice" .open=${"link"===this.mode&&this.showPermissionsNotice} icon=exclamation-mark-triangle closable kind=warning width=full><div slot=title>${this._messages.permissionsNoticeTitle}</div><div slot=message>${this._messages.permissionsNoticeDescription}</div><calcite-link slot=link @click=${()=>this.arcgisUpdatePermissions.emit()}>${this._messages.updatePermissions}</calcite-link></calcite-notice>${this.webmap.portalItem?.id?s.qy`<arcgis-embedded-map item-id=${this.webmap.portalItem.id??c.s6} .portalUrl=${this.webmap.portalItem.portal.url} .theme=${e.theme} .bookmarksEnabled=${e.bookmarksEnabled} .headingEnabled=${e.headingEnabled} .legendEnabled=${e.legendEnabled} .informationEnabled=${e.mapSummaryEnabled} .shareEnabled=${e.shareEnabled} .scrollEnabled=${"link"===this.mode||e.scrollEnabled} .host=${"js"} .calciteScriptOverride=${void 0} .calciteStyleOverride=${void 0} ${(0,p.K)(this.embeddedMapRefHandler)}></arcgis-embedded-map>`:""}</calcite-panel>`}renderShareOutput(){return s.qy`${"embed"===this.mode&&s.qy`<calcite-combobox selection-mode=single-persist .label=${this.scriptType} @calciteComboboxChange=${e=>{this.scriptType=e.currentTarget.value,this.generateCustomOutput()}}><calcite-combobox-item .label=${this._messages.scriptEmbed} .heading=${this._messages.scriptEmbed} value=component .selected=${"component"===this.scriptType}></calcite-combobox-item><calcite-combobox-item .label=${this._messages.iframeEmbed} .heading=${this._messages.iframeEmbed} value=iframe .selected=${"iframe"===this.scriptType}></calcite-combobox-item></calcite-combobox>`||""}<calcite-input read-only class="code-input-box" type=text .value=${this.output}></calcite-input>${"link"===this.mode&&!this.webmap.portalItem?.portal.isPortal&&s.qy`<calcite-label class="shorten-url" layout=inline><calcite-checkbox @calciteCheckboxChange=${async e=>{this.shortenURL=e.target.checked,this.output=await this.getSimpleViewLink(),this.copied=!1}} ${(0,p.K)(this.shortenUrlCheckbox)}></calcite-checkbox>${this._messages.shortenURL}</calcite-label>`||""}${this.copied?s.qy`<calcite-button icon-start=check kind=neutral>${"embed"===this.mode?this._messages.htmlCopied:this._messages.linkCopied}</calcite-button>`:s.qy`<calcite-button kind=brand @click=${()=>{this.copied=!0,navigator.clipboard.writeText(this.output)}}>${"embed"===this.mode?this._messages.copyHTML:this._messages.copyLink}</calcite-button>`}`}}(0,a.c)("arcgis-map-config-customize-map",u)},36486:(e,t,i)=>{i.d(t,{u:()=>n});var a=i(83552),s=i(73679);const n=(0,a.yr)(s.g)},42855:(e,t,i)=>{i.d(t,{a:()=>r,f:()=>a,l:()=>s,s:()=>n});var a=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(a||{}),s=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(s||{}),n=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(n||{}),r=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(r||{})},47640:(e,t,i)=>{i.d(t,{YZ:()=>r,e1:()=>s});var a=i(4836);const s={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},n=Symbol();class r{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const a="object"==typeof t?t:{task:t,args:i};this.v=a.task,this.j=a.args,this.m=a.argsEqual??l,this.k=a.onComplete,this.A=a.onError,this.autoRun=a.autoRun??!0,"initialValue"in a&&(this.u=a.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const a=++this.p;this.q=new AbortController;let s=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){s=!0,i=e}if(this.p===a){if(t===n)this.i=0;else{if(!1===s){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const l=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,a.Ec)(e,t[i]))},66228:(e,t,i)=>{i.d(t,{a:()=>y,b:()=>T,c:()=>R,d:()=>E,e:()=>_,f:()=>O,g:()=>b,h:()=>f,i:()=>u,j:()=>g,k:()=>$,l:()=>P,m:()=>v,n:()=>p,o:()=>k,p:()=>M,q:()=>I,r:()=>L,s:()=>x,t:()=>C,u:()=>w});var a=i(63438),s=i(18423),n=i(96086),r=i(91813),l=i(21255),o=i(13078),c=i(21303),h=i(12627),m=i(42855);const p=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],d=["feature"];function u(e){return null!=e}function g(e,t,i){const a=t.fieldName;if(a.includes(m.f.expression)){const e=i.get(a);return e?.title?e.title:a}return x(e)&&e.getFieldConfiguration(a)?e.getFieldAlias(a)||a:t.label||a}async function b(e){return new Map((await $(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function f(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${m.f.expression}${e.name}`;t.set(i,e)}),t}function y(e){return"map-image"===e?.layer?.type?m.s.mapImage:"subtype-sublayer"===e?.type?m.s.subtype:"tile"===e?.layer?.type?m.s.tile:"scene"===e?.type?m.s.scene:"ogc-feature"===e?.type?m.s.ogcFeature:"imagery"===e?.type?m.s.imagery:"imagery-tile"===e?.type?m.s.imageryTile:"wfs"===e?.type?m.s.wfs:"wcs"===e?.type?m.s.wcs:"wms"===e?.layer?.type?m.s.wms:"csv"===e?.type?m.s.csv:"geojson"===e?.type?m.s.geojson:"stream"===e?.type?m.s.stream:"oriented-imagery"===e?.type?m.s.orientedImagery:"catalog"===e?.type?m.s.catalog:"catalog-footprint"===e?.type?m.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?m.s.knowledgeGraphSublayer:"voxel"===e?.type?m.s.voxel:"parquet"===e?.type?m.s.parquet:m.s.feature}function w(e){const t=y(e);let i;return t===m.s.wms||t===m.s.mapImage?i=e?.layer.version:(t===m.s.imagery||t===m.s.feature||t===m.s.scene)&&(i=e.version),Number.parseFloat(i)}function x(e){return"fieldConfigurations"in e&&d.includes(e.type)}async function $(e){return await new Promise((t,i)=>{switch(y(e)){case m.s.feature:case m.s.ogcFeature:case m.s.stream:t(e.fields);break;case m.s.mapImage:{const a=e,s=a?.layer;s?.portalItem&&s.url.includes("https://demographics")&&s.url.includes(".arcgis.com")?s.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(a.fields.map(e=>[e.name,e])),s=e.thematicGroup.fieldNames,n=[];s.forEach(e=>{i.has(e)&&n.push(i.get(e))}),t(n)}else t(a.fields)}).catch(e=>{i(new Error(e))}):t(a.fields);break}case m.s.imagery:case m.s.imageryTile:case m.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function k(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function v(e){return Number((100*(1-e)).toFixed(1))}function C(e){return Number((1-e/100).toFixed(3))}const E=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(m.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},T=async(e,t)=>{const i=new h.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},_=async(e,t,i)=>{const a=await(await e.whenLayerView(t)).queryAggregates();return await S(i,a.features?.[0])},S=async(e,t)=>{let i;if(t)i=t.clone();else{i=new a.default;const t=E(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const n=new s.default;i.geometry=n}return i};function I(e,t){const i=t.startsWith("#"),a=t.startsWith(".");for((a||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(a){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function R(e){if(y(e)===m.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(y(e)===m.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function P(e,t,i){let a="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))a="number";else if(t.has(e)){const i=t.get(e);a=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);a=t.returnType?t.returnType.toLowerCase():""}else a="number";return a}async function O(e,t){try{const i=y(e);if(i===m.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await T(e,t)||await q(e,t)]};if(i===m.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await q(e,t)]};const a=i===m.s.ogcFeature||i===m.s.stream?await t.whenLayerView(e):e,s=a.createQuery();s.where=a.definitionExpression||"1=1",s.outFields=["*"],s.returnM="hasM"in e&&e.hasM,s.returnZ="hasZ"in e&&e.hasZ,s.outSpatialReference=t.spatialReference,s.returnGeometry=!0,(a.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===m.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=t.spatialReference;const n=await a.queryFeatures(s);return n?.features?.length||(n.features[0]=await q(e,t)),n}catch(e){console.error(e)}}async function q(e,t){return await new Promise(i=>{const s=new a.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),s.attributes=t}const c=t.extent;let h;"polygon"===e.geometryType?h=l.default.fromExtent(c):"point"===e.geometryType?h=c.center.clone():"multipoint"===e.geometryType?h=new n.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(h=new r.default({spatialReference:t.spatialReference.clone()}),h.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(h=o.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),s.geometry=h,i(s)})}function L(e){return y(e)===m.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function M(e){return y(e)===m.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);