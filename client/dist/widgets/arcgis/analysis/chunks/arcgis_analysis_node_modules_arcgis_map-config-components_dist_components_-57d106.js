/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-57d106.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-57d106"],{20566:(e,t,s)=>{s.r(t),s.d(t,{ArcgisMapConfigLayerViewBrowseLayer:()=>y});var i=s(73679),o=s(4395),r=s(28252),a=s(65722),n=s(2801),l=s(13661),c=s(21255),m=(s(59102),s(2924)),d=s(33752),p=s(44345),g=(s(588),s(51072),s(85643)),u=s(73801);function f(e,t,s){const{_messages:i}=s;return e.geometryType!==t.geometryType?(console.log("layer geometry type does not match"),i.msg.swapErrors.geometryType):JSON.stringify(e.spatialReference.toJSON())!==JSON.stringify(t.spatialReference.toJSON())?(console.log("layer spatial reference does not match"),i.msg.swapErrors.spatialReference):null}function w(e,t,s){const{_messages:i}=s,o=(0,n.m)(s,e),r=(0,n.e)(e.layerId,s);let a;if(r?.fields){const t=r.fields.concat(o);a=e.fields.filter(e=>t.includes(e.name))}else a=e.fields;for(let s=0;s<a.length;s++){const o=a[s],r=t.fields.find(e=>o.name===e.name);if(!r)return console.log("layer",e.layerId,e.title,": field",o.name,"missing in new source layer"),i.msg.swapErrors.missingField;if(o.type!==r.type)return console.log("layer",e.layerId,e.title,": field type of",o.name,"different in layers"),i.msg.swapErrors.fieldType}return null}const h=o.AH`:host{display:none}:host([selected]){display:flex}.panel{height:100%}`;class y extends u.WF{constructor(){super(...arguments),this.flowItemNode=(0,g._)(),this.goSwapLayer=async e=>{const{props:t,flowItemNode:{value:s},el:i}=this,{_messages:r}=t,a=this.items.find(t=>t.id===e);this.loading=!0;const g=await async function(e,t){const{layerItem:s,layer:i,adminServiceInfo:o,_messages:r}=t;if(!i||!s||!t)return null;if(t.swapItem=void 0,t.swapLayer=void 0,s.id===e.id)return await Promise.resolve("");const a=d.default.fromJSON(e);await a.load();const l=await m.default.fromPortalItem({portalItem:a});if(i.type!==l.type)return console.log("layer type does not match,",i.type,"!=",l.type),await Promise.resolve(r.msg.swapErrors.layerType);if("group"===i.type?await l.loadAll():await l.load(),"group"===i.type){const e=o.layers[0].capabilities.indexOf("Sync")>-1,t=(0,n.g)(l),s=(0,n.c)(l);if(e!==(t?.length?t:s).getItemAt(0).sourceJSON.capabilities.indexOf("Sync")>-1)return console.log("new source layer Sync not matching"),await Promise.resolve(r.msg.swapErrors.sync)}else if(o.capabilities.indexOf("Sync")>-1!=l.sourceJSON.capabilities.indexOf("Sync")>-1)return console.log("new source layer Sync not matching"),await Promise.resolve(r.msg.swapErrors.sync);if("group"===i.type&&((0,n.g)(i)?.length!==(0,n.g)(l)?.length||(0,n.c)(i)?.length!==(0,n.c)(l)?.length))return console.log("layer sublayers count does not match"),await Promise.resolve(r.msg.swapErrors.layerCount);if("group"===i.type){const e=(0,n.a)(i),s=(0,n.a)(l);for(let i=0;i<e.length;i++){const o=e.getItemAt(i),r=s.getItemAt(i);let a=f(o,r,t);if(a)return await Promise.resolve(a);if(a=w(o,r,t),a)return await Promise.resolve(a)}}else{let e=f(i,l,t);if(e)return await Promise.resolve(e);if(e=w(i,l,t),e)return await Promise.resolve(e)}return t.swapItem=e,t.swapLayer=l,await Promise.resolve(null)}(a,this.props);if(g)this.loading=!1,this.msgNode=(0,u.dN)(o.qy`<arcgis-map-config-layer-view-msg .props=${t} .flowItemElement=${s} is-error .message=${`${r.msg.cannotSwap} ${g}`} @arcgisMsgClosed=${()=>{document.getElementById(`swap-action-${e}`)?.setFocus(),this.removeMsg()}}></arcgis-map-config-layer-view-msg>`),i.shadowRoot.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout(()=>{document.getElementById(`swap-action-${e}`)?.setFocus(),this.removeMsg()},7e3);else try{await async function(e){let{layer:t,layerIds:s}=e;const{view:i,swapItem:o,swapLayer:r}=e;if(i&&t)try{await(0,n.p)(e,p.default);const a=d.default.fromJSON(o);await a.load(),e.layerItem=a,e.layer=r,e.swapItem=void 0,e.swapLayer=void 0;const m=e.viewItem;if(e.viewItem=void 0,e.adminServiceInfo=void 0,await(0,n.b)(e),await(0,n.q)(e,{serviceurl:m.url},p.default),e.viewItem=m,e.adminServiceInfo=void 0,await(0,n.b)(e),i.map?.remove(t),t=e.layer,"group"===t.type){const e=(0,n.g)(t);e?.length&&(s&&e.forEach(e=>{const t=e;e.visible=s.includes(t.layerId)}),i.map?.add(t)),e?.forEach(e=>{const t=e;!t.popupTemplate&&t.popupEnabled&&(t.popupTemplate=t.createPopupTemplate())})}else t.isTable||i.map?.add(t),t.popupTemplate=t.createPopupTemplate();(0,n.a)(e.adminServiceInfo).forEach(async t=>{const s=t.viewDefinitionQuery;s&&(0,n.r)(s,t.id,e);const i=t.adminLayerInfo?.viewLayerDefinition?.table?.filter?.value;if(i){const s=i.geometry.rings?c.default.fromJSON(i.geometry):l.default.fromJSON(i.geometry);(0,n.j)(s,t.id,e)}})}catch{return await new Promise((e,t)=>{t(new Error("swap source failed"))})}}(this.props),this.loading=!1,this.msgNode=(0,u.dN)(o.qy`<arcgis-map-config-layer-view-msg .props=${t} .flowItemElement=${s} .message=${r.msg.successSwap.replace("${source}",a.title)} close-with-ok @arcgisMsgClosed=${()=>{this.arcgisStatusChange.emit({status:n.f.SELECTION}),this.removeMsg()}}></arcgis-map-config-layer-view-msg>`),i.shadowRoot.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout(()=>{this.arcgisStatusChange.emit({status:n.f.SELECTION}),this.removeMsg()},7e3)}catch{this.loading=!1,this.msgNode=(0,u.dN)(o.qy`<arcgis-map-config-layer-view-msg .props=${t} .flowItemElement=${s} is-error .message=${r.msg.swapFailed} @arcgisMsgClosed=${()=>this.removeMsg()}></arcgis-map-config-layer-view-msg>`),i.shadowRoot.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout(()=>this.removeMsg(),7e3)}},this.reRender=!1,this.loading=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisStatusChange=(0,u.lh)()}static{this.properties={reRender:16,loading:16,items:16,pagination:16,error:16,props:0,menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=h}async setFocus(){this.flowItemNode.value?.setFocus()}loaded(){requestAnimationFrame(()=>this.flowItemNode.value?.setFocus())}removeMsg(){this.msgNode&&(this.msgNode.remove(),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0}onBack(){this.arcgisStatusChange.emit({status:n.f.SWAP_SOURCE})}render(){const{props:e,loading:t}=this,{_messages:s}=e;return this.el.classList.add("calcite-match-height"),o.qy`<calcite-flow-item .heading=${s.swapSource.browseForLayerTitle} .description=${s.swapSource.subTitle} .loading=${t} .selected=${this.selected} class="panel" show-back-button @calciteFlowItemBack=${this.onBack} ${(0,g.K)(this.flowItemNode)}>${this.renderItemBrowser()}</calcite-flow-item>`}renderItemBrowser(){const{props:e,pagination:t}=this,{layer:s,sourceItemId:i,_messages:n}=e,{portalItem:l}=s,{portal:c}=l,m=c.user,d=`type:"Feature Service" typekeywords:"Hosted Service" -typekeywords:"View Service" owner:"${m.username}" -id:${i}`,p=`${(0,a.a)(c)}/home/`;return o.qy`<arcgis-item-browser @arcgisItemBrowserUpdate=${e=>{const{results:t,num:s,start:i,total:o}=e.detail;this.items=t,this.pagination={start:i,num:s,total:o}}} .filter=${d} .portal=${c} .user=${m} .api=${4} .config=${{baseUrl:p}}><arcgis-item-browser-top-bar slot=top-bar><arcgis-item-browser-search slot=search .term=${""}></arcgis-item-browser-search></arcgis-item-browser-top-bar><arcgis-item-browser-sort .options=${["modified","title","relevance"]} slot=sort></arcgis-item-browser-sort><arcgis-item-browser-content slot=content>${(0,r.u)(this.items||[],e=>e.id,e=>o.qy`<arcgis-item-browser-card .item=${e} .portal=${c} .baseUrl=${p} .preview=${"top"}><calcite-action .id=${`swap-action-${e.id}`} icon=arrow-right-left text scale=s slot=actions-end @click=${this.goSwapLayer.bind(this,e.id)}><calcite-tooltip slot=tooltip overlay-positioning=fixed>${n.general.swapSource}</calcite-tooltip></calcite-action></arcgis-item-browser-card>`)}</arcgis-item-browser-content><arcgis-item-browser-pagination .total=${t?.total} .start=${t?.start} .num=${t?.num} slot=pagination></arcgis-item-browser-pagination></arcgis-item-browser>`}}(0,i.c)("arcgis-map-config-layer-view-browse-layer",y)},28252:(e,t,s)=>{s.d(t,{u:()=>n});var i=s(85282),o=s(34670),r=s(42466);const a=(e,t,s)=>{const i=new Map;for(let o=t;o<=s;o++)i.set(e[o],o);return i},n=(0,o.u$)(class extends o.WL{constructor(e){if(super(e),e.type!==o.OA.CHILD)throw Error("repeat() can only be used in text expressions")}dt(e,t,s){let i;void 0===s?s=t:void 0!==t&&(i=t);const o=[],r=[];let a=0;for(const t of e)o[a]=i?i(t,a):a,r[a]=s(t,a),a++;return{values:r,keys:o}}render(e,t,s){return this.dt(e,t,s).values}update(e,[t,s,o]){const n=(0,r.cN)(e),{values:l,keys:c}=this.dt(t,s,o);if(!Array.isArray(n))return this.ut=c,l;const m=this.ut??=[],d=[];let p,g,u=0,f=n.length-1,w=0,h=l.length-1;for(;u<=f&&w<=h;)if(null===n[u])u++;else if(null===n[f])f--;else if(m[u]===c[w])d[w]=(0,r.lx)(n[u],l[w]),u++,w++;else if(m[f]===c[h])d[h]=(0,r.lx)(n[f],l[h]),f--,h--;else if(m[u]===c[h])d[h]=(0,r.lx)(n[u],l[h]),(0,r.Dx)(e,d[h+1],n[u]),u++,h--;else if(m[f]===c[w])d[w]=(0,r.lx)(n[f],l[w]),(0,r.Dx)(e,n[u],n[f]),f--,w++;else if(void 0===p&&(p=a(c,w,h),g=a(m,u,f)),p.has(m[u]))if(p.has(m[f])){const t=g.get(c[w]),s=void 0!==t?n[t]:null;if(null===s){const t=(0,r.Dx)(e,n[u]);(0,r.lx)(t,l[w]),d[w]=t}else d[w]=(0,r.lx)(s,l[w]),(0,r.Dx)(e,n[u],s),n[t]=null;w++}else(0,r.KO)(n[f]),f--;else(0,r.KO)(n[u]),u++;for(;w<=h;){const t=(0,r.Dx)(e,d[h+1]);(0,r.lx)(t,l[w]),d[w++]=t}for(;u<=f;){const e=n[u++];null!==e&&(0,r.KO)(e)}return this.ut=c,(0,r.mY)(e,d),i.c0}})},65722:(e,t,s)=>{s.d(t,{a:()=>r,g:()=>a,o:()=>n});var i=s(44345);const o=e=>e&&!e.endsWith("/")?`${e}/`:e;function r(e){const{customBaseUrl:t,portalHostname:s,urlKey:i}=e,{protocol:o}=window.location;return`${o}//${i?`${i}.${t}`:s}`}function a(e){return o(e.restUrl)}async function n(e){if(!e?.user)return!1;const t=`${a(e)}portals/self/signinSettings`,s=await(0,i.default)(t,{query:{f:"json",async:!1},responseType:"json"});return!(s?.data&&!s.data.blockBetaApps)}}}]);