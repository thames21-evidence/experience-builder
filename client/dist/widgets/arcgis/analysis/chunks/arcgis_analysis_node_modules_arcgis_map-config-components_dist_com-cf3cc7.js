/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-cf3cc7.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-cf3cc7"],{4265:(e,i,s)=>{s.d(i,{a:()=>o,d:()=>t,t:()=>a});const t=(e,i)=>{let s,t="idle";const o=async(...o)=>await new Promise(a=>{switch(t){case"flushed":t="idle",s?(clearTimeout(s),a(e(...o))):a(null);break;case"invoked":clearTimeout(s),t="idle",a(e(...o));break;case"cancelled":clearTimeout(s),t="idle",a(null);break;default:s&&clearTimeout(s),t="pending",s=setTimeout(()=>{t="idle",a(e(...o))},i)}});return o.flush=async function(...e){return t="flushed",await o(...e)},o.invoke=async function(...e){return t="invoked",await o(...e)},o.cancel=async function(...e){return t="cancelled",await o(...e)},o.getStatus=function(){return t},o},o=(e,i)=>{let s;return async(...t)=>await new Promise(o=>{s||(s=setTimeout(()=>{clearTimeout(s),s=void 0,o(e(...t))},i))})};function a(e){return new Promise(i=>setTimeout(i,e))}},11751:(e,i,s)=>{s.d(i,{a:()=>d,c:()=>m,g:()=>u});var t=s(5294),o=s(56451),a=s(42411),l=s(1225),r=(s(54312),s(44345),s(55448),s(52797),s(34031),s(63438),s(5933),s(89704),s(66228)),n=(s(31521),s(23054),s(5077),s(23795),s(17902),s(87420),s(30161),s(81734),s(83552),s(77462),s(49403),s(66617),s(10628),s(59640),s(64451),s(6176),s(10454),s(28973));s(94916),s(52554),s(2156),s(4038),s(49851),s(75054),s(15223),s(70169),s(29614),s(47207),s(70852),s(48103),s(39423),s(85681),s(18444),s(9767),s(38218),s(91914),s(86605),s(68196),s(440),s(46547),s(28927),s(6238),s(7299);async function d(e,i){const{layer:s,useFeatureReduction:t,mapImageSublayer:o,mapView:d}=e,m=s;i=i||{};const u=(0,l.d)(e),c=(0,l.a)(e,(0,l.g)(e)),h=i.fieldInfos?i.fieldInfos[0]:null,p=i.theme?i.theme:"high-to-low",S={layer:m,view:d,field:h.field,valueExpression:h.expression,valueExpressionTitle:h.expressionTitle,normalizationField:i.normalizationField,theme:p,legendOptions:i.legendOptions,colorOptions:{colorScheme:i.colorScheme||(0,l.a2)(e,p),isContinuous:!!(0,r.i)(i.isContinuous)&&i.isContinuous},symbolOptions:(0,l.n)(e)?void 0:{symbolStyle:i.symbolOptions||"caret"},symbols:i.symbols||void 0,minValue:i.min,maxValue:i.max,sizeOptimizationEnabled:!o&&"above-and-below"!==p&&(!!(0,r.i)(i.sizeOptimizationEnabled)&&i.sizeOptimizationEnabled),defaultSymbolEnabled:!1,forBinning:t};return await a.createContinuousRenderer(S).then(s=>{if(!i.noReuse&&["color","color-size","color-size-age"].includes(u)&&(0,n.s)(e,i)){const i=(0,l.c)((0,l.g)(e),"color"),t=(0,l.p)((0,l.g)(e),"color");i&&t&&p===t.univariateTheme&&(s.renderer.visualVariables=[i],c.sizeOutlineVisVar&&s.renderer.visualVariables.push(c.sizeOutlineVisVar),s.renderer.authoringInfo.visualVariables=[t],(0,l.Q)(e,s.renderer))}return(0,l.b)(c,s.renderer),s})}async function m(e,i){const{layer:s,useFeatureReduction:n,mapImageSublayer:d,mapView:m}=e,u=s;i=i||{};const c=(0,l.g)(e),h=(0,l.c)(c,"color");if(h&&i.fieldInfos?.[0]&&i.fieldInfos?.[0].field===h.field&&i.fieldInfos?.[0].expression===h.valueExpression&&i.normalizationField===h.normalizationField&&(delete i.fieldInfos,(0,l.O)(i)))return{renderer:c.clone()};const p=(0,l.a)(e,c),S=(0,l.c)(c,"size"),g=c.authoringInfo,f=(0,l.p)(c,"size"),z=i.fieldInfos?i.fieldInfos[0]:h?{field:h.field,expression:h.valueExpression,expressionTitle:h.valueExpressionTitle,simpleFieldType:(0,l.K)(e,h.field)?.simpleFieldType||l.J.NUMBER}:{field:c.field,expression:c.valueExpression,expressionTitle:c.valueExpressionTitle,simpleFieldType:(0,l.K)(e,c.field)?.simpleFieldType||l.J.NUMBER},b=null===i.normalizationField?void 0:i.normalizationField?i.normalizationField:h?h.normalizationField:c.normalizationField,v=i.theme?i.theme:g?g.univariateTheme:"high-to-low",x="above-and-below"===g.univariateTheme,y="above-and-below"===v,V="custom"===g.univariateSymbolStyle;"custom"===i.symbolStyle&&!i.symbols&&(1===c.classBreakInfos.length?i.symbols=[t.clone(c.classBreakInfos[0].symbol),t.clone(c.classBreakInfos[0].symbol)]:i.symbols=[t.clone(c.classBreakInfos[0].symbol),t.clone(c.classBreakInfos[1].symbol)]);const I=(0,r.i)(i.isContinuous)?i.isContinuous:!(!x&&y)&&!!h,k="picture-marker"===c.classBreakInfos[0].symbol?.type||"picture-marker"===c.classBreakInfos[2===c.classBreakInfos.length?1:0].symbol?.type,B=!x&&y||k&&I?"caret":y?i.symbolStyle?["single","custom"].includes(i.symbolStyle)?void 0:i.symbolStyle:i.symbols?void 0:"custom"!==g.univariateSymbolStyle?g.univariateSymbolStyle:void 0:void 0,M=!(k&&I)&&("custom"===i.symbolStyle||!i.symbolStyle&&V);let w=y&&!(0,l.n)(e)?{symbolStyle:B,symbols:B?void 0:2===i.symbols?.length?{below:i.symbols[0],above:i.symbols[1]}:1===i.symbols?.length?void 0:M?{below:c.classBreakInfos[0].symbol,above:c.classBreakInfos[2===c.classBreakInfos.length?1:0].symbol}:void 0}:void 0;!w?.symbolStyle&&!w?.symbols&&(w=void 0),I&&w?.symbols&&((0,l.y)(w?.symbols.below,new o.default([0,0,0,.5])),(0,l.y)(w?.symbols.above,new o.default([0,0,0,.5])));const C=c.defaultSymbol,T=c.defaultLabel,D=c.backgroundFillSymbol;let E=!1;v===g?.univariateTheme&&(0,r.i)(S.minSize)&&(E=S.minSize.stops?S.minSize.stops[0].size>S.maxSize.stops[0].size:S.minSize>S.maxSize);let F=!1;(null===i.normalizationField||i.normalizationField||i.fieldInfos?.[0])&&(F=!0);const O=y&&!x||!y&&x,_=i.discardMinMax?void 0:(0,r.i)(i.min)?i.min:F?void 0:f?f.minSliderValue:void 0,Z=i.discardMinMax?void 0:(0,r.i)(i.max)?i.max:F?void 0:f?f.maxSliderValue:void 0,R="below"===g.univariateTheme,N="below"===v,$=N&&!R||!N&&R,L=i.colorScheme||!O&&(0,l.a2)(e,v),A={layer:u,view:m,field:z.field,valueExpression:z.expression,valueExpressionTitle:z.expressionTitle,theme:v,legendOptions:i.legendOptions||S.legendOptions,colorOptions:{colorScheme:L,isContinuous:I},symbolOptions:w,normalizationField:b,minValue:_,maxValue:Z,sizeOptimizationEnabled:!d&&"above-and-below"!==v&&((0,r.i)(i.sizeOptimizationEnabled)?i.sizeOptimizationEnabled:!!p.sizeAutoVisVar),defaultSymbolEnabled:(0,r.i)(i.defaultSymbolEnabled)?i.defaultSymbolEnabled:!!c.defaultSymbol,forBinning:n};return await a.createContinuousRenderer(A).then(e=>{if(i.discardMinMax){const i=(0,l.c)(c,"color"),s=(0,l.c)(e.renderer,"color");i?.stops.forEach((e,i)=>e.value=s?.stops[i].value);const t=(0,l.c)(c,"size"),o=(0,l.c)(e.renderer,"size");"above-and-below"===g.univariateTheme?t.stops?.forEach((e,i)=>{o.stops&&(e.value=o.stops[i].value)}):(t.minDataValue=o.minDataValue,t.maxDataValue=o.maxDataValue)}if((0,l.b)(p,e.renderer),y){const s=(0,l.i)(e.renderer.classBreakInfos[0].symbol),a=e.renderer.classBreakInfos[1]?(0,l.i)(e.renderer.classBreakInfos[1].symbol):s;if(!B)if(1===i.symbols?.length&&1===e.renderer.classBreakInfos.length)e.renderer.classBreakInfos[0].symbol=i.symbols[0];else if(2===i.symbols?.length&&1===e.renderer.classBreakInfos.length){const i=t.clone(c.classBreakInfos[0].symbol);e.renderer.classBreakInfos[0].symbol=i}else if("single"===i.symbolStyle&&2===e.renderer.classBreakInfos.length){const i=t.clone(c.classBreakInfos[0].symbol);e.renderer.classBreakInfos[0].symbol=i.clone(),(0,l.y)(i,(0,l.i)(e.renderer.classBreakInfos[1].symbol)),e.renderer.classBreakInfos[1].symbol=i,e.renderer.authoringInfo.univariateSymbolStyle=void 0}else{let i=t.clone(c.classBreakInfos[0].symbol);e.renderer.classBreakInfos[0].symbol=i,e.renderer.classBreakInfos[1]&&(i=c.classBreakInfos[1]?t.clone(c.classBreakInfos[1].symbol):t.clone(c.classBreakInfos[0].symbol),e.renderer.classBreakInfos[1].symbol=i)}const r=(0,l.c)(e.renderer,"color");if(r){const i=new o.default([0,0,0,.5]);(0,l.y)(e.renderer.classBreakInfos[0].symbol,i),e.renderer.classBreakInfos[1]&&(0,l.y)(e.renderer.classBreakInfos[1].symbol,i)}else h||r?((0,l.y)(e.renderer.classBreakInfos[0].symbol,s),e.renderer.classBreakInfos[1]&&(0,l.y)(e.renderer.classBreakInfos[1].symbol,a)):((0,l.y)(e.renderer.classBreakInfos[0].symbol,(0,l.i)(c.classBreakInfos[0].symbol)),(0,l.y)(e.renderer.classBreakInfos[1].symbol,(0,l.i)(c.classBreakInfos[1].symbol)))}else y||(1===i.symbols?.length?e.renderer.classBreakInfos[0].symbol=i.symbols[0]:1===c.classBreakInfos?.length&&(e.renderer.classBreakInfos[0].symbol=c.classBreakInfos[0].symbol));if(x&&y&&!F){const i=(0,l.c)(e.renderer,"size"),s=(0,l.c)(e.renderer,"color");i.stops=t.clone(S.stops),s&&s.stops.forEach((e,i)=>{e.value=S.stops[i].value}),2===e.renderer.classBreakInfos.length&&(e.renderer.classBreakInfos[0].maxValue=S.stops[2].value,e.renderer.classBreakInfos[1].minValue=S.stops[2].value)}if($&&L&&h){const i=(0,l.c)(e.renderer,"color"),s=h.stops.length-1;i.stops.forEach((e,i)=>{e.color=h.stops[s-i].color})}if(C&&(e.renderer.defaultSymbol=C,e.renderer.defaultLabel=T),e.renderer.backgroundFillSymbol=D||void 0,E){const i=(0,l.c)(e.renderer,"size"),s=i.minSize;i.minSize=i.maxSize,i.maxSize=s}return e})}function u(e){const{mapView:i}=e,s=(0,l.g)(e),t=(0,l.c)(s,"color"),o=(0,l.c)(s,"size"),a=i.scale,{minSize:r,maxSize:n}=o;let d;if(o.stops)d=t.stops.map((e,i)=>{const s=o.stops[i];return{color:e.color,size:s.size,value:s.value}});else{const e=t.stops.length-1;if("number"==typeof r)d=t.stops.map((i,s)=>({color:i.color,value:i.value,size:0===s?r:s===e?n:null}));else{let i,s;const l=r.stops.length-1;a>r.stops[l].value?(i=r.stops[l].size,s=n.stops[l].size):r.stops.forEach((e,t)=>{a<=e.value&&(i=e.size,s=n.stops[t].size)});const m=o.minDataValue,u=o.maxDataValue,c=(u-m)/4;d=t.stops.map((t,o)=>({color:t.color,value:0===o?m:o===e?u:m+o*c,size:0===o?i:o===e?s:void 0}))}}return d}},23076:(e,i,s)=>{s.r(i),s.d(i,{ArcgisMapConfigSmartMappingColorSizeSlider:()=>y});var t=s(73679),o=s(4395),a=s(85643),l=s(46317),r=s(54312),n=s(56451),d=s(88260),m=s(12233),u=s(24457),c=s(75430),h=s(1225),p=(s(44345),s(55448),s(62052)),S=(s(34031),s(63438),s(5933),s(89704),s(47550)),g=(s(5294),s(31521),s(23054),s(5077),s(23795),s(17902),s(87420),s(30161),s(81734),s(18423),s(96086),s(91813),s(21255),s(13078),s(21303),s(12627),s(31861)),f=s(65595),z=(s(77462),s(49403),s(66617),s(10628),s(59640),s(64451),s(6176),s(10454),s(29614),s(94916),s(52554),s(2156),s(4038),s(49851),s(75054),s(15223),s(70169),s(52797),s(47207),s(70852),s(48103),s(39423),s(85681),s(18444),s(11751)),b=(s(9767),s(38218),s(91914),s(86605),s(68196),s(440),s(46547),s(28927),s(6238),s(7299),s(73801)),v=s(4265);const x=o.AH`.slider-box{height:320px;.esri-color-size-slider,.esri-binary-color-size-slider{min-width:200px}.esri-color-size-slider .esri-slider .esri-slider__content,.esri-binary-color-size-slider .esri-slider .esri-slider__content{height:175px}.esri-color-size-slider__histogram-container,.esri-binary-color-size-slider__histogram-container{width:85px}.esri-color-size-slider .esri-slider .esri-slider__label,.esri-color-size-slider .esri-slider .esri-slider__min,.esri-color-size-slider .esri-slider .esri-slider__max,.esri-binary-color-size-slider .esri-slider .esri-slider__label,.esri-binary-color-size-slider .esri-slider .esri-slider__min,.esri-binary-color-size-slider .esri-slider .esri-slider__max{text-decoration:underline}.esri-color-size-slider .esri-slider .esri-slider__label:hover,.esri-color-size-slider .esri-slider .esri-slider__min:hover,.esri-color-size-slider .esri-slider .esri-slider__max:hover,.esri-binary-color-size-slider .esri-slider .esri-slider__label:hover,.esri-binary-color-size-slider .esri-slider .esri-slider__min:hover,.esri-binary-color-size-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}}.slider-box-buttons-front{display:flex}.slider-container{overflow:hidden}`;class y extends b.WF{constructor(){super(...arguments),this.currentColorStopValues=[],this.currentSizeStopSizes=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.smartMappingState=(0,f.u)(),this.histogramStatus=h.s.MISSING,this.statisticsStatus=h.s.MISSING,this.sliderZoomed=!1,this.arcgisSmartMappingColorSizeSliderChange=(0,b.lh)(),this.arcgisSmartMappingColorSizeSliderError=(0,b.lh)()}static{this.properties={histogramStatus:16,statisticsStatus:16,sliderZoomed:16}}static{this.styles=x}async updateStatistics(){this.statisticsStatus=h.s.MISSING,this.statistics=void 0,this.histogramStatus=h.s.MISSING,this.histogram=void 0,this.colorSizeSlider?.destroy(),this.colorSizeSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}load(){this.getStatistics()}disconnectedCallback(){super.disconnectedCallback(),this.zoomOptionsHandle?.remove()}divRefHandler(e){if(e)if(this.colorSizeSlider.container)e.append(this.colorSizeSlider.container);else{const i=document.createElement("div");i.classList.add("slider-container"),e.append(i),this.colorSizeSlider.container=i}}actionRefHandler(e){e&&(this.zoomButtonNode=e)}prepareColorSizeSlider(){const{statistics:e,histogram:i,histogramStatus:s,sliderZoomed:t,smartMappingState:o}=this,{mapView:a}=o,l=(0,h.g)(o),r=(0,h.d)(o),u="above-and-below"===l.authoringInfo.univariateTheme,c=["size-age","color-size-age","type-size-age"].includes(r),f=this.getFieldInfo().simpleFieldType===h.J.DATE,b=(0,h.c)(l,"color"),v=(0,h.c)(l,"size"),x=(0,h.p)(l,"size"),y=(0,h.p)(l,"color");let V,I,k;y?(V=(0,h.aC)(y.theme,b.stops,!0),I=y.minSliderValue,k=y.maxSliderValue):(I=x?.minSliderValue??e.min,k=x?.maxSliderValue??e.max),({min:I,max:k}=(0,h.au)({min:I,max:k}));const B=this.colorSizeSlider;if(this.colorSizeSlider&&(b&&B.style||!b&&!B.style)&&(this.colorSizeSlider?.destroy(),this.colorSizeSlider=void 0),s===h.s.IN_PROGRESS)return!1;if(this.colorSizeSlider){if("dragging"===this.colorSizeSlider.slider?.state)return!0;let s={histogramConfig:{bins:i?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:I??e.min,max:k??e.max};b?(s={...s,...V},s.stops=(0,z.g)(o),s.precision=(0,S.g)(s.stops),s.hasTimeData=f&&!c,f&&(0,p.a)(s,a.timeZone),t?this.zigzagClick||(s.zoomOptions=(0,h.av)(b.stops,y?.minSliderValue??e.min,y?.maxSliderValue??e.max)):s.zoomOptions=null,s.histogramConfig.barCreatedFunction=i&&this.colorSliderBars&&g.b.bind(this,b,i,this.colorSliderBars),(0,g.u)(this.colorSizeSlider,this.colorSliderBars,s,i)):(s.style={trackBelowFillColor:(0,h.i)(l.classBreakInfos[0].symbol)||new n.default([0,0,0,.5]),trackAboveFillColor:(0,h.i)(l.classBreakInfos[1].symbol)||new n.default([0,0,0,.5])},s.stops=v.stops,s.precision=(0,S.g)(s.stops),t?this.zigzagClick||(s.zoomOptions=(0,h.av)(u?v.stops:[{value:v.minDataValue},{value:v.maxDataValue}],x?.minSliderValue??e.min,x?.maxSliderValue??e.max)):s.zoomOptions=null),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(s.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.colorSizeSlider.slider.min=s.zoomOptions.min,s.zoomOptions.min=null):(this.colorSizeSlider.slider.max=s.zoomOptions.max,s.zoomOptions.max=null)),this.adjustedZoomOptions=void 0,this.zoomAdjustment=void 0,this.colorSizeSlider.set(s),this.zigzagClick=!1}else{this.colorSliderBars=[];let s={histogramConfig:{bins:i?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:I??e.min,max:k??e.max};u&&(s.primaryHandleEnabled=!0,s.persistSizeRangeEnabled=!0),f&&(s.hasTimeData=!0,(0,p.a)(s,a.timeZone)),b?(s={...s,...V},s.stops=(0,z.g)(o),s.precision=(0,S.g)(b.stops),s.histogramConfig.barCreatedFunction=i&&g.b.bind(this,s,i,this.colorSliderBars),this.colorSizeSlider=new m.default(s),this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max&&this.colorSizeSlider.set(s),this.colorSizeSlider&&(0,g.u)(this.colorSizeSlider,this.colorSliderBars)):(s.style={trackBelowFillColor:(0,h.i)(l.classBreakInfos[0].symbol)||new n.default([0,0,0,.5]),trackAboveFillColor:(0,h.i)(l.classBreakInfos[1].symbol)||new n.default([0,0,0,.5])},s.stops=v.stops,s.handlesSyncedToPrimary=!1,s.precision=(0,S.g)(s.stops),this.colorSizeSlider=new d.default(s),this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max&&this.colorSizeSlider.set(s)),this.createColorSizeSliderChangeEvents()}return(0,h.V)(this.colorSizeSlider)}handleInvertSlider(){const{smartMappingState:e}=this,i=(0,h.g)(e),s=(0,h.c)(i,"color");if((0,h.f)(),s){let e=s.stops.map(e=>e.color);e=e.reverse(),s.stops.forEach((i,s)=>{i.color=e[s]})}else{const e=(0,h.i)(i.classBreakInfos[0].symbol);(0,h.y)(i.classBreakInfos[0].symbol,(0,h.i)(i.classBreakInfos[1].symbol)),(0,h.y)(i.classBreakInfos[1].symbol,e)}const t=(0,h.c)(i,"size");[t.minSize,t.maxSize]=[t.maxSize,t.minSize],(0,h.a4)(e),this.requestUpdate(),this.arcgisSmartMappingColorSizeSliderChange.emit()}handleZoomSlider(e){const{smartMappingState:i}=this;if(this.histogramStatus===h.s.IN_PROGRESS)return;const{statistics:s}=this,t=(0,h.g)(i),o="above-and-below"===t.authoringInfo.univariateTheme;this.sliderZoomed=(0,h.V)(e)?!!e:!this.sliderZoomed;const a=(0,h.c)(t,"size");a||(this.sliderZoomed=!1);const l=(a?a.normalizationField:t.normalizationField)??void 0,r=this.getFieldInfo(),n=(0,h.p)(t,"size"),d=this.sliderZoomed?(0,h.av)(o?a.stops:[{value:a.minDataValue},{value:a.maxDataValue}],n?.minSliderValue??s.min,n?.maxSliderValue??s.max):null,m=n?.minSliderValue===n?.maxSliderValue;this.getHistogram(r,l,s,d?.min||(m?s.min:n?.minSliderValue??s.min),d?.max||(m?s.max:n?.maxSliderValue??s.max))}getStatistics(){const{smartMappingState:e}=this,{layer:i,useFeatureReduction:s,mapView:t}=e,o=i,a=(0,h.g)(e),l=(0,h.c)(a,"size"),r=(0,h.p)(a,"size"),n=this.getFieldInfo(),d=(l?l.normalizationField:a.normalizationField)??void 0;let m=r.minSliderValue,c=r.maxSliderValue;this.statisticsStatus=h.s.IN_PROGRESS,this.statistics||(0,u.default)({layer:o,view:t,field:n.field??void 0,valueExpression:n.expression??void 0,normalizationField:d,forBinning:s,outStatisticTypes:{exclude:["median"]}}).then(e=>{if(0===e.count){const[i,s]=this.getDefaultDataRange(n),t=r.minSliderValue||i,o=r.maxSliderValue||s;e.min=t,e.max=o,e.avg=(o+t)/2,(0,h.V)(r.minSliderValue)||(r.minSliderValue=t,r.maxSliderValue=o)}else if(!(0,h.V)(e.avg)||!(0,h.V)(e.min)||!(0,h.V)(e.max))return void(this.statisticsStatus=h.s.FAILED);e=(0,h.au)(e),({min:m,max:c}=(0,h.au)({min:m,max:c})),m=m??e.min,c=c??e.max,this.statistics=e,this.statisticsStatus=h.s.SUCCESS,this.getHistogram(n,d,e,m,c)},e=>{console.log(e),this.statisticsStatus=h.s.FAILED})}getHistogram(e,i,s,t,o){const{layer:a,useFeatureReduction:l,mapView:r}=this.smartMappingState,n=a;(s=s||this.statistics)&&0!==s.count&&(this.histogramStatus=h.s.IN_PROGRESS,(0,c.default)({layer:n,view:r,field:e.field??void 0,valueExpression:e.expression??void 0,numBins:50,minValue:(0,h.V)(t)?t:s.min??void 0,maxValue:(0,h.V)(o)?o:s.max??void 0,normalizationField:i??void 0,forBinning:l}).then(e=>{this.histogram=e,this.histogramStatus=h.s.SUCCESS},()=>{this.histogramStatus=h.s.FAILED}))}onMinMaxChange(e,i,s){const{smartMappingState:t}=this,o=(0,h.g)(t),a="above-and-below"===o.authoringInfo?.univariateTheme,l=(0,h.c)(o,"color"),r=(0,h.c)(o,"size");l?.stops&&(e=Math.min(e,l.stops[0].value),i=Math.max(i,l.stops[l.stops.length-1].value)),a&&(e=Math.min(e,r.stops[0].value),i=Math.max(i,r.stops[r.stops.length-1].value),r.stops.forEach((e,i)=>{e.size=this.currentSizeStopSizes[i]})),this.handleMinMaxChange(e,i,s)}handleMinMaxChange(e,i,s){const{statistics:t,smartMappingState:o}=this,a=(0,h.g)(o),l=(0,h.c)(a,"color"),r=(0,h.c)(a,"size"),n=(0,h.p)(a,"color")||{},d=(0,h.p)(a,"size")||{};"min"===s?(n.minSliderValue=e,d.minSliderValue=e):(n.maxSliderValue=i,d.maxSliderValue=i);const m=(0,h.av)(l?.stops,n.minSliderValue,n.maxSliderValue);this.zoomButtonNode&&(this.sliderZoomed?this.zoomButtonNode.disabled=!1:!m||m.minMaxSame||!(0,h.V)(m.min)&&!(0,h.V)(m.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.colorSizeSlider.zoomOptions,"min"===s?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=i,this.zoomAdjustment="max"));const u=this.getFieldInfo(),c=r?r.normalizationField:a.normalizationField;this.getHistogram(u,c,t,e,i),(0,g.u)(this.colorSizeSlider,this.colorSliderBars,l,this.histogram),e===n.minSliderValue&&i===n.maxSliderValue&&(this.sliderZoomed=!1),a.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingColorSizeSliderChange.emit()}createColorSizeSliderChangeEvents(){const{smartMappingState:e}=this,i=(0,h.g)(e),s=(0,h.d)(e),t=(0,h.c)(i,"size"),o=["size-age","color-size-age","type-size-age"].includes(s),a=this.getFieldInfo().simpleFieldType===h.J.DATE;this.colorSizeSlider&&(this.zoomOptionsHandle?.remove(),this.zoomOptionsHandle=r.watch(()=>this.colorSizeSlider.zoomOptions,(e,i)=>{this.sliderZoomed&&(i?.min&&!e?.min||i?.max&&!e?.max)&&(this.zigzagClick=!0,this.handleZigzagClick(e))}),this.colorSizeSlider.on("min-change",e=>{e.value>this.currentColorStopValues[0]?(this.colorSizeSlider.stops.forEach((e,i)=>{e.value=this.currentColorStopValues[i]}),this.onMinMaxChange(this.currentColorStopValues[0],this.colorSizeSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.colorSizeSlider.slider.max,"min")}),this.colorSizeSlider.on("max-change",e=>{e.value<this.currentColorStopValues[this.currentColorStopValues.length-1]?(this.colorSizeSlider.stops.forEach((e,i)=>{e.value=this.currentColorStopValues[i]}),this.onMinMaxChange(this.colorSizeSlider.slider.min,this.currentColorStopValues[this.currentColorStopValues.length-1],"max")):this.onMinMaxChange(this.colorSizeSlider.slider.min,e.value,"max")}),this.colorSizeSlider.on("thumb-change",e=>{if(t){if(a&&!o&&0===e.value)return void this.requestUpdate();this.updateRendererStops(this.colorSizeSlider.stops)}}),this.colorSizeSlider.on("thumb-drag",(0,v.d)(()=>{if(t){const e=this.colorSizeSlider.stops;this.updateRendererStops(e)}},10)),this.colorSizeSlider.on("segment-drag",(0,v.d)(()=>{this.updateRendererStops(this.colorSizeSlider.stops)},10)))}updateRendererStops(e){const{smartMappingState:i}=this,s=(0,h.g)(i),t=(0,h.c)(s,"color"),o=(0,h.c)(s,"size"),a=(0,h.p)(s,"size"),l="above-and-below"===s.authoringInfo.univariateTheme;o.stops?o.stops.forEach((i,s)=>{i.value=e[s].value,i.size=e[s].size,i.label=""}):(o.minDataValue=e[0].value,o.maxDataValue=e[e.length-1].value),t&&t.stops.forEach((i,s)=>{i.value=e[s].value,i.color=e[s].color,i.label=""}),this.currentColorStopValues=e.map(e=>e.value),this.currentSizeStopSizes=e.map(e=>e.size),2===s.classBreakInfos.length&&(s.classBreakInfos[0].maxValue=e[2].value,s.classBreakInfos[1].minValue=e[2].value);const r=(0,h.av)(l?o.stops:[{value:o.minDataValue},{value:o.maxDataValue}],a.minSliderValue,a.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!r||r.minMaxSame||!(0,h.V)(r.min)&&!(0,h.V)(r.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,(0,g.u)(this.colorSizeSlider,this.colorSliderBars),(0,h.a4)(i)}getDefaultDataRange(e){if(e.simpleFieldType===h.J.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const{smartMappingState:e}=this,i=(0,h.g)(e),s=(0,h.c)(i,"size"),t=(0,h.K)(e,s?s.field:i.field);return{field:s?.field||i.field,expression:s?.valueExpression||i.valueExpression,expressionTitle:s?.valueExpressionTitle||i.valueExpressionTitle,simpleFieldType:t?t.simpleFieldType:h.J.NUMBER}}handleZigzagClick(e){const{statistics:i,smartMappingState:s}=this,t=(0,h.g)(s),o=(0,h.c)(t,"size"),a=(0,h.p)(t,"size"),l=this.getFieldInfo(),r=o?o.normalizationField:t.normalizationField,n=a.minSliderValue===a.maxSliderValue;this.getHistogram(l,r,i,e?.min??(n?i.min:a.minSliderValue),e?.max??(n?i.max:a.maxSliderValue)),e||(this.sliderZoomed=!1)}render(){const{config:e}=this.smartMappingState;return o.qy`<link rel=stylesheet href=${`${e.jsapiUrl}/themes/light/main.css`} @load=${()=>{this.styleSheetStatus="loaded",this.requestUpdate()}} @error=${()=>{this.styleSheetStatus="failed",this.requestUpdate()}}>${"loaded"===this.styleSheetStatus?this.renderColorSizeSlider():"not-loaded"===this.styleSheetStatus?this.renderColorSizeSliderLoading():null}`}renderColorSizeSlider(){const{histogramStatus:e,statistics:i,statisticsStatus:s,sliderZoomed:t,smartMappingState:r}=this,{_messages:n}=r,d=(0,h.g)(r),m=d.authoringInfo,u=(0,h.c)(d,"color"),c=(0,h.c)(d,"size"),p="above-and-below"===m.univariateTheme;if(s===h.s.FAILED||s===h.s.MISSING)return this.colorSizeSlider&&(this.colorSizeSlider.destroy(),this.colorSizeSlider=void 0),"";if(s===h.s.IN_PROGRESS||e===h.s.IN_PROGRESS&&!this.colorSizeSlider)return this.renderColorSizeSliderLoading();{const e=this.prepareColorSizeSlider();let s=!1;if(u&&!t){const e=(0,h.p)(d,"color"),t=(0,z.g)(r),o=(0,h.av)(t,e?.minSliderValue??i.min,e?.maxSliderValue??i.max);(o?.minMaxSame||!(0,h.V)(o?.min)&&!(0,h.V)(o?.max))&&(s=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}else if(c&&!t){const e=(0,h.p)(d,"size"),t=(0,h.av)(p?c.stops:[{value:c.minDataValue},{value:c.maxDataValue}],e?.minSliderValue??i.min,e?.maxSliderValue??i.max);(t?.minMaxSame||!(0,h.V)(t?.min)&&!(0,h.V)(t?.max))&&(s=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return u&&(this.currentColorStopValues=u.stops.map(e=>e.value)),c?.stops&&(this.currentSizeStopSizes=c.stops.map(e=>e.size)),(e||this.colorSizeSlider)&&this.colorSizeSlider.min!==this.colorSizeSlider.max?(0,l.D)(u,o.qy`<div class="slider-box"><calcite-label>${n.colorSizeSlider.dataRange}</calcite-label><div class="slider-box-buttons-front">${this.renderInvertButton()}${c&&o.qy`<div>&nbsp;</div>${this.renderZoomButton(s)}`||""}</div><div ${(0,a.K)(this.divRefHandler)}></div></div>`):this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max?"":this.renderColorSizeSliderLoading()}}renderColorSizeSliderLoading(){const{_messages:e}=this.smartMappingState;return o.qy`<div class="slider-box"><calcite-loader .label=${e.loading}></calcite-loader></div>`}renderInvertButton(){const{_messages:e}=this.smartMappingState;return o.qy`<arcgis-map-config-smart-mapping-action .text=${e.colorSizeSlider.invertSlider} icon=arrowUpDown @click=${()=>this.handleInvertSlider()}></arcgis-map-config-smart-mapping-action>`}renderZoomButton(e){const{_messages:i}=this.smartMappingState,{sliderZoomed:s}=this;return o.qy`<arcgis-map-config-smart-mapping-action .text=${i.colorSizeSlider.zoomSlider} .icon=${s?"magnifyingGlassMinus":"magnifyingGlassPlus"} .disabled=${e} @click=${()=>this.handleZoomSlider()} ${(0,a.K)(this.actionRefHandler)}></arcgis-map-config-smart-mapping-action>`}}(0,t.c)("arcgis-map-config-smart-mapping-color-size-slider",y)},31861:(e,i,s)=>{s.d(i,{b:()=>o,u:()=>a});var t=s(56451);function o(e,i,s,t,o){const a=e?.length?r(e,i.bins[t]):l(e.stops,i.bins[t]);a&&(o.setAttribute("fill",a.toHex()),o.setAttribute("opacity",`${Math.max(a.a,.2)}`)),s?.push(o)}function a(e,i,s,t){e&&i?.forEach((i,o)=>{const a=(t||e.histogramConfig)?.bins?.[o],n="breaks"in e?r(s||e.breaks,a):l((s||e).stops,a);n&&(i.setAttribute("fill",n.toHex()),i.setAttribute("opacity",`${Math.max(n.a,.2)}`))})}function l(e,i){if(!i)return;const s=(i.maxValue-i.minValue)/2+i.minValue;let o=e[0],a=e[e.length-1];const l=o.value,r=a.value;if(s<l)return o.color;if(s>r)return a.color;const n=e.filter(e=>e.value===s);if(n.length>0)return n[0].color;o=null,a=null,e.forEach((i,t)=>{!o&&!a&&i.value>=s&&(o=e[t-1],a=i)});const d=(s-o.value)/(a.value-o.value);return t.default.blendColors(o.color,a.color,d)}function r(e,i){if(!i)return;const s=(i.maxValue-i.minValue)/2+i.minValue;let t=e[0],o=e[e.length-1];if(s<t.min||s>o.max)return;const a=e.filter(e=>e.min===s);return a.length>0?a[0].color:(t=e[e.length-1],o=null,e.forEach((i,a)=>{!o&&i.min>=s&&(t=e[a-1],o=i)}),t.color)}},46317:(e,i,s)=>{s.d(i,{D:()=>l});var t=s(85282),o=s(34670),a=s(42466);const l=(0,o.u$)(class extends o.WL{constructor(){super(...arguments),this.key=t.s6}render(e,i){return this.key=e,i}update(e,[i,s]){return i!==this.key&&((0,a.mY)(e),this.key=i),s}})},47550:(e,i,s)=>{s.d(i,{a:()=>d,b:()=>n,g:()=>h,u:()=>r});var t=s(5294),o=s(52797),a=(s(54312),s(44345),s(55448),s(34031),s(63438),s(5933),s(28927),s(83368),s(89704),s(66228)),l=(s(56451),s(31521),s(23054),s(5077),s(23795),s(17902),s(87420),s(30161),s(81734),s(1225));s(83552),s(77462),s(49403),s(10281),s(83930),s(66617),s(10628),s(59640),s(64451),s(6176),s(10454),s(29614),s(94916),s(52554),s(2156),s(4038),s(49851),s(75054),s(15223),s(70169),s(47207),s(70852),s(48103),s(39423),s(85681),s(18444),s(42411),s(9767),s(38218),s(91914),s(86605),s(68196),s(440),s(46547),s(6238),s(7299);function r(e,i){const s=(0,l.g)(e),r=t.clone(s.classBreakInfos);s.classBreakInfos=[],r.forEach((e,t)=>{e=function(e,i,s,t){if((0,a.i)(i)&&0!==i)if(i<1){const a=Math.round(1/i);e.minValue="first"===t?Math.floor(e.minValue/i)/a:Math.round(e.minValue/i)/a,e.maxValue="last"===t?Math.ceil(e.maxValue/i)/a:Math.round(e.maxValue/i)/a,e.label=`${s>0?"> ":""}${e.minValue.toLocaleString(o.getLocale(),{maximumSignificantDigits:15})} - ${e.maxValue.toLocaleString(o.getLocale(),{maximumSignificantDigits:15})}`}else e.minValue="first"===t?Math.floor(e.minValue/i)*i:Math.round(e.minValue/i)*i,e.maxValue="last"===t?Math.ceil(e.maxValue/i)*i:Math.round(e.maxValue/i)*i,e.label=`${s>0?"> ":""}${e.minValue.toLocaleString()} - ${e.maxValue.toLocaleString()}`;return e}(e,i,t,0===t?"first":t===r.length-1?"last":void 0),s.addClassBreakInfo({minValue:e.minValue,maxValue:e.maxValue,symbol:e.symbol,label:e.label})})}function n(e,i){const s=(0,l.g)(e).classBreakInfos;let t=i,o=Number.POSITIVE_INFINITY;s.forEach(e=>{t||(t=Math.max(m(e.minValue),m(e.maxValue))),o=Math.min(o,e.maxValue-e.minValue)});const a=[];return o>1e7?(a.push(1e7),a.push(1e6),a.push(1e5),a.push(1e4),a.push(1e3),a.push(100),a.push(10),t>0&&a.push(1),t>1&&a.push(.1),t>2&&a.push(.01)):o>1e6?(a.push(1e6),a.push(1e5),a.push(1e4),a.push(1e3),a.push(100),a.push(10),t>0&&a.push(1),t>1&&a.push(.1),t>2&&a.push(.01)):o>1e5?(a.push(1e5),a.push(1e4),a.push(1e3),a.push(100),a.push(10),t>0&&a.push(1),t>1&&a.push(.1),t>2&&a.push(.01)):o>1e4?(a.push(1e4),a.push(1e3),a.push(100),a.push(10),t>0&&a.push(1),t>1&&a.push(.1),t>2&&a.push(.01)):o>1e3?(a.push(1e3),a.push(100),a.push(10),t>0&&a.push(1),t>1&&a.push(.1),t>2&&a.push(.01),t>3&&a.push(.001)):o>100?(a.push(100),a.push(10),t>0&&a.push(1),t>1&&a.push(.1),t>2&&a.push(.01),t>3&&a.push(.001),t>4&&a.push(1e-4),t>5&&a.push(1e-5)):o>10?(a.push(10),t>0&&a.push(1),t>1&&a.push(.1),t>2&&a.push(.01),t>3&&a.push(.001),t>4&&a.push(1e-4),t>5&&a.push(1e-5),t>6&&a.push(1e-6)):o>1?(t>0&&a.push(1),t>1&&a.push(.1),t>2&&a.push(.01),t>3&&a.push(.001),t>4&&a.push(1e-4),t>5&&a.push(1e-5),t>6&&a.push(1e-6)):o>.1?(t>1&&a.push(.1),t>2&&a.push(.01),t>3&&a.push(.001),t>4&&a.push(1e-4),t>5&&a.push(1e-5),t>6&&a.push(1e-6)):o>.01?(t>2&&a.push(.01),t>3&&a.push(.001),t>4&&a.push(1e-4),t>5&&a.push(1e-5),t>6&&a.push(1e-6)):o>.001?(t>3&&a.push(.001),t>4&&a.push(1e-4),t>5&&a.push(1e-5),t>6&&a.push(1e-6),t>7&&a.push(1e-7)):o>1e-4?(t>4&&a.push(1e-4),t>5&&a.push(1e-5),t>6&&a.push(1e-6),t>7&&a.push(1e-7),t>8&&a.push(1e-8)):o>1e-5&&(t>5&&a.push(1e-5),t>6&&a.push(1e-6),t>7&&a.push(1e-7),t>8&&a.push(1e-8),t>9&&a.push(1e-9)),a}function d(e){const i=(0,l.g)(e);let s=1e10;return i.classBreakInfos.forEach(e=>{s=Math.min(s,u(e.minValue)),s=Math.min(s,u(e.maxValue))}),s}function m(e){let i=1;for(;Math.round(e*i)/i!==e;)i*=10;return Math.log(i)/Math.LN10}function u(e){let i=1e-8;for(;c(Math.round(e/i)*i)===e;)i*=10;return i/10}function c(e){return Number.parseFloat(e.toPrecision(12))}function h(e){let i=0;e.forEach(e=>{(0,a.i)(e.value)?i=Math.max(m(c(e.value)),i):((0,a.i)(e.minValue)&&(i=Math.max(m(c(e.minValue)),i)),(0,a.i)(e.maxValue)&&(i=Math.max(m(c(e.maxValue)),i)),(0,a.i)(e.min)&&(i=Math.max(m(c(e.min)),i)),(0,a.i)(e.max)&&(i=Math.max(m(c(e.max)),i)))}),i=Math.min(i,3);const s=e[0],t=e[e.length-1],o=Math.min(s.minValue??s.min??s.value,t.minValue??t.min??t.value),l=Math.max(s.maxValue??s.max??s.value,t.maxValue??t.max??t.value)-o;return l/e.length<2e-7?i=8:l/e.length<2e-6?i=7:l/e.length<2e-5?i=6:l/e.length<2e-4?i=5:l/e.length<.002?i=4:l/e.length<.02?i=3:l/e.length<.2?i=Math.max(i,2):l/e.length<2&&(i=Math.max(i,1)),Math.round(i)}},62052:(e,i,s)=>{s.d(i,{a:()=>o,b:()=>l,d:()=>r,u:()=>a});var t=s(52797);function o(e,i){e.labelFormatFunction=e=>n(e,i,"short-date"),e.inputFormatFunction=e=>n(e,i,"short-date"),e.inputParseFunction=e=>function(e,i){if(!e)return e;let s;if(i&&"system"!==i)if("unknown"===i)s=e;else{const t=new Date;s=e+(new Date(t.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(t.toLocaleString("en-US",{timeZone:i})).getTime())}else s=e+6e4*(new Date).getTimezoneOffset();return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(s).toISOString()),s}(Date.parse(e),i)}function a(e,i){let s;if(i&&"system"!==i)if("unknown"===i)s=new Date(e).toISOString();else{const t=(new Date).getTimezoneOffset(),o=new Date(e).toLocaleString("en-US",{timeZone:i});s=new Date(new Date(o).getTime()-6e4*t).toISOString()}else{const i=(new Date).getTimezoneOffset();s=new Date(e-6e4*i).toISOString()}return s}function l(e,i,s){let t;if(i&&"system"!==i)if("unknown"===i)t=new Date(e).toISOString();else{const s=(new Date).getTimezoneOffset(),o=new Date(e).toLocaleString("en-US",{timeZone:i});t=new Date(new Date(o).getTime()-6e4*s).toISOString()}else{const i=(new Date).getTimezoneOffset();t=new Date(e-6e4*i).toISOString()}return t=s?t.substring(11,19):t.substring(11,16),t}function r(e,i){let s,t=new Date(e);if(t=new Date(t.getTime()-6e4*t.getTimezoneOffset()),i&&"system"!==i)if("unknown"===i)s=t.getTime();else{const e=new Date(t.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(t.toLocaleString("en-US",{timeZone:i})).getTime();s=t.getTime()+e}else{const e=(new Date).getTimezoneOffset();s=t.getTime()+6e4*e}return s}function n(e,i,s){let o;return o="unknown"===i?t.formatDate(e,{...t.convertDateFormatToIntlOptions(s),timeZone:"utc",timeZoneName:"shortOffset"}):t.formatDate(e,{...t.convertDateFormatToIntlOptions(s),timeZone:i}),o}}}]);