/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-90abf8.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-90abf8"],{13446:(e,t,i)=>{i.d(t,{a:()=>a,r:()=>n});var r=i(72257),s=i(3826),o=i(95878);function n(){s.d.reset(),r.a.reset()}const a=()=>{if(s.a.existingItem||"register"===o.u.workflow)return;s.d.reset();const e=r.i.folder;r.a.reset(),r.i.folder=e}},38511:(e,t,i)=>{i.d(t,{p:()=>r});const r=(0,i(37762).c)({sourceItem:null,i18n:null}).state},81038:(e,t,i)=>{i.d(t,{c:()=>u});var r=i(46227),s=i(1536),o=i(74695),n=i(83692),a=i(59317),l=i(3826),c=function(e){return this instanceof c?(this.v=e,this):new c(e)},d=function(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,s=i.apply(e,t||[]),o=[];return r={},n("next"),n("throw"),n("return",function(e){return function(t){return Promise.resolve(t).then(e,d)}}),r[Symbol.asyncIterator]=function(){return this},r;function n(e,t){s[e]&&(r[e]=function(t){return new Promise(function(i,r){o.push([e,t,i,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{(i=s[e](t)).value instanceof c?Promise.resolve(i.value.v).then(l,d):u(o[0][2],i)}catch(e){u(o[0][3],e)}var i}function l(e){a("next",e)}function d(e){a("throw",e)}function u(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}};function u(e,t,i){return d(this,arguments,function*(){var d,u,h,p;const{config:m,portal:f,user:g}=i,{item:v}=yield c(function(e,t){const i=`${t.userContentUrl}/items/${e.id}`;return(0,n.r)(i)}(e,g)),y=yield c((0,o.v)(f));yield yield c("publishingService");const w=v.ownerFolder&&"/"!==v.ownerFolder&&"root"!==v.ownerFolder,b=`${t}---${(0,r.g)()}`,{createServiceResponse:I,addToDefinitionResponse:k}=yield c((0,o.w)(Object.assign({name:w?b:t,layers:(null==y?void 0:y.layers)||[],tables:(null==y?void 0:y.tables)||[]},y),{config:m,user:g}));w&&(yield c((0,s.m)(I.itemId,v.ownerFolder)),(null===(u=null===(d=a.c.portal)||void 0===d?void 0:d.sourceJSON)||void 0===u?void 0:u.hasClassificationSchema)&&(l.a.classification.createdUser=a.c.user.username,l.a.classification.createdDate=Date.now()),yield c((0,s.u)(I.itemId,Object.assign({title:t},(null===(p=null===(h=a.c.portal)||void 0===h?void 0:h.sourceJSON)||void 0===p?void 0:p.hasClassificationSchema)?{classification:JSON.stringify(l.a.classification)}:{})))),yield yield c("appendingPhotos");const{statusUrl:_}=yield c(function(e,t,i){var r;const s=t.layers[0],o=`${e.encodedServiceURL}/${null!==(r=s.id)&&void 0!==r?r:0}/append`,a={appendItemId:i.id,appendUploadFormat:"imageCollection",appendAttachmentsInfo:JSON.stringify({ignoreAttachmentsWithoutLocation:!0}),upsert:!1,useGlobalIds:!1,rollbackOnFailure:!0};return(0,n.r)(o,a,{},"post")}(I,k,v));yield c(function(e,t,i){const r=`${i.userContentUrl}/addRelationship`,s={relationshipType:"Service2Data",destinationItemId:t.id,originItemId:e.itemId};return(0,n.r)(r,s,{},"post")}(I,v,g)),yield yield c("checkingStatus"),yield c((0,n.p)(_)),yield yield c(I)})}},94526:(e,t,i)=>{i.r(t),i.d(t,{arcgis_publish_item_pages_item_properties:()=>v});var r=i(87849),s=i(50315),o=i(88878),n=i(59317),a=i(1654),l=i(72257),c=i(81038),d=i(98704),u=i(1536),h=i(13446),p=i(15912),m=i(27137),f=i(38511);i(83692),i(931),i(93814),i(41473),i(54251),i(26262),i(46904),i(37762),i(86562),i(15332),i(74695),i(24869),i(3826),i(76246),i(58573),i(29599),i(60958),i(32478),i(95878),i(82149),i(54077),i(10578),i(8417);var g=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=e[i]&&function(t){return new Promise(function(r,s){(function(e,t,i,r){Promise.resolve(r).then(function(t){e({value:t,done:i})},t)})(r,s,(t=e[i](t)).done,t.value)})}}};const v=class{constructor(e){(0,r.r)(this,e),this.workflowCancel=(0,r.c)(this,"workflowCancel",7),this.workflowComplete=(0,r.c)(this,"workflowComplete",7),this.newItemToggleNavigationEnabled=(0,r.c)(this,"newItemToggleNavigationEnabled",7),this.arcgisWorkflowUpdateError=(0,r.c)(this,"arcgisWorkflowUpdateError",7),this.workflowCancelled=!1,this.handleRequest=async()=>{const{categories:e,title:t}=l.i;if(await this.validate()){(null==t?void 0:t.length)>250&&(this.titleRef.title=t.substring(0,250));try{const{publishResponse:t}=await this.publishItem();if(e&&await(0,s.u)({portal:this.portal,itemIds:[t.id],categories:e}),this.workflowCancelled)(null==t?void 0:t.id)&&await(0,u.d)(t.id,{permanentDelete:!0}),this.workflowCancel.emit();else{const e=Object.assign({},t);this.workflowComplete.emit(e)}(0,h.r)()}catch(e){console.error(e),this.errorMessage=this.parseError(e.code),this.arcgisWorkflowUpdateError.emit(this.errorMessage),this.showLoader(!1)}}else this.arcgisWorkflowUpdateError.emit(this.errorMessage)},this.item=void 0,this.portal=void 0,this.user=void 0,this.errorMessage=void 0,this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0}async validate(){var e,t,i;const r=await(null===(e=this.titleRef)||void 0===e?void 0:e.validateTitle());if(r)return this.errorMessage={title:f.p.i18n.error.title,description:r.translatedMessage},this.titleRef.focusMainInput(),!1;const s=await(null===(t=this.itemPropertiesFolderRef)||void 0===t?void 0:t.saveActiveFolder());if(s){if("boolean"==typeof s&&!s)return!1;if("string"==typeof s)return this.errorMessage={title:f.p.i18n.error.title,description:s},!1}const o=await(null===(i=this.summaryRef)||void 0===i?void 0:i.getErrorMessage());return!o||(this.errorMessage={title:f.p.i18n.error.title,description:o.translatedMessage},!1)}async navigateToNextPage(){this.handleRequest()}async componentWillLoad(){var e,t;if(f.p.i18n=f.p.i18n,null!==(e=this.portal)&&void 0!==e||(this.portal=n.c.portal),null!==(t=this.user)&&void 0!==t||(this.user=n.c.user),!this.item)return console.error("No item found"),void this.arcgisWorkflowUpdateError.emit(this.errorMessage);this.folder=await(0,o.b)(this.item,this.user)}async publishItem(){const{id:e,type:t,typeKeywords:i}=this.item,r={success:!0,id:e,folder:null},s="Image Collection"===t&&(null==i?void 0:i.includes("Photo locations"))?await this.publishPhotosWithLocations(r):await this.publishService(e);return await(0,d.a)({publishResponse:s,portalUser:this.user}),{addResponse:r,publishResponse:s}}async publishService(e){var t;const{type:i}=this.item,r=p.a[i].fileExt[0];this.showLoader(!0,{loaderType:"indeterminate",loaderMessage:f.p.i18n.publishingService});const{result:s,error:o}=await(0,d.p)({itemId:e,user:this.user,portal:this.portal,title:l.i.title,extension:r,type:i});if(!o){const e=null===(t=s.services)||void 0===t?void 0:t[0];return{success:!0,id:null==e?void 0:e.serviceItemId,jobId:null==e?void 0:e.jobId,serviceType:null==e?void 0:e.type,serviceUrl:null==e?void 0:e.serviceurl}}console.error("there was an error",o)}async publishPhotosWithLocations(e){var t,i,r,s;const{config:o,user:a,portal:d}=n.c;this.showLoader(!0,{loaderType:"indeterminate",loaderMessage:f.p.i18n.publishingService});const u=(0,c.c)(e,l.i.title,{config:o,user:a,portal:d});try{for(var h,p=!0,m=g(u);!(t=(h=await m.next()).done);p=!0){s=h.value,p=!1;const e=s;if("string"!=typeof e)return{success:!0,id:e.serviceItemId,jobId:null,serviceType:e.type,serviceUrl:e.serviceurl};this.updateLoader("indeterminate",f.p.i18n[e])}}catch(e){i={error:e}}finally{try{p||t||!(r=m.return)||await r.call(m)}finally{if(i)throw i.error}}}showLoader(e,t){t&&this.updateLoader(t.loaderType,t.loaderMessage),e?(this.newItemToggleNavigationEnabled.emit(!1),this.loading=!0):(this.newItemToggleNavigationEnabled.emit(!0),this.loading=!1)}updateLoader(e,t){this.loaderType=e,this.loaderMessage=t}parseError(e){var t,i,r,s;const{i18n:o}=f.p;return{title:null!==(i=null===(t=o.error[e])||void 0===t?void 0:t.title)&&void 0!==i?i:"no error code title",description:null!==(s=null===(r=o.error[e])||void 0===r?void 0:r.description)&&void 0!==s?s:"no error code description"}}render(){if(!this.item)return;const{type:e}=this.item,{user:t}=n.c;return(0,r.h)(r.H,null,(0,r.h)("arcgis-new-item-loader",{type:this.loaderType,value:m.w.uploadProgress,active:this.loading,text:this.loaderMessage}),(0,r.h)("arcgis-item-properties",{onArcgisItemPropertiesChange:()=>this.arcgisWorkflowUpdateError.emit(null)},"Service Definition"!==e&&(0,r.h)("arcgis-title-input",{itemTitle:this.item.title,class:"medium",currentFolder:this.item.ownerFolder,type:e,enablePublishing:!0,ref:e=>{this.titleRef=e}}),(0,r.h)("arcgis-folder-picker",{class:"medium",ref:e=>this.itemPropertiesFolderRef=e,folder:this.folder}),!(0,a.b)(t)&&(0,r.h)("arcgis-categories-picker",{class:"medium"}),(0,r.h)("arcgis-tags-picker",{class:"medium"}),(0,r.h)("arcgis-summary-input",{class:"medium",ref:e=>this.summaryRef=e})))}get el(){return(0,r.a)(this)}};v.style=".layer-description.sc-arcgis-publish-item-pages-item-properties{display:block;margin-bottom:0.75rem}.locator__heading.sc-arcgis-publish-item-pages-item-properties{font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1);line-height:18px;margin-bottom:2px}.locator__description.sc-arcgis-publish-item-pages-item-properties{margin:0px;margin-bottom:1rem;padding:0px;font-size:0.875rem;color:var(--calcite-color-text-1)}.medium.sc-arcgis-publish-item-pages-item-properties{--arcgis-label-font-weight:500}.info-container.sc-arcgis-publish-item-pages-item-properties{margin-bottom:1.5rem}"}}]);