/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-1028a8.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-1028a8"],{93030:(e,a,t)=>{t.r(a),t.d(a,{ArcgisMapConfigSmartMappingPanelsAssist:()=>me});var s=t(73679),i=t(4395),n=t(46317),r=t(5294),l=t(1225),o=(t(54312),t(33543)),c=(t(52797),t(34031),t(63438),t(5933),t(89704)),p=t(66228),d=(t(56451),t(31521),t(23054),t(5077)),m=(t(23795),t(17902),t(87420),t(30161)),g=t(81734),h=t(65595),u=(t(77462),t(49403),t(10281),t(83930),t(66617)),y=t(10628),S=t(59640),f=t(64451),v=t(6176),w=t(10454),b=t(29614),C=t(94916),z=(t(52554),t(2156)),$=(t(4038),t(49851)),T=t(75054),k=(t(15223),t(70169)),P=t(47207),M=(t(70852),t(48103),t(39423),t(85681)),B=(t(18444),t(42411)),A=(t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(28927),t(6238),t(7299),t(44345),t(55448),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(83552),t(42987)),x=t(28973),I=t(87735),q=t(19479),F=t(89374),O=t(18383),R=t(13494),N=t(29997),D=t(92264),E=t(78778),U=t(17581),V=t(11751),_=(t(83368),t(75698),t(85643)),L=t(73801);const H=["Age (color)","Age (size)","Charts","Charts and Size","Color (age) and Size","Color and Size","Color and Size (age)","Color and Size (univariate)","Compare A to B","Continuous Timeline (color)","Continuous Timeline (size)","Counts and Amounts (color)","Counts and Amounts (size)","Counts and Amounts (opacity)","Counts and Amounts (classed color)","Discrete Time Periods (categories)","Dot Density","Heat Map","Predominant category","Predominant category and Size","Relationship","Relationship and size","Types (unique symbols)","Types and Size","Types and Size (age)"],j=["Counts and Amounts (color)","Counts and Amounts (size)","Counts and Amounts (opacity)","Continuous Timeline (color)","Continuous Timeline (size)","Predominant category and Size"],G={"Counts and Amounts (color)":X,"Counts and Amounts (size)":W,"Counts and Amounts (opacity)":Y,"Continuous Timeline (color)":X,"Continuous Timeline (size)":W,"Predominant category and Size":W},J={"Counts and Amounts (color)":le,"Counts and Amounts (size)":te,"Counts and Amounts (opacity)":oe,"Continuous Timeline (color)":le,"Continuous Timeline (size)":te,"Predominant category and Size":ie},K={"Age (color)":ae,"Age (size)":se,Charts:ne,"Charts and Size":ne,"Color (age) and Size":async function(e,a){const{fields:t,layer:s,view:i,theme:n,colorSchemeTags:r}=e,l=await ae({fields:[t[0]],theme:n,layer:s,view:i,colorSchemeTags:r}),o=await te({fields:[t[1]],theme:"above",layer:s,view:i},a);return{colorAgeStyleParams:l,sizeStyleParams:o}},"Color and Size":async function(e,a){const{fields:t,layer:s,view:i,theme:n,colorSchemeTags:r}=e,l=await ee({styleName:"Counts and Amounts (color)",fields:[t[0]],theme:n,layer:s,view:i,colorSchemeTags:r}),o=await te({fields:[t[1]],theme:"above",layer:s,view:i},a);return{colorStyleParams:l,sizeStyleParams:o}},"Color and Size (age)":async function(e){const{fields:a,layer:t,view:s,theme:i,colorSchemeTags:n}=e,r=await ee({styleName:"Counts and Amounts (color)",fields:[a[0]],theme:i,layer:t,view:s,colorSchemeTags:n}),l=await se({fields:[a[1]],theme:"above",layer:t,view:s});return{colorStyleParams:r,sizeAgeStyleParams:l}},"Color and Size (univariate)":async function(e){const{fields:a,layer:t,view:s,theme:i,colorSchemeTags:n}=e;let r;const l=a[0];return n&&(r=m.getSchemesByTag({geometryType:t.geometryType,includedTags:n,theme:i||"high-to-low"})[0]),{layer:t,view:s,field:l,normalizationField:undefined,theme:i,colorOptions:{colorScheme:r}}},"Compare A to B":ee,"Continuous Timeline (color)":ee,"Continuous Timeline (size)":te,"Counts and Amounts (color)":ee,"Counts and Amounts (size)":te,"Counts and Amounts (opacity)":oe,"Counts and Amounts (classed color)":ee,"Discrete Time Periods (categories)":Z,"Dot Density":async function(e){const{fields:a,layer:t,view:s,colorSchemeTags:i}=e;let n;return i&&(n=u.getSchemesByTag({includedTags:i,numColors:Math.min(a.length,8)})[0]),{layer:t,view:s,legendOptions:{unit:"units"},attributes:a.map(e=>({field:e,label:t.fields.find(a=>a.name===e)?.alias??""})).slice(0,8),outlineOptimizationEnabled:!0,dotDensityScheme:n}},"Heat Map":async function(e){const{fields:a,layer:t,view:s,colorSchemeTags:i}=e;let n;const r=a[0];return i&&(n=y.getSchemesByTag({includedTags:i,basemap:s.map?.basemap||"topo"})[0]),{layer:t,view:s,field:r,heatmapScheme:n}},"Predominant category":ie,"Predominant category and Size":ie,Relationship:re,"Relationship and size":async function(e,a){const{fields:t,layer:s,view:i,colorSchemeTags:n}=e,r=await re({layer:s,view:i,fields:[t[0],t[1]],colorSchemeTags:n}),l=t[2]?await te({fields:[t[2]],theme:"above",layer:s,view:i},a):null;return{relationshipStyleParams:r,sizeStyleParams:l}},"Types (unique symbols)":Z,"Types and Size":async function(e,a){const{fields:t,layer:s,view:i,colorSchemeTags:n}=e,r=await Z({layer:s,view:i,fields:[t[0]],colorSchemeTags:n}),l=await te({fields:[t[1]],theme:"above",layer:s,view:i},a);return{typesStyleParams:r,sizeStyleParams:l}},"Types and Size (age)":async function(e){const{fields:a,layer:t,view:s,colorSchemeTags:i}=e,n=await Z({layer:t,view:s,fields:[a[0]],colorSchemeTags:i}),r=await se({fields:[a[1]],theme:"above",layer:t,view:s});return{typesStyleParams:n,sizeAgeStyleParams:r}}};async function Q(e,a,t){return"update"===a?await async function(e,a){const t=await async function(e,a){let{styleName:t}=e;if(!j.includes(t)){const a=j.map(e=>e.toLocaleLowerCase());if(!a.includes(t.toLocaleLowerCase()))throw new Error(`Unsupported update method: ${t}`);t=j[a.indexOf(t.toLocaleLowerCase())],e.styleName=t}return await J[t](e,a)}(a,e),{styleName:s}=a,{renderer:i}=await G[s](e,t);return i}(e,t):await async function(e,a){const t=await async function(e,a){let{styleName:t}=a;if(!H.includes(t)){const e=H.map(e=>e.toLocaleLowerCase());if(!e.includes(t.toLocaleLowerCase()))throw new Error(`Unrecognized style: ${t}`);t=H[e.indexOf(t.toLocaleLowerCase())],a.styleName=t}return await K[t](a,e)}(e,a),{styleName:s,view:i}=a,{renderer:n}=await function(e,a,t){switch(a){case"Age (color)":return b.createAgeRenderer(t);case"Age (size)":return C.createAgeRenderer(t);case"Charts":case"Charts and Size":return k.createRenderer(t);case"Color (age) and Size":return async function(e){const{colorAgeStyleParams:a,sizeStyleParams:t}=e,{renderer:s,visualVariable:i}=await b.createAgeRenderer(a),{renderer:n}=await C.createContinuousRenderer(t),r=n.authoringInfo,l=s.authoringInfo.visualVariables.find(e=>"color"===e.type);return r.visualVariables=[...r.visualVariables,l],n.visualVariables=[...n.visualVariables,i],{renderer:n}}(t);case"Color and Size":return async function(e){const{colorStyleParams:a,sizeStyleParams:t}=e,{renderer:s,visualVariable:i}=await b.createContinuousRenderer(a),{renderer:n}=await C.createContinuousRenderer(t),r=n.authoringInfo,l=s.authoringInfo.visualVariables.find(e=>"color"===e.type);return r.visualVariables=[...r.visualVariables,l],n.visualVariables=[...n.visualVariables,i],{renderer:n}}(t);case"Color and Size (age)":return async function(e){const{colorStyleParams:a,sizeAgeStyleParams:t}=e,{renderer:s,visualVariable:i}=await b.createContinuousRenderer(a),{renderer:n}=await C.createAgeRenderer(t),r=n.authoringInfo,l=s.authoringInfo.visualVariables.find(e=>"color"===e.type);return r.visualVariables=[...r.visualVariables,l],n.visualVariables=[...n.visualVariables,i],{renderer:n}}(t);case"Color and Size (univariate)":return B.createContinuousRenderer(t);case"Compare A to B":case"Continuous Timeline (color)":case"Counts and Amounts (color)":return b.createContinuousRenderer(t);case"Continuous Timeline (size)":case"Counts and Amounts (size)":return C.createContinuousRenderer(t);case"Counts and Amounts (opacity)":return Y(e,t);case"Counts and Amounts (classed color)":return b.createClassBreaksRenderer({...t,numClasses:t.numClasses??void 0});case"Discrete Time Periods (categories)":case"Types (unique symbols)":return P.createRenderer(t);case"Dot Density":return z.createRenderer(t);case"Heat Map":return $.createRenderer(t);case"Predominant category":case"Predominant category and Size":return T.createRenderer(t);case"Relationship":return M.createRenderer(t);case"Relationship and size":return async function(e){const{relationshipStyleParams:a,sizeStyleParams:t}=e,s=a.layer.geometryType,{renderer:i}=await M.createRenderer(a);if(!t)return{renderer:i};const{visualVariables:n,renderer:r}=await C.createContinuousRenderer(t);if("polygon"===s){const e=r.classBreakInfos[0].symbol;i.uniqueValueInfos.forEach(a=>{const t=e.clone();t.color=a.symbol.color,a.symbol=t});const a=r.backgroundFillSymbol;i.backgroundFillSymbol=a}i.visualVariables=[...i.visualVariables,...n];const l=i.authoringInfo,o=r.authoringInfo.visualVariables.find(e=>"size"===e.type);return l.visualVariables=[o],{renderer:i}}(t);case"Types and Size":return async function(e){const{typesStyleParams:a,sizeStyleParams:t}=e,s=a.layer.geometryType,{renderer:i}=await P.createRenderer(a),{visualVariables:n,renderer:r}=await C.createContinuousRenderer(t);if("polygon"===s){const e=r.classBreakInfos[0].symbol;i.uniqueValueInfos.forEach(a=>{const t=e.clone();t.color=a.symbol.color,a.symbol=t});const a=r.backgroundFillSymbol;i.backgroundFillSymbol=a}i.visualVariables=[...i.visualVariables,...n];const l=i.authoringInfo,o=r.authoringInfo.visualVariables.find(e=>"size"===e.type);return l.visualVariables=[o],{renderer:i}}(t);case"Types and Size (age)":return async function(e){const{typesStyleParams:a,sizeAgeStyleParams:t}=e,s=a.layer.geometryType,{renderer:i}=await P.createRenderer(a),{visualVariables:n,renderer:r}=await C.createAgeRenderer(t);if("polygon"===s){const e=r.classBreakInfos[0].symbol;i.uniqueValueInfos.forEach(a=>{const t=e.clone();t.color=a.symbol.color,a.symbol=t});const a=r.backgroundFillSymbol;i.backgroundFillSymbol=a}i.visualVariables=[...i.visualVariables,...n];const l=i.authoringInfo,o=r.authoringInfo.visualVariables.find(e=>"size"===e.type);return l.visualVariables=[o],{renderer:i}}(t);default:return w.createRenderer(t)}}(e,s,t);if("Compare A to B"===s){((0,l.p)(n,"color")||{}).style="ratio"}return"heatmap"===n.type&&(n.referenceScale=i.scale),"pie-chart"===n.type&&(n.size=4),"dot-density"===n.type&&(n.dotSize=2,n.dotShape="circle"),n}(e,t)}async function W(e,a){const t=(0,l.d)(e),s=(0,l._)(e);return{renderer:(await ce(e,"size")(e,{fieldInfos:a.field?["color","color-age","type","relationship","predominance"].includes(t)?[...s,{field:a.field,simpleFieldType:(0,l.K)(e,a.field).simpleFieldType}]:void 0:[...s],includeSizeVariable:a.includeSizeVariable})).renderer}}async function X(e,a){const t=(0,l.d)(e),s=(0,l._)(e);return{renderer:(await ce(e,"color")(e,{fieldInfos:["size","size-age"].includes(t)?[{field:a.field,simpleFieldType:(0,l.K)(e,a.field).simpleFieldType},s[0]]:void 0,colorScheme:a.colorScheme,sizeScheme:a.colorScheme,relationshipScheme:a.colorScheme,predominanceScheme:a.colorScheme,pieChartScheme:a.colorScheme,dotDensityScheme:a.colorScheme,heatmapScheme:a.colorScheme,locationScheme:a.colorScheme,typeScheme:a.colorScheme})).renderer}}async function Y(e,a){const t=a.layer.renderer.clone();if("dictionary"===t.type)return{renderer:t};const{visualVariable:s}=await c.createVisualVariable(a);return t.visualVariables=(0,l.H)(t,"opacity")||[],t.visualVariables.push(s),t.authoringInfo&&(t.authoringInfo.visualVariables=(0,l.P)(t,"opacity")||[]),{renderer:t}}async function Z(e){const{fields:a,layer:t,view:s,colorSchemeTags:i}=e;let n;const r=a[0],l=a[1],o=a[2];return i&&(n=g.getSchemesByTag({geometryType:t.geometryType,includedTags:i})[0]),{layer:t,view:s,field:r,field2:l,field3:o,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,typeScheme:n}}async function ee(e){const{fields:a,layer:t,view:s,styleName:i,colorSchemeTags:n}=e;let r,l,{theme:o}=e;const c=a[0];return r??=a[1],"Compare A to B"===i&&(r??=a[1],o="above-and-below"),n&&(l=m.getSchemesByTag({geometryType:t.geometryType,includedTags:n,theme:o||"high-to-low"})[0]),{layer:t,view:s,field:c,normalizationField:r,theme:o,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:l}}async function ae(e){const{fields:a,layer:t,view:s,theme:i,colorSchemeTags:n}=e,r=a[0];let l;return n&&(l=m.getSchemesByTag({geometryType:t.geometryType,includedTags:n,theme:i||"high-to-low"})[0]),{layer:t,view:s,startTime:r,endTime:new Date,theme:i,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:l}}async function te(e,a){const{fields:t,layer:s,view:i,theme:n}=e;let r=t[0];const o=t[1];if(!r){const e=(0,l._)(a);e.length&&(r=e[0].field)}return{layer:s,view:i,field:r,normalizationField:o,theme:n,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}async function se(e){const{fields:a,layer:t,view:s,theme:i}=e;return{layer:t,view:s,startTime:a[0],endTime:new Date,theme:i,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}async function ie(e){const{fields:a,layer:t,view:s,styleName:i,colorSchemeTags:n}=e;let r;return n&&(r=f.getSchemesByTag({geometryType:t.geometryType,includedTags:n,numColors:Math.min(a.length,10)})[0]),{layer:t,view:s,fields:a.map(e=>({name:e})).slice(0,9),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:i.includes("Size"),predominanceScheme:r}}async function ne(e){const{fields:a,layer:t,view:s,styleName:i,colorSchemeTags:n}=e;let r;return r=n?S.getSchemesByTag({basemapTheme:await d.getBackgroundColorTheme(s),geometryType:t.geometryType,includedTags:n,numColors:Math.min(a.length,8)})[0]:S.getSchemes({basemapTheme:await d.getBackgroundColorTheme(s),geometryType:t.geometryType,numColors:Math.min(a.length,8)}).primaryScheme,{layer:t,view:s,attributes:a.map(e=>({field:e,label:t.fields.find(a=>a.name===e)?.alias??""})).slice(0,8),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:i.includes("Size"),pieChartScheme:r}}async function re(e){const{fields:a,layer:t,view:s,colorSchemeTags:i}=e;let n;const r={field:a[0]},l={field:a[1]};return i&&(n=v.getSchemesByTag({geometryType:t.geometryType,includedTags:i})[0]),{layer:t,view:s,field1:r,field2:l,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,relationshipScheme:n}}async function le(e,a){const{fields:t,layer:s,view:i,theme:n,colorSchemeTags:r}=e;let o,c=t[0];const p=t[1];if(!c){const e=(0,l._)(a);e.length&&(c=e[0].field)}return r&&(o=function(e){const a=(0,l.d)(e);switch(a){case"color":case"color-age":case"color-size":case"color-age-size":case"color-size-age":case"compare":return m.getSchemesByTag;case"type":case"type-size":case"type-size-age":return g.getSchemesByTag;case"dot-density":return u.getSchemesByTag;case"heatmap":return y.getSchemesByTag;case"relationship":case"relationship-size":return v.getSchemesByTag;case"predominance":case"predominance-size":return f.getSchemesByTag;case"chart":case"chart-size":return S.getSchemesByTag;default:return console.error("unknown renderer type",a),m.getSchemesByTag}}(a)({geometryType:s.geometryType,includedTags:r,theme:n||(0,l.ab)(a,"color")})[0]),{layer:s,view:i,field:c,normalizationField:p,theme:n,colorScheme:o}}async function oe(e,a){const{fields:t,layer:s,view:i}=e;let n=t[0];const r=t[1];if(!n){const e=(0,l._)(a);e.length&&(n=e[0].field)}return{layer:s,view:i,field:n,normalizationField:r}}function ce(e,a){const{layer:t}=e;if(!(0,l.a1)(t))return;const s=t.renderer.authoringInfo,i=(0,l.d)(e);switch(i){case"simple":return A.d;case"color":return"size"===a?U.h:"class-breaks-color"===s?.type?x.c:x.a;case"size":return"color"===a?U.h:"type"===a?U.j:"relationship"===a?q.a:"class-breaks-size"===s?.type?I.c:I.d;case"type":return"size"===a?U.j:D.d;case"color-age":return"size"===a?U.g:x.b;case"size-age":return"color"===a?U.f:"type"===a?U.i:I.e;case"color-size":return"univariate-color-size"===s?.type?V.c:U.d;case"color-age-size":return U.c;case"color-size-age":return U.a;case"type-size":return U.e;case"type-size-age":return U.b;case"dot-density":return q.d;case"heatmap":return F.a;case"relationship":return"size"===a?q.a:E.c;case"relationship-size":return q.c;case"predominance":case"predominance-size":return O.c;case"chart":case"chart-size":return R.c;case"compare":return N.a;default:return void console.error("unknown renderer type:",i)}}const pe=({portal:e})=>window.customElements?.get("arcgis-user-avatar")&&e?.user?i.qy`<arcgis-user-avatar class="avatar-user" .user=${e.user} .portal=${e}></arcgis-user-avatar>`:e?i.qy`<div class="avatar avatar-portal"><calcite-icon class="avatar-icon" icon=user scale=s></calcite-icon></div>`:i.qy`<div class="avatar avatar-bot"><calcite-icon class="avatar-icon" icon=effects scale=s></calcite-icon></div>`,de=i.AH`:host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.content{height:100%;background-color:#fff}.content-initial{padding:12px 9px}.content-generated{display:flex;flex-direction:column;justify-content:space-between;overflow-y:hidden}.title{font-weight:700;font-size:16px}.sub-title{font-size:var(--calcite-font-size--1);padding-bottom:10px}.text-input{padding:10px 0 20px;width:100%}.generate-buttons{display:flex;justify-content:right;margin-bottom:20px}:dir(rtl){.generate-buttons{justify-content:left}}.suggestions{background-color:var(--calcite-color-foreground-2);padding:8px;margin:20px 0}.suggestions-title{font-size:var(--calcite-font-size--1);padding-bottom:5px}.chip{max-width:100%;margin-top:5px}.disclaimer{font-size:var(--calcite-font-size--2);background-color:#fff;padding:8px;display:flex;justify-content:space-between}.disclaimer-icon{height:100%;vertical-align:middle}.disclaimer-text{line-height:16px}.avatar{border-radius:50%;width:30px;min-width:30px;height:30px;display:flex;justify-content:center}.avatar-user{min-width:30px}.avatar-portal{background-color:var(--calcite-color-foreground-2)}.avatar-bot{background-color:#dcf2f4}.avatar-icon{vertical-align:middle;height:100%}.bottom-input{border-top:1px solid var(--calcite-color-foreground-2);padding:0 9px}.messages{height:100%;overflow-y:auto;overflow-x:hidden;padding:12px 9px}.message-loader{display:flex;height:40px;margin:0 10px}.message{margin-bottom:14px}.chat-question{display:flex;column-gap:5px}.chat-response{display:flex;margin:3px 0;column-gap:5px}.question,.response{background-color:var(--calcite-color-foreground-2);padding:8px 10px;border-radius:8px;font-size:var(--calcite-font-size--2);line-height:19.25px;white-space:pre-wrap}.tile{width:100%}`;class me extends L.WF{constructor(){super(...arguments),this.chat=[],this.flowItemNode=(0,_._)(),this.textAreaNode=(0,_._)(),this.generateButtonNode=(0,_._)(),this.tileNodes=[],this.smartMappingState=(0,h.u)(),this.loading=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisSmartMappingPanelsAssistBackClick=(0,L.lh)(),this.arcgisSmartMappingPanelsAssistClose=(0,L.lh)(),this.arcgisSmartMappingPanelsAssistClusterRequiresUpdate=(0,L.lh)(),this.arcgisSmartMappingPanelsAssistError=(0,L.lh)(),this.smartMappingCompleteClose=(0,L.lh)()}static{this.properties={loading:16,activeRendererIdx:16,menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=de}async setFocus(){await(this.flowItemNode.value?.setFocus())}load(){const{layer:e}=this.smartMappingState,a=(0,l.g)(this.smartMappingState);this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?r.clone(e.featureReduction):void 0;const t=(0,l.a9)(this.smartMappingState,this.el);"ARCGIS-MAP-CONFIG-SMART-MAPPING"===t.tagName?this.panelsParentNode=t.shadowRoot:this.panelsParentNode=t}async loaded(){requestAnimationFrame(async()=>await(this.flowItemNode.value?.setFocus()))}chatMessagesRefHandler(e){e&&(this.messagesNode=e,queueMicrotask(()=>{e.querySelectorAll("arcgis-map-config-smart-mapping-tile").forEach(e=>{const a=e,t=Number.parseInt(a.getAttribute("data-value"));this.tileNodes[t]=a})}))}handleDone(){this.arcgisSmartMappingPanelsAssistClose.emit("save")}handleCancel(){const{originalRendererJSON:e,originalFeatureReduction:a,smartMappingState:t}=this;(0,l.a8)(t,e,a),this.arcgisSmartMappingPanelsAssistClose.emit("cancel")}async handleGenerate(){const{textAreaNode:{value:e},chat:a,activeRendererIdx:t,smartMappingState:s}=this,{layer:i,_messages:n}=s;if(!(0,l.a1)(i))return;const r=e.value;if(!r)return;this.usingLastStyleTile()||(a.length=t+1),a.push({text:r,type:"question"}),this.loading=!0,this.handleScrollTo(),e.value="";const c={text:r},p=await(0,o.b)(s,c);if(this.loading){if("valid"!==p.status)return a.push(p),this.loading=!1,void this.handleScrollTo();await async function(e,a,t){const{text:s}=a,{layer:i,mapView:n}=e;if(!(0,l.a1)(i))throw new Error("layer not a FL");if(![200,902].includes(t.dataObject.status_code))return t.message=t.dataObject.botMessage,t.status="error",console.log("*** question/response: ",JSON.stringify({question:s,responseObj:t})),t;const{actionResponse:r}=t.dataObject,{action:o}=r,c=r.style_name;let p;r.theme&&(p=r.theme.trim().toLowerCase().replace(/"/gu,"").replace(/theme/gu,"").replace(/:/gu,"").replace(/;/gu,"").replace(/'/gu,"").trim().replace(/ /gu,"-"),p="none"===r.theme.toLowerCase()?void 0:p);const d=r.field_names,m=[r.color_scheme];console.log("*** question/response: ",JSON.stringify({question:s,actionResponse:r}));try{const a=await Q(e,o,{layer:i,view:n,fields:d,styleName:c,theme:p,colorSchemeTags:m});return t.renderer=a,t.rendererFields=d,t.message=`${t.message}. Here's a ${c} map.`,t}catch(e){return t.message=`I'm sorry. There must have been a misunderstanding. I see the following error: ${e.message}`,t.status="error",t}}(s,c,p),a.push(p),p.renderer&&(this.activeRendererIdx=a.length-1,(0,l.a4)(s,p.renderer),this.smartMappingState.selectedFields=(0,l._)(s),this.smartMappingState.selectedFields.forEach(e=>{e.expression&&!e.expressionTitle&&(e.expressionTitle=n.expression)})),this.loading=!1,this.handleScrollTo()}}handleRestart(){this.chat=[],this.loading=!1;const{originalRendererJSON:e,originalFeatureReduction:a,smartMappingState:t}=this;(0,l.a8)(t,e,a),this.requestUpdate(),setTimeout(()=>{this.textAreaNode.value.setFocus()},500)}handleChip(e){const{textAreaNode:{value:a},smartMappingState:t}=this,{_messages:s}=t;switch(e){case 0:a.value="How can I style the data in the layer";break;case 1:a.value=`${s.panels.assist.mainSuggestion1} `;break;case 2:a.value=`${s.panels.assist.mainSuggestion2} `;break;case 3:a.value=`${s.panels.assist.mainSuggestion3} `;break;default:a.value=`${s.panels.assist.mainSuggestion4} `}this.requestUpdate(),setTimeout(async()=>await a.setFocus(),300)}handleSecondaryChip(e){const{textAreaNode:{value:a},smartMappingState:t}=this,{_messages:s}=t;switch(e){case 1:a.value=`${s.panels.assist.secondSuggestion1} `;break;case 2:a.value=`${s.panels.assist.secondSuggestion2} `;break;default:a.value=`${s.panels.assist.secondSuggestion3} `}this.requestUpdate(),setTimeout(async()=>await a.setFocus(),300)}handleStyleTileClick(e){const{chat:a,smartMappingState:t}=this,s=a[e];this.activeRendererIdx=e,(0,l.a4)(t,s.renderer)}handleStyleTileCustomize(e){const{chat:a,panelsParentNode:t,smartMappingState:s}=this,n=a[e],r=(0,l.R)(s,n.renderer),{selectedFields:o}=s;switch(r){case"simple":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-simple .showBackButton=${!0} selected @arcgisSmartMappingPanelsSimpleClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsSimpleBackClick=${()=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsSimpleError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-simple>`);t.appendChild(e),this.selected=!1;break}case"color":case"color-age":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-color .showBackButton=${!0} selected @arcgisSmartMappingPanelsColorClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsColorBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsColorError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-color>`);t.appendChild(e),this.selected=!1;break}case"size":case"size-age":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsSizeClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsSizeBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-size>`);t.appendChild(e),this.selected=!1;break}case"type":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-type .showBackButton=${!0} selected @arcgisSmartMappingPanelsTypeClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsTypeBackClick=${()=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsTypeClusterRequiresUpdate=${()=>this.arcgisSmartMappingPanelsAssistClusterRequiresUpdate.emit()} @arcgisSmartMappingPanelsTypeError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-type>`);t.appendChild(e),this.selected=!1;break}case"compare":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-compare .showBackButton=${!0} selected @arcgisSmartMappingPanelsCompareClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsCompareBackClick=${()=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsCompareError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-compare>`);t.appendChild(e),this.selected=!1;break}case"heatmap":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-heatmap .showBackButton=${!0} selected @arcgisSmartMappingPanelsHeatmapClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsHeatmapBackClick=${()=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsHeatmapError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-heatmap>`);t.appendChild(e),this.selected=!1;break}case"predominance":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-predominance .showBackButton=${!0} selected @arcgisSmartMappingPanelsPredominanceClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsPredominanceBackClick=${()=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsPredominanceError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-predominance>`);t.appendChild(e),this.selected=!1;break}case"chart":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-chart .showBackButton=${!0} selected @arcgisSmartMappingPanelsChartClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsChartBackClick=${()=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsChartError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-chart>`);t.appendChild(e),this.selected=!1;break}case"relationship":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-relationship .showBackButton=${!0} selected @arcgisSmartMappingPanelsRelationshipClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsRelationshipBackClick=${()=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsRelationshipError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-relationship>`);t.appendChild(e),this.selected=!1;break}case"dot-density":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-dot-density .showBackButton=${!0} selected @arcgisSmartMappingPanelsDotDensityClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsDotDensityBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}}></arcgis-map-config-smart-mapping-panels-dot-density>`);t.appendChild(e),this.selected=!1;break}case"color-size":case"color-age-size":case"color-size-age":if(o.length>1){const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-color-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsColorSizeClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsColorSizeBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsColorSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-color-size>`);t.appendChild(e),this.selected=!1}else{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-color-size-univariate .showBackButton=${!0} selected @arcgisSmartMappingPanelsColorSizeUnivariateClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsColorSizeUnivariateBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsColorSizeUnivariateError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-color-size-univariate>`);t.appendChild(e),this.selected=!1}break;case"type-size":case"type-size-age":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-type-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsTypeSizeClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsTypeSizeBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsTypeSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-type-size>`);t.appendChild(e),this.selected=!1;break}case"predominance-size":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-predominance-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsPredominanceSizeClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsPredominanceSizeBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsPredominanceSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-predominance-size>`);t.appendChild(e),this.selected=!1;break}case"chart-size":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-chart-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsChartSizeClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsChartSizeBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsChartSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-chart-size>`);t.appendChild(e),this.selected=!1;break}case"relationship-size":{const e=(0,L.dN)(i.qy`<arcgis-map-config-smart-mapping-panels-relationship-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsRelationshipSizeClose=${a=>{this.cleanUpFlowItem(e),this.handleStyleOptionsDone(a.detail,n)}} @arcgisSmartMappingPanelsRelationshipSizeBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e),this.handleStyleOptionsDone("save",n)}} @arcgisSmartMappingPanelsRelationshipSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e)}></arcgis-map-config-smart-mapping-panels-relationship-size>`);t.appendChild(e),this.selected=!1;break}}}handleStyleOptionsDone(e,a){const{layer:t}=this.smartMappingState;"save"===e&&(a.renderer=r.clone(t.renderer))}cleanUpFlowItem(e){e.remove(),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout(()=>requestAnimationFrame(async()=>await(this.tileNodes[0]?.setFocus())),300)}usingLastStyleTile(){const{chat:e,activeRendererIdx:a}=this;if(e.length>1&&(0,p.i)(a)){let t=e.length;return e.forEach((e,a)=>{"renderer"in e&&e.renderer&&(t=a)}),a===t}return!0}handleScrollTo(){const{textAreaNode:{value:e},messagesNode:a}=this;setTimeout(()=>{a?.scrollTo(0,a.scrollHeight)},300),setTimeout(()=>{e?.setFocus(),a?.scrollTo(0,a.scrollHeight)},500)}render(){const{layer:e,hideLayerTitle:a,_messages:t}=this.smartMappingState;return console.log("chat",this.chat),this.el.classList.add("calcite-match-height"),i.qy`<calcite-flow-item .heading=${t.panels.assist.heading} .description=${a?void 0:e.title??void 0} class="flow-item" .showBackButton=${this.showBackButton} .selected=${this.selected} @calciteFlowItemClose=${this.handleDone} @calciteFlowItemBack=${e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsAssistBackClick.emit()}} ${(0,_.K)(this.flowItemNode)}>${this.renderDoneButton()}${this.renderCancelButton()}${this.renderContent()}${this.renderDisclaimer()}</calcite-flow-item>`}renderDoneButton(){const{layer:e,_messages:a}=this.smartMappingState;return e?i.qy`<calcite-button slot=footer .label=${a.done} @click=${this.handleDone} appearance=solid width=half>${a.done}</calcite-button>`:""}renderCancelButton(){const{layer:e,_messages:a}=this.smartMappingState;return e?i.qy`<calcite-button slot=footer .label=${a.cancel} @click=${this.handleCancel} appearance=outline-fill width=half>${a.cancel}</calcite-button>`:""}renderContent(){const{chat:e,loading:a}=this;return e.length||a?this.renderGeneratedContent():this.renderInitialContent()}renderInitialContent(){const{_messages:e}=this.smartMappingState;return i.qy`<div class="content content-initial"><calcite-icon icon=effects></calcite-icon><div class="title">${e.panels.assist.title}</div><div class="sub-title">${e.panels.assist.subTitle}</div>${this.renderInput()}${this.renderSuggestions()}</div>`}renderGeneratedContent(){const{chat:e,loading:a}=this;return i.qy`<div class="content content-generated">${(0,n.D)(e.length,i.qy`<div class="messages" ${(0,_.K)(this.chatMessagesRefHandler)}>${e.map((e,a)=>this.renderChatMessage(e,a))}${a&&i.qy`<div class="message-loader"><svg version=1.1 id=message-loader xmlns=http://www.w3.org/2000/svg x=0px y=0px viewBox="0 0 100 100" enable-background="new 0 0 0 0">${i.JW`<circle fill=#000 stroke=none cx=6 cy=50 r=6><animate attributeName=opacity dur=1s values=0;1;0 repeatCount=indefinite begin=0.1 /></circle><circle fill=#000 stroke=none cx=26 cy=50 r=6><animate attributeName=opacity dur=1s values=0;1;0 repeatCount=indefinite begin=0.2 /></circle><circle fill=#000 stroke=none cx=46 cy=50 r=6><animate attributeName=opacity dur=1s values=0;1;0 repeatCount=indefinite begin=0.3 /></circle>`}</svg></div>`||""}</div>`)}<div class="bottom-input">${this.renderSecondarySuggestions()}${this.renderInput()}</div></div>`}renderChatMessage(e,a){return i.qy`<div class="message" data-value=${a??L.s6}>${"question"===e.type?this.rendererQuestion(e):this.renderResponse(e,a)}</div>`}rendererQuestion(e){const{portal:a}=this.smartMappingState;return i.qy`<div class="chat-question">${pe({portal:a})}<div class="question">${e.text}</div></div>`}renderResponse(e,a){return e.renderer?this.renderStyleTile(e,a):i.qy`<div class="chat-response">${pe({})}<div class="response">${e.message}</div></div>`}renderStyleTile(e,a){const{activeRendererIdx:t,smartMappingState:s}=this,r=(0,l.R)(s,e.renderer),o=(0,l._)(s,e.renderer)?.map(e=>(0,l.K)(s,e.field)?.label||e.field);return i.qy`<div class="chat-response">${pe({})}${(0,n.D)(a,i.qy`<arcgis-map-config-smart-mapping-tile class="tile" tile-type=assist .type=${r} .selected=${t===a} .fields=${o} data-value=${a??L.s6} @arcgisSmartMappingTileSelect=${()=>this.handleStyleTileClick(a)} @arcgisSmartMappingTileOptions=${()=>this.handleStyleTileCustomize(a)}></arcgis-map-config-smart-mapping-tile>`)}</div>`}renderInput(){const{chat:e,smartMappingState:a}=this,{_messages:t}=a;return i.qy`<calcite-text-area .disabled=${this.loading} class="text-input" .placeholder=${t.panels.assist.placeholder} value scale=s resize=vertical rows=3 @calciteTextAreaInput=${()=>this.generateButtonNode.value.disabled=!this.textAreaNode.value.value} @keyup=${e=>{"Enter"===e.key&&this.textAreaNode.value.value&&(e.preventDefault(),this.handleGenerate())}} ${(0,_.K)(this.textAreaNode)}></calcite-text-area><div class="generate-buttons">${!!e.length&&i.qy`<calcite-button class="restart-button" slot=footer icon-start=refresh .label=${t.panels.assist.restart} @click=${this.handleRestart} appearance=transparent width=auto>${t.panels.assist.restart}</calcite-button><span>&nbsp;&nbsp;</span>`||""}<calcite-button .disabled=${this.loading||!this.textAreaNode.value?.value} class="generate-button" slot=footer icon-start=effects .label=${t.panels.assist.generate} @click=${()=>{this.loading||this.handleGenerate()}} appearance=solid width=auto ${(0,_.K)(this.generateButtonNode)}>${t.panels.assist.generate}</calcite-button></div>`}renderSuggestions(){const{_messages:e}=this.smartMappingState;return i.qy`<div class="suggestions"><div class="suggestions-title">${e.panels.assist.suggestedPrompts}</div><calcite-chip class="chip" scale=s value=0 appearance=outline-fill label="How can I style the data in the layer" @click=${()=>this.handleChip(0)}>${"How can I style the data in the layer"}</calcite-chip><br><calcite-chip class="chip" scale=s value=1 appearance=outline-fill .label=${e.panels.assist.mainSuggestion1} @click=${()=>this.handleChip(1)}>${`${e.panels.assist.mainSuggestion1}...`}</calcite-chip><br><calcite-chip class="chip" scale=s value=2 appearance=outline-fill .label=${e.panels.assist.mainSuggestion2} @click=${()=>this.handleChip(2)}>${`${e.panels.assist.mainSuggestion2}...`}</calcite-chip><br><calcite-chip class="chip" scale=s value=3 appearance=outline-fill .label=${e.panels.assist.mainSuggestion3} @click=${()=>this.handleChip(3)}>${`${e.panels.assist.mainSuggestion3}...`}</calcite-chip><br><calcite-chip class="chip" scale=s value=4 appearance=outline-fill .label=${e.panels.assist.mainSuggestion4} @click=${()=>this.handleChip(4)}>${`${e.panels.assist.mainSuggestion4}...`}</calcite-chip></div>`}renderSecondarySuggestions(){const{_messages:e}=this.smartMappingState;return i.qy`<div class="secondary-suggestions"><calcite-chip .disabled=${this.loading} class="chip" scale=s value=1 appearance=solid .label=${e.panels.assist.secondSuggestion1} @click=${()=>!this.loading&&this.handleSecondaryChip(1)}>${e.panels.assist.secondSuggestion1}</calcite-chip><calcite-chip .disabled=${this.loading} class="chip" scale=s value=2 appearance=solid .label=${e.panels.assist.secondSuggestion2} @click=${()=>!this.loading&&this.handleSecondaryChip(2)}>${e.panels.assist.secondSuggestion2}</calcite-chip></div>`}renderDisclaimer(){return i.qy`<div class="disclaimer"><div class="disclaimer-icon"><calcite-icon class="disclaimer-icon" icon=information scale=s></calcite-icon></div><div>&nbsp;&nbsp;</div><div class="disclaimer-text"><span>"AI generated content may be inaccurate or misleading."</span></div></div>`}}(0,s.c)("arcgis-map-config-smart-mapping-panels-assist",me)}}]);