"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_tile-l-e889d1"],{68466:(e,i,n)=>{n.d(i,{a:()=>p,b:()=>b,c:()=>v,d:()=>y,e:()=>S,f:()=>I,g:()=>O,h:()=>g,l:()=>m,p:()=>h});var r=n(59317),t=n(931),a=n(41473),l=n(82149),s=n(1536),o=n(80562),c=n(74695),d=n(83692),u=n(3826),f=function(e,i){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&i.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var t=0;for(r=Object.getOwnPropertySymbols(e);t<r.length;t++)i.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(e,r[t])&&(n[r[t]]=e[r[t]])}return n};const g=(e,i)=>{let n=!1;return i&&(null==e?void 0:e.length)>0&&(n=!e.some(e=>!function(e,i,n){if("Feature Layer"!==e.type||!e.drawingInfo)return!1;if("scenes"===n)return function(e,i){var n,r,t;const a=e.drawingInfo.renderer,l=e.drawingInfo.labelingInfo,s=e.featureReduction,o=e.fields;if(-1===["esriGeometryPoint","esriGeometryMultiPatch"].indexOf(e.geometryType))return!1;if(a.observationRenderer||a.latestObservationRenderer)return!1;if("heatmap"===a.type)return!1;if(null===(n=a.valueExpression)||void 0===n?void 0:n.length)return!1;if(null===(r=a.visualVariables)||void 0===r?void 0:r.some(e=>e.valueExpression.length))return!1;const c=o.filter(e=>"esriFieldTypeDate"===e.type).map(e=>e.name);if(c.length){if(c.indexOf(a.field)>-1||c.indexOf(a.field1)>-1)return!1;if(null===(t=a.visualVariables)||void 0===t?void 0:t.some(e=>e.field&&c.indexOf(e.field)>-1))return!1}if(s)return!1;if(!i&&(null==l?void 0:l.length))return!1;return!0}(e,i);return p(e,i)}(e,!1,"tiles"))),n};function p(e,i){var n,r;if("esriGeometryMultiPatch"===e.geometryType)return!1;const t=null===(n=e.drawingInfo)||void 0===n?void 0:n.renderer,a=null===(r=e.drawingInfo)||void 0===r?void 0:r.labelingInfo,l=e.fields;return!m(e)&&(!(t&&e.geometryType&&(null==l?void 0:l.length)>0&&!v(t,e.geometryType,l))&&!(!i&&(null==a?void 0:a.length)))}const m=e=>{var i,n;const r=null!==(i=e.featureReduction)&&void 0!==i?i:null===(n=e.layerDefinition)||void 0===n?void 0:n.featureReduction;return!!r&&Object.keys(r).length>0},v=(e,i,n)=>{var r;if("heatmap"===e.type)return!1;if("esriGeometryPolygon"===i&&e.uniqueValueInfos&&e.visualVariables&&e.visualVariables.some(e=>{if("sizeInfo"===e.type&&!e.target)return!0}))return!1;const t=n.filter(e=>"esriFieldTypeDate"===e.type).map(e=>e.name);if(t.length){if(t.indexOf(e.field)>-1||t.indexOf(e.field1)>-1)return!1;if(null===(r=e.visualVariables)||void 0===r?void 0:r.some(e=>t.indexOf(e.field)>-1))return!1}return!0};const y=(e,i,n)=>{const{publishType:r,cacheOnDemand:t,tileInfo:a,cacheOnDemandMinScale:s,scale:c,layers:d}=i,{maxScale:u,minScale:g}=c,p={storageFormat:n||"vectorTiles"===i.publishType?"esriMapCacheStorageModeCompactV2":"esriMapCacheStorageModeExploded",packetSize:128},m=Object.assign(Object.assign({},"vectorTiles"===r?l.p:l.a),a);m.dpi&&!m.preciseDpi&&(m.preciseDpi=m.dpi),m.lods=m.lods.map(e=>f(e,["label"]));const v="vectorTiles"===r?Object.assign({},l.b):Object.assign({},l.c);let y={name:(0,o.f)(e.title),tilingSchema:{tileCacheInfo:m,tileImageInfo:v,cacheStorageInfo:p},minScale:g,maxScale:u};d&&(y.layers=d.map(({layerDefinition:e,id:i,drawingInfo:n})=>(null==e?void 0:e.drawingInfo)?{id:i,drawingInfo:Object.assign(Object.assign({},n),e.drawingInfo)}:{id:i,drawingInfo:n})),"vectorTiles"!==r&&(y.cacheOnDemand=t,t&&(y=Object.assign(Object.assign({},y),{capabilities:"Map,ChangeTracking",cacheOnDemandMinScale:s})));return{publishContent:{itemId:e.id,filetype:"featureService",outputType:r,publishParameters:JSON.stringify(y),buildInitialCache:!1},publishParameters:y}},b=async(e,i)=>{if(!e.includes(i?"/VectorTileServer":"/MapServer"))return{error:{code:"invalidUrl"}};try{const r=await(0,d.r)(e,{},{addTokenManually:!1});return r&&r.singleFusedMapCache&&r.tileInfo?{result:(n=r.tileInfo,Object.assign(Object.assign({},n),{lods:(n.lods||[]).map(e=>Object.assign(Object.assign({},e),{label:`1:${Math.round(e.scale).toLocaleString("en-EN",{maximumFractionDigits:0})}`}))}))}:r&&i&&r.tileInfo?{result:r.tileInfo}:{error:{code:"noTilingSchemeFound"}}}catch(e){return console.error(e),{error:{code:"mapServiceError",message:JSON.stringify(e)}}}var n},S=async(e,i,n,r)=>{let a=null,s=l.T;const o={constraints:e,minScale:e.minScale,maxScale:e.maxScale||18055.954822};if(!r)return{maxSupportedMinScale:a,cacheOnDemandMinScale:s,calculatedScale:o};try{const c=await Promise.allSettled(n.map(({id:e})=>(async e=>{try{const[i]=await(0,t.l)(["esri/layers/FeatureLayer"]),n=new i(e),r=await n.addPlugin("esri/plugins/FeatureLayerStatistics");return{result:await r.target.statisticsPlugin.getSuggestedScaleRange({sampleSize:100,forPublishingTiles:!0})}}catch(e){return"string"==typeof e&&e.toLowerCase().includes("sampling returned 0 features")?{result:null,error:null}:(console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}})}})(`${r}/${e}`)));let d=0,u=1/0;c.forEach(e=>{if("rejected"===e.status)return;const i=e.value.result;if(!i)return;const{maxScale:n,minScale:r}=i;d=null==r||r<=d?d:r,u=null==n||n>=u?u:n,s=null==r||r>=s?s:r}),a=e.minScale||l.T,s||(s=d),o.minScale=s||e.minScale,o.maxScale=u||o.maxScale,o.minScale>e.minScale&&e.minScale>0&&(o.minScale=e.minScale),o.maxScale>=o.minScale&&o.minScale>0&&(o.maxScale=((e,i,n)=>{var r,t;if(e<=i&&(null==n?void 0:n.length)>0){let a=-1;for(let i=n.length-1;i>=0;i--)if(e<n[i].scale){a=i+2;break}return a=a>n.length-1?n.length-1:a,null!==(t=null===(r=n[a])||void 0===r?void 0:r.scale)&&void 0!==t?t:i}return i})(o.minScale,o.maxScale,i))}catch(i){console.error(i),o.minScale=e.minScale}return{maxSupportedMinScale:a,cacheOnDemandMinScale:s,calculatedScale:o}},h=async(e,i,n)=>{var t,a,l,f,g;const{publishType:p,user:m,folder:v,title:y,tags:b=[],snippet:S,categories:h}=i;let O=Object.assign({},e);if(y){const e=JSON.parse(O.publishParameters);e.name=(0,o.f)(y),O.publishParameters=JSON.stringify(e)}const I=`${m.userContentUrl}/publish`,{services:w}=await(0,d.r)(I,O,{},"post"),{jobId:j,serviceItemId:x,serviceurl:T,error:D,type:M}=w[0]||{};if(D)throw console.error(D),D;await(0,c.g)(x,{jobId:j,success:!0}),(null===(a=null===(t=r.c.portal)||void 0===t?void 0:t.sourceJSON)||void 0===a?void 0:a.hasClassificationSchema)&&(u.a.classification.createdUser=r.c.user.username,u.a.classification.createdDate=Date.now());const P=(null===(f=null===(l=r.c.portal)||void 0===l?void 0:l.sourceJSON)||void 0===f?void 0:f.hasClassificationSchema)?{classification:JSON.stringify(u.a.classification)}:{};return"scenes"!==p&&await(0,s.u)(x,Object.assign({title:y,tags:b.length>0?b:"",snippet:S,categories:h,clearEmptyFields:!0},P)),n&&await(0,s.u)(x,Object.assign({text:JSON.stringify(n)},P)),v.id!==(null===(g=r.c.initialFolder)||void 0===g?void 0:g.id)&&await(0,s.m)(x,(0,s.l)(v)?"/":v.id),{id:x,jobId:j,serviceType:M,serviceUrl:T}},O=async e=>{const i=r.c.portal,n=`${`${(0,a.g)(i)}portals/${i.id}`}/datastores/getServers`,t={datastoreId:e,f:"json"};try{return{result:(await(0,d.r)(n,t,{},"post")).servers}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},I=async({itemId:e,itemUrl:i,portal:n,publishType:r,fullLayers:t})=>{try{const{result:a}=await(0,s.p)(e,n),l=((null==a?void 0:a.layers)||[]).map((n,a)=>{var l,s,o,c;if(!n)return null;const d=null!==(l=n.id)&&void 0!==l?l:a;let u=Object.assign(Object.assign({},n),{id:d,layerUrl:`${i}/${d}`,layerItemId:e,layerDefinition:n.layerDefinition});"vector"===r&&delete u.popupInfo,n.popupInfo&&(u=Object.assign(Object.assign({},u),{popupInfo:n.popupInfo})),null!=n.showLegend&&(u=Object.assign(Object.assign({},u),{showLegend:n.showLegend}));const f=t.find(e=>e.id===d);return u=Object.assign(Object.assign({},u),{drawingInfo:Object.assign(Object.assign(Object.assign({},null==f?void 0:f.drawingInfo),n.drawingInfo),{renderer:null!==(o=null===(s=n.drawingInfo)||void 0===s?void 0:s.renderer)&&void 0!==o?o:null===(c=null==f?void 0:f.drawingInfo)||void 0===c?void 0:c.renderer})}),u}).filter(e=>null!=e);return{result:Object.assign(Object.assign({},a),{layers:l})}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}}}}]);