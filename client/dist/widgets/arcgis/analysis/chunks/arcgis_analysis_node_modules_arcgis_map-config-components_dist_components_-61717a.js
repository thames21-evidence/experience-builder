/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-61717a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-61717a"],{93687:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigLayerViewOverview:()=>f});var s=i(73679),r=i(4395),a=i(2801),o=(i(2924),i(33752),i(44345),i(13661),i(21255),i(83552)),n=i(85643),c=i(73801);const l="flow",d="info-description",h="has-definition-icon",g="definition-icon",p="footer",u="footer-top",m=r.AH`.flow,.panel{height:100%}.info{display:grid;grid-template-columns:repeat(1,minmax(0px,1fr));gap:.5rem;pointer-events:none;padding:1rem .75rem}.info-description{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-color-text-3);transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1);pointer-events:none}.has-definition-icon{color:var(--calcite-color-border-1);cursor:pointer}.definition-icon{color:var(--calcite-color-text-2);cursor:pointer}.footer{width:100%}.footer-top{display:flex}`;class f extends c.WF{constructor(){super(),this._direction=(0,o.jH)(),this.definitionNode=(0,n._)(),this.backButtonNode=(0,n._)(),this.listItemNodes=[],this.reRender=!1,this.loading=!1,this.arcgisOverviewCancel=(0,c.lh)(),this.arcgisOverviewUpdated=(0,c.lh)(),this.arcgisStatusChange=(0,c.lh)(),this.listenOn(window,"arcgisOverViewRefresh",this.arcgisOverviewRefreshHandler),this.listen("arcgisMsgClosed",this.arcgisMsgClosedHandler)}static{this.properties={reRender:16,loading:16,props:0,status:9}}static{this.styles=m}loaded(){requestAnimationFrame(()=>this.backButtonNode.value?.setFocus())}arcgisOverviewRefreshHandler(){this.status=a.f.OVERVIEW,this.reRender=!this.reRender}arcgisMsgClosedHandler(){const{props:e}=this,{_messages:t}=e;this.msgNode&&(this.msgNode.message===t.msg.updated&&this.arcgisOverviewUpdated.emit(),this.msgNode.remove(),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0}flowItemRefHandler(e){e&&(this.flowItemNode=e)}listRefHandler(e){e&&queueMicrotask(()=>{[...e.children].forEach(e=>{if(e&&"CALCITE-LIST-ITEM"===e.nodeName){const t=Number.parseInt(e.getAttribute("data-value"));this.listItemNodes[t]=e}})})}goBack(){this.arcgisStatusChange.emit({status:a.f.SELECTION})}goNext(){this.arcgisStatusChange.emit({status:a.f.CREATE})}async goUpdate(){const{props:e}=this;if((0,a.h)(e)){this.loading=!0;try{if(await(0,a.u)(this.props),await this.getLatestAdminServiceInfo(),(0,a.h)(this.props)){let e=1e3;const t=async()=>{await this.getLatestAdminServiceInfo(),!(0,a.h)(this.props)||e>3e4?this.props.adminServiceInfo?.layers?.forEach(async e=>{const t=e.adminLayerInfo?.viewLayerDefinition?.table?.filter?.value;t&&(0,a.d)(e.id,{aoi:JSON.parse(JSON.stringify(t.geometry))},this.props)}):(e*=2,setTimeout(t,e))};setTimeout(t,e)}this.loading=!1,this.showMsg("success")}catch(e){this.showMsg("error",e)}}else this.showMsg("success")}goDefinition(e){const{props:t}=this;this.status=a.f.DEFINITION,t.definitionLayerId=e,this.reRender=!this.reRender}goCancel(){this.arcgisOverviewCancel.emit()}async getLatestAdminServiceInfo(){this.props.adminServiceInfo=void 0,await(0,a.b)(this.props,!0),this.reRender=!this.reRender}showMsg(e,t){const{props:i,el:s}=this,{_messages:a}=i;this.loading=!1,"success"!==e&&console.error("could not create view",t),this.msgNode=(0,c.dN)(r.qy`<arcgis-map-config-layer-view-msg .props=${i} .flowItemElement=${this.flowItemNode} .message=${"success"===e?a.msg.updated:a.msg.updateFailed} .isError=${"success"!==e} @arcgisMsgClosed=${()=>{clearTimeout(this.timeoutHndl),this.removeMsg(e)}}></arcgis-map-config-layer-view-msg>`),s.shadowRoot.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout(()=>this.removeMsg(e),7e3)}removeMsg(e){this.timeoutHndl=void 0,this.msgNode&&(this.msgNode.remove(),this.msgNode=void 0,"success"===e&&this.arcgisOverviewUpdated.emit())}render(){const{props:e,status:t,loading:i}=this,{viewItem:s,layerItem:o,_messages:d}=e;return this.el.classList.add("calcite-match-height"),r.qy`<calcite-flow class=${(0,c.CP)(l)} .customItemSelectors=${"arcgis-map-config-layer-view-definition, arcgis-common-sql-expression-config"}><calcite-flow-item .heading=${d.general.includedLayerPanelTitle} .description=${s?.title||o?.title||""} .loading=${i} .selected=${t===a.f.OVERVIEW} class="panel" ${(0,n.K)(this.flowItemRefHandler)}>${this.renderFooterButtons()}${this.renderInfo()}${this.renderSublayers()}</calcite-flow-item>${[a.f.DEFINITION,a.f.FILTER].includes(t)?this.renderLayerDefinition():null}</calcite-flow>`}renderFooterButtons(){const{props:e}=this,{viewItem:t}=e;return r.qy`<div slot=footer class=${(0,c.CP)(p)}><div class=${(0,c.CP)(u)}>${this.renderBack()}${t?this.renderUpdate():this.renderNext()}</div>${t?this.renderCancel():null}</div>`}renderBack(){const{props:e}=this,{_messages:t}=e,i="rtl"===this._direction;return r.qy`<calcite-button @click=${this.goBack} appearance=outline-fill width=half .iconStart=${i?"arrow-right":"arrow-left"} .label=${t.general.back} ${(0,n.K)(this.backButtonNode)}>${t.general.back}</calcite-button>`}renderNext(){const{props:e}=this,{_messages:t}=e,i="rtl"===this._direction;return r.qy`<calcite-button @click=${this.goNext} appearance=solid width=half .iconEnd=${i?"arrow-left":"arrow-right"} .label=${t.general.next}>${t.general.next}</calcite-button>`}renderUpdate(){const{props:e}=this,{_messages:t}=e;return r.qy`<calcite-button @click=${this.goUpdate} appearance=solid width=half icon-start=plus-square .label=${t.general.update}>${t.general.update}</calcite-button>`}renderCancel(){const{props:e}=this,{layer:t,layerIds:i,_messages:s}=e,a=t?.loaded&&i.length;return r.qy`<calcite-button .disabled=${!a} @click=${a?this.goCancel:void 0} appearance=transparent width=full .label=${s.general.close}>${s.general.close}</calcite-button>`}renderInfo(){const{props:e}=this,{_messages:t}=e;return r.qy`<div class="info"><div class=${(0,c.CP)(d)}>${t.general.includedLayerPanelDescription}</div></div>`}renderSublayers(){const{props:e}=this,{layer:t,layerIds:i,_messages:s}=e,o=[];return"group"===t.type?((0,a.c)(t)?.forEach(e=>{i.includes(e.layerId)&&o.unshift(this.renderSublayer(e))}),(0,a.g)(t)?.forEach(e=>{i.includes(e.layerId)&&o.unshift(this.renderSublayer(e))})):o.push(this.renderSublayer(t)),r.qy`<calcite-list .label=${s.general.layers} ${(0,n.K)(this.listRefHandler)}>${o}</calcite-list>`}renderSublayer(e){const{props:t}=this,{_messages:i}=t,s="rtl"===this._direction,o=(0,a.e)(e.layerId,t);return r.qy`<calcite-list-item .label=${e.title??""} .description=${e.isTable?i.general.table:i.general.layer} @click=${this.goDefinition.bind(this,e.layerId)} data-value=${e.layerId??c.s6}>${o?r.qy`<calcite-icon class=${(0,c.CP)(h)} slot=content-end icon=sliders scale=s></calcite-icon>`:null}<calcite-icon class=${(0,c.CP)(g)} slot=content-end .icon=${s?"chevron-left":"chevron-right"} scale=s></calcite-icon></calcite-list-item>`}renderLayerDefinition(){const{props:e,status:t}=this,{definitionLayerId:i}=e;return r.qy`<arcgis-map-config-layer-view-definition .props=${e} .status=${t} .selected=${t===a.f.DEFINITION} class="calcite-match-height" @arcgisOverViewRefresh=${()=>setTimeout(()=>this.listItemNodes[i]?.setFocus(),200)} @arcgisDefinitionRefresh=${()=>{setTimeout(()=>{this.flowItemNode.selected=!1,this.definitionNode.value.selected=!0},1)}} ${(0,n.K)(this.definitionNode)}></arcgis-map-config-layer-view-definition>`}}(0,s.c)("arcgis-map-config-layer-view-overview",f)}}]);