/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-64595c.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-64595c"],{310:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigFeatureReductionFields:()=>u});var s=i(73679),n=i(4395),a=i(69548),d=i(22679),l=(i(83930),i(23054),i(77462),i(56451),i(76830)),r=(i(63438),i(18423),i(96086),i(91813),i(21255),i(13078),i(21303),i(12627),i(85643)),c=i(73801);const o=n.AH`:host{display:none}:host([selected]){display:flex}.stats-fields-notice{margin:var(--calcite-spacing-lg)}.fields{background-color:var(--calcite-color-foreground-1)}.field-icon{padding:0 var(--calcite-spacing-lg);display:flex;align-items:center}`;class u extends c.WF{constructor(){super(...arguments),this.flowItemNode=(0,r._)(),this.fabNode=(0,r._)(),this.hideLayerTitle=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisBackClick=(0,c.lh)(),this.arcgisChange=(0,c.lh)()}static{this.properties={mapView:0,layer:0,portal:0,_messages:0,flowNode:0,hideLayerTitle:5,autoGeneratedPieChartClusterFields:0,menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=o}async setFocus(){this.flowItemNode.value?.setFocus()}loaded(){this.flowItemNode.value?.setFocus()}checkAllFieldsAdded(){const{layer:e}=this,t=(0,l.g)(e);let i=0,s=(0,l.b)(t[i]),n=0,a=(0,l.h)(e,t[i].name,s[n]);for(;i<t.length&&a;){for(;n<s.length&&a;)n++,n<s.length&&(a=(0,l.h)(e,t[i].name,s[n]));a&&(i++,i<t.length&&(s=(0,l.b)(t[i]),n=0,a=(0,l.h)(e,t[i].name,s[n])))}return a}addStatsField(){const{layer:e,_messages:t}=this,i=(0,l.g)(e);let s=0,n=(0,l.b)(i[s]),r=0,c=(0,l.h)(e,i[s].name,n[r]);for(;s<i.length&&c;){for(;r<n.length&&c;)r++,r<n.length&&(c=(0,l.h)(e,i[s].name,n[r]));c&&(s++,s<i.length&&(n=(0,l.b)(i[s]),r=0,c=(0,l.h)(e,i[s].name,n[r])))}const o=i[s],u=n[r],f=new a.default({name:`${o.name}_${u}`,onStatisticField:o.name,alias:`${(0,l.c)(e,o.name)||o.alias||o.name} ${(0,d.d)(u,t).toLocaleLowerCase()}`,statisticType:u,visible:!0}),h=e.featureReduction;h.fields=h.fields||[],h.fields.push(f),(0,l.a)(f,e),this.selectedFieldName=f.name,this.requestUpdate()}render(){const{layer:e,_messages:t,hideLayerTitle:i}=this,s=e.featureReduction.fields;return this.el.classList.add("calcite-match-height"),n.qy`<calcite-flow-item .heading=${"binning"===e.featureReduction.type?t.bin.binAttributesHeading:t.cluster.clusterAttributesHeading} .description=${i?void 0:e.title??void 0} .showBackButton=${this.showBackButton} .selected=${this.selected} @calciteFlowItemBack=${()=>this.arcgisBackClick.emit()} ${(0,r.K)(this.flowItemNode)}>${this.renderStatsFieldsNotice(s)}<div class="fields">${s?.map((e,t)=>this.renderStatsField(e,t))}</div>${this.renderAddField()}</calcite-flow-item>`}renderStatsFieldsNotice(e){const{_messages:t}=this;return e?.length?"":n.qy`<calcite-card class="stats-fields-notice"><div slot=heading>${t.fields.msgTitle}</div><div slot=description>${t.fields.msg}</div></calcite-card>`}renderStatsField(e,t){const{layer:i,mapView:s,portal:a,selectedFieldName:d,_messages:r,autoGeneratedPieChartClusterFields:c}=this;(0,l.a)(e,i);const o=c?.includes(e.name);return n.qy`<arcgis-map-config-feature-reduction-field .layer=${i} .mapView=${s} .portal=${a} ._messages=${r} .aggregateField=${e} .isAutoGeneratedPieChartClusterField=${o} .open=${d===e.name} @arcgisChange=${()=>{this.selectedFieldName=e.name,i.featureReduction.fields[t]=e,this.arcgisChange.emit(),this.requestUpdate()}} @arcgisDelete=${()=>{this.selectedFieldName=void 0,this.arcgisChange.emit(),this.requestUpdate(),setTimeout(()=>{this.fabNode.value?.setFocus()},300)}}></arcgis-map-config-feature-reduction-field>`}renderAddField(){const{_messages:e}=this;return this.checkAllFieldsAdded()?"":n.qy`<calcite-fab slot=fab appearance=outline-fill kind=neutral scale=s icon=plus text-enabled .text=${e.fields.addField} @click=${()=>this.addStatsField()} ${(0,r.K)(this.fabNode)}></calcite-fab>`}}(0,s.c)("arcgis-map-config-feature-reduction-fields",u)},22679:(e,t,i)=>{i.d(t,{F:()=>c,a:()=>r,b:()=>d,c:()=>a,d:()=>f,e:()=>s,f:()=>n,g:()=>o,h:()=>l,i:()=>u});const s=9,n=90,a=37.5,d=9,l=90,r=37.5;var c=(e=>(e.CLUSTERING="clustering",e.CHART_CLUSTERING="chartClustering",e.BINNING="binning",e))(c||{});function o(e){const t=e.featureReduction;if(t)return"binning"===t.type?"binning":"cluster"===t.type?function(e){const t=e.featureReduction;return!!t.renderer&&"pie-chart"===t.renderer.type&&!t?.renderer?.authoringInfo?.isAutoGenerated}(e)?"pie-chart":"cluster":void 0}function u(e){const t=e.featureReduction;return!t?.renderer||!!t?.renderer?.authoringInfo?.isAutoGenerated}function f(e,t){switch(e){case"sum":return t.fields.sum;case"avg":return t.fields.mean;case"min":return t.fields.min;case"max":return t.fields.max;case"stddev":return t.fields.stdDev;case"mode":return t.fields.mode;case"var":return t.fields.var;case"count":return t.fields.count;default:return""}}},76830:(e,t,i)=>{i.d(t,{a:()=>u,b:()=>c,c:()=>f,d:()=>o,e:()=>a,f:()=>l,g:()=>n,h:()=>d,i:()=>r});var s=i(42097);function n(e){return e.fields.filter(e=>["small-integer","big-integer","integer","single","double","long","number","string"].includes(e.type))}function a(e,t){if(t)return e.fields.find(e=>e.name===t)}function d(e,t,i){return!!e.featureReduction.fields?.find(e=>e.onStatisticField===t&&e.statisticType===i)}function l(e,t,i,s){const n=t.substring(0,t.lastIndexOf(`_${i}`));return!!e.featureReduction.fields?.find(e=>e.name.substring(0,e.name.lastIndexOf(`_${s}`))===n&&e.statisticType===s)}function r(e,t){return!c(a(e,t)).find(i=>!d(e,t,i))}function c(e){return["string","date","timestamp-offset"].includes(e.type)?["mode"]:["sum","avg","min","max","mode"]}function o(e,t){return e.featureReduction.popupTemplate.fieldInfos.find(e=>e.fieldName===t)}function u(e,t){const i=t.featureReduction,{popupTemplate:n}=i;n.fieldInfos=n.fieldInfos||[],n.fieldInfos.find(t=>t.fieldName===e.name)||n.fieldInfos.push(new s.default({fieldName:e.name,label:e.alias,isEditable:!1,visible:!0,format:h(e,t)}))}function f(e,t){const{popupTemplate:i}=e;return i?.fieldInfos?.find(e=>e.fieldName===t)?.label}function h(e,t){const i=e.onStatisticField,s=e.onStatisticExpression,n="sum"===e.statisticType,d="count"===e.statisticType,l=a(t,i),r=d||s&&n||l&&["small-integer","big-integer","integer","long","number"].includes(l.type);return l&&["single","double"].includes(l.type)?{digitSeparator:!0,places:1}:r?{digitSeparator:!0}:void 0}}}]);