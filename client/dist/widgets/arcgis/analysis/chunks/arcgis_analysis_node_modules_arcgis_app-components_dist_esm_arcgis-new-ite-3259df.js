/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-3259df.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-3259df"],{23405:(e,r,t)=>{t.r(r),t.d(r,{arcgis_new_item_pages_feature_layer_from_url:()=>h});var n=t(87849),a=t(52995),i=t(59317),s=t(41473),o=t(72257),l=t(74695),c=t(3826),d=t(95878),u=t(88863),m=t(33547),g=t(80562);t(83692),t(931),t(93814),t(54251),t(46904),t(29599),t(60958),t(37762),t(86562),t(15332),t(88878),t(24869),t(15912),t(27137),t(76246),t(58573),t(1536),t(32478),t(90079),t(62645);const h=class{constructor(e){(0,n.r)(this,e),this.newItemUpdatePage=(0,n.c)(this,"newItemUpdatePage",7),this.getLayerDetailInfo=async()=>{const{url:e}=this,r=i.c.portal,{result:t}=await(0,a.g)([e],r),n=null==t?void 0:t[0];if(!(null==n?void 0:n.item))return null;const{result:s}=await(0,a.a)({itemId:n.item.id,owningSystemUrl:n.owningSystemUrl});return s},this.url=void 0,this.error=void 0,this.loading=void 0}async componentWillLoad(){this.i18n=d.u.i18n.featureLayerFromUrl,this.commonI18n=d.u.i18n.common,this.url=c.a.serviceInfoUrl}async handleNext(){var e,r,t,n,a,d,h,y,p,v;const{url:w,getLayerDetailInfo:f}=this;if(!w)return(0,m.f)("Empty URL"),this.inputRef.setFocus(),void(this.error="missingUrl");const{error:b}=(0,u.g)(w);if(b)return(0,m.f)("Invalid URL"),this.inputRef.setFocus(),void(this.error=b.code);this.loading=!0;const I=w.toLowerCase().indexOf("/featureserver"),U=w.substring(0,I)+"/FeatureServer";try{const{result:u}=await(0,l.B)({url:U}),m=null==u?void 0:u.serviceInfo;(null==m?void 0:m.isSecured)&&(c.a.checkAuth=!0);const{layers:b,serviceInfo:I,tables:S}=await(0,l.o)({serviceUrl:w,restBaseUrl:(0,s.g)(i.c.portal),forceAddToken:!1,isSecure:null==m?void 0:m.isSecured}),k=await f();c.a.layerData=k,c.a.serviceInfo=Object.assign(Object.assign({},I),{layers:b,tables:S});let _=null===(e=I.documentInfo)||void 0===e?void 0:e.Title;const O=null!==(r=I.layers)&&void 0!==r?r:[],j=null!==(t=I.tables)&&void 0!==t?t:[];_||(1===O.length&&0===j.length?_=O[0].name:1===j.length&&0===O.length&&(_=j[0].name)),c.a.initialTitle=_,o.i.tags=(0,g.a)(null===(n=I.documentInfo)||void 0===n?void 0:n.Keywords),o.i.snippet=null!==(h=null!==(d=null===(a=I.documentInfo)||void 0===a?void 0:a.Subject)&&void 0!==d?d:I.serviceDescription)&&void 0!==h?h:"",c.a.description=null!==(v=null!==(p=null===(y=I.documentInfo)||void 0===y?void 0:y.Comments)&&void 0!==p?p:I.description)&&void 0!==v?v:"",c.a.serviceInfoUrl=w,this.loading=!1,this.newItemUpdatePage.emit("featureLayerSummary")}catch(e){(0,m.f)("Service doesn't exist"),this.error="serviceNotExist"}}handleInputChange(e){this.url=e.target.value}render(){const{loading:e,i18n:r,commonI18n:t,error:a,url:s}=this,{title:o,description:l}=r.error[a]||{},{portal:c}=i.c;return(0,n.h)(n.H,{key:"8e9347714ed5d4e882e9287bfd0c2027fe81d05c"},(0,n.h)("arcgis-new-item-loader",{key:"6a658f3e956cc5b7ac2fcb40f12738b1b889d750",active:e,text:d.u.i18n.urlType.getServiceInfo}),(0,n.h)("calcite-label",{key:"d7ef6b7164bc17235ff8c5ccbb647ae5837e4aa6",class:"label"},(0,n.h)("arcgis-new-item-description",{key:"10b5e2a3861a21b1e03153298e63fc89c2300a99",header:t.url,content:r.description}),(0,n.h)("calcite-input",{key:"c396e3e6ec492dd881869dcc7d3c5bb57f9677c2",placeholder:c.isPortal?"https://webadaptorhost.domain.com/webadaptorname/rest/services/service/servicetype":"https://myserver.com/arcgis/rest/services/folder/service/FeatureServer",onCalciteInputInput:e=>this.handleInputChange(e),class:"input",scale:"l",ref:e=>this.inputRef=e,value:s})),(0,n.h)("arcgis-new-item-alert",{key:"9e55c5e7ae8db408db3007caed8f573bbb3a8741",heading:o,description:l,active:!!a,onAlertDismiss:()=>this.error=null}))}get el(){return(0,n.a)(this)}};h.style=".input{margin-top:1rem}.label{margin-top:1rem;display:block}"},52995:(e,r,t)=>{t.d(r,{a:()=>b,b:()=>u,c:()=>m,d:()=>g,e:()=>h,f:()=>d,g:()=>y,l:()=>I});var n=t(83692),a=t(71467),i=t(46904),s=t(931),o=t(41473),l=t(29599),c=t(60958);const d=async(e,r,t)=>{const{owningSystemUrl:a}=await(0,n.f)(async()=>(0,l.a)(e),"portalInfo",e.id);return(await Promise.all(r.map(async e=>{try{const{owningSystemUrl:r}=await(0,l.g)(e,t);return{owningSystemUrl:r,url:e}}catch(r){return console.error(r),{owningSystemUrl:null,url:e}}}))).filter(({owningSystemUrl:e})=>e===a).map(({url:e})=>e)},u=async(e,r,t)=>{var a;try{return{result:await(0,n.r)(e,r,Object.assign({addTokenManually:!1},t))}}catch(e){const r="token required";return(null===(a=null==e?void 0:e.message)||void 0===a?void 0:a.toLowerCase().includes(r))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function m(e,r,t){var a;const{relationshipType:i,direction:s}=t,l=`${(0,o.g)(r)}content/items/${e}/relatedItems`,c=await(0,n.r)(l,{relationshipType:i,direction:s,includeRecycleBin:!0});return(null===(a=null==c?void 0:c.relatedItems)||void 0===a?void 0:a.length)&&(c.relatedItems=c.relatedItems.filter(r=>(null==r?void 0:r.id)!==e)),c}const g=async(e,r,t)=>{const a=!!t,i=(0,o.g)(r),s=a?`${i}/content/groups/${t.id}/search`:`${i}/search`;try{return{result:(await(0,n.r)(s,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},h=async(e,r)=>{try{const[t]=await(0,s.l)(["esri/portal/PortalItem"]);return{result:await Promise.all(e.map(e=>new t({id:e,portal:r}).load()))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},y=async(e,r,t,a)=>{try{const i=[],s=[],o=[];await Promise.all(e.map(async e=>{const{result:c,error:d}=await(0,n.f)(()=>u(e,r,a),"itemMetadata",`${e}--no-token`);if("tokenRequired"!==(null==d?void 0:d.code))if(p(c))i.push(v(c,e));else try{const r=await(0,l.g)(e,t);o.push(Object.assign(Object.assign({},c),{owningSystemUrl:r.owningSystemUrl}))}catch(d){console.warn(d)}else s.push(e)}));const m=await d(r,s,t),g=(await Promise.all(m.map(async e=>({response:await(0,c.r)(e,r,Object.assign({addTokenManually:!0},a)),owningSystemUrl:(await(0,l.g)(e,t)).owningSystemUrl,url:e})))).reduce((e,{response:r,url:t,owningSystemUrl:n})=>p(r)?(i.push(v(r,t)),e):[...e,Object.assign(Object.assign({},r),{owningSystemUrl:n})],[]),h=await Promise.all([...o,...g].map(async({serviceItemId:e,owningSystemUrl:r})=>{if(!e)return null;const{result:t}=await f({itemId:e,owningSystemUrl:r});return{item:t,owningSystemUrl:r}})),{result:w}=i.length<=0?{result:[]}:await y(i,r,t,a);return{result:[...h.filter(e=>!!e),...w]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},p=e=>!!(null==e?void 0:e.sources),v=(e,r)=>{var t;const n=null===(t=Object.values(e.sources)[0])||void 0===t?void 0:t.url;return n?n.includes("..")?(0,o.t)({url:r,path:n}):n:null},w=e=>`${e}/sharing/rest`,f=async({itemId:e,owningSystemUrl:r,requestOptions:t})=>{try{const a=(0,i.g)(e,w(r));return{result:await(0,n.r)(a,{},Object.assign(Object.assign({},t),{addTokenManually:!1}))}}catch(e){return console.error(e),(0,a.b)(e)&&e.message.toLocaleLowerCase().includes("invalid token")?{error:{code:"invalidToken"}}:{error:{code:"unhandledError"}}}},b=async({itemId:e,owningSystemUrl:r,requestOptions:t})=>{try{const a=`${(0,i.g)(e,w(r))}/data`;return{result:await(0,n.r)(a,{},Object.assign(Object.assign({},t),{addTokenManually:!1}))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},I=async(e,r)=>{try{const[t]=await(0,s.l)(["esri/portal/PortalItem"]),n=new t({id:e,portal:r});return await n.load(),{result:n}}catch(e){return console.error("Fail to reload item",e),{error:{code:"unhandledError"}}}}}}]);