/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-f9bbae.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-f9bbae"],{4265:(e,t,i)=>{i.d(t,{a:()=>a,d:()=>s,t:()=>o});const s=(e,t)=>{let i,s="idle";const a=async(...a)=>await new Promise(o=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),o(e(...a))):o(null);break;case"invoked":clearTimeout(i),s="idle",o(e(...a));break;case"cancelled":clearTimeout(i),s="idle",o(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout(()=>{s="idle",o(e(...a))},t)}});return a.flush=async function(...e){return s="flushed",await a(...e)},a.invoke=async function(...e){return s="invoked",await a(...e)},a.cancel=async function(...e){return s="cancelled",await a(...e)},a.getStatus=function(){return s},a},a=(e,t)=>{let i;return async(...s)=>await new Promise(a=>{i||(i=setTimeout(()=>{clearTimeout(i),i=void 0,a(e(...s))},t))})};function o(e){return new Promise(t=>setTimeout(t,e))}},9243:(e,t,i)=>{i.d(t,{a:()=>a,b:()=>s});const s=["attachment","connectivity","container","content","structure"];var a=(e=>(e.title="title",e.description="description",e.displayCount="displayCount",e))(a||{})},34883:(e,t,i)=>{function s(e){const{layer:t,backingFeatureLayer:i}=e;return i??t}i.d(t,{g:()=>s})},42855:(e,t,i)=>{i.d(t,{a:()=>r,f:()=>s,l:()=>a,s:()=>o});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),o=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(o||{}),r=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(r||{})},66228:(e,t,i)=>{i.d(t,{a:()=>b,b:()=>L,c:()=>C,d:()=>T,e:()=>$,f:()=>_,g:()=>f,h:()=>h,i:()=>m,j:()=>g,k:()=>x,l:()=>A,m:()=>I,n:()=>y,o:()=>N,p:()=>M,q:()=>P,r:()=>q,s:()=>v,t:()=>k,u:()=>w});var s=i(63438),a=i(18423),o=i(96086),r=i(91813),n=i(21255),l=i(13078),c=i(21303),p=i(12627),u=i(42855);const y=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],d=["feature"];function m(e){return null!=e}function g(e,t,i){const s=t.fieldName;if(s.includes(u.f.expression)){const e=i.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function f(e){return new Map((await x(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function h(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${u.f.expression}${e.name}`;t.set(i,e)}),t}function b(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function w(e){const t=b(e);let i;return t===u.s.wms||t===u.s.mapImage?i=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(i=e.version),Number.parseFloat(i)}function v(e){return"fieldConfigurations"in e&&d.includes(e.type)}async function x(e){return await new Promise((t,i)=>{switch(b(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const s=e,a=s?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,o=[];a.forEach(e=>{i.has(e)&&o.push(i.get(e))}),t(o)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function N(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function I(e){return Number((100*(1-e)).toFixed(1))}function k(e){return Number((1-e/100).toFixed(3))}const T=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},L=async(e,t)=>{const i=new p.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},$=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await S(i,s.features?.[0])},S=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=T(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const o=new a.default;i.geometry=o}return i};function P(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function C(e){if(b(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(b(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function A(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function _(e,t){try{const i=b(e);if(i===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await L(e,t)||await F(e,t)]};if(i===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await F(e,t)]};const s=i===u.s.ogcFeature||i===u.s.stream?await t.whenLayerView(e):e,a=s.createQuery();a.where=s.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===u.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const o=await s.queryFeatures(a);return o?.features?.length||(o.features[0]=await F(e,t)),o}catch(e){console.error(e)}}async function F(e,t){return await new Promise(i=>{const a=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const c=t.extent;let p;"polygon"===e.geometryType?p=n.default.fromExtent(c):"point"===e.geometryType?p=c.center.clone():"multipoint"===e.geometryType?p=new o.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(p=new r.default({spatialReference:t.spatialReference.clone()}),p.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(p=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=p,i(a)})}function q(e){return b(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function M(e){return b(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},72978:(e,t,i)=>{i.d(t,{g:()=>o,i:()=>a});var s=i(34883);function a(e){const{mapView:t,portal:i}=e,{map:a}=t,{portalHostname:r}=i,n=(0,s.g)(e);if(!a)return!1;const{utilityNetworks:l}=a;if(!l)return!1;const c=i.isPortal,p="1"===window.localStorage.getItem("utility-networks-agol")&&("devext.arcgis.com"===r||"qaext.arcgis.com"===r);if(!c&&!p)return!1;const u=o(n),y=l.find(e=>e.sourceJSON?.serviceItemId===u);return!!y&&y.isUtilityLayer(n)}function o(e){return"subtype-sublayer"===e.type?e.parent.serviceItemId:e.serviceItemId}},77367:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigPopupAssociationConfigPopover:()=>g});var s=i(73679),a=i(4395),o=i(54312),r=i(44345),n=i(66228),l=i(4265),c=i(85643),p=i(73801),u=i(9243),y=(i(9923),i(42097),i(34883)),d=(i(81565),i(72978));const m=a.AH`.popover{--calcite-popover-z-index: 100}.associations-div{background-color:var(--calcite-color-foreground-1);padding:var(--calcite-spacing-sm);max-height:calc(60vh - 102px)}.options-block{margin-top:var(--calcite-spacing-sm)}`;class g extends p.WF{constructor(){super(...arguments),this.popoverNode=(0,c._)(),this.panelNode=(0,c._)(),this.titleNode=(0,c._)(),this.descriptionNode=(0,c._)(),this.typeComboboxNode=(0,c._)(),this.layerComboboxNode=(0,c._)(),this.sourceUtilityNetworkLayerList=[],this.utilityNetworkLayerIdMap=new Map,this.arcgisChange=(0,p.lh)(),this.closePopupPopovers=(0,p.lh)()}static{this.properties={referenceElement:0,associationsContent:0,associationType:0,popupState:0}}static{this.styles=m}async reposition(){this.popoverNode.value?.reposition()}async load(){const{popupState:e}=this;this.allUtilityNetworkLayersAndTables=await this.getAllUtilityNetworkLayersAndTables();const{mapView:t}=e,{map:i}=t,{utilityNetworks:s}=i,a=(0,y.g)(e),r=(0,d.g)(a);this.currentUtilityNetwork=s.find(e=>e.sourceJSON?.serviceItemId===r),this.syncUtilityNetworkLayerIdMap(),this.layerListHandle=o.watch(()=>i?.allLayers.filter(e=>(0,d.g)(e)===r).length,()=>{this.syncUtilityNetworkLayerIdMap(),this.requestUpdate(),this.arcgisChange.emit()}),this.tableListHandle=o.watch(()=>i?.allTables.filter(e=>(0,d.g)(e)===r).length,()=>{this.syncUtilityNetworkLayerIdMap(),this.requestUpdate(),this.arcgisChange.emit()})}loaded(){this.arcgisChange.emit(),this.panelNode.value?.setFocus()}disconnectedCallback(){super.disconnectedCallback(),this.layerListHandle?.remove(),this.tableListHandle?.remove()}async getAllUtilityNetworkLayersAndTables(){const{popupState:e}=this,t=(0,y.g)(e),i="url"in t&&t.url||"portalItem"in t&&t.portalItem?.url;try{const e=await(0,r.default)(i,{responseType:"json",method:"auto",query:{f:"json"}}),t=[...e?.data?.layers||[],...e?.data?.tables||[]];return Promise.resolve(t)}catch{return await Promise.resolve([])}}syncUtilityNetworkLayerIdMap(){const{popupState:e}=this,{mapView:t}=e,{map:i}=t,s=(0,y.g)(e),{allUtilityNetworkLayersAndTables:a,currentUtilityNetwork:o}=this;this.utilityNetworkLayerIdMap.clear();const r=(0,d.g)(s);[...i?.allLayers.flatten(e=>"sublayers"in e?e.sublayers:null)??[],...i?.allTables.flatten(e=>"sublayers"in e?e.sublayers:null)??[]].filter(e=>(0,d.g)(e)===r).forEach(e=>{const t="subtype-sublayer"===e.type?e.parent.layerId:e.layerId,i=a.find(e=>e.id===t)?.name;i&&this.utilityNetworkLayerIdMap.set(t,i)});const n=this.associationType.associatedNetworkSourceId,l=o.getLayerIdBySourceId(n);this.utilityNetworkLayerIdMap.has(l)||(this.associationType.associatedNetworkSourceId=null)}setSourceLayerList(){const{allUtilityNetworkLayersAndTables:e,currentUtilityNetwork:t,associationType:i}=this;this.sourceUtilityNetworkLayerList=e.filter(e=>(0,n.i)(this.utilityNetworkLayerIdMap.get(e.id))&&(0,n.i)(t.getSourceIdByLayerId(e.id))).map(e=>{const s=this.utilityNetworkLayerIdMap.get(e.id),o=t.getSourceIdByLayerId(e.id);return a.qy`<calcite-combobox-item .value=${o} .heading=${s} .selected=${i.associatedNetworkSourceId===o}></calcite-combobox-item>`})}changeAssociationProperties(){this.associationType.title=this.titleNode.value.value,this.associationType.description=this.descriptionNode.value.value,this.associationType.type=this.typeComboboxNode.value.selectedItems[0]?.value,this.associationType.associatedNetworkSourceId=this.layerComboboxNode.value.selectedItems[0]?.value??null,this.arcgisChange.emit()}getAssociationTypeString(e){const{popupState:t}=this,{_messages:i}=t;switch(e){case"attachment":return i.associations.attachment;case"connectivity":return i.associations.connectivity;case"container":return i.associations.container;case"content":return i.associations.content;case"structure":return i.associations.structure}}render(){const{popupState:e}=this,{_messages:t}=e;return this.el.classList.add("js-app-flyout"),a.qy`<calcite-popover .referenceElement=${this.referenceElement} open class="popover" .label=${t.associations.configureType} placement=leading-start pointer-disabled trigger-disabled .offsetDistance=${-Math.round(this.referenceElement.getBoundingClientRect().width)} offset-skidding=50 ${(0,c.K)(this.popoverNode)}><calcite-panel closable style=${(0,p.zl)({width:`${this.referenceElement.getBoundingClientRect().width}px`})} @calcitePanelClose=${()=>this.closePopupPopovers.emit()} ${(0,c.K)(this.panelNode)}><div slot=header-content>${t.associations.configureType}</div>${this.renderDoneButton()}<div class="associations-div">${this.renderAssociationsTypeSelection()}${this.renderAssociationsFilterForLayerSelection()}${this.renderAssociationsDisplayOptions()}</div></calcite-panel></calcite-popover>`}renderAssociationsTypeSelection(){const{popupState:e}=this,{_messages:t}=e,{associationsContent:i,associationType:s}=this,o=i.associationTypes.map(e=>e.type),r=u.b.filter(e=>s.type===e||!o.includes(e)).map(e=>{const t=this.getAssociationTypeString(e);return a.qy`<calcite-combobox-item .value=${e} .heading=${t} .selected=${e===s.type}></calcite-combobox-item>`});return a.qy`<calcite-label>${t.associations.type}<calcite-combobox .label=${t.associations.type} scale=s selection-mode=single-persist clear-disabled @calciteComboboxChange=${e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()}} overlay-positioning=fixed ${(0,c.K)(this.typeComboboxNode)}>${r}</calcite-combobox></calcite-label>`}renderAssociationsFilterForLayerSelection(){const{popupState:e}=this,{_messages:t}=e;return this.syncUtilityNetworkLayerIdMap(),this.setSourceLayerList(),a.qy`<calcite-label>${t.associations.layer}<calcite-combobox .label=${t.associations.layer} scale=s selection-mode=single-persist .placeholder=${t.associations.optionalLayerSelection} @calciteComboboxChange=${e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()}} overlay-positioning=fixed ${(0,c.K)(this.layerComboboxNode)}>${this.sourceUtilityNetworkLayerList}</calcite-combobox></calcite-label>`}renderAssociationsDisplayOptions(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<calcite-block-section expanded .text=${t.options}><div class="options-block">${this.renderTitle()}${this.renderDescription()}</div></calcite-block-section>`}renderTitle(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<calcite-label scale=s>${t.title}<calcite-input type=text .value=${this.associationType.title} .placeholder=${t.enterTitle} @calciteInputInput=${(0,l.d)(e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()},300)} ${(0,c.K)(this.titleNode)}></calcite-input></calcite-label>`}renderDescription(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<calcite-label scale=s>${t.desc}<calcite-input type=text .value=${this.associationType.description} .placeholder=${t.enterDescription} @calciteInputInput=${(0,l.d)(e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()},300)} ${(0,c.K)(this.descriptionNode)}></calcite-input></calcite-label>`}renderDoneButton(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<calcite-button appearance=outline-fill slot=footer width=full @click=${()=>this.closePopupPopovers.emit()}>${t.done}</calcite-button>`}}(0,s.c)("arcgis-map-config-popup-association-config-popover",g)}}]);