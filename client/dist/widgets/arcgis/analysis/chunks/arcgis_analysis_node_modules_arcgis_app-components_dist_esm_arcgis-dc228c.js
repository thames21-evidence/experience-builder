/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-dc228c.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-dc228c"],{61:(e,t,i)=>{i.r(t),i.d(t,{arcgis_new_item_pages_service_definition_properties:()=>p});var r=i(87849),s=i(59317),o=i(74695),n=i(98704),a=i(1536),l=i(51632),c=i(38409),d=i(3826),u=i(95878);i(37762),i(88878),i(83692),i(931),i(93814),i(41473),i(54251),i(46904),i(24869),i(15912),i(72257),i(86562),i(15332),i(27137),i(76246),i(58573),i(29599),i(60958),i(32478),i(82149),i(54077),i(1654),i(10578),i(8417),i(50315),i(26262);const p=class{constructor(e){(0,r.r)(this,e),this.newItemToggleNavigationEnabled=(0,r.c)(this,"newItemToggleNavigationEnabled",7),this.handleRedirect=(0,r.c)(this,"handleRedirect",7),this.newItemPrevPage=(0,r.c)(this,"newItemPrevPage",7),this.i18n=void 0,this.itemPropertiesi18n=void 0,this.loading=!1,this.showError=!1,this.errorMessage=void 0,this.xmlFile={tags:[],summary:""},this.hostedWorkflowFolder=void 0,this.alertKind="danger",this.alertTitle=""}async componentWillLoad(){this.i18n=u.u.i18n.serviceDefinitionStrings,this.itemPropertiesi18n=u.u.i18n.itemProperties,u.u.nextText="save";const e=await(0,l.e)(s.c.config.restBaseUrl,d.a.id);(null==e?void 0:e.result)&&(this.xmlFile=e.result)}async navigateToNextPage(){var e;this.newItemToggleNavigationEnabled.emit(!1),this.loading=!0;const t=await(null===(e=this.classificationRef)||void 0===e?void 0:e.checkAllAttributesInputErrors());t?this.displayError(t):d.a.serviceDefinitonProperties.isHosted?this.publishHostedService():this.publishNonHostedService()}async handlePrev(e){d.a.serviceDefinitonProperties.isHosted&&(e.preventDefault(),await(0,c.d)(),this.newItemPrevPage.emit())}displayError(e,t=!1){const i=this.itemPropertiesi18n.serviceNameExists;this.errorMessage=t?i.description:e||this.i18n.errorUpdating,this.alertTitle=t?i.title:"",this.showError=!0,this.alertKind="danger",this.loading=!1,this.newItemToggleNavigationEnabled.emit(!0)}async publishNonHostedService(){var e,t,i,r;const{service:s}=d.a.serviceDefinitonProperties.serviceInfo,{layerMustBeShared:o,errorUpdating:n}=this.i18n,{extensions:c,serverFolder:u,serviceName:p,interceptorOrderList:v,interceptors:h,selectedServerUrl:m,id:f,portalFolder:g}=d.a;c.forEach(e=>{("MapServer"!==s.type&&"ImageServer"!==s.type||"WFSServer"!==e.typeName||"true"!==e.enabled)&&("ImageServer"!==s.type||"WCSServer"!==e.typeName&&"WMSServer"!==e.typeName||"true"!==e.enabled)||(this.errorMessage=o,this.showError=!0,this.alertKind="warning"),delete e.displayName});const y={folderName:u,service:Object.assign(Object.assign({},s),{extensions:c}),_ssl:!0};y.service.serviceName=p||s.serviceName;const S=v.filter(e=>"true"===h[e].enabled);S.length>0&&(y.service.frameworkProperties={interceptorOrderList:S.join(",")});const b=await(0,l.s)(m,y,f);if("esriJobSucceeded"!==(null===(e=null==b?void 0:b.result)||void 0===e?void 0:e.jobStatus))return void this.displayError(n);const w=g,I=await(0,l.f)(b.result.results.out_results.paramUrl,m,b.result.jobId),P=(null===(i=null===(t=null==I?void 0:I.result)||void 0===t?void 0:t.portalProperties)||void 0===i?void 0:i.portalItems)||[],D=null===(r=P.find(e=>e.type===I.result.type))||void 0===r?void 0:r.itemID;if(w.username!==w.id&&(null==I?void 0:I.result)){const e=[f,...P.map(e=>e.itemID)],t=await(0,a.m)(e.join(","),g.id);(null==t?void 0:t.result)?this.handleRedirect.emit({id:D,type:"Data Store"}):this.displayError(n)}this.handleRedirect.emit({id:D,type:"Data Store"})}async publishHostedService(){var e,t;const i=await(0,n.p)({itemId:d.a.id,user:s.c.user,portal:s.c.portal,extension:d.a.extension,type:d.a.type,title:d.a.serviceDefinitonProperties.serviceInfo.service.serviceName}),r=null===(e=null==i?void 0:i.result)||void 0===e?void 0:e.services[0];if(i.error||!r)this.displayError(this.i18n.errorUpdating,"serviceNameExists"===(null===(t=null==i?void 0:i.error)||void 0===t?void 0:t.code));else{if("failed"===(await(0,o.g)(r.serviceItemId,{jobId:r.jobId})).status)return void this.displayError(this.i18n.errorUpdating);const e=[d.a.id,r.serviceItemId];this.hostedWorkflowFolder.id!==this.hostedWorkflowFolder.username&&await(0,a.m)(e.join(","),this.hostedWorkflowFolder.id),this.handleRedirect.emit({id:r.serviceItemId,type:"Data Store"})}}render(){var e,t,i,o,n;const{i18n:a}=this,l=null===(t=null===(e=null===d.a||void 0===d.a?void 0:d.a.serviceDefinitonProperties)||void 0===e?void 0:e.serviceInfo)||void 0===t?void 0:t.service,{helpMap:c,helpBase:p}=s.c.config,{publishingService:v,serviceDefinitionTitle:h,errorUpdating:m,type:f,name:g,summaryDescription:y,learnMoreAboutServiceDefinition:S}=a,b="GeoDataServer"===l.type?"GeoData Server":h[(null===(i=null===d.a||void 0===d.a?void 0:d.a.serviceDefinitonProperties)||void 0===i?void 0:i.isHosted)&&"MapServer"===(null==l?void 0:l.type)?"TileLayer":null==l?void 0:l.type];return(0,r.h)(r.F,{key:"2307f5e93f8f634a5faacfbf0e2a4582dee89cc6"},this.loading?(0,r.h)("calcite-loader",{label:v,text:v}):(0,r.h)(r.F,null,(0,r.h)("arcgis-new-item-input-readonly",{label:g}),(0,r.h)("calcite-label",null,f,(0,r.h)("calcite-input-text",{readOnly:!0,value:b})),(null===(o=d.a.serviceDefinitonProperties)||void 0===o?void 0:o.isHosted)&&(0,r.h)("arcgis-folder-picker",{onArcgisFolderPickerChange:e=>this.hostedWorkflowFolder=e.detail}),(0,r.h)("arcgis-item-properties",null,(0,r.h)("arcgis-tags-picker",{class:"medium",activeTags:this.xmlFile.tags||[],readOnly:!0}),(0,r.h)("arcgis-summary-input",{class:"medium",summary:this.xmlFile.summary||"",readOnly:!0,"aria-label":y})),(0,r.h)("calcite-link",{href:`${p}${c[120005523]}`,"aria-label":S,target:"_blank"},u.u.i18n.common.learnMore),(null===(n=s.c.portal.sourceJSON)||void 0===n?void 0:n.hasClassificationSchema)&&(0,r.h)("arcgis-new-item-classification",{ref:e=>this.classificationRef=e})),this.showError&&(0,r.h)("arcgis-new-item-alert",{key:"33e9d93c007a2653e3733e576ed6429f2a895e74",heading:this.alertTitle,description:this.errorMessage||m,active:!0,onAlertDismiss:()=>(this.showError=!1,this.alertKind="danger"),kind:this.alertKind}))}}},38409:(e,t,i)=>{i.d(t,{d:()=>n,p:()=>o});var r=i(3826),s=i(1536);function o(e,t,i,r){var s,o;const n={},a=[],l=t.result.ExtensionTypes.filter(e=>{var t,s;return(null===(t=i[r])||void 0===t?void 0:t.includes(e.Name))||(null===(s=e.Info)||void 0===s?void 0:s.SupportsInterceptor)});l.forEach(t=>{var i;const{Info:r,Properties:s,DisplayName:o,Name:l}=t;if(e[l]&&!(null==r?void 0:r.SupportsInterceptor))e[l].displayName=o;else{const t={enabled:(null===(i=e[l])||void 0===i?void 0:i.enabled)||"false",typeName:l,capabilities:(null==r?void 0:r.DefaultWebCapabilities)||"",properties:Object.assign(Object.assign(Object.assign(Object.assign({},s),(null==r?void 0:r.SupportsREST)&&{SupportsREST:r.SupportsREST}),(null==r?void 0:r.SupportsSOAP)&&{SupportsSOAP:r.SupportsSOAP}),(null==r?void 0:r.SupportsInterceptor)&&{SupportsInterceptor:r.SupportsInterceptor}),displayName:o||""};"true"===(null==r?void 0:r.SupportsInterceptor)?(n[l]=t,a.push(l)):e[l]=t}});for(const t in e)"true"===(null===(o=null===(s=e[t])||void 0===s?void 0:s.properties)||void 0===o?void 0:o.supportsInterceptor)&&delete e[t];return{allExtensions:e,updatedInterceptors:n,interceptorOrderList:a}}async function n(){try{r.a.id&&(await(0,s.d)(r.a.id,{permanentDelete:!0}),r.a.id=null)}catch(e){console.warn("Delete item failed",e)}}},51632:(e,t,i)=>{i.d(t,{a:()=>d,b:()=>u,c:()=>l,d:()=>c,e:()=>m,f:()=>h,g:()=>p,s:()=>v});var r=i(54251),s=i(74695),o=i(98704),n=i(1536),a=i(83692);async function l(e){try{const t=await(0,a.r)(e);return{result:{folders:t.folders||[]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}async function c(e,t){try{return{result:{status:(await(0,a.r)(e,{folderName:t},{},"post")).status}}}catch(e){return console.error(e),{error:e}}}async function d(e){const t=await(0,s.l)();try{await(0,o.c)(t)}catch(e){return{error:e}}const i=`${e}/content/features/analyze`;try{const e=await(0,a.r)(i,{itemid:t.id,filetype:"Service Definition"},{},"post");return e.id=t.id,{result:e}}catch(e){return await async function(e){try{await(0,n.d)(e,{permanentDelete:!0})}catch(e){console.error("Failed to delete item:",e)}}(t.id),{error:e}}}async function u(e,t){const i=`${e}/content/features/analyze`;try{return{result:await(0,a.r)(i,{itemid:t,filetype:"Service Definition"},{},"post")}}catch(e){return{error:e}}}async function p(e,t){const i=`${e}/types/providers/ArcObjects11/${t}/types?listInterceptors=true`;try{return{result:await(0,a.r)(i)}}catch(e){return{error:e}}}async function v(e,t,i){const r=`${e}/rest/services/System/PublishingTools/GPServer/Publish%20Service%20Definition`;try{const e=await(0,a.r)(`${r}/submitJob`,{in_sdp_id:i,in_config_overwrite:JSON.stringify(t)},{},"post");return{result:(await async function(e,t){const i=`${t}/jobs/${encodeURIComponent(e)}`;try{return{result:await(0,a.p)(i,{pendingStatuses:["esriJobExecuting","esriJobSubmitted","esriJobWaiting"],successStatuses:["esriJobSucceeded"]},"post")}}catch(e){return{error:e}}}(e.jobId,r)).result}}catch(e){return{error:e}}}async function h(e,t,i){var r;const s=`${t}/rest/services/System/PublishingTools/GPServer/Publish%20Service%20Definition/jobs/${i}/${e}`;try{const e=await(0,a.r)(s);if(e){const i=null===(r=null==e?void 0:e.value)||void 0===r?void 0:r.svcConfigInfo,s=`${t}/admin/services/${(null==i?void 0:i.folder)?`${i.folder}/`:""}${i.name}.${i.type}`;return{result:await(0,a.r)(s)}}}catch(e){return{error:e}}}async function m(e,t){var i;const s=`${e}content/items/${t}/info/iteminfo.xml${(0,r.g)()?`?token=${(0,r.g)()}`:""}`;try{const e=await fetch(s,{headers:{Accept:"application/xml"}}),t=await e.text(),r=(new DOMParser).parseFromString(t,"text/xml"),o=Array.from(r.getElementsByTagName("tag")).map(e=>e.textContent);return{result:{tags:o,summary:(null===(i=r.getElementsByTagName("summary")[0])||void 0===i?void 0:i.textContent)||""}}}catch(e){return{error:e}}}}}]);