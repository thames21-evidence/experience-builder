/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-adb408.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-adb408"],{3104:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigSmartMappingAge:()=>T});var a=i(73679),n=i(4395),r=i(46317),s=(i(52797),i(20936)),l=(i(54312),i(44345),i(55448),i(62052)),o=(i(34031),i(63438),i(5933),i(1225)),c=i(75518),d=(i(89704),i(5294),i(18423),i(96086),i(91813),i(21255),i(13078),i(21303),i(12627),i(56451),i(31521),i(23054),i(5077),i(23795),i(17902),i(87420),i(30161),i(81734),i(65595)),p=(i(77462),i(49403),i(10281),i(83930),i(66617),i(10628),i(59640),i(64451),i(6176),i(10454),i(28973)),m=i(87735),u=(i(2156),i(4038),i(49851),i(75054),i(15223),i(70169),i(29614),i(47207),i(70852),i(48103),i(39423),i(85681),i(18444),i(17581)),g=(i(42411),i(9767),i(38218),i(91914),i(86605),i(68196),i(440),i(46547),i(28927),i(6238),i(7299),i(4265)),h=i(85643),f=i(73801);const b=n.AH`.field-select-fixed{background-color:#f6f6f6;padding:6px;justify-content:space-between;align-items:center;color:#333;margin:0;transition:box-shadow .25s ease-in-out;box-shadow:0 0 0 1px #e0e0e0;height:auto;line-height:1.25;overflow-wrap:anywhere}.variable-date-date{width:100%}.variable-date-time{width:100%;margin-top:5px}.variable-field-radio,.to-flip-wrapper{display:flex;justify-content:space-between}.to-label{display:flex;align-items:center;margin-top:10px}.units-label{margin-top:6px}.to-field{margin-top:-10px}.from-field{margin-top:-8px;margin-bottom:6px}.units-select{margin-bottom:10px}`;class T extends f.WF{constructor(){super(...arguments),this.unitsNode=(0,h._)(),this.smartMappingState=(0,d.u)(),this.arcgisSmartMappingAgeChange=(0,f.lh)(),this.arcgisSmartMappingAgeError=(0,f.lh)()}static{this.properties={rendererSubtype:1}}static{this.styles=b}load(){const{fields:e}=this.smartMappingState,t=(0,o.g)(this.smartMappingState),i="color"===this.rendererSubtype?(0,o.p)(t,"color"):(0,o.p)(t,"size"),a=e.filter(e=>e.simpleFieldType===o.J.DATE&&e.layerField.name===i.field);this.restDateFields=e.filter(e=>e.simpleFieldType===o.J.DATE&&e!==a[0]),this.flowItemNode=(0,s.el)(this.el,"calcite-flow-item")}createRendererUpdateCall(e){const{smartMappingState:t}=this,i=(0,o.d)(t);let a;a="color-age"===i?p.b:"size-age"===i?m.e:"color-age-size"===i?u.c:"color-size-age"===i?u.a:u.b,(0,c.r)(a(t,e,this.rendererSubtype),this.flowItemNode).then(e=>{(0,o.a4)(t,e.renderer),this.requestUpdate(),this.arcgisSmartMappingAgeChange.emit()},e=>{this.rendererAgeFieldNode&&this.rendererAgeFieldNode.manager.component.requestUpdate();const{mapView:i}=this.smartMappingState,a=(0,o.g)(t),n="color"===this.rendererSubtype?(0,o.p)(a,"color"):(0,o.p)(a,"size"),{field:r,startTime:s,endTime:c}=n,d=n.units,p=s===r?c:s,m="string"==typeof p,u=["seconds","minutes","hours"].includes(d),g=m?void 0:(0,l.u)(p,i.timeZone),h=!m&&u?(0,l.b)(p,i.timeZone,"seconds"===d):void 0;this.datePickerNode&&g&&(this.datePickerNode.value=g),this.timePickerNode&&h&&(this.timePickerNode.value=h),this.unitsNode.value&&(this.unitsNode.value.value=d),this.requestUpdate(),this.arcgisSmartMappingAgeError.emit(e)})}attributeInputRefHandler(e){e&&(this.rendererAgeFieldNode=e)}inputDatePickerRefHandler(e){e&&(this.datePickerNode=e)}inputTimePickerRefHandler(e){e&&(this.timePickerNode=e)}handleUnitChange(e){const t={units:e.target.selectedOption.value};this.createRendererUpdateCall(t)}handleTypeChange(e){const{smartMappingState:t}=this,i=(0,o.g)(t),a="color"===this.rendererSubtype?(0,o.p)(i,"color"):(0,o.p)(i,"size"),{field:n,startTime:r}=a,s="field"===e?this.restDateFields?.[0]?.layerField.name:(new Date).getTime();this.createRendererUpdateCall(n===r?{endTime:s}:{startTime:s})}handleDateChange(){const{smartMappingState:e}=this,{mapView:t}=e,i=(0,o.g)(e),a="color"===this.rendererSubtype?(0,o.p)(i,"color"):(0,o.p)(i,"size"),n=this.datePickerNode?.value;if(!n)return;const r=this.timePickerNode?.value||"00:00:00",s=(0,l.d)(`${n}T${r}`,t.timeZone),{field:c,startTime:d}=a,p={};c===d?p.endTime=s:p.startTime=s,this.createRendererUpdateCall(p)}handleTimeChange(){const{smartMappingState:e}=this,{mapView:t}=e,i=(0,o.g)(e),a="color"===this.rendererSubtype?(0,o.p)(i,"color"):(0,o.p)(i,"size"),{field:n,startTime:r}=a,s=this.timePickerNode?.value,c=this.datePickerNode?.value,d=(0,l.d)(`${c}T${s}`,t.timeZone),p={};n===r?p.endTime=d:p.startTime=d,this.createRendererUpdateCall(p)}handleFlip(){const{smartMappingState:e}=this,t=(0,o.g)(e),i="color"===this.rendererSubtype?(0,o.p)(t,"color"):(0,o.p)(t,"size"),{startTime:a,endTime:n}=i,r={startTime:n,endTime:a};this.createRendererUpdateCall(r),this.createRendererUpdateCall(r)}render(){return n.qy`${this.renderFrom()}${this.renderTo()}${this.renderUnits()}`}renderFrom(){const{smartMappingState:e}=this,{_messages:t}=e,i=(0,o.g)(e),a="color"===this.rendererSubtype?(0,o.p)(i,"color"):(0,o.p)(i,"size"),{field:r,startTime:s}=a;return n.qy`<calcite-label>${t.age.from}</calcite-label><div class="from-field">${r===s?this.renderStaticField():this.renderAgeField()}</div>`}renderTo(){const{smartMappingState:e}=this,{_messages:t}=e,i=(0,o.g)(e),a="color"===this.rendererSubtype?(0,o.p)(i,"color"):(0,o.p)(i,"size"),{field:r,endTime:s}=a;return n.qy`<calcite-label><div class="to-flip-wrapper"><div class="to-label">${t.age.to}</div><arcgis-map-config-smart-mapping-action hide-outline .text=${t.age.flip} icon=arrowUpDown @click=${()=>this.handleFlip()}></arcgis-map-config-smart-mapping-action></div></calcite-label><div class="to-field">${r===s?this.renderStaticField():this.renderAgeField()}</div>`}renderStaticField(){const{smartMappingState:e}=this,t=(0,o.g)(e),i="color"===this.rendererSubtype?(0,o.p)(t,"color"):(0,o.p)(t,"size"),a=(0,o.K)(e,i.field);return n.qy`<div class="field-select-fixed">${a?.label}</div>`}renderAgeField(){const{smartMappingState:e}=this,{_messages:t}=e,i=(0,o.g)(e),a="color"===this.rendererSubtype?(0,o.p)(i,"color"):(0,o.p)(i,"size"),{field:s,startTime:l,endTime:c}=a,d=l===s?c:l,p="string"==typeof d,m=this.restDateFields?.[0]?.layerField.alias||this.restDateFields?.[0]?.layerField.name;let u;return p&&(u={field:d,simpleFieldType:o.J.DATE}),n.qy`<div>${this.restDateFields?.length?n.qy`<calcite-radio-button-group class="variable-field-radio" name=variableType @calciteRadioButtonGroupChange=${e=>this.handleTypeChange(e.target.selectedItem.value)}><calcite-label layout=inline>${(0,r.D)(p?`age-variable-radio-field-${Math.random()}`:void 0,n.qy`<calcite-radio-button .checked=${p} value=field></calcite-radio-button>`)}${t.age.field}</calcite-label><calcite-label layout=inline>${(0,r.D)(p?void 0:`age-variable-radio-date-${Math.random()}`,n.qy`<calcite-radio-button .checked=${!p} value=date></calcite-radio-button>`)}${t.age.customDate}</calcite-label></calcite-radio-button-group>`:null}${p?this.restDateFields?.length&&this.restDateFields?.length>1?n.qy`<arcgis-map-config-smart-mapping-attribute-input .fieldList=${this.restDateFields} .selectedField=${u} mode=simple hide-label .popoverReferenceElement=${this.flowItemNode} @arcgisSmartMappingAttributeInputChange=${e=>{if(e.detail){const t=e.detail.field;this.createRendererUpdateCall(s===l?{endTime:t}:{startTime:t})}}} ${(0,h.K)(this.attributeInputRefHandler)}></arcgis-map-config-smart-mapping-attribute-input>`:n.qy`<div class="field-select-fixed">${m}</div>`:this.renderAgeFieldDate()}</div>`}renderUnits(){const{smartMappingState:e}=this,{_messages:t}=e,i=(0,o.g)(e),a=("color"===this.rendererSubtype?(0,o.p)(i,"color"):(0,o.p)(i,"size")).units;return n.qy`<calcite-label class="units-label">${t.age.units}<calcite-select class="units-select" width=full .label=${t.age.units} @calciteSelectChange=${this.handleUnitChange} .value=${a} ${(0,h.K)(this.unitsNode)}><calcite-option value=seconds .label=${t.age.seconds} .selected=${"seconds"===a}></calcite-option><calcite-option value=minutes .label=${t.age.minutes} .selected=${"minutes"===a}></calcite-option><calcite-option value=hours .label=${t.age.hours} .selected=${"hours"===a}></calcite-option><calcite-option value=days .label=${t.age.days} .selected=${"days"===a}></calcite-option><calcite-option value=months .label=${t.age.months} .selected=${"months"===a}></calcite-option><calcite-option value=years .label=${t.age.years} .selected=${"years"===a}></calcite-option></calcite-select></calcite-label>`}renderAgeFieldDate(){const{smartMappingState:e}=this,{mapView:t}=e,i=(0,o.g)(e),a="color"===this.rendererSubtype?(0,o.p)(i,"color"):(0,o.p)(i,"size"),{field:r,startTime:s,endTime:c}=a,d=a.units,p=s===r?c:s,m="string"==typeof p,u=m?void 0:(0,l.u)(p,t.timeZone),f=["seconds","minutes","hours"].includes(d),b=!m&&f?(0,l.b)(p,t.timeZone,"seconds"===d):void 0;return n.qy`<calcite-input-date-picker .value=${u} overlay-positioning=fixed class="variable-date-date" @calciteInputDatePickerChange=${()=>this.handleDateChange()} ${(0,h.K)(this.inputDatePickerRefHandler)}></calcite-input-date-picker>${f?n.qy`<calcite-input-time-picker .step=${"seconds"===d?1:60} .value=${b} overlay-positioning=fixed class="variable-date-time" @calciteInputTimePickerChange=${(0,g.d)(()=>{this.timePickerNode&&(this.timePickerNode.open=!1),this.handleTimeChange()},750)} ${(0,h.K)(this.inputTimePickerRefHandler)}></calcite-input-time-picker>`:null}`}}(0,a.c)("arcgis-map-config-smart-mapping-age",T)},4265:(e,t,i)=>{i.d(t,{a:()=>n,d:()=>a,t:()=>r});const a=(e,t)=>{let i,a="idle";const n=async(...n)=>await new Promise(r=>{switch(a){case"flushed":a="idle",i?(clearTimeout(i),r(e(...n))):r(null);break;case"invoked":clearTimeout(i),a="idle",r(e(...n));break;case"cancelled":clearTimeout(i),a="idle",r(null);break;default:i&&clearTimeout(i),a="pending",i=setTimeout(()=>{a="idle",r(e(...n))},t)}});return n.flush=async function(...e){return a="flushed",await n(...e)},n.invoke=async function(...e){return a="invoked",await n(...e)},n.cancel=async function(...e){return a="cancelled",await n(...e)},n.getStatus=function(){return a},n},n=(e,t)=>{let i;return async(...a)=>await new Promise(n=>{i||(i=setTimeout(()=>{clearTimeout(i),i=void 0,n(e(...a))},t))})};function r(e){return new Promise(t=>setTimeout(t,e))}},62052:(e,t,i)=>{i.d(t,{a:()=>n,b:()=>s,d:()=>l,u:()=>r});var a=i(52797);function n(e,t){e.labelFormatFunction=e=>o(e,t,"short-date"),e.inputFormatFunction=e=>o(e,t,"short-date"),e.inputParseFunction=e=>function(e,t){if(!e)return e;let i;if(t&&"system"!==t)if("unknown"===t)i=e;else{const a=new Date;i=e+(new Date(a.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(a.toLocaleString("en-US",{timeZone:t})).getTime())}else i=e+6e4*(new Date).getTimezoneOffset();return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(i).toISOString()),i}(Date.parse(e),t)}function r(e,t){let i;if(t&&"system"!==t)if("unknown"===t)i=new Date(e).toISOString();else{const a=(new Date).getTimezoneOffset(),n=new Date(e).toLocaleString("en-US",{timeZone:t});i=new Date(new Date(n).getTime()-6e4*a).toISOString()}else{const t=(new Date).getTimezoneOffset();i=new Date(e-6e4*t).toISOString()}return i}function s(e,t,i){let a;if(t&&"system"!==t)if("unknown"===t)a=new Date(e).toISOString();else{const i=(new Date).getTimezoneOffset(),n=new Date(e).toLocaleString("en-US",{timeZone:t});a=new Date(new Date(n).getTime()-6e4*i).toISOString()}else{const t=(new Date).getTimezoneOffset();a=new Date(e-6e4*t).toISOString()}return a=i?a.substring(11,19):a.substring(11,16),a}function l(e,t){let i,a=new Date(e);if(a=new Date(a.getTime()-6e4*a.getTimezoneOffset()),t&&"system"!==t)if("unknown"===t)i=a.getTime();else{const e=new Date(a.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(a.toLocaleString("en-US",{timeZone:t})).getTime();i=a.getTime()+e}else{const e=(new Date).getTimezoneOffset();i=a.getTime()+6e4*e}return i}function o(e,t,i){let n;return n="unknown"===t?a.formatDate(e,{...a.convertDateFormatToIntlOptions(i),timeZone:"utc",timeZoneName:"shortOffset"}):a.formatDate(e,{...a.convertDateFormatToIntlOptions(i),timeZone:t}),n}},75518:(e,t,i)=>{let a,n;function r(e){e.loading=!1}async function s(e,t){return function(e){e.loading=!0,n=!1,a&&clearTimeout(a),a=setTimeout(()=>{r(e),n=!0},6e4)}(t),await e.then(e=>{if(r(t),n)throw new Error("timeout");return e}).catch(e=>{throw r(t),e})}i.d(t,{r:()=>s})}}]);