/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-6c2324.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-6c2324"],{16153:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigSymbolPicker:()=>Le});var s=i(73679),r=i(46317),o=i(56451),a=i(89779),l=i(83595),n=i(96729),c=i(69683),m=i(21236),u=i(41631),d=i(9316),y=i(7923),h=i(76361),p=i(55448),g=i(4395),b=i(85643),f=i(73801),S=i(66228),v=i(55535),w=i(83552),_=i(36486),I=i(47640),C=i(16161);const E=[0,0,0,0];function $(e){return{authMode:"public"===e.access?"anonymous":"auto"}}const x=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Triangle",type:"esriSMS",style:"esriSMSTriangle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],k=[{type:"esriSLS",color:[0,0,0,255],width:.75,style:"esriSLSSolid"}],T=[{type:"esriSFS",color:[0,0,0,64],outline:{type:"esriSLS",color:[0,0,0,255],width:.75,style:"esriSLSSolid"},style:"esriSFSSolid"}],F=10,q=5;async function A(e,t,i,s){try{await u.renderPreviewHTML(t,{node:e,...i})}catch{e.appendChild(P(s))}return e}function P(e){const t=document.createElement("span");return t.setAttribute("alt",""),t.innerHTML=e,t}function O(e="2d"){return{async getEsriSymbol(t){const{data:i,parentData:s,portalItem:r}=t,a=await async function(e,t,i,s){const r=function(e){for(const t of e.typeKeywords)if(/^Esri.*Style$/u.test(t)&&"Esri Style"!==t)return t}(i);let o=null;r||(o=`${i.itemUrl}/data`);const a={data:e,baseUrl:i.itemUrl,styleName:r,styleUrl:o},{portal:l}=i;return await y.fetchSymbolFromStyle(a,t,{portal:l},s,h.symbolUrlFromStyleItem,$(i))}(s,i.name,r,s.cimVersion&&"2d"===e?"cimRef":"webRef");return"point-3d"===a.type&&a.symbolLayers.forEach(e=>{if(e.material?.color)if("icon"===e.type){const t=null!=e.material?e.material:{};t.color=c.defaultThematicColor.clone(),e.material=t}else if("object"===e.type){const t=null!=e.material?e.material:{};t.color=t.color||function(e,t=!1){const i=e?E:void 0;return t?o.default.fromJSON(i):new o.default(i)}([255,255,255]),e.material=t}}),a},getThumbnail:async e=>await async function(e){const t=e.data;let i=t.thumbnail?.href;const s=t.thumbnail?.imageData,r=t.title||e._messages?.symbolSources.noTitle,o=document.createElement("div"),n=!!t.cimRef,c=function(e){const t=e.formats?.includes("web3d"),i=e.formatInfos?.some(e=>"gltf"===e.type||"gltf_basisu"===e.type);return t||i}(t),u={size:c&&"volumetric"===t.dimensionality?42:24,disableUpsampling:!1};if(n&&!c){const t=await e.getEsriSymbol();if(!(0,a.e)(t))return(0,a.h)(t)&&delete u.size,await A(o,t,u,r)}if(m.isDevEnvironment(globalThis.location.hostname)&&(i=m.adjustStaticAGOUrl(i)),!i&&!s)return o.appendChild(P(r)),o;const d=new l.default({name:t.name,styleUrl:`${e.portalItem.itemUrl}/data`,thumbnail:{url:s?`data:image/jpeg;base64, ${s}`:p.makeAbsolute(i,e.portalItem.itemUrl)}});return await A(o,d,u,r)}(e)}}const N={getEsriSymbol:async e=>n.fromJSON(e.data),async getThumbnail(e){const t=await e.getEsriSymbol(),i={size:"line"===(0,a.g)(t)?{width:24}:24};return await u.renderPreviewHTML(t,i)}},L={getEsriSymbol:async e=>n.fromJSON(e.data),async getThumbnail(e){const t=await e.getEsriSymbol();return await u.renderPreviewHTML(t,{size:38})}},U=Function.prototype;class R{constructor({data:e,parentData:t,portalItem:i,strategy:s,_messages:r}){this.data=e,this.parentData=t,this.portalItem=i,this.strategy=s,this._messages=r}async getEsriSymbol(){if(!this._symbol){const e=this._symbolRequest||(this._symbolRequest=this.strategy?.getEsriSymbol(this));this._symbol=await e}return this._symbol.clone()}async getThumbnail(e){if(this._thumbnail)return e.appendChild(this._thumbnail),U;const t=this._thumbnailRequest||(this._thumbnailRequest=this.strategy?.getThumbnail(this));return this._thumbnail=await t,()=>this._thumbnail&&e.appendChild(this._thumbnail)}}class M{constructor({portalItem:e,_messages:t,symbolType:i}){this.symbolType="2d",this.portalItem=e,this._messages=t,i&&(this.symbolType=i)}get data(){return this._data}get id(){return this.portalItem?.id}get keywords(){return this.portalItem?.typeKeywords||[]}get name(){return this.portalItem?.name}get title(){return this.portalItem?.title}async fetchData(e){if(d.isAborted(e))throw d.createAbortError();return this._data||(this._data=await this.portalItem.fetchData("json",{...e,...$(this.portalItem)})),this._data}}class D extends M{constructor(){super(...arguments),this.type="symbol-set"}async getItems(e){if(d.isAborted(e))throw d.createAbortError();if(!this._items){const t=await this.fetchData(e);this._items=t.map(e=>new R({data:e,parentData:t,portalItem:this.portalItem,strategy:N,_messages:this._messages}))}return this._items}}class G extends M{constructor(){super(...arguments),this.type="web-style"}async getItems(e){if(d.isAborted(e))throw d.createAbortError();if(!this._items){const t=await this.fetchData(e);this._items=t.items.map(e=>new R({data:e,parentData:t,portalItem:this.portalItem,strategy:O(this.symbolType),_messages:this._messages}))}return this._items}}class V{constructor({_messages:e}){this.id="",this.keywords=[],this.name="Basic",this.type="symbol-set",this.title=e.symbolSources.basic}async getItems(e){if(d.isAborted(e))throw d.createAbortError();return this._items||(this._items=this.data.map(e=>new R({data:e,strategy:N,_messages:this._messages}))),this._items}}const j="basic-symbol-set:point",J="basic-symbol-set:line",H="basic-symbol-set:polygon";class z extends V{constructor(){super(...arguments),this.data=x,this.id=j,this.keywords=["Point"]}}class Q extends V{constructor(){super(...arguments),this.data=k,this.id=J,this.keywords=["Line"]}}class B extends V{constructor(){super(...arguments),this.data=T,this.id=H,this.keywords=["Polygon"]}}class W{constructor({_messages:e}){var t;this.keywords=["3d"],this.id="basic-web-style:flat",this.name="Basic",this.type="web-style",this.data={items:(t=e,[{title:t.symbolSources.circle,name:"Circle",primitive:"circle"},{title:t.symbolSources.square,name:"Square",primitive:"square"},{title:t.symbolSources.cross,name:"Cross",primitive:"cross"},{title:t.symbolSources.x,name:"X",primitive:"x"},{title:t.symbolSources.kite,name:"Kite",primitive:"kite"},{title:t.symbolSources.triangle,name:"Triangle",primitive:"triangle"}].map(e=>({dimensionality:"flat",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:e.primitive},material:{color:c.defaultThematicColor},outline:{color:[0,0,0]}}]})))},this.title=e.symbolSources.basic}async getItems(e){if(d.isAborted(e))throw d.createAbortError();return this._items||(this._items=this.data.items.map(e=>new R({data:e,strategy:N,_messages:this._messages}))),this._items}}class K{constructor({_messages:e}){var t;this.id="basic-web-style:volumetric",this.keywords=["3d","volumetric"],this.name="Basic",this.type="web-style",this.data={items:(t=e,[{title:t.symbolSources.sphere,name:"Sphere",primitive:"sphere"},{title:t.symbolSources.tallCylinder,name:"Tall_Cylinder",primitive:"cylinder",mixins:{width:q,height:F,depth:q}},{title:t.symbolSources.cylinder,name:"Cylinder",primitive:"cylinder"},{title:t.symbolSources.tallCube,name:"Tall_Cube",primitive:"cube",mixins:{width:q,height:F,depth:q,anchor:"bottom"}},{title:t.symbolSources.cube,name:"Cube",primitive:"cube"},{title:t.symbolSources.tallCone,name:"Tall_Cone",primitive:"cone",mixins:{width:q,height:F,depth:q}},{title:t.symbolSources.cone,name:"Cone",primitive:"cone"},{title:t.symbolSources.invertedCone,name:"Inverted_Cone",primitive:"invertedCone"},{title:t.symbolSources.diamond,name:"Diamond",primitive:"diamond"},{title:t.symbolSources.tetrahedron,name:"Tetrahedron",primitive:"tetrahedron"}].map(e=>({dimensionality:"volumetric",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[{type:"Object",resource:{primitive:e.primitive},...e.mixins}]})))},this.title=e.symbolSources.basic}async getItems(e){if(d.isAborted(e))throw d.createAbortError();return this._items||(this._items=this.data.items.map(e=>new R({data:e,parentData:this.data,strategy:L,_messages:this._messages}))),this._items}}const Z="marker-item",Y="calcite-mode-dark",X=({item:e,index:t,observer:i})=>{const s=e.data.title?g.qy`<calcite-tooltip .referenceElement=${e.data.name}>${e.data.title}</calcite-tooltip>`:null;return g.qy`<span class=${`${Z} ${Y}`} id=${e.data.name??f.s6} slot=thumbnail ${(0,b.K)(s=>{if(!s)return;const r=s;r.item||(r.item=e,r.index=t,i.observe(s))})}>${s}</span>`};async function ee(e,t,i){return i?[]:await async function(e){return await oe({portal:e,queries:{group:e.symbolSetsGroupQuery,item:'type:"Symbol Set" AND (typekeywords:"by value" AND typekeywords:"marker")'}}).then(ae)}(e).then(e=>e.map(e=>new D({portalItem:e,_messages:t})))}async function te(e,t,i){return await async function(e,t){const i="2d"===t?e.stylesGroupQuery2d:e.stylesGroupQuery3d;return i?await oe({portal:e,queries:{group:i,item:'type:"Style"'}}).then(ae):[]}(e,t).then(e=>e.map(e=>new G({portalItem:e,symbolType:t,_messages:i})))}async function ie(e,t,i,s){return s?.length?await async function(e,t){let i="",s="";return t.forEach(e=>{i+=`${s}id:${e}`,s=" OR "}),await oe({portal:e,queries:{item:i}})}(e,s).then(e=>e.map(e=>new G({portalItem:e,symbolType:t,_messages:i}))):[]}function se(e,t){return"flat"===e?new W({_messages:t}):new K({_messages:t})}function re(e,t){const i={_messages:e};return"line"===t?new Q(i):"polygon"===t?new B(i):new z(i)}async function oe(e){const t=e.portal,i=e.queries.group,s=e.queries.item;if(i){const{results:e}=await t.queryGroups({query:i,disableExtraQuery:!0});if(0===e.length)return[];const[r]=e;return(await r.queryItems({query:s,disableExtraQuery:!0,num:100,sortField:r.sortField})).results}return(await t.queryItems({query:s,disableExtraQuery:!0,num:100})).results}function ae(e){const t=[];return e.forEach(e=>{!function(e,t){return e.typeKeywords.includes(t)}(e,"default")?t.push(e):t.unshift(e)}),t}const le="pointSymbol",ne="lineSymbol",ce="polygonSymbol",me=e=>!!e.portal;async function ue(e,t){return await Promise.all(e.map(t)).then(t=>e.filter((e,i)=>t[i]))}async function de(e,t,i,s,r,o){const l=ve(i),n="2d"===r?function(e,t){function i(i){if(t.includes("all"))return!0;const{data:s}=i,{dimensionality:r,type:o}=s;if("volumetric"===r)return!1;if("point"===e&&(t.includes("picture")&&"esriPMS"===o||t.includes("simple")&&"esriSMS"===o)||"line"===e&&t.includes("simple")&&"esriSLS"===o||"polygon"===e&&t.includes("simple")&&"esriSFS"===o)return!0;const{formats:a}=s;return!(!Se(t)||!Se(a))}return async function(s,r){const o="point"===e?a.f:"line"===e?a.h:a.e;if(!i(s))return!1;const l=t.includes("cim:picture"),n=t.includes("cim:vector"),c=l&&n||!l&&!n,m=he(r)&&!ge(r)&&!be(r),u=ge(r)&&!he(r)&&!be(r),d=be(r)&&!he(r)&&!ge(r),y="line"===e?ne:"polygon"===e?ce:le;if((m||u||d)&&c||"web-style"!==r.type||s.data.itemType===y)return!0;const h=await s.getEsriSymbol();return!(0,a.i)(h)||o(h)}}(s,l):function(e){return async function(t){if(e.includes("all")||e.includes("3d"))return!0;const{data:{dimensionality:i}}=t;return e.includes("3d:flat")&&"flat"===i||e.includes("3d:volumetric")&&"volumetric"===i}}(l);return await ue(t,async t=>o?await o(t,e,n):await n(t,e))}const ye={point:"Point",line:"Line",polygon:"Polygon"};function he({keywords:e}){return e.includes(ye.point)||e.includes("pointSymbol")}function pe({keywords:e}){return e.includes("marker")}function ge({keywords:e}){return e.includes(ye.line)||e.includes("lineSymbol")}function be({keywords:e}){return e.includes(ye.polygon)||e.includes("polygonSymbol")}async function fe(e,t,i,s,r){const o=ve(t),a="2d"===s?function(e,t){return async i=>{const s=i.keywords.includes("3d"),r=i.keywords.includes("Dictionary"),o="point"===e?he(i)||pe(i):"line"===e?ge(i):be(i),a=he(i)||pe(i)||ge(i)||be(i);if(s||r||!o&&a)return!1;if(t.includes("all"))return!0;function l(){return"point"===e?j:"line"===e?J:H}const n=l();return!!(t.includes("picture")&&i.id!==n&&"symbol-set"===i.type||t.includes("simple")&&i.id===n||Se(t)&&"web-style"===i.type)}}(i,o):function(e){const t={EsriThematicShapesStyle:!0};return async i=>{if(i.keywords.every(e=>!t[e])&&"web-style"===i.type&&(e.includes("all")||e.includes("3d")))return!0;if(function(e){return"portalItem"in e}(i)){const t=await i.fetchData(),[s]=t.items,{dimensionality:r}=s;return e.includes("3d:flat")&&"flat"===r||e.includes("3d:volumetric")&&"volumetric"===r}return e.includes("3d:flat")&&"basic-web-style:flat"===i.id||e.includes("3d:volumetric")&&"basic-web-style:volumetric"===i.id}}(o);return await ue(e,async e=>r?await r(e,a):await a(e))}function Se(e){return Array.isArray(e)&&e.some(e=>e.includes("cim"))}function ve(e="all"){const t=Array.isArray(e)?e:[e];return t.find(e=>"cim"===e&&t.find(e=>e.includes("cim:")))?t.filter(e=>!e.includes("cim:")):t}async function we(e,t,i,s,r,o,a){const l={};t&&await t(e,l),await e.load();const n=await("2d"===r?async function(e,t,i,s){const r=e.symbolSetsGroupQuery;e.symbolSetsGroupQuery='owner:esri AND title:"Map Viewer Beta Symbols"';const[o,a,l]=await Promise.all([ee(e,t,s),te(e,"2d",t),ie(e,"2d",t,i)]),n=e=>e.keywords.every(e=>"Basic"!==e),c=s?[...o.filter(n),...a.filter(n),...l.filter(n)]:[re(t,"point"),re(t,"line"),re(t,"polygon"),...o.filter(n),...a.filter(n),...l.filter(n)];return e.symbolSetsGroupQuery=r,c}(e,s,o,a):async function(e,t){const[i]=await Promise.all([te(e,"3d",t)]),s=e=>e.keywords.every(e=>"Basic"!==e);return[se("flat",t),se("volumetric",t),...i.filter(s)]}(e,s));return i&&await i(e,l),n}const _e=g.AH`:host,.arcgis-map-config-symbol-picker__container{display:flex;flex:1 1 auto;flex-flow:column nowrap;align-items:stretch;arcgis-map-config-item-palette .item-palette{gap:8px}calcite-notice:first-of-type{margin:auto 0 0}calcite-label{margin:16px 12px 0}calcite-panel{overflow:visible}}.section{display:flex;flex-direction:column;background-color:var(--calcite-color-foreground-1)}.categories{display:flex;align-content:normal}.categories-center-action{padding:0 5px}.marker-selection{padding:8px}.symbol-div{padding:0 8px}.marker-source-select{width:calc(100% - 74px);display:block}.marker-source-select[hidden]+.marker-selection{border-top:1px solid lightgray;background-color:var(--calcite-color-foreground-1)}.empty-category-content{display:flex;align-items:center;justify-content:center}.empty-filter{display:flex;align-items:center;justify-content:center;padding:8px}.incompatible-symbols-notice{margin:8px 0}.marker-item{[slot=thumbnail]>div{margin:8px 10px;display:flex;justify-content:center;align-items:center}}.item-palette{width:100%;display:flex;flex-direction:column}.file-upload{margin-top:20px;width:auto}.remove-button{padding:10px 0}.scroller{max-height:var(--scroller-max-height, min(100vh - 380px, 320px));overflow-y:auto;min-width:200px;overflow-x:hidden;display:flex;justify-content:center}`,Ie="arcgis-symbol-styler-storage-styles",Ce="arcgis-map-config-symbol-picker__container",Ee="incompatible-symbols-notice",$e="empty-category-content",xe="marker-source-select",ke="marker-selection",Te="scroller",Fe="item-palette",qe="file-upload",Ae="categories",Pe="categories-center-action",Oe="symbol-div",Ne="empty-filter";class Le extends f.WF{constructor(){super(),this._direction=(0,w.jH)(),this._messages=(0,_.u)({blocking:!0}),this.allCustomFileInfos=[],this.customSymbolsStorageId="arcgis-symbol-picker-custom-symbols",this.itemPaletteNode=(0,b._)(),this.actionEls=[],this._initialized=!1,this._loaded=!1,this._propWatcherTask=new I.YZ(this,{task:async([e,t])=>{if(!(0,S.i)(e)||!(0,S.i)(t))throw console.error("[arcgis-map-config-symbol-picker] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.symbol,this.portal]}),this.isGridView=!0,this.displayEmptyFilterMsg=!1,this.hideHeader=!1,this.symbolType="2d",this.itemsPerRow=4,this.hideSvgUploadSymbols=!1,this.hideClassicSymbols=!1,this.arcgisActiveSourceIdChange=(0,f.lh)(),this.arcgisActiveSourceItemsChange=(0,f.lh)(),this.arcgisActiveSymbolChange=(0,f.lh)(),this.arcgisActiveSymbolItemChange=(0,f.lh)(),this.arcgisSymbolSourcesChange=(0,f.lh)(),this.listenOn(window,"arcgisSymbolPickerFileUploadChange",this.handleFileUploadChange),this.listenOn(window,"arcgisSymbolPickerFileUploadInvalidFile",this.handleInvalidFile),this.listenOn(window,"arcgisSymbolPickerFileUploadError",this.handleFileUploadError)}static{this.properties={_activeSourceId:16,_symbolSources:16,_activeSymbolItems:16,customSymbolError:16,isGridView:16,displayEmptyFilterMsg:16,_activeSymbolFetch:16,symbol:0,portal:0,symbolFilter:1,activeSourceId:1,activeSymbolItem:0,hideHeader:5,symbolType:1,customSymbolItemFilter:0,customSymbolSourceFilter:0,itemsPerRow:9,symbolSources:0,activeSymbolItems:0,hideSvgUploadSymbols:5,hideClassicSymbols:5}}static{this.styles=_e}get editGeometry(){return(0,a.g)(this.symbol)}async getStyleItemIds(){return this._symbolSources.filter(e=>"web-style"===e.type).map(e=>e.id)}connectedCallback(){super.connectedCallback(),this.setUpSymbolIntersectionObserver(),this._activeSymbolFetch?.controller.abort(),this._sourcesFetchController?.abort()}async willUpdate(e){if(e.has("_activeSourceId")&&this._activeSourceId)if("custom-symbol-set"===this._activeSourceId)this._setupCustomSymbols();else{const e=this._symbolSources?.find(({id:e})=>e===this._activeSourceId);e&&await this._fetchAndSetUpSymbolItems(e)}}updated(){this._propWatcherTask.status===I.e1.COMPLETE&&this._initialized&&!this._loaded&&(this._loaded=!0,this._symbolSources||this._fetchSources(),this._getCustomSymbolsFromStorage())}disconnectedCallback(){super.disconnectedCallback(),this.tearDownSymbolIntersectionObserver()}async init(){const e=(0,a.g)(this.symbol),t=(0,v.g)(Ie,!0)||{};this.savedStyleIds=t?.[e]||[],this._initialized=!0}async handleFileUploadChange({detail:e}){const t=e,i=t.cim&&JSON.stringify(t.cim.toJSON());if(t.dataURL&&t.dataURL.length>2e5)return void(this.customSymbolError="too-large");if(t.cim&&i&&i.length>2e5)return void(this.customSymbolError="too-large");this.customSymbolError=void 0;const s=this.allCustomFileInfos.find(e=>t.dataURL&&e.dataURL&&e.dataURL===t.dataURL&&e.fileName===t.fileName||t.cim&&e.cim&&e.fileName===t.fileName&&i===JSON.stringify(e.cim.toJSON()));try{let e;if(s)e=this._activeSymbolItems?.find(e=>e.data.name===s.fileName);else{const i=[...this.allCustomFileInfos,t];(0,v.s)(this.customSymbolsStorageId,i.map(e=>e.dataURL?e:{...e,cim:JSON.stringify(e.cim?.toJSON())}),!0),this.allCustomFileInfos=i,this._setupCustomSymbols(),e=this._activeSymbolItems?.[this._activeSymbolItems.length-1]}this.activeSymbolItem=e,this.arcgisActiveSymbolItemChange.emit(e);const i=await(this.activeSymbolItem?.getEsriSymbol());this.arcgisActiveSymbolChange.emit(i),setTimeout(()=>requestAnimationFrame(()=>{this.itemPaletteNode.value?.setFocus(),this.updateListSelection()}),1)}catch{this.customSymbolError="storage-full"}}handleInvalidFile(){this.customSymbolError="invalid-file"}handleFileUploadError(){this.customSymbolError="error"}_onSymbolSourceChange(e){const t=e.currentTarget,{selectedItems:i}=t,s=i.find(e=>e.getAttribute("data-value")!==this._activeSourceId);this._activeSourceId=s?.getAttribute("data-value")||this._activeSourceId,t.querySelectorAll("calcite-dropdown-item").forEach(e=>{e!==s&&(e.selected=!1)}),e.stopPropagation(),this.displayEmptyFilterMsg=!1}_setupCustomSymbols(){const e=this.allCustomFileInfos.map(e=>{let t=24,i=24;if(e.width>e.height?i=Math.round(t/e.width*e.height):e.width<e.height&&(t=Math.round(i/e.height*e.width)),e.dataURL){const s=e.fileName.split(".")[1].toLowerCase();return new R({data:{angle:0,contentType:"png"===s?"image/png":"gif"===s?"image/gif":"image/jpeg",height:i,imageData:e.dataURL.split(",")[1],name:e.fileName,type:"esriPMS",url:void 0,width:t,xoffset:0,yoffset:0},parentData:null,portalItem:void 0,strategy:N,_messages:this._messages})}return new R({data:{symbol:e.cim,name:e.fileName},parentData:{cimVersion:"2.6.0"},portalItem:void 0,strategy:{getEsriSymbol:async e=>e.data.symbol,async getThumbnail(e){const t=document.createElement("div");return await A(t,e.data.symbol,{size:24,disableUpsampling:!1},e.data.title)}},_messages:this._messages})});this.setUpSymbolIntersectionObserver(),this.customSymbolError=void 0,this._activeSymbolFetch=null,this._activeSymbolItems=e,this.arcgisActiveSourceIdChange.emit("custom-symbol-set"),this.arcgisActiveSourceItemsChange.emit(e.map(e=>new R({...e})))}async _fetchAndSetUpSymbolItems(e){this._activeSymbolFetch&&this._activeSymbolFetch.controller.abort();const t=new AbortController,i=t.signal;this._activeSymbolFetch={controller:t,id:e.id};const s=!this._activeSymbolItems&&this.activeSymbolItems||await e.getItems(t);if(i?.aborted)return;const r=await de(e,s,this.symbolFilter,this.editGeometry,this.symbolType,this.customSymbolItemFilter);i?.aborted||(this.setUpSymbolIntersectionObserver(),this.customSymbolError=void 0,this._activeSymbolFetch=null,this._activeSymbolItems=r,this.arcgisActiveSourceIdChange.emit(this._activeSourceId),this.arcgisActiveSourceItemsChange.emit(r.map(e=>new R({...e}))))}tearDownSymbolIntersectionObserver(){this._symbolIntersectionObserver?.disconnect(),this._symbolIntersectionObserver=void 0}setUpSymbolIntersectionObserver(){this.tearDownSymbolIntersectionObserver();let e=0;const t={};this._symbolIntersectionObserver=new IntersectionObserver((i,s)=>{function r(){e++,t[e]&&(t[e](),delete t[e],r())}i.forEach(i=>{if(!i.isIntersecting)return;const o=i.target;o.item.getThumbnail(o).then(i=>{o.index===e?(i(),r()):t[o.index]=i}),o.item.getEsriSymbol(),s.unobserve(o)})})}async _fetchSources(){this._sourcesFetchController&&this._sourcesFetchController.abort(),this._sourcesFetchController=new AbortController;const e=this._sourcesFetchController.signal,t=this.portal,i=me(t)?t.portal:t,s=me(t)?t.before:null,r=me(t)?t.after:null,o=i?this.symbolSources||await we(i,s,r,this._messages,this.symbolType,this.savedStyleIds,this.hideClassicSymbols):[];if(e?.aborted)return;this._symbolSources=await fe(o,this.symbolFilter,(0,a.g)(this.symbol),this.symbolType,this.customSymbolSourceFilter);const l=this._symbolSources.filter(e=>this.savedStyleIds?.includes(e.id));if(l.length!==this.savedStyleIds?.length){const e=l.map(e=>e.id),t=this.savedStyleIds?.filter(t=>!e.includes(t));this.savedStyleIds=e,this.removeStyleIds(t)}if(this.arcgisSymbolSourcesChange.emit(this._symbolSources),!this._activeSourceId){let e=this.activeSourceId;e&&(this._symbolSources.find(e=>e.id===this.activeSourceId)||(e=void 0)),this._activeSourceId=e||this._symbolSources[0].id}}_getCustomSymbolsFromStorage(){if("3d"===this.symbolType||"point"!==this.editGeometry)return;const e=(0,v.g)(this.customSymbolsStorageId,!0);e&&(this.allCustomFileInfos=e.map(e=>e.dataURL?e:{...e,cim:C.default?.fromJSON(JSON.parse(e.cim))}))}listRefHandler(e){e&&queueMicrotask(()=>{e.querySelectorAll(".list-item-div").forEach(e=>{if(e){const t=Number.parseInt(e.getAttribute("data-value")),i=this._activeSymbolItems?.[t];i&&(i.getThumbnail(e).then(e=>e()),i.getEsriSymbol())}}),e.querySelectorAll(".list-item-action").forEach(e=>{if(e){const t=Number.parseInt(e.getAttribute("data-value"));this.actionEls[t]=e}})})}updateListSelection(){this.el.querySelectorAll("CALCITE-LIST-ITEM").forEach(e=>{e.selected=e.value===this.activeSymbolItem?.data.name,e.selected&&e.setFocus()})}removeCustomSymbol(e){this.allCustomFileInfos.splice(e,1),(0,v.s)(this.customSymbolsStorageId,this.allCustomFileInfos.map(e=>e.dataURL?e:{...e,cim:JSON.stringify(e.cim?.toJSON())})),this._setupCustomSymbols(),this.activeSymbolItem=void 0}addTooltip(e){this.removeTooltip(),this.tooltipEl=(0,f.dN)(g.qy`<calcite-tooltip .placement=${e.placement||"auto"} .referenceElement=${e.referenceElement} overlay-positioning=fixed .innerHTML=${e.innerHTML??""} open></calcite-tooltip>`),this.el.parentElement?.appendChild(this.tooltipEl)}removeTooltip(){this.tooltipEl?.parentNode&&(this.tooltipEl.remove(),this.tooltipEl=void 0)}removeStyle(){this.savedStyleIds=this.savedStyleIds?.filter(e=>e!==this._activeSourceId),this._activeSourceId&&this.removeStyleIds([this._activeSourceId]),this._activeSourceId=this.savedStyleIds?.[0]||this._symbolSources?.[0].id}removeStyleIds(e){const t=(0,v.g)(Ie,!0)||{};let i=t.point||[];i=i.filter(t=>!e?.includes(t)),t.point=i.length?i:void 0;let s=t.lline||[];s=s.filter(t=>!e?.includes(t)),t.line=s.length?s:void 0;let r=t.polygon||[];r=r.filter(t=>!e?.includes(t)),t.polygon=r.length?r:void 0,JSON.stringify(t)===JSON.stringify({})?(0,v.r)(Ie):(0,v.s)(Ie,t),this._fetchSources()}_renderSymbolSourceOptions(e,t){const{_messages:i,savedStyleIds:s}=this,r=e.filter(e=>"symbol-set"===e.type&&!s?.includes(e.id)),o=e.filter(e=>"web-style"===e.type&&!s?.includes(e.id)),a=e.filter(e=>s?.includes(e.id));a.sort((e,t)=>e.title.localeCompare(t.title));const l=this.symbolFilter?Array.isArray(this.symbolFilter)?this.symbolFilter:[this.symbolFilter]:void 0,n=!("point"!==this.editGeometry||l&&!l.find(e=>"custom"===e||"picture"===e)&&!s?.length),c="3d"!==this.symbolType&&(n||this.savedStyleIds?.length)&&g.qy`<calcite-dropdown-group .groupTitle=${i.addedStyles} selection-mode=multiple>${this._renderSourceDropdownItem(a,t)}${n&&(!l||!!l.find(e=>"custom"===e))&&g.qy`<calcite-dropdown-item data-value=custom-symbol-set .selected=${"custom-symbol-set"===t}>${i.customSymbols}</calcite-dropdown-item>`||""}</calcite-dropdown-group>`||"",m=r.length&&g.qy`<calcite-dropdown-group .groupTitle=${i.classicSymbols} selection-mode=multiple>${this._renderSourceDropdownItem(r,t)}</calcite-dropdown-group>`||"",u=o.length&&g.qy`<calcite-dropdown-group .groupTitle=${r.length?i.newSymbols:i.symbols} selection-mode=multiple>${this._renderSourceDropdownItem(o,t)}</calcite-dropdown-group>`||"";return c?m?u?[m,u,c]:[m,c]:[u,c]:m&&u?[m,u]:g.qy`<calcite-dropdown-group>${this._renderSourceDropdownItem([...r,...o],t)}</calcite-dropdown-group>`}_renderSourceDropdownItem(e,t){return e.map(e=>g.qy`<calcite-dropdown-item data-value=${e.id??g.s6} .selected=${e.id===t}>${e.title}</calcite-dropdown-item>`)}_renderSourceSelection(){const{_messages:e}=this,t=this._symbolSources;if(!t)return g.qy`<div></div>`;const i=this._symbolSources?.find(e=>e.id===this._activeSourceId),s="custom-symbol-set"===this._activeSourceId?e.customSymbols:i?.title,r=1===t.length,o=g.qy`<calcite-dropdown class=${(0,f.CP)({[xe]:!0})} .hidden=${r} @calciteDropdownSelect=${this._onSymbolSourceChange} overlay-positioning=fixed><calcite-button alignment=space-between appearance=outline-fill kind=neutral icon-end=chevron-down scale=m slot=trigger width=full>${s}</calcite-button>${this._renderSymbolSourceOptions(t,this._activeSourceId)}</calcite-dropdown>`;return g.qy`<div class="section"><calcite-label class="section">${this.hideHeader?null:this._messages.category}<div class=${(0,f.CP)(Ae)}>${o}<calcite-action id=symbol-picker-grid .active=${this.isGridView} appearance=transparent icon=grid scale=s class=${(0,f.CP)(Pe)} .text=${this._messages.gridView} @click=${()=>{this.isGridView=!0,this.requestUpdate()}}></calcite-action><calcite-tooltip reference-element=symbol-picker-grid overlay-positioning=fixed>${this._messages.gridView}</calcite-tooltip><calcite-action id=symbol-picker-list .active=${!this.isGridView} appearance=transparent icon=list icon-flip-rtl scale=s .text=${this._messages.listView} @click=${()=>{this.isGridView=!1,this.requestUpdate()}}></calcite-action><calcite-tooltip reference-element=symbol-picker-list overlay-positioning=fixed>${this._messages.listView}</calcite-tooltip></div></calcite-label></div>`}_renderItemSelection(){const{portal:e,_messages:t}=this,i=this._activeSymbolFetch,s=me(e)?e.portal:e,o=g.qy`<div class="remove-button"><calcite-button appearance=transparent kind=danger width=full @click=${()=>this.removeStyle()}>${t.removeStyle}</calcite-button></div>`;return g.qy`<div class=${(0,f.CP)({[Te]:!0,[ke]:this.isGridView})}>${i?g.qy`<calcite-loader label></calcite-loader>`:0===this._activeSymbolItems?.length&&"custom-symbol-set"===this._activeSourceId?g.qy`<arcgis-map-config-symbol-picker-file-upload .portal=${s} .hideSvgUploadSymbols=${this.hideSvgUploadSymbols}></arcgis-map-config-symbol-picker-file-upload>`:this._activeSymbolItems&&this._activeSymbolItems.length>0?(0,r.D)(this._activeSymbolItems?.length,g.qy`<div class=${(0,f.CP)(Fe)}>${this.isGridView?this._renderGridView():this._renderListView()}${"custom-symbol-set"===this._activeSourceId&&g.qy`<arcgis-map-config-symbol-picker-file-upload class=${(0,f.CP)(qe)} .portal=${s} .hideSvgUploadSymbols=${this.hideSvgUploadSymbols}></arcgis-map-config-symbol-picker-file-upload>`||""}${this.displayEmptyFilterMsg&&g.qy`<div class=${(0,f.CP)(Ne)}>${this._messages.noFilterSymbolsAvailable}</div>`||""}${this._activeSourceId&&this.savedStyleIds?.includes(this._activeSourceId)&&o||""}</div>`):g.qy`<div><div class=${(0,f.CP)($e)}>${this._messages.noSymbolsAvailable}</div>${this._activeSourceId&&this.savedStyleIds?.includes(this._activeSourceId)&&o||""}</div>`}</div>`}_renderGridView(){return g.qy`<arcgis-map-config-item-palette .items=${this._activeSymbolItems?.map((e,t)=>({item:e,index:t,observer:this._symbolIntersectionObserver}))} .ItemRenderer=${X} .itemsPerRow=${this.itemsPerRow} .selected=${({item:e})=>e?.data===this.activeSymbolItem?.data} @arcgisItemSelect=${async e=>{const{detail:{item:t}}=e;this.customSymbolError=void 0,this.arcgisActiveSymbolItemChange.emit(t),this.activeSymbolItem=t;const i=await t.getEsriSymbol();this.arcgisActiveSymbolChange.emit(i),e.stopPropagation()}} ${(0,b.K)(this.itemPaletteNode)}></arcgis-map-config-item-palette>`}_renderListView(){const{_messages:e}=this,t="rtl"===this._direction;return g.qy`<calcite-list .label=${e.symbols} .filterEnabled=${this._activeSymbolItems&&this._activeSymbolItems.length>10} .filterPlaceholder=${e.filterPlaceholder} @calciteListFilter=${e=>{const t=e.target;this.displayEmptyFilterMsg=!!t.filterText&&0===t.filteredItems.length}} ${(0,b.K)(this.listRefHandler)}>${this._activeSymbolItems?.map((e,i)=>g.qy`<calcite-list-item .label=${e.data.title||e.data.name} .value=${i} .selected=${this.activeSymbolItem?.data.name===e.data.name} .metadata=${e.data.tags?.toString()} @calciteListItemSelect=${async e=>{const t=e.target,i=this._activeSymbolItems[t.value];this.customSymbolError=void 0,this.arcgisActiveSymbolItemChange.emit(i),this.activeSymbolItem=i;const s=await(i?.getEsriSymbol());this.arcgisActiveSymbolChange.emit(s),e.stopPropagation()}}><div slot=actions-start class=${`list-item-div ${Oe}`} data-value=${i??g.s6}></div>${"custom-symbol-set"===this._activeSourceId&&g.qy`<calcite-action slot=actions-end class="list-item-action" appearance=transparent .text=${this._messages.removeSymbol} data-value=${i??g.s6} @click=${()=>{this.removeCustomSymbol(i),this.requestUpdate()}} @mouseover=${()=>this.addTooltip({referenceElement:this.actionEls[i],placement:t?"right-start":"left-start",innerHTML:this._messages.removeSymbol})} @mouseout=${()=>this.removeTooltip()}><calcite-icon scale=s icon=x></calcite-icon></calcite-action>`||""}</calcite-list-item>`)}</calcite-list>`}render(){return this._propWatcherTask.render({complete:()=>{const e=this._symbolSources,t=this._activeSymbolFetch;if(!e||t)return g.qy`<div class=${(0,f.CP)(Ce)}><calcite-loader label></calcite-loader></div>`;const i=this._symbolSources?.find(e=>e.id===this._activeSourceId)?.keywords.includes("Adobe");let s;return i&&(s=this._messages.adobeCopyright.replace("${year}","2024")),g.qy`<div class=${(0,f.CP)(Ce)}>${this._renderSourceSelection()}${this._renderItemSelection()}${i?g.qy`<calcite-notice open kind=danger scale=s><div slot=message .innerHTML=${s??""}></div></calcite-notice>`:null}${this.customSymbolError?g.qy`<calcite-notice open class=${(0,f.CP)(Ee)} closable icon=exclamation-mark-circle kind=danger @calciteNoticeClose=${()=>this.customSymbolError=void 0} scale=s><div slot=message>${"too-large"===this.customSymbolError?this._messages.customSymbolErrors.tooLarge:"invalid-file"===this.customSymbolError?this._messages.customSymbolErrors.invalidFile:"storage-full"===this.customSymbolError?this._messages.customSymbolErrors.outOfSpace:"error"===this.customSymbolError?this._messages.customSymbolErrors.error:void 0}</div></calcite-notice>`:null}</div>`}})}}(0,s.c)("arcgis-map-config-symbol-picker",Le)},36486:(e,t,i)=>{i.d(t,{u:()=>o});var s=i(83552),r=i(73679);const o=(0,s.yr)(r.g)},42855:(e,t,i)=>{i.d(t,{a:()=>a,f:()=>s,l:()=>r,s:()=>o});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),r=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(r||{}),o=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(o||{}),a=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(a||{})},46317:(e,t,i)=>{i.d(t,{D:()=>a});var s=i(85282),r=i(34670),o=i(42466);const a=(0,r.u$)(class extends r.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,o.mY)(e),this.key=t),i}})},47640:(e,t,i)=>{i.d(t,{YZ:()=>a,e1:()=>r});var s=i(4836);const r={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},o=Symbol();class a{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??l,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let r=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){r=!0,i=e}if(this.p===s){if(t===o)this.i=0;else{if(!1===r){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const l=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},55535:(e,t,i)=>{function s(e,t,i){window.localStorage.setItem(e,JSON.stringify(t))}function r(e){window.localStorage.removeItem(e)}function o(e,t){const i=window.localStorage.getItem(e);return i&&t?JSON.parse(i):i}function a(e,t,i){window.sessionStorage.setItem(e,JSON.stringify(t))}function l(e,t){const i=window.sessionStorage.getItem(e);return i&&t?JSON.parse(i):i}i.d(t,{a:()=>a,b:()=>l,g:()=>o,r:()=>r,s:()=>s})},66228:(e,t,i)=>{i.d(t,{a:()=>f,b:()=>$,c:()=>F,d:()=>E,e:()=>x,f:()=>A,g:()=>g,h:()=>b,i:()=>h,j:()=>p,k:()=>w,l:()=>q,m:()=>I,n:()=>d,o:()=>_,p:()=>N,q:()=>T,r:()=>O,s:()=>v,t:()=>C,u:()=>S});var s=i(63438),r=i(18423),o=i(96086),a=i(91813),l=i(21255),n=i(13078),c=i(21303),m=i(12627),u=i(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],y=["feature"];function h(e){return null!=e}function p(e,t,i){const s=t.fieldName;if(s.includes(u.f.expression)){const e=i.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function g(e){return new Map((await w(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function b(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${u.f.expression}${e.name}`;t.set(i,e)}),t}function f(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function S(e){const t=f(e);let i;return t===u.s.wms||t===u.s.mapImage?i=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(i=e.version),Number.parseFloat(i)}function v(e){return"fieldConfigurations"in e&&y.includes(e.type)}async function w(e){return await new Promise((t,i)=>{switch(f(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const s=e,r=s?.layer;r?.portalItem&&r.url.includes("https://demographics")&&r.url.includes(".arcgis.com")?r.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),r=e.thematicGroup.fieldNames,o=[];r.forEach(e=>{i.has(e)&&o.push(i.get(e))}),t(o)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function _(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function I(e){return Number((100*(1-e)).toFixed(1))}function C(e){return Number((1-e/100).toFixed(3))}const E=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},$=async(e,t)=>{const i=new m.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},x=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await k(i,s.features?.[0])},k=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=E(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const o=new r.default;i.geometry=o}return i};function T(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function F(e){if(f(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(f(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function q(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function A(e,t){try{const i=f(e);if(i===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await $(e,t)||await P(e,t)]};if(i===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await P(e,t)]};const s=i===u.s.ogcFeature||i===u.s.stream?await t.whenLayerView(e):e,r=s.createQuery();r.where=s.definitionExpression||"1=1",r.outFields=["*"],r.returnM="hasM"in e&&e.hasM,r.returnZ="hasZ"in e&&e.hasZ,r.outSpatialReference=t.spatialReference,r.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===u.s.ogcFeature)&&(r.start=0,r.num=1),r.outSpatialReference=t.spatialReference;const o=await s.queryFeatures(r);return o?.features?.length||(o.features[0]=await P(e,t)),o}catch(e){console.error(e)}}async function P(e,t){return await new Promise(i=>{const r=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),r.attributes=t}const c=t.extent;let m;"polygon"===e.geometryType?m=l.default.fromExtent(c):"point"===e.geometryType?m=c.center.clone():"multipoint"===e.geometryType?m=new o.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(m=new a.default({spatialReference:t.spatialReference.clone()}),m.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(m=n.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),r.geometry=m,i(r)})}function O(e){return f(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function N(e){return f(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},89779:(e,t,i)=>{function s(e){return"cim"===e.type&&e.data.symbol?"CIMLineSymbol"===e.data.symbol.type?"line":"CIMPolygonSymbol"===e.data.symbol.type?"polygon":"point":"simple-marker"===e.type||"picture-marker"===e.type?"point":"simple-line"===e.type?"line":"polygon"}function r(e){return"cim"===e?.type}function o(e){return"simple-marker"===e?.type}function a(e){return"picture-marker"===e?.type}function l(e){return"simple-line"===e?.type}function n(e){return"simple-fill"===e?.type}function c(e){return!!e.data.symbol&&"CIMPointSymbol"===e.data.symbol.type}function m(e){return!!e.data.symbol&&"CIMLineSymbol"===e.data.symbol.type}function u(e){return!!e.data.symbol&&"CIMPolygonSymbol"===e.data.symbol.type}i.d(t,{a:()=>o,b:()=>n,c:()=>l,d:()=>a,e:()=>u,f:()=>c,g:()=>s,h:()=>m,i:()=>r})}}]);