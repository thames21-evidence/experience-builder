/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-4abe4c.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-4abe4c"],{31068:(e,t,r)=>{r.d(t,{a:()=>p,c:()=>m});var n=r(83368),a=r(17989),i=r(54470),s=r(75698),o=r(44345),l=r(43284),u=r(66228),c=r(45211),f=r(65722);function d(e,t){return!(!e||!t)&&e.toLocaleLowerCase()===t.toLocaleLowerCase()}async function m(e){const t=["feature","oriented-imagery"].includes(e.type),r=e?.portalItem,n=e.sourceJSON;if(!t||!r)return!1;const a=r.portal;if(!a?.user||(0,c.a)(r)||!(0,c.i)(r)||(0,c.l)(r)||(0,c.b)(n))return!1;const i=(0,c.u)(r,a.user),s=await(0,c.g)(e)??[],o=await(0,c.d)(e)??[],l=(0,c.e)(s,o);if(!i&&!l)return!1;const u=await(0,c.f)(r.id,a,{relationshipType:"Service2Service"});return!(u?.data?.relatedItems&&u.data.relatedItems.some(e=>["WMTS","Map Service","Vector Tile Service"].includes(e.type)))}async function p(e,t,r,a){if(!r)return!1;const i=["feature","oriented-imagery"].includes(t.type),u=t.portalItem,m=t.sourceJSON;if(!i||!u||!u.portal.user||!(0,c.i)(u)||(0,c.a)(u)||(0,c.l)(u)||(0,c.b)(m)||u.portal.isPortal&&(0,c.c)(u)||["oid","global-id","geometry"].includes(r.type))return!1;const p=t.sourceJSON.geometryProperties,w=p?.shapeLengthFieldName,h=p?.shapeAreaFieldName;if(d(w,r.name)||d(h,r.name))return!1;const b=t.editFieldsInfo;if(b&&(d(b.creationDateField,r.name)||d(b.creatorField,r.name)||d(b.editDateField,r.name)||d(b.editorField,r.name))||d(t.objectIdField,r.name)||d(t.displayField,r.name)||d(t.typeIdField,r.name)||d(t.subtypeField,r.name)||t.timeInfo&&(d(t.timeInfo.startField,r.name)||d(t.timeInfo.endField,r.name)||d(t.timeInfo.trackIdField,r.name)))return!1;if(t.featureReduction){const e=new Set;if(await n.collectFeatureReductionFields(e,t,t.featureReduction),Array.from(e).some(e=>d(e,r.name)))return!1}if((await n.getRendererFields(t.renderer,t.fieldsIndex)).some(e=>d(e,r.name)))return!1;{const e=t.labelingInfo?.map(e=>e.labelExpressionInfo?.expression);if(e&&((await n.getExpressionFields(t,e)).some(e=>d(e,r.name))||await y(t,r,"layer")))return!1}if(t.definitionExpression&&(await l.parseWhereClause(t.definitionExpression,t.fieldsIndex)).fieldNames.some(e=>d(e,r.name))||await async function(e,t){const r=e.portalItem;if(!r)return!1;const a=`${(0,f.g)(r.portal)}content/items/${r.id}/data`,i=(await(0,o.default)(a,{query:{f:"json"},responseType:"json"}))?.data;if(!i)return!1;if(i?.layers){const r=i.layers.find(t=>t.id===e.layerId),a=r?.layerDefinition?.drawingInfo?.renderer,o=r?.layerDefinition?.featureReduction,u=r?.layerDefinition?.definitionExpression;if(!a&&!o&&!u)return!1;if(a){const r=s.fromJSON(a);if((await n.getRendererFields(r,e.fieldsIndex)).some(e=>d(e,t.name)))return!0}if(o&&await g(e,t,o)||u&&(await l.parseWhereClause(u,e.fieldsIndex)).fieldNames.some(e=>d(e,t.name)))return!0}return!1}(t,r)||await async function(e,t){const r=e.sourceJSON,a=r?.drawingInfo?.renderer,i=r?.featureReduction;if(!a&&!i)return!1;if(a){const r=s.fromJSON(a);if((await n.getRendererFields(r,e.fieldsIndex)).some(e=>d(e,t.name)))return!0}return!(!i||!await g(e,t,i))}(t,r))return!1;if(await async function(e,t){const r=e.sourceJSON?.drawingInfo?.labelingInfo;if(!r)return await Promise.resolve(!1);const a=r?.map(e=>e.labelExpressionInfo?.expression);if(a){if((await n.getExpressionFields(e,a)).some(e=>d(e,t.name)))return await Promise.resolve(!0);if(await y(e,t,"service"))return await Promise.resolve(!0)}return await Promise.resolve(!1)}(t,r))return await Promise.resolve(!1);if(await async function(e,t){const r=e.sourceJSON?.definitionQuery;return r&&(await l.parseWhereClause(r,e.fieldsIndex)).fieldNames.some(e=>d(e,t.name))?await Promise.resolve(!0):await Promise.resolve(!1)}(t,r))return await Promise.resolve(!1);if(function(e,t,r){if(!e)return!1;const n=e.map?.applicationProperties?.viewing?.search;if(n){const e=n.layers?.find(e=>e.id===t.id);if(e){const t=e?.field?.name;if(t)return d(t,r.name)}}return!1}(e,t,r)||t.relationships?.map(e=>e.keyField)?.some(e=>d(e,r.name)))return!1;const v=(0,c.u)(u,u.portal.user),I=await(0,c.g)(t)??[],x=await(0,c.d)(t)??[],F=(0,c.e)(I,x);if(!v&&!F)return!1;const S=await(0,c.f)(u.id,u.portal,{relationshipType:"Service2Service"});return!(S?.data?.relatedItems&&S.data.relatedItems.some(e=>["WMTS","Map Service","Vector Tile Service"].includes(e.type)))}async function y(e,t,r){const n="layer"===r?e.labelingInfo?.filter(e=>(0,u.i)(e.where)):e.sourceJSON?.drawingInfo?.labelingInfo?.filter(e=>(0,u.i)(e.where));if(!n?.length)return!1;const a=[...await Promise.all(n.map(async t=>await l.parseWhereClause(t.where,e.fieldsIndex)))];let i=!1;for(let e=0;e<a.length;e++){const r=a[e].fieldNames?.some(e=>d(e,t.name));if(!i&&r){i=!0;break}}return await Promise.resolve(i)}async function g(e,t,r){const s="binning"===r.type?a.default.fromJSON(r):i.default.fromJSON(r),o=new Set;return await n.collectFeatureReductionFields(o,e,s),!!Array.from(o).some(e=>d(e,t.name))}},42855:(e,t,r)=>{r.d(t,{a:()=>s,f:()=>n,l:()=>a,s:()=>i});var n=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(n||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),i=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(i||{}),s=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(s||{})},45211:(e,t,r)=>{r.d(t,{a:()=>l,b:()=>f,c:()=>o,d:()=>m,e:()=>y,f:()=>p,g:()=>d,i:()=>u,l:()=>c,u:()=>i});var n=r(44345),a=r(65722);function i(e,t){return s(e,t)||function(e,t){const r=e.owner,n="admin"===e.itemControl,a=["esri_livingatlas","esri_demographics","esri_boundaries"];return!(e.portal?.isPortal&&!s(e,t)&&n&&r?.includes("esri_")&&!a.includes(r))&&n}(e,t)}function s(e,t){return e.owner===t.username}function o(e){return e.typeKeywords?.includes("Spatiotemporal")}function l(e){return e.typeKeywords?.includes("View Service")}function u(e){return e.typeKeywords?.includes("Hosted Service")}function c(e){return e.typeKeywords?.includes("Multi Services View")}function f(e){return e?.hasViews&&!e.sourceSchemaChangesAllowed}async function d(e){const t=e?.portalItem;if(!t)return await Promise.resolve(null);const r=t.portal;if(r?.user){const e=`${(0,a.g)(r)}community/users/${r.user.username}`;return await(0,n.default)(e,{query:{f:"json",token:t.portal.credential?.token},responseType:"json"}).then(e=>{const t=e.data?.groups??[];return Promise.resolve(t)},()=>Promise.reject(new Error("Failed to fetch user groups")))}return await Promise.resolve(null)}async function m(e){const t=e?.portalItem;if(!t)return await Promise.resolve(null);const r=t.portal,i=`${(0,a.g)(r)}content/items/${t.id}/groups`;return await(0,n.default)(i,{query:{f:"json",token:t.portal.credential?.token},responseType:"json"}).then(e=>{const t=[...e.data?.admin??[],...e.data?.member??[],...e.data?.other??[]];return Promise.resolve(t)},()=>Promise.reject(new Error("Failed to fetch item groups")))}async function p(e,t,{relationshipType:r,direction:i}){const s=`${(0,a.g)(t)}content/items/${e}/relatedItems`;return await(0,n.default)(s,{query:{f:"json",relationshipType:r,direction:i},responseType:"json"})}function y(e,t){return e?.some(e=>t?.some(t=>e.id===t.id&&e.capabilities.includes("updateitemcontrol")))}},65722:(e,t,r)=>{r.d(t,{a:()=>i,g:()=>s,o:()=>o});var n=r(44345);const a=e=>e&&!e.endsWith("/")?`${e}/`:e;function i(e){const{customBaseUrl:t,portalHostname:r,urlKey:n}=e,{protocol:a}=window.location;return`${a}//${n?`${n}.${t}`:r}`}function s(e){return a(e.restUrl)}async function o(e){if(!e?.user)return!1;const t=`${s(e)}portals/self/signinSettings`,r=await(0,n.default)(t,{query:{f:"json",async:!1},responseType:"json"});return!(r?.data&&!r.data.blockBetaApps)}},66228:(e,t,r)=>{r.d(t,{a:()=>h,b:()=>N,c:()=>j,d:()=>P,e:()=>T,f:()=>R,g:()=>g,h:()=>w,i:()=>p,j:()=>y,k:()=>I,l:()=>E,m:()=>F,n:()=>d,o:()=>x,p:()=>_,q:()=>k,r:()=>$,s:()=>v,t:()=>S,u:()=>b});var n=r(63438),a=r(18423),i=r(96086),s=r(91813),o=r(21255),l=r(13078),u=r(21303),c=r(12627),f=r(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],m=["feature"];function p(e){return null!=e}function y(e,t,r){const n=t.fieldName;if(n.includes(f.f.expression)){const e=r.get(n);return e?.title?e.title:n}return v(e)&&e.getFieldConfiguration(n)?e.getFieldAlias(n)||n:t.label||n}async function g(e){return new Map((await I(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function w(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const r=`${f.f.expression}${e.name}`;t.set(r,e)}),t}function h(e){return"map-image"===e?.layer?.type?f.s.mapImage:"subtype-sublayer"===e?.type?f.s.subtype:"tile"===e?.layer?.type?f.s.tile:"scene"===e?.type?f.s.scene:"ogc-feature"===e?.type?f.s.ogcFeature:"imagery"===e?.type?f.s.imagery:"imagery-tile"===e?.type?f.s.imageryTile:"wfs"===e?.type?f.s.wfs:"wcs"===e?.type?f.s.wcs:"wms"===e?.layer?.type?f.s.wms:"csv"===e?.type?f.s.csv:"geojson"===e?.type?f.s.geojson:"stream"===e?.type?f.s.stream:"oriented-imagery"===e?.type?f.s.orientedImagery:"catalog"===e?.type?f.s.catalog:"catalog-footprint"===e?.type?f.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?f.s.knowledgeGraphSublayer:"voxel"===e?.type?f.s.voxel:"parquet"===e?.type?f.s.parquet:f.s.feature}function b(e){const t=h(e);let r;return t===f.s.wms||t===f.s.mapImage?r=e?.layer.version:(t===f.s.imagery||t===f.s.feature||t===f.s.scene)&&(r=e.version),Number.parseFloat(r)}function v(e){return"fieldConfigurations"in e&&m.includes(e.type)}async function I(e){return await new Promise((t,r)=>{switch(h(e)){case f.s.feature:case f.s.ogcFeature:case f.s.stream:t(e.fields);break;case f.s.mapImage:{const n=e,a=n?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const r=new Map(n.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,i=[];a.forEach(e=>{r.has(e)&&i.push(r.get(e))}),t(i)}else t(n.fields)}).catch(e=>{r(new Error(e))}):t(n.fields);break}case f.s.imagery:case f.s.imageryTile:case f.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function x(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function F(e){return Number((100*(1-e)).toFixed(1))}function S(e){return Number((1-e/100).toFixed(3))}const P=(e,t)=>{const r=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(f.f.expression)||r.push({name:e.fieldName,alias:e.label,type:"string"})}),r},N=async(e,t)=>{const r=new c.default;return r.geometry=t.extent,r.mapExtent=t.extent,r.returnGeometry=!0,r.tolerance=6,r.layerOption="popup",r.width=t.width,r.height=t.height,r.layerIds=[e.id],(await u.identify(e.layer.url,r))?.results?.[0]?.feature},T=async(e,t,r)=>{const n=await(await e.whenLayerView(t)).queryAggregates();return await O(r,n.features?.[0])},O=async(e,t)=>{let r;if(t)r=t.clone();else{r=new n.default;const t=P(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),r.attributes=e}const i=new a.default;r.geometry=i}return r};function k(e,t){const r=t.startsWith("#"),n=t.startsWith(".");for((n||r)&&(t=t.slice(1));e;){if(r){if(e.id===t)return e}else if(n){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function j(e){if(h(e)===f.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(h(e)===f.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function E(e,t,r){let n="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))n="number";else if(t.has(e)){const r=t.get(e);n=r.type?r.type.toLowerCase():""}else if(r.has(e)){const t=r.get(e);n=t.returnType?t.returnType.toLowerCase():""}else n="number";return n}async function R(e,t){try{const r=h(e);if(r===f.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await N(e,t)||await C(e,t)]};if(r===f.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await C(e,t)]};const n=r===f.s.ogcFeature||r===f.s.stream?await t.whenLayerView(e):e,a=n.createQuery();a.where=n.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(n.sourceJSON?.advancedQueryCapabilities?.supportsPagination||r===f.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const i=await n.queryFeatures(a);return i?.features?.length||(i.features[0]=await C(e,t)),i}catch(e){console.error(e)}}async function C(e,t){return await new Promise(r=>{const a=new n.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const u=t.extent;let c;"polygon"===e.geometryType?c=o.default.fromExtent(u):"point"===e.geometryType?c=u.center.clone():"multipoint"===e.geometryType?c=new i.default({points:[[u.center.x,u.center.y]],spatialReference:u.center.spatialReference.clone()}):"polyline"===e.geometryType?(c=new s.default({spatialReference:t.spatialReference.clone()}),c.addPath([[u.xmin,u.ymin],[u.xmax,u.ymax]])):"mesh"===e.geometryType&&(c=l.default.createBox(u.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=c,r(a)})}function $(e){return h(e)===f.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function _(e){return h(e)===f.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);