/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-722a64.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-722a64"],{1225:(e,t,i)=>{i.d(t,{$:()=>Le,A:()=>Je,B:()=>st,C:()=>ot,D:()=>pt,E:()=>dt,F:()=>Ze,G:()=>Ye,H:()=>ht,I:()=>Ve,J:()=>U,K:()=>J,L:()=>te,M:()=>qe,N:()=>X,O:()=>S,P:()=>bt,Q:()=>Te,R:()=>ve,S:()=>Me,T:()=>oe,U:()=>le,V:()=>_,W:()=>De,X:()=>Be,Y:()=>nt,Z:()=>rt,_:()=>we,a:()=>vt,a0:()=>Z,a1:()=>P,a2:()=>Ce,a3:()=>_e,a4:()=>Re,a5:()=>ne,a6:()=>pe,a7:()=>G,a8:()=>Ne,a9:()=>z,aA:()=>me,aB:()=>de,aC:()=>Fe,aD:()=>$,aE:()=>Y,aF:()=>L,aG:()=>K,aH:()=>ee,aI:()=>Q,aJ:()=>Nt,aK:()=>It,aa:()=>N,ab:()=>xe,ac:()=>ut,ad:()=>$e,ae:()=>H,af:()=>j,ag:()=>ce,ah:()=>re,ai:()=>zt,aj:()=>kt,ak:()=>ge,al:()=>ae,am:()=>se,an:()=>Rt,ao:()=>q,ap:()=>Et,aq:()=>Ft,ar:()=>wt,as:()=>St,at:()=>je,au:()=>k,av:()=>Ie,aw:()=>D,ax:()=>O,ay:()=>W,az:()=>xt,b:()=>Tt,c:()=>yt,d:()=>be,e:()=>Ge,f:()=>x,g:()=>Se,h:()=>R,i:()=>He,j:()=>C,k:()=>Pe,l:()=>ie,m:()=>M,n:()=>B,o:()=>V,p:()=>gt,q:()=>We,r:()=>it,s:()=>I,t:()=>Ue,u:()=>Xe,v:()=>at,w:()=>Ke,x:()=>ct,y:()=>Qe,z:()=>lt});var n=i(7299),r=i(28927),s=i(52797),o=i(20936),a=(i(54312),i(44345),i(55448),i(34031),i(63438),i(5933),i(83368),i(89704),i(5294)),l=(i(18423),i(96086),i(91813),i(21255),i(13078),i(21303),i(12627),i(56451)),c=i(31521),u=i(23054),p=(i(5077),i(23795),i(17902),i(87420),i(30161)),d=i(81734),f=i(75698),m=i(10628),y=i(59640),g=i(64451),h=i(6176),b=(i(83552),i(77462)),v=i(49403),T=i(10281),w=i(83930),F=(i(66617),i(10454),i(29614),i(94916),i(52554),i(2156),i(4038),i(49851),i(75054),i(15223),i(70169),i(47207),i(70852),i(48103),i(39423),i(85681),i(18444),i(42411),i(9767),i(38218),i(91914)),E=i(66228),I=(i(86605),i(68196),i(440),i(46547),i(6238),(e=>(e.MISSING="missing",e.IN_PROGRESS="inProgress",e.SUCCESS="success",e.FAILED="failed",e))(I||{}));function S(e){return 0===Object.keys(e).length&&e.constructor===Object}function x(){document.querySelectorAll("calcite-popover").forEach(e=>{let t=!1;e.classList.forEach(e=>{e.startsWith("smart-mapping-")&&e.endsWith("-popover")&&(t=!0)}),t&&(e.setAttribute("open","false"),e.remove())}),document.querySelectorAll("arcgis-map-config-smart-mapping-symbol-styler-popover, arcgis-map-config-smart-mapping-info-popover, arcgis-map-config-smart-mapping-symbol-pair-popover, arcgis-map-config-smart-mapping-dropdown, arcgis-map-config-smart-mapping-field-pick-list, .arcgis-map-config-smart-mapping-attribute-input-field-pick-list").forEach(e=>e?.remove())}function R(e,t){const i=function(e){if("CALCITE-PANEL"===e?.tagName)return e;if("CALCITE-FLOW-ITEM"===e?.tagName)return e;{let t=e?.parentElement;for(;t;){if("CALCITE-PANEL"===t.tagName)return t;if("CALCITE-FLOW-ITEM"===t.tagName)return t;t=t.parentElement}}}(e);i&&(i.disabled=t)}function N(e){const t=e?.parentElement;if("CALCITE-FLOW"===t?.tagName){let i=0;return[...t.children].forEach((t,n)=>{t===e&&(i=n)}),0===i}return!1}function z(e,t){const{containsFlow:i}=e;return i?(0,o.el)(t,"calcite-flow"):(0,o.el)(t,"arcgis-map-config-smart-mapping")}function k(e){return e.min===e.max&&_(e.min)&&(e.min>0?(e.min=0,e.max*=2):e.min<0?(e.min*=2,e.max=0):(e.min=-10,e.max=10)),e}function C(e){const{layer:t,useFeatureReduction:i}=e;return"featureReduction"in t&&i?"binning"===t.featureReduction?.type?"polygon":t.geometryType:"imagery"===t.type||"imagery-tile"===t.type||"wcs"===t.type?"polygon":"geo-rss"===t.type?"point":t.geometryType}function M(e){return"point"===C(e)||"multipoint"===C(e)}function V(e){return"polygon"===C(e)}function B(e){return"polyline"===C(e)}function _(e){return null!=e}function L(e){if(e.simpleFieldType===U.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}function O(e){setTimeout(()=>{e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),setTimeout(()=>{const e=document.getElementsByTagName("calcite-shell")?.[0];e&&(e.scrollTop=0)},100)},100)}function q(e){const{isRTL:t}=e,i=new Intl.NumberFormat(s.getLocale(),{style:"percent"}).format(0);return t?i.endsWith("%"):i.startsWith("%")}function D(e,t){return e.minValue<.001&&e.maxValue<.001?`${e.minValue.toFixed(t).toLocaleString()} - ${e.maxValue.toFixed(t).toLocaleString()}`:`${e.minValue.toLocaleString()} - ${e.maxValue.toLocaleString()}`}function P(e){return"feature"===e.type}var U=(e=>(e.NUMBER="number",e.STRING="string",e.DATE="date",e.OID="oid",e.GUID="guid",e.UNKNOWN="unknown",e))(U||{});let A=["id","fips","fid","objectid","_objectid","__objectid","x","y","lat","long","latitude","longitude","shape","shape_length","shape_leng","shape_area","perimeter","stretched_value","fnode_","tnode_","lpoly_","rpoly_","poly_","subclass","rings_ok","rings_nok","st_length(shape)","st_area(shape)"];async function G(e){const{layer:t,mapImageSublayer:i}=e;let{layerFields:n}=e;if(!t||n)return;e.layerFields=function(e){const{layer:t,useFeatureReduction:i}=e;if("featureReduction"in t&&i){const i=t.featureReduction.fields,n=[];return i.forEach(i=>{const s=t.fields.find(e=>e.name===i.onStatisticField);(!i.onStatisticField||s)&&n.push(new r.default({name:i.name,alias:i.alias||i.name,type:te(e,i)}))}),n}return"fields"in t&&_(t.fields)?t.fields??[]:[]}(e);const s=i?.layer;if(s?.portalItem&&s.url.includes("https://demographics")&&s.url.includes(".arcgis.com")){const e=s.portalItem;try{const t=await e.fetchData();if(t?.thematicGroup){const e=t.thematicGroup.fieldNames;e&&(n=n.filter(t=>e.includes(t.name)))}}catch{}}!function(e){const{layer:t,mapImageSublayer:i,layerFields:n,supportsArcade:r}=e,s="capabilities"in t&&null!=t.capabilities&&"query"in t.capabilities&&"supportsSqlExpression"in t.capabilities.query&&t.capabilities?.query?.supportsSqlExpression;e.fields=[],e.stringFieldsCount=0,e.dateFieldsCount=0,e.numberFieldsCount=0;const o="popupTemplate"in t&&t.popupTemplate?t.popupTemplate.fieldInfos:[],a=we(e).filter(e=>!!e.field).map(e=>e.field.toLowerCase());a?.length&&(A=A.filter(e=>!a.includes(e))),n.forEach(n=>{if(A.includes(n.name.toLowerCase())||"date"===n.type&&(i&&!r||"stream"!==t.type&&!s)||"date-only"===n.type&&i)return;const l=o?o.filter(e=>e.fieldName===n.name):null,c=l?.length?l[0].label:null,u={layerField:n,label:c||n.alias||n.name};(function(e,t,i){const{useFeatureReduction:n}=e;let r=te(e,t.layerField);switch(n&&r&&["date","timestamp-offset"].includes(r)&&(r="string"),r){case"string":case"date-only":t.simpleFieldType="string",e.stringFieldsCount++;break;case"date":t.simpleFieldType="date",e.dateFieldsCount++;break;case"oid":i.includes(t.layerField.name.toLowerCase())&&(t.simpleFieldType="oid");break;case"guid":i.includes(t.layerField.name.toLowerCase())&&(t.simpleFieldType="guid");break;case"small-integer":case"big-integer":case"integer":case"single":case"double":case"long":t.simpleFieldType="number",e.numberFieldsCount++}})(e,u,a),u.simpleFieldType&&e.fields.push(u)})}(e)}function J(e,t){if(ie(e)){const i=kt(e).filter(e=>e.name===t);if(i.length){const e=i[0];return{label:e.alias??"",layerField:e,simpleFieldType:"string"}}}else{const i=e.fields.filter(e=>e.layerField.name===t);if(i.length)return i[0]}}function W(e){const t=e.fields.filter(e=>"number"===e.simpleFieldType);if(t.length)return t[0]}function j(e){return e.numberFieldsCount>0}function $(e){const{selectedFields:t}=e,i={string:0,number:0,date:0,unknown:0,expression:0,featureReductionExpression:0};return t.forEach(t=>{let n;if(i.expression+=t.expression?1:0,i.featureReductionExpression+=t.featureReductionExpression?1:0,t.field){const i=J(e,t.field);n=i?i.simpleFieldType:"unknown"}else n=t.simpleFieldType;switch(n){case"number":case"oid":case"guid":i.number++;break;case"string":i.string++;break;case"date":i.date++;break;case"unknown":i.unknown++}}),i}function H(e,t){const{fields:i}=e;t=t||i;const n={string:0,number:0,date:0,expression:0};return t?.forEach(e=>{switch(e.simpleFieldType){case"number":case"oid":case"guid":n.number++;break;case"string":n.string++;break;case"date":n.date++}}),n}function Q(e,t){const{layer:i}=e;(!("featureReduction"in i)||!i.featureReduction)&&Z(e,t)}function Z(e,t){const{layer:i}=e;("geojson"===i.type||"wfs"===i.type||"feature"===i.type||"parquet"===i.type)&&(i.outFields=t)}function K(e,t){let i=!0;return e.length===t.length&&(e.forEach((e,n)=>{i&&!X(e,t[n])&&(i=!1)}),i)}function X(e,t){return e&&t&&(e.field??null)===(t.field??null)&&(e.expression??null)===(t.expression??null)&&(e.expressionTitle??null)===(t.expressionTitle??null)}function Y(e){return"date"===e.simpleFieldType}function ee(e,t){const i=t.layerField;switch(te(e,i)){case"small-integer":case"big-integer":case"integer":case"single":case"double":if("domain"in i&&i.domain)return"string";switch("valueType"in i&&i.valueType){case"name-or-title":case"type-or-category":case"description":case"location-or-place-name":case"ordered-or-ranked":case"binary":case"unique-identifier":case"date-and-time":return"string";case"count-or-amount":return"integer";default:return"double"}case"string":case"date-only":return"string";case"date":return"date";default:return"string"}}function te(e,t){const{layer:i}=e;if(t&&"fields"in i){if("type"in t)return t.type;if("statisticType"in t){if(t.onStatisticExpression)return"number"===t.onStatisticExpression.returnType?"double":t.onStatisticExpression.returnType;const e=i.fields?.find(e=>e.name===t.onStatisticField);if(!t.onStatisticField||e){if("count"===t.statisticType)return"integer";if("avg"===t.statisticType)return"double";if(["min","max","sum","mode"].includes(t.statisticType))return e?.type||"integer"}return}}}function ie(e){const{layer:t}=e;return["imagery","imagery-tile","wcs"].includes(t.type)}async function ne(e){return("imagery"===e.type||"imagery-tile"===e.type?await e.generateRasterInfo(e.rasterFunction).catch(()=>e.serviceRasterInfo):"wcs"===e.type?e.serviceRasterInfo:void 0)??void 0}function re(e,t){const{layer:i}=e,n=i;return"imagery"!==n.type&&"imagery-tile"!==n.type||!n.activePresetRendererName?t:n.activePresetRendererName}function se(e){const{layer:t}=e,i=t;if(("imagery"===i.type||"imagery-tile"===i.type)&&i.activePresetRendererName)return i.presetRenderers.find(e=>e.name===i.activePresetRendererName)}function oe(e){const{layer:t}=e,i=t;return"imagery"!==i.type&&"imagery-tile"!==i.type||!i.activePresetRendererName?i.renderer:se(e)?.renderer??i.renderer}function ae(e){const t=se(e);if(t)return t.bandIds;{const{layer:t}=e;return t.bandIds??void 0}}function le(e,t){const{layer:i}=e,n=i;let r;switch(r=t?t.renderer:"imagery"!==n.type&&"imagery-tile"!==n.type||!n.activePresetRendererName?n.renderer:oe(e),r?.type){case"flow":return"raster-flow";case"vector-field":return"raster-vector-field";case"class-breaks":return"raster-class-breaks";case"unique-value":return"raster-unique-value";case"raster-stretch":return xt(e,t)?"raster-rgb":"raster-stretch";case"raster-shaded-relief":return"raster-shaded-relief";default:return r?.type}}function ce(e,t){ue(e,a.clone(t||oe(e)))}function ue(e,t){const{layer:i}=e,n=i;"imagery"!==n.type&&"imagery-tile"!==n.type||!n.activePresetRendererName?n.renderer=t:de(n.activePresetRendererName,n,t)}async function pe(e){const{layer:t}=e,i=t,n=i.rasterFunction;if(!i.bandIds){const e=await c.getDefaultBandCombination({layer:i,rasterFunction:n});i.bandIds=e}const r=await c.getSupportedRendererInfo({layer:i,rasterFunction:n});return ue(e,r.defaultRenderer),r.defaultRenderer}function de(e,t,i){const n=t.presetRenderers?.find(({name:t})=>t===e);if(!n)return;const{bandIds:r,method:s,name:o,value:a}=n;t.bandIds=r,"raster-function-template"===s?function(e,t){const i=t.rasterFunction?.functionName;if(e===i||fe(e,t))return;const n={functionName:e};if("imagery-tile"===t.type)t.rasterFunction="none"===e?.toLowerCase()?null:n;else if(t.rasterFunction=n,t.mosaicRule?.multidimensionalDefinition){const e=t.mosaicRule.multidimensionalDefinition.map(e=>(e.variableName="",e));t.mosaicRule.multidimensionalDefinition=e}}(a,t):"variable"===s&&function(e,t){const{type:i}=t;if("imagery-tile"===i){const i=t.multidimensionalDefinition?.map(t=>(t.variableName=e,t));t.multidimensionalDefinition=i}else{const i=t.mosaicRule?.multidimensionalDefinition?.map(t=>(t.variableName=e,t));t.mosaicRule.multidimensionalDefinition=i}}(a,t),i&&(n.renderer=i),t.renderer=n.renderer,t.activePresetRendererName=o}function fe(e,t){return!!e&&!ye(t).includes(e)}function me(e){const t=ye(e),i=e?.rasterFunction?.functionName;return i&&fe(i,e)&&t.unshift(i),t}function ye(e){const{type:t}=e;return"imagery-tile"===t?["None"]:e.rasterFunctionInfos?.map(({name:e})=>e)??[]}function ge(e){if(!e)return[new l.default([0,0,0,1]),new l.default([50,50,50,1]),new l.default([73,73,73,1]),new l.default([140,140,140,1]),new l.default([255,255,255,1])];if("multipart"!==e?.type)return[e.fromColor,e.toColor];const t=e.colorRamps??[],i=t.map(e=>e.fromColor);return i.push(t[t.length-1].toColor),i}const he="polygon";function be(e){return ve(e,Se(e))}function ve(e,t){let i="unknown";if(!t)return i;const n=mt(t,"size"),r=mt(t,"color"),s=yt(t,"color"),o=gt(t,"color"),a=gt(t,"size"),l=gt(t,"reference-size"),c=gt(t,"spike");if(t.normalizationType&&"field"!==t.normalizationType)return"unknown";if("simple"===t.type)i="simple";else if("dot-density"===t.type)i="dot-density";else if("heatmap"===t.type)i="heatmap";else if("class-breaks"===t.type){const u=t;if(r)i=u.valueExpression&&!o?"color":n?a?.units?"color-size-age":o?.units?"color-age-size":"color-size":o?.style&&s.normalizationField?"compare":o?.units?n?"color-age-size":"color-age":l||c?"color-size":"color";else if(n)i="univariate-color-size"===u.authoringInfo?.type?"color-size":u.valueExpression&&!a?"size":a?.units?"size-age":"size";else{const n=t,r=n.authoringInfo;i=r?"class-breaks-color"===r.type?"color":"class-breaks-size"===r.type||l||c||ze(n.classBreakInfos)?"size":"color":V(e)?n.valueExpression?ze(n.classBreakInfos)?"size":"color":n.backgroundFillSymbol?"size":"color":ze(n.classBreakInfos)?"size":"color"}}else"unique-value"===t.type?r||(i=t.valueExpression?t.authoringInfo&&"predominance"===t.authoringInfo.type||"Predominant category"===t.valueExpressionTitle?mt(t,"size")?"predominance-size":"predominance":t.authoringInfo&&"relationship"===t.authoringInfo.type?mt(t,"size")||l||c?"relationship-size":"relationship":mt(t,"size")||l||c?"type-size":"type":n?a?.units?"type-size-age":"type-size":l||c?"type-size":"type"):"pie-chart"===t.type&&(i=mt(t,"size")?"chart-size":"chart");return i}function Te(e,t){const i=yt(t,"color"),n=yt(t,"size"),r=ve(e,t);i?.normalizationField?(t.normalizationField=i.normalizationField,t.normalizationType="field"):["color-size","color-age-size","color-size-age"].includes(r)&&i?(t.normalizationField=void 0,t.normalizationType=void 0):"size"===r&&n?.normalizationField&&(t.normalizationField=n.normalizationField,t.normalizationType="field")}function we(e,t){t=t||Se(e);let i=[];switch(ve(e,t)){case"relationship":case"relationship-size":{i=[{field:t.authoringInfo.field1.field,simpleFieldType:U.NUMBER},{field:t.authoringInfo.field2.field,simpleFieldType:U.NUMBER}];const n=yt(t,"size"),r=gt(t,"reference-size"),s=gt(t,"spike");if(n){const t=J(e,n.field);i.push({field:n.field,expression:n.valueExpression,expressionTitle:n.valueExpressionTitle,simpleFieldType:n.field&&t?.simpleFieldType?t.simpleFieldType:U.NUMBER})}else r?i.push({field:r.field,simpleFieldType:U.NUMBER}):s&&i.push({field:s.field,simpleFieldType:U.NUMBER});break}case"predominance":case"predominance-size":i=t.uniqueValueInfos.map(t=>({field:`${t.value}`,simpleFieldType:J(e,`${t.value}`)?.simpleFieldType||U.NUMBER}));break;case"chart":case"chart-size":i=t.attributes.map(t=>{const i=J(e,t.field);return{field:t.field,expression:t.valueExpression,expressionTitle:t.valueExpressionTitle,simpleFieldType:t.field&&i?i.simpleFieldType:U.NUMBER}})}if(i.length)return i;switch(t.type){case"dot-density":i=t.attributes.map(t=>({field:t.field,simpleFieldType:J(e,t.field)?.simpleFieldType||U.NUMBER}));break;case"heatmap":{const n=t;i=n.field?[{field:n.field,simpleFieldType:J(e,n.field)?.simpleFieldType||U.NUMBER}]:[];break}case"class-breaks":{const n=t,r=J(e,n.field);i=[{field:n.field,expression:r?void 0:n.valueExpression,expressionTitle:r?void 0:n.valueExpressionTitle,simpleFieldType:n.field&&r?.simpleFieldType?r.simpleFieldType:U.NUMBER}];const s=yt(t,"color"),o=yt(t,"size"),a=gt(t,"color"),l=gt(t,"size"),c=gt(t,"reference-size"),u=gt(t,"spike");if(s&&o)if(s.field===o.field&&s.valueExpression===o.valueExpression&&s.valueExpressionTitle===o.valueExpressionTitle){const t=J(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:U.NUMBER}]}else{if(a?.units)i=[{field:a.field,simpleFieldType:U.DATE}];else{const t=J(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:U.NUMBER}]}if(l?.units)i.push({field:l.field,simpleFieldType:U.DATE});else{const t=J(e,o.field);i.push({field:o.field,expression:t?void 0:o.valueExpression,expressionTitle:t?void 0:o.valueExpressionTitle,simpleFieldType:o.field&&t?.simpleFieldType?t.simpleFieldType:U.NUMBER})}}else if(s){if(a?.units)i=[{field:a.field,simpleFieldType:U.DATE}];else{const t=J(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:U.NUMBER}]}c&&i.push({field:c.field,simpleFieldType:U.NUMBER}),u&&i.push({field:u.field,simpleFieldType:U.NUMBER})}else if(o)if(l?.units)i=[{field:l.field,simpleFieldType:U.DATE}];else{const t=J(e,o.field);i=[{field:o.field,expression:t?void 0:o.valueExpression,expressionTitle:t?void 0:o.valueExpressionTitle,simpleFieldType:o.field&&t?.simpleFieldType?t.simpleFieldType:U.NUMBER}]}else c?i=[{field:c.field,simpleFieldType:U.NUMBER}]:u&&(i=[{field:u.field,simpleFieldType:U.NUMBER}]);if(a?.style&&s&&s.normalizationField){const t=J(e,s.field),n=J(e,s.normalizationField);i=[{field:s.field,simpleFieldType:t?.simpleFieldType?t.simpleFieldType:U.NUMBER},{field:s.normalizationField,simpleFieldType:n?.simpleFieldType?n.simpleFieldType:U.NUMBER}]}break}case"unique-value":if("predominance"===t.authoringInfo?.type)i=t.uniqueValueInfos.map(t=>{const i=J(e,`${t.value}`);return{field:`${t.value}`,simpleFieldType:i?i.simpleFieldType:U.NUMBER}});else if("chart"===t.authoringInfo?.type)i=t.uniqueValueInfos.map(t=>{const i=J(e,`${t.value}`);return{field:`${t.value}`,simpleFieldType:i?i.simpleFieldType:U.NUMBER}});else if("relationship"===t.authoringInfo?.type){const n=J(e,t.authoringInfo.field1.field),r=J(e,t.authoringInfo.field2.field);i=[{field:t.authoringInfo.field1.field,simpleFieldType:n?.simpleFieldType?n.simpleFieldType:U.NUMBER},{field:t.authoringInfo.field2.field,simpleFieldType:r?.simpleFieldType?r.simpleFieldType:U.NUMBER}]}else{const n=t,r=J(e,n.field);let s=U.NUMBER;n.field&&r?s=r.simpleFieldType||U.NUMBER:n.valueExpression&&n.uniqueValueInfos?.[0]&&"string"==typeof n.uniqueValueInfos[0].value&&(s=U.STRING),i=[{field:n.field,expression:r?void 0:n.valueExpression,expressionTitle:r?void 0:n.valueExpressionTitle,simpleFieldType:s}];const o=yt(t,"size"),a=gt(t,"reference-size"),l=gt(t,"spike");if(o){let n=o.field;n||(n=(gt(t,"size")||{}).field);const r=J(e,n);i.push({field:n,expression:r?void 0:o.valueExpression,expressionTitle:r?void 0:o.valueExpressionTitle,simpleFieldType:n&&r?.simpleFieldType?r.simpleFieldType:U.NUMBER})}else a?i.push({field:a.field,simpleFieldType:U.NUMBER}):l&&i.push({field:l.field,simpleFieldType:U.NUMBER})}}return i}function Fe(e,t,i=!1){if(!e||t&&5!==t.length)return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!1,visibleElements:{interactiveTrack:!0}};switch(e){case"high-to-low":case"above":case"below":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!1,visibleElements:{interactiveTrack:!0}};case"above-and-below":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!0,syncedSegmentsEnabled:!i,visibleElements:{interactiveTrack:!i}};case"centered-on":case"extremes":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!0,syncedSegmentsEnabled:!0,visibleElements:{interactiveTrack:!0}}}}function Ee(e){const{mapView:t}=e,i=t.map?.basemap?.baseLayers?.getItemAt(0);if(!i)return"topo";if(!i.url)return"esri.layers.OpenStreetMapLayer"===i.declaredClass?"osm":"topo";const n=i.url.toLowerCase();return n.includes("arcgis/rest/services/World_Street_Map".toLowerCase())?"streets":n.includes("ArcGIS/rest/services/Canvas/World_Light_Gray_Base".toLowerCase())?"gray":n.includes("arcgis/rest/services/World_Topo_Map".toLowerCase())||n.includes("arcgis/rest/services/USGSTopo".toLowerCase())?"topo":n.includes("ArcGIS/rest/services/World_Terrain_Base".toLowerCase())?"terrain":n.includes("arcgis/rest/services/NatGeo_World_Map".toLowerCase())?"national-geographic":n.includes("arcgis/rest/services/Ocean/World_Ocean_Base".toLowerCase())?"oceans":n.includes("arcgis/rest/services/World_Imagery".toLowerCase())?"satellite":n.includes("ArcGIS/rest/services/Reference/World_Boundaries_and_Places".toLowerCase())?"hybrid":n.includes("arcgis/rest/services/Canvas/World_Dark_Gray_Base".toLowerCase())?"dark-gray":"topo"}function Ie(e,t,i){if(!(0,E.i)(t)||!(0,E.i)(i))return;const n=e[0].value,r=e[e.length-1].value,s=.3*(r-n);return{min:n-s>t?n-s:void 0,max:r+s<i?r+s:void 0,minMaxSame:n===r}}function Se(e){const{layer:t}=e,i=t,{useFeatureReduction:n}=e;return"featureReduction"in i&&n?i.featureReduction.renderer:i.renderer}function xe(e,t){const i=Se(e),n="authoringInfo"in i?i.authoringInfo:void 0,r=gt(Se(e),"color"),s=gt(Se(e),"size"),o=gt(Se(e),"reference-size"),a=gt(Se(e),"spike");return o&&"size"===t?"reference-size":a&&"size"===t?"spike":("color"===t?r?.theme:"size"===t?s?.theme:n?.univariateTheme||r?.theme||s?.theme)||""}function Re(e,t){const{layer:i,mapImageSublayer:n}=e;if("geo-rss"===i.type){const e=i;e.pointSymbol=e.pointSymbol.clone(),e.lineSymbol=e.lineSymbol.clone(),e.polygonSymbol=e.polygonSymbol.clone()}else(function(e,t){const{layer:i,useFeatureReduction:n}=e;"featureReduction"in i&&"binning"===i.featureReduction?.type&&n?i.featureReduction.renderer=t:!n&&"renderer"in i&&(i.renderer=t)})(e,(t||Se(e)).clone()),n&&(n.renderer=(t||Se(e)).clone())}function Ne(e,t,i){const{layer:n}=e;i&&"featureReduction"in n&&(n.featureReduction=null),Re(e,f.fromJSON(t)),i&&"featureReduction"in n&&(n.featureReduction=i)}function ze(e){let t,i;for(t=0;t<e.length;t++){const n=e[t].symbol;for(i=0;i<e.length;i++){const r=e[i].symbol;if(t!==i&&ke(n,r))return!0}}return!1}function ke(e,t){return"picture-marker"!==e.type&&("cross"===e.style||"x"===e.style?"cross"===t.style||"x"===t.style?!e.outline.color&&!t.outline.color||e.outline.color&&t.outline.color&&e.outline.color.toString()===t.outline.color.toString():!e.outline.color&&!t.color||e.outline.color&&t.color&&e.outline.color.toString()===t.color.toString():"cross"===t.style||"x"===t.style?!e.color&&!t.outline.color||e.color&&t.outline.color&&e.color.toString()===t.outline.color.toString():!e.color&&!t.color||e.color&&t.color&&e.color.toString()===t.color.toString())}function Ce(e,t){const i=Se(e),n=be(e);if(["unique-size","unique-size-age"].includes(n))return null;let r;const s=yt(i,"color"),o=i.classBreakInfos?i.classBreakInfos:i.uniqueValueInfos;let a;return s?(a=s.stops.map(e=>e.color),r=p.getMatchingSchemes({theme:t||"high-to-low",colors:a,geometryType:C(e)||he})):o&&o.length>=1&&(a=o?o.map(e=>He(e.symbol)).filter(e=>e):null,a?.length&&(a.length>10&&(a=a.slice(0,9)),r=function(e,t,i){let n=p.getMatchingSchemes({theme:i||"high-to-low",colors:t,geometryType:C(e)||he});return i&&(!n||n&&!n.length)&&(n=p.getMatchingSchemes({theme:"high-to-low",colors:t,geometryType:C(e)||he})),(!n||n&&!n.length)&&(n=p.getMatchingSchemes({theme:"above-and-below",colors:t,geometryType:C(e)||he})),n}(e,a,t))),r?.length?r[0]:null}function Me(e){const{mapView:t}=e,i=Se(e).uniqueValueInfos;if(!i||i.length<2)return null;const n=Math.sqrt(i.length),r=h.getSchemes({basemap:t.map?.basemap||"topo",geometryType:C(e)}),s=[r.primaryScheme].concat(r.secondarySchemes),o=[];return s.forEach(e=>{let t=[];e.colorsForClassBreaks[n-2].colors.forEach(e=>{t=t.concat(a.clone(e))}),i.some(e=>{const i=He(e.symbol);return!!i&&!t.find(e=>De(e,i))})||o.push(e)}),o.length?o[0]:null}function Ve(e,t){const{mapView:i}=e,n=Se(e);if(!n.uniqueValueInfos||n.uniqueValueInfos.length<2)return null;return Oe(e,d.getSchemes({basemap:i.map?.basemap,geometryType:C(e)||he,numColors:t??n.uniqueValueInfos.length}))}function Be(e){const{mapView:t}=e,i=Se(e);if(!i.uniqueValueInfos||i.uniqueValueInfos.length<2)return null;return Oe(e,g.getSchemes({basemap:t.map?.basemap,geometryType:C(e),numColors:10}))}function _e(e){const{mapView:t}=e,i=Se(e);if(!i.attributes||i.attributes.length<2)return null;return Oe(e,y.getSchemes({basemap:t.map?.basemap,geometryType:C(e),numColors:10}))}function Le(e){const{mapView:t}=e,i=Se(e).colorStops.filter((e,t)=>t>=3).map(e=>e.color),n=m.getSchemes({basemap:t.map?.basemap||"topo"}),r=[n.primaryScheme].concat(n.secondarySchemes),s=[];return r.forEach(e=>{i.some((t,i)=>!De(e.colors[i],t))||s.push(e)}),s.length?s[0]:null}function Oe(e,t){const i=Se(e).uniqueValueInfos;if(!i||i.length<2)return null;const n=Pe(t,Math.min(i.length,10)),r=[];return n.forEach(e=>{i.filter((e,t)=>t<10).some((t,i)=>{const n=He(t.symbol);return!!n&&!De(e.colors[i],n)})||r.push(e.scheme)}),r.length?r[0]:null}function qe(e){const{mapView:t}=e;return d.getSchemes({basemap:t.map?.basemap,geometryType:C(e)||he}).primaryScheme}function De(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b}function Pe(e,t){const i=Ae(e),n=[];return i.forEach(e=>{const i=t>0,r=!!e.colorsForClassBreaks;let s;s=i&&r?function(e,t){const i=e.length;let n=[];for(let r=0;r<i;r++){const i=e[r];if(t<i.numClasses)break;n=i.colors}return n}(e.colorsForClassBreaks,t):e.colors,n.push({colors:s,scheme:e})}),n}function Ue(e){const t=Ae(e);let i=[];return t.forEach(e=>{e.colors&&(i=i.concat(e.colors))}),function(e){const t={};return e.filter(e=>{const i=!t[e.toHex()];return i&&(t[e.toHex()]=1),i})}(i)}function Ae(e){return[e.primaryScheme].concat(e.secondarySchemes)}function Ge(e,t){const i=d.getSchemes({theme:"default",basemap:Ee(e),geometryType:C(e)}).primaryScheme;let n;if(M(e)||t&&["size","color-size","color-age-size","color-size-age","color-age-size-age","type-size","predominance-size","chart-size","relationship-size"].includes(t)){const e=new b.default({style:"solid",color:new l.default(i.outline.color),width:i.outline.width});n=new u.default({style:"circle",size:i.size,outline:e,color:i.noDataColor})}else if(V(e)){const e=new b.default({style:"solid",color:new l.default(i.outline.color),width:i.outline.width});n=new v.default({style:"solid",outline:e,color:i.noDataColor})}else B(e)&&(n=new b.default({style:"solid",color:new l.default(i.noDataColor),width:i.width}));return n}function Je(e,t){const i=d.getSchemes({theme:"default",basemap:Ee(e),geometryType:"line"===t?"polyline":t}).primaryScheme;let n;if("point"===t){const e=new b.default({style:"solid",color:new l.default(i.outline.color),width:i.outline.width});n=new u.default({style:"circle",size:i.size,outline:e,color:i.noDataColor})}else if("polygon"===t){const e=new b.default({style:"solid",color:new l.default(i.outline.color),width:i.outline.width});n=new v.default({style:"solid",outline:e,color:i.noDataColor})}else"line"===t&&(n=new b.default({style:"solid",color:new l.default(i.noDataColor),width:i.width}));return n}function We(){return new v.default({color:[184,184,184,1],style:"solid",outline:{type:"simple-line",color:"white",width:1}})}function je(e){if(!e)return!1;let t=!1;const i=He(e);if(e&&"esri.symbols.SimpleFillSymbol"===e.declaredClass){const n=e.outline;(!i||0===i.a)&&(!n||n&&!n.color||0===n.color.a)&&(t=!0)}else if(e&&"esri.symbols.SimpleLineSymbol"===e.declaredClass)(!i||0===i.a)&&(t=!0);else if(e&&"esri.symbols.SimpleMarkerSymbol"===e.declaredClass){const n=e.outline;(!i||0===i.a)&&(!n||n&&!n.color||0===n.color.a)&&(t=!0)}return t}function $e(e){return!!e&&"dark"===T.getContrastingBackgroundTheme(e,245)}function He(e){return"cim"===e?.type?l.default.fromJSON(w.getCIMSymbolColor(e)?.toJSON()):"simple-marker"===e?.type&&["x","cross"].includes(e?.style)?e?.outline?.color:e?.color}function Qe(e,t){"picture-marker"!==e.type&&("cim"===e.type?w.applyCIMSymbolColor(e,t):"simple-marker"===e.type&&e.style&&["cross","x"].includes(e.style)?(e.outline||(e.outline=new __esri.SimpleLineSymbol),e.outline.color=t):e.color=t)}function Ze(e,t){return e&&(e.a=t),e}function Ke(e){return"cim"===e.type?w.getCIMSymbolSize(e):e.size?e.size:e.width}function Xe(e,t){if("cim"===e.type)w.scaleCIMSymbolTo(e,t);else if((0,E.i)(e.size))e.size=t;else{const i=e.height/e.width;e.width=t,e.height=e.width*i}}function Ye(e){return e.data.symbol.symbolLayers?.find(e=>["CIMSolidStroke","CIMPictureStroke"].includes(e.type))?.width??0}function et(e){return"cim"===e.type?w.getCIMSymbolRotation(e,!0):["simple-marker","picture-marker"].includes(e.type)?e.angle:void 0}function tt(e,t){null!=t&&("cim"===e.type?w.applyCIMSymbolRotation(e,t,!0):["simple-marker","picture-marker"].includes(e.type)&&(e.angle=t))}function it(e){return"picture-marker"!==e.type&&("cim"===e.type?["CIMPolygonSymbol"].includes(e.data.symbol.type)&&!!ot(e):!!e.outline?.color)}function nt(e,t){if(e.uniqueValueInfos?.length){const i=e.uniqueValueInfos.slice();i.forEach(e=>{const i=t.clone();Qe(i,He(e.symbol)),e.symbol=i}),e.uniqueValueInfos=i}else if(e.classBreakInfos?.length){const i=e.classBreakInfos.slice();i.forEach(e=>{const i=t.clone();Qe(i,He(e.symbol)),e.symbol=i}),e.classBreakInfos=i}else if(e.symbol){const i=t.clone();Qe(i,He(e.symbol)),e.symbol=i}}function rt(e,t){if(e.uniqueValueInfos?.length){const i=e.uniqueValueInfos.slice();i.forEach(e=>{const i=t.clone();Qe(i,He(e.symbol)),e.symbol=i}),e.uniqueValueInfos=i}else if(e.classBreakInfos?.length){const i=e.classBreakInfos.slice();i.forEach(e=>{const i=t.clone();Qe(i,He(e.symbol)),e.symbol=i}),e.classBreakInfos=i}else if(e.symbol){const i=t.clone();Qe(i,He(e.symbol)),e.symbol=i}}function st(e){return"cim"===e.type&&"CIMLineSymbol"===e.data.symbol?.type}function ot(e){return"CIMPointSymbol"===e.data.symbol?.type?function(e){return e.data.symbol.symbolLayers.find(e=>"CIMSolidStroke"===e.type)}(e):"CIMLineSymbol"===e.data.symbol?.type?function(e){return e.data.symbol.symbolLayers[0]}(e):"CIMPolygonSymbol"===e.data.symbol?.type?function(e){return e.data.symbol.symbolLayers.find(e=>"CIMSolidStroke"===e.type)}(e):void 0}function at(e){const{mapImageSublayer:t,layer:i}=e;return!t||!!i.sourceJSON?.cimVersion}function lt(e){return!(!e.style||!["cross","x"].includes(e.style))}function ct(e){return"picture-marker"===e.type||"cim"===e.type&&!function(e){return!!w.getCIMSymbolColor(e)}(e)}function ut(e,t){return"simple-line"===e.type?{width:12,height:3}:"cim"===e.type&&"CIMLineSymbol"===e.data.symbol.type?void 0:"simple-fill"===e.type?14:"cim"===e.type&&"CIMPolygonSymbol"===e.data.symbol.type?t?18:void 0:"cim"===e.type?20:14}function pt(e,t){if(e.type!==t.type)return{hasOtherChanges:!0,any:!0};const i=et(e)!==et(t),n=Math.abs(Ke(e)-Ke(t))>.01,r=JSON.stringify(He(e)?.toJSON())!==JSON.stringify(He(t)?.toJSON()),s=!!["simple-marker","simple-fill"].includes(e.type)&&JSON.stringify(e.outline?.toJSON())!==JSON.stringify(t.outline?.toJSON()),o=e.clone();Xe(o,Ke(t)),Qe(o,He(t)),["simple-marker","simple-fill"].includes(e.type)&&(o.outline=t.outline.clone()),tt(o,et(t));const a=!function(e,t){return JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON())||"cim"===e.type&&"cim"===t.type&&ft(e.toJSON().symbol,t.toJSON().symbol)}(o,t);return{rotation:i&&!n&&!r&&!s&&!a,size:n&&!i&&!r&&!s&&!a,outline:s&&!i&&!n&&!r&&!a,color:r&&!i&&!n&&!s&&!a,other:a,any:i||n||s||r||a}}function dt(e,t,i,n){return n.rotation?tt(e,et(t)):n.size?Xe(e,Ke(t)):n.color?("picture-marker"===e.type&&(e=t.clone()),Qe(e,i)):n.outline?"picture-marker"===e.type?e=t.clone():e.outline=t.outline?.clone():Qe(e=t.clone(),i),e}function ft(e,t){const i=Object.keys,n=typeof e;return e&&t&&"object"===n&&n===typeof t?i(e).length===i(t).length&&i(e).every(i=>"size"===i||"width"===i?Math.abs(e[i]-t[i])<.01:ft(e[i],t[i])):e===t}function mt(e,t,i){const n=e&&e.visualVariables;return!!n&&n.some(e=>{const n=e.target,r="$view.scale"===e.valueExpression;return e.type===t&&(!(0,E.i)(n)&&!(0,E.i)(i)&&!r||n===i||"auto"===i)})}function yt(e,t,i){const n=e&&e.visualVariables;if(n){const e=n.filter(e=>{const n=e.target,r="$view.scale"===e.valueExpression;return e.type===t&&(!(0,E.i)(n)&&!(0,E.i)(i)&&!r||n===i||"auto"===i&&r&&!n)});if(e.length)return e[0]}}function gt(e,t,i){if(!e?.authoringInfo)return;const n=e?.authoringInfo?.visualVariables;if(n){const e=n.filter(e=>{const n=e.target;return"reference-size"===t?"size"===e.type&&"reference-size"===e.theme:"spike"===t?"size"===e.type&&"spike"===e.theme:e.type===t&&(!(0,E.i)(n)&&!(0,E.i)(i)||n===i)});if(e.length)return e[0]}}function ht(e,t,i){const n=e&&e.visualVariables;if(n){const e=n.filter(e=>{const n=e.target,r="$view.scale"===e.valueExpression;return!(e.type===t&&(!(0,E.i)(n)&&!(0,E.i)(i)&&!r||n===i||"auto"===i&&r))});if(e.length)return e}}function bt(e,t,i){if(!("authoringInfo"in e)||!e.authoringInfo)return;let n=e?.authoringInfo?.visualVariables;if(n){"reference-size"===t&&(n=n.filter(e=>!("size"===e.type&&"reference-size"===e?.theme))),"spike"===t&&(n=n.filter(e=>!("size"===e.type&&"spike"===e?.theme)));const e=n.filter(e=>{const n=e.target;return!(e.type===t&&(!(0,E.i)(n)&&!(0,E.i)(i)||n===i))});if(e.length)return e}}function vt(e,t){const i=ve(e,t),n=yt(t,"size","outline"),r=yt(t,"size","auto"),s=yt(t,"rotation");let o,a;return["predominance","predominance-size"].includes(i)||(o=yt(t,"opacity"),a=gt(t,"opacity")),{sizeOutlineVisVar:n,sizeAutoVisVar:r,opacityVisVar:o,authOpacityVisVar:a,rotationVisVar:s}}function Tt(e,t,i){const{sizeOutlineVisVar:n,opacityVisVar:r,authOpacityVisVar:s,rotationVisVar:o}=e;!gt(t,"reference-size")&&n&&(t.visualVariables=ht(t,"size","outline")||[],t.visualVariables.push(n)),r&&s&&!i?.notOpacity&&(t.visualVariables=ht(t,"opacity")||[],t.visualVariables.push(r),t.authoringInfo=t.authoringInfo||{},t.authoringInfo.visualVariables=bt(t,"opacity")||[],t.authoringInfo.visualVariables.push(s)),o&&(t.visualVariables=t.visualVariables||[],t.visualVariables.push(o))}var wt=(e=>(e[e.RED=0]="RED",e[e.GREEN=1]="GREEN",e[e.BLUE=2]="BLUE",e))(wt||{}),Ft=(e=>(e.NONE="none",e.MINIMUM_MAXIMUM="min-max",e.PERCENT_CLIP="percent-clip",e.STANDARD_DEVIATION="standard-deviation",e))(Ft||{});const Et={STD_DEV:2,MIN_PERCENT:2,MAX_PERCENT:2,GAMMA:1,STRETCH_TYPE:"none"};async function It(e){const{layer:t}=e,i=t,n="imagery"===i.type?i.rasterFunction:void 0;return i.bandIds=await Rt(e),await F.createRenderer({layer:i,rasterFunction:n,rgbBandIds:i.bandIds})}async function St(e,t){const{layer:i}=e,n=i,r=oe(e),s="imagery"===n.type?n.rasterFunction:void 0;return t=t||{},await F.createRenderer({layer:n,rasterFunction:s,rgbBandIds:n.bandIds,stretchType:t.stretchType||r.stretchType,useGamma:t.useGamma||r.useGamma,gamma:t.gamma||r.useGamma?r.gamma:[1,1,1]}).then(e=>(e.renderer.dynamicRangeAdjustment=r.dynamicRangeAdjustment,e.renderer.colorRamp=r.colorRamp,e.renderer.customStatistics=r.customStatistics,(!_(e.renderer.numberOfStandardDeviations)||0===e.renderer.numberOfStandardDeviations)&&(e.renderer.numberOfStandardDeviations=Et.STD_DEV),e))}function xt(e,t){const{layer:i,rasterInfo:n}=e,r=i,s=t?"raster-stretch"===t.renderer.type:"raster-stretch"===oe(e)?.type;if(!s)return!1;const o=t?t.bandIds:r.bandIds,a=!!(o&&o.length>1),l=n.bandCount>1,c=t?t.renderer.gamma?.length>1:oe(e).gamma?.length>1;return s&&(a||l&&c)}async function Rt(e){const{layer:t,rasterInfo:i}=e,n=t,{bandCount:r}=i,s=a.clone(await c.getDefaultBandCombination({layer:n}))??[0],o=s.length;return 3!==o&&s.push(...new Array(3-o).fill(r-1)),s}async function Nt(e){const{layer:t}=e,i=t,r="imagery"===i.type?i.rasterFunction??void 0:void 0;return await n.createRenderer({layer:i,rasterFunction:r})}async function zt(e,t){const{layer:i}=e,r=i,s=oe(e),o="imagery"===r.type?r.rasterFunction??void 0:void 0;return t=t||{},await n.createRenderer({layer:r,rasterFunction:o,classFieldName:t.field||s.field,colorRamp:t.colorRamp??null})}function kt(e){const{rasterInfo:t,_messages:i}=e;let n;const s=t?.attributeTable?.fields;return n=s?s.filter(e=>"oid"!==e.type):[new r.default({name:"value",alias:i.panels.uniqueValue.value})],n}},42855:(e,t,i)=>{i.d(t,{a:()=>o,f:()=>n,l:()=>r,s:()=>s});var n=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(n||{}),r=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(r||{}),s=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(s||{}),o=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(o||{})},66228:(e,t,i)=>{i.d(t,{a:()=>b,b:()=>x,c:()=>k,d:()=>S,e:()=>R,f:()=>M,g:()=>g,h:()=>h,i:()=>m,j:()=>y,k:()=>w,l:()=>C,m:()=>E,n:()=>d,o:()=>F,p:()=>_,q:()=>z,r:()=>B,s:()=>T,t:()=>I,u:()=>v});var n=i(63438),r=i(18423),s=i(96086),o=i(91813),a=i(21255),l=i(13078),c=i(21303),u=i(12627),p=i(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],f=["feature"];function m(e){return null!=e}function y(e,t,i){const n=t.fieldName;if(n.includes(p.f.expression)){const e=i.get(n);return e?.title?e.title:n}return T(e)&&e.getFieldConfiguration(n)?e.getFieldAlias(n)||n:t.label||n}async function g(e){return new Map((await w(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function h(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${p.f.expression}${e.name}`;t.set(i,e)}),t}function b(e){return"map-image"===e?.layer?.type?p.s.mapImage:"subtype-sublayer"===e?.type?p.s.subtype:"tile"===e?.layer?.type?p.s.tile:"scene"===e?.type?p.s.scene:"ogc-feature"===e?.type?p.s.ogcFeature:"imagery"===e?.type?p.s.imagery:"imagery-tile"===e?.type?p.s.imageryTile:"wfs"===e?.type?p.s.wfs:"wcs"===e?.type?p.s.wcs:"wms"===e?.layer?.type?p.s.wms:"csv"===e?.type?p.s.csv:"geojson"===e?.type?p.s.geojson:"stream"===e?.type?p.s.stream:"oriented-imagery"===e?.type?p.s.orientedImagery:"catalog"===e?.type?p.s.catalog:"catalog-footprint"===e?.type?p.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?p.s.knowledgeGraphSublayer:"voxel"===e?.type?p.s.voxel:"parquet"===e?.type?p.s.parquet:p.s.feature}function v(e){const t=b(e);let i;return t===p.s.wms||t===p.s.mapImage?i=e?.layer.version:(t===p.s.imagery||t===p.s.feature||t===p.s.scene)&&(i=e.version),Number.parseFloat(i)}function T(e){return"fieldConfigurations"in e&&f.includes(e.type)}async function w(e){return await new Promise((t,i)=>{switch(b(e)){case p.s.feature:case p.s.ogcFeature:case p.s.stream:t(e.fields);break;case p.s.mapImage:{const n=e,r=n?.layer;r?.portalItem&&r.url.includes("https://demographics")&&r.url.includes(".arcgis.com")?r.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(n.fields.map(e=>[e.name,e])),r=e.thematicGroup.fieldNames,s=[];r.forEach(e=>{i.has(e)&&s.push(i.get(e))}),t(s)}else t(n.fields)}).catch(e=>{i(new Error(e))}):t(n.fields);break}case p.s.imagery:case p.s.imageryTile:case p.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function F(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function E(e){return Number((100*(1-e)).toFixed(1))}function I(e){return Number((1-e/100).toFixed(3))}const S=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(p.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},x=async(e,t)=>{const i=new u.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},R=async(e,t,i)=>{const n=await(await e.whenLayerView(t)).queryAggregates();return await N(i,n.features?.[0])},N=async(e,t)=>{let i;if(t)i=t.clone();else{i=new n.default;const t=S(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const s=new r.default;i.geometry=s}return i};function z(e,t){const i=t.startsWith("#"),n=t.startsWith(".");for((n||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(n){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function k(e){if(b(e)===p.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(b(e)===p.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function C(e,t,i){let n="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))n="number";else if(t.has(e)){const i=t.get(e);n=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);n=t.returnType?t.returnType.toLowerCase():""}else n="number";return n}async function M(e,t){try{const i=b(e);if(i===p.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await x(e,t)||await V(e,t)]};if(i===p.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await V(e,t)]};const n=i===p.s.ogcFeature||i===p.s.stream?await t.whenLayerView(e):e,r=n.createQuery();r.where=n.definitionExpression||"1=1",r.outFields=["*"],r.returnM="hasM"in e&&e.hasM,r.returnZ="hasZ"in e&&e.hasZ,r.outSpatialReference=t.spatialReference,r.returnGeometry=!0,(n.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===p.s.ogcFeature)&&(r.start=0,r.num=1),r.outSpatialReference=t.spatialReference;const s=await n.queryFeatures(r);return s?.features?.length||(s.features[0]=await V(e,t)),s}catch(e){console.error(e)}}async function V(e,t){return await new Promise(i=>{const r=new n.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),r.attributes=t}const c=t.extent;let u;"polygon"===e.geometryType?u=a.default.fromExtent(c):"point"===e.geometryType?u=c.center.clone():"multipoint"===e.geometryType?u=new s.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(u=new o.default({spatialReference:t.spatialReference.clone()}),u.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(u=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),r.geometry=u,i(r)})}function B(e){return b(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function _(e){return b(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);