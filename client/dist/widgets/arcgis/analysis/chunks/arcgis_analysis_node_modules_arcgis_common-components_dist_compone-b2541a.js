/*! For license information please see arcgis_analysis_node_modules_arcgis_common-components_dist_compone-b2541a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_common-components_dist_compone-b2541a"],{10674:(e,t,i)=>{i.r(t),i.d(t,{ArcgisCommonSqlExpressionConfigCondition:()=>G});var s=i(22229),a=i(4395),n=i(46317),r=i(73801),o=i(85643),l=i(75430),u=i(24457),c=i(72349),d=i(74968),p=i(52797),h=i(5294),m=i(54312),v=i(20936),g=i(90732),f=i(51546),y=i(12762),$=i(80666),b=i(53550),I=i(24186);i(34031),i(43284);const S="field-selection",C="delete-action",N="filter-condition",q="operator-dropdown",T="input-plus-unique",E="input-plus-unique-date",V="input",O="label",F="blank-button",D="select-unique-button",P="between-values-input",x="select-values",U="list",M="unique-values-content-list-msg",A="in-the-last",w="in-the-last-count",k="in-the-last-unit",L="date-picker",R="histogram-content",_="small-loader",B="time-zone",H="time-zone-icon",Z=a.AH`.field-selection{display:flex;align-items:normal}.delete-action{padding:0 0 0 4px}:dir(rtl){.delete-action{padding:0 4px 0 0}}.operator-dropdown{width:100%;margin:5px 0}.input-plus-unique{display:flex;flex-direction:row;width:100%}.input-plus-unique-date,.input{width:100%}.blank-button{height:22px;border:var(--calcite-color-border-input) 1px solid}.blank-button.active{cursor:pointer}.blank-button.inactive:focus{outline:none}.select-unique-button{height:32px;border-top:var(--calcite-color-border-input) 1px solid;border-bottom:var(--calcite-color-border-input) 1px solid;border-right:var(--calcite-color-border-input) 1px solid}:dir(rtl){.select-unique-button{border-right:none;border-left:var(--calcite-color-border-input) 1px solid}}.between-values-input.first{margin-bottom:5px}.select-values{margin-bottom:4px}.field-button-trash{inline-size:calc(100% - 36px)}.list{max-height:200px;overflow-y:auto}.unique-values-content-list-msg{font-size:90%;margin-top:5px;margin-bottom:5px}.in-the-last{display:flex}.in-the-last-count,.in-the-last-unit{width:50%}.date-picker{width:100%}.date-picker.first{margin-bottom:5px}.label{margin-top:10px}.time-zone{margin-top:5px}.time-zone-icon{opacity:60%}.histogram-content{height:120px;overflow:hidden;margin:var(--calcite-spacing-xs) calc(-1 * var(--calcite-spacing-xl)) calc(-1 * var(--calcite-spacing-md-plus)) calc(-1 * var(--calcite-spacing-xl));padding:0 var(--calcite-spacing-xl) var(--calcite-spacing-md-plus) var(--calcite-spacing-xl)}.histogram-content.slim{height:40px}.small-loader{margin-left:calc((100% - 16px)/2);margin-top:10px}calcite-input-time-zone[read-only]{--calcite-color-border-input: transparent;--calcite-color-background: transparent;--calcite-font-weight-medium: normal;pointer-events:none;margin-left:-10px}:dir(rtl){.small-loader{margin-left:auto;margin-right:8px}calcite-input-time-zone[read-only]{margin-left:auto;margin-right:-10px}}`;class G extends r.WF{constructor(){super(),this.fieldNode=(0,o._)(),this.uniqueSelectNode=(0,o._)(),this.uniqueListNode=(0,o._)(),this.histogramSlider=void 0,this.isEditorField=!1,this.timeNode=(0,o._)(),this.timeNode2=(0,o._)(),this.debouncedOnValueChange=(0,g.s)(e=>this.onValueChange(e),500),this.debouncedOnValueChangeMaybe=(0,g.s)(e=>this.onValueChangeMaybe(e),500),this.debouncedOnValue2ChangeMaybe=(0,g.s)(e=>this.onValue2ChangeMaybe(e),500),this.hasFocus=!1,this.showDelete=!1,this.arcgisChanged=(0,r.lh)(),this.arcgisDeleted=(0,r.lh)(),this.arcgisDisablePanel=(0,r.lh)(),this.arcgisValuesReturned=(0,r.lh)(),this.constructor.K.c=void 0,this.listenOn(window,"arcgisValuesReturned",this.arcgisValuesReturnedHandler)}static{this.properties={props:0,uid:1,fieldName:[0,{attribute:"field"}],operator:1,uniqueValuesSortBy:[0,{attribute:"sort-by"}],value:1,value2:1,values:0,unit:0,histogramClosed:5,hasFocus:[4,{attribute:"focus"}],invalidValue:1,showDelete:5}}static{this.styles=Z}async onEdits(){this.onDisplayUniqueValues(this.fieldName)}async closePopover(){if(this.removeFieldPickList(),this.uniquePopoverNode){const e=this.uniquePopoverNode.referenceElement;this.removeUniquePopover(),e?.setFocus()}}async load(){const e=(0,I.r)({fields:this.props.fields});this.fieldName=this.fieldName||e.layerField.name,this.operator=this.operator||(0,I.s)(this.props,e),this.hasFocus=!!this.hasFocus}loaded(){(function(e){if(!e||!y.default)return;let t=y.default.assetsPath;t.endsWith("/")||(t+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${t}esri/themes/light/main.css" />`)})(this.el.shadowRoot),this.setFocus()}disconnectedCallback(){super.disconnectedCallback(),this.removeFieldPickList(),this.removeUniquePopover()}_setUniqueActionNode(e){e&&(this.uniqueActionNode=e)}_setDateNode(e){e&&(this.dateNode=e)}_setDateNode2(e){e&&(this.dateNode2=e)}setFocus(){setTimeout(()=>{this.el.querySelector(".autofocus")?.setFocus()},500)}onValueChange(e,t){t=t??this.getNewValue(e);const{props:i,fieldName:s,operator:a,value:n,value2:r}=this,{layer:o,view:l}=i,u=(0,I.g)(s,i),c=e;if(t=e?this.getNewValue(e):t,!(0,$.i)(t)&&(t=(0,I.t)(i,u,a).value,c))if(u.simpleFieldType===$.s.DATE){const e=(0,b.f)(t,l?.timeZone,"preferredTimeZone"in o?o.preferredTimeZone??void 0:void 0);if("CALCITE-INPUT-DATE-PICKER"===c.tagName)c.value=e;else{const t=(0,b.e)(e);t&&(c.value=t)}}else u.simpleFieldType===$.s.DATE_ONLY?c.value=(0,b.u)(t):u.simpleFieldType===$.s.TIME_ONLY?c.value=(0,b.a)(t):c.value=(0,$.i)(t)?`${t}`:"";if(n!==t){if((0,$.i)(t)&&(0,I.i)(i,a)&&t>=r&&c)if(u.simpleFieldType===$.s.DATE)if(t=r-1e3,"CALCITE-INPUT-TIME-PICKER"===c.tagName){const e=(0,b.f)(t,l?.timeZone,"preferredTimeZone"in o?o.preferredTimeZone??void 0:void 0),i=(0,b.e)(e);i&&requestAnimationFrame(()=>c.value=i)}else c.value=(0,b.f)(t,l?.timeZone,"preferredTimeZone"in o?o.preferredTimeZone??void 0:void 0);else if(u.simpleFieldType===$.s.DATE_ONLY){const e=new Date(r-864e5);c.value=(0,b.u)(e),t=e.getTime()}else u.simpleFieldType===$.s.TIME_ONLY?(t=r-1e3,requestAnimationFrame(()=>c.value=(0,b.a)(t))):(t=r-1,c.value=`${t}`);("CALCITE-INPUT-DATE-PICKER"===c?.tagName||"CALCITE-INPUT-TIME-PICKER"===c?.tagName||"CALCITE-INPUT"===c?.tagName&&"number"===c?.type||"CALCITE-INPUT-NUMBER"===c?.tagName)&&this.adjustHistogramMinMax(t),this.changeValues(t,r)}}onValueChangeMaybe(e){const{props:t,operator:i,value2:s}=this,a=this.getNewValue(e);(0,$.i)(a)&&(0,I.i)(t,i)&&a>=s||this.onValueChange(e,a)}onValue2ChangeMaybe(e){const{props:t,operator:i,value:s}=this,a=this.getNewValue(e);(0,$.i)(a)&&(0,I.i)(t,i)&&a<=s||this.onValue2Change(e,a)}handleRemoveSelectedValue(e){const{values:t}=this,i=t.indexOf(e);t.splice(i,1),this.emitChangeEvent({values:t.length?(0,h.clone)(t):null,histogramClosed:this.histogramClosed}),this.requestUpdate()}handleFieldPickListChange(e){this.removeFieldPickList(),e&&this.afterFieldSelect(e)}arcgisValuesReturnedHandler(e){const t=e.detail;this.fieldName===t&&(this.checkDefaultValues((0,I.g)(t,this.props)),this.requestUpdate())}afterCreateSliderDiv(e){const{fieldName:t,props:i,histogramSlider:s}=this;e&&setTimeout(()=>{if(!s)return;const a=document.createElement("div");if(e.appendChild(a),s.container){const e=(0,I.g)(t,i);if(!e)return;const{bins:n,average:r,min:o,max:l,values:u,precision:c,rangeType:p}=s,h={container:a,bins:n,average:r,min:o,max:l,values:u,precision:c,rangeType:p};[$.s.DATE,$.s.DATE_ONLY,$.s.TIME_ONLY].includes(e.simpleFieldType)&&(h.hasTimeData=!0,this.addDateFormatFunctions(h,e)),this.destroyHistogramSlider(),this.histogramSlider=new d.default(h),this.createSliderChangeEvents(e)}else s.container=a},1)}onFieldSelect(){this.hasFocus=!0,this.openFieldPickList()}onOperatorSelect(e){const{props:t,fieldName:i,operator:s,value:a,value2:n}=this,r=e.target.selectedOption.value,o=(0,I.g)(i,t),l=(0,I.b)(t,s),u=(0,I.b)(t,r),c=l||u,d=l&&u,p=(0,I.i)(t,s),h=(0,I.i)(t,r),m=p&&h,v={value:a,value2:n,operator:s};this.value=(c&&!d?void 0:o.statistics&&!(0,$.i)(a)?o.statistics.avg:a)??void 0,this.value2=(h?n??((0,I.u)(o)&&o.statistics?.max?Math.round(o.statistics?.max):o.statistics?.max):c||!m?void 0:n)??void 0,this.operator=r;const g=this.checkDefaultValues(o),f={value:this.value??g.value,value2:this.value2??(h?g.value2:null),operator:this.operator,unit:this.unit||g.unit,histogramClosed:this.histogramClosed};this.value=v.value,this.value2=v.value2,this.operator=v.operator,this.emitChangeEvent(f)}onValue2Change(e,t){const{value:i,props:s,fieldName:a,operator:n}=this,{layer:r,view:o}=s,l=(0,I.g)(a,s),u=e;if(t=t??this.getNewValue(e)??void 0,!(0,$.i)(t))if(t=(0,I.t)(s,l,n).value2,l.simpleFieldType===$.s.DATE){const e=(0,b.f)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0);if("CALCITE-INPUT-DATE-PICKER"===u.tagName)u.value=e;else{const t=(0,b.e)(e);t&&(u.value=t)}}else l.simpleFieldType===$.s.DATE_ONLY?u.value=(0,b.u)(t):l.simpleFieldType===$.s.TIME_ONLY?u.value=(0,b.a)(t):u.value=(0,$.i)(t)?`${t}`:"";if((0,$.i)(t)&&t<=i)if(l.simpleFieldType===$.s.DATE)if(t=i+1e3,"CALCITE-INPUT-TIME-PICKER"===u.tagName){const e=(0,b.f)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0),i=(0,b.e)(e);i&&requestAnimationFrame(()=>u.value=i)}else u.value=(0,b.f)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0);else if(l.simpleFieldType===$.s.DATE_ONLY){const e=new Date(i+864e5);u.value=(0,b.u)(e),t=e.getTime()}else l.simpleFieldType===$.s.TIME_ONLY?(t=i+1e3,requestAnimationFrame(()=>u.value=(0,b.a)(t))):(t=i+1,u.value=`${t}`);("CALCITE-INPUT-DATE-PICKER"===u.tagName||"CALCITE-INPUT-TIME-PICKER"===u?.tagName||"CALCITE-INPUT"===u.tagName&&"number"===u.type||"CALCITE-INPUT-NUMBER"===u?.tagName)&&this.adjustHistogramMinMax(t),this.changeValues(i,t)}onUnitSelect(e){const t=e.target;this.emitChangeEvent({unit:t.selectedOption.value,histogramClosed:this.histogramClosed})}onSelectUniqueValue(e){e.stopPropagation(),this.onSelectUnique(!1)}onSelectUniqueValues(){const{props:e,fieldName:t,operator:i}=this,s=(0,I.g)(t,e),a=(0,I.n)(s),n=(0,I.a)(e,i),r=a&&!n;this.onSelectUnique(!r)}onSelectUnique(e){const{props:t,value:i,values:s,fieldName:n,uid:l,uniqueValuesSortBy:u}=this,{_messages:c}=t;if(this.uniquePopoverNode)return void this.closeFilterPopovers();this.closeFilterPopovers();const d=(0,I.g)(n,t);if(!d)return;const p=this.fieldNode.value?.getBoundingClientRect().width,m=p?p+2:204,v=((0,f.q)(this.el,"calcite-panel")||(0,f.q)(this.el,"calcite-flow-item"))?.clientHeight,g=v?Math.max(Math.min(v/3,400),200):400,y=(0,r.dN)(a.qy`<calcite-popover .label=${c.chooseFromUnique} .id=${`arcgis-common-sql-expression-config-unique-popover_${l}`} placement=bottom-end auto-close offset-distance=0 offset-skidding=0 pointer-disabled overlay-positioning=fixed trigger-disabled .referenceElement=${e?this.uniqueSelectNode.value:this.uniqueActionNode} @calcitePopoverClose=${()=>{if(this.uniquePopoverNode){const e=this.uniquePopoverNode.referenceElement;this.removeUniquePopover(),e?.setFocus()}}}><arcgis-common-sql-expression-config-unique-list .uid=${l} .props=${t} .uniqueValues=${(0,h.clone)(d.uniqueValueInfos)} .selectedValues=${e?s:i?[i]:[]} .fieldDomains=${d.fieldDomains} .layerFieldType=${d.layerField.type} .multiple=${e} .sortBy=${u} .partialUniqueValues=${d.partialUniqueValues} .maxHeight=${g} style=${(0,r.zl)({width:`${m}px`})} @arcgisChanged=${e=>{const{detail:t}=e;if(t.uid===this.uid){const e=t.selectedValues;if(t.multiple)this.emitChangeEvent({values:e,uniqueValuesSortBy:t.sortBy,histogramClosed:this.histogramClosed});else{this.uniqueValuesSortBy=t.sortBy;let i=e?.length?e[0]:void 0;const{fieldName:s,props:a}=this,n=(0,I.g)(s,a);(0,$.i)(i)&&"string"==typeof i&&n.simpleFieldType===$.s.TIME_ONLY&&(i=(0,b.t)(i)),this.onValueChange(null,i),this.removeUniquePopover(),this.uniqueActionNode?.setFocus()}}}} @arcgisSortByChanged=${e=>{const{detail:t}=e;t.uid===this.uid&&(this.uniqueValuesSortBy=t.sortBy)}} @arcgisDone=${e=>{const{detail:t}=e;t===this.uid&&(this.removeUniquePopover(),this.uniqueActionNode?.setFocus())}} ${(0,o.K)(this.uniqueListNode)}></arcgis-common-sql-expression-config-unique-list></calcite-popover>`);document.body.appendChild(y),this.uniqueListNode.value.requestUpdate(),this.uniqueListNode.value.setFocus(),y.reposition(),this.uniquePopoverNode=y,setTimeout(()=>{y.open=!0},50)}afterCreateList(e){e&&this.scrollExprIntoView(e)}scrollExprIntoView(e){setTimeout(()=>{e&&(e=(0,f.q)(e,".filter-expression"),e?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))},100)}removeUniquePopover(){this.uniquePopoverNode&&(this.uniquePopoverNode.open=!1,this.uniquePopoverNode.remove(),this.uniquePopoverNode=void 0)}async onDisplayUniqueValues(e){const{props:t}=this,{layer:i,view:s,mode:a}=t,n=(0,I.g)(e,t);if(n&&"sublayer"!==i.type&&n.uniqueValuesStatus===$.b.MISSING&&i){n.uniqueValuesStatus=$.b.IN_PROGRESS;try{const r=await(0,c.default)({layer:i,view:s,field:e,sqlWhere:"basic"===a&&"definitionExpression"in i?i.definitionExpression??void 0:void 0,forBinning:"feature-reduction"===a&&["binning","cluster"].includes(i.featureReduction?.type)}),o=(0,I.j)(n),l=r.uniqueValueInfos.filter(e=>!!(0,$.i)(e.value)&&("string"===n.simpleFieldType&&!o||"guid"===n.simpleFieldType?"<Null>"!==e.value&&""!==`${e.value}`.trim():("number"===n.simpleFieldType||n.simpleFieldType,"<Null>"!==e.value&&""!==e.value)));l.sort((e,t)=>e.count>t.count?-1:e.count<t.count?1:0),(0,I.n)(n)&&n.fieldDomains.forEach(e=>{l.find(t=>t.value===e.code)||l.push({value:e.code,count:0})});const u=2e3===r.uniqueValueInfos.length;t.fields=t.fields.map(t=>t.layerField.name===e?{...t,uniqueValueInfos:l,uniqueValuesStatus:$.b.SUCCESS,partialUniqueValues:u}:t),this.arcgisValuesReturned.emit(n.layerField.name)}catch(i){if(console.error("error-uniqueValues",i),(0,I.n)(n)){const i=[];n.fieldDomains.forEach(e=>{i.find(t=>t.value===e.code)||i.push({value:e.code,count:void 0})}),t.fields=t.fields.map(t=>t.layerField.name===e?{...t,uniqueValueInfos:i,uniqueValuesStatus:$.b.SUCCESS,partialUniqueValues:!1}:t)}else t.fields=t.fields.map(t=>t.layerField.name===e?{...t,uniqueValuesStatus:$.b.FAILED}:t);this.requestUpdate()}}}onHistogramBlockToggle(e){e.currentTarget.open?this.onHistogramOpen():this.onHistogramClose()}async onHistogramCollapsed(){const{props:e,fieldName:t}=this;let i=(0,I.g)(t,e);i&&(await this.getSummaryStatistics(),i=(0,I.g)(t,e),this.checkDefaultValues(i))}async onHistogramOpen(){const{props:e,fieldName:t}=this,{layer:i,view:s,mode:a}=e;let n=(0,I.g)(t,e);if(i&&"sublayer"!==i.type&&n){if("subtype-group"===i.type)return e.fields=e.fields.map(e=>e.layerField.name===t?{...e,statisticsStatus:$.b.FAILED,histogramStatus:$.b.FAILED}:e),this.histogramClosed=!0,void this.requestUpdate();if(n.statistics&&n.histogramStatus!==$.b.MISSING)this.checkDefaultValues(n),this.histogramClosed=!1;else{let r=n.statistics;if(r||(e.fields=e.fields.map(e=>e.layerField.name===t?{...e,statisticsStatus:$.b.IN_PROGRESS}:e),r=await this.getSummaryStatistics(),this.checkDefaultValues(n)),n=(0,I.g)(t,e),n.histogramStatus!==$.b.MISSING)return;e.fields=e.fields.map(e=>e.layerField.name===t?{...e,histogramStatus:$.b.IN_PROGRESS}:e);try{const n=await(0,l.default)({layer:i,view:s,field:t,sqlWhere:"basic"===a&&"definitionExpression"in i?i.definitionExpression??void 0:void 0,numBins:30,minValue:r?.min||void 0,maxValue:r?.max||void 0,forBinning:"feature-reduction"===a&&["binning","cluster"].includes(i.featureReduction?.type)});e.fields=e.fields.map(e=>e.layerField.name===t?{...e,histogram:n,histogramStatus:$.b.SUCCESS}:e),this.histogramClosed=!1,this.requestUpdate()}catch(i){console.error("error-histogram",i),e.fields=e.fields.map(e=>e.layerField.name===t?{...e,histogramStatus:$.b.FAILED}:e),this.requestUpdate()}}}}onHistogramClose(){this.histogramClosed=!0}async onMinMaxChange(e,t,i){const{props:s,value:a,value2:n}=this,{layer:r,view:o,mode:u}=s,c=(0,I.g)(i,s);if(c&&"sublayer"!==r.type){this.value=Math.min(Math.max(a,e),t),(0,$.i)(n)&&(this.value2=Math.min(Math.max(n,e),t)),this.histogramClosed=!1,s.fields=s.fields.map(e=>e.layerField.name===i?{...e,histogramStatus:$.b.IN_PROGRESS}:e);try{const a=await(0,l.default)({layer:r,view:o,field:c.layerField.name,sqlWhere:"basic"===u&&"definitionExpression"in r?r.definitionExpression??void 0:void 0,numBins:30,minValue:e,maxValue:t,forBinning:"feature-reduction"===u&&["binning","cluster"].includes(r.featureReduction?.type)});s.fields=s.fields.map(e=>e.layerField.name===i?{...e,histogram:a,histogramStatus:$.b.SUCCESS}:e),this.requestUpdate()}catch(e){console.error("error-histogram",e),s.fields=s.fields.map(e=>e.layerField.name===i?{...e,histogramStatus:$.b.FAILED}:e)}}}async getSummaryStatistics(){const{props:e,fieldName:t}=this,{layer:i,view:s,mode:a}=e;if("sublayer"!==i.type)try{const n=await(0,u.default)({layer:i,view:s,field:t,sqlWhere:"basic"===a&&"definitionExpression"in i?i.definitionExpression??void 0:void 0,forBinning:"feature-reduction"===a&&["binning","cluster"].includes(i.featureReduction?.type),outStatisticTypes:{exclude:["median"]}});return(0,$.i)(n.avg)&&(0,$.i)(n.min)&&(0,$.i)(n.max)?(n.min===n.max&&((0,$.i)(n.min)&&(0,$.i)(n.max)&&n.min>0?(n.min=n.min-.1*n.min,n.max=n.max+.1*n.max):(0,$.i)(n.min)&&(0,$.i)(n.max)&&n.min<0?(n.min=n.min+.1*n.min,n.max=n.max-.1*n.max):(n.min=-1,n.max=1)),e.fields=e.fields.map(e=>e.layerField.name===t?{...e,statistics:n,statisticsStatus:$.b.SUCCESS}:e),n):(e.fields=e.fields.map(e=>e.layerField.name===t?{...e,statisticsStatus:$.b.FAILED}:e),void(this.histogramClosed=!0))}catch(i){return console.error("error-summaryStatistics",i),e.fields=e.fields.map(e=>e.layerField.name===t?{...e,statisticsStatus:$.b.FAILED,histogramStatus:$.b.FAILED}:e),this.histogramClosed=!0,void this.requestUpdate()}}adjustHistogramMinMax(e){const{histogramSlider:t}=this;t&&(t.min>e&&t.set({min:e}),t.max<e&&t.set({max:e}))}prepareSlider(e){const{histogramSliderFieldName:t}=this;let{value:i,value2:s,histogramSlider:a}=this;const n=e.statistics;if(e.histogramStatus===$.b.IN_PROGRESS)return!1;(0,$.i)(i)&&"number"!=typeof i&&(i=void 0),(0,$.i)(s)&&"number"!=typeof s&&(s=void 0),this.checkDefaultValues(e);const r=[];if(r.push(i),(0,$.i)(s)&&r.push(s),(0,I.u)(e)){if((0,$.i)(r[0])){const e=Math.round(r[0]);e!==r[0]&&this.changeValues(e,s),r[0]=e}if((0,$.i)(r[1])){const e=Math.round(r[1]);e!==r[1]&&this.changeValues(i,e),r[1]=e}}let o=e.histogram?e.histogram.minValue:n.min,l=e.histogram?e.histogram.maxValue:n.max;if((0,$.i)(r[0])&&(0,$.i)(r[1])?(o=Math.min(o,r[0]),l=Math.max(l,r[1])):(0,$.i)(r[0])&&(o=Math.min(o,r[0]),l=Math.max(l,r[0])),a&&t!==e.layerField.name&&(this.destroyHistogramSlider(),a=this.histogramSlider),a){const t={bins:e.histogram?.bins,average:Math.round(10*n.avg)/10,min:o,max:l,values:void 0===r?.[0]?void 0:r,rangeType:this.getSliderRangeType()};a.set(t)}else{const t={bins:e.histogram?.bins,average:Math.round(10*n.avg)/10,min:o,max:l,values:void 0===r?.[0]?void 0:r,rangeType:this.getSliderRangeType(),precision:(0,I.u)(e)?0:4};[$.s.DATE,$.s.DATE_ONLY,$.s.TIME_ONLY].includes(e.simpleFieldType)&&(t.hasTimeData=!0,this.addDateFormatFunctions(t,e)),this.histogramSliderFieldName=e.layerField.name,this.histogramSlider=new d.default(t),this.createSliderChangeEvents(e)}return!0}createSliderChangeEvents(e){const{histogramSlider:t}=this;t&&(t.on("min-change",i=>{const s=t;this.onMinMaxChange(i.value,s.max,e.layerField.name)}),t.on("max-change",i=>{const s=t;this.onMinMaxChange(s.min,i.value,e.layerField.name)}),(0,m.watch)(()=>t.values,(0,g.s)(()=>{const i=t;let s=i.values?.[0],a=i.values?.[1];[$.s.DATE,$.s.DATE_ONLY,$.s.TIME_ONLY].includes(e.simpleFieldType)&&(s=Math.round(s)),(0,I.u)(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)},150)),t.on("segment-drag",()=>{const i=t;let s=i.values[0],a=i.values[1];(0,I.u)(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)}))}getSliderRangeType(){const{props:e,operator:t}=this,{_messages:i}=e;switch(t){case i.operators.numberOperatorIs:case i.operators.dateOperatorIsOn:return"equal";case i.operators.numberOperatorIsNot:case i.operators.dateOperatorIsNotOn:return"not-equal";case i.operators.numberOperatorIsLessThan:case i.operators.dateOperatorIsBefore:return"less-than";case i.operators.numberOperatorIsGreaterThan:case i.operators.dateOperatorIsAfter:return"greater-than";case i.operators.numberOperatorIsAtMost:case i.operators.dateOperatorIsBeforeOrEqual:return"at-most";case i.operators.numberOperatorIsAtLeast:case i.operators.dateOperatorIsAfterOrEqual:return"at-least";case i.operators.numberOperatorIsBetween:case i.operators.dateOperatorIsBetween:return"between";case i.operators.numberOperatorIsNotBetween:case i.operators.dateOperatorIsNotBetween:return"not-between";default:return""}}destroyHistogramSlider(){this.histogramSlider?.destroy(),this.histogramSlider=void 0}getNewValue(e){const{fieldName:t,props:i}=this,{layer:s,view:a}=i,n=e;let r;if("CALCITE-INPUT-DATE-PICKER"===n?.tagName||"CALCITE-INPUT-TIME-PICKER"===n?.tagName){const e=(0,I.g)(t,i),o=n.getAttribute("data-value");if("CALCITE-INPUT-DATE-PICKER"===n?.tagName){if(r=n.value,!r)return;r=e.simpleFieldType===$.s.DATE?(0,b.h)(`${r} ${"second"===o?this.timeNode2.value?.value:this.timeNode.value?.value}`,s.fieldsIndex.getTimeZone(t),a?.timeZone,"preferredTimeZone"in s?s.preferredTimeZone??void 0:void 0):(0,b.d)(r)}else{if(r=n.value,!r)return;r=e.simpleFieldType===$.s.DATE?(0,b.h)(`${"second"===o?this.dateNode2?.value:this.dateNode?.value} ${r}`,s.fieldsIndex.getTimeZone(t),a?.timeZone,"preferredTimeZone"in s?s.preferredTimeZone??void 0:void 0):(0,b.t)(r)}}else if("CALCITE-INPUT"===n?.tagName&&"number"===n.type||"CALCITE-INPUT-NUMBER"===n?.tagName){if(r=n.value,!r)return;r=Number.parseFloat(r)}else"CALCITE-INPUT"===n?.tagName&&(r=n.value,r?.length||(r=void 0));return r}addDateFormatFunctions(e,t){const{props:i}=this,{view:s}=i,a=s?.timeZone||"system";e.labelFormatFunction=e=>t.simpleFieldType===$.s.DATE?(0,b.g)(e,a,"short-date"):t.simpleFieldType===$.s.DATE_ONLY?(0,b.b)(e):(0,b.c)(e)}changeValues(e,t){const{props:i,fieldName:s}=this,a=(0,I.g)(s,i),n=a.simpleFieldType&&[$.s.NUMBER,$.s.DATE,$.s.OID].includes(a.simpleFieldType)&&Number.isNaN(e)?void 0:e,r=a.simpleFieldType&&[$.s.NUMBER,$.s.DATE,$.s.OID].includes(a.simpleFieldType)&&Number.isNaN(t)?void 0:t;(this.value!==n||this.value2!==r)&&this.emitChangeEvent({value:n??void 0,value2:r??void 0,histogramClosed:this.histogramClosed})}checkDefaultValues(e){const{props:t,operator:i,value:s,value2:a,histogramSlider:n}=this,r=e.statistics,o=(0,I.t)(t,e,i);if((0,I.b)(t,i)){if(!(0,$.i)(s)){let e,t;if(r){const i=(new Date).getTime(),s=Math.abs(i-r.avg);s>2*$.t.YEAR?(e=Math.round(s/$.t.YEAR),t=$.d.YEAR):s>2*$.t.MONTH?(e=Math.round(s/$.t.MONTH),t=$.d.MONTH):s>2*$.t.WEEK?(e=Math.round(s/$.t.WEEK),t=$.d.WEEK):s>2*$.t.DAY?(e=Math.round(s/$.t.DAY),t=$.d.DAY):s>2*$.t.HOUR?(e=Math.round(s/$.t.HOUR),t=$.d.HOUR):(e=Math.round(s/$.t.MINUTE),t=$.d.MINUTE)}else e=1,t=$.d.YEAR;this.emitChangeEvent({value:e,unit:t,histogramClosed:this.histogramClosed})}}else if((0,I.i)(t,i))if((0,$.i)(s))if((0,$.i)(a))a<s&&(n&&n.values[0]===s?this.changeValues(s,s):this.changeValues(a,a));else{const t=r?.max??s+1,i=(0,I.u)(e)?Math.round(t):t;this.changeValues(s,i)}else if((0,$.i)(a)){const i=r?(0,I.v)(r.avg,t,e):a-1;this.changeValues(i,a)}else this.changeValues(o.value,o.value2);else(0,$.i)(s)||this.changeValues(o.value,o.value2);return o}openFieldPickList(){const{props:e,fieldName:t,fieldPickListSortBy:i}=this,{layer:s,fieldPickListLayer:n,view:o,mode:l,panelNode:u,insideDialog:c}=e;this.closeFilterPopovers();const d=u?.getBoundingClientRect().width||240,p=Math.min(Math.round(d),500),h=-1*Math.round(p+(d-p)/2);let m;u instanceof HTMLDivElement&&(m=(0,f.q)(this.el,"calcite-panel")??(0,f.q)(this.el,"calcite-flow-item")),this.arcgisFieldPickList=(0,r.dN)(a.qy`<arcgis-field-pick-list .fields=${this.createPickerFields()} .layer=${n??s} .mapView=${o} .showFieldInfo=${"feature-reduction"!==l} .selectedFields=${[t]} .sortBy=${i??"default"} .popoverProps=${{placement:"leading",offsetDistance:h,offsetSkidding:0,popoverWidth:p,overlayPositioning:"fixed",triggerDisabled:!0,refElement:m??u,zIndex:c?900:"effects"===l?101:void 0}} @arcgisClose=${e=>{e.stopPropagation();const t=e.detail?.selectedFields?.[0];this.handleFieldPickListChange(t)}} @arcgisSortByChange=${e=>this.fieldPickListSortBy=e.detail}></arcgis-field-pick-list>`),document.body.appendChild(this.arcgisFieldPickList),this.arcgisFieldPickList.setFocus(),this.arcgisDisablePanel.emit(!0)}createPickerFields(){const{props:e}=this,{fields:t}=e;return t.map(e=>({name:e.layerField.name,alias:e.label,type:e.simpleFieldType}))}removeFieldPickList(){this.arcgisDisablePanel.emit(!1),this.arcgisFieldPickList&&(this.arcgisFieldPickList.remove(),this.arcgisFieldPickList=void 0,setTimeout(()=>this.fieldNode.value?.setFocus(),1))}afterFieldSelect(e){const{props:t,fieldName:i,operator:s,histogramClosed:a}=this,{_messages:n}=t,r=(0,I.g)(i,t),o=(0,I.g)(e,t);let l;const u=(0,I.w)(t,r,o,s),c=(0,I.g)(e,t);c.simpleFieldType===$.s.STRING&&c.uniqueValuesStatus===$.b.SUCCESS&&c.uniqueValueInfos?.length&&[n.operators.stringOperatorIs,n.operators.stringOperatorIsNot].includes(u)&&(l=c.uniqueValueInfos[0].value??void 0),this.emitChangeEvent({hasFocus:!0,fieldName:e,operator:u,value:l,value2:void 0,values:void 0,uniqueValuesSortBy:void 0,histogramClosed:o.simpleFieldType&&![$.s.NUMBER,$.s.DATE,$.s.DATE_ONLY,$.s.TIME_ONLY].includes(o.simpleFieldType)||o.statisticsStatus===$.b.FAILED?void 0:!0===a&&r.statisticsStatus!==$.b.FAILED||void 0})}emitChangeEvent(e){const{uid:t,fieldName:i,operator:s,uniqueValuesSortBy:a,value:n,values:r,unit:o,histogramClosed:l,hasFocus:u,props:c}=this,d=(0,I.b)(c,s)&&e.unit&&o&&e.unit!==o,p={uid:t,fieldName:e.fieldName||i,operator:e.operator||s,uniqueValuesSortBy:void 0===e.uniqueValuesSortBy?void 0:e.uniqueValuesSortBy||a,value:d?e.value??n:void 0===e.value?void 0:e.value??n,value2:void 0===e.value2?void 0:e.value2,values:void 0===e.values?void 0:e.values||r,unit:e.unit||o,histogramClosed:void 0===e.histogramClosed?void 0:e.histogramClosed||l,hasFocus:e.hasFocus||u};this.arcgisChanged.emit(p)}waitOnUser(e,t){this.typingHndl&&(clearTimeout(this.typingHndl),this.typingHndl=void 0);const i=e.value,s=Number.parseFloat(i);i?(!i.startsWith("-")||0!==s&&!Number.isNaN(s))&&t(e):this.typingHndl=setTimeout(()=>{this.typingHndl=void 0,t(e)},2e3)}closeFilterPopovers(){this.removeFieldPickList(),this.removeUniquePopover()}render(){const{fieldName:e,props:t}=this,{layer:i}=t,s=(0,I.g)(e,t);if(!s?.simpleFieldType)return a.qy`<div></div>`;const n="sourceJSON"in i?i.sourceJSON?.editFieldsInfo:void 0;this.isEditorField=e===n?.creatorField||e===n?.editorField;const o=(0,v.Qp)(this.el);return(0,r.Bq)(this.el,"dir",o),a.qy`<div class=${(0,r.CP)(N)}>${this.renderFieldSelection()}${this.renderOperatorSelection(s)}${this.renderValueInput(s)}${this.renderTimeZone(s)}${this.renderHistogram(s)}</div>`}renderFieldSelection(){const{hasFocus:e,fieldName:t,showDelete:i,props:s}=this,{fields:n,_messages:l}=s,u=(0,I.g)(t,s);return a.qy`<div class=${(0,r.CP)(S)}><calcite-button appearance=outline-fill kind=neutral width=full alignment=icon-end-space-between .disabled=${n.length<=1} icon-end=chevron-down class=${`${i?"field-button-trash":""} ${e?"autofocus":""}`} @click=${n.length>1?this.onFieldSelect:void 0} ${(0,o.K)(this.fieldNode)}>${u?.label||""}</calcite-button>${i?a.qy`<calcite-action class=${(0,r.CP)(C)} .label=${l.remove} text scale=s icon=trash @click=${()=>this.arcgisDeleted.emit()}></calcite-action>`:null}</div>`}renderOperatorSelection(e){const{props:t}=this,{operators:i,_messages:s}=t;let n=e.simpleFieldType;if(!n)return;n===$.s.GUID&&(n=$.s.STRING),n===$.s.OID&&(n=$.s.NUMBER),(0,I.n)(e)&&(n=$.s.DOMAIN);let o=i?.get(n);this.isEditorField&&(o=o.filter(e=>!(0,I.c)(t,e.name)&&!(0,I.d)(t,e.name)));const l=o.map(e=>this.renderOperatorOption(e.name));return a.qy`<calcite-select width=full .label=${s.accessibility.operator} class=${(0,r.CP)(q)} @calciteSelectChange=${this.onOperatorSelect}>${l}</calcite-select>`}renderOperatorOption(e){const{operator:t}=this;return a.qy`<calcite-option .value=${e} .label=${e} .selected=${e===t}></calcite-option>`}renderValueInput(e){const{props:t,operator:i,invalidValue:s}=this,n=s?"invalid":void 0;let r;return(0,I.c)(t,i)||(0,I.d)(t,i)||(0,I.e)(t,i)?r="":(0,I.a)(t,i)?r=this.renderUniqueValues(e):(0,I.b)(t,i)?r=this.renderInTheLast(e):e.simpleFieldType===$.s.STRING||e.simpleFieldType===$.s.GUID||(0,I.n)(e)?r=this.renderValueInputString(e,{status:n}):e.simpleFieldType===$.s.NUMBER?r=this.renderValueInputNumber(e,{status:n}):e.simpleFieldType===$.s.DATE?r=this.renderValueInputDate(e):e.simpleFieldType===$.s.DATE_ONLY?r=this.renderValueInputDateOnly(e):e.simpleFieldType===$.s.TIME_ONLY?r=this.renderValueInputTimeOnly(e):e.simpleFieldType===$.s.OID&&(r=this.renderValueInputOid(e,{status:n})),s?a.qy`<calcite-label>${r}<calcite-input-message icon .status=${n}>${s}</calcite-input-message></calcite-label>`:r}renderUniqueButton(e,t,i){const{props:s}=this,{_messages:n}=s;if(e)return a.qy`<calcite-action class=${(0,r.CP)(D)} .disabled=${t} .loading=${!!i} .text=${n.chooseFromUnique} scale=s icon=chevron-down @click=${t?void 0:this.onSelectUniqueValue} ${(0,o.K)(this._setUniqueActionNode)}></calcite-action>`}renderValueInputString(e,t){const{props:i,value:s,operator:l}=this,{_messages:u}=i,c=e.uniqueValuesStatus,d=e.uniqueValueInfos,p=[u.operators.stringOperatorIs,u.operators.stringOperatorIsNot].includes(l),h=p&&(c===$.b.FAILED||c===$.b.SUCCESS&&!d?.length),m=(0,I.n)(e),v=m?(0,I.x)(s,e):s,g=c===$.b.MISSING||c===$.b.IN_PROGRESS;return c===$.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),m?(0,$.i)(v)?(0,n.D)("value-input-string",a.qy`<div>${(0,n.D)(v,a.qy`<calcite-button appearance=outline-fill kind=neutral width=full alignment=icon-end-space-between .iconEnd=${g?"spinner":h?void 0:"chevron-down"} .disabled=${h} @click=${h?void 0:this.onSelectUniqueValue} ${(0,o.K)(this._setUniqueActionNode)}>${v?`${v}`:""}</calcite-button>`)}</div>`):(0,n.D)("value-input-string",a.qy`<div class=${(0,r.CP)(T)}>${(0,n.D)("value-input-string-button",a.qy`<div class=${`${V} ${F} ${c===$.b.SUCCESS?"active":"inactive"}`} tabindex=-1 @click=${c===$.b.SUCCESS?this.onSelectUniqueValue:void 0}></div>`)}${this.renderUniqueButton(p,h,g)}</div>`):(0,n.D)("value-input-string",a.qy`<div class=${(0,r.CP)(T)}><calcite-input type=text .value=${v?`${v}`:""} class=${(0,r.CP)(V)} .label=${u.accessibility.value} @calciteInputInput=${e=>this.debouncedOnValueChange(e.target)} .status=${t.status}></calcite-input>${this.renderUniqueButton(p,h,g)}</div>`)}renderValueInputNumber(e,t){const{props:i,value:s,value2:o,operator:l}=this,{_messages:u}=i,c=(0,I.y)(e);if([u.operators.numberOperatorIsBetween,u.operators.numberOperatorIsNotBetween].includes(l))return a.qy`<div><calcite-input type=number .value=${(0,$.i)(s)?`${s}`:""} .step=${c?"any":1} .label=${u.accessibility.fromValue} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValueChangeMaybe)} .status=${t.status}></calcite-input><div class=${`${P} first`}></div><calcite-input type=number .value=${(0,$.i)(o)?`${o}`:""} .step=${c?"any":1} class=${(0,r.CP)(P)} .label=${u.accessibility.toValue} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValue2ChangeMaybe)} .status=${t.status}></calcite-input></div>`;{const i=e.uniqueValuesStatus,o=e.uniqueValueInfos,d=[u.operators.numberOperatorIs,u.operators.numberOperatorIsNot,u.operators.numberOperatorIsAtLeast,u.operators.numberOperatorIsAtMost,u.operators.numberOperatorIsGreaterThan,u.operators.numberOperatorIsLessThan].includes(l),p=a.qy`<calcite-input class=${(0,r.CP)(V)} type=number .value=${(0,$.i)(s)?`${s}`:""} .step=${c?"any":1} .label=${u.accessibility.value} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValueChange)} .status=${t.status}></calcite-input>`;return i===$.b.FAILED||i===$.b.SUCCESS&&!o?.length||!d?(0,n.D)("value-input-number",a.qy`<div>${p}</div>`):i===$.b.MISSING||i===$.b.IN_PROGRESS?(i===$.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-number",a.qy`<div class=${(0,r.CP)(T)}>${p}${this.renderUniqueButton(d,!0,!0)}</div>`)):(0,n.D)("value-input-number",a.qy`<div class=${(0,r.CP)(T)}>${p}${this.renderUniqueButton(d,!e.uniqueValueInfos?.length)}</div>`)}}renderValueInputDate(e){const{props:t,value:i,value2:s,operator:l}=this,{layer:u,view:c,_messages:d}=t,p="number"==typeof i?(0,b.f)(i,c?.timeZone,"preferredTimeZone"in u?u.preferredTimeZone??void 0:void 0):i,h=(0,b.e)(p);if([d.operators.dateOperatorIsBetween,d.operators.dateOperatorIsNotBetween].includes(l)){const e="number"==typeof s?(0,b.f)(s,c?.timeZone,"preferredTimeZone"in u?u.preferredTimeZone??void 0:void 0):s,t=(0,b.e)(e);return a.qy`<div><calcite-label class=${(0,r.CP)(O)}>${d.startDate}</calcite-label><calcite-input-date-picker class=${`${L} first`} .value=${p} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValueChange(e.target)} ${(0,o.K)(this._setDateNode)}></calcite-input-date-picker><calcite-input-time-picker class=${`${L} ${V}}`} .value=${h} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValueChange(e.target)} ${(0,o.K)(this.timeNode)}></calcite-input-time-picker><calcite-label class=${(0,r.CP)(O)}>${d.endDate}</calcite-label><calcite-input-date-picker class=${`${L} first`} .value=${e} data-value=second overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValue2Change(e.target)} ${(0,o.K)(this._setDateNode2)}></calcite-input-date-picker><calcite-input-time-picker class=${`${L} ${V}`} .value=${t} data-value=second step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValue2Change(e.target)} ${(0,o.K)(this.timeNode2)}></calcite-input-time-picker></div>`}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[d.operators.dateOperatorIsOn,d.operators.dateOperatorIsNotOn,d.operators.dateOperatorIsAfter,d.operators.dateOperatorIsBefore,d.operators.dateOperatorIsAfterOrEqual,d.operators.dateOperatorIsBeforeOrEqual].includes(l),u=a.qy`<div class=${(0,r.CP)(E)}><calcite-input-date-picker class=${`${L} ${V} first`} .value=${p} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValueChange(e.target)} ${(0,o.K)(this._setDateNode)}></calcite-input-date-picker><calcite-input-time-picker class=${`${L} ${V}`} .value=${h} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValueChange(e.target)} ${(0,o.K)(this.timeNode)}></calcite-input-time-picker></div>`;return t===$.b.FAILED||t===$.b.SUCCESS&&!i?.length||!s?(0,n.D)("value-input-date",a.qy`<div>${u}</div>`):t===$.b.MISSING||t===$.b.IN_PROGRESS?(t===$.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-date",a.qy`<div class=${(0,r.CP)(T)}>${u}${this.renderUniqueButton(s,!0,!0)}</div>`)):(0,n.D)("value-input-date",a.qy`<div class=${(0,r.CP)(T)}>${u}${this.renderUniqueButton(s,!e.uniqueValueInfos?.length)}</div>`)}}renderValueInputDateOnly(e){const{props:t,value:i,value2:s,operator:o}=this,{_messages:l}=t,u="number"==typeof i?(0,b.u)(i):i;if([l.operators.dateOperatorIsBetween,l.operators.dateOperatorIsNotBetween].includes(o)){const e="number"==typeof s?(0,b.u)(s):s;return a.qy`<div><calcite-input-date-picker class=${`${L} first`} .value=${u} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValueChange(e.target)}></calcite-input-date-picker><calcite-input-date-picker class=${(0,r.CP)(L)} .value=${e} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValue2Change(e.target)}></calcite-input-date-picker></div>`}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[l.operators.dateOperatorIsOn,l.operators.dateOperatorIsNotOn,l.operators.dateOperatorIsAfter,l.operators.dateOperatorIsBefore,l.operators.dateOperatorIsAfterOrEqual,l.operators.dateOperatorIsBeforeOrEqual].includes(o),c=a.qy`<calcite-input-date-picker class=${`${L} ${V}`} .value=${u} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValueChange(e.target)}></calcite-input-date-picker>`;return t===$.b.FAILED||t===$.b.SUCCESS&&!i?.length||!s?(0,n.D)("value-input-date",a.qy`<div>${c}</div>`):t===$.b.MISSING||t===$.b.IN_PROGRESS?(t===$.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-date",a.qy`<div class=${(0,r.CP)(T)}>${c}${this.renderUniqueButton(s,!0,!0)}</div>`)):(0,n.D)("value-input-date",a.qy`<div class=${(0,r.CP)(T)}>${c}${this.renderUniqueButton(s,!e.uniqueValueInfos?.length)}</div>`)}}renderValueInputTimeOnly(e){const{props:t,value:i,value2:s,operator:o}=this,{_messages:l}=t,u="number"==typeof i?(0,b.a)(i):i;if([l.operators.dateOperatorIsBetween,l.operators.dateOperatorIsNotBetween].includes(o)){const e="number"==typeof s?(0,b.a)(s):s;return a.qy`<div><calcite-input-time-picker class=${`${L} first`} .value=${u} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValueChange(e.target)}></calcite-input-time-picker><calcite-input-time-picker class=${(0,r.CP)(L)} .value=${e} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValue2Change(e.target)}></calcite-input-time-picker></div>`}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[l.operators.dateOperatorIsOn,l.operators.dateOperatorIsNotOn,l.operators.dateOperatorIsAfter,l.operators.dateOperatorIsBefore,l.operators.dateOperatorIsAfterOrEqual,l.operators.dateOperatorIsBeforeOrEqual].includes(o),c=a.qy`<calcite-input-time-picker class=${`${L} ${V}`} .value=${u} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValueChange(e.target)}></calcite-input-time-picker>`;return t===$.b.FAILED||t===$.b.SUCCESS&&!i?.length||!s?(0,n.D)("value-input-time",a.qy`<div>${c}</div>`):t===$.b.MISSING||t===$.b.IN_PROGRESS?(t===$.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-time",a.qy`<div class=${(0,r.CP)(T)}>${c}${this.renderUniqueButton(s,!0,!0)}</div>`)):(0,n.D)("value-input-time",a.qy`<div class=${(0,r.CP)(T)}>${c}${this.renderUniqueButton(s,!e.uniqueValueInfos?.length)}</div>`)}}renderValueInputOid(e,t){const{props:i,value:s,value2:o,operator:l}=this,{_messages:u}=i;if(e.simpleFieldType===$.s.OID)if((0,$.i)(s)&&(0,$.i)(o)){const e=Math.round(s),t=Math.round(o);(e!==s||t!==o)&&this.changeValues(e,t)}else if((0,$.i)(s)){const e=Math.round(s);e!==s&&this.changeValues(e,o)}else if((0,$.i)(o)){const e=Math.round(o);e!==o&&this.changeValues(s,e)}if([u.operators.numberOperatorIsBetween,u.operators.numberOperatorIsNotBetween].includes(l))return a.qy`<div><calcite-input type=number .value=${(0,$.i)(s)?`${s}`:""} min=0 step=1 .label=${u.accessibility.fromValue} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValueChangeMaybe)} .status=${t.status}></calcite-input><div class=${`${P} first`}></div><calcite-input type=number .value=${(0,$.i)(o)?`${o}`:""} min=0 step=1 class=${(0,r.CP)(P)} .label=${u.accessibility.toValue} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValue2ChangeMaybe)} .status=${t.status}></calcite-input></div>`;{const i=e.uniqueValuesStatus,o=e.uniqueValueInfos,c=[u.operators.numberOperatorIs,u.operators.numberOperatorIsNot,u.operators.numberOperatorIsAtLeast,u.operators.numberOperatorIsAtMost,u.operators.numberOperatorIsGreaterThan,u.operators.numberOperatorIsLessThan].includes(l),d=a.qy`<calcite-input class=${(0,r.CP)(V)} type=number .value=${(0,$.i)(s)?`${s}`:""} min=0 step=1 .label=${u.accessibility.value} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValueChange)} .status=${t.status}></calcite-input>`;return i===$.b.FAILED||i===$.b.SUCCESS&&!o?.length||!c?(0,n.D)("value-input-oid",a.qy`<div>${d}</div>`):i===$.b.MISSING||i===$.b.IN_PROGRESS?(i===$.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-oid",a.qy`<div class=${(0,r.CP)(T)}>${d}${this.renderUniqueButton(c,!0,!0)}</div>`)):(0,n.D)("value-input-oid",a.qy`<div class=${(0,r.CP)(T)}>${d}${this.renderUniqueButton(c,!e.uniqueValueInfos?.length)}</div>`)}}renderUniqueValues(e){const{props:t,values:i,fieldName:s}=this,{_messages:l}=t,u=e.uniqueValuesStatus,c=e.uniqueValueInfos;if(u===$.b.MISSING||u===$.b.IN_PROGRESS)return u===$.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),a.qy`<div><calcite-loader class=${(0,r.CP)(_)} inline label></calcite-loader></div>`;if(u===$.b.FAILED)return a.qy`<div class=${(0,r.CP)(M)}><calcite-button appearance=transparent width=full alignment=center class=${(0,r.CP)(x)} disabled .label=${l.selectValues}>${l.selectValues}</calcite-button>${l.errors.errorUniqueValues}</div>`;{const t=a.qy`<div class=${(0,r.CP)(M)}>${!i?.length&&c?.length?l.selectOneValue:""}</div>`;let u;c?.length||(u=a.qy`<div class=${(0,r.CP)(M)}>${l.errors.noUniqueValues}</div>`);const d=i?.map(t=>this.renderSelectedUniqueValue(t,e));return a.qy`<div>${t}<calcite-button appearance=transparent width=full alignment=center class=${(0,r.CP)(x)} .disabled=${!c?.length} @click=${c?.length?this.onSelectUniqueValues:void 0} .label=${l.selectValues} ${(0,o.K)(this.uniqueSelectNode)}>${l.selectValues}</calcite-button>${u}${i?.length?(0,n.D)(`unique-values-list-${s}`,a.qy`<calcite-list class=${(0,r.CP)(U)} .label=${l.values} ${(0,o.K)(this.afterCreateList)}>${d}</calcite-list>`):null}</div>`}}renderSelectedUniqueValue(e,t){const{props:i}=this,{view:s,_messages:n}=i,r=s?.timeZone||"system",o=(0,I.n)(t)?(0,I.x)(e,t):(0,I.k)(t)?(0,b.g)(e,r):(0,I.l)(t)?(0,b.b)(e):(0,I.m)(t)?(0,b.c)(e):(0,I.j)(t)?(0,p.formatNumber)(e):e;return a.qy`<calcite-list-item .label=${`${o}`} .value=${`${e}`}><calcite-action slot=actions-end .text=${n.remove} icon=x @click=${()=>this.handleRemoveSelectedValue(e)}></calcite-action></calcite-list-item>`}renderInTheLast(e){const{props:t,value:i,unit:s}=this,{_messages:n}=t,o=(0,I.l)(e);return a.qy`<div class=${(0,r.CP)(A)}><calcite-input-number inputmode=decimal min=1 integer .value=${(0,$.i)(i)?`${i}`:""} class=${(0,r.CP)(w)} .label=${n.accessibility.value} @calciteInputNumberInput=${e=>this.onValueChange(e.target)}></calcite-input-number><calcite-select width=full .label=${n.accessibility.units} class=${(0,r.CP)(k)} @calciteSelectChange=${this.onUnitSelect}>${!o&&this.renderInTheLastOption($.d.MINUTE,s===$.d.MINUTE)||""}${!o&&this.renderInTheLastOption($.d.HOUR,s===$.d.HOUR)||""}${this.renderInTheLastOption($.d.DAY,s===$.d.DAY)}${this.renderInTheLastOption($.d.WEEK,s===$.d.WEEK)}${this.renderInTheLastOption($.d.MONTH,s===$.d.MONTH)}${this.renderInTheLastOption($.d.YEAR,s===$.d.YEAR)}</calcite-select></div>`}renderInTheLastOption(e,t){const{props:i}=this,{_messages:s}=i;return a.qy`<calcite-option .value=${e} .label=${s.units[e]} .selected=${t}></calcite-option>`}renderTimeZone(e){const{props:t}=this,{view:i,_messages:s}=t;if(e.simpleFieldType!==$.s.DATE)return;const n=i&&"system"!==i.timeZone?"unknown"===i.timeZone?s.timeZoneUnknown:void 0:s.timeZoneSystem;return a.qy`<calcite-label class=${(0,r.CP)(B)} scale=s layout=inline alignment=start><calcite-icon icon=time-zone scale=s class=${(0,r.CP)(H)}></calcite-icon>${n||a.qy`<calcite-input-time-zone mode=region read-only .value=${i?.timeZone} tabindex=-1></calcite-input-time-zone>`}</calcite-label>`}renderHistogram(e){const{props:t,histogramClosed:i,operator:s,fieldName:n}=this,{_messages:r}=t;if(e?.simpleFieldType)if(e.statisticsStatus!==$.b.FAILED)if((0,I.z)(n,s,t)){if(!0!==i||e.statisticsStatus!==$.b.MISSING)return(void 0===i||!i&&e.histogramStatus===$.b.MISSING)&&this.onHistogramOpen(),a.qy`<calcite-block-section .expanded=${!0!==i} .text=${e.histogramStatus===$.b.FAILED?r.valueRange:r.histogram} @calciteBlockSectionToggle=${this.onHistogramBlockToggle}>${this.renderHistogramContent(e)}</calcite-block-section>`;this.onHistogramCollapsed()}else this.destroyHistogramSlider();else this.destroyHistogramSlider();else this.destroyHistogramSlider()}renderHistogramContent(e){const{histogramClosed:t}=this,i=e.layerField.name;if(!0!==t)return e.statistics&&e.histogramStatus!==$.b.IN_PROGRESS?this.prepareSlider(e)?(0,n.D)(`histogram-content-${i}-${e.statistics}`,a.qy`<div class=${`${R} ${e.histogram?"":"slim"}`} dir=${(0,v.Qp)(this.el)??r.s6} ${(0,o.K)(this.afterCreateSliderDiv)}></div>`):void 0:(0,n.D)(`histogram-content-${i}-${e.statistics}`,a.qy`<div class=${`${R} ${e.histogram?"":"slim"}`}><calcite-loader class=${(0,r.CP)(_)} inline label></calcite-loader></div>`)}}(0,s.c)("arcgis-common-sql-expression-config-condition",G)},20936:(e,t,i)=>{function s(e){return function(e,t){return function(e,t){const i=e.assignedElements({flatten:!0});return t?i.filter(e=>e.matches(t)):i}(e.target,t)}(e).length>0}i.d(t,{Ly:()=>a,Qp:()=>u,Yt:()=>n,Zj:()=>c,el:()=>l,ti:()=>s});const a=(...e)=>{const t=[];for(let i=0;i<e.length;i++){const s=e[i];if("string"==typeof s)t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if("object"==typeof s)for(const e in s)s[e]&&t.push(e)}const i=t.join(" ");return t.length=0,i},n=(e,t,i)=>(0,o(t).subscribe)(t=>{const s=t.some(t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target));s&&i()}),r={},o=e=>{const t=e.join(","),i=r[t];if(void 0!==i)return i;const s=new Set,a=new MutationObserver(e=>s.forEach(t=>t(e)));globalThis.document&&a.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const n={subscribe:e=>(s.add(e),()=>{s.delete(e),0===s.size&&(a.disconnect(),r[t]=void 0)})};return r[t]=n,n},l=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const s=i.getRootNode?.();if(s===globalThis.document)return;i=s.host}};const u=e=>c(e,"dir","ltr"),c=(e,t,i)=>{const s=l(e,`[${t}]`);return s?.getAttribute(t)??i}},46317:(e,t,i)=>{i.d(t,{D:()=>r});var s=i(85282),a=i(34670),n=i(42466);const r=(0,a.u$)(class extends a.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,n.mY)(e),this.key=t),i}})},90732:(e,t,i)=>{i.d(t,{s:()=>s});const s=(e,t=100)=>{let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...s)},t)}}}}]);