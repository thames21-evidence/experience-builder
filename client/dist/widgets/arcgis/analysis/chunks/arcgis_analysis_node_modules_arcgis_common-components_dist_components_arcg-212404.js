/*! For license information please see arcgis_analysis_node_modules_arcgis_common-components_dist_components_arcg-212404.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_common-components_dist_components_arcg-212404"],{23037:(e,t,s)=>{s.r(t),s.d(t,{ArcgisCommonSqlExpressionConfigUniqueList:()=>q});var i=s(22229),l=s(4395),r=s(46317),n=s(73801),a=s(47640),o=s(85643),u=s(52797),c=s(60701),d=s(80666),h=s(53550),p=(s(5294),s(28927),s(588),s(44345),s(34031),s(43284),s(42984));const g="container",m="popover-unique-list",v="unique-values-content-list-msg",y="count",f="unique-values-done",$=l.AH`:host{width:100%}.container{min-height:30px}.popover-unique-list{width:100%;overflow-y:auto}.unique-values-content-list-msg{font-size:75%;margin:5px}.count{padding:0 6px;font-size:smaller;white-space:nowrap}.unique-values-done{padding:.5rem}`;class q extends n.WF{constructor(){super(...arguments),this.dropdownNode=(0,o._)(),this._messages=(0,p.u)({blocking:!0,name:"common-sql-expression-config"}),this._propWatcherTask=new a.YZ(this,{task:async([e])=>{if(!(0,d.i)(e?.layer)||!(0,d.i)(e?.fields))throw console.error("Required properties are missing."),new Error;await this.processProps()},args:()=>[this.props]}),this.initialRender=!0,this.uid=(0,c.DA)(),this.uniqueValues=[],this.multiple=!1,this.partialUniqueValues=!1,this.arcgisChanged=(0,n.lh)(),this.arcgisDone=(0,n.lh)(),this.arcgisSortByChanged=(0,n.lh)()}static{this.properties={initialRender:16,uid:1,props:0,uniqueValues:0,selectedValues:0,fieldDomains:0,layerFieldType:1,sortBy:1,multiple:5,partialUniqueValues:5,maxHeight:9}}static{this.styles=$}async setFocus(){this.listNode?.setFocus()}loaded(){this.props?.layer&&this.props?.fields&&(setTimeout(()=>this.initialRender=!1,800),this.listNode?.setFocus())}async processProps(){const{props:e}=this;e._messages||(e._messages=this._messages),setTimeout(()=>{this.initialRender=!1,this.listNode?.setFocus()},800)}_setListRef(e){const{maxHeight:t}=this;this.listNode=e,t&&e?.setAttribute("style",`max-height: ${t||400}px`)}getDecodedValue(e){const{fieldDomains:t}=this,s=t;if(s){let t="";for(let i=0;i<s.length;i++){const l=s[i];l.code==e&&(t+=(t.length?" | ":"")+l.name)}return t.length||(t=`${e}`),t}return e}onSortMenuSelect(e){const t=e.currentTarget.selectedItems?.[0].getAttribute("data-value");this.sortBy=t||void 0,this.arcgisSortByChanged.emit({uid:this.uid,sortBy:t||void 0})}done(){this.arcgisDone.emit(this.uid)}isSameLists(e,t){if(!e&&!t)return!0;if(!e||!t||e?.length!==t?.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}render(){const{uid:e,uniqueValues:t,selectedValues:s,layerFieldType:i,fieldDomains:r,sortBy:a,multiple:u,partialUniqueValues:c,props:d,initialRender:p}=this;return this._propWatcherTask.render({complete:()=>{const{_messages:y}=d,f=["small-integer","big-integer","integer","single","double","long"].includes(i),$=["date","date-only","time-only"].includes(i);(e=>{const t=r?.length;e.sort((e,s)=>{if(!t&&f)return("string"==typeof e.value?Number.parseFloat(e.value):e.value)-("string"==typeof s.value?Number.parseFloat(s.value):s.value);{const i=t?this.getDecodedValue(e.value):e.value,l=t?this.getDecodedValue(s.value):s.value;return`${i}`.startsWith("_")?1:`${l}`.startsWith("_")?-1:`${i}`.localeCompare(`${l}`)}})})(t),a&&"count"!==a?"selected"===a&&((e,t)=>{e.sort((e,s)=>{const i=t?.indexOf(e.value)??-1,l=t?.indexOf(s.value)??-1;return i===l||i>-1&&l>-1?0:i>l?-1:1})})(t,s):t.sort((e,t)=>e.count<=t.count?1:-1);const q=t.map(e=>this.renderUniqueValue(e));let w;return c&&!p&&(w=l.qy`<div class=${(0,n.CP)(v)}>${y.errors.tooManyUniqueValues}</div>`),l.qy`<div class=${(0,n.CP)(g)}><calcite-list .label=${y.values} class=${(0,n.CP)(m)} .filterEnabled=${t.length>10} .selectionMode=${u?"multiple":"single"} .filterPlaceholder=${y.searchValues} @calciteListChange=${t=>{let s=t.target.selectedItems.map(e=>e.value);r||"date-only"!==i?r||"time-only"!==i?["date","oid","small-integer","big-integer","integer","long"].includes(i)?s=s?.map(e=>Number.parseInt(e)):["single","double"].includes(i)&&(s=s?.map(e=>Number.parseFloat(e))):s=s?.map(e=>(0,h.t)(e)):s=s?.map(e=>(0,h.d)(e)),!this.isSameLists(s,this.selectedValues)&&(this.selectedValues=s,this.arcgisChanged.emit({uid:e,multiple:u,selectedValues:s,sortBy:a}))}} @calciteListFilter=${()=>{this.dropdownNode.value&&(this.dropdownNode.value.disabled=this.listNode.filteredItems.length<4)}} ${(0,o.K)(this._setListRef)}>${t.length>10&&!p?this.renderSort(f,$):null}${q}</calcite-list>${w}${this.renderDone()}</div>`}})}renderSort(e,t){const{sortBy:s,props:i}=this,{_messages:r}=i;return l.qy`<calcite-dropdown slot=filter-actions-end placement=bottom-end overlay-positioning=fixed @calciteDropdownSelect=${this.onSortMenuSelect} ${(0,o.K)(this.dropdownNode)}><calcite-action slot=trigger .label=${r.sortValues} text><calcite-icon scale=s icon=sortDescending flip-rtl></calcite-icon></calcite-action><calcite-dropdown-group><calcite-dropdown-item .selected=${"count"===s||!(0,d.i)(s)} data-value=count>${r.sortByCount}</calcite-dropdown-item><calcite-dropdown-item .selected=${"name"===s} data-value=name>${e||t?r.sortAscending:r.sortAlphabetical}</calcite-dropdown-item><calcite-dropdown-item .selected=${"selected"===s} data-value=selected>${r.sortSelected}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown>`}renderUniqueValue(e){const{selectedValues:t,fieldDomains:s,layerFieldType:i,uniqueValues:a,initialRender:o,props:c}=this,{view:p}=c,g=p?.timeZone||"system",m=s?.length?this.getDecodedValue(e.value):i===d.s.DATE?(0,h.g)(e.value,g):i===d.s.DATE_ONLY?(0,h.b)(e.value):i===d.s.TIME_ONLY?(0,h.c)(e.value):"number"==typeof e.value?(0,u.formatNumber)(e.value):e.value,v=!!t&&(i===d.s.DATE_ONLY?t.includes(s?.length?e.value:(0,h.d)(e.value)):i===d.s.TIME_ONLY?t.includes(s?.length?e.value:(0,h.t)(e.value)):t.includes(e.value));return(0,r.D)(`list-item_${e.value}`,l.qy`<calcite-list-item .label=${`${m}`} .value=${`${e.value}`} .selected=${v}>${(0,d.i)(e.count)&&(a.length>200&&!o||a.length<=200)?l.qy`<div class=${(0,n.CP)(y)} slot=actions-end>${`${e.count}`}</div>`:null}</calcite-list-item>`)}renderDone(){const{multiple:e,props:t}=this,{_messages:s}=t;return e?l.qy`<div class=${(0,n.CP)(f)}><calcite-button appearance=outline-fill width=full @click=${this.done} .label=${s.done}>${s.done}</calcite-button></div>`:null}}(0,i.c)("arcgis-common-sql-expression-config-unique-list",q)},42984:(e,t,s)=>{s.d(t,{u:()=>r});var i=s(83552),l=s(22229);const r=(0,i.yr)(l.g)},46317:(e,t,s)=>{s.d(t,{D:()=>n});var i=s(85282),l=s(34670),r=s(42466);const n=(0,l.u$)(class extends l.WL{constructor(){super(...arguments),this.key=i.s6}render(e,t){return this.key=e,t}update(e,[t,s]){return t!==this.key&&((0,r.mY)(e),this.key=t),s}})},47640:(e,t,s)=>{s.d(t,{YZ:()=>n,e1:()=>l});var i=s(4836);const l={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,s){this.p=0,this.i=0,(this._=e).addController(this);const i="object"==typeof t?t:{task:t,args:s};this.v=i.task,this.j=i.args,this.m=i.argsEqual??a,this.k=i.onComplete,this.A=i.onError,this.autoRun=i.autoRun??!0,"initialValue"in i&&(this.u=i.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,s;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const i=++this.p;this.q=new AbortController;let l=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){l=!0,s=e}if(this.p===i){if(t===r)this.i=0;else{if(!1===l){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(s)}catch{}this.i=3,this.h?.(s)}this.u=t,this.l=s}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const a=(e,t)=>e===t||e.length===t.length&&e.every((e,s)=>!(0,i.Ec)(e,t[s]))}}]);