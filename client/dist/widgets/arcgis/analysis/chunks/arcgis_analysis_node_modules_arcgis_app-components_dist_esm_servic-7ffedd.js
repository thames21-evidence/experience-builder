/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_servic-7ffedd.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_servic-7ffedd"],{26262:(e,r,a)=>{a.d(r,{a:()=>i,g:()=>l,i:()=>s});var t=a(41473);const i=(e,r)=>(0,t.a)(`${(0,t.g)(e)}community/groups/${r.id}`),l=(e,r)=>`${((e,r)=>(0,t.a)(`${(0,t.g)(e)}content/groups/${r.id}`))(e,r)}search`,s=e=>{var r;return null===(r=null==e?void 0:e.capabilities)||void 0===r?void 0:r.includes("distributed")}},37566:(e,r,a)=>{a.d(r,{a:()=>W,b:()=>f,c:()=>g,d:()=>R,e:()=>h,s:()=>V,u:()=>I});var t=a(1536),i=a(83692),l=a(46904),s=a(41473),n=a(60958),o=a(4429),u=a(26262),c=a(1654),d=a(71467),p=a(63263),y=a(29599),m=a(68616),v=a(52995);const h=async(e,r,a,o,u=!1)=>{const{portal:c,user:d}=o,p=`${(0,s.g)(c)}content/users/${d.username}/shareItems`;let y=[];const m=r?function(e){switch(e){case"public":return{org:!1,everyone:!0};case"org":return{org:!0,everyone:!1};case"private":case"shared":return{org:!1,everyone:!1};default:return{}}}(r):{};if(e.every(e=>(0,l.i)(e,d)))try{y=(await(0,n.r)(p,c,{body:Object.assign({items:e.map(e=>e.id).join(","),groups:(null==a?void 0:a.length)?a.join(","):void 0,confirmItemControl:!0},m),usePost:!0})).results}catch(e){return console.error(e),{error:{code:"unhandledError"}}}else y=(await Promise.all(e.map(({id:e})=>async function(e,r,a,l,s=!1){try{const o=`${(0,t.g)(e,l)}/share`,u=Object.assign({groups:(null==a?void 0:a.length)?a.join(","):null,confirmItemControl:!0},r);let c;return c=s?await(0,n.r)(o,l,{body:u,usePost:!0}):await(0,i.r)(o,u,{},"post"),{result:c}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}(e,m,a,c,u)))).map(e=>e.result);return{result:y}},I=async(e,r,a)=>{const{portal:t,user:i}=a,l=`${(0,s.g)(t)}content/users/${i.username}/unshareItems`;try{return{result:(await(0,n.r)(l,t,{body:{items:e.join(","),groups:(null==r?void 0:r.length)?r.join(","):null},usePost:!0})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};function f(e,r){const{typeKeywords:a,type:t,url:i}=e,l=a&&b.some(e=>a.includes(e)),s="Image Service"===t&&(null==i?void 0:i.includes("://iservices"))&&i.includes("arcgis.com"),n="Geoprocessing Service"===t&&(null==a?void 0:a.includes("Notebook Web Tool")),o=w.includes(t)||!r&&"Data Store"===t;return l||s||o||n}function g(e){var r;const a=null===(r=e.typeKeywords)||void 0===r?void 0:r.includes("Hosted Service");return["Vector Tile Service","Map Service","Scene Service","Feature Service"].includes(e.type)&&a}const b=["Location Tracking Service","Location Tracking View","IoTFeed","IoTFeatureLayer","IoTMapImageLayer","IoTStreamLayer","Administrative Report","EditExtensionIndoorsSpaces","ArcgisWorkflowJobLocation","Integration Info"],w=["Knowledge Graph","Pro Project","Workflow"],S=async(e,r)=>{const a=e.id;let t,i={items:[],layers:[]};switch(e.type){case"Group Layer":({result:i,error:t}=await T(a,r));break;case"Web Map":case"Web Scene":({result:i,error:t}=await L(a,r));break;case"Web Mapping Application":({result:i,error:t}=await E(a,r));break;case"Web Experience":case"Web Experience Template":({result:i,error:t}=await P(a,e.typeKeywords,r));break;case"Analysis Model":({result:i,error:t}=await A(a,r))}return{result:i,error:t}},T=async(e,r)=>{try{const a=await(0,p.g)(e,r);return{result:{items:[],layers:[Object.assign({},a)]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},L=async(e,r)=>{var a,t;try{const i=await(0,p.g)(e,r),{operationalLayers:l,baseMap:s,tables:n,ground:o,mapIPSInfo:u}=i,c=[...null!=l?l:[],...null!==(a=null==s?void 0:s.baseMapLayers)&&void 0!==a?a:[],...null!==(t=null==o?void 0:o.layers)&&void 0!==t?t:[],...null!=n?n:[]];return u&&c.push({itemId:u.positioningService.itemId,layerType:"Indoor Positioning Data Service"}),{result:{items:[],layers:c}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},E=async(e,r)=>{var a;try{const a=await(0,p.g)(e,r);if(!a)return{result:{items:[],layers:[]}};const t=G(a),i=(await Promise.all(t.map(e=>(0,p.a)(e,r)))).map(({result:e})=>e).filter(e=>e),l=await Promise.all(i.map(e=>S(e,r))),{items:s,layers:n}=D(l.map(({result:e})=>e).flat().filter(e=>e));return{result:{items:[...i,...s],layers:n}}}catch(e){return(0,d.i)(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"")?{result:{items:[],layers:[]}}:(console.error(e),{error:{code:"unhandledError"}})}},G=e=>{var r,a,t,i,l,s,n,o,u,c;return[...(null===(r=null==e?void 0:e.map)||void 0===r?void 0:r.itemId)?[e.map.itemId]:[],...null!==(i=null===(t=null===(a=e.values)||void 0===a?void 0:a.itemCollection)||void 0===t?void 0:t.map(e=>e.id))&&void 0!==i?i:[],...null!==(n=null===(s=null===(l=e.values)||void 0===l?void 0:l.webmap)||void 0===s?void 0:s.split(","))&&void 0!==n?n:[],...null!==(c=null===(u=null===(o=e.values)||void 0===o?void 0:o.webscene)||void 0===u?void 0:u.split(","))&&void 0!==c?c:[]]},P=async(e,r,a)=>{const i=`${(0,t.g)(e,a)}/resources/config/config.json`,l=(0,p.b)(e,a),s=[];r.includes("status: Draft")?s.push(i):r.includes("status: Changed")?s.push(i,l):s.push(l);try{const e=[],r=[],t=[];return await Promise.all(s.map(async i=>{const l=await(0,n.r)(i,a);if(!(null==l?void 0:l.dataSources)&&!(null==l?void 0:l.utilities))return;const s=(await Promise.all(function(e){const r=e.dataSources||{},a=e.utilities||{};return[...Object.values(r),...Object.values(a)].map(e=>e.itemId).filter(e=>e)}(l).map(e=>(0,p.a)(e,a)))).map(({result:e})=>e).filter(e=>e),o=await Promise.all(s.map(e=>S(e,a))),{items:u,layers:c}=D(o.flatMap(({result:e})=>e).filter(e=>e));t.push(...c),e.push(...u),r.push(...s)})),{result:{items:[...r,...e],layers:t}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};const A=async(e,r)=>{try{const a=(await(0,p.g)(e,r)).variables.filter(e=>!e.isDerived).map(({value:e})=>{var r,a;return null!==(a=null===(r=e.value)||void 0===r?void 0:r.itemId)&&void 0!==a?a:e.itemId}),t=await Promise.all(a.map(e=>(0,p.a)(e,r)));return{result:{items:t.map(({result:e})=>e).filter(e=>e),layers:[]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},D=e=>({items:e.flatMap(e=>e.items),layers:e.flatMap(e=>e.layers)});async function M(e,r,a=!1){try{const{result:t}=await(0,p.c)(e,r);return{result:[...t.admin,...t.member,...t.other].filter(e=>a||!e.isFav)}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}const U=e=>!("layerType"in e)&&e.url&&e.popupInfo,j={needsGroupUpdate:!1,needsShareLevelUpdate:!1,canEditShareLevel:!0,premium:!1},k=async(e,r)=>{var a;const t=e.filter(e=>{return!!(null==e?void 0:e.url)&&(r={layerType:e.layerType},["table","ArcGISFeatureLayer","ArcGISTiledMapServiceLayer","VectorTileLayer","GroupLayer","ArcGISImageServiceLayer","ArcGISTiledImageServiceLayer","SubtypeGroupLayer","ArcGISStreamLayer"].includes(r.layerType));var r}),i=await C(t.map(e=>e.url),r),{result:l}=await(0,v.g)(i,r);return null!==(a=l.map(e=>e.item))&&void 0!==a?a:[]},C=async(e,r)=>{const a=e.filter(e=>!!e&&!!(0,s.p)(e)),t=e.filter(e=>!e||!(0,s.p)(e));return[...await(0,v.f)(r,a),...t]},O=async(e,r)=>{const a=[],t=e=>{if((e=>"layerType"in e&&"Indoor Positioning Data Service"===e.layerType)(e))a.push({id:e.itemId,itemId:e.itemId,layerType:e.layerType,getType:"normal"});else if(U(e))a.push({id:e.id,url:e.url,layerType:"table",getType:"normal"});else{if("GroupLayer"===e.layerType)return e.itemId&&a.push({id:e.id,itemId:e.itemId,layerType:"GroupLayer",getType:"normal"}),void e.layers.forEach(e=>{if(U(e)||"GroupLayer"===e.layerType)return void t(e);const r=e.url;if(!r)return void t(e);const a=(0,s.p)(r);t(Object.assign(Object.assign({},e),{url:null!=(null==a?void 0:a.index)?a.baseServerUrl:e.url}))});if((e=>"VectorTileLayer"===e.layerType&&"styleUrl"in e)(e))a.push({id:e.id,url:e.styleUrl,itemId:e.itemId,layerType:e.layerType,getType:"normal"});else{if((e=>"ArcGISTiledMapServiceLayer"===e.layerType)(e)){const r=(e=>"ArcGISTiledMapServiceLayer"===e.layerType&&"layers"in e&&!1===e.layers[0].disablePopup)(e);if(r){const r=e.layers[0];a.push({id:r.id,url:r.layerUrl,getType:"normal",layerType:e.layerType,itemId:r.layerItemId})}return void a.push({id:e.id,getType:r?"normal":"tile-layer-with-no-popup",itemId:e.itemId,layerType:e.layerType,url:e.url})}(e.itemId||e.url)&&a.push({id:e.id,url:e.url,itemId:e.itemId,layerType:e.layerType,getType:"normal"})}}};e.forEach(t);const l=(0,o.a)(a,e=>e.itemId?{key:e.itemId,data:{searchType:"item-id",layerType:e.layerType}}:{key:e.url,data:{searchType:"url",layerType:e.layerType}}),n=Object.keys(l).filter(e=>"item-id"===l[e].searchType);try{const e=(await Promise.all(n.map(e=>(0,p.d)(e,r)))).filter(e=>!!e),t=a.filter(({getType:e,itemId:r})=>"tile-layer-with-no-popup"===e&&!!r),s=(await Promise.all(t.map(e=>(async(e,r)=>{try{const a=e.itemId,t=await(0,i.f)(()=>(0,p.g)(a,r),"itemData",a),{layerItemId:l}=null==t?void 0:t.layers[0];return l?{result:await(0,p.d)(l,r)}:{error:{code:"unhandledError"}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e,r)))).map(({result:e})=>e),u=e.filter(e=>!(0,m.i)(e.typeKeywords,e.type)),c=await k(u.map(e=>{const{url:r,id:a}=e,t=l[a];return t&&"Indoor Positioning Data Service"!==(null==t?void 0:t.layerType)?{layerType:t.layerType,url:r}:null}),r),d=(0,o.a)(c,e=>({key:e.url,data:e})),y=Object.keys(l).map(e=>{const r=l[e];return r&&"url"===r.searchType&&"Indoor Positioning Data Service"!==r.layerType?{layerType:r.layerType,url:e}:null}).filter(e=>e),v=await k(y,r),h=[];return e.filter(e=>e).forEach(e=>{const r=e.url;h.push({sourceItem:e});const a=d[r];a&&e.id!==a.id&&h.push({sourceItem:a})}),[...s,...v].forEach(e=>{e&&h.push({layer:null,sourceItem:e})}),{result:h}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},_={private:0,shared:1,org:2,public:3},W=async(e,r,a,t={clearDataCacheOnDone:!0})=>{if("private"===e.access)return{result:{needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needAuthentication:[]}};const{result:l,error:s}=await $(e,r,a);if(s)return{error:s};const n={needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needAuthentication:K(e)?[{sourceItem:e,detail:{canEditShareLevel:!0,needsGroupUpdate:!1,needsShareLevelUpdate:!1,premium:!1}}]:[]};return await Promise.all(null==l?void 0:l.map(async a=>{const t=await N({mainItem:e,sharingDetailResult:a,portal:r});t&&n[t].push(a)})),t.clearDataCacheOnDone&&R.forEach(e=>(0,i.c)(e)),{result:n}},$=async(e,r,a)=>{var t,i;let s,n=[],c=[...a||[]];if(!(null==c?void 0:c.length)){const{error:a,result:l}=await S(e,r);s=a,c=null!==(t=null==l?void 0:l.layers)&&void 0!==t?t:[],n=null!==(i=null==l?void 0:l.items)&&void 0!==i?i:[]}if(s)return{error:s};if(c.length<=0&&n.length<=0)return{error:{code:"dataNotAvailable"}};try{if(!(0,o.i)(["Data Store","Analysis Model"],e.type)){const{result:e,error:a}=await O(c,r);if(a)return{error:a};n.push(...e.map(({sourceItem:e})=>e))}const{result:a,error:t}=await M(e.id,r);if(t)return{error:t};const i=(0,o.u)(n,e=>e.id),s=a.map(e=>e.id),d=a.some(e=>(0,u.i)(e)),p=await Promise.all(i.map(async a=>{const t=await async function({mainItemAccess:e,mainItemSharedGroupIds:r,isMainItemSharedWithCollabGroups:a,portal:t,sourceItem:i}){const{access:s,itemControl:n}=i,o=Object.assign({},j),u="public"===e;if(f(i,t.isPortal)&&u)return Object.assign(Object.assign({},o),{needsShareLevelUpdate:!0,canEditShareLevel:!1});"public"!==s?(o.canEditShareLevel=x(n),o.needsGroupUpdate=(!u||a)&&await(async({sourceItem:e,portal:r,mainItemSharedGroupIds:a})=>{const{result:t}=await M(e.id,r);return!function(e,r){return!(null==e?void 0:e.length)||e.filter(e=>!(r||[]).includes(e)).length<=0}(a,t.map(e=>e.id))})({sourceItem:i,mainItemSharedGroupIds:r,portal:t}),o.needsShareLevelUpdate=F({mainItemAccess:e,sourceItemAccess:s})):(o.premium=function(e){return(0,l.a)(e)||(0,l.b)(e)}(i),o.needsGroupUpdate=await(async({sourceItem:e,isMainItemSharingToPublic:r,isMainItemSharedWithCollabGroups:a,portal:t})=>{if(!a||!r)return!1;if("esri_apps"===e.owner)return!1;try{const r=await(0,y.g)(e.url),a=await(0,y.a)(t);if(r.owningSystemUrl!==a.owningSystemUrl)return!1}catch(e){return!1}return!0})({sourceItem:i,isMainItemSharingToPublic:u,isMainItemSharedWithCollabGroups:a,mainItemSharedGroupIds:r,portal:t}));return o}({sourceItem:a,mainItemAccess:e.access,isMainItemSharedWithCollabGroups:d,mainItemSharedGroupIds:s,portal:r});return{sourceItem:a,detail:t}}));return{result:p}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};const x=e=>"admin"===e||"update"===e,K=e=>e.typeKeywords.includes("DeveloperBasemap"),F=({mainItemAccess:e,sourceItemAccess:r})=>!("private"===r&&"shared"===e)&&_[e]>_[r];async function V(e,r,a,t,i=!0){const{user:l}=t,s=i?await Promise.all(r.map(async e=>{const{result:r}=await M(e.id,t);return r})):[];let n=s.flat(1);"public"===a&&(n=n.filter(e=>(0,u.i)(e)));const o=n.map(e=>e.id);return h(e,a,o,{portal:t,user:l},!0)}const N=async({mainItem:e,sharingDetailResult:r,portal:a})=>{var t;const{sourceItem:i,detail:l}=r,{canEditShareLevel:s,needsGroupUpdate:n,needsShareLevelUpdate:o,premium:u}=l;if(!n&&!o&&!u)return null;if(!s&&!u)return"notEditableLayers";switch(e.access){case"public":if(u)return"premiumLayers";if("public"!==i.access){if((0,c.i)(a.subscriptionInfo||(null===(t=a.sourceJSON)||void 0===t?void 0:t.subscriptionInfo))&&g(i))return"notEditableLayers";if(await(0,p.i)(i,a)){return i.typeKeywords.includes("Public Data Collection")?"needEditableLayers":"needDataCollectionLayers"}}return"needsShareLevelUpdateLayers";case"org":case"shared":case"private":return u?null:"needsShareLevelUpdateLayers";default:J(e.access)}},R=["itemData","itemMetadata"],J=e=>{throw new Error(`Unexpected share level ${e}`)}}}]);