/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-218809.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-218809"],{9868:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigLayerViewJoin:()=>C});var s=i(73679),r=i(4395),a=i(97357),n=i(36486),o=i(76456),l=i(66228),c=i(13661),h=(i(21255),i(2801)),d=i(2924),p=i(33752),u=i(44345),g=(i(588),i(51072)),m=i(43786),y=i(73801),f=i(47640);const w=r.AH`:host{height:100%}.panel{height:100%}.footer{width:100%}.error-content{margin:.5rem}`;class C extends y.WF{constructor(){super(),this.status=o.j.LOADING,this._messages=(0,n.u)({blocking:!0,name:"map-config-layer-view"}),this.createOngoing=!1,this._initialized=!1,this._loaded=!1,this._propWatcherTask=new f.YZ(this,{task:async([e,t,i])=>{if(!((0,l.i)(e)&&(0,l.i)(t)&&(0,l.i)(i)))throw console.error("[arcgis-map-config-layer-view-join] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.view,this.itemId,this.config]}),this.showTableOption=!1,this.arcgisCancel=(0,y.lh)(),this.arcgisCreate=(0,y.lh)(),this.arcgisStepChange=(0,y.lh)(),this.arcgisTableClick=(0,y.lh)(),this.listen("arcgisStatusChange",this.arcgisStatusHandler),this.listen("arcgisCreateDone",this.arcgisCreateDoneHandler),this.listen("arcgisCreateCancel",this.arcgisCreateCancelHandler),this.listen("arcgisCreateOngoing",this.arcgisCreateOngoingHandler)}static{this.properties={view:0,itemId:1,config:0,showTableOption:5}}static{this.styles=w}async setStep(e){const{props:t}=this,{targetLayerId:i,addLayerId:s,attributeRelationships:r,joinOperation:a}=t;if(this.createOngoing)return setTimeout(()=>this.arcgisStepChange.emit(4),100),!1;const n=(0,l.i)(i),c=(0,l.i)(s),h=r?.find(e=>e.targetFieldName&&e.addFieldName)&&a&&("first"===a.matchType&&a.sortByFieldName&&a.sortOrder||"summarize"===a.matchType&&a.statisticsFields?.length&&a.statisticsFields?.[0].fieldName);switch(document.body.querySelectorAll(".js-app-flyout").forEach(e=>e.remove()),e){case 1:return this.status=o.j.TARGET_SELECTION,this.requestUpdate(),await new Promise(e=>e(!0));case 2:if(n)return this.status=o.j.ADD_SELECTION,this.requestUpdate(),await new Promise(e=>e(!0));break;case 3:if(c)return this.status=o.j.CONFIG,this.requestUpdate(),await new Promise(e=>e(!0));break;case 4:if(h)return this.status=o.j.CREATE,this.requestUpdate(),await new Promise(e=>e(!0))}return await new Promise(e=>e(!1))}updated(){this._propWatcherTask.status===f.e1.COMPLETE&&this._initialized&&!this._loaded&&(this._loaded=!0,this.arcgisStepChange.emit(1))}disconnectedCallback(){super.disconnectedCallback();const{props:e}=this,{view:t,targetLayer:i,addLayer:s}=e;t.map?.remove(i),t.map?.remove(s)}async init(){const{itemId:e,view:t,showTableOption:i,config:s,_messages:r}=this;this.props={config:s,view:t,itemId:e,showTableOption:i,_messages:r};const{props:a}=this;if(e)try{const i=new p.default({id:e});if(await i.load(),a.targetItemOwner=i.portal.user,i.portal.user.username!==i.owner&&await(0,u.default)(`${i.portal.restUrl}/community/users/${i.owner}`,{query:{f:"json"}}).then(e=>{e?.data&&(a.targetItemOwner=e.data)}),"Feature Service"!==i.type)return console.error("Only Feature Service items are allowed."),void(this.status=o.j.ERROR);if(-1===i.typeKeywords?.indexOf("Hosted Service"))return console.error("Only hosted Feature Service items are allowed."),void(this.status=o.j.ERROR);if(i.portal.user.username!==i.owner&&"admin"!==i.itemControl)return console.error("Only owners and admins are allowed."),void(this.status=o.j.ERROR);if(i.typeKeywords?.indexOf("View Service")>-1)return console.error("View items are not allowed."),void(this.status=o.j.ERROR);if(i?.typeKeywords.indexOf("IoTFeatureLayer")>-1)return console.error("Velocity items are not allowed."),void(this.status=o.j.ERROR);let s=i.extent;if(s||(s=new c.default({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:new m.default({wkid:4326})})),4326!==t.spatialReference.wkid){await g.load();const e=g.execute(s,t.spatialReference);t.goTo(e.expand(1.1))}else t.goTo(s.expand(1.1));const r=await d.default.fromPortalItem({portalItem:i});if("group"===r.type){await r.loadAll();const e=(0,h.g)(r);e?.length&&t.map?.add(r),e?.forEach(e=>{if("feature"===e.type){const t=e;!t.popupTemplate&&t.popupEnabled&&(t.popupTemplate=t.createPopupTemplate())}})}else await r.load(),r.isTable||t.map?.add(r),r.popupTemplate=r.createPopupTemplate();a.targetItem=i,a.targetLayer=r,this.status=o.j.TARGET_SELECTION}catch(e){console.error(e),this.status=o.j.ERROR}finally{this._initialized=!0}else console.error("itemId is a required property.")}arcgisStatusHandler(e){const{detail:t}=e;this.status=t.status,this.status===o.j.TARGET_SELECTION?this.arcgisStepChange.emit(1):this.status===o.j.ADD_SELECTION?this.arcgisStepChange.emit(2):this.status===o.j.CONFIG?this.arcgisStepChange.emit(3):this.status===o.j.CREATE&&this.arcgisStepChange.emit(4),this.requestUpdate()}async arcgisCreateDoneHandler(e){this.arcgisCreate.emit(e.detail)}arcgisCreateCancelHandler(){this.arcgisCancel.emit()}arcgisCreateOngoingHandler(e){this.createOngoing=e.detail}goCancel(){this.arcgisCancel.emit()}render(){return this._propWatcherTask.render({complete:()=>{const{status:e}=this,t=window.customElements?.get("arcgis-item-browser"),i=window.customElements?.get("arcgis-item-properties");return t&&i?r.qy`${e===o.j.ERROR?this.renderError():null}${e===o.j.LOADING?this.renderLoading():null}${[o.j.TARGET_SELECTION].includes(e)?this.renderTargetLayerSelection():null}${[o.j.ADD_SELECTION,o.j.BROWSE_LAYER].includes(e)?this.renderAddLayerSelection():null}${[o.j.CONFIG].includes(e)?this.renderConfig():null}${e===o.j.CREATE?this.renderCreateJoin():null}`:(console.error("Can't use arcgis-map-config-layer-view-join because @arcgis/app-components/arcgis-item-browser or @arcgis/app-components/arcgis-item-properties are not available."),r.qy`<div></div>`)}})}renderError(){const{props:e}=this,{targetItem:t,_messages:i}=e;return r.qy`<calcite-flow-item .heading=${t?.title||i.msg.error} .description=${t?.title?i.join.targetLayer:void 0} class=${(0,y.CP)(a.C.panel)}><div class=${(0,y.CP)(a.C.errorContent)}><calcite-notice scale=s width=full open icon=exclamation-mark-triangle kind=danger><div slot=title>${i.msg.error}</div><div slot=message>${i.msg.initFailed}</div></calcite-notice></div><div slot=footer class=${(0,y.CP)(a.C.footer)}><calcite-button slot=footer @click=${this.goCancel} appearance=transparent width=full .label=${i.general.cancel}>${i.general.cancel}</calcite-button></div></calcite-flow-item>`}renderLoading(){const{props:e}=this,{targetItem:t,_messages:i}=e;return r.qy`<calcite-flow-item loading .heading=${t?.title??void 0} .description=${i.join.targetLayer} class=${(0,y.CP)(a.C.panel)}></calcite-flow-item>`}renderTargetLayerSelection(){const{props:e,status:t}=this;return r.qy`<arcgis-map-config-layer-view-join-target-selection .props=${e} .status=${t}></arcgis-map-config-layer-view-join-target-selection>`}renderAddLayerSelection(){const{props:e,status:t}=this;return r.qy`<arcgis-map-config-layer-view-join-add-selection .props=${e} .status=${t}></arcgis-map-config-layer-view-join-add-selection>`}renderConfig(){const{props:e}=this;return r.qy`<arcgis-map-config-layer-view-join-config .props=${e} @arcgisConfigTableClick=${e=>this.arcgisTableClick.emit(e.detail)}></arcgis-map-config-layer-view-join-config>`}renderCreateJoin(){const{props:e}=this;return r.qy`<arcgis-map-config-layer-view-join-create .props=${e}></arcgis-map-config-layer-view-join-create>`}}(0,s.c)("arcgis-map-config-layer-view-join",C)},36486:(e,t,i)=>{i.d(t,{u:()=>a});var s=i(83552),r=i(73679);const a=(0,s.yr)(r.g)},47640:(e,t,i)=>{i.d(t,{YZ:()=>n,e1:()=>r});var s=i(4836);const r={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},a=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??o,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let r=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){r=!0,i=e}if(this.p===s){if(t===a)this.i=0;else{if(!1===r){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},76456:(e,t,i)=>{i.d(t,{a:()=>a,b:()=>r,g:()=>n,h:()=>o,j:()=>s});var s=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADING=1]="LOADING",e[e.TARGET_SELECTION=2]="TARGET_SELECTION",e[e.ADD_SELECTION=3]="ADD_SELECTION",e[e.BROWSE_LAYER=4]="BROWSE_LAYER",e[e.CONFIG=5]="CONFIG",e[e.CREATE=6]="CREATE",e))(s||{});function r(e,t){const{fields:i,popupTemplate:s}=e,r=s?.fieldInfos,a=i.find(e=>t===e.name);return a&&r?.find(e=>e.fieldName===a.name)?.label||a?.alias||t}function a(e,t){const{fields:i}=e;return i.find(e=>t===e.name)?.type||""}function n(e,t){const{_messages:i}=t;return e.isTable?i.general.table:"point"===e.geometryType||"multipoint"===e.geometryType?i.join.pointLayer:"polyline"===e.geometryType?i.join.polylineLayer:"polygon"===e.geometryType?i.join.polygonLayer:""}function o(e){return e.sourceJSON.ownershipBasedAccessControlForFeatures&&(!1===e.sourceJSON.ownershipBasedAccessControlForFeatures?.allowAnonymousToQuery||!1===e.sourceJSON.ownershipBasedAccessControlForFeatures?.allowOthersToQuery)}},97357:(e,t,i)=>{i.d(t,{C:()=>s});const s={panel:"panel",footer:"footer",errorContent:"error-content"}}}]);