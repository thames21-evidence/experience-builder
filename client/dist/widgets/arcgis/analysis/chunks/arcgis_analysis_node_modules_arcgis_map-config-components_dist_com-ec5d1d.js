/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-ec5d1d.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-ec5d1d"],{7383:(e,i,t)=>{t.r(i),t.d(i,{ArcgisMapConfigSmartMappingPanelsRelationship:()=>f});var a=t(73679),n=t(4395),s=t(5294),o=t(56451),r=t(6176),l=t(1225),d=t(89989),c=(t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(75518)),p=(t(89704),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(65595)),u=(t(54312),t(77462),t(49403),t(66617),t(10628),t(59640),t(64451),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(78778)),m=(t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(28927),t(6238),t(7299),t(85643)),h=t(73801);const g=n.AH`:host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.relationship-block{overflow-x:hidden}.attribute-name{word-break:break-all}.block-section-padding{padding-top:6px}`;class f extends h.WF{constructor(){super(...arguments),this.colorSliderNodes=[],this.methodButtonNode=(0,m._)(),this.legendNode=(0,m._)(),this.rotationNode=(0,m._)(),this.smartMappingState=(0,p.u)(),this.visualizationOpen=!1,this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisSmartMappingPanelsRelationshipBackClick=(0,h.lh)(),this.arcgisSmartMappingPanelsRelationshipClose=(0,h.lh)(),this.arcgisSmartMappingPanelsRelationshipError=(0,h.lh)(),this.smartMappingCompleteClose=(0,h.lh)()}static{this.properties={visualizationOpen:16,hideTransparency:5,hideRotation:5,menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=g}async setFocus(){await(this.flowItemNode?.setFocus())}load(){this.visualizationOpen=!0;const{layer:e}=this.smartMappingState,i=(0,l.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?s.clone(e.featureReduction):void 0}async loaded(){requestAnimationFrame(async()=>await(this.flowItemNode?.setFocus())),this.scaleHandle=(0,d.w)(this.smartMappingState,this.flowItemNode,()=>this.smartMappingCompleteClose.emit("cancel"))}disconnectedCallback(){super.disconnectedCallback(),this.scaleHandle?.remove()}flowItemRefHandler(e){e&&(this.flowItemNode=e)}sliderRefHandler(e){if(e){const i=e.fieldPos;this.colorSliderNodes[i]=e}}handleDone(){this.arcgisSmartMappingPanelsRelationshipClose.emit("save")}handleCancel(){const{originalRendererJSON:e,originalFeatureReduction:i,smartMappingState:t}=this;(0,l.a8)(t,e,i),this.arcgisSmartMappingPanelsRelationshipClose.emit("cancel")}handleGridSizeChange(e){(0,l.f)();const{smartMappingState:i}=this;(0,c.r)((0,u.c)(i,{numClasses:e}),this.flowItemNode).then(e=>{if("relationship-size"===(0,l.d)(i)){const t=(0,l.g)(i),a=(0,l.c)(t,"size");e.renderer.visualVariables=e.renderer.visualVariables||[],e.renderer.visualVariables.push(a);const n=(0,l.p)(t,"size");e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(n)}(0,l.a4)(i,e.renderer),this.requestUpdate(),this.colorSliderNodes[0]&&this.colorSliderNodes[0].manager.component.requestUpdate(),this.colorSliderNodes[1]&&this.colorSliderNodes[1].manager.component.requestUpdate()})}render(){const{layer:e,hideLayerTitle:i,mapImageSublayer:t,_messages:a}=this.smartMappingState,s=i?void 0:t?.title??e.title;return this.el.classList.add("calcite-match-height"),n.qy`<calcite-flow-item .heading=${a.panels.styleOptions} .description=${s} class="flow-item" .closable=${(0,l.aa)(this.el)} .showBackButton=${this.showBackButton} .selected=${this.selected} @calciteFlowItemClose=${()=>this.handleDone()} @calciteFlowItemBack=${e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsRelationshipBackClick.emit()}} ${(0,m.K)(this.flowItemRefHandler)}>${this.renderDoneButton()}${this.renderCancelButton()}${this.renderVisualization()}${this.renderLegend()}${this.renderTransparency()}${this.renderRotation()}</calcite-flow-item>`}renderDoneButton(){const{_messages:e}=this.smartMappingState;return n.qy`<calcite-button slot=footer .label=${e.done} @click=${()=>this.handleDone()} appearance=solid width=half>${e.done}</calcite-button>`}renderCancelButton(){const{_messages:e}=this.smartMappingState;return n.qy`<calcite-button slot=footer .label=${e.cancel} @click=${()=>this.handleCancel()} appearance=outline-fill width=half>${e.cancel}</calcite-button>`}renderVisualization(){const{visualizationOpen:e,hideTransparency:i,hideRotation:t}=this,{_messages:a}=this.smartMappingState;return n.qy`<calcite-block class="relationship-block" .heading=${a.panels.relationship.relationshipStyle} .collapsible=${!i||!t} .expanded=${e} @calciteBlockOpen=${()=>this.visualizationOpen=!0} @calciteBlockClose=${()=>this.visualizationOpen=!1}>${this.renderSymbol()}${this.renderGridSize()}${this.renderMethod()}${this.renderField1()}${this.renderField2()}${this.renderRegenerateStyle()}${this.renderBackgroundStyle()}${this.renderDefaultSymbol()}</calcite-block>`}renderSymbol(){const{smartMappingState:e}=this,{mapView:i}=e,t=(0,l.g)(e).uniqueValueInfos??[];if(!t.length)return"";const a=r.getSchemes({basemap:i.map?.basemap,geometryType:(0,l.j)(e)}),s=(0,l.k)(a,Math.min(t.length,10))[0].colors,d=(t?.length?t.filter((e,i)=>i<10).map((e,i)=>(0,l.i)(e.symbol)||new o.default(s[i%s.length])):[]).reverse();return n.qy`<arcgis-map-config-smart-mapping-symbol-button .colors=${d} type=relationship-ramp ramp-type=discrete @arcgisSmartMappingSymbolButtonSymbolChange=${()=>{this.requestUpdate(),this.colorSliderNodes[0]&&this.colorSliderNodes[0].manager.component.requestUpdate(),this.colorSliderNodes[1]&&this.colorSliderNodes[1].manager.component.requestUpdate(),this.legendNode.value&&this.legendNode.value.manager.component.requestUpdate(),this.rotationNode.value&&this.rotationNode.value.manager.component.requestUpdate()}}></arcgis-map-config-smart-mapping-symbol-button>`}renderGridSize(){const{smartMappingState:e}=this,{_messages:i}=e,t=(0,l.g)(e).authoringInfo.numClasses;return n.qy`<calcite-label>${i.panels.relationship.gridSize}<calcite-select .label=${i.panels.relationship.gridSize} @calciteSelectChange=${e=>{const i=e.target;this.handleGridSizeChange(Number.parseFloat(i.value))}}><calcite-option value=2 .selected=${2===t}>${i.panels.relationship.gridsize2}</calcite-option><calcite-option value=3 .selected=${3===t}>${i.panels.relationship.gridsize3}</calcite-option><calcite-option value=4 .selected=${4===t}>${i.panels.relationship.gridsize4}</calcite-option></calcite-select></calcite-label>`}renderMethod(){const{smartMappingState:e}=this,i=(0,l.d)(e);return n.qy`<arcgis-map-config-smart-mapping-method-button @arcgisSmartMappingMethodButtonBeforeOpen=${()=>(0,l.f)()} @arcgisSmartMappingMethodButtonChange=${t=>{const a=t.target,n=(0,l.g)(e);"manual"===t.detail?(n.authoringInfo.classificationMethod="manual",(0,l.a4)(e),this.requestUpdate()):(0,c.r)((0,u.c)(e,{classificationMethod:t.detail}),this.flowItemNode).then(t=>{if(["relationship-size"].includes(i)){const e=(0,l.c)(n,"size");t.renderer.visualVariables=t.renderer.visualVariables||[],t.renderer.visualVariables.push(e);const i=(0,l.p)(n,"size");t.renderer.authoringInfo=t.renderer.authoringInfo||{},t.renderer.authoringInfo.visualVariables=t.renderer.authoringInfo.visualVariables||[],t.renderer.authoringInfo.visualVariables.push(i)}(0,l.a4)(e,t.renderer),this.requestUpdate(),a.manager.component.requestUpdate()},e=>{a.manager.component.requestUpdate(),this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}} ${(0,m.K)(this.methodButtonNode)}></arcgis-map-config-smart-mapping-method-button>`}renderField1(){const{smartMappingState:e}=this,i=(0,l.g)(e).authoringInfo.field1,t=(0,l.K)(e,i.field),a=t.layerField.alias||t.layerField.name;return n.qy`<calcite-block-section .text=${a}><div class="block-section-padding">${this.renderDividedBy(0)}${this.renderColorSlider(0)}</div></calcite-block-section>`}renderField2(){const{smartMappingState:e}=this,i=(0,l.g)(e).authoringInfo.field2,t=(0,l.K)(e,i.field),a=t.layerField.alias||t.layerField.name;return n.qy`<calcite-block-section .text=${a}><div class="block-section-padding">${this.renderDividedBy(1)}${this.renderColorSlider(1)}</div></calcite-block-section>`}renderDividedBy(e){const{smartMappingState:i}=this,t=(0,l.g)(i).authoringInfo,a=(0===e?t.field1:t.field2)?.normalizationField;return n.qy`<arcgis-map-config-smart-mapping-divided-by renderer-subtype=relationship .fieldPos=${e} .normalizationField=${a} @arcgisSmartMappingDividedByChange=${()=>{this.requestUpdate(),this.colorSliderNodes[e]&&this.colorSliderNodes[e].updateStatistics()}}></arcgis-map-config-smart-mapping-divided-by>`}renderColorSlider(e){return n.qy`<arcgis-map-config-smart-mapping-relationship-color-slider .fieldPos=${e} @arcgisSmartMappingRelationshipColorSliderChange=${()=>this.methodButtonNode.value&&this.methodButtonNode.value.manager.component.requestUpdate()} ${(0,m.K)(this.sliderRefHandler)}></arcgis-map-config-smart-mapping-relationship-color-slider>`}renderRegenerateStyle(){const{smartMappingState:e}=this,{mapImageSublayer:i}=e;return i?"":n.qy`<arcgis-map-config-smart-mapping-regenerate-style renderer-subtype=relationship @arcgisRendererRegenerate=${()=>{this.requestUpdate(),this.colorSliderNodes.forEach(e=>{e.manager.component.requestUpdate(),e.updateStatistics()})}}></arcgis-map-config-smart-mapping-regenerate-style>`}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:i}=e;return i||!(0,l.o)(e)||"relationship-size"!==(0,l.d)(e)?"":n.qy`<arcgis-map-config-smart-mapping-background-symbol></arcgis-map-config-smart-mapping-background-symbol>`}renderDefaultSymbol(){return n.qy`<arcgis-map-config-smart-mapping-default-symbol></arcgis-map-config-smart-mapping-default-symbol>`}renderLegend(){return n.qy`<arcgis-map-config-smart-mapping-relationship-legend @arcgisSmartMappingRelationshipLegendFocusChange=${()=>this.requestUpdate()} ${(0,m.K)(this.legendNode)}></arcgis-map-config-smart-mapping-relationship-legend>`}renderTransparency(){const{hideTransparency:e,smartMappingState:i}=this;if(e)return"";const t=(0,l.g)(i),a=(0,l.c)(t,"opacity");return n.qy`<arcgis-map-config-smart-mapping-transparency .open=${!!a} @arcgisSmartMappingSymbolTransparencyError=${({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)}></arcgis-map-config-smart-mapping-transparency>`}renderRotation(){if(this.hideRotation)return"";const{smartMappingState:e}=this,i=(0,l.g)(e),t=(0,l.c)(i,"opacity"),a=(0,l.c)(i,"rotation");return n.qy`<arcgis-map-config-smart-mapping-rotation .open=${!t&&!!a} @arcgisSmartMappingRotationError=${({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)} ${(0,m.K)(this.rotationNode)}></arcgis-map-config-smart-mapping-rotation>`}}(0,a.c)("arcgis-map-config-smart-mapping-panels-relationship",f)},65595:(e,i,t)=>{t.d(i,{c:()=>o,u:()=>r});var a=t(20936),n=t(1225),s=(t(54312),t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(28927),t(83368),t(89704),t(5294),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(75698),t(10628),t(59640),t(64451),t(6176),t(83552));t(77462),t(49403),t(10281),t(83930),t(66617),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(6238),t(7299);function o(e){e.selectedFields=[],e.layerFields=void 0,e.fields=void 0,e.hideLayerTitle=!1,e.supportsArcade=!1,e.stringFieldsCount=-1,e.dateFieldsCount=-1,e.numberFieldsCount=-1,e.containsFlow=!0,e.oneFeatureResponseStatus=n.s.MISSING,e.selectedAttribute=void 0,e.selectedAttributeText=void 0,e.selectedTypeValue=void 0,e.selectedValue=void 0,e.lastDefault=void 0,e.lastDefaults=void 0,e.dotColorSelected=void 0,e.backgroundStyleSelected=void 0,e.lastSettings=void 0,e.classedSymbolSelectedIdx=void 0,e.allUniqueValues=void 0,e.useFeatureReduction=void 0,e.symbolStylerConfig={},e.allowTimeSeriesConfiguration=!1,e.rasterInfo=void 0}function r(){const e=(0,s.Gk)(),i=e;e.manager.onLoad(()=>{i.smartMappingState=function(e,i){const t=l.get(e);if(t)return t;const n=(0,a.el)(e,i);return n&&"store"in n?(l.set(e,n.store),n.store):null}(e.el,"arcgis-map-config-smart-mapping")})}const l=new WeakMap},75518:(e,i,t)=>{let a,n;function s(e){e.loading=!1}async function o(e,i){return function(e){e.loading=!0,n=!1,a&&clearTimeout(a),a=setTimeout(()=>{s(e),n=!0},6e4)}(i),await e.then(e=>{if(s(i),n)throw new Error("timeout");return e}).catch(e=>{throw s(i),e})}t.d(i,{r:()=>o})},78778:(e,i,t)=>{t.d(i,{a:()=>o,c:()=>r,u:()=>l});var a=t(85681),n=t(1225),s=(t(54312),t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(89704),t(5294),t(66228));t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(83552),t(77462),t(49403),t(66617),t(10628),t(59640),t(64451),t(6176),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(28927),t(6238),t(7299);async function o(e,i){const{layer:t,useFeatureReduction:o,mapImageSublayer:r,mapView:l}=e,d=t,c=(0,n.d)(e);let p=i.relationshipScheme;if(!p&&["relationship","relationship-size"].includes(c)&&(p=(0,n.S)(e)),i=i||{},"relationship-size"===c){const t=(0,n.g)(e).clone(),a=t.authoringInfo,s=(0,n.p)(t,"spike");if(a&&i.fieldInfos?.length>1&&i.fieldInfos[0].field===a.field1.field&&i.fieldInfos[1].field===a.field2.field){if(t.visualVariables=(0,n.H)(t,"size"),t.authoringInfo.visualVariables=(0,n.P)(t,"size"),(0,n.o)(e)||s){const i=(0,n.e)(e),a=t.uniqueValueInfos.slice();a.forEach(e=>{const t=(0,n.i)(e.symbol);e.symbol=i.clone(),(0,n.y)(e.symbol,t)}),t.uniqueValueInfos=a}return{renderer:t}}}const u=(0,n.a)(e,(0,n.g)(e)),m={layer:d,view:l,field1:{field:i.fieldInfos[0].field},field2:{field:i.fieldInfos[1].field},classificationMethod:"quantile",numClasses:3,focus:"HH",relationshipScheme:p,outlineOptimizationEnabled:!r&&(!(0,s.i)(i.outlineOptimizationEnabled)||i.outlineOptimizationEnabled),sizeOptimizationEnabled:!r&&(!(0,s.i)(i.sizeOptimizationEnabled)||i.sizeOptimizationEnabled),legendOptions:i.legendOptions,defaultSymbolEnabled:!1,forBinning:o};return await a.createRenderer(m).then(e=>((0,n.b)(u,e.renderer),e))}async function r(e,i){const{layer:t,useFeatureReduction:o,mapImageSublayer:r,mapView:l}=e,d=t;i=i||{};const c=(0,n.g)(e),p=(0,n.d)(e),u=c.authoringInfo,m=(0,n.c)(c,"size");if(i.fieldInfos&&i.fieldInfos.length>1&&i.fieldInfos[0].field===u.field1.field&&i.normalizationField1===u.field1.normalizationField&&i.fieldInfos[1].field===u.field2.field&&i.normalizationField2===u.field2.normalizationField&&(delete i.fieldInfos,delete i.normalizationField1,delete i.normalizationField2,(0,n.O)(i)&&!m))return{renderer:c.clone()};let h=i.relationshipScheme;!h&&["relationship","relationship-size"].includes(p)&&(h=(0,n.S)(e));const g=(0,n.a)(e,c),f=i.fieldInfos?i.fieldInfos[0]:{field:u.field1.field,simpleFieldType:n.J.NUMBER},b=i.fieldInfos?i.fieldInfos[1]:{field:u.field2.field,simpleFieldType:n.J.NUMBER},y=void 0!==i.normalizationField1?i.normalizationField1:u.field1.normalizationField,S=void 0!==i.normalizationField2?i.normalizationField2:u.field2.normalizationField,v=c.uniqueValueInfos?.length?c.uniqueValueInfos[0].symbol:null,$=c.defaultSymbol,z=c.defaultLabel,M=i.numClasses?i.numClasses:u.numClasses,I={layer:d,view:l,field1:{field:f?f.field:c.field,normalizationField:y},field2:{field:b?b.field:c.field,normalizationField:S},classificationMethod:i.classificationMethod?i.classificationMethod:"manual"!==u.classificationMethod?u.classificationMethod:"quantile",numClasses:M,focus:i.focus?i.focus:u.focus,relationshipScheme:h,outlineOptimizationEnabled:!r&&((0,s.i)(i.outlineOptimizationEnabled)?i.outlineOptimizationEnabled:!!g.sizeOutlineVisVar),sizeOptimizationEnabled:!r&&((0,s.i)(i.sizeOptimizationEnabled)?i.sizeOptimizationEnabled:!!g.sizeAutoVisVar),legendOptions:i.legendOptions?i.legendOptions:c.legendOptions,defaultSymbolEnabled:(0,s.i)(i.defaultSymbolEnabled)?i.defaultSymbolEnabled:!!c.defaultSymbol,forBinning:o};return await a.createRenderer(I).then(i=>((0,n.b)(g,i.renderer),v&&i.renderer.uniqueValueInfos.forEach(e=>{const i=v.clone();(0,n.y)(i,(0,n.i)(e.symbol)),e.symbol=i}),(0,n.g)(e).uniqueValueInfos.forEach(e=>{const t=i.renderer.uniqueValueInfos.find(i=>e.value===i.value);t&&(t.label=e.label)}),$&&(i.renderer.defaultSymbol=$,i.renderer.defaultLabel=z),i))}async function l(e,i){i=i||{};const t=(0,n.g)(e),s=t.authoringInfo;return await a.updateRenderer({field1:s.field1,field2:s.field2,numClasses:i.numClasses?i.numClasses:s.numClasses,focus:i.focus?"none"===i.focus?null:i.focus:s.focus,colors:i.colors,renderer:t})}},89989:(e,i,t)=>{t.d(i,{w:()=>s});var a=t(54312),n=t(1225);t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(28927),t(83368),t(89704),t(5294),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(75698),t(10628),t(59640),t(64451),t(6176),t(83552),t(77462),t(49403),t(10281),t(83930),t(66617),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(6238),t(7299);function s(e,i,t){const{layer:s,mapView:r,useFeatureReduction:l}=e;return l&&"featureReduction"in s&&"binning"===s.featureReduction.type?a.watch(()=>r.scale,()=>{const a=s.featureReduction;r.scale<=a.maxScale&&!i.disabled?((0,n.f)(),function(e,i,t){const a=document.createElement("arcgis-map-config-smart-mapping-scale-alert-popover");a.smartMappingState=e,a.refElement=i,a.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",()=>{o(),t()}),document.body.append(a)}(e,i,t),(0,n.h)(i,!0)):r.scale>a.maxScale&&i.disabled&&(o(),(0,n.h)(i,!1),i.setFocus())}):void 0}function o(){document.querySelectorAll("arcgis-map-config-smart-mapping-scale-alert-popover").forEach(e=>e.remove())}}}]);