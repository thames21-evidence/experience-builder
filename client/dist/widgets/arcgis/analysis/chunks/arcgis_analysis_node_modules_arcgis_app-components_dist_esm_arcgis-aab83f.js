/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-aab83f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-aab83f"],{26854:(e,t,i)=>{i.d(t,{a:()=>o,c:()=>l,g:()=>n,h:()=>a,i:()=>s,r:()=>c});var r=i(15332);function a(e){const t=document.createElement("textarea");return t.innerHTML=e,t.innerText}function n(e){return function(e){return null==e?void 0:e.replace(/&#10;&#13;|&#10;|&#13;|\r\n|\r|\n/g,"<br>")}(function(e){return null==e?void 0:e.replace(/(?:\r)/g,"&#10;").replace(/(?:\n)/g,"&#13;")}(function(e){return null==e?void 0:e.replace(/(https?:\/\/[^\s]+)/g,e=>`<a href="${e}" target="_blank">${e}</a>`)}(function(e){return null==e?void 0:e.replace(/(?:&#10;)/g,"\r").replace(/(?:&#13;)/g,"\n")}(e))))}function s(e){return e.replace(/\$\{startSup\}/g,"<sup>").replace(/\$\{endSup\}/g,"</sup>")}function c(e,t,i){return e.replace(/\$\{startLink\}/g,`<calcite-link label="${i}" href="${t}" target="_blank">`).replace(/\$\{endLink\}/g,"</calcite-link>")}function o(e){return e.replace(/\$\{startStrong\}/g,"<strong>").replace(/\$\{endStrong\}/g,"</strong>")}function l(e){return(0,r.s)((null==e?void 0:e.trim())||"").replace(/[!*+\-&|()[\]{}^~?:"\\]/g,"\\$&")}},36443:(e,t,i)=>{i.d(t,{a:()=>n,g:()=>s});var r=i(83692),a=i(41473);const n=async e=>{try{return{result:await(0,r.r)(`${(0,a.g)(e)}portals/self/subscriptionInfo`)}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},s=async(e,t)=>await(0,r.f)(()=>n(e),"subscriptionType",(0,r.b)(t))},71366:(e,t,i)=>{i.r(t),i.d(t,{arcgis_new_item_pages_developer_credentials_input:()=>g});var r=i(87849),a=i(36443),n=i(59317),s=i(41473),c=i(74695),o=i(3826),l=i(95878),d=i(10578),p=i(1654),h=i(26854);i(83692),i(931),i(93814),i(54251),i(37762),i(88878),i(46904),i(24869),i(15912),i(72257),i(86562),i(15332),i(27137),i(76246),i(58573),i(1536),i(29599),i(60958),i(32478);const u=864e5,f=1e3;const g=class{constructor(e){(0,r.r)(this,e),this.newItemUpdatePage=(0,r.c)(this,"newItemUpdatePage",7),this.workflowComplete=(0,r.c)(this,"workflowComplete",7),this.newItemSetButtonState=(0,r.c)(this,"newItemSetButtonState",7),this.maxDate=null,this.minDate=null,this.canShowLearnMore=!0,this.isRegisteringApiKey=!1,this.isGeoAnalyticsSub=!1,this.isTerminalPage=!1,this.determineNextPage=()=>{const{isRegisteringApiKey:e}=this,t=(0,d.v)(n.c.user)&&!this.isGeoAnalyticsSub;switch(!0){case e:return"serviceScope";case t:return"developerCredentialsPrivilegePicker";default:return"itemProperties"}},this.isRegisterTerminalPage=()=>"register"===l.u.workflow&&"oauth"===this.selectedCredentialType,this.setAlertMessage=e=>{this.alertInfo=this.i18n.error[e]},this.setUnsupportedUrlAlertMessage=()=>{const e=this.i18nBase.featureLayerFromUrl.error;this.alertInfo={title:e.invalidFeatureLayerUrl.title,description:this.i18n.error.registerError.description}},this.alertInfo=void 0,this.selectedApplicationEnvironment="multiple",this.redirectUrls=[],this.referrerUrls=[],this.expirationDate=null,this.url="",this.canCreateAPIKey=!1}async componentWillLoad(){var e,t;this.i18n=l.u.i18n.developerCredentialsInput,this.i18nBase=l.u.i18n;const i=o.a.existingItem;if(await this.setUpSubscriptionInfo(),this.selectedCredentialType=o.a.developerCredentialsType,this.isGeoAnalyticsSub=(0,p.r)(n.c.subscriptionInfo),this.selectedCredentialType=this.isGeoAnalyticsSub?"apiToken":o.a.developerCredentialsType,this.isGeoAnalyticsSub&&(o.a.breadcrumbs=["apiCredentialType"]),i){const e=i.type,t=l.u.workflow;switch(!0){case"API Key"===e:this.isRegisteringApiKey=!0,l.u.nextText="register";break;case"register"===t:this.selectedCredentialType="oauth"}}if(this.isRegisterTerminalPage()&&(l.u.nextText="register",this.isTerminalPage=!0),"apiToken"===this.selectedCredentialType){this.maxDate=function(e){const t=new Date;return t.setFullYear(t.getFullYear()+e),t.setTime(t.getTime()+u-f),t}(1),this.minDate=new Date;const e=o.a.apiToken1ExpirationDate,t=new Date;t.setDate(t.getDate()+90),this.expirationDate=e?new Date(e):t}this.selectedApplicationEnvironment=o.a.applicationEnvironment||"multiple",this.url=null!==(e=o.a.url)&&void 0!==e?e:null===(t=o.a.existingItem)||void 0===t?void 0:t.url;const r=o.a.developerCredentialsRedirectUrls;this.redirectUrls=(null==r?void 0:r.length)>0?r:[""];const a=o.a.apiKeyReferrerUrls;this.referrerUrls=(null==a?void 0:a.length)>0?a:[""];const{portal:s,config:{helpBase:c}}=n.c;this.canShowLearnMore=!s.isPortal||c.includes("https://enterprise.arcgis.com/")}validateExpirationDate(){if(this.expirationDate>this.maxDate)return this.setAlertMessage("invalidDate"),void this.newItemSetButtonState.emit({targetButton:"primary",state:{loading:!1,disabled:!0}});this.newItemSetButtonState.emit({targetButton:"primary",state:{loading:!1,disabled:!1}}),this.alertInfo=null}async handleNext(){const{selectedCredentialType:e,selectedApplicationEnvironment:t,isRegisterTerminalPage:i,redirectUrls:r,redirectManagementRef:a,referrerUrls:l,referrerManagementRef:d,urlRef:p,setAlertMessage:h,url:g,expirationDate:m,isRegisteringApiKey:b}=this;if(await(null==p?void 0:p.validateInput()))return void p.focusMainInput();const y=r.filter(e=>e);if(b||"oauth"===e){if(y.length<=0)return h("redirectEmpty"),void a.focusInputByIndex(0);if(new Set(y).size!==y.length)return h("redirectDuplicated"),void a.focusInputByIndex(0)}const v=l.filter(e=>e);if(b&&v.length<1)return h("referrerEmpty"),void d.focusInputByIndex(0);if(0!==v.length){if(!await this.referrerManagementRef.validateAllInputs({focusWhenInvalid:!0}))return}if(!m&&"apiToken"===e)return h("expirationDateEmpty"),void this.expirationDateRef.focus();if("oauth"===e){if(!await this.redirectManagementRef.validateAllInputs({focusWhenInvalid:!0}))return void this.setUnsupportedUrlAlertMessage()}if(i()){const{result:e}=await(0,c.z)("oauth",o.a.id,(0,s.g)(n.c.portal),{appType:t,redirect_uris:y,httpReferrers:v,url:g});return void(e?this.workflowComplete.emit({id:o.a.id,redirectUrls:y,httpReferrers:v,clientId:e.client_id,clientSecret:e.client_secret,appType:e.appType}):this.setUnsupportedUrlAlertMessage())}o.a.developerCredentialsType=e,o.a.applicationEnvironment=b?void 0:t,o.a.apiKeyReferrerUrls=v,o.a.developerCredentialsRedirectUrls=y,o.a.type=b?"API Key":"Application",o.a.url=b?void 0:g;const k=new Date;k.setDate(k.getDate()+90),k.setTime(k.getTime()+u-f),o.a.apiToken1ExpirationDate="apiToken"===e?m.getTime():k.getTime(),this.isGeoAnalyticsSub&&(o.a.selectedAppPrivileges=["premium:user:basemaps"]),this.newItemUpdatePage.emit(this.determineNextPage())}async setUpSubscriptionInfo(){if(!n.c.subscriptionInfo){const{result:e}=await(0,a.g)(n.c.portal,n.c.user);n.c.subscriptionInfo=e}this.canCreateAPIKey=(0,d.w)()}handleExpirationDate(e){const t=e.getTime()+u-f,i=new Date(t);this.expirationDate=i}validateReferrerUrl(e){if(e.length){if(e.includes("*")){const t=e.indexOf("//")+2,i=t+1;return e.length>1&&"*"===e[0]&&"."===e[1]||"*"===e[t]&&"."===e[i]||(this.alertInfo={title:this.i18n.error.referrerHasInvalidWildcard.title,description:this.i18n.error.referrerHasInvalidWildcard.description},!1)}return!0}return!1}render(){const{i18n:e,selectedCredentialType:t,selectedApplicationEnvironment:i,redirectUrls:a,alertInfo:n,referrerUrls:s,url:c,isRegisteringApiKey:d,canShowLearnMore:p,expirationDate:u,isTerminalPage:f}=this,{breadcrumbs:g}=o.a;return(0,r.h)(r.H,{key:"82bb4af64fb03ed1452bb0747f13e3c937c6516d"},!f&&(0,r.h)("arcgis-new-item-breadcrumbs",{key:"a2fe23ded58adf90f0ec3e53263d684c2c92d2d3",breadcrumbs:g}),!f&&(0,r.h)("div",{key:"559588d503acf8689634a485a38cddb7e6352774",class:"settings-header"},(0,r.h)("arcgis-new-item-description",{key:"09472d16b47d5aed951c45fc267009fde853925a",header:e.settings})),d&&(0,r.h)("p",{key:"0e65b2362bceaceec79843e0029d334225384213",innerHTML:p?e.oauth2Hint.replace("${apiLinkStart}",'<a href="https://developers.arcgis.com/documentation/mapping-apis-and-services/security/types-of-authentication/" target="_blank">').replace("${endLink}","</a>"):e.oauth2HintNoLink}),(d||"oauth"===t)&&(0,r.h)("div",{key:"a85398696c030d40039ab03919297ec77d0b56c7",class:"section"},(0,r.h)("arcgis-data-array-management",{key:"7794fbd861603734ad97b22ec518fe90d0c2c074",header:e.redirectUrlsTitle,description:e.redirectUrlsDescription,addNewText:l.u.i18n.common.add,placeholder:"https://<server>[:port]",initialData:a,required:!0,validateData:e=>{const t=new RegExp(/[^ -~]/).test(e.content);return e.content.length>0&&!t},onDataChanged:({detail:{allData:e}})=>{this.redirectUrls=e.map(e=>e.content.trim())},ref:e=>this.redirectManagementRef=e})),"apiToken"===t&&(0,r.h)("div",{key:"b13fdf45f4234c00f3fb038a6e0261afcfc6b246",class:"section"},(0,r.h)("arcgis-new-item-description",{key:"ed35389d6f49e26cc0e05d40a86d1d00b86e2f7f",header:e.setExpirationDateTitle,content:e.setExpirationDateDescription}),(0,r.h)("div",{key:"6ca0d61a9e751d9f7b841abf7e153878ee522232",class:"expiration-date-container"},(0,r.h)("calcite-label",{key:"db87650de307445c336c8c1de3a451c4fec8dc4c"},(0,r.h)("p",{key:"cf622deb825a80fe257be3123d9e777b93a51a3c",class:"expiration-date-subheader"},e.expirationDate),(0,r.h)("calcite-input-date-picker",{key:"e7a6c3b5a6bfe7b005f21410cffa819965f8f496",placement:"bottom-start",valueAsDate:(null==u?void 0:u[0])||u,min:this.minDate.toISOString().split("T")[0],minAsDate:this.minDate,maxAsDate:this.maxDate,ref:e=>this.expirationDateRef=e,onCalciteInputDatePickerChange:e=>{const t=e.target.valueAsDate,i=Array.isArray(t)?t[0]:t;this.handleExpirationDate(i)}})))),(0,r.h)("div",{key:"d4e6e8d24f0af46405940751db7ba5f731b423df",class:"section"},(0,r.h)("div",{key:"5d1fb308881af4d266d518ff8f324210415d7a20",class:"data-array-header"},e.referrerUrlsTitle),(0,r.h)("div",{key:"ea38b6254c86d8ae4bfa09aa8901f1207fb4e843",class:"data-array-content",innerHTML:(0,h.r)(e.referrerUrlsDescription,"apiToken"===t?"https://developers.arcgis.com/documentation/security-and-authentication/api-key-authentication/api-key-credentials/#referrers":"https://developers.arcgis.com/documentation/security-and-authentication/app-authentication/oauth-credentials-app/#referrers",e.referrerUrlsDescription)}),(0,r.h)("arcgis-data-array-management",{key:"3e592abef2231e29121ed18e3c14ff538bf49787",addNewText:l.u.i18n.common.add,placeholder:"https://your-app.com",initialData:s,required:!0,validateData:e=>this.validateReferrerUrl(e.content),onDataChanged:({detail:{allData:e}})=>{this.referrerUrls=e.map(e=>e.content.trim())},ref:e=>this.referrerManagementRef=e})),"oauth"===t&&(0,r.h)("div",{key:"d0c431cd53bf503d93780fbedde83494aba0cb86",class:"section"},(0,r.h)("arcgis-application-environment",{key:"1faf3016ec14c3b06138e781350e774296b7f172",defaultEnvironment:i,onArcgisApplicationEnvironmentChange:e=>{this.selectedApplicationEnvironment=e.detail}})),!d&&"oauth"===t&&(0,r.h)("div",{key:"f9972ddff7f0a841d6b3bc0b15f8d7b0c246887b",class:"section"},(0,r.h)("arcgis-new-item-url",{key:"3365524809d76186bcd44bc18e2007e1807fc26b",onNewItemUrlChange:e=>{this.url=e.detail.url},url:c,ref:e=>this.urlRef=e,required:!1,headerScale:"m"})),(0,r.h)("arcgis-new-item-alert",{key:"5e70d801a34dc4f93646579b37ca580bd0dc4418",heading:null==n?void 0:n.title,description:null==n?void 0:n.description,active:!!n,onAlertDismiss:()=>this.alertInfo=null}))}static get watchers(){return{expirationDate:["validateExpirationDate"]}}};g.style=".section{margin-bottom:2rem}.settings-header{margin-bottom:0.75rem;font-size:1rem}.expiration-date-container{margin-top:1rem;margin-bottom:1.5rem;padding:1.5rem;background-color:var(--calcite-color-background)}.expiration-date-subheader{margin-bottom:0.75rem}calcite-input-date-picker{width:13rem}.data-array-header{padding:0px;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1);min-width:0px;margin-top:0px;margin-bottom:0px;overflow-wrap:anywhere;line-height:1.5}.data-array-content{font-size:0.875rem;margin-top:0.25rem;line-height:1.5}"}}]);