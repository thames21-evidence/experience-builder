/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-45faf4.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-45faf4"],{2801:(e,t,r)=>{r.d(t,{a:()=>P,b:()=>S,c:()=>T,d:()=>I,e:()=>w,f:()=>d,g:()=>k,h:()=>j,i:()=>g,j:()=>b,k:()=>O,l:()=>v,m:()=>m,n:()=>D,o:()=>$,p:()=>F,q:()=>R,r:()=>E,s:()=>h,u:()=>N});var i=r(66228),n=r(13661),a=r(21255),s=r(59102),o=(r(2924),r(33752),r(44345)),l=r(588),f=r(51072),c=(r(63438),r(18423),r(96086),r(91813),r(13078),r(21303),r(12627),r(4265)),d=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADING=1]="LOADING",e[e.SELECTION=2]="SELECTION",e[e.OVERVIEW=3]="OVERVIEW",e[e.SWAP_SOURCE=4]="SWAP_SOURCE",e[e.BROWSE_LAYER=5]="BROWSE_LAYER",e[e.DEFINITION=6]="DEFINITION",e[e.FILTER=7]="FILTER",e[e.CREATE=8]="CREATE",e))(d||{});function u(e){return!e?.filter||!(e.filter?.geometry||e.filter?.distance||e.filter?.objectIds||e.filter?.timeExtent||e.filter?.where)}function y(e,t,r){const{backgroundTheme:i}=r,n="light"===i?100:65;e.featureEffect=new t({filter:{},excludedEffect:`grayscale(100%) opacity(30%) brightness(${n}%)`,excludedLabelsVisible:!0})}function p(e,t){return e===t||Math.round(1e6*e)/1e6==Math.round(1e6*t)/1e6}function m(e,t){const r=["oid","esriFieldTypeOID","global-id","esriFieldTypeGlobalID","geometry","esriFieldTypeGeometry"];let n;if(t)n=t.fields;else{const{definitionLayerId:t}=e;n=O(t,e)?.fields||v(t,e).fields}return n.filter(e=>r.includes(e.type)||!e.nullable&&!(0,i.i)(e.defaultValue)).map(e=>e.name)}async function g(e){const{viewItem:t,adminServiceInfo:r,layer:i}=e;if(t){if(!r)return;e.layerIds=[],P(r).forEach(async t=>{e.layerIds.push(t.id);const r=[];t.fields.forEach(e=>{!1!==e.visible&&r.push(e.name)}),r.length!==t.fields.length&&I(t.id,{fields:r},e);const i=t.viewDefinitionQuery;i&&(I(t.id,{filter:i},e),E(i,t.id,e));const s=t.adminLayerInfo?.viewLayerDefinition?.table?.filter?.value;if(s){I(t.id,{aoi:JSON.parse(JSON.stringify(s.geometry))},e);b(s.geometry.rings?a.default.fromJSON(s.geometry):n.default.fromJSON(s.geometry),t.id,e)}}),i&&"group"===i.type?(k(i).forEach(t=>{t.visible=e.layerIds.includes(t.layerId),t.definitionExpression=null}),T(i)?.forEach(e=>{e.definitionExpression=null})):(i.visible=e.layerIds.includes(i.layerId),i.definitionExpression=null)}else"group"===i.type?(k(i)?.forEach(t=>{t.definitionExpression&&(I(t.layerId,{filter:t.definitionExpression},e),E(t.definitionExpression,t.layerId,e),t.definitionExpression=null)}),i.tables?.forEach(t=>{const r=t;r.definitionExpression&&(I(r.layerId,{filter:r.definitionExpression},e),E(r.definitionExpression,r.layerId,e),r.definitionExpression=null)})):i?.definitionExpression&&(I(i.layerId,{filter:i.definitionExpression},e),E(i.definitionExpression,i.layerId,e),i.definitionExpression=null)}function w(e,t){const{viewProps:r}=t;return r?.find(t=>e===t.layerId)}function h(e){const{viewProps:t}=e;t&&(e.viewProps=t.filter(e=>e.filter||e.aoi||e.fields),e.viewProps.length||(e.viewProps=void 0))}function I(e,t,r){let i=w(e,r);i||(i={layerId:e});const n={...i,...t};r.viewProps=r.viewProps?.filter(t=>t.layerId!==e),r.viewProps=r.viewProps||[],r.viewProps.push(n)}function v(e,t){const{layer:r}=t;return"group"===r.type?P(r).find(t=>t.layerId===e):r}async function E(e,t,r){const i=v(t,r);if(i.isTable)return await new Promise(e=>{e()});if(e){let t=0;const n=setInterval(()=>{i.featureEffect?.filter||y(i,s.default,r),i.featureEffect.filter.where=e,t++,3===t&&clearInterval(n),i.featureEffect=i.featureEffect.clone()},200)}else i.featureEffect.filter.where=null,u(i.featureEffect)&&(i.featureEffect=null),i.featureEffect=i.featureEffect?.clone()}async function b(e,t,r){const i=v(t,r);if(e){let t=0;const o=setInterval(()=>{i.featureEffect?.filter||y(i,s.default,r);const l="polygon"===e.type?a.default.fromJSON(e.toJSON()):n.default.fromJSON(e.toJSON());i.featureEffect.filter.geometry=l,t++,3===t&&clearInterval(o),i.featureEffect=i.featureEffect.clone()},200)}else i.featureEffect.filter.geometry=null,u(i.featureEffect)&&(i.featureEffect=null),i.featureEffect=i.featureEffect?.clone()}function x(e){const{url:t}=e;if(!t)return"";const r=["/FeatureServer","/MapServer"].filter(e=>t.toLowerCase().includes(e.toLowerCase()))?.[0];let i="";return r&&(i=t.substring(0,t.indexOf(r)),i=i.substring(i.lastIndexOf("/")+1,i.length)),i}function P(e){const t=k(e),r=T(e);return t?.length&&r?.length?t.concat(r):t?.length?t:r}function k(e){return e.layers?.filter(e=>"feature"===e.type||"Feature Layer"===e.type)}function T(e){return e.tables?.filter(e=>"feature"===e.type||"Feature Layer"===e.type)}async function D(e){const{layerItem:t,layer:r,_messages:i}=e,n=`${t.itemUrl}/relatedItems`,a=(await(0,o.default)(n,{query:{relationshipType:"Service2Service",direction:"forward",f:"json",token:(r.portalItem?.portal).credential?.token},method:"post",responseType:"json"}))?.data?.relatedItems?.filter(e=>"Feature Service"===e.type&&(e.title.indexOf(t.title)>-1||e.title.indexOf(t.title.replace(/ /gu,"_"))>-1||e.title.replace(/ /gu,"_").indexOf(t.title)>-1))||[];return`${t.title}${a.length?` ${a.length+1}`:""} ${i.createView.view}`}async function S(e,t){const{layer:r,viewItem:i,adminServiceInfo:n}=e;if(n)return;let a=(i?.url||r.portalItem.url).replace("/rest/services","/rest/admin/services");t&&(a+=`${a.includes("?")?"&":"?"}_ts=${(new Date).getTime()}`);try{await l.default.getCredential(a);const t=await(0,o.default)(a,{query:{f:"json"}});e.adminServiceInfo=t.data}catch{return await Promise.reject(new Error("could not get admin info"))}}function O(e,t){const{adminServiceInfo:r}=t,i=r?.layers?.find(t=>t.id===e);return i||r?.tables?.find(t=>t.id===e)}function j(e){const{layer:t,layerIds:r,adminServiceInfo:i}=e;if("group"===t.type){const n=i&&P(i);return!(i&&n.length===r.length&&n.every(e=>r.includes(e.id)))||P(t).filter(e=>{const t=e;return r.includes(t.layerId)}).some(t=>L(t.layerId,e))}return L(t.layerId,e)}function L(e,t){const{viewItem:r}=t,i=v(e,t),n=w(e,t),a=O(e,t),s=r&&a?.fields?a.fields.filter(e=>e.visible):a?.fields||i.fields;if(n){if(n.filter!==a?.viewDefinitionQuery||n.fields&&n.fields.length!==s.length||!n.fields&&s.length!==i.fields.length||!i.isTable&&!function(e,t){const r=t?.adminLayerInfo?.viewLayerDefinition?.table?.filter?.value;if(!e?.aoi&&!r)return!0;if(e?.aoi&&!r||!e?.aoi&&r||e.aoi.rings&&"esriGeometryPolygon"!==r.geometryType||e.aoi.xmin&&"esriGeometryEnvelope"!==r.geometryType)return!1;if(e.aoi.xmin){const t=e.aoi,i=r.geometry;return!!(p(t.xmin,i.xmin)&&p(t.xmax,i.xmax)&&p(t.ymin,i.ymin)&&p(t.ymax,i.ymax))}if(e.aoi.rings)return e.aoi.rings[0].length===r.geometry.rings[0].length&&e.aoi.rings[0].every(e=>r.geometry.rings[0].some(t=>p(e[0],t[0])&&p(e[1],t[1])));return!1}(n,a))return!0}else if(a?.viewDefinitionQuery||s.length<i.fields.length||!i.isTable&&a?.adminLayerInfo?.viewLayerDefinition?.table?.filter?.value)return!0;return!1}async function $(e,t){try{const r=await async function(e,t,r){const{layer:i,layerIds:n}=e,a=i.portalItem,s=a.portal,o=v(n[0],e),f=`${s.restUrl}/content/users/${a.owner}/createService`,c=l.default.findCredential(f),d={name:t.title.replace(/ /gu,"_"),isView:!0,sourceSchemaChangesAllowed:!0,isUpdatableView:!0,spatialReference:o.sourceJSON.extent?.spatialReference,initialExtent:o.sourceJSON.extent,capabilities:"Query",preserveLayerIds:!0};if(s.isPortal){const t=function(e){const{adminServiceInfo:t}=e,r=t?.adminServiceInfo?.database?.datasource||{};return r?.name?.indexOf("/nosqlDatabases")>-1?"spatiotemporal":r?.name?.indexOf("/enterpriseDatabases")>-1?"relational":null}(e);t&&(d.options={dataSourceType:t})}const u={createParameters:JSON.stringify(d),outputType:"featureService",tags:t.tags?.length?t.tags.toString():void 0,snippet:t.summary,categories:t.categories?.join(","),isView:!0};try{return(await r(f,{query:{...u,f:"json",token:c.token},method:"post",responseType:"json"})).data}catch(e){return e.message.indexOf(" already exists ")>-1?await Promise.reject(new Error("service name already exists")):await Promise.reject(new Error("create service failed"))}}(e,t,o.default);return await R(e,r,o.default),await async function(e,t,r,i){const{layer:n,layerIds:a}=e,s=n.portalItem,o=s.portal,f=await n.portalItem.fetchData(),c=f?.layers||f?.tables;c&&(f.layers=f.layers?.filter(e=>a.includes(e.id)),f.tables=f.tables?.filter(e=>a.includes(e.id)),"group"===n.type&&k(n)?.length&&(f.layers=f.layers||void 0),"group"===n.type&&T(n)?.length&&(f.tables=f.tables||void 0),f.layers?.forEach(e=>{e.layerDefinition&&(e.layerDefinition.definitionExpression=void 0)}),f.tables?.forEach(e=>{e.layerDefinition&&(e.layerDefinition.definitionExpression=void 0)}));const d=`${o.restUrl}/content/users/${s.owner}/items/${t.itemId}/update`,u=l.default.findCredential(d),y={title:r.title,tags:r.tags?.length?r.tags.toString():void 0,snippet:r.summary,categories:r.categories?.join(",")};return c&&(y.text=JSON.stringify(f)),("group"===n.type&&k(n)?.getItemAt(0)?.fullExtent?.spatialReference?.wkt||"feature"===n.type&&n.fullExtent?.spatialReference?.wkt)&&setTimeout(()=>{const e={extent:`${s.extent.xmin},${s.extent.ymin},${s.extent.xmax},${s.extent.ymax}`};i(d,{query:{...e,f:"json",token:u.token},method:"post",responseType:"json"})},7e3),await i(d,{query:{...y,f:"json",token:u.token},method:"post",responseType:"json"})}(e,r,t,o.default),await async function(e,t,r,i){const{layer:n}=e,a=n.portalItem,{portal:s}=a;if(!r.folder?.id||r.folder.id===a.owner)return;const o=`${s.restUrl}/content/users/${a.owner}/items/${t.itemId}/move`,f=l.default.findCredential(o),c={folder:r.folder.id};return await i(o,{query:{...c,f:"json",token:f.token},method:"post",responseType:"json"})}(e,r,t,o.default),r.itemId}catch(e){return"service name already exists"===e.message?await Promise.reject(new Error(e.message)):await Promise.reject(new Error("createView failed"))}}async function N(e){const{viewItem:t}=e;try{const{addLayerIds:r,deleteLayerIds:i}=await async function(e,t,r){const{layer:i,layerIds:n,adminServiceInfo:a}=e,s=i.portalItem,{portal:o}=s,l=[],f=[];try{const c=t.url.replace("rest/services","rest/admin/services");if("group"===i.type){a?.layers?.forEach(e=>{n.includes(e.id)||l.push(e.id)});const t=[];if(a?.tables?.forEach(e=>{n.includes(e.id)||t.push(e.id)}),l.length||t.length){const e=`${c}/deleteFromDefinition`;await J(e,{layers:l?.map(e=>({id:e})),tables:t?.map(e=>({id:e}))},s,r);const f=[];if(P(i).filter(e=>n.includes(e.layerId)).forEach(async e=>{if(e.relationships?.length){const r=P(a).find(t=>t.id===e.layerId);if(r?.relationships?.length){const i=r.relationships.filter(e=>l.includes(e.relatedTableId)||t.includes(e.relatedTableId));if(i.length){const t={};t.relationships=i;const r=`${c}/${e.layerId}/deleteFromDefinition`;f.push({delFromDefUrl:r,json:t})}}}}),f.length)if(o.isPortal)for(const e of f)await J(e.delFromDefUrl,e.json,s,r);else{const e=[];f.forEach(t=>{e.push(J(t.delFromDefUrl,t.json,s,r))}),await Promise.all(e)}}if(n.forEach(e=>{P(a).some(t=>t.id===e)||f.push(e)}),f.length){const t=k(i)?.filter(e=>f.includes(e.layerId)).map(t=>U(t,e)).toArray().reverse(),s=T(i)?.filter(e=>f.includes(e.layerId)).map(t=>U(t,e)).toArray().reverse();await q(`${c}/addToDefinition`,{layers:t,tables:s},r,e);const l=[];if(P(i).filter(e=>n.includes(e.layerId)).forEach(async e=>{if(e.relationships?.length){const t=P(a).find(t=>t.id===e.layerId);if(t&&e.relationships?.length!==t.relationships.length){const t={},r=e.relationships.filter(e=>f.includes(e.relatedTableId));t.relationships=r;const i=`${c}/${e.layerId}/addToDefinition`;l.push({addToDefUrl:i,json:t})}}}),l.length)if(o.isPortal)for(const t of l)await q(t.addToDefUrl,t.json,r,e);else{const t=[];l.forEach(i=>{t.push(q(i.addToDefUrl,i.json,r,e))}),await Promise.all(t)}}const d=[],u=[],y=async(t,r)=>{const i=`${c}/${r.layerId}/updateDefinition`,n=await _(r,e);return t.push({updateDefUrl:i,json:n}),await Promise.resolve()};if(P(i).filter(e=>n.includes(e.layerId)).forEach(t=>{L(t.layerId,e)&&u.push(y(d,t))}),await Promise.all(u),d.length)if(o.isPortal)for(const t of d)await C(t.updateDefUrl,t.json,r,e);else{const t=[];d.forEach(i=>{t.push(C(i.updateDefUrl,i.json,r,e))}),await Promise.all(t)}}else if(L(i.layerId,e)){const t=await _(i,e),n=`${c}/${i.layerId}/updateDefinition`;await C(n,t,r,e)}return Promise.resolve({addLayerIds:f,deleteLayerIds:l})}catch(e){return console.error(e),await Promise.reject(new Error("updateDefinition failed"))}}(e,t,o.default);return await async function(e,t,r,i){if(!t.length&&!r.length)return await Promise.resolve();const{layer:n,viewItem:a}=e,s=n.portalItem,o=s.portal,f=await n.portalItem.fetchData();let c=await a.fetchData();if(!(f&&(f.layers||f.tables)||c&&(c.layers||c.tables)))return await Promise.resolve();r.length&&(c?.layers?.length&&(c.layers=c.layers.filter(e=>!r.includes(e.id))),c?.tables?.length&&(c.tables=c.tables.filter(e=>!r.includes(e.id))));const d=!!c?.layers?.length||!!c?.tables?.length;if(t.length){const r=[],i=[];if(t.forEach(t=>{if(v(t,e).isTable){let e;f?.tables&&(e=f.tables.find(e=>e.id===t),e?.layerDefinition&&(e.layerDefinition.definitionExpression=void 0)),!e&&d&&(e={id:t}),e&&i.push(e)}else{let e;f?.layers&&(e=f.layers.find(e=>e.id===t),e?.layerDefinition&&(e.layerDefinition.definitionExpression=void 0)),!e&&d&&(e={id:t}),e&&r.push(e)}}),r?.length){c=c||{},c.layers=(c.layers||[]).concat(r);const e=[];n.layers?.forEach(t=>{"feature"===t.type&&e.unshift(t.layerId)}),c.layers.sort((t,r)=>e.indexOf(t.id)<e.indexOf(r.id)?-1:1)}if(i?.length){c=c||{},c.tables=(c.tables||[]).concat(i);const e=[];n.tables?.forEach(t=>{"feature"===t.type&&e.unshift(t.layerId)}),c.tables.sort((t,r)=>e.indexOf(t.id)<e.indexOf(r.id)?-1:1)}}const u=`${o.restUrl}/content/users/${s.owner}/items/${a.id}/update`,y=l.default.findCredential(u),p={tags:a.tags?.length?a.tags.toString():void 0,snippet:a.snippet,categories:a.categories?.join(","),text:JSON.stringify(c)};return await i(u,{query:{...p,f:"json",token:y.token},method:"post",responseType:"json"})}(e,r,i,o.default),Promise.resolve()}catch{return await Promise.reject(new Error("updateView failed"))}}async function F(e,t){const{layer:r,viewItem:i,adminServiceInfo:n}=e,a=r.portalItem,s=[];n?.layers?.forEach(e=>{s.push(e.id)});const o=[];if(n?.tables?.forEach(e=>{o.push(e.id)}),s.length||o.length){const e=`${i?.url?.replace("rest/services","rest/admin/services")}/deleteFromDefinition`;await J(e,{layers:s?.map(e=>({id:e})),tables:o?.map(e=>({id:e}))},a,t)}return await Promise.resolve()}async function R(e,t,r){const{layer:i,layerIds:n}=e;let a,s;"group"===i.type?(a=k(i)?.filter(e=>n.includes(e.layerId)).map(t=>U(t,e)).toArray().reverse(),s=T(i)?.filter(e=>n.includes(e.layerId)).map(t=>U(t,e)).toArray().reverse()):i.isTable?s=[U(i,e)]:a=[U(i,e)];try{const i=t.serviceurl.replace("rest/services","rest/admin/services");await q(`${i}/addToDefinition`,{layers:a,tables:s},r,e),await async function(e,t,r){const{layer:i,layerIds:n}=e,{portalItem:a}=i,{portal:s}=a,o=t.serviceurl.replace("rest/services","rest/admin/services");try{if("group"===i.type){const t=[],a=P(i).filter(e=>n.includes(e.layerId));for(let r=0;r<a.length;r++){const i=a.getItemAt(r);if(L(i.layerId,e)){const r=await _(i,e),n=`${o}/${i.layerId}/updateDefinition`;t.push({updateDefUrl:n,json:r})}}if(t.length)if(s.isPortal)for(const i of t)await C(i.updateDefUrl,i.json,r,e);else{const i=[];t.forEach(t=>{i.push(C(t.updateDefUrl,t.json,r,e))}),await Promise.all(i)}}else if(L(i.layerId,e)){const t=await _(i,e),n=`${o}/${i.layerId}/updateDefinition`;await C(n,t,r,e)}return Promise.resolve()}catch{return await Promise.reject(new Error("updateDefinitions failed"))}}(e,t,r)}catch{return await Promise.reject(new Error("initialAddToDefinition failed"))}}async function C(e,t,r,i,n=!1){const{layer:a,viewItem:s}=i,o={updateDefinition:JSON.stringify(t)},f=l.default.findCredential(e);try{const t=a.portalItem.portal,i=s?.typeKeywords&&s.typeKeywords?.indexOf("IoTFeatureLayer")>-1,n=await r(e,{query:{...o,f:"json",async:!t.isPortal&&!i,token:f.token},method:"post",responseType:"json"});if(t.isPortal||i)return Promise.resolve();try{return await A(n?.data?.statusURL,{f:"json",token:f.token},r),Promise.resolve()}catch{return Promise.reject(new Error("updateDefinition request failed (poll)"))}}catch{return n?await Promise.reject(new Error("updateDefinition request failed")):await C(e,t,r,i,!0)}}async function q(e,t,r,i,n=!1){const{layer:a,viewItem:s}=i,o={addToDefinition:JSON.stringify(t)};let f=l.default.findCredential(e);f||(f=await l.default.getCredential(e));try{const t=a.portalItem.portal,i=s?.typeKeywords&&s.typeKeywords?.indexOf("IoTFeatureLayer")>-1,n=await r(e,{query:{...o,f:"json",async:!t.isPortal&&!i,token:f.token},method:"post",responseType:"json"});if(t.isPortal||i)return Promise.resolve();try{return await A(n?.data?.statusURL,{f:"json",token:f.token},r),Promise.resolve()}catch{return Promise.reject(new Error("addToDefinition request failed (poll)"))}}catch{return n?await Promise.reject(new Error("addToDefinition request failed")):await q(e,t,r,i,!0)}}async function J(e,t,r,i,n=!1){const a=l.default.findCredential(e),s={deleteFromDefinition:JSON.stringify(t)};try{return await i(e,{query:{...s,f:"json",token:a.token},method:"post",responseType:"json"}),Promise.resolve()}catch{return n?await Promise.reject(new Error("deleteFromDefinition request failed")):await J(e,t,r,i,!0)}}function U(e,t){const{layer:r,layerItem:i}=t,n=e.sourceJSON;delete n.indexes,delete n.fields,delete n.serviceItemId,delete n.serverGens,delete n.relationships;const a=l.default.findCredential(r.portalItem.portal.url);return n.url=`${e.url}/${e.layerId}?token=${a.token}`,n.adminLayerInfo={viewLayerDefinition:{sourceServiceName:x(i),sourceLayerId:e.layerId,sourceLayerFields:"*"}},n}async function _(e,t){const r={},s=w(e.layerId,t);if(s){if(r.viewDefinitionQuery=s.filter||"",s.aoi){let t=s.aoi;if(!function(e,t){const r=[102113,102100,3857];return!!(e&&t&&(0,i.i)(e.wkid)&&(0,i.i)(t.wkid)&&r.includes(e.wkid)&&r.includes(t.wkid)||e&&t&&((0,i.i)(e.wkid)&&(0,i.i)(t.wkid)&&e.wkid==t.wkid||(0,i.i)(e.latestWkid)&&(0,i.i)(t.wkid)&&e.latestWkid==t.wkid||(0,i.i)(e.wkid)&&(0,i.i)(t.latestWkid)&&e.wkid==t.latestWkid||(0,i.i)(e.latestWkid)&&(0,i.i)(t.latestWkid)&&e.latestWkid==t.latestWkid))||!!(e&&t&&(0,i.i)(e.wkt)&&(0,i.i)(t.wkt)&&e.wkt===t.wkt)}(t.spatialReference,e.spatialReference)){await f.load();const r=t.rings?a.default.fromJSON(t):n.default.fromJSON(t);t=f.execute(r,e.spatialReference)?.toJSON()}const o=t.rings?"esriGeometryPolygon":"esriGeometryEnvelope";r.viewLayerDefinition={filter:{operator:"esriSpatialRelIntersects",value:{geometryType:o,geometry:t}}}}else O(e.layerId,t)?.adminLayerInfo?.viewLayerDefinition?.table?.filter?.value&&(r.viewLayerDefinition={filter:null});s.fields?r.fields=e.fields.map(e=>({name:e.name,visible:s.fields?.includes(e.name)})):r.fields=e.fields.map(e=>({name:e.name,visible:!0}))}else r.viewDefinitionQuery="",r.fields=e.fields.map(e=>({name:e.name,visible:!0})),O(e.layerId,t)?.adminLayerInfo?.viewLayerDefinition?.table?.filter?.value&&(r.viewLayerDefinition={filter:null});return r}const A=async(e,t,r)=>{if(!e)throw new Error("pollForStatus: no status URL");const i=["processing","partial","Pending","InProgress"],n=["completed","Completed"];try{const a=(await r(e,{query:t}))?.data?.status;return i.includes(a)?(await(0,c.t)(500),A(e,t,r)):n.includes(a)?Promise.resolve():Promise.reject(new Error("pollForStatus: error or unknown status"))}catch(e){return await Promise.reject(new Error(e.message))}}},4265:(e,t,r)=>{r.d(t,{a:()=>n,d:()=>i,t:()=>a});const i=(e,t)=>{let r,i="idle";const n=async(...n)=>await new Promise(a=>{switch(i){case"flushed":i="idle",r?(clearTimeout(r),a(e(...n))):a(null);break;case"invoked":clearTimeout(r),i="idle",a(e(...n));break;case"cancelled":clearTimeout(r),i="idle",a(null);break;default:r&&clearTimeout(r),i="pending",r=setTimeout(()=>{i="idle",a(e(...n))},t)}});return n.flush=async function(...e){return i="flushed",await n(...e)},n.invoke=async function(...e){return i="invoked",await n(...e)},n.cancel=async function(...e){return i="cancelled",await n(...e)},n.getStatus=function(){return i},n},n=(e,t)=>{let r;return async(...i)=>await new Promise(n=>{r||(r=setTimeout(()=>{clearTimeout(r),r=void 0,n(e(...i))},t))})};function a(e){return new Promise(t=>setTimeout(t,e))}},42855:(e,t,r)=>{r.d(t,{a:()=>s,f:()=>i,l:()=>n,s:()=>a});var i=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(i||{}),n=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(n||{}),a=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(a||{}),s=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(s||{})},66228:(e,t,r)=>{r.d(t,{a:()=>h,b:()=>T,c:()=>j,d:()=>k,e:()=>D,f:()=>$,g:()=>g,h:()=>w,i:()=>p,j:()=>m,k:()=>E,l:()=>L,m:()=>x,n:()=>u,o:()=>b,p:()=>R,q:()=>O,r:()=>F,s:()=>v,t:()=>P,u:()=>I});var i=r(63438),n=r(18423),a=r(96086),s=r(91813),o=r(21255),l=r(13078),f=r(21303),c=r(12627),d=r(42855);const u=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],y=["feature"];function p(e){return null!=e}function m(e,t,r){const i=t.fieldName;if(i.includes(d.f.expression)){const e=r.get(i);return e?.title?e.title:i}return v(e)&&e.getFieldConfiguration(i)?e.getFieldAlias(i)||i:t.label||i}async function g(e){return new Map((await E(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function w(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const r=`${d.f.expression}${e.name}`;t.set(r,e)}),t}function h(e){return"map-image"===e?.layer?.type?d.s.mapImage:"subtype-sublayer"===e?.type?d.s.subtype:"tile"===e?.layer?.type?d.s.tile:"scene"===e?.type?d.s.scene:"ogc-feature"===e?.type?d.s.ogcFeature:"imagery"===e?.type?d.s.imagery:"imagery-tile"===e?.type?d.s.imageryTile:"wfs"===e?.type?d.s.wfs:"wcs"===e?.type?d.s.wcs:"wms"===e?.layer?.type?d.s.wms:"csv"===e?.type?d.s.csv:"geojson"===e?.type?d.s.geojson:"stream"===e?.type?d.s.stream:"oriented-imagery"===e?.type?d.s.orientedImagery:"catalog"===e?.type?d.s.catalog:"catalog-footprint"===e?.type?d.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?d.s.knowledgeGraphSublayer:"voxel"===e?.type?d.s.voxel:"parquet"===e?.type?d.s.parquet:d.s.feature}function I(e){const t=h(e);let r;return t===d.s.wms||t===d.s.mapImage?r=e?.layer.version:(t===d.s.imagery||t===d.s.feature||t===d.s.scene)&&(r=e.version),Number.parseFloat(r)}function v(e){return"fieldConfigurations"in e&&y.includes(e.type)}async function E(e){return await new Promise((t,r)=>{switch(h(e)){case d.s.feature:case d.s.ogcFeature:case d.s.stream:t(e.fields);break;case d.s.mapImage:{const i=e,n=i?.layer;n?.portalItem&&n.url.includes("https://demographics")&&n.url.includes(".arcgis.com")?n.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const r=new Map(i.fields.map(e=>[e.name,e])),n=e.thematicGroup.fieldNames,a=[];n.forEach(e=>{r.has(e)&&a.push(r.get(e))}),t(a)}else t(i.fields)}).catch(e=>{r(new Error(e))}):t(i.fields);break}case d.s.imagery:case d.s.imageryTile:case d.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function b(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function x(e){return Number((100*(1-e)).toFixed(1))}function P(e){return Number((1-e/100).toFixed(3))}const k=(e,t)=>{const r=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(d.f.expression)||r.push({name:e.fieldName,alias:e.label,type:"string"})}),r},T=async(e,t)=>{const r=new c.default;return r.geometry=t.extent,r.mapExtent=t.extent,r.returnGeometry=!0,r.tolerance=6,r.layerOption="popup",r.width=t.width,r.height=t.height,r.layerIds=[e.id],(await f.identify(e.layer.url,r))?.results?.[0]?.feature},D=async(e,t,r)=>{const i=await(await e.whenLayerView(t)).queryAggregates();return await S(r,i.features?.[0])},S=async(e,t)=>{let r;if(t)r=t.clone();else{r=new i.default;const t=k(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),r.attributes=e}const a=new n.default;r.geometry=a}return r};function O(e,t){const r=t.startsWith("#"),i=t.startsWith(".");for((i||r)&&(t=t.slice(1));e;){if(r){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function j(e){if(h(e)===d.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(h(e)===d.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function L(e,t,r){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const r=t.get(e);i=r.type?r.type.toLowerCase():""}else if(r.has(e)){const t=r.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function $(e,t){try{const r=h(e);if(r===d.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await T(e,t)||await N(e,t)]};if(r===d.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await N(e,t)]};const i=r===d.s.ogcFeature||r===d.s.stream?await t.whenLayerView(e):e,n=i.createQuery();n.where=i.definitionExpression||"1=1",n.outFields=["*"],n.returnM="hasM"in e&&e.hasM,n.returnZ="hasZ"in e&&e.hasZ,n.outSpatialReference=t.spatialReference,n.returnGeometry=!0,(i.sourceJSON?.advancedQueryCapabilities?.supportsPagination||r===d.s.ogcFeature)&&(n.start=0,n.num=1),n.outSpatialReference=t.spatialReference;const a=await i.queryFeatures(n);return a?.features?.length||(a.features[0]=await N(e,t)),a}catch(e){console.error(e)}}async function N(e,t){return await new Promise(r=>{const n=new i.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),n.attributes=t}const f=t.extent;let c;"polygon"===e.geometryType?c=o.default.fromExtent(f):"point"===e.geometryType?c=f.center.clone():"multipoint"===e.geometryType?c=new a.default({points:[[f.center.x,f.center.y]],spatialReference:f.center.spatialReference.clone()}):"polyline"===e.geometryType?(c=new s.default({spatialReference:t.spatialReference.clone()}),c.addPath([[f.xmin,f.ymin],[f.xmax,f.ymax]])):"mesh"===e.geometryType&&(c=l.default.createBox(f.center.clone(),{size:{width:50,height:50,depth:50}})),n.geometry=c,r(n)})}function F(e){return h(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function R(e){return h(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);