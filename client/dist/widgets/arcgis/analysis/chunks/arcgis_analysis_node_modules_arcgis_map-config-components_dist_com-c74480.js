/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-c74480.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-c74480"],{2079:(e,t,s)=>{s.d(t,{a:()=>o,i:()=>a});var i=s(42855);function a(e,t,s,a){const{layer:o}=e;switch(t){case i.l.feature:return!!(o&&s===i.s.wms||o&&o.popupTemplate)&&o.popupEnabled;case i.l.cluster:return!!o&&o.featureReduction.popupEnabled;case i.l.mapNotes:return a;default:return!!o?.popupEnabled}}function o(e,t){const s="CALCITE-INPUT"===e.tagName,i=s?e.shadowRoot.querySelector("input"):e.shadowRoot.querySelector("textarea"),a=i.selectionStart,o=[e.value.slice(0,a),`{${t}}`,e.value.slice(a)].join("");e.value=o;const n=a+2+t.length;setTimeout(()=>{s?e.setFocus():(i?.setSelectionRange(n,n),i?.focus()),i?.setSelectionRange(n,n)},1)}},9243:(e,t,s)=>{s.d(t,{a:()=>a,b:()=>i});const i=["attachment","connectivity","container","content","structure"];var a=(e=>(e.title="title",e.description="description",e.displayCount="displayCount",e))(a||{})},10763:(e,t,s)=>{s.d(t,{c:()=>o,u:()=>n});var i=s(83552),a=s(20936);function o(e){e.mapView=void 0,e.portal=void 0,e.config=void 0,e.layerDisplayType=void 0,e.serviceType=void 0,e.layerHasAttributes=!0,e.layerSupportsAttachments=!1,e.layerHasCharts=!0,e.layerHasImages=!0,e.layerHasText=!0,e.layerSupportsArcade=!1,e.layerHasRelatedRecords=!1,e.layerIsUNLayer=!1,e.layerHasEditInfo=!1,e.blockFeatureReductionArcade=!1,e.allowTimeSeriesConfiguration=!1}function n(){const e=(0,i.Gk)(),t=e;e.manager.onLoad(()=>{t.popupState=function(e,t){const s=r.get(e);if(s)return s;const i=(0,a.el)(e,t);return i&&"store"in i?(r.set(e,i.store),i.store):null}(e.el,"arcgis-map-config-popup")})}const r=new WeakMap},42855:(e,t,s)=>{s.d(t,{a:()=>n,f:()=>i,l:()=>a,s:()=>o});var i=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(i||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),o=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(o||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},64179:(e,t,s)=>{s.r(t),s.d(t,{ArcgisMapConfigPopupAssociations:()=>d});var i=s(73679),a=s(4395),o=s(66228),n=s(9243),r=s(85643),c=s(73801),l=(s(9923),s(42097),s(81565),s(2079)),p=s(10763);const u=a.AH`.disable-spacing{--calcite-label-margin-bottom: 0}.form-input-button{display:flex}.input{width:100%}calcite-text-area{width:100%;--calcite-text-area-min-width: 0;--calcite-text-area-min-height: 42px}.add-association-button{display:flex;justify-content:center;margin-top:var(--calcite-spacing-sm)}`;class d extends c.WF{constructor(){super(),this.listNode=(0,r._)(),this.listItems=[],this.addAssociationsButtonNode=(0,r._)(),this.popupState=(0,p.u)(),this.blockOpen=!1,this.arcgisChange=(0,c.lh)(),this.arcgisDelete=(0,c.lh)(),this.closePopupPopovers=(0,c.lh)(),this.disablePopupPanel=(0,c.lh)(),this.listenOn(window,"closePopupPopovers",this.closePopupPopoversHandler)}static{this.properties={referenceElement:0,blockOpen:5,associationsContent:0}}static{this.styles=u}load(){this.syncDisplayWithCurrentPopupElementInfo()}loaded(){const{blockOpen:e,associationsContent:t}=this;e&&(this.addAssociationsButtonNode.value?.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),1===t.associationTypes.length&&this.openAssociationConfigPopoverNode(t.associationTypes[0]))}syncDisplayWithCurrentPopupElementInfo(){this.listItems=[],this.associationsContent.associationTypes.forEach(e=>this.listItems.push(this.renderListItem(e)))}closePopupPopoversHandler(){this.associationConfigPopoverNode?.remove(),this.associationConfigPopoverNode=void 0,this.pickListNode?.remove(),this.pickListNode=void 0,this.disablePopupPanel.emit(!1)}getAssociationsBlockCustomDescription(e){return`${e.substring(0,25)}${e.length>25?"...":""}`}getAssociationTypeString(e){const{popupState:t}=this,{_messages:s}=t;switch(e){case"attachment":return s.associations.attachment;case"connectivity":return s.associations.connectivity;case"container":return s.associations.container;case"content":return s.associations.content;case"structure":return s.associations.structure}}handlePickListChange(e,t){t===n.a.title?((0,l.a)(this.titleNode,e),this.associationsContent.title=this.titleNode.value):((0,l.a)(this.descriptionNode,e),this.associationsContent.description=this.descriptionNode.value),this.closePopupPopovers.emit(),this.arcgisChange.emit()}openAssociationConfigPopoverNode(e){const{popupState:t}=this;this.associationConfigPopoverNode=(0,c.dN)(a.qy`<arcgis-map-config-popup-association-config-popover .popupState=${t} .referenceElement=${this.referenceElement} .associationsContent=${this.associationsContent} .associationType=${e} @arcgisChange=${e=>{e.stopPropagation(),this.syncDisplayWithCurrentPopupElementInfo(),this.requestUpdate(),this.arcgisChange.emit()}}></arcgis-map-config-popup-association-config-popover>`),document.body.appendChild(this.associationConfigPopoverNode),this.disablePopupPanel.emit(!0)}render(){const{popupState:e}=this,{_messages:t}=e,{associationsContent:s}=this,i=n.b.every(e=>(0,o.i)(s.associationTypes.find(t=>t.type===e)));return a.qy`${this.renderFormInput(t.title,n.a.title,s.title,t.enterTitle,e=>this.titleNode=e)}${this.renderFormInput(t.desc,n.a.description,s.description,t.enterDescription,e=>this.descriptionNode=e)}${this.renderFormInput(t.associations.previewCount,n.a.displayCount,`${s.displayCount??""}`,t.associations.enterPreviewCount)}<calcite-label class="disable-spacing" scale=s>${t.associations.types}</calcite-label><calcite-list .label=${t.associations.types} drag-enabled @calciteListOrderChange=${e=>{const t=e.detail.oldIndex,s=e.detail.newIndex,i=this.associationsContent.associationTypes.splice(t,1)[0];this.associationsContent.associationTypes.splice(s,0,i),this.listItems=[...this.listNode.value.children],this.arcgisChange.emit(),this.requestUpdate()}} ${(0,r.K)(this.listNode)}>${this.listItems}</calcite-list>${i?"":a.qy`<calcite-button title=${t.associations.addAssociation??c.s6} appearance=outline-fill round scale=s class="add-association-button" icon-start=plus @click=${e=>{if(e.stopPropagation(),this.closePopupPopovers.emit(),!this.associationConfigPopoverNode){const e=this.associationsContent.associationTypes.map(e=>e.type),t={type:n.b.filter(t=>!e.includes(t))[0]};this.associationsContent.associationTypes.push(t),this.openAssociationConfigPopoverNode(t),this.arcgisChange.emit()}}} ${(0,r.K)(this.addAssociationsButtonNode)}></calcite-button>`}`}renderFormInput(e,t,s,i,o){const{popupState:l}=this,{_messages:p,popupTemplate:u}=l;return a.qy`<calcite-label scale=s>${e}${t===n.a.displayCount?a.qy`<calcite-input-number autofocus integer min=0 max=100 .value=${s} .placeholder=${i} @calciteInputNumberInput=${e=>{e.stopPropagation();const t=e.target,s=t.value,i=this.associationsContent.displayCount,a=Number.parseInt(s);i!==a&&(Number.isNaN(a)?(this.associationsContent.displayCount=null,t.value=""):a>t.max?(this.associationsContent.displayCount=t.max,t.value=`${t.max}`):a<t.min?(this.associationsContent.displayCount=t.min,t.value=`${t.min}`):this.associationsContent.displayCount=a,this.arcgisChange.emit())}} @click=${()=>this.closePopupPopovers.emit()}></calcite-input-number>`:a.qy`<div class="form-input-button">${t===n.a.title?a.qy`<calcite-input class="input" type=text autofocus .value=${s} .placeholder=${i} @calciteInputInput=${e=>{e.stopPropagation();const t=e.target.value;this.associationsContent.title=t,this.arcgisChange.emit()}} @click=${()=>this.closePopupPopovers.emit()} ${(0,r.K)(o)}></calcite-input>`:a.qy`<calcite-text-area resize=vertical autofocus .value=${s} .placeholder=${i} @calciteTextAreaInput=${e=>{e.stopPropagation();const t=e.target.value;this.associationsContent.description=t,this.arcgisChange.emit()}} ${(0,r.K)(o)}></calcite-text-area>`}${u.fieldInfos?.length?a.qy`<calcite-action .text=${p.attributes} scale=s icon=brackets-curly @click=${()=>{const{popupState:e}=this;this.closePopupPopovers.emit(),this.pickListNode||(this.pickListNode=(0,c.dN)(a.qy`<arcgis-map-config-popup-field-pick-list .popupState=${e} .popoverProps=${{refElement:this.referenceElement,offsetSkidding:50}} .heading=${p.addField} @arcgisChange=${e=>{e.stopPropagation();const s=e.detail.selectedFields[0];this.handlePickListChange(s,t)}} @arcgisClose=${e=>{e.stopPropagation(),this.closePopupPopovers.emit()}}></arcgis-map-config-popup-field-pick-list>`),document.body.appendChild(this.pickListNode),this.disablePopupPanel.emit(!0))}}></calcite-action>`:""}</div>`}</calcite-label>`}renderListItem(e){const{popupState:t}=this,{_messages:s}=t;return a.qy`<calcite-list-item .label=${e.title?this.getAssociationsBlockCustomDescription(e.title):s.noTitle} .description=${this.getAssociationTypeString(e.type)} @click=${t=>{t.stopPropagation(),this.closePopupPopovers.emit(),this.openAssociationConfigPopoverNode(e)}}><calcite-action slot=actions-end appearance=transparent .text=${s.remove} @click=${t=>{t.stopPropagation(),this.closePopupPopovers.emit();const s=this.associationsContent.associationTypes.find(t=>t.type===e.type);if(s){const e=this.associationsContent.associationTypes.indexOf(s);this.associationsContent.associationTypes.splice(e,1),this.listItems.splice(e,1)}0===this.associationsContent.associationTypes.length?this.arcgisDelete.emit():this.arcgisChange.emit(),this.requestUpdate()}}><calcite-icon scale=s icon=x></calcite-icon></calcite-action></calcite-list-item>`}}(0,i.c)("arcgis-map-config-popup-associations",d)},66228:(e,t,s)=>{s.d(t,{a:()=>v,b:()=>I,c:()=>F,d:()=>N,e:()=>T,f:()=>q,g:()=>h,h:()=>f,i:()=>g,j:()=>y,k:()=>C,l:()=>E,m:()=>x,n:()=>d,o:()=>P,p:()=>O,q:()=>S,r:()=>L,s:()=>w,t:()=>$,u:()=>b});var i=s(63438),a=s(18423),o=s(96086),n=s(91813),r=s(21255),c=s(13078),l=s(21303),p=s(12627),u=s(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],m=["feature"];function g(e){return null!=e}function y(e,t,s){const i=t.fieldName;if(i.includes(u.f.expression)){const e=s.get(i);return e?.title?e.title:i}return w(e)&&e.getFieldConfiguration(i)?e.getFieldAlias(i)||i:t.label||i}async function h(e){return new Map((await C(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function f(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const s=`${u.f.expression}${e.name}`;t.set(s,e)}),t}function v(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function b(e){const t=v(e);let s;return t===u.s.wms||t===u.s.mapImage?s=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(s=e.version),Number.parseFloat(s)}function w(e){return"fieldConfigurations"in e&&m.includes(e.type)}async function C(e){return await new Promise((t,s)=>{switch(v(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const i=e,a=i?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const s=new Map(i.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,o=[];a.forEach(e=>{s.has(e)&&o.push(s.get(e))}),t(o)}else t(i.fields)}).catch(e=>{s(new Error(e))}):t(i.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function P(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function x(e){return Number((100*(1-e)).toFixed(1))}function $(e){return Number((1-e/100).toFixed(3))}const N=(e,t)=>{const s=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||s.push({name:e.fieldName,alias:e.label,type:"string"})}),s},I=async(e,t)=>{const s=new p.default;return s.geometry=t.extent,s.mapExtent=t.extent,s.returnGeometry=!0,s.tolerance=6,s.layerOption="popup",s.width=t.width,s.height=t.height,s.layerIds=[e.id],(await l.identify(e.layer.url,s))?.results?.[0]?.feature},T=async(e,t,s)=>{const i=await(await e.whenLayerView(t)).queryAggregates();return await k(s,i.features?.[0])},k=async(e,t)=>{let s;if(t)s=t.clone();else{s=new i.default;const t=N(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),s.attributes=e}const o=new a.default;s.geometry=o}return s};function S(e,t){const s=t.startsWith("#"),i=t.startsWith(".");for((i||s)&&(t=t.slice(1));e;){if(s){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function F(e){if(v(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(v(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function E(e,t,s){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const s=t.get(e);i=s.type?s.type.toLowerCase():""}else if(s.has(e)){const t=s.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function q(e,t){try{const s=v(e);if(s===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await I(e,t)||await A(e,t)]};if(s===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await A(e,t)]};const i=s===u.s.ogcFeature||s===u.s.stream?await t.whenLayerView(e):e,a=i.createQuery();a.where=i.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(i.sourceJSON?.advancedQueryCapabilities?.supportsPagination||s===u.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const o=await i.queryFeatures(a);return o?.features?.length||(o.features[0]=await A(e,t)),o}catch(e){console.error(e)}}async function A(e,t){return await new Promise(s=>{const a=new i.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const l=t.extent;let p;"polygon"===e.geometryType?p=r.default.fromExtent(l):"point"===e.geometryType?p=l.center.clone():"multipoint"===e.geometryType?p=new o.default({points:[[l.center.x,l.center.y]],spatialReference:l.center.spatialReference.clone()}):"polyline"===e.geometryType?(p=new n.default({spatialReference:t.spatialReference.clone()}),p.addPath([[l.xmin,l.ymin],[l.xmax,l.ymax]])):"mesh"===e.geometryType&&(p=c.default.createBox(l.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=p,s(a)})}function L(e){return v(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function O(e){return v(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);