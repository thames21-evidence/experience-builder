/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-f0a4c1.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-f0a4c1"],{28252:(e,t,i)=>{i.d(t,{u:()=>l});var s=i(85282),a=i(34670),r=i(42466);const n=(e,t,i)=>{const s=new Map;for(let a=t;a<=i;a++)s.set(e[a],a);return s},l=(0,a.u$)(class extends a.WL{constructor(e){if(super(e),e.type!==a.OA.CHILD)throw Error("repeat() can only be used in text expressions")}dt(e,t,i){let s;void 0===i?i=t:void 0!==t&&(s=t);const a=[],r=[];let n=0;for(const t of e)a[n]=s?s(t,n):n,r[n]=i(t,n),n++;return{values:r,keys:a}}render(e,t,i){return this.dt(e,t,i).values}update(e,[t,i,a]){const l=(0,r.cN)(e),{values:o,keys:c}=this.dt(t,i,a);if(!Array.isArray(l))return this.ut=c,o;const u=this.ut??=[],d=[];let h,p,m=0,g=l.length-1,f=0,y=o.length-1;for(;m<=g&&f<=y;)if(null===l[m])m++;else if(null===l[g])g--;else if(u[m]===c[f])d[f]=(0,r.lx)(l[m],o[f]),m++,f++;else if(u[g]===c[y])d[y]=(0,r.lx)(l[g],o[y]),g--,y--;else if(u[m]===c[y])d[y]=(0,r.lx)(l[m],o[y]),(0,r.Dx)(e,d[y+1],l[m]),m++,y--;else if(u[g]===c[f])d[f]=(0,r.lx)(l[g],o[f]),(0,r.Dx)(e,l[m],l[g]),g--,f++;else if(void 0===h&&(h=n(c,f,y),p=n(u,m,g)),h.has(u[m]))if(h.has(u[g])){const t=p.get(c[f]),i=void 0!==t?l[t]:null;if(null===i){const t=(0,r.Dx)(e,l[m]);(0,r.lx)(t,o[f]),d[f]=t}else d[f]=(0,r.lx)(i,o[f]),(0,r.Dx)(e,l[m],i),l[t]=null;f++}else(0,r.KO)(l[g]),g--;else(0,r.KO)(l[m]),m++;for(;f<=y;){const t=(0,r.Dx)(e,d[y+1]);(0,r.lx)(t,o[f]),d[f++]=t}for(;m<=g;){const e=l[m++];null!==e&&(0,r.KO)(e)}return this.ut=c,(0,r.mY)(e,d),s.c0}})},36486:(e,t,i)=>{i.d(t,{u:()=>r});var s=i(83552),a=i(73679);const r=(0,s.yr)(a.g)},42855:(e,t,i)=>{i.d(t,{a:()=>n,f:()=>s,l:()=>a,s:()=>r});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),r=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(r||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},47640:(e,t,i)=>{i.d(t,{YZ:()=>n,e1:()=>a});var s=i(4836);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??l,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let a=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){a=!0,i=e}if(this.p===s){if(t===r)this.i=0;else{if(!1===a){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const l=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},66228:(e,t,i)=>{i.d(t,{a:()=>v,b:()=>M,c:()=>I,d:()=>S,e:()=>x,f:()=>L,g:()=>f,h:()=>y,i:()=>m,j:()=>g,k:()=>$,l:()=>k,m:()=>D,n:()=>h,o:()=>T,p:()=>P,q:()=>C,r:()=>q,s:()=>w,t:()=>F,u:()=>b});var s=i(63438),a=i(18423),r=i(96086),n=i(91813),l=i(21255),o=i(13078),c=i(21303),u=i(12627),d=i(42855);const h=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],p=["feature"];function m(e){return null!=e}function g(e,t,i){const s=t.fieldName;if(s.includes(d.f.expression)){const e=i.get(s);return e?.title?e.title:s}return w(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function f(e){return new Map((await $(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function y(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${d.f.expression}${e.name}`;t.set(i,e)}),t}function v(e){return"map-image"===e?.layer?.type?d.s.mapImage:"subtype-sublayer"===e?.type?d.s.subtype:"tile"===e?.layer?.type?d.s.tile:"scene"===e?.type?d.s.scene:"ogc-feature"===e?.type?d.s.ogcFeature:"imagery"===e?.type?d.s.imagery:"imagery-tile"===e?.type?d.s.imageryTile:"wfs"===e?.type?d.s.wfs:"wcs"===e?.type?d.s.wcs:"wms"===e?.layer?.type?d.s.wms:"csv"===e?.type?d.s.csv:"geojson"===e?.type?d.s.geojson:"stream"===e?.type?d.s.stream:"oriented-imagery"===e?.type?d.s.orientedImagery:"catalog"===e?.type?d.s.catalog:"catalog-footprint"===e?.type?d.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?d.s.knowledgeGraphSublayer:"voxel"===e?.type?d.s.voxel:"parquet"===e?.type?d.s.parquet:d.s.feature}function b(e){const t=v(e);let i;return t===d.s.wms||t===d.s.mapImage?i=e?.layer.version:(t===d.s.imagery||t===d.s.feature||t===d.s.scene)&&(i=e.version),Number.parseFloat(i)}function w(e){return"fieldConfigurations"in e&&p.includes(e.type)}async function $(e){return await new Promise((t,i)=>{switch(v(e)){case d.s.feature:case d.s.ogcFeature:case d.s.stream:t(e.fields);break;case d.s.mapImage:{const s=e,a=s?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,r=[];a.forEach(e=>{i.has(e)&&r.push(i.get(e))}),t(r)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case d.s.imagery:case d.s.imageryTile:case d.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function T(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function D(e){return Number((100*(1-e)).toFixed(1))}function F(e){return Number((1-e/100).toFixed(3))}const S=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(d.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},M=async(e,t)=>{const i=new u.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},x=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await N(i,s.features?.[0])},N=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=S(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const r=new a.default;i.geometry=r}return i};function C(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function I(e){if(v(e)===d.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(v(e)===d.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function k(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function L(e,t){try{const i=v(e);if(i===d.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await M(e,t)||await _(e,t)]};if(i===d.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await _(e,t)]};const s=i===d.s.ogcFeature||i===d.s.stream?await t.whenLayerView(e):e,a=s.createQuery();a.where=s.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===d.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const r=await s.queryFeatures(a);return r?.features?.length||(r.features[0]=await _(e,t)),r}catch(e){console.error(e)}}async function _(e,t){return await new Promise(i=>{const a=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const c=t.extent;let u;"polygon"===e.geometryType?u=l.default.fromExtent(c):"point"===e.geometryType?u=c.center.clone():"multipoint"===e.geometryType?u=new r.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(u=new n.default({spatialReference:t.spatialReference.clone()}),u.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(u=o.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=u,i(a)})}function q(e){return v(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function P(e){return v(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},94857:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigTimeSeries:()=>$});var s=i(73679),a=i(28252),r=i(4395),n=i(73801),l=i(85643),o=i(47640),c=i(42855),u=i(66228),d=i(36486);function h(e,t,i,s,a){if(!e||!i||!s)return;const r=new Date(e.getTime());if(t){const[e,i,s]=t.split(":").map(Number);r.setHours(r.getHours()+e),r.setMinutes(r.getMinutes()+i),r.setSeconds(r.getSeconds()+(s??0))}const n=i*a;switch(s){case"centuries":r.setFullYear(r.getFullYear()+100*n);break;case"decades":r.setFullYear(r.getFullYear()+10*n);break;case"years":r.setFullYear(r.getFullYear()+n);break;case"months":r.setMonth(r.getMonth()+n);break;case"weeks":r.setDate(r.getDate()+7*n);break;case"days":default:r.setDate(r.getDate()+n);break;case"hours":r.setHours(r.getHours()+n);break;case"minutes":r.setMinutes(r.getMinutes()+n);break;case"seconds":r.setSeconds(r.getSeconds()+n);break;case"milliseconds":r.setMilliseconds(r.getMilliseconds()+n)}return r}function p(e){return!!e&&["centuries","decades","years"].includes(e)}function m(e){return!!e&&["centuries","decades","years","months"].includes(e)}function g(e){return!!e&&["hours","minutes","seconds","milliseconds"].includes(e)}function f(e){return!!e&&["seconds","milliseconds"].includes(e)}const y=["centuries","decades","years","months","weeks","days","hours","minutes","seconds"],v=["january","february","march","april","may","june","july","august","september","october","november","december"],b=r.AH`.dialog{--calcite-dialog-size-x: 60%;--calcite-dialog-size-y: 60%;z-index:900}.fields-dialog{--calcite-dialog-content-space: 0}.fields{overflow:hidden}.stepper{margin:0 var(--calcite-spacing-xs)}.manual-button{margin-bottom:var(--calcite-spacing-lg)}.preview-fields-panel{height:100%;display:flex;flex-direction:column;overflow:hidden}.preview-fields-list{height:100%;background-color:var(--calcite-color-foreground-3);overflow:auto}.no-fields-div{display:flex;flex-direction:column;text-align:center;align-items:center;margin:var(--calcite-spacing-xxl) 0}.no-fields-text-div{display:flex;flex-direction:column;justify-content:center;width:85%;margin-top:var(--calcite-spacing-xxl)}.no-fields-title{font-weight:var(--calcite-font-weight-bold)}.list-item-end-actions{display:flex}.date-info-div{display:flex;align-items:center;gap:var(--calcite-spacing-sm);margin:0 var(--calcite-spacing-md)}.time-settings{display:flex;flex-direction:column;gap:var(--calcite-spacing-lg)}.time-interval-unit-wrapper-div{display:flex;gap:var(--calcite-spacing-sm);width:100%}.time-interval,.time-unit{width:50%}`,w=["choose-fields","choose-time","review"];class $ extends n.WF{constructor(){super(...arguments),this._propWatcherTask=new o.YZ(this,{task:async([e,t])=>{if(!(0,u.i)(e)||!(0,u.i)(t))throw console.error("[arcgis-map-config-time-series] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.layer,this.fields]}),this._messages=(0,d.u)({blocking:!0}),this.dialogNode=(0,l._)(),this.stepperNode=(0,l._)(),this.disableDialog=!1,this.disconnected=!1,this.fieldDateMap=new Map,this.layerFieldsMap=new Map,this.arcadeExpMap=new Map,this.chooseFieldsPanelNode=(0,l._)(),this.addFieldsButtonNode=(0,l._)(),this.timeSeriesFieldListNode=(0,l._)(),this.chooseTimePanelNode=(0,l._)(),this.timeIntervalNode=(0,l._)(),this.monthNode=(0,l._)(),this.yearOnlyNode=(0,l._)(),this.datePickerNode=(0,l._)(),this.cancelNode=(0,l._)(),this.doneNode=(0,l._)(),this.listItems=[],this.currentStep="choose-fields",this.timeSeriesFields=[],this.currentTimeInterval=1,this.currentTimeUnit="years",this.layerDisplayType=c.l.feature,this.arcgisClose=(0,n.lh)()}static{this.properties={mapView:0,layer:0,fields:0,preconfiguredTimeSeriesSettings:0,layerDisplayType:0}}static{this.styles=b}async setFocus(){this.dialogNode.value?.setFocus()}async init(){const{layer:e,layerDisplayType:t}=this;let i;i=t===c.l.feature?e.popupTemplate?e.popupTemplate.clone():e.createPopupTemplate():e.featureReduction.popupTemplate.clone(),this.layerFieldsMap=await(0,u.g)(e),this.arcadeExpMap=(0,u.h)(i),this.setUpPreconfiguredDisplay()}setUpPreconfiguredDisplay(){const{preconfiguredTimeSeriesSettings:e}=this;if(!e)return;const{fieldDateMap:t,startDate:i,timeInterval:s,timeUnit:a}=e;this.sanitizePreconfiguredFieldDateMap(),t.size&&(this.fieldDateMap=new Map(t),this.currentDate=new Date(i),this.currentTimeInterval=s,this.currentTimeUnit=a,this.timeSeriesFields=this.fields.filter(e=>this.fieldDateMap.has(e.name)),this.generateListItems())}sanitizePreconfiguredFieldDateMap(){const{preconfiguredTimeSeriesSettings:e}=this,{fieldDateMap:t}=e;t.forEach((e,i)=>{if(!this.fields.find(e=>e.name===i))return void t.delete(i);const s=t.get(i);(!s||Number.isNaN(new Date(s).getTime()))&&t.delete(i)})}generateListItems(){const{_messages:e,currentStep:t,currentTimeUnit:i}=this,s=g(i),n=p(i),l=m(i),o=f(i);this.listItems=(0,a.u)(this.timeSeriesFields,e=>e.name,i=>r.qy`<calcite-list-item .label=${i.name} .value=${i.name}><div class="list-item-end-actions" slot=actions-end>${"review"===t?r.qy`<div class="date-info-div">${l?r.qy`${n?null:this.renderReviewMonth(i)}${this.renderReviewYear(i)}`:r.qy`<calcite-input-date-picker overlay-positioning=fixed .valueAsDate=${this.fieldDateMap.get(i.name)} @calciteInputDatePickerChange=${e=>{const t=this.fieldDateMap.get(i.name),s=t?.getHours()??0,a=t?.getMinutes()??0,r=t?.getSeconds()??0,n=e.target.valueAsDate;n?(n.setHours(n.getHours()+s),n.setMinutes(n.getMinutes()+a),n.setSeconds(n.getSeconds()+r),this.fieldDateMap.set(i.name,n)):e.target.valueAsDate=t,this.requestUpdate()}}></calcite-input-date-picker>`}${s&&r.qy`<calcite-input-time-picker .step=${o?1:60} overlay-positioning=fixed .value=${this.getFieldTimeString(this.fieldDateMap.get(i.name)?.getTime())} @calciteInputTimePickerChange=${e=>{const t=e.target.value,s=t?t.split(":"):["00","00","00"],a="hours"===this.currentTimeUnit,r=Number.parseInt(s[0]??0),n=a?0:Number.parseInt(s[1]??0),l=a?0:Number.parseInt(s[2]??0),o=new Date(this.fieldDateMap.get(i.name));o.setHours(r),o.setMinutes(n),o.setSeconds(l),a&&(e.target.value=`${r.toString().padStart(2,"0")}:00:00`),this.fieldDateMap.set(i.name,o)}}></calcite-input-time-picker>`||""}</div>`:null}<calcite-action appearance=transparent .text=${e.remove} @click=${()=>{this.timeSeriesFields=this.timeSeriesFields.filter(e=>e.name!==i.name),this.fieldDateMap.delete(i.name),this.generateListItems(),this.requestUpdate()}}><calcite-icon scale=s icon=x></calcite-icon></calcite-action></div></calcite-list-item>`)}getSelectedStepIndex(){const e=this.stepperNode.value?.selectedItem;return e?Array.from(this.el.shadowRoot.querySelectorAll("calcite-stepper-item")).indexOf(e):0}openFieldPickList(){const{mapView:e,layer:t,fields:i,layerFieldsMap:s,arcadeExpMap:a}=this,l=this.timeSeriesFields.map(e=>e.name),o=i.map(e=>({name:e.name,alias:e.alias,type:(0,u.l)(e.name,s,a)}));this.fieldPickListNode=(0,n.dN)(r.qy`<arcgis-field-pick-list class="fields" .view=${e} .layer=${t} .fields=${o} .selectedFields=${l} .popoverProps=${{refElement:this.addFieldsButtonNode.value,popoverWidth:.25*this.dialogNode.value.getBoundingClientRect().width,placement:"bottom-start",triggerDisabled:!0,zIndex:901}} show-field-name show-field-type-icon show-selection-all multiple @arcgisClose=${e=>{const t=e.detail?.selectedFields;if(t){const e=i.filter(e=>t.includes(e.name));this.timeSeriesFields=e,this.generateListItems(),this.updateFieldDateMap()}this.fieldPickListNode.remove(),this.fieldPickListNode=void 0,this.disableDialog=!1,this.requestUpdate(),setTimeout(()=>this.addFieldsButtonNode.value.setFocus(),300)}}></arcgis-field-pick-list>`),this.disableDialog=!0,this.requestUpdate(),document.body.appendChild(this.fieldPickListNode)}getFieldTimeString(e){if(!e)return"";const t=new Date(e),i=t.getHours(),s=t.getMinutes(),a=t.getSeconds();return`${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}updateFieldDateMap(){const{currentDate:e,currentTime:t,currentTimeInterval:i,currentTimeUnit:s}=this;this.fieldDateMap.clear(),this.timeSeriesFields.forEach((a,r)=>this.fieldDateMap.set(a.name,h(e,t,i,s,r)))}render(){const{_messages:e}=this;return this._propWatcherTask.render({complete:()=>{const{disableDialog:t}=this;return r.qy`<calcite-dialog class="dialog" width=s open modal outside-close-disabled escape-disabled .heading=${e.configureTimeSeries} @calciteDialogBeforeClose=${()=>this.fieldPickListNode?.remove()} @calciteDialogClose=${()=>this.arcgisClose.emit()} ${(0,l.K)(this.dialogNode)}><calcite-stepper class="stepper" icon numbered @calciteStepperChange=${()=>{const e=this.getSelectedStepIndex();this.currentStep=w[e],this.generateListItems(),this.requestUpdate()}} ${(0,l.K)(this.stepperNode)}><calcite-stepper-item .disabled=${t} .heading=${e.stepperHeadings.chooseFields} selected></calcite-stepper-item><calcite-stepper-item .disabled=${t} .heading=${e.stepperHeadings.setTimeInterval}></calcite-stepper-item><calcite-stepper-item .disabled=${t} .heading=${e.stepperHeadings.review}></calcite-stepper-item></calcite-stepper>${this.renderSteps()}${this.renderFooter()}</calcite-dialog>`}})}renderSteps(){return r.qy`${this.renderChooseFields()}${this.renderChooseTime()}${this.renderReview()}`}renderChooseFields(){const{_messages:e,currentStep:t,disableDialog:i}=this;return"choose-fields"!==t?"":r.qy`<calcite-panel .disabled=${i} ${(0,l.K)(this.chooseFieldsPanelNode)}><div><calcite-button class="manual-button" kind=brand appearance=solid icon-start=plus @click=${this.openFieldPickList} ${(0,l.K)(this.addFieldsButtonNode)}>${e.addFields}</calcite-button></div><div class="preview-fields-panel"><calcite-label>${this.timeSeriesFields.length?e.previewFieldsWithNumber.replace("${number}",`${this.timeSeriesFields.length}`):e.previewFields}</calcite-label><div class="preview-fields-list">${this.timeSeriesFields.length?this.renderTimeSeriesFieldsList():this.renderNoTimeSeriesFields()}</div></div></calcite-panel>`}renderTimeSeriesFieldsList(){const{_messages:e}=this;return r.qy`<calcite-list drag-enabled .label=${e.timeSeriesFields} @calciteListOrderChange=${e=>{const t=e.detail.oldIndex,i=e.detail.newIndex,s=this.timeSeriesFields.splice(t,1)[0];this.timeSeriesFields.splice(i,0,s),this.listItems=[...this.timeSeriesFieldListNode.value.children],this.requestUpdate()}} ${(0,l.K)(this.timeSeriesFieldListNode)}>${this.listItems}</calcite-list>`}renderNoTimeSeriesFields(){const{_messages:e}=this;return r.qy`<div class="no-fields-div"><svg xmlns=http://www.w3.org/2000/svg width=48 height=48 viewBox="0 0 48 48" fill=none>${r.JW`<path d="M16.4997 29.9016C13.9537 29.9032 11.4599 29.1796 9.31033 27.8153C7.16073 26.451 5.44428 24.5026 4.36195 22.1981C3.27962 19.8936 2.87619 17.3285 3.19891 14.803C3.52164 12.2776 4.55714 9.89632 6.1842 7.93807C7.81125 5.97982 9.96252 4.52562 12.3861 3.74573C14.8097 2.96584 17.4053 2.89253 19.8691 3.5344C22.3328 4.17626 24.5627 5.50673 26.2977 7.37003C28.0327 9.23333 29.201 11.5523 29.6657 14.0556C29.4093 14.1654 29.158 14.2869 28.9127 14.4196C28.4539 11.6493 27.0843 9.11126 25.0207 7.20702C22.9571 5.30277 20.3173 4.14113 17.5193 3.90596C14.7212 3.67079 11.9246 4.37551 9.57206 5.90859C7.21956 7.44167 5.44553 9.71554 4.53077 12.3703C3.616 15.0251 3.61274 17.9091 4.5215 20.5659C5.43026 23.2228 7.19913 25.5006 9.54816 27.039C11.8972 28.5774 14.6922 29.2885 17.4908 29.0596C20.2894 28.8308 22.9318 27.6751 24.9997 25.7756V26.8516C22.6072 28.8257 19.6015 29.9043 16.4997 29.9016ZM22.6277 38.7116L25.0237 41.1016H20.4997C19.2802 41.1005 18.1109 40.6157 17.2485 39.7534C16.3861 38.8912 15.901 37.7221 15.8997 36.5026V33.9666L18.2897 36.3576L18.8557 35.7916L15.4997 32.4366L12.1437 35.7916L12.7087 36.3576L15.0997 33.9676V36.5016C15.1013 37.9332 15.6707 39.3058 16.6831 40.3182C17.6954 41.3305 19.068 41.9 20.4997 41.9016H25.0237L22.6277 44.2896L23.1927 44.8556L26.5587 41.5006L23.1927 38.1456L22.6277 38.7116ZM16.0997 7.00156V17.9016H22.9997V17.1016H16.8997V7.00156H16.0997ZM43.8997 21.4136V37.7136L35.4997 46.1686L27.0997 37.7136V21.4136C27.0997 17.2836 30.0047 15.1016 35.4997 15.1016C40.9947 15.1016 43.8997 17.2836 43.8997 21.4136ZM43.0997 21.4136C43.0997 17.7566 40.5427 15.9016 35.4997 15.9016C30.4567 15.9016 27.8997 17.7566 27.8997 21.4136V37.3836L35.4997 45.0336L43.0997 37.3836V21.4136ZM39.8997 24.7516C39.8997 25.6218 39.6416 26.4725 39.1582 27.1961C38.6747 27.9196 37.9875 28.4836 37.1835 28.8166C36.3795 29.1497 35.4948 29.2368 34.6413 29.067C33.7878 28.8972 33.0038 28.4782 32.3884 27.8628C31.7731 27.2475 31.354 26.4635 31.1842 25.61C31.0145 24.7564 31.1016 23.8717 31.4346 23.0678C31.7676 22.2638 32.3316 21.5766 33.0552 21.0931C33.7788 20.6096 34.6295 20.3516 35.4997 20.3516C36.6662 20.3529 37.7846 20.8169 38.6095 21.6418C39.4344 22.4666 39.8984 23.585 39.8997 24.7516ZM39.0997 24.7516C39.0997 24.0395 38.8886 23.3435 38.493 22.7515C38.0974 22.1595 37.5352 21.6981 36.8774 21.4256C36.2195 21.1531 35.4957 21.0818 34.7974 21.2207C34.099 21.3596 33.4576 21.7025 32.9541 22.206C32.4506 22.7094 32.1078 23.3509 31.9689 24.0492C31.83 24.7476 31.9013 25.4714 32.1737 26.1292C32.4462 26.787 32.9076 27.3493 33.4996 27.7449C34.0917 28.1404 34.7877 28.3516 35.4997 28.3516C36.4542 28.3508 37.3694 27.9712 38.0444 27.2963C38.7194 26.6213 39.0989 25.7061 39.0997 24.7516Z" fill=#6A6A6A />`}</svg><div class="no-fields-text-div"><div class="no-fields-title">${e.noTimeSeriesFieldsTitle}</div><div>${e.noTimeSeriesFieldsDescriptionLong}</div></div></div>`}renderChooseTime(){const{_messages:e,currentStep:t,currentTime:i,currentTimeUnit:s}=this;if("choose-time"!==t)return"";const a=g(s),n=p(s),o=m(s),c=f(s);return r.qy`<calcite-panel ${(0,l.K)(this.chooseTimePanelNode)}><div class="time-settings"><div class="time-interval-unit-wrapper-div"><calcite-label class="time-interval">${e.chooseTimeInterval}<calcite-input-number inputmode=decimal min=1 step=1 .value=${`${this.currentTimeInterval}`} @calciteInputNumberInput=${()=>{if(this.disconnected)return;clearTimeout(this.currentTimeIntervalHandle);const e=Number.parseFloat(this.timeIntervalNode.value.value);!Number.isNaN(e)&&e>0?(this.currentTimeInterval=Math.round(e),this.timeIntervalNode.value.value=`${Math.round(e)}`,this.updateFieldDateMap()):this.currentTimeIntervalHandle=setTimeout(()=>this.timeIntervalNode.value.value=`${this.currentTimeInterval}`,3e3)}} ${(0,l.K)(this.timeIntervalNode)}></calcite-input-number></calcite-label><calcite-label class="time-unit">${e.timeUnit}<calcite-select .label=${e.timeUnit} .value=${s} @calciteSelectChange=${e=>{this.currentTimeUnit=e.target.value,g(this.currentTimeUnit)||(this.currentTime=void 0,this.currentDate&&this.currentDate.setHours(0,0,0,0)),this.currentDate&&p(this.currentTimeUnit)&&(this.currentDate=new Date(this.currentDate.getFullYear(),0,1),this.monthNode.value&&(this.monthNode.value.value="0")),this.updateFieldDateMap(),this.requestUpdate()}}>${y.map(t=>r.qy`<calcite-option .value=${t}>${e.timeUnits[t]}</calcite-option>`)}</calcite-select></calcite-label></div><calcite-label>${a?e.startDateAndTime:e.startDate}${o?r.qy`${n?null:this.renderChooseMonth()}${this.renderChooseYear()}`:this.renderChooseDate()}${a?r.qy`<calcite-input-time-picker .step=${c?1:60} overlay-positioning=fixed .value=${i} @calciteInputTimePickerChange=${e=>{if(this.currentTime=e.target.value,"hours"===this.currentTimeUnit){const t=this.currentTime?this.currentTime.split(":"):["00","00","00"];this.currentTime=`${t[0]}:00:00`,e.target.value=this.currentTime}this.updateFieldDateMap()}}></calcite-input-time-picker>`:null}</calcite-label></div></calcite-panel>`}renderChooseMonth(){const{_messages:e,currentDate:t}=this;return r.qy`<calcite-select .label=${e.month} @calciteSelectChange=${e=>{const t=e.target.value;this.currentDate&&(this.currentDate.setMonth(Number.parseInt(t)),this.updateFieldDateMap())}} ${(0,l.K)(this.monthNode)}>${v.map((i,s)=>r.qy`<calcite-option .selected=${t?.getMonth()===s} .value=${s}>${e.months[i]}</calcite-option>`)}</calcite-select>`}renderChooseYear(){const{_messages:e,currentDate:t}=this;return r.qy`<calcite-input-number step=1 .placeholder=${e.yearOnlyPlaceholder} .value=${`${t?.getFullYear()??""}`} @calciteInputNumberInput=${()=>{if(this.disconnected)return;clearTimeout(this.yearAndAboveHandle);const e=Number.parseFloat(this.yearOnlyNode.value.value);if(Number.isNaN(e))this.yearAndAboveHandle=setTimeout(()=>this.yearOnlyNode.value.value=`${this.currentDate?.getFullYear()??""}`,3e3);else{const t="months"===this.currentTimeUnit?Number.parseInt(this.monthNode.value.value):0;this.currentDate=new Date(Math.round(e),t,1),this.currentDate.setFullYear(Math.round(e)),this.yearOnlyNode.value.value=`${Math.round(e)}`,this.updateFieldDateMap()}}} ${(0,l.K)(this.yearOnlyNode)}></calcite-input-number>`}renderChooseDate(){const{currentDate:e}=this;return r.qy`<calcite-input-date-picker overlay-positioning=fixed .valueAsDate=${e??this.fieldDateMap.get(this.timeSeriesFields?.[0]?.name)} @calciteInputDatePickerChange=${e=>{const t=this.currentDate;!e.target.valueAsDate&&t&&(e.target.valueAsDate=t),this.currentDate=e.target.valueAsDate,this.updateFieldDateMap()}} ${(0,l.K)(this.datePickerNode)}></calcite-input-date-picker>`}renderReview(){const{_messages:e,currentStep:t}=this;return"review"!==t?"":r.qy`<calcite-panel><calcite-label>${e.fieldTimeRange}</calcite-label><div class="preview-fields-panel"><div class="preview-fields-list">${this.timeSeriesFields.length?this.renderTimeSeriesFieldsList():this.renderNoTimeSeriesFields()}</div></div></calcite-panel>`}renderReviewMonth(e){const{_messages:t}=this,i=v.map((i,s)=>r.qy`<calcite-option .selected=${this.fieldDateMap?.get(e.name)?.getMonth()===s} .value=${s}>${t.months[i]}</calcite-option>`);return r.qy`<calcite-select .label=${t.month} @calciteSelectChange=${t=>{const i=t.target.value;this.currentDate&&this.fieldDateMap.get(e.name).setMonth(Number.parseInt(i))}} ${(0,l.K)(this.monthNode)}>${i}</calcite-select>`}renderReviewYear(e){const{_messages:t}=this;return r.qy`<calcite-input-number step=1 .value=${`${this.fieldDateMap.get(e.name)?.getFullYear()??""}`} .placeholder=${t.yearOnlyPlaceholder} @calciteInputNumberInput=${t=>{const i=this.fieldDateMap.get(e.name).getFullYear(),s=Number.parseFloat(t.target.value);Number.isNaN(s)?t.target.value=`${i}`:this.fieldDateMap.get(e.name).setFullYear(Math.round(s)),this.requestUpdate()}}></calcite-input-number>`}renderFooter(){return r.qy`${this.renderBackButton()}${this.renderCancelButton()}${this.renderDoneButton()}`}renderBackButton(){const{_messages:e,disableDialog:t}=this,i=this.getSelectedStepIndex();return r.qy`<calcite-button .disabled=${t||0===i} appearance=outline kind=neutral slot=footer-start @click=${()=>{const e=this.getSelectedStepIndex();this.stepperNode.value?.prevStep(),this.currentStep=w[e-1],this.generateListItems(),this.requestUpdate()}}>${e.back}</calcite-button>`}renderCancelButton(){const{_messages:e,disableDialog:t}=this;return r.qy`<calcite-button .disabled=${t} @click=${()=>this.arcgisClose.emit()} slot=footer-end appearance=outline ${(0,l.K)(this.cancelNode)}>${e.cancel}</calcite-button>`}renderDoneButton(){const{_messages:e,disableDialog:t}=this,i=this.getSelectedStepIndex(),s=[...this.fieldDateMap.values()].some(e=>!e),a=t||2===i&&(!this.timeSeriesFields.length||s||this.timeSeriesFields.length!==this.fieldDateMap.size);return r.qy`<calcite-button .disabled=${a} kind=brand slot=footer-end @click=${()=>{const{currentDate:e,currentTime:t,currentTimeInterval:i,currentTimeUnit:s}=this,a=this.getSelectedStepIndex();if(2===a){const a=function(e,t){return`${[...e.keys()].map(e=>`$feature.${e};`).join("\n")}\n\nvar FIELD_DATE_MAP = [\n${[...e.entries()].map(([e,t])=>`  { value: $feature.${e}, dateTime: Date(${t?.getFullYear()||0}, ${t?.getMonth()||0}, ${t?.getDate()||0}, ${t?.getHours()||0}, ${t?.getMinutes()||0}, ${t?.getSeconds()||0}, ${t?.getMilliseconds()||0})}`).join(",\n")}\n];\n\nvar intervalDateFormatMap = {\n  "centuries": "Y",\n  "decades": "Y",\n  "years": "Y",\n  "months": "Y-M",\n  "days": "Y-M-D",\n  "hours": "Y-M-D-H",\n  "minutes": "Y-M-D-H-mm",\n  "seconds": "Y-M-D-H-mm-ss",\n  "milliseconds": "Y-M-D-H-mm-ss-SSS",\n}\n\nvar INTERVAL = "${t}";  // from user input\nvar dateTimeFormat = intervalDateFormatMap[INTERVAL];\n\nvar RESULT_FORMAT_PATTERN = ""; // Optional\n\nvar hasCurrentStart = HasValue($view, ["timeProperties", "currentStart"]);\nvar hasCurrentEnd = HasValue($view, ["timeProperties", "currentEnd"]);\n\nvar hasTimeProperties = hasCurrentStart || hasCurrentEnd;\nvar firstValue = Front(FIELD_DATE_MAP).value;\n\nif (!hasTimeProperties) {\n  return firstValue;\n}\n\nvar currentValue = DefaultValue(\n  $view.timeProperties.currentEnd,\n  $view.timeProperties.currentStart\n);\nvar formattedCurrentValue = Text(currentValue, dateTimeFormat);\n\nfunction getValueAtInstant() {\n  for(var item of FIELD_DATE_MAP){\n    var formattedDateTime = Text(item.dateTime, dateTimeFormat);\n    if(formattedDateTime == formattedCurrentValue){\n      return item.value;\n    }\n  }\n  return null;\n}\n\nfunction formatResult(value) {\n  if (IsEmpty(value)) {\n    return null;\n  }\n  if (IsEmpty(RESULT_FORMAT_PATTERN)) {\n    return value;\n  }\n  return Text(value, RESULT_FORMAT_PATTERN);\n}\n\nvar result = getValueAtInstant();\nreturn formatResult(result);`}(this.fieldDateMap,this.currentTimeUnit),r=this.fieldDateMap,n=[...this.fieldDateMap.values()].sort((e,t)=>e.getTime()-t.getTime()),l=n[0],o=n.length>1?n[n.length-1]:h(e,t,i,s,1);this.arcgisClose.emit({arcadeExpression:a,fieldDateMap:r,startTime:l,endTime:o,currentTimeInterval:i,currentTimeUnit:s})}else this.stepperNode.value?.nextStep(),this.currentStep=w[a+1],"review"===this.currentStep&&this.currentDate&&!this.currentTime&&(this.currentTime="00:00:00"),this.generateListItems(),this.requestUpdate()}} ${(0,l.K)(this.doneNode)}>${2===i?e.done:e.next}</calcite-button>`}}(0,s.c)("arcgis-map-config-time-series",$)}}]);