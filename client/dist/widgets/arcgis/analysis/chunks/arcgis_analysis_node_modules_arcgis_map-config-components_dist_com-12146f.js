/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-12146f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-12146f"],{36486:(e,t,a)=>{a.d(t,{u:()=>r});var s=a(83552),i=a(73679);const r=(0,s.yr)(i.g)},42855:(e,t,a)=>{a.d(t,{a:()=>o,f:()=>s,l:()=>i,s:()=>r});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),i=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(i||{}),r=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(r||{}),o=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(o||{})},47640:(e,t,a)=>{a.d(t,{YZ:()=>o,e1:()=>i});var s=a(4836);const i={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class o{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,a){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:a};this.v=s.task,this.j=s.args,this.m=s.argsEqual??n,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,a;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let i=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){i=!0,a=e}if(this.p===s){if(t===r)this.i=0;else{if(!1===i){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(a)}catch{}this.i=3,this.h?.(a)}this.u=t,this.l=a}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const n=(e,t)=>e===t||e.length===t.length&&e.every((e,a)=>!(0,s.Ec)(e,t[a]))},51048:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigLayerTemplate:()=>h});var s=a(73679),i=a(4395),r=a(85643),o=a(36486),n=a(73801),l=a(47640),c=a(66228);const d=i.AH`.empty-state{height:100%;align-content:center;text-align:center}.empty-state-description{color:#9f9f9f;font-size:var(--calcite-font-size-1)}.empty-state-icon{fill:#9f9f9f;display:inline-flex;height:80px;width:80px}.empty-state-title{color:#9f9f9f;font-weight:500;font-size:var(--calcite-font-size-3)}.main-container{display:flex;height:100%}.read-only-message{margin:auto .75rem auto auto}.read-only-permissions-message{margin:12px;align-self:center}.template-list{border-right:1px solid var(--calcite-color-border-3)}.warning-description{font-size:var(--calcite-font-size-md);padding:var(--calcite-spacing-md)}.warning-dialog-buttons{display:flex;gap:5px}.warning-title{margin:0;font-weight:var(--calcite-font-weight-normal);color:var(--calcite-color-text-1);font-size:var(--calcite-font-size-xl)}`;class h extends n.WF{constructor(){super(...arguments),this._messages=(0,o.u)({blocking:!0}),this._propWatcherTask=new l.YZ(this,{task:([e])=>{if(!(0,c.i)(e))throw console.error("[arcgis-map-config-layer-template] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,this.init()},args:()=>[this.layer]}),this.templateCoordinatorState={canUndo:!1,canRedo:!1,canSave:!1,undoLabels:[],redoLabels:[],selectedTemplate:void 0,hasUnsavedChanges:!1},this.showUnsavedChangesDialog=!1,this.saveInProgress=!1,this.readOnly=!1,this.arcgisClose=(0,n.lh)()}static{this.properties={templateCoordinatorState:16,showUnsavedChangesDialog:16,saveInProgress:16,layer:0,portal:0,readOnly:5}}static{this.styles=d}dialogRefHandler(e){e&&(this.dialogNode=e)}init(){this.templateCoordinatorState.selectedTemplate="feature"===this.layer.type?this.layer.types?.[0]?.templates?.[0]??this.layer.templates?.[0]:this.layer.templates?.[0]}templatesCoordinatorRefHandler(e){e&&(this.templatesCoordinator=e)}buttonRefHandler(e){e&&(this.cancelNode=e)}unsavedChangesDialogRefHandler(e){e&&(this.warningDialog=e)}close(){this.dialogNode.parentNode?.removeChild(this.dialogNode),this.arcgisClose.emit()}async handleCancelClick(){if(this.templateCoordinatorState.hasUnsavedChanges)this.showUnsavedChangesDialog=!0;else try{this.cancelNode.loading=!0;const e=await this.templatesCoordinator.reset();this.updateFromCoordinatorState(e),this.close()}catch(e){console.error(e)}finally{this.cancelNode.loading=!1}}async handleUndoClick(e=1){const t=await this.templatesCoordinator.undo(e);this.updateFromCoordinatorState(t)}async handleRedoClick(e=1){const t=await this.templatesCoordinator.redo(e);this.updateFromCoordinatorState(t)}async save(e,t=!1){try{e.loading=!0,this.dialogNode.closeDisabled=!0,this.saveInProgress=!0;const a=await this.templatesCoordinator.save();return this.dialogNode.closeDisabled=t,this.updateFromCoordinatorState(a),this.showAlert("success",this._messages.saveSuccessful,"",t),!0}catch(e){return console.error(e),e instanceof Error&&"ValidationError"===e.name?this.showAlert("error",this._messages.unableToSave,this._messages.saveErrorInvalidTemplate):this.showAlert("error",this._messages.unableToSaveTemplates,this._messages.checkPrivileges),this.dialogNode.closeDisabled=!1,!1}finally{this.saveInProgress=!1,e.loading=!1}}showAlert(e,t,a,s=!1){const r=(0,n.dN)(i.qy`<calcite-alert .kind=${"error"===e?"danger":"success"} .label=${t} auto-close slot=alerts open @calciteAlertClose=${()=>{"success"===e&&s&&this.close()}}><div slot=title>${t}</div>${a.length?i.qy`<div slot=message>${a}</div>`:""}</calcite-alert>`);this.dialogNode.appendChild(r)}updateFromCoordinatorState(e){this.templateCoordinatorState=e}render(){return this._propWatcherTask.render({complete:()=>{const e=this.portal??("feature"===this.layer.type?this.layer.portalItem?.portal:this.layer.parent?.portalItem?.portal);return e?i.qy`<calcite-dialog .heading=${this.layer.title||this._messages.configureTemplates} modal placement=cover open .beforeClose=${()=>this.templateCoordinatorState.hasUnsavedChanges?(this.showUnsavedChangesDialog=!0,Promise.reject(new Error(this._messages.unsavedChangesTitle))):Promise.resolve()} @calciteDialogClose=${()=>this.arcgisClose.emit()} ${(0,r.K)(this.dialogRefHandler)}><tc-templates-coordinator .layer=${this.layer} .portal=${e} .initialTemplate=${this.templateCoordinatorState.selectedTemplate} @tcTemplatesCoordinatorChange=${e=>this.updateFromCoordinatorState(e.detail)} ${(0,r.K)(this.templatesCoordinatorRefHandler)}><div class="main-container">${this.renderTemplateListPanel()}${this.renderEditorPanel()}</div></tc-templates-coordinator>${this.renderFooterButtons()}</calcite-dialog>${this.showUnsavedChangesDialog&&this.renderUnsavedChangesDialog()||""}`:(console.error("Portal information is required for template configuration."),"")}})}renderTemplateListPanel(){return i.qy`<calcite-panel class="template-list" .heading=${this._messages.templates}>${this.readOnly?this.renderReadOnlyMessage():this.renderActionBar()}${this.readOnly&&"subtype-sublayer"!==this.layer.type&&i.qy`<calcite-label layout=inline class="read-only-permissions-message"><calcite-icon scale=s icon=lock></calcite-icon> ${this._messages.editingNotAllowed}</calcite-label>`||""}${!this.readOnly&&this.layer.capabilities&&!this.layer.capabilities.operations.supportsEditing&&i.qy`<calcite-label layout=inline class="read-only-permissions-message"><calcite-icon scale=s icon=unlock></calcite-icon> ${this._messages.editingAllowed}</calcite-label>`||""}<tc-template-list .readOnly=${this.readOnly}></tc-template-list></calcite-panel>`}renderReadOnlyMessage(){return i.qy`<calcite-button class="read-only-message" disabled slot=header-actions-end appearance=solid kind=neutral>${this._messages.readOnly}</calcite-button>`}renderActionBar(){return i.qy`<calcite-action-bar slot=header-actions-end layout=horizontal expand-disabled overflow-actions-disabled><calcite-action-group><calcite-action .text=${this._messages.undo} icon=undo icon-flip-rtl .disabled=${!this.templateCoordinatorState.canUndo} @click=${()=>this.handleUndoClick()}><calcite-tooltip slot=tooltip>${this._messages.undo}</calcite-tooltip></calcite-action><calcite-action .text=${this._messages.redo} icon=redo icon-flip-rtl .disabled=${!this.templateCoordinatorState.canRedo} @click=${()=>this.handleRedoClick()}><calcite-tooltip slot=tooltip>${this._messages.redo}</calcite-tooltip></calcite-action><calcite-action .text=${this._messages.save} icon=save .disabled=${!this.templateCoordinatorState.hasUnsavedChanges||this.saveInProgress} @click=${e=>this.save(e.currentTarget)}><calcite-tooltip slot=tooltip>${this._messages.save}</calcite-tooltip></calcite-action></calcite-action-group><calcite-dropdown><calcite-action id=history-menu-trigger .text=${this._messages.history} icon=recent slot=trigger .disabled=${!this.templateCoordinatorState.canRedo&&!this.templateCoordinatorState.canUndo}><calcite-tooltip slot=tooltip>${this._messages.history}</calcite-tooltip></calcite-action>${this.renderUndoHistoryGroup()}${this.renderRedoHistoryGroup()}</calcite-dropdown></calcite-action-bar>`}renderEditorPanel(){return i.qy`<calcite-panel .heading=${this._messages.properties}>${this.templateCoordinatorState.selectedTemplate?this.renderEditors():this.renderEmptyState()}</calcite-panel>`}renderEditors(){return i.qy`<calcite-block .heading=${this._messages.formatting} expanded collapsible><tc-formatting-editor .readOnly=${this.readOnly}></tc-formatting-editor></calcite-block><calcite-block .heading=${this._messages.defaultValues} expanded collapsible><tc-default-values-editor .readOnly=${this.readOnly}></tc-default-values-editor></calcite-block>`}renderEmptyState(){return i.qy`<div class="empty-state"><div class="empty-state-icon"><svg viewBox="0 0 64 64" xmlns=http://www.w3.org/2000/svg>${i.JW`<use href=${`${(0,s.g)("./assets/map-config-layer-template/icons/clipboard-64.svg")}#icon`} />`}</svg></div><div class="empty-state-title">${this._messages.emptyStateTitle}</div><div class="empty-state-description">${this._messages.emptyStateDescription}</div></div>`}renderUndoHistoryGroup(){return this.templateCoordinatorState.canUndo?i.qy`<calcite-dropdown-group selection-mode=single .groupTitle=${this._messages.undo}>${this.templateCoordinatorState.undoLabels.map((e,t)=>i.qy`<calcite-dropdown-item icon-flip-rtl=start icon-start=undo @calciteDropdownItemSelect=${()=>this.handleUndoClick(t+1)}>${e}</calcite-dropdown-item>`)}</calcite-dropdown-group>`:""}renderRedoHistoryGroup(){return this.templateCoordinatorState.canRedo?i.qy`<calcite-dropdown-group selection-mode=single .groupTitle=${this._messages.redo}>${this.templateCoordinatorState.redoLabels.map((e,t)=>i.qy`<calcite-dropdown-item icon-flip-rtl=start icon-start=redo @calciteDropdownItemSelect=${()=>this.handleRedoClick(t+1)}>${e}</calcite-dropdown-item>`)}</calcite-dropdown-group>`:""}renderFooterButtons(){return this.readOnly?"":i.qy`<calcite-button slot=footer-end appearance=outline .disabled=${!this.templateCoordinatorState.hasUnsavedChanges||this.saveInProgress} @click=${()=>this.handleCancelClick()} ${(0,r.K)(this.buttonRefHandler)}>${this._messages.cancel}</calcite-button><calcite-button slot=footer-end .disabled=${!this.templateCoordinatorState.hasUnsavedChanges||this.saveInProgress} @click=${e=>this.save(e.currentTarget,!0)}>${this._messages.ok}</calcite-button>`}renderUnsavedChangesDialog(){return i.qy`<calcite-dialog modal open kind=danger escape-disabled outside-close-disabled @calciteDialogClose=${()=>this.showUnsavedChangesDialog=!1} ${(0,r.K)(this.unsavedChangesDialogRefHandler)}><div slot=header-content class="warning-title">${this._messages.unsavedChangesTitle}</div><div class="warning-description">${this._messages.unsavedChangesDescription}</div><div class="warning-dialog-buttons" slot=footer-end><calcite-button @click=${async()=>{await this.templatesCoordinator.reset(),this.warningDialog?.parentNode?.removeChild(this.warningDialog),this.close()}}>${this._messages.ok}</calcite-button><calcite-button appearance=outline @click=${()=>this.showUnsavedChangesDialog=!1}>${this._messages.cancel}</calcite-button></div></calcite-dialog>`}}(0,s.c)("arcgis-map-config-layer-template",h)},66228:(e,t,a)=>{a.d(t,{a:()=>w,b:()=>S,c:()=>I,d:()=>k,e:()=>T,f:()=>O,g:()=>y,h:()=>f,i:()=>g,j:()=>m,k:()=>C,l:()=>P,m:()=>x,n:()=>p,o:()=>$,p:()=>N,q:()=>q,r:()=>E,s:()=>b,t:()=>_,u:()=>v});var s=a(63438),i=a(18423),r=a(96086),o=a(91813),n=a(21255),l=a(13078),c=a(21303),d=a(12627),h=a(42855);const p=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],u=["feature"];function g(e){return null!=e}function m(e,t,a){const s=t.fieldName;if(s.includes(h.f.expression)){const e=a.get(s);return e?.title?e.title:s}return b(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function y(e){return new Map((await C(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function f(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const a=`${h.f.expression}${e.name}`;t.set(a,e)}),t}function w(e){return"map-image"===e?.layer?.type?h.s.mapImage:"subtype-sublayer"===e?.type?h.s.subtype:"tile"===e?.layer?.type?h.s.tile:"scene"===e?.type?h.s.scene:"ogc-feature"===e?.type?h.s.ogcFeature:"imagery"===e?.type?h.s.imagery:"imagery-tile"===e?.type?h.s.imageryTile:"wfs"===e?.type?h.s.wfs:"wcs"===e?.type?h.s.wcs:"wms"===e?.layer?.type?h.s.wms:"csv"===e?.type?h.s.csv:"geojson"===e?.type?h.s.geojson:"stream"===e?.type?h.s.stream:"oriented-imagery"===e?.type?h.s.orientedImagery:"catalog"===e?.type?h.s.catalog:"catalog-footprint"===e?.type?h.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?h.s.knowledgeGraphSublayer:"voxel"===e?.type?h.s.voxel:"parquet"===e?.type?h.s.parquet:h.s.feature}function v(e){const t=w(e);let a;return t===h.s.wms||t===h.s.mapImage?a=e?.layer.version:(t===h.s.imagery||t===h.s.feature||t===h.s.scene)&&(a=e.version),Number.parseFloat(a)}function b(e){return"fieldConfigurations"in e&&u.includes(e.type)}async function C(e){return await new Promise((t,a)=>{switch(w(e)){case h.s.feature:case h.s.ogcFeature:case h.s.stream:t(e.fields);break;case h.s.mapImage:{const s=e,i=s?.layer;i?.portalItem&&i.url.includes("https://demographics")&&i.url.includes(".arcgis.com")?i.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const a=new Map(s.fields.map(e=>[e.name,e])),i=e.thematicGroup.fieldNames,r=[];i.forEach(e=>{a.has(e)&&r.push(a.get(e))}),t(r)}else t(s.fields)}).catch(e=>{a(new Error(e))}):t(s.fields);break}case h.s.imagery:case h.s.imageryTile:case h.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function $(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function x(e){return Number((100*(1-e)).toFixed(1))}function _(e){return Number((1-e/100).toFixed(3))}const k=(e,t)=>{const a=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(h.f.expression)||a.push({name:e.fieldName,alias:e.label,type:"string"})}),a},S=async(e,t)=>{const a=new d.default;return a.geometry=t.extent,a.mapExtent=t.extent,a.returnGeometry=!0,a.tolerance=6,a.layerOption="popup",a.width=t.width,a.height=t.height,a.layerIds=[e.id],(await c.identify(e.layer.url,a))?.results?.[0]?.feature},T=async(e,t,a)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await R(a,s.features?.[0])},R=async(e,t)=>{let a;if(t)a=t.clone();else{a=new s.default;const t=k(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),a.attributes=e}const r=new i.default;a.geometry=r}return a};function q(e,t){const a=t.startsWith("#"),s=t.startsWith(".");for((s||a)&&(t=t.slice(1));e;){if(a){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function I(e){if(w(e)===h.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===h.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function P(e,t,a){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const a=t.get(e);s=a.type?a.type.toLowerCase():""}else if(a.has(e)){const t=a.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function O(e,t){try{const a=w(e);if(a===h.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await S(e,t)||await U(e,t)]};if(a===h.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await U(e,t)]};const s=a===h.s.ogcFeature||a===h.s.stream?await t.whenLayerView(e):e,i=s.createQuery();i.where=s.definitionExpression||"1=1",i.outFields=["*"],i.returnM="hasM"in e&&e.hasM,i.returnZ="hasZ"in e&&e.hasZ,i.outSpatialReference=t.spatialReference,i.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||a===h.s.ogcFeature)&&(i.start=0,i.num=1),i.outSpatialReference=t.spatialReference;const r=await s.queryFeatures(i);return r?.features?.length||(r.features[0]=await U(e,t)),r}catch(e){console.error(e)}}async function U(e,t){return await new Promise(a=>{const i=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),i.attributes=t}const c=t.extent;let d;"polygon"===e.geometryType?d=n.default.fromExtent(c):"point"===e.geometryType?d=c.center.clone():"multipoint"===e.geometryType?d=new r.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(d=new o.default({spatialReference:t.spatialReference.clone()}),d.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(d=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),i.geometry=d,a(i)})}function E(e){return w(e)===h.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function N(e){return w(e)===h.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);