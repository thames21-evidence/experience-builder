/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-7ba884.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-7ba884"],{43186:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigSmartMappingAttributeInput:()=>p});var s=i(73679),l=i(4395),n=i(1225),r=(i(54312),i(44345),i(55448),i(52797),i(34031),i(63438),i(5933),i(89704),i(5294),i(18423),i(96086),i(91813),i(21255),i(13078),i(21303),i(12627),i(56451),i(31521),i(23054),i(5077),i(23795),i(17902),i(87420),i(30161),i(81734),i(75698),i(10628),i(59640),i(64451),i(6176),i(65595)),a=(i(77462),i(49403),i(10281),i(83930),i(66617),i(10454),i(29614),i(94916),i(52554),i(2156),i(4038),i(49851),i(75054),i(15223),i(70169),i(47207),i(70852),i(48103),i(39423),i(85681),i(18444),i(42411),i(9767),i(38218),i(91914),i(86605),i(68196),i(440),i(46547),i(28927),i(6238),i(7299),i(85643)),d=i(73801),o=i(20936);const c=l.AH`.field-select-with-icon{display:flex;width:100%;justify-content:space-between;align-items:stretch;min-width:0}.field-button:focus{z-index:10}.non-simple-field-button{width:calc(100% - 32px)}`;class p extends d.WF{constructor(){super(...arguments),this.switchButtonNode=(0,a._)(),this.smartMappingState=(0,r.u)(),this.mode="simple",this.hideLabel=!1,this.arcgisSmartMappingAttributeInputChange=(0,d.lh)(),this.arcgisSmartMappingAttributeInputError=(0,d.lh)()}static{this.properties={fieldList:0,selectedField:0,label:1,mode:1,popoverReferenceElement:0,hideLabel:5}}static{this.styles=c}async clear(){this.currentField=void 0,this.requestUpdate()}load(){this.currentField=this.selectedField,this.popoverReferenceElement||(this.popoverReferenceElement=(0,o.el)(this.el,"calcite-flow-item"))}willUpdate(){this.hasUpdated||this.currentField!==this.selectedField&&(this.currentField=this.selectedField)}buttonRefHandler(e){e&&(this.fieldButtonNode=e)}async handleRemoveField(){this.currentField=null,this.arcgisSmartMappingAttributeInputChange.emit(void 0)}async handleSwitchAttributeType(){if((0,n.f)(),this.currentField?.field)if(this.lastSettings?.expression){const e={expression:this.lastSettings.expression,expressionTitle:this.lastSettings.expressionTitle,simpleFieldType:this.lastSettings.simpleFieldType};this.currentField.field=void 0,this.currentField=e,this.arcgisSmartMappingAttributeInputChange.emit(this.currentField)}else try{this.switchButtonNode.value.disabled=!0,await this.openArcadeEditorModal(),this.switchButtonNode.value.disabled=!1,this.fieldButtonNode?.setFocus()}catch{this.switchButtonNode.value.disabled=!1,this.switchButtonNode.value?.setFocus()}else this.openFieldPickList()}async openArcadeEditorModal(e){const{smartMappingState:t}=this;(0,n.f)();const i=(0,d.dN)(l.qy`<arcgis-map-config-smart-mapping-modal-arcade .smartMappingState=${t} .fieldInfo=${e} @arcgisClose=${e=>{i.remove(),e.detail&&this.editExpressionHandler(e.detail)}}></arcgis-map-config-smart-mapping-modal-arcade>`);document.body.appendChild(i)}async editExpressionHandler(e){const{smartMappingState:t}=this,{_messages:i}=t;e.simpleFieldType!==n.J.STRING?(e.simpleFieldType===n.J.UNKNOWN&&(e.simpleFieldType=n.J.NUMBER),this.currentField&&(this.currentField.field=void 0,this.currentField.expression=e.expression,this.currentField.expressionTitle=e.expressionTitle,this.currentField.simpleFieldType=e.simpleFieldType),this.arcgisSmartMappingAttributeInputChange.emit(this.currentField)):this.arcgisSmartMappingAttributeInputError.emit({message:i.attributeInput.errors.expressionMustBeNumber,type:"warning"})}openFieldPickList(){const{smartMappingState:e}=this,{layer:t,mapView:i,_messages:s}=e;(0,n.f)();const r=this.fieldList.map(e=>({name:e.layerField.name,alias:e.label,type:e.simpleFieldType,description:"description"in e.layerField?e.layerField.description:void 0})),a=(0,d.dN)(l.qy`<arcgis-field-pick-list class="arcgis-map-config-smart-mapping-attribute-input-field-pick-list" .heading=${this.currentField?s.replaceField:s.addField} .selectedFields=${this.currentField?[this.currentField.field]:[]} .layer=${t} .mapView=${i} .fields=${r} .popoverProps=${{refElement:this.popoverReferenceElement,placement:"leading",popoverWidth:1.05*this.popoverReferenceElement.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!0}} show-field-info .sortBy=${this.lastFieldSortBy||"default"} @arcgisSortByChange=${e=>this.lastFieldSortBy=e.detail} @arcgisClose=${t=>{if(t.detail?.selectedFields?.[0]){const i=(0,n.K)(e,t.detail.selectedFields[0]),s={field:i.layerField.name,simpleFieldType:i.simpleFieldType};this.currentField?.expression&&(this.lastSettings={expression:this.currentField.expression,expressionTitle:this.currentField.expressionTitle,simpleFieldType:this.currentField.simpleFieldType}),this.currentField=s,this.arcgisSmartMappingAttributeInputChange.emit(this.currentField)}this.fieldButtonNode?.setFocus(),a.remove(),(0,n.h)(this.popoverReferenceElement,!1)}}></arcgis-field-pick-list>`);(0,n.h)(this.popoverReferenceElement,!0),document.body.appendChild(a)}render(){const{_messages:e}=this.smartMappingState;return this.hideLabel?l.qy`<div class="field-select-with-icon">${this.renderFieldButton()}${"remove"===this.mode&&this.currentField&&this.renderRemoveButton()||""}${"expression"===this.mode&&this.renderArcadeButton()||""}</div>`:l.qy`<calcite-label>${this.label||e.attributeInput.attribute}<div class="field-select-with-icon">${this.renderFieldButton()}${"remove"===this.mode&&this.currentField&&this.renderRemoveButton()||""}${"expression"===this.mode&&this.renderArcadeButton()||""}</div></calcite-label>`}renderArcadeButton(){const{_messages:e}=this.smartMappingState,t=this.currentField?.field?e.attributeInput.useExpression:e.attributeInput.useField;return l.qy`<div>&nbsp;</div><calcite-button id=smart-mapping-attribute-switch appearance=outline-fill kind=neutral .iconStart=${this.currentField?.field?"code":"brackets-curly"} .label=${t} class="field-button" @click=${()=>this.handleSwitchAttributeType()} ${(0,a.K)(this.switchButtonNode)}></calcite-button><calcite-tooltip reference-element=smart-mapping-attribute-switch overlay-positioning=fixed>${t}</calcite-tooltip>`}renderFieldButton(){const{smartMappingState:e}=this,{_messages:t}=e,i="remove"!==this.mode&&"expression"!==this.mode||!this.currentField?"":"non-simple-field-button",s=!(!this.currentField?.field||1!==this.fieldList.length||"remove"===this.mode);return l.qy`<calcite-button alignment=icon-end-space-between appearance=outline-fill kind=neutral .disabled=${s} .iconEnd=${this.currentField?.expression?"pencil":s?void 0:"chevron-down"} width=full class=${`field-button ${i}`} @click=${()=>{this.currentField?.expression?(this.openArcadeEditorModal(this.currentField),this.fieldButtonNode?.setFocus()):this.openFieldPickList()}} ${(0,a.K)(this.buttonRefHandler)}>${this.currentField?.field?(0,n.K)(e,this.currentField.field)?.label:this.currentField?.expression?this.currentField?.expressionTitle:t.attributeInput.chooseField}</calcite-button>`}renderRemoveButton(){const{_messages:e}=this.smartMappingState;return l.qy`<div>&nbsp;</div><calcite-button id=smart-mapping-attribute-switch appearance=outline-fill kind=neutral icon-start=x .label=${e.clear} class="field-button" @click=${()=>{this.handleRemoveField()}}></calcite-button><calcite-tooltip reference-element=smart-mapping-attribute-switch overlay-positioning=fixed>${e.clear}</calcite-tooltip>`}}(0,s.c)("arcgis-map-config-smart-mapping-attribute-input",p)},65595:(e,t,i)=>{i.d(t,{c:()=>r,u:()=>a});var s=i(20936),l=i(1225),n=(i(54312),i(44345),i(55448),i(52797),i(34031),i(63438),i(5933),i(28927),i(83368),i(89704),i(5294),i(18423),i(96086),i(91813),i(21255),i(13078),i(21303),i(12627),i(56451),i(31521),i(23054),i(5077),i(23795),i(17902),i(87420),i(30161),i(81734),i(75698),i(10628),i(59640),i(64451),i(6176),i(83552));i(77462),i(49403),i(10281),i(83930),i(66617),i(10454),i(29614),i(94916),i(52554),i(2156),i(4038),i(49851),i(75054),i(15223),i(70169),i(47207),i(70852),i(48103),i(39423),i(85681),i(18444),i(42411),i(9767),i(38218),i(91914),i(86605),i(68196),i(440),i(46547),i(6238),i(7299);function r(e){e.selectedFields=[],e.layerFields=void 0,e.fields=void 0,e.hideLayerTitle=!1,e.supportsArcade=!1,e.stringFieldsCount=-1,e.dateFieldsCount=-1,e.numberFieldsCount=-1,e.containsFlow=!0,e.oneFeatureResponseStatus=l.s.MISSING,e.selectedAttribute=void 0,e.selectedAttributeText=void 0,e.selectedTypeValue=void 0,e.selectedValue=void 0,e.lastDefault=void 0,e.lastDefaults=void 0,e.dotColorSelected=void 0,e.backgroundStyleSelected=void 0,e.lastSettings=void 0,e.classedSymbolSelectedIdx=void 0,e.allUniqueValues=void 0,e.useFeatureReduction=void 0,e.symbolStylerConfig={},e.allowTimeSeriesConfiguration=!1,e.rasterInfo=void 0}function a(){const e=(0,n.Gk)(),t=e;e.manager.onLoad(()=>{t.smartMappingState=function(e,t){const i=d.get(e);if(i)return i;const l=(0,s.el)(e,t);return l&&"store"in l?(d.set(e,l.store),l.store):null}(e.el,"arcgis-map-config-smart-mapping")})}const d=new WeakMap}}]);