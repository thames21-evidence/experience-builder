"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_analysis-components_dist_esm_a-ed275f"],{41245:(e,a,t)=>{t.d(a,{A:()=>d,a:()=>v,b:()=>A,c:()=>M,d:()=>E,e:()=>U});var i=t(44471),s=t(44188),l=t(78065),r=t(76451),n=t(84121),o=t(91685),h=t(80526);const c="block",p="no-summary-text",d=class{constructor(e){(0,i.r)(this,e),this.collapsible=!1,this.defaultClosed=!1,this.open=!0}componentWillLoad(){this.defaultClosed&&(this.open=!1)}render(){return(0,i.h)(i.H,{key:"bc27cc3bf5eedb1ff96ffb9cb5cd79e2deb28853",class:`${(0,s.y)(this.summaryText)&&!1===this.collapsible?p:""}`},(0,i.h)("calcite-block",{key:"888e9b14b1a4a12b1b337c53d7d7837737d59c29",class:c,heading:this.label??"",collapsible:this.collapsible,description:(0,s.y)(this.summaryText)?void 0:this.summaryText,open:this.open},(0,i.h)("slot",{key:"18c5755cdf228227ed8506c8982ed5571848fbcf"})))}get hostElement(){return(0,i.d)(this)}};d.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;width:100%}.block{width:100%}:host(.no-summary-text) ::slotted(*){margin-top:calc(var(--calcite-spacing-md) * -1)}";const u="esriGPParameterTypeRequired",y="background",m="analysis--rtl",v=class{constructor(e){(0,i.r)(this,e)}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,s.u)(this.hostElement,(0,i.a)(".")))}render(){return(0,i.h)(i.H,{key:"f10d6f9d5f049634da71a768c03ccbfc4f91a24b",class:"rtl"===this.dir?m:""},(0,i.h)("calcite-block-section",{key:"620bf0305a3e7b4fd6651661f2b37f8c92d30ef3",class:y,dir:this.dir,text:this.label??this.strings.defaultTitle,open:this.open??!1},(0,i.h)("slot",{key:"b12d9c185c1223b91f785a1375aa10b70b2cdc58"})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.d)(this)}};function g(e,a,t){return null==e?e:(0,h.a)(e,a,t)}v.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:block;width:calc(var(--analysis-component-default-width) - var(--analysis-quarter-spacing))}.background{background-color:transparent}::slotted(*){margin-left:var(--analysis-quarter-spacing)}:host(.analysis--rtl) ::slotted(*){margin-left:0;margin-right:var(--analysis-quarter-spacing)}";const b={[r.A.GPString]:{icon:"string"},[r.A.GPMultiValueString]:{icon:"string"},[r.A.GPBoolean]:{icon:"boolean"},[r.A.GPMultiValueBoolean]:{icon:"boolean"},[r.A.GPDouble]:{icon:"number"},[r.A.GPMultiValueDouble]:{icon:"number"},[r.A.GPLong]:{icon:"number"},[r.A.GPMultiValueLong]:{icon:"number"},[r.A.GPDate]:{icon:"calendar"},[r.A.GPMultiValueDate]:{icon:"calendar"},[r.A.GPLinearUnit]:{icon:"line-straight"},[r.A.GPTimeUnit]:{icon:"clock"},[r.A.GPArealUnit]:{icon:"polygon-area"},[r.A.GPMultiValueArealUnit]:{icon:"polygon-area"},[r.A.GPMultiValueLinearUnit]:{icon:"line-straight"},[r.A.GPMultiValueTimeUnit]:{icon:"clock"},[r.A.GPFeatureRecordSetLayer]:{icon:"feature-layer"},[r.A.GPMultiValueFeatureRecordSetLayer]:{icon:"feature-layer"},[r.A.GPRecordSet]:{icon:"table"},[r.A.GPMultiValueRecordSet]:{icon:"tables"},[r.A.GPRasterDataLayer]:{icon:"image-layer"},[r.A.GPMultiValueRasterDataLayer]:{icon:"image-layer"},[r.A.GPDataFile]:{icon:"data"},[r.A.GPMultiValueDataFile]:{icon:"data"},[r.A.GPField]:{icon:"brackets-curly"},[r.A.GPMultiValueField]:{icon:"brackets-curly"},[r.A.GPValueTable]:{icon:"brackets-curly"},[r.A.GPMultiValueValueTable]:{icon:"brackets-curly"},[r.A.GPComposite]:{icon:"brackets-curly"},[r.A.GPMultiValueComposite]:{icon:"brackets-curly"},[r.A.GPSQLExpression]:{icon:"string"},[r.A.GPKeyValue]:{icon:"circle-disallowed"}},f="NEVER_SET",C="NO_LAYER",P="data-type-selector",V=new Set([r.A.GPFeatureRecordSetLayer,r.A.GPRecordSet]),A=class{constructor(e){(0,i.r)(this,e),this.analysisParameterGroupInputChange=(0,i.c)(this,"analysisParameterGroupInputChange",7),this.analysisHelpClick=(0,i.c)(this,"analysisHelpClick",7),this.readOnly=!1,this.visibleTypes=[],this.supportsUpload=!1,this.hideAddToMap=!1,this.clearEnabled=!1,this.paramGroupFilterLayersByChip=!1,this.UIparameterMap=new Map,this.data=new Map,this.layerIdMap=new Map,this.selectedLayersMap=new Map,this.externalBrowsedLayers=[],this.selectionOptionChange=()=>{const e=this.pickerElement;this.updateDataType(e.selectedOption.value)},this.selectedChipsChange=()=>{const e=this.pickerElement,[a]=e.selectedChips,t=a;void 0!==t?this.updateDataType(t,this.selectedDataType):void 0!==this.selectedDataType&&(e.selectedChips=[this.activeDataType])},this.parameterValueChanged=()=>{if(void 0!==this.mappedElement){const e=this.mappedElement.value;if(void 0!==e&&this.isSupportedGPLayerValue(e)){if("selectedLayers"in this.mappedElement){const e=this.mappedElement.selectedLayers,a=Array.isArray(e)?e[0]:e;void 0!==a&&(this.selectedLayersMap.set(this.activeDataType,a),this.selectedLayers=e,this.trackLayerInstance(a))}}else"selectedLayers"in this.mappedElement&&(this.selectedLayersMap.set(this.activeDataType,void 0),this.selectedLayers=void 0,this.trackLayerInstance(void 0));this.updateAndEmitValue(e,this.value)}},this.setAnalysisRef=e=>{null!=e&&(this.mappedElement=e,this.selectedLayers=this.selectedLayersMap.get(this.activeDataType))}}onValueChange(){this.dataType===r.A.GPComposite?(this.selectedDataType=this.getCompositeDataType(this.value),this.saveValue(this.selectedDataType,this.value)):this.updateSelectedLayerMap(this.activeDataType)}onDataTypeChange(e,a){e!==a&&(a===r.A.GPComposite&&(this.dataType=r.A.GPComposite),this.updateDataType(e,this.selectedDataType))}onVisibleTypesChange(e){this.visibleTypes=e??[]}onUIparameterInfosChange(e,a){(0,n.v)(e,a)||(this.updateWithUIParameterInfos(e),this.updateAndEmitValue(this.data.get(this.activeDataType),this.value))}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,s.u)(this.hostElement,(0,i.a)("."))),this.updateWithUIParameterInfos(this.UIparameterInfos),this.applyAllDefaultValues(),this.updateAndEmitValue(this.data.get(this.activeDataType),this.value)}async checkValidity(){return!0===this.readOnly?Promise.resolve(!0):this.validate()}async validate(){const e=this.isGPComposite(this.value)?void 0!==this.value.value:void 0!==this.value;let a=!0!==this.required||!1!==e;try{void 0!==this.mappedElement&&"checkValidity"in this.mappedElement&&(a=await this.mappedElement.checkValidity())}catch(e){}return a}saveValue(e,a){const t=this.isGPComposite(a)?a.dataType:e;if(void 0!==t){const e=this.data.get(t);this.data.set(t,a),(0,n.v)(a,e)||this.updateSelectedLayerMap(t)}}updateAndEmitValue(e,a){if(!(0,n.v)(e,a)){const a=this.formatCompositeValue(this.activeDataType,e);this.saveValue(this.activeDataType,a),this.value=a,this.selectedDataType=this.getCompositeDataType(a)??this.activeDataType,this.analysisParameterGroupInputChange.emit({data:a,creationMode:this.layerCreationMode})}}updateDataType(e,a=this.activeDataType){null!=e&&e!==a&&(this.saveValue(a,this.value),this.selectedDataType=e,this.dataType!==r.A.GPComposite&&(this.dataType=e),this.applyDefaultValue(e),this.updateAndEmitValue(this.data.get(e),this.value))}getNewLayerIdState(e,a){return void 0!==e?e:a===f?f:C}updateLayerIdMap(e,a){const t=this.layerIdMap.get(e)??f,i=a?.id,s=this.getNewLayerIdState(i,t);this.layerIdMap.set(e,s),s!==t&&t!==f&&(this.saveValue(e,void 0),this.applyDefaultValue(e))}updateUIParameterMap(e){const{dataType:a,...t}=e;this.UIparameterMap.set(a,t)}updateDataMap(e){const{dataType:a,value:t,mapLayer:i}=e;void 0!==a&&this.updateLayerIdMap(a,i);const s=this.formatCompositeValue(a,t??this.data.get(a));this.saveValue(a,s)}updateSelectedLayerMap(e){if(void 0!==e){const a=this.data.get(e),t=(0,s.l)(a)?{variable:a.variable}:void 0,i=this.isGPComposite(a)?a.value??t:a,l=(0,s.l)(a)&&a.variable===this.selectedLayersMap.get(e)?.id;V.has(e)&&this.isSupportedGPLayerValue(i)&&!l&&this.fetchEligibleLayerInstance(i).then(a=>{this.selectedLayersMap.set(e,a),this.selectedLayers=a,this.trackLayerInstance(a),e===this.activeDataType&&(this.selectedLayersMap=new Map(this.selectedLayersMap))})}}formatCompositeValue(e,a){const t=(0,s.l)(a);return this.dataType===r.A.GPComposite&&!1===this.isGPComposite(a)?{dataType:e,...t?{}:{value:a},...t?{variable:a.variable}:{}}:a}getCompositeDataType(e){return this.isGPComposite(e)?e.dataType:void 0}getCompositeValue(e){const a=(0,s.l)(e);return this.isGPComposite(e)&&!a?e.value:e}isGPComposite(e){return"object"==typeof e&&null!==e&&"dataType"in e&&(0,s.P)(e.dataType)&&("value"in e||"variable"in e)}applyAllDefaultValues(){this.UIparameterMap.forEach((e,a)=>{this.applyDefaultValue(a)})}applyDefaultValue(e){const{defaultValue:a}=this.UIparameterMap.get(e)??{},t=this.data.get(e),i=this.getCompositeValue(t),s=this.getCompositeValue(a);if(null==i&&null!=s){const a=this.formatCompositeValue(e,s);this.saveValue(e,a)}}updateWithUIParameterInfos(e){this.dataType===r.A.GPComposite?this.selectedDataType=this.getCompositeDataType(this.value):this.selectedDataType=this.dataType,this.saveValue(this.selectedDataType??this.dataType,this.value),this.UIparameterMap.clear();const a=e??[];for(const e of a)this.updateUIParameterMap(e),this.updateDataMap(e)}get dataTypes(){return[...this.UIparameterMap.keys()].filter(e=>0===this.visibleTypes.length||this.visibleTypes.includes(e))}get activeDataType(){let e=this.selectedDataType;if(void 0===e||!1===this.dataTypes.includes(e)){const a=this.dataTypes[0];e=a,this.selectedDataType=a,this.dataType!==r.A.GPComposite&&(this.dataType=a)}return e}get allLayers(){return[this.mapLayers,this.externalBrowsedLayers,this.modelVariables?.map(e=>e.layer)].flat().filter(e=>Boolean(e))}get layerCreationMode(){let e;return void 0!==this.mappedElement&&"creationMode"in this.mappedElement&&(e=this.mappedElement.creationMode),e}get allLayerIds(){const e=this.allLayers.map(e=>e.id).filter(Boolean);return new Set(e)}getChipGroupData(){return this.dataTypes.reduce((e,a)=>{const t=this.UIparameterMap.get(a),i=b[a]?.icon??"circle-disallowed",s=t?.parameterGroupDataTypeLabel??this.strings[a]??a;return e.labels.push(s),e.icons.push(i),e},{labels:[],icons:[]})}renderChipGroup(){const e=this.dataTypes,a=this.getChipGroupData();return(0,i.h)("analysis-chip-group",{ref:e=>{this.pickerElement=e},selectionMode:"single",value:e,chipLabel:a.labels,selectedChips:[this.activeDataType],iconLabel:a.icons,label:this.groupLabel,required:!0,onAnalysisChipGroupSelectionChange:this.selectedChipsChange})}renderSelect(){return(0,i.h)("calcite-select",{ref:e=>{this.pickerElement=e},label:this.strings.gpSelection,onCalciteSelectChange:this.selectionOptionChange,scale:s.g.Scale},(0,i.h)("calcite-option-group",{label:this.strings.gpTypes},this.dataTypes.map(e=>(0,i.h)("calcite-option",{key:e,value:e,selected:e===this.activeDataType},this.strings[e]??e))))}renderDefaultComponent(){const e=this.activeDataType,a=this.getCompositeValue(this.data.get(e)),t=void 0===b[e],s=Array.isArray(this.selectedLayers)?this.selectedLayers[0]:this.selectedLayers;let n;e===r.A.GPRecordSet&&(n=o.L.Feature_Table);const h={...this.UIparameterMap.get(e)??{},selectedLayers:this.selectedLayers,selectedLayerIds:void 0!==s?.id?[s.id]:[],layerFilterType:this.paramGroupFilterLayersByChip?n:this.UIparameterMap.get(e)?.layerFilterType};return(0,i.h)(l.A,{key:e,name:e,dataType:e,portal:this.portal,user:this.portal?.user??void 0,mapView:this.mapView,mapLayers:this.mapLayers,modelVariables:this.modelVariables,externalBrowsedLayers:this.externalBrowsedLayers,supportsUpload:this.supportsUpload,serviceUrl:this.serviceUrl,validationParams:this.validationParams,readOnly:this.readOnly,...h,value:a,hideLabel:t,required:this.required,onSetRef:this.setAnalysisRef,onValueChange:this.parameterValueChanged,doCalciteInputChangeOnCommit:this.doCalciteInputChangeOnCommit,hideAddToMap:this.hideAddToMap})}render(){const e=this.UIparameterMap.get(this.activeDataType)??{},a=!0===this.required&&(void 0===e.label||""===e.label);return(0,i.h)(i.H,{key:"eed434eae2745dd5da5b36b6b94f2de9b082837b",dir:this.dir},(0,i.h)("analysis-label",{key:"453bbbcad31ae238e194f2ed092d19702b59130a",label:this.groupLabel,required:a,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),(0,i.h)("div",{key:"7ce65c45d74ecafd00f25780a7967872e52aa1f7",class:P},this.dataTypes.length<=2?this.renderChipGroup():this.renderSelect()),this.renderDefaultComponent())}trackLayerInstance(e){void 0!==e&&!1===this.allLayerIds.has(e.id)&&(this.externalBrowsedLayers=[...this.externalBrowsedLayers,e])}isSupportedGPLayerValue(e){return"object"==typeof e&&null!==e&&("url"in e||"itemId"in e||"layerDefinition"in e||"variable"in e)}async fetchEligibleLayerInstance(e){let a;if((0,s.l)(e))a=(0,s.$)(e.variable,this.modelVariables??[])?.layer;else{const t=this.paramGroupFilterLayersByChip?"list"===this.layerCreationMode?this.mapLayers??[]:this.externalBrowsedLayers??[]:this.allLayers;a=(0,s.a0)(e,t),a=a??await(0,s.c)(e)}return this.trackLayerInstance(a),a}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.d)(this)}static get watchers(){return{value:["onValueChange"],dataType:["onDataTypeChange"],visibleTypes:["onVisibleTypesChange"],UIparameterInfos:["onUIparameterInfosChange"]}}};A.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{--calcite-color-border-input:var(--analysis-ui-border-input);margin-bottom:var(--analysis-half-spacing)}.data-type-selector{margin-bottom:var(--analysis-quarter-spacing)}";const I={[r.A.GPString]:"string",[r.A.GPMultiValueString]:"string",[r.A.GPBoolean]:"boolean",[r.A.GPMultiValueBoolean]:"boolean",[r.A.GPDouble]:"number",[r.A.GPMultiValueDouble]:"number",[r.A.GPLong]:"number",[r.A.GPMultiValueLong]:"number",[r.A.GPDate]:"calendar",[r.A.GPMultiValueDate]:"calendar",[r.A.GPLinearUnit]:"line-straight",[r.A.GPTimeUnit]:"clock",[r.A.GPArealUnit]:"polygon-area",[r.A.GPMultiValueArealUnit]:"polygon-area",[r.A.GPMultiValueLinearUnit]:"line-straight",[r.A.GPMultiValueTimeUnit]:"clock",[r.A.GPFeatureRecordSetLayer]:"feature-layer",[r.A.GPMultiValueFeatureRecordSetLayer]:"feature-layer",[r.A.GPRecordSet]:"table",[r.A.GPMultiValueRecordSet]:"tables",[r.A.GPRasterDataLayer]:"image-layer",[r.A.GPMultiValueRasterDataLayer]:"image-layer",[r.A.GPDataFile]:"data",[r.A.GPMultiValueDataFile]:"data",[r.A.GPField]:"brackets-curly",[r.A.GPMultiValueField]:"brackets-curly",[r.A.GPValueTable]:"brackets-curly",[r.A.GPMultiValueValueTable]:"brackets-curly",[r.A.GPComposite]:"brackets-curly",[r.A.GPMultiValueComposite]:"brackets-curly",[r.A.GPSQLExpression]:"string",[r.A.GPKeyValue]:"circle-disallowed"},T="data-type-selector",M=class{constructor(e){(0,i.r)(this,e),this.analysisGPCompositeInputChange=(0,i.c)(this,"analysisGPCompositeInputChange",7),this.analysisHelpClick=(0,i.c)(this,"analysisHelpClick",7),this.clearVariableById=(0,i.c)(this,"clearVariableById",7),this.supportsUpload=!1,this.readOnly=!1,this.parameterValueChanged=()=>{(0,s.l)(this.mappedElement.value)?this.value={dataType:this.selectedDataType,variable:this.mappedElement.value.variable}:this.value={dataType:this.selectedDataType,value:this.mappedElement.value},this.selectedLayers=this.mappedElement?.selectedLayers,this.analysisGPCompositeInputChange.emit({data:this.value,creationMode:"creationMode"in this.mappedElement?this.mappedElement.creationMode:void 0})},this.setAnalysisRef=e=>{null!=e&&(this.mappedElement=e)}}get combinedParameterInfos(){let e=this.parameterInfos??[];return void 0!==this.UIparameterInfos&&(e=this.UIparameterInfos.filter(o.i).map(e=>{const a=this.parameterInfos?.find(a=>a.name===e.name);return{...a,...e}})),e}get combinedParameterMap(){return new Map(this.combinedParameterInfos.filter(e=>!1!==e.visible).map(e=>[e.dataType,e]))}get selectedDataType(){return this.value.dataType}get unsupportedComponent(){return void 0===I[this.selectedDataType]}async componentWillLoad(){if(({strings:this.strings,dir:this.dir}=await(0,s.u)(this.hostElement,(0,i.a)("."))),!(0,s.P)(this.value?.dataType)){const e=this.initialDataType&&this.combinedParameterMap.has(this.initialDataType)?this.initialDataType:[...this.combinedParameterMap.keys()][0],a=this.combinedParameterMap.get(e);this.value={dataType:e,value:a.value??a.defaultValue},this.analysisGPCompositeInputChange.emit({data:this.value})}}componentWillUpdate(){if(!this.combinedParameterMap.has(this.selectedDataType)){const e=[...this.combinedParameterMap.keys()][0],a=this.combinedParameterMap.get(e);this.value.dataType=e,this.value.value=a.value??a.defaultValue,this.analysisGPCompositeInputChange.emit({data:this.value})}}async checkValidity(){return!0!==this.readOnly&&void 0!==this.mappedElement&&"checkValidity"in this.mappedElement?this.mappedElement.checkValidity():Promise.resolve(!0)}onSelectedChipChanged(){this.parameterValueChanged()}render(){return(0,i.h)(i.H,{key:"fa9daa320df57046ea1cd9efbb2f27c5ff2bee56",dir:this.dir},(0,i.h)("analysis-label",{key:"4f520bce736702dd6ccc58f909bb002c5882da2f",label:this.label,required:!0===this.required&&!this.unsupportedComponent,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),this.combinedParameterMap.size>1&&(0,i.h)("calcite-chip-group",{key:"b9ba13955c33d1b0cae74f09ef683ff751731f40",class:T,scale:s.g.Scale,label:"",disabled:this.readOnly,selectionMode:"single-persist",onCalciteChipGroupSelect:e=>{const a=e.target.selectedItems[0].value,t=this.combinedParameterMap.get(a);this.value={dataType:a,value:t.value??t.defaultValue}}},[...this.combinedParameterMap.entries()].map(([e,a])=>{const t=I[e]??"circle-disallowed",s=a.label??this.strings[e]??e;return(0,i.h)("calcite-chip",{icon:t,iconFlipRtl:"rtl"===this.dir,label:s,value:e,disabled:this.readOnly,kind:this.selectedDataType===e?"brand":"neutral",appearance:"outline",selected:this.selectedDataType===e},s)})),this.renderSelectedComponent())}renderSelectedComponent(){return(0,i.h)(l.A,{...this.combinedParameterMap.get(this.selectedDataType),key:this.selectedDataType,dataType:this.selectedDataType,label:"",readOnly:this.readOnly,hideLabel:this.unsupportedComponent,required:!0===this.required&&!this.unsupportedComponent,portal:this.portal,user:this.portal?.user??void 0,mapView:this.mapView,mapLayers:this.mapLayers,modelVariables:this.modelVariables,externalBrowsedLayers:this.externalBrowsedLayers,supportsUpload:this.supportsUpload,serviceUrl:this.serviceUrl,validationParams:this.validationParams,value:(0,s.l)(this.value)?{variable:this.value?.variable}:this.value?.value,onSetRef:this.setAnalysisRef,onValueChange:this.parameterValueChanged,onClearVariableById:e=>!0!==this.readOnly&&this.clearVariableById.emit(e.detail),doCalciteInputChangeOnCommit:this.doCalciteInputChangeOnCommit,selectedLayers:this.selectedLayers})}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.d)(this)}static get watchers(){return{mappedElement:["onSelectedChipChanged"]}}};M.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{--calcite-color-border-input:var(--analysis-ui-border-input);margin-bottom:var(--analysis-half-spacing)}.data-type-selector{margin-bottom:var(--analysis-quarter-spacing)}";const L="key-value",k={groupContainer:`${L}__group-container`,groupLabel:`${L}__group-label-text`,groupHorizontal:`${L}__horizontal-layout`,groupAction:`${L}__group-action`,groupActionHorizontal:`${L}__group-action-horizontal`,errorMessage:`${L}__error-message`};function G(e){return void 0!==e.name}const E=class{constructor(e){(0,i.r)(this,e),this.analysisKeyValueChange=(0,i.c)(this,"analysisKeyValueChange",7),this.analysisHelpClick=(0,i.c)(this,"analysisHelpClick",7),this.clearEnabled=!1,this.readOnly=!1,this.mappedElementMap=new Map,this.updateValue=(e,a)=>{const t=this.mappedElementMap.get(e),i=a;(0,n.w)(this.value,e)!==i&&(this.value={...this.value},g(this.value,e,i),void 0!==t&&(t.value=i,this.validateParameter(e)),this.analysisKeyValueChange.emit({path:e,value:this.value}))},this.parameterValueChanged=e=>{const a=this.mappedElementMap.get(e);void 0!==a&&(this.value={...this.value},g(this.value,e,a.value),this.validate()),this.analysisKeyValueChange.emit({path:e,value:this.value})},this.setAnalysisRef=(e,a)=>{null!=a?this.mappedElementMap.set(e,a):this.mappedElementMap.delete(e)}}parameterInfosChange(e,a){if((0,n.v)(e,a))return;const t=[];this.combinedParameterInfos?.forEach(e=>{"object"==typeof e&&(t.push(e.name),void 0===a&&(0,s.P)(this.value)?e.value=this.value[e.name]??e.value:this.updateValue(e.name,e.value))}),this.value=(0,h.p)(this.value,t),this.analysisKeyValueChange.emit({path:"init",value:this.value})}UIparameterInfosChange(e,a){(0,n.v)(e,a)||((0,s.y)(this.value)&&(this.value={}),this.combinedParameterInfos?.forEach(e=>{if(void 0!==e.name&&"object"==typeof this.value)if(!1===e.visible)delete this.value[e.name];else{const a=this.value[e.name]??e.value??e.defaultValue;this.updateValue(e.name,a)}}))}get combinedParameterInfos(){let e=this.parameterInfos??[];return void 0!==this.UIparameterInfos&&(e=this.UIparameterInfos.filter(G).map(e=>{const a=this.parameterInfos?.find(a=>a.name===e.name);return{...a,...e}})),e}componentWillLoad(){this.UIparameterInfosChange(this.UIparameterInfos),this.analysisKeyValueChange.emit({path:"init",value:this.value})}render(){return(0,i.h)(i.H,{key:"df45208934f267764b80633909348e4b0afa6108"},(0,i.h)("analysis-label",{key:"66b3afa7cb2a93d8c92d21d75c7a09384af5c8c3",label:this.label,required:!1,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),this.renderParameters(this.combinedParameterInfos),this.renderErrorMessage())}renderErrorMessage(){const e=(0,s.P)(this.validationParams?.message)||void 0!==this.errorMessage,a=(0,s.a1)((0,s.a2)({},this.validationParams)),t=void 0!==this.validationParams?(0,s.a3)(this.validationParams.type):s.r.INVALID;return(0,i.h)("calcite-input-message",{class:k.errorMessage,hidden:!e,icon:"exclamationMarkTriangle",scale:s.g.Scale,status:t},a??this.errorMessage)}renderParameters(e,a,t){return e?.length>0&&(0,i.h)("div",null,void 0!==a?(0,i.h)("div",{class:k.groupLabel},t):null,(0,i.h)("div",{class:k.groupContainer},e?.map(e=>{const t=void 0!==a?`${a}[${e.name}]`:`${e.name}`,s=e.visible??!0;return e?.parameterInfos&&!e.dataType.includes("MultiValue")?this.renderParameters(e.parameterInfos,t,e.label??e.displayName??e.name):s&&(0,i.h)("div",{class:this.layout===h.A.Horizontal?k.groupHorizontal:""},(0,i.h)("analysis-label",{class:k.groupLabel,label:e.label??e.displayName??e.name,hideHelp:!0,required:!0===this.required||"required"in e&&!0===e.required}),(0,i.h)("div",{class:this.layout===h.A.Horizontal?k.groupActionHorizontal:k.groupAction},this.renderDefaultComponent(e,t)))})))}renderDefaultComponent(e,a){const t=(0,n.w)(this.value,a);return(0,i.h)(l.A,{key:a,required:this.required,...e,label:"",onValueChange:()=>this.parameterValueChanged(`${a}`),onSetRef:e=>this.setAnalysisRef(`${a}`,e),value:t,doCalciteInputChangeOnCommit:this.doCalciteInputChangeOnCommit,clearEnabled:this.clearEnabled,readOnly:this.readOnly})}async checkValidity(){const e=await this.validate(),{message:a,type:t}=this.validationParams||{},i=!1===(void 0!==a)||!0===("informative"===t);return!0===e&&void 0===this.errorMessage&&!0===i}async validate(){const e=Array.from(this.mappedElementMap.keys()).map(async e=>this.validateParameter(e));return(await Promise.all(e)).every(e=>!0===e)}async validateParameter(e){const a=this.mappedElementMap.get(e),t=this.combinedParameterInfos.find(a=>a.name===e)??{};let i=!0;if(void 0!==a)if("checkValidity"in a)i=await a.checkValidity();else{const e="required"in t&&t.required;i=!1===(!0===this.required||!0===e)||void 0!==a.value}return i}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.d)(this)}static get watchers(){return{parameterInfos:["parameterInfosChange"],UIparameterInfos:["UIparameterInfosChange"]}}};E.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{height:100%;margin-bottom:var(--analysis-half-spacing)}.key-value__group-container{display:flex;flex-direction:column;border:1px var(--calcite-color-border-1) solid;border-radius:var(--calcite-border-radius);padding:var(--analysis-half-spacing) var(--analysis-half-spacing) 0 var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.key-value__group-label-text{margin-bottom:var(--analysis-quarter-spacing);align-self:center;width:48%;font-size:var(--calcite-font-size--2)}.key-value__group-action{align-self:flex-end;width:100%}.key-value__group-action-horizontal{align-self:flex-end;width:50%}.key-value__horizontal-layout{display:flex;width:var(--analysis-component-default-width);justify-content:space-between}.key-value__error-message{margin-top:var(--analysis-quarter-spacing)}";const D="value-table",w={groupContainer:`${D}__group-container`,groupAction:`${D}__group-action`,groupAction1:`${D}__group-action-1`,groupHorizontal:`${D}__horizontal-layout`,analysisInput:`${D}__analysis-input`,errorMessage:`${D}__error-message`},_=new Set([r.A.GPFeatureRecordSetLayer,r.A.GPRecordSet]),x=({direction:e,entryIndex:a,values:t,parameterInfos:s,valueWithoutKey:r,removeLabel:n,onEntryDeleted:o,onValueChange:h,onSetRef:c,doCalciteInputChangeOnCommit:p,clearEnabled:d,readOnly:y,props:m})=>{const v=s[0],g=v?.label;return r?(0,i.h)("div",{class:`${w.groupHorizontal} ${"rtl"===e?w.groupHorizontal:""}`,key:a},Boolean(g)&&(0,i.h)("analysis-label",{label:g,hideHelp:!0,required:!0===v.required||v.parameterType===u}),(0,i.h)(l.A,{...v,label:"",onValueChange:e=>h(a,s[0].name,e),onSetRef:e=>c(a,s[0].name,e),value:t[s[0].name],doCalciteInputChangeOnCommit:p,clearEnabled:d,readOnly:y}),(0,i.h)("calcite-button",{kind:"neutral","icon-start":"x",appearance:"transparent",scale:"s",disabled:y,class:w.groupAction1,onClick:()=>o(a),label:n})):(0,i.h)("div",{class:w.groupContainer,key:a},(0,i.h)("calcite-button",{"icon-end":"trash",appearance:"transparent",kind:"neutral",scale:"s",disabled:y,class:w.groupAction,onClick:()=>o(a),label:n}),s.filter(e=>!("visible"in e&&!1===e.visible)).map(e=>{const s="required"in e&&!0===e.required||e.parameterType===u;return(0,i.h)(l.A,{...e,...m,class:w.analysisInput,required:s,label:e.label??e.displayName,onValueChange:t=>h(a,e.name,t),onSetRef:t=>c(a,e.name,t),value:t?.[e.name],hideHelp:!0,doCalciteInputChangeOnCommit:p,readOnly:y})}))},U=class{constructor(e){(0,i.r)(this,e),this.analysisValueTableChange=(0,i.c)(this,"analysisValueTableChange",7),this.analysisHelpClick=(0,i.c)(this,"analysisHelpClick",7),this.direction="ltr",this.entryInputElements=new Map,this.required=!1,this.value=[],this.valueWithoutKey=!1,this.supportsUpload=!1,this.defaultEntryDisabled=!1,this.readOnly=!1,this.onAddButtonClick=()=>{this.value=this.valueWithoutKey?[...this.value,void 0]:[...this.value,this.getDefaultEntry()],this.analysisValueTableChange.emit()},this.onEntryDeleted=e=>{this.value.splice(e,1),this.removeAndUpdateEntryInputElements(e),this.value=[...this.value],this.analysisValueTableChange.emit()},this.onValueChange=async(e,a,t)=>{const i=t.target.value;this.valueWithoutKey?this.value[e]=i:(0,s.a4)(a)&&(this.value[e][a]=i);const[,l]=await this.applyRulesToEntry(e);this.value[e]=l,this.analysisValueTableChange.emit()},this.onSetRef=(e,a,t)=>{const i=this.entryInputElements.get(e);if(t)if(this.valueWithoutKey)this.entryInputElements.set(e,t);else{const s={[a]:t};this.entryInputElements.set(e,{...i??{},...s})}else if(this.valueWithoutKey)this.entryInputElements.delete(e),this.value.splice(e,1);else{delete i?.[a];const t=this.value[e];"object"==typeof t&&null!==t&&(0,s.a4)(a)&&delete t[a]}},this.validateSelection=async()=>{let e=!0;this.errorMessage=void 0;const a=(0,s.P)(this.value)&&(0,s.y)(this.value.every(e=>void 0!==e)),t=(0,s.a1)((0,s.a2)(this.strings,this.validationParams)),i=this.value.flat(2).some(e=>(0,s.P)(e)),l=!1===a&&!1===i,r=void 0!==this.minGroupCount&&(!0===this.required||!1===l)&&this.value.length<this.minGroupCount,n=void 0!==this.maxGroupCount&&this.value.length>this.maxGroupCount;!0===this.required&&l?(e=!1,this.errorMessage=void 0!==this.validationParams?.message?t:this.strings.requiredMessage):(r||n)&&(e=!1,this.errorMessage=void 0!==this.validationParams?.message?t:(0,s.a)(r?this.strings.minGroupsMessage:this.strings.maxGroupsMessage,{minCount:`${this.minGroupCount??0}`,maxCount:`${this.maxGroupCount??Number.MAX_SAFE_INTEGER}`}));const o=(await this.checkEntriesValidity()).every(e=>!0===e);return e&&o},this.checkEntriesValidity=async()=>{const e=Array.from(this.entryInputElements.keys()).map(e=>{const a=this.entryInputElements.get(e);return(this.valueWithoutKey?[a]:Object.values(a)).map(this.checkEntryValidity)});return Promise.all(e.flat())},this.checkEntryValidity=e=>(0,s.P)(e)&&"checkValidity"in e&&"function"==typeof e.checkValidity?e.checkValidity():Promise.resolve(!0),this.getDefaultEntry=()=>{const e=this.combinedParameterInfos.filter(e=>void 0!==e.defaultValue).map(e=>[e.name,e.defaultValue]);return Object.fromEntries(e)}}async checkValidity(){const e=await this.validateSelection(),{message:a,type:t}=this.validationParams||{},i=!1===(void 0!==a)||!0===("informative"===t);return!0===e&&void 0===this.errorMessage&&!0===i}get combinedParameterInfos(){let e=this.parameterInfos??[];return void 0!==this.UIparameterInfos&&(e=this.UIparameterInfos.filter(o.i).map(e=>{const a=this.parameterInfos?.find(a=>a.name===e.name);return{...a,...e}})),e}get rulesByDestination(){return(0,s.w)(this.UIparameterInfosRules??[])}async componentWillLoad(){if(({strings:this.strings,dir:this.direction}=await(0,s.u)(this.hostElement,(0,i.a)("."))),(void 0===this.value||0===this.value.length)&&!this.defaultEntryDisabled){const e=this.valueWithoutKey?void 0:this.getDefaultEntry();this.value=[e],(0,s.P)(e)&&this.analysisValueTableChange.emit()}}async componentWillRender(){this.entryElements=await Promise.all(this.value.map(async(e,a)=>{const[t,s]=await this.applyRulesToEntry(a);let l={};if(this.valueWithoutKey){l[t[0].name]=s}else l=s;return(0,i.h)(x,{direction:this.direction,entryIndex:a,values:l,valueWithoutKey:this.valueWithoutKey,parameterInfos:t,removeLabel:this.strings.removeEntryButtonLabel,onEntryDeleted:this.onEntryDeleted,onValueChange:this.onValueChange,onSetRef:this.onSetRef,doCalciteInputChangeOnCommit:this.doCalciteInputChangeOnCommit,clearEnabled:this.clearEnabled,readOnly:this.readOnly,props:{user:this.user,portal:this.portal,mapLayers:this.mapLayers,mapView:this.mapView,supportsUpload:this.supportsUpload,serviceUrl:this.serviceUrl}})}))}render(){return(0,i.h)(i.H,{key:"04e8bb91f2b94e82a33c8d6751bc4c70d0d04433"},(0,i.h)("analysis-label",{key:"f52d1b01bb9401c93329b5fd7e40c1def99c870f",label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),this.entryElements,(0,i.h)("calcite-button",{key:"9792b18c6b5b4b721a77dc0623b643c963d15151",style:this.valueWithoutKey?{marginTop:"var(--analysis-half-spacing)"}:{},appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:s.g.Scale,onClick:this.onAddButtonClick,disabled:this.readOnly},this.strings.addEntryButtonLabel),this.renderErrorMessage())}renderErrorMessage(){const e=(0,s.P)(this.validationParams?.message)||void 0!==this.errorMessage,a=(0,s.a1)((0,s.a2)(this.strings,this.validationParams)),t=void 0!==this.validationParams?(0,s.a3)(this.validationParams.type):s.r.INVALID;return(0,i.h)("calcite-input-message",{class:w.errorMessage,hidden:!e,icon:"exclamationMarkTriangle",scale:s.g.Scale,status:t},a??this.errorMessage)}removeAndUpdateEntryInputElements(e){const a=this.entryInputElements.size;if(e>=0&&e<a){const a=new Map;for(const[t,i]of this.entryInputElements){const s=t>e?t-1:t;t!==e&&a.set(s,i)}this.entryInputElements=a}}getSelectedLayersForParameter(e,a){const t=a?.[e.name];let i;if("dataType"in e&&"string"==typeof e?.dataType&&_.has(e?.dataType)&&void 0!==t){const e=t;i=(0,s.a5)(e?.url??e?.layerDefinition?.name,this.mapLayers??[])}return i}async applyRulesToEntry(e){if(this.valueWithoutKey)return[this.combinedParameterInfos,this.value[e]];const a=this.rulesByDestination,t=this.value[e],i=this.entryInputElements.get(e);let l;l=void 0===i?{}:i;const r=Object.entries(l).reduce((e,[a,t])=>(void 0!==t&&(e[a]=t),e),{});return[await Promise.all(this.combinedParameterInfos.map(async e=>{const i={selectedLayers:this.getSelectedLayersForParameter(e,t),...e};let[l]=await(0,s.A)({param:i,data:t,rules:a.get(e.name)??[],renderedParameters:r});return[l]=(0,s.J)({param:l,data:t,renderedParameters:r}),l})),t]}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.d)(this)}};U.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:block;margin-bottom:var(--analysis-half-spacing)}.value-table__group-container{display:flex;flex-direction:column;border:1px var(--calcite-color-border-1) solid;border-radius:var(--calcite-border-radius);padding:var(--analysis-half-spacing) var(--analysis-half-spacing) 0 var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.value-table__group-action{align-self:flex-end}.value-table__group-action-1{align-self:flex-start}.value-table__label{margin:var(--analysis-half-spacing) 0}.value-table__horizontal-layout{display:flex;border:1px var(--calcite-color-border-1) solid;width:calc(100% - var(--analysis-half-spacing) - 1px);margin-top:-1px;padding-top:var(--analysis-half-spacing);padding-left:var(--analysis-half-spacing)}.value-table__horizontal-layout-rtl{padding-left:unset;padding-right:var(--analysis-half-spacing)}.value-table__analysis-input{margin-bottom:var(--analysis-half-spacing)}.value-table__error-message{margin-top:var(--analysis-quarter-spacing)}"},80526:(e,a,t)=>{t.d(a,{A:()=>s,a:()=>l,b:()=>r,p:()=>n});var i=t(84121);const s={Vertical:"vertical",Horizontal:"horizontal"};function l(e,a,t,s){if(!(0,i.i)(e))return e;for(var l=-1,r=(a=(0,i.c)(a,e)).length,n=r-1,o=e;null!=o&&++l<r;){var h=(0,i.t)(a[l]),c=t;if("__proto__"===h||"constructor"===h||"prototype"===h)return e;if(l!=n){var p=o[h];void 0===(c=void 0)&&(c=(0,i.i)(p)?p:(0,i.b)(a[l+1])?[]:{})}(0,i.a)(o,h,c),o=o[h]}return e}function r(e,a,t){for(var s=-1,r=a.length,n={};++s<r;){var o=a[s],h=(0,i.d)(e,o);t(h,o)&&l(n,(0,i.c)(o,e),h)}return n}var n=(0,i.f)(function(e,a){return null==e?{}:function(e,a){return r(e,a,function(a,t){return(0,i.h)(e,t)})}(e,a)})}}]);