/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-de2750.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-de2750"],{30610:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigUnNtcPicker:()=>f});var s=i(73679),r=i(4395),a=i(46317),n=i(46300),o=i(36486),l=i(85643),c=i(73801),h=i(47640),u=i(66228),d=(e=>(e.DEFAULT="default",e.DESCRIPTION="description",e.TITLE="title",e.TYPE="type",e))(d||{});const p=r.AH`.popover{--calcite-popover-z-index: 100}.panel{min-height:300px}.label{height:-webkit-fill-available;width:-webkit-fill-available;padding:10px}.selection-button-div{padding:4px 10px}.content{max-height:60vh}`;class f extends c.WF{constructor(){super(...arguments),this._propWatcherTask=new h.YZ(this,{task:async([e,t])=>{if(!(0,u.i)(e)||!(0,u.i)(t))throw console.error("[arcgis-map-config-un-ntc-picker] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.utilityNetwork,this.popoverProps]}),this._messages=(0,o.u)({blocking:!0}),this.errorMessage="",this.flowElement=(0,l._)(),this.firstFlowItemElement=(0,l._)(),this.namedTraceConfigurations=[],this.namedTraceConfigurationInfos=[],this.listNode=(0,l._)(),this.popoverNode=(0,l._)(),this.lastSortBy=d.DEFAULT,this.filterNTCs=[],this.selectedNTCs=[],this.multipleDisabled=!1,this.showFilterLength=10,this.hideSort=!1,this.sortBy=d.DEFAULT,this.arcgisChange=(0,c.lh)(),this.arcgisClose=(0,c.lh)()}static{this.properties={lastSortBy:16,filterNTCs:16,utilityNetwork:0,selectedNTCs:0,popoverProps:0,multipleDisabled:5,showFilterLength:9,filterPlaceholderText:1,hideSort:5,sortBy:0}}static{this.styles=p}async reposition(){this.popoverNode.value?.reposition()}async init(){this.lastSortBy=this.sortBy||this.lastSortBy;try{if(this.namedTraceConfigurations=await this.utilityNetwork.queryNamedTraceConfigurations({}),!this.namedTraceConfigurations.length)return void(this.errorMessage=this._messages.ntcNoTracesFound);this.namedTraceConfigurations.forEach(e=>{this.namedTraceConfigurationInfos.push({id:e.globalId,creationDate:e.creationDate,creator:e.creator,description:e.description,minStartingPoints:e.minStartingPoints,resultTypes:e.resultTypes,tags:e.tags,title:e.title,type:e.traceType})}),this.utilityNetwork.sharedNamedTraceConfigurations.forEach(e=>{this.selectedNTCs.push(e.globalId)})}catch(e){this.errorMessage=e.message}}getSortedList(){const e=[...this.namedTraceConfigurationInfos];return this.lastSortBy===d.TITLE?e.sort((e,t)=>e.title.localeCompare(t.title)):this.lastSortBy===d.DESCRIPTION&&e.sort((e,t)=>e.description.localeCompare(t.description)),this.lastSortBy===d.TYPE&&e.sort((e,t)=>e.type.localeCompare(t.type)),e}selectDeselect(){return this.filterNTCs?.length?this.filterContainsAll():this.selectedNTCs.length===this.namedTraceConfigurationInfos.length}filterContainsAll(){return this.filterNTCs.every(e=>this.selectedNTCs.some(t=>t===e))}emitChange(){this.utilityNetwork.sharedNamedTraceConfigurations=[],this.selectedNTCs.forEach(e=>{const t=this.namedTraceConfigurations.find(t=>t.globalId===e);this.utilityNetwork.sharedNamedTraceConfigurations.push(new n.default({globalId:t.globalId,title:t.title}))}),this.arcgisChange.emit(this.utilityNetwork.sharedNamedTraceConfigurations)}render(){return this._propWatcherTask.render({complete:()=>{const{_messages:e,popoverProps:t}=this,i=t;return this.el.classList.add("js-app-flyout"),r.qy`<calcite-popover class="popover" .placement=${i.placement||"leading-start"} open pointer-disabled .referenceElement=${i.refElement} .offsetDistance=${i.offsetDistance||-Math.round(i.refElement.getBoundingClientRect().width)} .offsetSkidding=${i.offsetSkidding||25} .label=${e.headerSelect} ${(0,l.K)(this.popoverNode)}><calcite-flow class="content" style=${(0,c.zl)({width:`${i.popoverWidth||i.refElement.getBoundingClientRect().width}px`})} ${(0,l.K)(this.flowElement)}><calcite-flow-item class="panel" .heading=${e.headerSelect} closable @calciteFlowItemClose=${()=>this.arcgisClose.emit()} ${(0,l.K)(this.firstFlowItemElement)}>${""===this.errorMessage?this.renderNtcPickList():this.renderErrorLabel()}</calcite-flow-item></calcite-flow></calcite-popover>`}})}renderNtcPickList(){const{_messages:e}=this;return r.qy`<calcite-list .label=${e.ntc} .selectionMode=${this.multipleDisabled?"single":"multiple"} .filterEnabled=${this.namedTraceConfigurationInfos.length>=this.showFilterLength} .filterPlaceholder=${this.filterPlaceholderText??e.filter} @calciteListFilter=${e=>{e.stopPropagation(),this.filterNTCs=this.listNode.value.filteredItems?.map(e=>e.value)}} @calciteListChange=${()=>{const e=this.listNode.value.selectedItems.map(e=>e.value),t=this.selectedNTCs.filter(t=>e.includes(t)),i=e.filter(e=>!this.selectedNTCs.includes(e)),s=[...new Set([...t,...i])];this.selectedNTCs=s,this.emitChange()}} ${(0,l.K)(this.listNode)}>${this.namedTraceConfigurationInfos.length>=this.showFilterLength&&!this.hideSort&&this.renderSort()||""}${this.renderSelectionButton()}${[...this.getSortedList()].map(e=>this.renderCalciteListItem(e))}</calcite-list>`}renderErrorLabel(){return r.qy`<calcite-label class="label">${this.errorMessage}</calcite-label>`}renderSort(){const{_messages:e}=this;return r.qy`<calcite-dropdown overlay-positioning=fixed slot=filter-actions-end placement=bottom-end><calcite-action slot=trigger .text=${e.sort} title=${e.sort??c.s6}><calcite-icon scale=s icon=sortDescending flip-rtl></calcite-icon></calcite-action><calcite-dropdown-group><calcite-dropdown-item .selected=${this.lastSortBy===d.DEFAULT} @click=${()=>this.lastSortBy=d.DEFAULT}>${e.default}</calcite-dropdown-item><calcite-dropdown-item .selected=${this.lastSortBy===d.TITLE} @click=${()=>this.lastSortBy=d.TITLE}>${e.name}</calcite-dropdown-item><calcite-dropdown-item .selected=${this.lastSortBy===d.TYPE} @click=${()=>this.lastSortBy=d.TYPE}>${e.type}</calcite-dropdown-item><calcite-dropdown-item .selected=${this.lastSortBy===d.DESCRIPTION} @click=${()=>this.lastSortBy=d.DESCRIPTION}>${e.description}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown>`}renderSelectionButton(){const{_messages:e}=this;return r.qy`<div class="selection-button-div"><calcite-button appearance=transparent scale=s width=full @click=${()=>{this.selectDeselect()?this.selectedNTCs=this.filterNTCs?.length?this.selectedNTCs.filter(e=>!this.filterNTCs.includes(e)):[]:this.selectedNTCs=this.filterNTCs?.length?[...new Set([...this.selectedNTCs,...this.filterNTCs])]:this.namedTraceConfigurationInfos.map(e=>e.id),this.emitChange()}}>${this.selectDeselect()?e.deselectAll:e.selectAll}</calcite-button></div>`}renderCalciteListItem(e){const{_messages:t}=this;return(0,a.D)(e.id,r.qy`<calcite-list-item .label=${e.title} .description=${e.description} .value=${e.id} .selected=${this.selectedNTCs.includes(e.id)} .metadata=${{id:e.id,title:e.title}}><calcite-action slot=actions-end .text=${t.info} title=${t.info??c.s6} scale=s icon=information @click=${t=>{t.stopPropagation();const i=(0,c.dN)(r.qy`<calcite-flow-item .heading=${e.title} .description=${e.description} show-back-button selected @calciteFlowItemBack=${()=>{i.remove(),this.firstFlowItemElement.value.selected=!0}}><arcgis-map-config-un-ntc-picker-info .utilityNetwork=${this.utilityNetwork} .ntcId=${e.id} ._messages=${this._messages} class="content"></arcgis-map-config-un-ntc-picker-info></calcite-flow-item>`);this.flowElement.value.appendChild(i),this.firstFlowItemElement.value.selected=!1,i.setFocus()}}></calcite-action></calcite-list-item>`)}}(0,s.c)("arcgis-map-config-un-ntc-picker",f)},36486:(e,t,i)=>{i.d(t,{u:()=>a});var s=i(83552),r=i(73679);const a=(0,s.yr)(r.g)},42855:(e,t,i)=>{i.d(t,{a:()=>n,f:()=>s,l:()=>r,s:()=>a});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),r=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(r||{}),a=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(a||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},46317:(e,t,i)=>{i.d(t,{D:()=>n});var s=i(85282),r=i(34670),a=i(42466);const n=(0,r.u$)(class extends r.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,a.mY)(e),this.key=t),i}})},47640:(e,t,i)=>{i.d(t,{YZ:()=>n,e1:()=>r});var s=i(4836);const r={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},a=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??o,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let r=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){r=!0,i=e}if(this.p===s){if(t===a)this.i=0;else{if(!1===r){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},66228:(e,t,i)=>{i.d(t,{a:()=>w,b:()=>k,c:()=>P,d:()=>$,e:()=>E,f:()=>F,g:()=>g,h:()=>y,i:()=>f,j:()=>m,k:()=>v,l:()=>L,m:()=>N,n:()=>d,o:()=>C,p:()=>q,q:()=>S,r:()=>R,s:()=>b,t:()=>I,u:()=>T});var s=i(63438),r=i(18423),a=i(96086),n=i(91813),o=i(21255),l=i(13078),c=i(21303),h=i(12627),u=i(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],p=["feature"];function f(e){return null!=e}function m(e,t,i){const s=t.fieldName;if(s.includes(u.f.expression)){const e=i.get(s);return e?.title?e.title:s}return b(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function g(e){return new Map((await v(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function y(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${u.f.expression}${e.name}`;t.set(i,e)}),t}function w(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function T(e){const t=w(e);let i;return t===u.s.wms||t===u.s.mapImage?i=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(i=e.version),Number.parseFloat(i)}function b(e){return"fieldConfigurations"in e&&p.includes(e.type)}async function v(e){return await new Promise((t,i)=>{switch(w(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const s=e,r=s?.layer;r?.portalItem&&r.url.includes("https://demographics")&&r.url.includes(".arcgis.com")?r.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),r=e.thematicGroup.fieldNames,a=[];r.forEach(e=>{i.has(e)&&a.push(i.get(e))}),t(a)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function C(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function N(e){return Number((100*(1-e)).toFixed(1))}function I(e){return Number((1-e/100).toFixed(3))}const $=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},k=async(e,t)=>{const i=new h.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},E=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await x(i,s.features?.[0])},x=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=$(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const a=new r.default;i.geometry=a}return i};function S(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function P(e){if(w(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function L(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function F(e,t){try{const i=w(e);if(i===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await k(e,t)||await _(e,t)]};if(i===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await _(e,t)]};const s=i===u.s.ogcFeature||i===u.s.stream?await t.whenLayerView(e):e,r=s.createQuery();r.where=s.definitionExpression||"1=1",r.outFields=["*"],r.returnM="hasM"in e&&e.hasM,r.returnZ="hasZ"in e&&e.hasZ,r.outSpatialReference=t.spatialReference,r.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===u.s.ogcFeature)&&(r.start=0,r.num=1),r.outSpatialReference=t.spatialReference;const a=await s.queryFeatures(r);return a?.features?.length||(a.features[0]=await _(e,t)),a}catch(e){console.error(e)}}async function _(e,t){return await new Promise(i=>{const r=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),r.attributes=t}const c=t.extent;let h;"polygon"===e.geometryType?h=o.default.fromExtent(c):"point"===e.geometryType?h=c.center.clone():"multipoint"===e.geometryType?h=new a.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(h=new n.default({spatialReference:t.spatialReference.clone()}),h.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(h=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),r.geometry=h,i(r)})}function R(e){return w(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function q(e){return w(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);