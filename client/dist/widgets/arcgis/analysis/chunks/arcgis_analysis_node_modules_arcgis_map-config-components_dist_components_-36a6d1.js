/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-36a6d1.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-36a6d1"],{18055:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigLayerView:()=>R});var s=i(73679),r=i(4395),a=i(85643),n=i(46317),o=i(97357),c=i(36486),l=i(2801),h=i(2924),d=i(33752),p=i(44345),g=i(13661),u=(i(21255),i(66228)),m=i(43786),v=i(51072),f=i(5077),y=i(73801),w=i(47640);const C=r.AH`:host{height:100%}.panel{height:100%}.footer{width:100%}.error-content{margin:.5rem}`;class R extends y.WF{constructor(){super(),this.status=l.f.LOADING,this.initialLoad=!0,this._messages=(0,c.u)({blocking:!0}),this.createOngoing=!1,this._initialized=!1,this._loaded=!1,this._propWatcherTask=new w.YZ(this,{task:async([e,t,i])=>{if(!((0,u.i)(e)&&(0,u.i)(t)&&(0,u.i)(i)))throw console.error("[arcgis-map-config-layer-view] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,this.init()},args:()=>[this.view,this.itemId,this.config]}),this.reRender=!1,this.arcgisCancel=(0,y.lh)(),this.arcgisChange=(0,y.lh)(),this.arcgisCreate=(0,y.lh)(),this.arcgisStepChange=(0,y.lh)(),this.listen("arcgisStatusChange",this.arcgisStatusHandler),this.listen("arcgisCreateDone",this.arcgisCreateDoneHandler),this.listen("arcgisOverviewUpdated",this.arcgisOverviewUpdatedHandler),this.listen("arcgisSelectionCancel",this.arcgisSelectionCancelHandler),this.listen("arcgisOverviewCancel",this.arcgisOverviewCancelHandler),this.listen("arcgisCreateCancel",this.arcgisCreateCancelHandler),this.listen("arcgisCreateOngoing",this.arcgisCreateOngoingHandler)}static{this.properties={reRender:16,view:0,itemId:1,config:0}}static{this.styles=C}async setStep(e){const{props:t}=this,{viewItem:i}=t;if(this.createOngoing)setTimeout(()=>this.arcgisStepChange.emit(3),100);else switch(document.body.querySelectorAll(".js-app-flyout").forEach(e=>e.remove()),e){case 1:this.status=l.f.SELECTION,this.initialLoad=!1,this.reRender=!this.reRender;break;case 2:this.status=l.f.OVERVIEW,this.reRender=!this.reRender;break;case 3:i||(this.status=l.f.CREATE,this.reRender=!this.reRender)}}async updated(){if(this._propWatcherTask.status===w.e1.COMPLETE&&this._initialized&&!this._loaded){this._loaded=!0;let{props:e}=this;const{itemId:t,view:i}=e;try{const s=new d.default({id:t});if(await s.load(),"Feature Service"!==s.type)return void console.error("Only Feature Service items are allowed.");let r,a;if(s.typeKeywords?.indexOf("View Service")>-1?(r=s,await s.fetchRelatedItems({relationshipType:"Service2Data",direction:"forward"}).then(async e=>{e.length&&(a=e[0])})):a=s,!a)return console.error("Could not find related item for view."),this.panelNode.loading=!1,this.status=l.f.ERROR,void(this.reRender=!this.reRender);e.sourceItemId=a.id;let n=a.portal.user??void 0;a.portal.user.username!==a.owner&&await(0,p.default)(`${a.portal.restUrl}/community/users/${a.owner}`,{query:{f:"json"}}).then(e=>{e?.data&&(n=e.data)});let o=(r||a).extent;if(o||(o=new g.default({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:new m.default({wkid:4326})})),4326!==i.spatialReference.wkid){await v.load();const e=v.execute(o,i.spatialReference);e&&i.goTo(e.expand(1.1))}else i.goTo(o.expand(1.1));const c=await f.getBackgroundColorTheme(i);a=new d.default({id:a.id}),await a.load();const u=await h.default.fromPortalItem({portalItem:a});if(this.props={...e,layerItem:a,viewItem:r,layer:u,layerItemOwner:n,backgroundTheme:c||void 0},e=this.props,"group"===u.type?(await u.loadAll(),(0,l.g)(u)?.length&&i.map?.add(u),e.layerIds=(0,l.a)(u).map(e=>e.layerId).toArray(),(0,l.g)(u)?.forEach(e=>{if("feature"===e.type){const t=e;!t.popupTemplate&&t.popupEnabled&&(t.popupTemplate=t.createPopupTemplate())}})):(await u.load(),u.isTable||i.map?.add(u),e.layerIds=[u.layerId],u.popupTemplate=u.createPopupTemplate()),await(0,l.b)(e),await(0,l.i)(e),e.derivativeLayers={hasAny:!1},r){const t=await s.fetchRelatedItems({relationshipType:"Service2Service",direction:"forward"});t.length&&(e.derivativeLayers={hasMS:t.find(e=>"Map Service"===e.type),hasVTL:t.find(e=>"Vector Tile Service"===e.type),hasWFS:t.find(e=>"WFS"===e.type),hasScene:t.find(e=>"Scene Service"===e.type),hasOGCFL:t.find(e=>"OGCFeatureServer"===e.type)},(e.derivativeLayers.hasMS||e.derivativeLayers.hasVTL||e.derivativeLayers.hasWFS||e.derivativeLayers.hasScene||e.derivativeLayers.hasOGCFL)&&(e.derivativeLayers.hasAny=!0))}if(r&&e.adminServiceInfo.capabilities.indexOf("Sync")>-1){const t=`${r.url}/replicas`;await(0,p.default)(t,{query:{f:"json"}}).then(t=>{e.hasReplicas=t.data?.length>0})}this.status=l.f.SELECTION,this.reRender=!this.reRender,this.arcgisStepChange.emit(1)}catch(e){console.error(e),this.status=l.f.ERROR,this.reRender=!this.reRender}}}disconnectedCallback(){super.disconnectedCallback();const{props:e}=this,{view:t,layer:i}=e;t.map?.remove(i)}init(){const{itemId:e,view:t,config:i,_messages:s}=this;this.props={config:i,view:t,itemId:e,_messages:s,layerIds:[]},this._initialized=!0}arcgisStatusHandler(e){const{props:t}=this,{detail:i}=e;this.status=i.status,i.layerIds?.length&&(t.layerIds=[...i.layerIds]),this.status===l.f.SELECTION?(t.sourceItemId=t.layerItem.id,this.initialLoad=!1,this.arcgisStepChange.emit(1)):this.status===l.f.OVERVIEW?this.arcgisStepChange.emit(2):this.status===l.f.CREATE&&this.arcgisStepChange.emit(3),this.reRender=!this.reRender}async arcgisCreateDoneHandler(e){this.arcgisCreate.emit(e.detail)}async arcgisOverviewUpdatedHandler(){this.arcgisChange.emit(this.itemId)}arcgisSelectionCancelHandler(){this.arcgisCancel.emit()}arcgisOverviewCancelHandler(){this.arcgisCancel.emit()}arcgisCreateCancelHandler(){this.arcgisCancel.emit()}arcgisCreateOngoingHandler(e){this.createOngoing=e.detail}layerViewSelectionRefHandler(e){this.initialLoad||e?.setFocus()}goCancel(){this.arcgisCancel.emit()}render(){return this._propWatcherTask.render({complete:()=>{const{status:e}=this,t=window.customElements?.get("arcgis-item-browser"),i=window.customElements?.get("arcgis-item-properties");return t&&i?r.qy`${e===l.f.ERROR?this.renderError():null}${e===l.f.LOADING?this.renderLoading():null}${[l.f.SELECTION,l.f.SWAP_SOURCE,l.f.BROWSE_LAYER].includes(e)?this.renderLayerSelection():null}${[l.f.OVERVIEW,l.f.DEFINITION,l.f.FILTER].includes(e)?this.renderLayerOverview():null}${e===l.f.CREATE?this.renderCreateView():null}`:(console.error("Can't use arcgis-map-config-layer-view because @arcgis/app-components/arcgis-item-browser or @arcgis/app-components/arcgis-item-properties are not available."),r.qy`<div></div>`)}})}renderError(){const{props:e}=this,{viewItem:t,layerItem:i,_messages:s}=e;return r.qy`<calcite-flow-item .heading=${t?.title||i?.title||s.msg.error} .description=${t?.title||i?.title?s.general.sourceLayer:void 0} class=${(0,y.CP)(o.C.panel)} ${(0,a.K)(e=>this.panelNode=e)}><div class=${(0,y.CP)(o.C.errorContent)}><calcite-notice scale=s width=full open icon=exclamation-mark-triangle kind=danger><div slot=title>${s.msg.error}</div><div slot=message>${s.msg.initFailed}</div></calcite-notice></div><div slot=footer class=${(0,y.CP)(o.C.footer)}><calcite-button slot=footer @click=${this.goCancel} appearance=transparent width=full .label=${s.general.cancel}>${s.general.cancel}</calcite-button></div></calcite-flow-item>`}renderLoading(){const{props:e}=this,{viewItem:t,layerItem:i,_messages:s}=e;return r.qy`<calcite-flow-item loading .heading=${t?.title??i?.title??void 0} .description=${s.general.sourceLayer} class=${(0,y.CP)(o.C.panel)} ${(0,a.K)(e=>this.panelNode=e)}></calcite-flow-item>`}renderLayerSelection(){const{props:e,status:t}=this;return(0,n.D)(`selection-${t}`,r.qy`<arcgis-map-config-layer-view-selection .props=${e} .status=${t} ${(0,a.K)(this.layerViewSelectionRefHandler)}></arcgis-map-config-layer-view-selection>`)}renderLayerOverview(){const{props:e,status:t}=this;return r.qy`<arcgis-map-config-layer-view-overview .props=${e} .status=${t}></arcgis-map-config-layer-view-overview>`}renderCreateView(){const{props:e}=this;return r.qy`<arcgis-map-config-layer-view-create .props=${e}></arcgis-map-config-layer-view-create>`}}(0,s.c)("arcgis-map-config-layer-view",R)},36486:(e,t,i)=>{i.d(t,{u:()=>a});var s=i(83552),r=i(73679);const a=(0,s.yr)(r.g)},46317:(e,t,i)=>{i.d(t,{D:()=>n});var s=i(85282),r=i(34670),a=i(42466);const n=(0,r.u$)(class extends r.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,a.mY)(e),this.key=t),i}})},47640:(e,t,i)=>{i.d(t,{YZ:()=>n,e1:()=>r});var s=i(4836);const r={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},a=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??o,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let r=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){r=!0,i=e}if(this.p===s){if(t===a)this.i=0;else{if(!1===r){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},97357:(e,t,i)=>{i.d(t,{C:()=>s});const s={panel:"panel",footer:"footer",errorContent:"error-content"}}}]);