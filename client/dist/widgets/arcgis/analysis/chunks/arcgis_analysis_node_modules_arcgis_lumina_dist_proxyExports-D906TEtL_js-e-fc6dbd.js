/*! For license information please see arcgis_analysis_node_modules_arcgis_lumina_dist_proxyExports-D906TEtL_js-e-fc6dbd.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_lumina_dist_proxyExports-D906TEtL_js-e-fc6dbd"],{4265:(e,t,a)=>{a.d(t,{a:()=>r,d:()=>i,t:()=>l});const i=(e,t)=>{let a,i="idle";const r=async(...r)=>await new Promise(l=>{switch(i){case"flushed":i="idle",a?(clearTimeout(a),l(e(...r))):l(null);break;case"invoked":clearTimeout(a),i="idle",l(e(...r));break;case"cancelled":clearTimeout(a),i="idle",l(null);break;default:a&&clearTimeout(a),i="pending",a=setTimeout(()=>{i="idle",l(e(...r))},t)}});return r.flush=async function(...e){return i="flushed",await r(...e)},r.invoke=async function(...e){return i="invoked",await r(...e)},r.cancel=async function(...e){return i="cancelled",await r(...e)},r.getStatus=function(){return i},r},r=(e,t)=>{let a;return async(...i)=>await new Promise(r=>{a||(a=setTimeout(()=>{clearTimeout(a),a=void 0,r(e(...i))},t))})};function l(e){return new Promise(t=>setTimeout(t,e))}},45820:(e,t,a)=>{a.d(t,{a:()=>u,g:()=>n,q:()=>o});var i=a(28275),r=a(34031),l=a(63438),s=a(5933);async function n(e){const{isTable:t,layer:a,mapView:r}=i.f;if(!a||!("fields"in a))return await Promise.reject(new Error("getOneFeature: wrong layer type"));if(t)return await c(e);{const t=await r.whenLayerView(a),i="hasM"in a&&a.hasM,l="hasZ"in a&&a.hasZ,s=t.availableFields.length===a.fields.length&&!i&&!l;if("createQuery"in a&&s){const i=a.createQuery();i.start=0,i.num=5,i.outFields=["*"],i.returnGeometry=!0,i.outSpatialReference=a.spatialReference;const r=await t.queryFeatures(i);return r.features?.length?await Promise.resolve(r):await c(e)}return await c(e)}}async function c(e){const{layer:t}=i.f;if(!t||!("queryFeatures"in t))return d();try{return await o(e)||d()}catch{return}}async function o(e){const{layer:t}=i.f,a=new r.default({outFields:["*"],where:e||"1=1",outSpatialReference:t.spatialReference,returnGeometry:!0,returnM:"hasM"in t&&t.hasM,returnZ:"hasZ"in t&&t.hasZ});return t.sourceJSON?.advancedQueryCapabilities?.supportsPagination&&(a.num=1),await t.queryFeatures(a)}function d(){const{layer:e}=i.f,t={};e?.fields&&e.fields.forEach(e=>{e.defaultValue?t[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].includes(e.type)?t[e.name]=0:"date-only"===e.type?t[e.name]=null:t[e.name]=""});const a=new l.default({geometry:void 0,symbol:void 0,attributes:t});return new s.default({features:[a],fields:[],geometryType:e.geometryType,spatialReference:e?.spatialReference.clone()})}async function u(e="1=1"){const{layer:t}=i.f,a=new r.default({where:e});try{return await t.queryFeatureCount(a)}catch{return 0}}},65722:(e,t,a)=>{a.d(t,{a:()=>l,g:()=>s,o:()=>n});var i=a(44345);const r=e=>e&&!e.endsWith("/")?`${e}/`:e;function l(e){const{customBaseUrl:t,portalHostname:a,urlKey:i}=e,{protocol:r}=window.location;return`${r}//${i?`${i}.${t}`:a}`}function s(e){return r(e.restUrl)}async function n(e){if(!e?.user)return!1;const t=`${s(e)}portals/self/signinSettings`,a=await(0,i.default)(t,{query:{f:"json",async:!1},responseType:"json"});return!(a?.data&&!a.data.blockBetaApps)}},86519:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigFieldCalculateEditor:()=>h});var i=a(73679),r=a(4265),l=a(45820),s=a(28275),n=(a(52797),a(34031),a(63438),a(5933),a(59290),a(31526),a(44345),a(55448),a(4395)),c=a(73801),o=a(65722),d=a(85643);async function u(e){const{layer:t}=s.f;return{profileVariableInstances:{$feature:await p(e),$layer:t,$datastore:t.url},spatialReference:t.spatialReference,services:{portal:t.portalItem.portal}}}async function p(e){const{layer:t}=s.f;let a=null;if(t&&"fields"in t){const t=await(0,l.g)(e);t?.features?.length&&(a=t.features[0].clone())}return a}const g=n.AH`@layer{arcgis-map-config-field-calculate-editor{height:100%;position:relative;display:contents;.arcade-blocked-notice{margin-bottom:15px}arcgis-arcade-editor,arcgis-sql-expression-editor{z-index:calc(var(--calcite-z-index-header) + 1);height:100%;--calcite-dialog-content-space: 1rem !important}arcgis-arcade-editor>calcite-tooltip,arcgis-sql-expression-editor>calcite-tooltip{z-index:var(--calcite-z-index-tooltip)}.calculate-button{display:inline-flex}.calculate-card{cursor:pointer}.disabled{opacity:var(--calcite-opacity-disabled)}.editor{width:100%;height:100%}.hidden{display:none}.language-select-description{display:flex;flex-direction:column;width:100%}.language-select-description-header{font-weight:500}.language-select-tile{opacity:1;min-inline-size:100%}.language-select-description-text{list-style:revert!important;margin:revert!important;padding:revert!important;color:var(--calcite-color-text-3);font-size:var(--calcite-font-size-sm)}.language-select-text{margin:20px 12px 0}.language-select{margin:0 12px}.panel-border{border:1px solid #e0e0e0}.panel-title{font-size:var(--calcite-font-size-0);margin:14px 12px;font-weight:var(--calcite-font-weight-medium);color:var(--calcite-color-text-1)}.editor-wrapper{display:flex;flex-direction:column;align-items:center;margin:4rem 2rem;height:70vh;min-height:400px}.filter{height:100%;overflow-y:auto}}}`;class h extends c.WF{constructor(){super(...arguments),this.filterNode=(0,d._)(),this.script=s.f.currentScript||"",this.resizeObserver=new ResizeObserver(e=>{const t=e.pop();this.hideSideBar=t.contentRect.width<=600}),this.debouncedScriptChange=(0,r.d)(()=>{this.arcgisScriptChange.emit()},500),this.filterPanelOpen=!1,this.hideSideBar=!1,this.editorOpen=!1,this.arcgisFilterChange=(0,c.lh)(),this.arcgisLanguageSelected=(0,c.lh)(),this.arcgisResetWorkflow=(0,c.lh)(),this.arcgisScriptChange=(0,c.lh)()}static{this.properties={filterPanelOpen:16,hideSideBar:16,editorOpen:5,filterPanelWhere:1}}static{this.styles=g}static{this.shadowRootOptions=c.Iq}async closeEditor(){this.editorOpen=!1}async closeFilterPanel(){this.filterPanelOpen=!1}async closeFilterPopovers(){this.filterNode.value?.closePopover()}async isTestResultValid(){try{const e=await this.arcadeEditorNode.getTestResult();return"error"!==e.type&&(0,s.b)("null"===e.type?null:e.value).isFieldValid}catch{return!1}}async openEditor(){this.editorOpen=!0}async openFilterPanel(){this.filterPanelOpen=!0}async willUpdate(e){if(e.has("filterPanelWhere")&&this.arcadeEditorNode){const t=e.get("filterPanelWhere");this.arcadeEditorNode.testData=await u(t)}}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver.disconnect()}handleLanguageSelect(e){s.f.selectedLanguage!==e&&(s.f.selectedLanguage=e,this.script="",this.arcgisResetWorkflow.emit()),this.arcgisLanguageSelected.emit()}async setupArcadeEditor(e){const{layer:t,whereClause:a}=s.f;if(e){this.arcadeEditorNode=e,this.arcadeEditorNode.profile=function(){const{layer:e}=s.f;return{id:"field-calculation",definitions:{$feature:e,$datastore:e}}}(),this.arcadeEditorNode.testData=await u(a);const i=t?.portalItem?.portal;i?.user?.orgId&&!i.isPortal&&(await(0,o.o)(i)||(this.arcadeEditorNode.arcadeAssistant={portalUrl:i.url})),this.resizeObserver.observe(e)}}setupSQLEditor(e){e&&this.resizeObserver.observe(e)}render(){return n.qy`${this.renderLanguageSelect()}${this.renderFilterPanel()}${this.renderEditor()}`}renderFilterPanel(){if(!this.filterPanelOpen)return"";const{isTable:e,layer:t,mapView:a,_messages:i,whereClause:r}=s.f;return n.qy`<calcite-panel .heading=${i.defineFilter}><arcgis-common-sql-expression-config class="filter" .layer=${t} .whereClause=${r} mode=basic .view=${e?void 0:a} hide-buttons hide-layer-title .panelHeading=${i.defineFilter} .noFilterMsg=${i.emptyFilterText} .leadingText=${i.filterPanelDescription} .clearText=${i.clearAll} @arcgisChange=${e=>{this.arcgisFilterChange.emit(e.detail)}} ${(0,d.K)(this.filterNode)}></arcgis-common-sql-expression-config></calcite-panel>`}renderEditor(){const{selectedLanguage:e,_messages:t}=s.f;if(!this.editorOpen)return"";const a="Arcade"===e?this.renderArcadeEditor():this.renderSQLEditor();return n.qy`<calcite-panel .heading=${"Arcade"===e?t.arcadeExpression:t.sqlExpression}>${a}</calcite-panel>`}renderArcadeEditor(){return n.qy`<arcgis-arcade-editor class="editor" .script=${this.script} .hideSideBar=${this.hideSideBar} @arcgisScriptChange=${e=>{s.f.currentScript=e.detail,this.script=e.detail,this.debouncedScriptChange()}} ${(0,d.K)(this.setupArcadeEditor)}></arcgis-arcade-editor>`}renderSQLEditor(){return n.qy`<arcgis-sql-expression-editor class="editor" .script=${this.script} .profile=${function(){const{layer:e}=s.f;return{id:"field-calculation",definitions:{$layer:e}}}()} .hideSideBar=${this.hideSideBar} @arcgisScriptChange=${e=>{s.f.currentScript=e.detail,this.script=e.detail,this.debouncedScriptChange()}} ${(0,d.K)(this.setupSQLEditor)}></arcgis-sql-expression-editor>`}renderLanguageSelect(){if(this.editorOpen||this.filterPanelOpen)return"";const{arcadeSupported:e,config:t,layer:a,originalField:i,_messages:r}=s.f,l=a.portalItem,o=l.portal;let d=l.portal.urlKey?`//${o.urlKey}.${o.customBaseUrl}/home/item.html?id=${l.id}&sublayer=${a.layerId}`:`//${o.portalHostname}/home/item.html?id=${l.id}&sublayer=${a.layerId}`;return d+=`&calculateFieldName=${i.name}#data`,n.qy`<calcite-panel><div class="panel-title" slot=header-content>${r.editorPanelHeading}</div><calcite-label class="language-select-text">${r.languageSelect}</calcite-label><calcite-tile-group .label=${r.languageSelect} layout=vertical class="language-select" selection-mode=single-persist><calcite-notice class="arcade-blocked-notice" kind=info .open=${!e}><div slot=title>${r.languageNotSupported}</div><div slot=message>${a.portalItem.portal.isPortal?r.arcadeNotSupportedEN:r.arcadeNotSupported}</div>${t&&n.qy`<calcite-link slot=link target=_blank .href=${`${t.helpBase}${t.helpMap[120005320]}`}>${r.learnMoreEditing}</calcite-link>`||""}</calcite-notice><calcite-tile class="language-select-tile" .disabled=${!e} .selected=${"Arcade"===s.f.selectedLanguage} @click=${()=>this.handleLanguageSelect("Arcade")} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&this.handleLanguageSelect("Arcade")}}><div slot=content-bottom class="language-select-description"><calcite-label class=${(e?"":"disabled")+" language-select-description-header"}>${r.arcade}</calcite-label><calcite-label class=${(0,c.CP)(e?"":"disabled")}>${r.idealFor}<ul class=${(e?"":"disabled")+" language-select-description-text"}><li>${r.arcadeDescription1}</li><li>${r.arcadeDescription2}</li></ul></calcite-label></div></calcite-tile><calcite-tile class="language-select-tile" .selected=${"SQL"===s.f.selectedLanguage} @click=${()=>this.handleLanguageSelect("SQL")} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&this.handleLanguageSelect("SQL")}}><div slot=content-bottom class="language-select-description"><calcite-label class="language-select-description-header">${r.sql}</calcite-label><calcite-label>${r.idealFor}<ul class="language-select-description-text"><li>${r.sqlDescription1}</li><li>${r.sqlDescription2}</li><li>${r.sqlDescription3}</li></ul></calcite-label></div></calcite-tile></calcite-tile-group></calcite-panel>`}}(0,i.c)("arcgis-map-config-field-calculate-editor",h)},93461:(e,t,a)=>{a.d(t,{p:()=>l});var i=a(4713),r=a(44319);const l=e=>(...t)=>{const a=(0,i.d)(),l=new e(...t),n=l.exports;(0,i.b)(a.at(-1));const c=l.component.manager;c.W(l,n),l.watchExports(c.W.bind(c,l)),(0,i.j)(l);const o=[l.component,...a].reverse();return(0,r.t)(o,e=>void 0===e?void 0:s(l,e,n),n)},s=(e,{host:t,key:a,isReactive:r},l)=>{const s=t,n=s[a]!==e.exports,c=s[a]!==l,o=l!==e.exports;n&&!c&&o&&(s[a]=e.exports);if(t===e.component){if(r){const t=e.component.manager;c&&t.W(e,s[a]),e.onUpdate(i=>{if(i.has(a)){const i=s[a];i!==e.exports&&t.W(e,i)}})}e.O=r?void 0:a}const d=e.component.constructor.elementProperties.get(a)?.readOnly;e.watchExports(()=>{s[a]!==e.exports&&(d?(0,i.f)(()=>{s[a]=e.exports}):s[a]=e.exports)})}}}]);