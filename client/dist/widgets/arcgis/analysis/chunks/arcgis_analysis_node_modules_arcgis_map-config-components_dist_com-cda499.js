/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-cda499.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-cda499"],{4265:(e,i,s)=>{s.d(i,{a:()=>a,d:()=>t,t:()=>l});const t=(e,i)=>{let s,t="idle";const a=async(...a)=>await new Promise(l=>{switch(t){case"flushed":t="idle",s?(clearTimeout(s),l(e(...a))):l(null);break;case"invoked":clearTimeout(s),t="idle",l(e(...a));break;case"cancelled":clearTimeout(s),t="idle",l(null);break;default:s&&clearTimeout(s),t="pending",s=setTimeout(()=>{t="idle",l(e(...a))},i)}});return a.flush=async function(...e){return t="flushed",await a(...e)},a.invoke=async function(...e){return t="invoked",await a(...e)},a.cancel=async function(...e){return t="cancelled",await a(...e)},a.getStatus=function(){return t},a},a=(e,i)=>{let s;return async(...t)=>await new Promise(a=>{s||(s=setTimeout(()=>{clearTimeout(s),s=void 0,a(e(...t))},i))})};function l(e){return new Promise(i=>setTimeout(i,e))}},47550:(e,i,s)=>{s.d(i,{a:()=>u,b:()=>o,g:()=>c,u:()=>r});var t=s(5294),a=s(52797),l=(s(54312),s(44345),s(55448),s(34031),s(63438),s(5933),s(28927),s(83368),s(89704),s(66228)),n=(s(56451),s(31521),s(23054),s(5077),s(23795),s(17902),s(87420),s(30161),s(81734),s(1225));s(83552),s(77462),s(49403),s(10281),s(83930),s(66617),s(10628),s(59640),s(64451),s(6176),s(10454),s(29614),s(94916),s(52554),s(2156),s(4038),s(49851),s(75054),s(15223),s(70169),s(47207),s(70852),s(48103),s(39423),s(85681),s(18444),s(42411),s(9767),s(38218),s(91914),s(86605),s(68196),s(440),s(46547),s(6238),s(7299);function r(e,i){const s=(0,n.g)(e),r=t.clone(s.classBreakInfos);s.classBreakInfos=[],r.forEach((e,t)=>{e=function(e,i,s,t){if((0,l.i)(i)&&0!==i)if(i<1){const l=Math.round(1/i);e.minValue="first"===t?Math.floor(e.minValue/i)/l:Math.round(e.minValue/i)/l,e.maxValue="last"===t?Math.ceil(e.maxValue/i)/l:Math.round(e.maxValue/i)/l,e.label=`${s>0?"> ":""}${e.minValue.toLocaleString(a.getLocale(),{maximumSignificantDigits:15})} - ${e.maxValue.toLocaleString(a.getLocale(),{maximumSignificantDigits:15})}`}else e.minValue="first"===t?Math.floor(e.minValue/i)*i:Math.round(e.minValue/i)*i,e.maxValue="last"===t?Math.ceil(e.maxValue/i)*i:Math.round(e.maxValue/i)*i,e.label=`${s>0?"> ":""}${e.minValue.toLocaleString()} - ${e.maxValue.toLocaleString()}`;return e}(e,i,t,0===t?"first":t===r.length-1?"last":void 0),s.addClassBreakInfo({minValue:e.minValue,maxValue:e.maxValue,symbol:e.symbol,label:e.label})})}function o(e,i){const s=(0,n.g)(e).classBreakInfos;let t=i,a=Number.POSITIVE_INFINITY;s.forEach(e=>{t||(t=Math.max(d(e.minValue),d(e.maxValue))),a=Math.min(a,e.maxValue-e.minValue)});const l=[];return a>1e7?(l.push(1e7),l.push(1e6),l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01)):a>1e6?(l.push(1e6),l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01)):a>1e5?(l.push(1e5),l.push(1e4),l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01)):a>1e4?(l.push(1e4),l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01)):a>1e3?(l.push(1e3),l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001)):a>100?(l.push(100),l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5)):a>10?(l.push(10),t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6)):a>1?(t>0&&l.push(1),t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6)):a>.1?(t>1&&l.push(.1),t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6)):a>.01?(t>2&&l.push(.01),t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6)):a>.001?(t>3&&l.push(.001),t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6),t>7&&l.push(1e-7)):a>1e-4?(t>4&&l.push(1e-4),t>5&&l.push(1e-5),t>6&&l.push(1e-6),t>7&&l.push(1e-7),t>8&&l.push(1e-8)):a>1e-5&&(t>5&&l.push(1e-5),t>6&&l.push(1e-6),t>7&&l.push(1e-7),t>8&&l.push(1e-8),t>9&&l.push(1e-9)),l}function u(e){const i=(0,n.g)(e);let s=1e10;return i.classBreakInfos.forEach(e=>{s=Math.min(s,m(e.minValue)),s=Math.min(s,m(e.maxValue))}),s}function d(e){let i=1;for(;Math.round(e*i)/i!==e;)i*=10;return Math.log(i)/Math.LN10}function m(e){let i=1e-8;for(;h(Math.round(e/i)*i)===e;)i*=10;return i/10}function h(e){return Number.parseFloat(e.toPrecision(12))}function c(e){let i=0;e.forEach(e=>{(0,l.i)(e.value)?i=Math.max(d(h(e.value)),i):((0,l.i)(e.minValue)&&(i=Math.max(d(h(e.minValue)),i)),(0,l.i)(e.maxValue)&&(i=Math.max(d(h(e.maxValue)),i)),(0,l.i)(e.min)&&(i=Math.max(d(h(e.min)),i)),(0,l.i)(e.max)&&(i=Math.max(d(h(e.max)),i)))}),i=Math.min(i,3);const s=e[0],t=e[e.length-1],a=Math.min(s.minValue??s.min??s.value,t.minValue??t.min??t.value),n=Math.max(s.maxValue??s.max??s.value,t.maxValue??t.max??t.value)-a;return n/e.length<2e-7?i=8:n/e.length<2e-6?i=7:n/e.length<2e-5?i=6:n/e.length<2e-4?i=5:n/e.length<.002?i=4:n/e.length<.02?i=3:n/e.length<.2?i=Math.max(i,2):n/e.length<2&&(i=Math.max(i,1)),Math.round(i)}},57682:(e,i,s)=>{s.r(i),s.d(i,{ArcgisMapConfigSmartMappingSizeSlider:()=>V});var t=s(73679),a=s(4395),l=s(54312),n=s(37242),r=s(40399),o=s(24457),u=s(75430),d=s(1225),m=(s(44345),s(55448),s(62052)),h=(s(34031),s(63438),s(5933),s(89704),s(47550)),c=(s(5294),s(56451),s(31521),s(23054),s(5077),s(23795),s(17902),s(87420),s(30161),s(81734),s(18423),s(96086),s(91813),s(21255),s(13078),s(21303),s(12627),s(65595)),p=(s(77462),s(49403),s(66617),s(10628),s(59640),s(64451),s(6176),s(10454),s(29614),s(87735)),S=(s(2156),s(4038),s(49851),s(75054),s(15223),s(70169),s(52797),s(47207),s(70852),s(48103),s(39423),s(85681),s(18444),s(42411),s(9767),s(38218),s(91914),s(86605),s(68196),s(440),s(46547),s(28927),s(6238),s(7299),s(85643)),g=s(73801),z=s(4265);const f=a.AH`.slider-box{height:320px;.esri-size-slider,.esri-classed-size-slider{min-width:200px}.esri-size-slider .esri-slider .esri-slider__content,.esri-classed-size-slider .esri-slider .esri-slider__content{height:175px}.esri-size-slider__histogram-container,.esri-classed-size-slider__histogram-container{width:85px}.esri-size-slider .esri-slider .esri-slider__label,.esri-size-slider .esri-slider .esri-slider__min,.esri-size-slider .esri-slider .esri-slider__max,.esri-classed-size-slider .esri-slider .esri-slider__label,.esri-classed-size-slider .esri-slider .esri-slider__min,.esri-classed-size-slider .esri-slider .esri-slider__max{text-decoration:underline}.esri-size-slider .esri-slider .esri-slider__label:hover,.esri-size-slider .esri-slider .esri-slider__min:hover,.esri-size-slider .esri-slider .esri-slider__max:hover,.esri-classed-size-slider .esri-slider .esri-slider__label:hover,.esri-classed-size-slider .esri-slider .esri-slider__min:hover,.esri-classed-size-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}}.slider-box-buttons-front{display:flex}.slider-container{overflow:hidden}`;class V extends g.WF{constructor(){super(),this.zoomButtonNode=(0,S._)(),this.currentStopValues=[],this.currentBreakValues=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.smartMappingState=(0,c.u)(),this.histogramStatus=d.s.MISSING,this.statisticsStatus=d.s.MISSING,this.sliderZoomed=!1,this.arcgisSmartMappingSizeSliderChange=(0,g.lh)(),this.arcgisSmartMappingSizeSliderError=(0,g.lh)(),this.listenOn(window,"arcgisSmartMappingAuthRefSizeVisVarChange",this.arcgisSmartMappingAuthRefSizeVisVarChangeHandler)}static{this.properties={histogramStatus:16,statisticsStatus:16,sliderZoomed:16}}static{this.styles=f}async updateStatistics(){this.statisticsStatus=d.s.MISSING,this.statistics=void 0,this.histogramStatus=d.s.MISSING,this.histogram=void 0,this.sizeSlider?.destroy(),this.sizeSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}async updateColors(){const{smartMappingState:e}=this,i=(0,d.g)(e),s=(0,d.d)(e);if(this.sizeSlider){const e="class-breaks"===i.type?i.classBreakInfos:i.uniqueValueInfos,t=["color-size","color-age-size","color-size-age","type-size","type-size-age","predominance-size","chart-size","relationship-size"].includes(s)?null:(0,d.i)(e[e.length-1].symbol),a={style:t?{trackFillColor:t}:null};this.sizeSlider.set(a)}}load(){this.getStatistics()}disconnectedCallback(){super.disconnectedCallback(),this.zoomOptionsHandle?.remove(),this.scaleHandle?.remove()}arcgisSmartMappingAuthRefSizeVisVarChangeHandler(){const{smartMappingState:e}=this,i=(0,d.g)(e),s=(0,d.p)(i,"reference-size");s?.referenceSizeScale&&(this.currentStopValues=[s.sizeStops[0].value,s.sizeStops[1].value],this.sizeSlider?.stops.forEach((e,i)=>e.size=s.sizeStops[i].size))}divRefHandler(e){if(e)if(this.sizeSlider.container)e.append(this.sizeSlider.container);else{const i=document.createElement("div");i.classList.add("slider-container"),e.append(i),this.sizeSlider.container=i}}prepareSizeSlider(){const{statistics:e,histogram:i,histogramStatus:s,smartMappingState:t}=this,{mapView:a}=t,l=(0,d.g)(t),o=(0,d.d)(t),u=["size-age","color-size-age","type-size-age"].includes(o),c="class-breaks"===l.type?l.classBreakInfos:l.uniqueValueInfos,S=this.getFieldInfo().simpleFieldType===d.J.DATE,g=(0,d.c)(l,"size"),z=(0,d.p)(l,"size"),f=(0,d.p)(l,"size"),V=(0,d.p)(l,"spike"),x=["color-size","color-age-size","color-size-age","type-size","type-size-age","predominance-size","chart-size","relationship-size"].includes(o)?null:(0,d.i)(c[c.length-1].symbol);let v,M;if(z?(v=z.minSliderValue,M=z.maxSliderValue):f?(v=f.minSliderValue,M=f.maxSliderValue):V?(v=V.minSliderValue,M=V.maxSliderValue):(v=c[0].minValue,M=c[c.length-1].maxValue),({min:v,max:M}=(0,d.au)({min:v,max:M})),s===d.s.IN_PROGRESS)return!1;if(!this.sizeSlider||g&&this.sizeSlider.breaks||!g&&!f&&!V&&this.sizeSlider.stops){this.sizeSlider?.destroy();const s={histogramConfig:{bins:i?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:v??e.min,max:M??e.max,style:x?{trackFillColor:x||null}:null};if(g||f||V)S&&!u&&(s.hasTimeData=!0,(0,m.a)(s,a.timeZone)),s.stops=(0,p.h)(t),s.precision=(0,h.g)(s.stops),this.sizeSlider=new n.default(s),this.sizeSlider&&this.sizeSlider.min===this.sizeSlider.max&&this.sizeSlider.set(s);else{const e=(0,d.g)(t);s.histogramConfig.min=e.classBreakInfos[0].minValue,s.histogramConfig.max=e.classBreakInfos[e.classBreakInfos.length-1].maxValue,this.sliderZoomed=!1,s.breaks=(0,p.i)(t),s.precision=(0,h.g)(s.breaks),this.sizeSlider=new r.default(s),this.sizeSlider&&this.sizeSlider.min===this.sizeSlider.max&&this.sizeSlider.set(s)}this.createSizeSliderChangeEvents()}return(0,d.V)(this.sizeSlider)}handleInvertSlider(){const{smartMappingState:e}=this,i=(0,d.g)(e),s=(0,d.c)(i,"size");if(s)[s.minSize,s.maxSize]=[s.maxSize,s.minSize];else{const e=i.classBreakInfos.map(e=>(0,d.w)(e.symbol));e.reverse(),i.classBreakInfos.forEach((i,s)=>{const t=i.symbol;(0,d.u)(t,e[s])})}(0,d.a4)(e);const t=this.getUpdatedSizeSliderConfig(),{zoomOptions:a,...l}=t;this.sizeSlider.set(l),this.arcgisSmartMappingSizeSliderChange.emit()}async handleZoomSlider(e){const{smartMappingState:i}=this;if(this.histogramStatus===d.s.IN_PROGRESS)return;const{statistics:s}=this,t=(0,d.g)(i);this.sliderZoomed=(0,d.V)(e)?!!e:!this.sliderZoomed;const a=(0,d.c)(t,"size"),l=(0,d.p)(t,"reference-size"),n=(0,d.p)(t,"spike");!a&&!l&&!n&&(this.sliderZoomed=!1);const r=this.getFieldInfo(),o=this.getNormalizationField(),u=(0,d.p)(t,"size"),m=this.sliderZoomed?(0,d.av)(this.getZoomStops(),u?u.minSliderValue:l?l.minSliderValue:n?n.minSliderValue:s.min,u?u.maxSliderValue:l?l.maxSliderValue:n?n.maxSliderValue:s.max):null,h=u?u.minSliderValue===u.maxSliderValue:l?l?.minSliderValue===l?.maxSliderValue:n?.minSliderValue===n?.maxSliderValue;await this.getHistogram(r,o,s,(m?.min||(h?s.min:u?.minSliderValue??l?.minSliderValue??n?.minSliderValue??s.min))??void 0,(m?.max||(h?s.max:u?.maxSliderValue??l?.maxSliderValue??n?.minSliderValue??s.max))??void 0);const c=this.getUpdatedSizeSliderConfig();this.sizeSlider.set(c)}getStatistics(){const{smartMappingState:e}=this,{layer:i,useFeatureReduction:s,mapView:t}=e,a=i,l=(0,d.g)(e);let n,r;const u=(0,d.p)(l,"reference-size")||{},m=(0,d.p)(l,"spike")||{},h=this.getFieldInfo(),c=this.getNormalizationField(),p=(0,d.p)(l,"size")||{};if(n=p.minSliderValue??u.minSliderValue??m.minSliderValue??l.classBreakInfos?.[0]?.minValue,r=p.maxSliderValue??u.maxSliderValue??m.maxSliderValue??l.classBreakInfos?.[l.classBreakInfos.length-1]?.maxValue,"equal-interval"===l.authoringInfo?.classificationMethod){const e=l.classBreakInfos;n=e[0].minValue,r=e[e.length-1].maxValue}this.statisticsStatus=d.s.IN_PROGRESS,this.statistics||(0,o.default)({layer:a,view:t,field:h.field??void 0,valueExpression:h.expression??void 0,normalizationField:c,forBinning:s,outStatisticTypes:{exclude:["median"]}}).then(e=>{if(0===e.count){const[i,s]=this.getDefaultDataRange(h),t=p.minSliderValue||i,a=p.maxSliderValue||s;e.min=t,e.max=a,e.avg=(a+t)/2,(0,d.V)(p.minSliderValue)||(p.minSliderValue=t,p.maxSliderValue=a)}else if(!(0,d.V)(e.avg)||!(0,d.V)(e.min)||!(0,d.V)(e.max))return void(this.statisticsStatus=d.s.FAILED);e=(0,d.au)(e),({min:n,max:r}=(0,d.au)({min:n,max:r})),n=n??e.min,r=r??e.max,this.statistics=e,this.statisticsStatus=d.s.SUCCESS,this.getHistogram(h,c,e,n,r)},e=>{console.log(e),this.statisticsStatus=d.s.FAILED})}async getHistogram(e,i,s,t,a){const{smartMappingState:l}=this,{layer:n,useFeatureReduction:r,mapView:o}=l,m=n;if(!(s=s||this.statistics)||0===s.count)return;this.histogramStatus=d.s.IN_PROGRESS;const h=(0,d.g)(l),c=(0,d.p)(h,"reference-size");c&&void 0!==t&&c.sizeStops[0].value<t&&(t=c.sizeStops[0].value),c&&void 0!==a&&c.sizeStops[1].value>a&&(a=c.sizeStops[1].value);try{const l=await(0,u.default)({layer:m,view:o,field:e.field??void 0,valueExpression:e.expression??void 0,numBins:50,minValue:(0,d.V)(t)?t:s.min??void 0,maxValue:(0,d.V)(a)?a:s.max??void 0,normalizationField:i,forBinning:r});l&&(this.histogram=l,this.histogramStatus=d.s.SUCCESS)}catch(e){console.log(e),this.histogramStatus=d.s.FAILED}}async onMinMaxChange(e,i,s){const{statistics:t,smartMappingState:a}=this,l=(0,d.g)(a),n=(0,d.c)(l,"size"),r=(0,d.p)(l,"reference-size"),o=(0,d.p)(l,"spike"),u=(0,d.p)(l,"size")||{};if(!n&&!r&&!o){const s=l.classBreakInfos[0],t=l.classBreakInfos[l.classBreakInfos.length-1];s.minValue=e,s.label=(0,d.aw)(s,this.sizeSlider.precision),t.maxValue=i,t.label=(0,d.aw)(t,this.sizeSlider.precision)}u&&("min"===s?u.minSliderValue=e:u.maxSliderValue=i),r&&("min"===s?r.minSliderValue=e:r.maxSliderValue=i),o&&("min"===s?o.minSliderValue=e:o.maxSliderValue=i);const m=n||r||o?(0,d.av)(this.getZoomStops(),u?u.minSliderValue:r?r?.minSliderValue:o?.minSliderValue,u?u.maxSliderValue:r?r?.maxSliderValue:o?.maxSliderValue):null;this.zoomButtonNode.value&&(this.sliderZoomed?this.zoomButtonNode.value.disabled=!1:!m||m.minMaxSame||!(0,d.V)(m.min)&&!(0,d.V)(m.max)?this.zoomButtonNode.value.disabled=!0:this.zoomButtonNode.value.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.sizeSlider.zoomOptions,"min"===s?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=i,this.zoomAdjustment="max"));const h=this.getFieldInfo(),c=this.getNormalizationField();await this.getHistogram(h,c,t,e,i),(e===u?.minSliderValue&&i===u?.maxSliderValue||e===r?.minSliderValue&&i===r?.maxSliderValue||e===o?.minSliderValue&&i===o?.maxSliderValue)&&(this.sliderZoomed=!1),l.authoringInfo.classificationMethod="manual";const p=this.getUpdatedSizeSliderConfig();this.sizeSlider.set(p),this.arcgisSmartMappingSizeSliderChange.emit()}createSizeSliderChangeEvents(){const{smartMappingState:e}=this,i=(0,d.g)(e),s=(0,d.d)(e),t=(0,d.c)(i,"size"),a=(0,d.p)(i,"reference-size"),n=(0,d.p)(i,"spike"),r=["size-age","color-size-age","type-size-age"].includes(s),o=this.getFieldInfo().simpleFieldType===d.J.DATE;this.sizeSlider&&(this.zoomOptionsHandle?.remove(),this.zoomOptionsHandle=l.watch(()=>this.sizeSlider.zoomOptions,(e,i)=>{this.sliderZoomed&&(i?.min&&!e?.min||i?.max&&!e?.max)&&(this.zigzagClick=!0,this.handleZigzagClick(e))}),this.sizeSlider.on("min-change",e=>{t||a||n?e.value>this.currentStopValues[0]?(this.sizeSlider.stops.forEach((e,i)=>{e.value=this.currentStopValues[i]}),this.onMinMaxChange(this.currentStopValues[0],this.sizeSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.sizeSlider.slider.max,"min"):e.value>this.currentBreakValues[0].max?this.onMinMaxChange(this.currentBreakValues[0].max,this.sizeSlider.slider.max,"min"):this.onMinMaxChange(e.value,this.sizeSlider.slider.max,"min")}),this.sizeSlider.on("max-change",e=>{t||a||n?e.value<this.currentStopValues[this.currentStopValues.length-1]?(this.sizeSlider.stops.forEach((e,i)=>{e.value=this.currentStopValues[i]}),this.onMinMaxChange(this.sizeSlider.slider.min,this.currentStopValues[this.currentStopValues.length-1],"max")):this.onMinMaxChange(this.sizeSlider.slider.min,e.value,"max"):e.value<this.currentBreakValues[this.currentBreakValues.length-1].min?this.onMinMaxChange(this.sizeSlider.slider.min,this.currentBreakValues[this.currentBreakValues.length-1].min,"max"):this.onMinMaxChange(this.sizeSlider.slider.min,e.value,"max")}),this.sizeSlider.on("thumb-change",e=>{if(t||a||n){const i=this.sizeSlider.stops;if(o&&!r&&0===e.value)return void this.requestUpdate();this.updateRendererStops(i)}else this.updateRendererBreaks(this.sizeSlider.breaks)}),this.sizeSlider.on("thumb-drag",(0,z.d)(i=>{const s=(0,d.g)(e),a=(0,d.p)(s,"reference-size"),l=(0,d.p)(s,"spike");if(!a&&!l||!["start","drag"].includes(i.state))if(t||a||l){const e=this.sizeSlider.stops;this.updateRendererStops(e)}else this.updateRendererBreaks(this.sizeSlider.breaks)},10)),this.sizeSlider.on("segment-drag",(0,z.d)(()=>{if((0,d.c)(i,"size")||a||n){const e=this.sizeSlider.stops;this.updateRendererStops(e)}},10)))}updateRendererStops(e){const{smartMappingState:i}=this,s=(0,d.g)(i),t=(0,d.c)(s,"size"),a=(0,d.p)(s,"size"),l=(0,d.p)(s,"reference-size"),n=(0,d.p)(s,"spike");t?.stops||l?.sizeStops||n?.sizeStops?(5===e.length&&(e[0].label=`< ${e[0].value}`,e[1].label=`${e[1].value}`,e[2].label=`${e[2].value}`,e[3].label=`${e[3].value}`,e[4].label=`> ${e[4].value}`),t?t.stops=e:l?l?.sizeStops.forEach((i,s)=>i.value=e[s].value):n&&n?.sizeStops.forEach((i,s)=>i.value=e[s].value)):t&&(t.minDataValue=e[0].value,t.maxDataValue=e[1].value),this.currentStopValues=e.map(e=>e.value);const r=(0,d.av)(this.getZoomStops(),a?a.minSliderValue:l?l?.minSliderValue:n?.minSliderValue,a?a.maxSliderValue:l?l?.maxSliderValue:n?.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.value.disabled=!1:!r||r.minMaxSame||!(0,d.V)(r.min)&&!(0,d.V)(r.max)?this.zoomButtonNode.value.disabled=!0:this.zoomButtonNode.value.disabled=!1,l?(0,p.a)(i).then(e=>(0,d.a4)(i,e),e=>this.arcgisSmartMappingSizeSliderError.emit(e)):n?(0,p.b)(i).then(e=>(0,d.a4)(i,e),e=>this.arcgisSmartMappingSizeSliderError.emit(e)):(0,d.a4)(i)}updateRendererBreaks(e){const{smartMappingState:i}=this,s=(0,d.g)(i);s.authoringInfo.classificationMethod="manual",s.classBreakInfos.forEach((i,s)=>{if(i.minValue!==e[s].min||i.maxValue!==e[s].max){i.minValue=e[s].min,i.maxValue=e[s].max;const t=s>0?"> ":"";i.label=`${t} ${(0,d.aw)(i,this.sizeSlider.precision)}`,this.currentBreakValues[s].min=e[s].min,this.currentBreakValues[s].max=e[s].max}}),(0,d.a4)(i),this.arcgisSmartMappingSizeSliderChange.emit()}getDefaultDataRange(e){if(e.simpleFieldType===d.J.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const{smartMappingState:e}=this,i=(0,d.g)(e),s=(0,d.d)(e),t=(0,d.c)(i,"size"),a=(0,d._)(e),l=["color-size","color-age-size","color-size-age","type-size","type-size-age"].includes(s)&&a.length>1?a[1]:"relationship-size"===s?a[2]:a[0];return l.field||(l.expression=t?.valueExpression??i.valueExpression??null,l.expressionTitle=t?.valueExpressionTitle??i.valueExpressionTitle??null),l}async handleZigzagClick(e){const{statistics:i,smartMappingState:s}=this,t=(0,d.g)(s),a=(0,d.p)(t,"size")||{},l=(0,d.p)(t,"reference-size")||{},n=(0,d.p)(t,"spike")||{},r=this.getFieldInfo(),o=this.getNormalizationField(),u=a?a.minSliderValue===a.maxSliderValue:l?l.minSliderValue===l.maxSliderValue:n.minSliderValue===n.maxSliderValue;await this.getHistogram(r,o,i,e?.min??(u?i.min:a?.minSliderValue??l?.minSliderValue??n?.minSliderValue??i.min),e?.max??(u?i.max:a?.maxSliderValue??l?.maxSliderValue??n?.maxSliderValue??i.max)),e||(this.sliderZoomed=!1);const m=this.getUpdatedSizeSliderConfig();this.sizeSlider.set(m)}getNormalizationField(){const{smartMappingState:e}=this,i=(0,d.g)(e),s=(0,d.c)(i,"size"),t=(0,d.p)(i,"reference-size"),a=(0,d.p)(i,"spike");return s?s.normalizationField:t?t.normalizationField:a?a.normalizationField:i.normalizationField}getZoomStops(){const{smartMappingState:e}=this,i=(0,d.g)(e),s=(0,d.c)(i,"size"),t=(0,d.p)(i,"reference-size"),a=(0,d.p)(i,"spike");return s?[{value:s.minDataValue},{value:s.maxDataValue}]:t?[{value:t.sizeStops[0].value},{value:t.sizeStops[1].value}]:[{value:a.sizeStops[0].value},{value:a.sizeStops[1].value}]}getUpdatedSizeSliderConfig(){const{statistics:e,histogram:i,histogramStatus:s,sliderZoomed:t,smartMappingState:a}=this,{mapView:l}=a,n=(0,d.g)(a),r=(0,d.d)(a),o=["size-age","color-size-age","type-size-age"].includes(r),u="class-breaks"===n.type?n.classBreakInfos:n.uniqueValueInfos,c=this.getFieldInfo().simpleFieldType===d.J.DATE,S=(0,d.c)(n,"size"),g=(0,d.p)(n,"size"),z=(0,d.p)(n,"size"),f=(0,d.p)(n,"spike"),V=["color-size","color-age-size","color-size-age","type-size","type-size-age","predominance-size","chart-size","relationship-size"].includes(r)?null:(0,d.i)(u[u.length-1].symbol);let x,v;if(g?(x=g.minSliderValue,v=g.maxSliderValue):z?(x=z.minSliderValue,v=z.maxSliderValue):f?(x=f.minSliderValue,v=f.maxSliderValue):(x=u[0].minValue,v=u[u.length-1].maxValue),({min:x,max:v}=(0,d.au)({min:x,max:v})),s===d.s.IN_PROGRESS||"dragging"===this.sizeSlider.slider?.state)return;const M={histogramConfig:{bins:i?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:x??e.min,max:v??e.max,style:V?{trackFillColor:V||null}:null};return S||z||f?(M.stops=(0,p.h)(a),M.precision=(0,h.g)(M.stops),M.hasTimeData=c&&!o,c&&!o&&(0,m.a)(M,l.timeZone),t?this.zigzagClick||(M.zoomOptions=(0,d.av)(this.getZoomStops(),g?g?.minSliderValue:z?z?.minSliderValue:f?.minSliderValue,g?g?.maxSliderValue:z?z?.maxSliderValue:f?.maxSliderValue)):M.zoomOptions=null):(M.breaks=(0,p.i)(a),M.precision=(0,h.g)(M.breaks)),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(M.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.sizeSlider.slider.min=M.zoomOptions.min,M.zoomOptions.min=null):(this.sizeSlider.slider.max=M.zoomOptions.max,M.zoomOptions.max=null)),this.adjustedZoomOptions=void 0,this.zoomAdjustment=void 0,this.zigzagClick=!1,M}render(){const{config:e}=this.smartMappingState;return a.qy`<link rel=stylesheet href=${`${e.jsapiUrl}/themes/light/main.css`} @load=${()=>{this.styleSheetStatus="loaded",this.requestUpdate()}} @error=${()=>{this.styleSheetStatus="failed",this.requestUpdate()}}>${"loaded"===this.styleSheetStatus?this.renderSizeSlider():"not-loaded"===this.styleSheetStatus?this.renderSizeSliderLoading():null}`}renderSizeSlider(){const{statisticsStatus:e,histogramStatus:i,sliderZoomed:s,smartMappingState:t}=this,{_messages:l}=t,n=(0,d.g)(t),r=(0,d.c)(n,"size"),o=(0,d.p)(n,"reference-size"),u=(0,d.p)(n,"spike");if(e===d.s.FAILED||e===d.s.MISSING||r?.stops&&1===r.stops.length||!r&&!o&&!u&&1===n.classBreakInfos.length)return this.sizeSlider&&(this.sizeSlider.destroy(),this.sizeSlider=void 0),"";if(e===d.s.IN_PROGRESS||i===d.s.IN_PROGRESS&&!this.sizeSlider)return this.renderSizeSliderLoading();{const e=this.prepareSizeSlider();let i=!1;if((r||o||u)&&!s){const e=(0,d.p)(n,"size"),s=(0,d.av)(this.getZoomStops(),e?e?.minSliderValue:o?o?.minSliderValue:u?.minSliderValue,e?e?.maxSliderValue:o?o?.maxSliderValue:u?.maxSliderValue);(s?.minMaxSame||!(0,d.V)(s?.min)&&!(0,d.V)(s?.max))&&(i=!0,this.zoomButtonNode.value&&(this.zoomButtonNode.value.disabled=!0))}return r?this.currentStopValues=[r.minDataValue,r.maxDataValue]:o?this.currentStopValues=[o.sizeStops[0].value,o.sizeStops[1].value]:u?this.currentStopValues=[u.sizeStops[0].value,u.sizeStops[1].value]:this.currentBreakValues=n.classBreakInfos.map(e=>({min:e.minValue,max:e.maxValue})),(e||this.sizeSlider)&&this.sizeSlider.min!==this.sizeSlider.max?a.qy`<div class="slider-box"><calcite-label>${l.panels.size.dataRange}</calcite-label><div class="slider-box-buttons-front">${!o&&!u&&this.renderInvertButton()||""}${(r||o||u)&&a.qy`<div>&nbsp;</div>${this.renderZoomButton(i)}`||""}</div><div ${(0,S.K)(this.divRefHandler)}></div></div>`:this.sizeSlider&&this.sizeSlider.min===this.sizeSlider.max?"":this.renderSizeSliderLoading()}}renderSizeSliderLoading(){const{_messages:e}=this.smartMappingState;return a.qy`<div class="slider-box"><calcite-loader .label=${e.loading}></calcite-loader></div>`}renderInvertButton(){const{_messages:e}=this.smartMappingState;return a.qy`<arcgis-map-config-smart-mapping-action .text=${e.panels.size.invertSlider} icon=arrowUpDown @click=${()=>this.handleInvertSlider()}></arcgis-map-config-smart-mapping-action>`}renderZoomButton(e){const{_messages:i}=this.smartMappingState,{sliderZoomed:s}=this;return a.qy`<arcgis-map-config-smart-mapping-action .text=${i.panels.size.zoomSlider} .icon=${s?"magnifyingGlassMinus":"magnifyingGlassPlus"} .disabled=${e} @click=${()=>this.handleZoomSlider()} ${(0,S.K)(this.zoomButtonNode)}></arcgis-map-config-smart-mapping-action>`}}(0,t.c)("arcgis-map-config-smart-mapping-size-slider",V)},62052:(e,i,s)=>{s.d(i,{a:()=>a,b:()=>n,d:()=>r,u:()=>l});var t=s(52797);function a(e,i){e.labelFormatFunction=e=>o(e,i,"short-date"),e.inputFormatFunction=e=>o(e,i,"short-date"),e.inputParseFunction=e=>function(e,i){if(!e)return e;let s;if(i&&"system"!==i)if("unknown"===i)s=e;else{const t=new Date;s=e+(new Date(t.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(t.toLocaleString("en-US",{timeZone:i})).getTime())}else s=e+6e4*(new Date).getTimezoneOffset();return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(s).toISOString()),s}(Date.parse(e),i)}function l(e,i){let s;if(i&&"system"!==i)if("unknown"===i)s=new Date(e).toISOString();else{const t=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:i});s=new Date(new Date(a).getTime()-6e4*t).toISOString()}else{const i=(new Date).getTimezoneOffset();s=new Date(e-6e4*i).toISOString()}return s}function n(e,i,s){let t;if(i&&"system"!==i)if("unknown"===i)t=new Date(e).toISOString();else{const s=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:i});t=new Date(new Date(a).getTime()-6e4*s).toISOString()}else{const i=(new Date).getTimezoneOffset();t=new Date(e-6e4*i).toISOString()}return t=s?t.substring(11,19):t.substring(11,16),t}function r(e,i){let s,t=new Date(e);if(t=new Date(t.getTime()-6e4*t.getTimezoneOffset()),i&&"system"!==i)if("unknown"===i)s=t.getTime();else{const e=new Date(t.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(t.toLocaleString("en-US",{timeZone:i})).getTime();s=t.getTime()+e}else{const e=(new Date).getTimezoneOffset();s=t.getTime()+6e4*e}return s}function o(e,i,s){let a;return a="unknown"===i?t.formatDate(e,{...t.convertDateFormatToIntlOptions(s),timeZone:"utc",timeZoneName:"shortOffset"}):t.formatDate(e,{...t.convertDateFormatToIntlOptions(s),timeZone:i}),a}},65595:(e,i,s)=>{s.d(i,{c:()=>n,u:()=>r});var t=s(20936),a=s(1225),l=(s(54312),s(44345),s(55448),s(52797),s(34031),s(63438),s(5933),s(28927),s(83368),s(89704),s(5294),s(18423),s(96086),s(91813),s(21255),s(13078),s(21303),s(12627),s(56451),s(31521),s(23054),s(5077),s(23795),s(17902),s(87420),s(30161),s(81734),s(75698),s(10628),s(59640),s(64451),s(6176),s(83552));s(77462),s(49403),s(10281),s(83930),s(66617),s(10454),s(29614),s(94916),s(52554),s(2156),s(4038),s(49851),s(75054),s(15223),s(70169),s(47207),s(70852),s(48103),s(39423),s(85681),s(18444),s(42411),s(9767),s(38218),s(91914),s(86605),s(68196),s(440),s(46547),s(6238),s(7299);function n(e){e.selectedFields=[],e.layerFields=void 0,e.fields=void 0,e.hideLayerTitle=!1,e.supportsArcade=!1,e.stringFieldsCount=-1,e.dateFieldsCount=-1,e.numberFieldsCount=-1,e.containsFlow=!0,e.oneFeatureResponseStatus=a.s.MISSING,e.selectedAttribute=void 0,e.selectedAttributeText=void 0,e.selectedTypeValue=void 0,e.selectedValue=void 0,e.lastDefault=void 0,e.lastDefaults=void 0,e.dotColorSelected=void 0,e.backgroundStyleSelected=void 0,e.lastSettings=void 0,e.classedSymbolSelectedIdx=void 0,e.allUniqueValues=void 0,e.useFeatureReduction=void 0,e.symbolStylerConfig={},e.allowTimeSeriesConfiguration=!1,e.rasterInfo=void 0}function r(){const e=(0,l.Gk)(),i=e;e.manager.onLoad(()=>{i.smartMappingState=function(e,i){const s=o.get(e);if(s)return s;const a=(0,t.el)(e,i);return a&&"store"in a?(o.set(e,a.store),a.store):null}(e.el,"arcgis-map-config-smart-mapping")})}const o=new WeakMap}}]);