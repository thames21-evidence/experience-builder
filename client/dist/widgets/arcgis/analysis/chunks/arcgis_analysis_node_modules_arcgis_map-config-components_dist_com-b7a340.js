/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-b7a340.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-b7a340"],{4265:(e,t,i)=>{i.d(t,{a:()=>s,d:()=>a,t:()=>l});const a=(e,t)=>{let i,a="idle";const s=async(...s)=>await new Promise(l=>{switch(a){case"flushed":a="idle",i?(clearTimeout(i),l(e(...s))):l(null);break;case"invoked":clearTimeout(i),a="idle",l(e(...s));break;case"cancelled":clearTimeout(i),a="idle",l(null);break;default:i&&clearTimeout(i),a="pending",i=setTimeout(()=>{a="idle",l(e(...s))},t)}});return s.flush=async function(...e){return a="flushed",await s(...e)},s.invoke=async function(...e){return a="invoked",await s(...e)},s.cancel=async function(...e){return a="cancelled",await s(...e)},s.getStatus=function(){return a},s},s=(e,t)=>{let i;return async(...a)=>await new Promise(s=>{i||(i=setTimeout(()=>{clearTimeout(i),i=void 0,s(e(...a))},t))})};function l(e){return new Promise(t=>setTimeout(t,e))}},33324:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigTable:()=>$});var a=i(73679),s=i(4395),l=i(52797),o=i(54312),n=i(28335),r=i(34031),c=i(52373),d=i(81565),h=i(72344),u=i(90836),p=i(17599),m=i(31646),b=i(12660),f=i(63438),y=i(66228),g=i(4265),v=i(45211),T=i(98629),w=i(18423),C=i(21255),I=i(91552),S=i(36486),k=i(85643),N=i(73801),R=i(47640);const E=s.AH`@layer{:host{width:100%}arcgis-map-config-table{.table-wrapper{height:100%}.table-content{height:100%;display:flex}.non-tabs-manager-action-bar-wrapper{padding:2px 0;background-color:var(--calcite-color-foreground-1)}.table-action-bar{height:100%;border-width:0 1px 0 0;border-style:solid;border-color:var(--calcite-color-border-2);overflow-y:auto;overflow-x:hidden}.table-tooltip-message{white-space:nowrap}.table-header-actions{display:inline-flex;justify-self:stretch}.table-create-record-fab{position:absolute;bottom:24px;left:auto;right:76px;--calcite-opacity-disabled: .8}.table-hidden-fab{visibility:hidden}:dir(rtl){.action-bar{border-width:0 0 0 1px}.table-create-record-fab{left:76px;right:auto}}.esri-grid .esri-column__header-content calcite-dropdown calcite-dropdown-group{max-width:300px;overflow-x:auto}}}`;class $ extends N.WF{constructor(){super(...arguments),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new R.YZ(this,{task:async([e,t])=>{if(!(0,y.i)(e)||!(0,y.i)(t))throw console.error("[arcgis-map-config-table] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.view,this.layer]}),this._messages=(0,S.u)({blocking:!0}),this.isWithinTabsManager=!1,this.hasRelatedTileLayer=!1,this.recordsCount=0,this.fabNode=(0,k._)(),this.editMessageActionNode=(0,k._)(),this.fieldVisibilityActionNode=(0,k._)(),this.closeButtonNode=(0,k._)(),this.selectedOnlyMode=!1,this.selectedCount=0,this.keepTableSelection=!1,this.editMessagePopoverClickHandler=e=>{this.editMessagePopoverNode?(0,T.i)(e.target,"arcgis-map-config-table-editing-popover")||(this.editMessagePopoverNode?.remove(),this.editMessagePopoverNode=void 0,document.removeEventListener("click",this.editMessagePopoverClickHandler)):document.removeEventListener("click",this.editMessagePopoverClickHandler)},this.fieldVisibilityPopoverClickHandler=e=>{this.fieldVisibilityPopoverNode?(0,T.i)(e.target,"arcgis-map-config-table-field-selection")||(this.fieldVisibilityPopoverNode?.remove(),this.fieldVisibilityPopoverNode=void 0,document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler)):document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler)},this.columnInfoClickHandler=e=>{this.columnInfoPopoverNode?(0,T.i)(e.target,"arcgis-map-config-table-column-info")||(this.columnInfoPopoverNode?.remove(),this.columnInfoPopoverNode=void 0,document.removeEventListener("click",this.columnInfoClickHandler)):document.removeEventListener("click",this.columnInfoClickHandler)},this.reRender=!1,this.isBarExpanded=!1,this.lockRaster=!1,this.selectedFeatureIds=[],this.useSelectionManager=!1,this.scale="m",this.dismissible=!1,this.allowAddRecord=!1,this.allowEditRecord=!1,this.allowFieldCalculate=!1,this.arcgisChange=(0,N.lh)(),this.arcgisClose=(0,N.lh)(),this.arcgisCreateRecordClick=(0,N.lh)(),this.arcgisEditRecordClick=(0,N.lh)(),this.arcgisInCellEdit=(0,N.lh)(),this.arcgisScaleChange=(0,N.lh)()}static{this.properties={reRender:16,isBarExpanded:16,lockRaster:16,selectedFeatureIds:16,view:0,layer:0,config:0,useSelectionManager:5,scale:1,dismissible:5,initialViewpoint:0,allowAddRecord:5,allowEditRecord:5,allowFieldCalculate:5,initiallySelectedObjectIds:0}}static{this.styles=E}static{this.shadowRootOptions=N.Iq}async conditionalRefresh(e){const{table:t}=this;if(t.viewModel.relationshipColumns.some(t=>t.layer.id===e.id))await t.refresh();else for(const i of t.relatedTables){if(i.layer.id===e.id){await t.refresh();break}if(i.viewModel.relationshipColumns.some(t=>t.layer.id===e.id)){await t.refresh();break}}}async containsLayer(e){const{table:t}=this,i="subtype-sublayer"===e.type?e.parent.id:e.id;if(("subtype-sublayer"===t.layer.type?t.layer.parent.id:t.layer.id)===i)return!0;for(const e of t.relatedTables)if(("subtype-sublayer"===e.layer.type?e.layer.parent.id:e.layer.id)===i)return!0;return!(t.relatedTable||!t.relationshipInfos.length||!t.relationshipInfos.map(e=>"subtype-sublayer"===e.relatedLayer.type?e.relatedLayer.parent.id:e.relatedLayer.id).includes(i))}async disableTableEditorHooks(e){if(!this.activeTable?.layer)return;this.allowAddRecord=!e,this.allowEditRecord=!e;const t=this.supportsEditing(this.activeTable.layer);e?(this.activeTable.actionColumnConfig=void 0,this.fabNode.value&&(this.fabNode.value.hidden=!0)):(this.activeTable.actionColumnConfig=this.allowEditRecord&&t?this.getActionColumnConfig(this.activeTable.layer,this.activeTable.relatedTable?"related-table":"parent-table"):void 0,this.fabNode.value&&(this.fabNode.value.hidden=!1))}async enableEdits(e){e?(this.activeTable.editingEnabled=this.supportsEditing(this.activeTable.layer),this.fabNode.value&&(this.fabNode.value.disabled=!1)):(this.activeTable.editingEnabled=!1,this.fabNode.value&&(this.fabNode.value.disabled=!0))}async getSelectedObjectIds(){return await Promise.resolve(this.activeTable.highlightIds)}async highlightRootFeature(e,t){this.selectedFeatureIds=e&&(0,y.i)(t)?[t]:[],this.updateHighlightsAndSelection()}async refresh(e){const t=e?.addedObjectIds?.length?e.addedObjectIds:e?.updatedObjectIds;if(t)this.selectedFeatureIds=t,this.selectedCount=t.length,this.updateHighlightsAndSelection();else if(e?.selectedObjectIds?.length){if(this.selectedFeatureIds=e.selectedObjectIds,this.selectedCount=1,this.selectedOnlyMode=!0,this.canUseSelectionManager()){const t=this.getSelectionManager(),i=this.activeTable.layer;t.setSelection(i,e.selectedObjectIds)}else this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.addMany(e.selectedObjectIds);this.activeTable.objectIds.removeAll(),this.activeTable.objectIds.addMany(e.selectedObjectIds)}await(this.table?.refresh())}async setFocus(){this.handleFocus()}async syncTableTemplateWithAttributeTableTemplate(e){this.fieldVisibilityPopoverNode?.remove(),this.fieldVisibilityPopoverNode=void 0,document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler);const{table:t}=this,i="subtype-sublayer"===e.type?e.parent.id:e.id;if(("subtype-sublayer"===t.layer.type?t.layer.parent.id:t.layer.id)===i){const e=await this.getFieldTemplates(t.layer);t.tableTemplate=e}for(const e of t.relatedTables)if(("subtype-sublayer"===e.layer.type?e.layer.parent.id:e.layer.id)===i){const t=await this.getFieldTemplates(e.layer);e.tableTemplate=t}}async updated(){if(this._propWatcherTask.status===R.e1.COMPLETE&&this._initialized&&!this._loaded){this._loaded=!0;const{allowEditRecord:e}=this;if(requestAnimationFrame(()=>this.handleFocus()),!this.table)return;const t=await this.getFieldTemplates();this.activeTable.tableTemplate=t;const{table:i}=this;this.relatedTablesHandle=i.relatedTables.on("change",async({added:t})=>{t.length&&t.forEach(t=>{const i=t.layer,a=this.supportsEditing(i);t.visibleElements={header:!1,menu:!1,columnDescriptions:!1},t.actionColumnConfig=e&&a?this.getActionColumnConfig(i,"related-table"):void 0,t.attachmentsEnabled=(0,T.e)(i)}),this.activeTable=i.relatedTable??i;const a=this.supportsEditing(this.activeTable.layer);a&&this.activeTable.layer.on?this.activeTable.layer.on("edits",(0,g.d)(()=>{this.activeTable.layer&&this.arcgisInCellEdit.emit({layer:this.activeTable.layer})},300)):a&&"subtype-sublayer"===this.activeTable.layer.type&&this.activeTable.layer.parent.on&&this.activeTable.layer.parent.on("edits",(0,g.d)(()=>{this.activeTable.layer&&this.arcgisInCellEdit.emit({layer:this.activeTable.layer})},300)),i.relatedTable&&(this.showSelectedNode.disabled=!0);const s=await this.getFieldTemplates();this.activeTable.tableTemplate=s,setTimeout(()=>this.updateTable(this.activeTable.tableTemplate),300),this.selectedFeatureIds=[],this.activeTable.highlightIds.forEach(e=>this.selectedFeatureIds.push(e)),this.activeTable.highlightIds.on("change",e=>{const{selectedFeatureIds:t}=this;e.removed.forEach(e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)}),e.added.forEach(e=>{t.includes(e)||t.push(e)}),this.selectedCount=new Set(t).size,this.lockRasters(),this.reRender=!this.reRender}),this.createFeatureHandle=o.watch(()=>this.activeTable.viewModel.store.canAddRelatedFeature,()=>this.requestUpdate()),this.requestUpdate(),this.columnMenuHandle?.remove(),this.columnMenuHandle=this.getMenuHandle(),this.attachmentsViewOptionsHandle?.remove(),this.attachmentsViewOptionsHandle=this.getAttachmentsViewOptionsHandle(),this.columnSortOrderHandle?.remove(),this.columnSortOrderHandle=this.getColumnSortOrderHandle(),this.columnReorderHandle?.remove(),this.columnReorderHandle=this.getColumnReorderHandle()}),this.showAllTablesHandle=o.watch(()=>this.table.allRelatedTablesVisible,e=>this.fieldVisibilityActionNode.value.disabled=e)}}disconnectedCallback(){super.disconnectedCallback(),this.closePopovers();const{table:e}=this;e?.destroy(),this.removeAllHandles()}async init(){const{view:e,layer:t}=this,i=e,a=t;if("imagery"===a.type?(this.imagerySelection=!0,this.props={view:i,layer:a}):this.props={view:i,layer:a},i.popup?.viewModel?.active){const e=i.popup?.selectedFeature;if(this.layerContainsCurrentlySelectedFeature(e)){const e=i.popup.selectedFeature.getObjectId();(0,y.i)(this.initiallySelectedObjectIds?.length)&&!this.initiallySelectedObjectIds.includes(e)?this.initiallySelectedObjectIds.push(e):this.initiallySelectedObjectIds||(this.initiallySelectedObjectIds=[e])}}if(this.canUseSelectionManager()){const e=this.getSelectionManager().getSelection(a);e?.length?this.initiallySelectedObjectIds?.forEach(t=>{e.includes(t)||this.getSelectionManager().appendToSelection(a,t)}):this.initiallySelectedObjectIds?.length&&this.getSelectionManager().setSelection(a,this.initiallySelectedObjectIds);const t=this.getSelectionManager().getSelection(a);t?.length&&(this.selectedFeatureIds=t,this.selectedCount=t.length,this.selectedOnlyMode=!0)}else this.initiallySelectedObjectIds?.length&&(this.selectedFeatureIds=this.initiallySelectedObjectIds,this.selectedCount=this.initiallySelectedObjectIds.length,this.selectedOnlyMode=!0);if(this.isWithinTabsManager=(0,T.i)(this.el,"arcgis-map-config-tabs-manager"),("feature"===a.type||"oriented-imagery"===a.type)&&a.portalItem?.id){const e=await(0,v.f)(a.portalItem.id,a.portalItem.portal,{relationshipType:"Service2Service"});this.hasRelatedTileLayer=e?.data?.relatedItems.some(e=>e.type&&["WMTS","Map Service","Vector Tile Service"].includes(e.type))}this._initialized=!0}panelRefHandler(e){const{props:t}=this,{layer:i}=t;this.panelNode=e,this.layerTitleHandle=o.watch(()=>i.title,()=>this.requestUpdate())}zoomToObjectRefHandler(e){const{_messages:t}=this;this.zoomNode=e,this.afterCreateAction(this.zoomNode,t.zoomToSelection)}homeRefHandler(e){const{_messages:t}=this;this.homeNode=e,this.afterCreateAction(this.homeNode,t.home)}clearRefHandler(e){const{_messages:t}=this;this.eraseNode=e,this.afterCreateAction(this.eraseNode,t.clearSelection)}showSelectedRefHandler(e){const{_messages:t}=this;this.showSelectedNode=e,this.afterCreateAction(this.showSelectedNode,t.showSelected)}showAllRefHandler(e){const{_messages:t}=this;this.showAllNode=e,this.afterCreateAction(this.showAllNode,t.showAll)}refreshRefHandler(e){const{_messages:t}=this;this.refreshNode=e,this.afterCreateAction(this.refreshNode,t.refresh)}eraseRefHandler(e){const{_messages:t}=this;this.eraseNode=e,this.afterCreateAction(this.eraseNode,t.clearSelection)}selectVisibleRefHandler(e){const{_messages:t}=this;this.selectVisibleImageryNode=e,this.afterCreateAction(this.selectVisibleImageryNode,t.selectVisible)}displayAllRefHandler(e){const{lockRaster:t,_messages:i}=this;this.displayImageNode=e,this.afterCreateAction(this.displayImageNode,t?i.displayAll:i.displaySelected)}afterCreateTableNode(e){const{props:t,useSelectionManager:i}=this;let{selectedFeatureIds:a}=this;const{layer:s,view:l}=t,{table:n}=this;if(n)return;const{allowEditRecord:r}=this,c=this.supportsEditing(s);this.table=new u.default({selectionSource:i?"view":"table",objectIds:a,highlightIds:a,layer:s,view:l,relatedRecordsEnabled:!0,syncTemplateOnChangesEnabled:!1,editingEnabled:c,attachmentsEnabled:(0,T.e)(s),multiSortEnabled:!1,visibleElements:{header:!1,menu:!1,columnDescriptions:!1},actionColumnConfig:r&&c?this.getActionColumnConfig(s,"parent-table"):void 0,container:e}),this.activeTable=this.table,c&&this.table.layer.on?this.table.layer.on("edits",(0,g.d)(()=>{this.table.layer&&this.arcgisInCellEdit.emit({layer:this.table.layer})},300)):c&&"subtype-sublayer"===this.table.layer.type&&this.table.layer.parent.on&&this.table.layer.parent.on("edits",(0,g.d)(()=>{this.table.layer&&this.arcgisInCellEdit.emit({layer:this.table.layer})},300)),this.tableSizeHandle=o.watch(()=>this.table.viewModel.size,e=>{this.recordsCount=e,this.updateDisplayCount()}),this.columnMenuHandle?.remove(),this.columnMenuHandle=this.getMenuHandle(),this.attachmentsViewOptionsHandle?.remove(),this.attachmentsViewOptionsHandle=this.getAttachmentsViewOptionsHandle(),this.columnSortOrderHandle?.remove(),this.columnSortOrderHandle=this.getColumnSortOrderHandle(),this.columnReorderHandle?.remove(),this.columnReorderHandle=this.getColumnReorderHandle(),this.activeTable.highlightIds.on("change",e=>{const{selectedFeatureIds:t}=this;e.removed.forEach(e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)}),e.added.forEach(e=>{t.includes(e)||(t.push(e),this.canUseSelectionManager()&&this.activeTable.objectIds.length&&!this.activeTable.objectIds.includes(e)&&this.activeTable.objectIds.push(e))}),this.selectedCount=new Set(t).size,this.updateDisplayCount(),this.lockRasters(),this.reRender=!this.reRender}),this.canUseSelectionManager()||(this.popupActiveHandle=o.watch(()=>l.popup?.viewModel?.active,()=>{const e=l.popup?.selectedFeature;if(this.layerContainsCurrentlySelectedFeature(e)){this.activeTable.highlightIds.removeAll(),a=[];const e=l.popup.selectedFeature.getObjectId();this.activeTable.highlightIds.push(e),a.push(e),this.selectedOnlyMode&&!this.activeTable.objectIds.includes(e)&&(this.activeTable.objectIds.push(e),this.reRender=!this.reRender)}else e&&!l.popup.visible&&!this.keepTableSelection&&(this.activeTable.highlightIds.removeAll(),this.selectedOnlyMode&&this.handleShowAllClick());this.keepTableSelection=!1}))}getActionColumnConfig(e,t){const{_messages:i}=this;if(this.supportsUpdateDelete(e)&&(!e.portalItem||!(0,v.l)(e.portalItem)))return{icon:"pencil",label:e.isTable?i.editRecord:i.editFeature,callback:({feature:i})=>{if(this.keepTableSelection=!0,this.activeTable.columns.forEach(e=>e.closeMenu()),this.selectedFeatureIds=[i.getObjectId()],this.canUseSelectionManager()){const e=this.getSelectionManager(),t=i.layer??i.sourceLayer;e.setSelection(t,[i.getObjectId()])}else this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.add(i.getObjectId());this.activeTable.editingEnabled=!1,"related-table"===t&&(i.layer=e,i.sourceLayer=e),this.arcgisEditRecordClick.emit({parentTable:this.table,feature:i,layer:e})},disabled:()=>(0,y.i)(this.activeTable)&&!this.activeTable.editingEnabled}}async getFieldTemplates(e){const{activeTable:t,_messages:i}=this,a=e??t?.layer??this.layer,s=(0,y.s)(a),l=e=>{const t=[{label:i.information,icon:"information",clickFunction:()=>this.handleShowColumnInfo(e.name)}],s=!["blob","global-id","oid","raster"].includes(e.type),l=a.sourceJSON?.geometryProperties,o=l?.shapeLengthFieldName,n=l?.shapeAreaFieldName,r=[o,n].includes(e.name),c=e.editable&&s&&!r&&e.name!==this.activeTable.layer.objectIdField,d=("feature"===a.type||"oriented-imagery"===a.type)&&a.sourceJSON.supportsCalculate&&a.portalItem?.typeKeywords?.indexOf("Hosted Service")>-1&&"admin"===a.portalItem.itemControl&&!this.hasRelatedTileLayer;return this.allowFieldCalculate&&this.config&&d&&c&&t.push({label:i.calculateField,icon:"calculator",clickFunction:()=>{const t=a.portalItem.portal;if(t.sourceJSON?.isReadOnly){const e=t.isPortal;this.displayReadOnlyErrorDialog(e)}else this.handleCalculateField(e.name)}}),t.push({label:i.hideField,icon:"view-hide",clickFunction:()=>this.handleHideClick(e.name)}),{items:t}};let n;if(y.n.includes(a.type)){a?.attributeTableTemplate||(a.attributeTableTemplate=await b.createDefaultAttributeTableTemplateFromLayer({layer:a,excludedFieldTypesOverride:["geometry","blob","raster","xml"]})),n=await b.createTableTemplateFromAttributeTableTemplate({layer:a,template:a.attributeTableTemplate,includeHiddenFields:!0,excludedFieldTypesOverride:["geometry","blob","raster","xml"]});const e=a.fields.filter(e=>!e.visible).map(e=>e.name);n.columnTemplates=n.columnTemplates.filter(t=>!("field"===t.type&&(e.includes(t.fieldName)||!a.fields.find(e=>e.name===t.fieldName)))),n.columnTemplates.forEach(e=>{if("field"===e.type){const t=e.fieldName,i=a.fields.find(e=>e.name===t),o=a.popupTemplate?.fieldInfos?.find(e=>e.fieldName===t);s||(e.label=o?.label||i.alias||i.name,e.format=o?.format??this.getDefaultFormat(i)),e.menuConfig=l(i)}})}else{n=new p.default({columnTemplates:[]});const e=d.createFieldInfos({fields:a.fields,objectIdField:a.objectIdField}),t=new Map(e.map(e=>[e.fieldName,e])),i=a.popupTemplate?.fieldInfos?new Map(a.popupTemplate.fieldInfos.map(e=>[e.fieldName,e])):void 0,o=[];if(a.fields.forEach(e=>{if("geometry"===e.type||!e.visible)return;const a=t.get(e.name),n=i?.get(e.name),r={fieldName:e.name,type:"field",visible:!!a&&a.visible,menuConfig:l(e)};s||(r.label=n?.label||e.alias||e.name,r.format=n?.format||this.getDefaultFormat(e)),o.push(r)}),(0,T.e)(a)){const e={type:"attachment",visible:!0};o.push(e)}n.columnTemplates=o}return a.popupTemplate?.fieldInfos&&(this.popupTemplateWatchHandle?.remove(),this.popupTemplateWatchHandle=o.watch(()=>a.popupTemplate,async()=>{let e=!1,t=!1;const{popupTemplate:i}=a;if(n.columnTemplates.forEach(a=>{i.fieldInfos.forEach(i=>{if(!s&&a.fieldName===i.fieldName&&(JSON.stringify(a.format)!==JSON.stringify(i.format)&&(t=!0,a.format=i.format),a.label!==i.label)){e=!0,a.label=i.label;const t=this.activeTable.columns.find(e=>e.fieldName===i.fieldName);t&&(t.label=i.label)}})}),y.n.includes(a.type)){const e=await this.getFieldTemplates();this.activeTable.tableTemplate=e}else e?this.updateTable(new p.default({columnTemplates:n.columnTemplates})):t&&await(this.table?.refresh())})),n}getDefaultFormat(e){return["integer","small-integer","big-integer"].includes(e.type)?new h.default({digitSeparator:!1,places:0}):["single","double","long"].includes(e.type)?new h.default({digitSeparator:!1,places:2}):["date","time-only","timestamp-offset"].includes(e.type)?new h.default({dateFormat:"short-date-short-time"}):"date-only"===e.type?new h.default({dateFormat:"short-date"}):void 0}layerContainsCurrentlySelectedFeature(e){const{view:t}=this,i=this.activeTable?.layer??this.layer;return!!e&&(!!t.popup?.visible&&(e.layer?.id===i.id||"sublayer"===i.type&&e.sourceLayer?.layer?.id===i.layer?.id))}supportsEditing(e){const t=["feature","oriented-imagery","subtype-sublayer"].includes(e.type),i=e.effectiveEditingEnabled;return t&&i}supportsAdd(e){return e.effectiveCapabilities.operations.supportsAdd}supportsUpdateDelete(e){const t=e.effectiveCapabilities.operations.supportsUpdate,i=e.effectiveCapabilities.operations.supportsDelete;return t||i}updateDisplayCount(){const{_messages:e,panelNode:t,recordsCount:i,selectedCount:a}=this;if(!t)return;const s=l.convertNumberFormatToIntlOptions({digitSeparator:!0}),o=l.formatNumber(i,s);if((0,y.i)(a))if(0===a)t.description=0===i?e.zeroRecordsZeroSel:1===i?e.oneRecordZeroSel:e.numRecordsZeroSel.replace("${count}",o);else if(1===a)t.description=0===i?e.zeroRecordsOneSel:1===i?e.oneRecordOneSel:e.numRecordsOneSel.replace("${count}",o);else{const n=l.formatNumber(a,s);t.description=0===i?e.zeroRecordsNumSel.replace("${countSel}",n):1===i?e.oneRecordNumSel.replace("${countSel}",n):e.numRecordsNumSel.replace("${count}",o).replace("${countSel}",n)}else t.description=0===i?e.zeroRecords:1===i?e.oneRecord:e.numRecords.replace("${count}",o)}isKnowledgeGraphSubTable(){const e=this.activeTable?.layer??this.layer;return"knowledge-graph-sublayer"===e.type&&(e.parentCompositeLayer.tables?.toArray()??[]).map(e=>e.id).includes(e.id)}afterCreateAction(e,t){e&&(this.listenOn(e,"focus",()=>{const{isBarExpanded:i}=this;!i&&!e.textEnabled&&this.addTableTooltip(e,t)}),this.listenOn(e,"mouseover",()=>{const{isBarExpanded:i}=this;!i&&!e.textEnabled&&this.addTableTooltip(e,t)}),this.listenOn(e,"mouseout",()=>this.removeTableTooltip()),this.listenOn(e,"focusout",()=>this.removeTableTooltip()))}addTableTooltip(e,t){const i=(0,N.dN)(s.qy`<calcite-tooltip class="table-tooltip" .referenceElement=${e} placement=trailing-start open><div class="table-tooltip-message">${t}</div></calcite-tooltip>`);document.body.append(i)}removeTableTooltip(){document.querySelectorAll(".table-tooltip").forEach(e=>e.remove())}handleZoomToClick(){const{view:e,selectedFeatureIds:t}=this,i=e,a=this.activeTable?.layer??this.layer;if("imagery"===a.type){const e=new r.default;e.outSpatialReference=i.spatialReference,e.objectIds=[...t],e.returnGeometry=!0,a.queryRasters(e).then(e=>{i.goTo(e.features)})}else if("createQuery"in a){const e=a.createQuery();e.outSpatialReference=i.spatialReference,e.objectIds=[...t],e.returnGeometry=!0,a.queryFeatures(e).then(e=>i.goTo(e.features))}}handleHomeClick(){const{view:e,initialViewpoint:t}=this;e.goTo(t)}handleClearClick(){const{activeTable:e}=this;if(this.canUseSelectionManager()){const t=this.getSelectionManager(),i=e.layer;t.setSelection(i,[])}else e.highlightIds.removeAll();this.clearFilter()}handleShowSelectedClick(){this.selectedOnlyMode=!0,this.activeTable.objectIds.removeAll(),this.activeTable.objectIds.addMany(this.activeTable.highlightIds),this.reRender=!this.reRender}handleShowAllClick(){this.selectedOnlyMode=!1,this.activeTable.objectIds.removeAll(),this.reRender=!this.reRender}handleRefreshClick(){const{table:e}=this;e.refresh(),this.reRender=!this.reRender}handleSelectVisibleClick(){const{layer:e,view:t,table:i}=this;if(this.canUseSelectionManager()){const t=e;this.getSelectionManager().setSelection(t,[])}else i.highlightIds.removeAll();const a=t?.extent,s=function(e,t,i){const a=new C.default({spatialReference:e.spatialReference});a.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]);const s=(e.xmax-e.xmin)/t.width,l=(e.ymax-e.ymin)/t.height,o=e.spatialReference,n=new w.default({x:s,y:l,spatialReference:o}),r=new I.default;r.geometry=a,r.returnGeometry=!0,r.pixelSize=n;const c=i.mosaicRule.clone();return i.definitionExpression&&(c.where=i.definitionExpression),r.mosaicRule=c,r}(a,t,e);this.selectFeaturesFromIdentify(s)}handleDisplayAllClick(){this.lockRaster=!1;const e=this.layer,{sourceJSON:t}=e,i=t.allowedMosaicMethods.split(",").map(e=>e.trim().toLowerCase());i.unshift(t.defaultMosaicMethod.toLowerCase());const a=i.find(e=>"lockraster"!==e&&"viewpoint"!==e&&("byattribute"!==e||!!t.sortField))??"none";e.mosaicRule=c.default.fromJSON({...t,defaultMosaicMethod:a}),e.visible=!0}handleDisplaySelectedClick(){this.lockRaster=!0,this.lockRasters()}handleEditMessageActionClick(){const{_messages:e}=this;this.editMessagePopoverNode||(document.removeEventListener("click",this.editMessagePopoverClickHandler),this.editMessagePopoverNode=(0,N.dN)(s.qy`<arcgis-map-config-table-editing-popover .referenceElement=${this.editMessageActionNode.value} ._messages=${e} @arcgisClose=${()=>{this.removeEditingPopover(),setTimeout(()=>this.editMessageActionNode.value?.setFocus(),200)}}></arcgis-map-config-table-editing-popover>`),document.body.appendChild(this.editMessagePopoverNode))}handleFieldVisibilityClick(){if(this.fieldVisibilityPopoverNode)return;document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler);const e=this.activeTable.layer,{props:t,_messages:i,fieldSortOrder:a,activeTable:l}=this,o=this.activeTable.columns.filter(e=>"field"in e)??new m.default,n=Array.from(o.map(e=>e.fieldName)),r=!!(0,T.e)(e)&&l.attachmentsEnabled,c=l.relatedRecordsEnabled,d=(0,N.dN)(s.qy`<arcgis-map-config-table-field-selection .props=${{layer:e,view:t.view}} ._messages=${i} .fieldColumns=${o} .columnTemplates=${l.tableTemplate.columnTemplates} .fieldColumnOrder=${n} .sortBy=${a??"default"} .attachmentsEnabled=${r} .relationshipsEnabled=${c} .popoverReferenceElement=${this.fieldVisibilityActionNode.value} @arcgisFieldColumnTemplatesVisibilityChange=${e=>{e.stopPropagation(),e.detail.forEach(e=>this.activeTable.toggleColumnVisibility(e)),this.updateTable(this.activeTable.tableTemplate)}} @arcgisAttachmentColumnTemplateVisibilityChange=${e=>{e.stopPropagation();this.activeTable.columns.find(e=>"onShowAttachments"in e).hidden=!e.detail;const t=this.activeTable.tableTemplate?.columnTemplates.find(e=>"attachment"===e.type);t.visible=e.detail,this.updateTable(this.activeTable.tableTemplate)}} @arcgisRelationshipsColumnTemplateVisibilityChange=${e=>{e.stopPropagation(),this.activeTable.columns.filter(e=>"relationshipId"in e).forEach(t=>t.hidden=!e.detail),this.activeTable.tableTemplate?.columnTemplates.filter(e=>"relationship"===e.type)?.forEach(t=>t.visible=e.detail),this.updateTable(this.activeTable.tableTemplate)}} @arcgisSortByChange=${e=>{e.stopPropagation(),this.fieldSortOrder=e.detail}} @arcgisClose=${()=>{this.closePopovers(),setTimeout(()=>this.fieldVisibilityActionNode.value.setFocus(),200)}}></arcgis-map-config-table-field-selection>`);document.body.appendChild(d),this.fieldVisibilityPopoverNode=d,setTimeout(()=>document.addEventListener("click",this.fieldVisibilityPopoverClickHandler),200)}handleExpandClick(){const{scale:e}=this,t="s"===e?"m":"s";this.arcgisScaleChange.emit(t),this.scale=t,this.closePopovers()}handleCloseClick(){this.arcgisClose.emit()}handleCreateRecordClick(){const{table:e}=this;if(e.relatedTable){const t=e.relatedTable;t.editingEnabled=!1;const i=t.tableParent;if(t.relationshipConfig){const{objectId:e}=t.relationshipConfig,a=i.viewModel.store.getItemByObjectId(e);if(a?.feature){const{relatedLayer:e,relationshipId:i}=t.relationshipConfig,s=e.relationships?.find(e=>e.id===i),l=a.feature,o=t.layer.relationships?.find(e=>e.id===i),n=l.getAttribute(s.keyField);this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t,relationshipKeyField:o.keyField,relationshipKeyFieldValue:n})}else t.editingEnabled=!1,this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t})}else t.editingEnabled=!1,this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t})}else this.table.editingEnabled=!1,this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:this.table})}handleShowColumnInfo(e){this.columnInfoPopoverNode&&this.columnInfoPopoverNode.remove(),document.removeEventListener("click",this.columnInfoClickHandler);const{props:t,_messages:i}=this,a=this.activeTable.layer,l=(0,N.dN)(s.qy`<arcgis-map-config-table-column-info .props=${{view:t.view,layer:a}} ._messages=${i} .fieldName=${e} .popoverReferenceElement=${this.fieldVisibilityActionNode.value} @arcgisSetupComplete=${()=>this.syncMenuHandles()} @arcgisClose=${()=>{this.closePopovers(),setTimeout(()=>this.fieldVisibilityActionNode.value.setFocus(),200)}}></arcgis-map-config-table-column-info>`);document.body.appendChild(l),this.columnInfoPopoverNode=l,setTimeout(()=>document.addEventListener("click",this.columnInfoClickHandler),200)}displayReadOnlyErrorDialog(e){const{_messages:t}=this;this.readOnlyDialogNode||(this.readOnlyDialogNode=(0,N.dN)(s.qy`<calcite-dialog open modal outside-close-disabled escape-disabled .heading=${t.error}><div>${e?t.readOnlyErrorMessageEnterprise:t.readOnlyErrorMessage}</div>${!e&&s.qy`<div><calcite-link target=_blank href=https://status.arcgis.com>${t.healthDashboard}</calcite-link></div>`||""}<calcite-button slot=footer-end @click=${()=>{this.readOnlyDialogNode?.remove(),this.readOnlyDialogNode=void 0}}>${t.ok}</calcite-button></calcite-dialog>`),document.body.appendChild(this.readOnlyDialogNode))}handleCalculateField(e){const t=(0,N.dN)(s.qy`<arcgis-map-config-field-calculate .fieldName=${e} .layer=${this.activeTable.layer} .config=${this.config} @arcgisFieldCalculateClose=${()=>{t.remove(),this.activeTable.refresh(),this.arcgisInCellEdit.emit({layer:this.activeTable.layer})}}></arcgis-map-config-field-calculate>`);document.body.appendChild(t)}handleHideClick(e){this.activeTable.hideColumn(e),this.activeTable.tableTemplate?.columnTemplates.forEach(t=>{t.fieldName===e&&(t.visible=!1)}),this.updateTable(this.activeTable.tableTemplate)}async lockRasters(){const{selectedFeatureIds:e,layer:t,imagerySelection:i}=this;if(this.lockRaster)if(i&&e.length){const i=e.map(e=>"string"==typeof e?Number.parseInt(e):e),a=new c.default;a.method="lock-raster",a.lockRasterIds=i;const s=t.definitionExpression;s&&(a.where=s),t.mosaicRule=a,t.visible=!0}else t.visible=!1}async selectFeaturesFromIdentify(e){const{layer:t}=this,i=t,a=[];if("imagery"===i.type&&i.visible){const t=await n.identify(i.url,e);if(t?.catalogItems?.features&&t.catalogItemVisibilities)for(let e=0;e<t.catalogItems.features.length;e++)t.catalogItemVisibilities[e]>0&&a.push(t.catalogItems.features[e]);const s=a.map(e=>new f.default({attributes:e.attributes,geometry:e.geometry,sourceLayer:this.activeTable.layer,layer:this.activeTable.layer}));if(s.length){const e=s.map(e=>e.getObjectId());if(this.canUseSelectionManager()){const t=this.getSelectionManager(),i=this.activeTable.layer;t.setSelection(i,e)}else this.activeTable.highlightIds.addMany(e)}else if(this.canUseSelectionManager()){const e=this.getSelectionManager(),t=this.activeTable.layer;e.setSelection(t,[])}else this.activeTable.highlightIds.removeAll()}}updateTable(e){this.activeTable.tableTemplate=e,this.isStandardView()&&this.syncAttributeTableTemplate()}updateHighlightsAndSelection(){if(this.canUseSelectionManager()){const e=this.getSelectionManager(),t=this.activeTable.layer;e.setSelection(t,this.selectedFeatureIds)}else this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.addMany(this.selectedFeatureIds);if(this.activeTable.objectIds.length){const e=this.selectedFeatureIds.filter(e=>!this.activeTable.objectIds.includes(e));this.activeTable.objectIds.addMany(e)}}getMenuHandle(){return o.watch(()=>this.activeTable?.state,e=>{"loaded"===e&&(this.syncMenuHandles(),this.activeTable.columns.on("change",()=>this.syncMenuHandles()))})}syncMenuHandles(){this.activeTable.columns?.forEach(e=>{e?.menu&&(this.listenOn(e.menu,"calciteDropdownOpen",()=>{this.fabNode.value&&(this.fabNode.value.hidden=!0)}),this.listenOn(e.menu,"calciteDropdownClose",()=>{this.fabNode.value&&(this.fabNode.value.hidden=!1)}))})}getColumnSortOrderHandle(){return o.watch(()=>this.activeTable.activeSortOrders,async(e,t)=>{(e&&e.length>1||JSON.stringify(e)!==JSON.stringify(t))&&"loaded"===this.activeTable.state&&this.isStandardView()&&this.syncAttributeTableTemplate()})}getColumnReorderHandle(){const{activeTable:e}=this;return e.on("column-reorder",()=>{this.fieldVisibilityPopoverNode?.remove(),this.fieldVisibilityPopoverNode=void 0,document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler),this.isStandardView()&&this.syncAttributeTableTemplate()})}getAttachmentsViewOptionsHandle(){return o.watch(()=>this.activeTable.attachmentsViewOptions.objectId,e=>{this.fabNode.value&&(e&&!this.fabNode.value.classList.contains("table-hidden-fab")?this.fabNode.value.classList.add("table-hidden-fab"):!e&&this.fabNode.value.classList.contains("table-hidden-fab")&&this.fabNode.value.classList.remove("table-hidden-fab"))})}async syncAttributeTableTemplate(){const e=this.activeTable.layer;if(y.n.includes(e.type)){if(e.attributeTableTemplate){const t=e.attributeTableTemplate.clone();b.syncAttributeTableTemplate(this.activeTable,t);const i=this.table.activeSortOrders[0];t.orderByFields=i?[{field:i.fieldName,order:i.direction}]:[],JSON.stringify(t)!==JSON.stringify(e.attributeTableTemplate)&&(e.attributeTableTemplate=t)}this.syncColumnDirectionsWithOrderByFields(),this.arcgisChange.emit()}}isStandardView(){return!this.table.relatedTable&&!this.activeTable.attachmentsViewOptions.objectId}syncColumnDirectionsWithOrderByFields(){const e=this.activeTable.activeSortOrders[0]?.fieldName;this.activeTable.columns.forEach(t=>{"fieldName"in t&&t.fieldName!==e&&(t.direction=void 0)}),this.activeTable.tableTemplate?.columnTemplates.forEach(t=>{"fieldName"in t&&t.fieldName!==e&&(t.direction=void 0)})}handleFocus(){const{isWithinTabsManager:e}=this;e?this.fieldVisibilityActionNode.value?.setFocus():this.closeButtonNode.value?.setFocus()}clearFilter(){this.selectedOnlyMode=!1,this.selectedCount=0,this.selectedFeatureIds=[],this.activeTable.objectIds.removeAll()}closePopovers(){document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler),document.removeEventListener("click",this.columnInfoClickHandler),document.removeEventListener("click",this.editMessagePopoverClickHandler),this.fieldVisibilityPopoverNode&&(this.fieldVisibilityPopoverNode.remove(),this.fieldVisibilityPopoverNode=void 0),this.columnInfoPopoverNode&&(this.columnInfoPopoverNode.remove(),this.columnInfoPopoverNode=void 0),this.removeEditingPopover()}removeEditingPopover(){this.editMessagePopoverNode?.remove(),this.editMessagePopoverNode=void 0}removeAllHandles(){this.layerTitleHandle?.remove(),this.tableSizeHandle?.remove(),this.popupActiveHandle?.remove(),this.popupTemplateWatchHandle?.remove(),this.createFeatureHandle?.remove(),this.columnMenuHandle?.remove(),this.attachmentsViewOptionsHandle?.remove(),this.columnSortOrderHandle?.remove(),this.columnReorderHandle?.remove(),this.showAllTablesHandle?.remove(),this.relatedTablesHandle?.remove()}getSelectionManager(){const{view:e}=this;return e.selectionManager}canUseSelectionManager(){const{layer:e,useSelectionManager:t}=this;return!!t&&-1!==this.getSelectionManager().sources.indexOf(e)}render(){return this._propWatcherTask.render({complete:()=>{const{props:e,isWithinTabsManager:t}=this,{layer:i}=e;return i?s.qy`<div class="table-content">${this.renderActionBar()}<calcite-panel .heading=${t?void 0:i.title} @keydown=${e=>{this.dismissible&&"Escape"===e.key&&!e.defaultPrevented&&(this.handleCloseClick(),e.preventDefault())}} ${(0,k.K)(this.panelRefHandler)}>${this.renderHeaderActions()}${this.renderTable()}${this.renderCreateRecordFab()}</calcite-panel></div>`:""}})}renderActionBar(){const{selectedFeatureIds:e,imagerySelection:t,_messages:i,isWithinTabsManager:a}=this,l=this.isKnowledgeGraphSubTable();return s.qy`<div class=${(0,N.CP)(a?"":"non-tabs-manager-action-bar-wrapper")}><calcite-action-bar class="table-action-bar" @calciteActionBarToggle=${e=>this.isBarExpanded=e.target.expanded}><calcite-action-group overlay-positioning=fixed menu-placement=trailing-start>${!(this.activeTable?.layer??this.layer).isTable&&!l&&s.qy`<calcite-action icon=zoom-to-object .text=${i.zoomToSelection} .disabled=${!e?.length} @click=${()=>this.handleZoomToClick()} ${(0,k.K)(this.zoomToObjectRefHandler)}></calcite-action>`||""}<calcite-action icon=home .text=${i.home} .disabled=${!this.initialViewpoint} @click=${()=>this.handleHomeClick()} ${(0,k.K)(this.homeRefHandler)}></calcite-action><calcite-tooltip slot=menu-tooltip overlay-positioning=fixed><div class="table-tooltip-message">${i.more}</div></calcite-tooltip></calcite-action-group>${!t&&this.renderTableActions()||""}${t&&this.renderImageryTableActions()||""}<calcite-tooltip slot=expand-tooltip overlay-positioning=fixed><div class="table-tooltip-message">${i.expand}</div></calcite-tooltip></calcite-action-bar></div>`}renderTableActions(){const{selectedFeatureIds:e,selectedOnlyMode:t,_messages:i}=this,a=t||this.activeTable?.objectIds?.length;return s.qy`<calcite-action-group overlay-positioning=fixed menu-placement=trailing-start><calcite-action icon=erase .text=${i.clearSelection} .disabled=${!e?.length} @click=${()=>this.handleClearClick()} ${(0,k.K)(this.clearRefHandler)}></calcite-action><calcite-action icon=selected-items-filter .text=${i.showSelected} .disabled=${!!this.table?.relatedTable||!e?.length} @click=${()=>this.handleShowSelectedClick()} ${(0,k.K)(this.showSelectedRefHandler)}></calcite-action><calcite-action icon=list .text=${i.showAll} .disabled=${!a} @click=${()=>this.handleShowAllClick()} ${(0,k.K)(this.showAllRefHandler)}></calcite-action><calcite-action icon=refresh .text=${i.refresh} @click=${()=>this.handleRefreshClick()} ${(0,k.K)(this.refreshRefHandler)}></calcite-action><calcite-tooltip slot=menu-tooltip overlay-positioning=fixed><div class="table-tooltip-message">${i.more}</div></calcite-tooltip></calcite-action-group>`}renderImageryTableActions(){const{selectedFeatureIds:e,lockRaster:t,_messages:i}=this;return s.qy`<calcite-action-group overlay-positioning=fixed menu-placement=trailing-start><calcite-action icon=erase .text=${i.clearSelection} .disabled=${!e?.length} @click=${()=>this.handleClearClick()} ${(0,k.K)(this.eraseRefHandler)}></calcite-action><calcite-action icon=select-visible .text=${i.selectVisible} @click=${()=>this.handleSelectVisibleClick()} ${(0,k.K)(this.selectVisibleRefHandler)}></calcite-action><calcite-action .icon=${t?"unlock":"lock"} .text=${t?i.displayAll:i.displaySelected} @click=${()=>{t?this.handleDisplayAllClick():this.handleDisplaySelectedClick()}} ${(0,k.K)(this.displayAllRefHandler)}></calcite-action><calcite-tooltip slot=menu-tooltip overlay-positioning=fixed><div class="table-tooltip-message">${i.more}</div></calcite-tooltip></calcite-action-group>`}renderHeaderActions(){const{layer:e,_messages:t}=this,i="type"in e&&this.supportsEditing(e)&&!e.editingEnabled;return s.qy`<div slot=header-actions-end class="table-header-actions">${i&&s.qy`<calcite-action .text=${t.layerEditing} scale=s @click=${e=>{e.stopPropagation(),this.handleEditMessageActionClick()}} ${(0,k.K)(this.editMessageActionNode)}><calcite-icon scale=s icon=exclamation-mark-circle></calcite-icon></calcite-action>`||""}<calcite-action .text=${t.fieldVisibility} scale=s @click=${e=>{e.stopPropagation(),this.handleFieldVisibilityClick()}} @mouseover=${()=>this.addTableTooltip(this.fieldVisibilityActionNode.value,t.fieldVisibility)} @mouseout=${()=>this.removeTableTooltip()} @focus=${()=>this.addTableTooltip(this.fieldVisibilityActionNode.value,t.fieldVisibility)} @focusout=${()=>this.removeTableTooltip()} ${(0,k.K)(this.fieldVisibilityActionNode)}><calcite-icon scale=s icon=gear></calcite-icon></calcite-action>${this.renderExpandCollapseButton()}${this.renderCloseButton()}</div>`}renderExpandCollapseButton(){const{_messages:e,scale:t,isWithinTabsManager:i}=this;return i?"":"s"===t?s.qy`<calcite-action .text=${e.expand} scale=s @click=${()=>this.handleExpandClick()}><calcite-icon icon=chevrons-up></calcite-icon></calcite-action>`:s.qy`<calcite-action .text=${e.shrink} scale=s @click=${()=>this.handleExpandClick()}><calcite-icon icon=chevrons-down></calcite-icon></calcite-action>`}renderCloseButton(){const{_messages:e,isWithinTabsManager:t,dismissible:i}=this;return t||!i?"":s.qy`<calcite-action .text=${e.close} icon=x @click=${()=>this.handleCloseClick()} ${(0,k.K)(this.closeButtonNode)}></calcite-action>`}renderTable(){return s.qy`<div class="table-wrapper"><div ${(0,k.K)(this.afterCreateTableNode)}></div></div>`}renderCreateRecordFab(){const{_messages:e,allowAddRecord:t}=this,i=this.table?.relatedTable?this.table?.relatedTable.layer:this.layer;if(!t||!this.supportsEditing(i)||!this.supportsAdd(i)||i.portalItem&&(0,v.l)(i.portalItem)||this.table?.relatedTable&&!this.table.relatedTable.viewModel.store.canAddRelatedFeature)return"";const a=(0,T.g)(i);return i.isTable||a.length?s.qy`<calcite-fab scale=s class="table-create-record-fab" kind=neutral appearance=outline-fill text-enabled .text=${i.isTable?e.createRecord:e.createFeature} @click=${()=>{if(this.fabNode.value&&(this.fabNode.value.disabled=!0),this.canUseSelectionManager()){const e=this.getSelectionManager(),t=this.activeTable.layer;e.setSelection(t,[])}else this.activeTable.highlightIds.removeAll();this.handleCreateRecordClick()}} ${(0,k.K)(this.fabNode)}></calcite-fab>`:""}}(0,a.c)("arcgis-map-config-table",$)},36486:(e,t,i)=>{i.d(t,{u:()=>l});var a=i(83552),s=i(73679);const l=(0,a.yr)(s.g)},42855:(e,t,i)=>{i.d(t,{a:()=>o,f:()=>a,l:()=>s,s:()=>l});var a=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(a||{}),s=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(s||{}),l=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(l||{}),o=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(o||{})},45211:(e,t,i)=>{i.d(t,{a:()=>r,b:()=>h,c:()=>n,d:()=>p,e:()=>b,f:()=>m,g:()=>u,i:()=>c,l:()=>d,u:()=>l});var a=i(44345),s=i(65722);function l(e,t){return o(e,t)||function(e,t){const i=e.owner,a="admin"===e.itemControl,s=["esri_livingatlas","esri_demographics","esri_boundaries"];return!(e.portal?.isPortal&&!o(e,t)&&a&&i?.includes("esri_")&&!s.includes(i))&&a}(e,t)}function o(e,t){return e.owner===t.username}function n(e){return e.typeKeywords?.includes("Spatiotemporal")}function r(e){return e.typeKeywords?.includes("View Service")}function c(e){return e.typeKeywords?.includes("Hosted Service")}function d(e){return e.typeKeywords?.includes("Multi Services View")}function h(e){return e?.hasViews&&!e.sourceSchemaChangesAllowed}async function u(e){const t=e?.portalItem;if(!t)return await Promise.resolve(null);const i=t.portal;if(i?.user){const e=`${(0,s.g)(i)}community/users/${i.user.username}`;return await(0,a.default)(e,{query:{f:"json",token:t.portal.credential?.token},responseType:"json"}).then(e=>{const t=e.data?.groups??[];return Promise.resolve(t)},()=>Promise.reject(new Error("Failed to fetch user groups")))}return await Promise.resolve(null)}async function p(e){const t=e?.portalItem;if(!t)return await Promise.resolve(null);const i=t.portal,l=`${(0,s.g)(i)}content/items/${t.id}/groups`;return await(0,a.default)(l,{query:{f:"json",token:t.portal.credential?.token},responseType:"json"}).then(e=>{const t=[...e.data?.admin??[],...e.data?.member??[],...e.data?.other??[]];return Promise.resolve(t)},()=>Promise.reject(new Error("Failed to fetch item groups")))}async function m(e,t,{relationshipType:i,direction:l}){const o=`${(0,s.g)(t)}content/items/${e}/relatedItems`;return await(0,a.default)(o,{query:{f:"json",relationshipType:i,direction:l},responseType:"json"})}function b(e,t){return e?.some(e=>t?.some(t=>e.id===t.id&&e.capabilities.includes("updateitemcontrol")))}},47640:(e,t,i)=>{i.d(t,{YZ:()=>o,e1:()=>s});var a=i(4836);const s={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},l=Symbol();class o{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const a="object"==typeof t?t:{task:t,args:i};this.v=a.task,this.j=a.args,this.m=a.argsEqual??n,this.k=a.onComplete,this.A=a.onError,this.autoRun=a.autoRun??!0,"initialValue"in a&&(this.u=a.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const a=++this.p;this.q=new AbortController;let s=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){s=!0,i=e}if(this.p===a){if(t===l)this.i=0;else{if(!1===s){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const n=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,a.Ec)(e,t[i]))},65722:(e,t,i)=>{i.d(t,{a:()=>l,g:()=>o,o:()=>n});var a=i(44345);const s=e=>e&&!e.endsWith("/")?`${e}/`:e;function l(e){const{customBaseUrl:t,portalHostname:i,urlKey:a}=e,{protocol:s}=window.location;return`${s}//${a?`${a}.${t}`:i}`}function o(e){return s(e.restUrl)}async function n(e){if(!e?.user)return!1;const t=`${o(e)}portals/self/signinSettings`,i=await(0,a.default)(t,{query:{f:"json",async:!1},responseType:"json"});return!(i?.data&&!i.data.blockBetaApps)}},66228:(e,t,i)=>{i.d(t,{a:()=>g,b:()=>N,c:()=>O,d:()=>k,e:()=>R,f:()=>F,g:()=>f,h:()=>y,i:()=>m,j:()=>b,k:()=>w,l:()=>A,m:()=>I,n:()=>u,o:()=>C,p:()=>H,q:()=>$,r:()=>M,s:()=>T,t:()=>S,u:()=>v});var a=i(63438),s=i(18423),l=i(96086),o=i(91813),n=i(21255),r=i(13078),c=i(21303),d=i(12627),h=i(42855);const u=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],p=["feature"];function m(e){return null!=e}function b(e,t,i){const a=t.fieldName;if(a.includes(h.f.expression)){const e=i.get(a);return e?.title?e.title:a}return T(e)&&e.getFieldConfiguration(a)?e.getFieldAlias(a)||a:t.label||a}async function f(e){return new Map((await w(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function y(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${h.f.expression}${e.name}`;t.set(i,e)}),t}function g(e){return"map-image"===e?.layer?.type?h.s.mapImage:"subtype-sublayer"===e?.type?h.s.subtype:"tile"===e?.layer?.type?h.s.tile:"scene"===e?.type?h.s.scene:"ogc-feature"===e?.type?h.s.ogcFeature:"imagery"===e?.type?h.s.imagery:"imagery-tile"===e?.type?h.s.imageryTile:"wfs"===e?.type?h.s.wfs:"wcs"===e?.type?h.s.wcs:"wms"===e?.layer?.type?h.s.wms:"csv"===e?.type?h.s.csv:"geojson"===e?.type?h.s.geojson:"stream"===e?.type?h.s.stream:"oriented-imagery"===e?.type?h.s.orientedImagery:"catalog"===e?.type?h.s.catalog:"catalog-footprint"===e?.type?h.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?h.s.knowledgeGraphSublayer:"voxel"===e?.type?h.s.voxel:"parquet"===e?.type?h.s.parquet:h.s.feature}function v(e){const t=g(e);let i;return t===h.s.wms||t===h.s.mapImage?i=e?.layer.version:(t===h.s.imagery||t===h.s.feature||t===h.s.scene)&&(i=e.version),Number.parseFloat(i)}function T(e){return"fieldConfigurations"in e&&p.includes(e.type)}async function w(e){return await new Promise((t,i)=>{switch(g(e)){case h.s.feature:case h.s.ogcFeature:case h.s.stream:t(e.fields);break;case h.s.mapImage:{const a=e,s=a?.layer;s?.portalItem&&s.url.includes("https://demographics")&&s.url.includes(".arcgis.com")?s.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(a.fields.map(e=>[e.name,e])),s=e.thematicGroup.fieldNames,l=[];s.forEach(e=>{i.has(e)&&l.push(i.get(e))}),t(l)}else t(a.fields)}).catch(e=>{i(new Error(e))}):t(a.fields);break}case h.s.imagery:case h.s.imageryTile:case h.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function C(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function I(e){return Number((100*(1-e)).toFixed(1))}function S(e){return Number((1-e/100).toFixed(3))}const k=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(h.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},N=async(e,t)=>{const i=new d.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},R=async(e,t,i)=>{const a=await(await e.whenLayerView(t)).queryAggregates();return await E(i,a.features?.[0])},E=async(e,t)=>{let i;if(t)i=t.clone();else{i=new a.default;const t=k(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const l=new s.default;i.geometry=l}return i};function $(e,t){const i=t.startsWith("#"),a=t.startsWith(".");for((a||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(a){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function O(e){if(g(e)===h.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(g(e)===h.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function A(e,t,i){let a="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))a="number";else if(t.has(e)){const i=t.get(e);a=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);a=t.returnType?t.returnType.toLowerCase():""}else a="number";return a}async function F(e,t){try{const i=g(e);if(i===h.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await N(e,t)||await x(e,t)]};if(i===h.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await x(e,t)]};const a=i===h.s.ogcFeature||i===h.s.stream?await t.whenLayerView(e):e,s=a.createQuery();s.where=a.definitionExpression||"1=1",s.outFields=["*"],s.returnM="hasM"in e&&e.hasM,s.returnZ="hasZ"in e&&e.hasZ,s.outSpatialReference=t.spatialReference,s.returnGeometry=!0,(a.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===h.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=t.spatialReference;const l=await a.queryFeatures(s);return l?.features?.length||(l.features[0]=await x(e,t)),l}catch(e){console.error(e)}}async function x(e,t){return await new Promise(i=>{const s=new a.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),s.attributes=t}const c=t.extent;let d;"polygon"===e.geometryType?d=n.default.fromExtent(c):"point"===e.geometryType?d=c.center.clone():"multipoint"===e.geometryType?d=new l.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(d=new o.default({spatialReference:t.spatialReference.clone()}),d.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(d=r.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),s.geometry=d,i(s)})}function M(e){return g(e)===h.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function H(e){return g(e)===h.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},98629:(e,t,i)=>{i.d(t,{e:()=>o,g:()=>l,i:()=>s});const a=["feature","oriented-imagery","map-image","subtype-sublayer"];function s(e,t){for(;e;){if(e.nodeName===t.toUpperCase())return!0;e=e.parentElement}return!1}function l(e){return[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap(e=>e.templates):[]]}function o(e){return(a.includes(e.type)||"sublayer"===e.type&&a.includes(e.layer.type))&&function(e){if(!e?.capabilities)return!1;const{capabilities:{data:{supportsAttachment:t},operations:{supportsQueryAttachments:i}}}=e;return t&&i}(e)}}}]);