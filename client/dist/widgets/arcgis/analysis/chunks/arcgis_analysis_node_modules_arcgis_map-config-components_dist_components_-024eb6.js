/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-024eb6.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-024eb6"],{25554:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigPopupFieldPickList:()=>m});var s=i(73679),l=i(4395),a=i(46317),o=i(42855),n=i(85643),c=i(73801),d=i(66228),r=i(34132),p=(i(81565),i(34883));const h=l.AH`.popover{--calcite-popover-z-index: 100}.flow-item{min-height:300px}.content{max-height:calc(60vh - 142px)}.select-button-wrapper{padding:var(--calcite-spacing-sm)}.expression-actions{display:flex}.no-expressions-label{margin-top:var(--calcite-spacing-sm)}.footer{width:100%}.add-expression-button{margin:var(--calcite-spacing-sm) 0}`;class m extends c.WF{constructor(){super(...arguments),this.popoverNode=(0,n._)(),this.flowNode=(0,n._)(),this.listNode=(0,n._)(),this.arcadeExpMap=new Map,this.lastSortBy="default",this.selectedFields=[],this.showFilterLength=5,this.multiple=!1,this.numbersOnly=!1,this.hideCancel=!1,this.arcadeChangeNotification=(0,c.lh)(),this.arcgisChange=(0,c.lh)(),this.arcgisClose=(0,c.lh)()}static{this.properties={lastSortBy:16,filterFields:16,popoverProps:0,selectedFields:0,showFilterLength:9,multiple:5,numbersOnly:5,hideCancel:5,heading:1,okBtnText:1,popupState:0}}static{this.styles=h}async reposition(){this.popoverNode.value?.reposition()}async load(){const{popupState:e}=this,{layer:t,popupTemplate:i}=e;this.layerFieldsMap=await(0,d.g)(t),this.arcadeExpMap=(0,d.h)(i),this.fieldInfos=await this.getFieldInfos(),!this.multiple&&this.selectedFields.length>1&&(this.selectedFields=[this.selectedFields[0]])}willUpdate(){const{popupState:e}=this,{popupTemplate:t}=e;this.arcadeExpMap=(0,d.h)(t),this.fieldFieldInfosOnly=[...this.getSortedFieldList()].filter(e=>!e.name.includes(o.f.expression)),this.expressionFieldInfosOnly=[...this.getSortedFieldList()].filter(e=>e.name.includes(o.f.expression))}loaded(){this.flowItemNode?.setFocus()}flowItemRefHandler(e){e&&(this.flowItemNode=e)}async getFieldInfos(){const{popupState:e}=this,{popupTemplate:t,layer:i}=e,s=[];let l=await(0,d.k)(i);l=l.filter(e=>e.visible);const a=new Map(t.fieldInfos.map(e=>[e.fieldName,e]));if(l.forEach(e=>{if(a.has(e.name)){const t=a.get(e.name);s.push({name:t.fieldName,alias:(0,d.j)(i,t,this.arcadeExpMap),type:(0,d.l)(t.fieldName,this.layerFieldsMap,this.arcadeExpMap)}),a.delete(e.name)}}),a.forEach(e=>{s.push({name:e.fieldName,alias:(0,d.j)(i,e,this.arcadeExpMap),type:(0,d.l)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap)})}),this.numbersOnly){const e=new Set(this.selectedFields);return s.filter(t=>{const i=t.type.toLowerCase();return(e.has(t.name)||i===o.a.integer||i===o.a.smallInteger||i===o.a.bigInteger||i===o.a.single||i===o.a.double||i===o.a.long||i===o.a.number||i===o.a.oid)&&!t.name.includes(o.f.relationship)})}return s}getSortedFieldList(){const e=[...this.fieldInfos];return"display"===this.lastSortBy?e.sort((e,t)=>e.alias.localeCompare(t.alias)):"field"===this.lastSortBy?e.sort((e,t)=>e.name.localeCompare(t.name)):"type"===this.lastSortBy&&e.sort((e,t)=>e.type.localeCompare(t.type)),e}canDeselectAll(){return this.filterFields?.length?this.filterContainsAll():this.selectedFields.length===this.fieldInfos.length}filterContainsAll(){return this.filterFields.every(e=>this.selectedFields.some(t=>t===e))}async launchArcade(e){const{popupState:t}=this,{popupTemplate:i,layerDisplayType:s,_messages:a,serviceType:o,mapView:n,portal:d}=t,h=(0,p.g)(t);if(!this.arcadeEditorNode){this.flowItemNode.disabled=!0;const p=await(0,r.g)(h,n,o,i,s),m=await(0,r.a)(h,n,s,i),f=(0,r.b)(e?.expression,s,a),u=(0,r.c)(t,"popupElement");this.arcadeEditorNode=(0,c.dN)(l.qy`<arcgis-map-config-modal-arcade .arcadeProfile=${p} .testData=${m} .arcadeScript=${f} .suggestions=${u} add-existing-expressions .layer=${h} .portal=${d} .arcadeTitle=${e?.title||a.arcadeDefaultTitle} arcade-title-editable .arcadeTitleEditingEnabled=${!e?.title} return-predict-output-type @arcgisClose=${t=>{t.stopPropagation(),this.arcadeSetup(t.detail,e)}}></arcgis-map-config-modal-arcade>`),document.body.appendChild(this.arcadeEditorNode)}}async arcadeSetup(e,t){const{popupState:i}=this,{popupTemplate:s}=i;if(e){const l=(0,r.s)(e,t?.name,s);await(0,r.d)(i);const a=`${o.f.expression}${l.name}`;this.fieldInfos.push({name:a,alias:l.title,type:l.returnType}),this.fieldInfos=[...new Map(this.fieldInfos.map(e=>[e.name,e])).values()],this.multiple?this.selectedFields.push(a):this.selectedFields=[a],this.arcadeChangeNotification.emit(),this.arcgisChange.emit({selectedFields:[...new Set(this.selectedFields)]}),this.requestUpdate()}this.flowItemNode.disabled=!1,this.arcadeEditorNode?.remove(),this.arcadeEditorNode=void 0}render(){const{popupState:e}=this,{_messages:t,layerSupportsArcade:i}=e;return this.el.classList.add("js-app-flyout"),l.qy`<calcite-popover class="popover" .placement=${this.popoverProps.placement??"leading-start"} open pointer-disabled .referenceElement=${this.popoverProps.refElement} .offsetDistance=${this.popoverProps.offsetDistance??-Math.round(this.popoverProps.refElement.getBoundingClientRect().width)} .offsetSkidding=${this.popoverProps.offsetSkidding??50} .label=${this.heading} trigger-disabled ${(0,n.K)(this.popoverNode)}><calcite-flow style=${(0,c.zl)({width:`${this.popoverProps.popoverWidth??this.popoverProps.refElement.getBoundingClientRect().width}px`})} ${(0,n.K)(this.flowNode)}><calcite-flow-item class="flow-item" .heading=${this.heading} closable @calciteFlowItemClose=${()=>this.arcgisClose.emit()} ${(0,n.K)(this.flowItemRefHandler)}><calcite-list class="content" .label=${this.heading} .selectionMode=${this.multiple?"multiple":"single"} .filterEnabled=${this.fieldInfos.length>=this.showFilterLength} .filterPlaceholder=${t.searchFields} @calciteListFilter=${e=>{e.stopPropagation(),this.filterFields=this.listNode.value.filteredItems?.map(e=>e.value)}} @calciteListChange=${()=>{const e=this.listNode.value.selectedItems.map(e=>e.value),t=this.selectedFields.filter(t=>e.includes(t)),i=e.filter(e=>!this.selectedFields.includes(e));this.selectedFields=[...new Set([...t,...i])],this.arcgisChange.emit({selectedFields:this.selectedFields}),this.multiple||this.arcgisClose.emit({selectedFields:this.selectedFields})}} ${(0,n.K)(this.listNode)}>${this.multiple&&this.renderSelectDeselectButton()||""}${this.fieldInfos.length>=this.showFilterLength&&this.renderSort()||""}${i&&l.qy`<calcite-list-item-group .heading=${t.expressions}>${this.expressionFieldInfosOnly.length?this.expressionFieldInfosOnly.map(e=>this.renderExpressionsOnlyList(e)):l.qy`<calcite-label class="no-expressions-label" alignment=center>${t.noExpressions}</calcite-label>`}</calcite-list-item-group>`||""}<calcite-list-item-group .heading=${i?t.attributes:void 0}>${this.fieldFieldInfosOnly.map(e=>this.renderFieldsOnlyList(e))}</calcite-list-item-group></calcite-list><div class="footer" slot=footer>${i&&this.renderAddExpressionButton()||""}${this.multiple&&this.renderDoneButton()||""}${!this.hideCancel&&this.renderCancelButton()||""}</div></calcite-flow-item></calcite-flow></calcite-popover>`}renderSelectDeselectButton(){const{popupState:e}=this,{_messages:t}=e;return l.qy`<div class="select-button-wrapper"><calcite-button appearance=transparent width=full class="selection-button" @click=${()=>{this.canDeselectAll()?this.selectedFields=this.filterFields?.length?this.selectedFields.filter(e=>!this.filterFields.includes(e)):[]:this.selectedFields=this.filterFields?.length?[...new Set([...this.selectedFields,...this.filterFields])]:this.fieldInfos.map(e=>e.name),this.arcgisChange.emit({selectedFields:this.selectedFields})}}>${this.canDeselectAll()?t.deselectAll:t.selectAll}</calcite-button></div>`}renderSort(){const{popupState:e}=this,{_messages:t}=e;return l.qy`<calcite-dropdown slot=filter-actions-end placement=bottom-end overlay-positioning=fixed><calcite-action slot=trigger .text=${t.sort} title=${t.sort??c.s6}><calcite-icon scale=s icon=sortDescending flip-rtl></calcite-icon></calcite-action><calcite-dropdown-group><calcite-dropdown-item .selected=${"default"===this.lastSortBy} @click=${()=>this.lastSortBy="default"} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="default")}}>${t.default}</calcite-dropdown-item><calcite-dropdown-item .selected=${"display"===this.lastSortBy} @click=${()=>this.lastSortBy="display"} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="display")}}>${t.displayName}</calcite-dropdown-item><calcite-dropdown-item .selected=${"type"===this.lastSortBy} @click=${()=>this.lastSortBy="type"} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="type")}}>${t.type}</calcite-dropdown-item><calcite-dropdown-item .selected=${"field"===this.lastSortBy} @click=${()=>this.lastSortBy="field"} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="field")}}>${t.fieldName}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown>`}renderExpressionsOnlyList(e){const{popupState:t}=this,{_messages:i,popupTemplate:s}=t;return(0,a.D)(e.name,l.qy`<calcite-list-item .label=${e.alias||e.name} .value=${e.name} .description=${`{${e.name}}`} .selected=${!this.multiple&&e.name===this.selectedFields[0]||this.multiple&&this.selectedFields.includes(e.name)} .metadata=${{label:e.alias,fieldName:e.name}}><div class="expression-actions" slot=actions-end><calcite-action .disabled=${t.blockFeatureReductionArcade} .text=${i.edit} title=${i.edit??c.s6} scale=s .icon=${this.numbersOnly&&e.type.toLowerCase()!==o.a.number?"exclamation-mark-triangle":"pencil"} @click=${()=>{this.arcadeExpMap.has(e.name)&&this.launchArcade(this.arcadeExpMap.get(e.name))}}></calcite-action><calcite-action .text=${i.remove} title=${i.remove??c.s6} scale=s icon=trash @click=${async()=>{const i=s.expressionInfos.find(t=>`${o.f.expression}${t.name}`===e.name);i&&(s.expressionInfos.splice(s.expressionInfos.indexOf(i),1),s.content.filter(e=>"fields"===e.type).forEach(t=>{const i=t.fieldInfos.find(t=>t.fieldName===e.name);i&&t.fieldInfos.splice(t.fieldInfos.indexOf(i),1)}),s.content.filter(e=>"media"===e.type).forEach(t=>{t.mediaInfos.filter(e=>"image"!==e.type).forEach(t=>{const i=t.value.fields,s=t.value.normalizeField,l=i.find(t=>t===e.name);l&&i.splice(i.indexOf(l),1),s===e.name&&(t.value.normalizeField=null)})})),await(0,r.d)(t),this.fieldInfos=this.fieldInfos.filter(t=>t.name!==e.name),this.selectedFields=[...this.selectedFields].filter(t=>t!==e.name),this.multiple&&this.arcgisChange.emit({selectedFields:[...new Set(this.selectedFields)]}),this.arcadeChangeNotification.emit()}}></calcite-action></div></calcite-list-item>`)}renderFieldsOnlyList(e){const{popupState:t}=this,{_messages:i,layer:s,mapView:a,layerDisplayType:n}=t;return l.qy`<calcite-list-item .label=${e.alias||e.name} .value=${e.name} .description=${`{${e.name}}`} .selected=${!this.multiple&&e.name===this.selectedFields[0]||this.multiple&&this.selectedFields.includes(e.name)}>${n===o.l.feature&&!e.name.includes(o.f.relationship)&&l.qy`<calcite-action slot=actions-end .text=${i.info} title=${i.info??c.s6} scale=s icon=information @click=${t=>{t.stopPropagation();const i=t.currentTarget,o=(0,c.dN)(l.qy`<calcite-flow-item .heading=${e.alias??e.name} .description=${e.name} @calciteFlowItemBack=${()=>{o.remove(),this.flowItemNode.selected=!0,i.setFocus()}}><arcgis-field-info .fieldName=${e.name} .layer=${s} .view=${a} class="content"></arcgis-field-info></calcite-flow-item>`);this.flowNode.value.appendChild(o),o.selected=!0,this.flowItemNode.selected=!1,o.setFocus()}}></calcite-action>`||""}</calcite-list-item>`}renderAddExpressionButton(){const{popupState:e}=this,{_messages:t}=e;return l.qy`<calcite-button .disabled=${e.blockFeatureReductionArcade} appearance=transparent width=full icon-start=plus class="add-expression-button" @click=${()=>this.launchArcade()}>${t.addExpression}</calcite-button>`}renderDoneButton(){const{popupState:e}=this,{_messages:t}=e;return l.qy`<calcite-button .appearance=${this.hideCancel?"outline-fill":"solid"} .width=${this.hideCancel?"full":"half"} @click=${()=>this.arcgisClose.emit({selectedFields:[...new Set(this.selectedFields)]})}>${this.okBtnText??(this.multiple?t.done:t.ok)}</calcite-button>`}renderCancelButton(){const{popupState:e}=this,{_messages:t}=e;return l.qy`<calcite-button appearance=outline-fill .width=${this.multiple?"half":"full"} @click=${()=>this.arcgisClose.emit()}>${t.cancel}</calcite-button>`}}(0,s.c)("arcgis-map-config-popup-field-pick-list",m)},46317:(e,t,i)=>{i.d(t,{D:()=>o});var s=i(85282),l=i(34670),a=i(42466);const o=(0,l.u$)(class extends l.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,a.mY)(e),this.key=t),i}})}}]);