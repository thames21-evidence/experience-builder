/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-50d81e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-50d81e"],{3474:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigIps:()=>f});var s=i(73679),a=i(46317),n=i(36486),r=i(33752),o=i(44345),c=i(30423),l=i(92988),p=i(4265),h=i(4395),u=i(73801),g=i(47640),d=i(66228);const m=h.AH`.config-block{margin:20px 10px 10px 0}.config-option{display:flex;width:100%;justify-content:space-between;margin-top:10px;margin-bottom:10px}.item-browser{height:50vh}.path-snapping-options{display:flex;gap:10px;margin-bottom:20px}.unit-select,.distance-input{width:100%}.service-card{border:1px solid var(--calcite-color-border-3)}#smoothing-info,#gnss-info,#apple-ips-info,#path-snapping-info{--calcite-icon-color: var(--calcite-color-text-3)}`;class f extends u.WF{constructor(){super(...arguments),this.canUseItemBrowser=!1,this._messages=(0,n.u)({blocking:!0}),this._isLicensed=!1,this.handleDistanceInputChange=(0,p.d)(e=>{!Number.isNaN(Number.parseFloat(e.value))&&e.value?(Number.parseFloat(e.value)>e.max&&(e.value=`${e.max}`),Number.parseFloat(e.value)<e.min&&(e.value=`${e.min}`),this.ipsConfig={...this.ipsConfig,pathSnapping:{...this.ipsConfig.pathSnapping,distance:Number.parseFloat(e.value)}}):e.value=`${this.ipsConfig.pathSnapping.distance}`},300),this.#e={appleIPS:!0,gnss:!0,pathSnapping:{distance:5,enabled:!0,units:"meter"},smoothing:!0},this._propWatcherTask=new g.YZ(this,{task:async([e,t,i])=>{if(!((0,d.i)(e)&&(0,d.i)(t)&&(0,d.i)(i)))throw console.error("[arcgis-map-config-ips] Required properties are missing."),new Error("Required properties are missing.");await this.init()},args:()=>[this.map,this.portal,this.canUpdate]}),this.ipsConfig=this.#e,this.disabled=!1,this.arcgisError=(0,u.lh)(),this.arcgisUpdate=(0,u.lh)()}static{this.properties={portalItem:16,ipsConfig:16,map:0,portal:0,canUpdate:5,isLicensed:5,disabled:5}}static{this.styles=m}#e;load(){this.canUseItemBrowser=!!window.customElements?.get("arcgis-item-browser")}willUpdate(e){e.has("ipsConfig")&&(this.hasUpdated||this.ipsConfig!==this.#e)&&(this.map.ipsInfo=this.map.ipsInfo??{configuration:{}},this.map.ipsInfo.configuration={appleIPS:{enabled:this.ipsConfig.appleIPS},gnss:{enabled:this.ipsConfig.gnss},smoothing:{enabled:this.ipsConfig.smoothing},pathSnapping:{enabled:this.ipsConfig.pathSnapping.enabled,distance:this.ipsConfig.pathSnapping.distance,units:this.ipsConfig.pathSnapping.units}},this.arcgisUpdate.emit(this.map))}async checkLicense(){return(this.portal.user?await this.fetchUserLicenses():[]).includes("arcgisips")}async init(){this._isLicensed=this.isLicensed??await this.checkLicense(),this.portalItem=await this.getPositioningServiceItem();const e=this.map.ipsInfo;this.ipsConfig={...this.ipsConfig},e?.configuration&&(this.ipsConfig={appleIPS:e.configuration.appleIPS?.enabled??!0,gnss:e.configuration.gnss?.enabled??!0,smoothing:e.configuration.smoothing?.enabled??!0,pathSnapping:{enabled:e.configuration.pathSnapping?.enabled??!0,distance:e.configuration.pathSnapping?.distance??5,units:e.configuration.pathSnapping?.units??"meter"}})}async fetchUserLicenses(){const e=`${this.portal.restUrl}/community/self`;return await(0,o.default)(e,{query:{returnUserLicenseTypeExtensions:!0,f:"json"},responseType:"json",method:"auto"}).then(e=>e?.data?.userLicenseTypeExtensions||e?.data)}getItemLink(e){const t=e.portal?.restUrl??this.portal.restUrl;return t?`${t.replace("sharing/rest","home")}/item.html?id=${e.id}`:""}async getPositioningServiceItem(){try{const e=this.map.ipsInfo?.positioningService;return e?(await(e?.portalItem?.load()),e?.portalItem):null}catch(e){return this.arcgisError.emit(e),null}}handleAddService(){const e=(0,u.dN)(h.qy`<arcgis-map-config-ips-service-browser .portal=${this.portal} ._messages=${this._messages} @arcgisUpdate=${async e=>{const t=e.detail;if(t.length){const e=new r.default({id:t[0].id});await e.load(),this.portalItem=e,this.map.ipsInfo=new c.default({positioningService:new l.default({portalItem:this.portalItem})}),this.restoreDefaults(),this.arcgisUpdate.emit(this.map)}}} @arcgisClose=${()=>e.remove()}></arcgis-map-config-ips-service-browser>`);document.body.appendChild(e)}handleRemoveService(){this.portalItem=void 0,this.map.ipsInfo=void 0,this.arcgisUpdate.emit(this.map)}restoreDefaults(){this.ipsConfig={appleIPS:!0,gnss:!0,pathSnapping:{distance:5,enabled:!0,units:"meter"},smoothing:!0}}render(){return this._propWatcherTask.render({complete:()=>this._isLicensed?h.qy`<calcite-block .heading=${this._messages.indoorPositioningData} heading-level=2 collapsible .disabled=${this.disabled} .expanded=${!this.disabled}>${this.renderServiceCard()}${this.renderConfigOptions()}</calcite-block>`:(console.error("IPS license must be present to update configuration."),"")})}renderAddService(){return this.canUpdate&&this.canUseItemBrowser?h.qy`<calcite-button alignment=start width=full appearance=outline icon-start=plus @click=${()=>this.handleAddService()}>${this._messages.addService}</calcite-button>`:""}renderServiceCard(){if(this.portalItem){const e=this.getItemLink(this.portalItem),t="Indoor positioning data service",i=this.portalItem.title;return h.qy`<calcite-block class="service-card" .description=${t} .heading=${i||void 0}>${(0,a.D)("item-link",h.qy`<calcite-action slot=actions-end icon=launch .text=${this._messages.moreInfo} @click=${()=>window.open(e)} .hidden=${!e}></calcite-action>`)}${this.canUpdate&&this.canUseItemBrowser?(0,a.D)("item-remove",h.qy`<calcite-action slot=actions-end icon=x .text=${this._messages.remove} @click=${()=>this.handleRemoveService()} .hidden=${!e}></calcite-action>`):null}</calcite-block>`}return this.renderAddService()}renderConfigOptions(){return this.canUpdate&&this.portalItem?h.qy`<calcite-block expanded collapsible class="config-block" .heading=${this._messages.configuration}><div class="config-option"><calcite-label layout=inline>${this._messages.enableSmoothing}<calcite-icon id=smoothing-info scale=s icon=information></calcite-icon><calcite-tooltip reference-element=smoothing-info overlay-positioning=fixed>${this._messages.smoothingTooltip}</calcite-tooltip></calcite-label><calcite-switch .checked=${this.ipsConfig.smoothing} @calciteSwitchChange=${e=>{this.ipsConfig={...this.ipsConfig,smoothing:e.target.checked}}}></calcite-switch></div><div class="config-option"><calcite-label layout=inline>${this._messages.enableGNSS}<calcite-icon id=gnss-info scale=s icon=information></calcite-icon><calcite-tooltip reference-element=gnss-info overlay-positioning=fixed>${this._messages.gnssTooltip}</calcite-tooltip></calcite-label><calcite-switch .checked=${this.ipsConfig.gnss} @calciteSwitchChange=${e=>{this.ipsConfig={...this.ipsConfig,gnss:e.target.checked}}}></calcite-switch></div><div class="config-option"><calcite-label layout=inline>${this._messages.enableAppleIps}<calcite-icon id=apple-ips-info scale=s icon=information></calcite-icon><calcite-tooltip reference-element=apple-ips-info overlay-positioning=fixed>${this._messages.appleIPSTooltip}</calcite-tooltip></calcite-label><calcite-switch .checked=${this.ipsConfig.appleIPS} @calciteSwitchChange=${e=>{this.ipsConfig={...this.ipsConfig,appleIPS:e.target.checked}}}></calcite-switch></div><div class="config-option"><calcite-label layout=inline>${this._messages.enablePathSnapping}<calcite-icon id=path-snapping-info scale=s icon=information></calcite-icon><calcite-tooltip reference-element=path-snapping-info overlay-positioning=fixed>${this._messages.pathSnappingTooltip}</calcite-tooltip></calcite-label><calcite-switch .checked=${this.ipsConfig.pathSnapping.enabled} @calciteSwitchChange=${e=>{this.ipsConfig={...this.ipsConfig,pathSnapping:{...this.ipsConfig.pathSnapping,enabled:e.target.checked}}}}></calcite-switch></div>${this.ipsConfig.pathSnapping.enabled&&this.renderPathSnappingOptions()||""}<calcite-button appearance=outline @click=${()=>this.restoreDefaults()}>${this._messages.restoreDefaults}</calcite-button></calcite-block>`:""}renderPathSnappingOptions(){return h.qy`<calcite-label>${this._messages.distance}</calcite-label><div class="path-snapping-options"><calcite-input-number class="distance-input" .min=${"meter"===this.ipsConfig.pathSnapping.units?1:3.2} .max=${"meter"===this.ipsConfig.pathSnapping.units?10:32} step=0.1 .value=${`${this.ipsConfig.pathSnapping.distance}`} @calciteInputNumberInput=${e=>{e.stopPropagation(),this.handleDistanceInputChange(e.target)}}></calcite-input-number><calcite-select class="unit-select" label=units .value=${this.ipsConfig.pathSnapping.units} @calciteSelectChange=${e=>{const t=e.target.value;let i=this.ipsConfig.pathSnapping.distance;this.ipsConfig.pathSnapping.units!==t&&(i="feet"===t?Number.parseFloat((3.2*i).toFixed(1)):Number.parseFloat((i/3.2).toFixed(1))),this.ipsConfig={...this.ipsConfig,pathSnapping:{...this.ipsConfig.pathSnapping,units:t,distance:i}}}}><calcite-option .selected=${"meter"===this.ipsConfig.pathSnapping.units} value=meter>${this._messages.meters}</calcite-option><calcite-option .selected=${"feet"===this.ipsConfig.pathSnapping.units} value=feet>${this._messages.feet}</calcite-option></calcite-select></div>`}}(0,s.c)("arcgis-map-config-ips",f)},4265:(e,t,i)=>{i.d(t,{a:()=>a,d:()=>s,t:()=>n});const s=(e,t)=>{let i,s="idle";const a=async(...a)=>await new Promise(n=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),n(e(...a))):n(null);break;case"invoked":clearTimeout(i),s="idle",n(e(...a));break;case"cancelled":clearTimeout(i),s="idle",n(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout(()=>{s="idle",n(e(...a))},t)}});return a.flush=async function(...e){return s="flushed",await a(...e)},a.invoke=async function(...e){return s="invoked",await a(...e)},a.cancel=async function(...e){return s="cancelled",await a(...e)},a.getStatus=function(){return s},a},a=(e,t)=>{let i;return async(...s)=>await new Promise(a=>{i||(i=setTimeout(()=>{clearTimeout(i),i=void 0,a(e(...s))},t))})};function n(e){return new Promise(t=>setTimeout(t,e))}},36486:(e,t,i)=>{i.d(t,{u:()=>n});var s=i(83552),a=i(73679);const n=(0,s.yr)(a.g)},42855:(e,t,i)=>{i.d(t,{a:()=>r,f:()=>s,l:()=>a,s:()=>n});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),n=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(n||{}),r=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(r||{})},46317:(e,t,i)=>{i.d(t,{D:()=>r});var s=i(85282),a=i(34670),n=i(42466);const r=(0,a.u$)(class extends a.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,n.mY)(e),this.key=t),i}})},47640:(e,t,i)=>{i.d(t,{YZ:()=>r,e1:()=>a});var s=i(4836);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},n=Symbol();class r{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??o,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let a=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){a=!0,i=e}if(this.p===s){if(t===n)this.i=0;else{if(!1===a){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},66228:(e,t,i)=>{i.d(t,{a:()=>w,b:()=>k,c:()=>U,d:()=>$,e:()=>_,f:()=>q,g:()=>f,h:()=>y,i:()=>d,j:()=>m,k:()=>S,l:()=>N,m:()=>I,n:()=>u,o:()=>C,p:()=>L,q:()=>T,r:()=>F,s:()=>v,t:()=>x,u:()=>b});var s=i(63438),a=i(18423),n=i(96086),r=i(91813),o=i(21255),c=i(13078),l=i(21303),p=i(12627),h=i(42855);const u=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],g=["feature"];function d(e){return null!=e}function m(e,t,i){const s=t.fieldName;if(s.includes(h.f.expression)){const e=i.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function f(e){return new Map((await S(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function y(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${h.f.expression}${e.name}`;t.set(i,e)}),t}function w(e){return"map-image"===e?.layer?.type?h.s.mapImage:"subtype-sublayer"===e?.type?h.s.subtype:"tile"===e?.layer?.type?h.s.tile:"scene"===e?.type?h.s.scene:"ogc-feature"===e?.type?h.s.ogcFeature:"imagery"===e?.type?h.s.imagery:"imagery-tile"===e?.type?h.s.imageryTile:"wfs"===e?.type?h.s.wfs:"wcs"===e?.type?h.s.wcs:"wms"===e?.layer?.type?h.s.wms:"csv"===e?.type?h.s.csv:"geojson"===e?.type?h.s.geojson:"stream"===e?.type?h.s.stream:"oriented-imagery"===e?.type?h.s.orientedImagery:"catalog"===e?.type?h.s.catalog:"catalog-footprint"===e?.type?h.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?h.s.knowledgeGraphSublayer:"voxel"===e?.type?h.s.voxel:"parquet"===e?.type?h.s.parquet:h.s.feature}function b(e){const t=w(e);let i;return t===h.s.wms||t===h.s.mapImage?i=e?.layer.version:(t===h.s.imagery||t===h.s.feature||t===h.s.scene)&&(i=e.version),Number.parseFloat(i)}function v(e){return"fieldConfigurations"in e&&g.includes(e.type)}async function S(e){return await new Promise((t,i)=>{switch(w(e)){case h.s.feature:case h.s.ogcFeature:case h.s.stream:t(e.fields);break;case h.s.mapImage:{const s=e,a=s?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,n=[];a.forEach(e=>{i.has(e)&&n.push(i.get(e))}),t(n)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case h.s.imagery:case h.s.imageryTile:case h.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function C(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function I(e){return Number((100*(1-e)).toFixed(1))}function x(e){return Number((1-e/100).toFixed(3))}const $=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(h.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},k=async(e,t)=>{const i=new p.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await l.identify(e.layer.url,i))?.results?.[0]?.feature},_=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await P(i,s.features?.[0])},P=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=$(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const n=new a.default;i.geometry=n}return i};function T(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function U(e){if(w(e)===h.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===h.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function N(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function q(e,t){try{const i=w(e);if(i===h.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await k(e,t)||await E(e,t)]};if(i===h.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await E(e,t)]};const s=i===h.s.ogcFeature||i===h.s.stream?await t.whenLayerView(e):e,a=s.createQuery();a.where=s.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===h.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const n=await s.queryFeatures(a);return n?.features?.length||(n.features[0]=await E(e,t)),n}catch(e){console.error(e)}}async function E(e,t){return await new Promise(i=>{const a=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const l=t.extent;let p;"polygon"===e.geometryType?p=o.default.fromExtent(l):"point"===e.geometryType?p=l.center.clone():"multipoint"===e.geometryType?p=new n.default({points:[[l.center.x,l.center.y]],spatialReference:l.center.spatialReference.clone()}):"polyline"===e.geometryType?(p=new r.default({spatialReference:t.spatialReference.clone()}),p.addPath([[l.xmin,l.ymin],[l.xmax,l.ymax]])):"mesh"===e.geometryType&&(p=c.default.createBox(l.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=p,i(a)})}function F(e){return w(e)===h.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function L(e){return w(e)===h.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);