/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_classi-298b12.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_classi-298b12"],{931:(t,e,r)=>{r.d(e,{l:()=>i});var n=r(93814);const i=async(t,e)=>(await n.e.exports.loadModules(t,e)).map(t=>t.__esModule&&t.default?t.default:t)},4429:(t,e,r)=>{r.d(e,{a:()=>s,b:()=>d,c:()=>a,d:()=>u,e:()=>i,f:()=>n,g:()=>f,i:()=>v,m:()=>l,t:()=>o,u:()=>c});const n=(t,e)=>{let r,n="idle";const i=(...i)=>new Promise(a=>{switch(n){case"flushed":n="idle",r?(clearTimeout(r),a(t(...i))):a(null);break;case"invoked":clearTimeout(r),n="idle",a(t(...i));break;case"cancelled":clearTimeout(r),n="idle",a(null);break;default:r&&clearTimeout(r),n="pending",r=setTimeout(()=>(n="idle",a(t(...i))),e)}});return i.flush=function(...t){return n="flushed",i(...t)},i.invoke=function(...t){return n="invoked",i(...t)},i.cancel=function(...t){return n="cancelled",i(...t)},i.getStatus=function(){return n},i};function i(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function a(t){return null!=t}async function l(t,e){return await Promise.all([t,o(e)]),t}function o(t){return new Promise(e=>setTimeout(e,t))}const s=(t,e)=>Object.fromEntries((t||[]).map(t=>{const{key:r,data:n}=e(t);return[r,n]})),u=(t,e)=>t.length===e.length&&t.reduce((t,r)=>t&&e.indexOf(r)>-1,!0);function c(t,e){const r=[],n={};return t.forEach(t=>{const i=e(t);null==n[i]&&(n[i]=t,r.push(t))}),r}function d(t){const e={boolean:{},number:{},string:{}},r=[];return t.filter(t=>{let n=typeof t;return n in e?!e[n].hasOwnProperty(t)&&(e[n][t]=!0):!(r.indexOf(t)>=0)&&r.push(t)})}const f=(t,e)=>[...Array(Math.ceil(t.length/e))].map((r,n)=>t.slice(e*n,e+e*n)),v=(t,e)=>t.includes(e)},6591:(t,e,r)=>{r.d(e,{a:()=>h,b:()=>o,c:()=>C,d:()=>E,e:()=>w,f:()=>d,g:()=>m,h:()=>p,i:()=>_,j:()=>M,k:()=>T,l:()=>x,m:()=>j,n:()=>O,o:()=>P,p:()=>A,q:()=>I,r:()=>s,s:()=>c,t:()=>D,u:()=>S,v:()=>u,w:()=>y,x:()=>v,y:()=>J,z:()=>f});var n=r(59317),i=r(931),a=r(83692),l=r(37762);async function o(t){const e={};try{const r=await(0,a.r)(t);e.result=null==r?void 0:r.classification}catch(t){console.error(t),e.error=t}return e}async function s(t){const e={};try{const r=await(0,a.r)(t);e.result=r.classificationSchema}catch(t){console.error(t),e.error=t}return e}async function u(t){const e=`${n.c.config.restBaseUrl}portals/self/classification/validateClassification`,r={classificationValue:JSON.stringify(t)},i={};try{const t=await(0,a.r)(e,r,{},"post");i.result=t}catch(t){console.error(t),i.error=t}return i}async function c(t,e){const r={};try{const n={classification:JSON.stringify(e)},i=await(0,a.r)(t,n,{},"post");r.result=i}catch(t){console.error(t),r.error=t}return r}async function d(t,e){const r=Object.entries(null==t?void 0:t.attributes),n=[];for(let i in r){const a=r[i][0],l=r[i][1],o=null==l?void 0:l.attributeCategory;try{const r=await f(a,t,e);n.push({attributeId:a,attributeCategory:o,isEnabled:r})}catch(t){return console.error("error: ",t),t}}return n}async function f(t,e,r){var n;const i=null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n[t],a=null==i?void 0:i.isAttributeEnabled;if(!i)return!1;if(!a)return!0;const l={schemaJsonString:JSON.stringify(e),valueJsonString:JSON.stringify(r),attributeId:t};return(await g(a)).execute(l)}async function v(t,e,r){var n,i;const a=null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n[t],l=null==a?void 0:a.valueExpression,o=null==a?void 0:a.validValues,s=null==a?void 0:a.validValuesMap;if(!a)return null;if(null==o?void 0:o.length)return o;if(s&&(null===(i=Object.keys(s))||void 0===i?void 0:i.length))return s;if(!l)return null;const u={schemaJsonString:JSON.stringify(e),valueJsonString:JSON.stringify(r),attributeId:t};return(await g(l)).execute(u)}async function b(t,e,r,n=""){const i={schemaJsonString:e,valueJsonString:JSON.stringify(r),attributeId:n};return(await g(t)).execute(i)}async function g(t){const[e]=await(0,i.l)(["esri/arcade"]);return e.createArcadeExecutor(t,{variables:[{name:"schemaJsonString",type:"text"},{name:"valueJsonString",type:"text"},{name:"attributeId",type:"text"}]})}async function p(t,e,r,n){var i,a;let l=structuredClone(r.conflictsError);const o=n,s=null===(i=t.attributes[o])||void 0===i?void 0:i.attributeValidation,u=null===(a=t.attributes[o])||void 0===a?void 0:a.attributeCategory;if(s){const r=await b(s,t,e,o);if(r.length>0){const e=t.attributes[o].label;l.push({attributeId:o,attributeCategory:u,attributeLabel:e,errorMessage:r})}else l=l.filter(({attributeId:t})=>t!==n)}return l}async function h(t){const e={};try{const r=await(0,a.r)(t);e.result=r}catch(t){const r=t.details.raw.messageCode;e.error={code:r}}return e}async function y(t,e){const r={},n={key:"classification_favorites",text:JSON.stringify({favorites:e}),access:"UserPrivateAllApps"};try{const e=await(0,a.r)(t,n,{},"post");r.result=e.success}catch(t){console.error("error: ",t),r.error=t}return r}const m=async(t,e)=>{const r=null==t?void 0:t.bannerExpression;if((null==r?void 0:r.length)>0){return await b(r,JSON.stringify(t),e)}return k("bannerOrder","bannerLabel",t,e)},w=async(t,e)=>{e=await x(t,e);const r=null==t?void 0:t.bannerExpression;return(null==r?void 0:r.length)>0?await b(r,JSON.stringify(t),e):k("selectionDisplayOrder","selectionDisplayLabel",t,e)},E=(t,e,r)=>{let n=C(t,e,r);return n=O(r,n),n},S=t=>{const e=new Date,{type:r,defaultDateTimeline:n,defaultDateTimelineUnits:i}=t;if("date"===r&&n&&i)switch(i.toLowerCase()){case"years":e.setFullYear(e.getFullYear()+n);break;case"months":e.setMonth(e.getMonth()+n);break;case"days":e.setDate(e.getDate()+n)}const a=(e.getMonth()+1).toString(),l=e.getDate().toString();return`${e.getFullYear()}-${1===a.length?`0${a}`:a}-${1===l.length?`0${l}`:l}`},C=(t,e,r)=>{const n=r.classificationMetadata.defaultValue;let i=structuredClone(t);return i||(i={[e]:n}),(null==i?void 0:i[e])||(i[e]=n),i},O=(t,e)=>{const r=structuredClone(e);return Object.entries(t.attributes).forEach(([t,e])=>{if(t in r)return;const{uiElement:n}=e;if("date"===n)return void(r[t]=S(e));const{defaultValue:i}=e;i&&(["multi-select","multi-grouped-select-nested"].includes(n)?r[t]=[i]:"checkbox"===n?r[t]="true"===i:["single-select","text"].includes(n)&&(r[t]=i))}),r},x=async(t,e)=>{const r=structuredClone(e),n=Object.entries(t.attributes);for(let i in n){const a=n[i][0];await f(a,t,e)||delete r[a]}return r},k=(t,e,r,n)=>{const i=Object.entries(r.attributes).sort(([e,r],[n,i])=>{var a,l;const o=null!==(a=r[t])&&void 0!==a?a:0,s=null!==(l=i[t])&&void 0!==l?l:0;return o<s?-1:o>s?1:e.localeCompare(n)}),a=[],l=[];i.forEach(([r,i])=>{var o,s,u,c,d;const f=null==n?void 0:n[r];if(f&&i[t]&&"false"!==f){const t=null!==(o=i.uiElement)&&void 0!==o?o:"",r=null!==(s=i[e])&&void 0!==s?s:"",n=null!==(u=i.labelDelimiter)&&void 0!==u?u:"",v=null!==(c=i.valueDelimiter)&&void 0!==c?c:"";a.push($({elementType:t,selectionDisplayLabel:r,labelDelimiter:n,classificationProp:f,valueDelimiter:v})),l.push(null!==(d=i.attributeDelimiter)&&void 0!==d?d:"")}});return a.reduce((t,e,r)=>`${t}${l[r]}${e}`)},$=({elementType:t,selectionDisplayLabel:e,labelDelimiter:r,classificationProp:n,valueDelimiter:i})=>{let a="";if(t.includes("multi")&&n)for(let t=0;t<n.length;t++)a+=n[t],t!==n.length-1&&(a+=i);else a=n;return e+r+a},j=(t,e,r)=>{const{createdUser:n,createdDate:i}=e;return e=Object.assign(Object.assign({[r]:t},n?{createdUser:n}:{}),i?{createdDate:i}:{})},D=(t,e)=>{const r=e.requiredError.find(e=>e.attributeId===t),n=e.conflictsError.find(e=>e.attributeId===t),i=((t,e)=>(null==t?void 0:t.errorMessage)||(null==e?void 0:e.errorMessage)||null)(r,n);return{invalid:!!r||!!n,errorMsg:i}},I=(t,e)=>{let r="";const{requiredError:n,conflictsError:i}=e,a=n.map(({attributeLabel:t})=>t);if(1===a.length)r=t.singleAttributeError.replace("${startBoldText}","<b>").replace("${endBoldText}","</b>").replace("${attributeName}",a[0]);else if(a.length>1){const e=a.slice(0,-1).reduce((t,e)=>`${t}, ${e}`);r=t.multipleAttributeErrors.replace("${startBoldText}","<b>").replace("${endBoldText}","</b>").replace("${attributeString}",e).replace("${lastAttributeName}",a[a.length-1])}return 0!==i.length&&(r+=` ${i.map(({attributeLabel:t,errorMessage:e})=>`${t} - ${e}`).join(",")} `),r},M=({isEnableAttribute:t,i18n:e,itemClassificationSchema:r,itemClassificationValue:n,classificationErrors:i,activeAttributeId:a})=>{let l=structuredClone(i.requiredError);if(!a)return l;if(A(a,t,r,n)){if(!l.some(({attributeId:t})=>t===a)){const t=r.attributes[a].label,n=r.attributes[a].attributeCategory;l.push({attributeId:a,attributeLabel:t,attributeCategory:n,errorMessage:e.fieldSelectionError})}}else l=l.filter(({attributeId:t})=>t!==a);return l},T=(t,e,r,n,i)=>{const a=[];return Object.entries(r.attributes).forEach(([i])=>{if(A(i,t,r,n)){const t=r.attributes[i].label,n=r.attributes[i].attributeCategory;a.push({attributeId:i,attributeLabel:t,attributeCategory:n,errorMessage:e.fieldSelectionError})}}),i.requiredError=a,0===a.length},A=(t,e,r,n)=>{const i=r.attributes[t],a=!!(null==i?void 0:i.isRequired),l=!!(null==n?void 0:n[t]),o=null==e?void 0:e.find(({attributeId:e})=>e===t);return(null==o?void 0:o.isEnabled)&&a&&!l},J=(t,e)=>{const{requiredError:r,conflictsError:n}=e,i=r.some(({attributeCategory:e,errorMessage:r})=>e===t&&!!r),a=n.some(({attributeCategory:e,errorMessage:r})=>e===t&&!!r);return i||a},P=(0,l.c)({itemClassificationSchema:null,favoriteClassifications:[],itemClassificationValue:null,itemClassificationValueWithDefaults:null,isEnableAttribute:null,activeAttributeId:"",classificationErrors:{requiredError:[],conflictsError:[]},currSelectionText:"",selectedFavoriteClassificationName:""}),_=P.state},54251:(t,e,r)=>{r.d(e,{g:()=>i});var n=r(59317);function i(t){var e,r,i,a;return null!=t||(t=null===n.c||void 0===n.c?void 0:n.c.portal),(null===(e=null==t?void 0:t.credential)||void 0===e?void 0:e.token)||(null==t?void 0:t.token)||(null===(i=null===(r=null==t?void 0:t.user)||void 0===r?void 0:r.credential)||void 0===i?void 0:i.token)||(null===(a=null==t?void 0:t.portalUser)||void 0===a?void 0:a.token)||""}},83692:(t,e,r)=>{r.d(e,{a:()=>g,b:()=>b,c:()=>v,f:()=>d,g:()=>m,i:()=>f,p:()=>y,r:()=>p});var n=r(59317),i=r(4429),a=r(931),l=r(41473),o=r(54251);const s={},u={},c={};async function d(t,e,r,n){var i,a,l,o;const d=null===(a=null===(i=c[e])||void 0===i?void 0:i[r])||void 0===a?void 0:a.expireAt,f=!!d&&(new Date).getTime()>d;if((null===(l=s[e])||void 0===l?void 0:l[r])&&!f)return s[e][r];u[e]||(u[e]={}),u[e][r]&&!f||(u[e][r]=t());const v=await u[e][r];if(s[e]||(s[e]={}),c[e]||(c[e]={}),s[e][r]=v,n){const{expireAfter:t,getExpireAfterFromResult:i}=n,a=i||t?(new Date).getTime()+(null!==(o=null==i?void 0:i(v))&&void 0!==o?o:t):null;c[e][r]=Object.assign(Object.assign({},c[e][r]),{expireAt:a})}return v}function f(t,e){var r;return null===(r=null==s?void 0:s[t])||void 0===r?void 0:r[e]}const v=(t,e)=>{var r,n;e?(null===(r=s[t])||void 0===r||delete r[e],null===(n=u[t])||void 0===n||delete n[e]):(delete s[t],delete u[t])};function b(t){var e,r;return null!==(e=null==t?void 0:t.id)&&void 0!==e?e:null===(r=null==t?void 0:t.sourceJSON)||void 0===r?void 0:r.id}async function g(t,e,r={},n){const[i]=await(0,a.l)(["esri/request"]);t.includes("f=")||e.append("f","json");const l=(0,o.g)();return l&&!e.has("token")&&e.append("token",l),new Promise((a,l)=>{i(t,Object.assign(Object.assign({body:e},r),{timeout:r.timeout||0,method:n||"auto"})).then(t=>{a(t.data)}).catch(t=>l(t))})}async function p(t,e={},r={},i,l){const[o]=await(0,a.l)(["esri/request"]),{api:s,portal:u}=n.c,{customToken:c,addTokenManually:d,addSSL:f,useProxy:v}=r,b=Object.assign({},e);if(t.includes("f=")||!0===(null==l?void 0:l.excludeJson)||(b.f="json"),c)b.token=c;else if(!1!==d){const t=await m(u);t&&(b.token=t)}const g=!1===f?t:function(t){var e;const{config:r}=n.c;return"https:"===window.location.protocol||!0===(null===(e=null==r?void 0:r.self)||void 0===e?void 0:e.allSSL)?t.replace("http:","https:"):t}(t);if(3===s){const t=Object.assign({url:g,content:b,timeout:r.timeout||0},null==l?void 0:l.v3Request);r.withCredentials&&(t.withCredentials=r.withCredentials);return o(t,"post"===i?Object.assign({usePost:!0},r):r)}{const t=Object.assign(Object.assign(Object.assign({query:b,method:i||"auto"},r),{timeout:r.timeout||0,useProxy:v}),(null==r?void 0:r.disableIdentityLookup)?{authMode:"anonymous"}:{});return(await o(g,t)).data}}const h=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,15,15,30,30,30,30,30,30,30,30,30,30,120];const y=async(t,e,r)=>{var n,a;const l=null!==(n=null==e?void 0:e.pendingStatuses)&&void 0!==n?n:["processing","partial","Pending","InProgress","EXECUTING"],o=null!==(a=null==e?void 0:e.successStatuses)&&void 0!==a?a:["completed","Completed","COMPLETED"];let s=0;const u=async()=>{const n=await p(t,null==e?void 0:e.requestParams,{},r),a=n.status||n.jobStatus;if(l.includes(a))return await(0,i.t)((c=s++,1e3*h[c>-1&&c<h.length-1?c:h.length-1])),u();if(o.includes(a)||"failed"===a||"esriJobFailed"===a)return n;throw n;var c};try{return u()}catch(t){throw console.error(t),t}},m=async t=>{var e;if(!(null==t?void 0:t.isPortal)||!(0,l.i)(t))return(0,o.g)(t);if(!(null==t?void 0:t.user)&&!(null==t?void 0:t.portalUser)&&(0,l.i)(t))return;const{token:r}=await d(()=>w(t),"platformSelf",null!==(e=b(t.user))&&void 0!==e?e:t.id,{getExpireAfterFromResult:t=>t.expires_in});return r},w=async t=>{const e=await(async t=>{var e,r;const[n]=await(0,a.l)(["esri/identity/IdentityManager"]);return null!==(r=null===(e=(await d(()=>n.getCredential((0,l.g)(t),{oAuthPopupConfirmation:!1}),"credential",b(t.user))).oAuthState)||void 0===e?void 0:e.appId)&&void 0!==r?r:"arcgisonline"})(t),r={"X-Esri-Auth-Client-Id":e,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")};return p(`${(0,l.g)(t)}/oauth2/platformSelf`,{},{disableIdentityLookup:!0,headers:r,addTokenManually:!1,withCredentials:!0},"post",{v3Request:{headers:r}})}}}]);