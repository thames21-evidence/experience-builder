/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-fcad4b.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-fcad4b"],{29528:(e,t,s)=>{s.r(t),s.d(t,{ArcgisMapConfigPopupExpressions:()=>d});var i=s(73679),a=s(4395),o=s(42855),c=s(85643),n=s(73801),p=s(34132),l=(s(81565),s(63438),s(18423),s(96086),s(91813),s(21255),s(13078),s(21303),s(12627),s(34883));const r=a.AH`:host{height:100%}`;class d extends n.WF{constructor(){super(...arguments),this.filterLength=5,this.calciteListItems=[],this.panelNode=(0,c._)(),this.fabNode=(0,c._)(),this.arcadeChangeNotification=(0,n.lh)(),this.arcgisChange=(0,n.lh)()}static{this.properties={popupState:0}}static{this.styles=r}async setFocus(){this.panelNode.value?.setFocus()}willUpdate(){const{popupState:e}=this,{popupTemplate:t}=e;this.calciteListItems=[],t.expressionInfos?.length&&t.expressionInfos.forEach(e=>this.calciteListItems.push(this.getCalciteListItem(e)))}getCalciteListItem(e){const{popupState:t}=this,{_messages:s}=t;return a.qy`<calcite-list-item .disabled=${t.blockFeatureReductionArcade} .label=${e.title} .description=${`{${o.f.expression}${e.name}}`} .value=${e.name} @click=${t=>{t.stopPropagation(),this.launchArcade(e)}}><calcite-action slot=actions-end appearance=transparent .text=${s.remove} @click=${t=>{t.stopPropagation(),this.handleRemoveArcadeExpression(e.name)}}><calcite-icon scale=s icon=x></calcite-icon></calcite-action></calcite-list-item>`}async launchArcade(e){const{popupState:t}=this,{mapView:s,portal:i,layerDisplayType:o,_messages:c,serviceType:r,popupTemplate:d}=t,h=(0,l.g)(t);if(!this.arcadeEditorNode){this.panelNode.value.disabled=!0;const l=await(0,p.g)(h,s,r,d,o),u=await(0,p.a)(h,s,o,d);this.arcadeEditorNode=(0,n.dN)(a.qy`<arcgis-map-config-modal-arcade .arcadeProfile=${l} .testData=${u} .arcadeScript=${(0,p.b)(e?.expression,o,c)} .suggestions=${(0,p.c)(t,"attributeExpression")} add-existing-expressions .layer=${h} .portal=${i} .arcadeTitle=${e?.title||c.arcadeDefaultTitle} arcade-title-editable .arcadeTitleEditingEnabled=${!e?.title} return-predict-output-type @arcgisClose=${t=>{t.stopPropagation(),this.arcadeSetup(t.detail,e),setTimeout(()=>{this.fabNode.value?.setFocus()},300)}}></arcgis-map-config-modal-arcade>`),document.body.appendChild(this.arcadeEditorNode)}}async arcadeSetup(e,t){const{popupState:s}=this,{popupTemplate:i}=s;e&&((0,p.s)(e,t?.name,i),await this.setUpPopupExpressionDisplay()),this.panelNode.value.disabled=!1,this.arcadeEditorNode?.remove(),this.arcadeEditorNode=void 0}async setUpPopupExpressionDisplay(){const{popupState:e}=this;await(0,p.d)(e),this.arcadeChangeNotification.emit(),this.requestUpdate(),this.arcgisChange.emit()}handleRemoveArcadeExpression(e){const{popupState:t}=this,{popupTemplate:s}=t,i=s.expressionInfos.find(t=>t.name===e);i&&(s.expressionInfos.splice(s.expressionInfos.indexOf(i),1),s.content.filter(e=>"fields"===e.type).forEach(t=>{const s=t.fieldInfos.find(t=>t.fieldName===`${o.f.expression}${e}`);s&&t.fieldInfos.splice(t.fieldInfos.indexOf(s),1)}),s.content.filter(e=>"media"===e.type).forEach(t=>{t.mediaInfos.filter(e=>"image"!==e.type).forEach(t=>{const s=t.value.fields,i=t.value.normalizeField,a=s.find(t=>t===`${o.f.expression}${e}`);a&&s.splice(s.indexOf(a),1),i===`${o.f.expression}${e}`&&(t.value.normalizeField=null)})})),this.setUpPopupExpressionDisplay()}render(){const{popupState:e,filterLength:t}=this,{_messages:s,popupTemplate:i}=e;return this.el.classList.add("calcite-match-height"),a.qy`<calcite-panel ${(0,c.K)(this.panelNode)}>${i.expressionInfos?.length?a.qy`<calcite-list .label=${s.manageExpressions} .filterEnabled=${this.calciteListItems.length>=t}>${this.calciteListItems}</calcite-list>`:null}${this.renderAddExpression()}</calcite-panel>`}renderAddExpression(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<calcite-fab .disabled=${e.blockFeatureReductionArcade} slot=fab class="fab" icon=plus scale=s appearance=outline-fill kind=neutral .label=${t.addExpression} .text=${t.addExpression} text-enabled @click=${e=>{e.stopPropagation(),this.launchArcade()}} ${(0,c.K)(this.fabNode)}></calcite-fab>`}}(0,i.c)("arcgis-map-config-popup-expressions",d)}}]);