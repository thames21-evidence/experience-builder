/*! For license information please see arcgis_analysis_node_modules_arcgis_lumina_dist_proxyExports-D906T-c1f876.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_lumina_dist_proxyExports-D906T-c1f876"],{6316:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigFieldCalculateTable:()=>p});var r=a(73679),s=a(4395),n=a(85643),i=a(28275),l=(a(34031),a(63438),a(5933),a(55616)),o=(a(44345),a(55448),a(59290),a(66228)),c=a(27155),u=a(73801),d=a(90836),m=a(54312);const f=s.AH`:host{height:100%}.cell-with-icon{display:flex;align-items:center;column-gap:10px}.warning-icon{--calcite-icon-color: var(--calcite-color-status-warning)}.success-icon{--calcite-icon-color: var(--calcite-color-status-success)}`;class p extends u.WF{constructor(){super(...arguments),this.mode="preview",this.numVisibleRows=0,this.objectIds=[],this.testButtons={},this.arcgisRecordCountUpdate=(0,u.lh)()}static{this.styles=f}async calculateValues(){const{features:e}=i.f;Object.keys(e).forEach(t=>{e[t].calculatedValue=void 0,e[t].error=void 0,e[t].passed=!1,i.f.autoPreviewEnabled&&this.calculateCellValues(e[t].feature)}),this.table?.refreshCellContent(),(0,l.u)()}async enableGeometry(){this.table&&!this.table.returnGeometryEnabled&&(this.table.returnGeometryEnabled=!0,this.table.returnMEnabled=!0,this.table.returnZEnabled=!0,this.table.refresh())}async getLayer(){return this.layer}async getMode(){return this.mode}async noRowsVisible(){return 0===this.numVisibleRows}async refresh(e){e?this.table?.refreshCellContent():await(this.table?.refresh()),this.populateTestFeaturesFromTable()}async resetTableTemplates(){if(this.table)if("preview"===this.mode){const e=this.getPreviewValuesTemplates();this.table.tableTemplate={columnTemplates:e}}else{const e=this.getTestFeaturesTemplates();this.table.tableTemplate={columnTemplates:e}}}async setMode(e){this.mode!==e&&(this.mode=e,this.resetTableTemplates())}async updateTableFilter(e,t=!1){const{whereClause:a}=i.f,r=this.getCombinedWhere(e,a);this.objectIds=await this.queryForObjectIds(r),this.numVisibleRows=this.objectIds?.length||0,this.layer.definitionExpression=e,!t&&this.table&&(this.table.objectIds.removeAll(),this.table.maxSize=this.objectIds.length,this.objectIds.length&&this.table.objectIds.addMany(this.objectIds),this.populateTestFeaturesFromTable())}async load(){const{layer:e,whereClause:t}=i.f;this.layer=e.clone(),this.layer.definitionExpression=null,await this.layer.load(),this.objectIds=await this.queryForObjectIds(t),this.numVisibleRows=this.objectIds.length}loaded(){(0,c.i)(this.el.shadowRoot)}getTestFeaturesTemplates(){const{originalField:e}=i.f,t=[];this.layer.fields.forEach(a=>{a.name!==e.name&&t.push({type:"field",fieldName:a.name,label:a.alias})});const a=this.getOriginalFieldColumnTemplate();return a&&t.push(a),t}getCombinedWhere(e,t){return e&&t?`(${e}) AND (${t})`:e||t}getPreviewValuesTemplates(){const{layer:e,originalField:t,_messages:a}=i.f;if(!t)return;const r=[];r.push({type:"field",fieldName:e.objectIdField,label:e.fields.find(t=>t.name===e.objectIdField)?.alias});const n=this.getOriginalFieldColumnTemplate();return n&&r.push(n),r.push({type:"column",label:a.calculated,fieldName:`${t?.name}Calculated`,sortable:!1,invalid:!1,textWrap:!0,formatFunction:({feature:e})=>{const{arcadeExecutor:t,autoPreviewEnabled:r,features:n,invalidScript:o,sqlEngine:c}=i.f,d=e.attributes[this.layer.objectIdField];if(t||c){if(o&&r)return"";if((0,i.v)(n[d].calculatedValue))return n[d].error&&!(0,i.i)(n[d].calculatedValue)?n[d].calculatedValue:this.getCellDisplayValue(n[d].calculatedValue);if(n[d].error)return"";if(r||!t&&!c){const t=(0,l.a)(e);return n[d].error?t:this.getCellDisplayValue(t)}if(!this.testButtons[d]){const r=(0,u.dN)(s.qy`<calcite-button appearance=transparent icon-end=play @click=${async()=>{r.loading=!0,t?.isAsync?await(0,l.c)(e):(0,l.a)(e),this.table?.refreshCellContent()}}>${a.testCalculation}</calcite-button>`);this.testButtons[d]=r}return this.testButtons[d].loading=!1,this.testButtons[d]}return""}}),r.push(this.getErrorsTemplate()),r}getErrorsTemplate(){const{originalField:e,_messages:t}=i.f;return{type:"column",label:t.errors,fieldName:`${e?.name}Errors`,sortable:!1,textWrap:!0,formatFunction:({feature:e})=>{const{features:a,invalidScript:r}=i.f,n=e.attributes[this.layer.objectIdField],l=(0,o.i)(a[n].error);return(0,i.v)(a[n].calculatedValue)||l||r?(0,u.dN)(s.qy`<div class="cell-with-icon"><calcite-icon scale=s .icon=${l||r?"exclamation-mark-triangle-f":"check-circle"} class=${(0,u.CP)(l||r?"warning-icon":"success-icon")}></calcite-icon><div>${l?a[n].error??"":r?t.popupError:t.noErrors}</div></div>`):null}}}getOriginalFieldColumnTemplate(){const{originalField:e,_messages:t}=i.f;if(e)return{type:"column",label:"features"===this.mode?e.alias:t.original,fieldName:e.name,frozenToEnd:"features"===this.mode,sortable:!1,textWrap:!0,invalid:"features"===this.mode,formatFunction:({feature:t})=>{const a=t.attributes[e.name];if((0,i.v)(a))return this.getCellDisplayValue(a)}}}async queryForObjectIds(e){const{numRecords:t}=i.f,a=this.layer.createQuery();a.returnGeometry=!1,a.num=t,a.where=e;try{const e=await this.layer.queryObjectIds(a);return this.arcgisRecordCountUpdate.emit(e.length),e}catch{return this.arcgisRecordCountUpdate.emit(0),[]}}calculateCellValues(e){const{arcadeExecutor:t,features:a,sqlEngine:r}=i.f;if(t||r){const r=e.attributes[this.layer.objectIdField];if(!(0,i.v)(a[r].calculatedValue)){if(t?.isAsync)return;(0,l.a)(e)}}}getCellDisplayValue(e){if(e=(0,l.g)(e),[/^\s*(https?:\/\/([^\s]+))\s*$/iu,/^\s*(tel:([^\s]+))\s*$/iu,/^\s*(mailto:([^\s]+))\s*$/iu,/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/iu,/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/iu,/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/iu,/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/iu,/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/iu,/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/iu,/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/iu,/^\s*(iform:\/\/([^\s]+))\s*$/iu,/^\s*(flow:\/\/([^\s]+))\s*$/iu,/^\s*(lfmobile:\/\/([^\s]+))\s*$/iu,/^\s*(mspbi:\/\/([^\s]+))\s*$/iu].find(t=>t.test(e))){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t}if(/<\/?[a-z][\s\S]*>/iu.test(e)){const t=document.createElement("span");return t.textContent=e,t}return e}populateTestFeaturesFromTable(){const{features:e}=i.f;(this.table.viewModel.store.pageCache.get(0)||[]).forEach(t=>{const a=t.feature,r=t.objectId;e[r]||(e[r]={}),e[r].feature=a}),Object.keys(e).forEach(t=>{e[t].tableFeature=this.table.objectIds.includes(Number.parseInt(t))})}setTableContainer(e){if(!e)return;let t=[];switch(this.mode){case"features":t=this.getTestFeaturesTemplates();break;case"preview":t=this.getPreviewValuesTemplates()??[]}this.table=new d.default({layer:this.layer,tableTemplate:{columnTemplates:t},objectIds:this.objectIds,visibleElements:{columnMenus:!1,header:!1,menu:!1,selectionColumn:!1,columnDescriptions:!1},container:e,maxSize:this.objectIds.length}),m.watch(()=>this.table.viewModel.store.pageCache.size,e=>{e>0&&(this.populateTestFeaturesFromTable(),this.calculateValues())})}render(){const{layer:e,originalField:t}=i.f;return e&&t?s.qy`<div ${(0,n.K)(this.setTableContainer)}></div>`:""}}(0,r.c)("arcgis-map-config-field-calculate-table",p)},27155:(e,t,a)=>{a.d(t,{i:()=>s});var r=a(12762);function s(e){if(!e)return;let t=r.default.assetsPath;t.endsWith("/")||(t+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${t}esri/themes/light/main.css" />`)}},45820:(e,t,a)=>{a.d(t,{a:()=>d,g:()=>l,q:()=>c});var r=a(28275),s=a(34031),n=a(63438),i=a(5933);async function l(e){const{isTable:t,layer:a,mapView:s}=r.f;if(!a||!("fields"in a))return await Promise.reject(new Error("getOneFeature: wrong layer type"));if(t)return await o(e);{const t=await s.whenLayerView(a),r="hasM"in a&&a.hasM,n="hasZ"in a&&a.hasZ,i=t.availableFields.length===a.fields.length&&!r&&!n;if("createQuery"in a&&i){const r=a.createQuery();r.start=0,r.num=5,r.outFields=["*"],r.returnGeometry=!0,r.outSpatialReference=a.spatialReference;const s=await t.queryFeatures(r);return s.features?.length?await Promise.resolve(s):await o(e)}return await o(e)}}async function o(e){const{layer:t}=r.f;if(!t||!("queryFeatures"in t))return u();try{return await c(e)||u()}catch{return}}async function c(e){const{layer:t}=r.f,a=new s.default({outFields:["*"],where:e||"1=1",outSpatialReference:t.spatialReference,returnGeometry:!0,returnM:"hasM"in t&&t.hasM,returnZ:"hasZ"in t&&t.hasZ});return t.sourceJSON?.advancedQueryCapabilities?.supportsPagination&&(a.num=1),await t.queryFeatures(a)}function u(){const{layer:e}=r.f,t={};e?.fields&&e.fields.forEach(e=>{e.defaultValue?t[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].includes(e.type)?t[e.name]=0:"date-only"===e.type?t[e.name]=null:t[e.name]=""});const a=new n.default({geometry:void 0,symbol:void 0,attributes:t});return new i.default({features:[a],fields:[],geometryType:e.geometryType,spatialReference:e?.spatialReference.clone()})}async function d(e="1=1"){const{layer:t}=r.f,a=new s.default({where:e});try{return await t.queryFeatureCount(a)}catch{return 0}}},55616:(e,t,a)=>{a.d(t,{a:()=>p,c:()=>h,g:()=>u,p:()=>y,u:()=>g});var r=a(28275),s=a(52797),n=a(45820),i=a(98186),l=a(73679),o=a(31526);function c(e,t){return null!=e?d(e,t,{...s.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:"system"}):null}function u(e,t=r.f.originalField){if(!t)return;if(null===e)return e;const{domain:a}=t,s=["date-only","time-only","timestamp-offset"];if(t.domain){const r=function(e,t){if(!t)return null;if("range"===t.type)return e;if("coded-value"===t.type){const a=t.codedValues.filter(t=>t.hasOwnProperty("code")&&t.code===e);return a?.length?a[0].name:e}return null}(e,t.domain);return"date"===t.type&&"range"===a?.type?c(r,t):f(t)&&"range"===a?.type?m(e,t):s.includes(t.type)&&"range"===a?.type?d(r,t):r}return"date"===t.type||s.includes(t.type)||["esri.arcade.arcadedate","esri.core.sql.timeonly","esri.core.sql.dateonly"].includes(e.declaredRootClass)||e.isLuxonDateTime||e._timeStampOffset?c(e,t):f(t)?m(e,t):e}function d(e,t,a){const{selectedLanguage:n}=r.f;return"Arcade"===n?function(e,t,a){switch(t.type){case"date":return["esri.arcade.arcadedate","esri.core.sql.dateonly"].includes(e.declaredRootClass)?s.formatDate(e.toJSDate(),{...s.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:"system"}):s.formatDate(e,a);case"date-only":return"esri.core.sql.dateonly"===e.declaredRootClass?s.formatDateOnly(e.toStorageFormat(),a):s.formatDateOnly(e,a);case"time-only":return"esri.core.sql.timeonly"===e.declaredRootClass?s.formatTimeOnly(e.toStorageString(),a):"esri.core.sql.dateonly"===e.declaredRootClass?s.formatDateOnly(e.toJSDate(),a):"esri.arcade.arcadedate"===e.declaredRootClass?e.toString():s.formatTimeOnly(e,a);case"timestamp-offset":return"esri.arcade.arcadedate"===e.declaredRootClass?s.formatTimestamp(e.toISOString(),{...s.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:"system"}):"esri.core.sql.timeonly"===e.declaredRootClass?e.toStorageString():s.formatTimestamp(e,a);default:return"toStorageString"in e?e.toStorageString():e.toString()||null}}(e,t,a):function(e,t){const{currentScript:a}=r.f;let n={...s.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:"system"},i=e;if("esri.core.sql.timeonly"===e.declaredRootClass&&"time-only"!==t.type)if(a?.includes("CURRENT_TIME")){const{day:t,month:a,year:r}=function(e=!0){const t=new Date;return{day:e?t.getDate():t.getUTCDate(),month:(e?t.getMonth():t.getUTCMonth())+1,year:e?t.getFullYear():t.getUTCFullYear()}}();i=e.toUTCDateTime().set({day:t,month:a,year:r})}else i=e.toUTCDateTime().set({year:1900});else"esri.core.sql.dateonly"===e.declaredRootClass?(i=e.toUTCDateTime(),["time-only","string"].includes(t.type)||(i=i.toLocal())):i=e._timeStampOffset?e.toDateTime():(e.isLuxonDateTime||t.type,e);switch(t.type){case"date":return i.isLuxonDateTime&&(i=i.ts),s.formatDate(i,n);case"date-only":return i.isLuxonDateTime&&(i=i.toString()),s.formatDateOnly(i,n);case"time-only":return i.isLuxonDateTime?i.toFormat("h:mm a"):s.formatTimeOnly(i,n);case"timestamp-offset":return s.formatTimestamp(i,n);case"string":return n={...s.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:"UTC"},"esri.core.sql.dateonly"===e.declaredRootClass?i.isLuxonDateTime?a?.includes("CURRENT_DATE")?i.toFormat("LLL d yyyy h:mm a"):i.toFormat("yyyy-LL-dd HH:mm:ss"):s.formatDateOnly(e.toString(),n):"esri.core.sql.timeonly"===e.declaredRootClass?i.isLuxonDateTime?e.toFormat("HH:mm:ss"):e.toStorageString():e._timeStampOffset?e.toSQLValue():e.isLuxonDateTime?e.toFormat("yyyy-LL-dd HH:mm:ss"):s.formatDate(i,n);default:return null}}(e,t)}function m(e,t){return["single","double","long"].includes(t.type)?s.formatNumber(parseFloat(e),s.convertNumberFormatToIntlOptions({digitSeparator:!1,places:2})):["integer","small-integer","big-integer"].includes(t.type)?s.formatNumber(parseFloat(e),s.convertNumberFormatToIntlOptions({digitSeparator:!1,places:0})):void 0}function f(e){return["integer","small-integer","big-integer","single","double"].includes(e.type)}function p(e){const{features:t,layer:a,selectedLanguage:s,_messages:n}=r.f,l=e.attributes[a.objectIdField];try{if("Arcade"===s)return function(e,t){const{arcadeExecutor:a,features:s,layer:n}=r.f;try{let l=a.execute({$feature:e,$datastore:n.url},{spatialReference:n.spatialReference,rawOutput:!0});const o=(0,r.b)(l);return/<\/?[a-z][\s\S]*>/iu.test(l)&&(l=(0,i.s)(l)),s[t].calculatedValue=l,s[t].passed=o.isFieldValid,o.isFieldValid?s[t].error=void 0:s[t].error=o.errorMessage,l}catch(e){throw e}}(e,l);if("SQL"===s)return function(e,t){const{features:a,sqlEngine:s}=r.f;try{let n=s.calculateValue(e);const l=(0,r.b)(n);return/<\/?[a-z][\s\S]*>/iu.test(n)&&(n=(0,i.s)(n)),a[t].calculatedValue=n,a[t].passed=l.isFieldValid,l.isFieldValid?a[t].error=void 0:a[t].error=l.errorMessage,n}catch(e){throw e}}(e,l)}catch{t[l].calculatedValue=null,t[l].error=n.calculationErrorGeneral,t[l].passed=!1}}async function h(e){const{arcadeExecutor:t,features:a,layer:s,_messages:n}=r.f,l=e.attributes[s.objectIdField];try{let n=await t.executeAsync({$feature:e,$datastore:s.url},{spatialReference:s.spatialReference,rawOutput:!0});const o=(0,r.b)(n);return/<\/?[a-z][\s\S]*>/iu.test(n)&&(n=(0,i.s)(n)),a[l].calculatedValue=n,a[l].passed=o.isFieldValid,o.isFieldValid?a[l].error=void 0:a[l].error=o.errorMessage,n}catch{a[l].calculatedValue=null,a[l].error=n.calculationErrorGeneral,a[l].passed=!1}}async function y(e){const{arcadeExecutor:t,features:a,invalidScript:s,layer:i,sqlEngine:o}=r.f,c=(e.attributes||e.graphic.attributes)[i.objectIdField];if(!a[c]){const e=await(0,n.q)(`${i.objectIdField} = ${c}`);a[c]={feature:e.features[0],tableFeature:!1,calculatedValue:void 0,passed:!1}}return(t||o)&&!(0,r.v)(a[c].calculatedValue)&&!a[c].error&&(t?.isAsync?await h(a[c].feature):await p(a[c].feature)),s?function(){const{_messages:e}=r.f,t=document.createElement("div");return t.style.textAlign="center",t.innerHTML=`<img class="popup-icon" src=${(0,l.g)("./assets/map-config-field-calculate/map-config-field-calculate-icons/alert-48.svg")}></img>\n  <calcite-label>${e.popupError}</calcite-label>`,t}():(0,r.v)(a[c].calculatedValue)||a[c].error?function(e){const{arcadeExecutor:t,features:a,layer:s,originalField:n,_messages:i,sqlEngine:l}=r.f,o={};Object.keys(e).forEach(t=>{o[t.toLowerCase()]=e[t]});const c=document.createElement("div"),d=e[s.objectIdField];if(a[d].error){const e=document.createElement("calcite-label");e.layout="inline";const t=document.createElement("calcite-icon");t.classList.add("popup-error-icon"),t.icon="exclamation-mark-triangle",e.append(t),e.append(a[d].error),c.append(e)}const m=(0,r.v)(a[d].calculatedValue)&&!a[d].error||(0,r.i)(a[d].calculatedValue)?u(a[d].calculatedValue):a[d].calculatedValue,f=document.createElement("calcite-table");f.caption=m;const p=document.createElement("calcite-table-row"),h=document.createElement("calcite-table-header");h.heading=n?.alias??"",p.appendChild(h),f.appendChild(p);const y=document.createElement("calcite-table-row"),g=document.createElement("calcite-table-cell");g.innerHTML=m,y.appendChild(g),f.appendChild(y),c.appendChild(f),c.appendChild(document.createElement("br"));const b=[];if((t?t.fieldsUsed:l?l.fieldNames:[]).forEach(e=>{if(!Object.keys(o).includes(e.toLowerCase()))return;const t=document.createElement("calcite-table-row"),a=document.createElement("calcite-table-cell");a.innerHTML=e;const r=document.createElement("calcite-table-cell");r.innerHTML=u(o[e.toLowerCase()],s.fields.find(t=>t.name.toLowerCase()===e.toLowerCase())),t.append(a,r),b.push(t)}),b.length){const e=document.createElement("calcite-label");e.innerHTML=i.fieldsInCalculation;const t=document.createElement("calcite-table");t.bordered=!0,t.append(...b),e.append(t),c.append(e)}return c}(a[c].feature.attributes):function(){const{_messages:e}=r.f,t=document.createElement("div");return t.style.textAlign="center",t.innerHTML=`<img class="popup-icon" src=${(0,l.g)("./assets/map-config-field-calculate/map-config-field-calculate-icons/edit-48.svg")}></img>\n  <calcite-label>${e.popupPreview}</calcite-label>`,t}()}function g(){const{layer:e,mapView:t}=r.f;t?.popup?.visible&&e&&(e.popupTemplate=new o.default({title:e.displayField?`{${e.displayField}}`:`{${e.objectIdField}}`,content:y,lastEditInfoEnabled:!1}))}},93461:(e,t,a)=>{a.d(t,{p:()=>n});var r=a(4713),s=a(44319);const n=e=>(...t)=>{const a=(0,r.d)(),n=new e(...t),l=n.exports;(0,r.b)(a.at(-1));const o=n.component.manager;o.W(n,l),n.watchExports(o.W.bind(o,n)),(0,r.j)(n);const c=[n.component,...a].reverse();return(0,s.t)(c,e=>void 0===e?void 0:i(n,e,l),l)},i=(e,{host:t,key:a,isReactive:s},n)=>{const i=t,l=i[a]!==e.exports,o=i[a]!==n,c=n!==e.exports;l&&!o&&c&&(i[a]=e.exports);if(t===e.component){if(s){const t=e.component.manager;o&&t.W(e,i[a]),e.onUpdate(r=>{if(r.has(a)){const r=i[a];r!==e.exports&&t.W(e,r)}})}e.O=s?void 0:a}const u=e.component.constructor.elementProperties.get(a)?.readOnly;e.watchExports(()=>{i[a]!==e.exports&&(u?(0,r.f)(()=>{i[a]=e.exports}):i[a]=e.exports)})}},98186:(e,t,a)=>{a.d(t,{d:()=>n,i:()=>s,s:()=>i});var r=a(59290);function s(e,t){if(e?.tagName===t)return!0;{let a=e?.parentElement;for(;a;){if(a.tagName===t)return!0;a=a.parentElement}}return!1}function n(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}function i(e){return(new r.S).sanitize(e)}}}]);