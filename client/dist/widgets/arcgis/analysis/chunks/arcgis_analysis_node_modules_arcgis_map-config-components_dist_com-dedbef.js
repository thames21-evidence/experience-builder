/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-dedbef.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-dedbef"],{27155:(e,t,s)=>{s.d(t,{i:()=>a});var i=s(12762);function a(e){if(!e)return;let t=i.default.assetsPath;t.endsWith("/")||(t+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${t}esri/themes/light/main.css" />`)}},36486:(e,t,s)=>{s.d(t,{u:()=>r});var i=s(83552),a=s(73679);const r=(0,i.yr)(a.g)},39655:(e,t,s)=>{function i(e){return e?.sourceJSON?.id}s.d(t,{g:()=>i})},42855:(e,t,s)=>{s.d(t,{a:()=>n,f:()=>i,l:()=>a,s:()=>r});var i=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(i||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),r=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(r||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},47640:(e,t,s)=>{s.d(t,{YZ:()=>n,e1:()=>a});var i=s(4836);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,s){this.p=0,this.i=0,(this._=e).addController(this);const i="object"==typeof t?t:{task:t,args:s};this.v=i.task,this.j=i.args,this.m=i.argsEqual??o,this.k=i.onComplete,this.A=i.onError,this.autoRun=i.autoRun??!0,"initialValue"in i&&(this.u=i.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,s;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const i=++this.p;this.q=new AbortController;let a=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){a=!0,s=e}if(this.p===i){if(t===r)this.i=0;else{if(!1===a){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(s)}catch{}this.i=3,this.h?.(s)}this.u=t,this.l=s}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,s)=>!(0,i.Ec)(e,t[s]))},50867:(e,t,s)=>{s.r(t),s.d(t,{ArcgisMapConfigPrint:()=>T});var i=s(73679),a=s(4395),r=s(85643),n=s(31646),o=s(5294),l=s(54312),c=s(33752),p=s(44345),u=s(96197),d=s(66228),m=s(55535),h=s(39655),g=s(36486),f=s(65722),y=s(27155),w=s(47640),b=s(73801);const v=["tiff","gif","jpg","pdf","png"],I=a.AH`:host{height:100%;width:100%}.flow{height:100%}`,x="arcgis-app-print-custom-templates-storage-infos",k="arcgis-app-print-export-links-storage-infos";class T extends b.WF{constructor(){super(...arguments),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new w.YZ(this,{task:async([e,t])=>{if(!(0,d.i)(e)||!(0,d.i)(t))throw console.error("[arcgis-map-config-print] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.mapView,this.portal]}),this._messages=(0,g.u)({blocking:!0}),this.templateOptions={legendEnabled:!0},this.showPrintAreaEnabled=!1,this.showHeading=!1,this.closable=!1,this.arcgisClose=(0,b.lh)(),this.arcgisSaveItem=(0,b.lh)()}static{this.properties={mapView:0,portal:0,templateOptions:0,showPrintAreaEnabled:5,showHeading:5,closable:5}}static{this.styles=I}async processNewItem(e,t){const{portal:s,printWidget:i}=this,a=(0,h.g)(s.user),r=new c.default({id:e});await r.load();i.exportedLinks.find(e=>e.url===t).portalItem=r;const n=(0,m.g)(k,!0)||{},o=n[a]?.find(e=>e.url===t);o&&(o.portalItemId=r.id,(0,m.s)(k,n))}async setShowPrintAreaEnabled(e){this.printWidget.showPrintAreaEnabled=e}async updateTemplateOptions(e){this.printWidget.templateOptions=e}updated(){this._propWatcherTask.status===w.e1.COMPLETE&&this._initialized&&!this._loaded&&(this._loaded=!0,(0,y.i)(this.el.shadowRoot))}disconnectedCallback(){super.disconnectedCallback(),this.printWidget?.destroy()}async init(){this.blockBetaApps=await this.orgBlocksBetaApps(),this._initialized=!0}divRefHandler(e){this.afterCreateDiv(e)}async afterCreateDiv(e){if(this.printWidget)return;const t=window.customElements?.get("arcgis-item-browser"),s=window.customElements?.get("arcgis-new-item"),{mapView:i,portal:r,templateOptions:n,showPrintAreaEnabled:o,blockBetaApps:p}=this,d=await this.getEligibleExportLinks(),g=(0,h.g)(r.user),f=new u.default({view:i,portal:r,templateOptions:n,showPrintAreaEnabled:o,container:e,headerVisible:!1,includeOrganizationTemplates:r.isPortal||!p,exportedLinks:d,saveExportHidden:!0,allowedFormatsForSaving:v});this.printWidget=f,g&&s&&!r.sourceJSON?.isReadOnly&&(f.saveAsButtonCallback=e=>this.arcgisSaveItem.emit(e));const y=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]);t&&r.user&&!p&&(r.isPortal||y.has(r.user.sourceJSON.userLicenseTypeId))&&(f.viewModel.when(()=>this.populateCustomTemplates()),f.browseTemplateButtonOnClick=e=>{const t=e.target;t.disabled=!0;const s=(0,b.dN)(a.qy`<arcgis-map-config-print-browse-templates .portal=${r} ._messages=${this._messages} @arcgisClose=${e=>{e.detail?.length&&e.detail.forEach(e=>{const t=new c.default({id:e.id,title:e.title,portal:r});f.viewModel.addPortalTemplate(t)}),s.remove(),t.disabled=!1}}></arcgis-map-config-print-browse-templates>`);document.body.appendChild(s)}),l.watch(()=>f.viewModel.browseTemplates?.items?.length,()=>{const e=(0,h.g)(r.user),t=f.viewModel.browseTemplates.items.map(e=>({itemId:e.layoutItem.id,title:e.layoutItem.title})),s=(0,m.g)(x,!0)||{};t.length?s[e]=t:delete s[e],(0,m.s)(x,s)}),f.on("submit",async()=>await this.checkPortalItemValidity()),f.on("complete",async e=>{const t=e.link.url;await this.updateLocalStorageExportLinks({filterByTime:!0,completedExportUrl:t})}),l.watch(()=>f.exportedLinks.items?.length,async(e,t)=>{e<t&&await this.updateLocalStorageExportLinks({filterByTime:!1})})}populateCustomTemplates(){const{portal:e,printWidget:t}=this,s=(0,h.g)(e.user);((0,m.g)(x,!0)||{})[s]?.forEach(async s=>{try{const i=new c.default({id:s.itemId,title:s.title,portal:e});await i.load(),t.viewModel.addPortalTemplate(i)}catch{}})}async getEligibleExportLinks(){const{portal:e}=this,t=(0,h.g)(e.user);if(!t)return new n.default;const s=(0,m.g)(k,!0)||{},i=s[t];if(!i?.length)return new n.default;const a=i.filter(e=>!this.isTooOld(e));return await Promise.all(a.map(async e=>{if(e.portalItemId)try{await new c.default({id:e.portalItemId}).load()}catch{e.portalItem=void 0,e.portalItemId=void 0}})),a.length?s[t]=a:delete s[t],(0,m.s)(k,s),await this.getExportLinkCollectionWithPortalItems(a)}async updateLocalStorageExportLinks(e){const{portal:t,printWidget:s}=this,i=(0,h.g)(t.user);if(!i)return;const a=(0,m.g)(k,!0)||{},r=s.exportedLinks.map(t=>{const s=a[i]?.find(e=>e.url===t.url);return s||(t.url===e?.completedExportUrl?{count:t.count,error:t.error,extension:t.extension,name:t.name,portalItem:void 0,portalItemId:void 0,state:t.state,timestamp:(new Date).getTime(),url:t.url}:void 0)}).filter(e=>(0,d.i)(e)),n=e?.filterByTime?r.filter(e=>!this.isTooOld(e)):r;if(n.length?a[i]=n.filter(e=>"ready"===e.state):delete a[i],!s.exportedLinks.some(e=>"pending"===e.state)){const e=await this.getExportLinkCollectionWithPortalItems(n),t=s.exportedLinks.map(t=>e.find(e=>t.url===e.url));s.exportedLinks=t.filter(e=>(0,d.i)(e))}(0,m.s)(k,a)}isTooOld(e){return((new Date).getTime()-e.timestamp)/6e4>10}async getExportLinkCollectionWithPortalItems(e){const t=new n.default;if(!e.length)return t;const s=o.clone(e);return await Promise.all(s.map(async e=>{let t;if(e.portalItemId)try{t=new c.default({id:e.portalItemId}),await t.load()}catch{t=void 0}e.portalItem=t})),t.addMany(s.map(e=>({count:e.count,error:e.error,extension:e.extension,name:e.name,portalItem:e.portalItem,state:e.state,url:e.url}))),t}async checkPortalItemValidity(){const{portal:e,printWidget:t}=this,s=(0,h.g)(e.user),i=(0,m.g)(k,!0)||{},a=i[s];await Promise.all(t.exportedLinks.map(async e=>{if("ready"===e.state&&e.portalItem?.id)try{await new c.default({id:e.portalItem.id}).load()}catch{e.portalItem=void 0;const t=a.find(t=>t.url===e.url);t.portalItem=void 0,t.portalItemId=void 0}})),(0,m.s)(k,i)}async orgBlocksBetaApps(){const{portal:e}=this;if(!e.user)return await Promise.resolve(!1);const t=`${(0,f.g)(e)}portals/self/signinSettings`,s=await(0,p.default)(t,{query:{f:"json",async:!1},responseType:"json"});return s?.data&&!s.data.blockBetaApps?await Promise.resolve(!1):await Promise.resolve(!0)}render(){return this._propWatcherTask.render({complete:()=>{const{_messages:e,showHeading:t,closable:s}=this;return a.qy`<calcite-panel .heading=${t?e.print:void 0} .closable=${s} @calcitePanelClose=${()=>this.arcgisClose.emit()}><div ${(0,r.K)(this.divRefHandler)}></div></calcite-panel>`}})}}(0,i.c)("arcgis-map-config-print",T)},55535:(e,t,s)=>{function i(e,t,s){window.localStorage.setItem(e,JSON.stringify(t))}function a(e){window.localStorage.removeItem(e)}function r(e,t){const s=window.localStorage.getItem(e);return s&&t?JSON.parse(s):s}function n(e,t,s){window.sessionStorage.setItem(e,JSON.stringify(t))}function o(e,t){const s=window.sessionStorage.getItem(e);return s&&t?JSON.parse(s):s}s.d(t,{a:()=>n,b:()=>o,g:()=>r,r:()=>a,s:()=>i})},65722:(e,t,s)=>{s.d(t,{a:()=>r,g:()=>n,o:()=>o});var i=s(44345);const a=e=>e&&!e.endsWith("/")?`${e}/`:e;function r(e){const{customBaseUrl:t,portalHostname:s,urlKey:i}=e,{protocol:a}=window.location;return`${a}//${i?`${i}.${t}`:s}`}function n(e){return a(e.restUrl)}async function o(e){if(!e?.user)return!1;const t=`${n(e)}portals/self/signinSettings`,s=await(0,i.default)(t,{query:{f:"json",async:!1},responseType:"json"});return!(s?.data&&!s.data.blockBetaApps)}},66228:(e,t,s)=>{s.d(t,{a:()=>w,b:()=>P,c:()=>L,d:()=>E,e:()=>O,f:()=>N,g:()=>f,h:()=>y,i:()=>h,j:()=>g,k:()=>I,l:()=>_,m:()=>k,n:()=>d,o:()=>x,p:()=>q,q:()=>C,r:()=>R,s:()=>v,t:()=>T,u:()=>b});var i=s(63438),a=s(18423),r=s(96086),n=s(91813),o=s(21255),l=s(13078),c=s(21303),p=s(12627),u=s(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],m=["feature"];function h(e){return null!=e}function g(e,t,s){const i=t.fieldName;if(i.includes(u.f.expression)){const e=s.get(i);return e?.title?e.title:i}return v(e)&&e.getFieldConfiguration(i)?e.getFieldAlias(i)||i:t.label||i}async function f(e){return new Map((await I(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function y(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const s=`${u.f.expression}${e.name}`;t.set(s,e)}),t}function w(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function b(e){const t=w(e);let s;return t===u.s.wms||t===u.s.mapImage?s=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(s=e.version),Number.parseFloat(s)}function v(e){return"fieldConfigurations"in e&&m.includes(e.type)}async function I(e){return await new Promise((t,s)=>{switch(w(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const i=e,a=i?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const s=new Map(i.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,r=[];a.forEach(e=>{s.has(e)&&r.push(s.get(e))}),t(r)}else t(i.fields)}).catch(e=>{s(new Error(e))}):t(i.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function x(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function k(e){return Number((100*(1-e)).toFixed(1))}function T(e){return Number((1-e/100).toFixed(3))}const E=(e,t)=>{const s=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||s.push({name:e.fieldName,alias:e.label,type:"string"})}),s},P=async(e,t)=>{const s=new p.default;return s.geometry=t.extent,s.mapExtent=t.extent,s.returnGeometry=!0,s.tolerance=6,s.layerOption="popup",s.width=t.width,s.height=t.height,s.layerIds=[e.id],(await c.identify(e.layer.url,s))?.results?.[0]?.feature},O=async(e,t,s)=>{const i=await(await e.whenLayerView(t)).queryAggregates();return await S(s,i.features?.[0])},S=async(e,t)=>{let s;if(t)s=t.clone();else{s=new i.default;const t=E(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),s.attributes=e}const r=new a.default;s.geometry=r}return s};function C(e,t){const s=t.startsWith("#"),i=t.startsWith(".");for((i||s)&&(t=t.slice(1));e;){if(s){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function L(e){if(w(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function _(e,t,s){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const s=t.get(e);i=s.type?s.type.toLowerCase():""}else if(s.has(e)){const t=s.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function N(e,t){try{const s=w(e);if(s===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await P(e,t)||await A(e,t)]};if(s===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await A(e,t)]};const i=s===u.s.ogcFeature||s===u.s.stream?await t.whenLayerView(e):e,a=i.createQuery();a.where=i.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(i.sourceJSON?.advancedQueryCapabilities?.supportsPagination||s===u.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const r=await i.queryFeatures(a);return r?.features?.length||(r.features[0]=await A(e,t)),r}catch(e){console.error(e)}}async function A(e,t){return await new Promise(s=>{const a=new i.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const c=t.extent;let p;"polygon"===e.geometryType?p=o.default.fromExtent(c):"point"===e.geometryType?p=c.center.clone():"multipoint"===e.geometryType?p=new r.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(p=new n.default({spatialReference:t.spatialReference.clone()}),p.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(p=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=p,s(a)})}function R(e){return w(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function q(e){return w(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);