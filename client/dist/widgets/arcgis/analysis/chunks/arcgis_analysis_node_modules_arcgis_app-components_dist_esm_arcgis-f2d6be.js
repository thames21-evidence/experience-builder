/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be"],{1654:(e,t,r)=>{r.d(t,{A:()=>w,B:()=>E,C:()=>L,D:()=>U,E:()=>v,F:()=>D,a:()=>s,b:()=>o,c:()=>a,d:()=>y,e:()=>C,f:()=>b,g:()=>S,h:()=>k,i:()=>p,j:()=>I,k:()=>j,l:()=>c,m:()=>d,n:()=>l,o:()=>$,p:()=>g,q:()=>h,r:()=>m,s:()=>_,t:()=>z,u:()=>u,v:()=>x,w:()=>P,x:()=>O,y:()=>H,z:()=>f});var n=r(46904);const i=e=>{var t,r,n;return"string"==typeof(null==e?void 0:e.role)&&(null==e?void 0:e.role)?null==e?void 0:e.role:null!==(r=null!==(t=null==e?void 0:e.roleId)&&void 0!==t?t:null==e?void 0:e.id)&&void 0!==r?r:null===(n=null==e?void 0:e.sourceJSON)||void 0===n?void 0:n.id};function o(e){return e&&!e.orgId}function a(e,t){return(0,n.u)(e,t)||"update"===e.itemControl||(0,n.c)([e],t)&&b(t)}function s(e,t){const r=(0,n.c)([e],t),i=(0,n.u)(e,t)||b(t)&&r,o=S(t)&&T(t);return!!(i||r&&o)}const l=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:manageLicenses"))},c=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:inviteUsers"))},d=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:manageRoles"))},u=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:changeUserRoles"))},g=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:viewGroups"))},h=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:viewUsers"))};function p(e){return["Trial Developer","Developer","Developer Subscription"].includes(null==e?void 0:e.type)}function v(e){return["Developer Subscription"].includes(null==e?void 0:e.type)}function m(e){return["Geoanalytics Engine","GeoAnalytics MS Fabric"].includes(null==e?void 0:e.type)}const y=e=>{var t;return null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.includes("Developer")},f=e=>{var t;return null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.includes("PublicSharingDisabled")},w=e=>{var t;return null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.includes("HostedServicesPublicSharingDisabled")};function b(e){return"org_admin"===i(e)||"account_admin"===i(e)}function C(e){return["org_admin","account_admin"].includes(i(e))&&!(null==e?void 0:e.roleId)}function S(e){return!!(null==e?void 0:e.roleId)&&e.roleId.length>0}function I(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:updateItemCategorySchema"))}function k(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:updateGroups"))}function $(e){var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:assignToGroups"))}const T=e=>{var t;return!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:admin:deleteItems"))};function x(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToGroup")}function P(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToOrg")}function E(e){return((null==e?void 0:e.privileges)||[]).includes("portal:user:shareToPublic")}function H(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToOrg")}function L(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToPublic")}function O(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:shareToGroup")}function j(e,t,r,n){const i=n&&!["Trial","Trial Press","Trial Developer","Developer Subscription","Evaluation"].includes(n.type),o=((null==t?void 0:t.privileges)||[]).includes("portal:admin:manageCollaborations");return!(!(null==e?void 0:e.collaborationsEnabled)||!t||!b(t)&&!o||!(null==r?void 0:r.isPortal)&&!i)}function D(e){return!!e&&(!S(e)||S(e)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:viewItems")}(e))}const U=({items:e,user:t,portal:r})=>{const i=e[0],o=i.owner;if(r.isPortal&&o!==t.username&&o.includes("esri_")&&!["esri_livingatlas"].includes(o))return!1;const s=(0,n.u)(i,t),l=S(t),c=M(t),d=a(i,t)&&function(e){return((null==e?void 0:e.privileges)||[]).includes("portal:admin:updateItems")}(t)&&!l&&(function(e,t){return!function(e){return!(!e.urlKey||!e.customBaseUrl)||!!e.isPortal}(t)||x(e)||P(e)||!!t.canSharePublic&&E(e)}(t,r)||M(t));return s||d||(0,n.c)(e,t)&&c};function M(e){return O(e)||H(e)||L(e)}const A=["portal:user:createItem","portal:user:viewOrgItems","premium:publisher:createNotebooks","portal:publisher:createDataPipelines","features:user:edit","features:user:fullEdit","portal:admin:viewItems","portal:admin:updateItems","portal:admin:deleteItems"];function z(e){return e.some(e=>A.includes(e))}function _(e){return e.filter(e=>A.includes(e))}},12192:(e,t,r)=>{r.d(t,{a:()=>a,g:()=>c});var n=r(15332),i=r(94984),o=r(87849);function a(e){var t,r,o;const a=null!==(t=(0,n.c)(e,"[lang]"))&&void 0!==t?t:null===(o=null===(r=e.shadowRoot)||void 0===r?void 0:r.ownerDocument)||void 0===o?void 0:o.documentElement,s=((null==a?void 0:a.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return i.l.has(s)?i.l.get(s):i.l.has(s.slice(0,2))?i.l.get(s.slice(0,2)):"en"}const s={};function l(e,t){const r=`${e}${t}`;return s[r]||(s[r]=function(e,t){return new Promise((r,n)=>{fetch((0,o.d)(`../arcgis-app-assets/i18n/${e}.i18n.${t}.json`)).then(e=>{e.ok?r(e.json()):n()},()=>n())})}(e,t)),s[r]}async function c(e,t){const r=t||e.tagName.toLowerCase(),o=a(e),s=function(e){var t,r,o;const a=null!==(t=(0,n.c)(e,"[lang]"))&&void 0!==t?t:null===(o=null===(r=e.shadowRoot)||void 0===r?void 0:r.ownerDocument)||void 0===o?void 0:o.documentElement,s=((null==a?void 0:a.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return i.l.has(s)?i.l.get(s):i.l.has(s.slice(0,2))?s:"en"}(e);let c;try{c=await l(r,o)}catch(e){console.warn(`no locale for ${r} (${o}) loading default locale en.`),c=await l(r,"en")}return[c,o,s]}},26262:(e,t,r)=>{r.d(t,{a:()=>i,g:()=>o,i:()=>a});var n=r(41473);const i=(e,t)=>(0,n.a)(`${(0,n.g)(e)}community/groups/${t.id}`),o=(e,t)=>`${((e,t)=>(0,n.a)(`${(0,n.g)(e)}content/groups/${t.id}`))(e,t)}search`,a=e=>{var t;return null===(t=null==e?void 0:e.capabilities)||void 0===t?void 0:t.includes("distributed")}},37362:(e,t,r)=>{r.d(t,{U:()=>n,a:()=>o,b:()=>i,g:()=>a});const n="/Categories",i=(e,t,r=!0)=>{const n=null!=e?e:"";return`${n}${n.endsWith("/")?"":"/"}${r?t.title.toLocaleLowerCase():t.title}`};function o(e){var t;let r=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.title;return r&&"/"!==r.charAt(0)&&(r=`/${r}`),r||n}const a=(e,t)=>`${e.replace(/\/([^\/]+)$/,`/${t}`)}`},46456:(e,t,r)=>{r.r(t),r.d(t,{arcgis_categorize_items:()=>u});var n=r(87849),i=r(50315),o=r(52995),a=r(37362),s=r(4429),l=r(12192),c=r(80619);r(83692),r(59317),r(37762),r(931),r(93814),r(41473),r(54251),r(26262),r(1654),r(46904),r(29599),r(60958),r(15332),r(94984);const d=(e,t)=>{const r={};return e.forEach(({groupCategories:e,categories:n,id:i})=>{let o=t?e:n;(null==o?void 0:o.length)||(o=n),o.forEach(e=>{r[e]||(r[e]=[]),r[e].push(i)})}),r},u=class{constructor(e){(0,n.r)(this,e),this.arcgisCategorizeItemsCancel=(0,n.c)(this,"arcgisCategorizeItemsCancel",7),this.arcgisCategorizeItemsSubmit=(0,n.c)(this,"arcgisCategorizeItemsSubmit",7),this.closeDialog=()=>{this.arcgisCategorizeItemsCancel.emit()},this.handleCategorySelected=({paths:e,selected:t})=>{const{itemIds:r,itemToCategoriesLookupHistory:n}=this,i=Object.assign({},this.categorySelectionCountMapHistory[this.currentHistoryIndex]);e.forEach(e=>{i[e]=t?[...r]:[]});const o=structuredClone(n[this.currentHistoryIndex]);if(r.forEach(r=>{o[r]||(o[r]=[]);const n=o[r];o[r]=t?[...n,...e]:n.filter(t=>!e.includes(t))}),t){const t=e.reduce((e,t)=>{let r="";return t.split("/").filter(Boolean).forEach(n=>{r=`${r}/${n}`,r!==t&&e.push(r)}),e},[]);t.forEach(e=>{i[e]=[]}),r.forEach(e=>{const r=o[e];o[e]=r.filter(e=>!t.includes(e))})}this.addNewHistory(i,o)},this.handleItemCategoryChange=(e,t)=>{var r;const{itemToCategoriesLookupHistory:n,categorySelectionCountMapHistory:i,rootCategoryPath:o}=this,a=structuredClone(n[this.currentHistoryIndex]),l=structuredClone(i[this.currentHistoryIndex]),c=null!==(r=a[e])&&void 0!==r?r:[],d=t.map(e=>e.startsWith(o)?e:`${o}${e}`);(0,s.d)(c,d)||(c.forEach(t=>{const r=l[t];l[t]=(null!=r?r:[]).filter(t=>t!==e)}),d.forEach(t=>{const r=l[t];l[t]=[...null!=r?r:[],e]}),a[e]=[...d],this.addNewHistory(l,a))},this.addNewHistory=(e,t)=>{this.categorySelectionCountMapHistory=[...this.categorySelectionCountMapHistory.slice(0,this.currentHistoryIndex+1),e],this.itemToCategoriesLookupHistory=[...this.itemToCategoriesLookupHistory.slice(0,this.currentHistoryIndex+1),t],this.currentHistoryIndex=this.categorySelectionCountMapHistory.length-1},this.updateCategory=async()=>{const{itemIds:e,portal:t,itemToCategoriesLookupHistory:r,currentHistoryIndex:n,i18n:o,group:a}=this,s=r[n],l=()=>{this.arcgisCategorizeItemsSubmit.emit(s),this.canSave=!1};if(a)return void l();this.isLoading=!0;const{result:c,error:d}=await(0,i.u)({categories:s,itemIds:e,portal:t,group:a});this.isLoading=!1,!c||d?this.error=o.errorMessage:l()},this.renderItemCard=e=>{const{i18n:t,portal:r,user:i,config:o,itemToCategoriesLookupHistory:a,handleItemCategoryChange:s,categorySchema:l,rootCategoryPath:c}=this;if(0===a.length)return null;const d=a[this.currentHistoryIndex][e.id];return(0,n.h)("arcgis-item-browser-card",{key:e.id,item:e,portal:r,user:i,baseUrl:o.baseUrl,showItemType:!0},d&&d.length>=20&&(0,n.h)("div",{slot:"content-top",class:"status-banner"},(0,n.h)("calcite-icon",{icon:"exclamationMarkTriangle",scale:"s"}),(0,n.h)("span",null,t.limited)),(0,n.h)("div",{slot:"content-end",class:"category-picker-container"},(0,n.h)("arcgis-categories-picker",{portal:r,categories:d,schema:l,rootCategoryPath:c,onArcgisCategoriesPickerChange:({detail:t})=>s(e.id,t),hideLabel:!0})))},this.isActive=void 0,this.items=void 0,this.user=void 0,this.portal=void 0,this.config=void 0,this.group=void 0,this.categorySchema=void 0,this.isLoading=!1,this.categorySelectionCountMapHistory=[],this.currentHistoryIndex=0,this.itemToCategoriesLookupHistory=[],this.error=void 0,this.canSave=!1,this.rootCategoryPath=void 0}async componentWillLoad(){const e=await(0,l.g)(this.el);this.i18n=e[0]}async componentDidLoad(){const{portal:e,user:t,group:r}=this;this.isLoading=!0;const n=this.items.map(e=>e.id),{result:s,error:l}=await(0,o.d)(n,this.portal);this.items=s&&!l?s:this.items,this.updateInternalData(this.items);const{result:c,error:d}=await(0,i.g)({portal:e,user:t,group:r});!d&&c&&(this.categorySchema=c[0].categories,this.rootCategoryPath=(0,a.a)(c)),this.isLoading=!1}async updateInternalData(e){const t=this.group,r=!!t;this.itemIds=e.map(e=>e.id),this.isLoading=!0;const{result:n,error:i}=await(0,o.d)(this.itemIds,this.portal,t);this.isLoading=!1;const a=n&&!i?n:e;this.itemToCategoriesLookupHistory=[a.reduce((e,t)=>{let n=r?t.groupCategories:t.categories;return(null==n?void 0:n.length)||(n=t.categories),e[t.id]=n,e},{})],this.categorySelectionCountMapHistory=[d(a,r)],this.currentHistoryIndex=0,this.initialItemToCategoriesLookup=structuredClone(this.itemToCategoriesLookupHistory[0])}handleIsActiveChange(){this.isActive&&this.updateInternalData(this.items)}handleCountMapChange(){const{itemIds:e,itemToCategoriesLookupHistory:t,initialItemToCategoriesLookup:r}=this,n=t[this.currentHistoryIndex],i=!!n&&!!r&&e.some(e=>!(0,s.d)(n[e],r[e])),o=Object.values(n).some(e=>e.length>20);this.canSave=i&&!o}render(){var e;const{items:t,categorySchema:r,categorySelectionCountMapHistory:i,currentHistoryIndex:o,updateCategory:a,isLoading:s,i18n:l,closeDialog:d,isActive:u,renderItemCard:g,handleCategorySelected:h,error:p,canSave:v,rootCategoryPath:m}=this,y=t.length;return(0,n.h)("calcite-dialog",{key:"9d60bf1782c84d1cab6d9d58513c7c53be6b89c8",open:u,onCalciteDialogClose:d,modal:!0,scale:"l",class:"dialog",outsideCloseDisabled:!0,heading:l.modalTitle},s&&(0,n.h)("calcite-scrim",{key:"d331a8cd1c69c3ed0b090764f9122026d273da8d",loading:!0},l.loadingText),(0,n.h)("div",{key:"85c5b838a2349e69af82e68bdfc11449217f58a8",class:"stage"},(0,n.h)("calcite-alert",{key:"5f34acfa9f55d2f0a18ef0416d10a4b9dac49d90",icon:!0,open:!!p,label:p,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,n.h)("div",{key:"9184ef21291faa3cd42baca304731792613fdf12",slot:"message"},p)),(0,n.h)("arcgis-item-browser",{key:"a600c14a5e8240c192d000ee67be2634d04889d0",fetch:async()=>({nextStart:0,num:y,results:t,start:1,total:y}),portal:this.portal,user:this.user,config:this.config,hideContentTop:!0,contentPaddedBottom:!0,hidePreviewFooters:!0,view:"list",selection:"none",num:c.a},(0,n.h)("arcgis-category-tree",{key:"09f0d9375759442d5f25515177a3de29671a9fff",slot:"filters",rootCategoryPath:m,categorySchema:r,categorySelectionCountMap:null!==(e=i[o])&&void 0!==e?e:{},total:y,onArcgisCategorizeCategorySelected:({detail:e})=>h(e)}),(0,n.h)("arcgis-item-browser-content",{key:"a9942c6b89b1146b93e65f81f0fa84554b53791d",slot:"content"},t.map(e=>g(e))))),(0,n.h)("div",{key:"7c8ae85c4da72c40c582f2dfdd605bc551bce9dc",slot:"footer",class:"footer"},(0,n.h)("div",{key:"cf9cf9ca183210178d515f1da987d29cdfd68d49",class:"footer-history"},(0,n.h)("calcite-button",{key:"6a6451f99492a6f47fda8edfa3b3477fd6efee12",iconStart:"undo",label:l.undo,appearance:"transparent",onClick:()=>this.currentHistoryIndex--,disabled:0===this.currentHistoryIndex}),(0,n.h)("calcite-button",{key:"291da0321d5018bc976a2d45c67eb3fe29892790",iconStart:"redo",label:l.redo,appearance:"transparent",onClick:()=>this.currentHistoryIndex++,disabled:this.currentHistoryIndex>=this.categorySelectionCountMapHistory.length-1})),(0,n.h)("div",{key:"d951d6aa23702ccefd484d249222a7e984b3f360",class:"footer-actions"},(0,n.h)("calcite-button",{key:"845b5f6551124b2ec43a4f50927708f0cc142141",appearance:"outline","data-id":"cancelButton",onClick:d},l.cancel),(0,n.h)("calcite-button",{key:"e7ea5a720a3ffc212e49dd8a6743dd3619aeb159",appearance:"solid","data-id":"nextButton",onClick:a,disabled:!v},l.save))))}get el(){return(0,n.a)(this)}static get watchers(){return{items:["updateInternalData"],isActive:["handleIsActiveChange"],currentHistoryIndex:["handleCountMapChange"]}}};u.style=".stage{height:100%;overflow:hidden;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));background-color:var(--calcite-color-background)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.dialog{--calcite-dialog-content-space:0;--calcite-dialog-size-x:1080px}.category-picker-container{margin-top:0.5rem}.status-banner{display:flex;align-items:center;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;font-size:0.75rem;border-bottom:1px solid var(--calcite-color-border-2)}.status-banner>calcite-icon{margin-inline-end:0.5rem;color:var(--calcite-color-status-danger)}.status-banner>span{margin-top:2px}.footer{display:flex;justify-content:flex-end;gap:1rem;width:100%}.footer-history{display:flex;gap:0.25rem}.footer-actions{display:flex;gap:1rem}"},46904:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>o,c:()=>c,d:()=>d,e:()=>u,f:()=>g,g:()=>h,i:()=>s,u:()=>l});r(93814);var n=r(41473);function i(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function o(e){var t;return i(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function a(e){var t;return i(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function s(e,t){return e.owner===t.username}function l(e,t){return s(e,t)||function(e,t){var r;if(null!=e.isAdmin)return!!e.isAdmin;const n=e.owner,i="admin"===e.itemControl,o=["esri_livingatlas","esri_demographics","esri_boundaries"];if((null===(r=e.portal)||void 0===r?void 0:r.isPortal)&&!s(e,t)&&i&&n.includes("esri_")&&!o.includes(n))return!1;return i}(e,t)}const c=(e,t)=>!!t.orgId&&e.every(e=>e.isOrgItem),d=(e,t)=>`${(0,n.a)(t)}item.html?id=${e}`,u=(e,t)=>`${(0,n.g)(t)}/content/users/${e}`,g=e=>e.reduce((e,t)=>(e[t.owner]=e[t.owner]?[...e[t.owner],t.id]:[t.id],e),{}),h=(e,t)=>`${(0,n.a)(t)}content/items/${e}`},50315:(e,t,r)=>{r.d(t,{a:()=>p,b:()=>u,c:()=>h,d:()=>m,e:()=>g,f:()=>d,g:()=>c,u:()=>v});var n=r(83692),i=r(37362),o=r(59317),a=r(26262),s=r(41473),l=r(1654);const c=async({portal:e,user:t,group:r,useCache:n=!1})=>{var i;try{const o=await(r?u(r.id,e,n):d(e,t,n));return{result:null!==(i=null==o?void 0:o.categorySchema)&&void 0!==i?i:null}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};async function d(e,t,r=!0){if(null!=e||(e=o.c.portal),null!=t||(t=o.c.user),!(null==e?void 0:e.id)||t&&(0,l.b)(t))return null;const i=()=>(0,n.r)(`${(0,s.g)(e)}portals/${e.id}/categorySchema`);return r?(0,n.f)(i,"categorySchema",e.id):i()}async function u(e,t,r=!0){if(null!=t||(t=null===o.c||void 0===o.c?void 0:o.c.portal),!e||!t)return null;const i=()=>(0,n.r)(`${(0,a.a)(t,{id:e})}categorySchema`);return r?(0,n.f)(i,"categorySchema",e):i()}const g=async({user:e,portal:t,useCache:r=!1})=>{var n;const i=await h(t,e,r);return{result:null!==(n=null==i?void 0:i.memberCategorySchema)&&void 0!==n?n:null}};async function h(e,t,r=!0){if(null!=e||(e=o.c.portal),null!=t||(t=o.c.user),!(null==e?void 0:e.id)||t&&(0,l.b)(t))return null;const i=()=>(0,n.r)(`${(0,s.g)(e)}portals/${e.id}/memberCategorySchema`);return r?(0,n.f)(i,"memberCategorySchema",e.id):i()}async function p(e,t,r=!0){const i=()=>async function(e,t){var r;const i=(0,s.g)(e),o=(0,s.b)(e),l=await(0,n.r)(`${i}portals/self?culture=${o}`),c=await(0,n.r)(`${i}community/groups?q=${l.contentCategorySetsGroupQuery}`),d=null===(r=null==c?void 0:c.results)||void 0===r?void 0:r[0],u=(await(0,n.r)((0,a.g)(e,d),{q:`typekeywords: ${t}`})).results[0];return(0,n.r)(`${i}content/items/${u.id}/data`)}(e,t);return r?(0,n.f)(i,"categorySchema",t):i()}async function v({categories:e,itemIds:t,portal:r,group:i}){try{const o=`${(0,s.g)(r)}/content/${i?`groups/${i.id}/updateCategories`:"updateItems"}`,a=JSON.stringify(t.map(t=>{const r=Array.isArray(e)?e:e[t];return{[t]:i?r:{categories:r}}}));return{result:await(0,n.r)(o,{items:a},{},"post")}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}const m=async({path:e,portal:t,group:r,updateInfo:n})=>{try{const o=(await y({category:e,portal:t,group:r,num:1})).total;if(0===o)return console.warn(`No items found with category ${e} when updating schema`),{};const a=100,s=Math.ceil(o/a),l=[];for(let o=0;o<s;o++)l.push(y({category:e,portal:t,group:r,start:o*a,num:a}).then(({results:t})=>{const o={};return t.forEach(t=>{var a;const s=null!==(a=r?t.groupCategories:t.categories)&&void 0!==a?a:[],l="change-title"===n.type?s.map(t=>{const r=(0,i.g)(e,n.newTitle);return t===e?r:t.replace(`${e}/`,`${r}/`)}):s.filter(t=>!t.startsWith(e));o[t.id]=l}),o}));const c=await Promise.all(l);return await Promise.all(c.map(e=>v({categories:e,itemIds:Object.keys(e),portal:t,group:r}))),{}}catch(t){return console.error(`Error ${n.type} items schema from path ${e}:`,t),{error:{code:"unhandledError"}}}},y=({category:e,num:t=100,start:r=0,portal:i,group:o})=>{const l={start:r,num:t,categories:JSON.stringify([e])},c=o?(0,a.g)(i,o):`${(0,s.g)(i)}search`;return(0,n.r)(c,Object.assign(Object.assign({},l),{q:o?void 0:`orgid: ${i.id}`}))}},52995:(e,t,r)=>{r.d(t,{a:()=>b,b:()=>u,c:()=>g,d:()=>h,e:()=>p,f:()=>d,g:()=>v,l:()=>C});var n=r(83692),i=r(71467),o=r(46904),a=r(931),s=r(41473),l=r(29599),c=r(60958);const d=async(e,t,r)=>{const{owningSystemUrl:i}=await(0,n.f)(async()=>(0,l.a)(e),"portalInfo",e.id);return(await Promise.all(t.map(async e=>{try{const{owningSystemUrl:t}=await(0,l.g)(e,r);return{owningSystemUrl:t,url:e}}catch(t){return console.error(t),{owningSystemUrl:null,url:e}}}))).filter(({owningSystemUrl:e})=>e===i).map(({url:e})=>e)},u=async(e,t,r)=>{var i;try{return{result:await(0,n.r)(e,t,Object.assign({addTokenManually:!1},r))}}catch(e){const t="token required";return(null===(i=null==e?void 0:e.message)||void 0===i?void 0:i.toLowerCase().includes(t))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function g(e,t,r){var i;const{relationshipType:o,direction:a}=r,l=`${(0,s.g)(t)}content/items/${e}/relatedItems`,c=await(0,n.r)(l,{relationshipType:o,direction:a,includeRecycleBin:!0});return(null===(i=null==c?void 0:c.relatedItems)||void 0===i?void 0:i.length)&&(c.relatedItems=c.relatedItems.filter(t=>(null==t?void 0:t.id)!==e)),c}const h=async(e,t,r)=>{const i=!!r,o=(0,s.g)(t),a=i?`${o}/content/groups/${r.id}/search`:`${o}/search`;try{return{result:(await(0,n.r)(a,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},p=async(e,t)=>{try{const[r]=await(0,a.l)(["esri/portal/PortalItem"]);return{result:await Promise.all(e.map(e=>new r({id:e,portal:t}).load()))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},v=async(e,t,r,i)=>{try{const o=[],a=[],s=[];await Promise.all(e.map(async e=>{const{result:c,error:d}=await(0,n.f)(()=>u(e,t,i),"itemMetadata",`${e}--no-token`);if("tokenRequired"!==(null==d?void 0:d.code))if(m(c))o.push(y(c,e));else try{const t=await(0,l.g)(e,r);s.push(Object.assign(Object.assign({},c),{owningSystemUrl:t.owningSystemUrl}))}catch(d){console.warn(d)}else a.push(e)}));const g=await d(t,a,r),h=(await Promise.all(g.map(async e=>({response:await(0,c.r)(e,t,Object.assign({addTokenManually:!0},i)),owningSystemUrl:(await(0,l.g)(e,r)).owningSystemUrl,url:e})))).reduce((e,{response:t,url:r,owningSystemUrl:n})=>m(t)?(o.push(y(t,r)),e):[...e,Object.assign(Object.assign({},t),{owningSystemUrl:n})],[]),p=await Promise.all([...s,...h].map(async({serviceItemId:e,owningSystemUrl:t})=>{if(!e)return null;const{result:r}=await w({itemId:e,owningSystemUrl:t});return{item:r,owningSystemUrl:t}})),{result:f}=o.length<=0?{result:[]}:await v(o,t,r,i);return{result:[...p.filter(e=>!!e),...f]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},m=e=>!!(null==e?void 0:e.sources),y=(e,t)=>{var r;const n=null===(r=Object.values(e.sources)[0])||void 0===r?void 0:r.url;return n?n.includes("..")?(0,s.t)({url:t,path:n}):n:null},f=e=>`${e}/sharing/rest`,w=async({itemId:e,owningSystemUrl:t,requestOptions:r})=>{try{const i=(0,o.g)(e,f(t));return{result:await(0,n.r)(i,{},Object.assign(Object.assign({},r),{addTokenManually:!1}))}}catch(e){return console.error(e),(0,i.b)(e)&&e.message.toLocaleLowerCase().includes("invalid token")?{error:{code:"invalidToken"}}:{error:{code:"unhandledError"}}}},b=async({itemId:e,owningSystemUrl:t,requestOptions:r})=>{try{const i=`${(0,o.g)(e,f(t))}/data`;return{result:await(0,n.r)(i,{},Object.assign(Object.assign({},r),{addTokenManually:!1}))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},C=async(e,t)=>{try{const[r]=await(0,a.l)(["esri/portal/PortalItem"]),n=new r({id:e,portal:t});return await n.load(),{result:n}}catch(e){return console.error("Fail to reload item",e),{error:{code:"unhandledError"}}}}},60958:(e,t,r)=>{r.d(t,{r:()=>i});var n=r(83692);const i=async(e,t,r={})=>{const{body:i,usePost:o,addTokenManually:a,customToken:s}=r,l=new URLSearchParams;i&&Object.entries(i).forEach(([e,t])=>{void 0!==t&&l.append(e,t)});const c=new URL(e);if(c.searchParams.append("f","json"),s)c.searchParams.append("token",s);else{const e=!1===a?null:await(0,n.g)(t);e&&c.searchParams.append("token",e)}const d=await fetch(c.toString(),{body:o?l:void 0,method:o?"POST":"GET"}),u=await d.json(),g=u.error;if(g)throw"string"==typeof g?new Error(g):g;return u}},71467:(e,t,r)=>{r.d(t,{a:()=>i,b:()=>o,i:()=>a});const n=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","invalidToken","invalid3DObjectFeatureClass","invalidClassification","serviceNameInvalid","titleInvalid","titleStartsWithNumber","titleRequired","titleInUseService","itemInRecycleBin","summaryInvalid","descriptionInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","invalidKeyFile","unauthorizedCredentials","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType","failToCreate3DLayer"],i=e=>n.includes(null==e?void 0:e.code),o=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),a=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}},80619:(e,t,r)=>{r.d(t,{I:()=>n,a:()=>i});const n=["folder","group","contentType"],i=99999},94984:(e,t,r)=>{r.d(t,{C:()=>s,a:()=>u,b:()=>d,f:()=>l,g:()=>a,l:()=>o,s:()=>h});var n=r(15332),i=r(931);const o=new Map([["ar","ar"],["bg","bg"],["bs","bs"],["ca","ca"],["cs","cs"],["da","da"],["de","de"],["el","el"],["en","en"],["es","es"],["et","et"],["fi","fi"],["fr","fr"],["he","he"],["hr","hr"],["hu","hu"],["id","id"],["it","it"],["ja","ja"],["ko","ko"],["lt","lt"],["lv","lv"],["nb","no"],["no","no"],["nl","nl"],["pl","pl"],["pt-br","pt-BR"],["pt-pt","pt-PT"],["ro","ro"],["ru","ru"],["sk","sk"],["sl","sl"],["sr","sr"],["sv","sv"],["th","th"],["tr","tr"],["uk","uk"],["vi","vi"],["zh-cn","zh-CN"],["zh-hk","zh-HK"],["zh-tw","zh-TW"]]);function a(e){return function(e,t,r){const i=(0,n.c)(e,`[${t}]`);return i?i.getAttribute(t):r}(e,"dir","ltr")}const s={rtl:"arcgis--rtl"};async function l(e,t){const{api:r,type:n,places:o}=t||{};if(3===r){const[r]=await(0,i.l)(["dojo/number"]);return r.format(e,{type:n,places:o,pattern:null==t?void 0:t.pattern})}const[a]=await(0,i.l)(["esri/intl"]),s=a.convertNumberFormatToIntlOptions({places:o,style:n,digitSeparator:!0});return a.formatNumber(e,Object.assign(Object.assign({},s),{style:n}))}const c={};function d(e,t){let r=document.documentElement.lang;const n="bs"===r;if(n&&(r="hr"),t){const t=`${r}-full`,n={dateStyle:"full",timeStyle:"long"};return c[t]||(c[t]=new Intl.DateTimeFormat(r,n)),c[t].format(e)}const i={year:"numeric",month:n?"numeric":"short",day:"numeric"};return c[r]||(c[r]=new Intl.DateTimeFormat(r,i)),c[r].format(e)}function u(e,t,r,n){const i=null!=e?e:"en";let o=t.unknown;return(1===r||["id","ja","ko","th","vi","zh-cn","zh-hk","zh-tw"].includes(i))&&(o=t.single),1!==r&&["en","ca","da","de","el","es","et","fi","hi","hu","it","nb","nl","pt-pt","sv","tr"].includes(i)&&(o=t.multiple),h(o,Object.assign(Object.assign({},n),{number:r}))}const g=/\$\{([^}]+)\}/g;function h(e,t,r=g){let n=e;try{n=e.replace(r,(e,r)=>function(e,t){const r=e.split(".").reduce((e,t)=>e[t],t);return"string"==typeof r||"number"==typeof r?r:e}(r,t).toString())}catch(e){console.error(e)}return n}}}]);