/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-fac597.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-fac597"],{16174:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigSmartMappingFieldPickList:()=>n});var s=i(73679),l=i(4395),a=i(46317),d=(i(52797),i(54312),i(44345),i(55448),i(34031),i(63438),i(5933),i(1225)),r=(i(89704),i(5294),i(18423),i(96086),i(91813),i(21255),i(13078),i(21303),i(12627),i(56451),i(31521),i(23054),i(5077),i(23795),i(17902),i(87420),i(30161),i(81734),i(75698),i(10628),i(59640),i(64451),i(6176),i(83552),i(77462),i(49403),i(10281),i(83930),i(66617),i(10454),i(29614),i(94916),i(52554),i(2156),i(4038),i(49851),i(75054),i(15223),i(70169),i(47207),i(70852),i(48103),i(39423),i(85681),i(18444),i(42411),i(9767),i(38218),i(91914),i(86605),i(68196),i(440),i(46547),i(28927),i(6238),i(7299),i(85643)),o=i(73801);const c=l.AH`.smart-mapping-field-pick-list-popover{--calcite-popover-z-index: 100}.panel{min-height:300px}.content{max-height:60vh}.selection-button-div{padding:4px 10px}`;class n extends o.WF{constructor(){super(...arguments),this.popoverNode=(0,r._)(),this.flowNode=(0,r._)(),this.flowItemNode=(0,r._)(),this.listNode=(0,r._)(),this.dropdownNode=(0,r._)(),this.maxNumberFieldCount=10,this.selectedFields=[],this.isOpen=!1,this.singleEditMode=!1,this.lastSortBy="default",this.arcgisSmartMappingFieldPickListChange=(0,o.lh)(),this.arcgisSmartMappingFieldPickListClose=(0,o.lh)(),this.arcgisSmartMappingFieldPickListSortByChange=(0,o.lh)()}static{this.properties={filterFields:16,isOpen:16,width:16,fields:0,fieldToReplace:0,popoverProps:0,singleEditMode:5,heading:1,okBtnText:1,filterPlaceholderText:1,lastSortBy:1,smartMappingState:0}}static{this.styles=c}async reposition(){await(this.popoverNode.value?.reposition())}async setFocus(){await(this.flowItemNode.value?.setFocus())}load(){this.isOpen=!0,this.rendererFieldInfosMap=this.smartMappingState.selectedFields?.reduce((e,t)=>(e[t.field]=t,e),{})}async loaded(){this.setUpObservers(),this.resizeObserver?.observe(this.popoverProps.refElement),this.checkDisabledListItems().forEach(e=>e.remove()),requestAnimationFrame(async()=>await(this.flowItemNode.value?.setFocus()))}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),this.resizeObserver?.disconnect()}checkDisabledListItems(){const{smartMappingState:e}=this,{mapImageSublayer:t,supportsArcade:i}=e;if(!this.listNode.value)return;const s=(0,d.aD)(e);this.singleEditMode?s[this.fieldToReplace.simpleFieldType]--:this.selectedFields.forEach(t=>{const i=(0,d.K)(e,t);if(i)switch(i.simpleFieldType){case"number":s.number++;break;case"string":s.string++;break;case"date":s.date++}});const l=[];if(this.listNode.value.querySelectorAll("calcite-list-item").forEach(e=>this.enableListItem(e)),t&&!i&&s.number+s.string+s.date+s.unknown===1)this.listNode.value.querySelectorAll('[data-type="string"], [data-type="number"], [data-type="date"]').forEach(e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),l.push(t))});else if(t&&1===s.date)this.listNode.value.querySelectorAll('[data-type="date"]').forEach(e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),l.push(t))});else if(1===s.string)this.listNode.value.querySelectorAll('[data-type="string"]').forEach(e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),l.push(t))}),(1===s.number||1===s.date||1===s.unknown)&&this.listNode.value.querySelectorAll('[data-type="number"], [data-type="date"]').forEach(e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),l.push(t))});else if(s.number+s.date+s.unknown>1)if(s.expression>0&&(1!==s.expression||3!==this.selectedFields.length||!this.rendererFieldInfosMap[this.selectedFields[2]].expression)||s.date>0&&2===s.number&&!this.singleEditMode||2===s.date||t&&s.date>0){let e;e=this.singleEditMode?this.fieldToReplace.simpleFieldType===d.J.NUMBER?'[data-type="date"], [data-type="string"]':d.J.STRING?'[data-type="date"], [data-type="number"]':'[data-type="string"], [data-type="number"]':'[data-type="date"], [data-type="string"], [data-type="number"]',this.listNode.value.querySelectorAll(e).forEach(e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),l.push(t))})}else this.listNode.value.querySelectorAll('[data-type="string"]').forEach(e=>{const t=e;this.disableListItem(t),l.push(t),this.selectedFields.includes(t.value)&&(t.selected=!1)}),(s.number>2||t)&&this.listNode.value.querySelectorAll('[data-type="date"]').forEach(e=>{const t=e;this.disableListItem(t),l.push(t),this.selectedFields.includes(t.value)&&(t.selected=!1)}),1===s.date&&this.listNode.value.querySelectorAll('[data-type="date"]').forEach(e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),l.push(t))}),s.number>=this.maxNumberFieldCount&&this.listNode.value.querySelectorAll('[data-type="number"], [data-type="date"]').forEach(e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),l.push(t))});return l}disableListItem(e){e.disabled=!0;const t=e.querySelector("calcite-action");t&&(t.disabled=!0)}enableListItem(e){e.disabled=!1;const t=e.querySelector("calcite-action");t&&(t.disabled=!1)}getSortedList(){const e=[...this.fields];return"field"===this.lastSortBy?e.sort((e,t)=>e.layerField.name.startsWith("_")?1:t.layerField.name.startsWith("_")?-1:e.layerField.name.localeCompare(t.layerField.name)):e.sort((e,t)=>e.label.startsWith("_")?1:t.label.startsWith("_")?-1:e.label.localeCompare(t.label)),e}setUpObservers(){this.mutationObserver=new MutationObserver(e=>{for(const t of e)"style"===t.attributeName&&"hidden"===this.popoverNode.value.style.visibility&&(this.dropdownNode.value.open=!1)}),this.resizeObserver=new ResizeObserver(e=>{const t=e.pop();this.width=1.05*t.contentRect.width})}render(){const e=this.popoverProps,{_messages:t}=this.smartMappingState;return this.el.classList.add("js-app-flyout"),l.qy`<calcite-popover class="smart-mapping-field-pick-list-popover" .placement=${e.placement||"leading-start"} .open=${this.isOpen} pointer-disabled .referenceElement=${e.refElement} .offsetDistance=${e.offsetDistance??-1*(e.popoverWidth??this.width)+10} .offsetSkidding=${e.offsetSkidding||0} .overlayPositioning=${e.overlayPositioning} trigger-disabled .label=${this.heading||(this.singleEditMode?t.replaceField:t.fieldPickList.selectFields)} ${(0,r.K)(this.popoverNode)}><calcite-flow style=${(0,o.zl)({width:`${this.width||e.popoverWidth}px`})} ${(0,r.K)(this.flowNode)}><calcite-flow-item class="panel" .heading=${this.heading||(this.singleEditMode?t.replaceField:t.fieldPickList.selectFields)} closable @calciteFlowItemClose=${()=>this.arcgisSmartMappingFieldPickListClose.emit(void 0)} ${(0,r.K)(this.flowItemNode)}>${!this.singleEditMode&&this.renderAddButton()||""}${this.renderCancelButton()}${this.renderList()}</calcite-flow-item></calcite-flow></calcite-popover>`}renderAddButton(){const{_messages:e}=this.smartMappingState;return l.qy`<calcite-button slot=footer appearance=solid width=half @click=${()=>this.arcgisSmartMappingFieldPickListClose.emit({selectedFields:this.selectedFields})}>${this.okBtnText||e.add}</calcite-button>`}renderCancelButton(){const{_messages:e}=this.smartMappingState;return l.qy`<calcite-button slot=footer appearance=outline-fill .width=${this.singleEditMode?"full":"half"} @click=${()=>this.arcgisSmartMappingFieldPickListClose.emit(void 0)}>${e.cancel}</calcite-button>`}renderList(){const{_messages:e}=this.smartMappingState;return l.qy`<calcite-list .label=${e.fieldPickList.fields} .selectionMode=${this.singleEditMode?"single-persist":"multiple"} class="content" .filterEnabled=${this.fields.length>=10} .filterPlaceholder=${this.filterPlaceholderText??e.fieldPickList.searchFields} @calciteListFilter=${()=>{this.filterFields=this.listNode.value?.filteredItems?.map(e=>e.value)}} ${(0,r.K)(this.listNode)}>${this.renderSortDropdown()}${this.renderListItems()}</calcite-list>`}renderListItems(){return"type"===this.lastSortBy?this.renderItemsSortedByType():["display","field"].includes(this.lastSortBy)?[...this.getSortedList()].map(e=>this.renderListItem(e)):[...this.fields].map(e=>this.renderListItem(e))}renderItemsSortedByType(){const e=[...this.getSortedList()];return e.filter(e=>e.simpleFieldType===d.J.NUMBER).map(e=>this.renderListItem(e)).concat(e.filter(e=>e.simpleFieldType===d.J.STRING).map(e=>this.renderListItem(e))).concat(e.filter(e=>e.simpleFieldType===d.J.DATE).map(e=>this.renderListItem(e))).concat(e.filter(e=>e.simpleFieldType===d.J.OID).map(e=>this.renderListItem(e))).concat(e.filter(e=>e.simpleFieldType===d.J.GUID).map(e=>this.renderListItem(e))).concat(e.filter(e=>e.simpleFieldType===d.J.UNKNOWN).map(e=>this.renderListItem(e)))}renderListItem(e){const{layer:t,useFeatureReduction:i,mapView:s,_messages:d}=this.smartMappingState;return(0,a.D)(e.layerField.name,l.qy`<calcite-list-item .label=${e.label||e.layerField.name} data-type=${e.simpleFieldType??o.s6} .value=${e.layerField.name} .selected=${this.singleEditMode&&e.layerField.name===this.fieldToReplace.field} .metadata=${{label:e.label,fieldName:e.layerField.name}} @click=${e=>{e.shiftKey&&(e.preventDefault(),this.listNode.value?.selectedItems.forEach(e=>{e.selected=this.selectedFields.includes(e.value)}))}} @calciteListItemSelect=${()=>{setTimeout(()=>{this.selectedFields=this.listNode.value.selectedItems.map(e=>e.value),this.singleEditMode?this.selectedFields[0]!==this.fieldToReplace.field&&this.arcgisSmartMappingFieldPickListClose.emit({selectedFields:this.selectedFields}):(this.checkDisabledListItems(),this.arcgisSmartMappingFieldPickListChange.emit({selectedFields:this.selectedFields}))},20)}}>${!i&&l.qy`<calcite-action slot=actions-end .text=${d.fieldPickList.info} scale=s icon=information @click=${i=>{i.stopPropagation();const a=i.currentTarget,d=(0,o.dN)(l.qy`<calcite-flow-item .heading=${e.label??e.layerField.name} .description=${e.layerField.name} @calciteFlowItemBack=${()=>{requestAnimationFrame(async()=>await a.setFocus()),d.remove(),this.flowItemNode.value.selected=!0}}><arcgis-field-info class="content" .fieldName=${e.layerField.name} .layer=${t} .view=${s}></arcgis-field-info></calcite-flow-item>`);this.flowNode.value.appendChild(d),d.selected=!0,this.flowItemNode.value.selected=!1,requestAnimationFrame(async()=>await d.setFocus())}}></calcite-action>`||""}</calcite-list-item>`)}renderSortDropdown(){const{_messages:e}=this.smartMappingState;return this.fields.length>10?l.qy`<calcite-dropdown placement=bottom-end overlay-positioning=fixed slot=filter-actions-end @calciteDropdownOpen=${()=>{this.mutationObserver?.disconnect(),this.mutationObserver?.observe(this.popoverNode.value,{attributes:!0})}} @calciteDropdownClose=${()=>this.mutationObserver?.disconnect()} ${(0,r.K)(this.dropdownNode)}><calcite-action slot=trigger .text=${e.fieldPickList.sort} title=${e.fieldPickList.sort??o.s6}><calcite-icon scale=s icon=sortDescending flip-rtl></calcite-icon></calcite-action><calcite-dropdown-group><calcite-dropdown-item label=default .selected=${"default"===this.lastSortBy} @click=${()=>{this.lastSortBy="default",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="default",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy))}}>${e.fieldPickList.default}</calcite-dropdown-item><calcite-dropdown-item label=display .selected=${"display"===this.lastSortBy} @click=${()=>{this.lastSortBy="display",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="display",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy))}}>${e.fieldPickList.displayName}</calcite-dropdown-item><calcite-dropdown-item label=type .selected=${"type"===this.lastSortBy} @click=${()=>{this.lastSortBy="type",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="type",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy))}}>${e.fieldPickList.type}</calcite-dropdown-item><calcite-dropdown-item label=field .selected=${"field"===this.lastSortBy} @click=${()=>{this.lastSortBy="field",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="field",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy))}}>${e.fieldPickList.fieldName}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown>`:""}}(0,s.c)("arcgis-map-config-smart-mapping-field-pick-list",n)},46317:(e,t,i)=>{i.d(t,{D:()=>d});var s=i(85282),l=i(34670),a=i(42466);const d=(0,l.u$)(class extends l.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,a.mY)(e),this.key=t),i}})}}]);