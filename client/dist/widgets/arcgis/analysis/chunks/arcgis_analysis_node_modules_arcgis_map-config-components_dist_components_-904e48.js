/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-904e48.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-904e48"],{10763:(e,t,a)=>{a.d(t,{c:()=>s,u:()=>o});var i=a(83552),r=a(20936);function s(e){e.mapView=void 0,e.portal=void 0,e.config=void 0,e.layerDisplayType=void 0,e.serviceType=void 0,e.layerHasAttributes=!0,e.layerSupportsAttachments=!1,e.layerHasCharts=!0,e.layerHasImages=!0,e.layerHasText=!0,e.layerSupportsArcade=!1,e.layerHasRelatedRecords=!1,e.layerIsUNLayer=!1,e.layerHasEditInfo=!1,e.blockFeatureReductionArcade=!1,e.allowTimeSeriesConfiguration=!1}function o(){const e=(0,i.Gk)(),t=e;e.manager.onLoad(()=>{t.popupState=function(e,t){const a=n.get(e);if(a)return a;const i=(0,r.el)(e,t);return i&&"store"in i?(n.set(e,i.store),i.store):null}(e.el,"arcgis-map-config-popup")})}const n=new WeakMap},42855:(e,t,a)=>{a.d(t,{a:()=>o,f:()=>i,l:()=>r,s:()=>s});var i=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(i||{}),r=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(r||{}),s=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(s||{}),o=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(o||{})},43022:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigPopupRichtext:()=>u});var i=a(73679),r=a(4395),s=a(52797),o=a(73801),n=a(66228),l=a(10763),c=a(60701),p=a(85643);class u extends o.WF{constructor(){super(),this.buttonNode=(0,p._)(),this.arcadeExpMap=new Map,this.popupState=(0,l.u)(),this.blockOpen=!1,this.arcgisChange=(0,o.lh)(),this.closePopupPopovers=(0,o.lh)(),this.disablePopupPanel=(0,o.lh)(),this.listenOn(window,"arcadeChangeNotification",this.arcadeChangeNotificationHandler),this.listenOn(window,"closePopupPopovers",this.closePopupPopoversHandler)}static{this.properties={popupFlowItem:0,blockOpen:5,popupTextContent:0,fieldExpressionData:0,arcgisColorPickerData:0}}loaded(){this.setUpCkEditorMentionFields(),this.blockOpen&&this.openRichTextEditor()}disconnectedCallback(){super.disconnectedCallback(),this.ckEditorPopoverNode?.remove()}arcadeChangeNotificationHandler(){this.setUpCkEditorMentionFields()}closePopupPopoversHandler(){this.ckEditorPopoverNode&&(this.ckEditorPopoverNode.remove(),this.ckEditorPopoverNode=void 0,this.disablePopupPanel.emit(!1))}setUpCkEditorMentionFields(){const{popupState:e}=this,{layer:t,popupTemplate:a}=e;this.ckEditorMentionFields=[],this.arcadeExpMap=(0,n.h)(a),a.fieldInfos?.forEach(e=>{e.fieldName&&this.ckEditorMentionFields.push({id:`{${e.fieldName}}`,name:(0,n.j)(t,e,this.arcadeExpMap)})})}openRichTextEditor(){const{popupState:e}=this,{_messages:t,popupTemplate:a}=e;this.closePopupPopovers.emit(),this.ckEditorPopoverNode=(0,o.dN)(r.qy`<arcgis-ckeditor5-popover .guid=${(0,c.DA)()} .refElement=${this.popupFlowItem} .intlOk=${t.ok} .intlCancel=${t.cancel} @arcgisPopoverClosed=${e=>{e.stopPropagation(),(0,n.i)(e.detail?.data?.length)&&(this.popupTextContent.text=e.detail.data,this.requestUpdate(),this.arcgisChange.emit()),this.closePopupPopovers.emit(),setTimeout(()=>this.buttonNode.value?.setFocus(),300)}}></arcgis-ckeditor5-popover>`);const i=(0,o.dN)(r.qy`<arcgis-ckeditor5 .customConfig=${{FieldExpression:{...this.fieldExpressionData,layer:void 0,mapView:void 0},ArcgisColorPicker:{...this.arcgisColorPickerData,enableFields:!!this.arcgisColorPickerData.data?.length}}} .textData=${this.popupTextContent.text??""} .mentionFields=${this.ckEditorMentionFields} .intlTextPlaceHolder=${a.fieldInfos?.length?t.textPlaceHolder:t.textPlaceHolderLabel} .currentLanguage=${s.getLocale()}></arcgis-ckeditor5>`);i.setFocus(),this.ckEditorPopoverNode.appendChild(i),document.body.appendChild(this.ckEditorPopoverNode),this.disablePopupPanel.emit(!0)}render(){const{popupState:e}=this,{_messages:t}=e;return r.qy`<calcite-button appearance=transparent width=full @click=${()=>this.openRichTextEditor()} ${(0,p.K)(this.buttonNode)}>${t.editText}</calcite-button>`}}(0,i.c)("arcgis-map-config-popup-richtext",u)},66228:(e,t,a)=>{a.d(t,{a:()=>w,b:()=>N,c:()=>M,d:()=>E,e:()=>F,f:()=>R,g:()=>m,h:()=>h,i:()=>y,j:()=>g,k:()=>x,l:()=>O,m:()=>k,n:()=>d,o:()=>P,p:()=>_,q:()=>I,r:()=>$,s:()=>v,t:()=>C,u:()=>b});var i=a(63438),r=a(18423),s=a(96086),o=a(91813),n=a(21255),l=a(13078),c=a(21303),p=a(12627),u=a(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],f=["feature"];function y(e){return null!=e}function g(e,t,a){const i=t.fieldName;if(i.includes(u.f.expression)){const e=a.get(i);return e?.title?e.title:i}return v(e)&&e.getFieldConfiguration(i)?e.getFieldAlias(i)||i:t.label||i}async function m(e){return new Map((await x(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function h(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const a=`${u.f.expression}${e.name}`;t.set(a,e)}),t}function w(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function b(e){const t=w(e);let a;return t===u.s.wms||t===u.s.mapImage?a=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(a=e.version),Number.parseFloat(a)}function v(e){return"fieldConfigurations"in e&&f.includes(e.type)}async function x(e){return await new Promise((t,a)=>{switch(w(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const i=e,r=i?.layer;r?.portalItem&&r.url.includes("https://demographics")&&r.url.includes(".arcgis.com")?r.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const a=new Map(i.fields.map(e=>[e.name,e])),r=e.thematicGroup.fieldNames,s=[];r.forEach(e=>{a.has(e)&&s.push(a.get(e))}),t(s)}else t(i.fields)}).catch(e=>{a(new Error(e))}):t(i.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function P(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function k(e){return Number((100*(1-e)).toFixed(1))}function C(e){return Number((1-e/100).toFixed(3))}const E=(e,t)=>{const a=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||a.push({name:e.fieldName,alias:e.label,type:"string"})}),a},N=async(e,t)=>{const a=new p.default;return a.geometry=t.extent,a.mapExtent=t.extent,a.returnGeometry=!0,a.tolerance=6,a.layerOption="popup",a.width=t.width,a.height=t.height,a.layerIds=[e.id],(await c.identify(e.layer.url,a))?.results?.[0]?.feature},F=async(e,t,a)=>{const i=await(await e.whenLayerView(t)).queryAggregates();return await T(a,i.features?.[0])},T=async(e,t)=>{let a;if(t)a=t.clone();else{a=new i.default;const t=E(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),a.attributes=e}const s=new r.default;a.geometry=s}return a};function I(e,t){const a=t.startsWith("#"),i=t.startsWith(".");for((i||a)&&(t=t.slice(1));e;){if(a){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function M(e){if(w(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function O(e,t,a){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const a=t.get(e);i=a.type?a.type.toLowerCase():""}else if(a.has(e)){const t=a.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function R(e,t){try{const a=w(e);if(a===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await N(e,t)||await S(e,t)]};if(a===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await S(e,t)]};const i=a===u.s.ogcFeature||a===u.s.stream?await t.whenLayerView(e):e,r=i.createQuery();r.where=i.definitionExpression||"1=1",r.outFields=["*"],r.returnM="hasM"in e&&e.hasM,r.returnZ="hasZ"in e&&e.hasZ,r.outSpatialReference=t.spatialReference,r.returnGeometry=!0,(i.sourceJSON?.advancedQueryCapabilities?.supportsPagination||a===u.s.ogcFeature)&&(r.start=0,r.num=1),r.outSpatialReference=t.spatialReference;const s=await i.queryFeatures(r);return s?.features?.length||(s.features[0]=await S(e,t)),s}catch(e){console.error(e)}}async function S(e,t){return await new Promise(a=>{const r=new i.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),r.attributes=t}const c=t.extent;let p;"polygon"===e.geometryType?p=n.default.fromExtent(c):"point"===e.geometryType?p=c.center.clone():"multipoint"===e.geometryType?p=new s.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(p=new o.default({spatialReference:t.spatialReference.clone()}),p.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(p=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),r.geometry=p,a(r)})}function $(e){return w(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function _(e){return w(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);