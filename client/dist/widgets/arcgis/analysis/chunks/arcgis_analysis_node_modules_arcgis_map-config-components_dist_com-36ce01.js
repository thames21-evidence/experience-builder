/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-36ce01.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-36ce01"],{71239:(e,i,t)=>{t.r(i),t.d(i,{ArcgisMapConfigSmartMappingPanelsGallery:()=>C});var a=t(73679),s=t(4395),n=t(46317),r=t(5294),l=t(55448),o=t(1225),c=t(89989),p=t(33543),d=(t(52797),t(34031),t(63438),t(5933),t(75518)),m=(t(89704),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(65595)),g=(t(54312),t(77462),t(49403),t(66617),t(10628),t(59640),t(64451),t(6176),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(28927),t(6238),t(7299),t(44345),t(66228)),h=t(20936),u=(t(83552),t(10281),t(83930),t(42987)),f=t(28973),y=t(87735),z=t(19479),S=t(89374),F=t(18383),T=t(13494),b=t(29997),E=t(92264),v=t(78778),P=t(17581),M=t(11751),I=t(85643),x=t(73801),w=t(71384);let k;function $(e,i){k&&clearTimeout(k),k=setTimeout(()=>{k=null,N(e,i)},1e3)}function N(e,i){const{selectedFields:t,layer:a,mapImageSublayer:s}=e,n="ogc-feature"===a.type,r="wfs"===a.type,l="parquet"===a.type,c=a.capabilities?.query?.supportsSqlExpression,p=n||r||l||c,d=t.map(i=>(0,o.K)(e,i.field)),m=(0,o._)(e),h=(0,o.d)(e);if(!(0,o.aG)(t,m))if(0===t.length)i("heatmap"===h?(0,S.c)(e):(0,u.c)(e));else if(1===t.length){const n=d[0];if("heatmap"!==h||!p||t[0].expression||t[0].featureReductionExpression||t[0].simpleFieldType!==o.J.NUMBER)if("color-size"===h&&(0,o.N)(t[0],m[0]))i((0,f.d)(e,{fieldInfos:t}));else if("type-size"===h&&(0,o.N)(t[0],m[0]))i((0,E.c)(e,{fieldInfos:t}));else if(["color-size","type-size"].includes(h)&&(0,o.N)(t[0],m[m.length>1?1:0]))i((0,y.f)(e,{fieldInfos:t}));else if(t[0].expression||t[0].featureReductionExpression)t[0].simpleFieldType===o.J.NUMBER||t[0].simpleFieldType===o.J.DATE?i((0,f.d)(e,{fieldInfos:t})):i((0,E.c)(e,{fieldInfos:t}));else if(n.simpleFieldType===o.J.STRING||"string"===(0,o.aH)(e,n)||"domain"in n.layerField&&n.layerField.domain)i((0,E.c)(e,{fieldInfos:t}));else if(["integer","double","single","small-integer","big-integer"].includes((0,o.L)(e,n.layerField))&&"objectIdField"in a&&a.objectIdField!==n.layerField.name)if((0,o.m)(e))"featureReduction"in a&&a.featureReduction?i((0,f.d)(e,{fieldInfos:t})):i((0,y.f)(e,{fieldInfos:t}));else if((0,o.n)(e))i((0,y.f)(e,{fieldInfos:t}));else{const a=(0,o.aH)(e,n);["integer","small-integer","big-integer"].includes((0,o.L)(e,n.layerField))||(0,g.i)(a)&&"integer"===a?i((0,y.f)(e,{fieldInfos:t})):i((0,f.d)(e,{fieldInfos:t}))}else"date"===(0,o.L)(e,n.layerField)&&("color-age-size"===h&&(0,o.N)(t[0],m[0])?i((0,f.e)(e,{fieldInfos:t})):["color-size-age","type-size-age"].includes(h)&&(0,o.N)(t[0],m[1])?i((0,y.g)(e,{fieldInfos:t})):i(s?(0,f.e)(e,{fieldInfos:t}):(0,f.d)(e,{fieldInfos:t})));else i((0,S.c)(e,{fieldInfos:t}))}else if(2===t.length){const a=d[0];"type"!==h&&"type-size"!==h||!(0,o.N)(t[0],m[0])?t[0].expression||t[0].featureReductionExpression?t[0].simpleFieldType===o.J.NUMBER&&t[1].simpleFieldType===o.J.NUMBER?i((0,P.h)(e,{fieldInfos:t})):i((0,P.j)(e,{fieldInfos:t})):t[0].simpleFieldType===o.J.STRING||"string"===(0,o.aH)(e,a)||"domain"in a.layerField&&a.layerField.domain?t[1].simpleFieldType===o.J.DATE&&(["color-size-age","type-size-age"].includes(h)||s)?i((0,P.i)(e,{fieldInfos:t})):i((0,P.j)(e,{fieldInfos:t})):t[0].simpleFieldType===o.J.DATE||t[1].simpleFieldType===o.J.DATE?t[0].simpleFieldType===o.J.DATE&&(["color-age","color-age-size"].includes(h)||s)?i((0,P.g)(e,{fieldInfos:t})):t[1].simpleFieldType===o.J.DATE&&(["color-size-age","type-size-age"].includes(h)||s)?i((0,P.f)(e,{fieldInfos:t})):i((0,P.h)(e,{fieldInfos:t})):t[0].expression||t[0].featureReductionExpression||t[1].expression||t[1].featureReductionExpression?i((0,P.h)(e,{fieldInfos:t})):"dot-density"===h?i((0,z.b)(e,{fieldInfos:t})):"predominance"===h?i((0,F.a)(e,{fieldInfos:t})):"predominance-size"===h?i((0,F.a)(e,{fieldInfos:t,includeSizeVariable:!0})):"chart"===h?i((0,T.a)(e,{fieldInfos:t})):"chart-size"===h?i((0,T.a)(e,{fieldInfos:t,includeSizeVariable:!0})):"compare"===h?i((0,b.c)(e,{fieldInfos:t})):["relationship","relationship-size"].includes(h)?i((0,v.a)(e,{fieldInfos:t})):i((0,P.h)(e,{fieldInfos:t})):i((0,P.j)(e,{fieldInfos:t}))}else 3===t.length&&(["relationship","relationship-size"].includes(h)||t[2].expression||t[2].featureReductionExpression||!p)?i((0,z.a)(e,{fieldInfos:t})):"dot-density"===h&&t.length<=8?i((0,z.b)(e,{fieldInfos:t})):"predominance-size"===h?i((0,F.a)(e,{fieldInfos:t,includeSizeVariable:!0})):"chart"===h?i((0,T.a)(e,{fieldInfos:t,includeSizeVariable:!1})):"chart-size"===h?i((0,T.a)(e,{fieldInfos:t,includeSizeVariable:!0})):s&&!p||t[2].simpleFieldType===o.J.DATE?i((0,z.a)(e,{fieldInfos:t})):i((0,F.a)(e,{fieldInfos:t}))}const R=s.AH`:host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.clustering-warning-notice{margin:var(--calcite-spacing-lg)}.generate-block{--calcite-panel-background-color: var(--calcite-color-foreground-1);padding:0 var(--calcite-spacing-sm)}.generate-title{font-weight:var(--calcite-font-weight-bold);padding-top:var(--calcite-spacing-xs);font-size:var(--calcite-font-size-0)}.generate-description{padding-top:var(--calcite-spacing-xs);font-size:var(--calcite-font-size--1)}.generate-button{padding-right:var(--calcite-spacing-xs)}:dir(rtl){.generate-button{padding-left:var(--calcite-spacing-xs);padding-right:0}}.separator{display:flex;align-items:center;margin-bottom:var(--calcite-spacing-sm)}.time-series-separator{margin-top:var(--calcite-spacing-sm)}.separator-line{flex-grow:1;height:var(--calcite-spacing-px);background-color:var(--calcite-color-border-1);margin:0 var(--calcite-spacing-md)}.separator-text{padding:0 var(--calcite-spacing-xl);color:var(--calcite-color-text-1);font-weight:var(--calcite-font-weight-bold)}.add-button-div{margin:0 3px}.add-buttons{display:flex;justify-content:center}.attributes{padding:6px 6px 0;background-color:#fff}.attributes-header-text{font-weight:700;font-size:16px;margin-top:var(--calcite-spacing-sm);margin-bottom:var(--calcite-spacing-xs)}.attributes-link-info{margin-inline-start:5px}.attributes-msg{font-size:var(--calcite-font-size--2)}.attributes-add-new{margin-top:10px}.split-button-button{display:block;margin:var(--calcite-spacing-xs)}.tip{margin-top:15px;display:flex;justify-content:space-between}.tip-message{justify-content:center}.tip-text{color:#3d5f1d}.tip-close{margin-top:4px}.field-type{display:flex;align-items:center;height:100%;color:var(--calcite-color-text-1)}.attribute-list{border-bottom:1px solid #e0e0e0}.gallery-block{padding:12px 3px;margin-bottom:12px;background-color:#fff;box-shadow:0 1px 10px 2px #0000000d,0 0 0 1px #e0e0e0}.style-tiles{overflow-x:hidden}.center{display:flex;align-items:center;justify-content:center;text-align:center}.number-icon{color:var(--calcite-color-brand)}.styles-msg-title{padding:6px;font-weight:700;font-size:16px;display:flex;justify-content:center}.styles-msg{font-size:var(--calcite-font-size--2)}`;class C extends x.WF{constructor(){super(...arguments),this.flowItemNode=(0,I._)(),this.attributesInfoIconNode=(0,I._)(),this.listNode=(0,I._)(),this.addFieldButtonNode=(0,I._)(),this.tilesNode=(0,I._)(),this.fieldsSelection=[],this.lastSortBy="default",this.hasArcadeTimeExpressionChange=!1,this.smartMappingState=(0,m.u)(),this.galleryRequestWrapper=e=>{const{smartMappingState:i}=this,{_messages:t}=i;(0,d.r)(e,this.flowItemNode.value).then(e=>{const{layer:a,allowTimeSeriesConfiguration:s}=i;if(s&&this.timeSeriesInfo?.startTime&&!e.renderer.defaultSymbol){const a=(0,o.e)(i);e.renderer.defaultSymbol=a,e.renderer.defaultLabel=e.renderer.defaultLabel||t.defaultSymbol.other}(0,o.a4)(i,e.renderer),queueMicrotask(()=>{this.syncDisplayWithCurrentFieldsOrder(),this.requestUpdate()}),"featureReduction"in a&&"cluster"===a.featureReduction?.type&&(this.checkCluster(),this.checkClusterRenderer()),this.focusSelectedTile(),this.handleArcadeTimeExpressionChange()},()=>{this.arcgisSmartMappingPanelsGalleryError.emit({message:t.panels.gallery.errors.changeRendererErrorMsg,type:"warning"})})},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisSmartMappingPanelsGalleryArcadeTimeExpressionChange=(0,x.lh)(),this.arcgisSmartMappingPanelsGalleryClose=(0,x.lh)(),this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate=(0,x.lh)(),this.arcgisSmartMappingPanelsGalleryError=(0,x.lh)(),this.smartMappingCompleteClose=(0,x.lh)()}static{this.properties={menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=R}async setFocus(){await(this.flowItemNode.value?.setFocus())}load(){const{smartMappingState:e}=this,{layer:i}=e,t=(0,o.g)(this.smartMappingState);this.originalRendererJSON=t.toJSON(),this.originalFeatureReduction="featureReduction"in i&&i.featureReduction?r.clone(i.featureReduction):void 0,this.flowNode=(0,h.el)(this.el,"calcite-flow");const a=l.urlToObject(document.URL);this.urlObjectQuery=a.query||{},this.syncDisplayWithCurrentFieldsOrder()}async loaded(){requestAnimationFrame(async()=>await(this.flowItemNode.value?.setFocus())),this.setUpWatchFeatureReductionScale(!0)}disconnectedCallback(){super.disconnectedCallback(),this.scaleHandle?.remove()}addExpressionButtonRefHandler(e){this.addExpressionButtonNode=e}syncDisplayWithCurrentFieldsOrder(){const{smartMappingState:e}=this,{selectedFields:i}=e;this.fieldsSelection=[],this.fieldsSelection=i.map(e=>this.renderAttribute(e))}handleGenerateClick(){const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-assist .showBackButton=${!0} selected @arcgisSmartMappingPanelsAssistClose=${()=>{this.removeFlowItem(e),this.focusSelectedTile(),setTimeout(()=>this.focusSelectedTile(),500)}} @arcgisSmartMappingPanelsAssistBackClick=${()=>{this.requestUpdate(),setTimeout(()=>this.focusSelectedTile(),500),this.removeFlowItem(e)}} @arcgisSmartMappingPanelsAssistError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)} @arcgisSmartMappingPanelsAssistClusterRequiresUpdate=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit(e)}></arcgis-map-config-smart-mapping-panels-assist>`);this.appendFlowItem(e),this.selected=!1}handleAttributesInfoClick(){const{smartMappingState:e}=this,{_messages:i}=e;this.infoPopoverNode&&document.body.contains(this.infoPopoverNode)?this.removeAttributesInfoPopover():(this.el.shadowRoot.querySelectorAll("arcgis-map-config-smart-mapping-tile").forEach(e=>e.removePopover()),this.infoPopoverNode=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-info-popover .smartMappingState=${e} .props=${{title:null,titleOverride:i.panels.gallery.choosingAttributes,moreInfo:i.panels.gallery.chooseAttributesMsgWithTips,helpId:"120003249",flowItemNode:this.flowItemNode.value}} .referenceElement=${this.attributesInfoIconNode.value} @arcgisSmartMappingInfoPopoverClose=${()=>{this.removeAttributesInfoPopover(),setTimeout(()=>this.attributesInfoIconNode.value.setFocus(),200)}}></arcgis-map-config-smart-mapping-info-popover>`),document.body.append(this.infoPopoverNode),this.infoPopoverNode.open=!0,this.infoPopoverNode.reposition(),setTimeout(()=>this.infoPopoverNode?.setFocus(),100))}removeAttributesInfoPopover(){this.infoPopoverNode?.remove(),this.infoPopoverNode=void 0}addField(e){const{smartMappingState:i}=this,{layer:t,selectedFields:a,useFeatureReduction:s}=i;(0,o.aI)(i,e);const n=s?a.find(e=>"aggregateCount"===e.field):void 0,l=n?r.clone(a).filter(e=>"aggregateCount"!==e.field):r.clone(a);if(e.forEach(e=>{const a=(0,o.K)(i,e);let n;"featureReduction"in t&&s&&(n=t.featureReduction.fields.find(e=>e.name===a.layerField.name&&e.onStatisticExpression)),a.simpleFieldType===o.J.STRING||s&&a.simpleFieldType===o.J.DATE?n?l.unshift({field:e,simpleFieldType:a.simpleFieldType,featureReductionExpression:n.onStatisticExpression.expression,featureReductionExpressionTitle:n.onStatisticExpression.title??void 0}):l.unshift({field:e,simpleFieldType:s&&a.simpleFieldType===o.J.DATE?o.J.DATE:o.J.STRING}):n?l.push({field:e,simpleFieldType:a.simpleFieldType,featureReductionExpression:n.onStatisticExpression.expression,featureReductionExpressionTitle:n.onStatisticExpression.title??void 0}):l.push({field:e,simpleFieldType:a.simpleFieldType})}),3===l.length)for(let e=0;e<3;e++){const i=l[e];if(i.simpleFieldType===o.J.DATE&&2!==e){l.splice(e,1),l.splice(2,0,i);break}}n&&l.push(n),(0,o.aG)(a,l)||(this.smartMappingState.selectedFields=l,$(i,this.galleryRequestWrapper))}editAttribute(e,i){const{smartMappingState:t}=this,{layer:a,selectedFields:s,useFeatureReduction:n}=t;(0,o.aI)(t,e);const l=r.clone(s);e.forEach(e=>{const r=(0,o.K)(t,e);let l;"featureReduction"in a&&n&&(l=a.featureReduction.fields.find(e=>e.name===r.layerField.name&&e.onStatisticExpression)),r.simpleFieldType===o.J.STRING||n&&r.simpleFieldType===o.J.DATE?(s.splice(i,1),l?s.unshift({field:e,simpleFieldType:r.simpleFieldType,featureReductionExpression:l.onStatisticExpression.expression,featureReductionExpressionTitle:l.onStatisticExpression.title??void 0}):s.unshift({field:e,simpleFieldType:n&&r.simpleFieldType===o.J.DATE?o.J.DATE:o.J.STRING})):s[i]=l?{field:e,simpleFieldType:r.simpleFieldType,featureReductionExpression:l.onStatisticExpression.expression,featureReductionExpressionTitle:l.onStatisticExpression.title??void 0}:{field:e,simpleFieldType:r.simpleFieldType}}),(0,o.aG)(s,l)||(this.syncDisplayWithCurrentFieldsOrder(),this.smartMappingState.selectedFields=s,$(t,this.galleryRequestWrapper))}async addExpression(){const{smartMappingState:e}=this;this.addExpressionButtonNode.disabled=!0,(0,o.f)();const i=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-modal-arcade .smartMappingState=${e} allow-configure-time-series @arcgisClose=${e=>{i.remove(),this.addExpressionButtonNode.disabled=!1,e.detail&&this.addExpressionHandler(e.detail)}}></arcgis-map-config-smart-mapping-modal-arcade>`);document.body.appendChild(i)}async addExpressionHandler(e){const{smartMappingState:i}=this,{useFeatureReduction:t}=i;e.simpleFieldType===o.J.UNKNOWN&&(e.simpleFieldType=o.J.NUMBER);const{selectedFields:a,_messages:s}=this.smartMappingState;if(2===a.length&&e?.simpleFieldType===o.J.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:s.panels.gallery.errors.expressionMustBeNumber,type:"warning"});if(1===a.length&&a[0].simpleFieldType===o.J.STRING&&e?.simpleFieldType===o.J.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:s.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const n=t?a.find(e=>"aggregateCount"===e.field):void 0,l=n?r.clone(a).filter(e=>"aggregateCount"!==e.field):r.clone(a);if(l.push(e),3===l.length)for(let e=0;e<3;e++){const i=l[e];if(i.simpleFieldType===o.J.DATE&&2!==e){l.splice(e,1),l.splice(2,0,i);break}}n&&l.push(n),l.length>1&&l[1].simpleFieldType===o.J.STRING&&l.reverse(),this.smartMappingState.selectedFields=l,e.expression?.includes(w.a)&&(this.hasArcadeTimeExpressionChange=!0,e.timeSeriesInfo&&(this.timeSeriesInfo=e.timeSeriesInfo)),$(i,this.galleryRequestWrapper)}async handleArcadeEdit(e){(0,o.f)();const{smartMappingState:i}=this,{selectedFields:t}=i,a=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-modal-arcade .smartMappingState=${i} .fieldInfo=${t[e]} allow-configure-time-series @arcgisClose=${i=>{a.remove(),i.detail&&this.editExpressionHandler(i.detail,e)}}></arcgis-map-config-smart-mapping-modal-arcade>`);document.body.appendChild(a)}async editExpressionHandler(e,i){const{smartMappingState:t}=this,{selectedFields:a,_messages:s}=t;if(e.simpleFieldType===o.J.UNKNOWN&&(e.simpleFieldType=o.J.NUMBER),0!==i&&e?.simpleFieldType===o.J.STRING&&a[0].simpleFieldType===o.J.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:s.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const n=a[i];"string"===e.simpleFieldType?(a.splice(i,1),a.unshift(e),i=0,this.requestUpdate()):a[i]=e;const r=n.expression?.includes(w.a),l=e.expression?.includes(w.a);(r&&!l||l&&!r)&&(this.hasArcadeTimeExpressionChange=!0),this.smartMappingState.selectedFields.length!==a.length?(this.smartMappingState.selectedFields=a,$(t,this.galleryRequestWrapper)):(this.smartMappingState.selectedFields=a,function(e,i,t){const{selectedFields:a}=e,s=(0,o.g)(e),{idx:n,oldFieldInfo:r}=i,l=(0,o.d)(e);if(!(0,o.N)(a[n],r))if(a[n].expression===r.expression){const i=a[n];if("size"===l||"color-size"===l&&1===n||"type-size"===l&&1===n||"relationship-size"===l&&2===n){const e=s,t=(0,o.c)(s,"size");t?t.valueExpressionTitle=i.expressionTitle:e.valueExpressionTitle&&(e.valueExpressionTitle=i.expressionTitle)}else if("color"===l||"color-size"===l&&0===n){const e=s,t=(0,o.c)(s,"color");t?t.valueExpressionTitle=i.expressionTitle:e.valueExpressionTitle&&(e.valueExpressionTitle=i.expressionTitle)}else("type"===l||"type-size"===l&&0===n)&&(s.valueExpressionTitle=i.expressionTitle);(0,o.a4)(e)}else a[n].simpleFieldType===r.simpleFieldType?"size"===l?t((0,y.d)(e,{fieldInfos:a})):"color"===l?t((0,f.a)(e,{fieldInfos:a})):"type"===l?t((0,E.d)(e,{fieldInfos:a})):"color-size"===l?1===a.length?t((0,M.c)(e,{fieldInfos:a})):t((0,P.d)(e,{fieldInfos:a})):"type-size"===l?t((0,P.e)(e,{fieldInfos:a})):"relationship-size"===l?t((0,z.c)(e,{fieldInfos:a})):N(e,t):N(e,t)}(t,{idx:i,oldFieldInfo:n},this.galleryRequestWrapper),!(0,o.N)(a[i],n)&&a[i].expression===n.expression&&(this.syncDisplayWithCurrentFieldsOrder(),this.requestUpdate()))}handleListChange(e){const{selectedFields:i}=this.smartMappingState;i[e].expression?this.handleArcadeEdit(e):this.openFieldPickList(!0,e)}handleRemoveAttribute(e){const{smartMappingState:i}=this,{selectedFields:t}=i,a=t.some(e=>e.expression?.includes(w.a));this.smartMappingState.selectedFields=t?.filter((i,t)=>t!==e);const s=this.smartMappingState.selectedFields.some(e=>e.expression?.includes(w.a));a&&!s&&(this.hasArcadeTimeExpressionChange=!0),this.syncDisplayWithCurrentFieldsOrder(),$(i,this.galleryRequestWrapper)}handleSelectClick(e){const{smartMappingState:i}=this,{selectedFields:t}=i;t.some(e=>e.expression?.includes(w.a))&&"simple"===e&&(this.hasArcadeTimeExpressionChange=!0),function(e,i,t){const{selectedFields:a}=e;switch(i){case"simple":e.selectedFields=[],t((0,u.c)(e));break;case"type":t((0,E.c)(e,{fieldInfos:a}));break;case"color":t((0,f.d)(e,{fieldInfos:a}));break;case"size":t((0,y.f)(e,{fieldInfos:a}));break;case"color-age":t((0,f.e)(e,{fieldInfos:a}));break;case"size-age":t((0,y.g)(e,{fieldInfos:a}));break;case"dot-density":t((0,z.b)(e,{fieldInfos:a}));break;case"heatmap":t((0,S.c)(e,{fieldInfos:a}));break;case"compare":t((0,b.c)(e,{fieldInfos:a}));break;case"relationship":t((0,v.a)(e,{fieldInfos:a}));break;case"relationship-size":t((0,z.a)(e,{fieldInfos:a}));break;case"predominance":t((0,F.a)(e,{fieldInfos:a}));break;case"predominance-size":t((0,F.a)(e,{fieldInfos:a,includeSizeVariable:!0}));break;case"chart":t((0,T.a)(e,{fieldInfos:a}));break;case"chart-size":t((0,T.a)(e,{fieldInfos:a,includeSizeVariable:!0}));break;case"type-size":t((0,P.j)(e,{fieldInfos:a}));break;case"type-size-age":t((0,P.i)(e,{fieldInfos:a}));break;case"color-size":1===a.length?t((0,M.a)(e,{fieldInfos:a})):t((0,P.h)(e,{fieldInfos:a}));break;case"color-age-size":t((0,P.g)(e,{fieldInfos:a}));break;case"color-size-age":t((0,P.f)(e,{fieldInfos:a}))}}(i,e,this.galleryRequestWrapper)}handleOptionsClick(e){const{selectedFields:i}=this.smartMappingState;switch(e){case"simple":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-simple .showBackButton=${!0} selected @arcgisSmartMappingPanelsSimpleClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsSimpleBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsSimpleError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-simple>`);this.appendFlowItem(e),this.selected=!1;break}case"color":case"color-age":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-color .showBackButton=${!0} selected @arcgisSmartMappingPanelsColorClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsColorBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsColorError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-color>`);this.appendFlowItem(e),this.selected=!1;break}case"size":case"size-age":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsSizeClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsSizeBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-size>`);this.appendFlowItem(e),this.selected=!1;break}case"type":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-type .showBackButton=${!0} selected @arcgisSmartMappingPanelsTypeClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsTypeBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsTypeError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)} @arcgisSmartMappingPanelsTypeClusterRequiresUpdate=${()=>this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()}></arcgis-map-config-smart-mapping-panels-type>`);this.appendFlowItem(e),this.selected=!1;break}case"compare":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-compare .showBackButton=${!0} selected @arcgisSmartMappingPanelsCompareClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsCompareBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsCompareError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-compare>`);this.appendFlowItem(e),this.selected=!1;break}case"heatmap":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-heatmap .showBackButton=${!0} selected @arcgisSmartMappingPanelsHeatmapClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsHeatmapBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsHeatmapError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-heatmap>`);this.appendFlowItem(e),this.selected=!1;break}case"predominance":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-predominance .showBackButton=${!0} selected @arcgisSmartMappingPanelsPredominanceClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsPredominanceBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsPredominanceError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-predominance>`);this.appendFlowItem(e),this.selected=!1;break}case"chart":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-chart .showBackButton=${!0} selected @arcgisSmartMappingPanelsChartClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsChartBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsChartError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-chart>`);this.appendFlowItem(e),this.selected=!1;break}case"relationship":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-relationship .showBackButton=${!0} selected @arcgisSmartMappingPanelsRelationshipClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsRelationshipBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsRelationshipError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-relationship>`);this.appendFlowItem(e),this.selected=!1;break}case"dot-density":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-dot-density .showBackButton=${!0} selected @arcgisSmartMappingPanelsDotDensityClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsDotDensityBackClick=${()=>this.cleanUpFlowItem(e)}></arcgis-map-config-smart-mapping-panels-dot-density>`);this.appendFlowItem(e),this.selected=!1;break}case"color-size":case"color-age-size":case"color-size-age":if(i.length>1){const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-color-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsColorSizeClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsColorSizeBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e)}} @arcgisSmartMappingPanelsColorSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-color-size>`);this.appendFlowItem(e),this.selected=!1}else{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-color-size-univariate .showBackButton=${!0} selected @arcgisSmartMappingPanelsColorSizeUnivariateClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsColorSizeUnivariateBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e)}} @arcgisSmartMappingPanelsColorSizeUnivariateError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-color-size-univariate>`);this.appendFlowItem(e),this.selected=!1}break;case"type-size":case"type-size-age":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-type-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsTypeSizeClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsTypeSizeBackClick=${()=>{this.requestUpdate(),this.cleanUpFlowItem(e)}} @arcgisSmartMappingPanelsTypeSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-type-size>`);this.appendFlowItem(e),this.selected=!1,setTimeout(()=>{e.selected=!0},1);break}case"predominance-size":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-predominance-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsPredominanceSizeClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsPredominanceSizeBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsPredominanceSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-predominance-size>`);this.appendFlowItem(e),this.selected=!1;break}case"chart-size":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-chart-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsChartSizeClose=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsChartSizeBackClick=${()=>this.cleanUpFlowItem(e)} @arcgisSmartMappingPanelsChartSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-chart-size>`);this.appendFlowItem(e),this.selected=!1;break}case"relationship-size":{const e=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-panels-relationship-size .showBackButton=${!0} selected @arcgisSmartMappingPanelsRelationshipSizeClose=${()=>this.removeFlowItem(e)} @arcgisSmartMappingPanelsRelationshipSizeBackClick=${()=>this.removeFlowItem(e)} @arcgisSmartMappingPanelsRelationshipSizeError=${({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e)}></arcgis-map-config-smart-mapping-panels-relationship-size>`);this.appendFlowItem(e),this.selected=!1;break}}}appendFlowItem(e){const{flowNode:i}=this;(0,o.aa)(this.el)?i.appendChild(e):(0,h.el)(this.el,"arcgis-map-config-smart-mapping").shadowRoot.appendChild(e),this.setUpWatchFeatureReductionScale(!1)}removeFlowItem(e){e.remove(),this.setUpWatchFeatureReductionScale(!0),this.selected=!0}handleDone(){this.arcgisSmartMappingPanelsGalleryClose.emit("save")}handleCancel(){const{originalRendererJSON:e,originalFeatureReduction:i,smartMappingState:t}=this,{selectedFields:a}=t,s=a.some(e=>e.expression?.includes(w.a)),n=e?.visualVariables?.some(e=>e.valueExpression?.includes(w.a));(s&&!n||!s&&n)&&(this.hasArcadeTimeExpressionChange=!0),(0,o.a8)(t,e,i),this.arcgisSmartMappingPanelsGalleryClose.emit("cancel"),this.handleArcadeTimeExpressionChange()}checkCluster(){const{layer:e}=this.smartMappingState;"featureReduction"in e&&e.featureReduction&&this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()}checkClusterRenderer(){const{layer:e}=this.smartMappingState;if("featureReduction"in e&&"cluster"===e.featureReduction?.type){const i=e.featureReduction;i.renderer=void 0,e.featureReduction=i.clone()}}handleArcadeTimeExpressionChange(){this.hasArcadeTimeExpressionChange&&(this.arcgisSmartMappingPanelsGalleryArcadeTimeExpressionChange.emit(this.timeSeriesInfo??void 0),this.timeSeriesInfo=void 0,this.hasArcadeTimeExpressionChange=!1)}openFieldPickList(e=!1,i){(0,o.f)();const{fields:t,selectedFields:a}=this.smartMappingState,n=a.map(e=>e.field),r=t.filter(t=>{let a=!n.includes(t.layerField.name);return e&&(a=a||t.layerField.name===n[i]),a}),l=(0,x.dN)(s.qy`<arcgis-map-config-smart-mapping-field-pick-list .smartMappingState=${this.smartMappingState} .fields=${r} .popoverProps=${{refElement:this.flowItemNode.value,placement:"leading",popoverWidth:1.05*this.flowItemNode.value.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!0}} .singleEditMode=${e} .fieldToReplace=${e?a[i]:void 0} .lastSortBy=${this.lastSortBy} @arcgisSmartMappingFieldPickListSortByChange=${e=>this.lastSortBy=e.detail} @arcgisSmartMappingFieldPickListClose=${t=>{l.remove(),(0,o.h)(this.flowItemNode.value,!1),t.detail?.selectedFields&&(e?this.editAttribute(t.detail.selectedFields,i):this.addField(t.detail.selectedFields)),this.addFieldButtonNode.value?.setFocus()}}></arcgis-map-config-smart-mapping-field-pick-list>`);document.body.appendChild(l),(0,o.h)(this.flowItemNode.value,!0)}cleanUpFlowItem(e){this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0}focusSelectedTile(){this.setUpWatchFeatureReductionScale(!0),setTimeout(()=>{let e=!1;[...this.tilesNode.value.children].forEach(i=>{!e&&i&&"ARCGIS-MAP-CONFIG-SMART-MAPPING-TILE"===i.nodeName&&(e=!0,i.setFocus())})},300)}setUpWatchFeatureReductionScale(e){this.scaleHandle?.remove(),e&&(this.scaleHandle=(0,c.w)(this.smartMappingState,this.flowItemNode.value,()=>this.smartMappingCompleteClose.emit("cancel")))}render(){const{layer:e,useFeatureReduction:i,hideLayerTitle:t,_messages:a}=this.smartMappingState,n=i?"cluster"===e.featureReduction.type?a.panels.gallery.clusterStyles:a.panels.gallery.binStyles:a.panels.gallery.styles;let r=!1;if("featureReduction"in e&&"cluster"===e.featureReduction?.type){const i=e.featureReduction;"pie-chart"===i.renderer?.type&&!i.renderer.authoringInfo?.isAutoGenerated&&(r=!0)}return this.el.classList.add("calcite-match-height"),s.qy`<calcite-flow-item .heading=${n} .description=${t?void 0:e.title} class="flow-item" .closable=${(0,o.aa)(this.el)} .showBackButton=${this.showBackButton} .selected=${this.selected} @calciteFlowItemClose=${this.handleDone} @calciteFlowItemBack=${this.handleDone} ${(0,I.K)(this.flowItemNode)}>${r?this.renderClusteringWarning():this.renderGalleryContent()}</calcite-flow-item>`}renderGalleryContent(){return s.qy`${this.renderDoneButton()}${this.renderCancelButton()}${this.renderGenerate()}${this.renderStepOne()}${this.renderStepTwo()}`}renderClusteringWarning(){const{_messages:e}=this.smartMappingState;return s.qy`<calcite-card class="clustering-warning-notice"><div slot=description>${e.panels.gallery.chartClusterMsg}</div></calcite-card><calcite-button slot=footer .label=${e.done} @click=${this.handleCancel} appearance=outline-fill width=full>${e.done}</calcite-button>`}renderDoneButton(){const{layer:e,_messages:i}=this.smartMappingState;return e?s.qy`<calcite-button slot=footer .label=${i.done} @click=${this.handleDone} appearance=solid width=half>${i.done}</calcite-button>`:""}renderCancelButton(){const{layer:e,_messages:i}=this.smartMappingState;return e?s.qy`<calcite-button slot=footer .label=${i.cancel} @click=${this.handleCancel} appearance=outline-fill width=half>${i.cancel}</calcite-button>`:""}renderGenerate(){const e=this.urlObjectQuery,{layer:i,portal:t,_messages:a}=this.smartMappingState,n=Object.keys(p.a).includes(e.assist);return e.assist&&(0,o.a1)(i)&&(n&&"devext.arcgis.com"===t.portalHostname||n&&"qaext.arcgis.com"===t.portalHostname||n&&"www.arcgis.com"===t.portalHostname&&t.user&&"jsapi"===t.urlKey)?s.qy`<div class="gallery-block"><div class="generate-block"><calcite-icon icon=effects></calcite-icon><calcite-label layout=inline-space-between><div><div class="generate-title">${a.panels.gallery.styleWithAI}</div><div class="generate-description">${a.panels.gallery.styleWithAIMsg}</div></div><calcite-button class="generate-button" @click=${this.handleGenerateClick}>${a.panels.gallery.go}</calcite-button></calcite-label></div></div><div class="separator"><div class="separator-line"></div><span class="separator-text">${a.panels.gallery.or}</span><div class="separator-line"></div></div>`:""}renderStepOne(){const{smartMappingState:e}=this,{layer:i,selectedFields:t,_messages:a,useFeatureReduction:n}=e,r=t.length,l=(0,o.aD)(e).string>0,c=3===r&&(t[2].expression||t[2].featureReductionExpression),p=n&&2===r&&t[0].simpleFieldType===o.J.DATE,d=3===r&&t[2].simpleFieldType===o.J.DATE,m=r>1&&!l&&!c&&!d&&!p;return s.qy`<div class="attributes gallery-block"><div><div class="center"><calcite-icon class="number-icon" icon=number-circle-1></calcite-icon></div><div class="attributes-header-text center">${a.panels.gallery.chooseAttributes}<calcite-button class="attributes-link-info" icon-start=information appearance=transparent kind=neutral .label=${a.tile.moreInfo} @click=${e=>{e.stopPropagation(),this.handleAttributesInfoClick()}} ${(0,I.K)(this.attributesInfoIconNode)}></calcite-button></div></div><calcite-list .label=${a.panels.gallery.attributes} class=${(0,x.CP)(this.fieldsSelection.length>0?"attribute-list":"")} .dragEnabled=${m} @calciteListOrderChange=${e=>{const i=e.detail.oldIndex,t=e.detail.newIndex,a=this.smartMappingState.selectedFields.splice(i,1)[0];this.smartMappingState.selectedFields.splice(t,0,a),this.fieldsSelection=[...this.listNode.value.children];const{smartMappingState:s}=this;$(s,this.galleryRequestWrapper)}} ${(0,I.K)(this.listNode)}>${this.fieldsSelection}</calcite-list>${i&&this.renderAddButtons()||""}</div>`}renderAttribute(e){const{smartMappingState:i}=this,{selectedFields:t,_messages:a,useFeatureReduction:n}=i,r=t.indexOf(e),l=!!t[r].expression,c=(0,o.K)(i,t[r].field),p=c?c.label:t[r].expressionTitle||t[r].featureReductionExpressionTitle,d=t[r].simpleFieldType,m=!l&&(d===o.J.NUMBER?"number":n&&["date","timestamp-offset"].includes((0,o.L)(i,c.layerField))?"date-time":d===o.J.STRING?"date-only"===(0,o.L)(i,c.layerField)?"calendar":"string":d===o.J.DATE?"date-time":null);return s.qy`<calcite-list-item .label=${p} .value=${r} @click=${e=>e.target&&this.handleListChange(r)} @keydown=${e=>{" "===e.key&&(e.preventDefault(),this.handleListChange(r))}}>${m&&s.qy`<div slot=actions-end><calcite-icon scale=s .icon=${m} class="field-type"></calcite-icon></div>`||""}<calcite-action slot=actions-end .text=${l?a.panels.gallery.removeExpression:a.panels.gallery.removeField} .label=${l?a.panels.gallery.removeExpression:a.panels.gallery.removeField} @click=${e=>{e.stopPropagation(),this.handleRemoveAttribute(r)}} @keydown=${e=>{("Enter"===e.key||" "===e.key)&&(e.stopPropagation(),this.handleRemoveAttribute(r))}}><calcite-icon scale=s icon=x></calcite-icon></calcite-action></calcite-list-item>`}renderAddButtons(){const{smartMappingState:e}=this,{layer:i,mapImageSublayer:t,selectedFields:a,_messages:n,supportsArcade:r}=e,l=a.length,c=(0,o.ae)(e),p=(0,o.aD)(e),d=p.string>0,m=p.date>0,g=p.expression>0,h=i.capabilities?.query?.supportsSqlExpression,u=(0,o.g)(e),f=(0,o.p)(u,"reference-size"),y=(0,o.p)(u,"spike");let z=!(t&&!r&&1===l||!(l<10)||2===l&&(d||g)||t&&2===l&&m||3===l&&(m||a[2].expression||a[2].featureReductionExpression||!h));z=z&&(1===p.string&&p.number+p.date===0&&c.number+c.date>0||0===p.string&&p.date<2&&p.number+p.date<3&&p.string+p.number+p.date<c.string+c.number+c.date||p.number>=2&&p.number<c.number);const S=!f&&!y&&(!t||r)&&(l<2||2===l&&!g&&a[0].simpleFieldType===o.J.NUMBER&&a[1].simpleFieldType===o.J.NUMBER);return s.qy`<div class="add-button-div"><div class="add-buttons"><calcite-button .disabled=${!z} @click=${()=>this.openFieldPickList()} appearance=outline-fill kind=neutral width=full .label=${n.panels.gallery.addField} icon-start=plus class="attributes-add-new" ${(0,I.K)(this.addFieldButtonNode)}>${n.panels.gallery.field}</calcite-button><span>&nbsp;&nbsp;</span><calcite-button .disabled=${!S} @click=${()=>this.addExpression()} appearance=outline-fill kind=neutral width=full .label=${n.panels.gallery.addExpression} icon-start=plus class="attributes-add-new" ${(0,I.K)(this.addExpressionButtonRefHandler)}>${n.expression}</calcite-button></div></div>`}renderStepTwo(){const{smartMappingState:e}=this,{selectedFields:i,_messages:t}=e,a=function(e){const{layer:i,useFeatureReduction:t,mapImageSublayer:a,selectedFields:s,supportsArcade:n}=e,r="ogc-feature"===i.type,l="wfs"===i.type,c="stream"===i.type,p="parquet"===i.type,d="subtype-sublayer"===i.type,m="featureReduction"in i&&i.featureReduction,g=s.length,h=(0,o.aD)(e),u=h.string>0,f=h.date>0,y=h.expression>0,z=i.capabilities?.query?.supportsSqlExpression,S=r||l||c||p||z,F=[];return F.push("simple"),1===g&&!u&&!(a&&f)&&F.push("color"),1===g&&!u&&!(a&&f)&&F.push("size"),(!a||n)&&1===g&&f&&!y&&S&&F.push("color-age"),(!a||n)&&1===g&&f&&!y&&S&&F.push("size-age"),(!a||n)&&(1===g||2===g)&&!u&&!(a&&f)&&F.push("color-size"),(!a||n)&&2===g&&!u&&f&&s[0].simpleFieldType===o.J.DATE&&!s[0].expression&&!s[0].featureReductionExpression&&S&&!(a&&h.date>1)&&F.push("color-age-size"),(!a||n)&&2===g&&!u&&f&&s[1].simpleFieldType===o.J.DATE&&!s[1].expression&&!s[1].featureReductionExpression&&S&&!(a&&h.date>1)&&F.push("color-size-age"),(!a||n)&&!d&&g>0&&g<=8&&!y&&(0,o.o)(e)&&!u&&!f&&S&&F.push("dot-density"),(!a||n)&&g>1&&g<=10&&!y&&!u&&!f&&S&&F.push("predominance"),(!a||n)&&g>1&&!y&&!u&&!f&&S&&F.push("predominance-size"),!a&&!d&&(!m||"binning"===m.type)&&g>1&&g<=10&&!y&&["polygon","point","multipoint"].includes((0,o.j)(e))&&!u&&!f&&S&&F.push("chart"),!a&&!d&&(!m||"binning"===m.type)&&g>1&&!y&&["polygon","point","multipoint"].includes((0,o.j)(e))&&!u&&!f&&S&&F.push("chart-size"),(!a||n)&&!d&&2===g&&!y&&!u&&!f&&F.push("relationship"),(!a||n)&&!d&&3===g&&(!y||1===h.expression&&(s[2].expression||s[2].featureReductionExpression))&&!(a&&f)&&F.push("relationship-size"),(!a||n)&&2===g&&!y&&!u&&!f&&F.push("compare"),1===g&&!(a&&f)&&F.push("type"),(!a||n)&&2===g&&h.date<2&&!(a&&f)&&F.push("type-size"),(!a||n)&&2===g&&f&&h.date<2&&s[1].simpleFieldType===o.J.DATE&&s[1].field&&S&&F.push("type-size-age"),(!a||n)&&!d&&["point","multipoint"].includes((0,o.j)(e))&&(!m||"binning"===m?.type&&!t)&&(S&&g<=1||!S&&0===g)&&!u&&!f&&0===h.expression&&F.push("heatmap"),F}(e),n=function(e){const i=(0,o.d)(e),t=(0,o._)(e),a=t.length>0?t[0].simpleFieldType:null;let s=[];switch(i){case"simple":s=["simple","color","size","color-age","size-age","color-size","type","heatmap","dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"];break;case"type":s=["type","color","size","color-age","size-age","color-size","dot-density","heatmap","simple","type-size","type-size-age","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","compare","relationship","relationship-size"];break;case"color":s=["color","size","color-age","size-age","color-size","dot-density"],s="string"===a||"date"===a?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"color-age":s=["color-age","color","size","size-age","color-size","dot-density"],s="string"===a||"date"===a?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size":s=["size","size-age","color","color-age","color-size","dot-density"],s="string"===a||"date"===a?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size-age":s=["size-age","size","color-age","color","color-size","dot-density"],s="string"===a||"date"===a?s.concat(["type","heatmap","simple"]):s.concat(["heatmap","simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"heatmap":s=["heatmap","color","size","color-age","size-age","color-size","dot-density"],s="string"===a?s.concat(["type","simple"]):s.concat(["simple","type"]),s=s.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"predominance":s=["predominance","predominance-size","chart","chart-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===a?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"chart":s=["chart","chart-size","predominance","predominance-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===a?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"dot-density":s=["dot-density","color-size","color-age-size","color-size-age","predominance","predominance-size","chart","chart-size","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===a?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"compare":s=["compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===a&&(s=s.concat(["type"])),s=s.concat(["simple"]),(!a||"string"!==a)&&(s=s.concat(["type"]));break;case"relationship":s=["relationship","relationship-size","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===a&&(s=s.concat(["type"])),s=s.concat(["simple"]),(!a||"string"!==a)&&(s=s.concat(["type"]));break;case"color-size":s=["color-size","color-age-size","color-size-age","color","size","color-age","size-age","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","type","heatmap","simple"];break;case"color-age-size":s=["color-age-size","color-size-age","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"color-size-age":s=["color-size-age","color-age-size","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"type-size":s=["type-size","type-size-age","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type","size","simple","color","color-age","size-age","heatmap","compare","relationship","relationship-size"];break;case"type-size-age":s=["type-size-age","type-size","color-age-size","color-size-age","color-size","dot-density","predominance","predominance-size","chart","chart-size","type","size","size-age","simple","color","color-age","heatmap","compare","relationship","relationship-size"];break;case"predominance-size":s=["predominance-size","predominance","chart-size","chart","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===a?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"chart-size":s=["chart-size","chart","predominance-size","predominance","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],s="string"===a?s.concat(["type","simple"]):s.concat(["simple","type"]);break;case"relationship-size":s=["relationship-size","relationship","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===a&&(s=s.concat(["type"])),s=s.concat(["simple"]),"string"!==a&&(s=s.concat(["type"]));break;default:s=["color","size","color-age","size-age","color-size"],"string"===a&&(s=s.concat(["type"])),s=s.concat(["heatmap","simple"]),"string"!==a&&(s=s.concat(["type"])),s=s.concat(["dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"])}return s}(e),r=i?.length?1===i.length&&i[0].field&&i[0].simpleFieldType===o.J.NUMBER?t.panels.gallery.styleMsg.oneNumber:2===i.length&&i[0].field&&i[1].field&&i[0].simpleFieldType===o.J.NUMBER&&i[1].simpleFieldType===o.J.NUMBER?t.panels.gallery.styleMsg.multipleNumber:t.panels.gallery.styleMsg.any:t.panels.gallery.styleMsg.empty;a.sort((e,i)=>n.indexOf(e)-n.indexOf(i));const l=a.map(e=>this.renderStyleTile(e));return s.qy`<div class="gallery-block"><div class="style-tiles" ${(0,I.K)(this.tilesNode)}><div class="attributes-header"><div class="center"><calcite-icon class="number-icon" icon=number-circle-2></calcite-icon></div><div class="styles-msg-title center">${t.panels.gallery.pickStyle}</div><div class="styles-msg center">${r}</div></div>${l}</div></div>`}renderStyleTile(e){const{smartMappingState:i}=this,t=(0,o.g)(i),{selectedFields:a}=i,r=(0,o.d)(i),l=(0,o.ab)(i),c=`${a?.[0]?.simpleFieldType===o.J.DATE}\n        ${a?.[1]?.simpleFieldType===o.J.DATE}`,p=(0,o.p)(t,"reference-size"),d=(0,o.V)(p),m=(0,o.p)(t,"spike"),g=(0,o.V)(m);return(0,n.D)(`tile-${e}-${l}-${d}-${g}-${c}`,s.qy`<arcgis-map-config-smart-mapping-tile tile-type=gallery .type=${e} .selected=${e===r} @arcgisSmartMappingTileSelect=${()=>{(0,o.f)(),this.handleSelectClick(e)}} @arcgisSmartMappingTileOptions=${()=>{(0,o.f)(),this.handleOptionsClick(e)}} @arcgisSmartMappingTileError=${e=>this.arcgisSmartMappingPanelsGalleryError.emit(e.detail)} @arcgisSmartMappingTileThemeChange=${()=>{queueMicrotask(()=>{this.el.shadowRoot.querySelector("arcgis-map-config-smart-mapping-tile").setThemeFocus()})}}></arcgis-map-config-smart-mapping-tile>`)}}(0,a.c)("arcgis-map-config-smart-mapping-panels-gallery",C)},71384:(e,i,t)=>{t.d(i,{a:()=>a,g:()=>s});const a="timeProperties";function s(e){return`// To configure a time series visualization using this template, data for this layer should be structured so that\n// each row represents a static feature with a fixed location, such as a country boundary or a city location.\n// The attribute table should have two or more fields that represent the same data attributes at different points in time for each feature.\n// Field names should refer to a specific attribute and a specific point in time, such as population in a specific year.\n// e.g. POP1990, POP2000, POP2010, POP2020, POP2030\n\n// There are four areas of this template where modification is necessary for the template to work with your layer\n// Two are required, and two are optional. \n\n// Examine your data and the details below to edit the template accordingly.\n\nvar FIELD_NAME_PATTERN = "POP{Y}"; // Required - Update this to match your data. See Lines 17-49 for details.\nExpects($feature, "POP*"); // Required - Update this to match your data. See Lines 51-63 for details.\nvar DEFAULT_FIELD_NAME = ""; // Optional - See Lines 65-79 for details.\nvar RESULT_FORMAT_PATTERN = "${e?.resultFormatPattern??"#,###.00"}"; // Optional - Update this to match your data. See Lines 81-93 for details.\n\n// FIELD_NAME_PATTERN\n//\n// The field name pattern is used to create the field name from the time slider values.\n// Patterns are defined using the following syntax: fieldName{pattern}\n//\n// EXAMPLE 1: given fields with names Cases_2023_10_01, Cases_2023_10_02, Cases_2023_10_03, etc., the field name pattern would be:\n// var FIELD_NAME_PATTERN = "Cases_{Y_MM_DD}";\n//\n// EXAMPLE 2: given fields with names POP2000, POP2010, POP2020, etc., the field name pattern would be:\n// var FIELD_NAME_PATTERN = "POP{Y}";\n//\n// The following patterns are supported:\n//\n// D: Day of the month, not padded (1 - 31)\n// DD: Day of the month, padded (01 - 31)\n// DDD: Ordinal day of the year (1 - 365)\n// d: Day of the week (1 - 7)\n// ddd: Abbreviated day of the week (e.g. Mon)\n// dddd: Full day of the week (e.g. Monday)\n// M: Month number (1 - 12)\n// MM: Month number, padded (01 - 12)\n// MMM: Abbreviated month name (e.g. Jan)\n// MMMM: Full month name (e.g. January)\n// Y: Full year\n// YY: Two-digit year\n// h: Civilian hours, not padded (1 - 12)\n// hh: Civilian hours, padded (01 - 12)\n// H: Military hours, not padded (0 - 23)\n// HH: Military hours, padded (00 - 23)\n// m: Minutes, not padded (0 - 59)\n// mm: Minutes, padded (00 - 59)\n// s: Seconds, not padded (0 - 59)\n// ss: Seconds, padded (00 - 59)\n\n// EXPECTS\n//\n// Copy and paste the part of the field pattern common to all fields\n// followed by an asterisk (*) into the second parameter of the Expects function.\n// This must be a raw text value like "POP*", not a variable name like FIELD_NAME_PATTERN.\n// \n// EXAMPLE 1: given fields with names Cases_2023_10_01, Cases_2023_10_02, Cases_2023_10_03, etc.\n//   - Expects($feature, \u201cCases_*\u201d);  // includes all fields that start with "Cases_"\n//   - Expects($feature, \u201cCases_2023*\u201d); // includes all Cases fields for the year 2023\n// \n// EXAMPLE 2: given fields with names POP2000, POP2010, POP2020, etc.\n//   - Expects($feature, "POP*"); // includes all fields that start with "POP"\n//   - Expects($feature, "POP2*"); // includes all "POP" fields for all years after 2000\n\n// DEFAULT_FIELD_NAME\n//\n// The field name to return if the time slider is closed.\n// Suggested values might include the first field in the time series,\n// the most recent field in the time series, or possibly an\n// aggregated value, such as TOTAL_POPULATION.\n// \n// EXAMPLE 1: The first field in the time series. Given fields with names POP2000, POP2010, POP2020, TOTAL_POPULATION,\n// var DEFAULT_FIELD_NAME = "POP2000";\n//\n// EXAMPLE 2: An aggregated value such as the total population. Given fields with names POP2000, POP2010, POP2020, TOTAL_POPULATION,\n// var DEFAULT_FIELD_NAME = "TOTAL_POPULATION";\n//\n// Note - If you defined a default field, be sure to include it in the Expects function as a third parameter.\n// e.g. Expects($feature, "POP*", "TOTAL_POPULATION");\n\n// RESULT_FORMAT_PATTERN\n//\n// The result format pattern is used to format the result of the calculation.\n// Patterns are defined using the following syntax: #,###.00\n// This should only be defined for formatting numeric values in labels or popups.\n// If using for symbology/layer styles, or the field data type\n// is a string, then leave this value empty.\n//\n// EXAMPLE 1: if returning a numeric value in a label,\n// var RESULT_FORMAT_PATTERN = "#,###"; // formats the value with commas and rounded to nearest integer\n// \n// EXAMPLE 2: if returning a numeric value in a popup,\n// var RESULT_FORMAT_PATTERN = "#,###.00"; // formats the value with commas and two decimal places\n\nfunction fieldsWithPatternFilter(field) {\n  var prefix = Front(Split(FIELD_NAME_PATTERN, "{"));\n  var suffix = Back(Split(FIELD_NAME_PATTERN, "}"));\n  var patternToFind = DefaultValue(prefix, suffix);\n  return Find(patternToFind, field.name) > -1;\n}\n\nfunction fieldsWithPatternMap(field) {\n  return field.name;\n}\n\nfunction getAllFieldsFromPattern() {\n  var fields = Schema($feature).fields;\n  return Sort(\n    Map(Filter(fields, fieldsWithPatternFilter), fieldsWithPatternMap)\n  );\n}\n\nfunction getFieldNameFromTimeProperties(dateValue, pattern) {\n  var fieldName = pattern;\n\n  var startPosition = Find("{", fieldName);\n  while (startPosition > -1) {\n    var startIndex = Find("{", fieldName, startPosition);\n    var endIndex = Find("}", fieldName, startIndex);\n    var searchText = Mid(fieldName, startIndex, endIndex - startIndex + 1);\n    var dateText = Text(dateValue, searchText);\n    fieldName = Replace(fieldName, searchText, dateText);\n    startPosition = Find("{", fieldName, endIndex);\n  }\n  fieldName = Replace(Replace(fieldName, "{", ""), "}", "");\n  return fieldName;\n}\n\nvar hasCurrentStart = HasValue($view, ["timeProperties", "currentStart"]);\nvar hasCurrentEnd = HasValue($view, ["timeProperties", "currentEnd"]);\n\nvar hasTimeProperties = hasCurrentStart || hasCurrentEnd;\n\nif (!hasTimeProperties) {\n  if (!IsEmpty(DEFAULT_FIELD_NAME) && HasKey($feature, DEFAULT_FIELD_NAME)) {\n    return $feature[DEFAULT_FIELD_NAME];\n  }\n  var firstField = Front(getAllFieldsFromPattern());\n  return $feature[firstField];\n}\n\nvar currentValue = DefaultValue(\n  $view.timeProperties.currentEnd,\n  $view.timeProperties.currentStart\n);\n\nfunction getValueAtInstant() {\n  var fieldName = getFieldNameFromTimeProperties(\n    currentValue,\n    FIELD_NAME_PATTERN\n  );\n  if (HasValue($feature, fieldName)) {\n    var value = $feature[fieldName];\n    return value;\n  }\n  return null;\n}\n\nfunction formatResult(value) {\n  if (IsEmpty(value)) {\n    return null;\n  }\n  if (IsEmpty(RESULT_FORMAT_PATTERN)) {\n    return value;\n  }\n  return Text(value, RESULT_FORMAT_PATTERN);\n}\n\nvar result = getValueAtInstant();\nreturn formatResult(result);`}},75518:(e,i,t)=>{let a,s;function n(e){e.loading=!1}async function r(e,i){return function(e){e.loading=!0,s=!1,a&&clearTimeout(a),a=setTimeout(()=>{n(e),s=!0},6e4)}(i),await e.then(e=>{if(n(i),s)throw new Error("timeout");return e}).catch(e=>{throw n(i),e})}t.d(i,{r:()=>r})},89989:(e,i,t)=>{t.d(i,{w:()=>n});var a=t(54312),s=t(1225);t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(28927),t(83368),t(89704),t(5294),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(75698),t(10628),t(59640),t(64451),t(6176),t(83552),t(77462),t(49403),t(10281),t(83930),t(66617),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(6238),t(7299);function n(e,i,t){const{layer:n,mapView:l,useFeatureReduction:o}=e;return o&&"featureReduction"in n&&"binning"===n.featureReduction.type?a.watch(()=>l.scale,()=>{const a=n.featureReduction;l.scale<=a.maxScale&&!i.disabled?((0,s.f)(),function(e,i,t){const a=document.createElement("arcgis-map-config-smart-mapping-scale-alert-popover");a.smartMappingState=e,a.refElement=i,a.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",()=>{r(),t()}),document.body.append(a)}(e,i,t),(0,s.h)(i,!0)):l.scale>a.maxScale&&i.disabled&&(r(),(0,s.h)(i,!1),i.setFocus())}):void 0}function r(){document.querySelectorAll("arcgis-map-config-smart-mapping-scale-alert-popover").forEach(e=>e.remove())}}}]);