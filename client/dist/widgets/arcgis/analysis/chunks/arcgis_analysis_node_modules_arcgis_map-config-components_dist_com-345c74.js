/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-345c74.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-345c74"],{2079:(e,t,a)=>{a.d(t,{a:()=>n,i:()=>i});var s=a(42855);function i(e,t,a,i){const{layer:n}=e;switch(t){case s.l.feature:return!!(n&&a===s.s.wms||n&&n.popupTemplate)&&n.popupEnabled;case s.l.cluster:return!!n&&n.featureReduction.popupEnabled;case s.l.mapNotes:return i;default:return!!n?.popupEnabled}}function n(e,t){const a="CALCITE-INPUT"===e.tagName,s=a?e.shadowRoot.querySelector("input"):e.shadowRoot.querySelector("textarea"),i=s.selectionStart,n=[e.value.slice(0,i),`{${t}}`,e.value.slice(i)].join("");e.value=n;const o=i+2+t.length;setTimeout(()=>{a?e.setFocus():(s?.setSelectionRange(o,o),s?.focus()),s?.setSelectionRange(o,o)},1)}},10763:(e,t,a)=>{a.d(t,{c:()=>n,u:()=>o});var s=a(83552),i=a(20936);function n(e){e.mapView=void 0,e.portal=void 0,e.config=void 0,e.layerDisplayType=void 0,e.serviceType=void 0,e.layerHasAttributes=!0,e.layerSupportsAttachments=!1,e.layerHasCharts=!0,e.layerHasImages=!0,e.layerHasText=!0,e.layerSupportsArcade=!1,e.layerHasRelatedRecords=!1,e.layerIsUNLayer=!1,e.layerHasEditInfo=!1,e.blockFeatureReductionArcade=!1,e.allowTimeSeriesConfiguration=!1}function o(){const e=(0,s.Gk)(),t=e;e.manager.onLoad(()=>{t.popupState=function(e,t){const a=c.get(e);if(a)return a;const s=(0,i.el)(e,t);return s&&"store"in s?(c.set(e,s.store),s.store):null}(e.el,"arcgis-map-config-popup")})}const c=new WeakMap},30669:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigPopupAttachments:()=>h});var s=a(73679),i=a(4395),n=a(73801),o=a(85643),c=a(66228),r=(a(9923),a(42097),a(81565),a(2079)),l=a(98295),p=a(10763);const d=i.AH`.form-input-button{display:flex}.input{width:100%}calcite-text-area{width:100%;--calcite-text-area-min-width: 0;--calcite-text-area-min-height: 42px}.list-warning-wrapper{border:1px solid var(--calcite-color-foreground-3);display:flex;font-size:var(--calcite-font-size-sm)}.list-warning-icon{display:flex;align-items:center;padding:0 var(--calcite-spacing-sm);background-color:var(--calcite-color-foreground-2)}.list-warning-text{padding:var(--calcite-spacing-xs) var(--calcite-spacing-sm)}.filter-block{border:1px solid var(--calcite-color-border-2)}.single-line-label-switch-section{display:flex;margin:0;padding:var(--calcite-spacing-xxs) 0px}.single-line-label-switch-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.single-line-label-switch-switch{flex:0 0 0%;justify-self:flex-end;margin:0}.combobox{margin-bottom:var(--calcite-spacing-sm)}.combobox-active{display:block}.combobox-inactive{display:none}`;class h extends n.WF{constructor(){super(),this.keywordSwitchNode=(0,o._)(),this.keywordComboboxNode=(0,o._)(),this.typeComboboxNode=(0,o._)(),this.allKeywords=[],this.attachmentSortOptionsMap=new Map,this.popupState=(0,p.u)(),this.blockOpen=!1,this.arcgisChange=(0,n.lh)(),this.closePopupPopovers=(0,n.lh)(),this.disablePopupPanel=(0,n.lh)(),this.listenOn(window,"closePopupPopovers",this.closePopupPopoversHandler)}static{this.properties={popupFlowItem:0,blockOpen:5,attachmentsContent:0,layerSupportsResizeAttachments:5,layerSupportsOrderingAttachments:5,layerSupportsFilteringAttachments:5}}static{this.styles=d}async load(){this.setUpAttachmentSortByMap(),this.layerSupportsResizeAttachments?this.attachmentsContent.displayType||(this.attachmentsContent.displayType=l.A.AUTO,this.arcgisChange.emit()):this.attachmentsContent.displayType=l.A.LIST,this.layerSupportsFilteringAttachments&&(await this.setUpFullKeywordsList(),this.lastKeywords=this.attachmentsContent.attachmentKeywords,this.lastTypes=this.attachmentsContent.attachmentTypes),this.attachmentsContent.title=this.attachmentsContent.title||"",this.attachmentsContent.description=this.attachmentsContent.description||""}disconnectedCallback(){super.disconnectedCallback(),this.pickListNode?.remove()}closePopupPopoversHandler(){this.pickListNode&&(this.pickListNode.remove(),this.pickListNode=void 0,this.disablePopupPanel.emit(!1))}setUpAttachmentSortByMap(){const{popupState:e}=this,{layer:t}=e;this.attachmentSortOptionsMap.set("id","ATTACHMENTID"),this.attachmentSortOptionsMap.set("contentType","CONTENT_TYPE"),this.attachmentSortOptionsMap.set("name","ATT_NAME"),this.attachmentSortOptionsMap.set("size","DATA_SIZE"),"fields"in t&&t.fields.find(e=>"global-id"===e.type)&&this.attachmentSortOptionsMap.set("globalId","AttachmentGlobalId")}async setUpFullKeywordsList(){const{popupState:e}=this,{layer:t}=e,a=await t.queryAttachments({where:"1=1"}),s=Object.values(a).flat();if(s?.length){const e=s.map(e=>e.keywords).filter(e=>!!e).map(e=>e.split(",").map(e=>e.trim())).flat().filter(e=>!!e.length);this.allKeywords=Array.from(new Set(e)).sort((e,t)=>e.localeCompare(t))}}getDisplayTypeMessage(){const{popupState:e}=this,{_messages:t}=e;switch(this.attachmentsContent.displayType){case l.A.AUTO:return t.autoDisplayMessage;case l.A.LIST:return t.listDisplayMessage;case l.A.PREVIEW:return t.previewDisplayMessage;default:return t.listDisplayMessage}}handlePickListChange(e,t){"title"===t?((0,r.a)(this.attachmentsTitleNode,e),this.attachmentsContent.title=this.attachmentsTitleNode.value):"description"===t&&((0,r.a)(this.attachmentsDescriptionNode,e),this.attachmentsContent.description=this.attachmentsDescriptionNode.value),this.closePopupPopovers.emit(),this.arcgisChange.emit()}render(){const{popupState:e}=this,{_messages:t}=e;return i.qy`${this.renderAttachmentDisplayType()}<div>${this.renderFormInput("title",t.title,this.attachmentsContent.title,t.enterTitle,e=>this.attachmentsTitleNode=e)}${this.renderFormInput("description",t.desc,this.attachmentsContent.description,t.enterDescription,e=>this.attachmentsDescriptionNode=e)}${this.layerSupportsOrderingAttachments&&this.renderSortBy()||""}${this.layerSupportsOrderingAttachments&&this.renderSortOrder()||""}${this.layerSupportsFilteringAttachments&&this.renderFilters()||""}${!this.layerSupportsResizeAttachments&&this.renderListOnlyMessage()||""}</div>`}renderAttachmentDisplayType(){const{popupState:e}=this,{_messages:t}=e;return i.qy`<calcite-label>${t.displayAttachmentsAs}<calcite-segmented-control width=full scale=s .disabled=${!this.layerSupportsResizeAttachments} @calciteSegmentedControlChange=${e=>{const t=e.target.selectedItem;this.attachmentsContent.displayType=t.value,this.arcgisChange.emit()}}><calcite-segmented-control-item .value=${l.A.AUTO} icon-start=check .checked=${this.attachmentsContent.displayType===l.A.AUTO}>${t.auto}</calcite-segmented-control-item><calcite-segmented-control-item .value=${l.A.LIST} icon-start=list .checked=${this.attachmentsContent.displayType===l.A.LIST}>${t.list}</calcite-segmented-control-item><calcite-segmented-control-item .value=${l.A.PREVIEW} icon-start=image .checked=${this.attachmentsContent.displayType===l.A.PREVIEW}>${t.gallery}</calcite-segmented-control-item></calcite-segmented-control><calcite-label scale=s>${this.getDisplayTypeMessage()}</calcite-label></calcite-label>`}renderFormInput(e,t,a,s,c){const{popupState:r}=this,{_messages:l,popupTemplate:p}=r;return i.qy`<calcite-label scale=s>${t}<div class="form-input-button">${"title"===e?i.qy`<calcite-input class="input" type=text autofocus .value=${a} .placeholder=${s} @calciteInputInput=${e=>{e.stopPropagation();const t=e.target.value;this.attachmentsContent.title=t,this.arcgisChange.emit()}} @click=${()=>this.closePopupPopovers.emit()} ${(0,o.K)(c)}></calcite-input>`:i.qy`<calcite-text-area resize=vertical autofocus .value=${a} .placeholder=${s} @calciteTextAreaInput=${e=>{e.stopPropagation();const t=e.target.value;this.attachmentsContent.description=t,this.arcgisChange.emit()}} ${(0,o.K)(c)}></calcite-text-area>`}${p.fieldInfos?.length&&i.qy`<calcite-action .text=${l.attributes} scale=s icon=brackets-curly @click=${()=>{const{popupState:t}=this;this.closePopupPopovers.emit(),this.pickListNode||(this.pickListNode=(0,n.dN)(i.qy`<arcgis-map-config-popup-field-pick-list .popoverProps=${{refElement:this.popupFlowItem}} .heading=${l.addField} .popupState=${t} @arcgisChange=${t=>{t.stopPropagation();const a=t.detail.selectedFields[0];this.handlePickListChange(a,e)}} @arcgisClose=${e=>{e.stopPropagation(),this.closePopupPopovers.emit()}}></arcgis-map-config-popup-field-pick-list>`),document.body.appendChild(this.pickListNode),this.disablePopupPanel.emit(!0))}}></calcite-action>`||""}</div></calcite-label>`}renderSortBy(){const{popupState:e,attachmentSortOptionsMap:t}=this,{_messages:a}=e,s=(0,c.i)(this.attachmentsContent.orderByFields?.[0]),n=Array.from(t.entries()).map(([e,t])=>{const n=s?this.attachmentsContent.orderByFields[0].field===t:"id"===e;return i.qy`<calcite-dropdown-item .selected=${n} @click=${()=>{s?this.attachmentsContent.orderByFields[0].field=t:this.attachmentsContent.orderByFields=[{field:t,order:"ascending"}],this.arcgisChange.emit()}}>${a[e]}</calcite-dropdown-item>`});return i.qy`<calcite-label>${a.sortBy}<calcite-dropdown overlay-positioning=fixed><calcite-button slot=trigger appearance=outline-fill kind=neutral icon-end=chevronDown alignment=icon-end-space-between width=full>${s?a[Array.from(t.entries()).find(([,e])=>this.attachmentsContent.orderByFields[0].field===e)[0]]:a.id}</calcite-button>${n}</calcite-dropdown></calcite-label>`}renderSortOrder(){const{popupState:e}=this,{_messages:t}=e,a=(0,c.i)(this.attachmentsContent.orderByFields?.[0]);return i.qy`<calcite-label>${t.sortOrder}<calcite-dropdown overlay-positioning=fixed><calcite-button slot=trigger appearance=outline-fill kind=neutral icon-end=chevronDown alignment=icon-end-space-between width=full>${a?t[this.attachmentsContent.orderByFields[0].order]:t.ascending}</calcite-button><calcite-dropdown-item .selected=${!a||"ascending"===this.attachmentsContent.orderByFields[0].order} @click=${()=>{a?this.attachmentsContent.orderByFields[0].order="ascending":this.attachmentsContent.orderByFields=[{field:this.attachmentSortOptionsMap.get("id"),order:"ascending"}],this.arcgisChange.emit()}}>${t.ascending}</calcite-dropdown-item><calcite-dropdown-item .selected=${"descending"===this.attachmentsContent.orderByFields?.[0]?.order} @click=${()=>{a?this.attachmentsContent.orderByFields[0].order="descending":this.attachmentsContent.orderByFields=[{field:this.attachmentSortOptionsMap.get("id"),order:"descending"}],this.arcgisChange.emit()}}>${t.descending}</calcite-dropdown-item></calcite-dropdown></calcite-label>`}renderFilters(){const{popupState:e}=this,{_messages:t}=e,a=this.attachmentsContent.attachmentKeywords,s=this.attachmentsContent.attachmentTypes,n=!!(a||s||this.lastKeywords||this.lastTypes);return i.qy`<calcite-block class="filter-block" .expanded=${n} collapsible .heading=${t.filters}>${this.renderKeywordFilter()}${this.renderTypeFilter()}</calcite-block>`}renderKeywordFilter(){const{popupState:e,allKeywords:t}=this,{_messages:a}=e,s=this.attachmentsContent.attachmentKeywords;return i.qy`<section class="single-line-label-switch-section"><calcite-label class="single-line-label-switch-label">${a.keyword}</calcite-label><calcite-switch class="single-line-label-switch-switch" .checked=${!!s||!!this.lastKeywords} @calciteSwitchChange=${e=>{if(!t?.length)return void this.requestUpdate();const a=this.attachmentsContent.attachmentKeywords;e.target.checked?(this.keywordComboboxNode.value.classList.remove("combobox-inactive"),this.keywordComboboxNode.value.classList.add("combobox-active"),this.lastKeywords?.length&&(this.attachmentsContent.attachmentKeywords=this.lastKeywords)):(this.keywordComboboxNode.value.classList.remove("combobox-active"),this.keywordComboboxNode.value.classList.add("combobox-inactive"),this.attachmentsContent.attachmentKeywords=null),a!==this.attachmentsContent.attachmentKeywords&&this.arcgisChange.emit()}} ${(0,o.K)(this.keywordSwitchNode)}></calcite-switch></section>${t?.length?i.qy`<calcite-combobox class=${"combobox "+(s||this.lastKeywords?"combobox-active":"combobox-inactive")} selection-display=fit .label=${a.keyword} .placeholder=${a.addKeywords} @calciteComboboxChange=${e=>{const t=e.target.selectedItems.map(e=>e.value);this.attachmentsContent.attachmentKeywords=t.length?t:null,this.lastKeywords=t,this.arcgisChange.emit()}} ${(0,o.K)(this.keywordComboboxNode)}>${t.map(e=>i.qy`<calcite-combobox-item .value=${e} .heading=${e} .selected=${s?.includes(e)}></calcite-combobox-item>`)}</calcite-combobox>`:this.keywordSwitchNode.value?.checked&&!t?.length?i.qy`<calcite-label scale=s layout=inline><calcite-icon icon=exclamation-mark-triangle scale=s></calcite-icon>${a.noKeywordsFound}</calcite-label>`:null}`}renderTypeFilter(){const{popupState:e}=this,{_messages:t}=e,a=this.attachmentsContent.attachmentTypes;return i.qy`<section class="single-line-label-switch-section"><calcite-label class="single-line-label-switch-label">${t.type}</calcite-label><calcite-switch class="single-line-label-switch-switch" .checked=${!!a||!!this.lastTypes} @calciteSwitchChange=${e=>{const t=this.attachmentsContent.attachmentTypes;e.target.checked?(this.typeComboboxNode.value.classList.remove("combobox-inactive"),this.typeComboboxNode.value.classList.add("combobox-active"),this.lastTypes?.length&&(this.attachmentsContent.attachmentTypes=this.lastTypes)):(this.typeComboboxNode.value.classList.remove("combobox-active"),this.typeComboboxNode.value.classList.add("combobox-inactive"),this.attachmentsContent.attachmentTypes=null),t!==this.attachmentsContent.attachmentTypes&&this.arcgisChange.emit()}}></calcite-switch></section><calcite-combobox class=${"combobox "+(a||this.lastTypes?"combobox-active":"combobox-inactive")} selection-display=fit .label=${t.type} .placeholder=${t.addTypes} @calciteComboboxChange=${e=>{const t=e.target.selectedItems.map(e=>e.value);t.includes("document")&&(t.splice(t.indexOf("document"),1),t.push("application","model","text")),this.attachmentsContent.attachmentTypes=t.length?t:null,this.lastTypes=t,this.arcgisChange.emit()}} ${(0,o.K)(this.typeComboboxNode)}><calcite-combobox-item value=audio .heading=${t.audio} .selected=${a?.includes("audio")}></calcite-combobox-item><calcite-combobox-item value=document .heading=${t.document} .selected=${a?.includes("application")}></calcite-combobox-item><calcite-combobox-item value=image .heading=${t.image} .selected=${a?.includes("image")}></calcite-combobox-item><calcite-combobox-item value=video .heading=${t.video} .selected=${a?.includes("video")}></calcite-combobox-item></calcite-combobox>`}renderListOnlyMessage(){const{popupState:e}=this,{_messages:t}=e;return i.qy`<div class="list-warning-wrapper"><span class="list-warning-icon"><calcite-icon scale=s icon=exclamation-mark-triangle></calcite-icon></span><span class="list-warning-text">${t.layerOnlySupportsListView}</span></div>`}}(0,s.c)("arcgis-map-config-popup-attachments",h)},42855:(e,t,a)=>{a.d(t,{a:()=>o,f:()=>s,l:()=>i,s:()=>n});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),i=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(i||{}),n=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(n||{}),o=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(o||{})},66228:(e,t,a)=>{a.d(t,{a:()=>b,b:()=>A,c:()=>P,d:()=>S,e:()=>k,f:()=>O,g:()=>g,h:()=>f,i:()=>u,j:()=>y,k:()=>x,l:()=>F,m:()=>T,n:()=>h,o:()=>C,p:()=>R,q:()=>N,r:()=>E,s:()=>v,t:()=>$,u:()=>w});var s=a(63438),i=a(18423),n=a(96086),o=a(91813),c=a(21255),r=a(13078),l=a(21303),p=a(12627),d=a(42855);const h=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],m=["feature"];function u(e){return null!=e}function y(e,t,a){const s=t.fieldName;if(s.includes(d.f.expression)){const e=a.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function g(e){return new Map((await x(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function f(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const a=`${d.f.expression}${e.name}`;t.set(a,e)}),t}function b(e){return"map-image"===e?.layer?.type?d.s.mapImage:"subtype-sublayer"===e?.type?d.s.subtype:"tile"===e?.layer?.type?d.s.tile:"scene"===e?.type?d.s.scene:"ogc-feature"===e?.type?d.s.ogcFeature:"imagery"===e?.type?d.s.imagery:"imagery-tile"===e?.type?d.s.imageryTile:"wfs"===e?.type?d.s.wfs:"wcs"===e?.type?d.s.wcs:"wms"===e?.layer?.type?d.s.wms:"csv"===e?.type?d.s.csv:"geojson"===e?.type?d.s.geojson:"stream"===e?.type?d.s.stream:"oriented-imagery"===e?.type?d.s.orientedImagery:"catalog"===e?.type?d.s.catalog:"catalog-footprint"===e?.type?d.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?d.s.knowledgeGraphSublayer:"voxel"===e?.type?d.s.voxel:"parquet"===e?.type?d.s.parquet:d.s.feature}function w(e){const t=b(e);let a;return t===d.s.wms||t===d.s.mapImage?a=e?.layer.version:(t===d.s.imagery||t===d.s.feature||t===d.s.scene)&&(a=e.version),Number.parseFloat(a)}function v(e){return"fieldConfigurations"in e&&m.includes(e.type)}async function x(e){return await new Promise((t,a)=>{switch(b(e)){case d.s.feature:case d.s.ogcFeature:case d.s.stream:t(e.fields);break;case d.s.mapImage:{const s=e,i=s?.layer;i?.portalItem&&i.url.includes("https://demographics")&&i.url.includes(".arcgis.com")?i.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const a=new Map(s.fields.map(e=>[e.name,e])),i=e.thematicGroup.fieldNames,n=[];i.forEach(e=>{a.has(e)&&n.push(a.get(e))}),t(n)}else t(s.fields)}).catch(e=>{a(new Error(e))}):t(s.fields);break}case d.s.imagery:case d.s.imageryTile:case d.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function C(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function T(e){return Number((100*(1-e)).toFixed(1))}function $(e){return Number((1-e/100).toFixed(3))}const S=(e,t)=>{const a=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(d.f.expression)||a.push({name:e.fieldName,alias:e.label,type:"string"})}),a},A=async(e,t)=>{const a=new p.default;return a.geometry=t.extent,a.mapExtent=t.extent,a.returnGeometry=!0,a.tolerance=6,a.layerOption="popup",a.width=t.width,a.height=t.height,a.layerIds=[e.id],(await l.identify(e.layer.url,a))?.results?.[0]?.feature},k=async(e,t,a)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await I(a,s.features?.[0])},I=async(e,t)=>{let a;if(t)a=t.clone();else{a=new s.default;const t=S(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),a.attributes=e}const n=new i.default;a.geometry=n}return a};function N(e,t){const a=t.startsWith("#"),s=t.startsWith(".");for((s||a)&&(t=t.slice(1));e;){if(a){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function P(e){if(b(e)===d.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(b(e)===d.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function F(e,t,a){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const a=t.get(e);s=a.type?a.type.toLowerCase():""}else if(a.has(e)){const t=a.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function O(e,t){try{const a=b(e);if(a===d.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await A(e,t)||await L(e,t)]};if(a===d.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await L(e,t)]};const s=a===d.s.ogcFeature||a===d.s.stream?await t.whenLayerView(e):e,i=s.createQuery();i.where=s.definitionExpression||"1=1",i.outFields=["*"],i.returnM="hasM"in e&&e.hasM,i.returnZ="hasZ"in e&&e.hasZ,i.outSpatialReference=t.spatialReference,i.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||a===d.s.ogcFeature)&&(i.start=0,i.num=1),i.outSpatialReference=t.spatialReference;const n=await s.queryFeatures(i);return n?.features?.length||(n.features[0]=await L(e,t)),n}catch(e){console.error(e)}}async function L(e,t){return await new Promise(a=>{const i=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),i.attributes=t}const l=t.extent;let p;"polygon"===e.geometryType?p=c.default.fromExtent(l):"point"===e.geometryType?p=l.center.clone():"multipoint"===e.geometryType?p=new n.default({points:[[l.center.x,l.center.y]],spatialReference:l.center.spatialReference.clone()}):"polyline"===e.geometryType?(p=new o.default({spatialReference:t.spatialReference.clone()}),p.addPath([[l.xmin,l.ymin],[l.xmax,l.ymax]])):"mesh"===e.geometryType&&(p=r.default.createBox(l.center.clone(),{size:{width:50,height:50,depth:50}})),i.geometry=p,a(i)})}function E(e){return b(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function R(e){return b(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},98295:(e,t,a)=>{a.d(t,{A:()=>i,C:()=>s,I:()=>o,P:()=>n});var s=(e=>(e.ATTRIBUTES="attributes",e.ATTACHMENTS="attachments",e.CHARTS="charts",e.IMAGES="images",e.RICH_TEXT="richText",e.ARCADE="arcade",e.RELATIONSHIP="relationship",e.ASSOCIATIONS="associations",e.EDIT_INFO_SUMMARY="editInfoSummary",e))(s||{}),i=(e=>(e.PREVIEW="preview",e.LIST="list",e.AUTO="auto",e))(i||{}),n=(e=>(e.IMAGE="image",e.BAR_CHART="bar-chart",e.COLUMN_CHART="column-chart",e.LINE_CHART="line-chart",e.PIE_CHART="pie-chart",e))(n||{}),o=(e=>(e.SOURCE_URL="sourceUrl",e.TITLE="title",e.CAPTION="caption",e.LINK_URL="linkUrl",e.ALT_TEXT="altText",e))(o||{})}}]);