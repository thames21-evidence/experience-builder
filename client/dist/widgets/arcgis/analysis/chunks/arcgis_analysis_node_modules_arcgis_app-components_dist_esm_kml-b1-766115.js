/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_kml-b1-766115.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_kml-b1-766115"],{32478:(e,t,i)=>{i.d(t,{a:()=>p,b:()=>g,c:()=>w,d:()=>d,e:()=>v,f:()=>y,g:()=>o,h:()=>u,i:()=>m,j:()=>h,p:()=>c});var n=i(59317),a=i(4429),r=i(931);const l={xmax:2e7,xmin:-2e7,ymax:2e7,ymin:-2e7,spatialReference:{wkid:102100}};function s(e,t){const i={102113:[-20037508.342788905,20037508.342788905],102100:[-20037508.342788905,20037508.342788905],3785:[-20037508.342788905,20037508.342788905],3857:[-20037508.342788905,20037508.342788905],4326:[-180,180]}[e];if(i&&t.xmin>t.xmax){const e=i[1]-t.xmin,n=t.xmax-i[0];e>n?t.xmax=i[1]+n:t.xmin=i[0]-e}}function o(e,t){var i,n;const a="ImageServer"!==t?null==e?void 0:e.spatialReference:null===(i=null==e?void 0:e.extent)||void 0===i?void 0:i.spatialReference;return a?a.wkid?a.wkid:a.wkt&&-1!==(null===(n=a.wkt)||void 0===n?void 0:n.search(/^PROJCS/i))?/^PROJCS\["[A-Za-z0-9_]*/i.exec(a.wkt)[0].split("[")[1]:null:null}async function u(e){var t,i;const[n]=await(0,r.l)(["esri/geometry/SpatialReference"]),l=(null===(t=null==e?void 0:e.spatialReference)||void 0===t?void 0:t.wkid)||(null===(i=null==e?void 0:e.spatialReference)||void 0===i?void 0:i.wkt),s=new n({wkid:4326}),o=await async function(e,t){const i=[102113,102100,3857];if((null==e?void 0:e.wkt)==(null==t?void 0:t.wkt)&&((null==e?void 0:e.wkid)==(null==t?void 0:t.wkid)||(0,a.c)(e.latestWkid)&&(null==e?void 0:e.latestWkid)==(null==t?void 0:t.wkid))||(0,a.c)(null==t?void 0:t.latestWkid)&&(null==e?void 0:e.wkid)==(null==t?void 0:t.latestWkid)||(0,a.c)(null==e?void 0:e.latestWkid)&&(null==e?void 0:e.latestWkid)==(null==t?void 0:t.latestWkid))return!0;if((null==e?void 0:e.wkid)&&(null==t?void 0:t.wkid)&&i.includes(null==e?void 0:e.wkid)&&i.includes(null==t?void 0:t.wkid))return!0;return!1}(s,null==e?void 0:e.spatialReference);return l&&!o?await p(e,s):e}async function d(e){const{extent:t}=e;return e.extent=v(await u(t)),e}async function c(e,t){const{portal:i}=n.c,[a,l]=await(0,r.l)(["esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]),o=[102113,102100,3857],u=e.spatialReference.wkid;if(u===t.wkid)return[e];let d;return 4326===u&&o.indexOf(t.wkid)>-1?(e.ymin=Math.max(e.ymin,-89.99),e.ymax=Math.min(e.ymax,89.99),d=a.geographicToWebMercator(e),s(t.wkid,d),d.spatialReference.wkid=t.wkid,[d]):o.indexOf(u)>-1&&4326===t.wkid?(d=a.webMercatorToGeographic(e),s(t.wkid,d),[d]):new Promise(async(n,a)=>{const s=l;try{const[a]=await(0,r.l)(["esri/rest/support/ProjectParameters"]),l=new a({geometries:[e],outSpatialReference:t});(e=>{const t=null==e?void 0:e[0];if("extent"!==(null==t?void 0:t.type)||isNaN(e[0].xmin)||isNaN(e[0].ymin)||isNaN(e[0].xmax)||isNaN(e[0].ymax)){if("point"!==(null==t?void 0:t.type)||isNaN(e[0].x)||isNaN(e[0].y))throw new Error;n(e)}else n(e)})(await s.project(i.helperServices.geometry.url,l))}catch(e){a(e)}})}async function p(e,t){var i;const[n]=await(0,r.l)(["esri/geometry/Extent"]),a=new n(l),s=e.clone?e.clone():new n(Object.assign({},e)),o=await c(s,t);return"extent"===(null===(i=null==o?void 0:o[0])||void 0===i?void 0:i.type)?o[0]:a}const m=e=>{const t=(e,t,i)=>e>=t&&e<=i;return t(e.ymax,-90,90)&&t(e.ymin,-90,90)&&t(e.xmax,-180,180)&&t(e.xmin,-180,180)&&e.ymax>e.ymin&&e.xmax>e.xmin};function v(e,t=4){if(!e)return v(l);if("string"==typeof e)return e;if(Array.isArray(e)){if(Array.isArray(e[0])&&Array.isArray(e[1])){let t,i;return 2===e[0].length&&(t=e[0],i=e[1]),4!==e[0].length&&6!==e[0].length||(t=[e[0][0],e[0][1]],i=[e[0][2],e[0][3]],6===e[0].length&&(i=[e[0][3],e[0][4]])),`${t.join(",")},${i.join(",")}`}return e.join(",")}return`${e.xmin.toFixed(t)},${e.ymin.toFixed(t)},${e.xmax.toFixed(t)},${e.ymax.toFixed(t)}`}const x="hiddenMapDiv",f=()=>{const e=document.getElementById(x);e&&e.parentNode.removeChild(e)},w=(e=200,t=130)=>{let i=document.getElementById(x);i||(i=document.createElement("div"),i.id=x,i.style.position="absolute",i.style.left="-1000px",i.style.top="-1000px",i.style.width=`${e}px`,i.style.height=`${t}px`,document.body.appendChild(i));const n=document.createElement("div"),a="hiddenMap";return n.id=a,n.style.width=`${e}px`,n.style.height=`${t}px`,i.appendChild(n),a};async function y(e){const{url:t,thumbnailURL:i,serviceInfo:l,extent:s}=e;if(i)return i;if(!["Map Service","Feature Service","Image Service"].includes(e.type))return null;if(["Map Service","Image Service"].includes(e.type)||-1!==t.indexOf("MapServer")){const e=v(s);return s?function(e){var t;let i,{visibleLayers:n,serviceUrl:a,serviceInfo:r,size:l,extent:s,bboxSR:o,imageSR:u,format:d}=e;if(!r)return"";let c=a.indexOf("/MapServer")>-1;if(!n&&c){let e;i=a.indexOf("/MapServer");const t=a.indexOf("?");t>-1?(e=a.substring(i+11,t),a=a.substring(0,i+10)+a.substring(t),n=e):(e=a.substring(i+11),a=a.substring(0,i+10),n=e)}!c&&r&&(c=r.capabilities?r.capabilities.toLowerCase().indexOf("map")>-1:r.supportedImageFormatTypes);let p=a;if(i=p.indexOf("?"),-1===i)if(c)p+="/export?";else{if(void 0!==r.currentVersion&&r.currentVersion>=10.1)return p+="/info/thumbnail",p;p+="/exportImage?"}else if(c)p=`${p.substring(0,i)}/export${p.substring(i,p.length)}&`;else{if(void 0!==r.currentVersion&&r.currentVersion>=10.1)return p=`${p.substring(0,i)}/info/thumbnail${p.substring(i,p.length)}`,p;p=`${p.substring(0,i)}/exportImage${p.substring(i,p.length)}&`}p+=`size=${l}&bbox=${s}`,(null==o?void 0:o.length)>0&&(p+=`&bboxSR=${o}`);(null==u?void 0:u.length)>0&&(p+=`&imageSR=${u}`);c&&(null===(t=null==r?void 0:r.supportedImageFormatTypes)||void 0===t?void 0:t.indexOf("PNG32"))>-1?p+=`&format=png32&f=${d}`:p+=c?`&format=png24&f=${d}`:`&format=jpgpng&f=${d}`;c?(null==n?void 0:n.length)>0&&(p+=`&layers=show:${n}`):p+="&interpolation=RSP_NearestNeighbor&bandIds=null";return p}({serviceUrl:t,extent:e,size:"800,532",format:"image",serviceInfo:l}):null}const o=await async function(e,t){var i,n,l;const[s,o,u,d,c,p,m,v]=await(0,r.l)(["esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/Basemap","esri/rest/print","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/smartMapping/heuristics/scaleRange"]);try{const r=w(800,532),x=t.defaultBasemap.id.includes("basemap"),y=new u({portalItem:{id:e,portal:t}}),g=new s({basemap:x?"topo-vector":new d({portalItem:{id:t.defaultBasemap.id,portal:t}})}),h=new o({map:g,container:r});await g.watch("loaded");let b=0,k=0;x||({minScale:b,maxScale:k}=await v({layer:y,view:h}));const S=await y.queryExtent();h.goTo(S.extent),y.minScale=b,y.maxScale=k,h.map.add(y),h.scale=k,await(0,a.t)(2e3);const M=null!==(l=null===(n=null===(i=t.helperServices)||void 0===i?void 0:i.printTask)||void 0===n?void 0:n.url)&&void 0!==l?l:"https://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",$=new m({view:h,template:new p({format:"png32",exportOptions:{dpi:96,width:800,height:532},layout:"map-only",showLabels:!1,attributionVisible:!1})}),R=await c.execute(M,$);return f(),R.url}catch(e){return f(),null}}(e.id,n.c.portal);return o||(console.error("Error generating thumbnail"),"")}async function g(e,t,i){var a;const[l]=await(0,r.l)(["esri/rest/geoprocessor"]),{portal:s}=n.c;(null!==(a=e.baseMap.baseMapLayers)&&void 0!==a?a:[]).forEach(e=>{delete e.resourceInfo}),e.mapOptions={showAttribution:!1,extent:{xmin:t[0][0],ymin:t[0][1],xmax:t[1][0],ymax:t[1][1],spatialReference:{wkid:4326}},spatialReference:i},e.exportOptions={dpi:96,outputSize:[600,400]},e.layoutOptions={};const o={Web_Map_as_JSON:JSON.stringify(e),Format:"PNG32",Layout_Template:"MAP_ONLY"},{results:u}=await l.execute(s.helperServices.printTask.url,o),d=u.find(e=>"data-file"===e.dataType&&e).value.url;if(!d)throw new Error("Failed to create thumbnail");return d}async function h(e){var t;const[i]=await(0,r.l)(["esri/geometry/SpatialReference"]),{config:a,portal:l}=n.c,s={};s.baseMap=a.defaultBasemap||l.defaultBasemap,s.baseMap.title="basemap",s.operationalLayers=[];let o=e.url;o||"KML"!==e.type||(o=a.restBaseUrl+"content/items/"+e.id+"/data");const u=new URL(a.restBaseUrl).hostname;if(o.indexOf(u)>-1){const e=null===(t=null==a?void 0:a.userInfo)||void 0===t?void 0:t.token;e&&(o+="?token="+e)}s.operationalLayers.push({url:o,id:"KML_"+Math.random(),opacity:1,title:e.title,visibility:!0,type:"KML"});let d=[];if("string"==typeof e.extent){const t=e.extent.split(",");d=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]]}else d=e.extent&&e.extent.length>0?e.extent:[[-180,-90],[180,90]];return g(s,d,new i({wkid:4326}))}}}]);