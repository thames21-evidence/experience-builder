/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_delete-4e7a04.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_delete-4e7a04"],{46904:(e,t,r)=>{r.d(t,{a:()=>o,b:()=>a,c:()=>c,d:()=>d,e:()=>u,f:()=>p,g:()=>m,i:()=>s,u:()=>l});r(93814);var i=r(41473);function n(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function a(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function o(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function s(e,t){return e.owner===t.username}function l(e,t){return s(e,t)||function(e,t){var r;if(null!=e.isAdmin)return!!e.isAdmin;const i=e.owner,n="admin"===e.itemControl,a=["esri_livingatlas","esri_demographics","esri_boundaries"];if((null===(r=e.portal)||void 0===r?void 0:r.isPortal)&&!s(e,t)&&n&&i.includes("esri_")&&!a.includes(i))return!1;return n}(e,t)}const c=(e,t)=>!!t.orgId&&e.every(e=>e.isOrgItem),d=(e,t)=>`${(0,i.a)(t)}item.html?id=${e}`,u=(e,t)=>`${(0,i.g)(t)}/content/users/${e}`,p=e=>e.reduce((e,t)=>(e[t.owner]=e[t.owner]?[...e[t.owner],t.id]:[t.id],e),{}),m=(e,t)=>`${(0,i.a)(t)}content/items/${e}`},51312:(e,t,r)=>{r.d(t,{a:()=>d,b:()=>h,c:()=>w,d:()=>c,e:()=>g,f:()=>E,g:()=>m,i:()=>C,s:()=>D});var i=r(4429),n=(r(93814),r(59317),r(68616)),a=r(52995),o=r(46904),s=r(41473),l=r(83692);const c=async(e,t,r=!1)=>{const i=`${(0,o.e)(e.owner,t)}/items/${e.id}/delete`;return(0,l.r)(i,{permanentDelete:r},{},"post")},d=async(e,t,r=!1)=>{const n=(0,o.f)(e),a=[];for(const e in n){const s=`${(0,o.e)(e,t)}/deleteItems`,c=n[e];(0,i.g)(c,100).forEach(e=>{const t={items:e.join(","),permanentDelete:r};a.push((0,l.r)(s,t,{},"post"))})}return{results:(await Promise.all(a)).flatMap(e=>e.results)}},u=async(e,t)=>{var r;const{type:i,typeKeywords:n}=e,o=["Scene Service","Map Service","WFS","OGCFeatureServer","Vector Tile Service","3DTiles Service"].includes(i),s=["Map Service","Vector Tile Service"].includes(i);try{const l=o?[{relationshipType:"Service2Service",direction:"reverse"},{relationshipType:"Service2Data",direction:"forward"}]:n.indexOf("Bulk Published Service")>-1?{relationshipType:"DataStore2BPService",direction:"reverse"}:"Geoprocessing Service"===i&&n.includes("Notebook Web Tool")?{relationshipType:"Notebook2WebTool",direction:"reverse"}:n.includes("Route Layer")?{relationshipType:"Service2Route",direction:"reverse"}:"Mobile Application"===i?{relationshipType:"MobileApp2Code",direction:"reverse"}:"Map Package"===i?{relationshipType:"Area2Package",direction:"reverse"}:"Route Layer"===i?{relationshipType:"Service2Route",direction:"reverse"}:"Feature Service"===i?{relationshipType:"Service2Layer",direction:"reverse"}:n.includes("Document")?{relationshipType:"Item2Attachment",direction:"reverse"}:"Application Configuration"===i?{relationshipType:"Map2AppConfig",direction:"reverse"}:{relationshipType:"Service2Data",direction:"forward"};if(!l)return null;if(!Array.isArray(l)){return{sourceData:null===(r=(await(0,a.c)(e.id,t,l)).relatedItems)||void 0===r?void 0:r[0],relationship:l}}if(o){let r={relationshipType:"Service2Service",direction:"reverse"};const i=await(0,a.c)(e.id,t,r),n=(null==i?void 0:i.total)?i.relatedItems.shift():null;if(s&&!(e=>(null==e?void 0:e.typeKeywords.includes("View Service"))||!1)(n)||!n){r={relationshipType:"Service2Data",direction:"forward"};const i=await(0,a.c)(e.id,t,r);return{sourceData:(null==i?void 0:i.total)?i.relatedItems.shift():n,relationship:r}}return{sourceData:n,relationship:r}}}catch(e){return console.error(e),{sourceData:null,relationship:{relationshipType:null}}}},p=async(e,t)=>{try{const{type:r,typeKeywords:i}=e,o=(()=>"Notebook"===r?{relationshipType:"Notebook2WebTool",direction:"forward"}:i.includes("Has Related Route Layers")?{relationshipType:"Service2Route",direction:"forward"}:(0,n.i)(i,r)?{relationshipType:"Service2Service",direction:"Feed"===r?"reverse":"forward"}:"Data Store"===r||i.includes("ArcGIS Server")?{relationshipType:"DataStore2BPService",direction:"forward"}:{relationshipType:"Service2Data",direction:"reverse"})(),s=await(0,a.c)(e.id,t,o);return{resultData:{items:s.total>0?s.relatedItems:null,count:s.aggregations.total.count},relationship:o}}catch(e){return console.error(e),{resultData:null,relationship:{relationshipType:null}}}};async function m(e,t){const r=await(0,l.r)(`${(0,s.e)(e)}portals/helpmap?culture=${t}`);return null==r?void 0:r.helpMap.m}const v=["Area2Package","Item2Attachment","Listed2Provisioned","Map2AppConfig","Map2Area","Map2IndoorsConfig","MobileApp2Code","Notebook2WebTool","Service2Layer","Service2Route","WMA2Code"],y=["ArcgisWorkflowManager","ArcGISWorkflowJobLocation","Workflow Manager"],h=async(e,t,r=!1)=>{const i=[],s=[],c=[],d=[],m=({item:t,sourceData:i,resultData:a,replacementItemFor:o})=>{const s=((e,t,r)=>{const{typeKeywords:i,type:a}=e;return!t&&(null==r?void 0:r.length)&&!(0,n.i)(i,a)})(t,i,a),l=!!o;return{preventSourceDelete:!s&&(null==a?void 0:a.filter(e=>!e.inRecycleBin).length)>0&&!T(t,a)&&!I(t,a),discourageSourceDelete:s,discouragedAllowedSourceItem:r&&1===e.length&&s?{item:t,error:{message:"Delete discouraged: dependent"}}:l&&!s?{item:t,error:{message:"Delete discouraged: replacement",offendingItems:o}}:null}},h=async(r,i)=>{var n;const{sourceData:s,relationship:c}=await u(r,t),{resultData:d,relationship:w}=await p(r,t),{replacementItem:g}=await(async(e,t)=>{try{const r=await(0,a.c)(e.id,t,{relationshipType:"ReplacementItem2Item",direction:"forward"});return{replacementItem:{items:r.total>0?r.relatedItems:null,count:r.aggregations.total.count}}}catch(e){return console.error(e),{replacementItem:null}}})(r,t),f=v.includes(c.relationshipType),T=v.includes(w.relationshipType);try{const{preventSourceDelete:n,discourageSourceDelete:a,discouragedAllowedSourceItem:c}=m({item:r,sourceData:s,resultData:null==d?void 0:d.items,replacementItemFor:null==g?void 0:g.items}),u=await(async e=>{var t,r;const{item:i,portal:n,permanentlyDelete:a}=e,s=(null!==(r=null===(t=n.sourceJSON)||void 0===t?void 0:t.recycleBinEnabled)&&void 0!==r?r:n.recycleBinEnabled)&&!a?"/canRecycle":"/canDelete",c=`${(0,o.e)(i.owner,n)}/items/${i.id}${s}`;return await(0,l.r)(c)})({item:r,portal:t,permanentlyDelete:i});return u.success?T?{bucket:"UNPROTECTED",bucketItem:{item:r,relatedItems:{resultData:d,isComposite:!0}}}:c?{bucket:"UNPROTECTED",bucketItem:c}:await S({selectedItems:e,resultData:null==d?void 0:d.items,portal:t})||!a&&!n?{bucket:i?"UNRECYCLABLE":"UNPROTECTED",bucketItem:{item:r,relatedItems:{resultData:d}}}:{bucket:"PROTECTED",bucketItem:{item:r,error:a?{message:"Delete discouraged",offendingItems:d.items}:{messageCode:"CONT_00481",offendingItems:d.items}}}:r.protected?{bucket:"PROTECTED",bucketItem:{item:r,error:{messageCode:"CONT_0048"}}}:{bucket:"UNRECYCLABLE",bucketItem:{item:r}}}catch(a){const o=(null===(n=null==a?void 0:a.details)||void 0===n?void 0:n.raw)||Object.assign({},a);switch(a.messageCode||o.messageCode){case"CONT_00481":case"CONT_00484":{o.offendingItems=d.items;const i=!y.some(e=>r.typeKeywords.includes(e));return await S({selectedItems:e,resultData:d.items,portal:t})?{bucket:i?"UNPROTECTED":"UNRECYCLABLE",bucketItem:{item:r,relatedItems:{resultData:d}}}:{bucket:"PROTECTED",bucketItem:{item:r,error:o}}}case"CONT_0048":return{bucket:"PROTECTED",bucketItem:{item:r,error:o}};case"CONT_0298":return f&&b({items:e,sourceData:s})?{bucket:"COMPOSITE",bucketItem:{item:r,relatedItems:{sourceData:s}}}:i?{bucket:"UNRECYCLABLE",bucketItem:{item:r,relatedItems:{sourceData:s}}}:h(r,!0);default:return console.error(a),{bucket:"PROTECTED",bucketItem:{item:r,error:o}}}}};return await Promise.all(e.map(async e=>{const{bucket:t,bucketItem:r}=await h(e);switch(t){case"UNPROTECTED":s.push(r);break;case"PROTECTED":i.push(r);break;case"UNRECYCLABLE":c.push(r);break;case"COMPOSITE":d.push(r)}})),Promise.resolve({protectedItems:i,unprotectedItems:s,unrecyclableItems:c,selectedCompositeItems:d})},w=e=>{const{protectedItems:t,unrecyclableItems:r,unprotectedItems:i}=e,n=[];return t.length>0&&n.push("PROTECTED"),r.length>0&&n.push("UNRECYCLABLE"),i.length>0&&n.push("UNPROTECTED"),n.join("_")},g=e=>{let t="DELETE";switch(e){case"PROTECTED":t="NONE";break;case"UNRECYCLABLE":case"PROTECTED_UNRECYCLABLE":t="PERMANENTLY_DELETE"}return t},S=async e=>{var t,r;const{selectedItems:n,offendingItems:a,resultData:o,portal:s}=e,l=null!==(t=await f({items:o,portal:s}))&&void 0!==t?t:[],c=null!==(r=null==a?void 0:a.map(e=>e.itemId))&&void 0!==r?r:[],d=(0,i.b)([...l,...c]),u=n.filter(e=>d.includes(e.id)),p=d.every(e=>n.some(t=>t.id===e)),m=u.every(e=>!e.protected);return p&&m},f=async e=>{var t,r;null!==(t=e.accumulatedIds)&&void 0!==t||(e.accumulatedIds=[]);const{items:i,portal:n,accumulatedIds:a}=e;if(!i)return a;const o=i.filter(e=>!e.inRecycleBin);a.push(...o.map(e=>e.id));for(const e of null!=o?o:[]){const{resultData:t}=await p(e,n);return f({items:null!==(r=null==t?void 0:t.items)&&void 0!==r?r:[],accumulatedIds:a,portal:n})}return a},b=e=>{const{items:t,sourceData:r}=e;return!!r&&t.find(e=>e.id===r.id)},T=(e,t)=>{const{typeKeywords:r,type:i}=e;return"Feed"===e.type&&(0,n.i)(r,i)&&1===(null==t?void 0:t.length)&&"Feature Service"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},I=(e,t)=>{const{typeKeywords:r,type:i}=e;return"Feature Service"===e.type&&(0,n.i)(r,i)&&1===(null==t?void 0:t.length)&&"Feed"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},E=({item:e})=>{var t,r;const{typeKeywords:i,type:a}=e;return(0,n.i)(i,a)&&"Feature Service"===e.type&&!!(null!==(r=null===(t=e.sourceJSON)||void 0===t?void 0:t.origin)&&void 0!==r?r:null==e?void 0:e.origin)},D=e=>{const{deletedItems:t,permanentlyDeletedItems:r}=e,i={successes:[],errors:[]};for(const e of t)e.success?i.successes.push(Object.assign(Object.assign({},e),{permanentDelete:!1})):i.errors.push(Object.assign(Object.assign({},e),{permanentDelete:!1}));for(const e of r)e.success?i.successes.push(Object.assign(Object.assign({},e),{permanentDelete:!0})):i.errors.push(Object.assign(Object.assign({},e),{permanentDelete:!0}));return i},C=e=>{var t;return 1===e.length&&(null===(t=e[0].relatedItems)||void 0===t?void 0:t.isComposite)}},52995:(e,t,r)=>{r.d(t,{a:()=>f,b:()=>u,c:()=>p,d:()=>m,e:()=>v,f:()=>d,g:()=>y,l:()=>b});var i=r(83692),n=r(71467),a=r(46904),o=r(931),s=r(41473),l=r(29599),c=r(60958);const d=async(e,t,r)=>{const{owningSystemUrl:n}=await(0,i.f)(async()=>(0,l.a)(e),"portalInfo",e.id);return(await Promise.all(t.map(async e=>{try{const{owningSystemUrl:t}=await(0,l.g)(e,r);return{owningSystemUrl:t,url:e}}catch(t){return console.error(t),{owningSystemUrl:null,url:e}}}))).filter(({owningSystemUrl:e})=>e===n).map(({url:e})=>e)},u=async(e,t,r)=>{var n;try{return{result:await(0,i.r)(e,t,Object.assign({addTokenManually:!1},r))}}catch(e){const t="token required";return(null===(n=null==e?void 0:e.message)||void 0===n?void 0:n.toLowerCase().includes(t))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function p(e,t,r){var n;const{relationshipType:a,direction:o}=r,l=`${(0,s.g)(t)}content/items/${e}/relatedItems`,c=await(0,i.r)(l,{relationshipType:a,direction:o,includeRecycleBin:!0});return(null===(n=null==c?void 0:c.relatedItems)||void 0===n?void 0:n.length)&&(c.relatedItems=c.relatedItems.filter(t=>(null==t?void 0:t.id)!==e)),c}const m=async(e,t,r)=>{const n=!!r,a=(0,s.g)(t),o=n?`${a}/content/groups/${r.id}/search`:`${a}/search`;try{return{result:(await(0,i.r)(o,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},v=async(e,t)=>{try{const[r]=await(0,o.l)(["esri/portal/PortalItem"]);return{result:await Promise.all(e.map(e=>new r({id:e,portal:t}).load()))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},y=async(e,t,r,n)=>{try{const a=[],o=[],s=[];await Promise.all(e.map(async e=>{const{result:c,error:d}=await(0,i.f)(()=>u(e,t,n),"itemMetadata",`${e}--no-token`);if("tokenRequired"!==(null==d?void 0:d.code))if(h(c))a.push(w(c,e));else try{const t=await(0,l.g)(e,r);s.push(Object.assign(Object.assign({},c),{owningSystemUrl:t.owningSystemUrl}))}catch(d){console.warn(d)}else o.push(e)}));const p=await d(t,o,r),m=(await Promise.all(p.map(async e=>({response:await(0,c.r)(e,t,Object.assign({addTokenManually:!0},n)),owningSystemUrl:(await(0,l.g)(e,r)).owningSystemUrl,url:e})))).reduce((e,{response:t,url:r,owningSystemUrl:i})=>h(t)?(a.push(w(t,r)),e):[...e,Object.assign(Object.assign({},t),{owningSystemUrl:i})],[]),v=await Promise.all([...s,...m].map(async({serviceItemId:e,owningSystemUrl:t})=>{if(!e)return null;const{result:r}=await S({itemId:e,owningSystemUrl:t});return{item:r,owningSystemUrl:t}})),{result:g}=a.length<=0?{result:[]}:await y(a,t,r,n);return{result:[...v.filter(e=>!!e),...g]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},h=e=>!!(null==e?void 0:e.sources),w=(e,t)=>{var r;const i=null===(r=Object.values(e.sources)[0])||void 0===r?void 0:r.url;return i?i.includes("..")?(0,s.t)({url:t,path:i}):i:null},g=e=>`${e}/sharing/rest`,S=async({itemId:e,owningSystemUrl:t,requestOptions:r})=>{try{const n=(0,a.g)(e,g(t));return{result:await(0,i.r)(n,{},Object.assign(Object.assign({},r),{addTokenManually:!1}))}}catch(e){return console.error(e),(0,n.b)(e)&&e.message.toLocaleLowerCase().includes("invalid token")?{error:{code:"invalidToken"}}:{error:{code:"unhandledError"}}}},f=async({itemId:e,owningSystemUrl:t,requestOptions:r})=>{try{const n=`${(0,a.g)(e,g(t))}/data`;return{result:await(0,i.r)(n,{},Object.assign(Object.assign({},r),{addTokenManually:!1}))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},b=async(e,t)=>{try{const[r]=await(0,o.l)(["esri/portal/PortalItem"]),i=new r({id:e,portal:t});return await i.load(),{result:i}}catch(e){return console.error("Fail to reload item",e),{error:{code:"unhandledError"}}}}},60958:(e,t,r)=>{r.d(t,{r:()=>n});var i=r(83692);const n=async(e,t,r={})=>{const{body:n,usePost:a,addTokenManually:o,customToken:s}=r,l=new URLSearchParams;n&&Object.entries(n).forEach(([e,t])=>{void 0!==t&&l.append(e,t)});const c=new URL(e);if(c.searchParams.append("f","json"),s)c.searchParams.append("token",s);else{const e=!1===o?null:await(0,i.g)(t);e&&c.searchParams.append("token",e)}const d=await fetch(c.toString(),{body:a?l:void 0,method:a?"POST":"GET"}),u=await d.json(),p=u.error;if(p)throw"string"==typeof p?new Error(p):p;return u}},68616:(e,t,r)=>{r.d(t,{i:()=>i});const i=(e,t)=>"Feature Service"===t&&e.includes("Hosted Service")},71467:(e,t,r)=>{r.d(t,{a:()=>n,b:()=>a,i:()=>o});const i=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","invalidToken","invalid3DObjectFeatureClass","invalidClassification","serviceNameInvalid","titleInvalid","titleStartsWithNumber","titleRequired","titleInUseService","itemInRecycleBin","summaryInvalid","descriptionInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","invalidKeyFile","unauthorizedCredentials","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType","failToCreate3DLayer"],n=e=>i.includes(null==e?void 0:e.code),a=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),o=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}}}]);