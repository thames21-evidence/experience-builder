/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-0f1c28.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-0f1c28"],{5706:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigFeatureReduction:()=>R});var s=i(73679),r=i(4395),a=i(69548),n=i(57715),o=i(20880),c=i(43811),l=i(31092),u=i(29614),d=i(70169),f=i(81565),p=i(22679),g=(i(83930),i(23054),i(77462),i(56451),i(76830)),h=i(66228),m=i(85643),y=i(73801),w=i(47640),b=i(36486);const v=r.AH`:host{height:100%}.flow,.panel{height:100%}.toggle{background-color:#fff;padding:15px 10px 5px}.feature-specific-effects-notice{margin:var(--calcite-spacing-lg)}`;class R extends y.WF{constructor(){super(...arguments),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new w.YZ(this,{task:async([e,t,i])=>{if(!((0,h.i)(e)&&(0,h.i)(t)&&(0,h.i)(i)))throw console.error("[arcgis-map-config-feature-reduction] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,this.init()},args:()=>[this.layer,this.portal,this.config]}),this._messages=(0,b.u)({blocking:!0}),this.flowNode=(0,m._)(),this.flowItemNode=(0,m._)(),this.switchNode=(0,m._)(),this.tileNodes={binning:void 0,cluster:void 0,"pie-chart":void 0},this.lastFeatureReduction={binning:void 0,cluster:void 0,"pie-chart":void 0},this.hideLayerTitle=!1,this.symbolStylerConfig={},this.allowTimeSeriesConfiguration=!1,this.arcgisActive=(0,y.lh)(),this.arcgisChange=(0,y.lh)(),this.arcgisClose=(0,y.lh)(),this.arcgisError=(0,y.lh)(),this.arcgisStyleBtnBackClick=(0,y.lh)(),this.arcgisStyleBtnClick=(0,y.lh)(),this.arcgisArcadeTimeExpressionChange=(0,y.lh)()}static{this.properties={options:16,view:0,layer:0,portal:0,config:0,hideLayerTitle:5,symbolStylerConfig:0,allowTimeSeriesConfiguration:5}}static{this.styles=v}async setFocus(){this.flowItemNode.value?.setFocus()}updated(){if(this._propWatcherTask.status===w.e1.COMPLETE&&this._initialized&&!this._loaded){this._loaded=!0,this.flowItemNode.value?.setFocus();const{props:e}=this,{layer:t}=e,i=t.featureReduction;if(i&&!i.fields?.length){const e=new a.default({name:"aggregateCount",onStatisticField:void 0,alias:"aggregateCount",statisticType:"count",visible:!0});t.featureReduction.fields=[e]}i&&this.arcgisActive.emit(!0)}}disconnectedCallback(){super.disconnectedCallback(),this.arcgisActive.emit(!1)}init(){const{view:e,layer:t}=this;this.props={view:e,layer:t},this.initializeFieldInfos(),this._initialized=!0}tileNodesBinningRefHandler(e){this.tileNodes.binning=e}tileNodesClusterRefHandler(e){this.tileNodes.cluster=e}tileNodesPieChartRefHandler(e){this.tileNodes["pie-chart"]=e}async handleToggleFeatureReduction(e){e.currentTarget.checked?await this.enableFeatureReduction("default"):this.disableFeatureReduction(),this.requestUpdate()}async enableFeatureReduction(e){const{props:t,flowItemNode:i}=this,{layer:s}=t,{renderer:r}=s,a=this.isSpike(),n="unique-value"===r.type&&!!r.field2,o="heatmap"===r.type,c="pie-chart"===r.type;if("default"===e&&this.lastFeatureReductionType&&this.lastFeatureReduction[this.lastFeatureReductionType])s.featureReduction=this.lastFeatureReduction[this.lastFeatureReductionType],s.featureReduction=s.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisActive.emit(!0);else{"default"===e&&(e=a||o||c||n||"point"!==s.geometryType&&"multipoint"!==s.geometryType?"binning":"cluster");const t=(0,p.g)(s);if(t&&("binning"===s.featureReduction.type&&(s.featureReduction.labelsVisible=!1),this.lastFeatureReduction[t]=s.featureReduction),this.lastFeatureReduction[e])s.featureReduction=this.lastFeatureReduction[e],s.featureReduction=s.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisActive.emit(!0);else try{i.value.loading=!0,"binning"===e?await this.createBinning():await this.createCluster(e),i.value.loading=!1,s.featureReduction=s.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisActive.emit(!0)}catch{i.value.loading=!1,this.arcgisError.emit({message:"Feature reduction style could not be changed.",type:"warning"}),this.arcgisActive.emit(!1),this.requestUpdate()}}}async createCluster(e){const{props:t,switchNode:{value:i},tileNodes:s}=this,{layer:r,view:a}=t,n=r.featureReduction;try{const t="cluster"===e&&await c.getLabelSchemes({layer:r,renderer:r.renderer,view:a});let i;r.featureReduction={type:"cluster",clusterMinSize:t?.primaryScheme?.clusterMinSize||p.b,clusterMaxSize:p.a,clusterRadius:p.c,labelsVisible:"cluster"===e,labelingInfo:t?.primaryScheme?.labelingInfo},"pie-chart"===e&&(i=await d.createRendererForClustering({layer:r}),r.featureReduction.renderer=i.renderer,r.featureReduction.fields=r.featureReduction.fields.concat(i.fields));const s=await l.getTemplates({layer:r,renderer:r.renderer});if("cluster"===e){const e=s.primaryTemplate.value;r.featureReduction.popupTemplate=e}else{const e=s.secondaryTemplates[0].value;r.featureReduction.popupTemplate=e,i&&i.fields.forEach(e=>(0,g.a)(e,r))}await Promise.resolve()}catch{r.featureReduction=n,r.featureReduction?s[(0,p.g)(r)].setFocus():i.setFocus(),await Promise.reject(new Error("Failed to create clusters"))}}async createBinning(){const{props:e,switchNode:{value:t},tileNodes:i}=this,{layer:s,view:r}=e,c=s.featureReduction;try{const e=await(0,n.default)({view:r});if(s.featureReduction={type:"binning",fixedBinLevel:e||1},!s.featureReduction.fields?.length){const e=new a.default({name:"aggregateCount",onStatisticField:void 0,alias:"aggregateCount",statisticType:"count",visible:!0});s.featureReduction.fields=[e]}const t=await u.createContinuousRenderer({layer:s,view:r,field:"aggregateCount",outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,defaultSymbolEnabled:!1,forBinning:!0});s.featureReduction.renderer=t.renderer;const i=await o.getLabelSchemes({layer:s});s.featureReduction.labelingInfo=i?.primaryScheme?.labelingInfo,s.featureReduction.labelsVisible=!1;const c=s.featureReduction.fields.map(e=>e.onStatisticField),l=f.createPopupTemplateForFeatureReduction({featureReduction:s.featureReduction,fields:s.fields.filter(e=>c.includes(e.name))});return s.featureReduction.popupTemplate=l,await Promise.resolve()}catch{return s.featureReduction=c,s.featureReduction?i[(0,p.g)(s)].setFocus():t.setFocus(),void await Promise.reject(new Error("Failed to create binning"))}}disableFeatureReduction(){const{props:e}=this,{layer:t}=e,i=(0,p.g)(t);"binning"===i?(t.featureReduction.labelsVisible=!1,this.lastFeatureReduction[i]=t.featureReduction):this.lastFeatureReduction[i]=t.featureReduction,this.lastFeatureReductionType=i,t.featureReduction=null,this.arcgisChange.emit(),this.arcgisActive.emit(!1)}initializeFieldInfos(){const{layer:e}=this,t=e.featureReduction;t?.popupTemplate&&!t.popupTemplate.fieldInfos&&t.fields.forEach(t=>(0,g.a)(t,e))}isSpike(){const{layer:e}=this,{renderer:t}=e;return!!t.authoringInfo?.visualVariables?.some(e=>"spike"===e.theme)}closePopovers(){const{tileNodes:e}=this;e.binning&&e.binning.closePopovers(),e.cluster&&e.cluster.closePopovers(),e["pie-chart"]&&e["pie-chart"].closePopovers()}render(){return this._propWatcherTask.render({complete:()=>{const{layer:e,options:t}=this;return this.el.classList.add("calcite-match-height"),r.qy`<calcite-flow class="flow" .customItemSelectors=${"arcgis-map-config-feature-reduction-clustering, arcgis-map-config-feature-reduction-binning, arcgis-map-config-feature-reduction-fields"} ${(0,m.K)(this.flowNode)}>${"featureEffect"in e&&e.featureEffect?this.renderFeatureSpecificEffectsMessage():this.renderFeatureReductionOptions()}${(t===p.F.CLUSTERING||t===p.F.CHART_CLUSTERING)&&this.renderClusteringOptions()||""}${t===p.F.BINNING&&this.renderBinningOptions()||""}</calcite-flow>`}})}renderFeatureSpecificEffectsMessage(){const{layer:e,hideLayerTitle:t,_messages:i}=this;return r.qy`<calcite-flow-item .heading=${i.aggregation} .description=${t?void 0:e.title??void 0} class="panel" closable @calciteFlowItemClose=${()=>this.arcgisClose.emit()} ${(0,m.K)(this.flowItemNode)}><calcite-card class="feature-specific-effects-notice"><div slot=description>${i.cluster.leNotSupportedMessage}</div></calcite-card></calcite-flow-item>`}renderFeatureReductionOptions(){const{props:e,hideLayerTitle:t,config:i,flowItemNode:a,options:n,_messages:o}=this,{layer:c}=e,l=c.featureReduction,u={flowItemNode:a.value,_messages:o,config:i},{renderer:d}=c,f=this.isSpike(),g="unique-value"===d.type,h=g&&!!d.field2,y="heatmap"===d.type,w="pie-chart"===d.type,b=!!d.valueExpression,v="class-breaks"===d.type&&"class-breaks-color"===d.authoringInfo?.type,R=g?d.uniqueValueInfos?.length:v?d.classBreakInfos?.length:0,C=!(f||y||w||h||"point"!==c.geometryType&&"multipoint"!==c.geometryType),T=(g||v)&&R<=10&&!h&&!b&&("point"===c.geometryType||"multipoint"===c.geometryType),F=(0,p.g)(c);return r.qy`<calcite-flow-item .heading=${o.aggregation} .description=${t?void 0:c.title??void 0} class="panel" closable .selected=${![p.F.CLUSTERING,p.F.CHART_CLUSTERING,p.F.BINNING].includes(n)} @calciteFlowItemScroll=${()=>this.closePopovers()} @calciteFlowItemClose=${()=>this.arcgisClose.emit()} ${(0,m.K)(this.flowItemNode)}><div class="toggle"><calcite-label layout=inline-space-between>${o.enableAggregation}<calcite-switch .checked=${!!l} .label=${o.enableAggregation} @calciteSwitchChange=${this.handleToggleFeatureReduction} ${(0,m.K)(this.switchNode)}></calcite-switch></calcite-label></div><div>${C&&r.qy`<arcgis-map-config-feature-reduction-tile .props=${{title:o.clustering,imagePath:(0,s.g)("./assets/map-config-feature-reduction/map-config-feature-reduction-thumbnails/clustering.jpg"),moreInfo:o.info.clustering,helpId:"120003927",...u}} .selected=${"cluster"===F} @arcgisSelect=${async()=>{this.closePopovers(),await this.enableFeatureReduction("cluster"),this.requestUpdate()}} @arcgisOptionsClick=${()=>{this.closePopovers(),this.options=p.F.CLUSTERING,this.requestUpdate()}} ${(0,m.K)(this.tileNodesClusterRefHandler)}></arcgis-map-config-feature-reduction-tile>`||""}${T&&r.qy`<arcgis-map-config-feature-reduction-tile .props=${{title:o.chartClustering,imagePath:(0,s.g)("./assets/map-config-feature-reduction/map-config-feature-reduction-thumbnails/chartClustering.jpg"),moreInfo:o.info.chartClustering,helpId:"120003927",...u}} .selected=${"pie-chart"===F} @arcgisSelect=${async()=>{this.closePopovers(),await this.enableFeatureReduction("pie-chart"),this.requestUpdate()}} @arcgisOptionsClick=${()=>{this.closePopovers(),this.options=p.F.CHART_CLUSTERING,this.requestUpdate()}} ${(0,m.K)(this.tileNodesPieChartRefHandler)}></arcgis-map-config-feature-reduction-tile>`||""}${r.qy`<arcgis-map-config-feature-reduction-tile .props=${{title:o.binning,imagePath:(0,s.g)("./assets/map-config-feature-reduction/map-config-feature-reduction-thumbnails/binning.jpg"),moreInfo:o.info.binning,helpId:"120003926",...u}} .selected=${"binning"===F} @arcgisSelect=${async()=>{this.closePopovers(),await this.enableFeatureReduction("binning"),this.requestUpdate()}} @arcgisOptionsClick=${()=>{this.closePopovers(),this.options=p.F.BINNING,this.requestUpdate()}} ${(0,m.K)(this.tileNodesBinningRefHandler)}></arcgis-map-config-feature-reduction-tile>`||""}</div></calcite-flow-item>`}renderClusteringOptions(){const{props:e,hideLayerTitle:t,portal:i,config:s,flowNode:{value:a},options:n,_messages:o,allowTimeSeriesConfiguration:c}=this,{layer:l,view:u}=e;return r.qy`<arcgis-map-config-feature-reduction-clustering .view=${u} .layer=${l} .portal=${i} .config=${s} .flowNode=${a} .selected=${n===p.F.CLUSTERING||n===p.F.CHART_CLUSTERING} .hideLayerTitle=${t} ._messages=${o} .allowTimeSeriesConfiguration=${c} @arcgisChange=${e=>{e.stopPropagation(),this.arcgisChange.emit()}} @arcgisBackClick=${()=>{const e=n;this.options=void 0,e===p.F.CLUSTERING&&setTimeout(()=>this.tileNodes.cluster?.setFocus(),300),e===p.F.CHART_CLUSTERING&&setTimeout(()=>this.tileNodes["pie-chart"]?.setFocus(),300)}}></arcgis-map-config-feature-reduction-clustering>`}renderBinningOptions(){const{props:e,hideLayerTitle:t,portal:i,config:s,flowNode:{value:a},_messages:n,symbolStylerConfig:o,options:c,allowTimeSeriesConfiguration:l}=this,{layer:u,view:d}=e;return r.qy`<arcgis-map-config-feature-reduction-binning .view=${d} .layer=${u} .portal=${i} .config=${s} .flowNode=${a} .selected=${c===p.F.BINNING} .hideLayerTitle=${t} .symbolStylerConfig=${o} ._messages=${n} .allowTimeSeriesConfiguration=${l} @arcgisStyleBtnClick=${()=>this.arcgisStyleBtnClick.emit()} @arcgisStyleBtnBackClick=${()=>this.arcgisStyleBtnBackClick.emit()} @arcgisChange=${e=>{e.stopPropagation(),this.arcgisChange.emit()}} @arcgisBackClick=${()=>{this.options=void 0,setTimeout(()=>this.tileNodes.binning?.setFocus(),300)}} @arcgisArcadeTimeExpressionChange=${e=>{e.stopPropagation();const t=e.detail;this.arcgisArcadeTimeExpressionChange.emit(t)}}></arcgis-map-config-feature-reduction-binning>`}}(0,s.c)("arcgis-map-config-feature-reduction",R)},22679:(e,t,i)=>{i.d(t,{F:()=>l,a:()=>c,b:()=>n,c:()=>a,d:()=>f,e:()=>s,f:()=>r,g:()=>u,h:()=>o,i:()=>d});const s=9,r=90,a=37.5,n=9,o=90,c=37.5;var l=(e=>(e.CLUSTERING="clustering",e.CHART_CLUSTERING="chartClustering",e.BINNING="binning",e))(l||{});function u(e){const t=e.featureReduction;if(t)return"binning"===t.type?"binning":"cluster"===t.type?function(e){const t=e.featureReduction;return!!t.renderer&&"pie-chart"===t.renderer.type&&!t?.renderer?.authoringInfo?.isAutoGenerated}(e)?"pie-chart":"cluster":void 0}function d(e){const t=e.featureReduction;return!t?.renderer||!!t?.renderer?.authoringInfo?.isAutoGenerated}function f(e,t){switch(e){case"sum":return t.fields.sum;case"avg":return t.fields.mean;case"min":return t.fields.min;case"max":return t.fields.max;case"stddev":return t.fields.stdDev;case"mode":return t.fields.mode;case"var":return t.fields.var;case"count":return t.fields.count;default:return""}}},36486:(e,t,i)=>{i.d(t,{u:()=>a});var s=i(83552),r=i(73679);const a=(0,s.yr)(r.g)},42855:(e,t,i)=>{i.d(t,{a:()=>n,f:()=>s,l:()=>r,s:()=>a});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),r=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(r||{}),a=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(a||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},47640:(e,t,i)=>{i.d(t,{YZ:()=>n,e1:()=>r});var s=i(4836);const r={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},a=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??o,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let r=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){r=!0,i=e}if(this.p===s){if(t===a)this.i=0;else{if(!1===r){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},66228:(e,t,i)=>{i.d(t,{a:()=>w,b:()=>N,c:()=>E,d:()=>I,e:()=>S,f:()=>P,g:()=>m,h:()=>y,i:()=>g,j:()=>h,k:()=>R,l:()=>k,m:()=>T,n:()=>f,o:()=>C,p:()=>L,q:()=>x,r:()=>q,s:()=>v,t:()=>F,u:()=>b});var s=i(63438),r=i(18423),a=i(96086),n=i(91813),o=i(21255),c=i(13078),l=i(21303),u=i(12627),d=i(42855);const f=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],p=["feature"];function g(e){return null!=e}function h(e,t,i){const s=t.fieldName;if(s.includes(d.f.expression)){const e=i.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function m(e){return new Map((await R(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function y(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${d.f.expression}${e.name}`;t.set(i,e)}),t}function w(e){return"map-image"===e?.layer?.type?d.s.mapImage:"subtype-sublayer"===e?.type?d.s.subtype:"tile"===e?.layer?.type?d.s.tile:"scene"===e?.type?d.s.scene:"ogc-feature"===e?.type?d.s.ogcFeature:"imagery"===e?.type?d.s.imagery:"imagery-tile"===e?.type?d.s.imageryTile:"wfs"===e?.type?d.s.wfs:"wcs"===e?.type?d.s.wcs:"wms"===e?.layer?.type?d.s.wms:"csv"===e?.type?d.s.csv:"geojson"===e?.type?d.s.geojson:"stream"===e?.type?d.s.stream:"oriented-imagery"===e?.type?d.s.orientedImagery:"catalog"===e?.type?d.s.catalog:"catalog-footprint"===e?.type?d.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?d.s.knowledgeGraphSublayer:"voxel"===e?.type?d.s.voxel:"parquet"===e?.type?d.s.parquet:d.s.feature}function b(e){const t=w(e);let i;return t===d.s.wms||t===d.s.mapImage?i=e?.layer.version:(t===d.s.imagery||t===d.s.feature||t===d.s.scene)&&(i=e.version),Number.parseFloat(i)}function v(e){return"fieldConfigurations"in e&&p.includes(e.type)}async function R(e){return await new Promise((t,i)=>{switch(w(e)){case d.s.feature:case d.s.ogcFeature:case d.s.stream:t(e.fields);break;case d.s.mapImage:{const s=e,r=s?.layer;r?.portalItem&&r.url.includes("https://demographics")&&r.url.includes(".arcgis.com")?r.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),r=e.thematicGroup.fieldNames,a=[];r.forEach(e=>{i.has(e)&&a.push(i.get(e))}),t(a)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case d.s.imagery:case d.s.imageryTile:case d.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function C(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function T(e){return Number((100*(1-e)).toFixed(1))}function F(e){return Number((1-e/100).toFixed(3))}const I=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(d.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},N=async(e,t)=>{const i=new u.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await l.identify(e.layer.url,i))?.results?.[0]?.feature},S=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await $(i,s.features?.[0])},$=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=I(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const a=new r.default;i.geometry=a}return i};function x(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function E(e){if(w(e)===d.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===d.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function k(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function P(e,t){try{const i=w(e);if(i===d.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await N(e,t)||await _(e,t)]};if(i===d.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await _(e,t)]};const s=i===d.s.ogcFeature||i===d.s.stream?await t.whenLayerView(e):e,r=s.createQuery();r.where=s.definitionExpression||"1=1",r.outFields=["*"],r.returnM="hasM"in e&&e.hasM,r.returnZ="hasZ"in e&&e.hasZ,r.outSpatialReference=t.spatialReference,r.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===d.s.ogcFeature)&&(r.start=0,r.num=1),r.outSpatialReference=t.spatialReference;const a=await s.queryFeatures(r);return a?.features?.length||(a.features[0]=await _(e,t)),a}catch(e){console.error(e)}}async function _(e,t){return await new Promise(i=>{const r=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),r.attributes=t}const l=t.extent;let u;"polygon"===e.geometryType?u=o.default.fromExtent(l):"point"===e.geometryType?u=l.center.clone():"multipoint"===e.geometryType?u=new a.default({points:[[l.center.x,l.center.y]],spatialReference:l.center.spatialReference.clone()}):"polyline"===e.geometryType?(u=new n.default({spatialReference:t.spatialReference.clone()}),u.addPath([[l.xmin,l.ymin],[l.xmax,l.ymax]])):"mesh"===e.geometryType&&(u=c.default.createBox(l.center.clone(),{size:{width:50,height:50,depth:50}})),r.geometry=u,i(r)})}function q(e){return w(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function L(e){return w(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},76830:(e,t,i)=>{i.d(t,{a:()=>d,b:()=>l,c:()=>f,d:()=>u,e:()=>a,f:()=>o,g:()=>r,h:()=>n,i:()=>c});var s=i(42097);function r(e){return e.fields.filter(e=>["small-integer","big-integer","integer","single","double","long","number","string"].includes(e.type))}function a(e,t){if(t)return e.fields.find(e=>e.name===t)}function n(e,t,i){return!!e.featureReduction.fields?.find(e=>e.onStatisticField===t&&e.statisticType===i)}function o(e,t,i,s){const r=t.substring(0,t.lastIndexOf(`_${i}`));return!!e.featureReduction.fields?.find(e=>e.name.substring(0,e.name.lastIndexOf(`_${s}`))===r&&e.statisticType===s)}function c(e,t){return!l(a(e,t)).find(i=>!n(e,t,i))}function l(e){return["string","date","timestamp-offset"].includes(e.type)?["mode"]:["sum","avg","min","max","mode"]}function u(e,t){return e.featureReduction.popupTemplate.fieldInfos.find(e=>e.fieldName===t)}function d(e,t){const i=t.featureReduction,{popupTemplate:r}=i;r.fieldInfos=r.fieldInfos||[],r.fieldInfos.find(t=>t.fieldName===e.name)||r.fieldInfos.push(new s.default({fieldName:e.name,label:e.alias,isEditable:!1,visible:!0,format:p(e,t)}))}function f(e,t){const{popupTemplate:i}=e;return i?.fieldInfos?.find(e=>e.fieldName===t)?.label}function p(e,t){const i=e.onStatisticField,s=e.onStatisticExpression,r="sum"===e.statisticType,n="count"===e.statisticType,o=a(t,i),c=n||s&&r||o&&["small-integer","big-integer","integer","long","number"].includes(o.type);return o&&["single","double"].includes(o.type)?{digitSeparator:!0,places:1}:c?{digitSeparator:!0}:void 0}}}]);