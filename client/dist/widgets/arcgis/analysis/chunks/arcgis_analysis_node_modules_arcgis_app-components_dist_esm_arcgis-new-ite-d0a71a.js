/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-d0a71a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-d0a71a"],{40486:(e,t,r)=>{r.r(t),r.d(t,{arcgis_new_item_pages_data_store_select_server_list:()=>n});var s=r(87849),a=r(59317),i=r(64589),l=r(3826),o=r(95878),c=r(86686);r(37762),r(41473),r(60958),r(83692),r(931),r(93814),r(54251),r(1536),r(88878),r(46904),r(72257),r(86562),r(15332),r(15912),r(74695),r(24869),r(27137),r(76246),r(58573),r(29599),r(32478);const n=class{constructor(e){(0,s.r)(this,e),this.newItemUpdatePage=(0,s.c)(this,"newItemUpdatePage",7),this.loading=!0,this.noValidServers=!0,this.serverTypes=[],this.item={allowServicesRestart:!1,publisherFolderPath:l.a.publisherFolderPath,publisherFolderPathHostname:l.a.publisherFolderPathHostname,serverFolderPath:l.a.serverFolderPath,newServerFolderPath:l.a.newServerFolderPath,nfsSharePath:l.a.nfsSharePath,nfsHostName:l.a.nfsHostName},this.serverStatusIcons={success:"check-circle-f",failure:"exclamation-mark-circle-f",error:"exclamation-mark-triangle-f",validating:"information"},this.selectedServers=[],this.serverList=[],this.allBoxesSelected=!1,this.error=null,this.requireRestart=!1,this.openRequireRestartModal=!1}async componentWillLoad(){this.i18n=o.u.i18n.serverSelection,this.dataStoreType=l.a.addDataStoreType,this.serverList=l.a.dataStoreSelectServerList||[],this.serverList=this.filterServers(!1,!1)}async componentDidLoad(){const e=await(0,i.d)({item:l.a,serverList:this.serverList,datastoreType:this.dataStoreType,portal:a.c.portal});this.serverList=[...e];const t=await(0,i.e)(this.serverList);this.openRequireRestartModal=e.some(e=>"RequiresServicesRestart"===(null==e?void 0:e.error)),this.serverList=[...t.servers],this.serverTypes=[...t.serverTypes],this.renderTable(),this.appendServerTypes(),this.loading=!1}filterServers(e,t){const r=l.a.addDataStoreType;return(this.serverList||[]).filter(s=>{const i=(s.serverRole||"").toUpperCase();let l=["ARCGIS_NOTEBOOK_SERVER","ARCGIS_MISSION_SERVER","ARCGIS_VIDEO_SERVER"];const o=s.serverFunction&&s.serverFunction.replace(/\s+/g,"").split(",")||[];let n=["NOTEBOOKSERVER","WORKFLOWMANAGER","MISSIONSERVER","VIDEOSERVER"],d="HOSTING_SERVER"===i;e&&-1===o.indexOf("KnowledgeServer")&&(l.push(i),d=!1),t&&(0,c.i)()&&(d=!0),["folder","cloud"].includes(r)&&a.c.portal.isPortal&&(l=l.filter(e=>"ARCGIS_VIDEO_SERVER"!==e),n=n.filter(e=>"VIDEOSERVER"!==e));let h=-1===l.indexOf(i);return d||h&&(!o.length||o.some(function(e){return-1===n.indexOf(e.toUpperCase())}))})}renderTable(){const e=this.dataStoreType,t="nosql"===e,r="nfsHostAndPath"===l.a.serverFolderPath&&"folder"===e;this.serverList=this.filterServers(t,r),r||["folder","fileshare"].includes(e)&&(this.serverList=this.filterServersByServerPath())}filterServersByServerPath(){const e=l.a.addDataStoreType,t=("folder"===e?l.a.newServerFolderPath||l.a.publisherFolderPath:l.a.publisherFileShareFolderPath)[0].indexOf("/")>-1?"Linux":"Windows",r="nfsHostAndPath"===l.a.serverFolderPath&&"folder"===e;return this.serverList.filter(e=>!!this.serverTypes.find(s=>(s.name===e.adminUrl||s.name===`${e.adminUrl}/admin`)&&(r?e.isHosted:s.type===t)))}appendServerTypes(){const{serverList:e,i18n:t}=this;e.map(e=>{const r=e.serverFunction&&e.serverFunction.replace(/\s+/g,"").split(",")||[];let s="";"HOSTING_SERVER"===e.serverRole&&(s+=t.types.hostedSetting),r.indexOf("NotebookServer")>-1&&(s+=(s&&", ")+t.types.notebookServerSetting),r.indexOf("GeoAnalytics")>-1&&(s+=(s&&", ")+t.types.geoAnalyticsServerSetting),r.indexOf("RasterAnalytics")>-1&&(s+=(s&&", ")+t.types.rasterAnalysisSetting),r.indexOf("ImageHosting")>-1&&(s+=(s&&", ")+t.types.imageHostingSetting),r.indexOf("MissionServer")>-1&&(s+=(s&&", ")+t.types.missionServerSetting),r.indexOf("DataPipelinesServer")>-1&&(s+=(s&&", ")+t.types.dataPipelinesServerSetting),r.indexOf("VideoServer")>-1&&(s+=(s&&", ")+t.types.videoServerSetting),e.serverType=s})}convertStatusDisplayText(e){const t=this.i18n,r=e.serverStatus;return{success:t.status.success,failure:t.status.failure,error:t.status.error,validating:t.status.validating}[r]}closeModal(){this.openRequireRestartModal=!1,this.newItemUpdatePage.emit("dataStoreSelectFolder")}async acceptRequireRestart(){this.loading=!0,this.openRequireRestartModal=!1,this.item.allowServicesRestart=!0,this.requireRestart=!0;const e=await(0,i.d)({item:this.item,serverList:this.serverList,datastoreType:this.dataStoreType,portal:a.c.portal});this.serverList=[...e];const t=await(0,i.e)(this.serverList);this.serverList=[...t.servers],this.serverTypes=[...t.serverTypes],this.renderTable(),this.appendServerTypes(),this.loading=!1}checkValidServers(){this.noValidServers=!this.serverList.some(e=>"success"===e.serverStatus)}checkAllBoxes(){this.selectedServers=[],this.allBoxesSelected||this.serverList.forEach(e=>{this.selectedServers=[...this.selectedServers,e.id]}),this.allBoxesSelected=!this.allBoxesSelected}handleNext(){const e=this.selectedServers||[];0!==e.length?(this.requireRestart&&(l.a.allowServicesRestart=!0),l.a.dataStoreSelectedServers=e,this.newItemUpdatePage.emit("itemProperties")):this.error="noServerSelected"}render(){const{i18n:e,error:t,serverList:r,loading:a,allBoxesSelected:i,noValidServers:l}=this;return(0,s.h)("div",{key:"f720a3d77ba103a94c18712d5198780be8e61602"},(0,s.h)("arcgis-new-item-description",{key:"01a6c47551d4a38ab20cdb4cb7b35d433d62dc46",header:e.dataStoreServerSelect.heading}),(0,s.h)("p",{key:"bb04d849e8098144434834c7a05f57c4fb4062be",class:"sub-heading"},e.dataStoreServerSelect.subHeading),a?(0,s.h)("calcite-loader",{label:"server-loader",text:e.loader.validating}):(0,s.h)(s.F,null,(0,s.h)("div",{class:"row-wrapper"},(0,s.h)("div",{class:"half-row"},(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-checkbox",{disabled:l,checked:i,onCalciteCheckboxChange:()=>{this.checkAllBoxes()}}),e.list.title)),(0,s.h)("div",{class:"half-row"},(0,s.h)("calcite-label",{layout:"inline"},e.list.status))),r.map(e=>(0,s.h)("div",{class:"row-wrapper row-divider"},(0,s.h)("div",{class:"half-row"},(0,s.h)("calcite-label",{layout:"inline",class:"server-wrapper"},(0,s.h)("calcite-checkbox",{disabled:"success"!==e.serverStatus,value:e.id,onCalciteCheckboxChange:e=>{const t=e.target.value;-1===this.selectedServers.indexOf(t)?this.selectedServers=[...this.selectedServers,t]:this.selectedServers=this.selectedServers.filter(e=>e!==t)},checked:this.selectedServers.includes(e.id)}),e.url+(e.serverType&&` (${e.serverType})`))),(0,s.h)("div",{class:"half-row"},(0,s.h)("div",{class:"status-wrapper",title:e.errorMsg||e.serverStatus},(0,s.h)("calcite-icon",{class:{success:"success"===e.serverStatus,failure:"failure"===e.serverStatus,error:"error"===e.serverStatus,validating:"validating"===e.serverStatus},scale:"s",icon:this.serverStatusIcons[e.serverStatus]}),this.convertStatusDisplayText(e))))),(0,s.h)("arcgis-new-item-alert",{heading:e.dataStoreServerSelect.noServerSelected.heading,description:e.dataStoreServerSelect.noServerSelected.description,active:null!==t&&!a,onAlertDismiss:()=>{this.error=null}})),(0,s.h)("calcite-modal",{key:"56f708924941011104be9c173e642f590d6baac2",open:this.openRequireRestartModal,class:"requireRestartModal",onCalciteModalClose:e=>e.stopPropagation()},(0,s.h)("div",{key:"eb936f6c6200a1d1a1ee0b33e781d69c1ffbfc9b",slot:"content"},"You are registering a folder data store that uses a new path and host that has not been registered with ArcGIS Enterprise. This will cause several of your system and utility services to restart. To avoid disruption, consider registering during off-peak hours.",(0,s.h)("br",{key:"4d1dd80e24ad0b3818bd93f6873dd8d5875cca37"}),(0,s.h)("br",{key:"7daf5f9abcb9533764183eb97a1f38f3471752ef"}),"Are you sure you want to proceed"),(0,s.h)("calcite-button",{key:"51eeb3f3b30c5eeb0ba164f88032f069270197ec",slot:"secondary",appearance:"outline",onClick:()=>this.closeModal()},"Cancel"),(0,s.h)("calcite-button",{key:"e4bf1efc269447f52774df2d26354dd36debbbee",slot:"primary",onClick:()=>this.acceptRequireRestart()},"OK")))}static get watchers(){return{serverList:["checkValidServers"]}}};n.style=".sub-heading{font-weight:400;color:var(--calcite-color-text-3)}.row-wrapper{margin-top:0.5rem;margin-bottom:0.5rem;display:flex;width:100%;padding-top:0.75rem}.row-divider{box-shadow:0 -1px 0 #eaeaea}.title{gap:0.5rem}.status-wrapper{display:flex;gap:0.5rem;line-height:1rem}.success{--calcite-ui-icon-color:var(--calcite-color-status-success)}.failure{--calcite-ui-icon-color:var(--calcite-color-status-danger)}.error{--calcite-ui-icon-color:var(--calcite-color-status-danger)}.validating{--calcite-ui-icon-color:var(--calcite-color-status-info)}.half-row{width:50%;padding-left:0.5rem;padding-right:0.5rem}.requireRestartModal{--calcite-modal-width:500px;--calcite-modal-height:400px}"}}]);