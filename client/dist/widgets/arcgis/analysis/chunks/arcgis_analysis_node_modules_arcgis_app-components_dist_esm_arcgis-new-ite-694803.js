/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-694803.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-694803"],{24084:(e,t,i)=>{i.r(t),i.d(t,{arcgis_new_item_pages_data_store_bigquery_credentials:()=>h});var a=i(87849),s=i(59317),n=i(24869),l=i(64589),r=i(47172),o=i(3826),c=i(95878),d=i(86686);i(37762),i(15912),i(41473),i(60958),i(83692),i(931),i(93814),i(54251),i(1536),i(88878),i(46904),i(72257),i(86562),i(15332),i(74695),i(27137),i(76246),i(58573),i(29599),i(32478);const h=class{constructor(e){(0,a.r)(this,e),this.newItemUpdatePage=(0,a.c)(this,"newItemUpdatePage",7),this.allowedAuthenticationTypes=["user","service"],this.handleFileInputChange=e=>{this.processFile(e.target.files[0])},this.authenticationType="service",this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0,this.refreshToken=void 0,this.keyFileContents=void 0,this.projectId=void 0,this.defaultDataset=void 0,this.validJson=!0,this.emptyFieldsExist=!1,this.keyFileName=void 0,this.error=void 0}async handleNext(){o.a.authenticationType=this.authenticationType,o.a.projectID=this.projectId,o.a.defaultDataset=this.defaultDataset,"service"===this.authenticationType?(o.a.bigQueryKeyFileName=this.keyFileName,o.a.bigQueryKeyFileContents=this.keyFileContents):o.a.refreshToken=this.refreshToken,this.checkValidFields()?await this.validateConnection():this.handleError({code:"unhandledError"})}async componentWillLoad(){this.i18n=c.u.i18n.dataStoreDatabaseCredentials,this.populateFields()}checkValidFields(){const{projectId:e,keyFileName:t}=this,i=[t,e];return this.emptyFieldsExist=i.some(e=>!e),!this.emptyFieldsExist}populateFields(){var e;null!==(e=this.authenticationType)&&void 0!==e||(this.authenticationType=o.a.authenticationType),this.projectId=o.a.projectID,this.defaultDataset=o.a.defaultDataset,"service"===this.authenticationType?(this.keyFileName=o.a.bigQueryKeyFileName,this.keyFileContents=o.a.bigQueryKeyFileContents):this.refreshToken=o.a.refreshToken}async validateConnection(){const{projectId:e,defaultDataset:t,keyFileContents:i,refreshToken:a}=this;let n;const{orgId:c}=s.c.user;this.loading=!0,this.loaderMessage=this.i18n.validating;const h=i||"",u=a||"",p=await(0,d.f)(e,t,h,u);if(null==p?void 0:p.error)return"invalidJSON"===p.error.code&&(this.validJson=!1),void this.handleError({code:p.error.code});n=p.result,o.a.jdbcConnection=Object.assign({},n.info.JDBCConnection),o.a.initialTitle=(0,r.f)("bigquery",e);const{result:y,error:f}=await(0,l.v)(c,s.c.portal,n);"success"===(null==y?void 0:y.status)?this.newItemUpdatePage.emit("itemProperties"):this.handleError(f)}processFile(e){if(!e)return;const{extension:t,fileName:i}=(0,n.s)(e);if(this.keyFileName=i,"json"!==t)return void(this.validJson=!1);this.validJson=!0;const a=new FileReader;a.onload=e=>{this.keyFileContents=String(e.target.result)},a.readAsText(e)}trimInput(e){return e.trim()}handleError(e){this.loading=!1;let t=this.i18n.errors.validationFailedTitle,i=this.i18n.errors.invalidConnection;switch(e.code){case"invalidJSON":t=c.u.i18n.itemProperties.invalidJSON.title,i=c.u.i18n.itemProperties.invalidJSON.description;break;case"invalidBigQueryProjectId":case"invalidCredentials":i=this.i18n.errors[e.code]}this.error={title:t,description:i,details:e.details}}render(){const{i18n:e,authenticationType:t,projectId:i,defaultDataset:s,validJson:n,error:l}=this;return(0,a.h)("div",{key:"267e796406aaec6f68f8894f30c07b359984ac9e"},(0,a.h)("arcgis-new-item-loader",{key:"65e088b813db9f5c75aecb3a7b34b20cde02d844",type:this.loaderType,active:this.loading,text:this.loaderMessage}),(0,a.h)("arcgis-new-item-description",{key:"ca0ad6bb8d700825171f86986199777676bdc958",header:e.dataStoreConnection,content:e.bigQuery}),(0,a.h)("div",{key:"ba15be16f716ec402dcc8a8e0c87fad40bda42e5",class:"configure-form"},(0,a.h)("calcite-label",{key:"281fe2541df114175a4ba3ca927dc92f510f6d38"},e.authenticationType,(0,a.h)("calcite-select",{key:"a3292192d1a7ca98b69d486d280c5d3eef2c87b6",value:t,label:e.authenticationType,disabled:!0,onCalciteSelectChange:e=>this.authenticationType=e.target.selectedOption.value},this.allowedAuthenticationTypes.map(t=>(0,a.h)("calcite-option",{value:t,key:t},e[t])))),"service"===t?(0,a.h)("calcite-label",null,e.keyFile,(0,a.h)("calcite-input",{status:!n||!this.keyFileName&&this.emptyFieldsExist?"invalid":"valid",readOnly:!0,value:this.keyFileName,required:!0},(0,a.h)("calcite-button",{iconStart:"folder",slot:"action",kind:"neutral",appearance:"outline",onClick:()=>{var e;return null===(e=this.inputFileElement)||void 0===e?void 0:e.click()}},e.selectKeyFile)),(0,a.h)("input",{class:"hide",type:"file",accept:".json",onChange:this.handleFileInputChange,ref:e=>this.inputFileElement=e}),(0,a.h)("calcite-input-message",{icon:!n||!this.keyFileName&&this.emptyFieldsExist?"exclamation-mark-triangle":"information",status:!n||!this.keyFileName&&this.emptyFieldsExist?"invalid":"idle"},!this.keyFileName&&this.emptyFieldsExist?e.errors.noKeyFile:n?e.jsonOnly:e.notJson)):(0,a.h)("calcite-label",null,e.refreshToken,(0,a.h)("calcite-input",{type:"password",status:"valid",onCalciteInputInput:e=>this.refreshToken=this.trimInput(e.target.value)})),(0,a.h)("calcite-label",{key:"65ee30584f1aef23d6fec43b43d6b7993581e171"},e.projectId,(0,a.h)("calcite-input",{key:"21269a9f1f889bb2f31330126dff60000e3b1d7c",value:i,onCalciteInputInput:e=>this.projectId=this.trimInput(e.target.value),required:!0}),!this.projectId&&this.emptyFieldsExist&&(0,a.h)("calcite-input-message",{key:"89d7d10d610eff023c5671e29c9212ec1ac46910",icon:"exclamation-mark-triangle",status:"invalid"},e.errors.noProjectId)),"user"===t&&(0,a.h)("calcite-label",{key:"6766cc9169e7ef1f26980be45e71379a670461c3"},e.defaultDataset,(0,a.h)("calcite-input",{key:"2cdf734cd86399c5b8cee303a5688f228dd17c6a",value:s,onCalciteInputInput:e=>this.defaultDataset=this.trimInput(e.target.value)}))),(0,a.h)("arcgis-new-item-alert",{key:"bc42219ee466e3e962f3181a46bf4a2bb495ce55",heading:null==l?void 0:l.title,description:null==l?void 0:l.description,details:null==l?void 0:l.details,detailsPopoverLabel:e.errorDetails,active:!!l,onAlertDismiss:()=>this.error=null}))}};h.style=".configure-form{margin-top:1.5rem}.hide{display:none}calcite-label{--calcite-label-margin-bottom:1.25rem}"},47172:(e,t,i)=>{i.d(t,{f:()=>a});const a=(e,t)=>{let i;const a=null!=t?t:"";switch(e){case"amazon":i=`AmazonS3_${a}`;break;case"azure":i=`Microsoft_Azure_Storage_${a}`;break;case"bigquery":i=`BigQuery_${a}`;break;case"databricks":i=a?`Databricks_${a}`:"Databricks";break;case"snowflake":i=`Snowflake_${a}`}return i.replace(/ /g,"_").replace(/-/g,"_")}}}]);