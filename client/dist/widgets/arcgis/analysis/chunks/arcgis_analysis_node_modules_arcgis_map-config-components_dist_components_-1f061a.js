/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-1f061a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-1f061a"],{23208:(e,t,s)=>{s.d(t,{a:()=>n,b:()=>y,c:()=>u,d:()=>p,g:()=>d,r:()=>l,s:()=>h,u:()=>o});const i={facilityLayer:{facilityIdField:"FACILITY_ID",siteIdField:"SITE_ID",nameField:"NAME"},levelLayer:{levelIdField:"LEVEL_ID",facilityIdField:"FACILITY_ID",longNameField:"NAME",shortNameField:"NAME_SHORT",levelNumberField:"LEVEL_NUMBER",verticalOrderField:"VERTICAL_ORDER"},siteLayer:{siteIdField:"SITE_ID",nameField:"NAME"}};let r;const a=e=>{const t=e?.map;return r=r||t?.floorInfo||{...i},r.siteLayer=r?.siteLayer?.layerId?r.siteLayer:null,r},n=e=>{const t=e?.map,s=a(e);t&&c(s)?t.set("floorInfo",s):l(e)},o=(e,t)=>{const s=a(t),{name:r}=e,o=e.layer;if(o&&"floorInfo"in o&&"levelLayer"===r){const e={floorField:i.levelLayer.levelIdField};o.floorInfo=e}if(o){const e="sublayer"===o.type;s[r]={...i[r]},s[r]&&(s[r].layerId=e?o.layer?.id:o.id,s[r].sublayerId=e?o.id:void 0)}else s[r]=void 0;n(t)},l=e=>{const t=e?.map;t&&(t.floorInfo=null)},c=e=>!(!e?.facilityLayer?.layerId||!e?.levelLayer?.layerId||e?.siteLayer&&!e?.siteLayer.layerId),u=e=>{const t=i[e];return Object.values(t)},d=e=>{const{map:t}=e,s=t?.allLayers;let i=[];return s?.forEach(e=>{const{type:t,floorInfo:s}=e;"map-image"===t?i=i.concat(e.allSublayers.filter(e=>e.fieldsIndex&&!e?.floorInfo).toArray()):!s&&["feature","oriented-imagery"].includes(t)&&i.push(e)}),i},y=async e=>{const{map:t}=e,s=t?.allLayers?.map(async e=>await f(e)).filter(e=>"failed"!==e?.loadStatus),i=s?await Promise.all(s):[];let r=[];return i.forEach(e=>{const{type:t,geometryType:s}=e;"map-image"===t?r=r.concat(e.allSublayers.filter(e=>e.fieldsIndex&&"esriGeometryPolygon"===e.sourceJSON?.geometryType).toArray()):"feature"===t&&"polygon"===s&&r.push(e)}),r},f=async e=>(typeof e.loadAll<"u"?await e.loadAll():await e.load(),e),p=(e,t)=>{const s=t.map?.allLayers,i=a(t),r=i?.[e]?.layerId,n=i?.[e]?.sublayerId;let o=r?s?.find(e=>e.id===r):null;return"map-image"===o?.type&&(o=o.allSublayers.find(e=>e.id===n)),o},h=e=>{const{layer:t}=e;let s;if(s="arcgis-field-list"===e?.localName||"arcgis-map-config-floor-field-list"===e?.localName?Object.values(e.selection)[0]:e?.field,s){const e=t.floorInfo||{};e.floorField=s.name,t.set("floorInfo",e)}}},36486:(e,t,s)=>{s.d(t,{u:()=>a});var i=s(83552),r=s(73679);const a=(0,i.yr)(r.g)},42855:(e,t,s)=>{s.d(t,{a:()=>n,f:()=>i,l:()=>r,s:()=>a});var i=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(i||{}),r=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(r||{}),a=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(a||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},47640:(e,t,s)=>{s.d(t,{YZ:()=>n,e1:()=>r});var i=s(4836);const r={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},a=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,s){this.p=0,this.i=0,(this._=e).addController(this);const i="object"==typeof t?t:{task:t,args:s};this.v=i.task,this.j=i.args,this.m=i.argsEqual??o,this.k=i.onComplete,this.A=i.onError,this.autoRun=i.autoRun??!0,"initialValue"in i&&(this.u=i.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,s;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const i=++this.p;this.q=new AbortController;let r=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){r=!0,s=e}if(this.p===i){if(t===a)this.i=0;else{if(!1===r){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(s)}catch{}this.i=3,this.h?.(s)}this.u=t,this.l=s}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,s)=>!(0,i.Ec)(e,t[s]))},66228:(e,t,s)=>{s.d(t,{a:()=>w,b:()=>_,c:()=>N,d:()=>k,e:()=>E,f:()=>C,g:()=>g,h:()=>m,i:()=>p,j:()=>h,k:()=>I,l:()=>R,m:()=>x,n:()=>y,o:()=>L,p:()=>$,q:()=>T,r:()=>q,s:()=>v,t:()=>F,u:()=>b});var i=s(63438),r=s(18423),a=s(96086),n=s(91813),o=s(21255),l=s(13078),c=s(21303),u=s(12627),d=s(42855);const y=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],f=["feature"];function p(e){return null!=e}function h(e,t,s){const i=t.fieldName;if(i.includes(d.f.expression)){const e=s.get(i);return e?.title?e.title:i}return v(e)&&e.getFieldConfiguration(i)?e.getFieldAlias(i)||i:t.label||i}async function g(e){return new Map((await I(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function m(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const s=`${d.f.expression}${e.name}`;t.set(s,e)}),t}function w(e){return"map-image"===e?.layer?.type?d.s.mapImage:"subtype-sublayer"===e?.type?d.s.subtype:"tile"===e?.layer?.type?d.s.tile:"scene"===e?.type?d.s.scene:"ogc-feature"===e?.type?d.s.ogcFeature:"imagery"===e?.type?d.s.imagery:"imagery-tile"===e?.type?d.s.imageryTile:"wfs"===e?.type?d.s.wfs:"wcs"===e?.type?d.s.wcs:"wms"===e?.layer?.type?d.s.wms:"csv"===e?.type?d.s.csv:"geojson"===e?.type?d.s.geojson:"stream"===e?.type?d.s.stream:"oriented-imagery"===e?.type?d.s.orientedImagery:"catalog"===e?.type?d.s.catalog:"catalog-footprint"===e?.type?d.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?d.s.knowledgeGraphSublayer:"voxel"===e?.type?d.s.voxel:"parquet"===e?.type?d.s.parquet:d.s.feature}function b(e){const t=w(e);let s;return t===d.s.wms||t===d.s.mapImage?s=e?.layer.version:(t===d.s.imagery||t===d.s.feature||t===d.s.scene)&&(s=e.version),Number.parseFloat(s)}function v(e){return"fieldConfigurations"in e&&f.includes(e.type)}async function I(e){return await new Promise((t,s)=>{switch(w(e)){case d.s.feature:case d.s.ogcFeature:case d.s.stream:t(e.fields);break;case d.s.mapImage:{const i=e,r=i?.layer;r?.portalItem&&r.url.includes("https://demographics")&&r.url.includes(".arcgis.com")?r.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const s=new Map(i.fields.map(e=>[e.name,e])),r=e.thematicGroup.fieldNames,a=[];r.forEach(e=>{s.has(e)&&a.push(s.get(e))}),t(a)}else t(i.fields)}).catch(e=>{s(new Error(e))}):t(i.fields);break}case d.s.imagery:case d.s.imageryTile:case d.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function L(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function x(e){return Number((100*(1-e)).toFixed(1))}function F(e){return Number((1-e/100).toFixed(3))}const k=(e,t)=>{const s=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(d.f.expression)||s.push({name:e.fieldName,alias:e.label,type:"string"})}),s},_=async(e,t)=>{const s=new u.default;return s.geometry=t.extent,s.mapExtent=t.extent,s.returnGeometry=!0,s.tolerance=6,s.layerOption="popup",s.width=t.width,s.height=t.height,s.layerIds=[e.id],(await c.identify(e.layer.url,s))?.results?.[0]?.feature},E=async(e,t,s)=>{const i=await(await e.whenLayerView(t)).queryAggregates();return await O(s,i.features?.[0])},O=async(e,t)=>{let s;if(t)s=t.clone();else{s=new i.default;const t=k(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),s.attributes=e}const a=new r.default;s.geometry=a}return s};function T(e,t){const s=t.startsWith("#"),i=t.startsWith(".");for((i||s)&&(t=t.slice(1));e;){if(s){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function N(e){if(w(e)===d.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===d.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function R(e,t,s){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const s=t.get(e);i=s.type?s.type.toLowerCase():""}else if(s.has(e)){const t=s.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function C(e,t){try{const s=w(e);if(s===d.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await _(e,t)||await P(e,t)]};if(s===d.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await P(e,t)]};const i=s===d.s.ogcFeature||s===d.s.stream?await t.whenLayerView(e):e,r=i.createQuery();r.where=i.definitionExpression||"1=1",r.outFields=["*"],r.returnM="hasM"in e&&e.hasM,r.returnZ="hasZ"in e&&e.hasZ,r.outSpatialReference=t.spatialReference,r.returnGeometry=!0,(i.sourceJSON?.advancedQueryCapabilities?.supportsPagination||s===d.s.ogcFeature)&&(r.start=0,r.num=1),r.outSpatialReference=t.spatialReference;const a=await i.queryFeatures(r);return a?.features?.length||(a.features[0]=await P(e,t)),a}catch(e){console.error(e)}}async function P(e,t){return await new Promise(s=>{const r=new i.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),r.attributes=t}const c=t.extent;let u;"polygon"===e.geometryType?u=o.default.fromExtent(c):"point"===e.geometryType?u=c.center.clone():"multipoint"===e.geometryType?u=new a.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(u=new n.default({spatialReference:t.spatialReference.clone()}),u.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(u=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),r.geometry=u,s(r)})}function q(e){return w(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function $(e){return w(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},73502:(e,t,s)=>{s.r(t),s.d(t,{ArcgisMapConfigFloor:()=>y});var i=s(73679),r=s(4395),a=s(36486),n=s(23208),o=s(54312),l=s(73801),c=s(47640),u=s(66228);const d=r.AH`.layer-select-message{margin:14px 0}`;class y extends l.WF{constructor(){super(...arguments),this.blockOpenOnLoad=!1,this._messages=(0,a.u)({blocking:!0}),this._propWatcherTask=new c.YZ(this,{task:async([e])=>{if(!(0,u.i)(e))throw console.error("[arcgis-map-config-floor] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.view]}),this.closedOnLoad=!1,this.disabled=!1,this.arcgisChange=(0,l.lh)()}static{this.properties={closedOnLoad:5,disabled:5,view:0}}static{this.styles=d}async init(){this.disabled=this.disabled||await this.getDisabled();const e=this.view.map;this.blockOpenOnLoad=!!e?.floorInfo}addMapFloorInfo(){(0,n.a)(this.view),this.arcgisChange.emit()}disableContainer(e){const{detail:t}=e,s=this.el.closest("calcite-flow-item");s&&(s.disabled=t)}async getDisabled(){await o.whenOnce(()=>this.view.allLayerViews.every(e=>!e.updating));const e=await(0,n.b)(this.view);return!["facilityLayer","levelLayer"].filter(t=>e.filter(e=>this.hasRequiredFields(e,(0,n.c)(t)))?.length)?.length}hasRequiredFields(e,t){if(e){const{fieldsIndex:s}=e;return s&&t.every(e=>!!s.get(e))||!1}return!1}removeFloorInfo(){(0,n.r)(this.view),this.arcgisChange.emit()}updateFloorInfo(e){(0,n.u)(e,this.view),this.arcgisChange.emit()}render(){return this._propWatcherTask.render({complete:()=>{const{closedOnLoad:e,_messages:t,disabled:s}=this;return r.qy`<calcite-block class="container" .heading=${t.heading} collapsible .disabled=${s} .expanded=${!e&&!s}>${this.renderFloorInfo()}</calcite-block>`}})}renderFloorInfo(){const{_messages:e}=this;return r.qy`<calcite-block-section .text=${e.enable} .expanded=${this.blockOpenOnLoad} toggle-display=switch @calciteBlockSectionToggle=${e=>e.currentTarget.open?this.addMapFloorInfo():this.removeFloorInfo()}><calcite-label class="layer-select-message">${e.summary}</calcite-label>${this.renderLayerPicker("siteLayer")}${this.renderLayerPicker("facilityLayer")}${this.renderLayerPicker("levelLayer")}${this.renderAdditionalLayers()}</calcite-block-section>`}renderLayerPicker(e){const t=(0,n.d)(e,this.view),s=(0,n.c)(e);return r.qy`<arcgis-map-config-floor-layer-picker .view=${this.view} .label=${this._messages[e]} .selectedLayer=${t} .requiredFields=${s} ._messages=${this._messages} @arcgisLayerPickerListChange=${t=>{const s=t?.detail;this.updateFloorInfo({layer:s,name:e})}}></arcgis-map-config-floor-layer-picker>`}renderAdditionalLayers(){return r.qy`<calcite-block-section .text=${this._messages.additionalLayers} expanded><arcgis-map-config-floor-additional-layers .view=${this.view} ._messages=${this._messages} @arcgisDisable=${this.disableContainer}></arcgis-map-config-floor-additional-layers></calcite-block-section>`}}(0,i.c)("arcgis-map-config-floor",y)}}]);