/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-671560.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-671560"],{4265:(e,t,s)=>{s.d(t,{a:()=>a,d:()=>i,t:()=>c});const i=(e,t)=>{let s,i="idle";const a=async(...a)=>await new Promise(c=>{switch(i){case"flushed":i="idle",s?(clearTimeout(s),c(e(...a))):c(null);break;case"invoked":clearTimeout(s),i="idle",c(e(...a));break;case"cancelled":clearTimeout(s),i="idle",c(null);break;default:s&&clearTimeout(s),i="pending",s=setTimeout(()=>{i="idle",c(e(...a))},t)}});return a.flush=async function(...e){return i="flushed",await a(...e)},a.invoke=async function(...e){return i="invoked",await a(...e)},a.cancel=async function(...e){return i="cancelled",await a(...e)},a.getStatus=function(){return i},a},a=(e,t)=>{let s;return async(...i)=>await new Promise(a=>{s||(s=setTimeout(()=>{clearTimeout(s),s=void 0,a(e(...i))},t))})};function c(e){return new Promise(t=>setTimeout(t,e))}},36486:(e,t,s)=>{s.d(t,{u:()=>c});var i=s(83552),a=s(73679);const c=(0,i.yr)(a.g)},47640:(e,t,s)=>{s.d(t,{YZ:()=>r,e1:()=>a});var i=s(4836);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},c=Symbol();class r{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,s){this.p=0,this.i=0,(this._=e).addController(this);const i="object"==typeof t?t:{task:t,args:s};this.v=i.task,this.j=i.args,this.m=i.argsEqual??l,this.k=i.onComplete,this.A=i.onError,this.autoRun=i.autoRun??!0,"initialValue"in i&&(this.u=i.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,s;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const i=++this.p;this.q=new AbortController;let a=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){a=!0,s=e}if(this.p===i){if(t===c)this.i=0;else{if(!1===a){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(s)}catch{}this.i=3,this.h?.(s)}this.u=t,this.l=s}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const l=(e,t)=>e===t||e.length===t.length&&e.every((e,s)=>!(0,i.Ec)(e,t[s]))},55103:(e,t,s)=>{s.r(t),s.d(t,{ArcgisMapConfigEffect:()=>C});var i=s(73679),a=s(4395),c=s(66228),r=s(4265),l=s(90628),o=s(70004),n=s(36486),f=s(5077),h=s(85643),d=s(73801),p=s(47640);const u="panel",g="card",m="notice",y="hint",E="basemap-type",v="radio-buttons",_="switch",w="list",S="effect-thumb",$="effect-thumb-img",T=a.AH`:host{height:100%}.flow,.panel{height:100%}.card{margin:var(--calcite-spacing-lg)}.notice{margin:var(--calcite-spacing-sm)}.radio-buttons{padding:.5rem;background-color:#fff}.hint{padding:.25rem .5rem;background-color:#fff}.basemap-type{padding:.75rem .5rem .25rem}.switch{margin-right:.75rem;margin-left:0;align-self:center}.list{flex-flow:column nowrap;margin:1px}.effect-thumb{display:flex;align-items:center;padding-left:.5rem;cursor:pointer}.effect-thumb-img{margin-top:.25rem;margin-bottom:.25rem;height:48px;width:48px}:dir(rtl){.switch{margin-left:.75rem;margin-right:0}.effect-thumb{padding-left:0;padding-right:.5rem}}`;class C extends d.WF{constructor(){super(),this._messages=(0,n.u)({blocking:!0}),this.panelNode=(0,h._)(),this.enabledSwitchNode=(0,h._)(),this.listNode=(0,h._)(),this.lightListNode=(0,h._)(),this.darkListNode=(0,h._)(),this.popovers=new Map,this._initialized=!1,this._loaded=!1,this._propWatcherTask=new p.YZ(this,{task:async([e])=>{if(!(0,l.i)(e))throw console.error("[arcgis-map-config-effect] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.layer]}),this.arcgisPopoverCloseHandler=()=>{const{listNode:{value:e},lightListNode:{value:t},darkListNode:{value:s}}=this;e?.querySelectorAll("calcite-list-item").forEach(e=>{e.selected&&setTimeout(()=>e.setFocus(),100)}),t?.querySelectorAll("calcite-list-item").forEach(e=>{e.selected&&setTimeout(()=>e.setFocus(),100)}),s?.querySelectorAll("calcite-list-item").forEach(e=>{e.selected&&setTimeout(()=>e.setFocus(),100)})},this.arcgisFilterChangeHandler=e=>{const{props:t,el:s}=this,{layer:i}=t,a=e.detail,c=Array.from(s.shadowRoot.querySelectorAll("calcite-list-item")).find(e=>e.selected)?.value;if(c){if(l.a.find(e=>e===c))return;i.featureEffect=(0,l.b)(c,a),this.arcgisChange.emit()}else this.defaultWhere=a},this.isUnsupported=!1,this.showFeatureEffects=!1,this.hideLayerTitle=!1,this.arcgisApplyLayerEffect=(0,d.lh)(),this.arcgisChange=(0,d.lh)(),this.arcgisClose=(0,d.lh)(),this.listenOn(window,"arcgisApplyLayerEffect",this.arcgisApplyLayerEffectHandler)}static{this.properties={isUnsupported:16,showFeatureEffects:16,view:0,layer:0,hideLayerTitle:5}}static{this.styles=T}async done(){const{popovers:e}=this;e.forEach(e=>e.open=!1),document.body.querySelectorAll("arcgis-map-config-effect-popovers").forEach(e=>e.remove())}async setFocus(e){e&&"dismiss-button"!==e?this.listNode.value?.setFocus():this.panelNode.value?.setFocus()}updated(){this._propWatcherTask.status===p.e1.COMPLETE&&this._initialized&&!this._loaded&&(this._loaded=!0,requestAnimationFrame(()=>this.setFocus()),this.createPopovers())}disconnectedCallback(){super.disconnectedCallback(),this.done()}async init(){const{view:e,layer:t,_messages:s}=this,i=!t.featureReduction&&["feature","geojson","ogc-feature","wfs","csv","stream","oriented-imagery","knowledge-graph-sublayer","parquet"].includes(t.type);this.props={view:e,layer:t,_messages:s,supportsFeatureEffects:i};const{props:a}=this;a.backgroundTheme=e&&(await(0,f.getBackgroundColorTheme)(e)??void 0);try{const e=t;e.effect&&e.featureEffect?this.isUnsupported=!0:e.effect?(a.effectsJSON=(0,l.p)(a),(0,l.s)(a)):e.featureEffect&&(a.featureEffectType=(0,l.p)(a)),this._initialized=!0}catch{this.isUnsupported=!0}}async arcgisApplyLayerEffectHandler(e){const{props:t,listNode:{value:s}}=this,{layer:i}=t,a=e.detail?.type;if(a&&!e.detail?.keepSwitch){Array.from(s.querySelectorAll("calcite-list-item")).find(e=>e.value===a).querySelector("calcite-switch").checked=!0}const c=await(0,l.c)(this.listNode.value,this.popovers,t);i.effect=c,this.arcgisChange.emit(),t.effectsJSON=(0,l.p)(t),this.requestUpdate()}async onSwitchEffectType(e){const{props:t,popovers:s}=this,i=t.layer,a=e.target;if(s.forEach(e=>e.open=!1),"layer"===a.selectedItem.value)this.lastFeatureEffect=i.featureEffect||this.lastFeatureEffect,i.featureEffect=null,i.effect=this.lastLayerEffect,this.showFeatureEffects=!1;else{if(this.lastLayerEffect=i.effect,i.effect=null,this.lastFeatureEffect)i.featureEffect=this.lastFeatureEffect,t.featureEffectType=(0,l.p)(t);else{const{backgroundTheme:e}=t;await this.selectFeatureEffectType("light"===e?l.d[0]:l.e[0])}this.showFeatureEffects=!0;const e=await this.getPopover("featureEffect");e.open=!0,e.updateHeader(t.featureEffectType),setTimeout(()=>e.setFocus(),300)}this.requestUpdate()}onRemoveEffect(){const{props:e}=this,{layer:t}=e;t.effect=null,t.featureEffect=null,this.isUnsupported=!1}async onSwitchChange(e){const t=e.target,s=(0,c.q)(t,"calcite-list-item").value;if(!t.checked){(await this.getPopover(s)).open=!1}this.arcgisApplyLayerEffect.emit({type:s,keepSwitch:!0})}async onFeatureEffectEnabledSwitchChange(e){const{props:t}=this,s=t.layer;if(e.target.checked){if(this.lastFeatureEffect)s.featureEffect=this.lastFeatureEffect,t.featureEffectType=(0,l.p)(t);else{const{backgroundTheme:e}=t;t.featureEffectType="light"===e?l.d[0]:l.e[0]}await this.selectFeatureEffectType(t.featureEffectType)}else{(await this.getPopover("featureEffect")).open=!1,this.lastFeatureEffect=s.featureEffect,s.featureEffect=null,t.featureEffectType=void 0,this.arcgisChange.emit()}}async openPopover(e){const{popovers:t}=this,s=e.target,i=s.tagName.toLowerCase();let a;if("img"===i)a=(0,c.q)(s,"calcite-list-item");else if("calcite-switch"===i){if(!s.checked)return;a=(0,c.q)(s,"calcite-list-item")}else{if("calcite-list-item"!==i)return;a=s}const r=a.value;if(l.d.concat(l.e).includes(r))await this.selectFeatureEffectType(r,a);else{const e=a.querySelector("calcite-switch"),s=await this.getPopover(r);s.open?(s.open=!1,e.checked=!1,this.arcgisApplyLayerEffect.emit()):(e.checked||(e.checked=!0,this.arcgisApplyLayerEffect.emit()),t.forEach(e=>e.open=!1),s.open=!0)}}async createPopovers(){const{props:e}=this,{featureEffectType:t,supportsFeatureEffects:s}=e,{popovers:i,panelNode:c}=this;i&&this.done();const r=s?["featureEffect"].concat(l.a):l.a,o=async t=>await new Promise(s=>{const i=(0,d.dN)(a.qy`<arcgis-map-config-effect-popovers .props=${e} .type=${t} .referenceElement=${c.value} @arcgisReady=${()=>s(i)} @arcgisClose=${this.arcgisPopoverCloseHandler} @arcgisFilterChange=${this.arcgisFilterChangeHandler}></arcgis-map-config-effect-popovers>`);document.body.appendChild(i)});for(const e of r)i.set(e,await o(e));if(t){const e=await this.getPopover("featureEffect");e.open=!0,e.updateHeader(t)}}async selectFeatureEffectType(e,t){const{popovers:s,props:i,defaultWhere:a,enabledSwitchNode:{value:c}}=this,{layer:r}=i;i.featureEffectType=e,r.featureEffect=(0,l.b)(e,r.featureEffect?.filter?.where||a),this.defaultWhere=void 0,this.arcgisChange.emit();const o=await this.getPopover("featureEffect");o.open?(o.updateHeader(e),t?.setFocus()):(s.forEach(e=>e.open=!1),o.open=!0,o.updateHeader(e),setTimeout(()=>o.setFocus(),300)),c?c.checked=!0:this.requestUpdate()}async getPopover(e){const{popovers:t}=this;let s=t.get(e);for(;!s;)await(0,r.t)(100),s=t.get(e);return s}render(){return this._propWatcherTask.render({complete:()=>{const{isUnsupported:e}=this;return this.el.classList.add("calcite-match-height"),e?this.renderUnsupportedNotice():this.renderContent()}})}renderUnsupportedNotice(){const{props:e,hideLayerTitle:t}=this,{layer:s,_messages:i}=e;return a.qy`<calcite-panel .heading=${i.general.effects} .description=${t?void 0:s.title??void 0} class=${(0,d.CP)(u)} closable @calcitePanelClose=${()=>this.arcgisClose.emit()} ${(0,h.K)(this.panelNode)}><calcite-card class=${(0,d.CP)(g)}><div slot=heading>${i.error.title}</div><div slot=description><div>${i.error.text1}</div><div>${i.error.text2}</div></div></calcite-card><calcite-fab class="autofocus" slot=fab appearance=outline-fill kind=neutral scale=s text-enabled .label=${i.error.button} .text=${i.error.button} @click=${this.onRemoveEffect}></calcite-fab></calcite-panel>`}renderContent(){const{props:e,hideLayerTitle:t,showFeatureEffects:s}=this,{layer:i,supportsFeatureEffects:c,_messages:r}=e,l=c&&!!i.featureEffect;return a.qy`<calcite-panel .heading=${r.general.effects} .description=${t?void 0:i.title??void 0} class=${(0,d.CP)(u)} closable @calcitePanelClose=${()=>{const{popovers:e}=this;e.forEach(e=>e.open=!1),this.arcgisClose.emit()}} ${(0,h.K)(this.panelNode)}>${this.renderTip()}${c?a.qy`<div class=${(0,d.CP)(v)}><calcite-segmented-control layout=horizontal appearance=solid scale=s width=full @calciteSegmentedControlChange=${this.onSwitchEffectType}><calcite-segmented-control-item value=layer .checked=${!(l||s)}>${r.general.wholeLayer}</calcite-segmented-control-item><calcite-segmented-control-item value=feature .checked=${l||s}>${r.general.featureSpecific}</calcite-segmented-control-item></calcite-segmented-control></div>`:null}${l||s?this.renderFeatureEffectsContent():this.renderLayerEffectsContent()}</calcite-panel>`}renderTip(){const{props:e}=this,{_messages:t}=e;return(0,o.g)(o.l.ARCGIS_COMPONENT_NOTIFICATIONS,o.a.EFFECTS_TIP_DISMISSED)?a.qy`<div></div>`:a.qy`<div class=${(0,d.CP)(m)}><calcite-notice scale=s width=full open closable @calciteNoticeClose=${()=>{(0,o.s)(o.l.ARCGIS_COMPONENT_NOTIFICATIONS,{key:o.a.EFFECTS_TIP_DISMISSED,value:"true"})}}><div slot=message>${t.general.notice}</div></calcite-notice></div>`}renderLayerEffectsContent(){const{_messages:e}=this;return a.qy`<div><div class=${(0,d.CP)(y)}><calcite-label scale=s>${e.general.dragToReorder}</calcite-label></div><calcite-list .label=${e.general.effects} class=${(0,d.CP)(w)} drag-enabled @calciteListOrderChange=${()=>this.arcgisApplyLayerEffect.emit()} ${(0,h.K)(this.listNode)}>${l.a.map(e=>this.renderLayerEffectItem(e))}</calcite-list></div>`}renderLayerEffectItem(e){const{props:t}=this,{effectsJSON:s,_messages:c}=t;let r=-1,o=!1;return s&&Array.from(s)?.forEach((t,s)=>{t.type===(0,l.f)(e)&&(r=s+1,o=!0)}),a.qy`<calcite-list-item .label=${c.effectsTitle[e]} .description=${c.effectsSummary[e]} .value=${e} .selected=${o} @click=${this.openPopover} @keydown=${e=>{if("Enter"===e.key&&this.openPopover(e)," "===e.key){const t=e.composedPath()[0];("SPAN"!==t.tagName||!t.classList.contains("handle"))&&this.openPopover(e)}}}><div slot=actions-start class=${(0,d.CP)(S)}><img class=${(0,d.CP)($)} src=${(0,i.g)(`./assets/map-config-effect/effect-thumbs/${e}.png`)??d.s6} alt></div><calcite-switch .checked=${r>0} slot=actions-end class=${(0,d.CP)(_)} @calciteSwitchChange=${this.onSwitchChange}></calcite-switch></calcite-list-item>`}renderFeatureEffectsContent(){const{props:e,lastFeatureEffect:t,_messages:s}=this,{layer:i,backgroundTheme:c}=e,r="light"===c,o=a.qy`<div><div class=${(0,d.CP)(E)}><calcite-label scale=s>${s.general.lightBasemaps}</calcite-label></div><calcite-list .label=${s.general.effects} class=${(0,d.CP)(w)} data-value=light ${(0,h.K)(this.lightListNode)}>${l.d.map(e=>this.renderFeatureEffectItem(e))}</calcite-list></div>`,n=a.qy`<div><div class=${(0,d.CP)(E)}><calcite-label scale=s>${s.general.darkBasemaps}</calcite-label></div><calcite-list .label=${s.general.effects} class=${(0,d.CP)(w)} data-value=dark ${(0,h.K)(this.darkListNode)}>${l.e.map(e=>this.renderFeatureEffectItem(e))}</calcite-list></div>`;return a.qy`<div><div class=${(0,d.CP)(y)}><calcite-label scale=s>${s.general.emphasize}</calcite-label><calcite-label scale=s layout=inline-space-between>${s.general.enabled}<calcite-switch scale=s .checked=${!(!i.featureEffect&&!t)} @calciteSwitchChange=${this.onFeatureEffectEnabledSwitchChange} ${(0,h.K)(this.enabledSwitchNode)}></calcite-switch></calcite-label></div>${r?o:n}${r?n:o}</div>`}renderFeatureEffectItem(e){const{props:t}=this,{featureEffectType:s,_messages:c}=t,r=e.replace("_light","").replace("_dark","");return a.qy`<calcite-list-item .label=${c.featureEffectsTitle[r]} .description=${c.featureEffectsSummary[r]} .value=${e} .selected=${s===e} @click=${this.openPopover} @keydown=${e=>{if("Enter"===e.key&&this.openPopover(e)," "===e.key){const t=e.composedPath()[0];("SPAN"!==t.tagName||!t.classList.contains("handle"))&&this.openPopover(e)}}}><div slot=actions-start class=${(0,d.CP)(S)}><img class=${`${$} feature`} src=${(0,i.g)(`./assets/map-config-effect/effect-thumbs/${e}.png`)??d.s6} alt></div></calcite-list-item>`}}(0,i.c)("arcgis-map-config-effect",C)},70004:(e,t,s)=>{s.d(t,{a:()=>a,g:()=>l,l:()=>i,s:()=>r});var i=(e=>(e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications",e))(i||{}),a=(e=>(e.FEATURE_REDUCTION_WARNING_DISMISSED="arcgis_feature_reduction_warning_dismissed",e.POPUP_WARNING_DISMISSED="arcgis_popup_warning_dismissed",e.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED="arcgis_symbol_styler_incompatible_vector_symbols_dismissed",e.EFFECTS_TIP_DISMISSED="arcgis_effects_tip_dismissed",e.LAYER_VIEW_DEFINITION_DISMISSED="arcgis_layer_view_definition_dismissed",e.LAYER_OVERRIDE_STATUS_TIP_DISMISSED="arcgis_layer_override_status_tip_dismissed",e.SMART_MAPPING_TIP1_DISMISSED="arcgis_smart_mapping_tip1_dismissed",e.SMART_MAPPING_TIP2_DISMISSED="arcgis_smart_mapping_tip2_dismissed",e.LAYER_VIEW_JOIN_TIP_DISMISSED="arcgis_layer_view_join_tip_dismissed",e.MULTIDIMENSIONAL_INFO_TIP_DISMISSED="arcgis_multidimensional_info_tip_dismissed",e))(a||{});const c=e=>{const t=(e=>localStorage.getItem(e))(e);return t?JSON.parse(t):{}},r=(e,t)=>{const s=c(e);s[t.key]=t.value,((e,t)=>{localStorage.setItem(e,t)})(e,JSON.stringify(s))},l=(e,t)=>{const s=c(e);return Object.getOwnPropertyDescriptor(s,t)?s[t]:null}}}]);