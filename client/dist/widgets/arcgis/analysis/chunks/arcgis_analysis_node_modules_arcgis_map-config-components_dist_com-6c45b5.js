/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-6c45b5.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-6c45b5"],{7274:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigLabel:()=>m});var s=a(73679),i=a(4395),l=a(72989),r=a(5077),n=a(43811),o=a(20880),c=a(73801),h=a(20936),d=a(47640),p=a(85643),u=a(42855),f=a(66228),g=a(34216),y=a(36486);const b=i.AH`.enable-label{background-color:var(--calcite-color-foreground-1);border-bottom:solid 1px var(--calcite-color-foreground-3);display:flex;padding:var(--calcite-spacing-lg) var(--calcite-spacing-sm) var(--calcite-spacing-xxs)}.label-switch{flex:0 0 0%;margin:0;justify-self:flex-end}.label-classes-wrapper{margin:0 0 var(--calcite-spacing-lg);padding:0}`;class m extends c.WF{constructor(){super(...arguments),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new d.YZ(this,{task:async([e,t,a])=>{if(!((0,f.i)(e)&&(0,f.i)(t)&&(0,f.i)(a)))throw console.error("[arcgis-map-config-label] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.mapView,this.layer,this.portal]}),this._messages=(0,y.u)({blocking:!0}),this.labelClasses=[],this.flowItemNode=(0,p._)(),this.switchNode=(0,p._)(),this.internalFabNode=(0,p._)(),this.blockGroupNode=(0,p._)(),this.labelFields=[],this.aggregationExpressionMapping=new Map,this.layerDisplayType=u.l.feature,this.dismissible=!1,this.hideLayerTitle=!1,this.allowTimeSeriesConfiguration=!1,this.arcgisChange=(0,c.lh)(),this.arcgisClose=(0,c.lh)()}static{this.properties={mapView:0,layer:0,portal:0,layerDisplayType:0,calciteFlowProps:0,dismissible:5,hideLayerTitle:5,allowTimeSeriesConfiguration:5}}static{this.styles=b}async done(){this.handleCloseLabelContentPopovers()}async setFocus(){this.flowItemNode.value?this.flowItemNode.value.setFocus():this.switchNode.value?.focus()}async updated(){if(this._propWatcherTask.status===d.e1.COMPLETE&&this._initialized&&!this._loaded){this._loaded=!0;const{_messages:e}=this;if(Array.isArray(this.labelingInfo)&&this.labelingInfo.forEach(e=>this.addLabelClass(e,1===this.labelingInfo.length)),this.calciteFlowProps&&!this.calciteFlowProps.calciteFab){const t=(0,c.dN)(i.qy`<calcite-fab icon=plus slot=fab scale=s appearance=outline-fill kind=neutral .label=${e.addLabel} .text=${e.addLabel} text-enabled @click=${e=>{e.stopPropagation(),this.handleAddLabelClick()}}></calcite-fab>`);this.layerLabelsVisible()||(t.hidden=!0),this.calciteFlowProps.calciteFab=t,this.calciteFlowProps.calciteFlowItem.appendChild(t)}this.calciteFab=this.calciteFlowProps?.calciteFab??this.internalFabNode.value,this.flowItemNode.value?.setFocus(),this.requestUpdate()}}disconnectedCallback(){super.disconnectedCallback(),this.calciteFab?.remove(),this.calciteFab=void 0}async init(){const{layer:e,mapView:t,layerDisplayType:a,calciteFlowProps:s}=this,i=e;this.serviceType=(0,f.a)(i),this.layerGeometryType=await(0,f.c)(i),this.labelingInfo=a===u.l.feature?i.labelingInfo:i.featureReduction.labelingInfo,a===u.l.feature?i.labelsVisible=i.labelsVisible||!1:this.layerDisplayType===u.l.cluster&&(i.featureReduction.labelsVisible=i.featureReduction.labelsVisible||!1),s?.calciteFab&&!this.layerLabelsVisible()&&(s.calciteFab.hidden=!0);const l=a===u.l.feature?i.popupTemplate:i.featureReduction.popupTemplate;this.labelFields=await(0,g.g)(i,l,a),a===u.l.cluster&&await Promise.all(this.labelFields.map(async e=>await(0,g.s)(i,t,e.name,this.aggregationExpressionMapping))),this._initialized=!0}layerLabelsVisible(){const{layerDisplayType:e}=this;switch(e){case u.l.feature:return this.layer.labelsVisible;case u.l.cluster:return this.layer.featureReduction.labelsVisible;default:return this.layer.labelsVisible}}enableLabel(e){this.blockGroupNode.value.style.display=e?"block":"none",this.calciteFab.style.display=e?"block":"none",this.handleCloseLabelContentPopovers()}async handleAddLabelClick(){this.handleCloseLabelContentPopovers();const e=await this.getLabelClass();this.labelingInfo?this.labelingInfo.push(e):this.labelingInfo=[e],this.addLabelClass(e,!0),this.requestUpdate(),this.focusLastLabelClass(),this.handleInternalLabelUpdate()}async getLabelClass(){const{mapView:e,layer:t,layerDisplayType:a}=this;if(a===u.l.feature){const t=this.getDefaultSymbolProps(await r.getBackgroundColor(e),await r.getBackgroundColorTheme(e));return new l.default(this.getDefaultLabelProps(t))}return"binning"===t.featureReduction?.type?(await o.getLabelSchemes({layer:t}))?.primaryScheme?.labelingInfo[0]??void 0:(await n.getLabelSchemes({layer:t,renderer:t?.renderer,view:e}))?.primaryScheme?.labelingInfo[0]??void 0}getDefaultLabelProps(e){const{layer:t,layerDisplayType:a,serviceType:s}=this,i=t,l=this.getDefaultFieldName(),r="coded-value"===i.fields.find(e=>e.name===l)?.domain?.type;return{labelExpression:s===u.s.mapImage?`[${l}]`:null,labelExpressionInfo:a===u.l.cluster?{expression:`$feature["${l}"]`}:s!==u.s.mapImage?{expression:l?r?`$feature["${l}"]\nDomainName($feature, "${l}")`:`$feature["${l}"]`:null}:null,labelPlacement:this.getDefaultPlacement(),minScale:i.minScale||0,maxScale:i.maxScale||0,symbol:{color:e.fontColor,haloColor:e.haloColor,haloSize:e.haloSize,font:{family:e.fontFamily,size:e.fontSize},type:"text"}}}getDefaultSymbolProps(e,t){return"light"===t?{fontFamily:"Arial",fontSize:9.75,fontColor:"#262626",haloColor:"#f7f7f7",haloSize:.75}:"dark"===t?{fontFamily:"Arial",fontSize:9.75,fontColor:"#f7f7f7",haloColor:"#262626",haloSize:.75}:{fontFamily:"Arial",fontSize:9.75,fontColor:e.toHex()||"#262626",haloColor:"#f7f7f7",haloSize:.75}}getDefaultFieldName(){const{layer:e,layerDisplayType:t}=this,a=e;let s=null;if(t===u.l.cluster)s=a.featureReduction.fields[0].name;else if("displayField"in a&&"fieldsIndex"in a&&a.displayField&&a.fieldsIndex.get(a.displayField))s=a.displayField;else{const e=a.fields.find(e=>"string"===e.type);e&&(s=e.name)}return s??a.fields[0].name}getDefaultPlacement(){const{layer:e,layerDisplayType:t,layerGeometryType:a}=this;return t===u.l.cluster&&"binning"===e.featureReduction?.type?"always-horizontal":"point"===a||"multipoint"===a?"above-center":"polyline"===a?"center-along":"polygon"===a?"always-horizontal":void 0}addLabelClass(e,t=!1){this.labelClasses=[...this.labelClasses,this.renderLabelClass(e,t)]}focusLastLabelClass(){setTimeout(()=>{const e=this.el.shadowRoot.querySelectorAll("arcgis-map-config-block-options");e?.length&&e[e.length-1].setFocus()},200)}handleInternalLabelUpdate(e){const{layerDisplayType:t}=this;this.labelingInfo&&!e&&(t===u.l.feature?this.layer.labelingInfo=[...this.labelingInfo]:this.layer.featureReduction.labelingInfo=[...this.labelingInfo]),this.arcgisChange.emit()}handleCloseLabelContentPopovers(){this.el.shadowRoot.querySelectorAll("arcgis-map-config-label-content").forEach(e=>e.closeAllPopovers()),this.el.shadowRoot.querySelectorAll("arcgis-map-config-block-options")?.forEach(e=>e.closeDropdown())}handleDelete(e){this.handleCloseLabelContentPopovers();const t=this.el.shadowRoot.querySelectorAll("arcgis-map-config-block-options"),a=e.target,s=Array.from(t).indexOf(a);this.labelingInfo.splice(s,1);const i=this.blockGroupNode.value.children[s];this.blockGroupNode.value.removeChild(i),this.labelClasses=[...this.blockGroupNode.value.children],this.handleInternalLabelUpdate(),this.requestUpdate(),this.calciteFab?.setFocus()}handleDuplicate(e){this.handleCloseLabelContentPopovers();const t=this.el.shadowRoot.querySelectorAll("arcgis-map-config-block-options"),a=e.target,s=Array.from(t).indexOf(a),i=this.labelingInfo[s].clone();this.labelingInfo.push(i),this.addLabelClass(i,!0),this.focusLastLabelClass(),this.handleInternalLabelUpdate(),this.requestUpdate()}handleRename(e,t){const{_messages:a,labelFields:s,layerDisplayType:l,aggregationExpressionMapping:r}=this;this.labelRenameFormNode=(0,c.dN)(i.qy`<arcgis-map-config-label-rename-form .refElement=${t} ._messages=${a} .currentLabelName=${e.name||(0,g.a)(s,e,l,r)||a.label} @arcgisChange=${a=>{const s=a.detail;s&&(e.name=s,t.heading=s,this.requestUpdate());(this.calciteFlowProps?.calciteFlowItem??this.flowItemNode.value).disabled=!1,this.labelRenameFormNode?.remove(),this.labelRenameFormNode=void 0}}></arcgis-map-config-label-rename-form>`);(this.calciteFlowProps?.calciteFlowItem??this.flowItemNode.value).disabled=!0,document.body.appendChild(this.labelRenameFormNode)}render(){return this._propWatcherTask.render({complete:()=>{const{_messages:e,layer:t,calciteFlowProps:a,hideLayerTitle:s,dismissible:l}=this;return this.el.classList.add("calcite-match-height"),a?i.qy`<div>${this.renderSwitch()}${this.renderLabelClasses()}</div>`:i.qy`<calcite-flow><calcite-flow-item .heading=${e.labelFeatures} .description=${s?void 0:t.title??void 0} .closable=${l} @calciteFlowItemClose=${e=>{e.stopPropagation(),this.handleCloseLabelContentPopovers(),this.arcgisClose.emit()}} ${(0,p.K)(this.flowItemNode)}>${this.renderSwitch()}${this.renderLabelClasses()}${this.renderFab()}</calcite-flow-item></calcite-flow>`}})}renderSwitch(){const{_messages:e,layer:t,layerDisplayType:a}=this;return i.qy`<calcite-label class="enable-label" alignment=start layout=inline-space-between>${e.enableLabels}<calcite-switch class="label-switch" .checked=${this.layerLabelsVisible()} @calciteSwitchChange=${e=>{const s=e.target.checked;switch(a){case u.l.feature:t.labelsVisible=s;break;case u.l.cluster:t.featureReduction.labelsVisible=s;break;default:t.labelsVisible=s}this.enableLabel(s),this.handleInternalLabelUpdate(!0)}} ${(0,p.K)(this.switchNode)}></calcite-switch></calcite-label>`}renderLabelClasses(){const{_messages:e}=this;return i.qy`<calcite-block-group .label=${e.labels} class="label-classes-wrapper" drag-enabled .hidden=${!this.layerLabelsVisible()} @calciteBlockGroupOrderChange=${e=>{this.handleCloseLabelContentPopovers();const t=e.detail.oldIndex,a=e.detail.newIndex,s=this.labelingInfo.splice(t,1)[0];this.labelingInfo.splice(a,0,s),this.labelClasses=[...this.blockGroupNode.value.children],this.handleInternalLabelUpdate()}} ${(0,p.K)(this.blockGroupNode)}>${this.labelClasses}</calcite-block-group>`}renderLabelClass(e,t){const{_messages:a,mapView:s,layer:l,portal:r,calciteFlowProps:n,layerDisplayType:o,serviceType:c,labelFields:d,aggregationExpressionMapping:p,allowTimeSeriesConfiguration:u}=this;return i.qy`<calcite-block .heading=${e.name||(0,g.a)(d,e,o,p)||a.label} .expanded=${t} collapsible><div slot=control><arcgis-map-config-block-options .options=${{hasDelete:!0,hasDuplicate:!0,hasRename:!0}} @arcgisDelete=${this.handleDelete} @arcgisDuplicate=${this.handleDuplicate} @arcgisRename=${t=>{const a=(0,h.el)(t.target,"calcite-block");this.handleRename(e,a)}}></arcgis-map-config-block-options></div><arcgis-map-config-label-content .labelFields=${d} .aggregationExpressionMapping=${p} .labelClass=${e} .blockOpen=${t} ._messages=${a} .mapView=${s} .layer=${l} .portal=${r} .calciteFlowItem=${n?.calciteFlowItem??this.flowItemNode.value} .layerDisplayType=${o} .serviceType=${c} .allowTimeSeriesConfiguration=${u} @arcgisDisablePanel=${e=>{e.stopPropagation();(this.calciteFlowProps?.calciteFlowItem??this.flowItemNode.value).disabled=e.detail}} @arcgisChange=${t=>{const s=e.name||(0,g.a)(d,e,o,p)||a.label;t.target.parentElement.heading=s,this.handleInternalLabelUpdate()}}></arcgis-map-config-label-content></calcite-block>`}renderFab(){const{_messages:e}=this;return i.qy`<calcite-fab .hidden=${!this.layerLabelsVisible()} icon=plus slot=fab scale=s appearance=outline-fill kind=neutral .label=${e.addLabel} .text=${e.addLabel} text-enabled @click=${async e=>{e.stopPropagation(),await this.handleAddLabelClick()}} ${(0,p.K)(this.internalFabNode)}></calcite-fab>`}}(0,s.c)("arcgis-map-config-label",m)},34216:(e,t,a)=>{a.d(t,{a:()=>c,b:()=>h,g:()=>n,s:()=>o});var s=a(43811),i=a(20880),l=a(42855),r=a(66228);async function n(e,t,a){if(a===l.l.feature){const a=await(0,r.k)(e);if(t?.fieldInfos){let e=[];return a.filter(e=>["string","small-integer","big-integer","integer","single","double","long","date","date-only","time-only","timestamp-offset","oid","guid","global-id"].includes(e.type)).forEach(a=>{e=[...e,a.clone()];const s=t.fieldInfos.find(e=>e.fieldName===a.name);s&&(e[e.length-1].alias=s.label)}),e}return a}return(0,r.d)(t)}async function o(e,t,a,l){let r;r="binning"===e.featureReduction?.type?await i.getLabelSchemes({layer:e,field:a}):await s.getLabelSchemes({layer:e,renderer:e?.renderer,view:t,field:a}),[r?.primaryScheme,...r?.secondarySchemes??[]].forEach(e=>{e&&l.set(e?.fieldName,e?.labelingInfo?.[0]?.labelExpressionInfo?.expression??"")})}function c(e,t,a,s){const i=a===l.l.cluster?h(t,a,s):t.getLabelExpressionSingleField();return e.find(e=>e.name===i)?.alias||t.labelExpressionInfo?.title||i}function h(e,t,a){if(t===l.l.cluster)for(const[t,s]of a)if(s===e?.labelExpressionInfo?.expression)return t}},36486:(e,t,a)=>{a.d(t,{u:()=>l});var s=a(83552),i=a(73679);const l=(0,s.yr)(i.g)},42855:(e,t,a)=>{a.d(t,{a:()=>r,f:()=>s,l:()=>i,s:()=>l});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),i=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(i||{}),l=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(l||{}),r=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(r||{})},47640:(e,t,a)=>{a.d(t,{YZ:()=>r,e1:()=>i});var s=a(4836);const i={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},l=Symbol();class r{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,a){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:a};this.v=s.task,this.j=s.args,this.m=s.argsEqual??n,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,a;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let i=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){i=!0,a=e}if(this.p===s){if(t===l)this.i=0;else{if(!1===i){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(a)}catch{}this.i=3,this.h?.(a)}this.u=t,this.l=a}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const n=(e,t)=>e===t||e.length===t.length&&e.every((e,a)=>!(0,s.Ec)(e,t[a]))},66228:(e,t,a)=>{a.d(t,{a:()=>m,b:()=>k,c:()=>N,d:()=>L,e:()=>$,f:()=>R,g:()=>y,h:()=>b,i:()=>f,j:()=>g,k:()=>C,l:()=>S,m:()=>F,n:()=>p,o:()=>I,p:()=>q,q:()=>P,r:()=>_,s:()=>v,t:()=>x,u:()=>w});var s=a(63438),i=a(18423),l=a(96086),r=a(91813),n=a(21255),o=a(13078),c=a(21303),h=a(12627),d=a(42855);const p=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],u=["feature"];function f(e){return null!=e}function g(e,t,a){const s=t.fieldName;if(s.includes(d.f.expression)){const e=a.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function y(e){return new Map((await C(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function b(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const a=`${d.f.expression}${e.name}`;t.set(a,e)}),t}function m(e){return"map-image"===e?.layer?.type?d.s.mapImage:"subtype-sublayer"===e?.type?d.s.subtype:"tile"===e?.layer?.type?d.s.tile:"scene"===e?.type?d.s.scene:"ogc-feature"===e?.type?d.s.ogcFeature:"imagery"===e?.type?d.s.imagery:"imagery-tile"===e?.type?d.s.imageryTile:"wfs"===e?.type?d.s.wfs:"wcs"===e?.type?d.s.wcs:"wms"===e?.layer?.type?d.s.wms:"csv"===e?.type?d.s.csv:"geojson"===e?.type?d.s.geojson:"stream"===e?.type?d.s.stream:"oriented-imagery"===e?.type?d.s.orientedImagery:"catalog"===e?.type?d.s.catalog:"catalog-footprint"===e?.type?d.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?d.s.knowledgeGraphSublayer:"voxel"===e?.type?d.s.voxel:"parquet"===e?.type?d.s.parquet:d.s.feature}function w(e){const t=m(e);let a;return t===d.s.wms||t===d.s.mapImage?a=e?.layer.version:(t===d.s.imagery||t===d.s.feature||t===d.s.scene)&&(a=e.version),Number.parseFloat(a)}function v(e){return"fieldConfigurations"in e&&u.includes(e.type)}async function C(e){return await new Promise((t,a)=>{switch(m(e)){case d.s.feature:case d.s.ogcFeature:case d.s.stream:t(e.fields);break;case d.s.mapImage:{const s=e,i=s?.layer;i?.portalItem&&i.url.includes("https://demographics")&&i.url.includes(".arcgis.com")?i.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const a=new Map(s.fields.map(e=>[e.name,e])),i=e.thematicGroup.fieldNames,l=[];i.forEach(e=>{a.has(e)&&l.push(a.get(e))}),t(l)}else t(s.fields)}).catch(e=>{a(new Error(e))}):t(s.fields);break}case d.s.imagery:case d.s.imageryTile:case d.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function I(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function F(e){return Number((100*(1-e)).toFixed(1))}function x(e){return Number((1-e/100).toFixed(3))}const L=(e,t)=>{const a=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(d.f.expression)||a.push({name:e.fieldName,alias:e.label,type:"string"})}),a},k=async(e,t)=>{const a=new h.default;return a.geometry=t.extent,a.mapExtent=t.extent,a.returnGeometry=!0,a.tolerance=6,a.layerOption="popup",a.width=t.width,a.height=t.height,a.layerIds=[e.id],(await c.identify(e.layer.url,a))?.results?.[0]?.feature},$=async(e,t,a)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await T(a,s.features?.[0])},T=async(e,t)=>{let a;if(t)a=t.clone();else{a=new s.default;const t=L(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),a.attributes=e}const l=new i.default;a.geometry=l}return a};function P(e,t){const a=t.startsWith("#"),s=t.startsWith(".");for((s||a)&&(t=t.slice(1));e;){if(a){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function N(e){if(m(e)===d.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(m(e)===d.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function S(e,t,a){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const a=t.get(e);s=a.type?a.type.toLowerCase():""}else if(a.has(e)){const t=a.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function R(e,t){try{const a=m(e);if(a===d.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await k(e,t)||await E(e,t)]};if(a===d.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await E(e,t)]};const s=a===d.s.ogcFeature||a===d.s.stream?await t.whenLayerView(e):e,i=s.createQuery();i.where=s.definitionExpression||"1=1",i.outFields=["*"],i.returnM="hasM"in e&&e.hasM,i.returnZ="hasZ"in e&&e.hasZ,i.outSpatialReference=t.spatialReference,i.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||a===d.s.ogcFeature)&&(i.start=0,i.num=1),i.outSpatialReference=t.spatialReference;const l=await s.queryFeatures(i);return l?.features?.length||(l.features[0]=await E(e,t)),l}catch(e){console.error(e)}}async function E(e,t){return await new Promise(a=>{const i=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),i.attributes=t}const c=t.extent;let h;"polygon"===e.geometryType?h=n.default.fromExtent(c):"point"===e.geometryType?h=c.center.clone():"multipoint"===e.geometryType?h=new l.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(h=new r.default({spatialReference:t.spatialReference.clone()}),h.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(h=o.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),i.geometry=h,a(i)})}function _(e){return m(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function q(e){return m(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);