/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-6d8384.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-6d8384"],{42855:(e,t,i)=>{i.d(t,{a:()=>n,f:()=>s,l:()=>a,s:()=>l});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),l=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(l||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},46317:(e,t,i)=>{i.d(t,{D:()=>n});var s=i(85282),a=i(34670),l=i(42466);const n=(0,a.u$)(class extends a.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,l.mY)(e),this.key=t),i}})},64918:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigTableFieldSelection:()=>m});var s=i(73679),a=i(4395),l=i(46317),n=i(39849),r=i(66228),o=i(98629),c=(i(18423),i(21255),i(91552),i(85643)),d=i(73801);const p=a.AH`.popover{--calcite-popover-z-index: 100}.flow{height:400px;width:280px}.content{max-height:80vh}.select-button{margin:4px 0}.info{background-color:var(--calcite-color-foreground-1)}`;class m extends d.WF{constructor(){super(...arguments),this.popoverNode=(0,c._)(),this.flowNode=(0,c._)(),this.flowItemNode=(0,c._)(),this.listNode=(0,c._)(),this.filterFields=void 0,this.changedFieldNames=[],this.listItemChangeHandle=void 0,this.lastSortBy="display",this.attachmentsEnabled=!1,this.relationshipsEnabled=!1,this.arcgisAttachmentColumnTemplateVisibilityChange=(0,d.lh)(),this.arcgisClose=(0,d.lh)(),this.arcgisFieldColumnTemplatesVisibilityChange=(0,d.lh)(),this.arcgisRelationshipsColumnTemplateVisibilityChange=(0,d.lh)(),this.arcgisSortByChange=(0,d.lh)()}static{this.properties={lastSortBy:16,_messages:0,props:0,popoverReferenceElement:0,fieldColumns:0,columnTemplates:0,fieldColumnOrder:0,sortBy:1,attachmentsEnabled:5,relationshipsEnabled:5}}static{this.styles=p}async reposition(){this.popoverNode.value?.reposition()}async load(){const{layer:e}=this.props;this.fieldsMap=await(0,r.g)(e),this.totalCounts=this.getTotalFieldTypeCount(),this.lastSortBy=this.sortBy||"default"}loaded(){this.popoverNode.value?.setFocus()}getTotalFieldTypeCount(){const{columnTemplates:e,fieldsMap:t}=this,i={string:0,number:0,date:0};return e.forEach(e=>{if("field"===e.type)switch(t.get(e.fieldName).type){case"small-integer":case"big-integer":case"integer":case"single":case"double":case"long":case"oid":case"guid":i.number++;break;case"string":i.string++;break;case"date":case"date-only":case"time-only":case"timestamp-offset":i.date++}}),i}cloneFieldTemplates(){const{fieldColumns:e,columnTemplates:t}=this;return(t.filter(e=>"field"===e.type)??[]).map(t=>{const i=e.find(e=>e.fieldName===t.fieldName).effectiveLabel;return new n.default({fieldName:t.fieldName,label:i,visible:t.visible})})}handleSelectionAllClick(e){const{columnTemplates:t,filterFields:i}=this;t.forEach(t=>{(!i||i.some(e=>e.value===t.fieldName))&&(t.visible=!e)}),this.listNode.value.querySelectorAll("calcite-list-item").forEach(t=>{(!i||i.some(e=>e.value===t.value))&&t.selected===e&&(t.selected=!e,this.changedFieldNames.push(t.value),this.handleListItemChange(t))}),this.requestUpdate()}filterContainsAll(){const{props:e,columnTemplates:t,filterFields:i,attachmentsEnabled:s,relationshipsEnabled:a}=this,{layer:l}=e;if(i){const e=i.filter(e=>"__attachments"!==e.value&&"__relationships"!==e.value).map(e=>({value:e.value,selected:e.selected})),l=t.filter(t=>e.some(e=>t.fieldName===e.value)),n=!!i.find(e=>"__attachments"===e.value),r=!!i.find(e=>"__relationships"===e.value);return e.every(e=>!l.some(t=>t.fieldName===e.value&&!t.visible))&&(n&&s&&(r&&a||!r)||r&&a&&!n||!n&&!r)}{const e=(0,o.e)(l),i="relationships"in l&&l.relationships?.length;return t.every(e=>e.visible)&&(e&&s&&(i&&a||!i)||i&&a&&!e||!e&&!i)}}handleListItemChange(e){"__attachments"===e.value?this.handleAttachmentsItemChange(e):"__relationships"===e.value?this.handleRelationshipsItemChange(e):this.handleFieldColumnTemplateListItemChange(e)}handleFieldColumnTemplateListItemChange(e){const{columnTemplates:t}=this;t.forEach(t=>{t.fieldName===e.value&&t.visible!==e.selected&&(t.visible=e.selected,this.changedFieldNames.push(t.fieldName))}),this.listItemChangeHandle&&clearTimeout(this.listItemChangeHandle),this.listItemChangeHandle=setTimeout(()=>{this.listItemChangeHandle=void 0,this.arcgisFieldColumnTemplatesVisibilityChange.emit(new Set([...this.changedFieldNames])),this.changedFieldNames=[],this.requestUpdate()},100)}handleAttachmentsItemChange(e){const t=e.selected;this.arcgisAttachmentColumnTemplateVisibilityChange.emit(t),this.attachmentsEnabled=t,this.requestUpdate()}handleRelationshipsItemChange(e){const t=e.selected;this.arcgisRelationshipsColumnTemplateVisibilityChange.emit(t),this.relationshipsEnabled=t,this.requestUpdate()}handleInfoClick(e,t){const{layer:i,view:s}=this.props,{flowNode:{value:l},flowItemNode:{value:n}}=this,r=n.getBoundingClientRect(),o=(0,d.dN)(a.qy`<calcite-flow-item .heading=${e.label??e.fieldName} .description=${e.fieldName} selected style=${(0,d.zl)({height:`${r.height}px`,width:`${r.width}px`})} @calciteFlowItemBack=${()=>{o.remove(),this.flowItemNode.value.selected=!0,requestAnimationFrame(()=>{t.setFocus()})}}><arcgis-field-info .fieldName=${e.fieldName} .layer=${i} .view=${s} class="info"></arcgis-field-info></calcite-flow-item>`);l.appendChild(o),this.flowItemNode.value.selected=!1,setTimeout(()=>{o.setFocus(),this.reposition()},200)}sortFieldsAlphabetically(e){return e.sort((e,t)=>e.label.startsWith("_")?1:t.label.startsWith("_")?-1:e.label.localeCompare(t.label))}sortFieldsByType(e){const{fieldsMap:t}=this;return e.filter(e=>["small-integer","big-integer","integer","single","double","long"].includes(t.get(e.fieldName).type)).map(e=>e).concat(e.filter(e=>"string"===t.get(e.fieldName).type).map(e=>e)).concat(e.filter(e=>["date","date-only","time-only","timestamp-offset"].includes(t.get(e.fieldName).type)).map(e=>e)).concat(e.filter(e=>"oid"===t.get(e.fieldName).type).map(e=>e)).concat(e.filter(e=>"guid"===t.get(e.fieldName).type).map(e=>e)).concat(e.filter(e=>!["small-integer","big-integer","integer","single","double","long","string","date","date-only","time-only","timestamp-offset","oid","guid"].includes(t.get(e.fieldName).type)).map(e=>e))}render(){const{_messages:e,popoverReferenceElement:t}=this;return this.el.classList.add("js-app-flyout"),a.qy`<calcite-popover placement=auto-start .referenceElement=${t} open pointer-disabled offset-distance=-32 offset-skidding=0 overlay-positioning=fixed .label=${e.fieldVisibility} class="popover" ${(0,c.K)(this.popoverNode)}><calcite-flow class="flow" ${(0,c.K)(this.flowNode)}><calcite-flow-item .heading=${e.fieldVisibility} closable @calciteFlowItemClose=${()=>this.arcgisClose.emit()} ${(0,c.K)(this.flowItemNode)}>${this.renderList()}${this.renderDoneButton()}</calcite-flow-item></calcite-flow></calcite-popover>`}renderList(){const{_messages:e}=this;return a.qy`<calcite-list .label=${e.selectFields} class="content" selection-mode=multiple filter-enabled .filterPlaceholder=${e.filterFields} @calciteListFilter=${e=>{const t=e.currentTarget;this.filterFields=t.filteredItems,this.requestUpdate()}} ${(0,c.K)(this.listNode)}>${this.renderSort()}${this.renderSelection()}${this.renderFieldColumnTemplateListItems()}${this.renderAttachmentListItem()}${this.renderRelationshipsListItem()}</calcite-list>`}renderSort(){const{lastSortBy:e,totalCounts:t,_messages:i}=this,s=t.number>0,l=t.string>0,n=t.date>0,r=!(!s||!l&&!n)||!(!l||!n);return a.qy`<calcite-dropdown slot=filter-actions-end placement=bottom-end overlay-positioning=fixed><calcite-action slot=trigger .text=${i.sortFields} title=${i.sortFields??d.s6}><calcite-icon scale=s icon=sortDescending flip-rtl></calcite-icon></calcite-action><calcite-dropdown-group .groupTitle=${i.sortBy}><calcite-dropdown-item .selected=${"default"===e} @click=${()=>{this.lastSortBy="default",this.arcgisSortByChange.emit(this.lastSortBy)}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="default",this.arcgisSortByChange.emit(this.lastSortBy))}}>${i.default}</calcite-dropdown-item><calcite-dropdown-item .selected=${"display"===e} @click=${()=>{this.lastSortBy="display",this.arcgisSortByChange.emit(this.lastSortBy)}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="display",this.arcgisSortByChange.emit(this.lastSortBy))}}>${i.sortByDisplayName}</calcite-dropdown-item>${r?a.qy`<calcite-dropdown-item .selected=${"type"===e} @click=${()=>{this.lastSortBy="type",this.arcgisSortByChange.emit(this.lastSortBy)}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="type",this.arcgisSortByChange.emit(this.lastSortBy))}}>${i.sortByType}</calcite-dropdown-item>`:null}<calcite-dropdown-item .selected=${"field"===e} @click=${()=>{this.lastSortBy="field",this.arcgisSortByChange.emit(this.lastSortBy)}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="field",this.arcgisSortByChange.emit(this.lastSortBy))}}>${i.sortByFieldName}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown>`}renderSelection(){const{_messages:e}=this,t=this.filterContainsAll();return a.qy`<calcite-button class="select-button" appearance=transparent scale=s width=full @click=${()=>this.handleSelectionAllClick(t)} .label=${t?e.deselectAll:e.selectAll}>${t?e.deselectAll:e.selectAll}</calcite-button>`}renderFieldColumnTemplateListItems(){const{fieldColumnOrder:e,lastSortBy:t}=this;let i=this.cloneFieldTemplates();return e&&(i=i.sort((t,i)=>e.indexOf(t.fieldName)-e.indexOf(i.fieldName))),"display"===t?i=this.sortFieldsAlphabetically(i):"type"===t?i=this.sortFieldsByType(this.sortFieldsAlphabetically(i)):"field"===t&&i.sort((e,t)=>e.fieldName.localeCompare(t.fieldName)),i.map(e=>this.renderFieldColumnTemplateListItem(e))}renderFieldColumnTemplateListItem(e){const{_messages:t}=this;return(0,l.D)(e.fieldName,a.qy`<calcite-list-item .label=${e.label} .value=${e.fieldName} .selected=${e.visible} @calciteListItemSelect=${e=>{const t=e.currentTarget;this.handleFieldColumnTemplateListItemChange(t)}}><calcite-action slot=actions-end .text=${t.info} @click=${t=>{t.stopPropagation(),this.handleInfoClick(e,t.currentTarget)}}><calcite-icon scale=s icon=information></calcite-icon></calcite-action></calcite-list-item>`)}renderAttachmentListItem(){const{_messages:e,props:t}=this,{layer:i}=t;if(!(0,o.e)(i))return"";const s=this.columnTemplates.find(e=>"attachment"===e.type);return a.qy`<calcite-list-item .label=${e.photosAndFiles} .description=${e.attachments} value=__attachments .selected=${s?.visible} @calciteListItemSelect=${e=>{const t=e.currentTarget;this.handleAttachmentsItemChange(t)}}></calcite-list-item>`}renderRelationshipsListItem(){const{layer:e}=this.props,{_messages:t}=this;if(!("relationships"in e)||!e.relationships?.length)return"";const i=this.columnTemplates.find(e=>"relationship"===e.type);return a.qy`<calcite-list-item .label=${t.relatedRecords} value=__relationships .selected=${i?.visible} @calciteListItemSelect=${e=>{const t=e.currentTarget;this.handleRelationshipsItemChange(t)}}></calcite-list-item>`}renderDoneButton(){const{_messages:e}=this;return a.qy`<calcite-button appearance=outline-fill slot=footer width=full @click=${()=>this.arcgisClose.emit()} .label=${e.done}>${e.done}</calcite-button>`}}(0,s.c)("arcgis-map-config-table-field-selection",m)},66228:(e,t,i)=>{i.d(t,{a:()=>b,b:()=>T,c:()=>B,d:()=>I,e:()=>x,f:()=>A,g:()=>y,h:()=>g,i:()=>h,j:()=>f,k:()=>C,l:()=>_,m:()=>N,n:()=>m,o:()=>$,p:()=>q,q:()=>k,r:()=>E,s:()=>v,t:()=>F,u:()=>w});var s=i(63438),a=i(18423),l=i(96086),n=i(91813),r=i(21255),o=i(13078),c=i(21303),d=i(12627),p=i(42855);const m=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],u=["feature"];function h(e){return null!=e}function f(e,t,i){const s=t.fieldName;if(s.includes(p.f.expression)){const e=i.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function y(e){return new Map((await C(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function g(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${p.f.expression}${e.name}`;t.set(i,e)}),t}function b(e){return"map-image"===e?.layer?.type?p.s.mapImage:"subtype-sublayer"===e?.type?p.s.subtype:"tile"===e?.layer?.type?p.s.tile:"scene"===e?.type?p.s.scene:"ogc-feature"===e?.type?p.s.ogcFeature:"imagery"===e?.type?p.s.imagery:"imagery-tile"===e?.type?p.s.imageryTile:"wfs"===e?.type?p.s.wfs:"wcs"===e?.type?p.s.wcs:"wms"===e?.layer?.type?p.s.wms:"csv"===e?.type?p.s.csv:"geojson"===e?.type?p.s.geojson:"stream"===e?.type?p.s.stream:"oriented-imagery"===e?.type?p.s.orientedImagery:"catalog"===e?.type?p.s.catalog:"catalog-footprint"===e?.type?p.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?p.s.knowledgeGraphSublayer:"voxel"===e?.type?p.s.voxel:"parquet"===e?.type?p.s.parquet:p.s.feature}function w(e){const t=b(e);let i;return t===p.s.wms||t===p.s.mapImage?i=e?.layer.version:(t===p.s.imagery||t===p.s.feature||t===p.s.scene)&&(i=e.version),Number.parseFloat(i)}function v(e){return"fieldConfigurations"in e&&u.includes(e.type)}async function C(e){return await new Promise((t,i)=>{switch(b(e)){case p.s.feature:case p.s.ogcFeature:case p.s.stream:t(e.fields);break;case p.s.mapImage:{const s=e,a=s?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,l=[];a.forEach(e=>{i.has(e)&&l.push(i.get(e))}),t(l)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case p.s.imagery:case p.s.imageryTile:case p.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function $(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function N(e){return Number((100*(1-e)).toFixed(1))}function F(e){return Number((1-e/100).toFixed(3))}const I=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(p.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},T=async(e,t)=>{const i=new d.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},x=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await S(i,s.features?.[0])},S=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=I(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const l=new a.default;i.geometry=l}return i};function k(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function B(e){if(b(e)===p.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(b(e)===p.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function _(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function A(e,t){try{const i=b(e);if(i===p.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await T(e,t)||await L(e,t)]};if(i===p.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await L(e,t)]};const s=i===p.s.ogcFeature||i===p.s.stream?await t.whenLayerView(e):e,a=s.createQuery();a.where=s.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===p.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const l=await s.queryFeatures(a);return l?.features?.length||(l.features[0]=await L(e,t)),l}catch(e){console.error(e)}}async function L(e,t){return await new Promise(i=>{const a=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const c=t.extent;let d;"polygon"===e.geometryType?d=r.default.fromExtent(c):"point"===e.geometryType?d=c.center.clone():"multipoint"===e.geometryType?d=new l.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(d=new n.default({spatialReference:t.spatialReference.clone()}),d.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(d=o.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=d,i(a)})}function E(e){return b(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function q(e){return b(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},98629:(e,t,i)=>{i.d(t,{e:()=>n,g:()=>l,i:()=>a});const s=["feature","oriented-imagery","map-image","subtype-sublayer"];function a(e,t){for(;e;){if(e.nodeName===t.toUpperCase())return!0;e=e.parentElement}return!1}function l(e){return[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap(e=>e.templates):[]]}function n(e){return(s.includes(e.type)||"sublayer"===e.type&&s.includes(e.layer.type))&&function(e){if(!e?.capabilities)return!1;const{capabilities:{data:{supportsAttachment:t},operations:{supportsQueryAttachments:i}}}=e;return t&&i}(e)}}}]);