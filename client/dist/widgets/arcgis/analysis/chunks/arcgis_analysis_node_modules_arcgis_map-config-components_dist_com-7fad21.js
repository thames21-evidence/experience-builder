/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-7fad21.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-7fad21"],{20936:(e,t,i)=>{function a(e){return function(e,t){return function(e,t){const i=e.assignedElements({flatten:!0});return t?i.filter(e=>e.matches(t)):i}(e.target,t)}(e).length>0}i.d(t,{Ly:()=>s,Qp:()=>c,Yt:()=>n,Zj:()=>d,el:()=>l,ti:()=>a});const s=(...e)=>{const t=[];for(let i=0;i<e.length;i++){const a=e[i];if("string"==typeof a)t.push(a);else if(Array.isArray(a))t.push.apply(t,a);else if("object"==typeof a)for(const e in a)a[e]&&t.push(e)}const i=t.join(" ");return t.length=0,i},n=(e,t,i)=>(0,r(t).subscribe)(t=>{const a=t.some(t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target));a&&i()}),o={},r=e=>{const t=e.join(","),i=o[t];if(void 0!==i)return i;const a=new Set,s=new MutationObserver(e=>a.forEach(t=>t(e)));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const n={subscribe:e=>(a.add(e),()=>{a.delete(e),0===a.size&&(s.disconnect(),o[t]=void 0)})};return o[t]=n,n},l=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const a=i.getRootNode?.();if(a===globalThis.document)return;i=a.host}};const c=e=>d(e,"dir","ltr"),d=(e,t,i)=>{const a=l(e,`[${t}]`);return a?.getAttribute(t)??i}},21487:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigFeatureReductionField:()=>y});var a=i(73679),s=i(4395),n=i(42097),o=i(72344),r=i(52797),l=i(42855),c=i(66228),d=i(57313),m=i(85643),u=i(73801),p=i(22679),f=(i(83930),i(23054),i(77462),i(56451),i(76830)),g=i(20936);const h=s.AH`.section{padding-top:15px}.format{padding-top:20px}.field-selection{display:flex;width:100%;justify-content:space-between;align-items:stretch;min-width:0}.field-selection-button{width:calc(100% - 32px - var(--calcite-spacing-xs))}.single-line-label-switch-section{display:flex;margin:0;padding:var(--calcite-spacing-sm) 0}.single-line-label-switch-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.single-line-label-switch-switch{flex:0 0 0%;justify-self:flex-end;margin:0}.single-line-label-switch-switch input{display:none}`;class y extends u.WF{constructor(){super(...arguments),this.blockNode=(0,m._)(),this.dropdownActionNode=(0,m._)(),this.fieldNode=(0,m._)(),this.dateFormatSelectNode=(0,m._)(),this.showTimeNode=(0,m._)(),this.showTimeSwitchNode=(0,m._)(),this.timeFormatNode=(0,m._)(),this.timeFormatSelectNode=(0,m._)(),this.arcadeExpMap=new Map,this.displayDate=new Date("December 31, 1969 18:00:00"),this.disconnected=!1,this.open=!1,this.isAutoGeneratedPieChartClusterField=!1,this.arcgisChange=(0,u.lh)(),this.arcgisDelete=(0,u.lh)()}static{this.properties={mapView:0,layer:0,portal:0,_messages:0,aggregateField:0,open:5,isAutoGeneratedPieChartClusterField:5}}static{this.styles=h}async done(){this.closePopovers()}async load(){const{layer:e,aggregateField:t}=this;(0,f.d)(e,t.name)||(0,f.a)(t,e),this.arcadeExpMap=(0,c.h)(this.layer.featureReduction.popupTemplate),this.currentFieldInfo=this.getCurrentFieldInfo()}loaded(){this.flowItemNode=(0,g.el)(this.el,"calcite-flow-item");const{currentFieldInfo:e}=this;d.a.get(e.format?.dateFormat)&&this.setupDateTimeDisplay()}disconnectedCallback(){super.disconnectedCallback(),this.disconnected=!0,clearTimeout(this.fieldAliasHandle),this.closePopovers()}buttonRefHandler(e){e&&(this.arcadeButtonNode=e)}getCurrentFieldInfo(){const{layer:e,aggregateField:t}=this;return e.featureReduction.popupTemplate.fieldInfos.find(e=>e.fieldName===t.name)}saveFieldInfo(){const{layer:e,aggregateField:t,currentFieldInfo:i,arcadeExpMap:a}=this,s=e.featureReduction?.popupTemplate;if(this.arcadeExpMap.has(i.fieldName)&&s?.expressionInfos&&s.expressionInfos.find((e,t)=>{`${l.f.expression}${e.name}`===i.fieldName&&(s.expressionInfos[t]=a.get(i.fieldName).clone())}),s?.fieldInfos){const e=s.fieldInfos.findIndex(e=>e.fieldName===this.aggregateField.name);s.fieldInfos[e]=i.clone()}Array.isArray(s?.content)&&s.content.forEach(e=>{"fields"===e.type&&e.fieldInfos&&e.fieldInfos.forEach((a,s)=>{if(a.fieldName===t.name){const t=i.clone();t.visible=!0,e.fieldInfos[s]=t}})}),this.arcgisChange.emit()}handleFieldSelect(){const{layer:e,mapView:t,aggregateField:i,fieldPickListSortBy:a,_messages:n}=this,o=(0,g.el)(this.el,"calcite-flow-item"),r=o.getBoundingClientRect().width||215;this.arcgisFieldPickList=(0,u.dN)(s.qy`<arcgis-field-pick-list .popoverProps=${{placement:"auto",offsetDistance:-1*(r+10),offsetSkidding:0,triggerDisabled:!0,popoverWidth:r+30,refElement:o}} .fields=${this.createPickListFields()} .layer=${e} .mapView=${t} show-field-info .selectedFields=${[i.onStatisticField]} .sortBy=${a} @arcgisSortByChange=${e=>{this.fieldPickListSortBy=e.detail}} @arcgisClose=${t=>{t.stopPropagation();const i=t.detail?.selectedFields?.[0];if(o.disabled=!1,this.arcgisFieldPickList&&(this.arcgisFieldPickList.remove(),this.arcgisFieldPickList=void 0,setTimeout(()=>{this.fieldNode.value?.setFocus()},1)),i){const{aggregateField:t}=this,a=(0,f.e)(e,i),s=(0,f.b)(a);let o=0,r=(0,f.h)(e,a.name,s[o]);for(;o<s.length&&r;)o++,s[o]===t.statisticType&&o++,o<s.length&&(r=(0,f.h)(e,a.name,s[o]));if(r)return;const l=t.name,c=s[o];t.name=`${a.name}_${c}`,t.onStatisticField=a.name,t.onStatisticExpression=null,t.alias=`${(0,f.c)(e,a.name)||a.alias||a.name} ${(0,p.d)(c,n).toLowerCase()}`,t.statisticType=c,this.replacePopupField(l),this.currentFieldInfo=this.getCurrentFieldInfo(),this.arcgisChange.emit()}}}></arcgis-field-pick-list>`),document.body.appendChild(this.arcgisFieldPickList),this.arcgisFieldPickList.setFocus(),o.disabled=!0}createPickListFields(){const{layer:e,aggregateField:t}=this,{fields:i}=e;return i.filter(e=>["small-integer","big-integer","integer","single","double","long","number","string","date","timestamp-offset"].includes(e.type)).filter(i=>t.onStatisticField===i.name||!(0,f.i)(e,i.name)).map(t=>({name:t.name,alias:(0,f.c)(e,t.name)||t.alias,type:t.type}))}replacePopupField(e){const{layer:t,aggregateField:i}=this,a=t.featureReduction,{popupTemplate:s}=a;s.fieldInfos=s.fieldInfos||[];const o=s.fieldInfos.findIndex(t=>t.fieldName===e),r=i.onStatisticField?(0,f.e)(t,i.onStatisticField):i.onStatisticExpression;s.fieldInfos.splice(o,1,new n.default({fieldName:i.name,label:i.alias,isEditable:!1,visible:!0,format:i.onStatisticExpression?"number"===i.onStatisticExpression.returnType?{digitSeparator:!0}:void 0:"string"===r.type?void 0:["date","timestamp-offset"].includes(r.type)?{dateFormat:"short-date-short-time"}:["small-integer","big-integer","integer","long","number"].includes(r.type)?{digitSeparator:!0}:{digitSeparator:!0,places:1}})),s.content?.forEach((t,i)=>{"fields"===t.type&&t.fieldInfos&&(s.content[i].fieldInfos=s.content[i].fieldInfos?.filter(t=>t.fieldName!==e))})}removeField(){const{layer:e,aggregateField:t}=this,i=e.featureReduction,a=i.popupTemplate;let s=a.fieldInfos.findIndex(e=>e.fieldName===t.name);s>=0&&a.fieldInfos.splice(s,1),s=i.fields.findIndex(e=>e.name===t.name),i.fields.splice(s,1),a.content?.forEach((e,i)=>{"fields"===e.type&&e.fieldInfos&&(a.content[i].fieldInfos=a.content[i].fieldInfos?.filter(e=>e.fieldName!==t.name))}),this.arcgisDelete.emit()}async openArcadeEditor(){const{_messages:e}=this;if(!this.arcadeEditor){(0,g.el)(this.el,"calcite-flow-item").disabled=!0,this.arcadeEditor=(0,u.dN)(s.qy`<arcgis-map-config-modal-arcade .arcadeScript=${this.aggregateField.onStatisticExpression?.expression||""} .arcadeProfile=${this.getArcadeProfile()} .testData=${await this.getArcadeTestData()} add-existing-expressions .layer=${this.layer} .portal=${this.portal} .arcadeTitle=${this.aggregateField.onStatisticExpression?.title||e.fields.newExpression} arcade-title-editable .arcadeTitleEditingEnabled=${!this.aggregateField.onStatisticExpression?.title} return-predict-output-type @arcgisClose=${e=>{this.arcadeSetup(e.detail)}}></arcgis-map-config-modal-arcade>`),document.body.appendChild(this.arcadeEditor)}}getArcadeProfile(){const{layer:e}=this;return{id:"aggregate-field",definitions:{$feature:e}}}async getArcadeTestData(){const{layer:e,mapView:t}=this;try{return{profileVariableInstances:{$feature:(await(0,c.f)(e,t)).features[0]},spatialReference:this.mapView.spatialReference,timeZone:this.mapView.timeZone}}catch(e){console.log(e)}}arcadeSetup(e){const{layer:t,aggregateField:i,_messages:a}=this;if(e&&"date"!==e.predictOutputType){if(e?.script){const s="number"===e.predictOutputType?a.fields.sum:a.fields.mode,n=i.name,o=`${e.title}_${s.toLocaleLowerCase()}`;if(t.featureReduction.fields.find(e=>e.name===o)&&n!==o){const i=t.featureReduction.fields.map(e=>e.name);let a=1;for(;i.includes(`${e.title}_${a}_${s.toLocaleLowerCase()}`);)a++;e.title=`${e.title}_${a}`}i.name=`${e.title}_${s.toLocaleLowerCase()}`,i.alias=e.title,i.onStatisticField=null,i.statisticType="number"===e.predictOutputType?"sum":"mode",i.onStatisticExpression?(i.onStatisticExpression.expression=e.script,i.onStatisticExpression.title=e.title,i.onStatisticExpression.returnType=e.predictOutputType??"number"):i.onStatisticExpression={expression:e.script,title:e.title,returnType:e.predictOutputType??"number"},this.replacePopupField(n),this.currentFieldInfo=this.getCurrentFieldInfo(),this.arcgisChange.emit(),this.requestUpdate()}this.handleArcadeModalClose()}else this.handleArcadeModalClose()}handleArcadeModalClose(){const{flowItemNode:e}=this;e.disabled=!1,this.arcadeEditor&&(this.arcadeEditor.remove(),this.arcadeEditor=void 0),this.arcadeButtonNode?.setFocus()}updateAlias(e){const{layer:t,aggregateField:i}=this,a=(0,f.d)(t,i.name);i.isAutoGenerated?a.label=e:i.alias=e,this.updatePopupAlias(),this.arcgisChange.emit()}updatePopupAlias(){const{layer:e,aggregateField:t}=this,i=e.featureReduction,a=(0,f.d)(e,t.name),s=t.isAutoGenerated?a.label:t.alias;t.isAutoGenerated||(a.label=s),Array.isArray(i.popupTemplate.content)&&i.popupTemplate.content.length&&i.popupTemplate.content.forEach(e=>{if("fields"===e.type&&e.fieldInfos){const i=e.fieldInfos.find(e=>e.fieldName===t.name);i&&(i.label=s)}})}setupDateTimeDisplay(){const{currentFieldInfo:e}=this,t=d.a.get(e.format.dateFormat);t&&(""===t.timeFormat?(this.showTimeNode.value.style.display="flex",this.showTimeSwitchNode.value.checked=!1,this.timeFormatNode.value.style.display="none"):null===t.timeFormat?(this.showTimeNode.value.style.display="none",this.showTimeSwitchNode.value.checked=!1,this.timeFormatNode.value.style.display="none"):(this.showTimeNode.value.style.display="flex",this.showTimeSwitchNode.value.checked=!0,this.timeFormatNode.value.style.display="block"))}getTimeFormatString(e){const{_messages:t}=this;return e===d.t[0]?t.fields.shortTime:e===d.t[1]?t.fields.longTime:e===d.t[2]?t.fields.shortTime24:e===d.t[3]?t.fields.longTime24:t.fields.shortTime24}changeDateFormat(){const{currentFieldInfo:e}=this,t=this.dateFormatSelectNode.value?.selectedOption?.value,i=this.timeFormatSelectNode.value?.selectedOption?.value,a=d.a.get(t);""===a.timeFormat?e.format.dateFormat=this.showTimeSwitchNode.value.checked?`${t}-${i}`:`${t}`:null===a.timeFormat&&(e.format.dateFormat=`${t}`),this.saveFieldInfo(),this.setupDateTimeDisplay()}toggleTooltip(e){e&&!this.tooltipNode?(this.tooltipNode=(0,u.dN)(s.qy`<calcite-tooltip .referenceElement=${this.dropdownActionNode.value} open placement=leading-start overlay-positioning=fixed>${this._messages.fields.moreOptions}</calcite-tooltip>`),document.body.append(this.tooltipNode)):e||(this.tooltipNode?.remove(),this.tooltipNode=void 0)}closePopovers(){this.arcgisFieldPickList&&(this.arcgisFieldPickList.remove(),this.arcgisFieldPickList=void 0),this.tooltipNode&&(this.tooltipNode.remove(),this.tooltipNode=void 0)}render(){const{layer:e,aggregateField:t,open:i}=this,a=(0,f.d)(e,t.name),n=(t.isAutoGenerated?a.label:t.alias)||t.name;return s.qy`<calcite-block .heading=${n} .expanded=${i} collapsible @calciteBlockOpen=${e=>{const t=e.target;this.open=t.open}} @calciteBlockClose=${e=>{const t=e.target;this.open=t.open}} ${(0,m.K)(this.blockNode)}>${this.renderDropdown()}${this.renderFieldSelection()}${this.renderFieldTypeOptions()}${this.renderTypeSelection()}${this.renderResultFieldName()}${this.renderFieldAlias()}${this.renderFormatting()}</calcite-block>`}renderDropdown(){const{layer:e,aggregateField:t,_messages:i,isAutoGeneratedPieChartClusterField:a}=this,n=(0,f.e)(e,t.onStatisticField)??t.onStatisticExpression;return t.isAutoGenerated||a||!n?"":s.qy`<div slot=control><calcite-dropdown placement=bottom-end scale=s overlay-positioning=fixed><calcite-action id=dropdown-action-node slot=trigger .text=${i.delete} @mouseover=${()=>this.toggleTooltip(!0)} @mouseout=${()=>this.toggleTooltip(!1)} @focus=${()=>this.toggleTooltip(!0)} @focusout=${()=>this.toggleTooltip(!1)} ${(0,m.K)(this.dropdownActionNode)}><calcite-icon scale=s icon=ellipsis></calcite-icon></calcite-action><calcite-dropdown-group><calcite-dropdown-item @click=${e=>{e.stopPropagation(),this.removeField()}} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&this.removeField()}}>${i.delete}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown></div>`}renderFieldSelection(){const{aggregateField:e,_messages:t,isAutoGeneratedPieChartClusterField:i,layer:a}=this;return e.isAutoGenerated||i||!e.onStatisticField&&!e.onStatisticExpression?"":s.qy`<calcite-label>${t.fields.field}</calcite-label><div class="field-selection"><calcite-button class="field-selection-button" appearance=outline-fill kind=neutral width=full alignment=icon-end-space-between icon-end=chevron-down .disabled=${e.isAutoGenerated} @click=${()=>this.handleFieldSelect()} ${(0,m.K)(this.fieldNode)}>${(0,f.c)(a,e.onStatisticField)||e.alias||e.onStatisticField||e.onStatisticExpression?.title}</calcite-button><div>&nbsp;</div><calcite-button id=feature-reduction-attribute-switch appearance=outline-fill kind=neutral icon-start=code .label=${t.fields.expression} @click=${()=>this.openArcadeEditor()} ${(0,m.K)(this.buttonRefHandler)}></calcite-button><calcite-tooltip reference-element=feature-reduction-attribute-switch overlay-positioning=fixed>${t.fields.addExpression}</calcite-tooltip></div>`}renderFieldTypeOptions(){const{aggregateField:e,_messages:t,layer:i}=this;if(!e.onStatisticExpression)return"";const a=e.onStatisticExpression.returnType;return s.qy`<div class="section"><calcite-label>${t.fields.fieldType}</calcite-label><calcite-segmented-control scale=s width=full @calciteSegmentedControlChange=${a=>{const s=a.target.value,n="number"===s?t.fields.sum:t.fields.mode,o=e.name,r=`${e.onStatisticExpression.title}_${n.toLocaleLowerCase()}`;if(i.featureReduction.fields.find(e=>e.name===r)&&o!==r){const t=i.featureReduction.fields.map(e=>e.name);let a=1;for(;t.includes(`${e.onStatisticExpression.title}_${a}_${n.toLocaleLowerCase()}`);)a++;e.onStatisticExpression.title=`${e.onStatisticExpression.title}_${a}`}e.name=`${e.onStatisticExpression.title}_${n.toLocaleLowerCase()}`,e.alias=e.onStatisticExpression.title,e.onStatisticField=null,e.statisticType="number"===s?"sum":"mode",e.onStatisticExpression.returnType=s,this.replacePopupField(o),this.currentFieldInfo=this.getCurrentFieldInfo(),this.arcgisChange.emit(),this.requestUpdate()}}><calcite-segmented-control-item value=number .checked=${"number"===a}>${t.fields.number}</calcite-segmented-control-item><calcite-segmented-control-item value=string .checked=${"string"===a}>${t.fields.string}</calcite-segmented-control-item></calcite-segmented-control></div>`}renderTypeSelection(){const{layer:e,aggregateField:t,_messages:i,isAutoGeneratedPieChartClusterField:a}=this,n=t.onStatisticField?(0,f.e)(e,t.onStatisticField):t.onStatisticExpression,o=t.onStatisticExpression?"string"===t.onStatisticExpression.returnType:"string"===n?.type,r=t.onStatisticExpression?["date","timestamp-offset"].includes(t.onStatisticExpression.returnType):["date","timestamp-offset"].includes(n?.type);return s.qy`<div class="section"><calcite-label>${i.fields.statsType}</calcite-label><calcite-select width=full .label=${i.fields.statsType} .disabled=${t.isAutoGenerated||a||!n} @calciteSelectChange=${a=>{const s=(a?.target).selectedOption.value,o=t.name;t.name=t.onStatisticExpression?`${t.onStatisticExpression.title}_${s}`:`${n.name}_${s}`,t.onStatisticField&&(t.onStatisticField=n.name),t.alias=t.onStatisticExpression?t.onStatisticExpression.title:`${(0,f.c)(e,n.name)||n.alias||n.name} ${(0,p.d)(s,i).toLowerCase()}`,t.statisticType=s,this.replacePopupField(o),this.arcgisChange.emit()}}>${!o&&!r&&this.renderTypeOption("sum")||""}${!o&&!r&&this.renderTypeOption("avg")||""}${!o&&!r&&this.renderTypeOption("min")||""}${!o&&!r&&this.renderTypeOption("max")||""}${this.renderTypeOption("mode")}${"count"===t.statisticType&&this.renderTypeOption("count")||""}</calcite-select></div>`}renderTypeOption(e){const{layer:t,aggregateField:i,_messages:a}=this;return s.qy`<calcite-option .value=${e} .label=${(0,p.d)(e,a)} .disabled=${i.statisticType!==e&&(i.onStatisticField&&(0,f.h)(t,i.onStatisticField,e)||i.onStatisticExpression&&(0,f.f)(t,i.name,i.statisticType,e))} .selected=${i.statisticType===e}></calcite-option>`}renderResultFieldName(){const{aggregateField:e,_messages:t}=this;return s.qy`<div class="section"><calcite-label>${t.fields.resultFieldName}</calcite-label><calcite-input type=text disabled .value=${e.name} .label=${t.fields.resultFieldName}></calcite-input></div>`}renderFieldAlias(){const{layer:e,aggregateField:t,_messages:i}=this,a=(0,f.d)(e,t.name),n=(t.isAutoGenerated?a.label:t.alias)||t.name;return s.qy`<div class="section"><calcite-label>${i.fields.fieldAlias}</calcite-label><calcite-input type=text .value=${n} .label=${i.fields.fieldAlias} @calciteInputInput=${a=>{if(this.disconnected)return;clearTimeout(this.fieldAliasHandle);const s=a.target;let n=s.value;this.blockNode.value.heading=n,n?this.updateAlias(n):this.fieldAliasHandle=setTimeout(()=>{const a=(0,f.d)(e,t.name);if(!(t.isAutoGenerated?a.label:t.alias)){const a=(0,f.e)(e,t.onStatisticField);n=`${a.alias||a.name} ${(0,p.d)(t.statisticType,i).toLocaleLowerCase()}`,this.blockNode.value.heading=n,s.value=n}this.updateAlias(n)},3e3)}}></calcite-input></div>`}renderFormatting(){const{layer:e,aggregateField:t,_messages:i}=this,a=(0,f.e)(e,t.onStatisticField);if(t.onStatisticExpression||!a&&"count"!==t.statisticType||"string"===a?.type)return"";this.currentFieldInfo=this.getCurrentFieldInfo(),this.currentFieldInfo.format=this.currentFieldInfo.format||new o.default({digitSeparator:!0,places:0});const n=["date","timestamp-offset"].includes(a?.type),r=!a||["integer","small-integer","big-integer"].includes(a.type),l=d.a.has(this.currentFieldInfo.format.dateFormat)?d.a.get(this.currentFieldInfo.format.dateFormat):d.a.get("short-date-short-time");return s.qy`<div class="format"><calcite-label scale=l>${i.fields.formatting}</calcite-label>${!r&&!n&&this.renderSignificantDigits(this.currentFieldInfo.format)||""}${!n&&this.renderThousandSeparator(this.currentFieldInfo.format)||""}${n&&this.renderDateFormat(l.dateFormat)||""}${n&&this.renderShowTime(l.timeFormat)||""}${n&&this.renderTimeFormat(l.timeFormat)||""}</div>`}renderSignificantDigits(e){const{_messages:t}=this;return s.qy`<section><calcite-label>${t.fields.significantDigits}<calcite-select .label=${t.fields.significantDigits} @calciteSelectChange=${t=>{const i=t.target;e.places=Number(i.selectedOption.value)||0,this.saveFieldInfo()}}><calcite-option value=0 .selected=${0===e.places}>${t.fields.decimalPlaces0}</calcite-option><calcite-option value=1 .selected=${1===e.places}>${t.fields.decimalPlaces1}</calcite-option>${[2,3,4,5,6,7,8].map(i=>s.qy`<calcite-option .value=${`${i}`} .selected=${e.places===i}>${t.fields.decimalPlacesN.replace("${num}",`${i}`)}</calcite-option>`)}</calcite-select></calcite-label></section>`}renderThousandSeparator(e){const{_messages:t}=this;return s.qy`<section><calcite-label layout=inline-space-between>${t.fields.show1000Separator}<calcite-switch .checked=${e.digitSeparator} @calciteSwitchChange=${t=>{const i=t?.target;e.digitSeparator=i.checked,this.saveFieldInfo()}}></calcite-switch></calcite-label></section>`}renderDateFormat(e){const{_messages:t,displayDate:i}=this;return s.qy`<calcite-label>${t.fields.dateFormat}<calcite-select .label=${t.fields.dateFormat} @calciteSelectChange=${()=>this.changeDateFormat()} ${(0,m.K)(this.dateFormatSelectNode)}>${d.d.map(t=>s.qy`<calcite-option .value=${t} .selected=${e===t}>${r.formatDate(i,r.convertDateFormatToIntlOptions(t))}</calcite-option>`)}</calcite-select></calcite-label>`}renderShowTime(e){const{_messages:t}=this;return s.qy`<div class="single-line-label-switch-section" ${(0,m.K)(this.showTimeNode)}><calcite-label class="single-line-label-switch-label">${t.fields.showTime}</calcite-label><calcite-switch class="single-line-label-switch-switch" .checked=${(0,c.i)(e)&&""!==e} @calciteSwitchChange=${()=>this.changeDateFormat()} ${(0,m.K)(this.showTimeSwitchNode)}></calcite-switch></div>`}renderTimeFormat(e){const{_messages:t}=this;return s.qy`<calcite-label ${(0,m.K)(this.timeFormatNode)}>${t.fields.timeFormat}<calcite-select .label=${t.fields.timeFormat} @calciteSelectChange=${()=>this.changeDateFormat()} ${(0,m.K)(this.timeFormatSelectNode)}>${d.t.map(t=>s.qy`<calcite-option .value=${t} .selected=${e===t}>${this.getTimeFormatString(t)}</calcite-option>`)}</calcite-select></calcite-label>`}}(0,a.c)("arcgis-map-config-feature-reduction-field",y)},22679:(e,t,i)=>{i.d(t,{F:()=>c,a:()=>l,b:()=>o,c:()=>n,d:()=>u,e:()=>a,f:()=>s,g:()=>d,h:()=>r,i:()=>m});const a=9,s=90,n=37.5,o=9,r=90,l=37.5;var c=(e=>(e.CLUSTERING="clustering",e.CHART_CLUSTERING="chartClustering",e.BINNING="binning",e))(c||{});function d(e){const t=e.featureReduction;if(t)return"binning"===t.type?"binning":"cluster"===t.type?function(e){const t=e.featureReduction;return!!t.renderer&&"pie-chart"===t.renderer.type&&!t?.renderer?.authoringInfo?.isAutoGenerated}(e)?"pie-chart":"cluster":void 0}function m(e){const t=e.featureReduction;return!t?.renderer||!!t?.renderer?.authoringInfo?.isAutoGenerated}function u(e,t){switch(e){case"sum":return t.fields.sum;case"avg":return t.fields.mean;case"min":return t.fields.min;case"max":return t.fields.max;case"stddev":return t.fields.stdDev;case"mode":return t.fields.mode;case"var":return t.fields.var;case"count":return t.fields.count;default:return""}}},42855:(e,t,i)=>{i.d(t,{a:()=>o,f:()=>a,l:()=>s,s:()=>n});var a=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(a||{}),s=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(s||{}),n=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(n||{}),o=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(o||{})},57313:(e,t,i)=>{i.d(t,{a:()=>r,b:()=>o,d:()=>a,i:()=>s,t:()=>n});const a=["short-date","long-month-day-year","day-short-month-year","long-date","long-month-year","short-month-year","year"],s=[{dateStyle:"short",month:void 0,year:void 0},{dateStyle:"long",month:void 0,year:void 0},{dateStyle:"medium",month:void 0,year:void 0},{dateStyle:"full",month:void 0,year:void 0},{dateStyle:void 0,month:"long",year:"numeric"},{dateStyle:void 0,month:"short",year:"numeric"},{dateStyle:void 0,month:void 0,year:"numeric"}],n=["short-time","long-time","short-time-24","long-time-24"],o=[{timeStyle:"short"},{timeStyle:"medium"},{timeStyle:"long"},{timeStyle:"full"}],r=new Map;r.set("short-date",{dateFormat:a[0],timeFormat:""}),r.set("short-date-short-time",{dateFormat:a[0],timeFormat:n[0]}),r.set("short-date-long-time",{dateFormat:a[0],timeFormat:n[1]}),r.set("short-date-short-time-24",{dateFormat:a[0],timeFormat:n[2]}),r.set("short-date-long-time-24",{dateFormat:a[0],timeFormat:n[3]}),r.set("long-month-day-year",{dateFormat:a[1],timeFormat:""}),r.set("long-month-day-year-short-time",{dateFormat:a[1],timeFormat:n[0]}),r.set("long-month-day-year-long-time",{dateFormat:a[1],timeFormat:n[1]}),r.set("long-month-day-year-short-time-24",{dateFormat:a[1],timeFormat:n[2]}),r.set("long-month-day-year-long-time-24",{dateFormat:a[1],timeFormat:n[3]}),r.set("day-short-month-year",{dateFormat:a[2],timeFormat:""}),r.set("day-short-month-year-short-time",{dateFormat:a[2],timeFormat:n[0]}),r.set("day-short-month-year-long-time",{dateFormat:a[2],timeFormat:n[1]}),r.set("day-short-month-year-short-time-24",{dateFormat:a[2],timeFormat:n[2]}),r.set("day-short-month-year-long-time-24",{dateFormat:a[2],timeFormat:n[3]}),r.set("long-date",{dateFormat:a[3],timeFormat:""}),r.set("long-date-short-time",{dateFormat:a[3],timeFormat:n[0]}),r.set("long-date-long-time",{dateFormat:a[3],timeFormat:n[1]}),r.set("long-date-short-time-24",{dateFormat:a[3],timeFormat:n[2]}),r.set("long-date-long-time-24",{dateFormat:a[3],timeFormat:n[3]}),r.set("long-month-year",{dateFormat:a[4],timeFormat:null}),r.set("short-month-year",{dateFormat:a[5],timeFormat:null}),r.set("year",{dateFormat:a[6],timeFormat:null}),r.set("default",{dateFormat:a[0],timeFormat:n[2]})},66228:(e,t,i)=>{i.d(t,{a:()=>F,b:()=>N,c:()=>k,d:()=>T,e:()=>I,f:()=>A,g:()=>h,h:()=>y,i:()=>f,j:()=>g,k:()=>$,l:()=>_,m:()=>S,n:()=>u,o:()=>v,p:()=>R,q:()=>C,r:()=>L,s:()=>w,t:()=>x,u:()=>b});var a=i(63438),s=i(18423),n=i(96086),o=i(91813),r=i(21255),l=i(13078),c=i(21303),d=i(12627),m=i(42855);const u=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],p=["feature"];function f(e){return null!=e}function g(e,t,i){const a=t.fieldName;if(a.includes(m.f.expression)){const e=i.get(a);return e?.title?e.title:a}return w(e)&&e.getFieldConfiguration(a)?e.getFieldAlias(a)||a:t.label||a}async function h(e){return new Map((await $(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function y(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${m.f.expression}${e.name}`;t.set(i,e)}),t}function F(e){return"map-image"===e?.layer?.type?m.s.mapImage:"subtype-sublayer"===e?.type?m.s.subtype:"tile"===e?.layer?.type?m.s.tile:"scene"===e?.type?m.s.scene:"ogc-feature"===e?.type?m.s.ogcFeature:"imagery"===e?.type?m.s.imagery:"imagery-tile"===e?.type?m.s.imageryTile:"wfs"===e?.type?m.s.wfs:"wcs"===e?.type?m.s.wcs:"wms"===e?.layer?.type?m.s.wms:"csv"===e?.type?m.s.csv:"geojson"===e?.type?m.s.geojson:"stream"===e?.type?m.s.stream:"oriented-imagery"===e?.type?m.s.orientedImagery:"catalog"===e?.type?m.s.catalog:"catalog-footprint"===e?.type?m.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?m.s.knowledgeGraphSublayer:"voxel"===e?.type?m.s.voxel:"parquet"===e?.type?m.s.parquet:m.s.feature}function b(e){const t=F(e);let i;return t===m.s.wms||t===m.s.mapImage?i=e?.layer.version:(t===m.s.imagery||t===m.s.feature||t===m.s.scene)&&(i=e.version),Number.parseFloat(i)}function w(e){return"fieldConfigurations"in e&&p.includes(e.type)}async function $(e){return await new Promise((t,i)=>{switch(F(e)){case m.s.feature:case m.s.ogcFeature:case m.s.stream:t(e.fields);break;case m.s.mapImage:{const a=e,s=a?.layer;s?.portalItem&&s.url.includes("https://demographics")&&s.url.includes(".arcgis.com")?s.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(a.fields.map(e=>[e.name,e])),s=e.thematicGroup.fieldNames,n=[];s.forEach(e=>{i.has(e)&&n.push(i.get(e))}),t(n)}else t(a.fields)}).catch(e=>{i(new Error(e))}):t(a.fields);break}case m.s.imagery:case m.s.imageryTile:case m.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function v(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function S(e){return Number((100*(1-e)).toFixed(1))}function x(e){return Number((1-e/100).toFixed(3))}const T=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(m.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},N=async(e,t)=>{const i=new d.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await c.identify(e.layer.url,i))?.results?.[0]?.feature},I=async(e,t,i)=>{const a=await(await e.whenLayerView(t)).queryAggregates();return await E(i,a.features?.[0])},E=async(e,t)=>{let i;if(t)i=t.clone();else{i=new a.default;const t=T(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const n=new s.default;i.geometry=n}return i};function C(e,t){const i=t.startsWith("#"),a=t.startsWith(".");for((a||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(a){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function k(e){if(F(e)===m.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(F(e)===m.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function _(e,t,i){let a="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))a="number";else if(t.has(e)){const i=t.get(e);a=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);a=t.returnType?t.returnType.toLowerCase():""}else a="number";return a}async function A(e,t){try{const i=F(e);if(i===m.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await N(e,t)||await P(e,t)]};if(i===m.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await P(e,t)]};const a=i===m.s.ogcFeature||i===m.s.stream?await t.whenLayerView(e):e,s=a.createQuery();s.where=a.definitionExpression||"1=1",s.outFields=["*"],s.returnM="hasM"in e&&e.hasM,s.returnZ="hasZ"in e&&e.hasZ,s.outSpatialReference=t.spatialReference,s.returnGeometry=!0,(a.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===m.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=t.spatialReference;const n=await a.queryFeatures(s);return n?.features?.length||(n.features[0]=await P(e,t)),n}catch(e){console.error(e)}}async function P(e,t){return await new Promise(i=>{const s=new a.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),s.attributes=t}const c=t.extent;let d;"polygon"===e.geometryType?d=r.default.fromExtent(c):"point"===e.geometryType?d=c.center.clone():"multipoint"===e.geometryType?d=new n.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(d=new o.default({spatialReference:t.spatialReference.clone()}),d.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(d=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),s.geometry=d,i(s)})}function L(e){return F(e)===m.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function R(e){return F(e)===m.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},76830:(e,t,i)=>{i.d(t,{a:()=>m,b:()=>c,c:()=>u,d:()=>d,e:()=>n,f:()=>r,g:()=>s,h:()=>o,i:()=>l});var a=i(42097);function s(e){return e.fields.filter(e=>["small-integer","big-integer","integer","single","double","long","number","string"].includes(e.type))}function n(e,t){if(t)return e.fields.find(e=>e.name===t)}function o(e,t,i){return!!e.featureReduction.fields?.find(e=>e.onStatisticField===t&&e.statisticType===i)}function r(e,t,i,a){const s=t.substring(0,t.lastIndexOf(`_${i}`));return!!e.featureReduction.fields?.find(e=>e.name.substring(0,e.name.lastIndexOf(`_${a}`))===s&&e.statisticType===a)}function l(e,t){return!c(n(e,t)).find(i=>!o(e,t,i))}function c(e){return["string","date","timestamp-offset"].includes(e.type)?["mode"]:["sum","avg","min","max","mode"]}function d(e,t){return e.featureReduction.popupTemplate.fieldInfos.find(e=>e.fieldName===t)}function m(e,t){const i=t.featureReduction,{popupTemplate:s}=i;s.fieldInfos=s.fieldInfos||[],s.fieldInfos.find(t=>t.fieldName===e.name)||s.fieldInfos.push(new a.default({fieldName:e.name,label:e.alias,isEditable:!1,visible:!0,format:p(e,t)}))}function u(e,t){const{popupTemplate:i}=e;return i?.fieldInfos?.find(e=>e.fieldName===t)?.label}function p(e,t){const i=e.onStatisticField,a=e.onStatisticExpression,s="sum"===e.statisticType,o="count"===e.statisticType,r=n(t,i),l=o||a&&s||r&&["small-integer","big-integer","integer","long","number"].includes(r.type);return r&&["single","double"].includes(r.type)?{digitSeparator:!0,places:1}:l?{digitSeparator:!0}:void 0}}}]);