/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-860bc4.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-860bc4"],{36486:(e,t,a)=>{a.d(t,{u:()=>n});var s=a(83552),i=a(73679);const n=(0,s.yr)(i.g)},42855:(e,t,a)=>{a.d(t,{a:()=>r,f:()=>s,l:()=>i,s:()=>n});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),i=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(i||{}),n=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(n||{}),r=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(r||{})},46520:(e,t,a)=>{a.r(t),a.d(t,{ArcgisWebMappingAssistant:()=>P});var s=a(73679),i=a(4395),n=a(66228),r=a(73801),o=a(36486),l=a(85643),c=a(47640),d=a(47207),u=a(81734),p=a(29614),m=a(30161),h=a(70169),y=a(59640),g=a(5077),f=a(42411),w=a(2156),b=a(66617),v=a(49851),x=a(10628),T=a(75054),S=a(64451),I=a(85681),$=a(6176),R=a(94916),z=a(44345),O=a(588);const q=({portal:e})=>{if(window.customElements?.get("arcgis-user-avatar")&&e?.user)return i.qy`<arcgis-user-avatar class="avatar-user" .user=${e.user} .portal=${e}></arcgis-user-avatar>`;const t=e?"user":"effects";return i.qy`<div class=${(0,r.CP)("avatar "+(e?"avatar-portal":"avatar-bot"))}><calcite-icon class="avatar-icon" .icon=${t} scale=s></calcite-icon></div>`};async function N(e){const{fields:t,layer:a,view:s,styleName:i,colorSchemeTags:n}=e;let{theme:r}=e,o=t[1];const l=t[0];let c;return"compare"===i&&(o=t[1],r="above-and-below"),n&&(c=(0,m.getSchemesByTag)({geometryType:a.geometryType,includedTags:n,theme:r||"high-to-low"})[0]),{layer:a,view:s,field:l,normalizationField:o,theme:r,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:c}}async function k(e){return await(0,p.createContinuousRenderer)(e)}function C(e,t){t&&function(e,t){e.renderer=t}(e,t)}async function A(e){const t=e.styleName;let a,s;if("color"===t)a=await N(e),s=await k(a);else if("type"===t)a=await async function(e){const{fields:t,layer:a,view:s,colorSchemeTags:i}=e;console.log("processTypeRendererParams",e);const n=t[0];let r;return i&&(r=(0,u.getSchemesByTag)({geometryType:a.geometryType,includedTags:i})[0]),{layer:a,view:s,field:n,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,typeScheme:r}}(e),s=await async function(e){return await(0,d.createRenderer)(e)}(a);else if("color-age"===t)a=await async function(e){const{fields:t,layer:a,view:s,theme:i,colorSchemeTags:n}=e,r=t[0];let o;return n&&(o=(0,m.getSchemesByTag)({geometryType:a.geometryType,includedTags:n,theme:i||"high-to-low"})[0]),{layer:a,view:s,startTime:r,endTime:new Date,theme:i,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:o}}(e),s=await async function(e){return await(0,p.createAgeRenderer)(e)}(a);else if("size"===t)a=function(e){const{fields:t,layer:a,view:s,styleName:i}=e;console.log("processSizeRendererParams",e);let{theme:n}=e,r=t[1];const o=t[0];return"compare"===i&&(r=t[1],n="above-and-below"),{layer:a,view:s,field:o,normalizationField:r,theme:n,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}(e),s=await async function(e){return await(0,R.createContinuousRenderer)(e)}(a);else if("size-age"===t)a=function(e){const{fields:t,layer:a,view:s,theme:i}=e;return{layer:a,view:s,startTime:t[0],endTime:new Date,theme:i,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}(e),s=await async function(e){return await(0,R.createAgeRenderer)(e)}(a);else if("color-size-univariate"===t)a=await async function(e){const{fields:t,layer:a,view:s,colorSchemeTags:i,theme:n}=e;let r;const o=t[0];return i&&(r=(0,m.getSchemesByTag)({geometryType:a.geometryType,includedTags:i,theme:n||"high-to-low"})[0]),{layer:a,view:s,field:o,normalizationField:void 0,theme:n,colorOptions:{colorScheme:r}}}(e),s=await async function(e){return await(0,f.createContinuousRenderer)(e)}(a);else if("heatmap"===t)a=await async function(e){const{fields:t,layer:a,view:s,colorSchemeTags:i}=e;let n;const r=t[0];return i&&(n=(0,x.getSchemesByTag)({includedTags:i,basemap:s.map?.basemap||"topo"})[0]),{layer:a,view:s,field:r,heatmapScheme:n}}(e),s=await async function(e){return await(0,v.createRenderer)(e)}(a);else if("dot-density"===t)a=await async function(e){const{fields:t,layer:a,view:s,colorSchemeTags:i}=e;let n;return i&&(n=(0,b.getSchemesByTag)({includedTags:i,numColors:Math.min(t.length,8)})[0]),{layer:a,view:s,legendOptions:{unit:"units"},attributes:t.map(e=>({field:e,label:a.fields.find(t=>t.name===e)?.alias??""})).slice(0,8),outlineOptimizationEnabled:!0,dotDensityScheme:n}}(e),s=await async function(e){return await(0,w.createRenderer)(e)}(a);else if("relationship"===t)a=await async function(e){const{fields:t,layer:a,view:s,colorSchemeTags:i}=e;let n;const r={field:t[0]},o={field:t[1]};return i&&(n=(0,$.getSchemesByTag)({geometryType:a.geometryType,includedTags:i})[0]),{layer:a,view:s,field1:r,field2:o,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,relationshipScheme:n}}(e),s=await async function(e){return await(0,I.createRenderer)(e)}(a);else if("compare"===t)a=await N(e),s=await k(a);else if("predominance"===t||"predominance-size"===t)a=await async function(e){const{fields:t,layer:a,view:s,styleName:i,colorSchemeTags:n}=e;let r;return n&&(r=(0,S.getSchemesByTag)({geometryType:a.geometryType,includedTags:n,numColors:Math.min(t.length,10)})[0]),{layer:a,view:s,fields:t.map(e=>({name:e})).slice(0,9),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:i.includes("Size"),predominanceScheme:r}}(e),s=await async function(e){return await(0,T.createRenderer)(e)}(a);else{if("chart"!==t&&"chart-size"!==t)throw new Error(`Unsupported style: ${t}`);a=await async function(e){const{fields:t,layer:a,view:s,styleName:i,colorSchemeTags:n}=e;let r;return r=n?(0,y.getSchemesByTag)({basemapTheme:await(0,g.getBackgroundColorTheme)(s),geometryType:a.geometryType,includedTags:n,numColors:Math.min(t.length,8)})[0]:(0,y.getSchemes)({basemapTheme:await(0,g.getBackgroundColorTheme)(s),geometryType:a.geometryType,numColors:Math.min(t.length,8)}).primaryScheme,{layer:a,view:s,attributes:t.map(e=>({field:e,label:a.fields.find(t=>t.name===e)?.alias??""})).slice(0,8),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:i.includes("Size"),pieChartScheme:r}}(e),s=await async function(e){return await(0,h.createRenderer)(e)}(a)}return s}const E={"layer styling":(e,t=[])=>function(e,t){return`\n  You are an AI assistant for Esri ArcGIS Online Smart Mapping. Your role is to analyze user input and generate a structured JSON response recommending fields, style, theme, color scheme, and action for map visualization. Follow these strict rules for every response:\n\n  Given the user input: ${e} and a list of available fields: ${JSON.stringify(t)},\n\n  General Response Structure:\n  Return an array of JSON objects. Each object must have:\n  - "fields": Array of valid field names (not aliases). Must be an array.\n  - "style": Mapping style (or null).\n  - "theme": Theme (or null).\n  - "color_schemes": Array of color scheme names (or null).\n  - "action": "create" or "update".\n  - "message": Short, user-friendly explanation.\n\n  Step 1: Field Selection\n  - If user specifies fields, use only those (must match provided metadata exactly, not aliases).\n  - If not specified, select 3 interesting and semantically relevant fields from metadata (avoid IDs).\n  - Do not select unrelated fields even if data type matches.\n\n  Step 2: Style Selection\n  - If user specifies a style, use it only if it matches the selected fields\u2019 data types and count (see style rules below). If not compatible, set "style": null.\n  - If style is not specified, set "style": null.\n  - Do not infer or assign a style unless explicitly mentioned.\n\n  Step 3: Theme Selection\n  - If user specifies a theme, use it (must be one of: high-to-low, above, below, centered-on, above-and-below, extremes).\n  - If not specified, set "theme": null.\n\n  Step 4: Color Scheme Selection\n  - If user requests a color scheme, use up to two matching values from: reds, yellows, oranges, greens, blues, purples, pinks, browns, grays, subdued, diverging, sequential, categorical.\n  - If not specified, set "color_schemes": null.\n\n  Step 5: Action\n  - Set "action" to "create" if user asks for a new style, or "update" if modifying an existing style.\n\n  Strict Rules:\n  - Never use aliases or inferred field names.\n  - Never assign a style, theme, or color scheme unless explicitly requested or compatible.\n  - If user input is unrelated to mapping, return a single object with all fields set to null and a polite message.\n  - If style/fields are incompatible, set "style": null but retain fields.\n  - Always validate field count and types for the selected style.\n  - If multiple valid outputs, return multiple JSON objects.\n\n  Style Rules (summarized):\n  - "type": 1 string/number/date field.\n  - "type-size": 1 string/number + 1 number field.\n  - "color": 1 number field (optionally normalized by another number).\n  - "color-classed": 1 number field (optionally normalized).\n  - "color-age": 1+ date fields.\n  - "size": 1 number field (optionally normalized).\n  - "size-classed": 1 number field (optionally normalized).\n  - "size-age": 1+ date fields.\n  - "color-size": 2 number fields.\n  - "color-size-univariate": 2 number fields.\n  - "color-size-age": 1+ date fields.\n  - "color-age-size": 1+ date fields.\n  - "heatmap": 0 or 1 number field (points only).\n  - "dot-density": 2-8 number fields (polygons only).\n  - "relationship": 2 number fields.\n  - "relationship-size": 3 number fields.\n  - "compare": 2 number fields.\n  - "predominance": 2-10 number fields.\n  - "predominance-size": 2-10 number fields.\n  - "chart": 2-8 number fields.\n  - "chart-size": 2-8 number fields.\n\n  Example Output:\n  User input: "Show carbon storage above and below average in red."\n  Response:\n  [\n    {\n      "fields": ["C_Storage"],\n      "style": "color",\n      "theme": "above-and-below",\n      "color_schemes": ["reds"],\n      "action": "create",\n      "message": "Created a color map for carbon storage using an above-and-below theme with a red color scheme."\n    }\n  ]\n  `}(e,t),popups:e=>`Add a popup showing attribute values when clicking a feature. User input: ${e}`,labels:e=>`Enable labels to show feature values directly on the map. User input: ${e}`,filter:e=>`Apply a filter to show only features matching certain criteria. User input: ${e}`,aggregation:e=>`Aggregate features to visualize summaries like count or average. User input: ${e}`},_="http://ai-assistant.eastus.cloudapp.azure.com//skills/web_mapping_assistant/chat";async function j(e,t,a,s){const{text:i}=a;if(![200,902].includes(s.dataObject.httpResponseCode))return s.message=s.dataObject.message,s.status="error",console.log("*** question/response: ",JSON.stringify({question:i,responseObj:s})),[s];const{styleActions:n}=s.dataObject;if(!Array.isArray(n))return console.warn("Expected styleActions to be an array."),[s];const r=[];for(const a of n){if("invalid"===s.dataObject.actionType||"invalid"===a.style&&null===a.action){r.push({...s,message:a.message,status:"valid",dataObject:{...s.dataObject,styleActions:n}});continue}const i=a.style;let o;a.theme&&(o=a.theme.trim().toLowerCase().replace(/["';:]/gu,"").replace(/theme/gu,"").trim().replace(/ /gu,"-"),"none"===a.theme.toLowerCase()&&(o=void 0));const l=a.fields,c=[a.color_schemes];try{const d=await A({styleName:i,fields:l,theme:o,layer:e,view:t,colorSchemeTags:c});C(e,d.renderer),r.push({...s,message:`${a.message} Here's a ${i} map.`,status:"valid",renderer:d.renderer,rendererFields:l,dataObject:{...s.dataObject,styleActions:n}})}catch(e){r.push({...s,message:`I'm sorry. There was an error: ${e.message}`,status:"error",dataObject:{...s.dataObject,styleActions:n}})}}return r}async function F(e,t,a){const s=[];for(const{action:i,layer:n,partialInput:r}of a){if(!E[i]){console.warn(`No prompt defined for action: ${i}`);continue}const a=e.find(e=>e.title===n);if(!a){console.warn(`Layer with title "${n}" not found in allLayers.`);continue}const o=a;console.log(o.fields);const l={message:r,context:{kind:"WebMappingAssistantRequest",context:{stage:"action_router",target:n,fields:o.fields,action:i}}};try{const e=await(0,z.default)(_,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(l),responseType:"json"});if(200!==e.httpStatus){const t=e.data?.message||JSON.stringify(e.data);throw new Error(`Initial action stage error: ${t}`)}const a=e.data;let i=a.sequenceNumber;const n=a.conversationId,r=a.inquiryId;if(a?.context?.actionsRouter){s.push({action:a.context.actionsRouter.action,color_schemes:a.context.actionsRouter.colorSchemes,fields:a.context.actionsRouter.fields,message:a.context.actionsRouter.message,theme:a.context.actionsRouter.theme,style:a.context.actionsRouter.style});continue}for(;a.hasMore;){const e={conversationId:n,inquiryId:r,ackSequenceNumber:i},a=(await(0,z.default)(_,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e),responseType:"json"})).data;if(a?.context?.actionsRouter){s.push({action:a.context.actionsRouter.action,color_schemes:a.context.actionsRouter.colorSchemes,fields:a.context.actionsRouter.fields,message:a.context.actionsRouter.message,theme:a.context.actionsRouter.theme,style:a.context.actionsRouter.style});break}if(!a.hasMore)break;i=a.sequenceNumber,await new Promise(e=>setTimeout(e,1e3))}}catch(e){console.error(`Polling failed for ${i} on ${n}:`,e)}}return s}const L=i.AH`.avatar{border-radius:50%;width:30px;min-width:30px;height:30px;display:flex;justify-content:center}.avatar-user{min-width:var(--calcite-size-32)}.avatar-portal{background-color:var(--calcite-color-foreground-2)}.avatar-bot{background-color:#dcf2f4}.avatar-icon{vertical-align:middle;height:100%}.web-mapping-assistant-panel{padding:var(--calcite-spacing-md);height:100vh;background-color:var(--calcite-color-background)}.restart-button{margin-right:var(--calcite-spacing-sm)}.disclaimer{display:flex;gap:var(--calcite-spacing-sm)}.disclaimer-icon{display:flex}.disclaimer-text{font-size:var(--calcite-font-size-sm)}.chat-question-container{display:flex;align-items:center;justify-content:flex-end;gap:var(--calcite-spacing-sm);margin:var(--calcite-spacing-sm) 0}.chat-bubble{background-color:var(--calcite-color-foreground-2);border-radius:var(--calcite-corner-radius-round);padding:var(--calcite-spacing-sm) var(--calcite-spacing-md);display:flex;align-items:center;max-width:80%;color:var(--calcite-color-text-1)}.question-text{flex:1;font-weight:var(--calcite-font-weight-light)}.copy-icon{margin-left:var(--calcite-spacing-sm);cursor:pointer;color:var(--calcite-color-neutral-blk-140)}.chat-response.multiple{display:flex;align-items:flex-start;gap:var(--calcite-spacing-md);margin:var(--calcite-spacing-md) 0}.tile-content{max-width:100%;display:flex;flex-direction:column}.generate-buttons{display:flex;justify-content:flex-end;align-items:center;gap:var(--calcite-spacing-xxs);margin:var(--calcite-spacing-md) 0}`;class P extends r.WF{constructor(){super(...arguments),this.textAreaNode=(0,l._)(),this.messagesNode=(0,l._)(),this.chat=[],this._messages=(0,o.u)({blocking:!0}),this._propWatcherTask=new c.YZ(this,{task:async([e,t])=>{if(!(0,n.i)(e)||!(0,n.i)(t))throw console.error("[arcgis-web-mapping-assistant] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,this.init()},args:()=>[this.layer,this.mapView]}),this.loading=!1}static{this.properties={loading:16,activeRendererIdx:16,activeInnerTileIdx:16,portal:0,mapView:0,layer:0}}static{this.styles=L}get portalUrl(){if(!this.portal)throw new Error("Portal is required but was not provided.");return this.portal.url}init(){const{mapView:e,layer:t}=this;if("feature"!==t.type)throw new Error("layer is not a FeatureLayer");e?.map||(this.loading=!1)}isTileSelected(e,t){return this.activeRendererIdx===e&&this.activeInnerTileIdx===t}handleTileSelect(e,t){this.activeRendererIdx=e,this.activeInnerTileIdx=t;const a=this.chat[e][t].renderer;a&&C(this.layer,a)}handleFieldsChange(e,t,a){const s=this.chat[t][a];s.finalSelectedFields=e;const i=s.dataObject.styleActions[0]?.style;if(!i)return;A({styleName:i,fields:e,layer:this.layer,view:this.mapView}).then(e=>{s.renderer=e.renderer,C(this.layer,e.renderer),this.activeRendererIdx=t,this.activeInnerTileIdx=a,this.requestUpdate()})}async handleSubmit(){const e={styleName:"color",fields:["M172_07"],theme:"above-and-below",layer:this.layer,view:this.mapView,colorSchemeTags:["reds"]},t=await N(e);console.log("Style Params:",t);const a=await k(t);console.log("Renderer created:",a.renderer),C(this.layer,a.renderer)}async handleGenerate(){const{textAreaNode:{value:e},chat:t}=this,a=e.value;if(!a)return;t.push({text:a,type:"question"}),this.loading=!0,this._scrollTo(),e.value="";const s={text:a},i=await async function(e){const{token:t}=await O.default.getCredential(e);return t}(`${this.portalUrl}/generateToken`),n=await async function(e,t,a){const s={message:e,context:{kind:"WebMappingAssistantRequest",context:{stage:"intent",layers:a}}};try{const e=await(0,z.default)(_,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s),responseType:"json"});if(200!==e.httpStatus){const t=e.data?.message||JSON.stringify(e.data);throw new Error(`Error ${e.httpStatus}: ${t}`)}const i=e.data;let n=i.sequenceNumber;const r=i.conversationId,o=i.inquiryId;for(;i.hasMore;){const e={conversationId:r,inquiryId:o,ackSequenceNumber:n},s=(await(0,z.default)(_,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e),responseType:"json"})).data;if(s?.context?.actionsList){console.log("Parsed actionsList:",s.context.actionsList);const e=s.context.actionsList;if(!a)throw new Error("allLayers is undefined");return{actionType:"map_style",styleActions:await F(a,t,e.actions),httpResponseCode:200}}if(!s.hasMore)break;n=s.sequenceNumber,await new Promise(e=>setTimeout(e,1e3))}return console.warn("actionsList not found after polling"),{actionType:"invalid",styleActions:[],message:"No actionsList found after polling.",httpResponseCode:400}}catch(e){return console.error("submitIntentStageQuestion failed:",e),{actionType:"invalid",styleActions:[],message:e.message||"Unknown error",httpResponseCode:500}}}(a,i,this.mapView?.map?.allLayers.toArray().filter(e=>"feature"===e.type)),r=n.styleActions.map(e=>({message:e.message,status:"map_style"===n.actionType?"valid":"invalid",type:"response",dataObject:{...n,styleActions:[e]}}));if(console.log("Response List:",r),!this.loading)return;const o=[];for(const e of r){if("valid"!==e.status){t.push([e]);continue}e.dataObject.httpResponseCode=200;const a=await j(this.layer,this.mapView,s,e);o.push(...a)}if(o.length){this.chat.push(o);const e=this.chat.length-1,t=0;this.activeRendererIdx=e,this.activeInnerTileIdx=t;const a=o[0].renderer;a&&C(this.layer,a)}this.loading=!1,this._scrollTo()}_scrollTo(){const{textAreaNode:{value:e},messagesNode:{value:t}}=this;setTimeout(()=>{t?.scrollTo(0,t.scrollHeight)},300),setTimeout(()=>{e?.setFocus(),t?.scrollTo(0,t.scrollHeight)},500)}render(){return this._propWatcherTask.render({complete:()=>i.qy`<calcite-panel class="assistant-panel" .heading=${this._messages.webMappingAssistant} closable><div class="web-mapping-assistant-panel">${this.renderContent()}${this.renderDisclaimer()}</div></calcite-panel>`})}renderContent(){const{chat:e,loading:t}=this;return e.length||t?this.renderGeneratedContent():this.renderInitialContent()}renderInitialContent(){return i.qy`<div class="content content-initial"><calcite-icon icon=effects></calcite-icon><div class="title">Ask a question</div>${this.renderInput()}</div>`}renderGeneratedContent(){const{chat:e,loading:t}=this;return i.qy`<div class="content content-generated"><div class="messages" ${(0,l.K)(this.messagesNode)}>${e.map((e,t)=>this.renderChatMessage(e,t))}${t&&i.qy`<div class="message-loader"><svg version=1.1 id=message-loader xmlns=http://www.w3.org/2000/svg x=0px y=0px viewBox="0 0 100 100" enable-background="new 0 0 0 0">${i.JW`<circle fill=#000 stroke=none cx=6 cy=50 r=6><animate attributeName=opacity dur=1s values=0;1;0 repeatCount=indefinite begin=0.1 /></circle><circle fill=#000 stroke=none cx=26 cy=50 r=6><animate attributeName=opacity dur=1s values=0;1;0 repeatCount=indefinite begin=0.2 /></circle><circle fill=#000 stroke=none cx=46 cy=50 r=6><animate attributeName=opacity dur=1s values=0;1;0 repeatCount=indefinite begin=0.3 /></circle>`}</svg></div>`||""}</div><div class="bottom-input">${this.renderInput()}</div></div>`}renderChatMessage(e,t){return Array.isArray(e)?i.qy`<div class="message" data-value=${t??r.s6}>${this.renderResponse(e,t)}</div>`:i.qy`<div class="message" data-value=${t??r.s6}>${this.rendererQuestion(e)}</div>`}rendererQuestion(e){return i.qy`<div class="chat-question-container"><div class="chat-bubble"><span class="question-text">${e.text}</span><calcite-icon icon=duplicate scale=s class="copy-icon" @click=${()=>navigator.clipboard.writeText(e.text)}></calcite-icon></div>${q({portal:this.portal})}</div>`}renderResponse(e,t){const{activeRendererIdx:a,activeInnerTileIdx:s}=this,n=a===t&&"number"==typeof s?e[s]:null;return i.qy`<div class="chat-response multiple">${q({})}<div class="tile-content">${n?.message&&i.qy`<div class="selected-message">${n.message}</div>`||""}<div class="tile-list">${e.map((e,a)=>e.dataObject.styleActions.map(s=>e.renderer?this.renderStyleTile(e,s,t,a):i.qy`<div class="response">${e.message}</div>`))}</div></div></div>`}renderStyleTile(e,t,a,s){const n=this.layer.fields,r=this.layer.geometryType?.toLowerCase();return i.qy`<div class="chat-response"><arcgis-web-mapping-assistant-tile .type=${t.style} .geometryType=${r} .fields=${n.map(e=>({layerField:{name:e.name,alias:e.alias||e.name,type:e.type},simpleFieldType:e.type}))} .selectedFieldsList=${e.rendererFields} .selected=${this.isTileSelected(a,s)} @arcgisSelect=${()=>this.handleTileSelect(a,s)}><arcgis-web-mapping-assistant-selected-fields .styleName=${t.style} .fields=${n.map(e=>({layerField:{name:e.name,alias:e.alias||e.name,type:e.type},simpleFieldType:e.type}))} .selectedFieldsList=${e.rendererFields} .selectedFields=${e.finalSelectedFields??e.rendererFields} ._messages=${this._messages} @arcgisSelectedFieldsChange=${e=>{this.handleFieldsChange(e.detail,a,s)}}></arcgis-web-mapping-assistant-selected-fields></arcgis-web-mapping-assistant-tile><calcite-icon icon=thumbs-up></calcite-icon><calcite-icon icon=thumbs-down></calcite-icon></div>`}renderInput(){const{chat:e,_messages:t}=this;return i.qy`<calcite-text-area .disabled=${this.loading} class="text-input" .placeholder=${t.placeholder} value scale=s resize=vertical rows=3 ${(0,l.K)(this.textAreaNode)}></calcite-text-area><div class="generate-buttons">${!!e.length&&i.qy`<calcite-button class="restart-button" slot=footer icon-start=refresh .label=${t.restart} appearance=transparent width=auto @click=${()=>this.handleSubmit()}>Restart</calcite-button>`||""}<calcite-button .disabled=${this.loading} class="generate-button" slot=footer icon-start=effects .label=${t.generate} appearance=solid width=auto round @click=${()=>this.handleGenerate()}>Generate</calcite-button></div>`}renderDisclaimer(){const{_messages:e}=this;return i.qy`<div class="disclaimer"><div class="disclaimer-icon"><calcite-icon class="disclaimer-icon" icon=information scale=s></calcite-icon></div><div class="disclaimer-text">${e.disclaimer}<calcite-link>${e.disclaimerTerms}</calcite-link></div></div>`}}(0,s.c)("arcgis-web-mapping-assistant",P)},47640:(e,t,a)=>{a.d(t,{YZ:()=>r,e1:()=>i});var s=a(4836);const i={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},n=Symbol();class r{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,a){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:a};this.v=s.task,this.j=s.args,this.m=s.argsEqual??o,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,a;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let i=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){i=!0,a=e}if(this.p===s){if(t===n)this.i=0;else{if(!1===i){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(a)}catch{}this.i=3,this.h?.(a)}this.u=t,this.l=a}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,a)=>!(0,s.Ec)(e,t[a]))},66228:(e,t,a)=>{a.d(t,{a:()=>w,b:()=>R,c:()=>N,d:()=>$,e:()=>z,f:()=>C,g:()=>g,h:()=>f,i:()=>h,j:()=>y,k:()=>x,l:()=>k,m:()=>S,n:()=>p,o:()=>T,p:()=>_,q:()=>q,r:()=>E,s:()=>v,t:()=>I,u:()=>b});var s=a(63438),i=a(18423),n=a(96086),r=a(91813),o=a(21255),l=a(13078),c=a(21303),d=a(12627),u=a(42855);const p=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],m=["feature"];function h(e){return null!=e}function y(e,t,a){const s=t.fieldName;if(s.includes(u.f.expression)){const e=a.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function g(e){return new Map((await x(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function f(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const a=`${u.f.expression}${e.name}`;t.set(a,e)}),t}function w(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function b(e){const t=w(e);let a;return t===u.s.wms||t===u.s.mapImage?a=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(a=e.version),Number.parseFloat(a)}function v(e){return"fieldConfigurations"in e&&m.includes(e.type)}async function x(e){return await new Promise((t,a)=>{switch(w(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const s=e,i=s?.layer;i?.portalItem&&i.url.includes("https://demographics")&&i.url.includes(".arcgis.com")?i.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const a=new Map(s.fields.map(e=>[e.name,e])),i=e.thematicGroup.fieldNames,n=[];i.forEach(e=>{a.has(e)&&n.push(a.get(e))}),t(n)}else t(s.fields)}).catch(e=>{a(new Error(e))}):t(s.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function T(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function S(e){return Number((100*(1-e)).toFixed(1))}function I(e){return Number((1-e/100).toFixed(3))}const $=(e,t)=>{const a=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||a.push({name:e.fieldName,alias:e.label,type:"string"})}),a},R=async(e,t)=>{const a=new d.default;return a.geometry=t.extent,a.mapExtent=t.extent,a.returnGeometry=!0,a.tolerance=6,a.layerOption="popup",a.width=t.width,a.height=t.height,a.layerIds=[e.id],(await c.identify(e.layer.url,a))?.results?.[0]?.feature},z=async(e,t,a)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await O(a,s.features?.[0])},O=async(e,t)=>{let a;if(t)a=t.clone();else{a=new s.default;const t=$(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),a.attributes=e}const n=new i.default;a.geometry=n}return a};function q(e,t){const a=t.startsWith("#"),s=t.startsWith(".");for((s||a)&&(t=t.slice(1));e;){if(a){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function N(e){if(w(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function k(e,t,a){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const a=t.get(e);s=a.type?a.type.toLowerCase():""}else if(a.has(e)){const t=a.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function C(e,t){try{const a=w(e);if(a===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await R(e,t)||await A(e,t)]};if(a===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await A(e,t)]};const s=a===u.s.ogcFeature||a===u.s.stream?await t.whenLayerView(e):e,i=s.createQuery();i.where=s.definitionExpression||"1=1",i.outFields=["*"],i.returnM="hasM"in e&&e.hasM,i.returnZ="hasZ"in e&&e.hasZ,i.outSpatialReference=t.spatialReference,i.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||a===u.s.ogcFeature)&&(i.start=0,i.num=1),i.outSpatialReference=t.spatialReference;const n=await s.queryFeatures(i);return n?.features?.length||(n.features[0]=await A(e,t)),n}catch(e){console.error(e)}}async function A(e,t){return await new Promise(a=>{const i=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),i.attributes=t}const c=t.extent;let d;"polygon"===e.geometryType?d=o.default.fromExtent(c):"point"===e.geometryType?d=c.center.clone():"multipoint"===e.geometryType?d=new n.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(d=new r.default({spatialReference:t.spatialReference.clone()}),d.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(d=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),i.geometry=d,a(i)})}function E(e){return w(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function _(e){return w(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);