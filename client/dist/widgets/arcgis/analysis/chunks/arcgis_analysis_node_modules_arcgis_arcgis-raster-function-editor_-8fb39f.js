"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-8fb39f"],{38987:(e,t,a)=>{a.d(t,{R:()=>b});var i=a(92265),l=(a(5294),a(13661),a(18423),a(21255),a(35431),a(69843)),s=a(38949),r=a(85740),n=a(33797),c=a(42335),d=(a(588),a(71802),a(44345),a(36596),a(23795),a(17902),a(56451),a(47453)),h=(a(33752),a(19956));const o="rfx-cte-weighted-overlay-table-editor",u={colorRed:`${o}__color-red`,grid:`${o}__grid`,layerColumn:`${o}__layer-column`,influenceColumn:`${o}__influence-column`,fieldColumn:`${o}__field-column`,valueColumn:`${o}__value-column`,scaleColumn:`${o}__scale-column`},g="weightedOverlayTableHelpClickHandler",f="remapTableHelpClickHandler",p="scalesHelpClickHandler",m=[{key:"1-3",label:"1-3"},{key:"1-5",label:"1-5"},{key:"1-7",label:"1-7"},{key:"1-9",label:"1-9"},{key:"1-10",label:"1-10"},{key:"1-20",label:"1-20"},{key:"1-25",label:"1-25"},{key:"1-50",label:"1-50"},{key:"1-75",label:"1-75"},{key:"1-100",label:"1-100"}],v={influence:{numberType:h.N.INTEGER,min:0,max:100},layer:{required:!0}},b=class{constructor(e){(0,i.r)(this,e),this.rfxArgumentChange=(0,i.c)(this,"rfxArgumentChange"),this.helpActionClickEventHandlers=new Map,this.scalesOptions=m,this.weightedOverlayGridSchema={canAdd:!0,gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,hasIdColumn:!0},this.remapsGridSchema={canAdd:!0,gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,hasIdColumn:!0},this.sumOfInfluence=0,this.refreshRemapsGrid=()=>{const e=this.getRemapGridData();(0,s.i)(e)||(this.remapsGridSchema={...this.remapsGridSchema,gridOptions:e})},this.handleGridRowClick=e=>{const{detail:{gridOptions:t,rowIndex:a}}=e;a<0||a>t?.length-1||(this.selectedRowId=a,this.refreshRemapsGrid())},this.updateValue_weightedOverlayTable=async e=>{const{detail:{gridOptions:t,rowIndex:a,columnName:i}}=e,l=this.inputArgs;if((0,s.i)(t)||(0,s.i)(l))return;const r=[],n=[],c=[];let h=0,o=!1,u=!1,g=!1;t.forEach((e,a)=>{if(a===t.length-1)return;const{layer:i,influence:l,field:o}=e;if((0,s.i)(i)||(0,s.i)(o))return;r.push(i),c.push(o);let u=(0,d.p)(l);((0,s.i)(u)||isNaN(u))&&(u=0===a?100:0),h+=u,n.push(u/100)}),h!==this.sumOfInfluence&&(o=!0,this.updateSumOfInfluenceElement(h)),u="layer"===i,g="field"===i;const f=l.Rasters,p=l.Influences,m=l.Fields,v=l.Remaps;let b;if(g&&m.value?.[a]===c[a]&&(g=!1),(0,s.i)(f.value)?f.value={elements:r,type:"ArgumentArray"}:f.value.elements=r,p.value=n,m.value=c,t.length>this.weightedOverlayGridOptionsLength?b=t[a]:t.length<this.weightedOverlayGridOptionsLength?(this.deleteLayerRemapStr(a),this.selectedRowId=a+1):t.length===this.weightedOverlayGridOptionsLength&&(o||(b=t[a])),v?.value&&(u&&b?.layer||g)){this.selectedRowId=a;const e=t.length-1;await this.initLayerRemapStr(b,a,e)}this.refreshRemapsGrid(),this.weightedOverlayGridOptionsLength=t.length},this.updateValue_remapTable=e=>{const{detail:{gridOptions:t}}=e,a=this.inputArgs;if((0,s.i)(t)||(0,s.i)(a))return;const i=a.Remaps,l=i?.value?.length;if((0,s.i)(l)||l<1||this.selectedRowId<0||this.selectedRowId>l-1)return;let r="";const n=t.length-1;t.forEach(function(e,t){const{value:a,scale:i}=e;if(!(0,s.i)(a)&&!(0,s.i)(i?.value)){let e=a;const l=i.value;"string"==typeof a&&(e=a.indexOf(" ")>-1?"'"+a+"'":a),r+=e+" "+l,t<n-1&&(r+=" ; ")}}),i.value[this.selectedRowId]=r},this.updateValue_scales=async e=>{e.stopPropagation();const t=e.target.value.replace(/\s/g,"").split("-");if(2!==t.length)return;const a=parseInt(t[0],10),i=parseInt(t[1],10);if(isNaN(a)||isNaN(i)||a>i)return;this.evalScales={evalFrom:a,evalTo:i},this.inputArgs.EvalFrom.value=a,this.inputArgs.EvalTo.value=i;const l=this.selectedRowId,s=this.weightedOverlayGridSchema.gridOptions?.[l],r=this.weightedOverlayGridSchema.gridOptions?.length;await this.initLayerRemapStr(s,l,r),this.refreshRemapsGrid()}}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,i.d)(".")));const{inputArgs:e,inputLayers:t}=this.widgetArgs;this.inputArgs=e,this.inputLayers=t,this.initScalesSelectOptions(),await this.initGrids()}componentDidLoad(){this.attachHelpClickEventHandlers()}async checkValidity(){return await this.gridElement.checkValidity()}attachHelpClickEventHandlers(){const e=this.widgetArgs.onHelpActionClick({heading:this.strings.weightedOverlayTable,referenceElement:this.weightedOverlayTableLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_weightedoverlaytable});this.helpActionClickEventHandlers.set(g,e);const t=this.widgetArgs.onHelpActionClick({heading:this.strings.remapTable,referenceElement:this.remapTableLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_remaptable});this.helpActionClickEventHandlers.set(f,t);const a=this.widgetArgs.onHelpActionClick({heading:this.strings.scales,referenceElement:this.scalesLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_scales});this.helpActionClickEventHandlers.set(p,a)}async getSelectedLayer(e){const t=(0,r.b)(e),a=this.inputLayers.find(e=>e.url===t);return a&&await a.load(),a}getScaleOptions(){const e=[];for(let t=this.evalScales.evalFrom;t<=this.evalScales.evalTo;t++)e.push({key:t.toString(),label:t.toString()});return e.push({key:"NODATA",label:"NODATA"}),e.push({key:"RESTRICTED",label:"RESTRICTED"}),e}getDefaultGridOption_weightedOverlayTable(){return{id:0,layer:void 0,field:void 0,influence:0}}getDefaultGridOption_remapTable(){return{id:0,value:void 0,scale:{options:this.getScaleOptions(),value:void 0}}}getRemapGridData(){const e=this.inputArgs?.Remaps,t=this.selectedRowId,a=[];if(t<0||t>e?.value?.length-1)return a;if(e?.value?.[t]){e.value[t].split(";").forEach((e,t)=>{const i=e.trim().match(/(?:[^\s']+|'[^']*')+/g);if((0,s.i)(i)||2!==i.length)return;let l=i[0];const r=i[1];l.indexOf("'")>-1&&(l=l.replace(/[']+/g,"")),a.push({id:t,value:l,scale:{options:this.getScaleOptions(),value:r}})});const i=a.length;a.push({id:i,value:void 0,scale:{options:this.getScaleOptions(),value:void 0}})}else a.push(this.getDefaultGridOption_remapTable());return a}async readArgValues(){if((0,s.i)(this.inputArgs))return;const e=this.inputArgs,t=[],a=e.Rasters,i=e.Fields,l=e.Influences,n=e.Remaps,c=a?.value?.elements??a?.value??[];let d=[],h=0,o=0;if((0,s.i)(a)||(0,s.i)(i)||(0,s.i)(l)||(0,s.i)(n)||(h=Math.max(c?.length||0,i.value?.length||0,l.value?.length||0,n.value?.length||0),n.value=n.value??[]),0===h||isNaN(h))return t.push(this.getDefaultGridOption_weightedOverlayTable()),d.push(this.getDefaultGridOption_remapTable()),[t,d];for(;o<h;){const e=c?.[o],a=e?.value;(0,s.i)(a?.url)||(e.value=await(0,r.w)(a,this.inputLayers)),t.push({id:o,rasterElement:e,layer:e,field:i?.value?.[o],influence:(l?.value?.[o]&&((100*l.value[o]).toFixed(2)||(o>0?0:100)))??0}),o+=1}if(n?.value?.length>0)t?.length>0&&t[0]?.layer&&t[0]?.field&&(this.selectedRowId=0,d=this.getRemapGridData());else for(let e=0;e<h;e++)n.value.push("");return[t,d]}async initGrids(){const e={layer:{allowScalar:!1,label:this.strings.layer,uiType:c.G.raster,style:u.layerColumn,validationRule:v.layer},influence:{label:this.strings.influence,uiType:c.G.number,style:u.influenceColumn,validationRule:v.influence},field:{label:this.strings.field,uiType:c.G.field,style:u.fieldColumn}},t={value:{label:this.strings.value,uiType:c.G.textInput,style:u.valueColumn},scale:{label:this.strings.scale,uiType:c.G.select,style:u.scaleColumn}},a=await this.readArgValues(),i=a[0],l=a[1];this.weightedOverlayGridOptionsLength=(i?.length??0)+1,this.weightedOverlayGridSchema={...this.weightedOverlayGridSchema,gridLayout:e,gridOptions:i},this.remapsGridSchema={...this.remapsGridSchema,gridLayout:t,gridOptions:l}}initScalesSelectOptions(){if((0,s.i)(this.inputArgs))return;const{EvalFrom:e,EvalTo:t}=this.inputArgs,a=e?.value??1,i=t?.value??9;this.evalScales={evalFrom:a,evalTo:i};const l=`${a}-${i}`;this.scalesOptions.some(e=>e.key===l)||this.scalesOptions.push({key:l,label:l})}updateSumOfInfluenceElement(e){this.sumOfInfluence=e,e>100?this.sumOfInfluenceElement.classList.add(u.colorRed):this.sumOfInfluenceElement.classList.remove(u.colorRed)}async initLayerRemapStr(e,t,a){if((0,s.i)(e)||t<0||a<=0||t>a-1)return;const{layer:i,field:l}=e,{evalFrom:r,evalTo:n}=this.evalScales;if((0,s.i)(i)||(0,s.i)(l))return;let c="";if(!(0,s.i)(i.value?.url)){const e=await this.getSelectedLayer(i.value?.url),t=await(e?.generateRasterInfo(e.rasterFunction));if((0,s.i)(e))return;if(e.sourceJSON?.hasRasterAttributeTable&&l){const a=(0,s.u)(e)?e.serviceRasterInfo.attributeTable:t.attributeTable,i=a?.features;if((0,s.i)(i))return;const d=i.map(e=>e.attributes[l]).filter(function(e,t,a){return a.indexOf(e)===t});d?.length>1&&!isNaN(d[0])&&d.sort(function(e,t){return e-t});c=d.map(function(e,t){"string"==typeof e&&(e=e.indexOf(" ")>-1?"'"+e+"'":e);return`${e} ${t+r<=n?t+r:r}`}).join(" ; ")}}const d=t,h=this.inputArgs.Remaps;this.inputArgs.Fields.value.splice(d,1,l),h.value.length===a&&h.value.splice(d,1,c),h.value.length<a&&h.value.splice(d,0,c)}deleteLayerRemapStr(e){this.inputArgs.Remaps.value.splice(e,1)}render(){return(0,i.h)("div",{key:"aebdb0b604e84572eb9a60158ca60d21acd93f3b"},(0,i.h)("calcite-label",{key:"ef9e974492a94cbac6d24e5c732f95a030264e56",alignment:"start",scale:s.s.scale??n.U.Scale,layout:"default",ref:e=>{this.weightedOverlayTableLabelElement=e}},(0,i.h)("rfx-label",{key:"3f859abfea17376f860e95110984b560b3ee3cb7",label:this.strings.weightedOverlayTable,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(g)()}),(0,i.h)("rfx-grid",{key:"7f174f3d27df6d0cc234bfd050b8dd47c596ebe4",canAdd:this.weightedOverlayGridSchema.canAdd,class:u.grid,gridLayout:this.weightedOverlayGridSchema.gridLayout,gridOptions:this.weightedOverlayGridSchema.gridOptions,hasBorder:this.weightedOverlayGridSchema.hasBorder,hasHeader:this.weightedOverlayGridSchema.hasHeader,hasIdColumn:this.weightedOverlayGridSchema.hasIdColumn,inputLayers:this.widgetArgs.inputLayers,onRfxGridRowClick:this.handleGridRowClick,onRfxGridOptionChange:this.updateValue_weightedOverlayTable,rfxBrowseLayerClick:this.widgetArgs.onRfxBrowseLayerClick,ref:e=>{this.gridElement=e}})),(0,i.h)("calcite-label",{key:"0f0ab4ffe79a49826c921c0adf26ebf059db38c4",alignment:"start",scale:s.s.scale??n.U.Scale,layout:"inline-space-between"},(0,i.h)("span",{key:"25b4f500a5bb9a84bebd0eee18478041e1a14239"},this.strings.sumOfInfluence),(0,i.h)("span",{key:"f77a1a89506996fa4f9a12d4c2dc78f9e901518b",ref:e=>{this.sumOfInfluenceElement=e}},this.sumOfInfluence)),(0,i.h)("calcite-label",{key:"12de786a1f18efadaa3f9cdb1edfdf99ce954e87",alignment:"start",scale:s.s.scale??n.U.Scale,layout:"default",ref:e=>{this.remapTableLabelElement=e}},(0,i.h)("rfx-label",{key:"646a21e239bcc2f62c6bbb7f3c8d0430079a7937",label:this.strings.remapTable,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(f)()}),(0,i.h)("rfx-grid",{key:"e9d5e2cce68c95904dc1d55c0691b5f40000e071",canAdd:this.remapsGridSchema.canAdd,class:u.grid,gridLayout:this.remapsGridSchema.gridLayout,gridOptions:this.remapsGridSchema.gridOptions,hasBorder:this.remapsGridSchema.hasBorder,hasHeader:this.remapsGridSchema.hasHeader,hasIdColumn:this.remapsGridSchema.hasIdColumn,onRfxGridOptionChange:this.updateValue_remapTable})),(0,i.h)("calcite-label",{key:"ede5ec53a265c7d90cb5e92d537bc477ea03ac2f",alignment:"start",scale:s.s.scale??n.U.Scale,layout:"default",ref:e=>{this.scalesLabelElement=e}},(0,i.h)("rfx-label",{key:"0ea1f058933ecfbae9087a9eb44c51a31c20dfb2",label:this.strings.scales,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(p)()}),(0,i.h)("rfx-dtex-common-select",{key:"42469b90e91fe3c63f83bb41c0d3745f8d073354",mode:this.widgetArgs.mode,allowCustomValues:!0,options:this.scalesOptions,onRfxArgumentChange:this.updateValue_scales,value:`${this.evalScales.evalFrom}-${this.evalScales.evalTo}`})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,i.a)(this)}};b.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-cte-weighted-overlay-table-editor__grid table{width:100%;table-layout:fixed}.rfx-cte-weighted-overlay-table-editor__grid table thead tr th:first-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table thead tr th:last-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table tbody tr td:first-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table tbody tr td:last-child{width:7%}.rfx-cte-weighted-overlay-table-editor__color-red{color:red}.rfx-cte-weighted-overlay-table-editor__layer-column{width:40%}.rfx-cte-weighted-overlay-table-editor__influence-column{width:16%}.rfx-cte-weighted-overlay-table-editor__field-column{width:30%}.rfx-cte-weighted-overlay-table-editor__scale-column{width:30%}"}}]);