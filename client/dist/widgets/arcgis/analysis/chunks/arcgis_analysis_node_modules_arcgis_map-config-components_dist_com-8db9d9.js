/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-8db9d9.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-8db9d9"],{19268:(e,t,s)=>{s.r(t),s.d(t,{ArcgisMapConfigSketchFeatures:()=>v});var i=s(73679),a=s(4395),r=s(72885),o=s(55535),n=s(22305),c=s(66228),l=s(54312),h=s(41631),p=s(44374),d=s(36486),u=s(85643),g=s(73801),y=s(47640);function m(e){switch(e?.geometry?.type){case"point":return"text"===e?.symbol?.type?"text":"point";case"polyline":return"polyline";default:return"polygon"}}function f(e,t,s){const i=function(e){if(e)return(0,o.b)(e.webmap,!0)||(0,o.b)(e.current,!0)||void 0}(e)||{enabled:!0,selfEnabled:!0,featureEnabled:!0,featureSourcesIds:[t.id]};return new r.default({enabled:i.enabled,selfEnabled:i.selfEnabled,featureEnabled:i.featureEnabled,featureSources:w(s,i.featureSourcesIds)})}function w(e,t){return function(e){const{map:t}=e,s=t?.allLayers?.flatten(e=>"sublayers"in e?e.sublayers:null).filter(e=>!e.isTable);return[...new Set(s?s.toArray():[])]}(e).filter(e=>t.includes(e.id)).map(e=>({layer:e,enabled:!0}))}class k{constructor(e,t,s,i){this.mapNotesLayer=e,this.mapView=t,this.sketchViewModelPoint=new n.default({layer:this.mapNotesLayer.pointLayer??void 0,view:this.mapView,updateOnGraphicClick:!1,snappingOptions:s}),this.sketchViewModelPoint.on("update",e=>i(e)),this.sketchViewModelLine=new n.default({layer:this.mapNotesLayer.polylineLayer??void 0,view:this.mapView,updateOnGraphicClick:!1,snappingOptions:s}),this.sketchViewModelLine.on("update",e=>i(e)),this.sketchViewModelPolygon=new n.default({layer:this.mapNotesLayer.polygonLayer??void 0,view:this.mapView,updateOnGraphicClick:!1,snappingOptions:s}),this.sketchViewModelPolygon.on("update",e=>i(e)),this.sketchViewModelText=new n.default({layer:this.mapNotesLayer.textLayer??void 0,view:this.mapView,updateOnGraphicClick:!1,snappingOptions:s}),this.sketchViewModelText.on("update",e=>i(e))}duplicate(){this.duplicatePoint(),this.duplicateLine(),this.duplicatePolygon(),this.duplicateText()}delete(){this.deletePoint(),this.deleteLine(),this.deletePolygon(),this.deleteText()}cancel(){this.cancelPoint(),this.cancelLine(),this.cancelPolygon(),this.cancelText()}destroy(){this.destroyPoint(),this.destroyLine(),this.destroyPolygon(),this.destroyText()}updatePoint(e){this.sketchViewModelPoint.update(e)}duplicatePoint(){this.sketchViewModelPoint.duplicate()}deletePoint(){this.sketchViewModelPoint.delete()}cancelPoint(){this.sketchViewModelPoint.cancel()}destroyPoint(){this.sketchViewModelPoint.destroy()}getLineSVM(){return this.sketchViewModelLine}async updateLine(e){const t=1===e.length&&!!e[0].geometry?.curvePaths?.length;await this.sketchViewModelLine.update(e,{reshapeOptions:{edgeOperation:t?"none":"split"}})}duplicateLine(){this.sketchViewModelLine.duplicate()}deleteLine(){this.sketchViewModelLine.delete()}cancelLine(){this.sketchViewModelLine.cancel()}destroyLine(){this.sketchViewModelLine.destroy()}updatePolygon(e){this.sketchViewModelPolygon.update(e)}duplicatePolygon(){this.sketchViewModelPolygon.duplicate()}deletePolygon(){this.sketchViewModelPolygon.delete()}cancelPolygon(){this.sketchViewModelPolygon.cancel()}destroyPolygon(){this.sketchViewModelPolygon.destroy()}updateText(e){this.sketchViewModelText.update(e)}duplicateText(){this.sketchViewModelText.duplicate()}deleteText(){this.sketchViewModelText.delete()}cancelText(){this.sketchViewModelText.cancel()}destroyText(){this.sketchViewModelText.destroy()}}const b=a.AH`.actions-start-padding{padding:8px}`;class v extends g.WF{constructor(){super(),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new y.YZ(this,{task:async([e,t])=>{if(!(0,c.i)(e)||!(0,c.i)(t))throw console.error("[arcgis-map-config-sketch-features] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,this.init()},args:()=>[this.mapView,this.layer]}),this._messages=(0,d.u)({blocking:!0}),this.blockNode=(0,u._)(),this.listItemNodes=[],this.addFeatureButtonNode=(0,u._)(),this.graphicsSelectionHandles=[],this.graphicsUpdateHandles=[],this.selectedGraphics=[],this.duplicatedGraphicIndices=[],this.freezeGraphicsListOrder=!1,this.activeSVMCount=0,this.onGraphicUpdate=e=>{if(this.listItemNodes=Array.from(this.el.shadowRoot.querySelectorAll("calcite-list-item")).filter(e=>(0,c.i)(e)),"start"===e.state)if(this.freezeGraphicsListOrder||this.activeSVMCount)this.listItemNodes.forEach((e,t)=>this.listItemNodes[t].selected=(0,c.i)(this.selectedGraphics.find(e=>e.index===t))),this.freezeGraphicsListOrder=!1,this.activeSVMCount-=1;else{let t=!1;this.selectedGraphics=[],this.graphics.forEach((s,i)=>{t||JSON.stringify(s.toJSON())!==JSON.stringify(e.graphics[0].toJSON())?this.listItemNodes[i]&&(this.listItemNodes[i].selected=!1):(t=!0,this.selectedGraphics.push({index:i,graphic:s}),this.listItemNodes[i]&&(this.listItemNodes[i].selected=!0),this.addActionsPopover())})}"complete"===e.state&&this.arcgisChange.emit()},this.graphics=[],this.hideAddSketch=!1,this.hideEditFeature=!1,this.snappingSessionStorageIds={current:"current",webmap:"webmap"},this.blockClosed=!1,this.arcgisAddFeature=(0,g.lh)(),this.arcgisChange=(0,g.lh)(),this.arcgisCopyToNewSketchLayer=(0,g.lh)(),this.arcgisEditFeatures=(0,g.lh)(),this.renderingSymbolPreviews=!1,this.listenOn(window,"sketchUpdated",this.sketchUpdatedHandler)}static{this.properties={graphics:16,mapView:0,layer:0,hideAddSketch:5,hideEditFeature:5,snappingSessionStorageIds:0,blockClosed:5}}static{this.styles=b}async deactivate(){this.deactivateCurrentWorkflow()}async done(){this.snappingSessionStorageIds?.current&&this.snappingOptions&&function(e,t){const s=[...new Set([...e.featureSources.filter(e=>e.enabled).map(e=>e.layer.id)])],i={enabled:e.enabled,selfEnabled:e.selfEnabled,featureEnabled:e.featureEnabled,featureSourcesIds:s};(0,o.a)(t,i)}(this.snappingOptions,this.snappingSessionStorageIds.current),this.sketchFeaturesSVModel?.destroy(),this.mapView&&(this.mapView.popupEnabled=!!this.originalPopupEnabled)}async setFocus(){this.addFeatureButtonNode.value?.setFocus()}async updated(){this._propWatcherTask.status===y.e1.COMPLETE&&this._initialized&&!this._loaded&&(this._loaded=!0,this.watchForChangesToMapNotesLayer(),this.watchForGraphicSelectionOnClick(),this.cleanUpBezierPaths());const{_messages:e}=this;if(!this.renderingSymbolPreviews&&this.listItemNodes.length){this.renderingSymbolPreviews=!0;for(let t=0;t<this.graphics.length;t++){const s=this.el.shadowRoot.getElementById(`image-${t}`),i=await h.renderPreviewHTML(this.graphics[t].symbol,{scale:!0,maxSize:20,size:{width:20,height:"polyline"===this.graphics[t].geometry?.type?6:20},..."text"===this.graphics[t].symbol?.type&&{overrideText:this.graphics[t].symbol?.text?.[0]||e.textPreview}});(1!==s.childElementCount||!s.firstElementChild?.isEqualNode(i))&&(s.innerHTML="",s.appendChild(i))}this.renderingSymbolPreviews=!1,this.duplicatedGraphicIndices.length&&(this.listItemNodes.forEach((e,t)=>this.listItemNodes[t].selected=this.duplicatedGraphicIndices.includes(t)),this.selectedGraphics=[],this.listItemNodes.forEach((e,t)=>{e.selected&&this.selectedGraphics.push({index:t,graphic:this.graphics[t]})}),this.duplicatedGraphicIndices=[])}}disconnectedCallback(){super.disconnectedCallback(),this.graphicsSelectionHandles.forEach(e=>e?.remove()),this.graphicsUpdateHandles.forEach(e=>e?.remove()),this.hitTestHandle?.remove(),this.unselectAllGraphics(),this.sketchFeaturesSVModel?.cancel(),this.sketchFeaturesSVModel?.destroy()}init(){this.snappingOptions=f(this.snappingSessionStorageIds,this.layer,this.mapView),this.sketchFeaturesSVModel=new k(this.layer,this.mapView,this.snappingOptions,this.onGraphicUpdate),this.combineMapNotesGraphics(),this.originalPopupEnabled=this.mapView.popupEnabled,this._initialized=!0}cleanUpBezierPaths(){const{layer:e}=this;e.polylineLayer.graphics.forEach(e=>{if(e.geometry.curvePaths&&e.geometry.paths?.length){const t=e.geometry.clone();t.paths=[],e.geometry=t}})}sketchUpdatedHandler(e){e.stopPropagation(),this.requestUpdate()}listItemRefHandler(e){e&&this.listItemNodes.push(e)}deactivateCurrentWorkflow(){this.listItemNodes?.forEach(e=>{e&&(e.selected=!1)}),this.removeActionsPopover(),this.unselectAllGraphics(),this.sketchFeaturesSVModel.cancel(),this.combineMapNotesGraphics(),this.freezeGraphicsListOrder=!1,this.activeSVMCount=0}combineMapNotesGraphics(){this.graphics=[...this.layer.pointLayer.graphics,...this.layer.polylineLayer.graphics,...this.layer.polygonLayer.graphics,...this.layer.textLayer.graphics]}watchForChangesToMapNotesLayer(){for(const e of[this.layer.pointLayer,this.layer.polylineLayer,this.layer.polygonLayer,this.layer.textLayer]){const t=l.on(()=>e?.graphics,"change",()=>{this.freezeGraphicsListOrder||this.combineMapNotesGraphics()});this.graphicsSelectionHandles.push(t);const s=l.on(()=>e,"graphic-update",e=>{"geometry"!==e?.property&&!this.freezeGraphicsListOrder&&this.combineMapNotesGraphics()});this.graphicsUpdateHandles.push(s)}}watchForGraphicSelectionOnClick(){this.hitTestHandle?.remove(),this.hitTestHandle=this.mapView.on("click",async e=>{const t=(await this.mapView.hitTest(e,{include:this.layer})).results;if(t.length){const e=["point","polyline","polygon"];t.sort((t,s)=>e.indexOf(t.graphic.geometry.type)-e.indexOf(s.graphic.geometry.type));const s=t[0].graphic;this.unselectAllGraphics(!0),this.handleFeatureSelectionViaHitTest(s)}else this.deactivateCurrentWorkflow()})}unselectAllGraphics(e){this.selectedGraphics=[],this.listItemNodes.forEach(e=>{e&&(e.selected=!1)}),e||this.removeActionsPopover()}addActionsPopover(){this.sketchActionsPopoverNode||(this.sketchActionsPopoverNode=(0,g.dN)(a.qy`<arcgis-map-config-sketch-features-actions-popover .referenceElement=${this.blockNode.value} .selectedGraphics=${this.selectedGraphics} ._messages=${this._messages} @arcgisEdit=${()=>this.handleEdit()} @arcgisDuplicate=${async()=>await this.handleDuplicate()} @arcgisCopy=${()=>this.handleCopy()} @arcgisDelete=${()=>this.handleDelete()}></arcgis-map-config-sketch-features-actions-popover>`),document.body.appendChild(this.sketchActionsPopoverNode)),this.sketchActionsPopoverNode.setFocus()}removeActionsPopover(){this.sketchActionsPopoverNode?.remove(),this.sketchActionsPopoverNode=void 0}getStringFromType(e){const{_messages:t}=this;switch(e?.geometry?.type){case"point":return"text"===e?.symbol?.type?t.text:t.point;case"polyline":return t.line;case"polygon":return t.polygon;default:return t.point}}handleFeatureSelectionViaHitTest(e){switch(this.freezeGraphicsListOrder=!0,this.activeSVMCount=1,e.layer){case this.layer.pointLayer:this.sketchFeaturesSVModel.updatePoint([e]);break;case this.layer.textLayer:this.sketchFeaturesSVModel.updateText([e]);break;case this.layer.polylineLayer:this.sketchFeaturesSVModel.updateLine([e]);break;case this.layer.polygonLayer:this.sketchFeaturesSVModel.updatePolygon([e]);break;default:return}this.graphics?.forEach((t,s)=>{JSON.stringify(t.toJSON())===JSON.stringify(e.toJSON())&&(this.selectedGraphics.find(t=>JSON.stringify(t.graphic.toJSON())===JSON.stringify(e.toJSON()))||this.selectedGraphics.push({index:s,graphic:t}))}),this.addActionsPopover()}handleFeatureSelectionViaList(){this.listItemNodes=Array.from(this.el.shadowRoot.querySelectorAll("calcite-list-item")).filter(e=>(0,c.i)(e)),this.listItemNodes.forEach(e=>{const t=Number.parseInt(e.id.split("-")[1]);if(e.selected)this.freezeGraphicsListOrder=!0,this.selectedGraphics.find(e=>e.index===t)||this.selectedGraphics.push({index:t,graphic:this.graphics[t]});else{const e=this.selectedGraphics.find(e=>e.index===t);e&&this.selectedGraphics.splice(this.selectedGraphics.indexOf(e),1)}}),this.selectedGraphics.length?(this.addActionsPopover(),this.sketchActionsPopoverNode.selectedGraphics=this.selectedGraphics):this.removeActionsPopover();let e=[],t=[],s=[],i=[];this.selectedGraphics.forEach(a=>{switch(m(a.graphic)){case"polyline":t=[...t,a.graphic];break;case"polygon":s=[...s,a.graphic];break;case"text":i=[...i,a.graphic];break;default:e=[...e,a.graphic]}});const a=[e,t,s,i].filter(e=>e.length);this.activeSVMCount=a.length,this.freezeGraphicsListOrder=!0,e.length?this.sketchFeaturesSVModel.updatePoint(e):this.sketchFeaturesSVModel.cancelPoint(),t.length?this.sketchFeaturesSVModel.updateLine(t):this.sketchFeaturesSVModel.cancelLine(),s.length?this.sketchFeaturesSVModel.updatePolygon(s):this.sketchFeaturesSVModel.cancelPolygon(),i.length?this.sketchFeaturesSVModel.updateText(i):this.sketchFeaturesSVModel.cancelText(),this.watchForGraphicSelectionOnClick(),this.selectedGraphics.length||(this.sketchFeaturesSVModel.cancel(),this.combineMapNotesGraphics(),this.freezeGraphicsListOrder=!1,this.activeSVMCount=0)}handleEdit(){this.removeActionsPopover();const e=this.selectedGraphics.map(e=>e.graphic);this.arcgisEditFeatures.emit({features:e}),this.unselectAllGraphics()}async handleDuplicate(){this.sketchFeaturesSVModel.duplicate(),await this.offsetDuplicatedFeatures(),this.combineMapNotesGraphics();const e=this.selectedGraphics.map(e=>e.graphic);this.duplicatedGraphicIndices=[],e.forEach(e=>{let t=!1;[...this.graphics].reverse().forEach((s,i)=>{const a=this.graphics.length-1-i;!t&&!this.duplicatedGraphicIndices.includes(a)&&JSON.stringify(s.toJSON())===JSON.stringify(e.toJSON())&&(this.duplicatedGraphicIndices.push(a),t=!0)})})}async offsetDuplicatedFeatures(){this.selectedGraphics.forEach(e=>{const t=e.graphic;p.move(t.geometry,15*this.mapView.resolution,15*this.mapView.resolution)});let e=[],t=[],s=[],i=[];this.selectedGraphics.forEach(a=>{switch(m(a.graphic)){case"polyline":t=[...t,a.graphic];break;case"polygon":s=[...s,a.graphic];break;case"text":i=[...i,a.graphic];break;default:e=[...e,a.graphic]}});const a=[e,t,s,i].filter(e=>e.length);this.activeSVMCount=a.length,this.freezeGraphicsListOrder=!0,e.length&&this.sketchFeaturesSVModel.updatePoint(e),t.length&&this.sketchFeaturesSVModel.updateLine(t),s.length&&this.sketchFeaturesSVModel.updatePolygon(s),i.length&&this.sketchFeaturesSVModel.updateText(i)}handleCopy(){const e=this.selectedGraphics.map(e=>e.graphic).map(e=>e.clone());this.arcgisCopyToNewSketchLayer.emit({features:e})}handleDelete(){this.removeActionsPopover(),this.unselectAllGraphics(),this.sketchFeaturesSVModel.delete(),this.combineMapNotesGraphics(),this.freezeGraphicsListOrder=!1,this.activeSVMCount=0,this.mapView.popupEnabled=!!this.originalPopupEnabled}render(){return this._propWatcherTask.render({complete:()=>{const{_messages:e,graphics:t,selectedGraphics:s,hideAddSketch:i,blockClosed:r}=this;return this.listItemNodes=[],a.qy`<calcite-block .heading=${e.sketches} .expanded=${!r} collapsible @calciteBlockOpen=${()=>{s.length&&this.addActionsPopover()}} @calciteBlockClose=${()=>this.removeActionsPopover()} ${(0,u.K)(this.blockNode)}><calcite-list selection-mode=multiple .label=${e.sketches}>${t.map((e,t)=>this.renderPickListItem(e,t))}</calcite-list>${i?null:a.qy`<calcite-button icon-start=pencil-mark appearance=transparent width=full @click=${()=>{const{layer:e}=this;this.removeActionsPopover(),this.unselectAllGraphics(),this.sketchFeaturesSVModel.cancel(),this.arcgisAddFeature.emit({layer:e})}} ${(0,u.K)(this.addFeatureButtonNode)}>${e.addSketch}</calcite-button>`}</calcite-block>`}})}renderPickListItem(e,t){const{_messages:s,hideEditFeature:i}=this;return a.qy`<calcite-list-item .id=${`graphic-${t}`} .label=${e?.attributes?.title||this.getStringFromType(e)} @click=${()=>this.handleFeatureSelectionViaList()} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),this.handleFeatureSelectionViaList())}} ${(0,u.K)(this.listItemRefHandler)}><div slot=content-start .id=${`image-${t}`}></div>${i?null:a.qy`<calcite-action slot=actions-end .text=${s.edit} title=${s.edit??g.s6} scale=s icon=pencil @click=${t=>{t.preventDefault(),t.stopPropagation(),this.arcgisEditFeatures.emit({features:[e]})}}></calcite-action>`}</calcite-list-item>`}}(0,i.c)("arcgis-map-config-sketch-features",v)},36486:(e,t,s)=>{s.d(t,{u:()=>r});var i=s(83552),a=s(73679);const r=(0,i.yr)(a.g)},42855:(e,t,s)=>{s.d(t,{a:()=>o,f:()=>i,l:()=>a,s:()=>r});var i=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(i||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),r=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(r||{}),o=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(o||{})},47640:(e,t,s)=>{s.d(t,{YZ:()=>o,e1:()=>a});var i=s(4836);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class o{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,s){this.p=0,this.i=0,(this._=e).addController(this);const i="object"==typeof t?t:{task:t,args:s};this.v=i.task,this.j=i.args,this.m=i.argsEqual??n,this.k=i.onComplete,this.A=i.onError,this.autoRun=i.autoRun??!0,"initialValue"in i&&(this.u=i.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,s;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const i=++this.p;this.q=new AbortController;let a=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){a=!0,s=e}if(this.p===i){if(t===r)this.i=0;else{if(!1===a){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(s)}catch{}this.i=3,this.h?.(s)}this.u=t,this.l=s}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const n=(e,t)=>e===t||e.length===t.length&&e.every((e,s)=>!(0,i.Ec)(e,t[s]))},55535:(e,t,s)=>{function i(e,t,s){window.localStorage.setItem(e,JSON.stringify(t))}function a(e){window.localStorage.removeItem(e)}function r(e,t){const s=window.localStorage.getItem(e);return s&&t?JSON.parse(s):s}function o(e,t,s){window.sessionStorage.setItem(e,JSON.stringify(t))}function n(e,t){const s=window.sessionStorage.getItem(e);return s&&t?JSON.parse(s):s}s.d(t,{a:()=>o,b:()=>n,g:()=>r,r:()=>a,s:()=>i})},66228:(e,t,s)=>{s.d(t,{a:()=>w,b:()=>x,c:()=>O,d:()=>N,e:()=>M,f:()=>E,g:()=>m,h:()=>f,i:()=>g,j:()=>y,k:()=>v,l:()=>F,m:()=>P,n:()=>d,o:()=>S,p:()=>C,q:()=>G,r:()=>T,s:()=>b,t:()=>V,u:()=>k});var i=s(63438),a=s(18423),r=s(96086),o=s(91813),n=s(21255),c=s(13078),l=s(21303),h=s(12627),p=s(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],u=["feature"];function g(e){return null!=e}function y(e,t,s){const i=t.fieldName;if(i.includes(p.f.expression)){const e=s.get(i);return e?.title?e.title:i}return b(e)&&e.getFieldConfiguration(i)?e.getFieldAlias(i)||i:t.label||i}async function m(e){return new Map((await v(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function f(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const s=`${p.f.expression}${e.name}`;t.set(s,e)}),t}function w(e){return"map-image"===e?.layer?.type?p.s.mapImage:"subtype-sublayer"===e?.type?p.s.subtype:"tile"===e?.layer?.type?p.s.tile:"scene"===e?.type?p.s.scene:"ogc-feature"===e?.type?p.s.ogcFeature:"imagery"===e?.type?p.s.imagery:"imagery-tile"===e?.type?p.s.imageryTile:"wfs"===e?.type?p.s.wfs:"wcs"===e?.type?p.s.wcs:"wms"===e?.layer?.type?p.s.wms:"csv"===e?.type?p.s.csv:"geojson"===e?.type?p.s.geojson:"stream"===e?.type?p.s.stream:"oriented-imagery"===e?.type?p.s.orientedImagery:"catalog"===e?.type?p.s.catalog:"catalog-footprint"===e?.type?p.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?p.s.knowledgeGraphSublayer:"voxel"===e?.type?p.s.voxel:"parquet"===e?.type?p.s.parquet:p.s.feature}function k(e){const t=w(e);let s;return t===p.s.wms||t===p.s.mapImage?s=e?.layer.version:(t===p.s.imagery||t===p.s.feature||t===p.s.scene)&&(s=e.version),Number.parseFloat(s)}function b(e){return"fieldConfigurations"in e&&u.includes(e.type)}async function v(e){return await new Promise((t,s)=>{switch(w(e)){case p.s.feature:case p.s.ogcFeature:case p.s.stream:t(e.fields);break;case p.s.mapImage:{const i=e,a=i?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const s=new Map(i.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,r=[];a.forEach(e=>{s.has(e)&&r.push(s.get(e))}),t(r)}else t(i.fields)}).catch(e=>{s(new Error(e))}):t(i.fields);break}case p.s.imagery:case p.s.imageryTile:case p.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function S(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function P(e){return Number((100*(1-e)).toFixed(1))}function V(e){return Number((1-e/100).toFixed(3))}const N=(e,t)=>{const s=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(p.f.expression)||s.push({name:e.fieldName,alias:e.label,type:"string"})}),s},x=async(e,t)=>{const s=new h.default;return s.geometry=t.extent,s.mapExtent=t.extent,s.returnGeometry=!0,s.tolerance=6,s.layerOption="popup",s.width=t.width,s.height=t.height,s.layerIds=[e.id],(await l.identify(e.layer.url,s))?.results?.[0]?.feature},M=async(e,t,s)=>{const i=await(await e.whenLayerView(t)).queryAggregates();return await L(s,i.features?.[0])},L=async(e,t)=>{let s;if(t)s=t.clone();else{s=new i.default;const t=N(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),s.attributes=e}const r=new a.default;s.geometry=r}return s};function G(e,t){const s=t.startsWith("#"),i=t.startsWith(".");for((i||s)&&(t=t.slice(1));e;){if(s){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function O(e){if(w(e)===p.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(w(e)===p.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function F(e,t,s){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const s=t.get(e);i=s.type?s.type.toLowerCase():""}else if(s.has(e)){const t=s.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function E(e,t){try{const s=w(e);if(s===p.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await x(e,t)||await I(e,t)]};if(s===p.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await I(e,t)]};const i=s===p.s.ogcFeature||s===p.s.stream?await t.whenLayerView(e):e,a=i.createQuery();a.where=i.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(i.sourceJSON?.advancedQueryCapabilities?.supportsPagination||s===p.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const r=await i.queryFeatures(a);return r?.features?.length||(r.features[0]=await I(e,t)),r}catch(e){console.error(e)}}async function I(e,t){return await new Promise(s=>{const a=new i.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const l=t.extent;let h;"polygon"===e.geometryType?h=n.default.fromExtent(l):"point"===e.geometryType?h=l.center.clone():"multipoint"===e.geometryType?h=new r.default({points:[[l.center.x,l.center.y]],spatialReference:l.center.spatialReference.clone()}):"polyline"===e.geometryType?(h=new o.default({spatialReference:t.spatialReference.clone()}),h.addPath([[l.xmin,l.ymin],[l.xmax,l.ymax]])):"mesh"===e.geometryType&&(h=c.default.createBox(l.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=h,s(a)})}function T(e){return w(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function C(e){return w(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);