/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-1a8ba3.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-1a8ba3"],{2079:(e,t,o)=>{o.d(t,{a:()=>s,i:()=>a});var i=o(42855);function a(e,t,o,a){const{layer:s}=e;switch(t){case i.l.feature:return!!(s&&o===i.s.wms||s&&s.popupTemplate)&&s.popupEnabled;case i.l.cluster:return!!s&&s.featureReduction.popupEnabled;case i.l.mapNotes:return a;default:return!!s?.popupEnabled}}function s(e,t){const o="CALCITE-INPUT"===e.tagName,i=o?e.shadowRoot.querySelector("input"):e.shadowRoot.querySelector("textarea"),a=i.selectionStart,s=[e.value.slice(0,a),`{${t}}`,e.value.slice(a)].join("");e.value=s;const r=a+2+t.length;setTimeout(()=>{o?e.setFocus():(i?.setSelectionRange(r,r),i?.focus()),i?.setSelectionRange(r,r)},1)}},4265:(e,t,o)=>{o.d(t,{a:()=>a,d:()=>i,t:()=>s});const i=(e,t)=>{let o,i="idle";const a=async(...a)=>await new Promise(s=>{switch(i){case"flushed":i="idle",o?(clearTimeout(o),s(e(...a))):s(null);break;case"invoked":clearTimeout(o),i="idle",s(e(...a));break;case"cancelled":clearTimeout(o),i="idle",s(null);break;default:o&&clearTimeout(o),i="pending",o=setTimeout(()=>{i="idle",s(e(...a))},t)}});return a.flush=async function(...e){return i="flushed",await a(...e)},a.invoke=async function(...e){return i="invoked",await a(...e)},a.cancel=async function(...e){return i="cancelled",await a(...e)},a.getStatus=function(){return i},a},a=(e,t)=>{let o;return async(...i)=>await new Promise(a=>{o||(o=setTimeout(()=>{clearTimeout(o),o=void 0,a(e(...i))},t))})};function s(e){return new Promise(t=>setTimeout(t,e))}},42855:(e,t,o)=>{o.d(t,{a:()=>r,f:()=>i,l:()=>a,s:()=>s});var i=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(i||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),s=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(s||{}),r=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(r||{})},66228:(e,t,o)=>{o.d(t,{a:()=>y,b:()=>T,c:()=>S,d:()=>b,e:()=>$,f:()=>R,g:()=>g,h:()=>v,i:()=>f,j:()=>m,k:()=>P,l:()=>E,m:()=>M,n:()=>d,o:()=>N,p:()=>_,q:()=>k,r:()=>A,s:()=>C,t:()=>w,u:()=>I});var i=o(63438),a=o(18423),s=o(96086),r=o(91813),l=o(21255),n=o(13078),c=o(21303),h=o(12627),p=o(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],u=["feature"];function f(e){return null!=e}function m(e,t,o){const i=t.fieldName;if(i.includes(p.f.expression)){const e=o.get(i);return e?.title?e.title:i}return C(e)&&e.getFieldConfiguration(i)?e.getFieldAlias(i)||i:t.label||i}async function g(e){return new Map((await P(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function v(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const o=`${p.f.expression}${e.name}`;t.set(o,e)}),t}function y(e){return"map-image"===e?.layer?.type?p.s.mapImage:"subtype-sublayer"===e?.type?p.s.subtype:"tile"===e?.layer?.type?p.s.tile:"scene"===e?.type?p.s.scene:"ogc-feature"===e?.type?p.s.ogcFeature:"imagery"===e?.type?p.s.imagery:"imagery-tile"===e?.type?p.s.imageryTile:"wfs"===e?.type?p.s.wfs:"wcs"===e?.type?p.s.wcs:"wms"===e?.layer?.type?p.s.wms:"csv"===e?.type?p.s.csv:"geojson"===e?.type?p.s.geojson:"stream"===e?.type?p.s.stream:"oriented-imagery"===e?.type?p.s.orientedImagery:"catalog"===e?.type?p.s.catalog:"catalog-footprint"===e?.type?p.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?p.s.knowledgeGraphSublayer:"voxel"===e?.type?p.s.voxel:"parquet"===e?.type?p.s.parquet:p.s.feature}function I(e){const t=y(e);let o;return t===p.s.wms||t===p.s.mapImage?o=e?.layer.version:(t===p.s.imagery||t===p.s.feature||t===p.s.scene)&&(o=e.version),Number.parseFloat(o)}function C(e){return"fieldConfigurations"in e&&u.includes(e.type)}async function P(e){return await new Promise((t,o)=>{switch(y(e)){case p.s.feature:case p.s.ogcFeature:case p.s.stream:t(e.fields);break;case p.s.mapImage:{const i=e,a=i?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const o=new Map(i.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,s=[];a.forEach(e=>{o.has(e)&&s.push(o.get(e))}),t(s)}else t(i.fields)}).catch(e=>{o(new Error(e))}):t(i.fields);break}case p.s.imagery:case p.s.imageryTile:case p.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function N(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function M(e){return Number((100*(1-e)).toFixed(1))}function w(e){return Number((1-e/100).toFixed(3))}const b=(e,t)=>{const o=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(p.f.expression)||o.push({name:e.fieldName,alias:e.label,type:"string"})}),o},T=async(e,t)=>{const o=new h.default;return o.geometry=t.extent,o.mapExtent=t.extent,o.returnGeometry=!0,o.tolerance=6,o.layerOption="popup",o.width=t.width,o.height=t.height,o.layerIds=[e.id],(await c.identify(e.layer.url,o))?.results?.[0]?.feature},$=async(e,t,o)=>{const i=await(await e.whenLayerView(t)).queryAggregates();return await x(o,i.features?.[0])},x=async(e,t)=>{let o;if(t)o=t.clone();else{o=new i.default;const t=b(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),o.attributes=e}const s=new a.default;o.geometry=s}return o};function k(e,t){const o=t.startsWith("#"),i=t.startsWith(".");for((i||o)&&(t=t.slice(1));e;){if(o){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function S(e){if(y(e)===p.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(y(e)===p.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function E(e,t,o){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const o=t.get(e);i=o.type?o.type.toLowerCase():""}else if(o.has(e)){const t=o.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function R(e,t){try{const o=y(e);if(o===p.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await T(e,t)||await L(e,t)]};if(o===p.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await L(e,t)]};const i=o===p.s.ogcFeature||o===p.s.stream?await t.whenLayerView(e):e,a=i.createQuery();a.where=i.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(i.sourceJSON?.advancedQueryCapabilities?.supportsPagination||o===p.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const s=await i.queryFeatures(a);return s?.features?.length||(s.features[0]=await L(e,t)),s}catch(e){console.error(e)}}async function L(e,t){return await new Promise(o=>{const a=new i.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const c=t.extent;let h;"polygon"===e.geometryType?h=l.default.fromExtent(c):"point"===e.geometryType?h=c.center.clone():"multipoint"===e.geometryType?h=new s.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(h=new r.default({spatialReference:t.spatialReference.clone()}),h.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(h=n.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=h,o(a)})}function A(e){return y(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function _(e){return y(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},88063:(e,t,o)=>{o.r(t),o.d(t,{ArcgisMapConfigPopupChart:()=>P});var i=o(73679),a=o(4395),s=o(98492),r=o(56451),l=o(50893),n=o(5294),c=o(26653),h=o(99709),p=o(59640),d=o(70852),u=o(42855),f=o(66228),m=o(4265),g=o(85643),v=o(73801),y=(o(9923),o(42097),o(81565),o(2079)),I=o(98295);const C=a.AH`.popover{--calcite-popover-z-index: 100}.panel{--calcite-panel-background-color: var(--calcite-color-foreground-1)}.content{padding:var(--calcite-spacing-lg) var(--calcite-spacing-sm);max-height:60vh}.segmented-control{margin-bottom:var(--calcite-spacing-sm)}.form-input-button{display:flex}.input{width:100%}calcite-text-area{width:100%;--calcite-text-area-min-width: 0;--calcite-text-area-min-height: 42px}.reset-to-default-colors-button{--calcite-label-margin-bottom: 0}.select-fields-button{margin-bottom:var(--calcite-spacing-sm)}.color-icon{width:18px;height:18px;border-radius:90%}.fields-div{margin-bottom:var(--calcite-spacing-sm)}.normalization-block-section{background-color:var(--calcite-color-foreground-1)}.normalize-by-button{margin-top:var(--calcite-spacing-sm)}`;class P extends v.WF{constructor(){super(),this.arcadeExpMap=new Map,this.popoverNode=(0,g._)(),this.panelNode=(0,g._)(),this.chartCaptionNode=(0,g._)(),this.colorButtonNode=(0,g._)(),this.listNode=(0,g._)(),this.listItems=[],this.orientationSwitchNode=(0,g._)(),this.normalizationBlockSectionNode=(0,g._)(),this.normalizationButtonNode=(0,g._)(),this.lastColors={},this.arcgisMultimediaChange=(0,v.lh)(),this.closePopupPopovers=(0,v.lh)(),this.listenOn(window,"arcadeChangeNotification",this.arcadeChangeNotificationHandler),this.listenOn(window,"closePopupPopovers",this.closePopupPopoversHandler)}static{this.properties={referenceElement:0,mediaContent:0,chartMediaInfo:0,mediaIndexPosition:9,popupState:0}}static{this.styles=C}async reposition(){this.popoverNode.value?.reposition()}async load(){const{popupState:e}=this,{layer:t,popupTemplate:o,layerDisplayType:i}=e;if(this.fieldInfoMap=new Map(o.fieldInfos.map(e=>[e.fieldName,e])),this.arcadeExpMap=(0,f.h)(o),this.chartMediaInfo.title=this.chartMediaInfo.title||"",this.chartMediaInfo.altText=this.chartMediaInfo.altText||"",this.chartMediaInfo.caption=this.chartMediaInfo.caption||"","renderer"in t){const e=i===u.l.cluster?t.featureReduction.renderer:t.renderer;["class-breaks","dot-density","heatmap","pie-chart","simple","unique-value"].includes(e?.type)&&(this.rendererColors=await d.getColorsFromRenderer(e))}this.colors=n.clone(this.chartMediaInfo?.value.colors)||[],this.setColors(),this.syncDisplayWithCurrentPopupElementInfo()}willUpdate(){const{popupState:e}=this,{popupTemplate:t}=e;this.fieldInfoMap=new Map(t.fieldInfos.map(e=>[e.fieldName,e])),this.arcadeExpMap=(0,f.h)(t)}updated(){this.arcgisMultimediaChange.emit(this.mediaIndexPosition)}loaded(){this.panelNode.value?.setFocus()}disconnectedCallback(){super.disconnectedCallback(),this.removePopovers()}syncDisplayWithCurrentPopupElementInfo(){this.listItems=[],this.chartMediaInfo.value.fields.forEach((e,t)=>{if(this.fieldInfoMap.has(e)){const o=this.fieldInfoMap.get(e);this.listItems.push(this.renderListItem(o,t))}})}arcadeChangeNotificationHandler(){const{popupState:e}=this,{popupTemplate:t}=e;this.arcadeExpMap=(0,f.h)(t),this.syncDisplayWithCurrentPopupElementInfo(),this.requestUpdate()}closePopupPopoversHandler(){this.removePopovers()}inputRefHandler(e){const t=e?.getAttribute("data-value");"title"===t?this.chartTitleNode=e:"altText"===t&&(this.chartAltTextNode=e)}async handleChartSelection(e){let t=null;e===I.P.BAR_CHART&&(t=new s.default({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===I.P.COLUMN_CHART&&(t=new l.default({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===I.P.LINE_CHART&&(t=new c.default({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===I.P.PIE_CHART&&(t=new h.default({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),this.chartMediaInfo=t.clone(),this.mediaContent.mediaInfos[this.mediaIndexPosition]=this.chartMediaInfo,this.requestUpdate()}getChartInputDescription(e){const{popupState:t}=this,{_messages:o}=t;return"title"===e?o.title:"caption"===e?o.caption:o.description}getChartInputValue(e){return"title"===e?this.chartMediaInfo.title:"caption"===e?this.chartMediaInfo.caption:this.chartMediaInfo.altText}getChartInputPlaceholder(e){const{popupState:t}=this,{_messages:o}=t;return"title"===e?o.imageTitlePlaceHolder:"caption"===e?o.imageCaptionPlaceHolder:o.describeChart}changeChartProperties(){this.chartMediaInfo.title=this.chartTitleNode.value,this.chartMediaInfo.caption=this.chartCaptionNode.value.value,this.chartMediaInfo.altText=this.chartAltTextNode.value,this.requestUpdate()}handleChartFormInputPickListNodeChange(e,t){"title"===t?((0,y.a)(this.chartTitleNode,e),this.chartMediaInfo.title=this.chartTitleNode.value):"caption"===t?((0,y.a)(this.chartCaptionNode.value,e),this.chartMediaInfo.caption=this.chartCaptionNode.value.value):"altText"===t&&((0,y.a)(this.chartAltTextNode,e),this.chartMediaInfo.altText=this.chartAltTextNode.value),this.removePopovers(),this.requestUpdate()}setColors(){const{lastColors:e,rendererColors:t}=this;if(this.chartMediaInfo.type===I.P.LINE_CHART)if(!this.colors?.length&&e.lineColors&&(this.colors=e.lineColors,this.chartMediaInfo.value.colors=n.clone(this.colors)),this.colors?.length)this.colors.length>1&&(this.colors=[this.colors[0]]);else{const e=this.getDefaultColorScheme();this.colors=[e.colors[0]]}else if(!this.colors?.length&&e.rampColors&&(this.colors=n.clone(e.rampColors),this.chartMediaInfo.value.colors=n.clone(this.colors)),!this.colors?.length||this.colors.length!==this.chartMediaInfo?.value.fields.length){const e=this.getDefaultColorScheme();this.colors=this.chartMediaInfo?.value.fields.map((o,i)=>t?.get(o)?.[0]?n.clone(t.get(o)[0]):(0,f.i)(this.colors?.[i])?this.colors[i]:(0,f.i)(e.colors[i%10])?new r.default(e.colors[i%10]):new r.default([0,0,0,1]))}}getDefaultColorScheme(){const{popupState:e}=this,{mapView:t}=e,o=p.getSchemes({basemap:t.map?.basemap??"topo",geometryType:"polygon",numColors:Math.min(10,this.chartMediaInfo.value.fields.length)});return[o.primaryScheme].concat(o.secondarySchemes).find(e=>"Olympic Sunset"===e.name)||o.primaryScheme}handleChartFieldPickListChange(e){const{rendererColors:t}=this,o=this.chartMediaInfo.value.fields;if(this.chartMediaInfo.value.fields=e,this.chartMediaInfo.type===I.P.LINE_CHART){if(this.chartMediaInfo.value.fields?.length&&!this.chartMediaInfo.value.colors?.length){const e=this.getDefaultColorScheme();this.colors=[e.colors[0]],this.chartMediaInfo.value.colors=n.clone(this.colors)}else!this.chartMediaInfo.value.fields?.length&&this.chartMediaInfo.value.colors?.length&&(this.colors=void 0,this.chartMediaInfo.value.colors=void 0);if(this.lastColors.rampColors?.length){const e=this.getDefaultColorScheme();this.lastColors.rampColors=this.chartMediaInfo?.value.fields.map((t,i)=>{const a=o.indexOf(t);return a>-1&&this.lastColors.rampColors?.[a]||new r.default(e.colors[i%10])||new r.default([0,0,0,1])})}}else if(this.chartMediaInfo.value.fields?.length){const e=this.getDefaultColorScheme();this.colors=this.chartMediaInfo?.value.fields.map((i,a)=>{const s=o.indexOf(i);return s>-1&&this.colors?.[s]||(t?.get(i)?.[0]?n.clone(t.get(i)[0]):new r.default(e.colors[a%10]))}),this.chartMediaInfo.value.colors?.length?this.chartMediaInfo.value.colors=n.clone(this.colors):(this.colors=[],this.setColors()),o?.length&&this.colorButtonNode.value&&this.colorButtonNode.value.manager.component.requestUpdate()}else this.colors=void 0,this.chartMediaInfo.value.colors=void 0;this.syncDisplayWithCurrentPopupElementInfo(),this.requestUpdate()}handleNormalizationFieldPickListNodeChange(e){e&&(this.chartMediaInfo.value.normalizeField=e,this.requestUpdate()),this.removePopovers(),this.normalizationButtonNode.value.focus()}openColorPopover(e){const{colors:t}=this,o=this.chartMediaInfo.value.fields.indexOf(e.fieldName);this.colorButtonNode.value?.closePopover(),this.closeColorPopover();const i=(0,v.dN)(a.qy`<arcgis-map-config-popup-color-popover .popoverProps=${{placement:"leading-start",offsetDistance:1,offsetSkidding:52,popoverWidth:315,refElement:this.panelNode.value}} .hexColor=${t[o].toHex()} .popupState=${this.popupState} @arcgisPopupColorPopoverChange=${({detail:e})=>{t[o]=new r.default(e),this.chartMediaInfo.value.colors=n.clone(t),this.syncDisplayWithCurrentPopupElementInfo(),this.requestUpdate(),this.colorButtonNode.value.manager.component.requestUpdate()}} @arcgisPopupColorPopoverClose=${()=>this.colorPopoverNode=void 0}></arcgis-map-config-popup-color-popover>`);document.body.appendChild(i),i.setOpen(!0),this.colorPopoverNode=i}closeColorPopover(){this.colorPopoverNode?.remove(),this.colorPopoverNode=void 0}removePopovers(){this.chartFormInputPickListNode&&(this.chartFormInputPickListNode.remove(),this.chartFormInputPickListNode=void 0),this.fieldPickListNode&&(this.fieldPickListNode.remove(),this.fieldPickListNode=void 0),this.normalizationFieldPickListNode&&(this.normalizationFieldPickListNode.remove(),this.normalizationFieldPickListNode=void 0),this.colorPopoverNode&&(this.colorPopoverNode.remove(),this.colorPopoverNode=void 0),this.panelNode.value&&(this.panelNode.value.disabled=!1)}render(){const{popupState:e}=this,{_messages:t}=e,o=!!this.chartMediaInfo.value.fields?.length;return this.el.classList.add("js-app-flyout"),a.qy`<calcite-popover class="popover" placement=leading-start open pointer-disabled .referenceElement=${this.referenceElement} .offsetDistance=${-Math.round(this.referenceElement.getBoundingClientRect().width)} offset-skidding=50 .label=${t.configureChart} trigger-disabled ${(0,g.K)(this.popoverNode)}><calcite-panel class="panel" closable style=${(0,v.zl)({width:`${this.referenceElement.getBoundingClientRect().width}px`})} @calcitePanelClose=${()=>this.closePopupPopovers.emit()} ${(0,g.K)(this.panelNode)}><div slot=header-content>${t.configureChart}</div><div class="content">${this.renderChartTypeSelection()}${this.renderChartFormInput("title")}${this.renderChartFormInput("caption")}${this.renderChartFormInput("altText")}${o&&this.renderColorButton()||""}${o&&this.renderResetToDefaultColorsButton()||""}${this.renderFieldList()}${this.renderHorizontalOrientationSwitch()}${this.renderNormalizationSwitch()}</div>${this.renderDoneButton()}</calcite-panel></calcite-popover>`}renderChartTypeSelection(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<calcite-segmented-control class="segmented-control" width=full scale=s @calciteSegmentedControlChange=${async e=>{this.colorButtonNode.value?.closePopover(),this.closeColorPopover();const t=e.target.selectedItem;if(this.chartMediaInfo.type===I.P.LINE_CHART&&t.value!==I.P.LINE_CHART||this.chartMediaInfo.type!==I.P.LINE_CHART&&t.value===I.P.LINE_CHART){const e=this.chartMediaInfo.value.colors;this.chartMediaInfo.type===I.P.LINE_CHART?(this.lastColors.lineColors=e?n.clone(e):void 0,this.colors=void 0,this.chartMediaInfo.value.colors=void 0):(this.lastColors.rampColors=e?n.clone(e):void 0,t.value===I.P.LINE_CHART&&(this.colors=void 0,this.chartMediaInfo.value.colors=void 0))}t.value!==this.chartMediaInfo.type&&(t.value===I.P.COLUMN_CHART&&this.chartMediaInfo.type===I.P.BAR_CHART||await this.handleChartSelection(t.value)),this.setColors(),this.syncDisplayWithCurrentPopupElementInfo(),this.requestUpdate()}}><calcite-segmented-control-item .value=${I.P.COLUMN_CHART} icon-start=graph-bar .checked=${this.chartMediaInfo.type===I.P.COLUMN_CHART||this.chartMediaInfo.type===I.P.BAR_CHART}>${t.bar}</calcite-segmented-control-item><calcite-segmented-control-item .value=${I.P.LINE_CHART} icon-start=graph-time-series .checked=${this.chartMediaInfo.type===I.P.LINE_CHART}>${t.line}</calcite-segmented-control-item><calcite-segmented-control-item .value=${I.P.PIE_CHART} icon-start=pie-chart .checked=${this.chartMediaInfo.type===I.P.PIE_CHART}>${t.pie}</calcite-segmented-control-item></calcite-segmented-control>`}renderChartFormInput(e){const{popupState:t}=this,{_messages:o,popupTemplate:i}=t,s=this.getChartInputDescription(e),r=this.getChartInputValue(e),l=this.getChartInputPlaceholder(e);return a.qy`<calcite-label scale=s>${s}<div class="form-input-button">${"caption"===e?a.qy`<calcite-text-area resize=vertical autofocus .value=${r} .placeholder=${l} @calciteTextAreaInput=${(0,m.d)(e=>{e.preventDefault(),e.stopPropagation(),this.changeChartProperties()},300)} ${(0,g.K)(this.chartCaptionNode)}></calcite-text-area>`:a.qy`<calcite-input class="input" autofocus data-value=${e??v.s6} .value=${r} .placeholder=${l} @calciteInputInput=${(0,m.d)(e=>{e.preventDefault(),e.stopPropagation(),this.changeChartProperties()},300)} ${(0,g.K)(this.inputRefHandler)}></calcite-input>`}${i.fieldInfos?.length&&a.qy`<calcite-action .text=${o.attributes} scale=s icon=brackets-curly @click=${()=>{const{popupState:t}=this;this.removePopovers(),this.colorButtonNode.value?.closePopover(),this.closeColorPopover(),this.chartFormInputPickListNode||(this.chartFormInputPickListNode=(0,v.dN)(a.qy`<arcgis-map-config-popup-field-pick-list .popoverProps=${{refElement:this.panelNode.value}} .heading=${o.addField} .popupState=${t} @arcgisChange=${t=>{t.stopPropagation();const o=t.detail.selectedFields[0];this.handleChartFormInputPickListNodeChange(o,e)}} @arcgisClose=${e=>{e.stopPropagation(),this.removePopovers()}}></arcgis-map-config-popup-field-pick-list>`),document.body.appendChild(this.chartFormInputPickListNode),this.panelNode.value.disabled=!0)}}></calcite-action>`||""}</div></calcite-label>`}renderColorButton(){const{popupState:e}=this;return a.qy`<arcgis-map-config-popup-color-button .referenceElement=${this.panelNode.value} .chartMediaInfo=${this.chartMediaInfo} .colors=${this.colors} .popupState=${e} @arcgisPopupColorButtonBeforeOpen=${()=>this.closeColorPopover()} @arcgisPopupColorButtonChange=${(0,m.d)(({detail:e})=>{this.colors=e,this.chartMediaInfo.value.colors=n.clone(e),this.syncDisplayWithCurrentPopupElementInfo(),this.requestUpdate()},300)} ${(0,g.K)(this.colorButtonNode)}></arcgis-map-config-popup-color-button>`}renderResetToDefaultColorsButton(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<calcite-label class="reset-to-default-colors-button" layout=inline-space-between>${t.resetColors}<calcite-action appearance=transparent .text=${t.resetColors} .disabled=${!this.chartMediaInfo.value.colors?.length} @click=${()=>{this.colorButtonNode.value?.closePopover(),this.closeColorPopover(),this.chartMediaInfo.value.colors=null,this.colors=[],this.chartMediaInfo.type===I.P.LINE_CHART?this.lastColors.lineColors=void 0:this.lastColors.rampColors=void 0,this.setColors(),this.syncDisplayWithCurrentPopupElementInfo(),this.requestUpdate()}}><calcite-icon scale=s icon=reset></calcite-icon></calcite-action></calcite-label>`}renderFieldList(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<div class="fields-div"><calcite-button class="select-fields-button" appearance=transparent width=full @click=${e=>{e.stopPropagation(),this.removePopovers(),this.colorButtonNode.value?.closePopover(),this.closeColorPopover();const{popupState:o}=this;this.fieldPickListNode||(this.fieldPickListNode=(0,v.dN)(a.qy`<arcgis-map-config-popup-field-pick-list .popoverProps=${{refElement:this.panelNode.value}} .selectedFields=${this.chartMediaInfo?.value?.fields||[]} hide-cancel multiple .heading=${t.selectFields} .okBtnText=${t.done} numbers-only .popupState=${o} @arcgisChange=${e=>{e.stopPropagation();const t=e.detail.selectedFields;this.handleChartFieldPickListChange(t)}} @arcgisClose=${e=>{e.stopPropagation(),this.removePopovers()}}></arcgis-map-config-popup-field-pick-list>`),document.body.appendChild(this.fieldPickListNode),this.panelNode.value.disabled=!0)}}>${t.selectAttributes}</calcite-button><calcite-list .label=${t.attributes} drag-enabled @calciteListOrderChange=${e=>{const t=e.detail.oldIndex,o=e.detail.newIndex;if(this.chartMediaInfo.type===I.P.LINE_CHART){const e=this.chartMediaInfo.value.fields.splice(t,1)[0];this.chartMediaInfo.value.fields.splice(o,0,e),this.listItems=[...this.listNode.value.children]}else{this.chartMediaInfo.value.colors?.length||(this.chartMediaInfo.value.colors=n.clone(this.colors));const e=this.chartMediaInfo.value.colors.splice(t,1)[0];this.chartMediaInfo.value.colors.splice(o,0,e),this.colors=n.clone(this.chartMediaInfo.value.colors);const i=this.chartMediaInfo.value.fields.splice(t,1)[0];this.chartMediaInfo.value.fields.splice(o,0,i),this.listItems=[...this.listNode.value.children]}if(this.lastColors.rampColors?.length){const t=e.target.querySelectorAll("calcite-list-item"),o=[];t.forEach(e=>{this.chartMediaInfo.value.fields.forEach((t,i)=>{e.value===t&&o.push(i)})});const i=[];o.forEach(e=>{i.push(this.lastColors.rampColors[e])}),this.lastColors.rampColors=i}this.requestUpdate()}} ${(0,g.K)(this.listNode)}>${this.listItems}</calcite-list></div>`}renderListItem(e,t){const{popupState:o}=this,{_messages:i,layer:s}=o;return a.qy`<calcite-list-item .label=${(0,f.j)(s,e,this.arcadeExpMap)} .value=${e.fieldName}>${this.renderColorIcon(e)}<calcite-action slot=actions-end appearance=transparent .text=${i.remove} @click=${()=>{this.removePopovers(),this.colorButtonNode.value?.closePopover(),this.closeColorPopover(),this.chartMediaInfo.value.colors?.length?this.chartMediaInfo.value.fields.forEach((t,o)=>{t===e.fieldName&&(this.chartMediaInfo.value.fields.splice(o,1),this.chartMediaInfo.type!==I.P.LINE_CHART&&(this.chartMediaInfo.value.colors.splice(o,1),this.colors.splice(o,1),this.colorButtonNode.value&&this.colorButtonNode.value.manager.component.requestUpdate()),this.lastColors.rampColors?.length&&this.lastColors.rampColors.splice(o,1))}):(this.chartMediaInfo.value.fields.forEach((t,o)=>{t===e.fieldName&&this.chartMediaInfo.value.fields.splice(o,1)}),this.colors=[],this.setColors()),this.listItems.splice(t,1),this.syncDisplayWithCurrentPopupElementInfo(),this.requestUpdate()}}><calcite-icon scale=s icon=x></calcite-icon></calcite-action></calcite-list-item>`}renderColorIcon(e){const{colors:t}=this;if(this.chartMediaInfo.type===I.P.LINE_CHART)return"";const o=this.chartMediaInfo.value.fields.indexOf(e.fieldName);return a.qy`<div class="color-icon" style=${(0,v.zl)({backgroundColor:t[o].toHex()})} slot=content-start @click=${()=>this.openColorPopover(e)} role=button tabindex=0 @keyup=${t=>{(" "===t.key||"Enter"===t.key)&&this.openColorPopover(e)}}></div>`}renderHorizontalOrientationSwitch(){const{popupState:e}=this,{_messages:t}=e;return this.chartMediaInfo.type!==I.P.BAR_CHART&&this.chartMediaInfo.type!==I.P.COLUMN_CHART?"":a.qy`<calcite-label layout=inline-space-between>${t.horizontalOrientation}<calcite-switch .checked=${this.chartMediaInfo.type===I.P.BAR_CHART} @calciteSwitchChange=${(0,m.d)(async()=>await this.handleChartSelection(this.orientationSwitchNode.value.checked?I.P.BAR_CHART:I.P.COLUMN_CHART),300)} ${(0,g.K)(this.orientationSwitchNode)}></calcite-switch></calcite-label>`}renderNormalizationSwitch(){const{popupState:e}=this,{_messages:t,layer:o}=e;return a.qy`<calcite-block-section class="normalization-block-section" .text=${t.normalize} toggle-display=switch .expanded=${!!this.chartMediaInfo.value.normalizeField} @calciteBlockSectionToggle=${()=>{this.normalizationBlockSectionNode.value.expanded?this.chartMediaInfo.value.normalizeField=this.tempNormalizedField:(this.tempNormalizedField=this.chartMediaInfo.value.normalizeField,this.chartMediaInfo.value.normalizeField=""),this.requestUpdate()}} ${(0,g.K)(this.normalizationBlockSectionNode)}><calcite-button class="normalize-by-button" alignment=icon-end-space-between icon-end=pencil appearance=outline-fill kind=neutral width=full title=${t.normalizeBy??v.s6} @click=${e=>{e.stopPropagation(),this.removePopovers(),this.colorButtonNode.value?.closePopover(),this.closeColorPopover();const{popupState:t}=this;this.normalizationFieldPickListNode||(this.normalizationFieldPickListNode=(0,v.dN)(a.qy`<arcgis-map-config-popup-field-pick-list .popoverProps=${{refElement:this.panelNode.value}} .selectedFields=${this.chartMediaInfo.value.normalizeField?[this.chartMediaInfo.value.normalizeField]:[]} numbers-only .popupState=${t} @arcgisChange=${e=>{e.stopPropagation();const t=e.detail.selectedFields[0];this.handleNormalizationFieldPickListNodeChange(t)}} @arcgisClose=${e=>{e.stopPropagation(),this.normalizationFieldPickListNode?.remove(),this.normalizationFieldPickListNode=void 0,this.panelNode.value.disabled=!1}}></arcgis-map-config-popup-field-pick-list>`),document.body.appendChild(this.normalizationFieldPickListNode),this.panelNode.value.disabled=!0)}} ${(0,g.K)(this.normalizationButtonNode)}>${this.fieldInfoMap.has(this.chartMediaInfo.value.normalizeField)?(0,f.j)(o,this.fieldInfoMap.get(this.chartMediaInfo.value.normalizeField),this.arcadeExpMap):t.normalizeBy}</calcite-button></calcite-block-section>`}renderDoneButton(){const{popupState:e}=this,{_messages:t}=e;return a.qy`<calcite-button appearance=outline-fill slot=footer width=full @click=${()=>this.closePopupPopovers.emit()}>${t.done}</calcite-button>`}}(0,i.c)("arcgis-map-config-popup-chart",P)},98295:(e,t,o)=>{o.d(t,{A:()=>a,C:()=>i,I:()=>r,P:()=>s});var i=(e=>(e.ATTRIBUTES="attributes",e.ATTACHMENTS="attachments",e.CHARTS="charts",e.IMAGES="images",e.RICH_TEXT="richText",e.ARCADE="arcade",e.RELATIONSHIP="relationship",e.ASSOCIATIONS="associations",e.EDIT_INFO_SUMMARY="editInfoSummary",e))(i||{}),a=(e=>(e.PREVIEW="preview",e.LIST="list",e.AUTO="auto",e))(a||{}),s=(e=>(e.IMAGE="image",e.BAR_CHART="bar-chart",e.COLUMN_CHART="column-chart",e.LINE_CHART="line-chart",e.PIE_CHART="pie-chart",e))(s||{}),r=(e=>(e.SOURCE_URL="sourceUrl",e.TITLE="title",e.CAPTION="caption",e.LINK_URL="linkUrl",e.ALT_TEXT="altText",e))(r||{})}}]);