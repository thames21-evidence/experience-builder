"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-6bf2b8"],{97396:(e,i,t)=>{t.r(i),t.d(i,{rfx_preview:()=>y});var r=t(92265),a=t(69843),s=(t(5294),t(13661),t(18423),t(21255),t(35431),t(38949)),o=t(85740),n=t(33797),l=t(80587),c=t(42335);t(23795),t(17902),t(56451),t(588),t(71802),t(44345),t(36596),t(33752),t(32513),t(55448),t(2924),t(11840),t(52373),t(440),t(66744),t(16035),t(51477),t(45253),t(73427);const h="action-button-container",d="action-button",w="preview-list",v="help-action",p="tooltip",y=class{constructor(e){(0,r.r)(this,e),this.rfxPreviewSelection=(0,r.c)(this,"rfxPreviewSelection"),this.previewHelpClick=(0,r.c)(this,"previewHelpClick"),this.openBlockInitially=!0,this.maxPreviewLayers=5,this.previewIndexCounter=1,this.previewLayers=[],this.showPreviewBlock=!1,this.createPreviewLayer=async()=>{await this.addToPreviewLayerList(),this.loadPreviewLayer()},this.updateLayerStatus=(e,i)=>{this.previewLayers=this.previewLayers.map(t=>(t.index===e&&(t.status=i),t))},this.handlePreviewSwitchChange=async e=>{const i=e.target.checked;if(this.showPreviewBlock=i,!1===this.showPreviewBlock)this.hidePreviewLayers();else{const e=this.getSelectedPreviewListItem(),i=await this.getTemplate();JSON.stringify(i)!==JSON.stringify(e?.data)?(5===this.previewLayers.length&&(this.removePreviewLayerFromMap(e?.layer),this.previewLayers=this.previewLayers.filter(e=>e.index!==this.selectedPreviewLayerIndex)),this.createPreviewLayer()):this.loadPreviewLayer()}},this.updatePreviewLayer=async()=>{const e=await this.getTemplate();this.previewLayers.forEach(i=>{i.index===this.selectedPreviewLayerIndex&&(i.data=e)}),this.loadPreviewLayer()},this.onPreviewSelect=e=>{this.hidePreviewLayers(),this.selectedPreviewLayerIndex=e.target?.value,this.showSelectedPreviewLayer()},this.onPreviewClose=e=>{const i=e.target?.value;this.removePreviewLayerFromMap(this.previewLayers.find(e=>e.index===i).layer),this.previewLayers=this.previewLayers.filter(e=>e.index!==i),0===this.previewLayers.length&&(this.showPreviewBlock=!1),this.selectedPreviewLayerIndex===i&&this.previewLayers.length>0&&(this.selectedPreviewLayerIndex=this.previewLayers[0].index,this.showSelectedPreviewLayer())},this.renderPreviewError=e=>(0,r.h)("div",{slot:"content-end"},(0,r.h)("calcite-button",{id:`preview-layer-load-error-${e}`,iconStart:"exclamation-mark-triangle",appearance:"transparent",kind:"neutral",scale:s.s.scale??n.U.Scale}),(0,r.h)("calcite-tooltip",{"reference-element":`preview-layer-load-error-${e}`,class:p,overlayPositioning:"fixed",placement:"leading"},(0,r.h)("span",null,this.strings.previewError))),this.renderPreviewLayers=()=>(0,r.h)("calcite-list",{class:w,loading:this.isPreviewLayerLoading(),selectionAppearance:"border",selectionMode:"single",dir:this.direction,label:""},this.previewLayers.map(e=>(0,r.h)("calcite-list-item",{key:`preview-layer-item${e.index}`,id:`preview-layer-item${e.index}`,dir:this.direction,label:e.label,value:e.index,selected:e.index===this.selectedPreviewLayerIndex,closable:!0,onCalciteListItemSelect:this.onPreviewSelect,onCalciteListItemClose:this.onPreviewClose},e.status===c.P.error&&this.renderPreviewError(e.index)))),this.renderPreviewSwitch=()=>(0,r.h)("calcite-label",{dir:this.direction,layout:"inline",scale:s.s.scale??n.U.Scale,ref:e=>{this.showPreviewElement=e}},(0,r.h)("calcite-switch",{checked:this.showPreviewBlock,onCalciteSwitchChange:this.handlePreviewSwitchChange,dir:this.direction,scale:s.s.scale??n.U.Scale}),this.strings.showPreview,(0,r.h)("calcite-action",{class:v,text:"show help",icon:"information",scale:s.s.scale??n.U.Scale,onClick:e=>{e.stopPropagation();const i=(0,l.e)(this.strings.previewPopup);this.previewHelpClick.emit({referenceElement:this.showPreviewElement,helpSrcdoc:i,heading:this.strings.showPreview})}}))}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,a.c)(this.hostElement,(0,r.d)(".")))}disconnectedCallback(){this.clearPreviewLayers()}async clearPreviewLayers(){return this.previewLayers.forEach(e=>{this.removePreviewLayerFromMap(e.layer)}),this.previewLayers=[],this.showPreviewBlock=!1,this.previewIndexCounter=1,Promise.resolve()}async addToPreviewLayerList(){const e=await this.getTemplate(),{previewIndexCounter:i}=this;this.previewLayers.push({index:i,label:(0,s.w)(this.strings.previewLayer,{number:i.toString()}),data:e,status:c.P.loading}),this.selectedPreviewLayerIndex=i,this.previewIndexCounter++}validateRFT(e){if((0,s.i)(e))return;const i=(0,s.M)(this.portal),t={renderingRule:JSON.stringify(e),f:"json"};return(0,s.r)(i,{query:t}).then(e=>e?.data?.renderingRule?.isValid,e=>{console.log("validate request failed",e)})}removePreviewLayerFromMap(e){(0,s.i)(e)||(e.visible=!1,e.opacity=0,this.mapView.map.remove(e))}async addPreviewLayerToMap(e,i){const t=(0,o.r)((0,s.N)(this.portal),e);i.status=c.P.loading;try{if(await t.load(),void 0!==i.layer&&this.removePreviewLayerFromMap(i.layer),i.layer=t,i.status=c.P.loading,!1===this.showPreviewBlock)return;this.mapView.map.add(t),this.mapView.whenLayerView(t).then(e=>{e.watch("updating",e=>{!1===e?this.updateLayerStatus(i.index,c.P.success):this.updateLayerStatus(i.index,c.P.loading)})})}catch(e){this.updateLayerStatus(i.index,c.P.error)}}hidePreviewLayers(){this.previewLayers.forEach(e=>{(0,s.i)(e.layer)||(e.layer.visible=!1)})}async loadPreviewLayer(){this.hidePreviewLayers();const e=this.getSelectedPreviewListItem();e.status=c.P.loading;const i=e.data;!0===(!0!==this.validateOnPreview||(await this.validateInputValues()).valid)&&(e.isValid=await this.validateRFT(i)),!1!==this.showPreviewBlock&&(e.isValid?(this.updateLayerStatus(e.index,c.P.success),await this.addPreviewLayerToMap(i,e)):this.updateLayerStatus(e.index,c.P.error))}removeAllPreviewLayersFromMap(){const e=this.mapView?.map?.allLayers.filter(e=>"imagery"===e.type&&e.title?.startsWith("RasterRendering"));this.mapView?.map?.removeMany(e?Array.from(e):[]),this.previewLayers=this.previewLayers.map(e=>(e.layer=void 0,e))}showSelectedPreviewLayer(){this.rfxPreviewSelection.emit(this.getSelectedPreviewListItem().data);const e=this.getSelectedPreviewListItem();void 0!==e?.layer?e.layer.visible=!0:this.loadPreviewLayer()}getSelectedPreviewListItem(){return void 0===this.selectedPreviewLayerIndex?this.previewLayers[0]:this.previewLayers.find(e=>e.index===this.selectedPreviewLayerIndex)}isPreviewLayerLoading(){return this.previewLayers.some(e=>e.status===c.P.loading)}renderActions(){const e=this.isPreviewLayerLoading(),i=this.previewLayers.length===this.maxPreviewLayers||e;return(0,r.h)("div",{class:h},(0,r.h)("calcite-button",{id:"preview-update-button",class:d,kind:"neutral",appearance:"outline-fill",iconStart:"refresh",onClick:this.updatePreviewLayer,dir:this.direction,scale:s.s.scale??n.U.Scale,disabled:e},this.strings.update),(0,r.h)("calcite-tooltip",{placement:"bottom-start","reference-element":"preview-update-button",overlayPositioning:"fixed"},(0,r.h)("span",null,this.strings.updatePopover)),(0,r.h)("calcite-button",{id:"preview-create-button",class:d,kind:"neutral",appearance:"outline-fill",iconStart:"plus",dir:this.direction,onClick:()=>{!1===i&&this.createPreviewLayer()},disabled:i,scale:s.s.scale??n.U.Scale},this.strings.newPreview),(0,r.h)("calcite-tooltip",{placement:"bottom-start","reference-element":"preview-create-button",overlayPositioning:"fixed"},(0,r.h)("span",null,i?(0,s.w)(this.strings.maxPreview,{maxCount:this.maxPreviewLayers.toString()}):this.strings.createPopover)))}render(){return(0,r.h)("calcite-block",{key:"d4f86764b4d61179fab18fbf85174d9912baa9cf",collapsible:!0,heading:this.strings.header,description:this.strings.description,open:this.openBlockInitially,dir:this.direction},this.renderPreviewSwitch(),this.showPreviewBlock&&this.renderPreviewLayers(),this.showPreviewBlock&&this.renderActions())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.a)(this)}};y.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.action-button-container{display:flex;justify-content:space-between}.action-button{width:48%}.preview-list{padding:var(--rfx-full-spacing) 0 var(--rfx-full-spacing) 0;--calcite-font-size--1:var(--calcite-font-size--2)}.help-action{-webkit-margin-start:auto;margin-inline-start:auto}.tooltip{position:fixed !important;z-index:100}"}}]);