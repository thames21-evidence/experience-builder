/*! For license information please see arcgis_analysis_node_modules_arcgis_common-components_dist_components_arcg-a06f7a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_common-components_dist_components_arcg-a06f7a"],{10117:(e,i,t)=>{t.r(i),t.d(i,{ArcgisCommonSqlExpressionConfigExpression:()=>x});var o=t(22229),n=t(4395),s=t(73801),r=t(85643),c=t(20936),a=t(80666),d=(t(52797),t(5294),t(24186));t(34031),t(43284);const l=n.AH`.expression-block{margin:0 var(--calcite-spacing-sm);border:var(--calcite-border-width-sm) solid var(--calcite-color-border-3)}.content{padding-bottom:var(--calcite-spacing-xs)}.match-type-text{display:flex;justify-content:flex-start;margin:var(--calcite-spacing-xs) var(--calcite-spacing-sm) 0 var(--calcite-spacing-sm)}:dir(rtl){.match-type-text{justify-content:flex-end}}.match-type-text-empty{margin:var(--calcite-spacing-sm-plus) 0 0 0}.match-condition{border-bottom:1px solid var(--calcite-color-border-3);padding-bottom:18px}.match-condition-dropdown{width:100%}.add-condition-button{display:flex}`,u="expression-block",p="add-condition-button",h="content",m="match-type-text",g="match-type-text-empty",v="match-condition",f="match-condition-dropdown";class x extends s.WF{constructor(){super(...arguments),this.menuNode=(0,r._)(),this.hideRemove=!1,this.hideDuplicate=!1,this.showAddConditionButton=!1,this.arcgisDisablePanel=(0,s.lh)(),this.arcgisExpressionChanged=(0,s.lh)()}static{this.properties={props:0,uid:1,conditions:0,logicalOperatorForConditions:[0,{attribute:"operator"}],hideRemove:5,hideDuplicate:5,showAddConditionButton:5}}static{this.styles=l}async onEdits(){this.el.shadowRoot?.querySelectorAll("arcgis-common-sql-expression-config-condition").forEach(e=>e.onEdits())}async closePopover(){this.el.shadowRoot?.querySelectorAll("arcgis-common-sql-expression-config-condition")?.forEach(e=>e.closePopover())}load(){this.conditions=this.conditions||[]}onAddCondition(){const{props:e,conditions:i}=this,t=(0,d.r)(e),o=(0,d.s)(e,t),n=(0,d.t)(e,t,o),s={fieldName:t.layerField.name,operator:(0,d.s)(e,t),...n,hasFocus:!0};i.forEach(e=>e.hasFocus=!1),this.conditions=[...i,s],e.expressions=e.expressions.map(e=>e.uid===this.uid?{...e,conditions:this.conditions}:{...e}),this.fixUIDsForExpression(),this.menuNode.value.open=!1,this.emitChangeEvent()}onRemoveCondition(e){const{props:i,conditions:t}=this;t.forEach(e=>e.hasFocus=!1);let o=0;this.conditions=t.filter((i,t)=>!i||t!==e||(o=t,!1)),this.conditions[Math.max(0,o-1)].hasFocus=!0,i.expressions=i.expressions.map(e=>e.uid===this.uid?{...e,conditions:this.conditions}:{...e}),this.fixUIDsForExpression(),this.emitChangeEvent()}onMatchSelect(e){const i=e.target.selectedOption.value;this.logicalOperatorForConditions=i,this.emitChangeEvent()}onCopyExpression(){const{uid:e,conditions:i,logicalOperatorForConditions:t}=this,o={uid:e,conditions:i,logicalOperatorForConditions:t};this.menuNode.value.open=!1,this.arcgisExpressionChanged.emit({type:"copy",uid:this.uid,expression:o})}onRemoveExpression(){this.arcgisExpressionChanged.emit({type:"delete",uid:this.uid})}fixUIDsForExpression(){const{props:e}=this;e.expressions=(0,a.f)(e.expressions),this.conditions=e.expressions.find(e=>e.uid===this.uid).conditions}emitChangeEvent(){const{uid:e,conditions:i,logicalOperatorForConditions:t}=this,o={uid:e,conditions:i,logicalOperatorForConditions:t};this.arcgisExpressionChanged.emit({type:"replace",expression:o})}render(){const{props:e,conditions:i}=this,{_messages:t}=e,o=(0,c.Qp)(this.el);return(0,s.Bq)(this.el,"dir",o),n.qy`<calcite-block .heading=${1===i.length?t.condition:t.conditionSet} expanded class=${(0,s.CP)(u)}>${this.renderMenu()}${this.renderMatchCondition()}${this.renderConditions()}${this.renderAddConditionButton()}</calcite-block>`}renderMenu(){const{props:e,hideDuplicate:i,hideRemove:t,conditions:o}=this,{_messages:s}=e;return n.qy`<calcite-action-menu slot=control placement=bottom-end overlay-positioning=fixed .label=${s.accessibility.moreOptions} @calcitePopoverClose=${e=>e.stopPropagation()} ${(0,r.K)(this.menuNode)}>${!t&&n.qy`<calcite-action .text=${1===o.length?s.deleteExpression:s.deleteSet} text-enabled data-value=remove @click=${this.onRemoveExpression}></calcite-action>`||""}${!i&&n.qy`<calcite-action .text=${s.duplicate} text-enabled data-value=copy @click=${this.onCopyExpression}></calcite-action>`||""}<calcite-action .text=${s.addCondition} text-enabled data-value=add @click=${this.onAddCondition}></calcite-action></calcite-action-menu>`}renderMatchCondition(){const{conditions:e,logicalOperatorForConditions:i,props:t}=this,{_messages:o}=t;if(!e?.length||1===e.length)return;const r=i!==a.l.OR;return n.qy`<div class=${(0,s.CP)(v)}><calcite-select width=full scale=m .label=${o.accessibility.matchType} class=${(0,s.CP)(f)} @calciteSelectChange=${this.onMatchSelect}><calcite-option .value=${a.l.AND} .label=${o.matchAll} .selected=${r}></calcite-option><calcite-option .value=${a.l.OR} .label=${o.matchAtLeastOne} .selected=${!r}></calcite-option></calcite-select></div>`}renderConditions(){const{conditions:e}=this;return n.qy`<div class=${(0,s.CP)(h)}>${e.map((e,i)=>this.renderCondition(e,i))}</div>`}renderCondition(e,i){const{conditions:t,props:o}=this;return n.qy`<div>${this.renderConditionHeader(i)}<arcgis-common-sql-expression-config-condition .props=${o} .showDelete=${t.length>1} .uid=${e.uid} .operator=${e.operator} .fieldName=${e.fieldName} .value=${e.value} .value2=${e.value2} .values=${e.values} .uniqueValuesSortBy=${e.uniqueValuesSortBy} .unit=${e.unit} .histogramClosed=${e.histogramClosed} .hasFocus=${e.hasFocus} .invalidValue=${e.invalidValue} @arcgisDeleted=${()=>this.onRemoveCondition(i)} @arcgisChanged=${e=>{const{conditions:i}=this,{detail:t}=e;this.conditions=i.map(e=>e.uid===t.uid?t:e),this.emitChangeEvent()}} @arcgisDisablePanel=${e=>{e.stopPropagation();const i=e.detail;this.arcgisDisablePanel.emit(i)}}></arcgis-common-sql-expression-config-condition></div>`}renderAddConditionButton(){return this.showAddConditionButton&&n.qy`<calcite-button alignment=center appearance=transparent class=${(0,s.CP)(p)} icon-start=plus scale=s @click=${this.onAddCondition}>${this.props._messages.addCondition}</calcite-button>`||""}renderConditionHeader(e){const{props:i,logicalOperatorForConditions:t,conditions:o}=this,{_messages:r}=i;if(o.length<2)return;const c=t!==a.l.OR;return n.qy`<div>${e>0?n.qy`<span class=${(0,s.CP)(m)}>${c?r.and:r.or}</span>`:o.length>1?n.qy`<div class=${(0,s.CP)(g)}></div>`:null}</div>`}}(0,o.c)("arcgis-common-sql-expression-config-expression",x)},20936:(e,i,t)=>{function o(e){return function(e,i){return function(e,i){const t=e.assignedElements({flatten:!0});return i?t.filter(e=>e.matches(i)):t}(e.target,i)}(e).length>0}t.d(i,{Ly:()=>n,Qp:()=>d,Yt:()=>s,Zj:()=>l,el:()=>a,ti:()=>o});const n=(...e)=>{const i=[];for(let t=0;t<e.length;t++){const o=e[t];if("string"==typeof o)i.push(o);else if(Array.isArray(o))i.push.apply(i,o);else if("object"==typeof o)for(const e in o)o[e]&&i.push(e)}const t=i.join(" ");return i.length=0,t},s=(e,i,t)=>(0,c(i).subscribe)(i=>{const o=i.some(i=>((e,i)=>{let t=e;for(;t;){if(t===i)return!0;if(!t.parentNode)return!1;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1})(e,i.target));o&&t()}),r={},c=e=>{const i=e.join(","),t=r[i];if(void 0!==t)return t;const o=new Set,n=new MutationObserver(e=>o.forEach(i=>i(e)));globalThis.document&&n.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const s={subscribe:e=>(o.add(e),()=>{o.delete(e),0===o.size&&(n.disconnect(),r[i]=void 0)})};return r[i]=s,s},a=(e,i)=>{let t=e;for(;t;){const e=t.closest?.(i);if(e)return e;const o=t.getRootNode?.();if(o===globalThis.document)return;t=o.host}};const d=e=>l(e,"dir","ltr"),l=(e,i,t)=>{const o=a(e,`[${i}]`);return o?.getAttribute(i)??t}},80666:(e,i,t)=>{t.d(i,{a:()=>d,b:()=>s,c:()=>l,d:()=>r,f:()=>u,i:()=>a,l:()=>o,s:()=>n,t:()=>c});var o=(e=>(e.AND="and",e.OR="or",e))(o||{}),n=(e=>(e.NUMBER="number",e.STRING="string",e.DATE="date",e.DATE_ONLY="date-only",e.TIME_ONLY="time-only",e.OID="oid",e.GUID="guid",e.DOMAIN="domain",e))(n||{}),s=(e=>(e.MISSING="missing",e.IN_PROGRESS="inProgress",e.SUCCESS="success",e.FAILED="failed",e))(s||{}),r=(e=>(e.MINUTE="minute",e.HOUR="hour",e.DAY="day",e.WEEK="week",e.MONTH="month",e.YEAR="year",e))(r||{}),c=(e=>(e[e.MINUTE=6e4]="MINUTE",e[e.HOUR=36e5]="HOUR",e[e.DAY=864e5]="DAY",e[e.WEEK=6048e5]="WEEK",e[e.MONTH=2592e6]="MONTH",e[e.YEAR=31104e6]="YEAR",e))(c||{});function a(e){return null!=e}function d(e){if(!e?.filter)return!0;const i=e.filter;return!(i.geometry||i.objectIds||i.timeExtent||i.where)}function l(e){const{layer:i,mapImageSublayer:t,mode:o}=e,n="url"in i?i.url:void 0;if(e.supportsStandardizedQuery="version"in i&&null!=i.version&&i.version>=10.2&&!!i.capabilities?.query?.supportsStandardizedQueriesOnly,e.supportedSqlParserVersion="feature"===i.type&&e.supportsStandardizedQuery&&i.sourceJSON.sqlParserVersion&&"ES_10.6.1"!==i.sourceJSON.sqlParserVersion,"layer-view"===o&&"capabilities"in i&&null!=i.capabilities&&"query"in i.capabilities&&(e.supportsCurrentUser=i.capabilities?.query?.supportsCurrentUser),!n||t)return void(e.isHosted=!1);const s=n.includes(".arcgis.com/"),r=n.includes("//services")||n.includes("//tiles")||n.includes("//features")||n.includes("//locationservices")||n.includes("//us-iot")||n.includes("//eu-iot");e.isHosted=s&&r||!s&&!1}function u(e){return e?.length?e.map((e,i)=>e.uid===`expression-${i}`?{...e,conditions:e.conditions.map((e,t)=>{const o=`condition-${i}-${t}`;return e.uid===o?e:{...e,uid:o}})}:{...e,uid:`expression-${i}`,expressionIndex:i,conditions:e.conditions.map((e,t)=>{const o=`condition-${i}-${t}`;return e.uid===o?e:{...e,uid:o}})}):e}}}]);