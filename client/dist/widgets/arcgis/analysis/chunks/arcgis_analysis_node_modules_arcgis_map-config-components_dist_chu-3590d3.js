/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-3590d3.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-3590d3"],{5589:(e,a,t)=>{t.d(a,{a:()=>o,b:()=>l,g:()=>r,s:()=>c});var i=t(5294),s=(t(52797),t(54312),t(44345),t(55448),t(34031),t(63438),t(5933),t(28927),t(83368),t(89704),t(66228)),n=(t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(1225));t(83552),t(77462),t(49403),t(66617),t(10628),t(59640),t(64451),t(6176),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(6238),t(7299);function l(e){const{mapView:a}=e,t=(0,n.g)(e),i=t.authoringInfo,l="class-breaks"===t.type?t.classBreakInfos:t.uniqueValueInfos,o=(0,n.c)(t,"size"),r=(0,n.p)(t,"reference-size"),d=(0,n.p)(t,"spike"),u=!!o&&!(0,s.i)(o.minSize),p=!!o&&"number"==typeof o.minSize,m="above-and-below"===i?.univariateTheme;let h=2,g=20;if(r)r.referenceSizeScale&&c(e),[h,g]=[r.sizeStops[0].size,r.sizeStops[1].size];else if(d)[h,g]=[d.sizeStops[0].size,d.sizeStops[1].size];else if(o)if(m){const e=o.stops;[h,g]=[e[2].size,Math.max(e[0].size,e[4].size)]}else if(u){const e=o.stops;[h,g]=[e[0].size,e[e.length-1].size]}else if(p)[h,g]=[o.minSize,o.maxSize];else{const e=a.scale,t=o.minSize.stops,i=o.maxSize.stops;[h,g]=[t[t.length-1].size,i[i.length-1].size];for(let a=0;a<t.length;a++){const s=t[a],n=i[a];if(e<=s.value){if(a>0){const l=t[a-1],o=i[a-1],r=(e-l.value)/(s.value-l.value);[h,g]=[l.size+(s.size-l.size)*r,o.size+(n.size-o.size)*r]}else[h,g]=[t[0].size,i[0].size];break}}}else if(l){const e=l[0].symbol,a=l[l.length-1].symbol;[h,g]=[(0,n.w)(e),(0,n.w)(a)],h>g&&([h,g]=[g,h])}return[h,g]}function o(e,a){const{mapView:t}=e,o=(0,n.g)(e),r=(0,n.c)(o,"size");let c=a[0],d=(0,s.i)(a[1])?a[1]:c;if(r){const n="above-and-below"===o.authoringInfo?.univariateTheme,u=!!r&&!(0,s.i)(r.minSize),p=!!r&&"number"==typeof r.minSize,[m,h]=l(e),g=m>h;if(!g&&c>=h?c=h-.75:g&&c>=m&&(c=m-.75),!g&&m>=d?d=m+.75:g&&h>=d&&(d=h+.75),n){const e=r.stops,t=g?a[1]:a[0],i=g?a[0]:a[1],s=Math.max(...e.map(e=>e.value)),n=e[2].value,l=Math.min(...e.map(e=>e.value)),o=Math.abs(s-n),c=Math.abs(l-n),d=o>c?o:c,u=i-t;e.forEach(e=>{const{value:a}=e;e.size=Math.abs(a-n)/d*u+t})}else if(u){const e=r.stops;r.stops=null,r.minSize=c,r.maxSize=d,r.minDataValue=e[0].value,r.maxDataValue=e[e.length-1].value}else if(p)g?(r.maxSize=c,r.minSize=d):(r.minSize=c,r.maxSize=d);else{const e=t.scale;let a=i.clone(r.minSize.stops),s=i.clone(r.maxSize.stops);g&&([a,s]=[s,a]);let n=c/a[a.length-1].size,l=d/s[s.length-1].size;for(let t=0;t<a.length;t++){const i=a[t],o=s[t];if(e<=i.value){if(t>0){const r=a[t-1],u=s[t-1],p=(e-r.value)/(i.value-r.value),[m,h]=[r.size+(i.size-r.size)*p,u.size+(o.size-u.size)*p];n=c/m,l=d/h}else n=c/a[0].size,l=d/s[0].size;break}}a.forEach(e=>e.size=Math.round(n*e.size*10)/10),s.forEach(e=>e.size=Math.round(l*e.size*10)/10),g&&([a,s]=[s,a]),r.minSize.stops=a,r.maxSize.stops=s}}else{const e=o.classBreakInfos[0].symbol,a=o.classBreakInfos[o.classBreakInfos.length-1].symbol;let t=(0,n.w)(e),i=(0,n.w)(a),s=!1;t>i&&([t,i]=[i,t],s=!0),t!==i&&c>i&&(c=i-.75),t=c,t!==i&&t>d&&(d=t+.75),i=d;const l=i-t,r=1===o.classBreakInfos.length?1:l/(o.classBreakInfos.length-1);o.classBreakInfos.forEach((e,a)=>{const l=e.symbol;s?(0,n.u)(l,i-r*a):(0,n.u)(l,t+r*a)})}}function r(e,a){const t=e.stops,i=t.length-1,s=t[0].value,n=t[i].value;if(a<=s)return t[0].size;if(a>=n)return t[i].size;for(let e=0;e<=i;e++){const i=t[e],s=t[e+1];if(a>=i.value&&a<s.value){const e=s.value-i.value,t=i.size-s.size,n=(a-i.value)/e,l=i.size-t*n;return Math.round(100*l)/100}}return 1}function c(e){const{mapView:a}=e,t=(0,n.g)(e),i=(0,n.p)(t,"reference-size"),s=i.referenceSizeScale/a.scale;i.sizeStops.forEach(e=>e.size*=s),i.referenceSizeScale=a.scale}},13438:(e,a,t)=>{t.r(a),t.d(a,{ArcgisMapConfigSmartMappingPanelsPredominance:()=>S});var i=t(73679),s=t(4395),n=t(46317),l=t(5294),o=t(75698),r=t(56451),c=t(41631),d=t(64451),u=t(1225),p=t(89989),m=(t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(89704),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(65595)),h=t(96333),g=(t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(18383)),f=(t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(28927),t(6238),t(7299),t(85643)),y=t(73801);const b=s.AH`:host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.predominance-block{overflow-x:hidden}.default-value-toggle{margin-left:-9px}.default-symbol{display:flex}.hidden{display:none}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.symbol{min-width:26px;display:flex;margin-left:3px}.symbol div,.default-symbol div{margin:auto}.symbol-is-white{background-color:#f3f3f3}.text-wrap{overflow-wrap:anywhere}.top-grey-border{border-top:1px solid #e0e0e0}.list-item-top-grey-border{border-top:1.5px solid #e0e0e0}:dir(rtl){.default-value-toggle{margin-right:-9px;margin-left:auto}.symbol{margin-right:3px;margin-left:auto}}`;class S extends y.WF{constructor(){super(...arguments),this.flowItemNode=(0,f._)(),this.valueSymbolNodes=[],this.labelNodes=[],this.inputNodes=[],this.listNode=(0,f._)(),this.defaultListNode=(0,f._)(),this.rotationNode=(0,f._)(),this.maxCountOtherValues=200,this.popoverSettings={},this.smartMappingState=(0,m.u)(),this.visualizationOpen=!1,this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisSmartMappingPanelsPredominanceBackClick=(0,y.lh)(),this.arcgisSmartMappingPanelsPredominanceClose=(0,y.lh)(),this.arcgisSmartMappingPanelsPredominanceError=(0,y.lh)(),this.arcgisSmartMappingPanelsPredominanceRegenerateRenderer=(0,y.lh)(),this.smartMappingCompleteClose=(0,y.lh)()}static{this.properties={visualizationOpen:16,hideRotation:5,hideTransparency:5,menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=b}async setFocus(){await(this.flowItemNode.value?.setFocus())}async load(){const{layer:e,_messages:a}=this.smartMappingState,t=e,i=(0,u.g)(this.smartMappingState);return this.smartMappingState.lastDefault={defaultSymbol:i.defaultSymbol||(0,u.e)(this.smartMappingState),defaultLabel:i.defaultLabel||a.panels.predominance.other},this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in t&&t.featureReduction?l.clone(t.featureReduction):void 0,this.originalOrderBy="knowledge-graph-sublayer"!==t.type&&"subtype-sublayer"!==t.type?t.orderBy??void 0:void 0,this.visualizationOpen=!0,await new Promise((e,a)=>{(0,g.g)(this.smartMappingState,{fieldInfos:i.uniqueValueGroups[0].classes.map(e=>({field:e.values[0].value,simpleFieldType:u.J.NUMBER}))}).then(a=>{this.predominantCategoryInfos=a.predominantCategoryInfos,e(a.predominantCategoryInfos)}).catch(e=>{this.arcgisSmartMappingPanelsPredominanceError.emit({message:e,type:"error"}),a(new Error(e))})})}async loaded(){requestAnimationFrame(async()=>await(this.flowItemNode.value?.setFocus())),this.scaleHandle=(0,p.w)(this.smartMappingState,this.flowItemNode.value,()=>this.smartMappingCompleteClose.emit("cancel"))}updated(){this.updateNodeHandles(this.listNode.value),this.updateNodeHandles(this.defaultListNode.value)}disconnectedCallback(){super.disconnectedCallback(),this.popoverSettings?.popoverNode?.remove(),this.smartMappingState.lastDefault=void 0,this.smartMappingState.selectedValue=void 0,this.scaleHandle?.remove()}updateNodeHandles(e){e&&queueMicrotask(()=>{e.querySelectorAll(".symbol").forEach(e=>{const a=Number.parseInt(e.getAttribute("data-value"));this.valueSymbolNodes[a]=e,this.createValueSymbol(a,e)}),e.querySelectorAll(".default-symbol").forEach(e=>{this.defaultSymbolNode=e,this.createValueSymbol(-1,e)}),e.querySelectorAll(".input").forEach(e=>{const a=Number.parseInt(e.getAttribute("data-value"));a>-1?this.inputNodes[a]=e:this.defaultInputNode=e}),e.querySelectorAll(".label").forEach(e=>{const a=Number.parseInt(e.getAttribute("data-value"));a>-1?this.labelNodes[a]=e:this.defaultLabelNode=e})})}handleDone(){(0,u.f)(),this.arcgisSmartMappingPanelsPredominanceClose.emit("save")}async createValueSymbol(e,a){const{smartMappingState:t}=this,{lastDefault:i}=t,s=(0,u.g)(t);let n;if(n=-1===e?s.defaultSymbol||i.defaultSymbol:s.uniqueValueGroups[0].classes[e].symbol.clone(),n){const e=await c.renderPreviewHTML(n,{size:(0,u.ac)(n),symbolConfig:"cim"===n.type&&"CIMPolygonSymbol"===n.data.symbol.type?{isSquareFill:!0}:void 0});a.replaceChildren(e)}}getPredominantCategoryValue(e){if(!this.predominantCategoryInfos)return;const a=this.predominantCategoryInfos.filter(a=>a.value==e);return a?.length?a[0]:void 0}handleSortValues(e){const{smartMappingState:a}=this;(0,u.f)();const t=e.map(e=>e.value),i=(0,u.g)(a),s=i.uniqueValueGroups[0].classes.filter(e=>t.includes(`${e.values[0].value}`)).map(e=>l.clone(e));s.sort((e,a)=>t.indexOf(e.values[0].value)-t.indexOf(a.values[0].value)),i.uniqueValueGroups[0].classes=s,(0,u.a4)(a),this.requestUpdate()}handleValueSymbolClick(e){this.popoverSettings?.popoverNode?((-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e])?.classList.remove("selected"),this.popoverSettings.index===e?((0,u.f)(),this.popoverSettings.popoverNode=void 0,this.popoverSettings.index=void 0):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}handleValueTextChange(e,a){const{smartMappingState:t}=this,{lastDefault:i,_messages:s}=t,n=(0,u.g)(t),l=o.fromJSON(this.originalRendererJSON);a.length||(a=-1===e?l.defaultLabel||s.panels.predominance.other:l.uniqueValueGroups[0].classes.find(a=>a.values[0].value===n.uniqueValueGroups[0].classes[e].values[0].value).label),-1===e?(n.defaultLabel=a,i.defaultLabel=a):n.uniqueValueGroups[0].classes[e].label=a;const r=-1===e?this.defaultInputNode:this.inputNodes[e],c=-1===e?this.defaultLabelNode:this.labelNodes[e];r&&c&&(r.classList.add("hidden"),c.classList.remove("hidden"),c.focus(),this.smartMappingState.selectedValue=void 0),(0,u.a4)(t)}openSymbolStylerForValue(e){const{smartMappingState:a}=this;(0,u.f)();const t=-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e];this.popoverSettings.popoverNode=(0,y.dN)(s.qy`<arcgis-map-config-smart-mapping-symbol-styler-popover .referenceElement=${this.flowItemNode.value} .heading=${a._messages.styler.symbolStyle} .smartMappingState=${a} @arcgisSmartMappingSymbolStylerPopoverClose=${()=>{this.popoverSettings.popoverNode?.remove(),this.popoverSettings.popoverNode=void 0,setTimeout(()=>t?.focus(),300),t?.classList.remove("selected")}} @arcgisSmartMappingSymbolStylerPopoverDisconnected=${()=>{this.popoverSettings.popoverNode?.remove(),this.popoverSettings.popoverNode=void 0,t?.classList.remove("selected")}}></arcgis-map-config-smart-mapping-symbol-styler-popover>`),document.body.appendChild(this.popoverSettings.popoverNode),this.smartMappingState.selectedValue=e,(0,h.c)(a,{symbolStylerPopoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,u.a4)(a),this.requestUpdate(),this.rotationNode.value&&this.rotationNode.value.manager.component.requestUpdate()}}),t?.classList.add("selected")}render(){const{hideLayerTitle:e,layer:a,mapImageSublayer:t,_messages:i}=this.smartMappingState,n=e?void 0:t?.title??a.title;return this.el.classList.add("calcite-match-height"),s.qy`<calcite-flow-item class="flow-item" .heading=${i.panels.predominance.styleOptions} .description=${n} .closable=${(0,u.aa)(this.el)} .showBackButton=${this.showBackButton} .selected=${this.selected} @calciteFlowItemClose=${this.handleDone} @calciteFlowItemBack=${e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsPredominanceBackClick.emit()}} ${(0,f.K)(this.flowItemNode)}>${this.renderVisualization()}${this.renderTransparency()}${this.renderRotation()}${this.renderDone()}${this.renderCancel()}</calcite-flow-item>`}renderVisualization(){const{_messages:e}=this.smartMappingState,a=!this.hideTransparency||!this.hideRotation;return s.qy`<calcite-block class="predominance-block" .heading=${e.panels.predominance.predominanceStyle} .collapsible=${a} .expanded=${this.visualizationOpen} @calciteBlockOpen=${()=>this.visualizationOpen=!0} @calciteBlockClose=${()=>this.visualizationOpen=!1}>${this.renderPredominanceSymbol()}${this.renderDrawingOrder()}${this.renderValues()}${this.renderMsg()}${this.renderBackgroundStyle()}</calcite-block>`}renderPredominanceSymbol(){const{smartMappingState:e}=this,{mapView:a}=e,t=(0,u.g)(e).uniqueValueGroups[0].classes,i=d.getSchemes({basemap:a.map?.basemap,geometryType:(0,u.j)(e),numColors:t.length}),n=(0,u.k)(i,Math.min(t.length,10))[0].colors,l=t?.length?t.slice(0,10).map((e,a)=>(0,u.i)(e.symbol)||new r.default(n[a%n.length])):[];return s.qy`<arcgis-map-config-smart-mapping-symbol-button type=predominance-ramp .colors=${l} ramp-type=discrete .popoverReferenceElement=${this.flowItemNode.value} @arcgisSmartMappingSymbolButtonSymbolChange=${()=>{this.requestUpdate(),this.rotationNode.value&&this.rotationNode.value.manager.component.requestUpdate()}}></arcgis-map-config-smart-mapping-symbol-button>`}renderDrawingOrder(){const{smartMappingState:e}=this,{layer:a,mapImageSublayer:t,_messages:i}=e;if(t||"catalog-footprint"===a.type||"knowledge-graph-sublayer"===a.type)return"";const n=(0,u.g)(e);return s.qy`<calcite-label layout=inline-space-between>${i.panels.predominance.drawingOrder}<calcite-switch .checked=${n.orderByClassesEnabled} @calciteSwitchChange=${a=>{const t=a.target;(0,u.f)();const i=e.layer;(0,u.g)(e).orderByClassesEnabled=t.checked,i.orderBy=t.checked?void 0:this.originalOrderBy,(0,u.a4)(e)}}></calcite-switch></calcite-label>`}renderValues(){const{smartMappingState:e}=this,{lastDefault:a,_messages:t}=e,i=(0,u.g)(e),n=i.defaultLabel||a?.defaultLabel;return s.qy`<calcite-label>${t.panels.predominance.fieldName}</calcite-label><calcite-list .label=${t.panels.predominance.fieldName} class="top-grey-border" drag-enabled @calciteListOrderChange=${e=>{const a=Array.from(e.target.children);this.handleSortValues(a)}} ${(0,f.K)(this.listNode)}>${i.uniqueValueGroups[0].classes.map((e,a)=>this.renderValue(e,a))}</calcite-list><calcite-list .label=${n} ${(0,f.K)(this.defaultListNode)}>${this.renderDefaultValue()}</calcite-list>`}renderValue(e,a){return s.qy`<calcite-list-item scale=s .value=${e.values[0].value}>${this.renderSymbolNode(e,a)}${this.renderTextNode(e,a)}${this.renderCountNode(e)}</calcite-list-item>`}renderSymbolNode(e,a){const{smartMappingState:t}=this,{selectedValue:i,_messages:n}=t,l={"default-symbol":-1===a,symbol:a>-1,"symbol-is-white":(0,u.ad)(e.symbol)};return s.qy`<div class=${(0,y.CP)(l)} slot=content-start role=button tabindex=0 .ariaLabel=${n.panels.predominance.accessibility.editSymbolFor.replace("${value}",e.label)} aria-haspopup=true .ariaExpanded=${i===a} data-value=${a??y.s6} @click=${()=>this.handleValueSymbolClick(a)} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(a))}}></div>`}renderTextNode(e,a){const{_messages:t}=this.smartMappingState;return s.qy`<div .ariaLabel=${t.panels.predominance.accessibility.editLabelFor.replace("${fieldName}",e.label)} class="label text-wrap" slot=content tabindex=0 data-value=${a??y.s6} @click=${e=>{this.smartMappingState.selectedValue=a,e.target.classList.add("hidden");const t=-1===a?this.defaultInputNode:this.inputNodes[a];t.classList.remove("hidden"),t.setFocus()}} @keydown=${e=>{if(" "===e.key||"Enter"===e.key){e.preventDefault(),e.stopPropagation(),this.smartMappingState.selectedValue=a,e.target.classList.add("hidden");const t=-1===a?this.defaultInputNode:this.inputNodes[a];t.classList.remove("hidden"),t.setFocus()}}}>${e.label}</div><calcite-input class="input hidden" slot=content .value=${e.label??void 0} data-value=${a??y.s6} @focusout=${e=>{const t=e.currentTarget;if(this.handleValueTextChange(a,t.value),e.relatedTarget?.className.includes("symbol")){const a=Number.parseInt(e.relatedTarget.getAttribute("data-value"));setTimeout(()=>this.handleValueSymbolClick(a),100)}}} @keydown=${e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const t=e.currentTarget;this.handleValueTextChange(a,t.value)}}}></calcite-input>`}renderCountNode(e){const{_messages:a}=this.smartMappingState,t=this.getPredominantCategoryValue(e.values[0].value);return t&&(0,u.V)(t.count)?s.qy`<div slot=content-end class="value-count" .ariaLabel=${a.panels.predominance.accessibility.countFor.replace("${value}",e.label)}>${`${t.count}`}</div>`:""}renderDefaultValue(){const{smartMappingState:e}=this,{lastDefault:a,_messages:t}=e,i=(0,u.g)(e),l=i.defaultSymbol||a?.defaultSymbol,o=i.defaultLabel||a?.defaultLabel,r=this.getPredominantCategoryValue();return s.qy`<calcite-list-item class="top-grey-border">${(0,n.D)(!!i.defaultSymbol,s.qy`<calcite-switch class="default-value-toggle" slot=actions-start .checked=${!!i.defaultSymbol} @click=${()=>{(0,u.f)(),i.defaultSymbol?i.defaultSymbol=void 0:(i.defaultSymbol=a.defaultSymbol,i.defaultLabel=a.defaultLabel),(0,u.a4)(e)}} @keydown=${t=>{(" "===t.key||"Enter"===t.key)&&(i.defaultSymbol?i.defaultSymbol=void 0:(i.defaultSymbol=a.defaultSymbol,i.defaultLabel=a.defaultLabel),(0,u.a4)(e))}}></calcite-switch>`)}${this.renderSymbolNode({symbol:l,label:o},-1)}${this.renderTextNode({symbol:l,label:o},-1)}<div slot=content-end .ariaLabel=${t.panels.predominance.accessibility.countFor.replace("${value}",o)}>${`${r&&(0,u.V)(r.count)?r.count:0}`}</div></calcite-list-item>`}renderMsg(){const{smartMappingState:e}=this,{lastDefault:a,_messages:t}=e,i=(0,u.g)(e);return i.uniqueValueGroups[0].classes&&i.uniqueValueGroups[0].classes.length>this.maxCountOtherValues?s.qy`<div>${t.panels.predominance.tooManyValues.replace("${count}",this.maxCountOtherValues.toString())}</div>`:i.uniqueValueGroups[0].classes.length?"":s.qy`<div>${t.panels.predominance.noFeatures.replace("${other}",a.defaultLabel)}</div>`}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:a}=e;return"predominance-size"!==(0,u.d)(e)||a?"":s.qy`<arcgis-map-config-smart-mapping-background-symbol></arcgis-map-config-smart-mapping-background-symbol>`}renderTransparency(){const{smartMappingState:e}=this;if(this.hideTransparency)return"";const a=(0,u.c)((0,u.g)(e),"opacity");return s.qy`<arcgis-map-config-smart-mapping-transparency .open=${!!a} @arcgisSmartMappingSymbolTransparencyError=${({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e)}></arcgis-map-config-smart-mapping-transparency>`}renderRotation(){const{smartMappingState:e}=this;if(this.hideRotation)return"";const a=(0,u.c)((0,u.g)(e),"opacity"),t=(0,u.c)((0,u.g)(e),"rotation");return s.qy`<arcgis-map-config-smart-mapping-rotation .open=${!a&&!!t} @arcgisSmartMappingRotationError=${({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e)} ${(0,f.K)(this.rotationNode)}></arcgis-map-config-smart-mapping-rotation>`}renderDone(){const{_messages:e}=this.smartMappingState;return s.qy`<calcite-button slot=footer .label=${e.done} @click=${this.handleDone} appearance=solid width=half>${e.done}</calcite-button>`}renderCancel(){const{smartMappingState:e}=this,{_messages:a}=e;return s.qy`<calcite-button slot=footer .label=${a.cancel} @click=${()=>{const{originalRendererJSON:a,originalFeatureReduction:t,originalOrderBy:i}=this;e.layer.orderBy=i,(0,u.f)(),(0,u.a8)(e,a,t),this.arcgisSmartMappingPanelsPredominanceClose.emit("cancel")}} appearance=outline-fill width=half>${a.cancel}</calcite-button>`}}(0,i.c)("arcgis-map-config-smart-mapping-panels-predominance",S)},18383:(e,a,t)=>{t.d(a,{a:()=>o,c:()=>r,g:()=>c});var i=t(75054),s=t(15223),n=t(1225),l=(t(54312),t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(89704),t(5294),t(66228));t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(83552),t(77462),t(49403),t(66617),t(10628),t(59640),t(64451),t(6176),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(28927),t(6238),t(7299);async function o(e,a){const{layer:t,useFeatureReduction:s,mapImageSublayer:o,mapView:r,selectedFields:c}=e,u=t;a=a||{};const p=(0,n.a)(e,(0,n.g)(e));return await i.createRenderer({layer:u,view:r,fields:d(e,a.fieldInfos),predominanceScheme:a.predominanceScheme||(0,n.X)(e),includeOpacityVariable:!(0,l.i)(a.includeOpacityVariable)||(0,l.i)(a.includeOpacityVariable),includeSizeVariable:!!(0,l.i)(a.includeSizeVariable)&&a.includeSizeVariable,outlineOptimizationEnabled:!o&&((0,l.i)(a.outlineOptimizationEnabled)?a.outlineOptimizationEnabled:(0,n.o)(e)),sizeOptimizationEnabled:!o&&(!(0,l.i)(a.sizeOptimizationEnabled)||a.sizeOptimizationEnabled),legendOptions:a.legendOptions,defaultSymbolEnabled:!1,forBinning:s}).then(t=>{(0,n.b)(p,t.renderer,{notOpacity:!0});const i=(0,n.d)(e);if(!(0,l.i)(a.includeOpacityVariable)&&["predominance","predominance-size"].includes(i)){const i=(0,n._)(e),s=c.map(e=>e.field).sort(),l=i.map(e=>e.field).sort();if(s.toString()===l.toString()){const i=(0,n.c)((0,n.g)(e),"opacity"),s=(0,n.p)((0,n.g)(e),"opacity");t.renderer.visualVariables=(0,n.H)(t.renderer,"opacity")||[],i&&t.renderer.visualVariables.push(i),t.renderer.authoringInfo.visualVariables=(0,n.P)(t.renderer,"opacity")||[],s&&t.renderer.authoringInfo.visualVariables.push(s);const l=t.renderer.uniqueValueInfos[0].symbol.clone();t.renderer.uniqueValueInfos=(0,n.g)(e).uniqueValueInfos,(0,n.o)(e)&&("predominance-size"===(0,n.d)(e)&&!0!==a.includeSizeVariable?(0,n.Y)(t.renderer,l):"predominance"===(0,n.d)(e)&&!0===a.includeSizeVariable&&(0,n.Z)(t.renderer,l))}}return t})}async function r(e,a){const{layer:t,useFeatureReduction:s,mapImageSublayer:o,mapView:r}=e,c=t;a=a||{};const u=(0,n.g)(e),p=(0,n.c)(u,"size"),m=(0,n.p)(u,"size"),h=(0,n.a)(e,u),g=a.fieldInfos?a.fieldInfos:u.uniqueValueGroups[0].classes.map(e=>({field:e.values[0].value,simpleFieldType:n.J.NUMBER}));let f,y=!0;if(a.fieldInfos&&(u.uniqueValueGroups[0].classes.forEach((e,t)=>{e.values[0].value!==a.fieldInfos[t].field&&(y=!1)}),y&&(delete a.fieldInfos,(0,n.O)(a))))return{renderer:u.clone()};y&&(f=u.uniqueValueInfos.map(e=>e.value),h.opacityVisVar=(0,n.c)(u,"opacity"),h.authOpacityVisVar=(0,n.p)(u,"opacity"));const b=(0,n.g)(e),S=b.uniqueValueInfos?.length?b.uniqueValueInfos[0].symbol:null,v=u.defaultSymbol,V=u.defaultLabel,z=u.backgroundFillSymbol;let $=!1;p&&($=p.minSize.stops?p.minSize.stops[0].size>p.maxSize.stops[0].size:p.minSize>p.maxSize);const w=(0,l.i)(a.includeSizeVariable)?a.includeSizeVariable:!!p,N=g[0];return g[0]=g[1],g[1]=N,await i.createRenderer({layer:c,view:r,fields:d(e,g),predominanceScheme:a.predominanceScheme||(0,n.X)(e),includeOpacityVariable:(0,l.i)(a.includeOpacityVariable)?a.includeOpacityVariable:!!h.opacityVisVar,includeSizeVariable:w,outlineOptimizationEnabled:!o&&((0,l.i)(a.outlineOptimizationEnabled)?a.outlineOptimizationEnabled:!!h.sizeOutlineVisVar),sizeOptimizationEnabled:(0,l.i)(a.sizeOptimizationEnabled)?a.sizeOptimizationEnabled:!!h.sizeAutoVisVar,legendOptions:void 0,defaultSymbolEnabled:(0,l.i)(a.defaultSymbolEnabled)?a.defaultSymbolEnabled:!!v,forBinning:s}).then(t=>{const i=t.renderer.uniqueValueInfos[0].symbol.clone();if(!a.fieldInfos&&p){const e=(0,n.c)(t.renderer,"size");if(e.minDataValue=p.minDataValue,e.maxDataValue=p.maxDataValue,m){const e=(0,n.p)(t.renderer,"size");e.minSliderValue=m.minSliderValue,e.maxSliderValue=m.maxSliderValue}}if(!(0,l.i)(a.includeOpacityVariable)&&y&&h.opacityVisVar&&h.authOpacityVisVar&&(t.renderer.visualVariables=(0,n.H)(t.renderer,"opacity"),t.renderer.authoringInfo.visualVariables=(0,n.P)(t.renderer,"opacity"),t.renderer.visualVariables.push(h.opacityVisVar),t.renderer.authoringInfo.visualVariables=t.renderer.authoringInfo.visualVariables||[],t.renderer.authoringInfo.visualVariables.push(h.authOpacityVisVar)),(0,n.b)(h,t.renderer,{notOpacity:!0}),f&&t.renderer.uniqueValueInfos.sort((e,a)=>{const t=f.indexOf(e.value),i=f.indexOf(a.value);return t>-1&&i>-1&&t<i?-1:t>-1&&i>-1&&t>i?1:t>-1?-1:i>-1?1:0}),y&&t.renderer.uniqueValueInfos.forEach((e,a)=>{e.label=u.uniqueValueInfos[a].label}),S&&t.renderer.uniqueValueInfos?.length){const a=t.renderer.uniqueValueInfos.slice();a.forEach((e,a)=>{let t;y?t=u.uniqueValueInfos[a].symbol:(t=S.clone(),(0,n.y)(t,(0,n.i)(e.symbol))),e.symbol=t}),t.renderer.uniqueValueInfos=a,(0,n.o)(e)&&("predominance-size"!==(0,n.d)(e)||w?"predominance"===(0,n.d)(e)&&w&&(0,n.Z)(t.renderer,i):(0,n.Y)(t.renderer,i))}if(v&&(t.renderer.defaultSymbol=v,t.renderer.defaultLabel=V),z&&(t.renderer.backgroundFillSymbol=z),$){const e=(0,n.c)(t.renderer,"size"),a=e.minSize;e.minSize=e.maxSize,e.maxSize=a}return t})}async function c(e,a){const{layer:t,useFeatureReduction:i,mapView:n}=e,l=t;return a=a||{},await(0,s.default)({layer:l,view:n,fields:a.fieldInfos.map(e=>e.field),forBinning:i})}function d(e,a){return a.map(a=>({name:a.field,label:u(e,a.field)}))}function u(e,a){const t=e.fields.filter(e=>e.layerField.name===a);return t.length?t[0].label:""}},46317:(e,a,t)=>{t.d(a,{D:()=>l});var i=t(85282),s=t(34670),n=t(42466);const l=(0,s.u$)(class extends s.WL{constructor(){super(...arguments),this.key=i.s6}render(e,a){return this.key=e,a}update(e,[a,t]){return a!==this.key&&((0,n.mY)(e),this.key=a),t}})},65595:(e,a,t)=>{t.d(a,{c:()=>l,u:()=>o});var i=t(20936),s=t(1225),n=(t(54312),t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(28927),t(83368),t(89704),t(5294),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(75698),t(10628),t(59640),t(64451),t(6176),t(83552));t(77462),t(49403),t(10281),t(83930),t(66617),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(6238),t(7299);function l(e){e.selectedFields=[],e.layerFields=void 0,e.fields=void 0,e.hideLayerTitle=!1,e.supportsArcade=!1,e.stringFieldsCount=-1,e.dateFieldsCount=-1,e.numberFieldsCount=-1,e.containsFlow=!0,e.oneFeatureResponseStatus=s.s.MISSING,e.selectedAttribute=void 0,e.selectedAttributeText=void 0,e.selectedTypeValue=void 0,e.selectedValue=void 0,e.lastDefault=void 0,e.lastDefaults=void 0,e.dotColorSelected=void 0,e.backgroundStyleSelected=void 0,e.lastSettings=void 0,e.classedSymbolSelectedIdx=void 0,e.allUniqueValues=void 0,e.useFeatureReduction=void 0,e.symbolStylerConfig={},e.allowTimeSeriesConfiguration=!1,e.rasterInfo=void 0}function o(){const e=(0,n.Gk)(),a=e;e.manager.onLoad(()=>{a.smartMappingState=function(e,a){const t=r.get(e);if(t)return t;const s=(0,i.el)(e,a);return s&&"store"in s?(r.set(e,s.store),s.store):null}(e.el,"arcgis-map-config-smart-mapping")})}const r=new WeakMap},89989:(e,a,t)=>{t.d(a,{w:()=>n});var i=t(54312),s=t(1225);t(44345),t(55448),t(52797),t(34031),t(63438),t(5933),t(28927),t(83368),t(89704),t(5294),t(18423),t(96086),t(91813),t(21255),t(13078),t(21303),t(12627),t(56451),t(31521),t(23054),t(5077),t(23795),t(17902),t(87420),t(30161),t(81734),t(75698),t(10628),t(59640),t(64451),t(6176),t(83552),t(77462),t(49403),t(10281),t(83930),t(66617),t(10454),t(29614),t(94916),t(52554),t(2156),t(4038),t(49851),t(75054),t(15223),t(70169),t(47207),t(70852),t(48103),t(39423),t(85681),t(18444),t(42411),t(9767),t(38218),t(91914),t(86605),t(68196),t(440),t(46547),t(6238),t(7299);function n(e,a,t){const{layer:n,mapView:o,useFeatureReduction:r}=e;return r&&"featureReduction"in n&&"binning"===n.featureReduction.type?i.watch(()=>o.scale,()=>{const i=n.featureReduction;o.scale<=i.maxScale&&!a.disabled?((0,s.f)(),function(e,a,t){const i=document.createElement("arcgis-map-config-smart-mapping-scale-alert-popover");i.smartMappingState=e,i.refElement=a,i.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",()=>{l(),t()}),document.body.append(i)}(e,a,t),(0,s.h)(a,!0)):o.scale>i.maxScale&&a.disabled&&(l(),(0,s.h)(a,!1),a.setFocus())}):void 0}function l(){document.querySelectorAll("arcgis-map-config-smart-mapping-scale-alert-popover").forEach(e=>e.remove())}}}]);