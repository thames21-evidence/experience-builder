/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-e934b4.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-e934b4"],{7080:(e,t,i)=>{i.d(t,{a:()=>h,b:()=>l,g:()=>a,s:()=>c});var s=i(72885),o=i(55535),r=i(81822);function a(e,t,i){const r=function(e){if(e)return(0,o.b)(e.webmap,!0)||(0,o.b)(e.current,!0)||void 0}(e)||{enabled:!0,selfEnabled:!0,featureEnabled:!0,featureSourcesIds:[t.id]};return new s.default({enabled:r.enabled,selfEnabled:r.selfEnabled,featureEnabled:r.featureEnabled,featureSources:n(i,r.featureSourcesIds)})}function n(e,t){return function(e){const{map:t}=e,i=t?.allLayers?.flatten(e=>"sublayers"in e?e.sublayers:null).filter(e=>!e.isTable);return[...new Set(i?.toArray())]}(e).filter(e=>t.includes(e.id)).map(e=>({layer:e,enabled:!0}))}function c(e,t){const i=[...new Set([...e.featureSources.filter(e=>e.enabled).map(e=>e.layer.id)])],s={enabled:e.enabled,selfEnabled:e.selfEnabled,featureEnabled:e.featureEnabled,featureSourcesIds:i};(0,o.a)(t,s)}function l(e){const t=function(e){if(e)return(0,o.b)(e.webmap,!0)||(0,o.b)(e.current,!0)||void 0}(e)||{enabled:!1};return new r.default({enabled:t.enabled})}function h(e,t){const i={enabled:e.enabled};(0,o.a)(t,i)}},36486:(e,t,i)=>{i.d(t,{u:()=>r});var s=i(83552),o=i(73679);const r=(0,s.yr)(o.g)},42855:(e,t,i)=>{i.d(t,{a:()=>a,f:()=>s,l:()=>o,s:()=>r});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),o=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(o||{}),r=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(r||{}),a=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(a||{})},46289:(e,t,i)=>{i.d(t,{a:()=>r,g:()=>o,m:()=>n});var s=i(91813);function o(e){switch(e?.geometry?.type){case"point":return"text"===e?.symbol?.type?"text":"point";case"polyline":return"polyline";default:return"polygon"}}function r(e){const t=e.clone(),{paths:i,spatialReference:o}=t,r=i[0][0],n=i[0][2]??i[0][1],c=i[0][2]?i[0][1]:[(r[0]+n[0])/2,(r[1]+n[1])/2];2===i[0].length&&i[0].splice(1,0,c);const l=[[[...r],a(r,c,n)]];return new s.default({curvePaths:l,spatialReference:o})}function a(e,t,i){const[s,o]=e,[r,a]=t,[n,c]=i,l=2*r-s/2-n/2,h=2*a-o/2-c/2;return{b:[[n,c],[s+2/3*(l-s),o+2/3*(h-o)],[n+2/3*(l-n),c+2/3*(h-c)]]}}const n=768},47640:(e,t,i)=>{i.d(t,{YZ:()=>a,e1:()=>o});var s=i(4836);const o={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class a{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??n,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let o=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){o=!0,i=e}if(this.p===s){if(t===r)this.i=0;else{if(!1===o){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const n=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},48134:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigSketchLayerEditor:()=>w});var s=i(73679),o=i(4395),r=i(46289),a=i(7080),n=i(65283),c=i(66228),l=i(36486),h=i(44374),p=i(5077),d=i(43266),u=i(22305),y=i(74147),g=i(85643),k=i(47640),m=i(73801),S=i(58611);class f{constructor(e,t,i,s,o,r,a){this.mapNotesLayer=e,this.mapView=t,this.sketchViewModelPoint=new i({layer:this.mapNotesLayer.pointLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelPoint.on("create",e=>r(e,this.sketchViewModelPoint)),this.sketchViewModelPoint.on("update",e=>a(e)),this.sketchViewModelLine=new i({layer:this.mapNotesLayer.polylineLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelLine.on("create",e=>r(e,this.sketchViewModelLine)),this.sketchViewModelLine.on("update",e=>a(e)),this.sketchViewModelPolygon=new i({layer:this.mapNotesLayer.polygonLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelPolygon.on("create",e=>r(e,this.sketchViewModelPolygon)),this.sketchViewModelPolygon.on("update",e=>a(e)),this.sketchViewModelText=new i({layer:this.mapNotesLayer.textLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelText.on("create",e=>r(e,this.sketchViewModelText)),this.sketchViewModelText.on("update",e=>a(e))}updateOnGraphicClick(e,t){this.hitTestHandle?.remove(),e&&(this.hitTestHandle=this.mapView.on("click",async e=>{const i=(await this.mapView.hitTest(e,{include:this.mapNotesLayer})).results;if(i.length){const e=["point","polyline","polygon"];i.sort((t,i)=>e.indexOf(t.graphic.geometry.type)-e.indexOf(i.graphic.geometry.type));const t=i[0].graphic;switch(t.layer){case this.mapNotesLayer.pointLayer:await this.updatePoint([t]);break;case this.mapNotesLayer.textLayer:await this.updateText([t]);break;case this.mapNotesLayer.polylineLayer:await this.updateLine([t]);break;case this.mapNotesLayer.polygonLayer:await this.updatePolygon([t]);break;default:return}}else t&&t({state:"complete"})}))}duplicate(){this._duplicatePoint(),this._duplicateLine(),this._duplicatePolygon(),this._duplicateText()}delete(){this._deletePoint(),this._deleteLine(),this._deletePolygon(),this._deleteText()}cancel(){this._cancelPoint(),this._cancelLine(),this._cancelPolygon(),this._cancelText()}destroy(){this._destroyPoint(),this._destroyLine(),this._destroyPolygon(),this._destroyText()}getPointSVM(){return this.sketchViewModelPoint}getPoint(){return this.sketchViewModelPoint.pointSymbol}setPoint(e){this.sketchViewModelPoint.pointSymbol=e}createPoint(){this.sketchViewModelPoint?.view&&this.sketchViewModelPoint.create("point")}async updatePoint(e){await this.sketchViewModelPoint.update(e)}_duplicatePoint(){this.sketchViewModelPoint.duplicate()}_deletePoint(){this.sketchViewModelPoint.delete()}_cancelPoint(){this.sketchViewModelPoint.cancel()}_destroyPoint(){this.sketchViewModelPoint.destroy()}getLineSVM(){return this.sketchViewModelLine}getLine(){return this.sketchViewModelLine.polylineSymbol}setLine(e){this.sketchViewModelLine.polylineSymbol=e}createLine(e){this.sketchViewModelLine?.view&&this.sketchViewModelLine.create("polyline",{mode:e?"click":"hybrid"})}async updateLine(e){const t=1===e.length&&!!e[0].geometry?.curvePaths?.length;await this.sketchViewModelLine.update(e,{reshapeOptions:{edgeOperation:t?"none":"split"}})}_duplicateLine(){this.sketchViewModelLine.duplicate()}_deleteLine(){this.sketchViewModelLine.delete()}_cancelLine(){this.sketchViewModelLine.cancel()}_destroyLine(){this.sketchViewModelLine.destroy()}getPolygonSVM(){return this.sketchViewModelPolygon}getPolygon(){return this.sketchViewModelPolygon.polygonSymbol}setPolygon(e){this.sketchViewModelPolygon.polygonSymbol=e}createPolygon(e){this.sketchViewModelPolygon?.view&&this.sketchViewModelPolygon.create(e)}async updatePolygon(e){await this.sketchViewModelPolygon.update(e)}_duplicatePolygon(){this.sketchViewModelPolygon.duplicate()}_deletePolygon(){this.sketchViewModelPolygon.delete()}_cancelPolygon(){this.sketchViewModelPolygon.cancel()}_destroyPolygon(){this.sketchViewModelPolygon.destroy()}getTextSVM(){return this.sketchViewModelText}getText(){return this.sketchViewModelText.pointSymbol}setText(e){this.sketchViewModelText.pointSymbol=e}createText(){this.sketchViewModelText?.view&&this.sketchViewModelText.create("point")}async updateText(e){await this.sketchViewModelText.update(e)}_duplicateText(){this.sketchViewModelText.duplicate()}_deleteText(){this.sketchViewModelText.delete()}_cancelText(){this.sketchViewModelText.cancel()}_destroyText(){this.sketchViewModelText.destroy()}}const b=o.AH`:host{display:flex;flex:1 1 auto;overflow:hidden}.snapping{display:flex;padding:var(--calcite-spacing-sm);background-color:var(--calcite-color-foreground-1)}.snapping-controls-button{min-width:0px}.sketch-message{padding:var(--calcite-spacing-sm)}.sketch-keyboard-button{margin-left:.3em}.multiple-selection{margin:1em}.multiple-selection calcite-button{margin-top:.3em}:dir(rtl){.sketch-keyboard-button{margin-left:unset;margin-right:.3em}}`;class w extends m.WF{constructor(){super(...arguments),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new k.YZ(this,{task:async([e,t,i])=>{const{showSketchToolsOnly:s}=this;if(!(0,c.i)(e)||!(0,c.i)(t)||!s&&!(0,c.i)(i))throw console.error("[arcgis-map-config-sketch-layer-editor] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,this.init()},args:()=>[this.mapView,this.layer,this.portal]}),this._messages=(0,l.u)({blocking:!0}),this.sketchLayerEditorState=(0,n.u)(),this.flowEl=(0,g._)(),this.sketchFlowItemEl=(0,g._)(),this.dismissButtonEl=(0,g._)(),this.sketchContentEl=(0,g._)(),this.sketchSnappingButtonEl=(0,g._)(),this.sketchShortcutsButtonEl=(0,g._)(),this.shortcutSnappingEl=(0,g._)(),this.sketchMode="update",this.escKey=!1,this.deleteInProgress=!1,this.duplicateInProgress=!1,this.isDone=!1,this.keepSelectionMessage="",this.keepSelectionTool=void 0,this.needsMapViewHandles=!1,this.onGraphicUpdate=async e=>{if("start"===e.state)if(this.mapView.closePopup(),this.multipleSelectedGraphics.length<=1&&1===e.graphics.length)this.currentSketchInfo.graphics=[e.graphics[0]],this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=this.currentSketchInfo.graphics[0].geometry.curvePaths?.length?"bezier-curve":(0,r.g)(this.currentSketchInfo.graphics[0]),this.currentSketchInfo.title=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),this.currentSketchInfo.popup=this.currentSketchInfo.graphics[0].popupTemplate??void 0,this.multipleSelectedGraphics.length||this.multipleSelectedGraphics.push(this.currentSketchInfo.graphics[0]),await(this.sketchContentEl.value?.rerender()),this.showSketchContent=!0,this.arcgisContentReRender.emit();else if(this.multipleSelectedGraphics.length){this.currentSketchInfo.graphics=this.multipleSelectedGraphics,this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=(0,r.g)(this.currentSketchInfo.graphics[0]);const e=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),t=this.currentSketchInfo.graphics.every(t=>t.attributes?.title===e),i=this.currentSketchInfo.graphics[0].popupTemplate,s=this.currentSketchInfo.graphics.every(e=>JSON.stringify(e.popupTemplate)===JSON.stringify(i));this.currentSketchInfo.title=t?e:void 0,this.currentSketchInfo.popup=s?i??void 0:void 0,await(this.sketchContentEl.value?.rerender()),this.showSketchContent=!0,this.arcgisContentReRender.emit()}else this.updateSketchMessage(void 0);if("complete"===e.state){if(this.removeHighlight(),this.isDone)return;const{keepSelectionTool:e}=this,t=e!==this.sketchToolsEl.activeSelectTool;!e||t?(this.currentSketchInfo.graphics=void 0,this.multipleSelectedGraphics=[],this.closeSketchPopovers(),this.handleInternalSketchUpdate(),await(this.sketchContentEl.value?.rerender()),this.arcgisContentReRender.emit()):this.deleteInProgress||this.keepSelectToolSelection()}},this.currentSketchInfo={tool:void 0,symbol:void 0,graphics:void 0,popup:void 0,title:void 0,sourceIds:{}},this.multipleSelectedGraphics=[],this.showSketchContent=!0,this.dismissible=!1,this.showSketchToolsOnly=!1,this.sketchToolsToHide=[],this.hideSelectionTools=!1,this.snappingSessionStorageIds={current:"current",webmap:"webmap"},this.sketchTooltipSessionStorageIds={current:"currenttooltip",webmap:"webmaptooltip"},this.symbolStylerConfig={},this.store=(0,S.y$)({mapView:void 0,portal:void 0,layer:void 0,_messages:void 0,sketchMessage:"",sketchLayerEditorSVModel:void 0,snappingOptions:void 0,sketchTooltipOptions:void 0,snappingSessionStorageIds:void 0,sketchTooltipSessionStorageIds:void 0}),this.arcgisChange=(0,m.lh)(),this.arcgisClose=(0,m.lh)(),this.arcgisContentReRender=(0,m.lh)(),this.arcgisCopyToNewSketchLayer=(0,m.lh)(),this.arcgisRecentColorsUpdate=(0,m.lh)()}static{this.properties={currentSketchInfo:16,multipleSelectedGraphics:16,showSketchContent:16,mapView:0,layer:0,portal:0,dismissible:5,showSketchToolsOnly:5,activeSketchTool:1,sketchToolsToHide:0,hideSelectionTools:5,sketchToolsReferenceElement:0,sketchToolsPopoverProps:0,selectedSketchFeaturesFeatures:0,snappingSessionStorageIds:0,sketchTooltipSessionStorageIds:0,symbolStylerConfig:0,store:0}}static{this.styles=b}async activateLayer(e,t){if(this.sketchLayerEditorSVModel?.destroy(),this.sketchLayerEditorSVModel?.updateOnGraphicClick(!1),this.layer=e,this.loadStore(),t?.length){const e=t.map(e=>e.clone());let i=[],s=[],o=[],a=[];e.forEach(e=>{switch((0,r.g)(e)){case"point":e.layer=this.layer.pointLayer,i=[...i,e];break;case"polyline":e.layer=this.layer.polylineLayer,s=[...s,e];break;case"polygon":e.layer=this.layer.polygonLayer,o=[...o,e];break;default:e.layer=this.layer.textLayer,a=[...a,e]}}),this.currentSketchInfo.graphics=e,this.updateCurrentSketchInfo(),setTimeout(()=>{this.multipleSelectedGraphics=[...i,...s,...o,...a],i.length&&this.sketchLayerEditorSVModel.updatePoint(i),s.length&&this.sketchLayerEditorSVModel.updateLine(s),o.length&&this.sketchLayerEditorSVModel.updatePolygon(o),a.length&&this.sketchLayerEditorSVModel.updateText(a),this.sketchMode="update"},300)}}async deactivate(){const e=[this.sketchLayerEditorSVModel.getPointSVM(),this.sketchLayerEditorSVModel.getLineSVM(),this.sketchLayerEditorSVModel.getPolygonSVM(),this.sketchLayerEditorSVModel.getTextSVM()],t=this.sketchToolsEl?.activeSelectTool;this.tempCreatedGraphic=void 0,this.removeHighlight(),e.forEach(e=>e.cancel()),t||await(this.sketchToolsEl?.activateSingleSelection())}async done(){this.isDone=!0,this.removeHighlight(),this.snappingSessionStorageIds?.current&&this.snappingOptions&&(0,a.s)(this.snappingOptions,this.snappingSessionStorageIds.current),this.sketchTooltipSessionStorageIds?.current&&this.sketchTooltipOptions&&(0,a.a)(this.sketchTooltipOptions,this.sketchTooltipSessionStorageIds.current),this.closeSketchPopovers(),this.sketchLayerEditorSVModel?.destroy(),this.sketchToolsEl?.remove(),this.sketchToolsEl=void 0,this.removeSketchShortcuts(),this.mapView&&(this.mapView.popupEnabled=!!this.originalPopupEnabled)}async setFocus(){this.dismissButtonEl.value?.setFocus()}async updateSketchTools(){this.sketchToolsEl&&(this.sketchToolsEl.sketchToolsToHide=this.sketchToolsToHide,this.sketchToolsEl.hideSelectionTools=this.hideSelectionTools,this.sketchToolsEl.activeSketchTool=this.activeSketchTool)}async updateSketchToolsPopoverProps(e){this.sketchToolsEl&&(this.sketchToolsEl.popoverProps=e)}updated(){if(this._propWatcherTask.status===k.e1.COMPLETE&&this._initialized&&!this._loaded){if(this._loaded=!0,this.needsMapViewHandles&&(this.mapView.focus(),this.watchDeleteOnMapView(!0),this.watchEscapeOnMapView(!0)),this.sketchToolsPopoverProps){const e=`(max-width: ${r.m}px)`;this.mobileViewportHandle=window.matchMedia(e),this.mobileViewportHandle.addEventListener("change",async e=>{const t=e.matches;await this.updateSketchToolsPopoverProps({...this.sketchToolsPopoverProps,placement:t?this.sketchToolsPopoverProps.mobilePlacement:this.sketchToolsPopoverProps.placement})})}this.mapView.popupEnabled=!1,this.createSketchTools(),this.cleanUpBezierPaths()}}disconnectedCallback(){super.disconnectedCallback(),this.watchEscapeOnMapView(!1),this.watchDeleteOnMapView(!1),this.removeSketchShortcuts(),this.removeSketchShortcutsTooltip(),this.selectorOperation?.cancel(),this.sketchLayerEditorSVModel?.updateOnGraphicClick(!1)}async init(){this.loadStore(),this.selectedSketchFeaturesFeatures?.length&&(this.selectedSketchFeaturesFeatures.forEach(e=>{switch((0,r.g)(e)){case"point":e.layer=this.layer.pointLayer,e.sourceLayer=this.layer;break;case"polyline":e.layer=this.layer.polylineLayer,e.sourceLayer=this.layer;break;case"polygon":e.layer=this.layer.polygonLayer,e.sourceLayer=this.layer;break;default:e.layer=this.layer.textLayer,e.sourceLayer=this.layer}}),this.multipleSelectedGraphics=this.selectedSketchFeaturesFeatures.filter(e=>(0,c.i)(e)),this.currentSketchInfo.graphics=this.multipleSelectedGraphics,this.updateCurrentSketchInfo()),this.originalPopupEnabled=this.mapView.popupEnabled,this._initialized=!0}loadStore(){const{sketchLayerEditorState:e}=this;(0,n.c)(e),this.initializeSessionStorageOptions(),this.initializeSVModel(),e.sketchLayerEditorSVModel=this.sketchLayerEditorSVModel,e.mapView=this.mapView,e.layer=this.layer,e.portal=this.portal,e._messages=this._messages,e.snappingOptions=this.snappingOptions,e.sketchTooltipOptions=this.sketchTooltipOptions,e.snappingSessionStorageIds=this.snappingSessionStorageIds,e.sketchTooltipSessionStorageIds=this.sketchTooltipSessionStorageIds}initializeSessionStorageOptions(){const{layer:e,mapView:t,snappingSessionStorageIds:i,sketchTooltipSessionStorageIds:s}=this;this.snappingOptions=(0,a.g)(i,e,t),this.sketchTooltipOptions=(0,a.b)(s)}initializeSVModel(){this.sketchLayerEditorSVModel=new f(this.layer,this.mapView,u.default,this.snappingOptions,this.sketchTooltipOptions,(e,t)=>this.onGraphicCreate(e,t),this.onGraphicUpdate)}cleanUpBezierPaths(){const{layer:e}=this;e.polylineLayer.graphics.forEach(e=>{if(e.geometry.curvePaths&&e.geometry.paths?.length){const t=e.geometry.clone();t.paths=[],e.geometry=t}})}updateCurrentSketchInfo(){this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=(0,r.g)(this.currentSketchInfo.graphics[0]);const e=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),t=this.currentSketchInfo.graphics.every(t=>t.attributes?.title===e),i=this.currentSketchInfo.graphics[0].popupTemplate,s=this.currentSketchInfo.graphics.every(e=>JSON.stringify(e.popupTemplate)===JSON.stringify(i));this.currentSketchInfo.title=t?e??void 0:void 0,this.currentSketchInfo.popup=s?i??void 0:void 0,this.showSketchContent=!0,this.sketchLayerEditorSVModel.updateOnGraphicClick(!0,this.onGraphicUpdate),this.needsMapViewHandles=!0}setCurrentSketchSymbol(){const{currentSketchInfo:e}=this;"point"===e.tool?this.sketchLayerEditorSVModel.setPoint(e.symbol):"polyline"===e.tool||"bezier-curve"===e.tool?this.sketchLayerEditorSVModel.setLine(e.symbol):["circle","polygon","rectangle"].includes(e.tool)?this.sketchLayerEditorSVModel.setPolygon(e.symbol):"text"===e.tool&&this.sketchLayerEditorSVModel.setText(e.symbol)}getDefaultGraphicTitle(){const{sketchLayerEditorState:e,currentSketchInfo:t}=this,{_messages:i}=e;switch(t.tool){case"point":default:return i.point;case"polyline":return i.line;case"bezier-curve":return i.curve;case"polygon":return i.polygon;case"rectangle":return i.rectangle;case"circle":return i.circle;case"text":return i.text}}createSketchTools(){const{sketchLayerEditorState:e}=this;this.sketchToolsEl=(0,m.dN)(o.qy`<arcgis-map-config-sketch-layer-editor-tools .sketchLayerEditorState=${e} .sketchToolsToHide=${this.sketchToolsToHide} .activeSketchTool=${this.activeSketchTool} .hideSelectionTools=${this.hideSelectionTools} .popoverProps=${this.sketchToolsPopoverProps} .refElement=${this.sketchToolsReferenceElement??this.el} @arcgisActionOnSelectFeatures=${async e=>{const t=e.detail.sketchMessage,i=e.detail.multipleSelectTool;await this.handleSelectFeatures(t,i)}} @arcgisActionOnDrawFeatures=${async e=>{const t=e.detail.sketchMessage,i=e.detail.tool;await this.handleDrawFeatures(t,i)}}></arcgis-map-config-sketch-layer-editor-tools>`),this.selectedSketchFeaturesFeatures&&(this.sketchToolsEl.mapNotesFeatures=this.selectedSketchFeaturesFeatures,this.sketchToolsEl.activeSelectTool=1===this.multipleSelectedGraphics.length?"select":"rectangle"),document.body.appendChild(this.sketchToolsEl),this.sketchContentEl.value&&!this.sketchContentEl.value.symbolStylerRefElement&&(this.sketchContentEl.value.symbolStylerRefElement=this.dismissButtonEl.value)}clearHighlightAndPopup(){const{mapView:e}=this;this.removeHighlight(),e.closePopup()}highlightGraphic(e){const{mapView:t}=this;this.removeHighlight(),setTimeout(()=>{const i=t.allLayerViews?.items.find(({layer:e})=>e===this.layer);this.createdGraphicHighlightHandle=i?.highlight(e)},1)}removeHighlight(){this.createdGraphicHighlightHandle?.remove(),this.createdGraphicHighlightHandle=void 0}watchEscapeOnMapView(e){e&&!this.watchEscapeHandle?this.watchEscapeHandle=this.mapView.on("key-down",e=>{"Escape"===e.key&&("active"===this.sketchLayerEditorSVModel.getPointSVM().state||"active"===this.sketchLayerEditorSVModel.getLineSVM().state||"active"===this.sketchLayerEditorSVModel.getPolygonSVM().state||"active"===this.sketchLayerEditorSVModel.getTextSVM().state)&&(e.stopPropagation(),this.escKey=!0,this.sketchLayerEditorSVModel.cancel())}):(this.watchEscapeHandle?.remove(),this.watchEscapeHandle=void 0)}watchDeleteOnMapView(e){e&&!this.watchDeleteHandle?this.watchDeleteHandle=this.mapView.on("key-down",e=>{("Delete"===e.key||"Backspace"===e.key)&&(this.deleteInProgress=!0,this.sketchLayerEditorSVModel.delete(),this.deleteInProgress=!1,this.keepSelectToolSelection())}):(this.watchDeleteHandle?.remove(),this.watchDeleteHandle=void 0)}async onGraphicCreate(e,t){"start"===e.state&&(this.tempCreatedGraphic=void 0,this.removeHighlight());const i=e.toolEventInfo;if("bezier-curve"===this.currentSketchInfo.tool&&"vertex-add"===i?.type){const t=e.graphic;2===t.geometry.paths[0].length&&(this.sketchLayerEditorSVModel?.getLineSVM()?.complete(),t.geometry=(0,r.a)(t.geometry))}if("cancel"===e.state&&this.escKey){this.escKey=!1;const e="text"===this.currentSketchInfo.tool?"point":"bezier-curve"===this.currentSketchInfo.tool?"polyline":this.currentSketchInfo.tool;t.create(e)}if("complete"===e.state){e.graphic&&(this.handleInternalSketchUpdate(),e.graphic.popupTemplate=this.currentSketchInfo.popup,e.graphic.attributes={title:this.currentSketchInfo.title},this.currentSketchInfo.graphics=[e.graphic],this.tempCreatedGraphic=e.graphic,this.highlightGraphic(e.graphic));const i="text"===this.currentSketchInfo.tool?"point":"bezier-curve"===this.currentSketchInfo.tool?"polyline":this.currentSketchInfo.tool;"bezier-curve"===this.currentSketchInfo.tool?(setTimeout(()=>{this.sketchMode="update",this.sketchLayerEditorSVModel?.getLineSVM()?.update([e.graphic],{tool:"reshape",reshapeOptions:{edgeOperation:"none"}})},100),await(this.sketchToolsEl?.activateSingleSelection())):t.create(i)}}async handleSelectFeatures(e,t){const{sketchLayerEditorSVModel:i,currentSketchInfo:s,selectedSketchFeaturesFeatures:o,selectorOperation:r}=this;this.keepSelectionMessage=e,this.keepSelectionTool=t,this.clearHighlightAndPopup(),this.watchEscapeOnMapView(!1),this.closeSketchPopovers(),this.updateSketchMessage(this.keepSelectionMessage),this.tempCreatedGraphic=void 0,s.graphics=void 0,s.symbol=void 0,s.tool=void 0,o&&!o.length&&(this.watchDeleteOnMapView(!1),this.multipleSelectedGraphics=[]),this.sketchMode="update",i.cancel(),this.keepSelectionTool?this.actionOnMultipleSelections(this.keepSelectionTool):(r?.cancel(),i.updateOnGraphicClick(!0),this.selectedSketchFeaturesFeatures=void 0),await(this.sketchContentEl.value?.rerender()),this.arcgisContentReRender.emit()}async handleDrawFeatures(e,t){const{sketchLayerEditorState:i}=this,{_messages:s}=i;switch(this.clearHighlightAndPopup(),this.watchEscapeOnMapView(!0),this.watchDeleteOnMapView(!1),this.updateSketchMessage(e),"update"===this.sketchMode&&this.closeSketchPopovers(),this.sketchMode="continuous",this.sketchLayerEditorSVModel.cancel(),this.sketchLayerEditorSVModel.updateOnGraphicClick(!1),this.tempCreatedGraphic=void 0,this.currentSketchInfo.graphics=void 0,this.currentSketchInfo.tool=t,t){case"point":this.sketchLayerEditorSVModel.setPoint(await(0,n.e)(this.mapView)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getPoint();const e=this.currentSketchInfo.symbol.clone();this.sketchLayerEditorSVModel.createPoint(),setTimeout(async()=>{this.sketchContentEl.value&&JSON.stringify(e.toJSON())!==JSON.stringify(this.currentSketchInfo.symbol.toJSON())&&(this.sketchContentEl.value.currentSketchInfo=this.currentSketchInfo,await this.sketchContentEl.value.rerender())},500);break;case"polyline":this.sketchLayerEditorSVModel.setLine(await(0,n.d)(this.mapView)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getLine(),this.sketchLayerEditorSVModel.createLine();break;case"bezier-curve":this.sketchLayerEditorSVModel.setLine(await(0,n.b)(this.mapView)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getLine(),this.sketchLayerEditorSVModel.createLine(!0);break;case"polygon":case"rectangle":case"circle":this.sketchLayerEditorSVModel.setPolygon(await(0,n.a)(this.mapView)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getPolygon(),this.sketchLayerEditorSVModel.createPolygon(t);break;case"text":this.sketchLayerEditorSVModel.setText(await(0,n.g)(this.mapView,p,y.default,s.textContentPlaceholder)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getText(),this.sketchLayerEditorSVModel.createText()}this.currentSketchInfo.popup=void 0,this.currentSketchInfo.title=this.getDefaultGraphicTitle(),await(this.sketchContentEl.value?.rerender(t)),this.showSketchContent=!0,this.arcgisContentReRender.emit(t)}getSymbolProps(e){return{size:(0,n.j)(e),rotation:(0,n.i)(e),color:(0,n.h)(e),outline:(0,n.f)(e),outlineStyle:e.outline?.style,strokeStyle:e.style,marker:e.marker}}actionOnMultipleSelections(e){if(this.duplicateInProgress)return;const{mapView:t}=this;if(this.selectedSketchFeaturesFeatures?.length)return void(this.selectedSketchFeaturesFeatures=void 0);this.multipleSelectedGraphics=[];const i=[this.layer.pointLayer,this.layer.polylineLayer,this.layer.polygonLayer,this.layer.textLayer],s="rectangle"===e?{createTool:"rectangle"}:{createTool:"polygon",mode:"freehand"},o=d.createSelectionOperation(t,i,s);this.selectorOperation=o,o.once("complete",e=>{const{selection:t}=e;if(this.clearHighlightAndPopup(),!e.aborted&&t.length){let e=[],i=[],s=[],o=[];t.forEach(t=>{switch((0,r.g)(t)){case"point":default:e=[...e,t];break;case"polyline":case"bezier-curve":i=[...i,t];break;case"polygon":s=[...s,t];break;case"text":o=[...o,t]}}),this.multipleSelectedGraphics=[...e,...i,...s,...o],e.length&&this.sketchLayerEditorSVModel.updatePoint(e),i.length&&this.sketchLayerEditorSVModel.updateLine(i),s.length&&this.sketchLayerEditorSVModel.updatePolygon(s),o.length&&this.sketchLayerEditorSVModel.updateText(o),this.watchDeleteOnMapView(!0)}}),this.sketchLayerEditorSVModel.updateOnGraphicClick(!1)}async offsetDuplicatedFeatures(){const{mapView:e}=this;this.multipleSelectedGraphics.forEach(t=>h.move(t.geometry,15*e.resolution,15*e.resolution));let t=[],i=[],s=[],o=[];this.multipleSelectedGraphics.forEach(e=>{switch((0,r.g)(e)){case"polyline":i=[...i,e];break;case"polygon":s=[...s,e];break;case"text":o=[...o,e];break;default:t=[...t,e]}}),this.currentSketchInfo.graphics=this.multipleSelectedGraphics,t.length&&this.sketchLayerEditorSVModel.updatePoint(t),i.length&&await this.sketchLayerEditorSVModel.updateLine(i),s.length&&this.sketchLayerEditorSVModel.updatePolygon(s),o.length&&this.sketchLayerEditorSVModel.updateText(o)}keepSelectToolSelection(){this.sketchToolsEl.activeSelectTool&&this.handleSelectFeatures(this.keepSelectionMessage,this.keepSelectionTool)}updateSketchMessage(e){const{sketchLayerEditorState:t}=this;t.sketchMessage=e}handleGraphicUpdates(e){if("symbol"===e.type&&e.symbolSwitchFromRecent){const e=(0,n.h)(this.currentSketchInfo.symbol.clone())?.toHex();e&&this.arcgisRecentColorsUpdate.emit(e)}if("update"===this.sketchMode&&this.currentSketchInfo.graphics?.length){const t=this.currentSketchInfo.graphics.length>1,i=this.currentSketchInfo.graphics[0].symbol.clone(),s=this.currentSketchInfo.symbol.clone(),o=this.getSymbolProps(i),r=this.getSymbolProps(s);this.currentSketchInfo.graphics.forEach((i,s)=>{if("title"===e.type)i.attributes&&i.attributes.title!==this.currentSketchInfo.title?this.currentSketchInfo.graphics[s].attributes={...this.currentSketchInfo.graphics[s].attributes,title:this.currentSketchInfo.title}:i.attributes||(this.currentSketchInfo.graphics[s].attributes={title:this.currentSketchInfo.title});else if("popup"===e.type)JSON.stringify(this.currentSketchInfo.graphics[s].popupTemplate?.toJSON())!==JSON.stringify(this.currentSketchInfo.popup?.toJSON())&&(this.currentSketchInfo.graphics[s].popupTemplate=this.currentSketchInfo.popup);else if("symbol"===e.type)if(!t||e.symbolSwitchFromRecent){const t=this.currentSketchInfo.symbol.clone();"recent-text"===e.textProp&&(t.text=this.currentSketchInfo.graphics[s].symbol.clone().text),this.currentSketchInfo.graphics[s].symbol=t}else if(e.symbolSwitch){const e=this.currentSketchInfo.graphics[s].symbol.clone(),t=this.currentSketchInfo.symbol.clone(),i=this.getSymbolProps(e),o=this.getSymbolProps(t);(0,c.i)(i.size)&&(0,c.i)(o.size)&&(0,n.k)(t,i.size),(0,c.i)(i.rotation)&&(0,c.i)(o.rotation)&&(0,n.l)(t,i.rotation),this.currentSketchInfo.graphics[s].symbol=t}else{const t=this.currentSketchInfo.graphics[s].symbol.clone(),i=this.getSymbolProps(t);if(o.size!==r.size&&(0,n.k)(t,r.size),o.rotation!==r.rotation&&(0,n.l)(t,r.rotation),JSON.stringify(o.color)!==JSON.stringify(r.color)&&(o.color.a===r.color.a?(i.color.r=r.color.r,i.color.g=r.color.g,i.color.b=r.color.b):i.color.a=r.color.a,(0,n.m)(t,i.color)),(0,c.i)(o.outline)&&(0,c.i)(r.outline)&&JSON.stringify(o.outline)!==JSON.stringify(r.outline)){const e=o.outline.width===r.outline.width,s=o.outline.color.a===r.outline.color.a;e?s?(i.outline.color.r=r.outline.color.r,i.outline.color.g=r.outline.color.g,i.outline.color.b=r.outline.color.b):i.outline.color.a=r.outline.color.a:i.outline.width=r.outline.width,(0,n.n)(t,i.outline)}if(JSON.stringify(o.outlineStyle)!==JSON.stringify(r.outlineStyle)&&t.outline&&(t.outline.style=r.outlineStyle),JSON.stringify(o.strokeStyle)!==JSON.stringify(r.strokeStyle)&&(t.style=r.strokeStyle),JSON.stringify(o.marker)!==JSON.stringify(r.marker)&&(t.marker=r.marker),e.textProp){const i=this.currentSketchInfo.symbol.clone();switch(e.textProp){case"text":t.text=i.text;break;case"font":t.font.family=i.font.family,t.font.weight=i.font.weight,t.font.style=i.font.style;break;case"font-size":t.font.size=i.font.size;break;case"color":t.color.r=i.color.r,t.color.g=i.color.g,t.color.b=i.color.b;break;case"color-transparency":t.color.a=i.color.a;break;case"rotation":t.angle=i.angle;break;case"halo":t.haloColor=i.haloColor,t.haloSize=i.haloSize;break;case"halo-color":t.haloColor?(t.haloColor.r=i.haloColor.r,t.haloColor.g=i.haloColor.g,t.haloColor.b=i.haloColor.b):t.haloColor=i.haloColor;break;case"halo-color-transparency":t.haloColor&&(t.haloColor.a=i.haloColor.a);break;case"halo-size":t.haloSize=i.haloSize;break;case"background":t.backgroundColor=i.backgroundColor,t.borderLineColor=i.borderLineColor,t.borderLineSize=i.borderLineSize;break;case"background-color":t.backgroundColor?(t.backgroundColor.r=i.backgroundColor.r,t.backgroundColor.g=i.backgroundColor.g,t.backgroundColor.b=i.backgroundColor.b):t.backgroundColor=i.backgroundColor;break;case"background-color-transparency":t.backgroundColor&&(t.backgroundColor.a=i.backgroundColor.a);break;case"border-line-color":t.borderLineColor?(t.borderLineColor.r=i.borderLineColor.r,t.borderLineColor.g=i.borderLineColor.g,t.borderLineColor.b=i.borderLineColor.b):(t.backgroundColor=i.backgroundColor,t.borderLineColor=i.borderLineColor,t.borderLineSize=i.borderLineSize);break;case"border-line-color-transparency":t.borderLineColor&&(t.borderLineColor.a=i.borderLineColor.a);break;case"border-line-size":t.borderLineSize=i.borderLineSize}}this.currentSketchInfo.graphics[s].symbol=t}})}else this.tempCreatedGraphic&&(this.tempCreatedGraphic.attributes&&this.tempCreatedGraphic.attributes.title!==this.currentSketchInfo.title?this.tempCreatedGraphic.attributes={...this.tempCreatedGraphic.attributes,title:this.currentSketchInfo.title}:this.tempCreatedGraphic.attributes||(this.tempCreatedGraphic.attributes={title:this.currentSketchInfo.title}),JSON.stringify(this.tempCreatedGraphic.popupTemplate?.toJSON())!==JSON.stringify(this.currentSketchInfo.popup?.toJSON())&&(this.tempCreatedGraphic.popupTemplate=this.currentSketchInfo.popup),this.tempCreatedGraphic.symbol=this.currentSketchInfo.symbol);this.currentSketchInfo.graphics?.[0]&&this.mapView.popup&&(this.mapView.popup.features=[this.currentSketchInfo.graphics[0]]),this.setCurrentSketchSymbol(),this.handleInternalSketchUpdate()}handleInternalSketchUpdate(){this.arcgisChange.emit()}handleDisablePanel(e){this.sketchFlowItemEl.value.disabled=e}removeSketchShortcuts(){this.arcgisSketchLayerEditorShortcutsEl&&(this.arcgisSketchLayerEditorShortcutsEl.remove(),this.arcgisSketchLayerEditorShortcutsEl=void 0)}addSketchShortcutsTooltip(){const{sketchLayerEditorState:e}=this,{_messages:t}=e,i=(0,m.dN)(o.qy`<calcite-tooltip .referenceElement=${this.sketchShortcutsButtonEl.value} open>${t.sketchShortcuts}</calcite-tooltip>`);this.sketchShortcutsTooltipEl=i,document.body.append(i)}removeSketchShortcutsTooltip(){this.sketchShortcutsTooltipEl&&(this.sketchShortcutsTooltipEl.remove(),this.sketchShortcutsTooltipEl=void 0)}closeSketchPopovers(){this.sketchToolsEl?.activeSelectTool&&"select"!==this.sketchToolsEl.activeSelectTool&&this.updateSketchMessage(void 0),this.showSketchContent=!1,this.closeSnappingPopovers(),this.removeSketchShortcuts(),this.setFocus()}closeSnappingPopovers(){this.sketchSnappingEl&&(this.sketchSnappingEl.remove(),this.sketchSnappingEl=void 0,this.handleDisablePanel(!1)),this.setFocus()}render(){return this._propWatcherTask.render({complete:()=>{const{showSketchToolsOnly:e}=this;return this.el.classList.add("calcite-match-height"),!e&&this.renderSketchFlowPanel()||""}})}renderSketchFlowPanel(){const{sketchLayerEditorState:e,currentSketchInfo:t,showSketchContent:i,dismissible:s}=this,{_messages:r,layer:a}=e;return o.qy`<calcite-flow ${(0,g.K)(this.flowEl)}><calcite-flow-item .heading=${r.sketch} .disabled=${!a.capabilities.operations.supportsMapNotesEditing} ${(0,g.K)(this.sketchFlowItemEl)}>${s&&this.renderDismissButton()||""}${this.renderShortcutAndSnapping()}${this.renderSketchMessage()}${t.graphics?.length&&!this.tempCreatedGraphic?o.qy`<div class="multiple-selection">${this.renderSelectionMultipleLabel()}<div id=multiple-selection-buttons class="buttons">${this.renderDuplicateMultiple()}${this.renderCopyToNewSketchLayer()}${this.renderDeleteMultiple()}</div></div>`:null}${i&&o.qy`<arcgis-map-config-sketch-layer-editor-content .currentSketchInfo=${t} .flowEl=${this.flowEl.value} .symbolStylerRefElement=${this.dismissButtonEl.value} .symbolStylerConfig=${this.symbolStylerConfig} @arcgisSymbolChange=${async()=>{await(this.sketchContentEl.value?.rerender()),this.arcgisContentReRender.emit()}} @arcgisGraphicUpdates=${e=>{const t=e.detail;this.handleGraphicUpdates(t)}} @arcgisLoadPanel=${e=>{const t=e.detail;this.sketchFlowItemEl.value&&(this.sketchFlowItemEl.value.loading=t)}} @arcgisDisablePanel=${e=>{const t=e.detail;this.handleDisablePanel(t)}} ${(0,g.K)(this.sketchContentEl)}></arcgis-map-config-sketch-layer-editor-content>`||""}</calcite-flow-item></calcite-flow>`}renderDismissButton(){return o.qy`<calcite-action text=close icon=x slot=header-actions-end @click=${e=>{e.stopPropagation(),this.updateSketchMessage(void 0),this.sketchLayerEditorSVModel.cancel(),this.clearHighlightAndPopup(),this.arcgisClose.emit()}} ${(0,g.K)(this.dismissButtonEl)}></calcite-action>`}renderShortcutAndSnapping(){const{sketchLayerEditorState:e}=this,{_messages:t}=e;return o.qy`<div class="snapping" ${(0,g.K)(this.shortcutSnappingEl)}><calcite-button class="snapping-controls-button" alignment=icon-end-space-between appearance=outline-fill kind=neutral width=full icon-start=gear icon-end=chevron-down .label=${t.sketchSettings} @click=${e=>{e.stopPropagation(),this.sketchSnappingEl||(this.sketchSnappingEl=(0,m.dN)(o.qy`<arcgis-map-config-sketch-layer-editor-snapping .sketchLayerEditorState=${this.sketchLayerEditorState} .refElement=${this.shortcutSnappingEl.value} @arcgisCloseSnappingPopovers=${()=>{this.closeSnappingPopovers(),setTimeout(()=>this.sketchSnappingButtonEl.value?.setFocus(),200)}}></arcgis-map-config-sketch-layer-editor-snapping>`),document.body.appendChild(this.sketchSnappingEl),this.handleDisablePanel(!0))}} ${(0,g.K)(this.sketchSnappingButtonEl)}>${t.sketchSettings}</calcite-button><calcite-button appearance=outline-fill class="sketch-keyboard-button" kind=neutral icon-start=keyboard .label=${t.sketchShortcuts} @click=${e=>{e.stopPropagation(),this.removeSketchShortcutsTooltip(),this.arcgisSketchLayerEditorShortcutsEl||(this.arcgisSketchLayerEditorShortcutsEl=(0,m.dN)(o.qy`<arcgis-map-config-sketch-layer-editor-shortcuts .sketchLayerEditorState=${this.sketchLayerEditorState} .refElement=${this.shortcutSnappingEl.value} @arcgisClose=${()=>{this.removeSketchShortcuts(),setTimeout(()=>this.sketchShortcutsButtonEl.value?.setFocus(),200)}}></arcgis-map-config-sketch-layer-editor-shortcuts>`),document.body.appendChild(this.arcgisSketchLayerEditorShortcutsEl))}} @mouseover=${()=>this.addSketchShortcutsTooltip()} @mouseout=${()=>this.removeSketchShortcutsTooltip()} ${(0,g.K)(this.sketchShortcutsButtonEl)}></calcite-button></div>`}renderSketchMessage(){const{sketchLayerEditorState:e}=this,{sketchMessage:t}=e,{currentSketchInfo:i}=this;return!t||i.graphics&&i.graphics.length>1?"":o.qy`<div class="sketch-message"><calcite-notice width=full open><div slot=message>${t}</div></calcite-notice></div>`}renderSelectionMultipleLabel(){const{sketchLayerEditorState:e,currentSketchInfo:t}=this,{_messages:i}=e;return o.qy`<calcite-label alignment=center for=multiple-selection-buttons>${t.graphics&&t.graphics.length<=1?i.singleFeatureSelected:i.featuresSelected.replace("${number}",t.graphics.length.toString())}</calcite-label>`}renderDuplicateMultiple(){const{sketchLayerEditorState:e}=this,{_messages:t}=e;return o.qy`<calcite-button appearance=outline-fill alignment=center icon-start=duplicate kind=neutral width=full @click=${async e=>{e.stopPropagation(),this.duplicateInProgress=!0,this.sketchLayerEditorSVModel.duplicate(),await this.offsetDuplicatedFeatures(),this.duplicateInProgress=!1}}>${t.duplicate}</calcite-button>`}renderCopyToNewSketchLayer(){const{sketchLayerEditorState:e}=this,{_messages:t}=e;return o.qy`<calcite-button appearance=outline-fill alignment=center icon-start=copy kind=neutral width=full @click=${e=>{e.stopPropagation();const t=this.currentSketchInfo.graphics.map(e=>e.clone());this.arcgisCopyToNewSketchLayer.emit({features:t})}}>${t.copyToNewSketchLayer}</calcite-button>`}renderDeleteMultiple(){const{sketchLayerEditorState:e}=this,{_messages:t}=e;return o.qy`<calcite-button appearance=outline-fill alignment=center icon-start=trash kind=danger width=full @click=${e=>{e.stopPropagation();const{sketchLayerEditorSVModel:t}=this;this.deleteInProgress=!0,t.delete(),this.deleteInProgress=!1,this.multipleSelectedGraphics=[],this.keepSelectToolSelection()}}>${t.delete}</calcite-button>`}}(0,s.c)("arcgis-map-config-sketch-layer-editor",w)},55535:(e,t,i)=>{function s(e,t,i){window.localStorage.setItem(e,JSON.stringify(t))}function o(e){window.localStorage.removeItem(e)}function r(e,t){const i=window.localStorage.getItem(e);return i&&t?JSON.parse(i):i}function a(e,t,i){window.sessionStorage.setItem(e,JSON.stringify(t))}function n(e,t){const i=window.sessionStorage.getItem(e);return i&&t?JSON.parse(i):i}i.d(t,{a:()=>a,b:()=>n,g:()=>r,r:()=>o,s:()=>s})},58611:(e,t,i)=>{i.d(t,{_i:()=>l,y$:()=>g});i(4713);var s=i(54312),o=i(44319),r=i(93461),a=i(53987),n=i(84577),c=i(60331);const l=(e,t)=>t=>p(t,e);class h extends o.G{constructor(e,t){super(e),this.Y=new Map,this.A=void 0,this.#e=(0,a.createObservable)();const i=this;i.#t=t,i.Z(),i.setProvisionalExports(d(e,new WeakRef(i),e.M.length-1,i.instance,i.Y),!1),(0,o.d)(e,t=>{if(t){const o=(0,s.watch)(()=>e[t],t=>{if(t===i.instance)return;const s=i.instance;i.exports=t,i.instance=t,i.Y.forEach((t,i)=>e.requestUpdate(t,s[i])),i.#i&&s.destroy(),i.#i=!1},{sync:!0});i.onDestroy(o.remove)}},i.exports)}#i;#e;#t;get exports(){return(0,a.trackAccess)(this.#e),super.exports}set exports(e){super.exports=e,this.#e.notify()}Z(){const e=this;e.instance="prototype"in e.#t&&"declaredClass"in e.#t.prototype?new e.#t:e.#t(),e.#i=!0}hostConnected(){this.exports=this.instance}hostDestroy(){this.#i&&this.instance.destroy?.()}}const p=(0,r.p)(h),d=(e,t,i,s,r)=>new Proxy(s,{get:(s,a)=>{const n=s[a];if("symbol"==typeof a||r.has(a))return n;const c=e.M[i];return c.A=a,(0,o.t)(e,s=>{if(c.A=void 0,void 0!==s){const o=s.key;r.set(a,o);const n=e.constructor.getPropertyOptions(o);0;const c=a!==o&&o.toLowerCase().includes("disable");u(t,n,a,o,c),void 0===n.i&&y(n,i,a,c)}},n)}}),u=(e,t,i,o,r,a)=>a=(0,s.watch)(()=>{const t=e.deref();return void 0===t||t.component.manager.destroyed?a=a.remove():t.exports[i]},(i,s)=>{if(!a)return;const n=e.deref().component;n?.requestUpdate(o,r?!s:s),t.c=!1},{sync:!0}),y=(e,t,i,s)=>{e.d.get=function(){const e=this.M[t]?.exports[i];return s?!e:e},e.d.set=function(e){const o=this.M[t];o.A!==i&&(o.exports[i]=s?!e:e)}},g=e=>{const t=class extends c.default{},i="function"==typeof e?e():e,s=Object.getOwnPropertyDescriptors(i);for(const[e,i]of Object.entries(s))Object.defineProperty(t.prototype,e,i),(0,n.property)()(t.prototype,e);return new((0,n.subclass)()(t))}},65283:(e,t,i)=>{i.d(t,{a:()=>u,b:()=>d,c:()=>V,d:()=>p,e:()=>h,f:()=>b,g:()=>y,h:()=>k,i:()=>v,j:()=>S,k:()=>f,l:()=>E,m:()=>m,n:()=>w,o:()=>g,r:()=>M,u:()=>T});var s=i(56451),o=i(5077),r=i(83930),a=i(16161),n=i(66228),c=i(20936),l=i(83552);async function h(e){const t=await o.getBackgroundColorTheme(e);return new a.default({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-1.75},anchorPointUnits:"Relative",size:5.7,frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:"light"===t?[242,242,242,255]:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-.5},anchorPointUnits:"Relative",size:15,frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:"light"===t?[17,26,40,255]:[186,186,186,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,rotation:0}],scaleX:1,angleAlignment:"Display",angle:0}}})}async function p(e){return{type:"simple-line",color:"light"===await o.getBackgroundColorTheme(e)?[0,0,0]:[255,255,255],width:.75}}async function d(e){return{type:"simple-line",color:"light"===await o.getBackgroundColorTheme(e)?[0,0,0]:[255,255,255],width:2.25}}async function u(e){const t=await o.getBackgroundColorTheme(e);return{type:"simple-fill",color:"light"===t?[0,0,0,.25]:[255,255,255,.25],style:"solid",outline:{color:"light"===t?[0,0,0]:[255,255,255],width:.75}}}async function y(e,t,i,s){const o=await t.getBackgroundColor(e),r=await t.getBackgroundColorTheme(e);return new i({text:s,color:"light"===r?[0,0,0]:"dark"===r?[255,255,255]:o||[0,0,0],haloColor:void 0,haloSize:.75,font:{size:16.5,family:"Arial",weight:"bold"},lineWidth:512})}function g(e){if(!function(e){const t=e.data.symbol.symbolLayers;if(1===t.length){const e=t[0];if("CIMVectorMarker"!==e.type||e.colorLocked)return!1;const i=e.markerGraphics[0]?.symbol?.symbolLayers;return 1===e.markerGraphics.length&&I(i)}if(2===t.length){const e=t[0],i=t[1];if("CIMVectorMarker"!==e.type||"CIMVectorMarker"!==i.type||e.colorLocked||e.size>i.size)return!1;const s=e.markerGraphics[0]?.symbol?.symbolLayers,o=i.markerGraphics[0]?.symbol?.symbolLayers;return 1===e.markerGraphics.length&&1===i.markerGraphics.length&&I(s)&&function(e){return function(e){return e?.find(e=>"CIMSolidFill"===e.type)}(e)&&L(e)}(o)}return!1}(e))return;const t=e.data.symbol.symbolLayers;return t[t.length-1].markerGraphics[0].symbol.symbolLayers.find(e=>"CIMSolidStroke"===e.type)}function k(e){return"cim"===e?.type?s.default.fromJSON(r.getCIMSymbolColor(e)?.toJSON()):"simple-marker"===e?.type&&["x","cross"].includes(e?.style)?e?.outline?.color:e?.color}function m(e,t){"picture-marker"!==e.type&&("cim"===e.type?r.applyCIMSymbolColor(e,t):"simple-marker"===e.type&&e.style&&["cross","x"].includes(e.style)?(e.outline||(e.outline=new __esri.SimpleLineSymbol),e.outline.color=t):e.color=t)}function S(e){return"cim"===e.type?r.getCIMSymbolSize(e):"text"===e.type?e.font.size:(0,n.i)(e.size)?e.size:e.width}function f(e,t){if("cim"===e.type)!function(e){return"CIMPolygonSymbol"===e.data.symbol.type}(e)?r.scaleCIMSymbolTo(e,t):function(e,t){e.data.symbol.symbolLayers?.forEach(e=>{["CIMSolidStroke","CIMPictureStroke"].includes(e.type)&&(e.width=t)})}(e,t);else if((0,n.i)(e.size))e.size=t;else{const i=e.height/e.width;e.width=t,e.height=e.width*i}}function b(e){return"cim"===e?.type?function(e){if("picture-marker"!==e.type&&"CIMPolygonSymbol"===e.data.symbol?.type)return function(e){return e.data.symbol.symbolLayers.find(e=>"CIMSolidStroke"===e.type)}(e)}(e):e?.outline}function w(e,t){"cim"===e.type?e.data.symbol.symbolLayers.forEach((i,s)=>{"CIMSolidStroke"===i.type&&(e.data.symbol.symbolLayers[s]=t)}):e.outline=t}function v(e){return"cim"===e.type?r.getCIMSymbolRotation(e,!0):["simple-marker","picture-marker"].includes(e.type)?e.angle:void 0}function E(e,t){(0,n.i)(t)&&("cim"===e.type?r.applyCIMSymbolRotation(e,t,!0):["simple-marker","picture-marker"].includes(e.type)&&(e.angle=t))}const M=e=>{for(;e?.childNodes?.length;)e.childNodes[0].remove()};function L(e){return e?.find(e=>"CIMSolidStroke"===e.type)}function I(e){return function(e){return e?.find(e=>"CIMSolidFill"===e.type&&!e.colorLocked)}(e)&&L(e)}function T(){const e=(0,l.Gk)(),t=e;e.manager.onLoad(()=>{t.sketchLayerEditorState=function(e,t){const i=C.get(e);if(i)return i;const s=(0,c.el)(e,t);return s&&"store"in s?(C.set(e,s.store),s.store):null}(e.el,"arcgis-map-config-sketch-layer-editor")})}function V(e){e.mapView=void 0,e.portal=void 0,e.layer=void 0,e._messages=void 0,e.sketchMessage=void 0,e.sketchLayerEditorSVModel=void 0,e.snappingOptions=void 0,e.sketchTooltipOptions=void 0,e.snappingSessionStorageIds=void 0,e.sketchTooltipSessionStorageIds=void 0}const C=new WeakMap},66228:(e,t,i)=>{i.d(t,{a:()=>S,b:()=>I,c:()=>P,d:()=>L,e:()=>T,f:()=>O,g:()=>k,h:()=>m,i:()=>y,j:()=>g,k:()=>w,l:()=>x,m:()=>E,n:()=>d,o:()=>v,p:()=>N,q:()=>C,r:()=>_,s:()=>b,t:()=>M,u:()=>f});var s=i(63438),o=i(18423),r=i(96086),a=i(91813),n=i(21255),c=i(13078),l=i(21303),h=i(12627),p=i(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],u=["feature"];function y(e){return null!=e}function g(e,t,i){const s=t.fieldName;if(s.includes(p.f.expression)){const e=i.get(s);return e?.title?e.title:s}return b(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function k(e){return new Map((await w(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function m(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${p.f.expression}${e.name}`;t.set(i,e)}),t}function S(e){return"map-image"===e?.layer?.type?p.s.mapImage:"subtype-sublayer"===e?.type?p.s.subtype:"tile"===e?.layer?.type?p.s.tile:"scene"===e?.type?p.s.scene:"ogc-feature"===e?.type?p.s.ogcFeature:"imagery"===e?.type?p.s.imagery:"imagery-tile"===e?.type?p.s.imageryTile:"wfs"===e?.type?p.s.wfs:"wcs"===e?.type?p.s.wcs:"wms"===e?.layer?.type?p.s.wms:"csv"===e?.type?p.s.csv:"geojson"===e?.type?p.s.geojson:"stream"===e?.type?p.s.stream:"oriented-imagery"===e?.type?p.s.orientedImagery:"catalog"===e?.type?p.s.catalog:"catalog-footprint"===e?.type?p.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?p.s.knowledgeGraphSublayer:"voxel"===e?.type?p.s.voxel:"parquet"===e?.type?p.s.parquet:p.s.feature}function f(e){const t=S(e);let i;return t===p.s.wms||t===p.s.mapImage?i=e?.layer.version:(t===p.s.imagery||t===p.s.feature||t===p.s.scene)&&(i=e.version),Number.parseFloat(i)}function b(e){return"fieldConfigurations"in e&&u.includes(e.type)}async function w(e){return await new Promise((t,i)=>{switch(S(e)){case p.s.feature:case p.s.ogcFeature:case p.s.stream:t(e.fields);break;case p.s.mapImage:{const s=e,o=s?.layer;o?.portalItem&&o.url.includes("https://demographics")&&o.url.includes(".arcgis.com")?o.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),o=e.thematicGroup.fieldNames,r=[];o.forEach(e=>{i.has(e)&&r.push(i.get(e))}),t(r)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case p.s.imagery:case p.s.imageryTile:case p.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function v(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function E(e){return Number((100*(1-e)).toFixed(1))}function M(e){return Number((1-e/100).toFixed(3))}const L=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(p.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},I=async(e,t)=>{const i=new h.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await l.identify(e.layer.url,i))?.results?.[0]?.feature},T=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await V(i,s.features?.[0])},V=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=L(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const r=new o.default;i.geometry=r}return i};function C(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function P(e){if(S(e)===p.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(S(e)===p.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function x(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function O(e,t){try{const i=S(e);if(i===p.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await I(e,t)||await G(e,t)]};if(i===p.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await G(e,t)]};const s=i===p.s.ogcFeature||i===p.s.stream?await t.whenLayerView(e):e,o=s.createQuery();o.where=s.definitionExpression||"1=1",o.outFields=["*"],o.returnM="hasM"in e&&e.hasM,o.returnZ="hasZ"in e&&e.hasZ,o.outSpatialReference=t.spatialReference,o.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===p.s.ogcFeature)&&(o.start=0,o.num=1),o.outSpatialReference=t.spatialReference;const r=await s.queryFeatures(o);return r?.features?.length||(r.features[0]=await G(e,t)),r}catch(e){console.error(e)}}async function G(e,t){return await new Promise(i=>{const o=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),o.attributes=t}const l=t.extent;let h;"polygon"===e.geometryType?h=n.default.fromExtent(l):"point"===e.geometryType?h=l.center.clone():"multipoint"===e.geometryType?h=new r.default({points:[[l.center.x,l.center.y]],spatialReference:l.center.spatialReference.clone()}):"polyline"===e.geometryType?(h=new a.default({spatialReference:t.spatialReference.clone()}),h.addPath([[l.xmin,l.ymin],[l.xmax,l.ymax]])):"mesh"===e.geometryType&&(h=c.default.createBox(l.center.clone(),{size:{width:50,height:50,depth:50}})),o.geometry=h,i(o)})}function _(e){return S(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function N(e){return S(e)===p.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);