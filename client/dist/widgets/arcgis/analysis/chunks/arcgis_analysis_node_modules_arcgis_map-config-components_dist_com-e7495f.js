/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-e7495f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-e7495f"],{4265:(e,t,i)=>{i.d(t,{a:()=>a,d:()=>s,t:()=>l});const s=(e,t)=>{let i,s="idle";const a=async(...a)=>await new Promise(l=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),l(e(...a))):l(null);break;case"invoked":clearTimeout(i),s="idle",l(e(...a));break;case"cancelled":clearTimeout(i),s="idle",l(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout(()=>{s="idle",l(e(...a))},t)}});return a.flush=async function(...e){return s="flushed",await a(...e)},a.invoke=async function(...e){return s="invoked",await a(...e)},a.cancel=async function(...e){return s="cancelled",await a(...e)},a.getStatus=function(){return s},a},a=(e,t)=>{let i;return async(...s)=>await new Promise(a=>{i||(i=setTimeout(()=>{clearTimeout(i),i=void 0,a(e(...s))},t))})};function l(e){return new Promise(t=>setTimeout(t,e))}},27891:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigFields:()=>b});var s=i(73679),a=i(4395),l=i(46317),o=i(5294),d=i(6550),r=i(42855),n=i(66228),p=i(31068),c=i(4265),h=i(30812),u=i(83926),m=i(36486),f=i(85643),y=i(47640),g=i(73801);const F=new Map;F.set("oid","key"),F.set("guid","key"),F.set("global-id","key"),F.set("blob","binary"),F.set("integer","integer"),F.set("small-integer","integer"),F.set("big-integer","integer"),F.set("single","number"),F.set("double","number"),F.set("long","number"),F.set("number","number"),F.set("date","date-time"),F.set("date-only","calendar"),F.set("time-only","clock"),F.set("timestamp-offset","time-zone"),F.set("string","string");const w=a.AH`.total-selected-div{padding:var(--calcite-spacing-xs)}.field-icons{padding:0 var(--calcite-spacing-xl);display:flex;align-items:center}.floating-add-field-button{padding-bottom:.5rem}`;class b extends g.WF{constructor(){super(...arguments),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new y.YZ(this,{task:async([e,t])=>{if(!(0,n.i)(e)||!(0,n.i)(t))throw console.error("[arcgis-map-config-fields] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.mapView,this.layer]}),this._messages=(0,m.u)({blocking:!0}),this.layerFieldsMap=new Map,this.arcadeExpMap=new Map,this.popupOpenForLayer=!1,this.panelNode=(0,f._)(),this.listNode=(0,f._)(),this.dropdownActionNode=(0,f._)(),this.fieldAddFabNode=(0,f._)(),this.allowFieldAdd=!1,this.debouncedAttributeUpdates=(0,c.d)(()=>{this.layerDisplayType===r.l.feature?(this.layer.popupTemplate=this.popupTemplate.clone(),this.backingFeatureLayer&&(this.backingFeatureLayer.popupTemplate=this.popupTemplate.clone())):this.layerDisplayType===r.l.cluster&&(this.layer.featureReduction.popupTemplate=this.popupTemplate.clone()),this.arcgisChange.emit()},1e3),this.debouncedFieldConfigUpdates=(0,c.d)(e=>{this.layer.fieldConfigurations=e,this.popupTemplate=this.layer.popupTemplate.clone(),Array.isArray(this.popupTemplate.content)&&this.popupTemplate.content.forEach(t=>{"fields"===t.type&&t.fieldInfos&&t.fieldInfos.forEach((i,s)=>{const a=e.find(e=>e.name===i.fieldName);if(a){const e=o.clone(t.fieldInfos[s]);e.fieldFormat=a.fieldFormat,a.alias&&(e.label=a.alias),t.fieldInfos[s]=e}})}),this.layer.popupTemplate=this.popupTemplate.clone(),this.backingFeatureLayer&&(this.backingFeatureLayer.popupTemplate=this.popupTemplate.clone()),this.arcgisChange.emit()},1e3),this.totalSelectedFields=0,this.lastSortBy="default",this.hidePopup=!1,this.dismissible=!1,this.hideHeading=!1,this.hideLayerTitle=!1,this.hideFieldFormatting=!1,this.hideTotalSelectedFields=!1,this.addFieldEnabled=!1,this.deleteFieldEnabled=!1,this.calciteFlowProps=!1,this.layerDisplayType=r.l.feature,this.allowedFieldNames=[],this.selectedFieldNames=[],this.arcgisChange=(0,g.lh)(),this.arcgisClose=(0,g.lh)(),this.arcgisFieldAdded=(0,g.lh)(),this.arcgisFieldsDeleted=(0,g.lh)()}static{this.properties={totalSelectedFields:16,lastSortBy:16,filterFields:16,mapView:0,layer:0,config:0,hidePopup:5,dismissible:5,hideHeading:5,hideLayerTitle:5,hideFieldFormatting:5,hideTotalSelectedFields:5,addFieldEnabled:5,deleteFieldEnabled:5,calciteFlowProps:5,layerDisplayType:0,allowedFieldNames:0,selectedFieldNames:0}}static{this.styles=w}async done(){this.closePopovers(!0),await this.showPreviewPopup(!1)}async setFocus(){this.panelNode.value?this.panelNode.value.setFocus():this.listNode.value?.setFocus()}async updated(){const{hideFieldFormatting:e}=this;this._propWatcherTask.status===y.e1.COMPLETE&&this._initialized&&!this._loaded&&(this._loaded=!0,await this.showPreviewPopup(!0),this.setupResizeObserver(),this.selectedFieldNames.length?(this.lastSelectedFieldName=this.selectedFieldNames[this.selectedFieldNames.length-1],e?this.setFocus():this.openFieldsFormatting()):this.setFocus())}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver?.disconnect()}async init(){const{mapView:e,layer:t,layerDisplayType:i}=this,s=e,a=t,l=(0,n.a)(a);if(i===r.l.feature){const e="type"in a?a.type:"sublayer",t=s.popup?.visible?s.popup.selectedFeature?.sourceLayer:void 0;if(this.popupOpenForLayer="subtype-sublayer"===e?t?.subtypeCode===a.subtypeCode&&t?.parent.id===a.parent.id:"sublayer"===e?t?.id===a.id&&t?.layer.id===a.layer?.id:"id"in a&&t?.id===a.id,l===r.s.mapImage&&!a.popupTemplate&&(a.popupEnabled=!1),this.popupTemplate=a.popupTemplate?a.popupTemplate.clone():a.createPopupTemplate(),(0,n.r)(a)){const e=new d.default({url:a.url});await e.load(),this.backingFeatureLayer=e,this.popupTemplate.fieldInfos=[...await(0,h.g)(e,this.popupTemplate)],this.layer.popupTemplate=this.popupTemplate.clone(),this.backingFeatureLayer.popupTemplate=this.popupTemplate.clone()}else this.popupTemplate.fieldInfos=[...await(0,h.g)(a,this.popupTemplate)];i===r.l.feature?a.popupTemplate=this.popupTemplate.clone():i===r.l.cluster&&(a.featureReduction.popupTemplate=this.popupTemplate.clone())}else this.popupTemplate=a.featureReduction.popupTemplate.clone();const o=window.customElements?.get("arcgis-field-add");this.allowFieldAdd=(0,n.i)(o)&&this.addFieldEnabled&&await(0,p.c)(a),this.allowedFieldNames.length&&(this.selectedFieldNames=this.selectedFieldNames.filter(e=>this.allowedFieldNames.includes(e))),this.totalSelectedFields=this.selectedFieldNames.length,this.syncFieldsAndArcadeExpMap(),this._initialized=!0}async syncFieldsAndArcadeExpMap(){const{layer:e,backingFeatureLayer:t}=this;this.layerFieldsMap=await(0,n.g)(t??e),this.arcadeExpMap=(0,n.h)(this.popupTemplate)}async showPreviewPopup(e){const{mapView:t,layer:i,hidePopup:s,layerDisplayType:a}=this;!s&&a===r.l.feature&&!this.popupOpenForLayer&&(e&&i.popupEnabled&&i.popupTemplate?(this.previewPopupController=new AbortController,await(0,u.p)(t,this.layer,this.previewPopupController)):(this.previewPopupController?.abort(),t.closePopup()))}setupResizeObserver(){const e=this.el?.parentElement;(0,n.i)(e.collapsed)&&(this.resizeObserver=new ResizeObserver(async()=>{e.collapsed&&await this.done()}),this.resizeObserver.observe(e))}getSortedFieldList(){const{layer:e,allowedFieldNames:t}=this;let i=[...this.popupTemplate.fieldInfos];return t.length&&(i=i.filter(e=>e.fieldName&&t.includes(e.fieldName))),"display"===this.lastSortBy?i.sort((t,i)=>(0,n.j)(e,t,this.arcadeExpMap).localeCompare((0,n.j)(e,i,this.arcadeExpMap))):"field"===this.lastSortBy?i.sort((e,t)=>e.fieldName.localeCompare(t.fieldName)):"type"===this.lastSortBy&&i.sort((e,t)=>{const i=(0,n.l)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap),s=(0,n.l)(t.fieldName,this.layerFieldsMap,this.arcadeExpMap);return i.localeCompare(s)}),i}async handleListItemClick(e){this.closePopovers(!1),this.selectedFieldNames=[...this.listNode.value.selectedItems.map(e=>e.value)],this.totalSelectedFields=this.selectedFieldNames.length,this.lastSelectedFieldName=e,this.openFieldsFormatting()}openFieldsFormatting(){const{_messages:e,mapView:t,layer:i,config:s,deleteFieldEnabled:l,hideFieldFormatting:o}=this;!o&&!this.formattingNode&&this.selectedFieldNames.length&&(this.formattingNode=(0,g.dN)(a.qy`<arcgis-map-config-fields-formatting ._messages=${e} .config=${s} .selectedFields=${this.selectedFieldNames} .layer=${i} .mapView=${t} .popoverProps=${{refElement:this.el}} .popupTemplate=${this.popupTemplate.clone()} .deleteFieldEnabled=${l} @arcgisChange=${async e=>{e.stopPropagation(),"updatedFieldConfigurations"in e.detail?this.debouncedFieldConfigUpdates(e.detail.updatedFieldConfigurations):(this.popupTemplate=e.detail.updatedPopupTemplate.clone(),this.debouncedAttributeUpdates()),await this.syncFieldsAndArcadeExpMap(),this.requestUpdate()}} @arcgisClose=${e=>{e.stopPropagation(),this.closePopovers(!0)}} @arcgisFieldsDeleted=${async e=>{e.stopPropagation(),this.formattingNode?.remove(),this.formattingNode=void 0,this.popupTemplate=this.layer.popupTemplate?.clone(),[...this.listNode.value.children].forEach(e=>{e&&"CALCITE-LIST-ITEM"===e.nodeName&&(e.selected=!1)}),await this.syncFieldsAndArcadeExpMap(),this.totalSelectedFields=0,this.arcgisFieldsDeleted.emit(e.detail),this.debouncedAttributeUpdates()}}></arcgis-map-config-fields-formatting>`),document.body.appendChild(this.formattingNode))}openFieldAddModal(){this.fieldAddNode=(0,g.dN)(a.qy`<arcgis-field-add .layer=${this.layer} @arcgisFieldAddFieldAdded=${async e=>{const{layer:t}=this;this.layer.popupTemplate.fieldInfos=[...t.popupTemplate.fieldInfos],this.popupTemplate=this.layer.popupTemplate.clone();const i=this.layer.popupTemplate.fieldInfos.find(t=>t.fieldName===e.detail);this.popupTemplate.fieldInfos=[...await(0,h.g)(this.layer,this.popupTemplate),...i?[i]:[]],await this.syncFieldsAndArcadeExpMap(),this.arcgisFieldAdded.emit(e.detail),this.debouncedAttributeUpdates(),this.removeFieldAddNodes()}} @arcgisWorkflowCancel=${()=>this.removeFieldAddNodes()}></arcgis-field-add>`),document.body.appendChild(this.fieldAddNode)}removeFieldAddNodes(){this.fieldAddFabNode.value.disabled=!1,this.fieldAddNode?.parentElement?.childNodes.forEach(e=>{"ARCGIS-FIELD-ADD"===e.nodeName&&(e.remove(),this.fieldAddNode=void 0)})}closePopovers(e){if(this.formattingNode&&(this.formattingNode.remove(),this.formattingNode=void 0,e)){const e=this.listNode.value.selectedItems,t=e.find(e=>e.value===this.lastSelectedFieldName);for(const t of e.values())t.selected=!1;this.totalSelectedFields=0,this.lastSelectedFieldName=void 0,setTimeout(()=>{if(t)t.setFocus();else{let e=!1;[...this.listNode.value.children].forEach(t=>{!e&&t&&"CALCITE-LIST-ITEM"===t.nodeName&&(e=!0,t.setFocus())})}},300)}}render(){return this._propWatcherTask.render({complete:()=>{const{_messages:e,layer:t,hideHeading:i,hideLayerTitle:s,dismissible:l,allowFieldAdd:o,calciteFlowProps:d}=this,r=window.customElements?.get("arcgis-field-add");return this.el.classList.add("calcite-match-height"),d?a.qy`<div>${this.renderList()}</div>`:a.qy`<calcite-panel .heading=${i?void 0:e.attributesHeading} .description=${s?void 0:t.title??void 0} .closable=${l} @calcitePanelClose=${async e=>{e.stopPropagation(),await this.done(),this.arcgisClose.emit()}} ${(0,f.K)(this.panelNode)}>${this.renderList()}${r&&o&&this.renderFieldAddFab()||""}</calcite-panel>`}})}renderList(){const{_messages:e,hideTotalSelectedFields:t}=this,i=this.getSortedFieldList().filter(e=>-1===e.fieldName?.indexOf(r.f.relationship));return a.qy`<calcite-list .label=${e.attributesHeading} .filterEnabled=${i.length>=5} .filterPlaceholder=${e.searchFields} selection-mode=multiple @calciteListFilter=${()=>{this.filterFields=this.listNode.value?.filteredItems?.map(e=>e.value)??[],this.dropdownActionNode.value.disabled=this.filterFields.length<=2}} ${(0,f.K)(this.listNode)}>${this.popupTemplate.fieldInfos.length>=5?this.renderSort():""}${!t&&this.totalSelectedFields>0?a.qy`<div class="total-selected-div"><calcite-chip .label=${e.numberFieldsSelected.replace("${number}",`${this.totalSelectedFields}`)} value=selected-fields closable @calciteChipClose=${e=>{e.stopPropagation(),this.closePopovers(!0)}}>${e.numberFieldsSelected.replace("${number}",`${this.totalSelectedFields}`)}</calcite-chip></div>`:""}${i.map(e=>this.renderListItem(e))}</calcite-list>`}renderSort(){const{_messages:e}=this,t=this.popupTemplate.fieldInfos.every(e=>!!(0,n.l)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap));return a.qy`<calcite-dropdown slot=filter-actions-end placement=bottom-end overlay-positioning=fixed><calcite-action slot=trigger .text=${e.sort} title=${e.sort??g.s6} .disabled=${this.allowFieldAdd&&this.filterFields&&this.filterFields.length<=2} ${(0,f.K)(this.dropdownActionNode)}><calcite-icon scale=s icon=sortDescending flip-rtl></calcite-icon></calcite-action><calcite-dropdown-group><calcite-dropdown-item .selected=${"default"===this.lastSortBy} @click=${()=>this.lastSortBy="default"} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="default")}}>${e.default}</calcite-dropdown-item><calcite-dropdown-item .selected=${"display"===this.lastSortBy} @click=${()=>this.lastSortBy="display"} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="display")}}>${e.displayName}</calcite-dropdown-item>${t&&a.qy`<calcite-dropdown-item .selected=${"type"===this.lastSortBy} @click=${()=>this.lastSortBy="type"} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="type")}}>${e.type}</calcite-dropdown-item>`||""}<calcite-dropdown-item .selected=${"field"===this.lastSortBy} @click=${()=>this.lastSortBy="field"} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&(this.lastSortBy="field")}}>${e.fieldName}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown>`}renderFieldAddFab(){const{_messages:e}=this;return a.qy`<calcite-fab scale=s class="floating-add-field-button" slot=fab kind=neutral appearance=outline-fill text-enabled .text=${e.addField} @click=${()=>{this.fieldAddFabNode.value.disabled=!0,this.openFieldAddModal()}} ${(0,f.K)(this.fieldAddFabNode)}></calcite-fab>`}renderListItem(e){const{layer:t,selectedFieldNames:i}=this;return(0,l.D)(e.fieldName,a.qy`<calcite-list-item .label=${(0,n.j)(t,e,this.arcadeExpMap)} .description=${`{${e.fieldName}}`} .value=${e.fieldName} .metadata=${{label:(0,n.j)(t,e,this.arcadeExpMap),fieldName:e.fieldName}} .selected=${e.fieldName&&i.includes(e.fieldName)||this.listNode.value?.selectedItems.some(t=>t.value===e.fieldName)} @click=${t=>{t.stopPropagation(),this.handleListItemClick(e.fieldName)}} @keydown=${t=>{(" "===t.key||"Enter"===t.key)&&(t.preventDefault(),t.stopPropagation(),this.handleListItemClick(e.fieldName))}}><div slot=actions-end class="field-icons">${(({fieldType:e})=>a.qy`<calcite-icon scale=s .icon=${F.get(e)}></calcite-icon>`)({fieldType:(0,n.l)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap)})}</div></calcite-list-item>`)}}(0,s.c)("arcgis-map-config-fields",b)},30812:(e,t,i)=>{i.d(t,{g:()=>o});var s=i(42097),a=i(42855),l=i(66228);async function o(e,t){return await async function(e,t){const i=[],o=new Map(t?.fieldInfos?.map(e=>[e.fieldName,e])),d=await(0,l.g)(e);return d?.size&&(o.forEach(e=>{d.has(e.fieldName)&&("geometry"!==d.get(e.fieldName).type&&i.push(e),d.delete(e.fieldName))}),d.forEach(e=>{if(!["geometry"].includes(e.type)){const t=new s.default;t.fieldName=e.name,t.label=e.alias,t.visible=!1,i.push(t)}}),d.clear()),t?.expressionInfos&&t.expressionInfos?.forEach(e=>{const t=`${a.f.expression}${e.name}`;if(o.has(t))i.push(o.get(t));else{const e=new s.default;e.fieldName=t,e.visible=!1,i.push(e)}}),t?.fieldInfos?.forEach(e=>{e.fieldName.includes(a.f.relationship)&&i.push(e)}),await Promise.resolve(i)}(e,t)}},36486:(e,t,i)=>{i.d(t,{u:()=>l});var s=i(83552),a=i(73679);const l=(0,s.yr)(a.g)},46317:(e,t,i)=>{i.d(t,{D:()=>o});var s=i(85282),a=i(34670),l=i(42466);const o=(0,a.u$)(class extends a.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,l.mY)(e),this.key=t),i}})},47640:(e,t,i)=>{i.d(t,{YZ:()=>o,e1:()=>a});var s=i(4836);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},l=Symbol();class o{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??d,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let a=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){a=!0,i=e}if(this.p===s){if(t===l)this.i=0;else{if(!1===a){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const d=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},83926:(e,t,i)=>{i.d(t,{p:()=>d});var s=i(54312),a=i(6756),l=i(42855),o=i(66228);const d=async(e,t,i)=>{e.closePopup();const s=(0,o.a)(t);if(s!==l.s.parquet&&s!==l.s.voxel){if(s!==l.s.scene||t?.associatedLayer){const a=await r(e,t,i,s);return a?(await e.openPopup({features:[a],location:a.geometry?.extent?.center??a.geometry}),e.popup&&"dockEnabled"in e.popup&&(e.popup.dockEnabled=!0),await Promise.resolve(a)):void await Promise.resolve(void 0)}await Promise.resolve(void 0)}else await Promise.resolve(void 0)},r=async(e,t,i,a)=>{try{let d,r;if(a===l.s.ogcFeature||a===l.s.stream?(d=await e.whenLayerView(t),await s.whenOnce(()=>!d.updating)):d=t,a===l.s.imageryTile||a===l.s.wcs)return(await e.allLayerViews.find(e=>e.layer.id===t.id).fetchPopupFeaturesAtLocation(t.fullExtent?.center))?.[0];if(a===l.s.mapImage&&t.layer.version>=10.5&&!t.layer.capabilities?.operations?.supportsQuery&&t.layer.capabilities?.operations?.supportsIdentify){const i=await(0,o.b)(t,e);return i&&(i.sourceLayer=t),Promise.resolve(i)}const c="isTable"in t&&t.isTable,h=d.createQuery();c||(h.geometry=e.center,h.distance=e.resolution),h.outFields=["*"];const u=await d.queryFeatures(h,{signal:i.signal});if(0===u?.features?.length){const s=d.createQuery();s.geometry=e.extent,s.outFields=["*"],"knowledge-graph-sublayer"===t.type&&(s.returnGeometry=!0);const o=await d.queryFeatures(s,{signal:i.signal});if(o?.features?.length>0)r=await p(o,e,t);else{const s=d.createQuery();s.where=d.definitionExpression||"1=1",s.outFields=["*"],(t.sourceJSON?.advancedQueryCapabilities?.supportsPagination||a===l.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=e.spatialReference,r=(await d.queryFeatures(s,{signal:i.signal}))?.features?.[0]}}else r=u?.features?.[0];return r&&a===l.s.imagery&&(r=await n(t,r)),Promise.resolve(r)}catch(e){return console.log(e),void await Promise.resolve(void 0)}},n=async(e,t)=>{const i=e.createQuery();return i.outFields=["*"].concat(e.rasterFields.map(e=>e.name).filter(e=>e.startsWith("Raster."))),i.geometry=t.geometry,i.outSpatialReference=t.geometry.spatialReference,(await e.queryVisibleRasters(i,{returnTopmostRaster:!0,returnDomainValues:!0}))?.[0]??t},p=async(e,t,i)=>{const s=await(0,o.c)(i);if("point"===s){let i=[void 0,void 0];for(let s=0;s<e.features.length;s++){const a=e.features[s].geometry.distance(t.center);(0===s||(0,o.i)(i?.[1]&&i[1]>a))&&(i=[e.features[s],a])}return i[0]}if("polyline"===s){let i=[void 0,void 0];for(let s=0;s<e.features.length;s++){const l=a.getNearestVertex(e.features[s].geometry,t.center).distance;(0===s||(0,o.i)(i?.[1]&&i[1]>l))&&(i=[e.features[s],l])}return i[0]}if("polygon"===s||"imagery"===(0,o.a)(i)){let i=[void 0,void 0];for(let s=0;s<e.features.length;s++){const a=e.features[s].geometry.centroid.distance(t.center);(0===s||(0,o.i)(i?.[1]&&i[1]>a))&&(i=[e.features[s],a])}return i[0]}return e.features[0]}}}]);