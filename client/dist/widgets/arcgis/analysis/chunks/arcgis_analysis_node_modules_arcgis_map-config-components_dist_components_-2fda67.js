/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-2fda67.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-2fda67"],{23208:(e,t,a)=>{a.d(t,{a:()=>o,b:()=>y,c:()=>d,d:()=>f,g:()=>p,r:()=>n,s:()=>m,u:()=>r});const i={facilityLayer:{facilityIdField:"FACILITY_ID",siteIdField:"SITE_ID",nameField:"NAME"},levelLayer:{levelIdField:"LEVEL_ID",facilityIdField:"FACILITY_ID",longNameField:"NAME",shortNameField:"NAME_SHORT",levelNumberField:"LEVEL_NUMBER",verticalOrderField:"VERTICAL_ORDER"},siteLayer:{siteIdField:"SITE_ID",nameField:"NAME"}};let s;const l=e=>{const t=e?.map;return s=s||t?.floorInfo||{...i},s.siteLayer=s?.siteLayer?.layerId?s.siteLayer:null,s},o=e=>{const t=e?.map,a=l(e);t&&c(a)?t.set("floorInfo",a):n(e)},r=(e,t)=>{const a=l(t),{name:s}=e,r=e.layer;if(r&&"floorInfo"in r&&"levelLayer"===s){const e={floorField:i.levelLayer.levelIdField};r.floorInfo=e}if(r){const e="sublayer"===r.type;a[s]={...i[s]},a[s]&&(a[s].layerId=e?r.layer?.id:r.id,a[s].sublayerId=e?r.id:void 0)}else a[s]=void 0;o(t)},n=e=>{const t=e?.map;t&&(t.floorInfo=null)},c=e=>!(!e?.facilityLayer?.layerId||!e?.levelLayer?.layerId||e?.siteLayer&&!e?.siteLayer.layerId),d=e=>{const t=i[e];return Object.values(t)},p=e=>{const{map:t}=e,a=t?.allLayers;let i=[];return a?.forEach(e=>{const{type:t,floorInfo:a}=e;"map-image"===t?i=i.concat(e.allSublayers.filter(e=>e.fieldsIndex&&!e?.floorInfo).toArray()):!a&&["feature","oriented-imagery"].includes(t)&&i.push(e)}),i},y=async e=>{const{map:t}=e,a=t?.allLayers?.map(async e=>await h(e)).filter(e=>"failed"!==e?.loadStatus),i=a?await Promise.all(a):[];let s=[];return i.forEach(e=>{const{type:t,geometryType:a}=e;"map-image"===t?s=s.concat(e.allSublayers.filter(e=>e.fieldsIndex&&"esriGeometryPolygon"===e.sourceJSON?.geometryType).toArray()):"feature"===t&&"polygon"===a&&s.push(e)}),s},h=async e=>(typeof e.loadAll<"u"?await e.loadAll():await e.load(),e),f=(e,t)=>{const a=t.map?.allLayers,i=l(t),s=i?.[e]?.layerId,o=i?.[e]?.sublayerId;let r=s?a?.find(e=>e.id===s):null;return"map-image"===r?.type&&(r=r.allSublayers.find(e=>e.id===o)),r},m=e=>{const{layer:t}=e;let a;if(a="arcgis-field-list"===e?.localName||"arcgis-map-config-floor-field-list"===e?.localName?Object.values(e.selection)[0]:e?.field,a){const e=t.floorInfo||{};e.floorField=a.name,t.set("floorInfo",e)}}},25925:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigFloorAdditionalLayers:()=>c});var i=a(73679),s=a(4395),l=a(23208),o=a(85643),r=a(73801);const n=s.AH`:host{height:100%}calcite-notice{margin-bottom:1em}`;class c extends r.WF{constructor(){super(...arguments),this.layerPanel=(0,o._)(),this.triggerButton=(0,o._)(),this.reRender=!1,this.placement="bottom-start",this.arcgisDisable=(0,r.lh)(),this.arcgisDismiss=(0,r.lh)(),this.arcgisFloorInfoChange=(0,r.lh)()}static{this.properties={reRender:16,placement:1,_messages:0,view:0}}static{this.styles=n}async close(e){const{popoverNode:t}=this;t&&(this.disableContainer(!1),t.open=!1,t.remove(),this.popoverNode=void 0,this.reRender=!this.reRender,e&&this.arcgisFloorInfoChange.emit())}async open(){requestAnimationFrame(()=>{this.popoverNode&&(this.popoverNode.open=!0)})}async setFocus(){return await(this.layerPanel.value?.setFocus())}disconnectedCallback(){super.disconnectedCallback();const{popoverNode:e}=this;e&&(e.open=!1,e.parentElement?.removeChild(e))}create(){if(this.createPopover(),this.popoverNode){const e=this.createAddLayersFlow("add-layer");this.popoverNode.appendChild(e),this.open()}}createAddLayersFlow(e,t=[]){return this.disableContainer(!0),(0,r.dN)(s.qy`<arcgis-map-config-floor-add-layers-flow .view=${this.view} .mode=${e} .layers=${t} ._messages=${this._messages} @arcgisDone=${()=>this.close(!0)} @arcgisDismiss=${()=>this.close(!1)}></arcgis-map-config-floor-add-layers-flow>`)}createPopover(){this.popoverNode=(0,r.dN)(s.qy`<calcite-popover class="js-app-primary-flyout" .referenceElement=${this.triggerButton.value??this.el} offset-skidding=75 .label=${this._messages.addLayers} placement=bottom-end pointer-disabled></calcite-popover>`),document.body.appendChild(this.popoverNode)}disableContainer(e){const t=this.el.closest("calcite-block");t&&(t.disabled=e),this.arcgisDisable.emit(e)}edit(e){const t=this.getSelectedLayer(e);if(t&&(this.createPopover(),this.popoverNode)){const e=this.createAddLayersFlow("replace-field",[t]);this.popoverNode.appendChild(e),this.open()}}findLayer(e){return this.getLayers()?.find(t=>t.id===e)}getLayers(){const e=this.view,{map:t}=e,a=t?.allLayers;let i=[];return a?.forEach(e=>{if("map-image"===e.type){const{allSublayers:t}=e;i=i.concat(t?.filter(e=>e.fieldsIndex&&e?.floorInfo).toArray())}else e.floorInfo&&i.push(e)}),i}getSelectedLayer(e){const t="calcite-list-item"===e.target.localName?e.target:"calcite-list-item"===e.target.parentElement?.localName?e.target.parentElement:void 0;return t?this.findLayer(t.value):void 0}removeLayer(e){e.floorInfo=void 0,this.reRender=!this.reRender,this.arcgisFloorInfoChange.emit()}render(){return s.qy`${this.renderNotice()}${this.renderPanel()}`}renderNotice(){const{_messages:e}=this;return this.getLayers()?.length?"":s.qy`<calcite-notice scale=s width=auto open><div slot=message>${e.additionalLayersTip}</div></calcite-notice>`}renderPanel(){const{_messages:e}=this,t=(0,l.g)(this.view);return s.qy`<calcite-panel ${(0,o.K)(this.layerPanel)}>${this.renderLayers()}<calcite-fab slot=fab icon=plus appearance=outline-fill kind=neutral text-enabled .label=${e.addLayers} .text=${e.addLayers} .disabled=${0===t.length} scale=s @click=${()=>this.create()} ${(0,o.K)(this.triggerButton)}></calcite-fab></calcite-panel>`}renderLayers(){const e=this.getLayers();return s.qy`<calcite-list .label=${this._messages.additionalLayers} class="calcite-mode-light" @click=${this.edit}>${e.map(e=>this.renderLayer(e))}</calcite-list>`}renderLayer(e){const{title:t,floorInfo:a,id:i}=e;if(!a)return"";const l=`{${a.floorField}}`;return s.qy`<calcite-list-item .label=${t||""} .description=${l} .value=${i}><calcite-action slot=actions-end .text=${this._messages.remove} icon=x @click=${t=>{t.stopPropagation(),this.removeLayer(e)}}></calcite-action></calcite-list-item>`}}(0,i.c)("arcgis-map-config-floor-additional-layers",c)}}]);