/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-0a8da3.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-0a8da3"],{28252:(e,t,a)=>{a.d(t,{u:()=>c});var i=a(85282),s=a(34670),l=a(42466);const n=(e,t,a)=>{const i=new Map;for(let s=t;s<=a;s++)i.set(e[s],s);return i},c=(0,s.u$)(class extends s.WL{constructor(e){if(super(e),e.type!==s.OA.CHILD)throw Error("repeat() can only be used in text expressions")}dt(e,t,a){let i;void 0===a?a=t:void 0!==t&&(i=t);const s=[],l=[];let n=0;for(const t of e)s[n]=i?i(t,n):n,l[n]=a(t,n),n++;return{values:l,keys:s}}render(e,t,a){return this.dt(e,t,a).values}update(e,[t,a,s]){const c=(0,l.cN)(e),{values:o,keys:r}=this.dt(t,a,s);if(!Array.isArray(c))return this.ut=r,o;const h=this.ut??=[],u=[];let d,g,p=0,f=c.length-1,b=0,m=o.length-1;for(;p<=f&&b<=m;)if(null===c[p])p++;else if(null===c[f])f--;else if(h[p]===r[b])u[b]=(0,l.lx)(c[p],o[b]),p++,b++;else if(h[f]===r[m])u[m]=(0,l.lx)(c[f],o[m]),f--,m--;else if(h[p]===r[m])u[m]=(0,l.lx)(c[p],o[m]),(0,l.Dx)(e,u[m+1],c[p]),p++,m--;else if(h[f]===r[b])u[b]=(0,l.lx)(c[f],o[b]),(0,l.Dx)(e,c[p],c[f]),f--,b++;else if(void 0===d&&(d=n(r,b,m),g=n(h,p,f)),d.has(h[p]))if(d.has(h[f])){const t=g.get(r[b]),a=void 0!==t?c[t]:null;if(null===a){const t=(0,l.Dx)(e,c[p]);(0,l.lx)(t,o[b]),u[b]=t}else u[b]=(0,l.lx)(a,o[b]),(0,l.Dx)(e,c[p],a),c[t]=null;b++}else(0,l.KO)(c[f]),f--;else(0,l.KO)(c[p]),p++;for(;b<=m;){const t=(0,l.Dx)(e,u[m+1]);(0,l.lx)(t,o[b]),u[b++]=t}for(;p<=f;){const e=c[p++];null!==e&&(0,l.KO)(e)}return this.ut=r,(0,l.mY)(e,u),i.c0}})},36486:(e,t,a)=>{a.d(t,{u:()=>l});var i=a(83552),s=a(73679);const l=(0,i.yr)(s.g)},42855:(e,t,a)=>{a.d(t,{a:()=>n,f:()=>i,l:()=>s,s:()=>l});var i=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(i||{}),s=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(s||{}),l=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(l||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},46317:(e,t,a)=>{a.d(t,{D:()=>n});var i=a(85282),s=a(34670),l=a(42466);const n=(0,s.u$)(class extends s.WL{constructor(){super(...arguments),this.key=i.s6}render(e,t){return this.key=e,t}update(e,[t,a]){return t!==this.key&&((0,l.mY)(e),this.key=t),a}})},58328:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigTabsManager:()=>d});var i=a(73679),s=a(4395),l=a(46317),n=a(28252),c=a(36486),o=a(66228),r=a(85643),h=a(73801);const u=s.AH`@layer{.arcgis-map-config-tabs-manager{z-index:var(--calcite-z-index)}.arcgis-map-config-tabs-manager calcite-shell-panel{--calcite-internal-shell-panel-height: 100%;--calcite-shell-panel-max-height: 100%}.arcgis-map-config-tabs-manager calcite-panel{height:100%;display:flex;flex:1 1 auto;overflow:hidden}.arcgis-map-config-tabs-manager.l{height:100%}.arcgis-map-config-tabs-manager.m{height:66%}.arcgis-map-config-tabs-manager.s{height:33%}.arcgis-map-config-tabs-manager.collapsed{height:4rem}.arcgis-map-config-tabs-manager.closed{display:none}.arcgis-map-config-tabs-manager calcite-panel[closed]{display:none}.arcgis-map-config-tabs-manager calcite-tabs{height:100%}.arcgis-map-config-tabs-manager calcite-tabs calcite-tab-nav{--calcite-size-xxl: var(--calcite-spacing-lg);padding:0 var(--calcite-spacing-lg)}.arcgis-map-config-tabs-manager calcite-tabs calcite-tab-title{--calcite-icon-color: var(--calcite-ui-border-input);--calcite-ui-text-3: var(--calcite-ui-text-2)}.arcgis-map-config-tabs-manager calcite-tabs calcite-tab-title calcite-loader{margin-left:var(--calcite-spacing-xs)}.arcgis-map-config-tabs-manager calcite-tabs calcite-tab-title[selected]{--calcite-icon-color: var(--calcite-ui-brand)}.arcgis-map-config-tabs-manager calcite-tabs calcite-tab-title[selected] calcite-loader{color:var(--calcite-color-brand)}.arcgis-map-config-tabs-manager calcite-tabs calcite-tab{--calcite-tab-content-block-padding: 0px}.arcgis-map-config-tabs-manager calcite-shell-panel{height:100%;--calcite-shell-panel-max-height: auto;--calcite-shell-panel-min-height: auto;--calcite-shell-panel-height: auto}}`;class d extends h.WF{constructor(){super(...arguments),this.calciteTabNavigationRef=(0,r._)(),this.calciteTabsRef=(0,r._)(),this.calcitePanelRef=(0,r._)(),this.calciteShellPanelRef=(0,r._)(),this.arcgisTunnelRef=(0,r._)(),this.heightSizes=["s","m","l"],this.heightUpElement=(0,r._)(),this.heightDownElement=(0,r._)(),this._messages=(0,c.u)({blocking:!0}),this.onCalciteTabsClose=e=>{this.onTabClose(e.target.tab)},this.onCalciteTabsActivate=async e=>{const t=e.target.tab,a=await this.findTab(t);a&&(a.selected=!0),this.selectedTabId!==t&&this.arcgisTabSelect.emit({id:t}),this.selectedTabId=t},this.height="m",this.tabCount=0,this.unsavedTabs=[],this.hideShellPanel=!1,this.closed=!1,this.collapsed=!1,this.arcgisTabSelect=(0,h.lh)(),this.arcgisTabsClose=(0,h.lh)()}static{this.properties={height:16,selectedTabId:16,tabCount:16,runningTab:16,unsavedTabs:16,hideShellPanel:5,closed:5,collapsed:5}}static{this.styles=u}static{this.shadowRootOptions=h.Iq}async addTab(e){const{title:t,id:a}=e;let i,s;return this.openPanel(),this.openShellPanel(),this.calcitePanelRef.value&&(this.createTabTitleElement(t,a),this.createTabElement(e),i=await this.findTabTitle(a),s=await this.findTab(a),await this.selectTab(a)),i&&s?{tab:s,title:i}:void 0}async canClose(){const e=Array.from(this.calciteTabsRef.value?.querySelectorAll("calcite-tab")??[]);return(await Promise.all(e.map(e=>e.firstChild?.canClose?.(e.tab)))).map((t,a)=>({canClose:t?.canClose??!0,isRunning:t?.isRunning??!1,itemId:e[a].tab})).filter(e=>!e.canClose)}async findTab(e){const t=Array.from(this.el.querySelectorAll("calcite-tab"));return await Promise.resolve(t.find(t=>t.tab===e))}async findTabTitle(e){const t=this.calciteTabNavigationRef.value?.querySelectorAll("calcite-tab-title"),a=t?Array.from(t):[];return await Promise.resolve(a.find(t=>t.tab===e))}async getTabNavElement(){return await Promise.resolve(this.calciteTabNavigationRef.value)}async removeTab(e){return await this.onTabClose(e)}async selectTab(e){await this.unSelectCurrentTab();const t=await this.findTabTitle(e),a=await this.findTab(e);return t&&(this.openPanel(),this.openShellPanel(),t.selected=!0,this.selectedTabId!==e&&this.arcgisTabSelect.emit({id:e}),this.selectedTabId=e),a&&(a.selected=!0),setTimeout(()=>requestAnimationFrame(()=>t?.focus?.()),25),!!t}async setTitle(e,t){const a=await this.findTabTitle(e);if(a){Array.from(this.calciteTabsRef.value?.querySelectorAll("calcite-tooltip")??[]).find(t=>t.id===`${e}-tooltip`)?.remove();const{title:i,tooltip:s}=this.createTitle(t,a,e);a.textContent=i,s&&this.calciteTabsRef.value?.appendChild(s)}}updated(){const e=this.calciteShellPanelRef.value?.shadowRoot?.querySelector(".content");(0,o.i)(e)&&"100%"!==e.style.height&&(e.style.height="100%");const t=this.calcitePanelRef.value?.shadowRoot?.querySelector("calcite-action[id=collapse]")?.shadowRoot?.querySelector("calcite-icon"),a=t?.getAttribute("icon"),i=!1===this.calcitePanelRef.value?.collapsed;i&&"chevron-up"===a?queueMicrotask(()=>t?.setAttribute("icon","chevron-down")):!i&&"chevron-down"===a&&queueMicrotask(()=>t?.setAttribute("icon","chevron-up"))}updateTabCount(){const e=this.calciteTabNavigationRef.value?.querySelectorAll("calcite-tab-title"),t=e?Array.from(e):[];this.tabCount=t.length??0}createTitle(e,t,a){const i=e.length;if(i>30){const n=`${a}-tooltip`,c=Math.round(15);return{title:`${e.substring(0,c)}...${e.substring(i-c+3)}`,tooltip:(0,h.dN)((0,l.D)(n,s.qy`<calcite-tooltip placement=bottom .referenceElement=${t} id=${n??h.s6}>${e}</calcite-tooltip>`))}}return{title:e}}createTabTitleElement(e,t){const{title:a,iconStart:i,iconEnd:l}=e,n=(0,h.dN)(s.qy`<calcite-tab-title .tab=${t} selected closable @calciteTabsActivate=${this.onCalciteTabsActivate} @calciteTabsClose=${this.onCalciteTabsClose}></calcite-tab-title>`);i&&(n.iconStart=i),l&&(n.iconEnd=l);const{title:c,tooltip:o}=this.createTitle(a,n,t);n.textContent=c;const r=this.calciteTabNavigationRef.value?.querySelectorAll("calcite-tab-title"),u=(r?Array.from(r):[]).find(e=>e.tab===t);u&&u.remove(),this.calciteTabNavigationRef.value?.appendChild(n),o&&this.calciteTabsRef.value?.appendChild(o),this.updateTabCount()}createTabElement(e){const{id:t,content:a}=e,i=(0,h.dN)(s.qy`<calcite-tab .tab=${t} selected></calcite-tab>`);i.appendChild(a),Array.from(this.el.querySelectorAll("calcite-tab")).find(e=>e.tab===t)?.remove(),this.calciteTabsRef.value?.appendChild(i)}async unSelectCurrentTab(){if(this.selectedTabId){const e=await this.findTab(this.selectedTabId);e&&(e.selected=!1);const t=await this.findTabTitle(this.selectedTabId);t&&(t.selected=!1),this.selectedTabId=void 0}}async onTabClose(e){const t=await this.findTabTitle(e),a=await this.findTab(e);if(t&&a)if(await(a.firstChild?.close?.(e))??1){this.closeTab(t,a),0===Array.from(this.el.querySelectorAll("calcite-tab")).length&&this.calcitePanelRef.value&&(this.closePanel(),this.closeShellPanel());const i=this.calciteTabNavigationRef.value?.querySelectorAll("calcite-tab-title"),s=i?Array.from(i):[],l=s[0]?.tab;e===this.selectedTabId&&l?this.selectTab(l):this.selectTab(this.selectedTabId??""),1===s.length&&(s[0].closable=!0)}else t.closed=!1,await this.selectTab(e);return!!t}closeTab(e,t){if(e){const t=Array.from(this.calciteTabsRef.value?.querySelectorAll("calcite-tooltip")??[]).find(t=>t.id===`${e.tab}-tooltip`);t&&t.remove(),e.remove(),this.updateTabCount()}t&&t.remove()}closeShellPanel(){this.calciteShellPanelRef.value&&(this.calciteShellPanelRef.value.collapsed=!0)}openShellPanel(){this.calciteShellPanelRef.value&&(this.calciteShellPanelRef.value.collapsed=!1)}closePanel(){this.calcitePanelRef.value&&(this.calcitePanelRef.value.closed=!0),this.closed=!0,this.el.classList.add("closed")}openPanel(){this.calcitePanelRef.value&&(this.calcitePanelRef.value.closed=!1,this.calcitePanelRef.value.collapsed=!1,this.onPanelCollapsed({target:this.calcitePanelRef.value})),this.closed=!1,this.el.classList.remove("closed")}onToggleHeight(e){const{heightSizes:t,height:a,heightUpElement:{value:i},heightDownElement:{value:s}}=this;if(!i||!s)return;const l=(t.indexOf(a)+e)%t.length,n=t[l];this.height=n,this.el.classList.remove(a),this.el.classList.add(n),this.calciteTabsRef.value?.classList.remove(a),this.calciteTabsRef.value?.classList.add(n),n===t[t.length-1]?(i.disabled=!0,s.disabled=!1):n===t[0]?(i.disabled=!1,s.disabled=!0):(i.disabled=!1,s.disabled=!1)}async closeAllTabs(e){const t=this.calciteTabNavigationRef.value?.querySelectorAll("calcite-tab-title"),a=t?Array.from(t):[];await Promise.all(a.map(async t=>{const a=t.tab,i=await this.findTab(a);e&&i&&await(i.firstChild?.discardChanges?.()),this.closeTab(t,i)})),this.closePanel(),this.closeShellPanel(),this.arcgisTabsClose.emit()}async onPanelClose(){if(this.calcitePanelRef.value){const e=await this.canClose();if((e?.length??0)>0){const t=e.filter(e=>!e.canClose&&e.isRunning);this.runningTab=t.length>0?await this.findTabTitle(t[0].itemId??""):void 0,this.runningTab||(this.unsavedTabs=await Promise.all(e.map(e=>this.findTabTitle(e?.itemId??"")))),this.openPanel(),this.openShellPanel()}else await this.closeAllTabs(!1)}}onDialogClose(){this.unsavedTabs=[],this.runningTab=void 0}goBack(){this.onDialogClose(),this.openPanel(),this.openShellPanel()}async discardAll(){this.onDialogClose(),this.calciteTabNavigationRef.value&&await this.closeAllTabs(!0)}onPanelCollapsed(e){this.heightUpElement.value&&this.heightDownElement.value&&(e.target.collapsed?(this.heightUpElement.value.disabled=!0,this.heightDownElement.value.disabled=!0,this.calciteTabsRef.value?.classList.add("collapsed"),this.el.classList.add("collapsed"),this.collapsed=!0):(this.calciteTabsRef.value?.classList.remove("collapsed"),this.el.classList.remove("collapsed"),this.collapsed=!1,this.onToggleHeight(0)))}renderTab(){return s.qy`<calcite-panel closed closable collapsible .heading=${`${this._messages.openTabs}: ${this.tabCount}`} @calcitePanelClose=${this.onPanelClose} @calcitePanelToggle=${this.onPanelCollapsed} .messageOverrides=${{collapse:this._messages.minimizeTooltip,expand:this._messages.restoreTooltip}} ${(0,r.K)(this.calcitePanelRef)}>${(0,l.D)("toggle-panel-height-up",s.qy`<calcite-action icon=chevrons-up slot=header-actions-end @click=${()=>this.onToggleHeight(1)} .text=${this._messages.heightUp} title=${this._messages.heightUpTooltip??h.s6} ${(0,r.K)(this.heightUpElement)}></calcite-action>`)}${(0,l.D)("toggle-panel-height-down",s.qy`<calcite-action icon=chevrons-down slot=header-actions-end @click=${()=>this.onToggleHeight(-1)} .text=${this._messages.heightDown} title=${this._messages.heightDownTooltip??h.s6} ${(0,r.K)(this.heightDownElement)}></calcite-action>`)}<calcite-tabs ${(0,r.K)(this.calciteTabsRef)}>${(0,l.D)("center-tabs-tab-title",s.qy`<calcite-tab-nav slot=title-group ${(0,r.K)(this.calciteTabNavigationRef)}></calcite-tab-nav>`)}</calcite-tabs></calcite-panel>`}renderTabLists(e){return s.qy`<ul style=${(0,h.zl)({"margin-block-start":"auto"})}>${(0,n.u)(e,e=>e.tab,e=>s.qy`<li>${e.textContent}</li>`)}</ul>`}renderDialog(){const e=this.unsavedTabs.length>0||!!this.runningTab;let t="",a=this._messages.unsavedChanges;const i=this.unsavedTabs.filter(e=>!!e),l=i.length;return this.runningTab?(a=this._messages.modelIsRunning,t=this._messages.modalRunningWithEditsContent.replaceAll("${modelName}",this.runningTab.textContent??"")):l>0&&(t=1===l?s.qy`<calcite-label>${this._messages.singleModelChangesText}</calcite-label>${this.renderTabLists(i)}<calcite-label>${this._messages.promptSaveChanges}</calcite-label>`:s.qy`<calcite-label>${this._messages.multiModelChangesText}</calcite-label>${this.renderTabLists(i)}<calcite-label>${this._messages.promptSaveChanges}</calcite-label>`),e?s.qy`<arcgis-tunnel .reference=${this.el} ${(0,r.K)(this.arcgisTunnelRef)}><calcite-modal .open=${e} id=tabs-dialog @calciteModalClose=${this.onDialogClose} kind=danger><span slot=header>${a}</span><div slot=content>${t}</div>${this.runningTab?void 0:s.qy`<calcite-button slot=back kind=neutral @click=${this.discardAll}>${this._messages.discardAll}</calcite-button>`}<calcite-button slot=primary appearance=solid @click=${this.goBack}>${this._messages.goBack}</calcite-button></calcite-modal></arcgis-tunnel>`:(this.arcgisTunnelRef?.value?.remove(),"")}render(){return this.el.classList.add("arcgis-map-config-tabs-manager"),s.qy`${this.renderDialog()}${this.hideShellPanel?this.renderTab():s.qy`<calcite-shell-panel display-mode=float .heightScale=${this.height} layout=horizontal collapsed ${(0,r.K)(this.calciteShellPanelRef)}>${this.renderTab()}</calcite-shell-panel>`}`}}(0,i.c)("arcgis-map-config-tabs-manager",d)},66228:(e,t,a)=>{a.d(t,{a:()=>y,b:()=>$,c:()=>I,d:()=>R,e:()=>S,f:()=>k,g:()=>b,h:()=>m,i:()=>p,j:()=>f,k:()=>w,l:()=>_,m:()=>C,n:()=>d,o:()=>x,p:()=>L,q:()=>q,r:()=>N,s:()=>v,t:()=>P,u:()=>T});var i=a(63438),s=a(18423),l=a(96086),n=a(91813),c=a(21255),o=a(13078),r=a(21303),h=a(12627),u=a(42855);const d=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],g=["feature"];function p(e){return null!=e}function f(e,t,a){const i=t.fieldName;if(i.includes(u.f.expression)){const e=a.get(i);return e?.title?e.title:i}return v(e)&&e.getFieldConfiguration(i)?e.getFieldAlias(i)||i:t.label||i}async function b(e){return new Map((await w(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function m(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const a=`${u.f.expression}${e.name}`;t.set(a,e)}),t}function y(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function T(e){const t=y(e);let a;return t===u.s.wms||t===u.s.mapImage?a=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(a=e.version),Number.parseFloat(a)}function v(e){return"fieldConfigurations"in e&&g.includes(e.type)}async function w(e){return await new Promise((t,a)=>{switch(y(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const i=e,s=i?.layer;s?.portalItem&&s.url.includes("https://demographics")&&s.url.includes(".arcgis.com")?s.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const a=new Map(i.fields.map(e=>[e.name,e])),s=e.thematicGroup.fieldNames,l=[];s.forEach(e=>{a.has(e)&&l.push(a.get(e))}),t(l)}else t(i.fields)}).catch(e=>{a(new Error(e))}):t(i.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function x(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function C(e){return Number((100*(1-e)).toFixed(1))}function P(e){return Number((1-e/100).toFixed(3))}const R=(e,t)=>{const a=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||a.push({name:e.fieldName,alias:e.label,type:"string"})}),a},$=async(e,t)=>{const a=new h.default;return a.geometry=t.extent,a.mapExtent=t.extent,a.returnGeometry=!0,a.tolerance=6,a.layerOption="popup",a.width=t.width,a.height=t.height,a.layerIds=[e.id],(await r.identify(e.layer.url,a))?.results?.[0]?.feature},S=async(e,t,a)=>{const i=await(await e.whenLayerView(t)).queryAggregates();return await A(a,i.features?.[0])},A=async(e,t)=>{let a;if(t)a=t.clone();else{a=new i.default;const t=R(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),a.attributes=e}const l=new s.default;a.geometry=l}return a};function q(e,t){const a=t.startsWith("#"),i=t.startsWith(".");for((i||a)&&(t=t.slice(1));e;){if(a){if(e.id===t)return e}else if(i){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function I(e){if(y(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(y(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function _(e,t,a){let i="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))i="number";else if(t.has(e)){const a=t.get(e);i=a.type?a.type.toLowerCase():""}else if(a.has(e)){const t=a.get(e);i=t.returnType?t.returnType.toLowerCase():""}else i="number";return i}async function k(e,t){try{const a=y(e);if(a===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await $(e,t)||await E(e,t)]};if(a===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await E(e,t)]};const i=a===u.s.ogcFeature||a===u.s.stream?await t.whenLayerView(e):e,s=i.createQuery();s.where=i.definitionExpression||"1=1",s.outFields=["*"],s.returnM="hasM"in e&&e.hasM,s.returnZ="hasZ"in e&&e.hasZ,s.outSpatialReference=t.spatialReference,s.returnGeometry=!0,(i.sourceJSON?.advancedQueryCapabilities?.supportsPagination||a===u.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=t.spatialReference;const l=await i.queryFeatures(s);return l?.features?.length||(l.features[0]=await E(e,t)),l}catch(e){console.error(e)}}async function E(e,t){return await new Promise(a=>{const s=new i.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),s.attributes=t}const r=t.extent;let h;"polygon"===e.geometryType?h=c.default.fromExtent(r):"point"===e.geometryType?h=r.center.clone():"multipoint"===e.geometryType?h=new l.default({points:[[r.center.x,r.center.y]],spatialReference:r.center.spatialReference.clone()}):"polyline"===e.geometryType?(h=new n.default({spatialReference:t.spatialReference.clone()}),h.addPath([[r.xmin,r.ymin],[r.xmax,r.ymax]])):"mesh"===e.geometryType&&(h=o.default.createBox(r.center.clone(),{size:{width:50,height:50,depth:50}})),s.geometry=h,a(s)})}function N(e){return y(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function L(e){return y(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}}}]);