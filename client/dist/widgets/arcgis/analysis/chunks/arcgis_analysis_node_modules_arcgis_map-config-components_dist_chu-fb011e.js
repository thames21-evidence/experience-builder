/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-fb011e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-fb011e"],{4265:(e,t,a)=>{a.d(t,{a:()=>s,d:()=>i,t:()=>l});const i=(e,t)=>{let a,i="idle";const s=async(...s)=>await new Promise(l=>{switch(i){case"flushed":i="idle",a?(clearTimeout(a),l(e(...s))):l(null);break;case"invoked":clearTimeout(a),i="idle",l(e(...s));break;case"cancelled":clearTimeout(a),i="idle",l(null);break;default:a&&clearTimeout(a),i="pending",a=setTimeout(()=>{i="idle",l(e(...s))},t)}});return s.flush=async function(...e){return i="flushed",await s(...e)},s.invoke=async function(...e){return i="invoked",await s(...e)},s.cancel=async function(...e){return i="cancelled",await s(...e)},s.getStatus=function(){return i},s},s=(e,t)=>{let a;return async(...i)=>await new Promise(s=>{a||(a=setTimeout(()=>{clearTimeout(a),a=void 0,s(e(...i))},t))})};function l(e){return new Promise(t=>setTimeout(t,e))}},5589:(e,t,a)=>{a.d(t,{a:()=>r,b:()=>o,g:()=>n,s:()=>c});var i=a(5294),s=(a(52797),a(54312),a(44345),a(55448),a(34031),a(63438),a(5933),a(28927),a(83368),a(89704),a(66228)),l=(a(56451),a(31521),a(23054),a(5077),a(23795),a(17902),a(87420),a(30161),a(81734),a(1225));a(83552),a(77462),a(49403),a(66617),a(10628),a(59640),a(64451),a(6176),a(10454),a(29614),a(94916),a(52554),a(2156),a(4038),a(49851),a(75054),a(15223),a(70169),a(47207),a(70852),a(48103),a(39423),a(85681),a(18444),a(42411),a(9767),a(38218),a(91914),a(86605),a(68196),a(440),a(46547),a(6238),a(7299);function o(e){const{mapView:t}=e,a=(0,l.g)(e),i=a.authoringInfo,o="class-breaks"===a.type?a.classBreakInfos:a.uniqueValueInfos,r=(0,l.c)(a,"size"),n=(0,l.p)(a,"reference-size"),d=(0,l.p)(a,"spike"),u=!!r&&!(0,s.i)(r.minSize),p=!!r&&"number"==typeof r.minSize,h="above-and-below"===i?.univariateTheme;let m=2,g=20;if(n)n.referenceSizeScale&&c(e),[m,g]=[n.sizeStops[0].size,n.sizeStops[1].size];else if(d)[m,g]=[d.sizeStops[0].size,d.sizeStops[1].size];else if(r)if(h){const e=r.stops;[m,g]=[e[2].size,Math.max(e[0].size,e[4].size)]}else if(u){const e=r.stops;[m,g]=[e[0].size,e[e.length-1].size]}else if(p)[m,g]=[r.minSize,r.maxSize];else{const e=t.scale,a=r.minSize.stops,i=r.maxSize.stops;[m,g]=[a[a.length-1].size,i[i.length-1].size];for(let t=0;t<a.length;t++){const s=a[t],l=i[t];if(e<=s.value){if(t>0){const o=a[t-1],r=i[t-1],n=(e-o.value)/(s.value-o.value);[m,g]=[o.size+(s.size-o.size)*n,r.size+(l.size-r.size)*n]}else[m,g]=[a[0].size,i[0].size];break}}}else if(o){const e=o[0].symbol,t=o[o.length-1].symbol;[m,g]=[(0,l.w)(e),(0,l.w)(t)],m>g&&([m,g]=[g,m])}return[m,g]}function r(e,t){const{mapView:a}=e,r=(0,l.g)(e),n=(0,l.c)(r,"size");let c=t[0],d=(0,s.i)(t[1])?t[1]:c;if(n){const l="above-and-below"===r.authoringInfo?.univariateTheme,u=!!n&&!(0,s.i)(n.minSize),p=!!n&&"number"==typeof n.minSize,[h,m]=o(e),g=h>m;if(!g&&c>=m?c=m-.75:g&&c>=h&&(c=h-.75),!g&&h>=d?d=h+.75:g&&m>=d&&(d=m+.75),l){const e=n.stops,a=g?t[1]:t[0],i=g?t[0]:t[1],s=Math.max(...e.map(e=>e.value)),l=e[2].value,o=Math.min(...e.map(e=>e.value)),r=Math.abs(s-l),c=Math.abs(o-l),d=r>c?r:c,u=i-a;e.forEach(e=>{const{value:t}=e;e.size=Math.abs(t-l)/d*u+a})}else if(u){const e=n.stops;n.stops=null,n.minSize=c,n.maxSize=d,n.minDataValue=e[0].value,n.maxDataValue=e[e.length-1].value}else if(p)g?(n.maxSize=c,n.minSize=d):(n.minSize=c,n.maxSize=d);else{const e=a.scale;let t=i.clone(n.minSize.stops),s=i.clone(n.maxSize.stops);g&&([t,s]=[s,t]);let l=c/t[t.length-1].size,o=d/s[s.length-1].size;for(let a=0;a<t.length;a++){const i=t[a],r=s[a];if(e<=i.value){if(a>0){const n=t[a-1],u=s[a-1],p=(e-n.value)/(i.value-n.value),[h,m]=[n.size+(i.size-n.size)*p,u.size+(r.size-u.size)*p];l=c/h,o=d/m}else l=c/t[0].size,o=d/s[0].size;break}}t.forEach(e=>e.size=Math.round(l*e.size*10)/10),s.forEach(e=>e.size=Math.round(o*e.size*10)/10),g&&([t,s]=[s,t]),n.minSize.stops=t,n.maxSize.stops=s}}else{const e=r.classBreakInfos[0].symbol,t=r.classBreakInfos[r.classBreakInfos.length-1].symbol;let a=(0,l.w)(e),i=(0,l.w)(t),s=!1;a>i&&([a,i]=[i,a],s=!0),a!==i&&c>i&&(c=i-.75),a=c,a!==i&&a>d&&(d=a+.75),i=d;const o=i-a,n=1===r.classBreakInfos.length?1:o/(r.classBreakInfos.length-1);r.classBreakInfos.forEach((e,t)=>{const o=e.symbol;s?(0,l.u)(o,i-n*t):(0,l.u)(o,a+n*t)})}}function n(e,t){const a=e.stops,i=a.length-1,s=a[0].value,l=a[i].value;if(t<=s)return a[0].size;if(t>=l)return a[i].size;for(let e=0;e<=i;e++){const i=a[e],s=a[e+1];if(t>=i.value&&t<s.value){const e=s.value-i.value,a=i.size-s.size,l=(t-i.value)/e,o=i.size-a*l;return Math.round(100*o)/100}}return 1}function c(e){const{mapView:t}=e,a=(0,l.g)(e),i=(0,l.p)(a,"reference-size"),s=i.referenceSizeScale/t.scale;i.sizeStops.forEach(e=>e.size*=s),i.referenceSizeScale=t.scale}},13494:(e,t,a)=>{a.d(t,{a:()=>r,c:()=>n});var i=a(5294),s=a(70169),l=a(1225),o=(a(54312),a(44345),a(55448),a(52797),a(34031),a(63438),a(5933),a(89704),a(66228));a(56451),a(31521),a(23054),a(5077),a(23795),a(17902),a(87420),a(30161),a(81734),a(83552),a(77462),a(49403),a(10281),a(83930),a(66617),a(10628),a(59640),a(64451),a(6176),a(10454),a(29614),a(94916),a(52554),a(2156),a(4038),a(49851),a(75054),a(15223),a(47207),a(70852),a(48103),a(39423),a(85681),a(18444),a(42411),a(9767),a(38218),a(91914),a(86605),a(68196),a(440),a(46547),a(28927),a(6238),a(7299);async function r(e,t){const{layer:a,useFeatureReduction:r,mapView:n,selectedFields:d}=e,u=a;t=t||{};const p=(0,l.a)(e,(0,l.g)(e)),h=!!(0,o.i)(t.includeSizeVariable)&&t.includeSizeVariable;return await s.createRenderer({layer:u,view:n,attributes:c(e,t.fieldInfos),pieChartScheme:t.pieChartScheme||(0,l.a3)(e),includeSizeVariable:h,outlineOptimizationEnabled:(0,o.i)(t.outlineOptimizationEnabled)?t.outlineOptimizationEnabled:(0,l.o)(e)&&h,sizeOptimizationEnabled:!(0,o.i)(t.sizeOptimizationEnabled)||t.sizeOptimizationEnabled,legendOptions:t.legendOptions,forBinning:r}).then(t=>{(0,l.b)(p,t.renderer,{notOpacity:!0});const a=(0,l.d)(e);if(["chart","chart-size"].includes(a)){const a=(0,l._)(e),s=d.map(e=>e.field),o=a.map(e=>e.field),r=s.toString()===o.toString(),n=i.clone(s),c=i.clone(o);n.sort(),c.sort(),n.toString()===c.toString()&&(t.renderer.attributes=(0,l.g)(e).attributes,r||t.renderer.attributes.sort((e,t)=>s.indexOf(e.field)-s.indexOf(t.field)),t.renderer.othersCategory=(0,l.g)(e).othersCategory,t.renderer.holePercentage=(0,l.g)(e).holePercentage)}return t})}async function n(e,t){const{layer:a,useFeatureReduction:i,mapView:r}=e,n=a;t=t||{};const d=(0,l.g)(e),u=(0,l.c)(d,"size"),p=(0,l.p)(d,"size"),h=(0,l.a)(e,d),m=t.fieldInfos?t.fieldInfos:d.attributes.map(e=>({field:e.field,simpleFieldType:l.J.NUMBER}));let g,f=!0;if(t.fieldInfos&&(d.attributes.forEach((e,a)=>{e.field!==t.fieldInfos[a].field&&(f=!1)}),f&&(delete t.fieldInfos,(0,l.O)(t))))return{renderer:d.clone()};f&&(g=d.attributes.map(e=>e.field));const b=(0,l.g)(e),S=b.attributes?.length?b.attributes[0].color:null,y=d.backgroundFillSymbol;let v=!1;u&&(v=u.minSize.stops?u.minSize.stops[0].size>u.maxSize.stops[0].size:u.minSize>u.maxSize);const z=m[0];return m[0]=m[1],m[1]=z,await s.createRenderer({layer:n,view:r,attributes:c(e,m),pieChartScheme:t.pieChartScheme||(0,l.a3)(e),includeSizeVariable:(0,o.i)(t.includeSizeVariable)?t.includeSizeVariable:!!u,outlineOptimizationEnabled:(0,o.i)(t.outlineOptimizationEnabled)?t.outlineOptimizationEnabled:!!h.sizeOutlineVisVar,sizeOptimizationEnabled:(0,o.i)(t.sizeOptimizationEnabled)?t.sizeOptimizationEnabled:!!h.sizeAutoVisVar,legendOptions:void 0,forBinning:i}).then(e=>{if(!t.fieldInfos&&u){const t=(0,l.c)(e.renderer,"size");if(t.minDataValue=u.minDataValue,t.maxDataValue=u.maxDataValue,p){const t=(0,l.p)(e.renderer,"size");t.minSliderValue=p.minSliderValue,t.maxSliderValue=p.maxSliderValue}}if(f&&h.opacityVisVar&&h.authOpacityVisVar&&(e.renderer.visualVariables=(0,l.H)(e.renderer,"opacity"),e.renderer.authoringInfo.visualVariables=(0,l.P)(e.renderer,"opacity"),e.renderer.visualVariables.push(h.opacityVisVar),e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(h.authOpacityVisVar)),(0,l.b)(h,e.renderer,{notOpacity:!0}),g&&e.renderer.attributes.sort((e,t)=>{const a=g.indexOf(e.field),i=g.indexOf(t.field);return a>-1&&i>-1&&a<i?-1:a>-1&&i>-1&&a>i?1:a>-1?-1:i>-1?1:0}),f&&e.renderer.attributes.forEach((e,t)=>{e.label=d.attributes[t].label}),e.renderer.size=d.size,e.renderer.holePercentage=d.holePercentage,e.renderer.othersCategory=d.othersCategory,S&&e.renderer.attributes?.length&&e.renderer.attributes.forEach((e,t)=>{f&&(e.color=d.attributes[t].color)}),y&&(e.renderer.backgroundFillSymbol=y),v){const t=(0,l.c)(e.renderer,"size"),a=t.minSize;t.minSize=t.maxSize,t.maxSize=a}return e})}function c(e,t){return t.map(t=>({field:t.field,label:d(e,t.field)}))}function d(e,t){const a=e.fields.filter(e=>e.layerField.name===t);return a.length?a[0].label:""}},22393:(e,t,a)=>{a.r(t),a.d(t,{ArcgisMapConfigSmartMappingPanelsChart:()=>k});var i=a(73679),s=a(4395),l=a(46317),o=a(5294),r=a(54312),n=a(86421),c=a(56451),d=a(75698),u=a(59640),p=a(1225),h=a(89989),m=(a(44345),a(55448),a(52797),a(34031),a(63438),a(5933),a(28927),a(83368),a(75518)),g=(a(89704),a(18423),a(96086),a(91813),a(21255),a(13078),a(21303),a(12627),a(31521),a(23054),a(5077),a(23795),a(17902),a(87420),a(30161),a(81734),a(65595)),f=a(96333),b=(a(10454),a(29614),a(94916),a(52554),a(2156),a(4038),a(49851),a(75054),a(15223),a(13494)),S=(a(47207),a(70852),a(48103),a(39423),a(85681),a(18444),a(42411),a(9767),a(38218),a(91914),a(86605),a(68196),a(440),a(46547),a(6238),a(7299),a(32173)),y=a(4265),v=a(27155),z=a(85643),C=a(73801);const $=s.AH`:host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.chart-block{overflow-x:hidden}.null-value-toggle{margin-left:-9px}.hidden{display:none}.top-grey-border{border-top:1.5px solid #e0e0e0}.top-padding{margin-top:12px}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol-icon:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.other-null-list-item{min-height:45px}.other-symbol{margin-left:21px}.null-value-actions{display:contents}.shape-slider{background-color:transparent;position:relative;width:100%;padding:0 4px}.slider-labels{margin-top:10px}.space-between{display:flex;justify-content:space-between}.symbol{margin-left:3px}.symbol-icon{width:19px;height:19px;margin:2px}.symbol-is-white{background-color:#f3f3f3}.text-wrap{overflow-wrap:anywhere}:dir(rtl){.null-value-toggle{margin-right:-9px;margin-left:auto}.other-symbol{margin-right:21px;margin-left:auto}.symbol{margin-right:3px;margin-left:auto}}`;class k extends C.WF{constructor(){super(...arguments),this.flowItemNode=(0,z._)(),this.inputNodes={},this.labelNodes={},this.popoverSettings={},this.valueSymbolNodes={},this.smartMappingState=(0,g.u)(),this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisSmartMappingPanelsChartBackClick=(0,C.lh)(),this.arcgisSmartMappingPanelsChartClose=(0,C.lh)(),this.arcgisSmartMappingPanelsChartError=(0,C.lh)(),this.smartMappingCompleteClose=(0,C.lh)()}static{this.properties={menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=$}async setFocus(){await(this.flowItemNode.value?.setFocus())}load(){const{layer:e,_messages:t}=this.smartMappingState,a=(0,p.g)(this.smartMappingState);this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?o.clone(e.featureReduction):void 0,a.defaultLabel||(a.defaultLabel=t.panels.chart.noData),this.smartMappingState.lastDefault={otherColor:a.othersCategory?.color,otherLabel:a.othersCategory?.label||t.panels.chart.other,threshold:a.othersCategory?.threshold,defaultColor:a.defaultColor,defaultLabel:a.defaultLabel},this.percentLabelFlip=(0,p.ao)(this.smartMappingState)}async loaded(){(0,v.i)(this.el.shadowRoot),requestAnimationFrame(async()=>await(this.flowItemNode.value?.setFocus())),this.scaleHandle=(0,h.w)(this.smartMappingState,this.flowItemNode.value,()=>this.smartMappingCompleteClose.emit("cancel"))}disconnectedCallback(){super.disconnectedCallback(),this.popoverSettings?.popoverNode?.remove(),this.sizeSliderWatchHandle?.remove(),this.smartMappingState.lastDefault=void 0,this.smartMappingState.selectedAttribute=void 0,this.smartMappingState.selectedValue=void 0,(0,S.r)(),this.scaleHandle?.remove()}listRefHandler(e){e&&queueMicrotask(()=>{let t=e.querySelectorAll(".symbol-icon");t.forEach(e=>{const t=Number.parseInt(e.getAttribute("data-value"));this.valueSymbolNodes[t]=e}),t=e.querySelectorAll(".label"),t.forEach(e=>{const t=Number.parseInt(e.getAttribute("data-value"));this.labelNodes[t]=e})})}checkboxRefHandler(e){const{smartMappingState:t}=this,{mapView:a}=t;this.adjustSizeNode=e,this.sizeSliderWatchHandle=r.watch(()=>a.scale,(0,y.d)(()=>this.requestUpdate(),100))}shapeDivRefHandler(e){e&&(e.style.width="100%",this.shapeSlider&&(this.shapeSlider.container=e))}infoIconRefHandler(e){const{smartMappingState:t}=this,{_messages:a}=t,i=(0,p.g)(t);e&&(0,S.b)(e,`<div>${a.panels.chart.groupingInfo.replace("${other}",i.othersCategory?.label||a.panels.chart.other)}</div>`,!1)}getSizeByScale(e,t){const a=e.stops,i=a.length-1,s=a[0].value,l=a[i].value;if(t<=s)return a[0].size;if(t>=l)return a[i].size;for(let e=0;e<=i;e++){const i=a[e],s=a[e+1];if(t>=i.value&&t<s.value){const e=s.value-i.value,a=i.size-s.size,l=(t-i.value)/e,o=i.size-a*l;return Math.round(100*o)/100}}return 1}getSizeValue(){const{smartMappingState:e}=this,{mapView:t}=e,a=(0,p.g)(e),i=(0,p.c)(a,"size","auto");if(i){const e=t.scale,a=i.stops;let s=0,l=!1;for(let t=0;t<a.length;t++){const i=a[t];if(e<=i.value){if(l=!0,t>0){const l=a[t-1],o=(e-l.value)/(i.value-l.value);s=l.size+(i.size-l.size)*o}else s=a[0].size;break}}return l||(s=a[a.length-1].size),s}return a.size}handleAutoSizeChange(e){const{smartMappingState:t}=this,a=(0,p.g)(t);if("fixed"===e){const e=(0,p.H)(a,"size","auto");a.visualVariables=e?.length?e:void 0,(0,p.a4)(t),this.requestUpdate()}else(0,m.r)((0,b.c)(t,{sizeOptimizationEnabled:!0}),this.flowItemNode.value).then(e=>{(0,p.a4)(t,e.renderer),this.requestUpdate()},e=>{this.adjustSizeNode.checked=!1,this.arcgisSmartMappingPanelsChartError.emit(e)})}handleChartSizeChange(e){const{smartMappingState:t}=this,{mapView:a}=t,i=(0,p.g)(t),s=Math.max(e,.1),l=(0,p.c)(i,"size","auto");if(l){const e=s/this.getSizeByScale(l,a.scale);this.updateAutoSizeStops(l,e)}else i.size=s;(0,p.a4)(t)}handleNullValueCheckChange(){const{smartMappingState:e}=this,{lastDefault:t}=e,a=(0,p.g)(e);a.defaultColor?(t.defaultColor=a.defaultColor,a.defaultColor=void 0):a.defaultColor=t.defaultColor,(0,p.a4)(e),this.requestUpdate()}handleSortLegend(e){const{smartMappingState:t}=this,a=(0,p.g)(t),i=a.attributes.map(e=>e.clone()),s=e.map(e=>e.value);i.sort((e,t)=>s.indexOf(e.field)-s.indexOf(t.field)),a.attributes=i,(0,p.a4)(t)}handleValueSymbolClick(e){this.popoverSettings?.popoverNode?(this.valueSymbolNodes[e].classList.remove("selected"),this.popoverSettings.index===e?((0,p.f)(),this.popoverSettings.popoverNode=void 0,this.popoverSettings.index=void 0,this.valueSymbolNodes[e].focus()):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}handleValueTextChange(e,t){const{smartMappingState:a}=this,{lastDefault:i,_messages:s}=a,l=(0,p.g)(a),o=d.fromJSON(this.originalRendererJSON);this.inputNodes[e].classList.add("hidden"),t.length||(t=-1===e?o.othersCategory?.label||s.panels.chart.other:-2===e?s.panels.chart.noData:o.attributes.find(t=>t.field===l.attributes[e].field).label),-1===e?(l.othersCategory=l.othersCategory||{color:i?.otherColor,threshold:i?.threshold??0,label:void 0},l.othersCategory.label=t,i.otherLabel=t):-2===e?(l.defaultLabel=t,i.defaultLabel=t):l.attributes=l.attributes.map((a,i)=>(i===e&&(a.label=t),a)),this.labelNodes[e].classList.remove("hidden"),this.inputNodes[e].value=t,(0,p.a4)(a),setTimeout(()=>{this.smartMappingState.selectedValue===e&&(this.labelNodes[e].focus(),this.smartMappingState.selectedValue=void 0)},300)}openSymbolStylerForValue(e){const{smartMappingState:t}=this;(0,p.f)(),this.popoverSettings.popoverNode=(0,C.dN)(s.qy`<arcgis-map-config-smart-mapping-symbol-styler-popover .referenceElement=${this.flowItemNode.value} .heading=${t._messages.styler.symbolStyle} .smartMappingState=${t} @arcgisSmartMappingSymbolStylerPopoverClose=${()=>{this.popoverSettings.popoverNode?.remove(),this.popoverSettings.popoverNode=void 0,this.valueSymbolNodes[e].classList.remove("selected"),setTimeout(()=>{this.valueSymbolNodes[e].focus()},100)}} @arcgisSmartMappingSymbolStylerPopoverDisconnected=${()=>{this.popoverSettings.popoverNode?.remove(),this.popoverSettings.popoverNode=void 0,this.valueSymbolNodes[e].classList.remove("selected")}}></arcgis-map-config-smart-mapping-symbol-styler-popover>`),document.body.appendChild(this.popoverSettings.popoverNode),this.smartMappingState.selectedAttribute=e,(0,f.e)(t,{symbolStylerPopoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,p.a4)(t),this.requestUpdate()}}),this.valueSymbolNodes[e].classList.add("selected")}updateAutoSizeStops(e,t){e.stops.forEach(e=>{e.size*=t})}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:a,_messages:i}=this.smartMappingState,l=e?void 0:a?.title??t.title;return this.el.classList.add("calcite-match-height"),s.qy`<calcite-flow-item class="flow-item" .closable=${(0,p.aa)(this.el)} .heading=${i.panels.styleOptions} .description=${l} .showBackButton=${this.showBackButton} .selected=${this.selected} @calciteFlowItemBack=${e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsChartBackClick.emit()}} ${(0,z.K)(this.flowItemNode)}>${this.renderVisualization()}${this.renderDoneButton()}${this.renderCancelButton()}</calcite-flow-item>`}renderVisualization(){const{smartMappingState:e}=this,{_messages:t}=e,a="chart-size"===(0,p.d)(e);return s.qy`<calcite-block class="chart-block" .heading=${a?t.panels.chart.chartStyleColor:t.panels.chart.chartStyle} expanded>${this.renderChartSymbol()}${this.renderValues()}${this.renderChartSize()}${this.renderShape()}${this.renderMinSlice()}${this.renderBackgroundStyle()}</calcite-block>`}renderChartSymbol(){const{smartMappingState:e}=this,{mapView:t}=e,a=(0,p.g)(e).attributes,i=u.getSchemes({basemap:t.map?.basemap,geometryType:(0,p.j)(e),numColors:a.length}),l=(0,p.k)(i,Math.min(a.length,10))[0].colors,o=a?.length?a.slice(0,10).map((e,t)=>e.color?new c.default(e.color):new c.default(l[t%l.length])):[];return s.qy`<arcgis-map-config-smart-mapping-symbol-button type=chart-ramp .colors=${o} ramp-type=discrete @arcgisSmartMappingSymbolButtonSymbolChange=${()=>this.requestUpdate()}></arcgis-map-config-smart-mapping-symbol-button>`}renderValues(){const{smartMappingState:e}=this,{_messages:t}=e,a=(0,p.g)(e);return s.qy`<calcite-label class="top-padding">${t.panels.chart.fieldName}${(0,l.D)(a.attributes.map(e=>e.field).toString(),s.qy`<calcite-list class="top-grey-border" .label=${t.panels.chart.fields} ${(0,z.K)(this.listRefHandler)}><calcite-list label=attributes drag-enabled @calciteListOrderChange=${e=>{const t=Array.from(e.target.children);this.handleSortLegend(t)}}>${a.attributes.map((e,t)=>this.renderValue(e,t))}</calcite-list>${this.renderOtherValue()}${this.renderNullValue()}</calcite-list>`)}</calcite-label>`}renderValue(e,t){return s.qy`<calcite-list-item scale=s .value=${e.field}>${this.renderSymbolNode(e,t)}${this.renderTextNode(e,t)}</calcite-list-item>`}renderSymbolNode(e,t){const{smartMappingState:a}=this,{selectedAttribute:i,_messages:l}=a,o=(0,p.e)(a);o.color=new c.default(e.color),o.outline=void 0;const r={symbol:!0,"symbol-is-white":(0,p.ad)(o)},n={"symbol-icon":!0,selected:i===t};return s.qy`<div class=${(0,C.CP)(r)} slot=content-start role=button .ariaLabel=${l.panels.chart.accessibility.editSymbolFor.replace("${value}",e.label)} aria-haspopup=true .ariaExpanded=${i===t} @click=${()=>this.handleValueSymbolClick(t)} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&this.handleValueSymbolClick(t)}}><div class=${(0,C.CP)(n)} tabindex=0 aria-hidden=true data-value=${t??C.s6} style=${(0,C.zl)((0,p.at)(o)?{backgroundColor:"",opacity:""}:{backgroundColor:o.color?.toHex()??"#ffffff",opacity:o.color?.a??0})}></div></div>`}renderOtherValue(){const{smartMappingState:e}=this,{lastDefault:t,selectedAttribute:a,_messages:i}=e,l=(0,p.g)(e),o=l.othersCategory?.color||t.otherColor,r=(0,p.e)(e);r.color=new c.default(o),r.outline=void 0;const n=l.othersCategory?.label||t.otherLabel,d={"other-symbol":!0,"symbol-is-white":(0,p.ad)(r)},u={"symbol-icon":!0,selected:-1===a};return s.qy`<calcite-list-item scale=s class="top-grey-border other-null-list-item"><div class=${(0,C.CP)(d)} slot=content-start role=button aria-haspopup=true .ariaExpanded=${-1===a} .ariaLabel=${i.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",n)} @click=${()=>this.handleValueSymbolClick(-1)} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&this.handleValueSymbolClick(-1)}}><div class=${(0,C.CP)(u)} tabindex=0 aria-hidden=true data-value=-1 style=${(0,C.zl)((0,p.at)(r)?{backgroundColor:"",opacity:""}:{backgroundColor:r.color?.toHex()??"#ffffff",opacity:r.color?.a??0})}></div></div>${this.renderTextNode({symbol:r,label:n},-1)}</calcite-list-item>`}renderTextNode(e,t){const{_messages:a}=this.smartMappingState;return s.qy`<div .ariaLabel=${a.panels.chart.accessibility.editLabelFor.replace("${fieldName}",e.label)} class="label text-wrap" slot=content tabindex=0 data-value=${t??C.s6} @click=${e=>{(0,p.f)(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),this.smartMappingState.selectedValue=t}} @keydown=${e=>{(0,p.f)(),(" "===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),this.smartMappingState.selectedValue=t)}}>${e.label}</div><calcite-input class="hidden" slot=content tabindex=0 .value=${e.label} @calciteInputChange=${e=>{const a=e.currentTarget;this.handleValueTextChange(t,a.value)}} @focusout=${e=>{const a=e.currentTarget;this.handleValueTextChange(t,a.value)}} @keydown=${a=>{if("Escape"===a.key){const i=a.currentTarget;i.value=e.label,this.handleValueTextChange(t,i.value)}}} ${(0,z.K)(e=>this.inputNodes[t]=e)}></calcite-input>`}renderNullValue(){const{smartMappingState:e}=this,{lastDefault:t,selectedAttribute:a,_messages:i}=e,l=(0,p.g)(e),o=l.defaultColor||t.defaultColor,r=(0,p.e)(e);r.color=new c.default(o),r.outline=void 0;const n=l.defaultLabel||t?.defaultLabel,d=(0,p.at)(r),u={"null-symbol":!0,"symbol-is-white":(0,p.ad)(r)},h={"symbol-icon":!0,selected:-2===a};return s.qy`<calcite-list-item class="other-null-list-item"><calcite-switch .disabled=${d} slot=actions-start class="null-value-toggle" tabindex=${(d?-1:void 0)??C.s6} .checked=${!!l.defaultColor&&!d} @click=${()=>this.handleNullValueCheckChange()} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&this.handleNullValueCheckChange()}}></calcite-switch><div class=${(0,C.CP)(u)} slot=content-start role=button aria-haspopup=true .ariaExpanded=${-2===a} .ariaLabel=${i.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",n)} @click=${()=>this.handleValueSymbolClick(-2)} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&this.handleValueSymbolClick(-2)}}><div class=${(0,C.CP)(h)} tabindex=0 aria-hidden=true data-value=-2 style=${(0,C.zl)(d?{backgroundColor:"",opacity:""}:{backgroundColor:r.color?.toHex()??"#ffffff",opacity:r.color?.a??0})}></div></div>${this.renderTextNode({symbol:r,label:n},-2)}</calcite-list-item>`}renderChartSize(){const{smartMappingState:e}=this,{_messages:t}=e,a=(0,p.g)(e);if((0,p.c)(a,"size"))return"";const i=(0,p.c)(a,"size","auto"),l=this.getSizeValue(),o=Math.round(l/.75);return s.qy`<calcite-label>${t.panels.chart.chartSize}</calcite-label><arcgis-map-config-smart-mapping-slider-input min=10 max=120 .values=${[o]} precision=0 .suffixText=${t.panels.chart.px} @arcgisSmartMappingSliderInputChange=${e=>this.handleChartSizeChange(.75*e.detail)}></arcgis-map-config-smart-mapping-slider-input><calcite-label scale=s layout=inline><calcite-checkbox scale=s .checked=${!!i} @calciteCheckboxChange=${e=>{this.handleAutoSizeChange(e.target.checked?"automatic":"fixed")}} ${(0,z.K)(this.checkboxRefHandler)}></calcite-checkbox>${t.panels.chart.adjustChartSizeAutomatically}</calcite-label>`}renderShape(){const{smartMappingState:e}=this,{_messages:t}=e,a=(0,p.g)(e);if(this.shapeSlider){const e={values:[a.holePercentage??.5]};this.shapeSlider.set(e)}else{const t={min:0,max:Math.max(.9,a.holePercentage),values:[a.holePercentage??.5],precision:1};this.shapeSlider=new n.default(t),this.shapeSlider?.on("thumb-drag",t=>{(0,p.g)(e).holePercentage=t.value,(0,p.a4)(e)}),this.shapeSlider?.on("thumb-change",t=>{(0,p.g)(e).holePercentage=t.value,(0,p.a4)(e)})}return s.qy`<div class="top-padding"><calcite-label>${t.panels.chart.shape}</calcite-label><div class="shape-slider slider-bottom-label" ${(0,z.K)(this.shapeDivRefHandler)}></div><div class="slider-labels space-between" aria-hidden=true><calcite-label>${t.panels.chart.pie}</calcite-label><calcite-label>${t.panels.chart.donut}</calcite-label></div></div>`}renderMinSlice(){const{smartMappingState:e}=this,{_messages:t}=e,a=(0,p.g)(e),i=a.othersCategory?.threshold??.04;return s.qy`<div class="top-padding"><div class="space-between"><calcite-label layout=inline>${t.panels.chart.grouping}</calcite-label><calcite-icon scale=s icon=information role=button ${(0,z.K)(this.infoIconRefHandler)}></calcite-icon></div><arcgis-map-config-smart-mapping-slider-input .disabled=${!a.othersCategory} min=0 max=50 .values=${[Math.round(100*i)]} precision=0 .prefixText=${this.percentLabelFlip?"%":void 0} .suffixText=${this.percentLabelFlip?void 0:"%"} @arcgisSmartMappingSliderInputChange=${t=>{const a=(0,p.g)(e);a.othersCategory&&(a.othersCategory.threshold=t.detail/100),(0,p.a4)(e)}}></arcgis-map-config-smart-mapping-slider-input></div>`}renderBackgroundStyle(){return s.qy`<arcgis-map-config-smart-mapping-background-symbol></arcgis-map-config-smart-mapping-background-symbol>`}renderDoneButton(){const{_messages:e}=this.smartMappingState;return s.qy`<calcite-button slot=footer .label=${e.done} @click=${()=>this.arcgisSmartMappingPanelsChartClose.emit("save")} appearance=solid width=half>${e.done}</calcite-button>`}renderCancelButton(){const{smartMappingState:e}=this,{_messages:t}=e;return s.qy`<calcite-button slot=footer .label=${t.cancel} @click=${()=>{const{originalRendererJSON:t,originalFeatureReduction:a}=this;(0,p.f)(),(0,p.a8)(e,t,a),this.arcgisSmartMappingPanelsChartClose.emit("cancel")}} appearance=outline-fill width=half>${t.cancel}</calcite-button>`}}(0,i.c)("arcgis-map-config-smart-mapping-panels-chart",k)},27155:(e,t,a)=>{a.d(t,{i:()=>s});var i=a(12762);function s(e){if(!e)return;let t=i.default.assetsPath;t.endsWith("/")||(t+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${t}esri/themes/light/main.css" />`)}},32173:(e,t,a)=>{a.d(t,{A:()=>l,a:()=>n,b:()=>o,r:()=>r});var i=a(4395),s=a(73801);function l(e,t,a,l=!0){const o=document.getElementById(a);o&&o.remove();const r=(0,s.dN)(i.qy`<calcite-tooltip class="smart-mapping-tooltip" id=${a??s.s6} .referenceElement=${e} .open=${l} .innerHTML=${t??""}></calcite-tooltip>`);document.body.append(r)}function o(e,t,a=!0,l){const o=(0,s.dN)(i.qy`<calcite-tooltip class="smart-mapping-tooltip" .referenceElement=${e} .open=${a} .placement=${l??"auto"} .innerHTML=${t??""}></calcite-tooltip>`);document.body.append(o)}function r(){document.querySelectorAll(".smart-mapping-tooltip").forEach(e=>e.remove())}function n(e){const t=document.getElementById(e);"smart-mapping-tooltip"===t?.className&&t.remove()}},46317:(e,t,a)=>{a.d(t,{D:()=>o});var i=a(85282),s=a(34670),l=a(42466);const o=(0,s.u$)(class extends s.WL{constructor(){super(...arguments),this.key=i.s6}render(e,t){return this.key=e,t}update(e,[t,a]){return t!==this.key&&((0,l.mY)(e),this.key=t),a}})},65595:(e,t,a)=>{a.d(t,{c:()=>o,u:()=>r});var i=a(20936),s=a(1225),l=(a(54312),a(44345),a(55448),a(52797),a(34031),a(63438),a(5933),a(28927),a(83368),a(89704),a(5294),a(18423),a(96086),a(91813),a(21255),a(13078),a(21303),a(12627),a(56451),a(31521),a(23054),a(5077),a(23795),a(17902),a(87420),a(30161),a(81734),a(75698),a(10628),a(59640),a(64451),a(6176),a(83552));a(77462),a(49403),a(10281),a(83930),a(66617),a(10454),a(29614),a(94916),a(52554),a(2156),a(4038),a(49851),a(75054),a(15223),a(70169),a(47207),a(70852),a(48103),a(39423),a(85681),a(18444),a(42411),a(9767),a(38218),a(91914),a(86605),a(68196),a(440),a(46547),a(6238),a(7299);function o(e){e.selectedFields=[],e.layerFields=void 0,e.fields=void 0,e.hideLayerTitle=!1,e.supportsArcade=!1,e.stringFieldsCount=-1,e.dateFieldsCount=-1,e.numberFieldsCount=-1,e.containsFlow=!0,e.oneFeatureResponseStatus=s.s.MISSING,e.selectedAttribute=void 0,e.selectedAttributeText=void 0,e.selectedTypeValue=void 0,e.selectedValue=void 0,e.lastDefault=void 0,e.lastDefaults=void 0,e.dotColorSelected=void 0,e.backgroundStyleSelected=void 0,e.lastSettings=void 0,e.classedSymbolSelectedIdx=void 0,e.allUniqueValues=void 0,e.useFeatureReduction=void 0,e.symbolStylerConfig={},e.allowTimeSeriesConfiguration=!1,e.rasterInfo=void 0}function r(){const e=(0,l.Gk)(),t=e;e.manager.onLoad(()=>{t.smartMappingState=function(e,t){const a=n.get(e);if(a)return a;const s=(0,i.el)(e,t);return s&&"store"in s?(n.set(e,s.store),s.store):null}(e.el,"arcgis-map-config-smart-mapping")})}const n=new WeakMap},75518:(e,t,a)=>{let i,s;function l(e){e.loading=!1}async function o(e,t){return function(e){e.loading=!0,s=!1,i&&clearTimeout(i),i=setTimeout(()=>{l(e),s=!0},6e4)}(t),await e.then(e=>{if(l(t),s)throw new Error("timeout");return e}).catch(e=>{throw l(t),e})}a.d(t,{r:()=>o})},89989:(e,t,a)=>{a.d(t,{w:()=>l});var i=a(54312),s=a(1225);a(44345),a(55448),a(52797),a(34031),a(63438),a(5933),a(28927),a(83368),a(89704),a(5294),a(18423),a(96086),a(91813),a(21255),a(13078),a(21303),a(12627),a(56451),a(31521),a(23054),a(5077),a(23795),a(17902),a(87420),a(30161),a(81734),a(75698),a(10628),a(59640),a(64451),a(6176),a(83552),a(77462),a(49403),a(10281),a(83930),a(66617),a(10454),a(29614),a(94916),a(52554),a(2156),a(4038),a(49851),a(75054),a(15223),a(70169),a(47207),a(70852),a(48103),a(39423),a(85681),a(18444),a(42411),a(9767),a(38218),a(91914),a(86605),a(68196),a(440),a(46547),a(6238),a(7299);function l(e,t,a){const{layer:l,mapView:r,useFeatureReduction:n}=e;return n&&"featureReduction"in l&&"binning"===l.featureReduction.type?i.watch(()=>r.scale,()=>{const i=l.featureReduction;r.scale<=i.maxScale&&!t.disabled?((0,s.f)(),function(e,t,a){const i=document.createElement("arcgis-map-config-smart-mapping-scale-alert-popover");i.smartMappingState=e,i.refElement=t,i.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",()=>{o(),a()}),document.body.append(i)}(e,t,a),(0,s.h)(t,!0)):r.scale>i.maxScale&&t.disabled&&(o(),(0,s.h)(t,!1),t.setFocus())}):void 0}function o(){document.querySelectorAll("arcgis-map-config-smart-mapping-scale-alert-popover").forEach(e=>e.remove())}}}]);