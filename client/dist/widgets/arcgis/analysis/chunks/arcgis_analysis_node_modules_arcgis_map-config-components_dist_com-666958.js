/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-666958.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-666958"],{36486:(e,t,i)=>{i.d(t,{u:()=>r});var s=i(83552),a=i(73679);const r=(0,s.yr)(a.g)},42855:(e,t,i)=>{i.d(t,{a:()=>n,f:()=>s,l:()=>a,s:()=>r});var s=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(s||{}),a=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(a||{}),r=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(r||{}),n=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(n||{})},47640:(e,t,i)=>{i.d(t,{YZ:()=>n,e1:()=>a});var s=i(4836);const a={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},r=Symbol();class n{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,i){this.p=0,this.i=0,(this._=e).addController(this);const s="object"==typeof t?t:{task:t,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??o,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,i;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let a=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){a=!0,i=e}if(this.p===s){if(t===r)this.i=0;else{if(!1===a){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=t,this.l=i}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const o=(e,t)=>e===t||e.length===t.length&&e.every((e,i)=>!(0,s.Ec)(e,t[i]))},56678:(e,t,i)=>{i.r(t),i.d(t,{ArcgisMapConfigModalArcade:()=>m});var s=i(73679),a=i(4395),r=i(66228),n=i(36486),o=i(93484),l=i(85643),u=i(47640),c=i(73801),d=i(65722),h=i(42855),p=i(71384);const f=a.AH`@layer{arcgis-map-config-modal-arcade{.arcade-dialog{top:7.5%;left:7.5%;right:7.5%;--calcite-dialog-size-x: 85%;--calcite-dialog-size-y: 85%}.header{display:flex;justify-content:space-between}.inline-editable{width:55%}.separator{margin:1px}.arcade-editor{width:100%;height:100%}arcgis-arcade-editor{z-index:var(--calcite-z-index-header);--calcite-panel-content-space: 0}arcgis-arcade-editor>calcite-tooltip{z-index:var(--calcite-z-index-tooltip)}}}`;class m extends c.WF{constructor(){super(...arguments),this.arcadeEditor=(0,l._)(),this.arcadeTitleInput=(0,l._)(),this._messages=(0,n.u)({blocking:!0}),this.configureTimeSeriesButtonNode=(0,l._)(),this.doneButtonNode=(0,l._)(),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new u.YZ(this,{task:async([e])=>{if(!(0,r.i)(e))throw console.error("[arcgis-map-config-modal-arcade] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.layer]}),this.scriptInvalid=!0,this.hasChanges=!1,this.hideDocumentationActions=!1,this.arcadeScript="",this.suggestions=[],this.returnPredictOutputType=!1,this.arcadeTitleEditable=!1,this.arcadeTitleEditingEnabled=!1,this.addExistingExpressions=!1,this.arcgisClose=(0,c.lh)()}static{this.properties={scriptInvalid:16,hasChanges:16,hideDocumentationActions:5,arcadeScript:1,arcadeProfile:0,testData:0,suggestions:0,returnPredictOutputType:5,arcadeTitle:1,arcadeTitleEditable:5,arcadeTitleEditingEnabled:5,addExistingExpressions:5,layer:0,portal:0,timeSeriesProps:0}}static{this.styles=f}static{this.shadowRootOptions=c.Iq}async updated(){if(this._propWatcherTask.status===u.e1.COMPLETE&&this._initialized&&!this._loaded){this._loaded=!0;const{portal:e}=this,t=this.arcadeProfile&&"id"in this.arcadeProfile?this.arcadeProfile.id:void 0;e?.user?.orgId&&!e.isPortal&&this.arcadeEditor.value&&t&&["labeling","popup-feature-reduction","popup-element-feature-reduction","popup-voxel","popup","popup-element","visualization","aggregate-field","feature-z"].includes(t)&&(await(0,d.o)(this.portal)||(this.arcadeEditor.value.arcadeAssistant={portalUrl:e.url}))}}async init(){if(this.addExistingExpressions&&this.layer){const e=this.getExistingExpressions();e&&(this.suggestions?.length?this.suggestions.push(e):this.suggestions=[e])}this.arcadeScript.length&&(this.scriptInvalid=!1);const{timeSeriesProps:e}=this;e&&!e.fields?.length&&(this.timeSeriesProps=void 0),this._initialized=!0}async getOutputType(){try{const e=await this.arcadeEditor.value.getTestResult();switch(e?.type){case"boolean":case"date":case"time":case"dateOnly":case"dictionary":case"number":return e.type;case"text":return"string";default:return null}}catch{return null}}getExistingExpressions(){if("subtype-sublayer"===this.layer.type)return{label:this._messages.existing,suggestions:[]};const e=o.getExpressionsFromLayer(this.layer).map(e=>({label:e?.title||e?.name||this._messages.newExpression,description:this.getStringFromProfileName(e.profileInfo?.name),code:e.expression}));return{label:this._messages.existing,suggestions:e?.length?e:[]}}getStringFromProfileName(e){switch(e){case"form-constraint":return this._messages.constraint;case"feature-z":return this._messages.featureZ;case"form-calculation":return this._messages.formCalculation;case"labeling":return this._messages.labeling;case"popup":return this._messages.popup;case"popup-element":return this._messages.popupElement;case"popup-feature-reduction":return this._messages.featureReductionPopup;case"popup-element-feature-reduction":return this._messages.featureReductionPopupElement;case"visualization":return this._messages.visualization;case"field-calculation":return this._messages.fieldCalculation;case"aggregate-field":return this._messages.aggregateField;default:return this._messages.unknown}}openTimeSeries(){const{layer:e,timeSeriesProps:t}=this,{fields:i,useFeatureReduction:s}=t||{},r=(0,c.dN)(a.qy`<arcgis-map-config-time-series .layer=${e} .layerDisplayType=${s?h.l.cluster:h.l.feature} .fields=${i} @arcgisClose=${e=>{this.configureTimeSeriesButtonNode.value.disabled=!1;const t=e.detail;r?.remove(),t?.startTime&&t?.endTime?(this.arcadeTitleInput.value.value||(this.arcadeTitleInput.value.value=this._messages.newTimeSeriesExpression),this.arcadeEditor.value.script=t.arcadeExpression,this.timeSeriesInfo=t,setTimeout(()=>this.doneButtonNode.value?.setFocus(),300)):setTimeout(()=>this.configureTimeSeriesButtonNode.value?.setFocus(),300)}}></arcgis-map-config-time-series>`);this.timeSeriesInfo&&(r.preconfiguredTimeSeriesSettings={fieldDateMap:this.timeSeriesInfo.fieldDateMap,startDate:this.timeSeriesInfo.startTime,timeInterval:this.timeSeriesInfo.currentTimeInterval,timeUnit:this.timeSeriesInfo.currentTimeUnit}),document.body.appendChild(r)}render(){return this._propWatcherTask.render({complete:()=>a.qy`<calcite-dialog class="arcade-dialog" open modal escape-disabled outside-close-disabled @calciteDialogClose=${()=>this.arcgisClose.emit(void 0)}>${this.renderHeader()}${this.renderArcadeEditor()}${this.renderFooter()}</calcite-dialog>`})}renderHeader(){const{timeSeriesProps:e,portal:t}=this,i=t?.portalHostname&&(["devext.arcgis.com","qaext.arcgis.com"].includes(t.portalHostname)||"www.arcgis.com"===t.portalHostname&&t.user&&"jsapi"===t.urlKey);return a.qy`<div slot=header-content class="header">${this.arcadeTitle&&this.arcadeTitleEditable?a.qy`<calcite-inline-editable class="inline-editable" scale=l .editingEnabled=${this.arcadeTitleEditingEnabled} .messageOverrides=${{cancelEditing:this._messages.cancel,enableEditing:this._messages.edit,confirmChanges:this._messages.done}}><calcite-input alignment=start .placeholder=${this._messages.titlePlaceHolder} scale=l type=text .value=${this.arcadeTitle||this._messages.newExpression} @calciteInputInput=${()=>this.hasChanges=!0} ${(0,l.K)(this.arcadeTitleInput)}></calcite-input></calcite-inline-editable>`:this.arcadeTitle||this._messages.newExpression}${i&&e?a.qy`<calcite-button appearance=transparent icon-end=${this.timeSeriesInfo?"configure":"launch"} kind=brand @click=${()=>{this.configureTimeSeriesButtonNode.value.disabled=!0,this.openTimeSeries()}} ${(0,l.K)(this.configureTimeSeriesButtonNode)}>${this.timeSeriesInfo?this._messages.reconfigureTimeSeries:this._messages.configureTimeSeries}</calcite-button>`:null}</div>`}renderArcadeEditor(){return a.qy`<arcgis-arcade-editor class="arcade-editor" .hideDocumentationActions=${this.hideDocumentationActions} .script=${this.arcadeScript} .profile=${this.arcadeProfile} .testData=${this.testData} .suggestions=${this.suggestions} @arcgisDiagnosticsChange=${e=>{const t=e.detail;if(t?.length){for(const e of t)if(1===e?.severity)return this.scriptInvalid=!0,void(this.hasChanges=!0);this.scriptInvalid=!1}else this.scriptInvalid=!1;if(!this.hasChanges){const e=this.arcadeEditor.value?.script;this.hasChanges=this.arcadeScript!==e}}} ${(0,l.K)(this.arcadeEditor)}></arcgis-arcade-editor>`}renderFooter(){return a.qy`<calcite-button slot=footer-end appearance=outline-fill alignment=center @click=${()=>this.arcgisClose.emit(void 0)}>${this._messages.cancel}</calcite-button><calcite-button slot=footer-end alignment=center appearance=solid .disabled=${this.scriptInvalid||!this.hasChanges} @click=${async()=>{const e=this.timeSeriesInfo&&this.arcadeEditor.value.script.includes(p.a);this.arcgisClose.emit({script:this.arcadeEditor.value.script,...this.arcadeTitle&&{title:this.arcadeTitleInput.value?.value?.trim()||(e?this._messages.newTimeSeriesExpression:this._messages.newExpression)},...this.returnPredictOutputType&&{predictOutputType:await this.getOutputType()},...e&&{timeSeriesInfo:this.timeSeriesInfo}})}} ${(0,l.K)(this.doneButtonNode)}>${this._messages.done}</calcite-button>`}}(0,s.c)("arcgis-map-config-modal-arcade",m)},65722:(e,t,i)=>{i.d(t,{a:()=>r,g:()=>n,o:()=>o});var s=i(44345);const a=e=>e&&!e.endsWith("/")?`${e}/`:e;function r(e){const{customBaseUrl:t,portalHostname:i,urlKey:s}=e,{protocol:a}=window.location;return`${a}//${s?`${s}.${t}`:i}`}function n(e){return a(e.restUrl)}async function o(e){if(!e?.user)return!1;const t=`${n(e)}portals/self/signinSettings`,i=await(0,s.default)(t,{query:{f:"json",async:!1},responseType:"json"});return!(i?.data&&!i.data.blockBetaApps)}},66228:(e,t,i)=>{i.d(t,{a:()=>T,b:()=>I,c:()=>O,d:()=>x,e:()=>A,f:()=>M,g:()=>g,h:()=>y,i:()=>f,j:()=>m,k:()=>P,l:()=>S,m:()=>_,n:()=>h,o:()=>w,p:()=>$,q:()=>N,r:()=>R,s:()=>v,t:()=>b,u:()=>E});var s=i(63438),a=i(18423),r=i(96086),n=i(91813),o=i(21255),l=i(13078),u=i(21303),c=i(12627),d=i(42855);const h=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],p=["feature"];function f(e){return null!=e}function m(e,t,i){const s=t.fieldName;if(s.includes(d.f.expression)){const e=i.get(s);return e?.title?e.title:s}return v(e)&&e.getFieldConfiguration(s)?e.getFieldAlias(s)||s:t.label||s}async function g(e){return new Map((await P(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function y(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const i=`${d.f.expression}${e.name}`;t.set(i,e)}),t}function T(e){return"map-image"===e?.layer?.type?d.s.mapImage:"subtype-sublayer"===e?.type?d.s.subtype:"tile"===e?.layer?.type?d.s.tile:"scene"===e?.type?d.s.scene:"ogc-feature"===e?.type?d.s.ogcFeature:"imagery"===e?.type?d.s.imagery:"imagery-tile"===e?.type?d.s.imageryTile:"wfs"===e?.type?d.s.wfs:"wcs"===e?.type?d.s.wcs:"wms"===e?.layer?.type?d.s.wms:"csv"===e?.type?d.s.csv:"geojson"===e?.type?d.s.geojson:"stream"===e?.type?d.s.stream:"oriented-imagery"===e?.type?d.s.orientedImagery:"catalog"===e?.type?d.s.catalog:"catalog-footprint"===e?.type?d.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?d.s.knowledgeGraphSublayer:"voxel"===e?.type?d.s.voxel:"parquet"===e?.type?d.s.parquet:d.s.feature}function E(e){const t=T(e);let i;return t===d.s.wms||t===d.s.mapImage?i=e?.layer.version:(t===d.s.imagery||t===d.s.feature||t===d.s.scene)&&(i=e.version),Number.parseFloat(i)}function v(e){return"fieldConfigurations"in e&&p.includes(e.type)}async function P(e){return await new Promise((t,i)=>{switch(T(e)){case d.s.feature:case d.s.ogcFeature:case d.s.stream:t(e.fields);break;case d.s.mapImage:{const s=e,a=s?.layer;a?.portalItem&&a.url.includes("https://demographics")&&a.url.includes(".arcgis.com")?a.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const i=new Map(s.fields.map(e=>[e.name,e])),a=e.thematicGroup.fieldNames,r=[];a.forEach(e=>{i.has(e)&&r.push(i.get(e))}),t(r)}else t(s.fields)}).catch(e=>{i(new Error(e))}):t(s.fields);break}case d.s.imagery:case d.s.imageryTile:case d.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function w(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function _(e){return Number((100*(1-e)).toFixed(1))}function b(e){return Number((1-e/100).toFixed(3))}const x=(e,t)=>{const i=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(d.f.expression)||i.push({name:e.fieldName,alias:e.label,type:"string"})}),i},I=async(e,t)=>{const i=new c.default;return i.geometry=t.extent,i.mapExtent=t.extent,i.returnGeometry=!0,i.tolerance=6,i.layerOption="popup",i.width=t.width,i.height=t.height,i.layerIds=[e.id],(await u.identify(e.layer.url,i))?.results?.[0]?.feature},A=async(e,t,i)=>{const s=await(await e.whenLayerView(t)).queryAggregates();return await F(i,s.features?.[0])},F=async(e,t)=>{let i;if(t)i=t.clone();else{i=new s.default;const t=x(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),i.attributes=e}const r=new a.default;i.geometry=r}return i};function N(e,t){const i=t.startsWith("#"),s=t.startsWith(".");for((s||i)&&(t=t.slice(1));e;){if(i){if(e.id===t)return e}else if(s){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function O(e){if(T(e)===d.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(T(e)===d.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function S(e,t,i){let s="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))s="number";else if(t.has(e)){const i=t.get(e);s=i.type?i.type.toLowerCase():""}else if(i.has(e)){const t=i.get(e);s=t.returnType?t.returnType.toLowerCase():""}else s="number";return s}async function M(e,t){try{const i=T(e);if(i===d.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await I(e,t)||await L(e,t)]};if(i===d.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await L(e,t)]};const s=i===d.s.ogcFeature||i===d.s.stream?await t.whenLayerView(e):e,a=s.createQuery();a.where=s.definitionExpression||"1=1",a.outFields=["*"],a.returnM="hasM"in e&&e.hasM,a.returnZ="hasZ"in e&&e.hasZ,a.outSpatialReference=t.spatialReference,a.returnGeometry=!0,(s.sourceJSON?.advancedQueryCapabilities?.supportsPagination||i===d.s.ogcFeature)&&(a.start=0,a.num=1),a.outSpatialReference=t.spatialReference;const r=await s.queryFeatures(a);return r?.features?.length||(r.features[0]=await L(e,t)),r}catch(e){console.error(e)}}async function L(e,t){return await new Promise(i=>{const a=new s.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),a.attributes=t}const u=t.extent;let c;"polygon"===e.geometryType?c=o.default.fromExtent(u):"point"===e.geometryType?c=u.center.clone():"multipoint"===e.geometryType?c=new r.default({points:[[u.center.x,u.center.y]],spatialReference:u.center.spatialReference.clone()}):"polyline"===e.geometryType?(c=new n.default({spatialReference:t.spatialReference.clone()}),c.addPath([[u.xmin,u.ymin],[u.xmax,u.ymax]])):"mesh"===e.geometryType&&(c=l.default.createBox(u.center.clone(),{size:{width:50,height:50,depth:50}})),a.geometry=c,i(a)})}function R(e){return T(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function $(e){return T(e)===d.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},71384:(e,t,i)=>{i.d(t,{a:()=>s,g:()=>a});const s="timeProperties";function a(e){return`// To configure a time series visualization using this template, data for this layer should be structured so that\n// each row represents a static feature with a fixed location, such as a country boundary or a city location.\n// The attribute table should have two or more fields that represent the same data attributes at different points in time for each feature.\n// Field names should refer to a specific attribute and a specific point in time, such as population in a specific year.\n// e.g. POP1990, POP2000, POP2010, POP2020, POP2030\n\n// There are four areas of this template where modification is necessary for the template to work with your layer\n// Two are required, and two are optional. \n\n// Examine your data and the details below to edit the template accordingly.\n\nvar FIELD_NAME_PATTERN = "POP{Y}"; // Required - Update this to match your data. See Lines 17-49 for details.\nExpects($feature, "POP*"); // Required - Update this to match your data. See Lines 51-63 for details.\nvar DEFAULT_FIELD_NAME = ""; // Optional - See Lines 65-79 for details.\nvar RESULT_FORMAT_PATTERN = "${e?.resultFormatPattern??"#,###.00"}"; // Optional - Update this to match your data. See Lines 81-93 for details.\n\n// FIELD_NAME_PATTERN\n//\n// The field name pattern is used to create the field name from the time slider values.\n// Patterns are defined using the following syntax: fieldName{pattern}\n//\n// EXAMPLE 1: given fields with names Cases_2023_10_01, Cases_2023_10_02, Cases_2023_10_03, etc., the field name pattern would be:\n// var FIELD_NAME_PATTERN = "Cases_{Y_MM_DD}";\n//\n// EXAMPLE 2: given fields with names POP2000, POP2010, POP2020, etc., the field name pattern would be:\n// var FIELD_NAME_PATTERN = "POP{Y}";\n//\n// The following patterns are supported:\n//\n// D: Day of the month, not padded (1 - 31)\n// DD: Day of the month, padded (01 - 31)\n// DDD: Ordinal day of the year (1 - 365)\n// d: Day of the week (1 - 7)\n// ddd: Abbreviated day of the week (e.g. Mon)\n// dddd: Full day of the week (e.g. Monday)\n// M: Month number (1 - 12)\n// MM: Month number, padded (01 - 12)\n// MMM: Abbreviated month name (e.g. Jan)\n// MMMM: Full month name (e.g. January)\n// Y: Full year\n// YY: Two-digit year\n// h: Civilian hours, not padded (1 - 12)\n// hh: Civilian hours, padded (01 - 12)\n// H: Military hours, not padded (0 - 23)\n// HH: Military hours, padded (00 - 23)\n// m: Minutes, not padded (0 - 59)\n// mm: Minutes, padded (00 - 59)\n// s: Seconds, not padded (0 - 59)\n// ss: Seconds, padded (00 - 59)\n\n// EXPECTS\n//\n// Copy and paste the part of the field pattern common to all fields\n// followed by an asterisk (*) into the second parameter of the Expects function.\n// This must be a raw text value like "POP*", not a variable name like FIELD_NAME_PATTERN.\n// \n// EXAMPLE 1: given fields with names Cases_2023_10_01, Cases_2023_10_02, Cases_2023_10_03, etc.\n//   - Expects($feature, \u201cCases_*\u201d);  // includes all fields that start with "Cases_"\n//   - Expects($feature, \u201cCases_2023*\u201d); // includes all Cases fields for the year 2023\n// \n// EXAMPLE 2: given fields with names POP2000, POP2010, POP2020, etc.\n//   - Expects($feature, "POP*"); // includes all fields that start with "POP"\n//   - Expects($feature, "POP2*"); // includes all "POP" fields for all years after 2000\n\n// DEFAULT_FIELD_NAME\n//\n// The field name to return if the time slider is closed.\n// Suggested values might include the first field in the time series,\n// the most recent field in the time series, or possibly an\n// aggregated value, such as TOTAL_POPULATION.\n// \n// EXAMPLE 1: The first field in the time series. Given fields with names POP2000, POP2010, POP2020, TOTAL_POPULATION,\n// var DEFAULT_FIELD_NAME = "POP2000";\n//\n// EXAMPLE 2: An aggregated value such as the total population. Given fields with names POP2000, POP2010, POP2020, TOTAL_POPULATION,\n// var DEFAULT_FIELD_NAME = "TOTAL_POPULATION";\n//\n// Note - If you defined a default field, be sure to include it in the Expects function as a third parameter.\n// e.g. Expects($feature, "POP*", "TOTAL_POPULATION");\n\n// RESULT_FORMAT_PATTERN\n//\n// The result format pattern is used to format the result of the calculation.\n// Patterns are defined using the following syntax: #,###.00\n// This should only be defined for formatting numeric values in labels or popups.\n// If using for symbology/layer styles, or the field data type\n// is a string, then leave this value empty.\n//\n// EXAMPLE 1: if returning a numeric value in a label,\n// var RESULT_FORMAT_PATTERN = "#,###"; // formats the value with commas and rounded to nearest integer\n// \n// EXAMPLE 2: if returning a numeric value in a popup,\n// var RESULT_FORMAT_PATTERN = "#,###.00"; // formats the value with commas and two decimal places\n\nfunction fieldsWithPatternFilter(field) {\n  var prefix = Front(Split(FIELD_NAME_PATTERN, "{"));\n  var suffix = Back(Split(FIELD_NAME_PATTERN, "}"));\n  var patternToFind = DefaultValue(prefix, suffix);\n  return Find(patternToFind, field.name) > -1;\n}\n\nfunction fieldsWithPatternMap(field) {\n  return field.name;\n}\n\nfunction getAllFieldsFromPattern() {\n  var fields = Schema($feature).fields;\n  return Sort(\n    Map(Filter(fields, fieldsWithPatternFilter), fieldsWithPatternMap)\n  );\n}\n\nfunction getFieldNameFromTimeProperties(dateValue, pattern) {\n  var fieldName = pattern;\n\n  var startPosition = Find("{", fieldName);\n  while (startPosition > -1) {\n    var startIndex = Find("{", fieldName, startPosition);\n    var endIndex = Find("}", fieldName, startIndex);\n    var searchText = Mid(fieldName, startIndex, endIndex - startIndex + 1);\n    var dateText = Text(dateValue, searchText);\n    fieldName = Replace(fieldName, searchText, dateText);\n    startPosition = Find("{", fieldName, endIndex);\n  }\n  fieldName = Replace(Replace(fieldName, "{", ""), "}", "");\n  return fieldName;\n}\n\nvar hasCurrentStart = HasValue($view, ["timeProperties", "currentStart"]);\nvar hasCurrentEnd = HasValue($view, ["timeProperties", "currentEnd"]);\n\nvar hasTimeProperties = hasCurrentStart || hasCurrentEnd;\n\nif (!hasTimeProperties) {\n  if (!IsEmpty(DEFAULT_FIELD_NAME) && HasKey($feature, DEFAULT_FIELD_NAME)) {\n    return $feature[DEFAULT_FIELD_NAME];\n  }\n  var firstField = Front(getAllFieldsFromPattern());\n  return $feature[firstField];\n}\n\nvar currentValue = DefaultValue(\n  $view.timeProperties.currentEnd,\n  $view.timeProperties.currentStart\n);\n\nfunction getValueAtInstant() {\n  var fieldName = getFieldNameFromTimeProperties(\n    currentValue,\n    FIELD_NAME_PATTERN\n  );\n  if (HasValue($feature, fieldName)) {\n    var value = $feature[fieldName];\n    return value;\n  }\n  return null;\n}\n\nfunction formatResult(value) {\n  if (IsEmpty(value)) {\n    return null;\n  }\n  if (IsEmpty(RESULT_FORMAT_PATTERN)) {\n    return value;\n  }\n  return Text(value, RESULT_FORMAT_PATTERN);\n}\n\nvar result = getValueAtInstant();\nreturn formatResult(result);`}}}]);