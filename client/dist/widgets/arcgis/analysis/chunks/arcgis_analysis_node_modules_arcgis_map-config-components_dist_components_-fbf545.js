/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-fbf545.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-fbf545"],{61749:(e,i,t)=>{t.r(i),t.d(i,{ArcgisMapConfigLayerViewDefinition:()=>b});var s=t(73679),o=t(4395),a=t(2801),l=(t(2924),t(33752),t(44345),t(13661)),n=t(21255),c=t(83552),r=t(70004),d=t(63438),h=t(61765),p=t(22305),f=t(85643),g=t(73801);const m="notice",u="filter-block",y="filter-chevron",I="aoi-action",_="aoi-bar",v="aoi-button",w="text-center",k="select-fields",$=o.AH`:host{display:none}:host([selected]){display:flex}.panel{height:100%}.hook{height:1px}.notice{margin:8px}.filter-block{cursor:pointer}.filter-block:hover{background-color:var(--calcite-color-foreground-2)}.filter-chevron{margin-right:.5rem}.arcgis--rtl{.filter-chevron{margin-left:.5rem;margin-right:auto}}.aoi-action{width:33%}.aoi-bar{display:flex;justify-content:space-around;margin-bottom:.75rem}.aoi-button{margin-top:.75rem;border-top-width:1px;border-top-style:solid;border-top-color:var(--calcite-color-border-3)}.text-center{text-align:center}.select-fields{margin:0 0 5px}`;class b extends g.WF{constructor(){super(),this._direction=(0,c.jH)(),this.defaultAutoOpenEnabled=!1,this.flowItemNode=(0,f._)(),this.buttonNode=(0,f._)(),this.filterActionNode=(0,f._)(),this.aoiBlockNode=(0,f._)(),this.polygonAction=(0,f._)(),this.rectangleAction=(0,f._)(),this.aoiSymbol={type:"simple-fill",style:"solid",color:[0,0,0,0],outline:{type:"simple-line",style:"solid",color:[255,0,0,255],width:2}},this.onGraphicUpdate=e=>{const{props:i}=this,{view:t,definitionLayerId:s}=i;if(t.closePopup(),"complete"===e.state){const t=e.graphics[0],o=t.geometry.extent,l=t.geometry.rings[0];let n=!1;5===l.length&&l.includes([o.xmin,o.ymin])&&l.includes([o.xmax,o.ymax])&&(n=!0),(0,a.d)(s,{aoi:this.rectangleAction.value.active&&n?o.toJSON():t.geometry.toJSON()},i),(0,a.j)(t.geometry,s,i)}},this.fieldPickListChanges=e=>{e.stopPropagation();const{props:i,requiredFieldNames:t}=this,{definitionLayerId:s}=i,o=e.detail?.selectedFields;if(this.removeFieldsPickList(),o){const e=(0,a.k)(s,i)?.fields||(0,a.l)(s,i).fields,l=e.filter(e=>t.includes(e.name)||o.indexOf(e.name)>-1).map(e=>e.name);if(l.length<e.length)(0,a.d)(s,{fields:l},i);else{const e=(0,a.e)(s,i);e&&(e.fields=void 0),(0,a.s)(i)}this.requestUpdate()}},this.loading=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisDefinitionRefresh=(0,g.lh)(),this.arcgisOverViewRefresh=(0,g.lh)(),this.listenOn(window,"closeLayerViewDefinitionPopovers",this.closeLayerViewDefinitionPopoversHandler)}static{this.properties={loading:16,activeAOIMsg:16,props:0,status:9,menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=$}async setFocus(){this.flowItemNode.value?.setFocus()}load(){const{props:e}=this,{definitionLayerId:i}=e;this.fl=(0,a.l)(i,e),this.adminLayerInfo=(0,a.k)(i,e),this.totalFields=this.adminLayerInfo?.fields||(0,a.l)(i,e).fields,this.requiredFieldNames=(0,a.m)(e)}loaded(){const{props:e}=this,{definitionLayerId:i,_messages:t}=e,s=!!(0,a.e)(i,e)?.aoi;this.activeAOIMsg=s?t.defineView.aoiRestart:t.defineView.aoiSelect,requestAnimationFrame(()=>this.flowItemNode.value?.setFocus())}disconnectedCallback(){super.disconnectedCallback(),this.removeSketchViewModel()}closeLayerViewDefinitionPopoversHandler(){this.removeFieldsPickList()}onBack(){this.arcgisOverViewRefresh.emit()}goFilter(){this.aoiBlockNode.value?.open&&(this.aoiBlockNode.value.open=!1,this.onAOIToggle()),this.status=a.f.FILTER}onBackFilter(){this.status=a.f.DEFINITION,this.arcgisDefinitionRefresh.emit(),setTimeout(()=>this.filterActionNode.value?.setFocus(),200)}async applyFilter(e){const{props:i}=this,{definitionLayerId:t}=i;if(e)(0,a.d)(t,{filter:e},i);else{const e=(0,a.e)(t,i);e&&(e.filter=void 0),(0,a.s)(i)}}onPolygonClick(e){const{props:i}=this,{_messages:t}=i,s=e.target;s.active||(this.sketchViewModel.cancel(),this.sketchViewModel.create("polygon"),s.active=!0,this.rectangleAction.value.active=!1,this.activeAOIMsg=t.defineView.aoiPolygonDraw)}onRectangleClick(e){const{props:i}=this,{_messages:t}=i,s=e.target;s.active||(this.sketchViewModel.cancel(),this.sketchViewModel.create("rectangle"),s.active=!0,this.polygonAction.value.active=!1,this.activeAOIMsg=t.defineView.aoiRectangleDraw)}onDeleteAOIClick(){const{props:e}=this,{definitionLayerId:i,_messages:t}=e;this.sketchViewModel.cancel(),this.graphicsLayer.removeAll();const s=(0,a.e)(i,e);s&&(s.aoi=void 0),(0,a.s)(e),(0,a.j)(void 0,i,e),this.activeAOIMsg=t.defineView.aoiSelect,this.polygonAction.value.disabled=!1,this.rectangleAction.value.disabled=!1,this.aoiBlockNode.value.description=t.defineView.aoiSubtext}async onAOIToggle(){this.aoiBlockNode.value.open?this.setupSketchViewModel():this.removeSketchViewModel()}setupSketchViewModel(){const{props:e,aoiSymbol:i}=this,{layer:t,view:s,definitionLayerId:o}=e;if(this.defaultAutoOpenEnabled=s.popupEnabled,s.popupEnabled=!1,this.graphicsLayer)return;this.graphicsLayer=new h.default,s.map.add(this.graphicsLayer);const l=(0,a.e)(o,e);if(l?.aoi){const e=l.aoi,t=e.rings?n.default.fromJSON(e):new n.default({rings:[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],spatialReference:l.aoi.spatialReference}),s=new d.default({geometry:t,symbol:i});this.graphicsLayer.add(s)}if(this.sketchViewModel=new p.default({layer:this.graphicsLayer,view:s,polygonSymbol:i,updateOnGraphicClick:!0}),this.sketchViewModel){this.sketchViewModel.on("create",e=>this.onGraphicCreate(e)),this.sketchViewModel.on("update",this.onGraphicUpdate);const e="group"===t.type?(0,a.g)(t).map(e=>({layer:e})):[{layer:t}];this.sketchViewModel.snappingOptions.featureSources=e,this.sketchViewModel.snappingOptions.enabled=!0}}removeSketchViewModel(){const{props:e,defaultAutoOpenEnabled:i}=this,{view:t}=e;this.graphicsLayer&&t.map.remove(this.graphicsLayer),this.graphicsLayer?.destroy(),this.graphicsLayer=void 0,this.sketchViewModel?.destroy(),this.sketchViewModel=void 0,t.popupEnabled=i}onGraphicCreate(e){const{props:i}=this,{definitionLayerId:t,_messages:s}=i;if("start"===e.state&&this.polygonAction.value.active&&(this.activeAOIMsg=s.defineView.aoiPolygonEnd),"complete"===e.state){const o=e.graphic,l=o.geometry.extent;(0,a.d)(t,{aoi:this.polygonAction.value.active?o.geometry.toJSON():l.toJSON()},i),(0,a.j)(o.geometry,t,i),this.activeAOIMsg=s.defineView.aoiRestart,this.polygonAction.value.active=!1,this.rectangleAction.value.active=!1,this.polygonAction.value.disabled=!0,this.rectangleAction.value.disabled=!0,this.aoiBlockNode.value.description=""}}applyAOIToAll(){const{props:e}=this,{definitionLayerId:i,layer:t}=e;if("group"!==t.type)return;const s=(0,a.e)(i,e);(0,a.g)(t).map(t=>{if(t.layerId!==i){if(s?.aoi)(0,a.d)(t.layerId,{aoi:JSON.parse(JSON.stringify(s.aoi))},e);else{const i=(0,a.e)(t.layerId,e);i&&(i.aoi=void 0),(0,a.s)(e)}if(s?.aoi){const i=s.aoi.rings?n.default.fromJSON(s.aoi):l.default.fromJSON(s.aoi);(0,a.j)(i,t.layerId,e)}else(0,a.j)(void 0,t.layerId,e)}})}selectFields(e){const{props:i,totalFields:t,requiredFieldNames:s}=this,{view:l,definitionLayerId:n}=i,c=(0,a.e)(n,i);let r=[];r=c?.fields?c.fields:t.filter(e=>!s.includes(e.name)).map(e=>e.name),this.closeLayerViewDefinitionPopoversHandler();const d=this.flowItemNode.value.getBoundingClientRect().width;this.arcgisFieldPickList=(0,g.dN)(o.qy`<arcgis-field-pick-list .popoverProps=${{placement:"auto",offsetDistance:-1*(d?d-5:215),offsetSkidding:0,overlayPositioning:"fixed",popoverWidth:d?d+30:280,refElement:this.flowItemNode.value}} .fields=${this.createPickListFields(e)} .layer=${e} .mapView=${l} show-field-info .selectedFields=${r} multiple show-selection-all @arcgisFieldPickListDismissed=${this.fieldPickListChanges}></arcgis-field-pick-list>`),document.body.appendChild(this.arcgisFieldPickList),this.flowItemNode.value.disabled=!0}createPickListFields(e){const{requiredFieldNames:i,props:t}=this;return((0,a.k)(e.layerId,t)?.fields||(0,a.l)(e.layerId,t).fields).filter(e=>!i.includes(e.name)).map(e=>({name:e.name,alias:e.alias||e.name,type:e.type}))}removeFieldsPickList(){this.flowItemNode.value.disabled=!1,this.arcgisFieldPickList&&(this.arcgisFieldPickList.remove(),this.arcgisFieldPickList=void 0,setTimeout(()=>{this.buttonNode.value.setFocus()},1))}removeField(e){const{props:i,totalFields:t}=this,{definitionLayerId:s}=i;let o=(0,a.e)(s,i);o||(o={layerId:s},i.viewProps=i.viewProps||[],i.viewProps.push(o)),o.fields||(o.fields=t.map(e=>e.name)),o.fields.splice(o.fields.indexOf(e),1),this.requestUpdate()}render(){const{props:e,status:i}=this,{definitionLayerId:t,_messages:s}=e,l=(0,a.l)(t,e);return this.el.classList.add("calcite-match-height"),o.qy`<calcite-flow-item .heading=${s.defineView.definitions} .description=${l.title??""} .selected=${this.selected&&i===a.f.DEFINITION} class="panel" .showBackButton=${this.showBackButton} @calciteFlowItemBack=${this.onBack} ${(0,f.K)(this.flowItemNode)}>${this.renderInfo()}${this.renderFilter()}${this.renderAOI()}${this.renderFields()}</calcite-flow-item>${i===a.f.FILTER?this.renderLayerFilter():null}`}renderInfo(){const{props:e}=this,{config:i,_messages:t}=e,{helpBase:s,helpMap:a}=i;return(0,r.g)(r.l.ARCGIS_COMPONENT_NOTIFICATIONS,r.a.LAYER_VIEW_DEFINITION_DISMISSED)?"":o.qy`<calcite-notice class=${(0,g.CP)(m)} open closable scale=s width=auto @calciteNoticeClose=${()=>{(0,r.s)(r.l.ARCGIS_COMPONENT_NOTIFICATIONS,{key:r.a.LAYER_VIEW_DEFINITION_DISMISSED,value:"true"})}}><div slot=title>${t.defineView.addDefinitions}</div><div slot=message>${t.defineView.addDefinitionsMsg}</div><calcite-link slot=link title=${t.defineView.moreAboutViews??g.s6} target=_blank .href=${`${s}${a[120002839]}`}>${t.defineView.moreAboutViews}</calcite-link></calcite-notice>`}renderFilter(){const{props:e}=this,{definitionLayerId:i,_messages:t}=e,s=(0,a.e)(i,e),l="rtl"===this._direction;return o.qy`<calcite-block .heading=${s?.filter?t.defineView.editFilter:t.defineView.addFilter} class=${(0,g.CP)(u)} tabindex=0 @click=${this.goFilter}><calcite-icon slot=icon icon=filter scale=s></calcite-icon><calcite-action slot=control .icon=${l?"chevron-left":"chevron-right"} class=${(0,g.CP)(y)} scale=s .text=${s?.filter?t.defineView.editFilter:t.defineView.addFilter} ${(0,f.K)(this.filterActionNode)}></calcite-action></calcite-block>`}renderAOI(){const{props:e,fl:i}=this,{definitionLayerId:t,_messages:s}=e;if(i.isTable)return"";const l=(0,a.e)(t,e);return o.qy`<calcite-block .heading=${s.defineView.areaOfInterest} .description=${l?.aoi?void 0:s.defineView.aoiSubtext} collapsible @calciteBlockOpen=${()=>this.onAOIToggle()} @calciteBlockClose=${()=>this.onAOIToggle()} ${(0,f.K)(this.aoiBlockNode)}><calcite-icon slot=icon icon=polygon scale=s></calcite-icon>${this.renderAOIContent()}</calcite-block>`}renderAOIContent(){const{activeAOIMsg:e,props:i}=this,{definitionLayerId:t,layerIds:s,_messages:l}=i,n=!!(0,a.e)(t,i)?.aoi;return o.qy`<div><calcite-action-bar layout=horizontal class=${(0,g.CP)(_)} expand-disabled><calcite-action icon=polygon appearance=solid class=${(0,g.CP)(I)} alignment=center .disabled=${n} scale=s .text=${l.defineView.aoiSketchPolygonLabel} title=${l.defineView.aoiSketchPolygonLabel??g.s6} @click=${n?void 0:this.onPolygonClick} ${(0,f.K)(this.polygonAction)}></calcite-action><calcite-action icon=rectangle appearance=solid class=${(0,g.CP)(I)} alignment=center .disabled=${n} scale=s .text=${l.defineView.aoiSketchRectangleLabel} title=${l.defineView.aoiSketchRectangleLabel??g.s6} @click=${n?void 0:this.onRectangleClick} ${(0,f.K)(this.rectangleAction)}></calcite-action><calcite-action icon=trash appearance=solid class=${(0,g.CP)(I)} alignment=center scale=s .disabled=${!n} .text=${l.defineView.aoiDeleteLabel} title=${l.defineView.aoiDeleteLabel??g.s6} @click=${n?this.onDeleteAOIClick:void 0}></calcite-action></calcite-action-bar><div class=${(0,g.CP)(w)}>${e}</div>${s.length>1?o.qy`<calcite-button appearance=transparent width=full class=${(0,g.CP)(v)} .label=${l.defineView.aoiApplyAll} @click=${()=>this.applyAOIToAll()}>${l.defineView.aoiApplyAll}</calcite-button>`:null}</div>`}renderFields(){const{props:e,totalFields:i}=this,{definitionLayerId:t,_messages:s}=e,l=(0,a.e)(t,e),n=i.length,c=l?.fields?.length||n;return o.qy`<calcite-block .heading=${s.defineView.fields} .description=${`${c}/${n}`} collapsible><calcite-icon slot=icon icon=feature-details scale=s></calcite-icon>${this.renderFieldsContent()}</calcite-block>`}renderFieldsContent(){const{props:e,fl:i,requiredFieldNames:t,totalFields:s}=this,{definitionLayerId:l,_messages:n}=e,c=(0,a.e)(l,e);let r;r=c?.fields?s.filter(e=>c.fields.includes(e.name)||t.includes(e.name)):s;const d=t.length!==s.length,h=r?.map(e=>o.qy`<calcite-list-item .label=${e.alias||e.name}>${t.includes(e.name)?null:o.qy`<calcite-action icon=x scale=s .text=${n.general.remove} slot=actions-end @click=${()=>this.removeField(e.name)}></calcite-action>`}</calcite-list-item>`);return o.qy`<div>${d&&o.qy`<calcite-button class=${(0,g.CP)(k)} appearance=outline-fill round .label=${n.defineView.selectFields} scale=s width=full @click=${()=>this.selectFields(i)} ${(0,f.K)(this.buttonNode)}>${n.defineView.selectFields}</calcite-button>`||""}<calcite-list .label=${n.general.layers}>${h}</calcite-list></div>`}renderLayerFilter(){const{props:e,fl:i,status:t}=this,{view:s,definitionLayerId:l}=e,n=(0,a.e)(l,this.props);return o.qy`<arcgis-common-sql-expression-config .view=${s} .layer=${i} mode=layer-view .whereClause=${n?.filter} .showBackButton=${!0} .selected=${t===a.f.FILTER} @arcgisPanelBackClick=${this.onBackFilter} @arcgisChange=${e=>{e.stopPropagation(),this.applyFilter(e.detail)}}></arcgis-common-sql-expression-config>`}}(0,s.c)("arcgis-map-config-layer-view-definition",b)},70004:(e,i,t)=>{t.d(i,{a:()=>o,g:()=>n,l:()=>s,s:()=>l});var s=(e=>(e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications",e))(s||{}),o=(e=>(e.FEATURE_REDUCTION_WARNING_DISMISSED="arcgis_feature_reduction_warning_dismissed",e.POPUP_WARNING_DISMISSED="arcgis_popup_warning_dismissed",e.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED="arcgis_symbol_styler_incompatible_vector_symbols_dismissed",e.EFFECTS_TIP_DISMISSED="arcgis_effects_tip_dismissed",e.LAYER_VIEW_DEFINITION_DISMISSED="arcgis_layer_view_definition_dismissed",e.LAYER_OVERRIDE_STATUS_TIP_DISMISSED="arcgis_layer_override_status_tip_dismissed",e.SMART_MAPPING_TIP1_DISMISSED="arcgis_smart_mapping_tip1_dismissed",e.SMART_MAPPING_TIP2_DISMISSED="arcgis_smart_mapping_tip2_dismissed",e.LAYER_VIEW_JOIN_TIP_DISMISSED="arcgis_layer_view_join_tip_dismissed",e.MULTIDIMENSIONAL_INFO_TIP_DISMISSED="arcgis_multidimensional_info_tip_dismissed",e))(o||{});const a=e=>{const i=(e=>localStorage.getItem(e))(e);return i?JSON.parse(i):{}},l=(e,i)=>{const t=a(e);t[i.key]=i.value,((e,i)=>{localStorage.setItem(e,i)})(e,JSON.stringify(t))},n=(e,i)=>{const t=a(e);return Object.getOwnPropertyDescriptor(t,i)?t[i]:null}}}]);