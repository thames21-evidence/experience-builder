/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-ef47b3.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_com-ef47b3"],{36486:(e,t,s)=>{s.d(t,{u:()=>a});var r=s(83552),i=s(73679);const a=(0,r.yr)(i.g)},42855:(e,t,s)=>{s.d(t,{a:()=>o,f:()=>r,l:()=>i,s:()=>a});var r=(e=>(e.expression="expression/",e.raster="Raster.",e.relationship="relationships/",e))(r||{}),i=(e=>(e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes",e))(i||{}),a=(e=>(e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms",e))(a||{}),o=(e=>(e.bigInteger="big-integer",e.blob="blob",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset",e))(o||{})},47640:(e,t,s)=>{s.d(t,{YZ:()=>o,e1:()=>i});var r=s(4836);const i={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},a=Symbol();class o{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((e,t)=>{this.o=e,this.h=t}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(e,t,s){this.p=0,this.i=0,(this._=e).addController(this);const r="object"==typeof t?t:{task:t,args:s};this.v=r.task,this.j=r.args,this.m=r.argsEqual??n,this.k=r.onComplete,this.A=r.onError,this.autoRun=r.autoRun??!0,"initialValue"in r&&(this.u=r.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const e=this.j();if(!Array.isArray(e))throw Error("The args function must return an array");return e}async S(){const e=this.T(),t=this.O;this.O=e,e===t||void 0===e||void 0!==t&&this.m(t,e)||await this.run(e)}async run(e){let t,s;e??=this.T(),this.O=e,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const r=++this.p;this.q=new AbortController;let i=!1;try{t=await this.v(e,{signal:this.q.signal})}catch(e){i=!0,s=e}if(this.p===r){if(t===a)this.i=0;else{if(!1===i){try{this.k?.(t)}catch{}this.i=2,this.o?.(t)}else{try{this.A?.(s)}catch{}this.i=3,this.h?.(s)}this.u=t,this.l=s}this._.requestUpdate()}}abort(e){1===this.i&&this.q?.abort(e)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(e){switch(this.i){case 0:return e.initial?.();case 1:return e.pending?.();case 2:return e.complete?.(this.value);case 3:return e.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const n=(e,t)=>e===t||e.length===t.length&&e.every((e,s)=>!(0,r.Ec)(e,t[s]))},66228:(e,t,s)=>{s.d(t,{a:()=>v,b:()=>I,c:()=>_,d:()=>x,e:()=>S,f:()=>q,g:()=>m,h:()=>f,i:()=>g,j:()=>y,k:()=>P,l:()=>R,m:()=>C,n:()=>h,o:()=>$,p:()=>E,q:()=>T,r:()=>O,s:()=>w,t:()=>k,u:()=>b});var r=s(63438),i=s(18423),a=s(96086),o=s(91813),n=s(21255),l=s(13078),c=s(21303),p=s(12627),u=s(42855);const h=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint","sublayer"],d=["feature"];function g(e){return null!=e}function y(e,t,s){const r=t.fieldName;if(r.includes(u.f.expression)){const e=s.get(r);return e?.title?e.title:r}return w(e)&&e.getFieldConfiguration(r)?e.getFieldAlias(r)||r:t.label||r}async function m(e){return new Map((await P(e)).filter(e=>e.visible).map(e=>[e.name,e]))}function f(e){const t=new Map;return e?.expressionInfos&&e.expressionInfos.forEach(e=>{const s=`${u.f.expression}${e.name}`;t.set(s,e)}),t}function v(e){return"map-image"===e?.layer?.type?u.s.mapImage:"subtype-sublayer"===e?.type?u.s.subtype:"tile"===e?.layer?.type?u.s.tile:"scene"===e?.type?u.s.scene:"ogc-feature"===e?.type?u.s.ogcFeature:"imagery"===e?.type?u.s.imagery:"imagery-tile"===e?.type?u.s.imageryTile:"wfs"===e?.type?u.s.wfs:"wcs"===e?.type?u.s.wcs:"wms"===e?.layer?.type?u.s.wms:"csv"===e?.type?u.s.csv:"geojson"===e?.type?u.s.geojson:"stream"===e?.type?u.s.stream:"oriented-imagery"===e?.type?u.s.orientedImagery:"catalog"===e?.type?u.s.catalog:"catalog-footprint"===e?.type?u.s.catalogFootprint:"knowledge-graph-sublayer"===e?.type?u.s.knowledgeGraphSublayer:"voxel"===e?.type?u.s.voxel:"parquet"===e?.type?u.s.parquet:u.s.feature}function b(e){const t=v(e);let s;return t===u.s.wms||t===u.s.mapImage?s=e?.layer.version:(t===u.s.imagery||t===u.s.feature||t===u.s.scene)&&(s=e.version),Number.parseFloat(s)}function w(e){return"fieldConfigurations"in e&&d.includes(e.type)}async function P(e){return await new Promise((t,s)=>{switch(v(e)){case u.s.feature:case u.s.ogcFeature:case u.s.stream:t(e.fields);break;case u.s.mapImage:{const r=e,i=r?.layer;i?.portalItem&&i.url.includes("https://demographics")&&i.url.includes(".arcgis.com")?i.portalItem?.fetchData().then(e=>{if(e?.thematicGroup){const s=new Map(r.fields.map(e=>[e.name,e])),i=e.thematicGroup.fieldNames,a=[];i.forEach(e=>{s.has(e)&&a.push(s.get(e))}),t(a)}else t(r.fields)}).catch(e=>{s(new Error(e))}):t(r.fields);break}case u.s.imagery:case u.s.imageryTile:case u.s.wcs:t(e.rasterFields);break;default:t("fields"in e?e.fields??[]:[])}})}function $(e){if(e)switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return}}function C(e){return Number((100*(1-e)).toFixed(1))}function k(e){return Number((1-e/100).toFixed(3))}const x=(e,t)=>{const s=[];return e?.fieldInfos?.forEach(e=>{e.fieldName?.includes(u.f.expression)||s.push({name:e.fieldName,alias:e.label,type:"string"})}),s},I=async(e,t)=>{const s=new p.default;return s.geometry=t.extent,s.mapExtent=t.extent,s.returnGeometry=!0,s.tolerance=6,s.layerOption="popup",s.width=t.width,s.height=t.height,s.layerIds=[e.id],(await c.identify(e.layer.url,s))?.results?.[0]?.feature},S=async(e,t,s)=>{const r=await(await e.whenLayerView(t)).queryAggregates();return await N(s,r.features?.[0])},N=async(e,t)=>{let s;if(t)s=t.clone();else{s=new r.default;const t=x(e);if(t?.length){const e={};t.forEach(t=>{e[t.name]=""}),s.attributes=e}const a=new i.default;s.geometry=a}return s};function T(e,t){const s=t.startsWith("#"),r=t.startsWith(".");for((r||s)&&(t=t.slice(1));e;){if(s){if(e.id===t)return e}else if(r){if(e.classList.contains(t))return e}else if(e.tagName.toLowerCase()===t.toLowerCase())return e;e=e.parentElement??e.getRootNode()?.host??void 0}}async function _(e){if(v(e)===u.s.stream)return await Promise.resolve("point");if(e.geometryType)return await Promise.resolve(e.geometryType);if(v(e)===u.s.mapImage&&e?.layer?.sourceJSON?.layers){const t=e.layer?.sourceJSON.layers.find(t=>{if(t.id===e.id)return t})?.geometryType?.toLowerCase();if(t)return t.indexOf("point")>-1?await Promise.resolve("point"):t.indexOf("line")>-1?await Promise.resolve("polyline"):t.indexOf("polygon")>-1?await Promise.resolve("polygon"):await Promise.resolve(t);{const t=e?.layer?.findSublayerById(e.id);if(t){const e=await(t?.createFeatureLayer());return e?(await e.load(),await Promise.resolve(e?.geometryType)):void await Promise.resolve()}return void await Promise.resolve()}}await Promise.resolve()}function R(e,t,s){let r="";if(/^raster.(?:item|service)pixelvalue/iu.test(e))r="number";else if(t.has(e)){const s=t.get(e);r=s.type?s.type.toLowerCase():""}else if(s.has(e)){const t=s.get(e);r=t.returnType?t.returnType.toLowerCase():""}else r="number";return r}async function q(e,t){try{const s=v(e);if(s===u.s.mapImage&&e.layer.version>=10.5&&!e.layer.capabilities?.operations?.supportsQuery&&e.layer.capabilities?.operations?.supportsIdentify)return{features:[await I(e,t)||await L(e,t)]};if(s===u.s.scene&&!e.capabilities?.operations?.supportsQuery)return{features:[await L(e,t)]};const r=s===u.s.ogcFeature||s===u.s.stream?await t.whenLayerView(e):e,i=r.createQuery();i.where=r.definitionExpression||"1=1",i.outFields=["*"],i.returnM="hasM"in e&&e.hasM,i.returnZ="hasZ"in e&&e.hasZ,i.outSpatialReference=t.spatialReference,i.returnGeometry=!0,(r.sourceJSON?.advancedQueryCapabilities?.supportsPagination||s===u.s.ogcFeature)&&(i.start=0,i.num=1),i.outSpatialReference=t.spatialReference;const a=await r.queryFeatures(i);return a?.features?.length||(a.features[0]=await L(e,t)),a}catch(e){console.error(e)}}async function L(e,t){return await new Promise(s=>{const i=new r.default;if(e.fields?.length){const t={};e.fields.forEach(e=>{t[e.name]=e.defaultValue}),i.attributes=t}const c=t.extent;let p;"polygon"===e.geometryType?p=n.default.fromExtent(c):"point"===e.geometryType?p=c.center.clone():"multipoint"===e.geometryType?p=new a.default({points:[[c.center.x,c.center.y]],spatialReference:c.center.spatialReference.clone()}):"polyline"===e.geometryType?(p=new o.default({spatialReference:t.spatialReference.clone()}),p.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])):"mesh"===e.geometryType&&(p=l.default.createBox(c.center.clone(),{size:{width:50,height:50,depth:50}})),i.geometry=p,s(i)})}function O(e){return v(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1===e.url?.indexOf(e.parent.url)&&!!e.fields?.length}function E(e){return v(e)===u.s.tile&&"url"in e&&"sublayer"===e.type&&-1!==e.url?.indexOf(e.parent.url)&&!!e.fields?.length}},79198:(e,t,s)=>{s.d(t,{r:()=>i});var r=s(40519);function i(e){const{layer:t}=e;e.layerOriginInfo=r.getLayerOriginInfo(t,"web-map")}},94394:(e,t,s)=>{s.r(t),s.d(t,{ArcgisMapConfigLayerOverride:()=>w});var r=s(73679),i=s(4395),a=s(66228),o=s(79198),n=s(83552),l=s(36486),c=s(40519),p=s(85643),u=s(73801),h=s(47640);const d="container",g="details",y="buttons",m="top-button",f="properties",v="properties-icon",b=i.AH`:host{height:100%}.container{padding:6px;background-color:#fff}.details{width:100%;margin-bottom:8px;border:1px solid var(--calcite-color-border-3);cursor:pointer}.buttons{margin-bottom:14px}.top-button{margin-bottom:4px}.properties{margin-bottom:16px;cursor:pointer}.properties-icon{height:100%;padding:0 var(--calcite-notice-spacing-token-large)}`;class w extends u.WF{constructor(){super(),this._direction=(0,n.jH)(),this.sourceActionNode=(0,p._)(),this._messages=(0,l.u)({blocking:!0}),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new h.YZ(this,{task:async([e,t])=>{if(!(0,a.i)(e)||!(0,a.i)(t))throw console.error("[arcgis-map-config-layer-override] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.layer,this.config]}),this.onPanelScroll=async()=>{if(this.statusPopover){const e=await(this.statusPopover?.getPopoverRect());(0,a.i)(e?.top)&&e.top<0&&this.closePopovers()}if(this.propertiesPopover){const e=await(this.propertiesPopover?.getPopoverRect());(0,a.i)(e?.top)&&e.top<0&&this.closePopovers()}},this.reRender=!1,this.hideDuplicate=!1,this.arcgisChange=(0,u.lh)(),this.arcgisDuplicateClick=(0,u.lh)(),this.arcgisSaveAsLayerClick=(0,u.lh)(),this.arcgisSaveLayerClick=(0,u.lh)(),this.listenOn(window,"closeAllPopovers",this.closeAllPopoversHandler),this.listenOn(window,"arcgisPropertiesChange",this.arcgisPropChange),this.listenOn(window,"arcgisStatusChange",this.arcgisStatusChange)}static{this.properties={props:16,reRender:16,layer:0,config:0,portal:0,hideDuplicate:5}}static{this.styles=b}async done(){this.closePopovers()}async refresh(){(0,o.r)(this.props),this.reRender=!this.reRender,this.propertiesPopover&&(this.propertiesPopover.props=this.props,this.propertiesPopover.manager.component.requestUpdate()),this.statusPopover&&(this.statusPopover.props=this.props,this.statusPopover.manager.component.requestUpdate())}async setFocus(){this.sourceActionNode.value?.setFocus()}updated(){this._propWatcherTask.status===h.e1.COMPLETE&&this._initialized&&!this._loaded&&(this._loaded=!0,this.props.containerPanelNode=(0,a.q)(this.el,"calcite-panel"),this.props.containerPanelNode||(this.props.containerPanelNode=(0,a.q)(this.el,"calcite-flow-item")),this.listenOn(this.props.containerPanelNode,"calcitePanelScroll",this.onPanelScroll))}disconnectedCallback(){super.disconnectedCallback(),this.closePopovers()}async init(){this.props={layer:this.layer,portal:this.portal,config:this.config},c.isSupportedLayer(this.layer),(0,o.r)(this.props),this._initialized=!0}closeAllPopoversHandler(){this.closePopovers()}arcgisPropChange(e){this.arcgisChange.emit(e.detail),this.reRender=!this.reRender}arcgisStatusChange(){this.reRender=!this.reRender}afterCreateSource(e){this.sourceNode=e}afterCreateStatusButton(e){this.statusButtonNode=e}afterCreatePropertiesButton(e){this.propertiesNode=e}closePopovers(){this.closeStatusPopover(),this.closePropertiesPopover(),this.disableContainer(!1)}closeStatusPopover(){this.statusPopover&&(this.statusPopover.remove(),this.statusPopover=void 0,setTimeout(()=>{this.statusButtonNode?.setFocus()},300))}closePropertiesPopover(){this.propertiesPopover&&(this.propertiesPopover.remove(),this.propertiesPopover=void 0,setTimeout(()=>{this.propertiesNode?.setFocus()},300))}openDetails(e){e.stopPropagation(),e.preventDefault();const{layer:t}=this,{portalItem:s}=t;let r;r=s?.portal?s.portal.urlKey?`//${s.portal.urlKey}.${s.portal.customBaseUrl}/home/item.html?id=${s.id}&sublayer=${t.layerId}`:`//${s.portal.portalHostname}/home/item.html?id=${s.id}&sublayer=${t.layerId}`:`${t.url}/${t.layerId}`,window.open(r)}saveLayer(e){e.stopPropagation();const{layer:t}=this;this.arcgisSaveLayerClick.emit(t.id)}saveAsLayer(e){e.stopPropagation();const{layer:t}=this;this.arcgisSaveAsLayerClick.emit(t.id)}duplicateLayer(e){e.stopPropagation();const{layer:t}=this;this.arcgisDuplicateClick.emit(t.id)}async openStatus(e){if(e.stopPropagation(),this.props.containerPanelNode?.disabled||!this.sourceNode)return;if(this.statusPopover){if(this.statusPopover.parentNode)return this.statusPopover.remove(),void(this.statusPopover=void 0);this.statusPopover=void 0}this.closePopovers(),await this.handleScrollIntoView(this.sourceNode);const{props:t,_messages:s}=this;this.statusPopover=(0,u.dN)(i.qy`<arcgis-map-config-layer-override-status .props=${t} ._messages=${s} .popoverReferenceElement=${this.sourceNode}></arcgis-map-config-layer-override-status>`),document.body.appendChild(this.statusPopover),this.disableContainer(!0)}async openManageProps(){if(!this.sourceNode)return;if(this.propertiesPopover){if(this.propertiesPopover.parentNode)return this.propertiesPopover.remove(),void(this.propertiesPopover=void 0);this.propertiesPopover=void 0}this.closePopovers(),await this.handleScrollIntoView(this.sourceNode);const{props:e,_messages:t}=this;this.propertiesPopover=(0,u.dN)(i.qy`<arcgis-map-config-layer-override-properties .props=${e} ._messages=${t} .popoverReferenceElement=${this.sourceNode}></arcgis-map-config-layer-override-properties>`),document.body.appendChild(this.propertiesPopover),this.disableContainer(!0)}handleScrollIntoView(e){return e.getBoundingClientRect()?.top<0?(e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),new Promise(t=>{let s=0;const r=setInterval(()=>{(s>10||e.getBoundingClientRect()?.top>=0)&&(clearInterval(r),t()),s++},100)})):Promise.resolve()}disableContainer(e){this.props.containerPanelNode&&(this.props.containerPanelNode.disabled=e)}canCreateItems(e){return e&&(this.isPublicUser(e)||e.privileges?.includes("portal:user:createItem"))}isPublicUser(e){return!e.orgId}render(){return this._propWatcherTask.render({complete:()=>i.qy`<div class=${(0,u.CP)(d)}>${this.renderSource()}${this.renderCopy()}${this.renderStatus()}${this.renderProperties()}</div>`})}renderSource(){const{_messages:e,layer:t}=this,s=t.portalItem?.title,r=t.title,a="rtl"===this._direction;return i.qy`<calcite-label ${(0,p.K)(this.afterCreateSource)}>${e.sourceLayer}<calcite-block class=${(0,u.CP)(g)} .heading=${(s&&s!==r?a?`${r} / ${s}`:`${s} / ${r}`:r)??void 0} .description=${t.isTable?"Table":"Feature layer"} @click=${this.openDetails}><calcite-action scale=s slot=control icon=launch .text=${e.sourceLayer} @click=${this.openDetails} ${(0,p.K)(this.sourceActionNode)}></calcite-action></calcite-block></calcite-label>`}renderCopy(){const{_messages:e,layer:t,hideDuplicate:s,props:r}=this,{portal:a}=r,o=this.canCreateItems(a?.user),n=["admin","update"].includes(t.portalItem?.itemControl??"");return n||o||!t.isTable&&!s?i.qy`<div class=${(0,u.CP)(y)}>${n&&i.qy`<calcite-button width=full appearance=outline-fill kind=neutral icon-start=save class=${(0,u.CP)(m)} .label=${e.save} @click=${this.saveLayer}>${e.save}</calcite-button>`||""}${o&&i.qy`<calcite-button width=full appearance=outline-fill kind=neutral icon-start=save class=${(0,u.CP)(m)} .label=${e.saveAs} @click=${this.saveAsLayer}>${e.saveAs}</calcite-button>`||""}${!t.isTable&&!s&&i.qy`<calcite-button width=full appearance=outline-fill kind=neutral icon-start=duplicate .label=${e.duplicate} @click=${this.duplicateLayer}>${e.duplicate}</calcite-button>`||""}</div>`:""}renderStatus(){const{_messages:e,layer:t,props:s}=this,{layerOriginInfo:r}=s;return i.qy`<calcite-notice class=${(0,u.CP)(f)} width=full scale=s open @click=${this.openStatus}><div slot=title>${"source"===r.status?e.propsFromSource:"overridden"===r.status?e.propsSetInWebmap:e.somePropsSetInWebmap}</div><calcite-button slot=actions-end icon-start=information scale=s appearance=transparent kind=neutral class=${(0,u.CP)(v)} .label=${t.isTable?e.tableStatus:e.layerStatus} @click=${this.openStatus} ${(0,p.K)(this.afterCreateStatusButton)}></calcite-button></calcite-notice>`}renderProperties(){const{_messages:e,layer:t}=this;return i.qy`<calcite-button appearance=outline-fill kind=neutral width=full .label=${t.isTable?e.manageTableProps:e.manageLayerProps} @click=${this.openManageProps} ${(0,p.K)(this.afterCreatePropertiesButton)}>${t.isTable?e.manageTableProps:e.manageLayerProps}</calcite-button>`}}(0,r.c)("arcgis-map-config-layer-override",w)}}]);