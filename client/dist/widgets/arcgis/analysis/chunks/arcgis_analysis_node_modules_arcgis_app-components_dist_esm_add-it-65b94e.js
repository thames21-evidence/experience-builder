/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_add-it-65b94e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_add-it-65b94e"],{5821:(e,t,r)=>{r.d(t,{a:()=>o,b:()=>n,g:()=>a,s:()=>s,u:()=>l});var i=r(4429);function s(e,t,r,i){!function(e,t,r){r=r||{};let i=null==r?void 0:r.expires;if("number"==typeof i){const e=new Date,t=24*i*60*60*1e3;e.setTime(Date.now()+t),i=r.expires=e}"string"!=typeof i&&(null==i?void 0:i.toUTCString)&&(r.expires=i.toUTCString());let s,a=`${e}=${encodeURIComponent(t)}`;for(s in r){a+=`; ${s}`;const e=r[s];!0!==e&&(a+=`=${e}`)}document.cookie=a}(e,i?JSON.stringify(t):t,r)}function a(e,t){const r=function(e){const t=document.cookie,r=new RegExp(`(?:^|; )${(0,i.e)(e)}=([^;]*)`),s=t.match(r);return s?decodeURIComponent(s[1]):void 0}(e);return r&&t?JSON.parse(r):r}function n(e,t,r){window.localStorage.setItem(e,r?JSON.stringify(t):t)}function o(e,t){const r=window.localStorage.getItem(e);return r&&t?JSON.parse(r):r}function l(e,t,r){const i=new Date(t);var a;i.setFullYear(t.getFullYear()+1),s(e,r,{expires:i}),r?n(e,"true",!1):(a=e,window.localStorage.removeItem(a))}},24869:(e,t,r)=>{r.d(t,{a:()=>a,f:()=>c,g:()=>l,s:()=>n,v:()=>o});var i=r(15912),s=r(46227);function a(e,t){const r=/(?:\.([^.]+))?$/;let i=null==e?void 0:e.replace(/^.*(\\|\/|:)/,""),a=i&&r.exec(i)[1]?r.exec(i)[1].toLowerCase():"",n="";if((null==i?void 0:i.indexOf(".rft."))>-1){const[e,t]=i.split(".rft.");a=`rft.${t}`,n=e}return i&&!n&&(n=-1===i.lastIndexOf(".")?i:i.substring(0,i.lastIndexOf("."))),n=n.replace(/\.|-/g,"_"),t&&(n=function(e){return`${e}_${(0,s.g)()}`}(n),i=`${n}.${a}`),{title:n,fileName:i,extension:a}}function n(e,t){return a(e.name,!!t)}function o(e,t){let r=e;const i=e.lastIndexOf("\\");return i>-1&&(r=r.substring(i+1,r.length)),r.replace(/\ /g,"_")===t.replace(/\ /g,"_")}function l(e){return i.a[e]?i.a[e]:i.a[Object.keys(i.a).find(t=>i.a[t].type===e)]}function c(e){if(!e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${Math.round(e/Math.pow(1024,t))} ${["B","KB","MB","GB","TB"][t]}`}},27137:(e,t,r)=>{r.d(t,{w:()=>i});const i=(0,r(37762).c)({portal:null,user:null,i18n:null,scale:"m",nextText:null,uploadProgress:0}).state},46227:(e,t,r)=>{r.d(t,{g:()=>i});const i=()=>[2,1,1,1,3].map(e=>{let t="";for(let r=0;r<e;r++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t}).join("-")},58573:(e,t,r)=>{r.d(t,{a:()=>p,b:()=>b,c:()=>g,d:()=>y,e:()=>S,f:()=>h,g:()=>v,h:()=>w,i:()=>m,j:()=>u,r:()=>c,s:()=>f,u:()=>d});var i=r(59317),s=r(931),a=r(41473),n=r(5821),o=r(76246),l=r(15912);function c(e){return"/"===(null==e?void 0:e.slice(-1))?e.slice(0,e.length-1):e}function u(e){return e.startsWith("/")||e.startsWith("\\")?e.slice(1):e}async function d(e){const[t]=await(0,s.l)(["esri/core/urlUtils"]);let r=t.urlToObject(e);r.query=r.query||{};for(let e in r.query||{})r.query.hasOwnProperty(e)&&(Array.isArray(r.query[e])||(r.query[e]=r.query[e].replace(/(&lt;|&gt;|<|>|%3C|%3E)/g,"")));return r}function p(e){return(null==e?void 0:e.replace(/^.*\//,"").replace(/.[^.]*$/,""))||""}function v(e){const t=(null==e?void 0:e.replace(/^.*\//,"").replace(/\?+.*/,""))||"",r=t.replace(/^.*\./,"").toLowerCase();return l.A.includes(r)?t:""}function y(e){return["WFS","GeoJson","CSV","GeoRSS","KML","OGCFeatureServer","WMS","WMTS","WCS"].includes(e)}function f(e){const{config:t,portal:r}=i.c;let s=!1;if(!e)return!1;if((t.httpsDomains||[]).forEach(t=>{(e.indexOf(`.${t}/`)>-1||e.indexOf(`/${t}/`)>-1)&&(s=!0)}),!s){let t=r.portalHostname;t.indexOf("/")>-1&&(t=t.substring(0,t.indexOf("/"))),e.indexOf(t)>-1&&(s=!0)}return s}function m(e){if(!e)return!1;const{config:t,portal:r}=i.c,s=(0,a.g)(r),n=new URL(s).hostname,o=!1===t.isMultiTenant,l=-1!==e.indexOf(".arcgis.com/"),c=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features")||-1!==e.indexOf("//locationservices"),u=r.supportsHostedServices&&-1!==e.indexOf(n)&&!o;return l&&c||!l&&u}function g(){var e;if(-1===window.location.protocol.toLowerCase().indexOf("https")){const t=(0,n.g)("esri_auth",!0);return"web"!==(null===(e=null==t?void 0:t.auth_tier)||void 0===e?void 0:e.toLowerCase())}return!0}function h(e){let t=e.toLowerCase();-1==t.indexOf("http://")&&-1==t.indexOf("https://")&&(t=(e="https://"+e).toLowerCase());let r=t.indexOf("//");r=t.indexOf("/",r+2),-1==r?t=(e+="/arcgis/rest/services").toLowerCase():r==t.length-1&&(t=(e+="arcgis/rest/services").toLowerCase());let i=t.indexOf("/arcgis",r);i==t.length-7?t=(e+="/rest/services").toLowerCase():i==t.length-8&&(t=(e+="rest/services").toLowerCase()),i=t.indexOf("/server",r),t.endsWith("/server")?t=(e+="/rest/services").toLowerCase():t.endsWith("/server/")&&(t=(e+="rest/services").toLowerCase());const s=t.indexOf("/rest/services",r),a=t.indexOf("/services",r),n=t.indexOf("/rest",r);return-1==s&&a>-1?t=(e=`${e.substring(0,a)}/rest/services${e.substring(a+9)}`).toLowerCase():-1==s&&n>-1&&(t=(e=`${e.substring(0,n)}/rest/services${e.substring(n+5)}`).toLowerCase()),t.indexOf("/rest/services"),e}const w=(e,t=!1)=>(e=c(e=e.trim()),/(http|https|ftp):\/\/?/.exec(e)||(e=`https://${e}`),!t&&"https:"!==location.protocol||!m(e)&&!f(e)||(e=e.replace("http:/","https:/")),e=e.indexOf("/dynamicLayer?")>-1?e.substring(0,e.indexOf("/dynamicLayer?")):e),S=(e,t=!1)=>{var r,i,s;if(!e)return{error:{code:"invalidUrl"}};if(b(e,t))return{error:{code:"httpWarning"}};const n=decodeURIComponent(e),l=n.replace(a.v,"").match(/((\.|\/)*(kml|kmz))/gi),c=n.replace(a.v,"").match(/((\/|\=)(wmts|wms|wfs|wcs))/gi),u=n.replace(a.v,"").match(/((\/|\=)(OGC|OGCFeatureServer))/gi),d=n.replace(a.v,"").match(/((\.|\/)*(rss))/gi),p=null===(r=n.replace(a.v,"").match(a.r))||void 0===r?void 0:r[1],v=n.replace(a.v,"").match(a.c),y=n.replace(a.v,"").match(/((\.|\/)*(csv))/gi),f=n.replace(a.v,"").match(/(\.|\/)((\$?{(z|level)})\/*(\$?{(x|col)})\/*(\$?{(y|row)}))/gi);let m=null;if(n.match(a.h))m="GeoJson";else if(!u||c||p)if(p&&!c)m=o.a[p];else if(v)m="Map Service";else if(c){const e="/"===(null==c?void 0:c[0].charAt(0))?"/":"=";m=null===(s=null===(i=null==c?void 0:c[0])||void 0===i?void 0:i.split(e)[1])||void 0===s?void 0:s.toUpperCase()}else l?m="KML":d?m="GeoRSS":y?m="CSV":f?m="Tile Layer":n.endsWith("KnowledgeGraphServer")&&(m="Knowledge Graph");else m="OGCFeatureServer";return{result:m}},b=(e,t)=>!t&&e.includes("http://")},60958:(e,t,r)=>{r.d(t,{r:()=>s});var i=r(83692);const s=async(e,t,r={})=>{const{body:s,usePost:a,addTokenManually:n,customToken:o}=r,l=new URLSearchParams;s&&Object.entries(s).forEach(([e,t])=>{void 0!==t&&l.append(e,t)});const c=new URL(e);if(c.searchParams.append("f","json"),o)c.searchParams.append("token",o);else{const e=!1===n?null:await(0,i.g)(t);e&&c.searchParams.append("token",e)}const u=await fetch(c.toString(),{body:a?l:void 0,method:a?"POST":"GET"}),d=await u.json(),p=d.error;if(p)throw"string"==typeof p?new Error(p):p;return d}},71467:(e,t,r)=>{r.d(t,{a:()=>s,b:()=>a,i:()=>n});const i=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","invalidToken","invalid3DObjectFeatureClass","invalidClassification","serviceNameInvalid","titleInvalid","titleStartsWithNumber","titleRequired","titleInUseService","itemInRecycleBin","summaryInvalid","descriptionInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","invalidKeyFile","unauthorizedCredentials","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType","failToCreate3DLayer"],s=e=>i.includes(null==e?void 0:e.code),a=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),n=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}},74695:(e,t,r)=>{r.d(t,{A:()=>me,B:()=>we,M:()=>C,a:()=>fe,b:()=>xe,c:()=>R,d:()=>Ie,e:()=>ke,f:()=>Le,g:()=>ze,h:()=>qe,i:()=>oe,j:()=>_e,k:()=>Be,l:()=>De,m:()=>Ge,n:()=>te,o:()=>Fe,p:()=>Ne,q:()=>ve,r:()=>k,s:()=>P,t:()=>he,u:()=>Me,v:()=>ge,w:()=>ye,x:()=>Je,y:()=>Ae,z:()=>Te});var i=r(88878),s=r(59317),a=r(24869),n=r(46227),o=r(54251),l=r(72257),c=r(27137),u=r(3826),d=r(37762),p=r(15912),v=r(80562),y=r(41473),f=r(71467),m=r(4429),g=r(931),h=r(76246),w=r(58573),S=r(1536),b=r(83692),x=r(29599),O=r(60958),I=r(32478),T=r(15332);const L=async e=>{const t=P.subscribers[e];try{await(null==t?void 0:t.unsubscribe())}catch(e){console.error(`Fail to call unsubscribe for ${t.name}: ${e}`)}},j=(0,d.c)({subscribers:{},unsubscribeAll:async()=>{await Promise.all(Object.keys(P.subscribers).map(L)),j.reset()},addSubscriber:(e,t)=>{const r=`${e}---${(0,n.g)()}`;return P.subscribers[r]={name:e,unsubscribe:t},r},unsubscribe:L,removeSubscriber:async e=>{delete P.subscribers[e]},isSubscriberValid:e=>!!P.subscribers[e]}),P=j.state,C=78643200;function U(e){const{customParameters:t}=u.a,r=e.includes("?")?"&":"?",i=(null==t?void 0:t.map(({parameter:e,value:t})=>`${e||""}${e||t?"=":""}${t||""}`).join("&"))||"";return i?`${e}${r}${i}`:e}function k(e,{value:t,parameter:r}){const i=`${r}=${t}`,s=e.replace("&"===e[e.indexOf(i)-1]?`&${i}`:i,"");return"?"===s[s.length-1]?s.replace("?",""):s}var F;function R(e){if(!e)return null;let t=!0,r={},i={};return e.forEach(({append:e,parameter:s,value:a})=>{"layer"===e?(t=!1,i[s]=a):r[s]=a}),t?{customParameters:r}:{customParameters:r,customLayerParameters:i}}async function $(e){return"imagery-tile"==e.type}async function E(e){return"imagery"===e.type}!function(e){e.Single="single",e.Multi="multi",e.Children="children",e.MultiChildren="multi-children",e.Ancestors="ancestors"}(F||(F={}));const N={type:"esriSMS",style:"esriSMSCircle",color:[34,114,162,128],size:6,outline:{color:[34,114,162,255],width:1}},M={type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:1.5},A={type:"esriSFS",style:"esriSFSSolid",color:[227,139,79,204],outline:{type:"esriSLS",style:"esriSLSSolid",color:[255,255,255,255],width:.75}};async function D(e){const[t,r]=await(0,g.l)(["esri/renderers/SimpleRenderer","esri/geometry/support/jsonUtils"]);switch(e){case"esriGeometryPoint":return new t(r.fromJson(N)).toJson();case"esriGeometryPolyline":return new t(r.fromJson(M)).toJson();case"esriGeometryPolygon":return new t(r.fromJson(A)).toJson()}}async function G(e){const{fields:t,selectedLayer:r}=e;if(null==t?void 0:t.length){const i=t.filter(e=>"esriFieldTypeGeometry"!==e.type);if(null==i?void 0:i.length)return async function(e,t){var r,i;const s=e.displayField,a=e.name+((null==s?void 0:s.length)?`: {${s}}`:"");let n=e.fields,o=!1,l=!1,c=!1;const u=E(t),d=$(t);if(u||d){const e={rasterAttributeTableFieldPrefix:"Raster."};n=null===(r=t.getCustomRasterFields)||void 0===r?void 0:r.call(t,e),c=["F32","F64"].indexOf(t.pixelType)<0,(null==t?void 0:t.capabilities)&&(o=(null==t?void 0:t.capabilities.toLowerCase().indexOf("catalog"))>-1||(null===(i=t.fields)||void 0===i?void 0:i.length)>0,l=o&&("esriImageServiceDataTypeVector-UV"===t.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===t.serviceDataType))}const p={esriFieldTypeDouble:1,esriFieldTypeSingle:1},v={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},y={esriFieldTypeDate:1};let f=",";e.editFieldsInfo&&(e.editFieldsInfo.creatorField&&(f+=`${e.editFieldsInfo.creatorField},`),e.editFieldsInfo.creationDateField&&(f+=`${e.editFieldsInfo.creationDateField},`),e.editFieldsInfo.editorField&&(f+=`${e.editFieldsInfo.editorField},`),e.editFieldsInfo.editDateField&&(f+=`${e.editFieldsInfo.editDateField},`),f=f.toLowerCase());const m={title:a,fieldInfos:n.map(r=>{let i="esriFieldTypeOID"!==r.type&&"esriFieldTypeGlobalID"!==r.type&&"esriFieldTypeGeometry"!==r.type,s=null,a=r.editable&&"esriFieldTypeOID"!==r.type&&"esriFieldTypeGlobalID"!==r.type;if(i){let a=r.name.toLowerCase(),n=`${f}stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,`;o&&(n=`${n}raster.itempixelvalue,`,l&&(n=`${n}raster.magnitude,raster.direction,`)),(n.indexOf(`,${a},`)>-1||a.indexOf("shape")>-1||a.indexOf("perimeter")>-1||a.indexOf("objectid")>-1||a.indexOf("raster.servicepixelvalue.")>-1||a.indexOf("_i")==a.length-2)&&(i=!1),r.type in v?s={places:0,digitSeparator:!0}:r.type in p?s={places:c&&(a.indexOf("raster.servicepixelvalue")>-1||a.indexOf("raster.itempixelvalue")>-1)?0:2,digitSeparator:!0}:r.type in y&&(e.currentVersion>=10||(null==t?void 0:t.version)>=10)&&(s={dateFormat:"longMonthDayYear"})}return a=a?-1===f.indexOf(`,${r.name.toLowerCase()},`):a,{fieldName:r.name,label:r.alias,isEditable:a,tooltip:"",visible:i,format:s,stringFieldOption:"textbox"}}),description:null,showAttachments:!0,mediaInfos:[],layerOptions:void 0};return E(t)?(m.layerOptions={},m.layerOptions.showNoDataRecords=!0,m.layerOptions.returnTopmostRaster=!0):$(t)&&(m.layerOptions={},m.layerOptions.showNoDataRecords=!0),m}({name:(null==r?void 0:r.title)||"",fields:t},e)}}const W=e=>{var t;const r=s.c.portal;return e.thumbnailURL&&(e.thumbnailURL=function(e){var t;return(null===(t=null==e?void 0:e.staticImagesUrl)||void 0===t?void 0:t.replace("http:","https:"))||""}(r)+e.thumbnailURL),r.isPortal&&0!==(null===(t=e.thumbnailURL)||void 0===t?void 0:t.indexOf("http"))&&(e.thumbnailURL=window.location.protocol+"//"+window.location.host+e.thumbnailURL),e},J=(e,t)=>{const[r,i]=e.split("?");return`${r}${(null==i?void 0:i.split("&").reduce((e,r)=>{const[i]=r.split("=");return-1===t.indexOf(i.toLowerCase())?`${e}${e?"&":"?"}${r}`:e},""))||""}`},_=async e=>{var t;const[r]=await(0,g.l)(["esri/layers/WMSLayer"]),{customParameters:i}=e,s=R(i),a=J(e.url,["service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);try{const i=new r({url:a,customParameters:Object.assign({},null==s?void 0:s.customParameters),customLayerParameters:Object.assign({},null==s?void 0:s.customLayerParameters)});try{const t=await i.load();return e.type="WMS",{result:Object.assign(Object.assign({},e),{type:"WMS",serviceInfo:t})}}catch(e){return{error:{code:e.message?"unhandledError":"serviceNotExist",message:null!==(t=e.message)&&void 0!==t?t:e.message}}}}catch(e){return console.error(e),{error:e}}},q=async e=>{const t=await e.load(),{title:r,allSublayers:i}=t;return{title:r,layers:function(e){return e.map(e=>{var t;const r=null!==(t=e.legendURL)&&void 0!==t?t:e.legendEnabled?e.legendUrl:void 0;return{name:e.name,visible:!1,title:e.title.replace(/ /g,String.fromCharCode(160)),extent:e.extent,legendUrl:r||void 0,queryable:e.queryable,subLayers:e.subLayers||[]}})}(i.items)}};function K(e=[],t){return delete t.id,t.subLayers&&t.subLayers.length?t.subLayers.reduce(K,e):[...e,t]}const V=async(e,t)=>{let r=e.thumbnailURL;try{r=(await t.fetchImage(e.extent,800,532)).src}catch(e){console.error(e)}return Object.assign(Object.assign({},e),{thumbnailURL:r,extent:(0,I.e)(e.extent)})},z=(e,t)=>JSON.stringify({title:e.title||"",url:e.url,version:e.version,layers:t,copyright:e.copyright||"",maxHeight:e.imageMaxHeight,maxWidth:e.imageMaxWidth,spatialReferences:e.spatialReferences,format:e.imageFormat.includes("png")?null:e.imageFormat,featureInfoUrl:e.featureInfoUrl,featureInfoFormat:e.featureInfoFormat,customParameters:e.customParameters||{},customLayerParameters:e.customLayerParameters||{}});function B({parameter:e}){return"version"===e}const Q=async e=>{const{customParameters:t}=e,{url:r}=e,i=J(r,["version","service","request","layer","typename"]),s=null==t?void 0:t.find(B),a=R(t.filter(e=>!B(e))),n=Object.assign({customParameters:(null==a?void 0:a.customParameters)||{}},s?{version:s.value}:{});try{const[t]=await(0,g.l)(["esri/layers/ogc/wcsUtils"]),r=await t.getCapabilities(i,n),s=r.gridCoverages;return s&&s.length?{result:Object.assign(Object.assign({},e),{type:"WCS",url:i,serviceInfo:Object.assign(Object.assign({},r),{url:i})})}:{error:{code:"emptyFeatureLayer"}}}catch(e){return console.error(e),{error:e}}},H=async(e,t)=>{const[r]=await(0,g.l)(["esri/layers/WFSLayer"]),{customParameters:i}=u.a,{url:s}=e,a=J(s,["version","service","request","layer","typename"]),n=R(i),o=await(async e=>{const{query:t}=await(0,w.u)(e);return(null==t?void 0:t.version)||"2.0.0"})(s),l=t||{version:o,url:a,customParameters:(null==n?void 0:n.customParameters)||{}};try{if("2.0.0"!==o)return{error:{code:"unsupportedWFSVersion"}};delete l.version,delete l.url;const[t]=await(0,g.l)(["esri/layers/ogc/wfsUtils"]),i=await t.getCapabilities(a,l),s=i.featureTypes;if(s&&s.length){const n=await t.getWFSLayerInfo(i,void 0,void 0,l),o=r.fromWFSLayerInfo(n);return o.layers=s,o.url=a,o.isComplex="esriGeometryComplex"===o.geometryType,{result:Object.assign(Object.assign({},e),{type:"WFS",serviceInfo:o})}}return{error:{code:"emptyFeatureLayer"}}}catch(e){return console.error(e),{error:e}}},Y=async e=>{var t;if(!e||!(null==e?void 0:e.serviceInfo))return Promise.reject(new Error("serviceNotExist"));const r=function(e,t,r){const{customParameters:i}=R(r),s=i.version||e.version;return delete i.version,{title:e.name,url:e.url,customParameters:i,layerType:"WCS",wcsInfo:{version:s,coverageId:t.id}}}(e.serviceInfo,e.selectedCoverage,e.customParameters),i=null===(t=null==e?void 0:e.selectedCoverage)||void 0===t?void 0:t.lonLatEnvelope,s=Object.assign(Object.assign({type:e.type,url:e.url},i?{extent:(0,I.e)(i)}:{}),{text:JSON.stringify(r)}),a=await Ve(s);return Object.assign(Object.assign({},s),a)},X=async e=>{var t;if(!e||!(null==e?void 0:e.serviceInfo))return Promise.reject(new Error("serviceNotExist"));const{serviceInfo:r}=e,i=(null===(t=r.selectedLayer)||void 0===t?void 0:t.fullExtent)||[[],[]],a=(0,I.e)(i),n=a.split(",").map(Number);if(!r.geometryType||"none"===r.geometryType)return Promise.reject(new Error("missingGeometry"));const o={type:e.type,url:e.url,thumbnailURL:e.thumbnailURL},l=await async function(e){const{layerNamespace:t,getFeatureUrl:r,spatialReferences:i,fields:s}=e,{maxFeatures:a,geometryType:n}=u.a;let o,l,c;const d=e;o=d.url,l="2.0.0",c=d.name;const p=n||e.geometryType||"esriGeometryComplex";return{url:o,mode:void 0,wfsInfo:{version:"2.0.0",name:c,wfsNamespace:t,featureUrl:r,supportedSpatialReferences:i,customParameters:e.customParameters||{},maxFeatures:a||e.maxFeatures||3e3},layerDefinition:{geometryType:p,drawingInfo:{renderer:await D(p)},spatialReference:{wkid:4326},fields:s},popupInfo:await G(e)}}(r),c=Object.assign(Object.assign({},W(o)),{text:JSON.stringify(l),extent:a}),d=await Ve(c),p=Object.assign(Object.assign(Object.assign({},c),d),{extent:[[n[0],n[1]],[n[2],n[3]]]});try{const e=await async function(e){const{config:t}=s.c,r={baseMap:t.defaultBasemap||t.self.defaultBasemap,operationalLayers:[]},{baseMapLayers:i}=r.baseMap;let a=!1;return i.forEach(e=>{e.isReference||a||(!t.allSSL&&"https:"!=location.protocol||!(0,w.i)(e.url)&&!(0,w.s)(e.url)||(e.url=e.url.replace("http:","https:")),e.visibility=!1,a=!0,r.baseMap.baseMapLayers=[e])}),r.operationalLayers.push({type:"WFS",layerType:"WFS",opacity:1,visibility:!0,id:"wfs_xxx",wfsInfo:{maxFeatures:100}}),(0,I.b)(r,e)}(p.extent);return Object.assign(Object.assign({},p),{thumbnailUrl:e})}catch(e){return p}};async function Z(e,t){const[r]=await(0,g.l)(["esri/layers/WMTSLayer"]),{customParameters:i,url:s}=e,a=R(i),n=Object.assign(Object.assign({},t),{customLayerParameters:null==a?void 0:a.customLayerParameters,customParameters:null==a?void 0:a.customParameters})||await Object.assign(Object.assign({},async function(e){var t,r;const i=await(0,w.u)(e),s=(null===(t=i.query)||void 0===t?void 0:t.service)||"",a=(null===(r=i.query)||void 0===r?void 0:r.request)||"";return"wmts"===s.toLowerCase()&&"getcapabilities"===a.toLowerCase()||e.toLowerCase().indexOf("/1.0.0/wmtscapabilities.xml")>-1?{serviceMode:"KVP"}:{}}(s)),{customLayerParameters:(null==a?void 0:a.customLayerParameters)||{},customParameters:(null==a?void 0:a.customParameters)||{}}),o=J(s,["version","service","request","layer","style","format","tilematrixset","tilematrix","tilerow","tilecol"]).replace(/\/1.0.0\/wmtscapabilities.xml/i,"");try{const t=new r(o,n),i=t;await i.load();const s=i.sublayers.toArray();return s&&s.length?(t.layers=s,{result:Object.assign(Object.assign({},e),{type:"WMTS",serviceInfo:t})}):{error:{code:"serviceNotExist"}}}catch(e){return console.error(e),{error:e}}}async function ee(e){if(!e)return Promise.reject("serviceNotExist");const{serviceInfo:t,selectedLayer:r,selectedTileInfo:i}=e;if(!r)return Promise.reject(new Error("layerNotSelected"));if(!i)return Promise.reject(new Error("missingGeometry"));t.selectedTileInfo=i;const{wmtsConfig:a,fullExtent:n}=await async function(e){var t;try{const[r]=await(0,g.l)(["esri/geometry/SpatialReference"]),{selectedLayer:i,selectedTileInfo:s,copyright:a}=e,n=(null==s?void 0:s.fullExtent.spatialReference)||new r({wkid:4326}),o=await(0,I.p)(null==i?void 0:i.fullExtent,n).then(e=>{var t;return"extent"===(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.type)?e[0]:null});let l,c="";c=i.imageFormat,e.resourceUrls=i.resourceUrls,l=e.getUrlTemplate(i.id,s.id,c,i.styleId);const u={templateUrl:l,copyright:function(e){return"none"!==(null==e?void 0:e.toLowerCase())?(null==e?void 0:e.length)>180?`${e.substring(0,180)}..`:"":e}(a),fullExtent:o.toJSON()||e.selectedTileInfo.fullExtent,tileInfo:function(e){const{tileInfo:t}=e;return 96!==(null==t?void 0:t.dpi)&&(t.lods.forEach(e=>{e.scale=96*e.scale/t.dpi}),t.dpi=96),t.toJSON()}(s),wmtsInfo:{url:null!==(t=e.wmtsUrl)&&void 0!==t?t:e.url,layerIdentifier:i.id,tileMatrixSet:s.id,customParameters:e.customParameters||{},customLayerParameters:e.customLayerParameters||{}}};return Promise.resolve({wmtsConfig:u,fullExtent:o})}catch(e){throw console.error(e),e}}(t).catch(e=>{throw console.error("Error getting WMTS config",e),e}),o=t.selectedLayer.fullExtent,l=n?o:{xmin:-180,ymin:-90,xmax:180,ymax:90},c={type:e.type,url:e.url,thumbnailURL:e.thumbnailURL},u=Object.assign(Object.assign({},W(c)),{url:a.wmtsInfo.url,text:JSON.stringify(a),extent:`${l.xmin},${l.ymin},${l.xmax},${l.ymax}`}),d=await Ve(u),p=Object.assign(Object.assign(Object.assign({},u),d),{extent:[[l.xmin,l.ymin],[l.xmax,l.ymax]]});try{const e=await async function(e){const[t,r,i,a]=await(0,g.l)(["esri/layers/WMTSLayer","esri/Map","esri/views/MapView","esri/core/reactiveUtils"]),n=new t({portalItem:{id:e.id,portal:s.c.portal}}),o=new r({layers:[n]}),l=new i({container:(0,I.c)(),map:o});return await a.whenOnce(()=>!l.updating),await l.goTo(n.fullExtent),(await l.takeScreenshot({width:l.width,height:l.height,format:"png"})).dataUrl}(p),t={type:"base64",data:e},r=await(0,S.a)(d.id,t);return Object.assign(Object.assign({},p),r)}catch(e){return console.error("Error when adding WMTS URL:",e),p}}function te(e){var t,r;if(!e)return;const{title:i,description:s}=e;l.i.title=null!==(t=null!=i?i:l.i.title)&&void 0!==t?t:"",l.i.snippet=null!==(r=null!=s?s:l.i.snippet)&&void 0!==r?r:"",u.a.selectedLayer=e}async function re(e,t={},r=!0){const{links:i}=e,s=ie(i,"data","application/json")||ie(i,"http://www.opengis.net/def/rel/ogc/1.0/data","application/json");if(null==s)throw new Error("Missing collections url");return(0,b.r)(U(s.href),{},Object.assign(Object.assign({},t),{addTokenManually:!1,headers:{accept:"application/json"}}),"auto",{excludeJson:r})}function ie(e,t,r){return e.find(e=>e.rel===t&&e.type===r)||e.find(e=>e.rel===t&&!e.type)}const se=["geocode.arcgis.com","geocodedev.arcgis.com","geocodeqa.arcgis.com","route.arcgis.com","routedev.arcgis.com","routeqa.arcgis.com","geoenrich.arcgis.com","geoenrichqa.arcgis.com","geoenrichddev.arcgis.com"],ae=[499,498];async function ne(e,t,r,i,s=!1){const a=t.split("?")[0],n=`${r}portals/checkurl`,o=se.some(e=>-1!==t.indexOf(e));if(o)return{secured:!0,isOverride:!0};{const l=!o&&t.indexOf("/VectorTileServer")>-1,c=`${n}?url=${encodeURIComponent(`${U(`${a}?f=json`)}`)}`;try{s&&await(0,b.r)(a,{},{disableIdentityLookup:!0,addTokenManually:!1});const n=await(0,b.r)(c,{},{addTokenManually:!1}),{httpStatusCode:o}=n;if(n.secured)403===o?n.secured=!1:401===o&&(n.allowStoredAuth=!1);else if(l){const s=await le({username:e.username,password:e.password},t,{isVideoService:!1,checkAuth:i});if(u.a.exportTilesAllowed=null==s?void 0:s.exportTilesAllowed,null==s?void 0:s.exportTilesAllowed)return ne(e,`${t}/exportTiles`,r,i)}return Object.assign(Object.assign({},n),{isOverride:!1})}catch(a){const{message:n,code:o}=a;return"Error checking resource"===n?s?{secured:!1,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:n,isOverride:!1,allowStoredAuth:!1}:ne(e,t,r,i,!0):"Service Proxy URL"===n?{secured:!0,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:n,isOverride:!1,allowStoredAuth:!1,useProxy:!0}:{allowStoredAuth:!1,url:t,httpResponse:"",httpStatusCode:o,httpStatusMessage:n,isOverride:!1}}}}function oe(e,t){var r;return e.toLowerCase().indexOf("/imageserver")>-1&&"Raster"===(null==t?void 0:t.cacheType)&&-1===(null===(r=null==t?void 0:t.capabilities)||void 0===r?void 0:r.toLowerCase().indexOf("tilesonly"))}async function le(e,t,r){var i;const a=s.c.config,[n]=await(0,g.l)(["esri/identity/IdentityManager"]),{forceAddToken:o,isSecure:l,checkAuth:c}=r,{username:u,password:d}=e,p="auto",v=(0,w.i)(t),y=t.indexOf(".esri.com/server/rest/services")>-1;const f=v||y,m=se.some(e=>-1!==t.indexOf(e)),h={useProxy:null!==(i=null==r?void 0:r.useProxy)&&void 0!==i&&i,timeout:!1===a.isMultiTenant?6e4:5e3,addSSL:f,addTokenManually:l&&f&&!!a.isMultiTenant||o||!1,disableIdentityLookup:null};if(c){if(t=t.split("?")[0],m)return await ue(t,{username:u,password:d}),pe(t,h,p);{let e;(null==l?void 0:l.secured)&&u&&d&&(h.customToken=await ce(t,{username:u,password:d}));try{e=await pe(t,h,p)}catch(r){if("sign in required"!==(null==r?void 0:r.message)||!h.addTokenManually||h.disableIdentityLookup)throw r;h.addTokenManually=!1,e=await pe(t,h,p)}return e.credential=n.findCredential(t),e.credential&&n.registerToken({server:t,token:e.credential.token,userId:e.credential.userId,expires:e.credential.expires,ssl:e.credential.ssl}),e}}return h.disableIdentityLookup=!0,await pe(t,h,p)}const ce=async(e,{username:t,password:r})=>{const{token:i}=await(0,b.f)(()=>ue(e,{username:t,password:r}),"securedAGSToken",`${e}---${t}`,{getExpireAfterFromResult:e=>e.expireAfter});return i};async function ue(e,t){const[r,i]=await(0,g.l)(["esri/identity/IdentityManager","esri/identity/Credential"]);if(t.username&&t.password){const s=await async function(e){const[t,r]=await(0,g.l)(["esri/identity/IdentityManager","esri/identity/ServerInfo"]);let i=await t.findServerInfo(e);if(!i){i=new r,i.server=await t._getOrigin(e);const{authInfo:s,currentVersion:a}=await de(e,t);i.tokenServiceUrl=(null==s?void 0:s.tokenServicesUrl)||(null==s?void 0:s.tokenServiceUrl),i.currentVersion=a,i.hasServer=!0,t.registerServers([i])}return i}(e);if(r._checkProtocol(e,s,e=>console.error(e)))try{const a=await r.generateToken(s,t),n=a.expires?Number(a.expires):null,o=!!a.ssl,l=new i({userId:t.username,server:s.server,token:a.token,expires:n,ssl:o,validity:s.shortLivedTokenValidity,resources:[e],scope:"server"});return-1===r.credentials.indexOf(l)&&r.credentials.push(l),{token:l.token,expireAfter:n}}catch(e){throw e.code=403,e}return null}}const de=async(e,t)=>{const r=await t._getTokenSvcUrl(e);return await r.promise};async function pe(e,t,r="post",i=!1){var a;try{return i&&!1===t.useProxy?await(0,O.r)(U(e),s.c.portal,Object.assign({},t)):await(0,b.r)(U(e),{},Object.assign({},t),r)}catch(s){if(s&&-1!==ae.indexOf(s.code));else if((403===(null==s?void 0:s.code)||403===(null===(a=null==s?void 0:s.details)||void 0===a?void 0:a.httpStatus))&&!i&&!1===t.useProxy)return await pe(e,t,r,!0);throw s}}async function ve(e){var t,r;if((0,h.i)(e.type))return await we(e);let i={};switch(e.type){case"OGCFeatureServer":i=await async function(e){var t,r,i,s;const{url:a}=e,n={addTokenManually:!1,headers:{accept:"application/json"}};try{const o=async(e,t)=>{var r,i,s;try{return await e()}catch(e){const a=null!==(s=null===(i=null===(r=null==e?void 0:e.message)||void 0===r?void 0:r.toLowerCase)||void 0===i?void 0:i.call(r))&&void 0!==s?s:"";if(a.includes("unexpected token")||a.includes("expected expression"))return t();throw{result:null,error:{code:"unhandledError",message:JSON.stringify(e)}}}},l=await o(()=>(0,b.r)(a,{},n,"auto",{excludeJson:!0}),()=>(0,b.r)(a,{},n)),c=await o(()=>re(l),()=>re(l,{},!1));return{result:Object.assign(Object.assign({},e),{extent:(0,I.e)(null===(s=null===(i=null===(r=null===(t=c.collections)||void 0===t?void 0:t[0])||void 0===r?void 0:r.extent)||void 0===i?void 0:i.spatial)||void 0===s?void 0:s.bbox),type:"OGCFeatureServer",serviceInfo:c,layers:c.collections}),error:null}}catch(e){return console.error("get OGC feature layer:",e),{result:null,error:{code:"unhandledError",message:JSON.stringify(e)}}}}(e);break;case"WCS":i=await Q(e);break;case"WMS":const{result:s,error:a}=await _(e);if(a)i.error=a;else{const e=await q(s.serviceInfo);i.result=Object.assign(Object.assign({},s),e)}break;case"WFS":i=await H(e),i.result&&(i.result.layers=i.result.serviceInfo.layers,i.result.title=null!==(t=i.result.serviceInfo.title)&&void 0!==t?t:"",i.result.isComplex="esriGeometryComplex"===i.result.serviceInfo.isComplex);break;case"WMTS":i=await Z(e),i.result&&(i.result.layers=i.result.serviceInfo.layers,i.result.title=null!==(r=i.result.serviceInfo.title)&&void 0!==r?r:"");break;default:i={result:Object.assign({},e)}}return{result:{serviceInfo:i.result,portalRestInfo:null},error:i.error}}async function ye(e,t){var r,i;const{config:s,user:a,asyncAddToDefinition:n=!0,preserveLayerIds:o}=t,l="CUSTOMDATA"===e.provider,c=Object.assign({},e);void 0!==o&&(c.preserveLayerIds=o);const u={layers:null!==(r=c.layers)&&void 0!==r?r:[],tables:null!==(i=c.tables)&&void 0!==i?i:[]},d=JSON.stringify(u);delete c.layers,delete c.tables,delete c.initialExtent,delete c.fullExtent,delete c._ssl;const p=l?{service:JSON.stringify(c)}:{createParameters:JSON.stringify(c),targetType:"featureService"},v=l?`${t.hostingServer[0].url}/admin/services/createService`:`${s.restBaseUrl}content/users/${a.username}/createService`,y=await(0,b.r)(v,p,{},"post");if(l){const e=`${t.hostingServer[0].url}/admin/services/${c.serviceName}.FeatureServer`;try{return{createServiceResponse:{itemId:(await(0,b.r)(e,"post")).portalProperties.portalItems[0].itemID,encodedServiceURL:"",isView:!1,name:"",serviceItemId:"",serviceurl:"",size:0,success:!0,type:"",typeKeywords:[]},addToDefinitionResponse:null}}catch(e){throw console.error(e),e}}try{return await fe(d,y.encodedServiceURL,n),{createServiceResponse:y,addToDefinitionResponse:u}}catch(e){throw await(0,S.d)(y.itemId,{permanentDelete:!0},a),console.error(e),e}}async function fe(e,t,r=!0){if(e){const i=`${t.replace("rest/services","rest/admin/services")}/addToDefinition`;try{const t=await(0,b.r)(i,{addToDefinition:e,async:r},{},"post");return r?await(0,b.p)(t.statusURL||t.statusUrl):t}catch(i){throw r&&await fe(e,t,!1),i}}return null}function me(e,t){const r=`${(0,y.g)(t)}content/items/${e.id}/data`;return(0,b.r)(r)}async function ge(e){var t,r;const i=null===(t=(await(0,x.q)({q:'title: "Esri Layer Templates" AND owner: "esri_en"',num:1})).results)||void 0===t?void 0:t[0];if(!i)return null;const s=null===(r=(await(0,b.r)(`${(0,y.g)(e)}/search`,{q:`title:"Points" group:"${i.id}" AND type:"Layer Template" -type:"Attachment"`,num:1})).results)||void 0===r?void 0:r[0];return s?me(s,e):null}function he(e){const t=(0,w.f)(e),r=(0,y.p)(e),i=t.replace(y.v,"").match(y.c);let s=null==r?void 0:r.serverType,a=null==r?void 0:r.index;const n={mapserver:"MapServer",geocodeserver:"GeocodeServer",gpserver:"GPServer",geometryserver:"GeometryServer",geoenrichmentserver:"GeoenrichmentServer",imageserver:"ImageServer",naserver:"NAServer",featureserver:"FeatureServer",geodataserver:"GeoDataServer",globeserver:"GlobeServer",wmserver:"WMServer",sceneserver:"SceneServer",vectortileserver:"VectorTileServer",streamserver:"StreamServer",videoserver:"VideoServer",knowledgegraphserver:"KnowledgeGraphServer"};return s&&n[s.toLowerCase()]&&(s=n[s.toLowerCase()]),("ags"===s||!s&&i)&&(s="MapServer"),"MapServer"===s&&null!==a?"FeatureServer":s}async function we(e){var t;const{config:r}=s.c,{checkAuth:i,storeAuth:a,username:n,password:o}=e;e.title=function(e){var t;return null===(t=(0,y.p)((0,w.f)(e)))||void 0===t?void 0:t.serverName}(e.url);const l=he(e.url);if(!l||"SceneServer"===l&&!r.sceneViewerEnabled)return{error:{code:"unknownAGSType"}};let c=null===(t=p.a[l])||void 0===t?void 0:t.type;c||console.warn(`Unknown AGS Type ${l}`),e.type=c,e.agsType=l;try{if(!s.c.user)return{result:{serviceInfo:await be(e),portalRestInfo:null}};const t=await ne({username:n,password:o},e.url,(0,y.g)(s.c.portal),i),r=null==t?void 0:t.allowStoredAuth;if(!1===r&&(e.allowStoredAuth=!1),t.secured){e.isSecured=Object.assign({},t),e.allowStoredAuth=!1;const{secured:s,portalRestInfo:n}=await async function(e,t,r){var i,s;if(499===(null==t?void 0:t.httpStatusCode)){const[t]=await(0,g.l)(["esri/identity/IdentityManager"]),{url:a,password:n,username:o}=e,l=await de(a,t);let c=null===(i=l.authInfo)||void 0===i?void 0:i.tokenServicesUrl;if(c){"/"!==c[c.length-1]&&(c+="/");try{const e=await ne({password:n,username:o},null!=c?c:"",(0,y.g)(),r);return{secured:(null==e?void 0:e.secured)&&401===(null==e?void 0:e.httpStatusCode),portalRestInfo:l}}catch(e){return{secured:!!(null===(s=null==e?void 0:e.message)||void 0===s?void 0:s.includes("Http StatusCode: -1"))&&-1,portalRestInfo:null}}}}return{secured:!1,portalRestInfo:null}}({username:e.username,password:e.password,url:e.url},t,i);if(!s&&401!==t.httpStatusCode)return e.isSecured=Object.assign(Object.assign({},t),{isFederatedWithWebTierAuth:s}),!1!==r&&(e.allowStoredAuth=!0),t.isOverride&&("GeoenrichmentServer"!==l||e.storeAuth?e.storeAuth=!0:e.createAsServiceProxy=!0),i&&!a?{result:{serviceInfo:await be(e,{useProxy:t.useProxy}),portalRestInfo:n}}:{result:{serviceInfo:e,portalRestInfo:n}};if(-1===s){const r=Object.assign(Object.assign({},e),{isSecured:null,checkUrlError:!0,storeAuth:!1});return{result:{serviceInfo:await be(r,{useProxy:t.useProxy}),portalRestInfo:n}}}const o=Object.assign(Object.assign({},e),{isSecured:{httpStatusCode:401,isFederatedWithWebTierAuth:s}});return{result:{serviceInfo:await be(o,{useProxy:t.useProxy}),portalRestInfo:n}}}return{result:{serviceInfo:await be(e,{useProxy:t.useProxy}),portalRestInfo:null}}}catch(t){if((0,f.a)(t)){const e=t.code;if("flowAborted"===e||"unauthorized"===e||"invalidSpatialRef"===e)return{error:t}}try{const r=Object.assign(Object.assign({},e),{isSecured:e.isSecured||null,checkUrlError:t,storeAuth:!1});return{result:{serviceInfo:await be(r),portalRestInfo:null}}}catch(e){return(0,f.a)(e)?{error:e}:{error:{code:"unhandledError",message:JSON.stringify(e)}}}}}let Se=3;async function be(e,t,r=0){var i,s,a,n,o,c,d,p,v,y,S,x,O,I,T,L,j,P;const{url:C=e.url,useProxy:U=!1}=null!=t?t:{},[k]=await(0,g.l)(["esri/identity/IdentityManager"]),{username:F,password:R,checkAuth:$,agsType:E}=e,{tags:N=[]}=l.i||{},M=[499,498],A=(0,w.f)(C);if(!e.isSecured||401!==(null===(i=e.isSecured)||void 0===i?void 0:i.httpStatusCode)&&$||(null===(s=e.checkUrlError)||void 0===s?void 0:s.message)&&e.isSecured&&(0,h.i)(e.type))try{const t=await le({username:F,password:R},A,{isSecure:e.isSecured,isVideoService:"Video Service"===e.type,checkAuth:$,useProxy:U});"Image Service"===e.type&&t.tileInfo&&("LERC"===t.tileInfo.format||"elevation"===(null===(a=t.cacheType)||void 0===a?void 0:a.toLowerCase())?e.agsType="ElevationServer":"raster"===(null===(n=t.cacheType)||void 0===n?void 0:n.toLowerCase())&&(e.agsType="TiledImageServer",oe(C,t)&&"TiledImageServer"!==u.a.hybridImageServiceSetting&&(e.agsType="ImageServer")));const r=t.credential||k.findCredential(C),i=t.documentInfo,s=((null==i?void 0:i.Keywords)||"").split(","),l=null!==(o=null==i?void 0:i.Title)&&void 0!==o?o:t.name;return e.tags=(0,m.b)([...s,...N]).filter(e=>e),(null==l?void 0:l.length)>0&&(e.title=l),e.description=null!==(d=null!==(c=null==i?void 0:i.Comments)&&void 0!==c?c:t.description)&&void 0!==d?d:"",e.snippet=null!==(v=null!==(p=null==i?void 0:i.Subject)&&void 0!==p?p:t.serviceDescription)&&void 0!==v?v:"",e=Object.assign(Object.assign({},e),{thumbnailToken:(null==r?void 0:r.token)||null,extent:e.extent||t.fullExtent||t.extent,serviceInfo:Object.assign(Object.assign({},t),{isSecure:!!$,userInfo:{username:F,password:R}})}),Object.assign({},e)}catch(i){if((null===(y=null==i?void 0:i.message)||void 0===y?void 0:y.toLowerCase().includes("aborted"))||"Error: json"===(null==i?void 0:i.message))throw{code:"flowAborted",message:JSON.stringify(i.message.message)};if(M.includes(null!==(S=null==i?void 0:i.code)&&void 0!==S?S:null===(x=null==i?void 0:i.details)||void 0===x?void 0:x.httpStatus))return!1!==e.allowStoredAuth&&(e.allowStoredAuth=!e.checkUrlError),Object.assign(Object.assign({},e),{isSecured:{secured:!0},serviceInfo:{isSecure:!0},allowStoredAuth:!1!==e.allowStoredAuth&&u.a.allowStoredAuth});if(403===(null==i?void 0:i.code))throw e.serviceInfo={isSecure:!0},e.isSecured={secured:!0},{code:"forbiddenCredential",message:JSON.stringify(i)};if(i&&(null===(O=e.checkUrlError)||void 0===O?void 0:O.message)){if(null===(L=null===(T=null===(I=e.checkUrlError)||void 0===I?void 0:I.message)||void 0===T?void 0:T.includes)||void 0===L?void 0:L.call(T,"was not found"))throw{code:"serviceNotExist",message:JSON.stringify(e.checkUrlError.message)};throw{code:"unhandledError",message:JSON.stringify(e.checkUrlError.message)}}if(E&&"FeatureServer"!==E||"string"==typeof i&&i.includes("not found"))throw{code:"serviceNotExist",message:JSON.stringify(i)};if((0,f.b)(i)&&"The input spatial reference must be either a geographic or projected coordinate system"===i.details[0])throw{code:"invalidSpatialRef",message:JSON.stringify(i)};if(r<Se)return await(0,m.t)(1e3*r),be(e,t,r+1)}else if((null===(j=e.isSecured)||void 0===j?void 0:j.isFederatedWithWebTierAuth)||401===(null===(P=e.isSecured)||void 0===P?void 0:P.httpStatusCode))try{const{title:t}=e,r=await(0,b.r)(e.url,{},{addTokenManually:!1}),i=(r.documentInfo.Keywords||"").split(","),s=[...(0,m.b)([...i,...N])];return e=Object.assign(Object.assign({},e),{extent:r.fullExtent||r.extent,serviceInfo:r}),Object.assign(Object.assign({},e),{title:t,tags:s})}catch(e){if(401===e.status)throw{code:"unauthorized"};throw{code:"serviceNotExist",message:JSON.stringify(e)}}}async function xe(e){const{serviceInfo:t,username:r,password:i,isSecured:n,storeAuth:o,type:l}=e,{user:c,portal:u,config:d}=s.c,p=l,v={username:r,password:i},{thumbnailURL:y}=(0,a.g)(p),f=Object.assign(Object.assign({},e),{thumbnailURL:y||e.thumbnailURL});if((null==t?void 0:t.isSecure)&&!t.userInfo||(null==n?void 0:n.isOverride)&&!v||401!==(null==n?void 0:n.httpStatusCode)&&!v||o&&!v)throw new Error("invalidCredentials");if(n&&o){if(!(!u.isPortal||u.isPortal&&(0,w.c)()))throw new Error;if(f.serviceUsername=r,f.servicePassword=i,401===n.httpStatusCode){const e=await Me(f,null==d?void 0:d.restBaseUrl).then(({id:e})=>(0,b.r)(`${c.userContentUrl}/items/${e}`,{},{},"post"));return Oe(Object.assign(Object.assign({},f),{id:e.item.id,url:e.item.url,sourceUrl:e.item.sourceUrl}),!0)}if((null==t?void 0:t.isSecure)&&!(null==t?void 0:t.userInfo))throw new Error("invalidCredentials")}return Oe(f)}async function Oe(e,t=!1){var r,i,n,o,l;const{url:c,serviceInfo:d,type:v,storeAuth:y,hybridImageServiceSetting:f,id:m}=e;let g;if(!d&&!y)throw new Error("serviceNotExist");if(y&&!d){Se=15;const t=await be(e);return Se=3,Object.assign(Object.assign({},t),{success:!0,id:m,folder:null===(r=e.folder)||void 0===r?void 0:r.title})}const h=Object.assign(Object.assign({},e),{description:(0,T.d)((0,T.d)((null==d?void 0:d.description)||(null===(i=null==d?void 0:d.documentInfo)||void 0===i?void 0:i.Comments)||"")),accessInformation:(null==d?void 0:d.copyrightText)||(null===(n=null==d?void 0:d.documentInfo)||void 0===n?void 0:n.Credits)||"",spatialReference:(0,I.g)(e.serviceInfo,e.agsType)});if("map service"===(null==v?void 0:v.toLowerCase())&&h.typeKeywords.push((null==d?void 0:d.singleFusedMapCache)?"Tiled":"Dynamic"),("Image Service"===v&&"TiledImageServer"===f||function(e,t){var r,i;return(null===(r=e.toLowerCase())||void 0===r?void 0:r.includes("/imageserver"))&&(null===(i=null==t?void 0:t.capabilities)||void 0===i?void 0:i.toLowerCase().includes("tilesonly"))}(c,d))&&(h.typeKeywords=p.a.TiledImageServer.typeKeywords),"Table"===(null==d?void 0:d.type)&&(h.typeKeywords=[...h.typeKeywords,"Table","Singlelayer"]),v in{StreamServer:1,ImageServer:1,WorkspaceServer:1}?h.typeKeywords.push("Singlelayer"):((null==d?void 0:d.layers)||(null==d?void 0:d.tables))&&(d.layers&&(null===(o=null==d?void 0:d.layers)||void 0===o?void 0:o.length)||!(null==d?void 0:d.tables.length)?(g=[...d.layers||[],...d.tables||[]],h.typeKeywords.push(g.length>1?"Multilayer":"Singlelayer")):(-1===h.typeKeywords.findIndex(e=>"Table"===e)&&h.typeKeywords.push("Table"),h.typeKeywords.push(d.tables.length>1?"Multilayer":"Singlelayer"))),"sceneserver"===(null==v?void 0:v.toLowerCase())){const{layers:e}=d,t=(null===(l=null==e?void 0:e[0])||void 0===l?void 0:l.layerType)||(null==d?void 0:d.layerType);t&&h.typeKeywords.push(t)}try{const{extent:e}=await(0,I.d)(Object.assign({},h)),r=h,i=(0,a.g)(r.type);if(r.type=i.type,r.typeKeywords=[...r.typeKeywords||[],...i.typeKeywords||[]],!y){const t=(0,I.e)(r.extent).split(","),i=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]];r.extent=i;const s=await(0,I.f)(r);r.thumbnailURL=s,r.thumbnailURL&&r.thumbnailToken&&(r.thumbnailURL+=`${r.thumbnailURL.indexOf("?")>-1?"&":"?"}${r.thumbnailToken}`),r.extent=(0,I.e)("Feature Service"===r.type||"Image Service"===r.type?e:r.extent)}return y?async function(e){const{user:t}=s.c,{exportTilesAllowed:r}=u.a,i=await Ve(e),a=`${t.userContentUrl}/items/${i.id}`,{item:n}=await(0,b.r)(a,{},{},"post"),o=r?e.url:n.url,l=await be(Object.assign(Object.assign({},e),{type:u.a.type}),o),{typeKeywords:c,thumbnailToken:d,spatialReference:p,extent:v,description:y}=l;e.id=i.id,e.typeKeywords=c,e.thumbnailToken=d,e.spatialReference=p,e.extent=v,e.description=y;try{const t=(0,I.e)(l.extent).split(","),r=[[parseFloat(t[0]),parseFloat(t[1])],[parseFloat(t[2]),parseFloat(t[3])]];e.extent=r;const i=await(0,I.f)(e);n.thumbnailURL=i,n.thumbnailURL&&n.thumbnailToken&&(n.thumbnailURL+=`${n.thumbnailURL.indexOf("?")>-1?"&":"?"}${n.thumbnailToken}`)}catch(e){console.error(e)}return await(0,S.u)(i.id,{thumbnailURL:n.thumbnailURL}),i}(r):t?(0,S.u)(r.id,Object.assign(Object.assign({},r),{url:r.sourceUrl})):Ve(r)}catch(t){if(y)throw t;return Ve(e)}}async function Ie(e,t,r){if("Desktop Application"===e.type)return De();const i=await(0,S.s)(e);return"Application"!==e.type&&"API Key"!==e.type||await Te(e.developerCredentialsType,i.id,t,r),i}async function Te(e,t,r,i){const s=`${r}oauth2/registerApp`;let a={itemId:t,appType:"multiple",redirect_uris:JSON.stringify(["urn:ietf:wg:oauth:2.0:oob"])};i&&(a="apiToken"===e?Object.assign(Object.assign({},a),{httpReferrers:JSON.stringify(i.httpReferrers),privileges:JSON.stringify(i.privileges),isPersonalAPIToken:i.isPersonalAPIToken}):"apikey"===i.appType?{itemId:t,appType:"apikey",redirect_uris:JSON.stringify(i.redirect_uris),httpReferrers:JSON.stringify(i.httpReferrers),privileges:JSON.stringify(i.privileges)}:{itemId:t,appType:i.appType,httpReferrers:JSON.stringify(i.httpReferrers),redirect_uris:JSON.stringify(i.redirect_uris),url:i.url,privileges:JSON.stringify(i.privileges),isPersonalAPIToken:i.isPersonalAPIToken});try{return{result:await(0,b.r)(s,a,{},"post")}}catch(e){return console.error("error:",e),{error:{code:"unhandledError"}}}}async function Le(e){try{return{result:await(0,b.r)(e,{},{addTokenManually:!1}),error:null}}catch(e){return console.error("error:",e),{result:null,error:{code:"appExtensionError"}}}}const je={name:"Layer3D",spatialReference:{wkid:4326,vcswkid:5709},serviceDataType:"Object3D",capabilities:"Query, Editing, ChangeTracking",layers:[{fields:[{name:"Name",type:"esriFieldTypeString",alias:"Name",nullable:!0,editable:!0,sqlType:"sqlTypeOther",visible:!0,domain:null,defaultValue:null},{name:"Location",type:"esriFieldTypeString",alias:"Location",nullable:!0,editable:!0,sqlType:"sqlTypeOther",visible:!0,domain:null,defaultValue:null},{name:"Description",type:"esriFieldTypeString",alias:"Description",nullable:!0,editable:!0,sqlType:"sqlTypeOther",visible:!0,domain:null,defaultValue:null}],infoFor3D:{queryFormats:["3D_shapebuffer","3D_glb"]},hasZ:!0}]};var Pe=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(r[i[s]]=e[i[s]])}return r};const Ce={currentVersion:10.51,hasVersionedData:!1,supportsDisconnectedEditing:!1,hasStaticData:!1,maxRecordCount:2e3,supportedQueryFormats:"JSON",supportsVCSProjection:!1,capabilities:"Query,Editing,Create,Update,Delete,Sync",description:"",copyrightText:"",allowGeometryUpdates:!0,units:"esriMeters",supportsAppend:!0,syncEnabled:!1,supportsApplyEditsWithGlobalIds:!1,editorTrackingInfo:{allowAnonymousToDelete:!0,allowAnonymousToQuery:!0,allowAnonymousToUpdate:!0,allowOthersToDelete:!1,allowOthersToQuery:!0,allowOthersToUpdate:!0,enableEditorTracking:!1,enableOwnershipAccessControl:!1},xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"},_ssl:!0},Ue={provider:"CUSTOMDATA",extensions:[],frameworkProperties:{},datasets:[],capabilities:"Query",type:"FeatureServer",clusterName:"default",minInstancesPerNode:0,maxInstancesPerNode:0,instancesPerContainer:1,maxWaitTime:60,maxStartupTime:300,maxIdleTime:1800,maxUsageTime:600,loadBalancing:"ROUND_ROBIN",isolationLevel:"HIGH",configuredState:"STARTED",recycleInterval:24,recycleStartTime:"00:00",keepAliveInterval:1800,private:!1,isDefault:!1,maxUploadFileSize:0,allowedUploadFileTypes:"",properties:{disableCaching:"true"}},ke=async e=>{var t,r,i,a,n,o,c,d,p,y;const{tags:f,serviceInfo:m,typeKeywords:g,extent:h,selectedServiceInfoLayersNames:w,addFeatureLayerType:x,addSceneLayerType:O,layerData:T}=e,{portal:L}=s.c,j=L.isPortal,P="CUSTOMDATA"===(null==m?void 0:m.provider);if(!m)throw new Error("No service info found.");try{let e;if(P)e=Ue,e.serviceName=m.name||l.i.title;else{e=Ce;try{e=null!==(t=await ge(L))&&void 0!==t?t:Ce,e.capabilities="Query,Editing,Create,Update,Delete",e.hasStaticData=!1}catch(e){console.warn(`Could not fetch template ${JSON.stringify(e)}`)}}const C=m;let U=null!==(r=C.layers)&&void 0!==r?r:[],k=null!==(i=C.tables)&&void 0!==i?i:[],F=null!==(a=null==T?void 0:T.layers)&&void 0!==a?a:[],R=null!==(n=null==T?void 0:T.tables)&&void 0!==n?n:[];if("build"!==x&&w){const e=e=>w[e.name];U=U.filter(e),k=k.filter(e),F=F.filter(e=>U.find(t=>t.id===e.id)),R=R.filter(e=>k.find(t=>t.id===e.id))}const{layers:$,tables:E}=$e(U,k),N=Object.assign(Object.assign(Object.assign({},e),m),{name:C.name||l.i.title,layers:$,tables:E}),{cleanedCreateParameters:M,relationshipParameters:A}=Re(N);let D;if(["serviceDescription","hasStaticData","maxRecordCount","supportedQueryFormats","capabilities","description","copyrightText","spatialReference","initialExtent","fullExtent","_ssl","allowGeometryUpdates","units","xssPreventionInfo"].forEach(e=>{const t=C[e];null!=t&&(M[e]=t)}),M.name=(0,v.f)(M.name),"template"===x&&(M.syncEnabled=!0,M.capabilities="Query,Editing,Create,Update,Delete,Sync"),"object3d"===O){const e=Object.assign(Object.assign({},je),{name:(0,v.f)(l.i.title)});({createServiceResponse:D}=await async function(e,t){const{config:r,user:i}=t,s=Object.assign({},e),a={createParameters:JSON.stringify(s),targetType:"featureService",async:!0},n=`${r.restBaseUrl}content/users/${i.username}/createService`;return{createServiceResponse:await(0,b.r)(n,a,{},"post")}}(e,{config:s.c.config,user:s.c.user}))}else({createServiceResponse:D}=await ye(M,Object.assign({asyncAddToDefinition:!j,config:s.c.config,user:s.c.user,preserveLayerIds:!0},P&&{hostingServer:s.c.hostingServer})));if(P)return{success:!0,id:D.itemId,folder:l.i.folder.id};const{serviceurl:G,success:W}=D,J=null!==(o=D.itemId)&&void 0!==o?o:D.serviceItemId,{typeKeywords:_}=(await(0,S.b)(J)).result,q=[...g,..._];m.captureGPS&&q.push("gpsMetadataEnabled");try{const e=L.defaultExtent||m.fullExtent||m.extent||h,t=e.spatialReference.wkid||e.spatialReference.wkt||"4326",r=(0,I.e)((0,I.i)(e)?e:await(0,I.h)(e)),i=`https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/export?size=800,532&format=png24&bboxSR=${t}&bbox=${(0,I.e)(e)}&f=image`,a=l.i.folder;(null===(d=null===(c=s.c.portal)||void 0===c?void 0:c.sourceJSON)||void 0===d?void 0:d.hasClassificationSchema)&&(u.a.classification.createdUser=s.c.user.username,u.a.classification.createdDate=Date.now());const n={};return F.length&&(n.layers=F),R.length&&(n.tables=R),0===F.length&&0===R.length&&(null==T?void 0:T.customParameters)&&(n.customParameters=T.customParameters),await Promise.all([(0,S.u)(J,Object.assign(Object.assign({title:l.i.title,typeKeywords:q.join(","),tags:(null!=f?f:l.i.tags).join(","),extent:r,snippet:l.i.snippet,description:u.a.description},Object.keys(n).length>0?{text:JSON.stringify(n)}:{}),(null===(y=null===(p=s.c.portal)||void 0===p?void 0:p.sourceJSON)||void 0===y?void 0:y.hasClassificationSchema)?{classification:JSON.stringify(u.a.classification)}:{})),A.layers||A.tables?fe(JSON.stringify(A),D.encodedServiceURL,!j):void 0,!(0,S.i)(a)&&(0,S.m)(J,a.id)]),(0,S.u)(J,{thumbnailURL:i}).catch(console.error),{success:W,id:J,folder:l.i.folder.id,serviceurl:G}}catch(e){throw(0,S.d)(J,{permanentDelete:!0}),console.error(e),e}}catch(e){throw console.error(e),e}},Fe=async({serviceUrl:e,restBaseUrl:t,forceAddToken:r,isSecure:i,customParameters:s})=>{var a;const{username:n,password:o,checkAuth:l}=u.a,c=s?`?${(0,y.d)(s)}`:"";let d;try{const t=e=>le({username:n,password:o},`${e}${c}`,{forceAddToken:r,isSecure:i,isVideoService:!1,checkAuth:l}),s=(0,y.p)(e);if(!s)return console.warn("invalid service info"),null;const{baseServerUrl:a,index:u}=s;d=await t(a);const p=await Promise.all((d.layers||[]).filter(e=>null===u||e.id===u).map(e=>t(`${a}/${e.id}`)));return{serviceInfo:d,layers:p,tables:await Promise.all((d.tables||[]).filter(e=>null===u||e.id===u).map(e=>t(`${a}/${e.id}`)))}}catch(r){if(console.error(r),d&&d.layers&&d.tables)return{serviceInfo:d,layers:d.layers,tables:d.tables};if("token required"===(null===(a=r.message)||void 0===a?void 0:a.toLowerCase()))try{const{secured:r}=await ne({username:n,password:o},e,t,l);return await Fe({serviceUrl:e,restBaseUrl:t,forceAddToken:r})}catch(e){throw e}throw r}},Re=e=>{const t={},r=e=>t[e.id]=!0;e.layers.forEach(r),e.tables.forEach(r);const i=e=>t[e.relatedTableId],s=e=>{var t;return{relationships:null===(t=e.relationships)||void 0===t?void 0:t.filter(i),id:e.id}},a=e=>{var t;return(null===(t=e.relationships)||void 0===t?void 0:t.length)>0},n={layers:e.layers.map(s).filter(a),tables:e.tables.map(s).filter(a)};0===n.layers.length&&delete n.layers,0===n.tables.length&&delete n.tables;const o=e.layers.map(e=>Pe(e,["relationships"])),l=e.tables.map(e=>Pe(e,["relationships"]));return{relationshipParameters:n,cleanedCreateParameters:Object.assign(Object.assign({},e),{layers:o,tables:l})}},$e=(e,t)=>{const r=e=>Object.assign(Object.assign({},e),{indexes:(0,m.u)(e.indexes,e=>e.name)});return{layers:e.map(r),tables:t.map(r)}};async function Ee(e,t){const[r,i]=await(0,g.l)(["esri/config","esri/layers/KMLLayer"]);r.kmlServiceUrl=t.kmlService;const s=new i({url:e});await s.load();const a=s.fullExtent;return(0,I.e)(a)}const Ne=async(e,t,r,i)=>{try{const s=t.isPortal?r:`https://${t.portalHostname}/sharing/rest`,a=t.portalHostname?`${s}/content/items/${e}/data`:`${(0,S.g)(e)}/data`,n=await Ee(a,i);return{result:await(0,S.u)(e,{url:a,extent:n})}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},Me=(e,t)=>{const{newItemMode:r,typeKeywords:i,tags:a,extent:n,selectedServiceInfoLayersNames:o,addFeatureLayerType:c,layerData:d}=u.a,p=l.i.title;switch((null==p?void 0:p.length)>250&&(l.i.title=p.substring(0,250)),r){case"application":return Ie(e,t);case"file":return De();case"url":return _e(e,s.c.config);case"featureLayer":return ke({serviceInfo:e.serviceInfo,typeKeywords:i,tags:a,extent:n,selectedServiceInfoLayersNames:o,addFeatureLayerType:c,layerData:d});default:return(0,S.s)(Object.assign({},e))}},Ae=async()=>{try{const e=u.b,t=await Me(e,"");u.a.id=t.id;const r=await ze(u.a.id,{success:t.success});if("failed"===r.status)throw r.statusMessage;return{}}catch(e){console.error(e);const t=(null==e?void 0:e.statusMessage)||e||"";switch(!0){case t.includes("Invalid File Geodatabase"):return{error:{code:"invalidFileGeodatabase"}};case t.includes("Invalid Shapefile"):return{error:{code:"invalidShapefile"}};case t.includes("The request size is greater than the max allowed of 1024MB"):return{error:{code:"exceedsFileSize"}};default:return{error:{code:"unhandledError"}}}}},De=async e=>{const t=u.a.file,r=u.a.dataUrl;return!t&&r?Ge(e):(null==t?void 0:t.size)>C||"Esri Classifier Definition"===u.a.type?Je():async function(){const e=(0,S.h)(s.c.user,l.i.folder),t=(0,S.e)(l.i,u.a);try{return await(0,b.a)(e,t,{},"post")}catch(e){throw(null==e?void 0:e.message)||e}}()},Ge=async e=>{var t;const r=(0,S.h)(s.c.user,l.i.folder),{fileName:i,dataUrl:a,extension:o}=u.a,c=(0,S.c)(l.i,u.a),d=!!u.a.overwrite,p=(null==a?void 0:a.includes("/query?"))&&(null==i?void 0:i.includes("query"))&&(null==o?void 0:o.includes("json"))?{filename:(0,n.g)(),dataUrl:a}:{},v=Object.assign(Object.assign(Object.assign({},c),{async:!0,filename:null!==(t=null==e?void 0:e.filename)&&void 0!==t?t:i,title:null==e?void 0:e.title,overwrite:d}),p);return(0,b.r)(r,v,{},"post")};async function We(e,t,r=0){const{user:a,portal:n}=s.c,{existingItem:l}=u.a;try{const{partData:c,formData:u}=e,d=`?streamdata=true&size=${c.size}&partNum=${c.partNum}&f=json`,p=`${l?(0,i.g)(await(0,i.f)(l.owner,n),n):a.userContentUrl}/items/${t}/addPart${d}`;return{response:await(0,b.a)(p,u,{"X-Esri-Authorization":`Bearer ${(0,o.g)(s.c.portal)}`},"post"),attempts:r,partSize:c.size}}catch(i){if(!u.a.id)throw"cancelled";if(++r>5)throw new Error("Upload failed - too many attempts");return We(e,t,r)}}const Je=async e=>{var t,r,i,a;let n,d,p,y,f=!0;if(e){const{updateUrl:t,updateFormData:r,updateSourceDataId:i}=e;n=t,d=r,p=i,y=u.a.existingItem.owner}const m=()=>{if(u.a.id){f=!1;const e=u.a.id;return u.a.id=null,(0,S.j)(e,y)}},g=P.addSubscriber("addFileMultiPart",m),h=s.c.config;n=e?n:(0,S.h)(s.c.user,l.i.folder);const{fileName:w,file:x}=u.a;let O,I=null!==(t=h.multiPartBatchSize)&&void 0!==t?t:3,T=0;try{if(e)await(0,b.a)(n,d,{enctype:"multipart/form/data"},"post"),O=p;else{const e=await(0,b.r)(n,{multipart:!0,fileName:w,async:!0},{},"post");O=null!==(r=e.id)&&void 0!==r?r:e.itemId,u.a.id=O}u.a.uploadProgress=0,c.w.uploadProgress=0;let t=0;const i=function*(e){const t=u.a.file,{name:r,size:i}=t;let a=e?u.a.fileName:r,n=26214400,l=Math.ceil(i/n),c=0;for(l>1e4&&(n=Math.ceil(i/1e4),l=Math.ceil(i/n));c<l;){const e=new FormData,r=c*n,i=t.slice(r,r+n);c++;const l={partNum:c,size:i.size};e.append("partNum",String(l.partNum)),e.append("streamdata","true"),e.append("f","json"),e.append("token",(0,o.g)(s.c.portal)),e.append("file",i,a),yield{partData:l,formData:e}}return null}(!!e);await(0,v.s)(()=>{const{value:e,done:t}=i.next();return t?null:We(e,O)},{getBatchSize:()=>I,onPromiseCompleted:e=>{const{attempts:r,partSize:i}=e;r>0?(I=Math.max(1,Math.ceil(I/2)),T=0):(T++,T>=I&&(I=Math.min(I+1,10),T=0)),t+=i;const s=Math.floor(t/x.size*100);u.a.uploadProgress=s,c.w.uploadProgress=s},onPromiseThrow(){f=!1},shouldContinue:()=>f&&P.isSubscriberValid(g)}),P.removeSubscriber(g);const{type:a,extension:l,enablePublishing:y,properties:m,existingItem:h,tileLayerPublishType:L,classification:j}=u.a,C=[];return"3dTiles"===L&&"GaussianSplat"!==u.a.tilesLayer3dType&&C.push(u.a.tilesLayer3dType),await(0,S.f)(O,{file:x,type:a,extension:l,enablePublishing:y,properties:m,existingItem:h,typeKeywords:C,classification:j},!!e)}catch(e){throw await m(),console.error(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:e),null!==(a=null==e?void 0:e.message)&&void 0!==a?a:e}},_e=(e,t)=>{if(e.agsType)return xe(e);switch(e.type){case"KML":return async function(e,t){try{const[r,i]=await Promise.all([Ee(e.url,t),(0,I.j)(e)]);return await Ve(Object.assign(Object.assign({},e),{extent:r,thumbnailURL:i}))}catch(e){throw e}}(e,t);case"WMS":return(async e=>{const[t]=await(0,g.l)(["esri/geometry/SpatialReference"]),{layers:r}=u.a;if(!e||!(null==e?void 0:e.serviceInfo))return Promise.reject(new Error("serviceNotExist"));const i=W(e),{serviceInfo:s}=i;let a;const n=r.reduce(K,[]).map(e=>{a=a?e.extent?a.union(e.extent):a:e.extent;const t={name:e.name,title:e.title,legendUrl:void 0,queryable:e.queryable};return e.legendUrl&&(t.legendUrl=e.legendUrl),t});a=a||s.fullExtent;const o=!s.spatialReferences.some(e=>e===a.spatialReference.wkid),l={type:e.type,url:s.url,description:s.description||"",accessInformation:s.copyright||"",text:z(s,n),extent:a};o&&(0,I.a)(a,new t({wkid:s.spatialReferences[0]})).then(e=>l.extent=e);const c=await V(l,s);return Ve(c)})(e);case"WFS":return X(e);case"WCS":return Y(e);case"WMTS":return ee(e);case"OGCFeatureServer":return async function(e){const{serviceInfo:t,customParameters:r}=e;return t?(r.length>0&&(e.text=JSON.stringify({customParameters:R(r).customParameters})),Ve(e)):Promise.reject(new Error("serviceNotExist"))}(e);default:return Ve(e)}},qe=async e=>(0,S.s)(e),Ke=e=>{var t,r,i,s;const{type:a,agsType:n}=e,o=(null===(t=p.a[null!=n?n:a])||void 0===t?void 0:t.typeKeywords)||[];return((null===(i=null===(r=null==e?void 0:e.serviceInfo)||void 0===r?void 0:r.layers)||void 0===i?void 0:i.some(e=>"Oriented Imagery Layer"===e.type))||"Oriented Imagery Layer"===(null===(s=null==e?void 0:e.serviceInfo)||void 0===s?void 0:s.type))&&o.push("OrientedImageryLayer"),[...o,...e.typeKeywords||[]]},Ve=async e=>{const{type:t}=(0,a.g)(e.type),r=Object.assign(Object.assign({},e),{typeKeywords:Ke(e),type:t});return(0,S.s)(r)};async function ze(e,t={},r){var i;try{const i=s.c.user,a=null!=r?r:`${i.userContentUrl}/items/${e}/status`,n=(null==t?void 0:t.jobId)?{jobId:t.jobId}:{};return await(0,b.p)(a,{requestParams:n})}catch(r){if(!(null===(i=r.statusMessage)||void 0===i?void 0:i.includes("Item status doesn't exist"))||!t.success)throw console.error(r),r;return{itemId:e,status:"status-not-found",lastUpdatedTime:0,submissionTime:0,recordCount:0,attachmentCount:0}}}async function Be(e,t){const r=l.i.folder,{user:i}=s.c;return async function(e,t,r,i){const{config:a}=s.c,n=r.id&&"/"!==r.id&&r.id!==e?`/${r.id}`:"",o=`${a.restBaseUrl}content/users/${e}${n}/items/${t}/addResources`;return(0,b.r)(o,i,{},"post")}(i.username,t,r,{fileName:"cloudProvider.json",text:JSON.stringify(e),access:"private"})}},76246:(e,t,r)=>{r.d(t,{a:()=>i,i:()=>s});const i={FeatureServer:"Feature Service",GeocodeServer:"Geocoding Service",GeoDataServer:"Geodata Service",GeometryServer:"Geometry Service",GeoenrichmentServer:"Geoenrichment Service",GPServer:"Geoprocessing Service",GlobeServer:"Globe Service",ImageServer:"Image Service",MapServer:"Map Service",NAServer:"Network Analysis Service",ElevationServer:"Image Service",VectorTileServer:"Vector Tile Service",SceneServer:"Scene Service",StreamServer:"Stream Service",WMServer:"Workflow Manager Service",TiledImageServer:"Image Service",VideoServer:"Video Service",KnowledgeGraphServer:"Knowledge Graph Layer"},s=e=>!!Object.values(i).includes(e)}}]);