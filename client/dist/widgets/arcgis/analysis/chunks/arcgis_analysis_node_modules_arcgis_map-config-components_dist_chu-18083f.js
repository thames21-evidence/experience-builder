/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-18083f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_chu-18083f"],{5589:(e,t,o)=>{o.d(t,{a:()=>r,b:()=>s,g:()=>l,s:()=>c});var a=o(5294),n=(o(52797),o(54312),o(44345),o(55448),o(34031),o(63438),o(5933),o(28927),o(83368),o(89704),o(66228)),i=(o(56451),o(31521),o(23054),o(5077),o(23795),o(17902),o(87420),o(30161),o(81734),o(1225));o(83552),o(77462),o(49403),o(66617),o(10628),o(59640),o(64451),o(6176),o(10454),o(29614),o(94916),o(52554),o(2156),o(4038),o(49851),o(75054),o(15223),o(70169),o(47207),o(70852),o(48103),o(39423),o(85681),o(18444),o(42411),o(9767),o(38218),o(91914),o(86605),o(68196),o(440),o(46547),o(6238),o(7299);function s(e){const{mapView:t}=e,o=(0,i.g)(e),a=o.authoringInfo,s="class-breaks"===o.type?o.classBreakInfos:o.uniqueValueInfos,r=(0,i.c)(o,"size"),l=(0,i.p)(o,"reference-size"),u=(0,i.p)(o,"spike"),d=!!r&&!(0,n.i)(r.minSize),p=!!r&&"number"==typeof r.minSize,h="above-and-below"===a?.univariateTheme;let g=2,m=20;if(l)l.referenceSizeScale&&c(e),[g,m]=[l.sizeStops[0].size,l.sizeStops[1].size];else if(u)[g,m]=[u.sizeStops[0].size,u.sizeStops[1].size];else if(r)if(h){const e=r.stops;[g,m]=[e[2].size,Math.max(e[0].size,e[4].size)]}else if(d){const e=r.stops;[g,m]=[e[0].size,e[e.length-1].size]}else if(p)[g,m]=[r.minSize,r.maxSize];else{const e=t.scale,o=r.minSize.stops,a=r.maxSize.stops;[g,m]=[o[o.length-1].size,a[a.length-1].size];for(let t=0;t<o.length;t++){const n=o[t],i=a[t];if(e<=n.value){if(t>0){const s=o[t-1],r=a[t-1],l=(e-s.value)/(n.value-s.value);[g,m]=[s.size+(n.size-s.size)*l,r.size+(i.size-r.size)*l]}else[g,m]=[o[0].size,a[0].size];break}}}else if(s){const e=s[0].symbol,t=s[s.length-1].symbol;[g,m]=[(0,i.w)(e),(0,i.w)(t)],g>m&&([g,m]=[m,g])}return[g,m]}function r(e,t){const{mapView:o}=e,r=(0,i.g)(e),l=(0,i.c)(r,"size");let c=t[0],u=(0,n.i)(t[1])?t[1]:c;if(l){const i="above-and-below"===r.authoringInfo?.univariateTheme,d=!!l&&!(0,n.i)(l.minSize),p=!!l&&"number"==typeof l.minSize,[h,g]=s(e),m=h>g;if(!m&&c>=g?c=g-.75:m&&c>=h&&(c=h-.75),!m&&h>=u?u=h+.75:m&&g>=u&&(u=g+.75),i){const e=l.stops,o=m?t[1]:t[0],a=m?t[0]:t[1],n=Math.max(...e.map(e=>e.value)),i=e[2].value,s=Math.min(...e.map(e=>e.value)),r=Math.abs(n-i),c=Math.abs(s-i),u=r>c?r:c,d=a-o;e.forEach(e=>{const{value:t}=e;e.size=Math.abs(t-i)/u*d+o})}else if(d){const e=l.stops;l.stops=null,l.minSize=c,l.maxSize=u,l.minDataValue=e[0].value,l.maxDataValue=e[e.length-1].value}else if(p)m?(l.maxSize=c,l.minSize=u):(l.minSize=c,l.maxSize=u);else{const e=o.scale;let t=a.clone(l.minSize.stops),n=a.clone(l.maxSize.stops);m&&([t,n]=[n,t]);let i=c/t[t.length-1].size,s=u/n[n.length-1].size;for(let o=0;o<t.length;o++){const a=t[o],r=n[o];if(e<=a.value){if(o>0){const l=t[o-1],d=n[o-1],p=(e-l.value)/(a.value-l.value),[h,g]=[l.size+(a.size-l.size)*p,d.size+(r.size-d.size)*p];i=c/h,s=u/g}else i=c/t[0].size,s=u/n[0].size;break}}t.forEach(e=>e.size=Math.round(i*e.size*10)/10),n.forEach(e=>e.size=Math.round(s*e.size*10)/10),m&&([t,n]=[n,t]),l.minSize.stops=t,l.maxSize.stops=n}}else{const e=r.classBreakInfos[0].symbol,t=r.classBreakInfos[r.classBreakInfos.length-1].symbol;let o=(0,i.w)(e),a=(0,i.w)(t),n=!1;o>a&&([o,a]=[a,o],n=!0),o!==a&&c>a&&(c=a-.75),o=c,o!==a&&o>u&&(u=o+.75),a=u;const s=a-o,l=1===r.classBreakInfos.length?1:s/(r.classBreakInfos.length-1);r.classBreakInfos.forEach((e,t)=>{const s=e.symbol;n?(0,i.u)(s,a-l*t):(0,i.u)(s,o+l*t)})}}function l(e,t){const o=e.stops,a=o.length-1,n=o[0].value,i=o[a].value;if(t<=n)return o[0].size;if(t>=i)return o[a].size;for(let e=0;e<=a;e++){const a=o[e],n=o[e+1];if(t>=a.value&&t<n.value){const e=n.value-a.value,o=a.size-n.size,i=(t-a.value)/e,s=a.size-o*i;return Math.round(100*s)/100}}return 1}function c(e){const{mapView:t}=e,o=(0,i.g)(e),a=(0,i.p)(o,"reference-size"),n=a.referenceSizeScale/t.scale;a.sizeStops.forEach(e=>e.size*=n),a.referenceSizeScale=t.scale}},24539:(e,t,o)=>{o.r(t),o.d(t,{ArcgisMapConfigSmartMappingPanelsType:()=>kt});var a=o(73679),n=o(4395),i=o(46317),s=o(5294),r=o(52797),l=o(41631),c=o(23054),u=o(56451),d=o(81734),p=o(24114),h=o(1225),g=o(89989),m=(o(44345),o(55448),o(34031),o(63438),o(5933),o(89704),o(18423),o(96086),o(91813),o(21255),o(13078),o(21303),o(12627),o(31521),o(5077),o(23795),o(17902),o(87420),o(30161),o(65595)),f=o(96333),v=(o(10454),o(29614),o(94916),o(52554),o(2156),o(4038),o(49851),o(75054),o(15223),o(70169),o(92264)),y=(o(85681),o(18444),o(42411),o(9767),o(38218),o(91914),o(86605),o(68196),o(440),o(46547),o(28927),o(6238),o(7299),o(32173));function b(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,a)}return o}function S(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?b(Object(o),!0).forEach(function(t){x(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):b(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function x(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function $(){return $=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},$.apply(this,arguments)}function E(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)o=i[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)o=i[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function T(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var N=T(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),k=T(/Edge/i),C=T(/firefox/i),M=T(/safari/i)&&!T(/chrome/i)&&!T(/android/i),I=T(/iP(ad|od|hone)/i),D=T(/chrome/i)&&T(/android/i),V={capture:!1,passive:!1};function _(e,t,o){e.addEventListener(t,o,!N&&V)}function O(e,t,o){e.removeEventListener(t,o,!N&&V)}function q(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function P(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function A(e,t,o,a){if(e){o=o||document;do{if(null!=t&&(">"===t[0]?e.parentNode===o&&q(e,t):q(e,t))||a&&e===o)return e;if(e===o)break}while(e=P(e))}return null}var z,F=/\s+/g;function R(e,t,o){if(e&&t)if(e.classList)e.classList[o?"add":"remove"](t);else{var a=(" "+e.className+" ").replace(F," ").replace(" "+t+" "," ");e.className=(a+(o?" "+t:"")).replace(F," ")}}function G(e,t,o){var a=e&&e.style;if(a){if(void 0===o)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(o=e.currentStyle),void 0===t?o:o[t];t in a||-1!==t.indexOf("webkit")||(t="-webkit-"+t),a[t]=o+("string"==typeof o?"":"px")}}function B(e,t){var o="";if("string"==typeof e)o=e;else do{var a=G(e,"transform");a&&"none"!==a&&(o=a+" "+o)}while(!t&&(e=e.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(o)}function L(e,t,o){if(e){var a=e.getElementsByTagName(t),n=0,i=a.length;if(o)for(;n<i;n++)o(a[n],n);return a}return[]}function U(){var e=document.scrollingElement;return e||document.documentElement}function H(e,t,o,a,n){if(e.getBoundingClientRect||e===window){var i,s,r,l,c,u,d;if(e!==window&&e.parentNode&&e!==U()?(s=(i=e.getBoundingClientRect()).top,r=i.left,l=i.bottom,c=i.right,u=i.height,d=i.width):(s=0,r=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,d=window.innerWidth),(t||o)&&e!==window&&(n=n||e.parentNode,!N))do{if(n&&n.getBoundingClientRect&&("none"!==G(n,"transform")||o&&"static"!==G(n,"position"))){var p=n.getBoundingClientRect();s-=p.top+parseInt(G(n,"border-top-width")),r-=p.left+parseInt(G(n,"border-left-width")),l=s+i.height,c=r+i.width;break}}while(n=n.parentNode);if(a&&e!==window){var h=B(n||e),g=h&&h.a,m=h&&h.d;h&&(l=(s/=m)+(u/=m),c=(r/=g)+(d/=g))}return{top:s,left:r,bottom:l,right:c,width:d,height:u}}}function Y(e){var t=H(e),o=parseInt(G(e,"padding-left")),a=parseInt(G(e,"padding-top")),n=parseInt(G(e,"padding-right")),i=parseInt(G(e,"padding-bottom"));return t.top+=a+parseInt(G(e,"border-top-width")),t.left+=o+parseInt(G(e,"border-left-width")),t.width=e.clientWidth-o-n,t.height=e.clientHeight-a-i,t.bottom=t.top+t.height,t.right=t.left+t.width,t}function X(e,t,o){for(var a=Z(e,!0),n=H(e)[t];a;){var i=H(a)[o];if(!("top"===o||"left"===o?n>=i:n<=i))return a;if(a===U())break;a=Z(a,!1)}return!1}function j(e,t,o,a){for(var n=0,i=0,s=e.children;i<s.length;){if("none"!==s[i].style.display&&s[i]!==ot.ghost&&(a||s[i]!==ot.dragged)&&A(s[i],o.draggable,e,!1)){if(n===t)return s[i];n++}i++}return null}function J(e,t){for(var o=e.lastElementChild;o&&(o===ot.ghost||"none"===G(o,"display")||t&&!q(o,t));)o=o.previousElementSibling;return o||null}function W(e,t){var o=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===ot.clone||t&&!q(e,t)||o++;return o}function K(e){var t=0,o=0,a=U();if(e)do{var n=B(e),i=n.a,s=n.d;t+=e.scrollLeft*i,o+=e.scrollTop*s}while(e!==a&&(e=e.parentNode));return[t,o]}function Z(e,t){if(!e||!e.getBoundingClientRect)return U();var o=e,a=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var n=G(o);if(o.clientWidth<o.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!o.getBoundingClientRect||o===document.body)return U();if(a||t)return o;a=!0}}}while(o=o.parentNode);return U()}function Q(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function ee(e,t){return function(){if(!z){var o=arguments;1===o.length?e.call(this,o[0]):e.apply(this,o),z=setTimeout(function(){z=void 0},t)}}}function te(e,t,o){e.scrollLeft+=t,e.scrollTop+=o}function oe(e){var t=window.Polymer,o=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):o?o(e).clone(!0)[0]:e.cloneNode(!0)}var ae="Sortable"+(new Date).getTime();function ne(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach(function(e){if("none"!==G(e,"display")&&e!==ot.ghost){t.push({target:e,rect:H(e)});var o=S({},t[t.length-1].rect);if(e.thisAnimationDuration){var a=B(e,!0);a&&(o.top-=a.f,o.left-=a.e)}e.fromRect=o}})},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var o in e)if(e.hasOwnProperty(o))for(var a in t)if(t.hasOwnProperty(a)&&t[a]===e[o][a])return Number(o);return-1}(t,{target:e}),1)},animateAll:function(o){var a=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof o&&o());var n=!1,i=0;t.forEach(function(e){var t=0,o=e.target,s=o.fromRect,r=H(o),l=o.prevFromRect,c=o.prevToRect,u=e.rect,d=B(o,!0);d&&(r.top-=d.f,r.left-=d.e),o.toRect=r,o.thisAnimationDuration&&Q(l,r)&&!Q(s,r)&&(u.top-r.top)/(u.left-r.left)===(s.top-r.top)/(s.left-r.left)&&(t=function(e,t,o,a){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-o.top,2)+Math.pow(t.left-o.left,2))*a.animation}(u,l,c,a.options)),Q(r,s)||(o.prevFromRect=s,o.prevToRect=r,t||(t=a.options.animation),a.animate(o,u,r,t)),t&&(n=!0,i=Math.max(i,t),clearTimeout(o.animationResetTimer),o.animationResetTimer=setTimeout(function(){o.animationTime=0,o.prevFromRect=null,o.fromRect=null,o.prevToRect=null,o.thisAnimationDuration=null},t),o.thisAnimationDuration=t)}),clearTimeout(e),n?e=setTimeout(function(){"function"==typeof o&&o()},i):"function"==typeof o&&o(),t=[]},animate:function(e,t,o,a){if(a){G(e,"transition",""),G(e,"transform","");var n=B(this.el),i=n&&n.a,s=n&&n.d,r=(t.left-o.left)/(i||1),l=(t.top-o.top)/(s||1);e.animatingX=!!r,e.animatingY=!!l,G(e,"transform","translate3d("+r+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),G(e,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),G(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout(function(){G(e,"transition",""),G(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},a)}}}}var ie=[],se={initializeByDefault:!0},re={mount:function(e){for(var t in se)se.hasOwnProperty(t)&&!(t in e)&&(e[t]=se[t]);ie.forEach(function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),ie.push(e)},pluginEvent:function(e,t,o){var a=this;this.eventCanceled=!1,o.cancel=function(){a.eventCanceled=!0};var n=e+"Global";ie.forEach(function(a){t[a.pluginName]&&(t[a.pluginName][n]&&t[a.pluginName][n](S({sortable:t},o)),t.options[a.pluginName]&&t[a.pluginName][e]&&t[a.pluginName][e](S({sortable:t},o)))})},initializePlugins:function(e,t,o,a){for(var n in ie.forEach(function(a){var n=a.pluginName;if(e.options[n]||a.initializeByDefault){var i=new a(e,t,e.options);i.sortable=e,i.options=e.options,e[n]=i,$(o,i.defaults)}}),e.options)if(e.options.hasOwnProperty(n)){var i=this.modifyOption(e,n,e.options[n]);void 0!==i&&(e.options[n]=i)}},getEventProperties:function(e,t){var o={};return ie.forEach(function(a){"function"==typeof a.eventProperties&&$(o,a.eventProperties.call(t[a.pluginName],e))}),o},modifyOption:function(e,t,o){var a;return ie.forEach(function(n){e[n.pluginName]&&n.optionListeners&&"function"==typeof n.optionListeners[t]&&(a=n.optionListeners[t].call(e[n.pluginName],o))}),a}};function le(e){var t=e.sortable,o=e.rootEl,a=e.name,n=e.targetEl,i=e.cloneEl,s=e.toEl,r=e.fromEl,l=e.oldIndex,c=e.newIndex,u=e.oldDraggableIndex,d=e.newDraggableIndex,p=e.originalEvent,h=e.putSortable,g=e.extraEventProperties;if(t=t||o&&o[ae]){var m,f=t.options,v="on"+a.charAt(0).toUpperCase()+a.substr(1);!window.CustomEvent||N||k?(m=document.createEvent("Event")).initEvent(a,!0,!0):m=new CustomEvent(a,{bubbles:!0,cancelable:!0}),m.to=s||o,m.from=r||o,m.item=n||o,m.clone=i,m.oldIndex=l,m.newIndex=c,m.oldDraggableIndex=u,m.newDraggableIndex=d,m.originalEvent=p,m.pullMode=h?h.lastPutMode:void 0;var y=S(S({},g),re.getEventProperties(a,t));for(var b in y)m[b]=y[b];o&&o.dispatchEvent(m),f[v]&&f[v].call(t,m)}}var ce=["evt"],ue=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=o.evt,n=E(o,ce);re.pluginEvent.bind(ot)(e,t,S({dragEl:pe,parentEl:he,ghostEl:ge,rootEl:me,nextEl:fe,lastDownEl:ve,cloneEl:ye,cloneHidden:be,dragStarted:Ve,putSortable:Te,activeSortable:ot.active,originalEvent:a,oldIndex:Se,oldDraggableIndex:xe,newIndex:we,newDraggableIndex:$e,hideGhostForTarget:Ze,unhideGhostForTarget:Qe,cloneNowHidden:function(){be=!0},cloneNowShown:function(){be=!1},dispatchSortableEvent:function(e){de({sortable:t,name:e,originalEvent:a})}},n))};function de(e){le(S({putSortable:Te,cloneEl:ye,targetEl:pe,rootEl:me,oldIndex:Se,oldDraggableIndex:xe,newIndex:we,newDraggableIndex:$e},e))}var pe,he,ge,me,fe,ve,ye,be,Se,we,xe,$e,Ee,Te,Ne,ke,Ce,Me,Ie,De,Ve,_e,Oe,qe,Pe,Ae=!1,ze=!1,Fe=[],Re=!1,Ge=!1,Be=[],Le=!1,Ue=[],He="undefined"!=typeof document,Ye=I,Xe=k||N?"cssFloat":"float",je=He&&!D&&!I&&"draggable"in document.createElement("div"),Je=function(){if(He){if(N)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),We=function(e,t){var o=G(e),a=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),n=j(e,0,t),i=j(e,1,t),s=n&&G(n),r=i&&G(i),l=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+H(n).width,c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+H(i).width;if("flex"===o.display)return"column"===o.flexDirection||"column-reverse"===o.flexDirection?"vertical":"horizontal";if("grid"===o.display)return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&s.float&&"none"!==s.float){var u="left"===s.float?"left":"right";return!i||"both"!==r.clear&&r.clear!==u?"horizontal":"vertical"}return n&&("block"===s.display||"flex"===s.display||"table"===s.display||"grid"===s.display||l>=a&&"none"===o[Xe]||i&&"none"===o[Xe]&&l+c>a)?"vertical":"horizontal"},Ke=function(e){function t(e,o){return function(a,n,i,s){var r=a.options.group.name&&n.options.group.name&&a.options.group.name===n.options.group.name;if(null==e&&(o||r))return!0;if(null==e||!1===e)return!1;if(o&&"clone"===e)return e;if("function"==typeof e)return t(e(a,n,i,s),o)(a,n,i,s);var l=(o?a:n).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var o={},a=e.group;a&&"object"==w(a)||(a={name:a}),o.name=a.name,o.checkPull=t(a.pull,!0),o.checkPut=t(a.put),o.revertClone=a.revertClone,e.group=o},Ze=function(){!Je&&ge&&G(ge,"display","none")},Qe=function(){!Je&&ge&&G(ge,"display","")};He&&!D&&document.addEventListener("click",function(e){if(ze)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),ze=!1,!1},!0);var et=function(e){if(pe){e=e.touches?e.touches[0]:e;var t=(n=e.clientX,i=e.clientY,Fe.some(function(e){var t=e[ae].options.emptyInsertThreshold;if(t&&!J(e)){var o=H(e),a=n>=o.left-t&&n<=o.right+t,r=i>=o.top-t&&i<=o.bottom+t;return a&&r?s=e:void 0}}),s);if(t){var o={};for(var a in e)e.hasOwnProperty(a)&&(o[a]=e[a]);o.target=o.rootEl=t,o.preventDefault=void 0,o.stopPropagation=void 0,t[ae]._onDragOver(o)}}var n,i,s},tt=function(e){pe&&pe.parentNode[ae]._isOutsideThisEl(e.target)};function ot(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=$({},t),e[ae]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return We(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==ot.supportPointer&&"PointerEvent"in window&&!M,emptyInsertThreshold:5};for(var a in re.initializePlugins(this,e,o),o)!(a in t)&&(t[a]=o[a]);for(var n in Ke(t),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!t.forceFallback&&je,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?_(e,"pointerdown",this._onTapStart):(_(e,"mousedown",this._onTapStart),_(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(_(e,"dragover",this),_(e,"dragenter",this)),Fe.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),$(this,ne())}function at(e,t,o,a,n,i,s,r){var l,c,u=e[ae],d=u.options.onMove;return!window.CustomEvent||N||k?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=o,l.draggedRect=a,l.related=n||t,l.relatedRect=i||H(t),l.willInsertAfter=r,l.originalEvent=s,e.dispatchEvent(l),d&&(c=d.call(u,l,s)),c}function nt(e){e.draggable=!1}function it(){Le=!1}function st(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,o=t.length,a=0;o--;)a+=t.charCodeAt(o);return a.toString(36)}function rt(e){return setTimeout(e,0)}function lt(e){return clearTimeout(e)}ot.prototype={constructor:ot,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(_e=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,pe):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,o=this.el,a=this.options,n=a.preventOnFilter,i=e.type,s=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,r=(s||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,c=a.filter;if(function(e){Ue.length=0;var t=e.getElementsByTagName("input"),o=t.length;for(;o--;){var a=t[o];a.checked&&Ue.push(a)}}(o),!pe&&!(/mousedown|pointerdown/.test(i)&&0!==e.button||a.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!M||!r||"SELECT"!==r.tagName.toUpperCase())&&!((r=A(r,a.draggable,o,!1))&&r.animated||ve===r)){if(Se=W(r),xe=W(r,a.draggable),"function"==typeof c){if(c.call(this,e,r,this))return de({sortable:t,rootEl:l,name:"filter",targetEl:r,toEl:o,fromEl:o}),ue("filter",t,{evt:e}),void(n&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some(function(a){if(a=A(l,a.trim(),o,!1))return de({sortable:t,rootEl:a,name:"filter",targetEl:r,fromEl:o,toEl:o}),ue("filter",t,{evt:e}),!0})))return void(n&&e.cancelable&&e.preventDefault());a.handle&&!A(l,a.handle,o,!1)||this._prepareDragStart(e,s,r)}}},_prepareDragStart:function(e,t,o){var a,n=this,i=n.el,s=n.options,r=i.ownerDocument;if(o&&!pe&&o.parentNode===i){var l=H(o);if(me=i,he=(pe=o).parentNode,fe=pe.nextSibling,ve=o,Ee=s.group,ot.dragged=pe,Ne={target:pe,clientX:(t||e).clientX,clientY:(t||e).clientY},Ie=Ne.clientX-l.left,De=Ne.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,pe.style["will-change"]="all",a=function(){ue("delayEnded",n,{evt:e}),ot.eventCanceled?n._onDrop():(n._disableDelayedDragEvents(),!C&&n.nativeDraggable&&(pe.draggable=!0),n._triggerDragStart(e,t),de({sortable:n,name:"choose",originalEvent:e}),R(pe,s.chosenClass,!0))},s.ignore.split(",").forEach(function(e){L(pe,e.trim(),nt)}),_(r,"dragover",et),_(r,"mousemove",et),_(r,"touchmove",et),_(r,"mouseup",n._onDrop),_(r,"touchend",n._onDrop),_(r,"touchcancel",n._onDrop),C&&this.nativeDraggable&&(this.options.touchStartThreshold=4,pe.draggable=!0),ue("delayStart",this,{evt:e}),!s.delay||s.delayOnTouchOnly&&!t||this.nativeDraggable&&(k||N))a();else{if(ot.eventCanceled)return void this._onDrop();_(r,"mouseup",n._disableDelayedDrag),_(r,"touchend",n._disableDelayedDrag),_(r,"touchcancel",n._disableDelayedDrag),_(r,"mousemove",n._delayedDragTouchMoveHandler),_(r,"touchmove",n._delayedDragTouchMoveHandler),s.supportPointer&&_(r,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(a,s.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){pe&&nt(pe),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;O(e,"mouseup",this._disableDelayedDrag),O(e,"touchend",this._disableDelayedDrag),O(e,"touchcancel",this._disableDelayedDrag),O(e,"mousemove",this._delayedDragTouchMoveHandler),O(e,"touchmove",this._delayedDragTouchMoveHandler),O(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?_(document,"pointermove",this._onTouchMove):_(document,t?"touchmove":"mousemove",this._onTouchMove):(_(pe,"dragend",this),_(me,"dragstart",this._onDragStart));try{document.selection?rt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(Ae=!1,me&&pe){ue("dragStarted",this,{evt:t}),this.nativeDraggable&&_(document,"dragover",tt);var o=this.options;!e&&R(pe,o.dragClass,!1),R(pe,o.ghostClass,!0),ot.active=this,e&&this._appendGhost(),de({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ke){this._lastX=ke.clientX,this._lastY=ke.clientY,Ze();for(var e=document.elementFromPoint(ke.clientX,ke.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ke.clientX,ke.clientY))!==t;)t=e;if(pe.parentNode[ae]._isOutsideThisEl(e),t)do{if(t[ae]){if(t[ae]._onDragOver({clientX:ke.clientX,clientY:ke.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);Qe()}},_onTouchMove:function(e){if(Ne){var t=this.options,o=t.fallbackTolerance,a=t.fallbackOffset,n=e.touches?e.touches[0]:e,i=ge&&B(ge,!0),s=ge&&i&&i.a,r=ge&&i&&i.d,l=Ye&&Pe&&K(Pe),c=(n.clientX-Ne.clientX+a.x)/(s||1)+(l?l[0]-Be[0]:0)/(s||1),u=(n.clientY-Ne.clientY+a.y)/(r||1)+(l?l[1]-Be[1]:0)/(r||1);if(!ot.active&&!Ae){if(o&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<o)return;this._onDragStart(e,!0)}if(ge){i?(i.e+=c-(Ce||0),i.f+=u-(Me||0)):i={a:1,b:0,c:0,d:1,e:c,f:u};var d="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");G(ge,"webkitTransform",d),G(ge,"mozTransform",d),G(ge,"msTransform",d),G(ge,"transform",d),Ce=c,Me=u,ke=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!ge){var e=this.options.fallbackOnBody?document.body:me,t=H(pe,!0,Ye,!0,e),o=this.options;if(Ye){for(Pe=e;"static"===G(Pe,"position")&&"none"===G(Pe,"transform")&&Pe!==document;)Pe=Pe.parentNode;Pe!==document.body&&Pe!==document.documentElement?(Pe===document&&(Pe=U()),t.top+=Pe.scrollTop,t.left+=Pe.scrollLeft):Pe=U(),Be=K(Pe)}R(ge=pe.cloneNode(!0),o.ghostClass,!1),R(ge,o.fallbackClass,!0),R(ge,o.dragClass,!0),G(ge,"transition",""),G(ge,"transform",""),G(ge,"box-sizing","border-box"),G(ge,"margin",0),G(ge,"top",t.top),G(ge,"left",t.left),G(ge,"width",t.width),G(ge,"height",t.height),G(ge,"opacity","0.8"),G(ge,"position",Ye?"absolute":"fixed"),G(ge,"zIndex","100000"),G(ge,"pointerEvents","none"),ot.ghost=ge,e.appendChild(ge),G(ge,"transform-origin",Ie/parseInt(ge.style.width)*100+"% "+De/parseInt(ge.style.height)*100+"%")}},_onDragStart:function(e,t){var o=this,a=e.dataTransfer,n=o.options;ue("dragStart",this,{evt:e}),ot.eventCanceled?this._onDrop():(ue("setupClone",this),ot.eventCanceled||((ye=oe(pe)).removeAttribute("id"),ye.draggable=!1,ye.style["will-change"]="",this._hideClone(),R(ye,this.options.chosenClass,!1),ot.clone=ye),o.cloneId=rt(function(){ue("clone",o),ot.eventCanceled||(o.options.removeCloneOnHide||me.insertBefore(ye,pe),o._hideClone(),de({sortable:o,name:"clone"}))}),!t&&R(pe,n.dragClass,!0),t?(ze=!0,o._loopId=setInterval(o._emulateDragOver,50)):(O(document,"mouseup",o._onDrop),O(document,"touchend",o._onDrop),O(document,"touchcancel",o._onDrop),a&&(a.effectAllowed="move",n.setData&&n.setData.call(o,a,pe)),_(document,"drop",o),G(pe,"transform","translateZ(0)")),Ae=!0,o._dragStartId=rt(o._dragStarted.bind(o,t,e)),_(document,"selectstart",o),Ve=!0,M&&G(document.body,"user-select","none"))},_onDragOver:function(e){var t,o,a,n,i=this.el,s=e.target,r=this.options,l=r.group,c=ot.active,u=Ee===l,d=r.sort,p=Te||c,h=this,g=!1;if(!Le){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=A(s,r.draggable,i,!0),I("dragOver"),ot.eventCanceled)return g;if(pe.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||h._ignoreWhileAnimating===s)return V(!1);if(ze=!1,c&&!r.disabled&&(u?d||(a=he!==me):Te===this||(this.lastPutMode=Ee.checkPull(this,c,pe,e))&&l.checkPut(this,c,pe,e))){if(n="vertical"===this._getDirection(e,s),t=H(pe),I("dragOverValid"),ot.eventCanceled)return g;if(a)return he=me,D(),this._hideClone(),I("revert"),ot.eventCanceled||(fe?me.insertBefore(pe,fe):me.appendChild(pe)),V(!0);var m=J(i,r.draggable);if(!m||function(e,t,o){var a=H(J(o.el,o.options.draggable)),n=Y(o.el),i=10;return t?e.clientX>n.right+i||e.clientY>a.bottom&&e.clientX>a.left:e.clientY>n.bottom+i||e.clientX>a.right&&e.clientY>a.top}(e,n,this)&&!m.animated){if(m===pe)return V(!1);if(m&&i===e.target&&(s=m),s&&(o=H(s)),!1!==at(me,i,pe,t,s,o,e,!!s))return D(),m&&m.nextSibling?i.insertBefore(pe,m.nextSibling):i.appendChild(pe),he=i,_(),V(!0)}else if(m&&function(e,t,o){var a=H(j(o.el,0,o.options,!0)),n=Y(o.el),i=10;return t?e.clientX<n.left-i||e.clientY<a.top&&e.clientX<a.right:e.clientY<n.top-i||e.clientY<a.bottom&&e.clientX<a.left}(e,n,this)){var f=j(i,0,r,!0);if(f===pe)return V(!1);if(o=H(s=f),!1!==at(me,i,pe,t,s,o,e,!1))return D(),i.insertBefore(pe,f),he=i,_(),V(!0)}else if(s.parentNode===i){o=H(s);var v,y,b,w=pe.parentNode!==i,x=!function(e,t,o){var a=o?e.left:e.top,n=o?e.right:e.bottom,i=o?e.width:e.height,s=o?t.left:t.top,r=o?t.right:t.bottom,l=o?t.width:t.height;return a===s||n===r||a+i/2===s+l/2}(pe.animated&&pe.toRect||t,s.animated&&s.toRect||o,n),$=n?"top":"left",E=X(s,"top","top")||X(pe,"top","top"),T=E?E.scrollTop:void 0;if(_e!==s&&(y=o[$],Re=!1,Ge=!x&&r.invertSwap||w),v=function(e,t,o,a,n,i,s,r){var l=a?e.clientY:e.clientX,c=a?o.height:o.width,u=a?o.top:o.left,d=a?o.bottom:o.right,p=!1;if(!s)if(r&&qe<c*n){if(!Re&&(1===Oe?l>u+c*i/2:l<d-c*i/2)&&(Re=!0),Re)p=!0;else if(1===Oe?l<u+qe:l>d-qe)return-Oe}else if(l>u+c*(1-n)/2&&l<d-c*(1-n)/2)return function(e){return W(pe)<W(e)?1:-1}(t);if((p=p||s)&&(l<u+c*i/2||l>d-c*i/2))return l>u+c/2?1:-1;return 0}(e,s,o,n,x?1:r.swapThreshold,null==r.invertedSwapThreshold?r.swapThreshold:r.invertedSwapThreshold,Ge,_e===s),0!==v){var N=W(pe);do{N-=v,b=he.children[N]}while(b&&("none"===G(b,"display")||b===ge))}if(0===v||b===s)return V(!1);_e=s,Oe=v;var k=s.nextElementSibling,C=!1,M=at(me,i,pe,t,s,o,e,C=1===v);if(!1!==M)return 1!==M&&-1!==M||(C=1===M),Le=!0,setTimeout(it,30),D(),C&&!k?i.appendChild(pe):s.parentNode.insertBefore(pe,C?k:s),E&&te(E,0,T-E.scrollTop),he=pe.parentNode,void 0===y||Ge||(qe=Math.abs(y-H(s)[$])),_(),V(!0)}if(i.contains(pe))return V(!1)}return!1}function I(r,l){ue(r,h,S({evt:e,isOwner:u,axis:n?"vertical":"horizontal",revert:a,dragRect:t,targetRect:o,canSort:d,fromSortable:p,target:s,completed:V,onMove:function(o,a){return at(me,i,pe,t,o,H(o),e,a)},changed:_},l))}function D(){I("dragOverAnimationCapture"),h.captureAnimationState(),h!==p&&p.captureAnimationState()}function V(t){return I("dragOverCompleted",{insertion:t}),t&&(u?c._hideClone():c._showClone(h),h!==p&&(R(pe,Te?Te.options.ghostClass:c.options.ghostClass,!1),R(pe,r.ghostClass,!0)),Te!==h&&h!==ot.active?Te=h:h===ot.active&&Te&&(Te=null),p===h&&(h._ignoreWhileAnimating=s),h.animateAll(function(){I("dragOverAnimationComplete"),h._ignoreWhileAnimating=null}),h!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(s===pe&&!pe.animated||s===i&&!s.animated)&&(_e=null),r.dragoverBubble||e.rootEl||s===document||(pe.parentNode[ae]._isOutsideThisEl(e.target),!t&&et(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),g=!0}function _(){we=W(pe),$e=W(pe,r.draggable),de({sortable:h,name:"change",toEl:i,newIndex:we,newDraggableIndex:$e,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){O(document,"mousemove",this._onTouchMove),O(document,"touchmove",this._onTouchMove),O(document,"pointermove",this._onTouchMove),O(document,"dragover",et),O(document,"mousemove",et),O(document,"touchmove",et)},_offUpEvents:function(){var e=this.el.ownerDocument;O(e,"mouseup",this._onDrop),O(e,"touchend",this._onDrop),O(e,"pointerup",this._onDrop),O(e,"touchcancel",this._onDrop),O(document,"selectstart",this)},_onDrop:function(e){var t=this.el,o=this.options;we=W(pe),$e=W(pe,o.draggable),ue("drop",this,{evt:e}),he=pe&&pe.parentNode,we=W(pe),$e=W(pe,o.draggable),ot.eventCanceled||(Ae=!1,Ge=!1,Re=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),lt(this.cloneId),lt(this._dragStartId),this.nativeDraggable&&(O(document,"drop",this),O(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),M&&G(document.body,"user-select",""),G(pe,"transform",""),e&&(Ve&&(e.cancelable&&e.preventDefault(),!o.dropBubble&&e.stopPropagation()),ge&&ge.parentNode&&ge.parentNode.removeChild(ge),(me===he||Te&&"clone"!==Te.lastPutMode)&&ye&&ye.parentNode&&ye.parentNode.removeChild(ye),pe&&(this.nativeDraggable&&O(pe,"dragend",this),nt(pe),pe.style["will-change"]="",Ve&&!Ae&&R(pe,Te?Te.options.ghostClass:this.options.ghostClass,!1),R(pe,this.options.chosenClass,!1),de({sortable:this,name:"unchoose",toEl:he,newIndex:null,newDraggableIndex:null,originalEvent:e}),me!==he?(we>=0&&(de({rootEl:he,name:"add",toEl:he,fromEl:me,originalEvent:e}),de({sortable:this,name:"remove",toEl:he,originalEvent:e}),de({rootEl:he,name:"sort",toEl:he,fromEl:me,originalEvent:e}),de({sortable:this,name:"sort",toEl:he,originalEvent:e})),Te&&Te.save()):we!==Se&&we>=0&&(de({sortable:this,name:"update",toEl:he,originalEvent:e}),de({sortable:this,name:"sort",toEl:he,originalEvent:e})),ot.active&&(null!=we&&-1!==we||(we=Se,$e=xe),de({sortable:this,name:"end",toEl:he,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){ue("nulling",this),me=pe=he=ge=fe=ye=ve=be=Ne=ke=Ve=we=$e=Se=xe=_e=Oe=Te=Ee=ot.dragged=ot.ghost=ot.clone=ot.active=null,Ue.forEach(function(e){e.checked=!0}),Ue.length=Ce=Me=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":pe&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],o=this.el.children,a=0,n=o.length,i=this.options;a<n;a++)A(e=o[a],i.draggable,this.el,!1)&&t.push(e.getAttribute(i.dataIdAttr)||st(e));return t},sort:function(e,t){var o={},a=this.el;this.toArray().forEach(function(e,t){var n=a.children[t];A(n,this.options.draggable,a,!1)&&(o[e]=n)},this),t&&this.captureAnimationState(),e.forEach(function(e){o[e]&&(a.removeChild(o[e]),a.appendChild(o[e]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return A(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var o=this.options;if(void 0===t)return o[e];var a=re.modifyOption(this,e,t);o[e]=void 0!==a?a:t,"group"===e&&Ke(o)},destroy:function(){ue("destroy",this);var e=this.el;e[ae]=null,O(e,"mousedown",this._onTapStart),O(e,"touchstart",this._onTapStart),O(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(O(e,"dragover",this),O(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Fe.splice(Fe.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!be){if(ue("hideClone",this),ot.eventCanceled)return;G(ye,"display","none"),this.options.removeCloneOnHide&&ye.parentNode&&ye.parentNode.removeChild(ye),be=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(be){if(ue("showClone",this),ot.eventCanceled)return;pe.parentNode!=me||this.options.group.revertClone?fe?me.insertBefore(ye,fe):me.appendChild(ye):me.insertBefore(ye,pe),this.options.group.revertClone&&this.animate(pe,ye),G(ye,"display",""),be=!1}}else this._hideClone()}},He&&_(document,"touchmove",function(e){(ot.active||Ae)&&e.cancelable&&e.preventDefault()}),ot.utils={on:_,off:O,css:G,find:L,is:function(e,t){return!!A(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e},throttle:ee,closest:A,toggleClass:R,clone:oe,index:W,nextTick:rt,cancelNextTick:lt,detectDirection:We,getChild:j},ot.get=function(e){return e[ae]},ot.mount=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];t[0].constructor===Array&&(t=t[0]),t.forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(ot.utils=S(S({},ot.utils),e.utils)),re.mount(e)})},ot.create=function(e,t){return new ot(e,t)},ot.version="1.15.1";var ct,ut,dt,pt,ht,gt,mt=[],ft=!1;function vt(){mt.forEach(function(e){clearInterval(e.pid)}),mt=[]}function yt(){clearInterval(gt)}var bt=ee(function(e,t,o,a){if(t.scroll){var n,i=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,l=t.scrollSpeed,c=U(),u=!1;ut!==o&&(ut=o,vt(),ct=t.scroll,n=t.scrollFn,!0===ct&&(ct=Z(o,!0)));var d=0,p=ct;do{var h=p,g=H(h),m=g.top,f=g.bottom,v=g.left,y=g.right,b=g.width,S=g.height,w=void 0,x=void 0,$=h.scrollWidth,E=h.scrollHeight,T=G(h),N=h.scrollLeft,k=h.scrollTop;h===c?(w=b<$&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),x=S<E&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(w=b<$&&("auto"===T.overflowX||"scroll"===T.overflowX),x=S<E&&("auto"===T.overflowY||"scroll"===T.overflowY));var C=w&&(Math.abs(y-i)<=r&&N+b<$)-(Math.abs(v-i)<=r&&!!N),M=x&&(Math.abs(f-s)<=r&&k+S<E)-(Math.abs(m-s)<=r&&!!k);if(!mt[d])for(var I=0;I<=d;I++)mt[I]||(mt[I]={});mt[d].vx==C&&mt[d].vy==M&&mt[d].el===h||(mt[d].el=h,mt[d].vx=C,mt[d].vy=M,clearInterval(mt[d].pid),0==C&&0==M||(u=!0,mt[d].pid=setInterval(function(){a&&0===this.layer&&ot.active._onTouchMove(ht);var t=mt[this.layer].vy?mt[this.layer].vy*l:0,o=mt[this.layer].vx?mt[this.layer].vx*l:0;"function"==typeof n&&"continue"!==n.call(ot.dragged.parentNode[ae],o,t,e,ht,mt[this.layer].el)||te(mt[this.layer].el,o,t)}.bind({layer:d}),24))),d++}while(t.bubbleScroll&&p!==c&&(p=Z(p,!1)));ft=u}},30),St=function(e){var t=e.originalEvent,o=e.putSortable,a=e.dragEl,n=e.activeSortable,i=e.dispatchSortableEvent,s=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var l=o||n;s();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(c.clientX,c.clientY);r(),l&&!l.el.contains(u)&&(i("spill"),this.onSpill({dragEl:a,putSortable:o}))}};function wt(){}function xt(){}wt.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,o=e.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var a=j(this.sortable.el,this.startIndex,this.options);a?this.sortable.el.insertBefore(t,a):this.sortable.el.appendChild(t),this.sortable.animateAll(),o&&o.animateAll()},drop:St},$(wt,{pluginName:"revertOnSpill"}),xt.prototype={onSpill:function(e){var t=e.dragEl,o=e.putSortable||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:St},$(xt,{pluginName:"removeOnSpill"});ot.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?_(document,"dragover",this._handleAutoScroll):this.options.supportPointer?_(document,"pointermove",this._handleFallbackAutoScroll):t.touches?_(document,"touchmove",this._handleFallbackAutoScroll):_(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?O(document,"dragover",this._handleAutoScroll):(O(document,"pointermove",this._handleFallbackAutoScroll),O(document,"touchmove",this._handleFallbackAutoScroll),O(document,"mousemove",this._handleFallbackAutoScroll)),yt(),vt(),clearTimeout(z),z=void 0},nulling:function(){ht=ut=ct=ft=gt=dt=pt=null,mt.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var o=this,a=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,i=document.elementFromPoint(a,n);if(ht=e,t||this.options.forceAutoScrollFallback||k||N||M){bt(e,this.options,i,t);var s=Z(i,!0);!ft||gt&&a===dt&&n===pt||(gt&&yt(),gt=setInterval(function(){var i=Z(document.elementFromPoint(a,n),!0);i!==s&&(s=i,vt()),bt(e,o.options,i,t)},10),dt=a,pt=n)}else{if(!this.options.bubbleScroll||Z(i,!0)===U())return void vt();bt(e,this.options,Z(i,!1),!1)}}},$(e,{pluginName:"scroll",initializeByDefault:!0})}),ot.mount(xt,wt);const $t=ot;var Et=o(85643),Tt=o(73801);const Nt=n.AH`:host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.hidden{display:none}.type-block{overflow:hidden}.check-placeholder{width:32px;height:24px}.type-panel-msg{font-size:80%;margin:5px}.toggle-button{margin-top:2px}.toggle-div{padding-top:6px}.top-padding{padding-top:10px}.symbol-selector{background-color:#fff;display:flex;padding:9px;justify-content:space-between;align-items:center;border-radius:3px;cursor:pointer;transition:box-shadow .25s ease-in-out;box-shadow:0 0 0 1px #e0e0e0}.symbol-selector :last-child{margin-bottom:0;svg{fill:silver}}.symbol-selector :hover{box-shadow:0 0 0 1px silver;svg{fill:#404040}}.symbol-selector--selected,.symbol-selector--selected:hover{outline:1px solid var(--calcite-color-brand);svg{fill:#404040}}.symbol-is-white{background-color:#f3f3f3}.symbol-icon{min-width:26px;display:flex}.symbol-icon div{margin:auto}.symbol-icon.transparent{height:15px;width:100%}.symbol-icon.transparent svg{height:15px;width:95%;stroke:#e0e0e0;stroke-width:1px}.group-header{display:flex;padding:6px 0;justify-content:space-between;align-items:center;border-bottom:1px solid #e0e0e0}.group-heading{font-weight:700}.no-group-heading{color:#32323266;font-style:italic}.group{border:1px solid #e0e0e0;margin:5px 0}.group-text{padding:3px 9px 0;word-break:break-all}.group-text-active{cursor:pointer}.group-count{padding-top:7px}.group-count-no-menu{padding-right:3px}.values-items-only{padding:6px}.value{display:flex;padding:6px 0;justify-content:space-between;align-items:center}.value-part1{display:flex;width:-webkit-fill-available;width:-moz-available;align-items:center;margin:0 5px}.value-part2{display:flex}.group-handle,.class-handle{color:#32323266;cursor:grab;width:16px;display:flex}.group-handle-disabled,.class-handle-disabled{color:#e0e0e0;width:16px;display:flex}.value-symbol{margin:0 5px;padding:4px;cursor:pointer}.value-text{padding:0 9px;word-break:break-all;cursor:pointer}.value-count{padding:3px 3px 0}.menu-placeholder{width:32px}.value-handle-placeholder{min-width:16px}.other{border:1px solid #e0e0e0}.default-value{border-bottom:1px solid #e0e0e0}.other-value-text{cursor:default}.other-value-toggle{margin-left:22px;margin-right:2px}.symbol-styler-panel{width:328px;min-height:300px}.avatar{background-color:#f0efef}.value-text:focus,.group-text:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}`;class kt extends Tt.WF{constructor(){super(...arguments),this.doneButtonNode=(0,Et._)(),this.flowItemNode=(0,Et._)(),this.groupsDivNode=(0,Et._)(),this.othersDivNode=(0,Et._)(),this.groupMenuNodes=[],this.rotationNode=(0,Et._)(),this.groupInputNodes=[],this.groupTextNodes=[],this.valueInputNodes=[],this.valueTextNodes=[],this.symbolNodes=[],this.checkedClasses=[],this.classSortable=[],this.groupSortable=void 0,this.otherSortable=void 0,this.symbolStylerOpen=!1,this.dragRenderToggle=!0,this.smartMappingState=(0,m.u)(),this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.arcgisSmartMappingPanelsTypeBackClick=(0,Tt.lh)(),this.arcgisSmartMappingPanelsTypeClose=(0,Tt.lh)(),this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate=(0,Tt.lh)(),this.arcgisSmartMappingPanelsTypeError=(0,Tt.lh)(),this.smartMappingCompleteClose=(0,Tt.lh)()}static{this.properties={hideRotation:5,hideTransparency:5,menuOpen:5,showBackButton:5,selected:7,beforeBack:0}}static{this.styles=Nt}async setFocus(){await(this.flowItemNode.value?.setFocus())}async load(){const{layer:e,_messages:t}=this.smartMappingState,o=e,a=(0,h.g)(this.smartMappingState),n=(0,h.d)(this.smartMappingState),i=(0,h.p)(a,"spike");this.smartMappingState.lastDefault={defaultSymbol:a.defaultSymbol||(0,h.e)(this.smartMappingState),defaultLabel:a.defaultLabel||t.panels.type.other},this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in o&&o.featureReduction?s.clone(o.featureReduction):void 0,this.originalOrderBy="knowledge-graph-sublayer"!==o.type&&"subtype-sublayer"!==o.type?o.orderBy??void 0:void 0;try{const e=await(0,v.c)(this.smartMappingState,{fieldInfos:[{field:a.field,expression:a.valueExpression,expressionTitle:a.valueExpressionTitle}],typeScheme:(0,h.I)(this.smartMappingState,v.m)});if(((0,h.o)(this.smartMappingState)||i)&&"type-size"===n){let t=a.uniqueValueInfos?.length?a.uniqueValueInfos[0].symbol:(0,h.e)(this.smartMappingState);const o=(0,h.g)(this.smartMappingState),n=(0,h.p)(o,"reference-size");"simple-marker"!==t.type&&!n&&!i&&(t=new c.default),e.uniqueValueInfos.forEach(e=>{const o=s.clone(t);(0,h.y)(o,(0,h.i)(e.symbol)),e.symbol=o})}return void(this.smartMappingState.allUniqueValues=e.uniqueValueInfos)}catch(e){throw this.arcgisSmartMappingPanelsTypeError.emit({message:e,type:"error"}),new Error("Could not get unique values")}}async loaded(){requestAnimationFrame(async()=>await(this.flowItemNode.value?.setFocus())),this.scaleHandle=(0,g.w)(this.smartMappingState,this.flowItemNode.value,()=>this.smartMappingCompleteClose.emit("cancel"))}updated(){this.updateNodeHandles(!0,this.groupsDivNode.value),this.updateNodeHandles(!1,this.othersDivNode.value)}disconnectedCallback(){super.disconnectedCallback(),this.closePopovers(),this.scaleHandle?.remove()}updateNodeHandles(e,t){const{smartMappingState:o}=this;if(t){const a=(0,h.g)(o);e&&a.uniqueValueGroups.length&&(this.groupSortable?.destroy(),this.groupSortable=$t.create(t,{group:{name:"shared",pull:!0,put:!1},dataIdAttr:"group-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortGroups(),handle:".group-handle"})),queueMicrotask(()=>{let e=t.querySelectorAll(".group-content");e.forEach(e=>{const t=Number.parseInt(e.getAttribute("data-value"));this.classSortable?.[t]?.destroy(),this.classSortable[t]=$t.create(e,{group:{name:"nested",pull:!0,put:["nested"]},dataIdAttr:"class-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortClasses(t),handle:".class-handle"})}),e=t.querySelectorAll(".label-input"),e.forEach(e=>{const t=Number.parseInt(e.getAttribute("data-value"));this.groupInputNodes[t]=e}),e=t.querySelectorAll(".group-text"),e.forEach(e=>{const t=Number.parseInt(e.getAttribute("data-value"));this.groupTextNodes[t]=e}),e=t.querySelectorAll(".checkbox"),e.forEach(e=>{const t=e.getAttribute("data-value"),o=JSON.parse(t),{groupIdx:a,last:n}=o;-1===a&&n&&(this.lastOtherValueCheckNode=e)}),e=t.querySelectorAll(".group-dropdown"),e.forEach(e=>{const t=Number.parseInt(e.getAttribute("data-value"));this.groupMenuNodes[t]=e}),e=t.querySelectorAll(".symbol"),e.forEach(e=>{const t=JSON.parse(e.getAttribute("data-value")),{groupIdx:o,classIdx:a}=t;this.symbolNodes[o]||(this.symbolNodes[o]=[]),this.symbolNodes[o][a]=e,this.afterCreateValueSymbol(o,a,e)}),e=t.querySelectorAll(".value-input"),e.forEach(e=>{const t=JSON.parse(e.getAttribute("data-value")),{groupIdx:o,classIdx:a}=t;this.valueInputNodes[o]||(this.valueInputNodes[o]=[]),this.valueInputNodes[o][a]=e}),e=t.querySelectorAll(".value-text"),e.forEach(e=>{const t=JSON.parse(e.getAttribute("data-value")),{groupIdx:o,classIdx:a}=t;-1===o&&-1===a?this.otherTextNode=e:(this.valueTextNodes[o]||(this.valueTextNodes[o]=[]),this.valueTextNodes[o][a]=e)})})}}otherGroupDivRefHandler(e){e&&(this.otherSortable?.destroy(),this.otherSortable=$t.create(e,{group:{name:"shared",pull:!1,put:!0},filter:".nodrag",sort:!1}))}defaultMenuRefHandler(e){e&&(this.groupMenuNodes[-1]=e)}transparencyRefHandler(e){e&&(this.transparencyNode=e)}addActionsPopover(){const{smartMappingState:e}=this;this.closePopovers(),this.actionsPopoverNode=(0,Tt.dN)(n.qy`<arcgis-map-config-smart-mapping-type-actions-popover .smartMappingState=${e} .referenceNode=${this.flowItemNode.value} .checkedClasses=${this.checkedClasses} .groupMenuNodes=${this.groupMenuNodes} @arcgisSmartMappingTypeActionsPopoverChange=${e=>{e.detail?.checkedClasses&&(this.checkedClasses=e.detail.checkedClasses,e.detail.checkedClasses.length||this.removeActionsPopover()),this.requestUpdate(),this.checkCluster()}} @arcgisSmartMappingTypeActionsPopoverFocusExit=${t=>{t.preventDefault(),"bottom"===t.detail?"type"===(0,h.d)(e)?this.transparencyNode?.setFocus():this.doneButtonNode.value?.setFocus():"top"===t.detail&&(this.lastOtherValueCheckNode?this.lastOtherValueCheckNode.setFocus():this.otherTextNode.focus())}}></arcgis-map-config-smart-mapping-type-actions-popover>`),document.body.appendChild(this.actionsPopoverNode)}afterCreateValueSymbol(e,t,o){const{smartMappingState:a}=this,{lastDefault:n}=a;if(!o)return;const i=(0,h.g)(a),s=(0,h.p)(i,"reference-size"),r=(0,h.V)(s);let c;c=-1===e?i.defaultSymbol||n.defaultSymbol:i.uniqueValueGroups[e].classes[t].symbol.clone(),c&&l.renderPreviewHTML(c,{size:(0,h.ac)(c,r),symbolConfig:"cim"===c.type&&"CIMPolygonSymbol"===c.data.symbol.type?{isSquareFill:!0}:void 0}).then(e=>{r&&(e.style.display="block"),o.replaceChildren(e)})}checkCluster(){const{layer:e,useFeatureReduction:t}=this.smartMappingState;"featureReduction"in e&&t&&e.featureReduction&&this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate.emit()}closePopovers(){this.removeActionsPopover(),(0,h.f)()}getOtherCount(e){let t=0;return e.map(e=>t+=e.count),e.length?t:-1}getUniqueValue(e){const{allUniqueValues:t}=this.smartMappingState;if(!t)return null;const o=t.filter(t=>"<Null>"===e&&null===t.value||t.value==e);return o.length?o[0]:null}handleAddValue(e){const t=(0,Tt.dN)(n.qy`<arcgis-map-config-smart-mapping-type-add-value .smartMappingState=${this.smartMappingState} .groupIdx=${e} .flowItemNode=${this.flowItemNode.value} .referenceNode=${this.groupMenuNodes[e]} @arcgisSmartMappingTypeAddValuePopoverNewValue=${()=>{this.updateRendererAndUI(),this.checkCluster(),setTimeout(()=>{this.groupMenuNodes[e].setFocus()},300),t?.remove()}} @arcgisSmartMappingTypeAddValuePopoverClose=${()=>{setTimeout(()=>{this.groupMenuNodes[e].setFocus()},300),t?.remove()}}></arcgis-map-config-smart-mapping-type-add-value>`);document.body.appendChild(t)}handleCheck(e,t){const o=this.checkedClasses.findIndex(o=>o.groupIdx===e&&o.classIdx===t);o>-1?(this.checkedClasses.splice(o,1),this.actionsPopoverNode.checkedClasses=this.checkedClasses,this.actionsPopoverNode?.manager.component.requestUpdate(),this.checkedClasses.length||this.removeActionsPopover()):(this.checkedClasses=[...this.checkedClasses,{groupIdx:e,classIdx:t}],this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,this.actionsPopoverNode.manager.component.requestUpdate()):this.addActionsPopover()),this.requestUpdate()}handleDefaultCheckChange(){const{smartMappingState:e}=this,t=(0,h.g)(e);if(t.defaultSymbol)t.defaultSymbol=void 0,t.defaultLabel=void 0;else{const{lastDefault:e}=this.smartMappingState;t.defaultSymbol=e.defaultSymbol,t.defaultLabel=e.defaultLabel}this.updateRendererAndUI()}handleDrawingOrderToggle(e){const{smartMappingState:t}=this,{layer:o}=t,a=o,n=(0,h.g)(t);(0,h.f)(),n.orderByClassesEnabled=e,a.orderBy=e?void 0:this.originalOrderBy,this.updateRendererAndUI()}handleGroupMoveUp(e){this.closePopovers();const{smartMappingState:t}=this,o=(0,h.g)(t);if(e>0){const t=o.uniqueValueGroups,a=t.splice(e,1)[0];t.splice(e-1,0,a),o.uniqueValueGroups=t,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout(()=>{this.groupMenuNodes[e-1]?.setFocus()},300)}}handleGroupMoveDown(e){this.closePopovers();const{smartMappingState:t}=this,o=(0,h.g)(t),a=o.uniqueValueGroups;if(e<a.length-1){const t=o.uniqueValueGroups,a=t.splice(e,1)[0];t.splice(e+1,0,a),o.uniqueValueGroups=t,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout(()=>{this.groupMenuNodes[e+1]?.setFocus()},300)}}handleGroupTextChange(e,t){const{smartMappingState:o}=this,a=(0,h.g)(o),n=a.uniqueValueGroups;this.groupInputNodes[e].classList.add("hidden"),n[e].heading=t,a.uniqueValueGroups=n,this.selectedValueText=void 0,this.updateRendererAndUI(),this.groupTextNodes[e].classList.remove("hidden"),setTimeout(()=>this.groupTextNodes[e].focus(),300)}handleGroupTextClick(e){this.selectedValueText=`${e}`,this.groupTextNodes[e].classList.add("hidden"),this.groupInputNodes[e].classList.remove("hidden"),this.groupInputNodes[e].setFocus()}handleSelectAllValues(e){(0,h.f)();const{smartMappingState:t}=this,o=(0,h.g)(t);let a=0;o.uniqueValueGroups.forEach(e=>a+=e.classes?.length??0);const n=e>-1?o.uniqueValueGroups[e].classes:(0,v.a)(t);-1===e&&a+n.length>v.m&&(n.length=v.m-a),n.forEach((t,o)=>{this.checkedClasses.find(t=>t.groupIdx===e&&t.classIdx===o)||this.checkedClasses.push({groupIdx:e,classIdx:o})}),this.requestUpdate(),this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,this.actionsPopoverNode.manager.component.requestUpdate()):this.addActionsPopover()}handleSeparateValues(e){this.closePopovers(),this.separateGroupValues(e),this.updateRendererAndUI(),this.checkCluster()}handleSortClasses(e){const t=this.classSortable?.[e].toArray()||[],{smartMappingState:o}=this,a=(0,h.g)(o);this.closePopovers();const n=(0,v.a)(o).length;let i=0;a.uniqueValueGroups.forEach(e=>i+=e.classes?.length??0);const s=a.clone().uniqueValueGroups,r=[];s.forEach((o,a)=>{if(a===e){const e=new p.default({heading:o.heading,classes:[]});t.forEach(t=>{const[o,a]=t.split("/").map(e=>Number.parseInt(e));e.classes.push(s[o].classes[a])}),r.push(e)}else r.push(s[a])}),a.uniqueValueGroups=r.filter(e=>!!e.classes.length);const l=(0,v.a)(o).length;this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],n===l&&(this.dragRenderToggle=!this.dragRenderToggle),this.updateRendererAndUI(),this.checkCluster();let c=0;a.uniqueValueGroups.forEach(e=>c+=e.classes?.length??0),i!==c&&this.checkCluster()}handleSortGroups(){const{smartMappingState:e}=this,t=this.groupSortable?this.groupSortable.toArray():[],o=(0,h.g)(e);this.closePopovers();const a=o.uniqueValueGroups,n=[];t.forEach(e=>{n.push(a[Number.parseInt(e)])}),o.uniqueValueGroups=n,this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],this.updateRendererAndUI()}handleValueSymbolClick(e,t){this.symbolNodes[e][t].classList.remove("symbol-selector--selected"),this.symbolStylerOpen&&this.selectedValue===`${e}/${t}`?(this.selectedValue=void 0,this.selectedValueText=void 0,(0,h.f)(),this.symbolStylerOpen=!1):this.selectedValue!==`${e}/${t}`?this.openSymbolStylerForValue(e,t):(this.symbolNodes[e][t].classList.remove("symbol-selector--selected"),this.selectedValue=void 0,this.selectedValueText=void 0,(0,h.f)(),this.symbolStylerOpen=!1)}handleValueTextChange(e,t,o){const{smartMappingState:a}=this,{allUniqueValues:n,lastDefault:i,_messages:s}=a,l=(0,h.g)(a),c=l.uniqueValueGroups;if(this.valueInputNodes[e][t].classList.add("hidden"),c?.[e]?.classes?.[t].label!==o)if(o?.length||(o=-1===e?this.originalRendererJSON.defaultLabel||s.panels.type.other:n.find(o=>o.value===l.uniqueValueGroups?.[e].classes?.[t].values?.[0].value)?.label||l.uniqueValueGroups?.[e].classes?.[t].label),-1===e&&!l.defaultSymbol&&(i.defaultLabel=o),-1===e)l.defaultSymbol&&(l.defaultLabel=o||i.defaultLabel);else{const i=l.uniqueValueGroups,s=(0,h.K)(a,l.field);if(o)i[e].classes[t].label=o;else{const o=i[e].classes[t].values.map(e=>{const t=e.value,o=n?.find(e=>e.value===t)?.label;return o||(s?.simpleFieldType===h.J.DATE||"date-only"===(0,h.L)(a,s?.layerField)?(0,v.g)(a,t,s):s?.simpleFieldType===h.J.NUMBER?r.formatNumber(t):t)});i[e].classes[t].label=o.join(", ")}l.uniqueValueGroups=i}this.selectedValueText=void 0,this.updateRendererAndUI();const u=-1===e&&-1===t?this.otherTextNode:this.valueTextNodes[e][t];u.classList.remove("hidden"),u.focus()}handleValueTextClick(e,t){this.selectedValueText=`${e}/${t}`,(-1===e&&-1===t?this.otherTextNode:this.valueTextNodes[e][t])?.classList.add("hidden"),this.valueInputNodes[e][t]?.classList.remove("hidden"),this.valueInputNodes[e][t]?.setFocus()}onMouseOver(e,t,o){(0,y.r)(),(0,y.A)(t,o,e)}onMouseOut(e){(0,y.a)(e)}openSymbolStylerForGroup(e){const{smartMappingState:t}=this,{_messages:o}=t;(0,h.f)();const a=(0,Tt.dN)(n.qy`<arcgis-map-config-smart-mapping-symbol-styler-popover .referenceElement=${this.flowItemNode.value} .heading=${o.panels.type.symbolStyle} .smartMappingState=${t} @arcgisSmartMappingSymbolStylerPopoverClose=${()=>this.afterCloseSymbolStylerForGroup(e,a)} @arcgisSmartMappingSymbolStylerPopoverDisconnected=${()=>this.afterCloseSymbolStylerForGroup(e,a)}></arcgis-map-config-smart-mapping-symbol-styler-popover>`);document.body.appendChild(a),(0,f.b)(t,{groupIdx:e,symbolStylerPopoverNode:a,onChange:()=>{this.updateRendererAndUI()}})}afterCloseSymbolStylerForGroup(e,t){t.remove(),this.selectedValue=void 0,this.selectedValueText=void 0,setTimeout(()=>{this.groupMenuNodes[e]?.setFocus()},300)}openSymbolStylerForValue(e,t){const{smartMappingState:o}=this,{_messages:a}=o;(0,h.f)();const i=(0,Tt.dN)(n.qy`<arcgis-map-config-smart-mapping-symbol-styler-popover .referenceElement=${this.flowItemNode.value} .heading=${a.panels.type.symbolStyle} .smartMappingState=${o} @arcgisSmartMappingSymbolStylerPopoverClose=${()=>this.afterCloseSymbolStylerForValue(e,t,i)} @arcgisSmartMappingSymbolStylerPopoverDisconnected=${()=>this.afterCloseSymbolStylerForValue(e,t,i)}></arcgis-map-config-smart-mapping-symbol-styler-popover>`);document.body.appendChild(i),this.selectedValue=`${e}/${t}`,this.selectedValueText=void 0,(0,f.a)(o,{selectedValue:this.selectedValue,symbolStylerPopoverNode:i,onChange:()=>{this.updateRendererAndUI(),this.rotationNode.value&&this.rotationNode.value.manager.component.requestUpdate()}}),this.symbolStylerOpen=!0,this.symbolNodes[e][t].classList.add("symbol-selector--selected"),this.symbolNodes[e][t].focus()}afterCloseSymbolStylerForValue(e,t,o){const a=this.symbolNodes[e][t];this.selectedValue=void 0,this.selectedValueText=void 0,o.remove(),a.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,a.focus()}removeActionsPopover(){this.actionsPopoverNode?.remove(),this.actionsPopoverNode=void 0}separateGroupValues(e){const{smartMappingState:t}=this,o=(0,h.g)(t).uniqueValueGroups;(0,v.s)(t,o[e]),this.checkedClasses=[]}updateRendererAndUI(){const{smartMappingState:e}=this;(0,h.a4)(e),this.requestUpdate()}render(){const{smartMappingState:e}=this,{hideLayerTitle:t,layer:o,mapImageSublayer:a,_messages:i}=e,s=t?void 0:a?.title??o.title;return this.el.classList.add("calcite-match-height"),n.qy`<calcite-flow-item class="flow-item" .heading=${i.panels.type.styleOptions} .closable=${(0,h.aa)(this.el)} .showBackButton=${this.showBackButton} .selected=${this.selected} .description=${s} @calciteFlowItemBack=${e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsTypeBackClick.emit()}} ${(0,Et.K)(this.flowItemNode)}>${this.renderVisualizationContent()}${this.renderTransparency()}${this.renderRotation()}${this.renderDoneButton()}${this.renderCancelButton()}</calcite-flow-item>`}renderVisualizationContent(){const{smartMappingState:e}=this,{_messages:t}=e,o=!this.hideTransparency||!this.hideRotation,a=(0,h.g)(e),i=(0,h.K)(e,a.field),s=i?.simpleFieldType===h.J.DATE||"date-only"===(0,h.L)(e,i?.layerField);return n.qy`<calcite-block class="type-block" .heading=${s?t.panels.type.typeStyleDate:t.panels.type.typeStyle} .collapsible=${o} expanded>${this.renderTypesSymbol()}${this.renderDrawingOrder()}${this.renderGroups()}${this.renderBackgroundStyle()}</calcite-block>`}renderTypesSymbol(){const{smartMappingState:e}=this,{mapView:t}=e,o=(0,h.g)(e).uniqueValueGroups??[];if(!o?.length||!o[0].classes?.length)return"";const a=[];o.forEach(e=>e.classes.forEach(e=>a.push(e)));const i=d.getSchemes({basemap:t.map?.basemap,geometryType:(0,h.j)(e),numColors:a.length}),s=(0,h.k)(i,Math.min(a.length,10))[0].colors,r=a?.length?a.map((e,t)=>(0,h.i)(e.symbol)||new u.default(s[t%s.length])):[];return n.qy`<arcgis-map-config-smart-mapping-symbol-button ramp-type=discrete .colors=${r} type=type-ramp @arcgisSmartMappingSymbolButtonSymbolChange=${()=>{this.requestUpdate(),this.rotationNode.value&&this.rotationNode.value.manager.component.requestUpdate()}}></arcgis-map-config-smart-mapping-symbol-button>`}renderDrawingOrder(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:o,_messages:a}=e;if(o||"catalog-footprint"===t.type)return"";const i=(0,h.g)(e);return n.qy`<calcite-label class="toggle-div" layout=inline-space-between>${a.panels.type.drawingOrder}<calcite-switch class="toggle-button" .checked=${i.orderByClassesEnabled} @calciteSwitchChange=${e=>{const t=e.target;this.handleDrawingOrderToggle(t.checked)}}></calcite-switch></calcite-label>`}renderGroups(){const{smartMappingState:e}=this,{_messages:t}=e,o=(0,h.g)(e),a=!o.uniqueValueGroups?.length,i=o.field?(0,h.K)(e,o.field)?.label:o.valueExpressionTitle||t.expression,s=a?[this.renderNoGroup()]:o.uniqueValueGroups.map((e,t)=>this.renderGroup(e,t));return n.qy`<div class="top-padding"><calcite-label>${i}</calcite-label><div ${(0,Et.K)(this.groupsDivNode)}>${s}</div><div class="other" ${(0,Et.K)(this.othersDivNode)}><div class=${(0,Tt.CP)(s.length?"":"values-items-only")}>${this.renderDefaultValue()}</div>${this.renderOtherValues()}</div></div>`}renderNoGroup(){const{_messages:e}=this.smartMappingState;return n.qy`<div class="group"><div class="group-header"><div class="value-part1"><div class="group-handle-disabled" aria-hidden=true><calcite-icon scale=s icon=drag></calcite-icon></div><div class="group-text no-group-heading" role=button tabindex=0 .ariaLabel=${e.panels.type.accessibility.editLabelFor.replace("${value}",e.panels.type.groupNameHint)}>${e.panels.type.groupNameHint}</div></div><div class="value-part2">${this.renderGroupMenuNode(-2)}</div></div><div>&nbsp;</div></div>`}renderGroup(e,t){const o=e.classes.map((e,o)=>this.renderValue(e,t,o));return(0,i.D)(JSON.stringify(e.toJSON()),n.qy`<div class="group" group-sort-values=${`${t}`}><div class="group-header"><div class="value-part1">${this.renderGroupHandleNode(t)}${this.renderGroupTextNode(e,t)}</div><div class="value-part2">${this.renderGroupCountNode(e)}${this.renderGroupMenuNode(t,e)}</div></div><div class="group-content" data-value=${t??Tt.s6}>${o}</div></div>`)}renderGroupHandleNode(e){const{_messages:t}=this.smartMappingState,o=this.selectedValueText===`${e}`;return n.qy`<div class=${(0,Tt.CP)(o?"group-handle-disabled":"group-handle")} aria-hidden=true @mouseover=${a=>{const n=a.currentTarget;o||this.onMouseOver(`values-${e}-handle-tooltip`,n,t.panels.type.tooltips.dragGroup)}} @mouseout=${()=>this.onMouseOut(`values-${e}-handle-tooltip`)}><calcite-icon scale=s icon=drag></calcite-icon></div>`}renderGroupTextNode(e,t){const{_messages:o}=this.smartMappingState;let a=!1;return n.qy`<calcite-input class="hidden label-input" .value=${e.heading||""} data-value=${t??Tt.s6} @calciteInputChange=${e=>{if(!a){a=!0;const o=e.currentTarget;this.handleGroupTextChange(t,o.value)}}} @keydown=${e=>{if(("Escape"===e.key||"Enter"===e.key)&&!a){e.preventDefault(),e.stopPropagation(),a=!0;const o=e.currentTarget;this.handleGroupTextChange(t,o.value)}}} @focusout=${e=>{if(!a){a=!0;const o=e.currentTarget;this.handleGroupTextChange(t,o.value)}}}></calcite-input><div class=${"group-text group-text-active "+(e.heading?"group-heading":"no-group-heading")} role=button tabindex=0 .ariaLabel=${o.panels.type.accessibility.editLabelFor.replace("${value}",e.heading||o.panels.type.groupNameHint)} data-value=${t??Tt.s6} @click=${()=>{this.onMouseOut(`group-${t}-text-tooltip`),this.handleGroupTextClick(t)}} @mouseover=${e=>{const a=e.currentTarget;this.onMouseOver(`group-${t}-text-tooltip`,a,o.panels.type.tooltips.renameGroup)}} @mouseout=${()=>this.onMouseOut(`group-${t}-text-tooltip`)} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),this.handleGroupTextClick(t))}}>${e.heading||o.panels.type.groupNameHint}</div>`}renderValue(e,t,o){return n.qy`<div class="value" class-sort-values=${`${t}/${o}`}><div class="value-part1">${this.renderHandleNode(t,o)}${this.renderCheckNode(t,o)}${this.renderSymbolNode(e,t,o)}${this.renderTextNode(e,t,o)}</div><div class="value-part2">${this.renderCountNode(e)}</div></div>`}renderHandleNode(e,t){const{_messages:o}=this.smartMappingState,a=this.selectedValueText===`${e}/${t}`;return n.qy`<div class=${(0,Tt.CP)(a?"class-handle-disabled":"class-handle")} aria-hidden=true @mouseover=${a=>{const n=a.currentTarget;this.onMouseOver(`values-${e}-${t}-handle-tooltip`,n,o.panels.type.tooltips.dragType)}} @mouseout=${()=>this.onMouseOut(`values-${e}-${t}-handle-tooltip`)}><calcite-icon scale=s icon=drag></calcite-icon></div>`}renderCheckNode(e,t,o){const{_messages:a}=this.smartMappingState,i=!!this.checkedClasses.find(o=>o.groupIdx===e&&o.classIdx===t);return n.qy`<calcite-action class="checkbox" scale=s .icon=${i?"check-square":"square"} .text=${a.panels.type.checkValue} appearance=transparent data-value=${JSON.stringify({groupIdx:e,last:o})??Tt.s6} @click=${()=>this.handleCheck(e,t)} @keydown=${t=>{-1===e&&o&&!t.shiftKey&&"Tab"===t.key&&(t.preventDefault(),this.actionsPopoverNode?.focusActionPad())}}></calcite-action>`}renderSymbolNode(e,t,o){const{smartMappingState:a}=this,{_messages:i}=a,s={"value-symbol":!0,"symbol-is-white":(0,h.ad)(e.symbol)},r={symbol:!0,[(0,h.j)(a)]:!0,"symbol-selector--selected":this.selectedValue===`${t}/${o}`};return n.qy`<div class=${(0,Tt.CP)(s)} @click=${()=>this.handleValueSymbolClick(t,o)} role=button .ariaLabel=${i.panels.type.accessibility.editSymbolFor.replace("${value}",e.label)} aria-haspopup=true .ariaExpanded=${this.selectedValue===`${t}/${o}`} @mouseover=${e=>{const a=e.currentTarget;this.onMouseOver(`values-${t}-${o}-icon-tooltip`,a,i.panels.type.tooltips.changeSymbol)}} @mouseout=${()=>this.onMouseOut(`values-${t}-${o}-icon-tooltip`)} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t,o))}}><div class=${(0,Tt.CP)(r)} tabindex=0 aria-hidden=true data-value=${JSON.stringify({groupIdx:t,classIdx:o})??Tt.s6}></div></div>`}renderTextNode(e,t,o){const{smartMappingState:a}=this,{_messages:i}=a;let s=!1;return n.qy`<calcite-input class="value-input hidden" .value=${e.label??void 0} data-value=${JSON.stringify({groupIdx:t,classIdx:o})??Tt.s6} @calciteInputChange=${e=>{if(!s){s=!0;const a=e.currentTarget;this.handleValueTextChange(t,o,a.value)}}} @keydown=${e=>{if(("Escape"===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),!s)){s=!0;const a=e.currentTarget;this.handleValueTextChange(t,o,a.value)}}} @focusout=${e=>{if(!s){s=!0;const a=e.currentTarget;this.handleValueTextChange(t,o,a.value)}}}></calcite-input><div class="value-text value-label" role=button tabindex=0 .ariaLabel=${i.panels.type.accessibility.editLabelFor.replace("${value}",e.label)} data-value=${JSON.stringify({groupIdx:t,classIdx:o})??Tt.s6} @click=${()=>{this.onMouseOut(`value-${t}-${o}-text-tooltip`),this.handleValueTextClick(t,o)}} @mouseover=${e=>{const a=e.currentTarget;this.onMouseOver(`value-${t}-${o}-text-tooltip`,a,i.panels.type.tooltips.renameType)}} @mouseout=${()=>this.onMouseOut(`value-${t}-${o}-text-tooltip`)} @keydown=${e=>{if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleValueTextClick(t,o);else if(!e.shiftKey&&"Tab"===e.key&&-1===t){const t=(0,h.g)(a),o=(0,v.b)(a);let n=0;t.uniqueValueGroups.forEach(e=>n+=e.classes.length),o?.length&&(1!==o.length||o[0].value)&&n<v.m||(e.preventDefault(),this.actionsPopoverNode.focusActionPad())}}}>${e.label?.trim().length?e.label:"\xa0\xa0\xa0\xa0\xa0\xa0"}</div>`}renderCountNode(e){const{allUniqueValues:t,_messages:o}=this.smartMappingState;if(!t?.length)return"";let a;if(e.values.length>1)a=e.values.reduce((e,t)=>e+(this.getUniqueValue(t.value)?.count||0),0);else{const o=e.values[0].value,n=this.getUniqueValue(o);if(n&&!(0,h.V)(n.count))return"";if(!n&&t?.length){const e=this.getUniqueValue(t[0].value);if(!(0,h.V)(e?.count))return""}a=n?n.count:0}return n.qy`<div class="value-count" .ariaLabel=${o.panels.type.accessibility.countFor.replace("${value}",e.label)}>${`${a}`}</div>`}renderGroupCountNode(e){const{allUniqueValues:t,_messages:o}=this.smartMappingState;if(!t?.length)return"";let a=0;return e.classes.forEach(e=>{e.values.forEach(e=>{const o=this.getUniqueValue(e.value);if(!o||(0,h.V)(o.count)){if(!o&&t?.length){const e=this.getUniqueValue(t[0].value);if(!(0,h.V)(e?.count))return}a+=o?.count??0}})}),n.qy`<div class="group-count" .ariaLabel=${o.panels.type.accessibility.countFor.replace("${value}",e.heading)}>${`${t?a:""}`}</div>`}renderGroupMenuNode(e,t){const{smartMappingState:o}=this,{_messages:a}=o,i=(0,h.g)(o),s=i.uniqueValueGroups;let r,l,c=!1;if(-1===e){l=(0,v.a)(o);let e=0;i.uniqueValueGroups.forEach(t=>e+=t.classes?.length??0),e+l.length>v.m&&(l=l.slice(0,v.m-e)),r=!!l.find((e,t)=>!this.checkedClasses.find(e=>-1===e.groupIdx&&e.classIdx===t))}else r=!!t?.classes?.find((t,o)=>!this.checkedClasses.find(t=>t.groupIdx===e&&t.classIdx===o)),c=!!t?.classes?.find(e=>e.values.length>1);return n.qy`<calcite-dropdown class="group-dropdown" placement=bottom-end scale=s overlay-positioning=fixed data-value=${e??Tt.s6}><calcite-action slot=trigger scale=s .text=${a.panels.type.tooltips.options}><calcite-icon scale=s icon=ellipsis></calcite-icon></calcite-action><calcite-dropdown-group selection-mode=none><calcite-dropdown-item icon-start=pin-plus .label=${a.panels.type.addValue} @click=${()=>this.handleAddValue(e)} @keydown=${t=>{t.stopPropagation(),(" "===t.key||"Enter"===t.key)&&this.handleAddValue(e)}}>${a.panels.type.addValue}</calcite-dropdown-item>${s.length>0&&n.qy`<calcite-dropdown-item icon-start=palette .label=${a.panels.type.changeColors} @click=${()=>this.openSymbolStylerForGroup(e)} @keydown=${t=>{t.stopPropagation(),(" "===t.key||"Enter"===t.key)&&this.openSymbolStylerForGroup(e)}}>${a.panels.type.changeColors}</calcite-dropdown-item>`||""}</calcite-dropdown-group><calcite-dropdown-group selection-mode=none>${r&&n.qy`<calcite-dropdown-item icon-start=check-circle .label=${a.panels.type.selectAllValues} @click=${()=>this.handleSelectAllValues(e)} @keydown=${t=>{t.stopPropagation(),(" "===t.key||"Enter"===t.key)&&this.handleSelectAllValues(e)}}>${a.panels.type.selectAllValues}</calcite-dropdown-item>`||""}${c&&n.qy`<calcite-dropdown-item icon-start=group-x .label=${a.panels.type.separateValues} @click=${()=>this.handleSeparateValues(e)} @keydown=${t=>{t.stopPropagation(),(" "===t.key||"Enter"===t.key)&&this.handleSeparateValues(e)}}>${a.panels.type.separateValues}</calcite-dropdown-item>`||""}${e>0&&n.qy`<calcite-dropdown-item icon-start=arrow-bold-up .label=${a.panels.type.moveUp} @click=${()=>this.handleGroupMoveUp(e)} @keydown=${t=>{t.stopPropagation(),(" "===t.key||"Enter"===t.key)&&this.handleGroupMoveUp(e)}}>${a.panels.type.moveUp}</calcite-dropdown-item>`||""}${s.length>0&&e<s.length-1&&n.qy`<calcite-dropdown-item icon-start=arrow-bold-down .label=${a.panels.type.moveDown} @click=${()=>this.handleGroupMoveDown(e)} @keydown=${t=>{t.stopPropagation(),(" "===t.key||"Enter"===t.key)&&this.handleGroupMoveDown(e)}}>${a.panels.type.moveDown}</calcite-dropdown-item>`||""}</calcite-dropdown-group></calcite-dropdown>`}renderDefaultValue(){const{smartMappingState:e}=this,{lastDefault:t,_messages:o}=e,a=(0,h.g)(e),s=a.defaultSymbol||t.defaultSymbol,r=a.defaultLabel||t.defaultLabel,l=(0,v.b)(e),c=l?this.getOtherCount(l):-1;let u=0;a.uniqueValueGroups.forEach(e=>u+=e.classes.length);const d=!!l?.length&&u<v.m,p=d&&1===l.length&&!l[0].value,g={"value-symbol":!0,"symbol-is-white":(0,h.ad)(s)},m={symbol:!0,[(0,h.j)(e)]:!0,"symbol-selector--selected":"-1"===this.selectedValue};return n.qy`<div class=${"value "+(d?"default-value":"")}><div class="value-part1">${(0,i.D)(!!a.defaultSymbol,n.qy`<calcite-switch class="other-value-toggle" .checked=${!!a.defaultSymbol} @mouseover=${e=>{const t=e.currentTarget;this.onMouseOver("default-value-checkbox-tooltip",t,o.panels.type.tooltips.otherTooltip)}} @mouseout=${()=>this.onMouseOut("default-value-checkbox-tooltip")} @click=${()=>this.handleDefaultCheckChange()} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&this.handleDefaultCheckChange()}}></calcite-switch>`)}<div class=${(0,Tt.CP)(g)} @click=${()=>this.handleValueSymbolClick(-1,0)} role=button aria-haspopup=true .ariaExpanded=${"-1/0"===this.selectedValue} .ariaLabel=${o.panels.type.accessibility.editSymbolFor.replace("${fieldName}",r)} @mouseover=${e=>{const t=e.currentTarget;this.onMouseOver("default-value-symbol-tooltip",t,o.panels.type.tooltips.changeSymbol)}} @mouseout=${()=>this.onMouseOut("default-value-symbol-tooltip")} @keydown=${e=>{(" "===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(-1,0))}}><div class=${(0,Tt.CP)(m)} tabindex=0 data-value=${JSON.stringify({groupIdx:-1,classIdx:0})??Tt.s6} aria-hidden=true></div></div>${this.renderTextNode({symbol:s,label:r},-1,-1)}</div><div class="value-part2">${c>-1?n.qy`<div class=${`group-count ${(!d||p)&&"group-count-no-menu"}`} .ariaLabel=${o.panels.type.accessibility.countFor.replace("${value}",r)}>${`${c}`}</div>`:null}${d&&!p&&this.renderDefaultMenuNode()||""}</div></div>`}renderDefaultMenuNode(){const{_messages:e}=this.smartMappingState;return n.qy`<calcite-dropdown placement=bottom-end scale=s overlay-positioning=fixed ${(0,Et.K)(this.defaultMenuRefHandler)}><calcite-action slot=trigger scale=s .text=${e.panels.type.tooltips.options}><calcite-icon scale=s icon=ellipsis></calcite-icon></calcite-action><calcite-dropdown-group selection-mode=none><calcite-dropdown-item icon-start=check-circle .label=${e.panels.type.selectAllValues} @click=${()=>this.handleSelectAllValues(-1)} @keydown=${e=>{e.stopPropagation(),(" "===e.key||"Enter"===e.key)&&this.handleSelectAllValues(-1)}}>${e.panels.type.selectAllValues}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown>`}renderOtherValues(){const{dragRenderToggle:e,smartMappingState:t}=this,{allUniqueValues:o}=t,a=(0,h.g)(t);o?.length||n.qy`<div ${(0,Et.K)(this.otherGroupDivRefHandler)}>${this.renderMsg()}</div>`;let s=(0,v.a)(t),r=0;a.uniqueValueGroups.forEach(e=>r+=e.classes?.length??0),r+s.length>v.m&&(s=s.slice(0,v.m-r));const l=s.map((e,t)=>this.renderOtherValue(e,t,t===s.length-1));return(0,i.D)(`${e}${JSON.stringify(s.map(e=>e.toJSON()))}`,n.qy`<div ${(0,Et.K)(this.otherGroupDivRefHandler)}>${l}${this.renderMsg()}</div>`)}renderOtherValue(e,t,o){const{_messages:a}=this.smartMappingState;return n.qy`<div class="value nodrag"><div class="value-part1"><div class="value-handle-placeholder">&nbsp;</div>${(0,h.V)(e.values[0].value)?this.renderCheckNode(-1,t,o):n.qy`<div class="check-placeholder">&nbsp;</div>`}<div class="value-text other-value-text" .ariaLabel=${e.label??void 0} data-value=${JSON.stringify({groupIdx:-1,classIdx:t})??Tt.s6}>${null===e.values[0].value?a.panels.type.noData:e.label}</div></div><div class="value-part2">${this.renderCountNode(e)}</div></div>`}renderMsg(){const{smartMappingState:e}=this,{allUniqueValues:t,lastDefault:o,_messages:a}=e,i=(0,h.g)(e);return t&&t.length>v.m?n.qy`<div class="type-panel-msg">${a.panels.type.errors.tooManyValues.replace("${count}",v.m.toString())}</div>`:i.uniqueValueInfos.length||t?.length?"":n.qy`<div class="type-panel-msg">${a.panels.type.errors.noFeatures.replace("${other}",o.defaultLabel)}</div>`}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return"type-size"!==(0,h.d)(e)||t?"":n.qy`<arcgis-map-config-smart-mapping-background-symbol></arcgis-map-config-smart-mapping-background-symbol>`}renderTransparency(){if(this.hideTransparency)return"";const{smartMappingState:e}=this,t=(0,h.c)((0,h.g)(e),"opacity");return n.qy`<arcgis-map-config-smart-mapping-transparency .open=${!!t} @arcgisSmartMappingSymbolTransparencyError=${({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e)} @keydown=${t=>{"type"===(0,h.d)(e)&&t.shiftKey&&"Tab"===t.key&&(t.preventDefault(),this.actionsPopoverNode.focusLastAction())}} ${(0,Et.K)(this.transparencyRefHandler)}></arcgis-map-config-smart-mapping-transparency>`}renderRotation(){if(this.hideRotation)return"";const{smartMappingState:e}=this,t=(0,h.c)((0,h.g)(e),"opacity"),o=(0,h.c)((0,h.g)(e),"rotation");return n.qy`<arcgis-map-config-smart-mapping-rotation .open=${!t&&!!o} @arcgisSmartMappingRotationError=${({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e)} ${(0,Et.K)(this.rotationNode)}></arcgis-map-config-smart-mapping-rotation>`}renderDoneButton(){const{smartMappingState:e}=this,{_messages:t}=e;return n.qy`<calcite-button slot=footer .label=${t.done} @click=${()=>this.arcgisSmartMappingPanelsTypeClose.emit("save")} appearance=solid width=half @keydown=${t=>{"type-size"===(0,h.d)(e)&&t.shiftKey&&"Tab"===t.key&&(t.preventDefault(),this.actionsPopoverNode.focusLastAction())}} ${(0,Et.K)(this.doneButtonNode)}>${t.done}</calcite-button>`}renderCancelButton(){const{smartMappingState:e}=this,{_messages:t}=e;return n.qy`<calcite-button slot=footer .label=${t.cancel} @click=${()=>{const{layer:t}=e,o=t,{originalRendererJSON:a,originalFeatureReduction:n,originalOrderBy:i}=this;this.closePopovers(),"catalog-footprint"!==o.type&&"knowledge-graph-sublayer"!==o.type&&(o.orderBy=i),(0,h.a8)(e,a,n),this.arcgisSmartMappingPanelsTypeClose.emit("cancel")}} appearance=outline-fill width=half>${t.cancel}</calcite-button>`}}(0,a.c)("arcgis-map-config-smart-mapping-panels-type",kt)},32173:(e,t,o)=>{o.d(t,{A:()=>i,a:()=>l,b:()=>s,r:()=>r});var a=o(4395),n=o(73801);function i(e,t,o,i=!0){const s=document.getElementById(o);s&&s.remove();const r=(0,n.dN)(a.qy`<calcite-tooltip class="smart-mapping-tooltip" id=${o??n.s6} .referenceElement=${e} .open=${i} .innerHTML=${t??""}></calcite-tooltip>`);document.body.append(r)}function s(e,t,o=!0,i){const s=(0,n.dN)(a.qy`<calcite-tooltip class="smart-mapping-tooltip" .referenceElement=${e} .open=${o} .placement=${i??"auto"} .innerHTML=${t??""}></calcite-tooltip>`);document.body.append(s)}function r(){document.querySelectorAll(".smart-mapping-tooltip").forEach(e=>e.remove())}function l(e){const t=document.getElementById(e);"smart-mapping-tooltip"===t?.className&&t.remove()}},46317:(e,t,o)=>{o.d(t,{D:()=>s});var a=o(85282),n=o(34670),i=o(42466);const s=(0,n.u$)(class extends n.WL{constructor(){super(...arguments),this.key=a.s6}render(e,t){return this.key=e,t}update(e,[t,o]){return t!==this.key&&((0,i.mY)(e),this.key=t),o}})},65595:(e,t,o)=>{o.d(t,{c:()=>s,u:()=>r});var a=o(20936),n=o(1225),i=(o(54312),o(44345),o(55448),o(52797),o(34031),o(63438),o(5933),o(28927),o(83368),o(89704),o(5294),o(18423),o(96086),o(91813),o(21255),o(13078),o(21303),o(12627),o(56451),o(31521),o(23054),o(5077),o(23795),o(17902),o(87420),o(30161),o(81734),o(75698),o(10628),o(59640),o(64451),o(6176),o(83552));o(77462),o(49403),o(10281),o(83930),o(66617),o(10454),o(29614),o(94916),o(52554),o(2156),o(4038),o(49851),o(75054),o(15223),o(70169),o(47207),o(70852),o(48103),o(39423),o(85681),o(18444),o(42411),o(9767),o(38218),o(91914),o(86605),o(68196),o(440),o(46547),o(6238),o(7299);function s(e){e.selectedFields=[],e.layerFields=void 0,e.fields=void 0,e.hideLayerTitle=!1,e.supportsArcade=!1,e.stringFieldsCount=-1,e.dateFieldsCount=-1,e.numberFieldsCount=-1,e.containsFlow=!0,e.oneFeatureResponseStatus=n.s.MISSING,e.selectedAttribute=void 0,e.selectedAttributeText=void 0,e.selectedTypeValue=void 0,e.selectedValue=void 0,e.lastDefault=void 0,e.lastDefaults=void 0,e.dotColorSelected=void 0,e.backgroundStyleSelected=void 0,e.lastSettings=void 0,e.classedSymbolSelectedIdx=void 0,e.allUniqueValues=void 0,e.useFeatureReduction=void 0,e.symbolStylerConfig={},e.allowTimeSeriesConfiguration=!1,e.rasterInfo=void 0}function r(){const e=(0,i.Gk)(),t=e;e.manager.onLoad(()=>{t.smartMappingState=function(e,t){const o=l.get(e);if(o)return o;const n=(0,a.el)(e,t);return n&&"store"in n?(l.set(e,n.store),n.store):null}(e.el,"arcgis-map-config-smart-mapping")})}const l=new WeakMap},89989:(e,t,o)=>{o.d(t,{w:()=>i});var a=o(54312),n=o(1225);o(44345),o(55448),o(52797),o(34031),o(63438),o(5933),o(28927),o(83368),o(89704),o(5294),o(18423),o(96086),o(91813),o(21255),o(13078),o(21303),o(12627),o(56451),o(31521),o(23054),o(5077),o(23795),o(17902),o(87420),o(30161),o(81734),o(75698),o(10628),o(59640),o(64451),o(6176),o(83552),o(77462),o(49403),o(10281),o(83930),o(66617),o(10454),o(29614),o(94916),o(52554),o(2156),o(4038),o(49851),o(75054),o(15223),o(70169),o(47207),o(70852),o(48103),o(39423),o(85681),o(18444),o(42411),o(9767),o(38218),o(91914),o(86605),o(68196),o(440),o(46547),o(6238),o(7299);function i(e,t,o){const{layer:i,mapView:r,useFeatureReduction:l}=e;return l&&"featureReduction"in i&&"binning"===i.featureReduction.type?a.watch(()=>r.scale,()=>{const a=i.featureReduction;r.scale<=a.maxScale&&!t.disabled?((0,n.f)(),function(e,t,o){const a=document.createElement("arcgis-map-config-smart-mapping-scale-alert-popover");a.smartMappingState=e,a.refElement=t,a.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",()=>{s(),o()}),document.body.append(a)}(e,t,o),(0,n.h)(t,!0)):r.scale>a.maxScale&&t.disabled&&(s(),(0,n.h)(t,!1),t.setFocus())}):void 0}function s(){document.querySelectorAll("arcgis-map-config-smart-mapping-scale-alert-popover").forEach(e=>e.remove())}},92264:(e,t,o)=>{o.d(t,{a:()=>v,b:()=>y,c:()=>h,d:()=>g,e:()=>S,f:()=>b,g:()=>f,m:()=>p,s:()=>w});var a=o(5294),n=o(52797),i=o(56451),s=o(47207),r=o(70852),l=o(48103),c=o(39423),u=o(1225),d=(o(54312),o(44345),o(55448),o(34031),o(63438),o(5933),o(89704),o(66228));o(31521),o(23054),o(5077),o(23795),o(17902),o(87420),o(30161),o(81734),o(83552),o(77462),o(49403),o(66617),o(10628),o(59640),o(64451),o(6176),o(10454),o(29614),o(94916),o(52554),o(2156),o(4038),o(49851),o(75054),o(15223),o(70169),o(85681),o(18444),o(42411),o(9767),o(38218),o(91914),o(86605),o(68196),o(440),o(46547),o(28927),o(6238),o(7299);const p=500;async function h(e,t){const{layer:o,useFeatureReduction:a,mapImageSublayer:n,mapView:i}=e,r=o;t=t||{};const l=(0,u.a)(e,(0,u.g)(e)),c=t.fieldInfos[0];return await s.createRenderer({layer:r,view:i,field:c.field,valueExpression:c.expression,valueExpressionTitle:c.expressionTitle,numTypes:t.numTypes||10,sortBy:t.sortBy||"count",typeScheme:t.typeScheme||(0,u.I)(e,p),returnAllCodedValues:!0,outlineOptimizationEnabled:!n&&(!(0,d.i)(t.outlineOptimizationEnabled)||t.outlineOptimizationEnabled),sizeOptimizationEnabled:!n&&(!(0,d.i)(t.sizeOptimizationEnabled)||t.sizeOptimizationEnabled),legendOptions:t.legendOptions,defaultSymbolEnabled:!0,forBinning:a}).then(o=>{if(o.excludedUniqueValueInfos.length||(o.renderer.defaultLabel=void 0,o.renderer.defaultSymbol=void 0),S(e,t)){const t=(0,u.g)(e).clone(),a=(0,u.c)(t,"size","auto"),n=(0,u.c)(t,"size","outline"),i=(0,u.p)(t,"spike");if(o.renderer.visualVariables=[],a&&(o.renderer.visualVariables=o.renderer.visualVariables||[],o.renderer.visualVariables.push(a)),n&&(o.renderer.visualVariables=o.renderer.visualVariables||[],o.renderer.visualVariables.push(n)),o.renderer.uniqueValueInfos=t.uniqueValueInfos,o.renderer.field2=t.field2,o.renderer.field3=t.field3,((0,u.o)(e)||i)&&"type-size"===(0,u.d)(e)){const t=(0,u.e)(e),a=o.renderer.uniqueValueInfos?.slice();a?.forEach(e=>{const o=(0,u.i)(e.symbol);e.symbol=t.clone(),(0,u.y)(e.symbol,o)}),o.renderer.uniqueValueInfos=a}}return(0,u.b)(l,o.renderer),o})}async function g(e,t){const{layer:o,useFeatureReduction:a,mapImageSublayer:n,mapView:i}=e,r=o,l=(t=t||[]).fieldInfos?t.fieldInfos[0]:null,c=(0,u.g)(e),h=(0,u.a)(e,c),g=c.uniqueValueInfos?.length?c.uniqueValueInfos[0].symbol:null,m=c.defaultSymbol,f=c.defaultLabel,v=l&&(l.field!==c.field||l.expression!==c.valueExpression);return t=t||{},await s.createRenderer({layer:r,view:i,field:l?l.field:c.field,valueExpression:l?l.expression:c.valueExpression,valueExpressionTitle:l?l.expressionTitle:c.valueExpressionTitle,numTypes:t.numTypes||(v?10:c.uniqueValueInfos.length),sortBy:t.sortBy||"count",typeScheme:(0,u.I)(e,p),outlineOptimizationEnabled:!n&&((0,d.i)(t.outlineOptimizationEnabled)?t.outlineOptimizationEnabled:!!h.sizeOutlineVisVar),sizeOptimizationEnabled:!n&&((0,d.i)(t.sizeOptimizationEnabled)?t.sizeOptimizationEnabled:!!h.sizeAutoVisVar),legendOptions:t.legendOptions||c.legendOptions,defaultSymbolEnabled:(0,d.i)(t.defaultSymbolEnabled)||!!c.defaultSymbol,forBinning:a}).then(e=>{if((0,u.b)(h,e.renderer),g&&e.renderer.uniqueValueInfos?.length){const t=e.renderer.uniqueValueInfos.slice();t.forEach(e=>{const t=g.clone();(0,u.y)(t,(0,u.i)(e.symbol)),e.symbol=t}),e.renderer.uniqueValueInfos=t}return m&&(e.renderer.defaultSymbol=m,e.renderer.defaultLabel=f),e})}const m={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};function f(e,t,o){const{allUniqueValues:a,mapView:i}=e;if(o?.simpleFieldType===u.J.DATE){let e;a&&(e=r.calculateDateFormatInterval(a.map(e=>e.value)));const o=new Date(t);if("unknown"===i.timeZone)return n.formatDate(o,{...n.convertDateFormatToIntlOptions(e?m[e]:"long-month-day-year"),timeZone:"utc",timeZoneName:"shortOffset"});{const t=new Date(o.getTime()+6e4*o.getTimezoneOffset());return n.formatDate(t,{...n.convertDateFormatToIntlOptions(e?m[e]:"long-month-day-year"),timeZone:i.timeZone})}}return n.formatDateOnly(t,n.convertDateFormatToIntlOptions("long-month-day-year"))}function v(e){const{allUniqueValues:t}=e,o=(0,u.g)(e);if(!t?.length||!(0,d.i)(t[0].count))return[];let a=[];return o.uniqueValueGroups.forEach(e=>{const t=[];e.classes?.forEach(e=>e.values?.forEach(e=>t.push(`${e.value}`))),a=a.concat(t)}),t.filter(e=>!a.includes(null===e.value?"<Null>":`${e.value}`)).map(e=>new c.default({label:e.label,symbol:e.symbol,values:[{value:e.value}]}))}function y(e){const{allUniqueValues:t}=e,o=(0,u.g)(e);if(!t?.length||!(0,d.i)(t[0].count))return[];let a=[];return o.uniqueValueGroups.forEach(e=>{const t=[];e.classes.forEach(e=>e.values.forEach(e=>t.push("<Null>"===e.value?"null":`${e.value}`))),a=a.concat(t)}),t.filter(e=>!a.includes(`${e.value}`))}function b(e,t){const{_messages:o}=e;let a=1,n=o.panels.type.defaultGroupName.replace("${number}",a.toString());for(;t.find(e=>e.heading===n);)n=o.panels.type.defaultGroupName.replace("${number}",(++a).toString());return n}function S(e,t){if(["type","type-size"].includes((0,u.d)(e))){const o=(0,u.g)(e),a={field:o.field,expression:o.valueExpression,expressionTitle:o.valueExpressionTitle};if((0,u.N)(t.fieldInfos[0],a))return!0}return!1}function w(e,t,o){const s=(0,u.g)(e),r=(0,u.K)(e,s.field),d=r&&["small-integer","integer","big-integer","long"].includes((0,u.L)(e,r.layerField)),p=r?.simpleFieldType===u.J.DATE,h="date-only"===(0,u.L)(e,r?.layerField),g=[],m=(0,u.I)(e);let v=0;t.classes.forEach((s,y)=>{if(1===s.values.length||o&&!o.includes(y))g.push(s),v++;else if(!o||o.includes(y)){const o=s.symbol?.type,y=null!=o&&["simple-marker","simple-line","simple-fill","cim"].includes(o)?s.symbol:(0,u.e)(e,(0,u.d)(e));s.values.forEach((o,s)=>{const b=a.clone(y);if(s>0)if(m){const e=m.colors[(t.classes.length+v)%m.colors.length];e&&(0,u.y)(b,e)}else{const o=(0,u.M)(e).colors,a=new i.default(o[(t.classes.length+v)%10]);a&&(0,u.y)(b,a)}const S=r?.layerField?.domain,w=S?S.codedValues?.find(e=>e.code===o.value):null,x=w?w.name:p||h?f(e,o.value,r):r?.simpleFieldType===u.J.NUMBER?n.formatNumber(d?Number.parseInt(o.value):Number.parseFloat(o.value)):o.value;g.push(new c.default({values:[new l.default({value:o.value})],label:x,symbol:b})),v++})}}),t.classes=g}}}]);