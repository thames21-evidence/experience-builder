"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_analysis-components_dist_esm_a-dbff16"],{13830:(e,t,i)=>{i.d(t,{A:()=>u,B:()=>li,C:()=>ci,D:()=>fi,E:()=>xi,F:()=>X,V:()=>we,a:()=>m,b:()=>w,c:()=>I,d:()=>M,e:()=>A,f:()=>R,g:()=>q,h:()=>j,i:()=>K,j:()=>Z,k:()=>se,l:()=>ve,m:()=>Ce,n:()=>xe,o:()=>Le,p:()=>Ee,q:()=>Me,r:()=>Fe,s:()=>Ve,t:()=>De,u:()=>Ne,v:()=>je,w:()=>Ke,x:()=>Yt,y:()=>ii,z:()=>ai});var s=i(44471),a=i(44188),l=i(91685),r=i(47937),n=i(84121),o=i(76451),h=i(52095);const c="control-margin",d="cursor-default",p="label",u=class{constructor(e){(0,s.r)(this,e),this.analysisBooleanInputChange=(0,s.c)(this,"analysisBooleanInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.displayStyle="checkbox",this.hideHelp=!1,this.readOnly=!1,this.handleCheckChange=()=>{this.value=!this.value,this.analysisBooleanInputChange.emit()}}render(){const e=(0,a.a1)(this.validationParams),t=(0,a.P)(e),i=(0,a.a3)(this.validationParams?.type);return(0,s.h)(s.H,{key:"52a52f31fe2f1f61651065f25a32784fefde5b80"},(0,s.h)("calcite-label",{key:"d2e0029da043278bcfd4e32773ba34cc9583509a",class:!0===this.readOnly?d:p,layout:this.labelLayout??"inline"},"switch"===this.displayStyle?(0,s.h)("calcite-switch",{class:c,scale:a.g.Scale,checked:this.value??!1,onCalciteSwitchChange:this.handleCheckChange,disabled:this.readOnly}):(0,s.h)("calcite-checkbox",{class:c,scale:a.g.Scale,checked:this.value??!1,onCalciteCheckboxChange:this.handleCheckChange,disabled:this.readOnly}),(0,a.P)(this.label)&&(0,s.h)("analysis-label",{key:"46a7df46881559c6471abcd6b87832c004b97d85",label:this.label,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp,class:!0===this.readOnly?d:""})),!1===this.readOnly&&(0,s.h)("calcite-input-message",{key:"4b9b628bd759e9146cead94355233fdd7015606f",status:i,hidden:!t,scale:a.g.Scale,icon:"exclamationMarkTriangle"},e))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};u.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{--calcite-label-margin-bottom:0rem}.control-margin{margin-bottom:var(--analysis-quarter-spacing)}.cursor-default{cursor:default}.label{width:100%;cursor:pointer}";const m=class{constructor(e){(0,s.r)(this,e),this.analysisChipGroupSelectionChange=(0,s.c)(this,"analysisChipGroupSelectionChange",7),this.chipRefs=[],this.canSelectAll=!0,this.scale=a.g.Scale,this.selectAllEnabled=!1,this.disabled=!1,this.dismissible=!1,this.selectedChips=[],this.initialChipSelection=[],this.required=!1,this.isValid=!0,this.selectAllHandler=()=>{Array.isArray(this.value)?this.selectedChips.length<this.value.length?(this.selectedChips=this.value,this.canSelectAll=!1):(this.selectedChips=[],this.canSelectAll=!0):(this.selectedChips=1===this.selectedChips.length?[]:[this.value],this.canSelectAll=1!==this.selectedChips.length),this.analysisChipGroupSelectionChange.emit()},this.handleCalciteChipClick=e=>{const t=e.target.value;this.disabled||this.handleChipSelection(t)},this.validateSelection=()=>{this.isValid=this.selectedChips.length>0},this.renderChips=()=>{const e=(0,a.ar)(this.value,this.chipLabel);return(0,s.h)(s.H,null,(0,s.h)("div",null,e.map(([e,t],i)=>(0,s.h)("calcite-chip",{label:t,key:e,scale:this.scale,ref:e=>{null==e||this.value.includes(e.value)||this.chipRefs.push(e)},appearance:"outline",kind:this.selectedChips.includes(e)?"brand":"neutral",icon:Array.isArray(this.iconLabel)?this.iconLabel[i]:this.iconLabel,value:e,onClick:this.handleCalciteChipClick,class:this.disabled?"analysis-chip-disabled":"analysis-chip-button",closed:!1,closable:this.dismissible,messageOverrides:{dismissLabel:this.strings.remove}},t)),this.selectAllEnabled?(0,s.h)("calcite-button",{round:!0,scale:this.scale,kind:"brand",appearance:"transparent",onClick:this.selectAllHandler},this.canSelectAll?this.strings.selectAll:this.strings.deselectAll):null,this.renderErrorMessage()))},this.renderErrorMessage=()=>!1===this.isValid?!0===this.required?(0,s.h)("calcite-input-message",{status:a.r.INVALID,scale:a.g.Scale,icon:"exclamationMarkTriangle"},(0,a.a)(this.validationParams?.badInputMessage??this.strings.requiredError,{})):(0,s.h)("calcite-input-message",{status:a.r.IDLE,scale:a.g.Scale,icon:"exclamationMarkTriangle"},this.strings.ignoreFieldMessage):null,this.renderChip=()=>(0,s.h)(s.H,null,(0,s.h)("div",null,(0,s.h)("calcite-chip",{label:this.chipLabel,ref:e=>{0===this.chipRefs.length&&this.chipRefs.push(e)},kind:this.selectedChips.includes(this.value)?"brand":"neutral",appearance:"outline",icon:this.chipLabel,scale:this.scale,value:this.value,onClick:this.handleCalciteChipClick,class:this.disabled?"analysis-chip-disabled":"analysis-chip-button",closable:this.dismissible,messageOverrides:{dismissLabel:this.strings.remove}},this.chipLabel)))}validateValues(e){if(!0===(0,a.as)(e))throw new a.at("DuplicateValueError","There are duplicate strings in the values array")}selectedChipsChange(){this.validateSelection(),this.analysisChipGroupSelectionChange.emit(),this.updateSelectAllButton()}async componentWillLoad(){Array.isArray(this.value)&&this.validateValues(this.value),({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)(".")))}componentDidLoad(){void 0!==this.initialChipSelection&&(this.selectedChips=this.initialChipSelection,this.isValid=!0)}handleDismiss(e){const t=e.target;this.value=Array.isArray(this.value)?this.value.filter(e=>e!==t.value):"",this.chipLabel=Array.isArray(this.chipLabel)?this.chipLabel.filter(e=>e!==t.innerText):"",this.chipRefs=this.chipRefs.filter(e=>e.value!==t.value)}handleChipSelection(e){if("single"===this.selectionMode)this.selectedChips=this.selectedChips.includes(e)?[]:[e];else{if("multi"!==this.selectionMode)throw new a.at("RequiredPropertyMissing","The selectionMode property is required and must be either 'single' or 'multi'");this.selectedChips=this.selectedChips.includes(e)?this.selectedChips=this.selectedChips.filter(t=>t!==e):this.selectedChips=[...this.selectedChips,e]}}updateSelectAllButton(){!0===this.selectAllEnabled&&(Array.isArray(this.value)&&this.selectedChips.length===this.value.length||this.selectedChips[0]===this.value?this.canSelectAll=!1:this.canSelectAll=!0)}async checkValidity(){return this.validateSelection(),Promise.resolve(this.isValid)}render(){return!0===(Array.isArray(this.value)&&Array.isArray(this.chipLabel)&&this.value?.length===this.chipLabel?.length)?this.renderChips():this.renderChip()}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["validateValues"],selectedChips:["selectedChipsChange"]}}};m.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{margin-bottom:var(--analysis-half-spacing)}.analysis-chip-button{margin:var(--analysis-quarter-spacing);border-width:2px}.analysis-chip-button:hover{cursor:pointer}.analysis-chip-disabled{margin:var(--analysis-quarter-spacing);background-color:var(--calcite-color-foreground-2);border:none}";const y="half-margin-bot",g="width-100",v="flex-container",f="primary-button",b="secondary-button",C="list-item--border",w=class{constructor(e){(0,s.r)(this,e),this.analysisDataFileInputChange=(0,s.c)(this,"analysisDataFileInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.hideUpload=!1,this.browseOption="item",this.mapLayers=[],this.hideHelp=!1,this.doCalciteInputChangeOnCommit=!1,this.itemSelected=!1,this.urlSelected=!1,this.fileUploading=!1,this.renderInitial=()=>{const e=(0,a.P)(this.value)&&"portalItemID"in this.value?{itemId:this.value.portalItemID}:void 0,t=this.accept?.map(e=>`.${e}`).join(","),i=this.portal?.user??void 0;return(0,s.h)(s.F,null,(0,s.h)("div",{class:v},"item"===this.browseOption?(0,s.h)("analysis-item-input",{class:f,hidden:this.urlSelected||void 0!==this.selectedFile,q:'((typekeywords:"Document" OR type:"Image" OR type:"Layout" OR type:"Desktop Style" OR type:"Project Template" OR type:"Report Template" OR type:"Pro Report" OR type:"Statistical Data Collection" OR type:"360 VR Experience" OR type:"netCDF" OR type:"PDF" OR type:"CSV" OR type:"Administrative Report" OR type:"Raster function template") -type:("Image Service" OR "Explorer Document" OR "Explorer Map" OR "Globe Document" OR "Scene Document"))',label:"",replaceTooltipText:this.strings.replaceData,selectButtonLabel:this.strings.addData,selectedItemIcon:"file",value:e,onAnalysisItemInputChange:this.handleAnalysisItemInputChange,portal:this.portal,user:i}):(0,s.h)("analysis-layer-input",{class:f,hidden:this.urlSelected||void 0!==this.selectedFile,label:"",layerFilterType:"imagery",mapLayers:this.mapLayers,mapView:this.mapView,selectedLayers:this.selectedRasterDataLayer,selectedLayerIcon:"image-layer",user:i,value:this.value,popoverWidth:this.popoverWidth,onAnalysisLayerInputChange:this.handleAnalysisLayerInputChange}),!1===this.hideUpload&&(0,s.h)("calcite-button",{"data-tooltip-id":"upload",class:`${b} ${y}`,hidden:this.itemSelected||this.urlSelected||void 0!==this.selectedFile||void 0!==this.selectedRasterDataLayer,appearance:"outline","icon-start":"upload-to",kind:"neutral",scale:a.g.Scale,label:this.strings.file,onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip,onClick:e=>{this.hiddenFileInput?.click(),e.preventDefault()}}),(0,s.h)("calcite-button",{"data-tooltip-id":"url",class:`${b} ${y}`,hidden:this.itemSelected||this.urlSelected||void 0!==this.selectedFile||void 0!==this.selectedRasterDataLayer,appearance:"outline","icon-start":"link",kind:"neutral",scale:a.g.Scale,label:this.strings.url,onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip,onClick:this.handleUrlClick}),this.urlSelected&&this.renderUrlInput(),void 0!==this.selectedFile&&this.renderFileSelected(),(0,s.h)("input",{accept:t,hidden:!0,type:"file",onInput:this.handleFileInputChange,ref:e=>this.hiddenFileInput=e})),this.renderInputMessage())},this.renderUrlInput=()=>{const e=this.doCalciteInputChangeOnCommit?{onCalciteInputTextChange:this.handleUrlInputChange}:{onCalciteInputTextInput:this.handleUrlInputChange};return(0,s.h)("calcite-input-text",{class:g,value:this.value?.url,scale:a.g.Scale,...e},(0,s.h)("calcite-action",{slot:"action",icon:"x",scale:a.g.Scale,text:this.strings.clear,onClick:this.resetToInitial}))},this.renderFileSelected=()=>{const e=this.selectedFile?.itemName;return(0,s.h)("calcite-list",{class:g,label:"",loading:this.fileUploading},(0,s.h)("calcite-list-item",{"data-tooltip-id":"replace",class:C,label:e,onCalciteListItemSelect:e=>{this.hiddenFileInput?.click(),e.preventDefault()},onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip},(0,s.h)("calcite-icon",{icon:"file",slot:"content-start"}),(0,s.h)("calcite-action",{text:this.strings.clear,slot:"actions-end",label:this.strings.clear,appearance:"transparent",icon:"x",onClick:this.resetToInitial,onMouseOver:this.removeTooltip})))},this.renderInputMessage=()=>void 0!==this.errorMessage&&(0,s.h)("calcite-input-message",{status:a.r.INVALID,scale:a.g.Scale,icon:"exclamationMarkTriangle"},this.errorMessage),this.handleAnalysisItemInputChange=e=>{const t=e.target.selectedItem;void 0!==t?(this.value={portalItemID:t.id},this.itemSelected=!0,this.validate(),this.analysisDataFileInputChange.emit()):this.resetToInitial()},this.handleAnalysisLayerInputChange=e=>{const{selectedLayers:t,value:i}=e.target;void 0!==t?(this.selectedRasterDataLayer=t,this.value={url:i.url,inputType:"layer"},this.validate(),this.analysisDataFileInputChange.emit()):this.resetToInitial()},this.handleFileInputChange=async()=>{if(0!==this.hiddenFileInput?.files?.length&&(this.selectedFile={itemName:this.hiddenFileInput?.files?.[0].name??""},void 0!==this.abortController&&this.abortController.abort(),void 0!==this.serviceUrl)){this.errorMessage=void 0,this.fileUploading=!0;try{this.abortController=new AbortController;const e=new FormData;e.append("file",this.hiddenFileInput?.files?.[0]),e.append("f","json");const t=this.apiUrls.upload,i=await(0,a.a6)(t,{body:e,method:"post",responseType:"json",signal:this.abortController.signal});this.selectedFile=i.data.item,this.value={itemID:i.data.item.itemID,inputType:"file"},this.fileUploading=!1,this.validate(),this.analysisDataFileInputChange.emit()}catch(e){console.error(e),this.errorMessage=this.strings.uploadFailureMsg,this.selectedFile=void 0,this.fileUploading=!1}}},this.handleUrlClick=()=>{this.urlSelected=!0},this.handleUrlInputChange=e=>{const t=e.target.value;this.value={url:t,inputType:"text"},this.validate(),this.analysisDataFileInputChange.emit()},this.resetToInitial=()=>{this.value=void 0,this.selectedFile=void 0,this.selectedRasterDataLayer=void 0,this.urlSelected=!1,this.itemSelected=!1,this.hiddenFileInput&&(this.hiddenFileInput.value=""),this.validate(),this.analysisDataFileInputChange.emit()},this.addTooltip=e=>{const t=e.target,i=t?.getAttribute("data-tooltip-id");switch(void 0===this.tooltipElement&&(this.tooltipElement=document.createElement("calcite-tooltip"),this.tooltipElement.placement="bottom"),i){case"upload":this.tooltipElement.innerText=this.strings.uploadData,this.tooltipElement.offsetDistance=14;break;case"url":this.tooltipElement.innerText=this.strings.AddDataFromUrl,this.tooltipElement.offsetDistance=14;break;case"replace":this.tooltipElement.innerText=this.strings.replaceData;break;default:return void(this.tooltipElement=void 0)}this.tooltipElement.referenceElement=t,(0,l.b)(document,this.tooltipElement)},this.removeTooltip=()=>{(0,l.r)(this.tooltipElement)},this.validate=()=>{let e;void 0===this.value||"url"in this.value&&""===this.value.url?e=!0===this.required&&(0,a.y)(this.value)?this.strings.required:void 0:"url"in this.value&&void 0===this.selectedRasterDataLayer&&(e=(0,l.d)(this.value.url)&&(0,l.e)(this.value.url,this.accept)?void 0:e??this.strings.invalidUrl),this.errorMessage=e}}get apiUrls(){return{delete:`${this.serviceUrl}/uploads/deleteItems`,upload:`${this.serviceUrl}/uploads/upload`}}async onValueChange(e){if((0,a.P)(e))if("url"in e){const t=(0,a.au)(e.url);"layer"===e.inputType?this.selectedRasterDataLayer?.url!==t&&(this.selectedRasterDataLayer=await(0,a.av)({url:t},this.mapLayers),void 0===this.selectedRasterDataLayer&&(this.errorMessage=this.strings.layerNotFound)):this.urlSelected=!0}else if("itemID"in e&&e.itemID!==this.selectedFile?.itemID)try{void 0!==this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const t=await(0,a.a6)(`${this.serviceUrl}/uploads/${e.itemID}?f=json`,{signal:this.abortController.signal});this.selectedFile=t.data}catch(e){console.error(e),this.errorMessage=this.strings.fileNotFound}else"portalItemID"in e&&(this.itemSelected=!0)}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.onValueChange(this.value)}componentDidRender(){this.popoverWidth=this.hostElement.offsetWidth}disconnectedCallback(){this.abortController?.abort()}async checkValidity(){return this.validate(),Promise.resolve(void 0===this.errorMessage)}render(){return(0,s.h)(s.H,{key:"180fb0898b9a5ad2fcd262ff5ff0b9320fa47f6d"},(0,a.P)(this.label)&&(0,s.h)("analysis-label",{key:"2ba945388577a763a489d722c6dcdbc16634b74e",label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}),this.renderInitial())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["onValueChange"]}}};w.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{width:100%}.half-margin-bot{margin-bottom:var(--analysis-half-spacing)}.width-100{width:100%}.primary-button{flex-grow:1;--layer-selected-margin-bottom:0}.secondary-button{flex-grow:0;height:1rem}.flex-container{display:flex;gap:0.33rem}.list-item--border{border:1px solid var(--calcite-color-border-input);box-shadow:none;--calcite-font-size--1:var(--calcite-font-size--2)}";const x="controls-container",L="control",I=class{constructor(e){(0,s.r)(this,e),this.analysisDateInputChange=(0,s.c)(this,"analysisDateInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.defaultToNow=!1,this.readOnly=!1,this.isValid=!0,this.hideHelp=!1,this.errorMessage="",this.validateSelection=()=>{void 0!==this.value&&0!==this.dateInputElement.value?.length&&void 0!==this.timeInputElement?.value||!0!==this.required?this.isValid=!0:(this.errorMessage=this.validationParams?.requiredMessage??(0,a.a)(this.strings.requiredError,{label:this.label}),this.isValid=!1)},this.handleDateChange=()=>{if(void 0!==this.dateInputElement?.valueAsDate){const e=this.dateInputElement.valueAsDate,t=(0,a.P)(this.timeInputElement?.value)?this.timeInputElement.value.split(":").map(e=>Number(e)):[0,0];this.value=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),t[0],t[1])}else this.value=void 0;this.analysisDateInputChange.emit()},this.handleTimeChange=()=>{const e=(0,a.P)(this.timeInputElement?.value)?this.timeInputElement.value.split(":").map(e=>Number(e)):void 0;if(void 0!==this.value&&void 0!==e){const t=this.dateInputElement.valueAsDate;this.value=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),e[0],e[1])}this.analysisDateInputChange.emit()}}async checkValidity(){return this.validateSelection(),Promise.resolve(this.isValid)}async componentWillLoad(){if(({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),!0===this.defaultToNow){const e=6e4*(new Date).getTimezoneOffset();this.value=new Date(Date.now()).setSeconds(0,0)-e,this.analysisDateInputChange.emit()}}render(){let e,t;if(void 0!==this.value&&null!==this.value)try{const i=new Date(this.value);e=i.toISOString(),t=`${i.getUTCHours()}:${i.getUTCMinutes()}`}catch{}return(0,s.h)(s.H,{key:"6ed306dbf9dc8ead5c2b99a179093aac387a0786"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}):null,(0,s.h)("div",{key:"31daf60aad9c57a98c029d77a35a33d7031279e6",class:x},(0,s.h)("calcite-input-date-picker",{key:"9d9993caab3da5af684344cfe4b31b184c7a4cbe",scale:a.g.Scale,class:L,value:e,placement:"bottom",minAsDate:void 0!==this.minDate?new Date(this.minDate):void 0,maxAsDate:void 0!==this.maxDate?new Date(this.maxDate):void 0,onFocusout:this.validateSelection,onCalciteInputDatePickerChange:this.handleDateChange,ref:e=>{this.dateInputElement=e},readOnly:this.readOnly}),(0,s.h)("calcite-input-time-picker",{key:"0edf363b85d681713741c66609b1fc78e6c02d0b",placement:"bottom",scale:a.g.Scale,value:t,class:L,onCalciteInputTimePickerChange:this.handleTimeChange,ref:e=>{this.timeInputElement=e},readOnly:this.readOnly})),!1===this.readOnly&&(0,s.h)("calcite-input-message",{key:"5d1d085c24b9c0e0e873cee9b6a2a7035950d42e",status:a.r.INVALID,scale:a.g.Scale,icon:"exclamationMarkTriangle",hidden:!1!==this.isValid},this.errorMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};I.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;margin-bottom:var(--analysis-half-spacing);--calcite-color-border-input:var(--analysis-ui-border-input)}.controls-container{display:flex;column-gap:5%}.control{flex:1 1 auto}.text{cursor:default;padding-bottom:var(--analysis-quarter-spacing);margin-block-start:0;margin-block-end:0}";const k="analysis-popover",E="full-width",S={"big-integer":"BigInteger",date:"Date","date-only":"DateOnly",double:"Double","global-id":"GlobalID",guid:"GUID",integer:"Integer",string:"String","time-only":"TimeOnly","timestamp-offset":"TimestampOffset"},M=class{constructor(e){(0,s.r)(this,e),this.analysisFieldInputChange=(0,s.c)(this,"analysisFieldInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.analysisHelpPopoverOpen=(0,s.c)(this,"analysisHelpPopoverOpen",7),this.newFieldName=void 0,this.newFieldType=void 0,this.pickListFields=[],this.loading=!1,this.fieldPickListOpen=!1,this.creatingNewField=!1,this.newFields=[],this.disableCreateNewFieldButton=!0,this.allowCreateNewFields=!1,this.required=!1,this.readOnly=!1,this.showFieldInfo=!0,this.usePopupTemplatesInfo=!0,this.useValueLabel=!1,this.storeAsGPValue=!1,this.showSort=!0,this.hideFieldNames=!1,this.useDefaultValue=!1,this.allowGeometryFields=!1,this.hideHelp=!1,this.filterOutGeometryFields=e=>{let t=e;return void 0!==this.mapLayer&&(t=e.filter(e=>!1===[this.mapLayer?.geometryFieldsInfo?.shapeAreaField,this.mapLayer?.geometryFieldsInfo?.shapeLengthField].includes(e.name))),t},this.handleAnalysisHelpPopoverClose=()=>{(0,a.ad)(this.toolHelpPopover),this.toolHelpPopover?.removeEventListener("analysisHelpPopoverClose",this.handleAnalysisHelpPopoverClose),this.toolHelpPopover=void 0},this.getEmptyFieldsMessage=()=>{let e;return this.pickListFields.length>0&&0===this.filteredPickListFields.length?e=this.noFieldsText??this.strings.fieldTypesIncompatible:void 0===this.mapLayer&&void 0===this.analysisDataset?e=this.noLayersText??this.strings.layerNotSelected:this.errorMessage===this.strings.fieldLoadingErrorText&&(e=this.strings.fieldLoadingErrorText),e},this.clearCreateNewFieldState=()=>{this.newFieldName=void 0,this.newFieldType=void 0,this.fieldCreationErrorMessage=void 0,this.disableCreateNewFieldButton=!0,this.creatingNewField=!1},this.arcgisFieldPickListDismissed=e=>{if(this.clearCreateNewFieldState(),e.detail){if(!0===this.storeAsGPValue)if(this.isMultiSelect){const t=e.detail.selectedFields;this.value=this.pickListFields.filter(e=>t.includes(e.name)).map(e=>this.convertFieldInstanceToFieldObject(e))}else{const t=e.detail.selectedFields[0];this.value=this.convertFieldInstanceToFieldObject(this.pickListFields.find(e=>e.name===t))}else this.value=this.isMultiSelect?e.detail.selectedFields:e.detail.selectedFields[0];this.analysisFieldInputChange.emit()}this.closeFieldPickList()},this.onAnalysisFieldRemoved=e=>{this.isStringArray(this.value)?this.value=this.value.filter(t=>t!==e.detail.value):this.isGPFieldArray(this.value)?this.value=this.value.filter(t=>t.name!==e.detail.value):this.value=void 0,this.validate(),this.analysisFieldInputChange.emit()},this.openFieldPickList=()=>{this.fieldPickListOpen=!0},this.closeFieldPickList=()=>{this.fieldPickListOpen=!1,this.validate()},this.validate=()=>{let e;this.required&&(e=(0,a.y)(this.value)?(0,a.a)(this.strings.requiredErrorMessage,{label:this.label??this.strings.requiredErrorLabelDefault}):e),this.errorMessage=e}}onCreatingNewFieldChange(){this.newFieldName=void 0,this.newFieldType=void 0}onNewFieldsChange(){this.fieldPickListOpen=!1,setTimeout(()=>{this.fieldPickListOpen=!0},0)}onReadOnlyChange(){this.readOnly??(this.readOnly=!1)}syncSelectedFieldsWithPickListFields(){this.syncSelectedFieldsWithValue(),this.analysisFieldInputChange.emit()}isString(e){return"string"==typeof e}isGPField(e){return!Array.isArray(e)&&"object"==typeof e&&"name"in e}isStringArray(e){return Array.isArray(e)&&e.every(e=>"string"==typeof e)}isGPFieldArray(e){return Array.isArray(e)&&e.every(this.isGPField)}syncSelectedFieldsWithValue(){const e=this.value;if((0,a.y)(e))this.selectedFields=void 0;else if(!0===this.storeAsGPValue)if(!0===this.isMultiSelect){const t=new Set(e.map(e=>e.name));this.selectedFields=this.pickListFields.filter(e=>t.has(e.name))}else this.selectedFields=this.pickListFields.find(t=>t.name===e.name);else if(!0===this.isMultiSelect){const t=new Set(e);this.selectedFields=this.pickListFields.filter(e=>t.has(e.name))}else this.selectedFields=this.pickListFields.find(t=>t.name===e)}disableFieldsFromPickList(){this.notAllowedFieldsSet=new Set(this.notAllowedFields),void 0!==this.value&&this.notAllowedFieldsSet.size&&(this.isStringArray(this.value)?this.value.forEach(e=>this.notAllowedFieldsSet.delete(e)):this.isGPFieldArray(this.value)?this.value.forEach(e=>this.notAllowedFieldsSet.delete(e.name)):this.isString(this.value)?this.notAllowedFieldsSet.delete(this.value):this.notAllowedFieldsSet.delete(this.value.name))}async updatePickListFieldsFromLayer(){await this.loadPickListFieldsFromLayer(),this.maybeResetValue()}async updatePickListFieldsFromDataset(){await this.loadPickListFieldsFromDataset(),this.maybeResetValue()}get filteredPickListFields(){const e=new Set(this.fieldTypes),t=!1===this.allowGeometryFields?this.filterOutGeometryFields(this.pickListFields):this.pickListFields;return 0===e.size?t:t.filter(t=>e.has(t.type)&&!this.notAllowedFieldsSet?.has(t.name))}createNewFieldFromMissingPickListField(e){if((0,a.P)(e)){const t=this.storeAsGPValue?e.name:e;this.pickListFields.map(e=>e.name).includes(t)||(this.storeAsGPValue?this.newFields.push((0,a.aw)({name:e.name,alias:e.alias??e.name,type:e.type,description:"",hideDescription:!0,hideFieldName:!1})):this.newFields.push((0,a.aw)({name:t,alias:t,type:"esriFieldTypeString",description:"",hideDescription:!0,hideFieldName:!1})))}}makeNewSetByFieldName(e,t){const i=Array.from(new Set([...e.map(e=>e.name),...t.map(e=>e.name)])),s=[];return i.forEach(i=>{const a=e.find(e=>e.name===i)??t.find(e=>e.name===i);void 0!==a&&s.push(a)}),s}createNewFieldsOnComponentLoad(){Array.isArray(this.value)?(this.value.forEach(e=>this.createNewFieldFromMissingPickListField(e)),this.pickListFields=this.makeNewSetByFieldName(this.pickListFields,this.newFields),this.selectedFields=this.pickListFields.filter(e=>this.isStringArray(this.value)?this.value.includes(e.name):this.value.map(e=>e.name).includes(e.name))):(this.createNewFieldFromMissingPickListField(this.value),this.pickListFields=this.makeNewSetByFieldName(this.pickListFields,this.newFields),this.selectedFields=this.pickListFields.find(e=>this.isString(this.value)?e.name===this.value:e.name===this.value.name))}setToolHelpFilePath(e){if(void 0===this.toolHelpFilePath){let t=e;switch(e){case a.al.English:case a.al.EnglishUSA:t=""}this.toolHelpFilePath=(0,s.a)(`assets/help/${""!==t?t+"/":""}AnalysisFieldInput.html`)}}async componentWillLoad(){let e="";({strings:this.strings,dir:this.dir,locale:e}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.setToolHelpFilePath(e),this.createNewFieldsOnComponentLoad(),void 0!==this.mapLayer?this.loadPickListFieldsFromLayer().then(()=>{this.disableFieldsFromPickList()}):void 0!==this.analysisDataset&&this.loadPickListFieldsFromDataset().then(()=>{void 0!==this.errorMessage&&""!==this.errorMessage||!0===this.abortController?.signal.aborted||this.maybeResetValue(),this.disableFieldsFromPickList()}),this.validateNewlyCreatedField()}disconnectedCallback(){this.abortController?.abort(),this.toolHelpPopover?.removeEventListener("analysisHelpPopoverClose",this.handleAnalysisHelpPopoverClose),(0,a.ad)(this.toolHelpPopover)}createHelpPopover(e,t,i){(0,a.E)(),void 0!==this.toolHelpPopover&&(this.toolHelpPopover.removeEventListener("analysisHelpPopoverClose",this.handleAnalysisHelpPopoverClose),this.toolHelpPopover=void 0),void 0!==this.toolHelpFilePath&&(this.toolHelpPopover=(0,r.s)(this.toolHelpPopover,{heading:e,helpFileName:"AnalysisFieldInput",helpId:t,helpUrl:this.toolHelpFilePath,isHelpFileExternalAsset:!1,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase??void 0,portal:this.portal,referenceElement:i}),this.toolHelpPopover.addEventListener("analysisHelpPopoverClose",this.handleAnalysisHelpPopoverClose),this.analysisHelpPopoverOpen.emit())}async checkValidity(){this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}maybeResetValue(){const e=this.filteredPickListFields??[],t=new Set(e.map(e=>e.name));this.errorMessage=void 0;let i=!0;if(this.isMultiSelect&&Array.isArray(this.value)){let e;e=this.isStringArray(this.value)?this.value.filter(e=>t.has(e)):this.value.filter(e=>t.has(e.name)),0!==e.length&&(this.value=e,this.validate(),this.analysisFieldInputChange.emit(),i=!1)}else i=this.isString(this.value)?!t.has(this.value):!t.has(this.value?.name);!0===i&&!1===this.readOnly&&(this.useDefaultValue&&e.length>0?(!1===this.storeAsGPValue?this.value=this.isMultiSelect?[e[0].name]:e[0].name:this.value=this.isMultiSelect?[e[0]]:e[0],this.validate(),this.analysisFieldInputChange.emit()):void 0!==this.value&&(this.value=void 0,this.validate(),this.analysisFieldInputChange.emit()))}get isMultiSelect(){return"multi"===this.selectionMode}convertFieldInstanceToFieldObject(e){return void 0!==e&&"toJSON"in e&&"function"==typeof e.toJSON?e.toJSON():e}async loadPickListFieldsFromDataset(){if(void 0!==this.abortController&&this.abortController.abort(),void 0!==this.analysisDataset){this.loading=!0;try{this.abortController=new AbortController,this.pickListFields=[...await this.analysisDataset.getFields({signal:this.abortController.signal}),...this.allowCreateNewFields?this.newFields:[]]}catch(e){!1===(0,a.ax)(e)&&(this.errorMessage=this.strings.fieldLoadingErrorText)}this.loading=!1}else this.pickListFields=[...this.allowCreateNewFields?this.newFields:[]]}async loadPickListFieldsFromLayer(){if(void 0!==this.mapLayer)try{this.pickListFields=[...await(0,a.ap)(this.mapLayer,this.usePopupTemplatesInfo),...this.allowCreateNewFields?this.newFields:[]],this.allowCreateNewFields&&void 0!==this.value&&0===this.newFields.length&&this.createNewFieldsOnComponentLoad()}catch(e){this.errorMessage=this.strings.fieldLoadingErrorText}else this.pickListFields=[...this.allowCreateNewFields?this.newFields:[]]}render(){return(0,s.h)(s.H,{key:"86fe4f09cec6fc02900811f1584217ff942887cf"},(0,s.h)("analysis-field-select",{key:"2a5fc9ebfc7cd9a338d507ee284315089f331eb3",errorMessage:this.errorMessage,value:(0,a.y)(this.value)?void 0:this.value,label:this.label,hideHelp:this.hideHelp,ref:e=>{this.fieldSelectElement=e},validationParams:this.validationParams,fields:this.pickListFields,useValueLabel:this.useValueLabel,selectionMode:this.selectionMode,onAnalysisSelectFieldClick:this.openFieldPickList,onAnalysisFieldRemove:this.onAnalysisFieldRemoved,placeholderText:this.readOnly?void 0:this.placeholderText,required:this.required,readOnly:this.readOnly}),this.fieldPickListOpen&&this.renderFieldPickList())}validateNewlyCreatedField(){let e=!0;const t=(0,a.ay)(this.newFieldName,a.aB);return(0,a.P)(t)?!0===(0,a.az)("/[^_\\p{L}\\p{N}]+/u")?.test(t)?(this.fieldCreationErrorMessage=this.strings.addFieldErrors.invalidNameInputInvalidCharactersError,e=!1):this.pickListFields.some(e=>e.name.toLowerCase()===t?.toLowerCase())?(this.fieldCreationErrorMessage=this.strings.addFieldErrors.existingFieldNameError,e=!1):a.aA.includes(t.toLowerCase())&&(this.fieldCreationErrorMessage=this.strings.addFieldErrors.invalidNameInputSQLError,e=!1):e=!1,this.disableCreateNewFieldButton=!e||void 0===this.newFieldType,e?t:void 0}async createNewFieldOnClick(){const e=await(this.newFieldNameInput?.checkValidity()),t=await(this.newFieldTypeInput?.checkValidity());if(!1===e||!1===t)return;if(this.newFieldName=this.validateNewlyCreatedField(),void 0===this.newFieldName)return;const i={name:this.newFieldName,alias:this.newFieldName,type:`esriFieldType${S[this.newFieldType]}`,description:"",hideDescription:!0,hideFieldName:!1};this.newFields.push(i),this.isMultiSelect?(this.value??(this.value=[]),this.storeAsGPValue?this.value=[...this.value,i]:this.value=[...this.value,i.name]):this.value=this.storeAsGPValue?i:i.name,this.pickListFields=this.makeNewSetByFieldName(this.pickListFields,[this.allowCreateNewFields?this.newFields:[]].flat()),this.newFieldName=void 0,this.newFieldType=void 0,this.creatingNewField=!1,this.closeFieldPickList(),this.disableCreateNewFieldButton=!0}renderCreateNewFieldOptions(){const e={"big-integer":"integer",date:"date-time","date-only":"calendar",double:"number","global-id":"key",guid:"key",integer:"integer",string:"string","time-only":"clock","timestamp-offset":"time-zone"},t=["integer","big-integer","double","string","date","date-only","time-only","timestamp-offset","guid","global-id"],i=this.fieldTypes?.filter(e=>t.includes(e))??t,l={},r={};return i?.forEach(t=>{const i=this.strings.types[t];l[t]=i?.title,r[t]=e[t]}),(0,s.h)(s.F,null,(0,s.h)("analysis-string-input",{class:E,label:this.strings.fieldName,onAnalysisStringInputChange:e=>{this.fieldCreationErrorMessage=void 0,this.newFieldName=e.target.value,this.validateNewlyCreatedField()},ref:e=>this.newFieldNameInput=e,onAnalysisHelpClick:()=>{this.createHelpPopover(this.strings.fieldName,"fieldName",this.newFieldNameInput)},required:!0}),(0,s.h)("calcite-input-message",{status:a.r.INVALID,hidden:void 0===this.fieldCreationErrorMessage,scale:a.g.Scale,icon:"exclamationMarkTriangle"},this.fieldCreationErrorMessage),(0,s.h)("analysis-string-input",{class:E,choiceListPositioning:"fixed",label:this.strings.fieldType,choiceList:i,choiceListIcons:r,choiceListLabels:l,onAnalysisStringInputChange:e=>{this.newFieldType=e.target.value,this.validateNewlyCreatedField()},ref:e=>this.newFieldTypeInput=e,onAnalysisHelpClick:()=>{this.createHelpPopover(this.strings.fieldType,"fieldType",this.newFieldTypeInput)},required:!0}))}renderFieldPickList(){const e=this.makeNewSetByFieldName(this.allowCreateNewFields?this.newFields:[],this.filteredPickListFields);let t;const i=this.getEmptyFieldsMessage(),a=this.allowCreateNewFields?{width:"100%",background:"var(--calcite-color-foreground-1)",padding:"0% 4% 13% 4%",boxSizing:"border-box"}:{margin:"var(--analysis-half-spacing)"};let l,r,n;this.loading?t=(0,s.h)("calcite-loader",{label:this.strings.loadingFields,type:"indeterminate",slot:"no-fields"}):void 0!==i&&(t=(0,s.h)("div",{slot:"no-fields",class:"emptyFieldsContent",style:a},(0,s.h)("p",null,i))),this.isMultiSelect||(l=this.strings.selectFieldPicklistHeading,r=this.strings.selectOkBtnText),l=this.heading??l,n=void 0!==this.value?this.isMultiSelect?!0===this.storeAsGPValue?this.value.map(e=>e.name):this.value:[!0===this.storeAsGPValue?this.value.name:this.value]:[];const o=void 0!==this.analysisDataset||!0===this.mapLayer?.variableJson?.isDerived;return(0,s.h)("arcgis-tunnel",{reference:this.hostElement},(0,s.h)("arcgis-field-pick-list",{dir:this.dir,class:k,layer:this.mapLayer,mapView:this.mapView,fields:this.creatingNewField||this.loading?[]:e,selectedFields:n,multiple:this.isMultiSelect,showDescription:!0,showFieldName:!this.hideFieldNames,hideCancel:this.creatingNewField,showSort:this.showSort,showSelectionAll:e.length>0,showFieldInfo:!o&&this.showFieldInfo,heading:this.creatingNewField?this.strings.createNewFields:l,okBtnText:r,filterPlaceholderText:this.readOnly?void 0:this.filterPlaceholderText,filterNoResultsText:this.creatingNewField?"":this.strings.noSearchResults,onArcgisFieldPickListDismissed:this.arcgisFieldPickListDismissed,popoverProps:{refElement:this.fieldSelectElement,autoClose:!this.allowCreateNewFields,popoverWidth:300,overlayPositioning:"fixed"}},!1===this.creatingNewField&&t,this.allowCreateNewFields&&(0,s.h)("div",{slot:"content-center"},!1===this.creatingNewField&&(0,s.h)("calcite-button",{appearance:"outline",iconStart:"plus",kind:"neutral",alignment:"center",style:{margin:"0rem 0.5rem 0.5rem 0.5rem",width:"92%",padding:"3% 0% 0% 1%"},label:this.strings.createNewFields,onClick:()=>this.creatingNewField=!this.creatingNewField},this.strings.createNewFields)),this.creatingNewField&&(0,s.h)("div",{slot:"content-top",style:{width:"100%",display:"grid"}},this.renderCreateNewFieldOptions()),this.creatingNewField&&(0,s.h)("div",{hidden:!this.creatingNewField,slot:"content-bottom",style:{width:"100%"}},(0,s.h)("calcite-button",{style:{marginBottom:"0.5rem"},onClick:()=>this.clearCreateNewFieldState(),appearance:"outline",width:"full"},this.strings.cancel),(0,s.h)("br",null),(0,s.h)("calcite-button",{width:"full",onClick:()=>this.createNewFieldOnClick(),disabled:this.disableCreateNewFieldButton,ref:e=>this.createFieldButton=e},this.strings.createAndSelectField),(0,s.h)("calcite-tooltip",{placement:"top",overlayPositioning:"fixed",hidden:!this.disableCreateNewFieldButton,closeOnClick:!0,referenceElement:this.createFieldButton},this.strings.tooltip))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{creatingNewField:["onCreatingNewFieldChange"],newFields:["onNewFieldsChange"],readOnly:["onReadOnlyChange"],pickListFields:["syncSelectedFieldsWithPickListFields"],value:["syncSelectedFieldsWithValue"],notAllowedFields:["disableFieldsFromPickList"],mapLayer:["updatePickListFieldsFromLayer"],usePopupTemplatesInfo:["updatePickListFieldsFromLayer"],analysisDataset:["updatePickListFieldsFromDataset"]}}};M.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;width:var(--analysis-component-default-width);margin-bottom:var(--analysis-half-spacing)}.list-item{--calcite-font-size--1:var(--calcite-font-size--2)}.full-width{margin:auto;width:100%}";const F="field-multi-select-btn-spaced",T="multi-select-container",V="border",P="border-list-items",D="border-single-list-item",A=class{constructor(e){(0,s.r)(this,e),this.analysisSelectFieldClick=(0,s.c)(this,"analysisSelectFieldClick",7),this.analysisFieldRemove=(0,s.c)(this,"analysisFieldRemove",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.disabled=!1,this.useValueLabel=!1,this.required=!1,this.readOnly=!1,this.hideHelp=!1,this.renderMessages=()=>{const e=(0,a.P)(this.errorMessage),t=(0,a.a1)((0,a.a2)(this.strings,this.validationParams));return(0,s.h)("calcite-input-message",{icon:"exclamationMarkTriangle",status:e?a.r.INVALID:(0,a.a3)(this.validationParams?.type),scale:a.g.Scale,hidden:!e&&(0,a.y)(t)},e?this.errorMessage:t)},this.handleReplaceFieldClick=e=>{const t=e.target;"calcite-list-item"!==t?.localName||e.composedPath().find(e=>"calcite-action"===e.localName)||this.analysisSelectFieldClick.emit()},this.handleMouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.strings.replaceField),this.replaceTooltip.referenceElement=t,(0,l.b)(document,this.replaceTooltip))},this.handleMouseOut=()=>{(0,l.r)(this.replaceTooltip)},this.onSelectClick=()=>{this.analysisSelectFieldClick.emit()},this.onFieldRemoved=e=>{(0,l.r)(this.replaceTooltip),this.analysisFieldRemove.emit({value:e})}}get fieldLabels(){let e=[];if(!0===this.useValueLabel&&void 0!==this.value){e=(Array.isArray(this.value)?this.value:[this.value]).map(e=>[e,e])}else!1===this.useValueLabel&&void 0!==this.fields&&(e=this.fields.map(e=>[e.name,e.alias]));return new Map(e)}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)(".")))}render(){return(0,s.h)(s.H,{key:"3baaad8412e50176e47ed4f4c0e34777835eda15"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}):null,void 0===this.selectionMode||"single"===this.selectionMode?void 0===this.value?this.renderSingleSelectButton():this.renderSingleListItem():this.renderMultiple(),this.renderMessages())}renderSingleListItem(){const e="string"==typeof this.value?this.value:this.value?.name,t=this.fieldLabels.get(e)??e;return(0,s.h)("calcite-list",{interactionMode:!0===this.readOnly?"static":void 0,label:""},(0,s.h)("calcite-list-item",{"data-layerId":e,class:D,key:e?.toString(),value:e,label:t,unavailable:!0===this.readOnly,onMouseOver:!1===this.readOnly?this.handleMouseOver:void 0,onMouseOut:!1===this.readOnly?this.handleMouseOut:void 0,onClick:!1===this.readOnly?this.handleReplaceFieldClick:void 0,messageOverrides:{close:this.strings.removeField}},!1===this.readOnly&&(0,s.h)("calcite-action",{text:this.strings.removeField,slot:"actions-end",label:this.strings.removeField,appearance:"transparent",icon:"x",onClick:()=>this.onFieldRemoved(e)})))}renderSingleSelectButton(){const e="string"==typeof this.value?this.value:this.value?.name,t=void 0!==e?this.fieldLabels.get(e):this.placeholderText??this.strings.inputPlaceholderText;return(0,s.h)("calcite-button",{scale:a.g.Scale,width:"full",alignment:"space-between",appearance:"outline",kind:"neutral","icon-end":"chevron-down",onClick:this.onSelectClick,disabled:this.readOnly},this.readOnly?(0,s.h)("span",null,"\xa0"):t)}renderMultiple(){const e=void 0!==this.value&&Array.isArray(this.value)&&this.value.length>0?F:void 0,t=this.fieldLabels,i=e=>(0,s.h)("calcite-list-item",{key:e,class:P,label:t.get(e)??e,value:e,onClick:this.handleReplaceFieldClick},!1===this.readOnly&&(0,s.h)("calcite-action",{text:this.strings.removeField,slot:"actions-end",label:this.strings.removeField,appearance:"transparent",icon:"x",onClick:()=>this.onFieldRemoved(e)}));let l;return l="string"==typeof this.value?.[0]?this.value.map(i):this.value?.map(e=>i(e.name)),(0,s.h)("div",{class:T},void 0!==l&&l.length>0&&(0,s.h)("calcite-list",{class:V,label:"",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,disabled:this.readOnly},l),(0,s.h)("calcite-button",{iconStart:"plus",appearance:"outline",kind:"neutral",width:"full",onClick:this.onSelectClick,class:e,scale:a.g.Scale,disabled:this.readOnly},this.placeholderText??this.strings.multiSelectFieldButtonText))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};A.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{width:var(--analysis-component-default-width);font-size:var(--analysis-label-font-size)}.error-message{margin-top:var(--analysis-quarter-spacing)}.field-multi-select-btn-spaced{margin-top:var(--analysis-half-spacing)}.border{border:1px solid var(--analysis-ui-border-input)}.multi-select-container{display:flex;flex-direction:column;gap:var(--analysis-quarter-spacing);width:100%;margin-bottom:var(--analysis-half-spacing)}.text-s{margin-block-start:0;margin-block-end:0;color:var(--calcite-color-text-1);font-size:var(--calcite-font-size--2);line-height:1rem}.text-m{margin-block-start:0;margin-block-end:0;color:var(--calcite-color-text-1);font-size:var(--calcite-font-size--1);line-height:1rem}.border-list-items{--calcite-font-size--1:var(--calcite-font-size--2);border-bottom:none;border-top:none}.border-single-list-item{border:1px solid var(--analysis-ui-border-input);--calcite-font-size--1:var(--calcite-font-size--2)}";const O={addVariableButton:"add-variable-button",borderListItems:"border-list-items",border:"border"},R=class{constructor(e){(0,s.r)(this,e),this.analysisGeoenrichmentInputChange=(0,s.c)(this,"analysisGeoenrichmentInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.doValidate=!1,this.readOnly=!1,this.required=!1,this.renderAddVariable=()=>{const e=(this.value?.analysisVariables?.length??0)>0?O.addVariableButton:void 0;return(0,s.h)("calcite-button",{disabled:this.readOnly,width:"full",appearance:"outline",kind:"neutral","icon-start":"plus",scale:a.g.Scale,onClick:this.openDataBrowser,class:e},this.strings.addVariableLabel)},this.renderSelectedVariables=()=>{const e=this.value?.analysisVariables?.map((e,t)=>(0,s.h)("calcite-list-item",{disabled:this.readOnly,key:e,label:this.value?.labels?.[t]??e,value:e,class:O.borderListItems,closable:!1===this.readOnly,onCalciteListItemClose:this.onListItemRemove}));return(0,s.h)("calcite-list",{label:"",class:O.border},e)},this.onListItemRemove=e=>{const t=e.target,i=t?.value;if(void 0!==this.value){let{analysisVariables:e,labels:s}=this.value;e=e?.filter(e=>e!==i),s=s?.filter(e=>e!==t?.label),this.doValidate=!0,this.value=Object.assign({},this.value,{analysisVariables:e,labels:s}),0===this.value.analysisVariables?.length&&(this.value.analysisVariables=void 0)}this.analysisGeoenrichmentInputChange.emit()},this.openDataBrowser=()=>{this.dataBrowserElement=document.createElement("analysis-geoenrichment-databrowser"),this.dataBrowserElement.addEventListener("analysisDataBrowserSelectionChange",this.onSelectedVariables),this.dataBrowserElement.addEventListener("analysisDataBrowserClose",this.closeModal),document.body.appendChild(this.dataBrowserElement),this.dataBrowserElement.analysisVariables=this.value?.analysisVariables?.join?.()??"",this.dataBrowserElement.portal=this.portal,this.dataBrowserElement.countryId=this.countryId,this.dataBrowserElement.hierarchyId=this.hierarchyId},this.closeModal=()=>{void 0!==this.dataBrowserElement&&(this.dataBrowserElement.removeEventListener("analysisDataBrowserSelectionChange",this.onSelectedVariables),this.dataBrowserElement.removeEventListener("analysisDataBrowserClose",this.closeModal),this.dataBrowserElement.remove(),this.dataBrowserElement=void 0)},this.onSelectedVariables=e=>{const{selectedValues:t,countryId:i,hierarchyId:s,countryAlias:a,hierarchyAlias:l}=e.detail;this.countryId=i,this.hierarchyId=s;const[r,n]=t.reduce((e,t)=>{const[i,s]=e;return i.push(t.value),s.push(t.label),[i,s]},[[],[]]);this.doValidate=!0,this.value={country:this.countryId,hierarchy:this.hierarchyId,countryAlias:a,hierarchyAlias:l,analysisVariables:r,labels:n},this.analysisGeoenrichmentInputChange.emit(),this.closeModal()},this.validate=()=>{let e;return this.required&&(0,a.y)(this.value?.analysisVariables)?(e=!1,this.error=this.strings.requiredInputMessage):(e=!0,this.error=void 0),e}}valueChange(e){this.countryId=e?.country??void 0,this.hierarchyId=e?.hierarchy??void 0,!0===this.doValidate&&this.validate()}get hasError(){return void 0!==this.error}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)(".")));(this.value?.analysisVariables?.length??0)>0&&(this.doValidate=!0),void 0!==this.value&&this.valueChange(this.value)}disconnectedCallback(){this.closeModal()}async checkValidity(){const e=this.validate();return Promise.resolve(e)}render(){const e=(this.value?.analysisVariables?.length??0)>0?this.renderSelectedVariables():null;return(0,s.h)(s.H,{key:"09929bf15943141c7ee6603c03899dec9debeb3e"},(0,a.P)(this.label)?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,e,this.renderAddVariable(),(0,s.h)("calcite-input-message",{key:"de9a3b5369f39cbcd05838bfecef160b522ef06b",status:"invalid",scale:a.g.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.error))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["valueChange"]}}};R.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.add-variables-button{margin-top:var(--analysis-half-spacing)}.border-list-items{--calcite-font-size--1:var(--calcite-font-size--2);border-bottom:none;border-top:none}.border{border:1px solid var(--analysis-ui-border-input);margin-bottom:var(--analysis-half-spacing)}";const N="analysis--rtl",q=class{constructor(e){(0,s.r)(this,e),this.analysisDataBrowserSelectionChange=(0,s.c)(this,"analysisDataBrowserSelectionChange",7),this.analysisDataBrowserClose=(0,s.c)(this,"analysisDataBrowserClose",7),this.analysisVariables="",this.onSelectButtonClick=()=>{const e=this.dataBrowserElement?.getSelectedVariables();this.analysisDataBrowserSelectionChange.emit(e)},this.resizeDataBrowser=()=>{const e=this.getWindowSize();this.dataBrowserElement.dataBrowser.domNode.style.width=.75*e.w+"px",this.dataBrowserElement.dataBrowser.domNode.style.height=.75*e.h+"px",this.dataBrowserElement.dataBrowser.domNode.style.maxWidth="100%",this.dataBrowserElement.dataBrowser.domNode.style.maxHeight="100%"},this.getWindowSize=()=>({w:window.innerWidth,h:window.innerHeight}),this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1),this.analysisDataBrowserClose.emit()}}portalChange(e){this.geoenrichmentUrl=e?.helperServices?.geoenrichment?.url??"https://geoenrichdev.arcgis.com/arcgis/rest/services/World/GeoenrichmentServer"}async componentWillLoad(){({strings:this.strings,locale:this.locale,dir:this.dir}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.portalChange(this.portal)}componentDidLoad(){try{setTimeout(()=>requestAnimationFrame(()=>this.containerRef?.setFocus()),1)}catch{}}renderDialog(){return(0,s.h)("calcite-dialog",{open:!0,modal:!0,heading:this.strings.header,width:"l",onCalciteDialogClose:this.close,ref:e=>this.containerRef=e},this.renderDataBrowser(),(0,s.h)("calcite-button",{slot:"footer-end",appearance:"outline",onClick:this.close},this.strings.cancel),(0,s.h)("calcite-button",{slot:"footer-end",onClick:this.onSelectButtonClick},this.strings.select))}renderDataBrowser(){return(0,s.h)("arcgis-geoenrichment-databrowser",{customTitle:" ",locale:this.locale,class:{[N]:"rtl"===this.dir},countryId:this.countryId??"_",hierarchyId:this.hierarchyId??"esri2025",geoenrichmentURL:this.geoenrichmentUrl,analysisVariables:this.analysisVariables,onArcgisDBOnLoadCompleted:this.resizeDataBrowser,hideApplyButton:!0,hideCancelButton:!0,ref:e=>{this.dataBrowserElement=e}})}render(){return this.renderDialog()}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{portal:["portalChange"]}}},_="Deep Learning Package",B="Raster function template",H="cloudStore_amazon",z="cloudStore_azure",U="bigquery",$="snowflake",G="databricks",W="analysis-item-input",Q={buttonContainer:`${W}__buttons-container`,listItem:`${W}__list-item`,loaderContainer:`${W}__loader-container`,loader:`${W}__loader`},j=class{constructor(e){(0,s.r)(this,e),this.analysisItemInputChange=(0,s.c)(this,"analysisItemInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.isProcessingItem=!1,this.deepLearningParameters={},this.required=!1,this.itemTypes=[],this.hideFilters=!0,this.hidePreview=!1,this.renderInitialMode=()=>{let e;if(void 0!==this.newItemMode){const t=this.getNewItemButtonProps(this.newItemMode);e=(0,s.h)("calcite-button",{appearance:"outline",scale:a.g.Scale,kind:"neutral","icon-start":t.icon,onClick:this.openAddItem},t.label)}return(0,s.h)("div",{class:Q.buttonContainer},e,(0,s.h)("calcite-button",{appearance:"outline",kind:"neutral",scale:a.g.Scale,"icon-start":"select",onClick:this.openItemBrowser},this.selectButtonLabel??this.strings.selectItem))},this.clearSelectedItem=()=>{this.value=void 0},this.openItemBrowser=()=>{this.itemBrowserElement=document.createElement("analysis-item-browser"),this.itemBrowserElement.header=this.strings.selectItem,this.itemBrowserElement.filter=this.filterExpression,this.itemBrowserElement.q=this.q,this.itemBrowserElement.portal=this.portal,this.itemBrowserElement.user=this.user,this.itemBrowserElement.bucketOptions=this.bucketOptions,this.itemBrowserElement.hidePreview=this.hidePreview,this.itemBrowserElement.hideFilters=this.hideFilters,this.itemBrowserElement.hideAddToMap=!0,this.itemBrowserElement.selectionMode="single",this.itemBrowserElement.cardMessageOverrides={preview:this.strings.previewDetails},this.itemBrowserElement.addEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.addEventListener("analysisItemBrowserSelection",this.onSelectedBrowserItem),document.body.appendChild(this.itemBrowserElement)},this.onSelectedBrowserItem=e=>{null!==e.detail&&(this.value={itemId:e.detail.id})},this.openAddItem=()=>{if(void 0!==this.newItemMode&&void 0!==this.newItemConfig){if(this.newItemElement=document.createElement("arcgis-new-item"),this.newItemElement.allowPublish=!1,this.newItemElement.allowedItemTypes=this.itemTypes,this.newItemElement.allowedModes=[this.newItemMode],this.newItemElement.api=4,this.newItemElement.config=this.newItemConfig,this.newItemElement.portal=this.portal,this.newItemElement.user=this.user,"serviceConnection"===this.newItemMode)this.newItemElement.firstStep="serviceConnection";else if("dataStore"===this.newItemMode){const e=[[H,"dataStoreSelectCloudCredentialsAmazonS3"],[z,"dataStoreSelectCloudCredentialsAzureBlob"],[$,"dataStoreDatabaseCredentialsSnowflake"],[U,"dataStoreDatabaseCredentialsBigQuery"],[G,"dataStoreDatabaseCredentialsDatabricks"]];for(const[t,i]of e)if(`typekeywords:${t}`===this.itemFilter){this.newItemElement.firstStep=i;break}}this.newItemElement.addEventListener("workflowCancel",this.closeModals),this.newItemElement.addEventListener("workflowComplete",this.onAddItemComplete),document.body.appendChild(this.newItemElement)}},this.onAddItemComplete=e=>{void 0!==e.detail.id?this.value={itemId:e.detail.id}:this.value=void 0,void 0!==this.newItemElement&&(this.newItemElement.isActive=!1)},this.closeModals=()=>{void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0),void 0!==this.newItemElement&&(this.newItemElement.removeEventListener("workflowCancel",this.closeModals),this.newItemElement.removeEventListener("workflowComplete",this.onAddItemComplete),this.newItemElement.remove(),this.newItemElement=void 0)},this.getNewItemButtonProps=e=>{if("file"===e)return{icon:"upload-to",label:this.strings.addFile};if("dataStore"===e)return{icon:"plus",label:this.strings.addDataStore};if("serviceConnection"===e)return{icon:"plus",label:this.strings.addServiceConnection};throw new Error("Unsupported new item mode.")},this.validate=()=>{let e;return this.required&&(0,a.y)(this.value)?(e=!1,this.errorMessage=this.strings.requiredInputMessage):(e=!0,this.errorMessage=void 0),e},this.renderLoader=()=>{const e=!0===this.isProcessingItem;return(0,s.h)("div",{class:Q.loaderContainer},(0,s.h)("calcite-loader",{class:Q.loader,hidden:!e,inline:!0,label:"loader",scale:a.g.Scale,type:"indeterminate"}),e?this.processingItemMessage??this.strings.queryModelArgsMsg:null)},this.onListItemMouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.replaceTooltipText??this.strings.replaceItem),this.replaceTooltip.referenceElement=t,(0,l.b)(document,this.replaceTooltip))},this.onListItemMouseOut=()=>{(0,l.r)(this.replaceTooltip)},this.onListItemClick=e=>{const t=e.target;"calcite-list-item"===t?.localName&&this.openItemBrowser()}}async hydrateSelectedItem(e){const t=e?.itemId;if(t!==this.selectedItem?.id){if(void 0===t)this.selectedItem=void 0,this.deepLearningParameters=void 0;else try{const e=await(0,a.aC)(t,this.portal);this.selectedItem=e,await this.loadItemProperties()}catch(e){this.value=void 0,"identity-manager:not-authorized"===e.name?this.errorMessage=this.strings.itemPermissionDenied:"request:server"===e.name&&"object"==typeof e.details&&null!==e.details&&"CONT_0001"===e.details.messageCode&&(this.errorMessage=this.strings.itemNotFound)}this.analysisItemInputChange.emit()}}validateOnValueChange(){this.validate()}get hasError(){return void 0!==this.errorMessage}get filterExpression(){return(0,l.m)(this.itemTypes,this.itemFilter)}get bucketOptions(){let e;if(void 0!==this.sharingLevels){e=[...this.sharingLevels];const t=e.indexOf("org-admin");t>=0&&(e.splice(t,1),"org_admin"!==this.user.role||e.includes("org")||e.push("org"))}return e}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.hydrateSelectedItem(this.value)}disconnectedCallback(){this.closeModals(),(0,l.r)(this.replaceTooltip),void 0!==this.itemBrowserElement&&(this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)}async checkValidity(){const e=this.validate();return Promise.resolve(e)}render(){const e=(0,a.y)(this.value)?this.renderInitialMode():this.renderSelection();return(0,s.h)(s.H,{key:"7a3c96d7089c8ff6f9b6c381c967805054ee3f45"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,e,(0,s.h)("calcite-input-message",{key:"e97f47bcec20c78ddcda79d0f88d0ce0ddf351d4",status:"invalid",scale:a.g.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.errorMessage))}renderSelection(){let e=void 0!==this.selectedItem;const t=this.selectedItem?.type;return!0!==this.portal.isPortal||t!==_&&t!==B||(e=!1),(0,s.h)("div",null,(0,s.h)("calcite-list",{label:"",selectionMode:"none"},(0,s.h)("calcite-list-item",{key:this.selectedItem?.id??"",value:this.selectedItem?.id,label:this.selectedItem?.title??"",class:Q.listItem,onMouseOver:this.onListItemMouseOver,onMouseOut:this.onListItemMouseOut,onClick:this.onListItemClick},void 0!==this.selectedItemIcon&&(0,s.h)("calcite-icon",{icon:this.selectedItemIcon,slot:"content-start"}),e&&(0,s.h)("calcite-action",{text:this.strings.viewDetails,label:this.strings.viewDetails,slot:"actions-end",icon:"launch",appearance:"transparent",onClick:()=>{if(void 0===this.selectedItem)return;const e=`${`${(0,a.W)(this.portal)}/home`}/item.html?id=${this.selectedItem.id}`;open(e,"_blank","noopener")}}),(0,s.h)("calcite-action",{text:this.strings.removeItem,slot:"actions-end",label:this.strings.removeItem,appearance:"transparent",icon:"x",onClick:this.clearSelectedItem}))),this.renderLoader())}async loadItemProperties(){if(void 0!==this.abortController&&this.abortController.abort(),this.deepLearningParameters=void 0,this.selectedItem?.type===_)try{this.abortController=new AbortController,this.isProcessingItem=!0,this.deepLearningParameters=await(0,a.aD)(this.selectedItem,this.portal,{signal:this.abortController.signal}),this.isProcessingItem=!1}catch(e){!1===(0,a.ax)(e)&&(this.isProcessingItem=!1,this.errorMessage=this.strings.queryModelArgsErrMsg)}}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["hydrateSelectedItem","validateOnValueChange"]}}};j.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.analysis-item-input__list-item{border:1px solid var(--analysis-ui-border-input);box-shadow:none;--calcite-font-size--1:var(--calcite-font-size--2)}.analysis-item-input__buttons-container{display:flex;flex-direction:row;flex-wrap:wrap;gap:var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.analysis-item-input__buttons-container>calcite-button{flex:1;max-width:100%}.analysis-item-input__label{cursor:pointer;padding-bottom:var(--analysis-half-spacing);margin-block-start:0;margin-block-end:0}.analysis-item-input__loader-container{font-size:var(--calcite-font-size--2)}.analysis-item-input__loader{margin-top:0.5rem}";const X=e=>{let t;const i=(0,a.l)(e.value)?e.value?.variable:void 0;return(0,s.h)(s.F,null,void 0!==e.label&&""!==e.label?(0,s.h)("analysis-label",{label:e.label,required:e.required,onAnalysisLabelHelpActionClick:()=>e.analysisHelpClick.emit(),onClick:()=>{t?.focus()},hideHelp:e.hideHelp,readOnly:e.readOnly,supportsVariables:e.supportsVariables,onShowVariableActionClick:()=>!0!==e.readOnly&&e.showVariableNodesClick?.emit()}):null,void 0!==i?((e,t)=>{const i=t.modelVariables?.find(t=>t.id===e);if(void 0===i)return t?.clearVariableById?.emit(e),null;const l=(0,a.P)(i?.value)?(i?.value).units:"";return(0,s.h)(s.F,null,(0,s.h)("variable-node-display",{variableNode:i,choiceLabel:t.choiceListLabels?.[l]??l,onClearVariable:e=>!0!==t.readOnly&&t?.clearVariableById?.emit(e.detail),onChangeNode:()=>!0!==t.readOnly&&t?.showVariableNodesClick?.emit(),readOnly:t.readOnly}))})(i,e):(0,s.h)("div",{class:"controls-container"},(0,s.h)("analysis-number-input",{ref:e=>t=e,class:"control",scale:e.scale,label:"",readOnly:e.readOnly,value:e.value?.distance??e.value?.area??e.value?.time,required:e.required,placeholderText:e.placeholderText??e.strings.inputPlaceholderText,min:e.minimum,max:e.maximum,excludeMinValue:e.excludeMinValue,excludeMaxValue:e.excludeMaxValue,choiceList:e.amountChoiceList,onAnalysisNumberInputChange:e.amountChange,numberType:e.numberType??"float"}),(0,s.h)("calcite-select",{scale:a.g.Scale,class:"control unit-select",dir:e.dir,disabled:e.readOnly,label:e.strings.unitSelect,onCalciteSelectChange:e.unitChanged},e.unitChoiceList?.map(t=>(0,s.h)("calcite-option",{value:t,label:void 0!==e.choiceListLabels?e.choiceListLabels[t]:t,selected:!1===(0,a.l)(e.value)&&e.value?.units===t})))))},K=class{constructor(e){(0,s.r)(this,e),this.analysisLinearUnitInputChange=(0,s.c)(this,"analysisLinearUnitInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.showVariableNodesClick=(0,s.c)(this,"showVariableNodesClick",7),this.clearVariableById=(0,s.c)(this,"clearVariableById",7),this.required=!1,this.readOnly=!1,this.hideHelp=!1,this.supportsVariables=!1,this.isValid=!0,this.distanceChange=e=>{const t=e?.target,i=t?.value,s=!1===(0,a.l)(this.value)?this.value?.units:void 0;void 0===t||Array.isArray(i)||"multi"===t.selectionMode||(void 0!==i&&"number"==typeof i?(this.value={units:s,distance:i},this.onUnitChoiceListChange()):this.value=void 0,this.analysisLinearUnitInputChange.emit())},this.unitChanged=e=>{const t=e?.target;this.value={distance:!1===(0,a.l)(this.value)?this.value?.distance:void 0,units:t?.value},this.validate(),void 0!==this.value?.distance&&this.analysisLinearUnitInputChange.emit()}}async onValueChange(){await this.validate()}get resolvedValue(){let e=this.value;if(void 0!==this.value&&(0,a.l)(this.value)){const{variable:t}=this.value,i=this.modelVariables?.find(e=>e.id===t);e=i?.value}return e}async onMinMaxChange(){(0,a.l)(this.value)&&await this.validate()}onUnitChoiceListChange(){if(!0===(0,a.l)(this.value))return;const e=this.value?.units;void 0===this.unitChoiceList||void 0!==e&&this.unitChoiceList.includes(e)||(this.value={distance:this.value?.distance,units:this.unitChoiceList[0]})}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.onUnitChoiceListChange(),!0===(0,a.l)(this.value)&&await this.validate()}async checkValidity(){return await this.validate(),Promise.resolve(this.isValid)}get formatOptions(){return{min:`${this.minimum??Number.MIN_SAFE_INTEGER}`,max:`${this.maximum??Number.MAX_SAFE_INTEGER}`}}async validate(){this.errorMessage=void 0;const e=this.hostElement.shadowRoot?.querySelector("analysis-number-input"),t=await(e?.checkValidity())??!1;if((0,a.l)(this.value)){const e=this.value?.variable,t=this.modelVariables?.find(t=>t.id===e);if(void 0!==t&&(0,a.P)(t.value)){const e=(0,l.f)(t.value.distance,{required:this.required,excludeMaxValue:this.excludeMaxValue,excludeMinValue:this.excludeMinValue,min:this.minimum??Number.MIN_SAFE_INTEGER,max:this.maximum??Number.MAX_SAFE_INTEGER});if(void 0!==e)return this.isValid=!1,void(this.errorMessage=void 0!==e?(0,a.a)(this.strings[e],this.formatOptions):void 0);const i=this.unitChoiceList?.includes(t.value.units);i||(this.isValid=!1,this.errorMessage=this.strings.choiceListBadInput)}}else{const e=!this.required||!1===(0,a.l)(this.value)&&void 0!==this.value?.units&&this.unitChoiceList?.includes(this.value?.units);this.isValid=t&&e}return Promise.resolve()}render(){!1===(0,a.l)(this.value)&&void 0!==this.value?.units&&(void 0===this.unitChoiceList||this.unitChoiceList.includes(this.value?.units)||(this.unitChoiceList=[...this.value?.units,...this.unitChoiceList]));const e=!1===this.isValid?a.r.INVALID:a.r.IDLE,t=void 0!==this.errorMessage;return(0,s.h)(s.H,{key:"b98e50ed6e2ecb61ec6898f9e0fc30c41ce0c46a"},(0,s.h)(X,{key:"0437868ac3fa3733141d38cbf06f60e8e320d084",label:this.label,required:this.required,value:this.value,minimum:this.minimum,maximum:this.maximum,excludeMinValue:this.excludeMinValue,excludeMaxValue:this.excludeMaxValue,placeholderText:this.placeholderText,strings:this.strings,dir:this.dir,unitChoiceList:this.unitChoiceList,hideHelp:this.hideHelp??!0,amountChoiceList:this.distanceChoiceList,amountChange:this.distanceChange,unitChanged:this.unitChanged,analysisHelpClick:this.analysisHelpClick,choiceListLabels:this.choiceListLabels,scale:a.g.Scale,readOnly:this.readOnly,modelVariables:this.modelVariables,supportsVariables:this.supportsVariables,showVariableNodesClick:this.showVariableNodesClick,clearVariableById:this.clearVariableById}),!1===this.readOnly&&(0,s.h)("calcite-input-message",{key:"76a2800bc52f65e383c8bd85e39c36a14f51de25",status:e,scale:a.g.Scale,hidden:!t,icon:"exclamationMarkTriangle"},this.errorMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["onValueChange"],minimum:["onMinMaxChange"],maximum:["onMinMaxChange"],excludeMinValue:["onMinMaxChange"],excludeMaxValue:["onMinMaxChange"],unitChoiceList:["onUnitChoiceListChange"]}}};K.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;--calcite-color-border-input:var(--analysis-ui-border-input)}.controls-container{display:flex;column-gap:5%}.control{flex:1 1 0}.text{cursor:pointer;padding-bottom:var(--analysis-quarter-spacing);margin-block-start:0;margin-block-end:0}.unit-select{margin-bottom:var(--analysis-half-spacing)}";const Z=class{constructor(e){(0,s.r)(this,e),this.analysisStringInputChange=(0,s.c)(this,"analysisStringInputChange",7),this.analysisStringInputComboboxBeforeOpen=(0,s.c)(this,"analysisStringInputComboboxBeforeOpen",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.showVariableNodesClick=(0,s.c)(this,"showVariableNodesClick",7),this.clearVariableById=(0,s.c)(this,"clearVariableById",7),this.segmentedItems=[],this.doCalciteInputChangeOnCommit=!1,this.choiceListPositioning="absolute",this.readOnly=!1,this.clearEnabled=!1,this.showAsRadioGroup=!1,this.showAsRadioButtonGroup=!1,this.showAsCheckList=!1,this.showSelectAllForCheckList=!1,this.showAsTextArea=!1,this.useDefaultOnReset=!1,this.allowCustomValues=!1,this.maxItems=10,this.hideHelp=!1,this.supportsVariables=!1,this.isValid=!0,this.layoutUpdating=!1,this.setErrorMessage=e=>{this.isValid=void 0===e,this.errorMessage=e},this.validateSingleInput=e=>{let t;if(!0===(0,a.P)(e)){if(void 0!==this.minLength&&e.length<(this.minLength??-1)&&(t=(0,a.a)(this.strings.minLengthError,{label:this.label,minLength:(0,a.M)(this.minLength??-1)})),void 0!==this.maxLength&&e.length>(this.maxLength??Number.MAX_SAFE_INTEGER)&&(t=(0,a.a)(this.strings.maxLengthError,{label:this.label,maxLength:(0,a.M)(this.maxLength??Number.MAX_SAFE_INTEGER)})),void 0!==this.invalidCharactersRegex){const i=(0,a.az)(this.invalidCharactersRegex);void 0!==i&&!0===i.test(e)&&(t=(0,a.a)(this.strings.invalidCharacterError,{label:this.label}))}const i=this.choiceList?.includes(e);!1===this.allowCustomValues&&void 0!==this.choiceList&&this.choiceList.length>0&&!1===i&&(t=(0,a.a)(this.strings.choiceListBadInput,{label:this.label}))}return this.setErrorMessage(t),void 0===t},this.validateInput=()=>{let e;const t=!0===(0,a.l)(this.value)?this.value?.variable:void 0,i=this.modelVariables?.find(e=>e.id===t),s=i?i.value:this.value;if("multi"!==this.selectionMode){const t=s??"";!0===this.required&&""===t?(e=(0,a.a)(this.strings.requiredError,{label:this.label}),this.setErrorMessage(e)):this.validateSingleInput(t)}else{const t=s??[];if(!0===this.required&&0===t.length)e=(0,a.a)(this.strings?.requiredError,{label:this.label}),this.setErrorMessage(e);else for(let e=0;e<t.length;e+=1){if(!1===this.validateSingleInput(t[e]??""))return}}},this.adjustLayout=()=>{const e=this.segmentedControl?.firstChild?.clientWidth;void 0!==e&&(this.layout=e*this.segmentedControl.childElementCount<this.hostElement.clientWidth?"horizontal":"vertical")},this.renderVariableDisplay=e=>{const t=this.modelVariables?.find(t=>t.id===e);if(void 0===t)return this.clearVariableById.emit(e),null;const i="string"==typeof t.value?t.value:"";return(0,s.h)("variable-node-display",{variableNode:t,choiceLabel:this.choiceListLabels?.[i]??i,onClearVariable:e=>!0!==this.readOnly&&this.clearVariableById.emit(e.detail),onChangeNode:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly})},this.renderInput=()=>{const e=this.doCalciteInputChangeOnCommit?{onCalciteInputChange:this.inputChanged}:{onCalciteInputInput:this.inputChanged},t=this.readOnly?void 0:this.placeholderText??this.strings.inputPlaceholderText;return(0,s.h)("calcite-input",{scale:a.g.Scale,type:this.showAsTextArea?"textarea":"text",readOnly:this.readOnly,value:this.value,status:this.isValid?a.r.VALID:a.r.INVALID,placeholder:t,...e})},this.renderCombobox=()=>{const e="multi"===this.selectionMode&&void 0===this.choiceList||!0===this.allowCustomValues;let t;t=!0===this.readOnly?a.r.IDLE:void 0!==this.errorMessage?a.r.INVALID:(0,a.a3)(this.validationParams?.type);const i=[];if(Array.isArray(this.choiceList)&&i.push(...this.choiceList),e&&(0,a.P)(this.initialValues)){const e=new Set(i),t="multi"===this.selectionMode?this.initialValues:[this.initialValues];for(const s of t)e.has(s)||i.push(s)}const l=!1===this.readOnly?"multi"===this.selectionMode?this.strings.multiSelectComboboxPlaceholderText:this.strings.comboboxPlaceholderText:void 0,r=this.readOnly?void 0:this.placeholderText??l;return(0,s.h)("calcite-combobox",{scale:a.g.Scale,status:t,label:this.strings.choiceList,disabled:this.readOnly,maxItems:this.maxItems,selectionMode:"multi"!==this.selectionMode?this.required?"single-persist":"single":"multiple",placeholder:r,placeholderIcon:this.placeholderIcon,overlayPositioning:this.choiceListPositioning,allowCustomValues:e,onCalciteComboboxBeforeOpen:this.analysisStringInputComboboxBeforeOpen.emit,onCalciteComboboxChange:this.comboboxChanged,clearDisabled:!1===this.clearEnabled&&"multi"!==this.selectionMode},i.map(e=>this.buildComboBoxItem(e)))},this.buildComboBoxItem=e=>{let t,i=!1;return i="multi"!==this.selectionMode?this.value===e:void 0!==this.value&&this.value.includes(e),t=void 0===this.choiceListLabels?e:this.allowCustomValues?this.choiceListLabels[e]??e:this.choiceListLabels[e],(0,s.h)("calcite-combobox-item",{key:e,value:e,textLabel:t,icon:void 0!==this.choiceListIcons?this.choiceListIcons[e]:void 0,selected:i,scale:a.g.Scale})},this.renderRadioGroup=()=>{const e=this.choiceList;return(0,s.h)("calcite-segmented-control",{class:"segmented-control",scale:a.g.Scale,onCalciteSegmentedControlChange:this.segmentedControlChange,ref:e=>this.segmentedControl=e,layout:this.layout,disabled:this.readOnly},e?.map(e=>this.buildRadioGroupItem(e)))},this.buildRadioGroupItem=e=>{const t=void 0!==this.choiceListLabels?this.choiceListLabels[e]:e;return(0,s.h)("calcite-segmented-control-item",{value:e,checked:e===this.value,ref:e=>{null!=e&&(e.focus=Function.prototype,this.segmentedItems.push(e))}},t)},this.renderRadioButtonGroup=()=>{const e=this.choiceList;return(0,s.h)("calcite-radio-button-group",{name:this.label,scale:a.g.Scale,layout:"vertical",onCalciteRadioButtonGroupChange:this.radioButtonGroupChange,disabled:this.readOnly},e?.map(e=>this.buildRadioButton(e)))},this.buildRadioButton=e=>{const t=void 0!==this.choiceListLabels?this.choiceListLabels[e]:e;return(0,s.h)("calcite-label",{layout:"inline",scale:a.g.Scale,class:"cursor"},(0,s.h)("calcite-radio-button",{value:e,checked:e===this.value,disabled:this.readOnly}),t)},this.renderCheckList=()=>(0,s.h)(s.F,null,this.showSelectAllForCheckList?this.renderCheckBox(!0,this.strings.selectAll):null,this.choiceList?.filter(e=>void 0!==e)?.map(e=>this.renderCheckBox(!1,e))),this.toggleCheckListSelectAll=e=>{const t=e.target.checked?[...this.choiceList??[]]:[];this.checkListChange(t)},this.toggleCheckBoxSingleSelection=(e,t)=>{let i=e;i=e.includes(t)?i.filter(e=>e!==t):[...i,t],this.checkListChange(i)},this.renderCheckBox=(e,t)=>{const i=e?this.strings.selectAll:this.choiceListLabels?.[t]??t,l=Array.isArray(this.value)?[...this.value]:[],r=e?l.length===this.choiceList?.length:l.includes(t),n=e&&!r&&l.length>0;return(0,s.h)("calcite-label",{layout:"inline",scale:a.g.Scale,class:"cursor"},(0,s.h)("calcite-checkbox",{disabled:this.readOnly,scale:a.g.Scale,value:i,checked:r,indeterminate:n,onCalciteCheckboxChange:i=>{e?this.toggleCheckListSelectAll(i):this.toggleCheckBoxSingleSelection(l,t)}}),i)},this.inputChanged=e=>{this.hasVariable||null!==e.target&&(this.value=e.target.value,this.validateInput(),this.analysisStringInputChange.emit())},this.comboboxChanged=e=>{if(this.hasVariable)return;const t=e.target;if(null!==t){if("multi"===this.selectionMode)this.value=t.selectedItems.filter(e=>void 0!==e?.value).map(e=>e.value);else{const[e]=t.selectedItems;this.value=e?.value}this.setErrorMessage(void 0),this.validateInput(),this.analysisStringInputChange.emit()}},this.segmentedControlChange=e=>{if(this.hasVariable)return;const t=e.target;null!==t&&(this.value=t.value??"",this.validateInput(),this.analysisStringInputChange.emit())},this.radioButtonGroupChange=e=>{this.hasVariable||null!==e?.target&&(this.value=e.target.selectedItem.value,this.validateInput(),this.analysisStringInputChange.emit())},this.checkListChange=e=>{this.hasVariable||(this.value=e,this.validateInput(),this.analysisStringInputChange.emit())}}updatedSelectionMode(){this.initialValues=this.value}onValueChange(e,t){let i=!1;void 0!==this.modelVariables&&(i=e===t||!(!Array.isArray(e)||!Array.isArray(t))&&(0,a.aE)(e,t),i||this.validateInput())}updatedChoiceList(e,t){if(!this.hasVariable&&!(0,n.v)(t,e)){let t=this.value;const i=(Array.isArray(t)?t:void 0!==t?[t]:[]).filter(t=>this.allowCustomValues||e?.includes(t));t="multi"===this.selectionMode?i:i[0],this.useDefaultOnReset&&0===i.length&&(t=void 0!==e?"multi"===this.selectionMode?[e[0]]:e[0]:void 0),(0,n.v)(t,this.value)||(this.value=t,this.analysisStringInputChange.emit())}}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),(0,a.P)(this.value)&&this.validateInput(),this.updatedChoiceList(this.choiceList,void 0),this.hasVariable||(this.initialValues=this.value)}async checkValidity(){return this.validateInput(),Promise.resolve(this.isValid)}componentDidLoad(){void 0!==this.segmentedControl&&(this.resizeObserver=new ResizeObserver(()=>{0!==this.hostElement.clientWidth?this.layoutUpdating?this.layoutUpdating=!1:(this.layoutUpdating=!0,this.adjustLayout()):this.layout="horizontal"}),this.resizeObserver.observe(this.hostElement)),setTimeout(()=>{this.segmentedItems.forEach(e=>delete e?.focus),this.segmentedItems=[]},250)}disconnectedCallback(){this.resizeObserver?.disconnect()}get hasVariable(){return!0===(0,a.l)(this.value)}render(){this.value??(this.value=this.initialValues);const e=this.hasVariable?this.value?.variable:void 0;let t;t=void 0!==e?this.renderVariableDisplay(e):void 0===this.choiceList||0===this.choiceList.length?"multi"!==this.selectionMode?this.renderInput():this.renderCombobox():!0===this.showAsCheckList?this.renderCheckList():"multi"!==this.selectionMode&&!0===this.showAsRadioGroup?this.renderRadioGroup():"multi"!=this.selectionMode&&!0===this.showAsRadioButtonGroup?this.renderRadioButtonGroup():this.renderCombobox();const i=!1===this.isValid,l=(0,a.a1)((0,a.a2)(this.strings,this.validationParams)),r=(0,a.P)(l)||!0===i,n=void 0!==this.errorMessage?a.r.INVALID:(0,a.a3)(this.validationParams?.type);return(0,s.h)(s.H,{key:"cba9ddfa6f4ed76a67d2b6d9099602ba37cb48c2"},(0,s.h)("calcite-label",{key:"a957511ab1cd52202c723086ac59aa988c060f9b",class:"label",scale:a.g.Scale},""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp,supportsVariables:this.supportsVariables,onShowVariableActionClick:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly}):null,t,(0,s.h)("calcite-input-message",{key:"d67d83fa18e1163c556eec5b80d68d763a8c8298",status:n,hidden:!r||this.readOnly,scale:a.g.Scale,icon:"exclamationMarkTriangle"},this.errorMessage??l)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{selectionMode:["updatedSelectionMode"],value:["onValueChange"],choiceList:["updatedChoiceList"]}}};Z.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;width:var(--analysis-component-default-width);--calcite-color-border-input:var(--analysis-ui-border-input)}.label{width:var(--analysis-component-default-width)}.segmented-control:not([layout]){visibility:hidden;position:absolute}.cursor{cursor:pointer}";const Y="now",J="custom",ee="unspecified",te="UTC",ie="GeoLocal",se=class{constructor(e){(0,s.r)(this,e),this.analysisTrafficTimeInputChange=(0,s.c)(this,"analysisTrafficTimeInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.value={timeOfDay:a.aF,timeZoneForTimeOfDay:te},this.readOnly=!1,this.isValid=!0,this.resetTimeZoneValue=!1,this.validateSelection=async()=>{let e=!0;this.selectedTimeMode===J&&!0===this.required?(void 0!==this.dateInputElement&&(e=await this.dateInputElement.checkValidity()),this.isValid=e&&void 0!==this.value):this.isValid=e},this.setSelectedTimeMode=e=>{switch(e?.timeZoneForTimeOfDay){case void 0:const t={timeOfDay:void 0,timeZoneForTimeOfDay:void 0};this.value={...t},this.selectedTimeMode=ee;break;case ie:const i=e.timeOfDay;if(void 0!==i&&"number"==typeof i){const e={timeOfDay:i,timeZoneForTimeOfDay:ie};this.value={...e}}this.selectedTimeMode=J;break;default:const s=e??{timeOfDay:a.aF,timeZoneForTimeOfData:te};s.timeOfDay=a.aF,this.value={...s},this.selectedTimeMode=Y}this.analysisTrafficTimeInputChange.emit()},this.renderDatePicker=()=>this.selectedTimeMode===J?(0,s.h)("analysis-date-input",{label:"",required:this.required,onAnalysisDateInputChange:this.datePickerChange,ref:e=>{this.dateInputElement=e},value:this.value?.timeOfDay,readOnly:this.readOnly}):null,this.timeSelectChange=()=>{switch(this.selectedTimeMode=this.timeSelectElement.value,this.selectedTimeMode){case Y:this.value={timeOfDay:a.aF,timeZoneForTimeOfDay:te};break;case ee:this.value={timeOfDay:void 0,timeZoneForTimeOfDay:void 0};break;case J:const e=this.value?.timeOfDay;this.value={timeOfDay:e,timeZoneForTimeOfDay:ie}}this.analysisTrafficTimeInputChange.emit()},this.datePickerChange=()=>{if(this.selectedTimeMode===J){const e=this.dateInputElement?.value;this.value={timeOfDay:e,timeZoneForTimeOfDay:ie},this.analysisTrafficTimeInputChange.emit()}}}resetTimeZoneValueChange(e){!0===e&&(this.value={timeOfDay:void 0,timeZoneForTimeOfDay:void 0},this.setSelectedTimeMode(this.value))}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.setSelectedTimeMode(this.value)}async checkValidity(){return await this.validateSelection(),Promise.resolve(this.isValid)}render(){return(0,s.h)(s.H,{key:"e86e4acbe9d98af3830e0b1c7d5b820db84e48f2"},(0,s.h)("calcite-label",{key:"9935e478d0927597154eabcc8eb40868fa6faaf4",class:"label",scale:a.g.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-select",{key:"3cd2941b6abf9a76f23cacd98f32328466f921a0",value:this.selectedTimeMode,scale:a.g.Scale,label:this.label??this.strings.arriveTime,onCalciteSelectChange:this.timeSelectChange,ref:e=>this.timeSelectElement=e,disabled:this.readOnly},(0,s.h)("calcite-option",{key:"8d80a848e6a3ce9e12a49872d79df9545d261f4e",selected:"UTC"===this.value?.timeZoneForTimeOfDay,value:Y},this.strings.modes.now),(0,s.h)("calcite-option",{key:"ef046c91a444a1b304b163f66a7b5287fd40f28d",selected:"GeoLocal"===this.value?.timeZoneForTimeOfDay,value:J},this.strings.modes.custom),(0,s.h)("calcite-option",{key:"68b6a7f46878df1e1c0e0ee19572503b6863d7c8",selected:void 0===this.value?.timeZoneForTimeOfDay,value:ee},this.strings.modes.unspecified))),this.renderDatePicker())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{resetTimeZoneValue:["resetTimeZoneValueChange"]}}};se.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;width:var(--analysis-component-default-width);--calcite-color-border-input:var(--analysis-ui-border-input)}.label{width:var(--analysis-component-default-width)}";const ae=e=>!("isConnected"in e)||e.isConnected,le=((e,t)=>{let i;return(...s)=>{i&&clearTimeout(i),i=setTimeout(()=>{i=0,e(...s)},t)}})(e=>{for(let t of e.keys())e.set(t,e.get(t).filter(ae))},2e3),re=e=>"function"==typeof e?e():e,ne=(e,t)=>{const i=e.indexOf(t);i>=0&&(e[i]=e[e.length-1],e.length--)},oe=((e,t)=>{const i=((e,t=(e,t)=>e!==t)=>{const i=re(e);let s=new Map(Object.entries(i??{}));const a={dispose:[],get:[],set:[],reset:[]},l=new Map,r=()=>{s=new Map(Object.entries(re(e)??{})),a.reset.forEach(e=>e())},n=e=>(a.get.forEach(t=>t(e)),s.get(e)),o=(e,i)=>{const l=s.get(e);t(i,l,e)&&(s.set(e,i),a.set.forEach(t=>t(e,i,l)))},h="undefined"==typeof Proxy?{}:new Proxy(i,{get:(e,t)=>n(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,i)=>(o(t,i),!0)}),c=(e,t)=>(a[e].push(t),()=>{ne(a[e],t)});return{state:h,get:n,set:o,on:c,onChange:(t,i)=>{const s=(e,s)=>{e===t&&i(s)},a=()=>i(re(e)[t]),r=c("set",s),n=c("reset",a);return l.set(i,{setHandler:s,resetHandler:a,propName:t}),()=>{r(),n(),l.delete(i)}},use:(...e)=>{const t=e.reduce((e,t)=>(t.set&&e.push(c("set",t.set)),t.get&&e.push(c("get",t.get)),t.reset&&e.push(c("reset",t.reset)),t.dispose&&e.push(c("dispose",t.dispose)),e),[]);return()=>t.forEach(e=>e())},dispose:()=>{a.dispose.forEach(e=>e()),r()},reset:r,forceUpdate:e=>{const t=s.get(e);a.set.forEach(i=>i(e,t,t))},removeListener:(e,t)=>{const i=l.get(t);i&&i.propName===e&&(ne(a.set,i.setHandler),ne(a.reset,i.resetHandler),l.delete(t))}}})(e,t);return i.use((()=>{if("function"!=typeof s.e)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const i=(0,s.e)();i&&((e,t,i)=>{const s=e.get(t);s?s.includes(i)||s.push(i):e.set(t,[i])})(e,t,i)},set:t=>{const i=e.get(t);i&&e.set(t,i.filter(s.f)),le(e)},reset:()=>{e.forEach(e=>e.forEach(s.f)),le(e)}}})()),i})({activeSketchToolName:""}),he="flex-container",ce="primary-button",de="border",pe="warning-message",ue="loading-message-wrapper",me="loading-sketch-message",ye="loader",ge="list-item",ve=class{constructor(e){(0,s.r)(this,e),this.analysisLayerInputChange=(0,s.c)(this,"analysisLayerInputChange",7),this.analysisLayerInputClose=(0,s.c)(this,"analysisLayerInputClose",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.hideAddToMap=!1,this.required=!1,this.enableSketch=!1,this.ignoreTimeExtent=!1,this.mapLayers=[],this.hideModelVariableLayers=!1,this.processedLayerProperties={},this.descriptionDisplay="featureCount",this.hideBrowseButton=!1,this.hideHelp=!1,this.creationMode="browse",this.readOnly=!1,this.canCreateAnalysisSketch=!1,this.isSketchLoading=!0,this.featureCounts=new Map,this.browsedLayers=[],this.replaceId=null,this.filteredMapLayers=[],this.filteredModelVariables=[],this.modelVariableLayers=[],this.showNoticeMessage=!1,this.noticeMessage=[],this.warningMessageForPopover=[],this.refreshHandlers=[],this.dataUpdatingHandlers=[],this.filterFeatureLayers=e=>e.filter(e=>void 0!==e&&(0,a.a8)(e)&&e.loaded),this.updateWarningMessage=(e,t)=>{const i=t.length-e.length;if(this.warningMessage=void 0,i>0){const s=new Map(this.mapLayers.map(e=>[e.id,e])),l=t.find(t=>!e.includes(t))??"",r=s.get(l)?.title??"",n=1===i?this.strings.layerNotAvailable:this.strings.multipleLayersNotAvailable;this.warningMessage=(0,a.a)(n,{layerName:r})}},this.syncValueWithIds=async()=>{const e=[...this.browsedLayers??[],...this.mapLayers??[],...this.modelVariableLayers??[]],t=[],i=[],s="multi"!==this.selectionMode;for(const s of this.selectedLayerIds??[]){const l=e.find(e=>s===e.id),r=this.modelVariables?.some(e=>s===e.id);if(void 0!==l){let e;i.push(l),!0===r?e={variable:s}:(0,a.a8)(l)?e=await(0,a.aG)(l,this.mapView):(0,a.aH)(l)||(0,a.aI)(l)?e=(0,a.aJ)(l):(0,a.aK)(l)&&(e=(0,a.aL)(l)),void 0!==e&&t.push(e)}}if(this.value=s?t[0]:t,this.selectedLayers=s?i[0]:i,this.processedLayerProperties={},s||Array.isArray(this.selectedLayers)&&1===this.selectedLayers.length){const e=i[0];if(void 0!==e&&((0,a.aH)(e)||(0,a.aI)(e)))this.processedLayerProperties=await(0,a.aM)(e);else if(void 0!==e&&(0,a.a8)(e)){const t=(0,a.a9)(e).fields,i=t?.map(e=>e.name);this.processedLayerProperties.fieldNames=i}}this.analysisLayerInputChange.emit({creationMode:this.creationMode})},this.renderInitialMode=()=>(this.removeTooltip(),(0,s.h)("section",null,void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}):null,this.renderButton())),this.renderErrorMessage=()=>{const e=(0,a.P)(this.validationParams?.message)||void 0!==this.errorMessage,t=(0,a.a1)((0,a.a2)(this.strings,this.validationParams)),i=void 0!==this.validationParams?(0,a.a3)(this.validationParams.type):a.r.INVALID;return(0,s.h)("calcite-input-message",{status:i,hidden:!e,scale:a.g.Scale,icon:"exclamationMarkTriangle"},t??this.errorMessage)},this.renderWarningMessage=()=>void 0!==this.warningMessage?(0,s.h)("calcite-input-message",{icon:"exclamationMarkTriangle",scale:a.g.Scale},(0,s.h)("div",{class:pe},this.warningMessage)):null,this.renderSketchLoadingMessage=()=>!0===this.canCreateAnalysisSketch&&!0===this.isSketchLoading&&(0,s.h)("div",{class:ue},(0,s.h)("calcite-loader",{class:ye,scale:a.g.Scale,label:this.strings.loadingSketch}),(0,s.h)("p",{class:me},this.strings.loadingSketch)),this.handleAnalysisSketchToolsRendered=()=>{this.isSketchLoading=!1,this.setupOutsideSketchClickListener()},this.handleAnalysisSketchLayerChange=e=>{const t=e.detail;(0,a.P)(t)&&(this.currentSketchLayerId=t.id,this.selectedLayers=[t])},this.handleAnalysisSketchRemove=async()=>{await this.removeAnalysisSketch()},this.renderCreateSketchButton=()=>(0,s.h)(s.F,null,(0,s.h)("calcite-button",{ref:e=>{void 0!==e&&(this.createSketchButtonRef=e)},scale:a.g.Scale,appearance:"outline",kind:"neutral",iconStart:"pencil-mark",onClick:this.onCreateSketchButtonClicked,label:this.strings.createSketch}),(0,s.h)("calcite-tooltip",{dir:this.dir,overlayPositioning:"fixed",ref:e=>this.sketchButtonTooltipRef=e,referenceElement:this.createSketchButtonRef,placement:"top"},this.strings.drawInputFeatures)),this.removeAnalysisSketch=async()=>{void 0!==this.analysisSketch&&(document.removeEventListener("click",this.handleClickedOutsideSketch),await(this.analysisSketch?.removeSketch()),this.analysisSketch?.remove(),this.analysisSketch=void 0,this.canCreateAnalysisSketch=!1,this.isSketchLoading=!0)},this.setupOutsideSketchClickListener=()=>{document.addEventListener("click",this.handleClickedOutsideSketch),oe.onChange("activeSketchToolName",async e=>{this.analysisSketchToolName!==e&&await this.removeAnalysisSketch()})},this.handleClickedOutsideSketch=async e=>{e.target.tagName.includes("ANALYSIS-")&&await this.removeAnalysisSketch()},this.onCreateSketchButtonClicked=e=>{e.stopPropagation(),this.analysisSketchToolName=`${this.toolTitle?.trim()??""} ${this.label}`,oe.state.activeSketchToolName=this.analysisSketchToolName,this.canCreateAnalysisSketch=!0},this.renderButton=()=>(0,s.h)("div",{class:he},(0,s.h)("calcite-button",{class:ce,appearance:"outline",kind:"neutral",scale:a.g.Scale,iconStart:"add-layer",disabled:this.readOnly,onClick:this.primaryButtonClicked},this.strings.layer),!0===this.enableSketch&&!(0,l.v)(this.mapView)&&this.renderCreateSketchButton()),this.renderListMode=()=>{const e=Array.isArray(this.selectedLayers)?this.selectedLayers:[this.selectedLayers];return(0,s.h)("section",null,(0,s.h)("calcite-label",null,void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-list",{class:de,label:"",selectionMode:"none",disabled:this.readOnly,onClick:this.replaceLayer,onMouseOver:this.mouseOver,onMouseOut:this.mouseOut},e.map(e=>this.renderListModeItem(e)))),"multi"===this.selectionMode?this.renderButton():null)},this.renderListModeItem=e=>{const t=void 0!==this.modelVariables,i=this.modelVariables?.find(t=>t.id===e.id);if(t&&(0,a.l)(this.value)&&void 0===i)return this.handleRemove(this.value.variable),null;const l=(0,a.aa)(e),r=i?.name??"";let n="";if((0,a.a8)(e)&&!0!==i?.isDerived&&"featureCount"===this.descriptionDisplay&&!(0,a.a7)(e)){const s=t?this.strings.countOfStyled:this.strings.countOf,l=this.featureCounts.get(i?.id??e.id)??this.strings.numberFeaturesLoading;l===this.strings.numberFeaturesLoading&&this.updateFeatureCounts([e]),n=(0,a.a)(s,{featureCount:l})}else if("spatialReference"===this.descriptionDisplay){const t=(0,a.a9)(e),i=(t.fullExtent?.spatialReference).latestWkid;n=this.wkidMap.get(i)??""}const o=(0,a.a)(this.strings.layerAction,{layerName:l}),h=(0,a.N)((0,a.a7)(e)?"":l),c=t?this.strings.valueOfStyled:this.strings.valueOf,d=(0,a.a)(c,{val:h});return(0,s.h)("calcite-list-item",{class:ge,key:e.id,value:e.id,label:l},void 0!==this.selectedLayerIcon&&(0,s.h)("calcite-icon",{icon:this.selectedLayerIcon,slot:"content-start"}),(0,s.h)("div",{slot:"content",style:{pointerEvents:"none",lineBreak:"anywhere"},class:t?"mb content":"analysis content"},(0,s.h)("div",null,""!==r&&!1===this.hideModelVariableLayers?r:l),""!==r&&!0!==i?.isDerived&&!1===this.hideModelVariableLayers&&(0,s.h)("div",{innerHTML:d}),""!==n&&(0,s.h)("div",{innerHTML:n})),!1===this.readOnly&&(0,s.h)("calcite-action",{text:o,slot:"actions-end",label:o,appearance:"transparent",icon:"x",onClick:()=>this.handleRemove(i?.id??e.id)}))},this.layerSelectionChange=async e=>{this.creationMode="list","multi"!==this.selectionMode&&((0,l.r)(this.layerInputPopover),this.layerInputPopover=void 0);const t=e.detail;if(null===this.replaceId){const e=(this.selectedLayerIds??[]).filter(e=>this.browsedLayers.some(t=>t.id===e));this.selectedLayerIds=[...t,...e]}else this.browsedLayers=this.browsedLayers.map(e=>this.replaceId===e.id?void 0:e).filter(e=>void 0!==e),this.selectedLayerIds=this.selectedLayerIds?.map(e=>e===this.replaceId?t?.[0]:e),this.replaceId=null;const i=this.selectedLayerIds?.find(e=>e===this.currentSketchLayerId);void 0===i&&await this.removeAnalysisSketch(),await this.syncValueWithIds(),await this.validate()},this.handleLayerBrowsed=async e=>{this.creationMode="browse","multi"!==this.selectionMode?(this.browsedLayers=e.detail,this.selectedLayers=this.browsedLayers[0]):null===this.replaceId?(this.browsedLayers=[...this.browsedLayers,...e.detail],this.selectedLayers=[...this.selectedLayers??[],...this.browsedLayers]):(this.browsedLayers=this.browsedLayers.map(t=>this.replaceId===t.id?e.detail[0]:t),this.selectedLayers=this.selectedLayers?.map(t=>this.replaceId===t.id?e.detail[0]:t),this.replaceId=null),await this.validate()},this.primaryButtonClicked=e=>{this.createLayerPopover(e.currentTarget)},this.replaceLayer=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(this.replaceId=t.value,this.createLayerPopover(t),void 0!==this.layerInputPopover&&null!==this.replaceId&&(this.layerInputPopover.selectedIds=[this.replaceId]))},this.handleRemove=async e=>{this.selectedLayerIds=this.selectedLayerIds?.filter(t=>t!==e),this.browsedLayers=this.browsedLayers.filter(t=>t.id!==e),this.analysisLayerInputClose.emit(),await this.removeAnalysisSketch(),await this.syncValueWithIds(),await this.validate()},this.mouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.strings.replaceLayer),this.replaceTooltip.referenceElement=t,(0,l.b)(document,this.replaceTooltip))},this.mouseOut=()=>{this.removeTooltip()},this.layerPopoverClose=async()=>{this.replaceId=null,(0,l.r)(this.layerInputPopover),this.layerInputPopover=void 0,await this.validate()},this.validate=async()=>{this.warningMessage=void 0,this.errorMessage=void 0;const e=(0,a.a1)((0,a.a2)(this.strings,this.validationParams));if(!1===(!this.required||void 0!==this.selectedLayers&&(!Array.isArray(this.selectedLayers)||this.selectedLayers.length>0)))return void(this.errorMessage=void 0!==this.validationParams?.message?e:(0,a.a)(this.strings.isRequired,{label:this.label??this.strings.layer}));const t=(0,a.l)(this.value),i=Array.isArray(this.selectedLayers)?this.selectedLayers:[this.selectedLayers];if(t){if((0,a.a7)(i[0]))return;const{filteredLayers:t}=await(0,a.d)({layers:i,layerFilterTypes:this.layerFilterType,user:this.user}),{filteredLayers:s}=(0,l.g)({layers:i,layerFilterTypes:this.layerFilterType}),r=t.length>0;if(s.length>0)return void(this.errorMessage=void 0!==this.validationParams?.message?e:this.strings.dataTypeMismatch);if(r)return void(this.errorMessage=void 0!==this.validationParams?.message?e:this.strings.geometryMismatch)}void 0!==this.selectedLayerFeatureCount&&(void 0!==this.minimumFeatureCount&&this.selectedLayerFeatureCount<this.minimumFeatureCount&&(this.errorMessage=void 0!==this.validationParams?.message?e:(0,a.a)(this.strings.featureCountBelowMinimum,{label:this.label,minimum:this.minimumFeatureCount.toString()})),void 0!==this.maximumFeatureCount&&this.selectedLayerFeatureCount>this.maximumFeatureCount&&(this.errorMessage=void 0!==this.validationParams?.message?e:(0,a.a)(this.strings.featureCountAboveMaximum,{label:this.label,maximum:this.maximumFeatureCount.toString()})))},this.removeTooltip=()=>{(0,l.r)(this.replaceTooltip)},this.updateFeatureCounts=e=>{const{countExtent:t,mapView:i,ignoreTimeExtent:s}=this,l=this.filterFeatureLayers(e).map(async e=>{let l;try{"mapExtent"!==this.countExtent&&(l=(await(0,a.aN)(e,i,s,t)).toString())}catch(e){l="AbortError"===e?.name?this.strings.numberFeaturesLoading:this.strings.unavailable}return[e.id,l]});return Promise.all(l).then(e=>{const t=e.filter(([,e])=>void 0!==e),i=[...this.featureCounts].filter(([e])=>this.selectedLayerIds?.includes(e));this.featureCounts=new Map([...i,...t])}).catch(()=>{})},this.updateFeatureCountsLayerView=async e=>{const t=(0,a.aO)().debounce((e,t)=>{e.queryFeatureCount({geometry:this.mapView.extent}).then(e=>{this.featureCounts.set(t,e.toString()),this.featureCounts=new Map(this.featureCounts)})});this.dataUpdatingHandlers.forEach(e=>e.remove()),this.dataUpdatingHandlers=[];const i=(0,a.am)(),s=this.filterFeatureLayers(e);for(const e of s){if(this.currentSketchLayerId===e.id)t(e,e.id),this.dataUpdatingHandlers.push(i.watch(()=>[this.mapView.viewpoint],t.bind(this,e,e.id)));else{const s=await this.mapView.whenLayerView(e);t(s,e.id),this.dataUpdatingHandlers.push(i.watch(()=>[this.mapView.viewpoint],t.bind(this,s,e.id))),this.dataUpdatingHandlers.push(i.watch(()=>[!s.dataUpdating],t.bind(this,s,e.id)))}}}}async mapLayersChange(e,t){this.warningMessageForPopover=[];const i=void 0!==this.selectedLayerIds?.find(e=>e===this.currentSketchLayerId),s=void 0===e.find(e=>e?.id===this.currentSketchLayerId);e.length!==t?.length&&!0===i&&!0===s&&(this.selectedLayerIds=this.selectedLayerIds?.filter(e=>e!==this.currentSketchLayerId),await this.syncValueWithIds());const{proxyAllowedLayers:l,filteredLayersByType:r,filteredLayersAllowAnalysis:n}=await(0,a.aP)(e,this.layerFilterType,this.user?.portal);if(n.length<e.length){this.noticeMessage=[];const t=l.length<e.length,i=n.length<r.length;t&&this.warningMessageForPopover.push("proxyReason"),i&&this.warningMessageForPopover.push("allowAnalysisReason")}this.showNoticeMessage=this.warningMessageForPopover.length>0,this.filteredMapLayers=n.filter(e=>e.loaded),void 0!==this.layerInputPopover&&(this.layerInputPopover.mapLayers=this.filteredMapLayers)}async modelVariablesChange(e){if(this.modelVariableLayers=e?.map(e=>e.layer).filter(e=>void 0!==e)??[],void 0===e)return void(this.filteredModelVariables=[]);const t=Object.groupBy(e,({isDerived:e})=>!0===e?"derived":"nonDerived"),{validLayers:i}=(0,l.g)({layers:t.derived?.map(e=>e.layer).filter(e=>void 0!==e)??[],layerFilterTypes:this.layerFilterType}),s=[];i.forEach(t=>{const i=e.find(e=>e.id===t.id);void 0!==i&&s.push(i)});const{validLayers:r}=await(0,a.d)({layers:t.nonDerived?.map(e=>e.layer).filter(e=>void 0!==e)??[],layerFilterTypes:this.layerFilterType,user:this.user}),n=[];r.forEach(t=>{const i=e.find(e=>e.id===t.id);void 0!==i&&n.push(i)}),this.filteredModelVariables=[...n,...s],void 0===this.layerInputPopover||this.hideModelVariableLayers||(this.layerInputPopover.modelVariables=this.filteredModelVariables)}async selectedLayersChange(e,t){if((0,a.P)(e)&&!(0,n.v)(e,t)){let t=Array.isArray(e)?e:[e];"featureCount"===this.descriptionDisplay&&("mapExtent"===this.countExtent?this.updateFeatureCountsLayerView(t):this.updateFeatureCounts(t)),this.refreshHandlers.forEach(e=>e.remove()),this.refreshHandlers=this.filterFeatureLayers(t).map(e=>(0,a.a9)(e).on("refresh",e=>{e.dataChanged&&("mapExtent"===this.countExtent?this.updateFeatureCountsLayerView(t):this.updateFeatureCounts(t))}));const i=t.map(e=>e.id),s=await Promise.allSettled(t.map(e=>e?.loaded?Promise.resolve(e):e?.load?.()));t=s.filter(e=>"fulfilled"===e.status).map(e=>e.value);const l=t.filter(e=>e.loaded).map(e=>e.id);this.updateWarningMessage(l,i),this.selectedLayerIds=Array.from(new Set(l));const r=this.featureCounts.get(this.selectedLayerIds?.[0]??"");void 0!==r&&"multi"!==this.selectionMode&&(this.selectedLayerFeatureCount=parseInt(r)),await this.syncValueWithIds(),void 0===this.warningMessage&&this.validate()}else this.dataUpdatingHandlers.forEach(e=>e.remove())}async layerFilterTypeChange(e,t){(0,n.v)(e,t)||await this.mapLayersChange(this.mapLayers)}externalBrowsedLayersChange(e){this.browsedLayers=[...e??[],...this.browsedLayers]}async countExtentChange(e,t){if(void 0===this.selectedLayers||(0,n.v)(e,t))return;const i=Array.isArray(this.selectedLayers)?this.selectedLayers:[this.selectedLayers];"mapExtent"===e?this.updateFeatureCountsLayerView(i):(this.dataUpdatingHandlers.forEach(e=>e.remove()),await this.updateFeatureCounts(i))}onFeatureCountChange(){if(void 0!==this.selectedLayerIds&&this.selectedLayerIds.length>0&&"multi"!==this.selectionMode){const e=this.featureCounts.get(this.selectedLayerIds[0]);void 0!==e&&this.selectedLayerFeatureCount!==parseInt(e)&&(this.selectedLayerFeatureCount=parseInt(e),this.analysisLayerInputChange.emit({creationMode:this.creationMode}))}}async checkValidity(){await this.validate();const e=void 0===this.errorMessage&&(void 0===this.validationParams?.message||"informative"===this.validationParams.type);return Promise.resolve(e)}componentDidRender(){(0,a.P)(this.sketchButtonTooltipRef)&&(0,a.P)(this.createSketchButtonRef)&&(this.sketchButtonTooltipRef.referenceElement=this.createSketchButtonRef)}disconnectedCallback(){(0,l.r)(this.layerInputPopover),(0,l.r)(this.replaceTooltip),document.removeEventListener("click",this.handleClickedOutsideSketch),this.refreshHandlers.forEach(e=>e.remove()),this.dataUpdatingHandlers.forEach(e=>e.remove())}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.wkidMap=(0,a.aQ)(),this.browsedLayers=[...this.externalBrowsedLayers??[],...this.browsedLayers],void 0!==this.modelVariables&&await this.modelVariablesChange(this.modelVariables),void 0!==this.mapLayers&&await this.mapLayersChange(this.mapLayers),await this.selectedLayersChange(this.selectedLayers,void 0)}get isInitialMode(){return void 0===this.selectedLayerIds||0===this.selectedLayerIds.length||void 0===this.selectedLayers}render(){return(0,s.h)(s.H,{key:"32914e6b3a8cd747ec771134d32840058815fa15"},(0,s.h)(s.F,{key:"53c1cb26496b1e618ad9b4ad8d1f1223750ea0b2"},!0===this.canCreateAnalysisSketch&&(0,s.h)("analysis-sketch",{key:"725a670228ce9ea1b1c26fc9f939ebe2cedaf336",ref:e=>{void 0!==e&&(this.analysisSketch=e)},referenceElement:this.hostElement,label:this.label,toolTitle:this.toolTitle,layerFilterType:this.layerFilterType,mapView:this.mapView,mapLayers:this.filteredMapLayers,onAnalysisSketchToolsRendered:this.handleAnalysisSketchToolsRendered,onAnalysisSketchLayerChange:this.handleAnalysisSketchLayerChange,onAnalysisSketchRemove:this.handleAnalysisSketchRemove}),this.isInitialMode?this.renderInitialMode():this.renderListMode(),!1===this.readOnly&&this.renderErrorMessage(),!1===this.readOnly&&this.renderWarningMessage(),this.renderSketchLoadingMessage()))}createLayerPopover(e){const t=(0,l.v)(this.mapView)&&null!=this.layerFilterType?(0,l.h)(this.layerFilterType):this.layerFilterType;void 0===this.layerInputPopover&&(this.layerInputPopover=document.createElement("analysis-layer-input-popover"),this.layerInputPopover.addEventListener("analysisLayerInputPopoverClose",this.layerPopoverClose),this.layerInputPopover.addEventListener("analysisLayerInputPopoverSelectionChange",this.layerSelectionChange),this.layerInputPopover.addEventListener("analysisLayerInputPopoverLayerBrowsed",this.handleLayerBrowsed)),!0===this.isInitialMode||"calcite-button"===e.localName?(this.layerInputPopover.selectionMode=this.selectionMode,void 0!==this.selectedLayerIds&&(this.layerInputPopover.selectedIds=[...this.selectedLayerIds])):this.layerInputPopover.selectionMode="single",this.layerInputPopover.mapLayers=this.filteredMapLayers,this.hideModelVariableLayers||(this.layerInputPopover.modelVariables=this.filteredModelVariables),this.layerInputPopover.hideModelVariableLayers=this.hideModelVariableLayers,this.layerInputPopover.hideAddToMap=this.hideAddToMap,this.layerInputPopover.itemBrowserFilter=(0,l.j)(t),this.layerInputPopover.itemBrowserQ=(0,l.k)(this.mapView,t,this.user?.orgId??void 0),this.layerInputPopover.itemBrowserAllowedGeometries=(0,l.l)(t),this.layerInputPopover.layerFilterType=t,this.layerInputPopover.showNoticeMessage=this.showNoticeMessage;const i=this.warningMessageForPopover.map(e=>{const t="allowAnalysisReason"===e?"allowAnalysis":"supportedData",i=!0===this.user?.portal?.isPortal&&void 0!==this.portalHelpMap?this.portalHelpMap?.m[r.n.map.OtherHelpLinks[t]]:r.m.map.OtherHelpLinks[t],s=(0,a.G)({url:i,basePath:(0,a.Z)(this.user?.portal),portalUrl:this.user?.portal?.restUrl});return(0,a.a)(this.strings[e],{docLink:s})});this.layerInputPopover.noticeMessage=[...this.noticeMessage,...i],this.layerInputPopover.placement="leading",this.layerInputPopover.dir=this.dir,this.layerInputPopover.hideBrowseButton=this.hideBrowseButton,this.layerInputPopover.referenceElement=e.parentElement??e,this.layerInputPopover.popoverWidth=this.popoverWidth??e.parentElement?.offsetWidth,this.layerInputPopover.mapView=this.mapView,void 0!==this.user&&(this.layerInputPopover.user=this.user,this.layerInputPopover.portal=this.user?.portal),(0,l.b)(document,this.layerInputPopover)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{mapLayers:["mapLayersChange"],modelVariables:["modelVariablesChange"],selectedLayers:["selectedLayersChange"],layerFilterType:["layerFilterTypeChange"],externalBrowsedLayers:["externalBrowsedLayersChange"],countExtent:["countExtentChange"],featureCounts:["onFeatureCountChange"]}}};ve.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;width:var(--analysis-component-default-width);margin-bottom:var(--analysis-half-spacing);--calcite-label-margin-bottom:0;--layer-selected-margin-bottom:var(--analysis-half-spacing)}:host([hidden]){display:none}.flex-container{display:flex;width:var(--analysis-component-default-width);column-gap:3%}.primary-button{flex:1 1 auto}.secondary-button{flex:auto 1 auto}.text{padding-bottom:var(--analysis-quarter-spacing);margin-block-start:0;margin-block-end:0}.border{border:1px solid var(--analysis-ui-border-input);margin-bottom:var(--layer-selected-margin-bottom)}.warning-message{word-wrap:break-word;overflow-wrap:anywhere}.loading-message-wrapper{margin-top:var(--analysis-half-spacing);display:flex;justify-content:center;gap:1rem}.loading-message-wrapper .loading-sketch-message{margin:0}.loading-message-wrapper .loader{--calcite-loader-size:1rem;margin:0;padding:0}.list-item .content.mb{color:var(--calcite-color-text-3);font-size:var(--calcite-font-size--2);font-weight:var(--calcite-font-weight-medium)}.list-item .content.analysis{--calcite-font-size--1:var(--calcite-font-size--2)}.list-item .content div:first-child{color:var(--calcite-color-text-1)}";const fe="calcite-chip",be="calcite-list-item",Ce=class{constructor(e){(0,s.r)(this,e),this.analysisSummaryFieldsChange=(0,s.c)(this,"analysisSummaryFieldsChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.valueMap=new Map,this.useInitialSelectedStatistics=!1,this.selection=new Set,this.storeAsGPValue=!1,this.required=!1,this.usePopupTemplatesInfo=!0,this.allowDateType=!1,this.allowDateOnlyType=!1,this.allowTimeOnlyType=!1,this.allowStringType=!1,this.showFirstLastStatistics=!1,this.alwaysShowAnyCountStatistics=!1,this.showFieldDescription=!1,this.fieldPopoverOpen=!1,this.readOnly=!1,this.updateValueMap=(e,t)=>{if(!1===this.valueMap.has(e))this.valueMap.set(e,[t]);else{const i=this.valueMap.get(e)??[];!1===i.includes(t)&&(i.push(t),this.valueMap.set(e,i))}},this.popoverAction=()=>{this.fieldPopoverOpen=!0,!0===this.fieldPopoverOpen?this.createSummaryFieldsPopover():void 0!==this.summaryFieldsPopover&&(this.summaryFieldsPopover.open=!1,this.validate())},this.createSummaryFieldsPopover=()=>{void 0===this.summaryFieldsPopover&&(this.summaryFieldsPopover=document.createElement("analysis-summary-fields-popover"),this.summaryFieldsPopover.addEventListener("analysisSummaryFieldSelectionDone",this.onAnalysisSummaryFieldSelectionDone),this.summaryFieldsPopover.addEventListener("analysisSummaryFieldPopoverClose",this.closePopover)),this.summaryFieldsPopover.referenceElement=this.fieldButton,this.summaryFieldsPopover.open=!0,this.summaryFieldsPopover.layer=this.layer,this.summaryFieldsPopover.usePopupTemplatesInfo=this.usePopupTemplatesInfo,this.summaryFieldsPopover.selection=new Set(this.selection.keys()),this.summaryFieldsPopover.allowDateType=this.allowDateType,this.summaryFieldsPopover.allowStringType=this.allowStringType,this.summaryFieldsPopover.allowDateOnlyType=this.allowDateOnlyType,this.summaryFieldsPopover.allowTimeOnlyType=this.allowTimeOnlyType,this.summaryFieldsPopover.layerInputLocalizedLabel=this.layerInputLocalizedLabel,this.summaryFieldsPopover.noFieldsText=this.noFieldsText,this.summaryFieldsPopover.noLayersText=this.noLayersText,this.summaryFieldsPopover.showFieldDescription=this.showFieldDescription,!1===document.body.contains(this.summaryFieldsPopover)&&(this.summaryFieldsPopover.open=!0,document.body.appendChild(this.summaryFieldsPopover))},this.closePopover=()=>{void 0!==this.summaryFieldsPopover&&!0===document.body.contains(this.summaryFieldsPopover)&&(document.body.removeChild(this.summaryFieldsPopover),this.summaryFieldsPopover?.remove(),this.summaryFieldsPopover=void 0,this.fieldPopoverOpen=!1)},this.onAnalysisSummaryFieldSelectionDone=e=>{this.selection=e.detail,this.fieldPopoverOpen=!1,0===this.selection.size?(this.valueMap=new Map,this.value=void 0):(Array.from(this.valueMap.keys()).map(e=>{!1===this.selection.has(e)&&this.removeFromValueMap(e)}),Array.from(this.selection).map(e=>{const t=this.layer.fieldsIndex.get(e),{statistics:i}=this.getSupportedStatisticTypes(t.type);this.useInitialSelectedStatistics=!0,!1===this.valueMap.has(e)&&this.updateValueMap(t.name,i[0])}),this.updateValue()),this.analysisSummaryFieldsChange.emit(),this.validate()},this.onAnalysisChipGroupSelectionChange=e=>{const t=e.target,i=t.selectedChips,s=t.parentElement,a=s.description??s.id;!0===this.useInitialSelectedStatistics&&(this.useInitialSelectedStatistics=!1),this.valueMap.set(a,i),this.updateValue(),this.analysisSummaryFieldsChange.emit()},this.closeField=e=>{const t=e.target.parentElement.id;if(this.selection.delete(t),this.removeFromValueMap(t),void 0!==this.value){let e;e=!0===this.storeAsGPValue?this.value.filter(e=>e.onStatisticField.name!==t):"string"===this.valueFormat?this.value.filter(e=>e.split(" ")[0]!==t):this.value.filter(e=>e.onStatisticField!==t),this.value=[...e],this.analysisSummaryFieldsChange.emit()}this.validate()},this.validate=()=>{this.errorMessage=void 0;const e=!this.required||this.valueMap.size>0,t=Array.from(this.valueMap.values()).every(e=>e.length>0);!this.required||e&&t||(this.errorMessage=this.validationParams?.requiredMessage??this.strings.isRequired)},this.renderErrorMessage=()=>void 0!==this.errorMessage?(0,s.h)("calcite-input-message",{status:a.r.INVALID,scale:a.g.Scale,icon:"exclamationMarkTriangle"},this.errorMessage):null,this.renderFields=()=>{const e={badInputMessage:this.strings.statisticNotSelected,...this.validationParams};return(0,s.h)("calcite-list",{label:"",disabled:this.readOnly},[...this.valueMap.keys()].map(t=>{const i=this.layer?.fieldsIndex?.get(t),a=i?.alias??t,l=this.valueMap.get(t),{statistics:r,labels:n}=this.getSupportedStatisticTypes(i?.type??"integer");return(0,s.h)("calcite-list-item",{class:be,label:a,key:t,id:t,description:i?.name??t},(0,s.h)("analysis-chip-group",{slot:"content-bottom",onAnalysisChipGroupSelectionChange:this.onAnalysisChipGroupSelectionChange,required:this.required,scale:"s",class:fe,chipLabel:n,value:r,label:this.strings.statistic,selectionMode:"multi",selectAllEnabled:!0!==this.readOnly,initialChipSelection:this.useInitialSelectedStatistics?l:[],selectedChips:l,validationParams:e}),!0!==this.readOnly&&(0,s.h)("calcite-action",{text:"",slot:"actions-end",icon:"trash",appearance:"transparent",onClick:this.closeField}))}))}}valueChange(){this.valueFormat=void 0!==this.value&&this.value.length>0&&"object"==typeof this.value[0]?"object":this.valueFormat??"string",void 0!==this.value&&0===this.valueMap.size&&void 0!==this.valueFormat&&(this.selection=new Set,this.value.forEach(e=>{let t,i;if("string"===this.valueFormat){const s=e.split(" ");t=s[0],i=s[1]}else{const s=e;t="string"==typeof s.onStatisticField?s.onStatisticField:s.onStatisticField.name,i=s.statisticType}this.updateValueMap(t,i),this.selection.add(t)}))}async layerChange(e,t){if(!0!==this.readOnly&&void 0!==e&&t?.id!==e.id){this.abortController?.abort();try{this.abortController=new AbortController;const e=(await(0,a.ap)(this.layer,this.usePopupTemplatesInfo,this.abortController.signal)).filter(e=>this.selection.has(e.name)).map(e=>e.name);this.selection=new Set(e);const t=new Map;this.valueMap.forEach((e,i)=>{if(this.selection.has(i)){const s=this.layer.fieldsIndex.get(i),{statistics:a}=this.getSupportedStatisticTypes(s.type),l=a.filter(t=>e.includes(t));l.length>0?t.set(i,l):this.selection.delete(i)}}),this.useInitialSelectedStatistics=!0,(this.valueMap.size!==t.size||[...this.valueMap.entries()].some(([e,i])=>t.get(e).length!==i.length))&&(this.valueMap=t,this.updateValue(),this.analysisSummaryFieldsChange.emit())}catch(e){!1===(0,a.ax)(e)&&(this.errorMessage=this.strings.fieldLoadingErrorText)}}this.closePopover()}disconnectedCallback(){this.abortController?.abort(),this.closePopover()}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),void 0!==this.value&&(this.valueChange(),this.useInitialSelectedStatistics=!0),await this.layerChange(this.layer)}componentShouldUpdate(){return this.layer?.loaded}async checkValidity(){return!0===this.readOnly?Promise.resolve(!0):(this.validate(),Promise.resolve(void 0===this.errorMessage))}updateValue(){const e=[];this.valueMap.forEach((t,i)=>{t.forEach(t=>{let s;if(!0===this.storeAsGPValue){const s={onStatisticField:(0,a.aR)(this.layer,i),statisticType:t};e.push(s)}else"string"===this.valueFormat?(s=`${i} ${t}`,e.push(s)):(s={onStatisticField:i,statisticType:t},e.push(s))})}),this.value=[...e]}removeFromValueMap(e){const t=this.valueMap;t.delete(e),this.valueMap=new Map(t)}getSupportedStatisticTypes(e){let t=[],i=[];return!0===(0,a.aS)(e)?(t=[l.S.Sum,l.S.Minimum,l.S.Maximum,l.S.Mean,l.S.StdDev],i=[this.strings.sum,this.strings.min,this.strings.max,this.strings.mean,this.strings.standardDeviation]):"date"===e&&!0===this.allowDateType?(t=[l.S.Minimum,l.S.Maximum],i=[this.strings.min,this.strings.max]):"string"===e&&!0===this.allowStringType?(t=[l.S.Any,l.S.Count],i=[this.strings.any,this.strings.count]):("date-only"===e&&!0===this.allowDateOnlyType||"time-only"===e&&!0===this.allowTimeOnlyType)&&(t=[l.S.Minimum,l.S.Maximum],i=[this.strings.min,this.strings.max]),!0===this.alwaysShowAnyCountStatistics&&"string"!==e?(t=[...t,l.S.Any,l.S.Count],i=[...i,this.strings.any,this.strings.count]):!0===this.showFirstLastStatistics&&(t=[...t,l.S.First,l.S.Last],i=[...i,this.strings.first,this.strings.last]),{statistics:t,labels:i}}render(){return(0,s.h)(s.H,{key:"71f475fb12091318d80c912801c34212aa4f4cee"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,void 0!==this.valueMap&&this.valueMap.size>0&&this.renderFields(),(0,s.h)("calcite-button",{key:"9e2761b65fbf6333f9b00bd9f94002d483b1d429",appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:a.g.Scale,disabled:this.readOnly,ref:e=>{this.fieldButton=e},onClick:this.popoverAction},this.strings.field),this.renderErrorMessage())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["valueChange"],layer:["layerChange"],usePopupTemplatesInfo:["layerChange"]}}};Ce.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;margin-bottom:var(--analysis-half-spacing)}.label{margin-top:0}.calcite-chip{margin:var(--analysis-quarter-spacing)}.calcite-list-item{border:2px solid var(--calcite-color-border-1);margin-bottom:var(--analysis-half-spacing);margin-top:var(--analysis-quarter-spacing);border-radius:var(--analysis-quarter-spacing);overflow:hidden;--calcite-font-size--1:var(--calcite-font-size--2)}.calcite-switch{border:2px solid var(--calcite-color-border-1);margin-bottom:var(--analysis-quarter-spacing);margin-top:var(--analysis-quarter-spacing);padding:var(--analysis-quarter-spacing);padding-top:var(--analysis-three-quarter-spacing);border-radius:var(--analysis-quarter-spacing);overflow:hidden}";const we=class{constructor(e){(0,s.r)(this,e),this.variableNodeSelection=(0,s.c)(this,"variableNodeSelection",7),this.variableMultiPopoverClose=(0,s.c)(this,"variableMultiPopoverClose",7),this.isMultiValueSelected=!1,this.selectedListItems=[],this.filteredModelVariables=[],this.searchValue="",this.selectedNodes=[],this.modelVariables=[],this.getSelectedListItems=()=>[...Array.from(this.multiValueListElement?.children??[]).filter(e=>e.selected),...Array.from(this.singleValueListElement?.children??[]).filter(e=>e.selected)],this.onMultiValueNodeClick=()=>{this.singleValueListElement?.selectedItems?.forEach(e=>e.selected=!1);const e=this.multiValueListElement?.selectedItems??[];this.selectedListItems=[...e],this.isMultiValueSelected=!0},this.onSingleValueNodeClick=()=>{this.multiValueListElement?.selectedItems?.forEach(e=>e.selected=!1);const e=this.singleValueListElement?.selectedItems??[];this.selectedListItems=[...e],this.isMultiValueSelected=!1},this.onAddSelection=()=>{this.variableNodeSelection.emit({selectedItems:this.selectedListItems.map(e=>e.value),isMultiValueSelected:this.isMultiValueSelected})},this.handleFilterChange=e=>{const t=e.target;this.searchValue=t.value;const i=[...t.filteredItems];this.filteredModelVariables=this.sortModelsByTitle(i)},this.sortModelsByTitle=e=>e.sort((e,t)=>e.name.localeCompare(t.name))}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)(".")))}componentDidLoad(){this.selectedListItems=this.getSelectedListItems()}renderMultipleNodeList(){const e=this.modelVariables.filter(e=>e.dataType===this.toolParam.dataType),t=this.filteredModelVariables.filter(e=>e.dataType===this.toolParam.dataType),i=this.searchValue.length>0?t:e,l=o.D[this.toolParam.dataType]??"rounded-rectangle";return(0,s.h)("calcite-list",{label:"",selectionMode:"single",scale:"m",ref:e=>{this.multiValueListElement=e}},0===i.length?(0,s.h)("div",{class:"empty-entrant"},this.strings.noFound):i.map(e=>(0,s.h)("calcite-list-item",{iconEnd:l,value:e.id,onClick:this.onMultiValueNodeClick,selected:void 0!==this.selectedNodes&&this.selectedNodes.includes(e.id),scale:"s"},(0,s.h)("div",{slot:"content",style:{pointerEvents:"none",lineBreak:"anywhere"},class:"content"},(0,s.h)("div",null,e.name),(0,s.h)("div",{innerHTML:(0,a.a)(this.strings.variableVal,{val:(0,a.N)((0,a.aT)(e.value))})})))))}renderSingleNodeList(){const e=(0,a.i)(this.toolParam.dataType),t=this.modelVariables.filter(t=>t.dataType===e),i=this.filteredModelVariables.filter(t=>t.dataType===e),l=this.searchValue.length>0?i:t,r=o.D[e]??"rounded-rectangle";return(0,s.h)("calcite-list",{label:"",selectionMode:"multiple",scale:"m",ref:e=>{this.singleValueListElement=e}},0===l.length?(0,s.h)("div",{class:"empty-entrant"},this.strings.noFound):l.map(e=>(0,s.h)("calcite-list-item",{iconEnd:r,value:e.id,onClick:this.onSingleValueNodeClick,selected:void 0!==this.selectedNodes&&this.selectedNodes.includes(e.id),scale:"s"},(0,s.h)("div",{slot:"content",style:{pointerEvents:"none",lineBreak:"anywhere"},class:"content"},(0,s.h)("div",null,e.name),(0,s.h)("div",{innerHTML:(0,a.a)(this.strings.variableVal,{val:(0,a.N)((0,a.M)(e.value))})})))))}render(){const e=void 0!==this.maxHeight?this.maxHeight-50+"px":void 0;return(0,s.h)(s.H,{key:"b6d1f8b1da78322acfbc5f83ce949f6f0944be1e"},(0,s.h)("calcite-panel",{key:"7a231c53355f76acf0fa97e9ff61952f19b45b3c",class:"panel",style:{maxHeight:e}},(0,s.h)("calcite-filter",{key:"11233437580d0f2a881990052d0d23758b233d33",class:"list-filter",placeholder:this.strings.search,items:this.modelVariables,onCalciteFilterChange:this.handleFilterChange}),this.searchValue.length>0&&0===this.filteredModelVariables.length||0===this.modelVariables.length?(0,s.h)("div",{class:"empty-entrant"},this.strings.noFound):(0,s.h)("div",{class:"scrollable-container"},(0,s.h)("calcite-label",{class:"variable-label"},this.strings.multipleVariables),this.renderMultipleNodeList(),(0,s.h)("calcite-label",{class:"variable-label"},this.strings.singleVariables),this.renderSingleNodeList()),(0,s.h)("calcite-button",{key:"da56573044baf41c8c8984acce96bd5b93e7c12a",slot:"footer-actions",class:"add-button",onClick:this.onAddSelection},this.strings.addBtn)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};we.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}calcite-panel{--calcite-panel-background-color:var(--calcite-color-foreground-1)}calcite-list-item .content{color:var(--calcite-color-text-3);font-size:var(--calcite-font-size--2);font-weight:var(--calcite-font-weight-medium)}calcite-list-item .content div:first-child{color:var(--calcite-color-text-1)}.variable-label{margin-top:1rem;margin-left:1rem;font-weight:var(--calcite-font-weight-medium)}.empty-entrant{margin-left:1rem}.button-container{border-top:1px solid var(--calcite-color-border-2);display:flex;justify-content:flex-end;margin-top:1rem}.add-button{width:100%}.popover-content{height:var(--analysis-popover-content-height)}.panel{display:flex;flex-direction:column;max-height:var(--analysis-popover-content-height)}.list-filter{flex:0 0 auto}.scrollable-container{flex:1 1 auto;overflow-y:auto;display:flex;flex-direction:column}";const xe=class{constructor(e){(0,s.r)(this,e),this.variableNodeSelection=(0,s.c)(this,"variableNodeSelection",7),this.modelVariables=[],this.selectionMode="single",this.open=!1,this.selectedNodes=[],this.updateSelectedNodes=()=>{if(r.M.includes(this.toolParam.dataType)){const e=this.toolParam.value;Array.isArray(e)?e.forEach(e=>{(0,a.l)(e)&&void 0!==e?.variable&&this.selectedNodes.push(e.variable)}):(0,a.l)(e)&&void 0!==e?.variable&&this.selectedNodes.push(e.variable)}else{const e=this.toolParam.value?.variable;void 0!==e&&this.selectedNodes.push(e)}},this.dataNodeList=()=>{const e=[],t=o.D[this.toolParam.dataType]??"rounded-rectangle";return this.modelVariables?.forEach(i=>{if(i.dataType===this.toolParam.dataType){const l=this.toolParam.choiceListLabels?.[i.value];e.push((0,s.h)("calcite-list-item",{iconEnd:t,value:i.id,onClick:this.onDataNodeClick,selected:void 0!==this.selectedNodes&&this.selectedNodes.includes(i.id),scale:"s",metadata:{name:i.name,value:i.value}},(0,s.h)("div",{slot:"content",style:{pointerEvents:"none",lineBreak:"anywhere"},class:"content"},(0,s.h)("div",null,i.name),(0,s.h)("div",{innerHTML:(0,a.a)(this.strings.variableVal,{val:this.getNodeValue(i)})}),void 0!==l&&(0,s.h)("div",{innerHTML:(0,a.a)(this.strings.variableLabel,{val:(0,a.N)(l)})}))))}}),e},this.onDataNodeClick=()=>{this.variableNodeSelection.emit({selectedItems:this.listElement?.selectedItems?.map(e=>e.value)})},this.handleFilter=e=>{const t=e.target;this.showEmpty=0===t.filteredData.length}}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.updateSelectedNodes(),this.showEmpty=void 0===this.modelVariables||0===this.modelVariables.length}getNodeValue(e){return!1===(0,a.P)(e.value)?"":e.dataType===o.A.GPLinearUnit?(0,a.N)(`${e.value?.distance} ${e.value?.units}`):(0,a.N)(e.value)}render(){const e=this.popoverWidth??this.referenceElement?.getBoundingClientRect().width,t=r.M.includes(this.toolParam.dataType),i=void 0!==this.maxHeight?this.maxHeight-50+"px":"442.68px";return(0,s.h)(s.H,{key:"47907c68ac1c329dedf526ce2aab7de82d50ffc4",dir:this.dir},(0,s.h)("calcite-popover",{key:"73b7ef37484040ab793a6cc6b5ea694a90f15403",style:{maxHeight:i,overflowY:"auto"},class:"calcite-popover",autoClose:!0,closable:!0,heading:this.strings.header,referenceElement:this.referenceElement??"analysis-layer-input",open:this.open,label:"",focusTrapDisabled:!0,pointerDisabled:!0,placement:"leading",onCalcitePopoverClose:()=>(0,a.ad)(this.hostElement)},t?(0,s.h)("variable-multi-popover",{selectedNodes:this.selectedNodes,toolParam:this.toolParam,modelVariables:this.modelVariables,onVariableMultiPopoverClose:()=>(0,a.ad)(this.hostElement),style:{maxHeight:i,overflowY:"auto",width:void 0!==e?`${e}px`:void 0,maxWidth:a.g.MaxPopoverWidth,overflowX:"hidden"}}):(0,s.h)("calcite-panel",{style:{maxHeight:i,overflowY:"auto",width:void 0!==e?`${e}px`:void 0,maxWidth:a.g.MaxPopoverWidth}},(0,s.h)("calcite-list",{label:"",class:"popover-content",selectionMode:"multi"===this.selectionMode?"multiple":"single",filterEnabled:!0,filterPlaceholder:this.strings.search,filterProps:["metadata"],onCalciteListFilter:this.handleFilter,scale:"m",ref:e=>{this.listElement=e}},this.showEmpty&&(0,s.h)("div",{class:"empty-entrant"},this.strings.noFound),this.dataNodeList()))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};xe.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host .empty-entrant{margin:7px}:host calcite-panel{width:17rem}:host calcite-list-item .content{color:var(--calcite-color-text-3);font-size:var(--calcite-font-size--2);font-weight:var(--calcite-font-weight-medium)}:host calcite-list-item .content div:first-child{color:var(--calcite-color-text-1)}.popover-content{max-height:var(--analysis-popover-content-height)}";const Le=class{constructor(e){(0,s.r)(this,e),this.analysisNumberInputChange=(0,s.c)(this,"analysisNumberInputChange",7),this.showVariableNodesClick=(0,s.c)(this,"showVariableNodesClick",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.clearVariableById=(0,s.c)(this,"clearVariableById",7),this.doCalciteInputChangeOnCommit=!1,this.readOnly=!1,this.hideHelp=!1,this.supportsVariables=!1,this.renderVariableDisplay=e=>{const t=this.modelVariables?.find(t=>t.id===e);return void 0===t?(this.clearVariableById.emit(e),null):(0,s.h)("variable-node-display",{variableNode:t,onClearVariable:e=>!0!==this.readOnly&&this.clearVariableById.emit(e.detail),onChangeNode:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly})},this.renderSingleInput=()=>void 0===this.choiceList?this.renderInput():this.renderCombobox(),this.renderInput=()=>{const e=void 0!==this.errorMessage?a.r.INVALID:(0,a.a3)(this.validationParams?.type),t=this.doCalciteInputChangeOnCommit?{onCalciteInputNumberChange:this.inputChanged}:{onCalciteInputNumberInput:this.inputChanged};return(0,s.h)("calcite-input-number",{value:(0,a.f)(this.value),status:!1===this.readOnly?e:a.r.IDLE,placeholder:!1===this.readOnly?this.placeholderText??this.strings.inputPlaceholderText:void 0,integer:!this.isFloatType,readOnly:this.readOnly,clearable:!1===this.readOnly,step:this.isFloatType?"any":1,required:this.required||void 0,min:this.min,max:this.max,scale:this.scale??a.g.Scale,groupSeparator:!0,...t})},this.renderCombobox=()=>{const e=this.choiceList?.map(e=>this.buildComboBoxItem((0,a.f)(e),e===this.value));return(0,s.h)("calcite-combobox",{scale:this.scale??a.g.Scale,label:this.label??this.strings.comboboxLabel,selectionMode:"single",placeholder:!1===this.readOnly?this.placeholderText??this.strings.comboboxPlaceholderText:void 0,clearDisabled:!0,disabled:this.readOnly},e)},this.buildComboBoxItem=(e,t)=>(0,s.h)("calcite-combobox-item",{key:e,value:e,textLabel:e,selected:t,onCalciteComboboxItemChange:this.comboboxItemChanged}),this.renderAnalysisMultiInput=()=>{const{isFloatType:e,min:t,max:i,excludeMinValue:a,excludeMaxValue:l,minValues:r,maxValues:n}=this,o={isFloatType:e,min:t??Number.MIN_SAFE_INTEGER,max:i??Number.MAX_SAFE_INTEGER,excludeMinValue:a,excludeMaxValue:l,minValues:r,maxValues:n};return(0,s.h)("analysis-multiple-input",{dataType:"number",value:this.value,choiceList:this.choiceList,placeholderText:this.placeholderText,required:this.required,modelVariables:this.modelVariables,validationOptions:o,validationParams:this.validationParams,ref:e=>{this.multiInputElement=e},onAnalysisMultipleInputChange:e=>{this.handleAnalysisMultipleInputChange(e)},readOnly:this.readOnly})},this.handleAnalysisMultipleInputChange=e=>{this.value=e.detail,this.analysisNumberInputChange.emit()},this.inputChanged=e=>{const t=e.currentTarget?.value;this.value=(0,a.aU)(t),this.analysisNumberInputChange.emit()},this.comboboxItemChanged=e=>{if(this.isMultiSelect)return;const t=e.target,i=t?.value,s=(0,a.aU)(i);this.value!==s&&t?.selected&&(this.value=s,this.analysisNumberInputChange.emit())}}onValueChange(){const e=[];Array.isArray(this.value)?this.value?.forEach(t=>{if((0,a.l)(t)){const i=t.variable,s=this.modelVariables?.find(e=>e.id===i);(0,a.P)(s?.value)&&e.push(s.value)}else e.push(t);this.maxOfValues=Math.max(...e)}):this.maxOfValues=this.value,this.validate()}onRequiredChange(){this.validate()}async onValidationChange(){void 0!==this.multiInputElement&&(this.multiInputElement.validationOptions=this.formatValidationOptions()),this.errorMessage=void 0,(0,a.P)(this.value)&&await this.validate()}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),(0,a.P)(this.value)&&this.onValueChange()}get isFloatType(){return void 0===this.numberType||"float"===this.numberType}get isMultiSelect(){return"multi"===this.selectionMode}get formatOptions(){return{min:`${this.min??Number.MIN_SAFE_INTEGER}`,max:`${this.max??Number.MAX_SAFE_INTEGER}`}}render(){const e=!0===(0,a.l)(this.value)?this.value?.variable:void 0,t=void 0!==this.errorMessage,i=(0,a.a1)(this.validationParams),l=(0,a.P)(i)||!0===t,r=t?a.r.INVALID:(0,a.a3)(this.validationParams?.type);return(0,s.h)(s.H,{key:"e7784d387dce0b1243065d34089dc015308e3ebc"},(0,s.h)("calcite-label",{key:"516e80598c208048980698153611630544685661",class:"label",scale:this.scale??a.g.Scale},""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),supportsVariables:this.supportsVariables,onShowVariableActionClick:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly,hideHelp:this.hideHelp}):null,void 0!==e&&!1===this.isMultiSelect?this.renderVariableDisplay(e):this.isMultiSelect?this.renderAnalysisMultiInput():this.renderSingleInput(),!1===this.readOnly&&(0,s.h)("calcite-input-message",{key:"0b364264a1df88fd9bf4c23e156bf209d231b18a",status:r,scale:a.g.Scale,hidden:!l||this.isMultiSelect,icon:"exclamationMarkTriangle"},this.errorMessage??i)))}async checkValidity(){await this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}async validate(){if(this.isMultiSelect)void 0!==this.multiInputElement&&(this.multiInputElement.errorMessage=void 0,await(this.multiInputElement?.checkValidity?.()),this.errorMessage=this.multiInputElement?.errorMessage);else{let e;const t=!0===(0,a.l)(this.value)?this.value?.variable:void 0;e=void 0!==t?this.modelVariables?.find(e=>e.id===t)?.value??0:this.value;const i=(0,l.f)(e,this.formatValidationOptions()),s=void 0!==i?(0,a.a)(this.strings[i],this.formatOptions):void 0;this.errorMessage=s}}formatValidationOptions(){return{required:this.required,isFloatType:this.isFloatType,excludeMaxValue:this.excludeMaxValue,excludeMinValue:this.excludeMinValue,max:this.max??Number.MAX_SAFE_INTEGER,min:this.min??Number.MIN_SAFE_INTEGER}}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["onValueChange"],required:["onRequiredChange"],min:["onValidationChange"],max:["onValidationChange"],excludeMaxValue:["onValidationChange"],excludeMinValue:["onValidationChange"],numberType:["onValidationChange"]}}};Le.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;width:var(--analysis-component-default-width);--calcite-color-border-input:var(--analysis-ui-border-input)}:host([hidden]){display:none}.label{width:var(--analysis-component-default-width)}";const Ie="dataset-input",ke={border:`${Ie}__border`,container:`${Ie}__container`,listItem:`${Ie}__list-item`},Ee=class{constructor(e){(0,s.r)(this,e),this.analysisDatasetInputChange=(0,s.c)(this,"analysisDatasetInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.required=!1,this.hideHelp=!1,this.renderInitialMode=()=>(0,s.h)("section",null,(0,s.h)("calcite-label",{scale:a.g.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}):null,this.renderAddButton(),this.renderErrorMessage())),this.renderListMode=()=>{const e=this.valueArray?.map(e=>(0,s.h)("calcite-list-item",{class:ke.listItem,key:e.id,value:e.id,label:e.name,description:e.description},(0,s.h)("calcite-action",{text:this.strings.remove,slot:"actions-end",label:this.strings.remove,appearance:"transparent",icon:"x",onClick:()=>this.onRemoveDataset(e.id)})));return(0,s.h)("section",{class:ke.container},(0,s.h)("calcite-label",{scale:a.g.Scale},(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}),(0,s.h)("calcite-list",{class:ke.border,label:"",onMouseOver:this.onListMouseOver,onMouseOut:this.onListMouseOut,onCalciteListChange:this.onListItemSelected},e),this.renderErrorMessage()),this.isMultiSelect&&this.renderAddButton())},this.renderErrorMessage=()=>{const e=void 0!==this.errorMessage;return(0,s.h)("calcite-input-message",{hidden:!e,icon:"exclamationMarkTriangle",status:a.r.INVALID,scale:a.g.Scale},this.errorMessage)},this.renderAddButton=()=>(0,s.h)("calcite-button",{appearance:"outline",kind:"neutral","icon-start":"plus",onClick:this.onAddButtonClicked,width:"full",scale:a.g.Scale},this.strings.dataset),this.onAddButtonClicked=e=>{this.createDatasetInputPopover(e.target)},this.onListMouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.strings.replaceDataset),this.replaceTooltip.referenceElement=t,(0,l.b)(document,this.replaceTooltip))},this.onListMouseOut=()=>{(0,l.r)(this.replaceTooltip)},this.onListItemSelected=e=>{this.createDatasetInputPopover(e.target)},this.onRemoveDataset=e=>{const t=this.valueArray?.filter(t=>t.id!==e);this.updateValueFromArray(t)},this.createDatasetInputPopover=e=>{void 0===this.datasetInputPopover&&(this.datasetInputPopover=document.createElement("analysis-dataset-input-popover"),this.datasetInputPopover.addEventListener("analysisDatasetInputPopoverClose",this.onDatasetPopoverClose),this.datasetInputPopover.addEventListener("analysisDatasetInputPopoverSelectionChange",this.onDatasetInputPopoverChange)),this.datasetInputPopover.selectedDatasetIds=this.valueArray?.map(e=>e.id),this.datasetInputPopover.selectionMode=this.isMultiSelect?"multiple":"single",this.datasetInputPopover.analysisDatasets=this.analysisDatasets,this.datasetInputPopover.placement="leading",this.datasetInputPopover.referenceElement=e.parentElement??e,(0,l.b)(document,this.datasetInputPopover)},this.onDatasetPopoverClose=()=>{(0,l.r)(this.datasetInputPopover),this.datasetInputPopover=void 0,this.validate()},this.onDatasetInputPopoverChange=e=>{const t=e.detail.selectedDatasetIds,i=new Set(t),s=this.analysisDatasets?.filter(e=>i.has(e.id));this.updateValueFromArray(s)},this.updateValueFromArray=e=>{if(this.isMultiSelect)this.value=e;else{const t=void 0===e||e.length<1;this.value=t?void 0:e[0]}this.analysisDatasetInputChange.emit()},this.validate=()=>{this.required&&!this.hasValue?this.errorMessage=(0,a.a)(this.strings.isRequired,{label:this.label}):this.errorMessage=void 0}}onValueChange(){this.validate()}get isMultiSelect(){return"multi"===this.selectionMode}get hasValue(){return this.isMultiSelect?void 0!==this.value&&this.value.length>0:void 0!==this.value}get valueArray(){let e;return void 0!==this.value&&(e=this.isMultiSelect?this.value:[this.value]),e}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)(".")))}disconnectedCallback(){(0,l.r)(this.datasetInputPopover),(0,l.r)(this.replaceTooltip)}render(){return(0,s.h)(s.H,{key:"eb3af92041fdeba60d5a5ac1ca597985aae3b64e"},this.hasValue?this.renderListMode():this.renderInitialMode())}async checkValidity(){this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["onValueChange"]}}};Ee.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;width:var(--analysis-component-default-width)}.dataset-input__border{border:1px solid var(--analysis-ui-border-input)}.dataset-input__container{margin-bottom:var(--analysis-half-spacing)}.dataset-input__list-item{--calcite-font-size--1:var(--calcite-font-size--2)}";const Se="custom-input-label",Me=class{constructor(e){(0,s.r)(this,e),this.showVariableNodesClick=(0,s.c)(this,"showVariableNodesClick",7),this.clearVariableById=(0,s.c)(this,"clearVariableById",7),this.analysisMultipleInputChange=(0,s.c)(this,"analysisMultipleInputChange",7),this.variablesById=new Map,this.dataType="number",this.scale=a.g.Scale,this.readOnly=!1,this.clearVariableDisplay=e=>{const t=e?.detail;!0===(0,a.l)(this.value)&&!0!==this.readOnly&&(this.value=void 0,this.clearVariableById.emit(t))},this.removeValueHandler=e=>{if(void 0===this.value||!1===Array.isArray(this.value))return;let t=[];t=""!==(0,a.f)(e)?this.value.filter(t=>t!==e):this.value.filter(t=>!((0,a.l)(t)&&t.variable===e)),this.value=t,this.analysisMultipleInputChange.emit(this.value),this.errorMessage=this.validate(this.completeValues),this.checkUnderMinValues()},this.renderVariableDisplay=e=>{const t=this.modelVariables?.find(t=>t.id===e);return void 0===t?(this.clearVariableById.emit(e),null):(0,s.h)("variable-node-display",{variableNode:t,onClearVariable:this.clearVariableDisplay,onChangeNode:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly})},this.renderCombobox=()=>{const{choiceList:e,errorMessage:t,value:i,scale:l,placeholderText:r}=this,n=void 0!==this.errorMessage,o=e?.map(e=>{const t=void 0!==i&&Array.isArray(i)&&i.includes(e);return this.buildComboBoxItem((0,a.f)(e),t)}),h=(0,a.a1)(this.validationParams),c=(0,a.P)(h)||!0===n,d=n?a.r.INVALID:(0,a.a3)(this.validationParams?.type);return(0,s.h)("calcite-label",{scale:l},(0,s.h)("calcite-combobox",{label:this.label,scale:l,selectionMode:"multiple",placeholder:!1===this.readOnly?r??this.strings.defaultPlaceholder:void 0,onCalciteComboboxChange:this.handleComboboxChange,disabled:this.readOnly},o),!1===this.readOnly&&(0,s.h)("calcite-input-message",{status:d,scale:a.g.Scale,hidden:!c,icon:"exclamationMarkTriangle"},t??h))},this.buildComboBoxItem=(e,t)=>(0,s.h)("calcite-combobox-item",{key:e,value:e,textLabel:e,selected:t}),this.buildListItem=e=>{const t=(0,a.l)(e);if(!0===t&&void 0===this.variablesById.get(e?.variable??""))return this.removeValueHandler(e?.variable),null;const i=!0===t&&void 0!==e.variable?this.getVariableValue(e.variable):void 0,l=void 0!==i?(0,a.a)(this.strings.value,{value:(0,a.M)(i)}):void 0,r=!0===t&&void 0!==e.variable?this.getVariableName(e.variable):(0,a.M)((0,a.f)(e),{maximumFractionDigits:8}),n=void 0!==i&&!Array.isArray(i)&&void 0!==this.checkNumberValidity([i]);return(0,s.h)("calcite-list-item",{label:r,closable:!0,scale:a.g.Scale,value:(0,a.l)(e)?e.variable:e,description:l,key:(0,a.l)(e)?e.variable:e,onCalciteListItemClose:this.handleListItemClose,messageOverrides:{dismissLabel:this.strings.remove},disabled:this.readOnly},r,!0===n&&!1===this.readOnly&&(0,s.h)("calcite-action",{class:"error-icon",slot:"actions-end",icon:"exclamation-mark-triangle",text:"Validation error"}))},this.handleComboboxChange=e=>{const t=e.target?.selectedItems,i=t?.map(e=>e.value);Array.isArray(i)&&0!==i.length||!0!==this.required?(this.value=i.map(e=>(0,a.aU)(e)).filter(e=>void 0!==e),this.analysisMultipleInputChange.emit(this.value),this.errorMessage=this.validate(this.completeValues),this.checkUnderMinValues()):this.errorMessage=this.strings.requiredInputMessage},this.handleNewListItem=()=>{if(this.isAtMaxValues)return;const e=this.inputElement?.value;if(!0===(0,a.y)(e))return;const t=(0,a.aU)(e);void 0!==t&&(this.errorMessage=this.checkNumberValidity([t]),this.isValid&&(!1===this.completeValues?.includes(t)?(this.value=[...this.value??[],t],this.analysisMultipleInputChange.emit(this.value),void 0!==this.inputElement&&(this.inputElement.value=""),this.errorMessage=this.validate(this.completeValues),this.checkUnderMinValues()):this.warningMessage=this.strings.addDuplicateMessage))},this.handleKeyDown=e=>{"Tab"===e?.key&&""!==this.inputElement?.value?(e.preventDefault(),this.handleNewListItem()):""===this.inputElement?.value||"Backspace"!==e?.key&&"Delete"!==e?.key||(this.warningMessage=void 0,this.errorMessage=this.validate())},this.handleListItemClose=async e=>{const t=e?.target,i=t.value,s=t.previousElementSibling;this.removeValueHandler(i),await(s?.setFocus())},this.checkUnderMinValues=()=>{const e=this.validationOptions?.minValues;void 0!==e&&(this.errorMessage=this.isUnderMinValues?(0,a.a)(this.strings.minValuesMessage,{minValues:(0,a.M)(e)}):this.errorMessage)}}onModelVariablesChange(e,t){e!==t&&this.getVariableByIdMap()}onValueChange(e,t){e!==t&&(this.warningMessage=void 0,this.errorMessage=this.validate())}getVariableByIdMap(){this.variablesById.clear(),this.modelVariables?.forEach(e=>{this.variablesById.set(e.id,e)})}getVariableValue(e){const t=this.variablesById.get(e);return t?t.value:void 0}getVariableName(e){const t=this.variablesById.get(e);return t?t.name:""}get completeValues(){const e=[];if((0,a.P)(this.value)){(Array.isArray(this.value)?this.value:[this.value]).forEach(t=>{if("number"==typeof t)e.push(t);else{const i=this.getVariableValue(t?.variable??"");(0,a.P)(i)&&(Array.isArray(i)?e.push(...i):e.push(i))}})}return e}get isValid(){return void 0===this.errorMessage||""===this.errorMessage}get isOverMaxValues(){const e=this.validationOptions?.maxValues??Number.MAX_SAFE_INTEGER;return this.completeValues.length>e}get isAtMaxValues(){const e=this.validationOptions?.maxValues??Number.MAX_SAFE_INTEGER;return this.completeValues.length===e}get isUnderMinValues(){const e=this.validationOptions?.minValues??0;return Array.from(new Set(this.completeValues)).length<e}async checkValidity(){const e="informative"!==this.validationParams?.type;return this.errorMessage=this.validate(this.completeValues)??this.errorMessage??(e?this.validationParams?.message:void 0),Promise.resolve(this.isValid)}validateVariable(){(Array.isArray(this.value)?this.value:[this.value]).some(a.l)&&(this.errorMessage=this.validate())}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.getVariableByIdMap(),this.validateVariable()}render(){return void 0!==this.choiceList&&this.choiceList.length>0?this.renderCombobox():this.renderNoChoiceList()}renderNoChoiceList(){const e=!0===(0,a.l)(this.value)?this.value?.variable:void 0;void 0!==this.validationOptions?.maxValues&&this.isAtMaxValues&&(this.warningMessage=(0,a.a)(this.strings.maxValuesMessage,{maxValues:(0,a.M)(this.validationOptions.maxValues)})),!1===(0,a.aV)(this.completeValues)&&(this.warningMessage=this.strings.duplicateValueMessage);const t=void 0!==this.errorMessage,i=void 0!==this.warningMessage&&!t,l=(0,a.a1)(this.validationParams),r=(0,a.P)(l)||t||i,n=t?a.r.INVALID:i?a.r.IDLE:(0,a.a3)(this.validationParams?.type),o=t?a.r.INVALID:(0,a.y)(this.validationParams)?a.r.IDLE:(0,a.a3)(this.validationParams?.type);return(0,s.h)(s.H,null,(0,s.h)("calcite-label",{scale:this.scale,class:Se},this.label,void 0!==e?this.renderVariableDisplay(e):(0,s.h)("calcite-input",{disabled:this.isAtMaxValues,type:this.dataType,placeholder:!1===this.readOnly?this.placeholderText??this.strings.defaultPlaceholder:void 0,scale:this.scale,status:!1===this.readOnly?o:a.r.IDLE,numberButtonType:"none",max:this.validationOptions?.max,min:this.validationOptions?.min,step:!0===this.validationOptions?.isFloatType?"any":1,onCalciteInputChange:this.handleNewListItem,onKeyDown:this.handleKeyDown,ref:e=>this.inputElement=e,readOnly:this.readOnly},(0,s.h)("calcite-button",{disabled:this.isAtMaxValues||this.readOnly,scale:this.scale,slot:"action",onClick:this.handleNewListItem,"icon-start":"plus"},this.strings.add))),void 0===e&&Array.isArray(this.value)&&this.value.length>0?(0,s.h)("calcite-list",{scale:a.g.Scale,class:"multiple-list",label:""},[...this.value].reverse().map(e=>this.buildListItem(e))):null,!1===this.readOnly&&(0,s.h)("calcite-input-message",{class:Se,status:n,scale:a.g.Scale,hidden:!r,icon:"exclamationMarkTriangle"},this.errorMessage??this.warningMessage??l))}checkNumberValidity(e){const t={required:!1,...this.validationOptions},i=e?.map(e=>(0,l.f)(e,t)).find(e=>void 0!==e),{min:s,max:r}=t,n={min:(0,a.M)(s),max:(0,a.M)(r)};return void 0!==i?(0,a.a)(this.strings[i],n):void 0}validate(e=this.completeValues){let t;return this.isOverMaxValues?(t=(0,a.a)(this.strings.maxValuesMessage,{maxValues:(0,a.M)(this.validationOptions?.maxValues)}),t):0!==this.completeValues.length&&this.isUnderMinValues?(t=(0,a.a)(this.strings.minValuesMessage,{minValues:(0,a.M)(this.validationOptions?.minValues)}),t):(t=!0!==this.required||void 0!==e&&0!==e?.length?"number"===this.dataType?this.checkNumberValidity(e):void 0:this.strings.requiredInputMessage,t)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{modelVariables:["onModelVariablesChange"],value:["onValueChange"]}}};Me.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{--calcite-color-border-input:var(--analysis-ui-border-input)}.multiple-list{border:1px solid var(--calcite-color-border-input)}.error-icon{--calcite-action-text-color:var(--calcite-color-status-danger)}.custom-input-label{margin-bottom:var(--analysis-quarter-spacing)/2}";const Fe=class{constructor(e){(0,s.r)(this,e),this.analysisTreeValueChange=(0,s.c)(this,"analysisTreeValueChange",7),this.data={},this.renderedTree=[],this.treeItemsOpen=new Set,this.handleMutations=e=>{e.forEach(e=>{if("attributes"===e.type&&"expanded"===e.attributeName){const t=e.target;if("key"in t.dataset&&void 0!==t.dataset.key){this.treeItemsOpen.has(t.dataset.key)!==t.expanded&&this.toggleTreeItem(t.dataset.key)}}})},this.toggleTreeItem=e=>{this.treeItemsOpen.has(e)?this.treeItemsOpen.delete(e):this.treeItemsOpen.add(e),this.buildJSXTree()}}onDataChange(){this.setupComponent()}componentWillLoad(){this.setupComponent()}componentDidLoad(){this.setupObserver()}disconnectedCallback(){this.observer?.disconnect()}setupComponent(){this.treeItemsOpen.clear(),this.buildJSXTree()}setupObserver(){this.observer=new MutationObserver(this.handleMutations);const e=this.hostElement.shadowRoot??this.hostElement;this.observer.observe(e,{attributes:!0,subtree:!0,attributeFilter:["expanded"]})}buildJSXTree(){const e=t=>{const i=[];for(const s in t){const a=t[s];let l;"object"==typeof a&&(l=this.treeItemsOpen.has(s)?e(a):[]);const r="object"==typeof a?s:a;i.push(this.createTreeItem(s,r,l))}return i};this.renderedTree=e(this.data)}createTreeItem(e,t,i){return(0,s.h)("calcite-tree-item",{key:`${e}-item`,"data-key":e,selected:this.value===e,"aria-selected":this.value===e,expanded:this.treeItemsOpen.has(e),"aria-expanded":this.treeItemsOpen.has(e)},t,void 0!==i&&(0,s.h)("calcite-tree",{key:`${e}-child-tree`,slot:"children"},i))}handleTreeSelect(e){const t=e.target,i=t?.selectedItems[0]?.dataset.key;void 0!==i&&(this.value=i,this.analysisTreeValueChange.emit())}render(){return(0,s.h)(s.H,{key:"5385edbb7ca2eebb0314db0ad49eb2285d23470d"},(0,s.h)("div",{key:"2e2805285ebffabb090cbb106aac18016cc453e1"},(0,s.h)("calcite-tree",{key:"base-tree",scale:a.g.Scale,onCalciteTreeSelect:e=>this.handleTreeSelect(e)},this.renderedTree)))}get hostElement(){return(0,s.d)(this)}static get watchers(){return{data:["onDataChange"]}}};Fe.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{overflow-y:auto;overflow-x:hidden;scroll-behavior:smooth;height:100%;width:100%}";const Te="no-matches-found-msg",Ve=class{constructor(e){(0,s.r)(this,e),this.analysisSpatialReferenceValueChange=(0,s.c)(this,"analysisSpatialReferenceValueChange",7),this.analysisSpatialReferenceSelectorDismissed=(0,s.c)(this,"analysisSpatialReferenceSelectorDismissed",7),this.autoFilterToDefault=!1,this.defaultWkid=4326,this.hideDone=!1,this.searchText="",this.performantFilterSpatialReferences=(0,r.l)(e=>{this.updateSearchResults(e)},250,{leading:!1,trailing:!0})}onAutoFilterToDefaultChange(){this.autoFilterSpatialReferences()}onDefaultWkidChange(){this.autoFilterSpatialReferences()}async getSRDescription(){return void 0!==this.value?.latestWkid?Promise.resolve((0,a.aW)(this.value?.latestWkid)):Promise.resolve(void 0)}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.value=this.value??{latestWkid:this.defaultWkid};const e=this.filterSrCategories(a.aX);this.visibleSrCategories=this.translateSrCategories(e)}componentDidLoad(){this.autoFilterSpatialReferences()}translateSrCategories(e){const t={};return this.recursiveTranslate(e,t),t}recursiveTranslate(e,t){Object.keys(e).forEach(i=>{const s=this.getTranslatedKey(i);"object"==typeof e[i]?(t[s]={},this.recursiveTranslate(e[i],t[s])):t[s]=e[i]})}getTranslatedKey(e){return e in this.strings?this.strings[e]:e}filterSrCategories(e){const t={};return Object.keys(e).forEach(i=>{void 0!==this.hideCategories&&!1!==this.hideCategories?.includes(i)||("object"==typeof e[i]?t[i]=this.filterSrCategories(e[i]):t[i]=e[i])}),t}setSpatialRef(e){this.value={latestWkid:Number(e)},this.analysisSpatialReferenceValueChange.emit(this.value)}inputKeyDown(e){"Enter"===e.key&&this.selectFirstChild(!0)}selectFirstChild(e){const t=this.treeElement,i=t?.shadowRoot?.querySelector("calcite-tree-item:not([has-children]):not([data-key='placeholder'])")||void 0;void 0!==t&&void 0!==i&&(i.selected=!0,this.setSpatialRef(i.dataset.key??""),e&&i.focus())}updateSearchResults(e){this.searchResults=(0,a.aY)(e,this.visibleSrCategories)}searchSpatialReferences(e){null!==e.target&&this.setSearchText(e.target.value??"")}setSearchText(e){this.searchText=e,this.searchText.length>1?this.performantFilterSpatialReferences(this.searchText):this.searchResults=void 0}autoFilterSpatialReferences(){this.autoFilterToDefault&&(0,a.P)(this.defaultWkid)&&void 0!==this.searchInput&&(this.searchInput.value=this.defaultWkid.toString(),this.setSearchText(this.searchInput.value))}render(){const e=(0,a.a)(this.strings.noMatchesFound,{searchTerm:this.searchText??""});return(0,s.h)(s.H,{key:"e790984829287921be70dd3787f48e1ff1361f8a",dir:this.dir},(0,s.h)("calcite-panel",{key:"d2c54ddb474f7cdbdf695b8bf7beea42088dbeab",closable:!1,closed:!1,onCalcitePanelClose:()=>this.analysisSpatialReferenceSelectorDismissed.emit(this.value)},(0,s.h)("calcite-input",{key:"2283d3f53451065074d1c4d97211c206b78fb821",onCalciteInputInput:e=>this.searchSpatialReferences(e),onKeyDown:e=>this.inputKeyDown(e),placeholder:this.strings.searchPlaceholder,scale:a.g.Scale,type:"search",icon:!0,autofocus:!0,ref:e=>this.searchInput=e}),this.searchText.length>1&&(0,a.y)(this.searchResults)&&(0,s.h)("p",{key:"1d7a4874e699e398aefd98be705e65c32771d8d3",class:Te},e),(0,s.h)("analysis-tree",{key:"tree",ref:e=>this.treeElement=e,data:void 0!==this.searchResults&&this.searchText.length>0?this.searchResults:this.visibleSrCategories,value:this.value&&`${this.value?.latestWkid}`,onAnalysisTreeValueChange:()=>{this.setSpatialRef(this.treeElement.value)}}),this.hideDone?void 0:(0,s.h)("calcite-button",{appearance:"solid",scale:a.g.Scale,width:"full",slot:"footer-actions",onClick:()=>this.analysisSpatialReferenceSelectorDismissed.emit(this.value)},this.strings.done)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{autoFilterToDefault:["onAutoFilterToDefaultChange"],defaultWkid:["onDefaultWkidChange"]}}};Ve.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{overflow-y:hidden;display:flex;flex-direction:column;--calcite-color-border-input:var(--analysis-ui-border-input);height:var(--analysis-popover-content-height);min-width:20rem;max-width:27rem}.no-matches-found-msg{margin:var(--analysis-half-spacing);font-size:var(--calcite-font-size--2)}analysis-tree{flex:1}";const Pe="select-button",De=class{constructor(e){(0,s.r)(this,e),this.analysisSpatialReferenceInputChange=(0,s.c)(this,"analysisSpatialReferenceInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.required=!1,this.createPopover=e=>{this.spatialReferencePopover&&(this.spatialReferencePopover.remove(),this.spatialReferencePopover=void 0),this.spatialReferencePopover=document.createElement("calcite-popover");const t={autoClose:!0,dir:this.dir,focusTrapDisabled:!0,triggerDisabled:!0,heading:this.strings.browseCoordinateSystems,closable:!0,open:!0,referenceElement:e.target};Object.assign(this.spatialReferencePopover,t),this.spatialReferencePopover.addEventListener("calcitePopoverClose",this.handleSpatialReferenceClose);const i=document.createElement("analysis-spatial-reference-selector");i.hideCategories=this.hideCategories,i.value=this.value,i.addEventListener("analysisSpatialReferenceValueChange",this.handleSpatialReferenceChange),i.addEventListener("analysisSpatialReferenceSelectorDismissed",this.handleSpatialReferenceClose),this.spatialReferencePopover.append(i),document.body.append(this.spatialReferencePopover),setTimeout(()=>requestAnimationFrame(()=>{this.spatialReferencePopover.open=!0,this.spatialReferencePopover?.setFocus()}),1)},this.validate=()=>(this.required&&void 0===this.value?this.errorMessage=(0,a.a)(this.strings.isRequired,{label:this.label}):this.errorMessage=void 0,void 0===this.errorMessage),this.handleSpatialReferenceChange=e=>{this.value={latestWkid:e.detail.latestWkid,wkid:e.detail.latestWkid},this.analysisSpatialReferenceInputChange.emit(this.value)},this.handleSpatialReferenceClose=()=>{this.spatialReferencePopover?.remove(),this.spatialReferencePopover=void 0,this.validate()}}onValueChange(){var e,t;void 0!==this.value&&((e=this.value).wkid??(e.wkid=this.value.latestWkid),(t=this.value).latestWkid??(t.latestWkid=this.value.wkid)),this.validate()}async componentWillLoad(){var e,t;({strings:this.strings,dir:this.dir}=await(0,a.u)(this.hostElement,(0,s.a)("."))),void 0!==this.value&&((e=this.value).wkid??(e.wkid=this.value.latestWkid),(t=this.value).latestWkid??(t.latestWkid=this.value.wkid))}disconnectedCallback(){this.spatialReferencePopover?.remove()}async checkValidity(){this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}render(){const e=(0,a.y)(this.value)?this.strings.browseCoordinateSystems:(0,a.aW)(this.value?.latestWkid)??this.strings.browseCoordinateSystems;return(0,s.h)(s.H,{key:"a59854c422d2e6eea881faafd993055b0f75e38f"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-button",{key:"aed04974a2db9df1f5997de02d8f8bf29f96acb4",width:"full",appearance:"outline",kind:"neutral","icon-end":"chevron-down",alignment:"icon-end-space-between",onClick:this.createPopover,class:Pe,scale:a.g.Scale},e),(0,s.h)("calcite-input-message",{key:"2c32c4e0ae5062160ae3a7de3ddd085b3d019c44",status:"invalid",scale:a.g.Scale,hidden:void 0===this.errorMessage,icon:"exclamationMarkTriangle"},this.errorMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["onValueChange"]}}};De.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;width:var(--analysis-component-default-width)}.select-button{margin-bottom:var(--analysis-half-spacing)}";const Ae="container",Oe="border",Re="list-item",Ne=class{constructor(e){(0,s.r)(this,e),this.analysisWorkflowSelectChange=(0,s.c)(this,"analysisWorkflowSelectChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.workflowOptions={},this.isValid=!0,this.hideElements=()=>{this.toolSettingsElement=this.parentAppContainer?.shadowRoot?.querySelector("analysis-tool-settings"),this.toolFooterElement=this.parentAppContainer?.shadowRoot?.querySelector("div[slot=footer]"),this.toolSettingsElement&&(this.toolSettingsElement.hidden=!0),this.toolFooterElement&&(this.toolFooterElement.hidden=!0)},this.showElements=()=>{!0===this.toolSettingsElement?.hidden&&(this.toolSettingsElement.hidden=!1),!0===this.toolFooterElement?.hidden&&(this.toolFooterElement.hidden=!1)},this.onSelectionChange=e=>{e!==this.value&&(this.value=e,this.updateSelectedUIParameters(),this.validate()),this.showElements()},this.replaceWorkflow=e=>{this.removeWorkflowReplacePopover(),this.workflowSelectPopover=this.createWorkflowSelectPopoverElement(e.target),(0,l.b)(document,this.workflowSelectPopover)},this.removeWorkflowReplacePopover=()=>{(0,l.r)(this.workflowSelectPopover)},this.createWorkflowSelectPopoverElement=e=>{const t=document.createElement("analysis-workflow-select-popover"),i={autoClose:!0,closable:!0,focusTrapDisabled:!0,heading:this.strings.popoverHeader,label:this.strings.popoverHeader,placement:"auto",referenceElement:e};return t.popoverOptions=i,t.renderPopoverContent=()=>this.renderWorkflowOptions(!0),t.addEventListener("calcitePopoverClose",()=>{this.removeWorkflowReplacePopover()}),t}}onUIparameterInfosChange(e){this.processUIparameterInfos(e)}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.u)(this.hostElement,(0,s.a)("."))),void 0===this.value&&(this.parentAppContainer=(0,a.aZ)("analysis-tool-app-container",this.hostElement)),void 0!==this.UIparameterInfos&&this.processUIparameterInfos(this.UIparameterInfos),this.updateSelectedUIParameters()}componentDidLoad(){void 0===this.value&&this.hideElements()}disconnectedCallback(){this.removeWorkflowReplacePopover(),this.showElements()}async checkValidity(){return this.validate()}validate(){let e=!0;return!0===this.required&&void 0===this.value&&(e=!1),this.isValid=e,Promise.resolve(this.isValid)}processUIparameterInfos(e){const t={},i={};for(const s of e??[]){const e=s?.name;if(void 0===e)throw new Error("UIparameterInfo goal must have a name property");t[e]=s,i[e]=s.label??e}this.workflowOptions=t,this.choiceListLabels=i,this.resetValueIfInvalid()}updateSelectedUIParameters(){const e=void 0===this.value?void 0:[this.workflowOptions[this.value]];!1===(0,n.v)(e,this.selectUIparameterInfos)&&(this.selectUIparameterInfos=e,this.analysisWorkflowSelectChange.emit())}resetValueIfInvalid(){void 0!==this.value&&void 0===this.workflowOptions[this.value]&&this.onSelectionChange(void 0)}renderReplaceTooltip(){const{replaceWorkflow:e}=this.strings;return(0,s.h)("calcite-tooltip",{closeOnClick:!0,dir:this.dir,overlayPositioning:"fixed",placement:"bottom",onClick:e=>e.stopPropagation(),ref:e=>this.selectedWorkflowTooltip=e},e)}renderWorkflowOptions(e=!1){const t=e||void 0===this.value,i=t?this.removeWorkflowReplacePopover:this.replaceWorkflow,a=t?Object.keys(this.workflowOptions).map(e=>this.renderListItem(this.workflowOptions[e],!1)):this.renderListItem(this.workflowOptions[this.value],!0);return(0,s.h)("calcite-list",{class:Oe,dir:this.dir,label:"",onClick:i,selectionMode:e?"single-persist":"none",selectionAppearance:"icon"},this.renderReplaceTooltip(),a)}renderWorkflowHelpAction(e){const{workflowHelp:t}=this.strings;return(0,s.h)("calcite-action",{label:t,text:t,onClick:t=>{t.stopPropagation();const i=t.target,s=i.parentElement,a=e.label??e.name;this.analysisHelpClick.emit({paramName:e.name,paramLabel:a,refElement:s??i})},icon:"information",slot:"actions-end"})}renderListItem(e,t){const{name:i,label:a}=e,l=t?()=>{}:()=>this.onSelectionChange(e.name);return(0,s.h)("calcite-list-item",{class:Re,key:i,id:i,value:i,label:a??i,selected:i===this.value,onClick:l,ref:e=>{!0===t&&void 0!==this.selectedWorkflowTooltip&&void 0!==this.value&&null!==e&&(this.selectedWorkflowTooltip.referenceElement=e)}},this.renderWorkflowHelpAction(e))}renderLabel(){return void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):void 0}renderErrorMessage(){const e=this.validationParams?.requiredMessage??(0,a.a)(this.strings.isRequired,{label:this.label});return!1===this.isValid&&""!==e?(0,s.h)("calcite-input-message",{status:a.r.INVALID,scale:a.g.Scale,icon:"exclamationMarkTriangle",hidden:this.isValid},e):void 0}render(){return(0,s.h)(s.H,{key:"d460ebc7719b738c8448d5b8227c68596a63d015"},(0,s.h)("calcite-section",{key:"0062c59b91ad70769ded60a92a8253b8d24d28a4",class:Ae},(0,s.h)("calcite-label",{key:"d5af00bab4d299f33ee848ec2d2aa9202ba9d5cb",scale:a.g.Scale},this.renderLabel(),this.renderWorkflowOptions(),this.renderErrorMessage())))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{UIparameterInfos:["onUIparameterInfosChange"]}}};Ne.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{width:var(--analysis-component-default-width)}.container{margin-bottom:var(--analysis-half-spacing)}.border{border:1px solid var(--calcite-color-border-input)}.list-item{--calcite-font-size--1:var(--calcite-font-size--2)}";const qe="analysis-popover",_e="js-app-flyout",Be="help-iframe-s",He="help-iframe-m",ze="learn-more",Ue="OnlineOnly",$e="PortalOnly",Ge="modelBuilderOnly",We="toolPaneOnly",Qe="help-custom-tool-param",je=class{constructor(e){(0,s.r)(this,e),this.analysisHelpPopoverClose=(0,s.c)(this,"analysisHelpPopoverClose",7),this.analysisHelpPopoverSelectionChange=(0,s.c)(this,"analysisHelpPopoverSelectionChange",7),this.isHelpFileExternalAsset=!1,this.placement="auto",this.analysisEngine=r.A.Standard,this.offsetDistance=20,this.offsetSkidding=0,this.triggerDisabled=!1,this.helpMode="standalone"}async portalChange(e){void 0!==e&&e.isPortal&&void 0===this.portalHelpMap&&(this.portalHelpMap=await(0,a.a_)(e))}async componentWillLoad(){({strings:this.strings,dir:this.dir,locale:this.locale}=await(0,a.u)(this.hostElement,(0,s.a)("."))),void 0!==this.portal&&await this.portalChange(this.portal)}componentDidLoad(){try{setTimeout(()=>requestAnimationFrame(()=>this.popoverElement?.setFocus()),1),setTimeout(()=>{this.popoverElement?.reposition?.()},a.g.PopoverTimer)}catch(e){}}async reposition(){await(this.popoverElement?.reposition?.())}get modifierClasses(){const e="model"===this.helpMode?Ge:We;return`${!0===this.portal?.isPortal?$e:Ue}-${e}`}getContentStyleClass(e){let t=Be;return(-1!==e.indexOf("Category")||-1!==e.indexOf("Tool")||-1!==e.indexOf("toolDescription"))&&(t=He),t}getLocalizedLearnMoreUrl(){let e;if(void 0!==this.learnMoreBaseUrl){e="/"!==this.learnMoreBaseUrl.charAt(this.learnMoreBaseUrl.length-1)?this.learnMoreBaseUrl+"/":this.learnMoreBaseUrl;const t=this.locale.toLocaleLowerCase();!0===a.a$.includes(t)&&(e=e.replace(/(\/|^)(en)(\/|$)/,`$1${t}$3`))}return e}getLearnMoreUrlForWebAnalysis(){let e;if(void 0!==this.learnMoreBaseUrl){const t=!0===this.portal?.isPortal?r.n.map:r.m.map,i=(0,n.w)(t,`${this.helpFileName}${(0,a.x)(this.analysisEngine)}.${this.helpId}`);if(void 0!==i&&void 0!==this.learnMoreBaseUrl){const t=this.getLocalizedLearnMoreUrl();if(!0===this.portal?.isPortal&&void 0!==this.portalHelpMap?.m){e=`${t}${this.portalHelpMap.m[i]}`;const{restUrl:s}=this.portal;e=(0,a.b0)(e,s)}else void 0!==this.portal&&!1!==this.portal?.isPortal||(e=`${t}analyze/${i}`)}}return e}getLearnMoreForCustomHelpMap(){let e;if(void 0!==this.externalHelpMap&&void 0!==this.helpId&&void 0!==this.helpFileName&&(e=(0,n.w)(this.externalHelpMap.map,`${this.helpFileName}.${this.helpId}`),void 0!==e&&void 0!==this.learnMoreBaseUrl)){const t="/"!==this.learnMoreBaseUrl.charAt(this.learnMoreBaseUrl.length-1)?this.learnMoreBaseUrl+"/":this.learnMoreBaseUrl;e=`${!0===this.isHelpFileExternalAsset?t:this.getLocalizedLearnMoreUrl()}${e}`}return e}getLearnMoreUrl(){let e;return void 0!==this.learnMoreBaseUrl?e=void 0!==this.externalHelpMap?this.getLearnMoreForCustomHelpMap():this.getLearnMoreUrlForWebAnalysis():void 0!==this.learnMoreUrl&&(e=this.learnMoreUrl),e}renderHelpUsingNode(){return(0,s.h)("div",{class:Qe},(0,s.h)("p",null,this.helpNode))}renderIframeUsingSrcDoc(){return(0,s.h)("iframe",{class:this.getContentStyleClass(this.helpId),id:this.helpId,title:this.heading??this.helpId,srcdoc:this.helpSrcdoc})}renderIframeUsingHelpUrl(){const e=!1===this.isHelpFileExternalAsset?(0,s.a)(this.helpUrl):this.helpUrl,t=void 0!==e?`${e}#${this.helpId}-${this.modifierClasses}`:"";return(0,s.h)("iframe",{class:this.getContentStyleClass(this.helpId),id:this.helpId,title:this.heading??this.helpId,src:t})}render(){let e,t;if((0,a.P)(this.helpSrcdoc))e=this.renderIframeUsingSrcDoc(),t=this.getLearnMoreUrl();else if((0,a.P)(this.helpUrl))e=this.renderIframeUsingHelpUrl(),t=this.getLearnMoreUrl();else if((0,a.P)(this.helpNode))e=this.renderHelpUsingNode(),t=this.getLearnMoreUrl();else{const i="toolDescription"===this.helpId?(0,n.w)(this.referenceElement?.getRootNode(),"host.webToolJSON.description"):this.referenceElement?.getAttribute("description");e=(0,s.h)("div",{key:"73dfaf05679883c2d2b2819b4c17fa55aa43c31b",class:Qe},(0,s.h)("p",{key:"755c9487e909c9f68f25c9bb9b0efd8ba2bf33a2"},i??"")),t=(0,n.w)(this.referenceElement?.getRootNode(),"host.webToolJSON.helpUrl")}return(0,s.h)(s.H,{key:"acd0bf29100b0927e0cefc4de7ea86704052b731",class:`${qe} ${_e}`,dir:this.dir,mode:this.mode},(0,s.h)("calcite-popover",{key:"0ac38f230dbe424ea437c13503f80e1acc4ab9ff",overlayPositioning:"fixed",autoClose:!0,ref:e=>this.popoverElement=e,referenceElement:this.referenceElement??"analysis-tool",placement:this.placement,open:this.open,closable:!0,heading:this.heading??this.helpId,headingLevel:4,triggerDisabled:this.triggerDisabled,focusTrapDisabled:!0,label:this.heading??this.helpId??"",offsetDistance:this.offsetDistance,offsetSkidding:this.offsetSkidding,onCalcitePopoverClose:()=>{this.analysisHelpPopoverClose.emit()}},e,void 0!==t&&(0,s.h)("calcite-link",{key:"2114bc203c8874b99480f9019244b112c6eb4fa5",rel:"help",target:"_blank",href:t,class:ze},this.strings.learnMoreLabel)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{portal:["portalChange"]}}};je.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;background-color:var(--calcite-color-foreground-1)}.help-iframe-s{padding:var(--analysis-quarter-spacing);min-height:var(--analysis-popover-content-min-height-s);max-height:var(--analysis-popover-content-max-height);border:0px}.help-iframe-m{padding:var(--analysis-quarter-spacing);min-height:var(--analysis-popover-content-min-height-m);max-height:var(--analysis-popover-content-max-height);border:0px}.help-custom-tool-param{color:#444;font-size:12px;font-family:Verdana, Helvetica, sans-serif;overflow-y:auto;padding:var(--analysis-quarter-spacing);min-height:var(--analysis-popover-content-min-height-s);max-height:var(--analysis-popover-content-max-height);width:300px}.help-custom-tool-param>p{margin:var(--analysis-half-spacing)}.learn-more{margin:var(--analysis-full-spacing)}";const Xe="description-text",Ke=class{constructor(e){(0,s.r)(this,e),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.required=!1,this.hideLabel=!1,this.isValid=!0,this.getMessageText=()=>{const e=!0===this.user?.portal?.isPortal&&void 0!==this.portalHelpMap?this.portalHelpMap?.m[r.n.map.OtherHelpLinks.unsupportedGPType]:r.m.map.OtherHelpLinks.unsupportedGPType,t=(0,a.G)({url:e,basePath:(0,a.Z)(this.user?.portal),portalUrl:this.user?.portal?.restUrl});let i="";return i="GPValueTable"===this.dataType?(0,a.a)(!1===this.isDefaultValueProvided()?this.strings.unsupportedParameterConfig:this.strings.unsupportedParameterConfigDefaultValue,{docLink:t}):(0,a.a)(!1===this.isDefaultValueProvided()?this.strings.unsupportedGPType:this.strings.defaultValue,{docLink:t}),i},this.isDefaultValueProvided=()=>!((0,a.y)(this.value)||Array.isArray(this.value)&&!this.value.some(e=>(0,a.P)(e))||"object"==typeof this.value&&"dataType"in this.value&&(0,a.y)(this.value.value))}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)(".")))}async checkValidity(){return this.isValid=this.required&&this.isDefaultValueProvided()||!this.required,Promise.resolve(this.isValid)}render(){return(0,s.h)(s.H,{key:"006cfc6de0c27a56dc3c977af41fe7c84895ddc7"},!1===this.hideLabel&&(0,s.h)("analysis-label",{key:"7034f39c2aa580c5ca7143ee45e21bfe175f897d",label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),(0,s.h)("div",{key:"198453fe641929bf3e7cdd08c310ffb974298389",innerHTML:this.getMessageText(),class:Xe}),(0,s.h)("calcite-input-message",{key:"2b32e2c05e4317e88f5be43319b597a3c35152d9",status:"invalid",hidden:this.isValid,scale:a.g.Scale,icon:"exclamationMarkTriangle"},this.strings.requiredMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};Ke.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{margin-bottom:var(--analysis-half-spacing)}.description-text{color:var(--calcite-color-text-3);font-size:var(--calcite-font-size--2)}";const Ze="and",Ye="or",Je=["Meters","Kilometers","Feet","Yards","Miles"],et={Intersects:"intersects",NotIntersects:"notIntersects",WithinDistance:"withinDistance",NotWithinDistance:"notWithinDistance",Contains:"contains",NotContains:"notContains",Within:"within",NotWithin:"notWithin",Nearest:"nearest"},tt="error-notice",it={ParsingFailed:"parsingPreviousQueryError",MissingField:"missingFields",UnsupportedFieldType:"unsupportedFieldType",InvalidFieldTypeForOperator:"invalidFieldTypeForOperator",UnsupportedOperator:"unsupportedOperator",InvalidOperandValue:"invalidOperandValue",MissingColumnReference:"missingColumnReference",InvalidExpression:"invalidExpression",MixedLogicalOperators:"mixedLogicalOperators",MixedLayers:"mixedLayers",PartialThisMonthExpression:"partialThisMonthExpression",PartialThisDayExpression:"partialThisDayExpression",ThisDateMismatchedFields:"thisDateMixedFields",UnsupportedDateUnit:"unsupportedDateUnit",ValueCannotBeBlank:"valueCannotBeBlank"};function st(e){return"small-integer"===e||"integer"===e||"big-integer"===e||"long"===e||"oid"===e}function at(e){return"single"===e||"double"===e}class lt extends Error{constructor(e){super(`QueryBuilderError: ${e}`),this.code=e}static fromUnknownError(e,t){return e instanceof lt?e:(console.warn("Unrecognized query error.",e),new lt(t??it.ParsingFailed))}toTranslatedString(e){return e[this.code]}}function rt(e,t){if(!1===e){if(Object.values(it).includes(t))throw new lt(t);throw new Error(t)}}let nt=0;function ot(){return nt+=1,`${nt}`}const ht=86399e3;function ct(e){const t=function(e){return new Date(e.toDateString())}(e),i=function(e){return new Date(e.getTime()+ht)}(e);return[t,i]}function dt(e){const t=e[0],i=(s=e[1],new Date(s.getTime()-ht));var s;return Math.abs(i.getTime()-t.getTime())<1e3}const pt=Object.freeze({equal:(e,t)=>`${e} = ${t}`,not_equal:(e,t)=>`${e} <> ${t}`,is_in:(e,t)=>`${e} IN(${t.join(", ")})`,is_not_in:(e,t)=>`${e} NOT IN(${t.join(", ")})`,less:(e,t)=>`${e} < ${t}`,less_or_equal:(e,t)=>`${e} <= ${t}`,greater:(e,t)=>`${e} > ${t}`,greater_or_equal:(e,t)=>`${e} >= ${t}`,between:(e,t)=>`${e} BETWEEN ${t.join(" AND ")}`,not_between:(e,t)=>`${e} NOT BETWEEN ${t.join(" AND ")}`,contains:(e,t)=>`${e} LIKE '%${t.slice(1,-1)}%'`,not_contains:(e,t)=>`${e} NOT LIKE '%${t.slice(1,-1)}%'`,begins_with:(e,t)=>`${e} LIKE '${t.slice(1,-1)}%'`,not_begins_with:(e,t)=>`${e} NOT LIKE '${t.slice(1,-1)}%'`,ends_with:(e,t)=>`${e} LIKE '%${t.slice(1,-1)}'`,not_ends_with:(e,t)=>`${e} NOT LIKE '%${t.slice(1,-1)}'`,is_empty:(e,t)=>`${e} = ''`,is_not_empty:(e,t)=>`${e} <> ''`,is_blank:(e,t)=>`${e} IS Null`,is_not_blank:(e,t)=>`${e} IS NOT Null`,is_on:(e,t)=>`${e} BETWEEN ${t}`,is_not_on:(e,t)=>`${e} NOT BETWEEN ${t}`,is_before:(e,t)=>`${e} < ${t}`,is_after:(e,t)=>`${e} > ${t}`,in_the_last:(e,t)=>`${e} BETWEEN ${t}`,this_year:(e,t)=>`EXTRACT(YEAR FROM ${e}) = EXTRACT(YEAR FROM CURRENT_DATE)`,this_month:(e,t)=>`(EXTRACT(MONTH FROM ${e}) = EXTRACT(MONTH FROM CURRENT_DATE) AND EXTRACT(YEAR FROM ${e}) = EXTRACT(YEAR FROM CURRENT_DATE))`,this_day:(e,t)=>`(EXTRACT(DAY FROM ${e}) = EXTRACT(DAY FROM CURRENT_DATE) AND EXTRACT(MONTH FROM ${e}) = EXTRACT(MONTH FROM CURRENT_DATE) AND EXTRACT(YEAR FROM ${e}) = EXTRACT(YEAR FROM CURRENT_DATE))`,not_in_the_last:(e,t)=>`${e} NOT BETWEEN ${t}`,is_true:(e,t)=>`${e} IS TRUE`,is_false:(e,t)=>`${e} IS FALSE`}),ut={"<":"less","<=":"less_or_equal",">":"greater",">=":"greater_or_equal","=":"equal","<>":"not_equal",IN:"is_in","NOT IN":"is_not_in",BETWEEN:"between",NOTBETWEEN:"not_between"},mt=["between","not_between","equal","not_equal","is_in","is_not_in","greater","greater_or_equal","less","less_or_equal","is_blank","is_not_blank"],yt=["equal","not_equal","is_in","is_not_in","contains","not_contains","begins_with","not_begins_with","ends_with","not_ends_with","is_blank","is_not_blank","is_empty","is_not_empty"],gt=["between","not_between","is_on","is_not_on","is_before","is_after","in_the_last","not_in_the_last","is_blank","is_not_blank","this_year","this_month","this_day"],vt=["between","not_between","is_on","is_not_on","is_before","is_after","in_the_last","not_in_the_last","is_blank","is_not_blank","this_year","this_month","this_day"],ft=["is_blank","is_not_blank"],bt=["is_blank","is_not_blank","is_true","is_false"],Ct=["between","not_between"],wt=["is_in","is_not_in"],xt=["in_the_last","not_in_the_last"],Lt={date:["minute","hour","day","week"],"date-only":["day","week"]},It=["is_blank","is_not_blank","is_empty","is_not_empty","is_true","is_false","this_year","this_month","this_day"];function kt(e){return Ct.includes(e)}function Et(e){return wt.includes(e)}function St(e){return It.includes(e)}function Mt(e){let t,i;switch(e){case"string":t="equal",i=yt;break;case"small-integer":case"integer":case"big-integer":case"single":case"double":case"long":case"oid":t="equal",i=mt;break;case"date":t="is_on",i=gt;break;case"date-only":t="is_on",i=vt;break;case"geometry":t="is_blank",i=ft;break;case"boolean":t="is_true",i=bt;break;default:throw new lt(it.UnsupportedFieldType)}return{defaultOperator:t,supportedOperators:i}}function Ft(e,t){return t?`"${e}"`:e}function Tt(e,t){switch(t){case"integer":case"small-integer":case"big-integer":case"long":case"oid":return null==e?"0":("number"!=typeof e&&(e=parseInt(e)),"number"==typeof e&&isNaN(e)?"0":`${e}`);case"double":case"single":return null==e?"0.0":("number"!=typeof e&&(e=parseFloat(e)),"number"==typeof e&&isNaN(e)?"0.0":`${e}`);case"date":const t=e instanceof Date?e:void 0;return void 0!==t?`timestamp '${function(e){if(void 0===e)return"";const t=`${e.getUTCFullYear()}`;let i=`${e.getUTCMonth()+1}`;1===i.length&&(i=`0${i}`);let s=`${e.getUTCDate()}`;1===s.length&&(s=`0${s}`);let a=`${e.getUTCHours()}`;1===a.length&&(a=`0${a}`);let l=`${e.getUTCMinutes()}`;1===l.length&&(l=`0${l}`);let r=`${e.getUTCSeconds()}`;return 1===r.length&&(r=`0${r}`),`${t}-${i}-${s} ${a}:${l}:${r}`}(t)}'`:"''";case"date-only":return void 0!==e?`date '${e}'`:"''";case"string":const i=e;return`'${null==i?"":i.replace(/'/g,"''")}'`;case"boolean":case"geometry":return"";default:throw new lt(it.UnsupportedFieldType)}}function Vt(e){switch(e.type){case"string":case"number":case"date":case"boolean":return e.value;case"null":return null;case"timestamp":return function(e){const t=new Date(e);return new Date(t.getTime()-6e4*t.getTimezoneOffset())}(e.value);default:throw new lt(it.InvalidOperandValue)}}function Pt(e){if("binary-expression"!==e.type||"="!==e.operator||"function"!==e.left.type||"extract"!==e.left.name||"expression-list"!==e.left.args.type||"function"!==e.right.type||"extract"!==e.right.name||"expression-list"!==e.right.args.type)return;const t=[...e.left.args.value,...e.right.args.value];let i,s,a;if("string"===t[0].type)switch(t[0].value.toLowerCase()){case"year":i="this_year";break;case"month":i="this_month";break;case"day":i="this_day"}if(void 0===i)throw new lt(it.UnsupportedDateUnit);for(const e of t)"column-reference"===e.type?s=e.column:"current-time"===e.type&&(a=e);if(void 0===s)throw new lt(it.MissingColumnReference);if(void 0===a)throw new lt(it.InvalidOperandValue);return{field:s,operator:i}}function Dt(e){if("binary-expression"!==e.type)return;let t;if("="===e.operator){if(t=Pt(e),"this_month"===t?.operator)throw new lt(it.PartialThisMonthExpression);if("this_day"===t?.operator)throw new lt(it.PartialThisDayExpression)}else if("AND"===e.operator)if("binary-expression"===e.left.type&&"AND"===e.left.operator){const i=Pt(e.left.left),s=Pt(e.left.right),a=Pt(e.right),l=[i?.operator,s?.operator,a?.operator],r=new Set([i?.field,s?.field,a?.field]);if(l.includes("this_day")&&l.includes("this_month")&&l.includes("this_year")){if(1!==r.size)throw new lt(it.ThisDateMismatchedFields);t={field:i.field,operator:"this_day"}}}else{const i=Pt(e.left),s=Pt(e.right),a=[i?.operator,s?.operator],l=new Set([i?.field,s?.field]);if(a.includes("this_month")&&a.includes("this_year")){if(1!==l.size)throw new lt(it.ThisDateMismatchedFields);t={field:i.field,operator:"this_month"}}}return t}var At;function Ot(e){return null==e}function Rt(e,t){let i,s=!0;return!Ot(e)&&""!==e||!1!==St(t)?"number"!=typeof e||!isNaN(e)&&isFinite(e)||(s=!1):(s=!1,i=new lt(it.ValueCannotBeBlank)),{isValid:s,queryError:i}}class Nt{constructor(e,t,i,s,a,l){this.field=e,this.dataType=t,this.value=i,this.operator=s,this.id=a??ot(),this.error=l}}class qt extends Nt{constructor(){super(...arguments),this.type="value"}validate(){const{isValid:e,queryError:t}=Rt(this.value,this.operator);return this.error=t,e}toSQL(e){let t;if("date"===this.dataType)t=this.toSQLForDate(this.value,this.operator,e);else if("date-only"===this.dataType)t=this.toSQLForDateOnly(this.value,this.operator,e);else{const i=Ft(this.field,!0===e?.useDelimitedIdentifiers),s=Tt(this.value,this.dataType);t=pt[this.operator](i,s)}return t}toSQLForDate(e,t,i){const s=Ft(this.field,!0===i?.useDelimitedIdentifiers);switch(t){case"is_on":case"is_not_on":const i=void 0!==e?ct(e).map(e=>Tt(e,"date")):["''","''"];return pt[t](s,`${i[0]} AND ${i[1]}`);default:const a=Tt(e,"date");return pt[t](s,a)}}toSQLForDateOnly(e,t,i){const s=Ft(this.field,!0===i?.useDelimitedIdentifiers),a=Tt(e,this.dataType);switch(t){case"is_on":return pt.equal(s,a);case"is_not_on":return pt.not_equal(s,a);default:return pt[t](s,a)}}}class _t extends Nt{constructor(){super(...arguments),this.type="multi-value"}get validValues(){return this.value.filter(e=>Rt(e).isValid)}validate(){const e=this.validValues.length>0;return this.error=e?void 0:new lt(it.ValueCannotBeBlank),e}toSQL(e){const t=Ft(this.field,!0===e?.useDelimitedIdentifiers),i=this.validValues.map(e=>Tt(e,this.dataType));return pt[this.operator](t,i)}}class Bt extends Nt{constructor(){super(...arguments),this.type="range"}validate(){const{isValid:e,queryError:t}=Rt(this.value[0]),{isValid:i,queryError:s}=Rt(this.value[1]);return this.error=t??s,e&&i}toSQL(e){const t=Ft(this.field,!0===e?.useDelimitedIdentifiers),i=Tt(this.value[0],this.dataType),s=Tt(this.value[1],this.dataType);return pt[this.operator](t,[i,s])}}class Ht extends Nt{constructor(){super(...arguments),this.type="distance"}validate(){const{isValid:e,queryError:t}=Rt(this.value.distance),{isValid:i,queryError:s}=Rt(this.value.unit);return this.error=t??s,e&&i}toSQL(e){if("date"!==this.dataType&&"date-only"!==this.dataType)throw new lt(it.InvalidFieldTypeForOperator);const t=Ft(this.field,!0===e?.useDelimitedIdentifiers),i=function(e,t,i){const s="date-only"===i?"CURRENT_DATE":"CURRENT_TIMESTAMP";switch(t){case"minute":return`CURRENT_TIMESTAMP - INTERVAL '${e}' MINUTE AND CURRENT_TIMESTAMP`;case"hour":return`CURRENT_TIMESTAMP - INTERVAL '${e}' HOUR AND CURRENT_TIMESTAMP`;case"day":return`${s} - INTERVAL '${e}' DAY AND ${s}`;case"week":return`${s} - INTERVAL '${7*e}' DAY AND ${s}`;default:throw new lt(it.UnsupportedDateUnit)}}(this.value.distance??0,this.value.unit??"hour",this.dataType);return pt[this.operator](t,i)}}class zt{constructor(e,t,i,s){this.layer=e,this.selectingLayer=t,this.spatialRelationship=i,this.spatialRelationshipParams=s}get isDistanceRelationship(){return"withinDistance"===this.spatialRelationship||"notWithinDistance"===this.spatialRelationship}validate(){let e=void 0!==this.selectingLayer&&void 0!==this.spatialRelationship;if(this.isDistanceRelationship){const{distance:t,units:i}=this.spatialRelationshipParams??{},{isValid:s}=Rt(t),{isValid:a}=Rt(i);e=e&&s&&a}return e}changeSelectingLayer(e){return new zt(this.layer,e,this.spatialRelationship,this.spatialRelationshipParams)}static getValidLayersForRelationships(e,t,i){const s=new Map;return i.forEach(i=>{let a=this.filterLayersBasedOnGeometryType(e,t,i);a=this.getValidSelectingLayers(e,a??[]),s.set(i,a)}),s}static filterLayersBasedOnGeometryType(e,t,i){const s=new Map;t.forEach(e=>{if(s.has(e.geometryType)){s.get(e.geometryType).push(e)}else s.set(e.geometryType,[e])});const a=e.geometryType,l=s.get("polygon")??[],r=s.get("polyline")??[],n=s.get("point")??[],o=s.get("multipoint")??[];let h=[];return h="contains"===i||"notContains"===i?"polygon"===a?[...n,...r,...l,...o]:"polyline"===a?[...n,...r,...o]:"point"===a||"multipoint"===a?[...n,...o]:[]:"within"===i||"notWithin"===i?"point"===a||"multipoint"===a?[...n,...r,...l,...o]:"polyline"===a?[...l,...r]:"polygon"===a?l:[]:t,h}static getValidSelectingLayers(e,t){return t.filter(t=>e.id!==t.id)}changeSpatialRelationship(e){const t=new zt(this.layer,this.selectingLayer,e);return t.isDistanceRelationship&&(t.spatialRelationshipParams={distance:this.spatialRelationshipParams?.distance,units:this.spatialRelationshipParams?.units??Je[0]}),t}changeSpatialRelationshipDistance(e){const t={...this.spatialRelationshipParams,distance:e};return new zt(this.layer,this.selectingLayer,this.spatialRelationship,t)}changeSpatialRelationshipUnit(e){const t={...this.spatialRelationshipParams,units:e};return new zt(this.layer,this.selectingLayer,this.spatialRelationship,t)}}function Ut(e,t,i){if(null==e)return!1;const s=t?.allowGeometryFields??!1,a=[i?.geometryFieldsInfo?.shapeAreaField,i?.geometryFieldsInfo?.shapeLengthField].includes(e.name)&&!1===s;if(!0===t?.hideObjectIdField&&e.name===i?.objectIdField||!0===a)return!1;switch(e.type){case"string":case"small-integer":case"integer":case"single":case"double":case"long":case"big-integer":case"date":case"date-only":case"geometry":case"oid":return!0;default:return!1}}function $t(e,t){let i;return Ot(e.description)||(e.description===t?.booleanFieldDescription?i="boolean":!0===t?.geometryFieldDescriptions?.includes(e.description)&&(i="geometry")),i}function Gt(e){let t="value";return kt(e)?t="range":Et(e)?t="multi-value":function(e){return xt.includes(e)}(e)&&(t="distance"),t}class Wt{constructor(e){this.expression=e}validate(){return this.expression.validate(),At.create({...this.expression})}changeOperator(e){const{field:t,dataType:i,id:s}=this.expression,a=At.create({field:t,dataType:i,operator:e,id:s});return Gt(e)===this.expression.type&&(a.value=this.expression.value),a}changeField(e,t){if(!Ut(e,t))throw new lt(it.UnsupportedFieldType);const i=$t(e,t)??e.type;return At.create({field:e.name,dataType:i,id:this.expression.id})}changeValue(e){return At.create({field:this.expression.field,dataType:this.expression.dataType,operator:this.expression.operator,value:e,id:this.expression.id})}static create({field:e,dataType:t,operator:i,id:s,value:a,error:l}){let r;const{supportedOperators:n,defaultOperator:o}=Mt(t);if(void 0!==i&&!n.includes(i))throw new lt(it.InvalidFieldTypeForOperator);const h=i??o;switch(Gt(h)){case"value":r=new qt(e,t,a,h,s,l);break;case"multi-value":r=new _t(e,t,a??[],h,s,l);break;case"range":r=new Bt(e,t,a??[void 0,void 0],h,s,l);break;case"distance":r=new Ht(e,t,a??{unit:"day"},h,s,l)}return r}static createDefaultForLayer(e,t){const i=e.fields.filter(i=>Ut(i,t,e));if(!(i.length<1)){const e=i[0],s=$t(e,t)??e.type;return At.create({field:e.name,dataType:s})}}}At=Wt,Wt.fromSQL=async(e,t,i)=>{try{const s=await(0,a.b1)(e,t);return At.fromSQLNode(s.parseTree,t,i)}catch(e){throw lt.fromUnknownError(e,it.InvalidExpression)}},Wt.fromSQLNode=(e,t,i)=>{rt("binary-expression"===e.type,it.InvalidExpression);const s=Dt(e);if(void 0!==s){const e=t.get(s.field);return rt((0,a.P)(e),it.MissingField),rt(Ut(e,i),it.UnsupportedFieldType),rt("date"===e.type||"date-only"===e.type,it.InvalidFieldTypeForOperator),new qt(e.name,e.type,void 0,s.operator)}let l,r;"column-reference"===e.left.type?(l=e.left,r=e.right):(l=e.right,r=e.left),rt("column-reference"===l.type,it.InvalidExpression);const n=t.get(l.column);let o;rt((0,a.P)(n),it.MissingField),rt(Ut(n,i),it.UnsupportedFieldType);const h=ut[e.operator],c=function(e){if("expression-list"!==e.type)return;const t=e.value;if(2===t.length&&"binary-expression"===t[0].type&&"current-time"===t[0].left.type&&"interval"===t[0].right.type&&"current-time"===t[1].type&&"interval-period"===t[0].right.qualifier.type){const e=t[0].right.qualifier.period,i=Number.parseFloat(t[0].right.value.value);switch(rt(!isNaN(i),it.InvalidOperandValue),e){case"day":return i%7==0?{distance:i/7,unit:"week"}:{distance:i,unit:"day"};case"hour":return{distance:i,unit:"hour"};case"minute":return{distance:i,unit:"minute"};case"month":case"second":case"year":throw new lt(it.UnsupportedDateUnit)}}}(r);if(void 0!==c){const e="between"===h?"in_the_last":"not_in_the_last";o=new Ht(n.name,n.type,c,e)}else if(kt(h)){rt("expression-list"===r.type,it.InvalidExpression);const e=r.value,t=Vt(e[0]),i=Vt(e[1]);if(o=new Bt(n.name,n.type,[t,i],h),t instanceof Date&&i instanceof Date&&dt([t,i])){const e="between"===o.operator?"is_on":"is_not_on";o=new qt(n.name,n.type,t,e)}}else if(Et(h)){rt("expression-list"===r.type,it.InvalidExpression);const e=r.value.map(Vt);o=new _t(n.name,n.type,e,h)}else{const[t,s]=function(e,t){const i=Vt(t);switch(e){case"IS":if(null===i)return["is_blank",void 0];if("boolean"==typeof i)return[!0===i?"is_true":"is_false",void 0];throw new lt(it.InvalidOperandValue);case"ISNOT":if(null===i)return["is_not_blank",void 0];throw new lt(it.InvalidOperandValue);case"=":return""===i?["is_empty",""]:"date"===t.type?["is_on",i]:["equal",i];case"<>":return""===i?["is_not_empty",""]:"date"===t.type?["is_not_on",i]:["not_equal",i];case"<":return"date"===t.type||"timestamp"===t.type?["is_before",i]:["less",i];case">":return"date"===t.type||"timestamp"===t.type?["is_after",i]:["greater",i];case"LIKE":return rt("string"==typeof i,it.InvalidOperandValue),i.startsWith("%")&&i.endsWith("%")?["contains",i.substring(1,i.length-1)]:i.endsWith("%")?["begins_with",i.substring(0,i.length-1)]:i.startsWith("%")?["ends_with",i.substring(1)]:["equal",i];case"NOT LIKE":return rt("string"==typeof i,it.InvalidOperandValue),i.startsWith("%")&&i.endsWith("%")?["not_contains",i.slice(1,i.length-1)]:i.endsWith("%")?["not_begins_with",i.slice(0,i.length-1)]:i.startsWith("%")?["not_ends_with",i.slice(1)]:["not_equal",i];default:const s=ut[e];return rt(void 0!==s,it.UnsupportedOperator),[s,i]}}(e.operator,r),a=$t(n,i)??n.type;o=new qt(n.name,a,s,t)}const{supportedOperators:d}=Mt(o.dataType);return rt(d.includes(o.operator),it.InvalidFieldTypeForOperator),o};class Qt{constructor(e,t="",i=[],s,a){this.toJSON=async(e,t)=>{const i=this.getUsedLayers(e);return{expressions:this.toGPQuery(i),inputLayers:await this.serializeLayers(i,t)}},this.toGPQuery=(e,t="")=>{const i=[];return this.children.forEach((s,a)=>{let l=0===a?t:this.operator;if(s instanceof Qt){if(!0===s.spatialExpression?.validate()){const t=(({expression:e,operator:t,layer:i,layerList:s})=>{const{spatialRelationship:a,spatialRelationshipParams:l}=e,r=e.selectingLayer;return{operator:t,layer:s.findIndex(e=>e.id===i.id),selectingLayer:s.findIndex(e=>e.id===r.id),spatialRel:a,distance:l?.distance,units:l?.units}})({operator:l,expression:s.spatialExpression,layer:this.layer,layerList:e});i.push(t),l="and"}const t=s.toGPQuery(e,l);t.length>0&&i.push(t)}else if(s.validate()){const t=(({expression:e,operator:t,layer:i,layerList:s})=>({operator:t,layer:s.findIndex(e=>e.id===i.id),where:e.toSQL()}))({operator:l,expression:s,layer:this.layer,layerList:e});i.push(t)}}),i},this.layer=e,this.operator=t,this.children=i,this.spatialExpression=s,this.id=a??ot()}static async fromSQL(e,t,i){let s,l;if(""===e)s=new Qt(t);else try{const{parseTree:r}=await(0,a.b1)(e,t.fieldsIndex),n=Qt.fromSQLNode(r,t,i);s=n.group,l=0===n.errors.length?void 0:n.errors}catch(e){l=[lt.fromUnknownError(e)]}return{group:s,errors:l}}static fromSQLNode(e,t,i){let s;const a=[],l=[],r=[e];for(;r.length>0;)try{const e=r.pop();if("binary-expression"===e.type&&("AND"===e.operator&&void 0===Dt(e)||"OR"===e.operator))if(s??(s=e.operator),s===e.operator)r.push(e.right),r.push(e.left);else{const s=Qt.fromSQLNode(e,t,i);l.push(...s.errors),a.push(s.group)}else{const s=Wt.fromSQLNode(e,t.fieldsIndex,i);a.push(s)}}catch(e){const t=lt.fromUnknownError(e,it.MissingField);l.push(t)}const n=void 0===s?"and":s.toLowerCase();return{group:new Qt(t,n,a),errors:l}}toSQL(e){const t=this.operator.toUpperCase();return this.children.map(t=>{let i;if(t instanceof Qt){const s=t.toSQL(e);""!==s&&(i=`(${s})`)}else t.validate()&&(i=t.toSQL(e));return i}).filter(e=>void 0!==e).join(` ${t} `)}static async fromJSON(e,t){let i,s;if(e.length<1)i=new Qt(t[0]);else{const a=await Qt._fromJSON(e,t);i=a.group,s=0===a.errors.length?void 0:a.errors}return{group:i,errors:s}}static async _fromJSON(e,t){let i,s,a="";const l=[],r=new Set,n=[];for(let o=0;o<e.length;o++)if(!r.has(o))try{let h,c;const d=e[o];if(Array.isArray(d)){const e=await Qt._fromJSON(d,t);n.push(...e.errors),l.push(e.group),c=e.group.layer,h=e.combineOperator}else if("spatialRel"in d){const{layer:i,selectingLayer:s,units:a,distance:p,spatialRel:u,operator:m}=d,y=new zt(t[i],t[s],u,{units:a,distance:p}),g=e[o+1];if(Array.isArray(g)){const e=await Qt._fromJSON(g,t);if(n.push(...e.errors),y.selectingLayer===e.group.layer)e.group.spatialExpression=y,l.push(e.group),r.add(o+1);else{const e=y.selectingLayer,t=new Qt(e,m,[],y);l.push(t)}}else{const e=new Qt(t[s],m,[],y);l.push(e)}c=t[i],h=m}else{const{where:e,layer:i,operator:s}=d,a=await Wt.fromSQL(e,t[i].fieldsIndex);l.push(a),c=t[i],h=s}0===o?a=h:(s??(s=h),rt(s===h,it.MixedLogicalOperators)),i??(i=c),rt(i===c,it.MixedLayers)}catch(e){const t=lt.fromUnknownError(e);n.push(t)}let o;return o=void 0===i?new Qt(t[0],"and",[]):new Qt(i,s??"and",l),{group:o,combineOperator:a,errors:n}}getUsedLayersIds(e){return e.add(this.layer.id),void 0!==this.spatialExpression&&e.add(this.spatialExpression.selectingLayer.id),this.children.forEach(t=>{t instanceof Qt&&t.getUsedLayersIds(e)}),e}getUsedLayers(e){const t=[...this.getUsedLayersIds(new Set)],i=new Map;e.forEach(e=>i.set(e.id,e));return t.map(e=>i.get(e))}async serializeLayers(e,t){let i=[];return i=(await Promise.all(e.map(e=>(0,a.aG)(e,t)))).map(e=>(0,r.o)(e,"itemId")),i}changeTarget(e){return new Qt(e,this.operator,[],void 0,this.id)}addDefaultSpatialExpression(e,t){const i=zt.getValidSelectingLayers(e,t)[0]??e,s=new zt(e,i,et.Intersects),a=new Qt(i,"and",[],s),l=[...this.children,a];return new Qt(this.layer,this.operator,l,this.spatialExpression,this.id)}addExpression(e){const t=[...this.children,e];return new Qt(this.layer,this.operator,t,this.spatialExpression,this.id)}addDefaultExpression(e){const t=Wt.createDefaultForLayer(this.layer,e);return void 0===t?this:this.addExpression(t)}addGroup(e){const t=[...this.children,e];return new Qt(this.layer,this.operator,t,this.spatialExpression,this.id)}addNewGroup(e="and"){const t=new Qt(this.layer,e,[],void 0,this.id);return this.addGroup(t)}removeChild(e){return this.children.splice(e,1),new Qt(this.layer,this.operator,this.children,this.spatialExpression,this.id)}changeSpatialExpression(e){const{layer:t,children:i}=this;let s=t,a=i;const l=this.spatialExpression?.selectingLayer,r=e.selectingLayer;return l!==r&&(s=r,a=[]),new Qt(s,this.operator,a,e,this.id)}clone(){const e=[...this.cloneChildren(this.children)];return new Qt(this.layer,this.operator,e,this.spatialExpression,this.id)}cloneChildren(e){return e.map(e=>{if(e instanceof Qt){const t=this.cloneChildren(e.children);return new Qt(e.layer,e.operator,t,e.spatialExpression,e.id)}return t=e,(0,r.p)(t,5);var t})}}const jt="border",Xt="mb-half",Kt="list-item",Zt={error:"__aborted__"},Yt=class{constructor(e){(0,s.r)(this,e),this.analysisQueryInputChange=(0,s.c)(this,"analysisQueryInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.loading=!0,this.required=!1,this.mode="analysis",this.hideHelp=!1,this.mapLayers=[],this.recordsTerm="features",this.readOnly=!1,this.openModal=()=>{this.queryModal=document.createElement("analysis-query-modal"),"sql"===this.mode?(this.queryModal.target=this.layer??this.expressionGroup?.layer,this.queryModal.layers=[]):(this.queryModal.target=this.layer??this.expressionGroup?.layer??this.combinedLayers[0],this.queryModal.layers=this.combinedLayers);const e="howToBuildAQuery";let t;t=void 0!==this.externalHelpMap&&void 0!==this.helpKey?this.externalHelpMap.map[this.helpKey]:!0===this.portal?.isPortal&&void 0!==this.portalHelpMap?this.portalHelpMap?.m[r.n.map.OtherHelpLinks[e]]:r.m.map.OtherHelpLinks[e];const i=(0,a.G)({url:t,basePath:this.customHelpBase??(0,a.Z)(this.portal),portalUrl:void 0!==this.customHelpBase?void 0:this.portal?.restUrl});!1===this.hideHelp&&(this.queryModal.docLink=i),this.queryModal.expressionGroup=this.expressionGroup,this.queryModal.recordsTerm=this.recordsTerm,this.queryModal.mode=this.mode,this.queryModal.open=!0;const s=!0===this.modelVariables?.find(e=>this.queryModal?.target?.id===e.id)?.isDerived,l=(0,a.P)(this.modelVariables)&&(0,a.a7)(this.queryModal.target);this.queryModal.options={showDerivedLayerMessage:s,hideObjectIdField:l,...this.options},this.hasValue&&void 0!==this.value&&(this.queryModal.value=this.value),this.queryModal.addEventListener("analysisQueryModalAdd",this.onQueryModalAddClick),this.queryModal.addEventListener("analysisQueryModalError",this.onQueryModalError),this.queryModal.addEventListener("analysisQueryModalDismissed",this.onQueryModalDismissed),document.body.appendChild(this.queryModal)},this.closeModal=()=>{this.queryModal?.removeEventListener("analysisQueryModalAdd",this.onQueryModalAddClick),this.queryModal?.removeEventListener("analysisQueryModalError",this.onQueryModalError),this.queryModal?.removeEventListener("analysisQueryModalDismissed",this.onQueryModalDismissed),this.queryModal?.remove()},this.onQueryModalError=e=>{this.errorMessage=e.detail},this.onQueryModalAddClick=async e=>{const t=e.detail;this.value=await this.serializeExpressionGroup(t),this.analysisQueryInputChange.emit(this.value),this.validate()},this.serializeExpressionGroup=async e=>{let t;if("sql"===this.mode)t=e?.toSQL(this.options);else{const i=await(e?.toJSON(this.combinedLayers,this.mapView));void 0!==i?.expressions&&void 0!==i?.inputLayers&&(t={expressions:i?.expressions,inputLayers:i?.inputLayers})}return t},this.onQueryModalDismissed=()=>{this.closeModal(),this.validate({preserveExistingErrors:!0})},this.onDeleteQuery=()=>{this.value=void 0,this.analysisQueryInputChange.emit(void 0),this.validate()}}async valueChange(){if("analysis"===this.mode){const e=await this.loadGPQueryLayers(this.value,this.combinedLayers);this.combinedLayers=this.combineLayers(e.result??[],this.combinedLayers)}const e=await this.parseCurrentValue();this.expressionGroup=e.result,this.maybeSetFirstError([e]),this.setValueLabel()}setValueLabel(){const e="features"===this.recordsTerm?this.strings.featureValueHeader:this.strings.recordsValueHeader,t=this.expressionGroup?.layer;(0,a.P)(t?.title)?this.valueLabel=(0,a.a)(e,{layer:t.title}):this.valueLabel=(0,a.a)(e,{layer:""})}async mapLayersChange(e){const t=await this.loadSupportedMapLayers(e),i=this.expressionGroup?.getUsedLayers(this.combinedLayers);this.combinedLayers=this.combineLayers(i??[],t.result??[]),this.maybeSetFirstError([t])}async targetLayerChange(e){if(void 0===e)return;const t=await this.loadTargetLayer(e),i=await this.parseCurrentValue();void 0===t.error&&void 0!==i.result&&(this.expressionGroup=i.result,this.setValueLabel()),void 0!==this.errorMessage&&this.errorMessage!==this.strings.isRequired&&(this.errorMessage=void 0),this.maybeSetFirstError([t,i])}get hasError(){return(0,a.P)(this.errorMessage)}get hasValue(){let e;if("string"==typeof this.value)e=""!==this.value;else if(void 0!==this.value){const{expressions:t,inputLayers:i}=this.value;e=void 0!==t&&t.length>0&&void 0!==i&&i.length>0}else e=!1;return e}get hasAnalysisLayersLoadError(){return"analysis"===this.mode&&this.errorMessage===this.strings.layersLoadError}get canCreateQuery(){const e=void 0===this.layer||void 0!==this.layer.loadError&&null!==this.layer.loadError,t=void 0===this.combinedLayers||0===this.combinedLayers.length;return"sql"===this.mode?!e&&!this.readOnly:!(e&&t)}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.loading=!0,this.loadInitialState().finally(()=>this.loading=!1)}async loadInitialState(){const e=await this.loadTargetLayer(this.layer),t=await this.loadSupportedMapLayers(this.mapLayers),i=t.result??[],s=await this.loadGPQueryLayers(this.value,i),a=s.result??[];if(this.combinedLayers=this.combineLayers(a,i),0!==this.combinedLayers.length||void 0!==this.layer){const i=await this.parseCurrentValue();if(void 0!==i.result){this.expressionGroup=i.result,this.setValueLabel();[e,t,s].some(e=>void 0!==e.error)||void 0===this.value||"string"==typeof this.value||(this.value={expressions:this.value.expressions,inputLayers:this.addMapLayerFiltersToInputLayers(this.value.inputLayers,this.combinedLayers)},this.analysisQueryInputChange.emit(this.value))}this.maybeSetFirstError([e,t,s,i])}else this.maybeSetFirstError([e,t,s])}componentDidRender(){void 0!==this.tooltipRef&&null!==this.tooltipRef&&((0,a.P)(this.valueRef)?this.tooltipRef.referenceElement=this.valueRef:(0,a.P)(this.addButtonRef)&&(this.tooltipRef.referenceElement=this.addButtonRef))}disconnectedCallback(){this.abortController?.abort(),this.closeModal()}async checkValidity(){return Promise.resolve(this.validate({preserveExistingErrors:!0}))}render(){return!0===this.loading?this.renderLoadingState():this.hasValue&&!this.hasAnalysisLayersLoadError?this.renderValueState():this.renderInitialState()}renderLoadingState(){return(0,s.h)(s.H,null,(0,s.h)("calcite-label",{scale:a.g.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-button",{appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:a.g.Scale,onClick:()=>{},loading:!0,disabled:!0},this.strings.createQuery)))}renderInitialState(){return(0,s.h)(s.H,null,(0,s.h)("calcite-label",{scale:a.g.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-button",{appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:a.g.Scale,onClick:()=>{this.canCreateQuery&&this.openModal()},disabled:!1===this.canCreateQuery,ref:e=>this.addButtonRef=e},this.strings.createQuery),!1===this.canCreateQuery&&!this.readOnly&&(0,s.h)("calcite-tooltip",{referenceElement:this.addButtonRef,ref:e=>this.tooltipRef=e,overlayPositioning:"fixed"},this.disabledTooltip??this.strings.disabledTooltip)),!1===this.readOnly&&(0,s.h)("calcite-input-message",{class:Xt,hidden:!this.hasError,icon:"exclamationMarkTriangle",status:a.r.INVALID,scale:a.g.Scale},!1===this.hasError?this.strings.isRequired:this.errorMessage))}renderValueState(){const e="sql"===this.mode&&"string"==typeof this.value?this.truncateString(this.value,25):this.strings.editDescription;return(0,s.h)(s.H,null,(0,s.h)("calcite-label",{scale:a.g.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-list",{label:"",onClick:()=>this.openModal(),class:`${jt} ${Xt}`},(0,s.h)("calcite-list-item",{class:Kt,value:"query",ref:e=>this.valueRef=e,label:this.valueLabel,description:e,disabled:"sql"===this.mode&&!this.canCreateQuery},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",icon:"pencil",text:this.strings.editAction}))),"sql"===this.mode&&"string"==typeof this.value&&(0,s.h)("calcite-tooltip",{referenceElement:this.valueRef,ref:e=>this.tooltipRef=e,overlayPositioning:"fixed"},this.canCreateQuery?(0,s.h)(s.F,null,this.strings.clickToEditExpression,(0,s.h)("br",null),(0,s.h)("code",null,this.value)):(0,s.h)(s.F,null,!this.readOnly&&(0,s.h)(s.F,null,this.disabledTooltip??this.strings.disabledTooltip,(0,s.h)("br",null),(0,s.h)("br",null)),(0,s.h)("code",null,this.value)))),(0,s.h)("calcite-button",{class:Xt,appearance:"outline",kind:"neutral","icon-start":"trash",width:"full",scale:a.g.Scale,onClick:this.onDeleteQuery,disabled:"sql"===this.mode&&this.readOnly},this.strings.deleteQuery),!1===this.readOnly&&(0,s.h)("calcite-input-message",{class:Xt,status:"invalid",scale:a.g.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.errorMessage))}async loadTargetLayer(e){let t;this.abortController?.abort(),this.abortController=new AbortController;try{await(e?.load({signal:this.abortController.signal})),t={result:void 0===e?void 0:e}}catch(e){if((0,a.ax)(e))return Zt;const t="records"===this.recordsTerm?"targetDatasetLoadError":"layersLoadError";return{error:this.strings[t]}}return t}async loadSupportedMapLayers(e){let t;if(void 0===e)t={result:[]};else{const i=e.filter(a.b2).filter(e=>!e.isTable);await Promise.allSettled(i.map(e=>e.load()));const s=i.filter(e=>e.loaded);t=s.length!==i.length?{result:s,error:this.strings.layersLoadError}:{result:s}}return t}async loadGPQueryLayers(e,t){let i;if("string"!=typeof e&&Array.isArray(e?.inputLayers)){const s=(t??[]).reduce((e,t)=>(e.set((0,l.n)(t),t),e),new Map),r=e.inputLayers.filter(e=>!s.has(e.url));try{const e=await(0,a.b3)(r);r.forEach((t,i)=>s.set(t.url,e[i]))}catch{return{error:this.strings.layersLoadError}}i={result:e.inputLayers.map(e=>s.get(e.url)).filter(e=>void 0!==e)}}else i={result:[]};return i}combineLayers(e,t){const i=new Set,s=[];for(const a of[...e,...t]){const e=(0,l.n)(a);i.has(e)||(i.add(e),s.push(a))}return s}addMapLayerFiltersToInputLayers(e,t){const i=t.reduce((e,t)=>(e.set((0,l.n)(t),t.definitionExpression),e),new Map);return e.map(e=>(e.filter=i.get(e.url)??void 0,e))}async parseCurrentValue(){let e,t;return"analysis"===this.mode&&"object"==typeof this.value?({group:e,errors:t}=await Qt.fromJSON(this.value.expressions,this.combinedLayers)):"sql"===this.mode&&"string"==typeof this.value&&({group:e,errors:t}=await Qt.fromSQL(this.value,this.layer,this.options)),void 0!==t&&t.length>0?{result:e,error:t[0].toTranslatedString(this.strings)}:{result:e}}validate(e){let t;return void 0!==this.errorMessage&&!0===e?.preserveExistingErrors?t=!1:!this.hasValue&&this.required?(t=!1,this.errorMessage=this.strings.isRequired):(t=!0,this.errorMessage=void 0),t}maybeSetFirstError(e){const t=e.find(e=>void 0!==e.error);void 0!==t&&t.error!==Zt.error&&(this.errorMessage=t.error)}truncateString(e,t){return e.length<=t?e:e.slice(0,t)+"..."}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}static get watchers(){return{value:["valueChange"],mapLayers:["mapLayersChange"],layer:["targetLayerChange"]}}};Yt.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.border{border:1px solid var(--calcite-color-border-input)}.mb-half{margin-bottom:var(--analysis-half-spacing)}.list-item{--calcite-font-size--1:var(--calcite-font-size--2)}";const Jt="expression-tile-select-w-third",ei="expression-tile-select-group",ti="validation-notice",ii=class{constructor(e){(0,s.r)(this,e),this.analysisQueryModalAdd=(0,s.c)(this,"analysisQueryModalAdd",7),this.analysisQueryModalDismissed=(0,s.c)(this,"analysisQueryModalDismissed",7),this.analysisQueryModalError=(0,s.c)(this,"analysisQueryModalError",7),this.selectedExpressionType="attribute",this.isOnboarding=!0,this.hasInvalidExpressions=!1,this.layers=[],this.recordsTerm="features",this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1)},this.onQueryError=e=>{this.analysisQueryModalError.emit(e.detail)},this.onTargetChange=e=>{this.target=e.target.target},this.onSelectExpressionType=e=>{const t=e.target;this.selectedExpressionType=t.value},this.onOnboardingNextClick=()=>{this.expressionGroup=this.createDefaultGroup(),this.isOnboarding=!1},this.onAddClick=()=>{setTimeout(async()=>{this.hasInvalidExpressions=!1===await(this.queryBuilderRef?.validate()),this.hasInvalidExpressions||(this.analysisQueryModalAdd.emit(this.newValue??this.expressionGroup),this.close())},100)},this.onClose=()=>{this.analysisQueryModalDismissed.emit()},this.onQueryChange=e=>{this.newValue=e.detail}}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.u)(this.hostElement,(0,s.a)("."))),this.isOnboarding=void 0===this.value||"string"!=typeof this.value&&this.value.expressions.length<1,await Promise.allSettled(this.layers.map(e=>e.load()))}componentDidRender(){void 0!==this.tooltipRef&&null!==this.tooltipRef&&void 0!==this.spatialExpressionTile&&(this.tooltipRef.referenceElement=this.spatialExpressionTile)}get loadedLayers(){return(0===this.layers.length&&void 0!==this.target?[this.target]:this.layers).filter(e=>e.loaded)}createDefaultGroup(){const e=this.target??this.loadedLayers[0];let t=new Qt(e,"and");return t="group"===this.selectedExpressionType?t.addNewGroup("and"):"spatial"===this.selectedExpressionType?t.addDefaultSpatialExpression(e,this.loadedLayers):t.addDefaultExpression(this.options),t}render(){return(0,s.h)("calcite-dialog",{key:"8f92c95464b3852ff820eefa21a569eb8dd4b4d5",modal:!0,escapeDisabled:!0,outsideCloseDisabled:!0,open:this.open,class:"query-modal",heading:this.strings.header,ref:e=>this.containerRef=e,onCalciteDialogClose:this.onClose},this.hasInvalidExpressions&&(0,s.h)("calcite-notice",{key:"abbaffde51155ea09a053ccd7dfca66d410f2cc0",class:ti,scale:a.g.Scale,kind:"danger",open:!0,slot:"footer-start"},(0,s.h)("div",{key:"3f15a14139980dc425e1d8a7dfdc28c9a5f57906",slot:"message"},this.strings.validationFailedScrollUp)),(0,a.P)(this.docLink)&&(0,s.h)("calcite-action",{key:"70a750343f9821efe5acddc45fdab53d709cf79c",text:this.strings.helpActionText,icon:"information",scale:a.g.Scale,onClick:()=>{window.open(this.docLink,"_blank")},slot:"header-actions-end"}),this.isOnboarding?this.renderOnboardingContent():this.renderQueryBuilder(),(0,s.h)("calcite-button",{key:"299aadcd33567dbac3f220d378fa3339b7f95df4",slot:"footer-end",appearance:"outline",onClick:this.close},this.strings.cancel),(0,s.h)("calcite-button",{key:"eb35601532867f332e9f196031b7eeabfd7ce0f0","data-testid":"next-add-btn",slot:"footer-end",onClick:this.isOnboarding?this.onOnboardingNextClick:this.onAddClick},this.isOnboarding?this.strings.next:this.strings.add))}renderOnboardingContent(){const e=new Set(this.layers.map(l.n)),t="sql"!==this.mode?Jt:"";return(0,s.h)(s.F,null,(0,s.h)("analysis-query-target-select",{target:this.target,layers:this.loadedLayers,onAnalysisQueryTargetSelectChange:this.onTargetChange,recordsTerm:this.recordsTerm,disabled:"sql"===this.mode}),(0,s.h)("calcite-tile-select-group",{class:ei},(0,s.h)("calcite-tile-select",{class:t,heading:this.getString(this.strings.attributeExpressionTitle,this.strings.expressionTitle),description:this.getString(this.strings.attributeExpressionDescription,this.strings.expressionDescription),checked:"attribute"===this.selectedExpressionType||void 0,icon:"rtl"===this.dir?"list-check-rtl":"list-check",value:"attribute",inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),"sql"!==this.mode&&(0,s.h)(s.F,null,(0,s.h)("calcite-tile-select",{class:t,ref:e=>{e&&(this.spatialExpressionTile=e)},heading:this.strings.spatialExpressionTitle,description:this.strings.spatialExpressionDescription,checked:"spatial"===this.selectedExpressionType||void 0,iconFlipRtl:"rtl"===this.dir,icon:"geographic-link-chart-layout",value:"spatial",disabled:e.size>1==!1,inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),e.size>1==!1&&(0,s.h)("calcite-tooltip",{referenceElement:this.spatialExpressionTile,ref:e=>this.tooltipRef=e,overlayPositioning:"fixed",placement:"top"},this.strings.spatialExpressionTwoLayers)),(0,s.h)("calcite-tile-select",{class:t,heading:this.strings.expressionGroupTitle,description:this.strings.expressionGroupDescription,checked:"group"===this.selectedExpressionType||void 0,iconFlipRtl:"rtl"===this.dir,icon:"group-form-plus",value:"group",inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType})))}renderQueryBuilder(){return(0,s.h)("analysis-query-builder",{ref:e=>this.queryBuilderRef=e,expressionGroup:this.expressionGroup,layers:this.loadedLayers,mode:this.mode,recordsTerm:this.recordsTerm,onAnalysisQueryChange:this.onQueryChange,onAnalysisQueryError:this.onQueryError,options:this.options})}getString(e,t){return"features"===this.recordsTerm?e:t}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};ii.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.query-modal{--calcite-dialog-background-color:var(--calcite-color-foreground-1)}.expression-tile-select-group{justify-content:center}.expression-tile-select-w-third{width:33%}.validation-notice{margin-left:0}";class si{constructor(){this.requestCache={}}getOrPut(e,t){const i=this.requestCache[t];return null==i&&(this.requestCache[t]=e()),this.requestCache[t]}}const ai=class{constructor(e){(0,s.r)(this,e),this.analysisQueryChange=(0,s.c)(this,"analysisQueryChange",7),this.analysisQueryError=(0,s.c)(this,"analysisQueryError",7),this.cache=new si,this.recordsTerm="features",this.layers=[],this.onGroupChange=e=>{this.workingExpressionGroup=e.target.expressionGroup,this.analysisQueryChange.emit(this.workingExpressionGroup)},this.onTargetChange=e=>{const t=e.target.target;this.workingExpressionGroup=this.workingExpressionGroup.changeTarget(t),this.analysisQueryChange.emit(this.workingExpressionGroup)},this.resetError=()=>{this.errorMessage=void 0,this.analysisQueryError.emit(this.errorMessage)}}get hasError(){return void 0!==this.errorMessage}async componentWillLoad(){let e;({strings:this.strings,locale:e}=await(0,a.u)(this.hostElement,(0,s.a)("."))),(0,h.s)(this.strings,e),this.workingExpressionGroup=this.expressionGroup.clone()}async validate(){let e=!0;return this.expressionGroupRef&&(e=await this.expressionGroupRef.validate()),Promise.resolve(e)}render(){return(0,s.h)(s.H,{key:"effa01dfcd669f1c463d154fd7778f46255b4d5a"},(0,s.h)("analysis-query-target-select",{key:"59eb87920789123f607f88f0f42d92b849a7aa21",target:this.workingExpressionGroup.layer,layers:this.layers,onAnalysisQueryTargetSelectChange:this.onTargetChange,disabled:"sql"===this.mode,recordsTerm:this.recordsTerm}),(0,s.h)("analysis-expression-group",{key:"16df7eae22b86502674222d4524927e05012f1b5",expressionGroup:this.workingExpressionGroup,ref:e=>this.expressionGroupRef=e,layers:this.layers,cache:this.cache,onAnalysisExpressionGroupChange:this.onGroupChange,recordsTerm:this.recordsTerm,mode:this.mode,allowedExpressions:"sql"===this.mode?["attribute","group"]:["attribute","group","spatial"],options:this.options}),this.hasError&&(0,s.h)("calcite-notice",{key:"67f69403949f4db9be69db0200ab98d93a594bff",class:tt,open:!0,kind:"danger",closable:!0,scale:a.g.Scale,width:"auto",onCalciteNoticeClose:this.resetError},(0,s.h)("div",{key:"965e26d251caa259772b809a12703d0e6a5b3188",slot:"title"},this.strings.error),(0,s.h)("div",{key:"727af6c1d6385a4f26e68ec88454695bbf3c12e3",slot:"message"},this.errorMessage)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};ai.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.error-notice{margin-top:var(--analysis-half-spacing)}";const li=class{constructor(e){(0,s.r)(this,e),this.analysisQueryTargetSelectChange=(0,s.c)(this,"analysisQueryTargetSelectChange",7),this.disabled=!1,this.recordsTerm="features",this.layers=[],this.onLayerSelectChange=e=>{const t=e.target.selectedOption.value;this.target=this.layers.find(e=>e.id===t)??this.layers[0],this.analysisQueryTargetSelectChange.emit(this.target)}}async componentWillLoad(){({strings:this.strings}=await(0,a.u)(this.hostElement,(0,s.a)(".")))}render(){const e="records"===this.recordsTerm?this.strings.recordsLabel:this.strings.featuresLabel;return(0,s.h)(s.H,{key:"c8e15dff3a6890463e26415eb05d5dcc6afdd7bf"},(0,s.h)("calcite-label",{key:"ba29c74a50d6dc7ba3c4599f0b1856130ab06fef"},e,(0,s.h)("calcite-select",{key:"362c31984356fbf52ddc160309e86f443c7e2047",label:e,onCalciteSelectChange:this.onLayerSelectChange,width:"auto",disabled:this.disabled},this.layers.map(e=>(0,s.h)("calcite-option",{value:e.id,selected:this.target.id===e.id,key:e.id},(0,a.aa)(e))))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.d)(this)}};li.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex}";const ri="add-btns-container",ni="error-message",oi="group-content-container",hi="operator-container",ci=class{constructor(e){(0,s.r)(this,e),this.analysisExpressionGroupChange=(0,s.c)(this,"analysisExpressionGroupChange",7),this.allowedExpressions=["attribute","group","spatial"],this.recordsTerm="features",this.depth=0,this.onAddSpatialExpressionClick=()=>{this.expressionGroup=this.expressionGroup.addDefaultSpatialExpression(this.expressionGroup.layer,this.layers),this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onAddAttributeExpressionClick=()=>{this.error=void 0,this.expressionGroup=this.expressionGroup.addDefaultExpression(this.options),this.analysisExpressionGroupChange.emit()},this.onOperatorSelect=e=>{this.expressionGroup.operator=e.target.selectedOption.value,this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onAddGroupClick=()=>{this.expressionGroup=this.expressionGroup.addNewGroup(),this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onRemoveChild=(e,t)=>{this.expressionGroup=this.expressionGroup.removeChild(e),this.error=void 0,this.analysisExpressionGroupChange.emit(),t.stopPropagation()},this.onChildExpressionChange=(e,t)=>{this.expressionGroup.children[e]=t.target.expression,this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onChildSpatialExpressionChange=e=>{const t=e.target.spatialExpression;this.expressionGroup=this.expressionGroup.changeSpatialExpression(t),this.analysisExpressionGroupChange.emit()},this.onChildGroupChange=(e,t)=>{this.expressionGroup.children[e]=t.target.expressionGroup,this.analysisExpressionGroupChange.emit(),t.stopPropagation()}}componentDidRender(){void 0!==this.spatialExpressionButtonTooltipRef&&null!==this.spatialExpressionButtonTooltipRef&&void 0!==this.addSpatialExpressionButtonRef&&(this.spatialExpressionButtonTooltipRef.referenceElement=this.addSpatialExpressionButtonRef)}get hasError(){return void 0!==this.error}componentWillLoad(){this.strings=(0,h.g)()}async validate(){const e=[...Array.from(this.expressionsContainer?.getElementsByTagName("analysis-expression-group")??[]),...Array.from(this.expressionsContainer?.getElementsByTagName("analysis-attribute-expression")??[])].filter(a.P).map(e=>e.validate());return(await Promise.all(e)).every(e=>!0===e)}render(){const e=this.expressionGroup;return(0,s.h)(s.F,{key:"23d98aecd0680db22eaa42b05fdddd30a3812cb5"},(0,s.h)("div",{key:"66a285dc10384650c33da943b515f1e87218fcf6",ref:e=>this.expressionsContainer=e},0===this.depth?(0,s.h)(s.F,null,this.renderOperatorContainer(),void 0!==e.spatialExpression&&this.renderSpatialExpression(),this.renderChildExpressions(),this.renderTopLevelButtons()):void 0===e.spatialExpression?(0,s.h)(s.F,null,(0,s.h)("div",{class:oi},this.renderOperatorContainer(),this.renderChildExpressions(),this.renderExpressionDropdown())):(0,s.h)(s.F,null,this.renderSpatialExpression(),this.depth<=2&&(0,s.h)("div",{class:oi},e.children.length>0&&this.renderOperatorContainer(),this.renderChildExpressions(),this.renderExpressionDropdown()))),(0,s.h)("calcite-input-message",{key:"f69441d1eac63238c06f0b1f994ffe3cdf6f9837",status:"invalid",class:ni,scale:a.g.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.error))}renderOperatorContainer(){return(0,s.h)("div",{class:hi},(0,s.h)("calcite-label",null,this.strings.where,(0,s.h)("calcite-select",{width:"auto",label:this.strings.groupOperatorSelect,onCalciteSelectChange:this.onOperatorSelect},(0,s.h)("calcite-option",{value:Ze,selected:this.expressionGroup.operator===Ze},this.strings.andOperatorLabel),(0,s.h)("calcite-option",{value:Ye,selected:this.expressionGroup.operator===Ye},this.strings.orOperatorLabel))))}renderSpatialExpression(){return(0,s.h)("analysis-spatial-expression",{layers:this.layers,spatialExpression:this.expressionGroup.spatialExpression,onAnalysisExpressionChange:e=>this.onChildSpatialExpressionChange(e)})}renderChildExpressions(){return this.expressionGroup.children.map((e,t)=>e instanceof Qt?(0,s.h)("analysis-query-entry",{kind:"group",appearance:"section",key:e.id,onAnalysisQueryEntryRemove:e=>this.onRemoveChild(t,e)},(0,s.h)("analysis-expression-group",{expressionGroup:e,layers:this.layers,depth:this.depth+1,mode:this.mode,cache:this.cache,allowedExpressions:this.allowedExpressions,options:this.options,onAnalysisExpressionGroupChange:e=>this.onChildGroupChange(t,e)})):(0,s.h)("analysis-attribute-expression",{expression:e,cache:this.cache,target:this.expressionGroup.layer,key:e.id,options:this.options,onAnalysisExpressionChange:e=>this.onChildExpressionChange(t,e),onAnalysisExpressionRemoveClick:e=>this.onRemoveChild(t,e)}))}renderTopLevelButtons(){const e=new Set(this.allowedExpressions);return("analysis"===this.mode&&zt.getValidSelectingLayers(this.expressionGroup.layer,this.layers).length<1||"sql"===this.mode)&&e.delete("spatial"),(0,s.h)("div",{class:ri},(0,s.h)("calcite-button",{"data-testid":"add-attribute-expression-button",disabled:!1===e.has("attribute"),appearance:"outline-fill",kind:"neutral",iconStart:"plus",onClick:this.onAddAttributeExpressionClick},"features"===this.recordsTerm?this.strings.attributeExpression:this.strings.expression),"sql"!==this.mode&&(0,s.h)(s.F,null,(0,s.h)("calcite-button",{disabled:!1===e.has("spatial"),ref:e=>{e&&(this.addSpatialExpressionButtonRef=e)},appearance:"outline-fill",kind:"neutral",iconStart:"plus",onClick:this.onAddSpatialExpressionClick},this.strings.spatialExpression),!1===e.has("spatial")&&(0,s.h)("calcite-tooltip",{referenceElement:this.addSpatialExpressionButtonRef,ref:e=>this.spatialExpressionButtonTooltipRef=e,overlayPositioning:"fixed",placement:"top"},this.strings.spatialExpressionTwoLayers)),(0,s.h)("calcite-button",{disabled:!1===e.has("group"),appearance:"outline-fill",kind:"neutral",iconStart:"group-form-plus",onClick:this.onAddGroupClick,iconFlipRtl:"both"},this.strings.expressionGroup))}renderExpressionDropdown(){const e=new Set(this.allowedExpressions);return this.depth>=2&&e.delete("group"),"analysis"===this.mode&&zt.getValidSelectingLayers(this.expressionGroup.layer,this.layers).length<1&&e.delete("spatial"),(0,s.h)("calcite-dropdown",{widthScale:"m",overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconStart:"plus",iconEnd:"chevron-down"},this.strings.expression),(0,s.h)("calcite-dropdown-group",null,e.has("attribute")&&(0,s.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddAttributeExpressionClick},"features"===this.recordsTerm?this.strings.attributeExpression:this.strings.expression),e.has("spatial")&&(0,s.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddSpatialExpressionClick},this.strings.spatialExpression),e.has("group")&&(0,s.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddGroupClick},this.strings.expressionGroup)))}get hostElement(){return(0,s.d)(this)}};ci.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.operator-container{display:flex}.group-content-container{width:calc(100% - 2 * var(--analysis-half-spacing) - 2px);padding:var(--analysis-half-spacing);background-color:var(--calcite-color-background);border:1px solid var(--calcite-color-border-1)}.add-btns-container{display:flex;gap:var(--analysis-quarter-spacing)}.error-message{margin-top:var(--analysis-half-spacing)}";const di="flex-container",pi="half-width",ui="single-value",mi="field-select",yi="operator-select",gi="value-select",vi="value-sm";const fi=class{constructor(e){(0,s.r)(this,e),this.analysisExpressionChange=(0,s.c)(this,"analysisExpressionChange",7),this.analysisExpressionRemoveClick=(0,s.c)(this,"analysisExpressionRemoveClick",7),this.defaultMaxDropdownItems=2e3,this.fieldValues=[],this.showUniqueValuesPopover=!1,this.handleUniqueValuesListChange=e=>{const t=e.detail.selectedValues,i=this.parseStringInput(t[0],this.expression.dataType);this.expression=new Wt(this.expression).changeValue(i),this.analysisExpressionChange.emit(),this.showUniqueValuesPopover=!1},this.onRemoveClick=e=>{this.analysisExpressionRemoveClick.emit(),e.stopPropagation()},this.onFieldSelect=e=>{const t=e.target.selectedOption.value,i=this.fields?.find(e=>e.name===t);void 0!==i&&(this.expression=new Wt(this.expression).changeField(i,this.options),!0===this.options?.showDerivedLayerMessage?this.fieldValuesLoadingMessage=this.strings.suggestedValuesNotAvailable:this.loadFieldValues(i.name)),this.analysisExpressionChange.emit()},this.getFieldValuesByUniqueValues=async e=>{const t=`${this.target.id}-${e}`,i=!0===this.options?.useLayerQueries?a.b4:a.b5,s=await this.cache.getOrPut(()=>i({layer:this.target,fieldName:e}),t);return(s?.uniqueValueInfos??[]).map(e=>({value:e.value,count:!0===this.options?.hideUniqueValueCounts?void 0:e.count,label:e.label??`${e.value}`}))},this.onOperatorSelect=e=>{const t=e.target.selectedOption.value;this.expression=new Wt(this.expression).changeOperator(t),this.analysisExpressionChange.emit()},this.onValueInputChange=e=>{const t=e.target.value;this.expression.value=this.parseStringInput(t,this.expression.dataType),this.analysisExpressionChange.emit()},this.onValueComboboxChange=e=>{const t=e.target.value,i=Array.isArray(t)?t[0]:t;this.expression.value=this.parseStringInput(i,this.expression.dataType),this.analysisExpressionChange.emit()},this.onValuesComboboxChange=e=>{rt("multi-value"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value,i=(Array.isArray(t)?t:[t]).map(e=>this.parseStringInput(e,this.expression.dataType));this.expression.value=i.filter(e=>(0,a.P)(e)),this.analysisExpressionChange.emit()},this.onValueDateChange=()=>{const e=this.parseDateValueFromInputs(this.valueDateInputElement,this.valueTimeInputElement);this.expression.value=e,this.analysisExpressionChange.emit()},this.onDateOnlyRangeChange=e=>{rt("range"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value;this.expression.value=[this.parseStringInput(t[0],"date-only"),this.parseStringInput(t[1],"date-only")],this.analysisExpressionChange.emit()},this.onRangeStartDateChange=()=>{rt("range"===this.expression.type,"Incorrect render function for expression type.");const e=this.parseDateValueFromInputs(this.startDateInputElement,this.startTimeInputElement);this.expression.value[0]=e,this.analysisExpressionChange.emit()},this.onRangeEndDateChange=()=>{rt("range"===this.expression.type,"Incorrect render function for expression type.");const e=this.parseDateValueFromInputs(this.endDateInputElement,this.endTimeInputElement);this.expression.value[1]=e,this.analysisExpressionChange.emit()},this.onRangeStartInputChange=e=>{rt("range"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value;this.expression.value[0]=this.parseStringInput(t,this.expression.dataType),this.analysisExpressionChange.emit()},this.onRangeEndInputChange=e=>{rt("range"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value;this.expression.value[1]=this.parseStringInput(t,this.expression.dataType),this.analysisExpressionChange.emit()},this.onDistanceInputChange=e=>{rt("distance"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value;this.expression=new Wt(this.expression).changeValue({distance:this.parseStringInput(t,"double"),unit:this.expression.value.unit}),this.analysisExpressionChange.emit()},this.onDistanceUnitChange=e=>{rt("distance"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.selectedOption.value;this.expression.value.unit=t,this.analysisExpressionChange.emit()},this.parseStringInput=(e,t)=>{let i;return i=(0,a.y)(e)?void 0:at(t)?""===e?void 0:Number(e):st(t)?""===e?void 0:Math.floor(Number(e)):e,i},this.parseDateValueFromInputs=(e,t)=>{const i=e?.valueAsDate,s=t?.value?t.value.split(":"):[0,0];return new Date(i.getFullYear(),i.getMonth(),i.getDate(),Number(s[0]),Number(s[1]))}}get maxDropdownItems(){return this.options?.maxDropdownItems??this.defaultMaxDropdownItems}get selectedField(){return this.fields?.find(e=>e.name===this.expression?.field)}async loadFields(e){this.loadAbortController?.abort(),this.loadAbortController=new AbortController;try{await(e?.load({signal:this.loadAbortController.signal}))}catch(e){}const t=e?.fields??[];this.fields=t.filter(t=>Ut(t,this.options,e))}get inputStatus(){return(0,a.P)(this.expression.error)?a.r.INVALID:a.r.IDLE}async componentWillLoad(){this.strings=(0,h.g)(),await this.loadFields(this.target),!0===this.options?.showDerivedLayerMessage?this.fieldValuesLoadingMessage=this.strings.suggestedValuesNotAvailable:this.loadFieldValues(this.expression.field)}componentDidRender(){(0,a.P)(this.tooltipRef)&&(0,a.P)(this.uniqueValuesPopoverButtonRef)&&(this.tooltipRef.referenceElement=this.uniqueValuesPopoverButtonRef)}validate(){this.expression=new Wt(this.expression).validate();const e=void 0===this.expression.error;return Promise.resolve(e)}render(){switch(this.expression.type){case"value":return(0,s.h)("analysis-query-entry",{kind:"expression",appearance:"inline",onAnalysisQueryEntryRemove:this.onRemoveClick,error:this.expression.error},(0,s.h)("div",{class:ui},this.renderFieldSelect("auto"),this.renderOperatorSelect("auto"),this.renderValueInput(),this.showUniqueValuesPopover&&this.renderUniqueValuesPopover()));case"multi-value":return(0,s.h)("analysis-query-entry",{kind:"expression",appearance:"section",onAnalysisQueryEntryRemove:this.onRemoveClick,error:this.expression.error},(0,s.h)("div",{class:di},this.renderFieldSelect("half"),this.renderOperatorSelect("half")),this.renderValuesInput());case"range":return(0,s.h)("analysis-query-entry",{kind:"expression",appearance:"section",onAnalysisQueryEntryRemove:this.onRemoveClick,error:this.expression.error},(0,s.h)("div",{class:di},this.renderFieldSelect("half"),this.renderOperatorSelect("half")),this.renderRangeInputs());case"distance":return(0,s.h)("analysis-query-entry",{kind:"expression",appearance:"inline",onAnalysisQueryEntryRemove:this.onRemoveClick,error:this.expression.error},(0,s.h)("div",{class:ui},this.renderFieldSelect("auto"),this.renderOperatorSelect("auto"),this.renderDistanceInputs()))}}renderFieldSelect(e="auto"){return(0,s.h)("calcite-select",{class:mi,status:this.inputStatus,label:this.strings.fieldSelect,width:e,onCalciteSelectChange:this.onFieldSelect},this.fields?.map(e=>(0,s.h)("calcite-option",{value:e.name,selected:e.name===this.expression?.field},e.alias)))}renderOperatorSelect(e="auto"){const t=function(e){switch(e.dataType){case"string":return yt;case"small-integer":case"integer":case"big-integer":case"single":case"double":case"long":case"oid":return mt;case"date":return gt;case"date-only":return vt;case"geometry":return ft;case"boolean":return bt}}(this.expression),i=void 0!==this.getSelectedFieldDomainOptions(),a=t.filter(e=>!(i&&kt(e))).filter(e=>{const{useIntervalQueries:t,useExtractDatePartQueries:i}=this.options??{},s=!0!==t&&["in_the_last","not_in_the_last"].includes(e),a=!0!==i&&["this_year","this_month","this_day"].includes(e);return!s&&!a&&"this_day"!==e});return(0,s.h)("calcite-select",{class:yi,status:this.inputStatus,label:this.strings.expressionOperatorSelect,key:this.expression.operator,width:e,onCalciteSelectChange:this.onOperatorSelect},a.map(e=>{const t=this.strings.operators?.[e],i="is_true"===e||"is_false"===e?t.toLocaleLowerCase():t;return(0,s.h)("calcite-option",{value:e,selected:this.expression?.operator===e},i)}))}renderUniqueValuesPopover(e=!1){let t=this.expression.dataType;if("oid"===this.expression.dataType){t=!0===(void 0===this.fieldValues.find(e=>"string"==typeof e.value))?"integer":this.expression.dataType}let i=!1,a=this.fieldValues;a.length>this.maxDropdownItems&&(i=!0,a=a.slice(0,this.maxDropdownItems));const l=this.numberInputElement.getBoundingClientRect().width;return(0,s.h)("calcite-popover",{autoClose:!0,focusTrapDisabled:!0,placement:"bottom-end",offsetDistance:0,offsetSkidding:0,pointerDisabled:!0,overlayPositioning:"fixed",open:!0,referenceElement:this.numberInputElement,onCalcitePopoverClose:()=>{this.showUniqueValuesPopover=!1},label:this.strings.chooseFromUniqueValues},(0,s.h)("arcgis-common-sql-expression-config-unique-list",{style:{width:`${l}px`},ref:e=>this.filterUniqueRefElement=e,uid:`arcgis-filter-unique-list_${this.expression.field}`,uniqueValues:a,partialUniqueValues:i,selectedValues:[this.expression.value],layerFieldType:t,props:this.filterUniqueRefElement?.props??{layer:this.target,fields:this.target.fields},multiple:e,sortBy:"name",maxHeight:300,onArcgisChanged:this.handleUniqueValuesListChange}))}renderValueInput(){rt("value"===this.expression.type,"Incorrect render function for expression type.");const{dataType:e,value:t,operator:i}=this.expression;let l;if(St(i))l=null;else if(at(e)||st(e)){const i=at(e)?"any":1,r=this.getSelectedFieldMinMax();l=(0,s.h)(s.F,null,(0,s.h)("calcite-input-number",{status:this.inputStatus,step:i,placeholder:this.strings.inputPlaceholderText,value:void 0===t?void 0:`${t}`,onCalciteInputNumberChange:this.onValueInputChange,min:r?.min,max:r?.max,ref:e=>{void 0!==e&&(this.numberInputElement=e)}},(0,s.h)("calcite-button",{slot:"action",label:this.strings.chooseFromUniqueValues,ref:e=>this.uniqueValuesPopoverButtonRef=e,disabled:void 0!==this.fieldValuesLoadingMessage,appearance:"outline",kind:"neutral",scale:a.g.MediumScale,iconEnd:"chevron-down",onClick:()=>{this.showUniqueValuesPopover=!this.showUniqueValuesPopover}})),void 0!==this.fieldValuesLoadingMessage&&(0,s.h)("calcite-tooltip",{referenceElement:this.uniqueValuesPopoverButtonRef,ref:e=>this.tooltipRef=e,placement:"bottom",overlayPositioning:"fixed"},this.fieldValuesLoadingMessage))}else l="date-only"===e?(0,s.h)("div",{class:di},(0,s.h)("calcite-input-date-picker",{status:this.inputStatus,placement:"bottom-start",overlayPositioning:"fixed",value:t,onCalciteInputDatePickerChange:this.onValueInputChange})):"date"===e?this.renderValueDateInput():(0,s.h)("calcite-combobox",{class:gi,status:this.inputStatus,label:this.strings.choiceList,allowCustomValues:!0,scale:a.g.MediumScale,selectionMode:"single",key:this.expression.operator,value:void 0===t?void 0:`${t}`,placeholder:this.strings.inputPlaceholderText,onCalciteComboboxChange:this.onValueComboboxChange,overlayPositioning:"fixed"},this.renderComboboxItems());return l}renderValuesInput(){rt("multi-value"===this.expression.type,"Incorrect render function for expression type.");const e=this.expression.validValues.map(e=>`${e}`);return(0,s.h)("calcite-combobox",{status:this.inputStatus,label:this.strings.multiInputPlaceholderText,onCalciteComboboxChange:this.onValuesComboboxChange,allowCustomValues:!0,selectionMode:"multiple",scale:a.g.MediumScale,value:e,key:this.expression.operator,overlayPositioning:"fixed",placeholder:this.strings.inputPlaceholderText,clearDisabled:!0},this.renderComboboxItems())}renderComboboxItems(){const e=[];let t="multi-value"===this.expression.type?this.expression.value:[this.expression.value];t=t.filter(e=>void 0!==e);for(const i of t){const t=`${i}`;e.push((0,s.h)("calcite-combobox-item",{key:t,value:t,textLabel:t,selected:!0}))}if(void 0!==this.fieldValuesLoadingMessage)e.push((0,s.h)("calcite-combobox-item",{key:this.fieldValuesLoadingMessage,value:void 0,textLabel:this.fieldValuesLoadingMessage,selected:!1,disabled:!0}));else{const i=new Set(t),a=this.maxDropdownItems+t.length;for(const t of this.fieldValues)if(i.has(t.value)||e.push((0,s.h)("calcite-combobox-item",{key:t.label,value:`${t.value}`,textLabel:t.label})),e.length>=a){e.push((0,s.h)("calcite-combobox-item",{key:this.strings.tooManyValuesToDisplay,value:void 0,textLabel:this.strings.tooManyValuesToDisplay,selected:!1,disabled:!0}));break}}return(0,s.h)(s.F,null,e)}renderValueDateInput(){rt("value"===this.expression.type,"Incorrect render function for expression type.");const{operator:e,value:t}=this.expression,i=t,a=this.parseTimeValue(i),l=["is_on","is_not_on"].includes(e);return(0,s.h)("div",{class:di},(0,s.h)("calcite-input-date-picker",{key:"value-date",placement:"bottom",class:l?di:pi,layout:"vertical",overlayPositioning:"fixed",valueAsDate:i,onCalciteInputDatePickerChange:this.onValueDateChange,ref:e=>{this.valueDateInputElement=e}}),!l&&(0,s.h)("calcite-input-time-picker",{key:"value-time",placement:"bottom",class:pi,overlayPositioning:"fixed",value:a,onCalciteInputTimePickerChange:this.onValueDateChange,ref:e=>{this.valueTimeInputElement=e}}))}renderRangeInputs(){rt("range"===this.expression.type,"Incorrect render function for expression type.");const{dataType:e,value:t}=this.expression;let i;if(at(e)||st(e)){const a=at(e)?"any":1,l=this.getSelectedFieldMinMax();i=(0,s.h)("div",{class:di},(0,s.h)("calcite-input-number",{status:this.inputStatus,step:a,class:pi,value:void 0===t[0]?"":`${t[0]}`,onCalciteInputNumberChange:this.onRangeStartInputChange,min:l?.min,max:l?.max}),(0,s.h)("calcite-input-number",{status:this.inputStatus,step:a,class:pi,value:void 0===t[1]?"":`${t[1]}`,onCalciteInputNumberChange:this.onRangeEndInputChange,min:l?.min,max:l?.max}))}else if("date-only"===e){const e=[t[0]??"",t[1]??""];i=(0,s.h)("calcite-input-date-picker",{placement:"bottom-start",overlayPositioning:"fixed",value:e,range:!0,onCalciteInputDatePickerChange:this.onDateOnlyRangeChange})}else i="date"===e?this.renderRangeDateInputs():(0,s.h)("p",null,"Not supported yet.");return i}renderRangeDateInputs(){rt("range"===this.expression.type,"Incorrect render function for expression type.");const{value:e}=this.expression,t=e[0],i=e[1],a=this.parseTimeValue(t),l=this.parseTimeValue(i);return(0,s.h)("div",{class:di},(0,s.h)("calcite-input-date-picker",{key:"start-date",class:pi,placement:"bottom",overlayPositioning:"fixed",valueAsDate:t,onCalciteInputDatePickerChange:this.onRangeStartDateChange,ref:e=>{this.startDateInputElement=e}}),(0,s.h)("calcite-input-time-picker",{key:"start-time",class:pi,placement:"bottom",overlayPositioning:"fixed",value:a,onCalciteInputTimePickerChange:this.onRangeStartDateChange,ref:e=>{this.startTimeInputElement=e}}),(0,s.h)("calcite-input-date-picker",{key:"end-date",class:pi,placement:"bottom",overlayPositioning:"fixed",valueAsDate:i,onCalciteInputDatePickerChange:this.onRangeEndDateChange,ref:e=>{this.endDateInputElement=e}}),(0,s.h)("calcite-input-time-picker",{key:"end-time",class:pi,placement:"bottom",overlayPositioning:"fixed",value:l,onCalciteInputTimePickerChange:this.onRangeEndDateChange,ref:e=>{this.endTimeInputElement=e}}))}renderDistanceInputs(){rt("distance"===this.expression.type,"Incorrect render function for expression type."),rt("date"===this.expression.dataType||"date-only"===this.expression.dataType,"Incorrect data type.");const{distance:e,unit:t}=this.expression.value;return(0,s.h)(s.F,null,(0,s.h)("calcite-input-number",{step:1,placeholder:this.strings.inputPlaceholderText,value:void 0===e?void 0:`${e}`,onCalciteInputNumberChange:this.onDistanceInputChange,class:vi,min:0}),(0,s.h)("calcite-select",{label:this.strings.expressionDateUnitSelect,onCalciteSelectChange:this.onDistanceUnitChange},Lt[this.expression.dataType].map(i=>(0,s.h)("calcite-option",{value:i,selected:i===t},(0,h.a)(i,e)))))}async loadFieldValues(e){let t=this.getSelectedFieldDomainOptions()??[];if(t.length<1)try{this.fieldValuesLoadingMessage=this.strings.loadingFieldValues,t=await this.getFieldValuesByUniqueValues(e)}catch(e){return console.log("Error retrieving unique field values: ",e),this.fieldValues=[],void(this.fieldValuesLoadingMessage=this.strings.errorRetrievingFieldValues)}this.fieldValues=t.filter(e=>(0,a.P)(e.value)),this.fieldValuesLoadingMessage=this.fieldValues.length<1?this.strings.noFieldValuesRetrieved:void 0}getSelectedFieldMinMax(){let e;const t=this.selectedField?.domain;return"range"===t?.type&&(e={min:t.minValue,max:t.maxValue}),e}getSelectedFieldDomainOptions(){let e;const t=this.selectedField?.name,i=this.selectedField?.domain;if("coded-value"===i?.type)e=i.codedValues.map(e=>({label:e.name,value:e.code}));else if(void 0!==t&&t===this.target?.typeIdField)e=this.target?.types?.map(e=>({label:e.name,value:e.id}));else if(void 0!==t&&(0,a.P)(this.target?.types)){const i=new Map;for(const e of this.target.types){const s=e.domains[t];if("coded-value"===s?.type)for(const e of s.codedValues){const t=i.get(e.code);void 0===t?i.set(e.code,[e.name]):t.includes(e.name)||t.push(e.name)}}if(i.size>0){e=[];for(const[t,s]of i)e.push({label:s.join(" | "),value:t})}}return e}parseTimeValue(e){return e instanceof Date?e.toTimeString().substring(0,5):void 0}get hostElement(){return(0,s.d)(this)}static get watchers(){return{target:["loadFields"]}}};fi.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.flex-container{display:flex}.half-width{width:50%}.single-value{display:flex}.single-value .field-select{max-inline-size:45%}.single-value .operator-select{flex-grow:1}.single-value .value-select{--calcite-combobox-input-height:1rem;min-width:150px}.single-value .value-sm{width:10rem}";const bi="flex-container",Ci="flex-grow",wi="layer-select",xi=class{constructor(e){(0,s.r)(this,e),this.analysisExpressionChange=(0,s.c)(this,"analysisExpressionChange",7),this.spatialRelationships=Object.values(et),this.spatialRelationshipUnits=Je,this.onSpatialRelationshipSelect=e=>{const t=e.target.selectedOption.value;this.spatialExpression=this.spatialExpression.changeSpatialRelationship(t);const i=this.spatialExpression.selectingLayer,s=this.spatialRelationshipLayers.get(t),a=s.find(e=>e.id===i.id);this.spatialExpression=void 0!==a?this.spatialExpression.changeSelectingLayer(a):this.spatialExpression.changeSelectingLayer(s[0]),this.analysisExpressionChange.emit()},this.onSpatialRelationshipUnitsSelect=e=>{const t=e.target.selectedOption.value;this.spatialExpression=this.spatialExpression.changeSpatialRelationshipUnit(t),this.analysisExpressionChange.emit()},this.onDistanceInputChange=e=>{const t=parseFloat(e.target.value);this.spatialExpression=this.spatialExpression.changeSpatialRelationshipDistance(t),this.analysisExpressionChange.emit()},this.onLayerSelectChange=e=>{const t=e.target.value,i=this.layers?.find(e=>e.id===t);void 0!==this.layers&&void 0!==i&&(this.spatialExpression=this.spatialExpression.changeSelectingLayer(i)),this.analysisExpressionChange.emit()}}setLayersToSpatialRelationships(e){void 0!==e&&(this.spatialRelationshipLayers=zt.getValidLayersForRelationships(this.spatialExpression.layer,e,this.spatialRelationships))}componentWillLoad(){this.strings=(0,h.g)(),this.setLayersToSpatialRelationships(this.layers),this.spatialRelationshipLayers=zt.getValidLayersForRelationships(this.spatialExpression.layer,this.layers??[],this.spatialRelationships)}render(){return(0,s.h)(s.H,{key:"f9f7918da6a32bf0f3af2aea161ea4638f3d019d"},this.renderSpatialRelationshipSelect(),this.renderLayerSelect())}renderSpatialRelationshipSelect(e="auto"){const t=this.spatialExpression.spatialRelationship;return(0,s.h)("div",{class:bi},(0,s.h)("calcite-select",{class:Ci,label:this.strings.spatialRelationshipSelect,width:e,onCalciteSelectChange:this.onSpatialRelationshipSelect},this.spatialRelationships.map(e=>(0,s.h)("calcite-option",{selected:t===e,value:e,key:e,disabled:(0,a.y)(this.spatialRelationshipLayers.get(e))},(0,a.y)(this.spatialRelationshipLayers.get(e))?(0,a.a)(this.strings.spatialRelationships[e],{noCompatibleLayers:this.strings.noCompatibleLayers}):(0,a.a)(this.strings.spatialRelationships[e],{noCompatibleLayers:""})))),this.spatialExpression.isDistanceRelationship&&this.renderSpatialRelationshipParams())}renderSpatialRelationshipParams(e="auto"){const t=this.spatialExpression.spatialRelationshipParams?.units,i=this.spatialExpression.spatialRelationshipParams?.distance;return(0,s.h)("div",{class:bi},(0,s.h)("calcite-input-number",{class:Ci,step:1,placeholder:this.strings.inputPlaceholderText,value:void 0===i?"":`${i}`,onCalciteInputNumberChange:this.onDistanceInputChange}),(0,s.h)("calcite-select",{class:Ci,label:this.strings.spatialRelationshipParamsDistanceInput,width:e,onCalciteSelectChange:this.onSpatialRelationshipUnitsSelect},this.spatialRelationshipUnits.map(e=>(0,s.h)("calcite-option",{selected:t===e,value:e,key:e},this.strings.spatialRelationshipUnits[e]))))}renderLayerSelect(e="auto"){const t=this.spatialRelationshipLayers.get(this.spatialExpression.spatialRelationship),i=this.spatialExpression.selectingLayer;return(0,s.h)("calcite-select",{class:wi,label:this.strings.spatialRelationshipLayerSelect,width:e,onCalciteSelectChange:this.onLayerSelectChange},t?.map(e=>(0,s.h)("calcite-option",{value:e.id,key:e.id,selected:i?.id===e.id},(0,a.aa)(e))))}get hostElement(){return(0,s.d)(this)}static get watchers(){return{layers:["setLayersToSpatialRelationships"]}}};xi.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.flex-container{display:flex}.flex-container .flex-grow{flex-grow:1}"},52095:(e,t,i)=>{let s,a;function l(e,t="en"){s=e,a=t}function r(){if(void 0===s)throw new Error("Translation strings are not loaded.");return s}i.d(t,{a:()=>o,g:()=>r,s:()=>l});const n=new Map;function o(e,t){const i=`${a}-${e}`;n.has(i)||n.set(i,new Intl.NumberFormat(a,{style:"unit",unit:e,unitDisplay:"long"}));const s=n.get(i).formatToParts(t);return s[s.length-1].value}}}]);