/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-41b7f6.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_components_-41b7f6"],{36486:(t,e,i)=>{i.d(e,{u:()=>n});var s=i(83552),o=i(73679);const n=(0,s.yr)(o.g)},47640:(t,e,i)=>{i.d(e,{YZ:()=>a,e1:()=>o});var s=i(4836);const o={INITIAL:0,PENDING:1,COMPLETE:2,ERROR:3},n=Symbol();class a{get taskComplete(){return this.t||(1===this.i?this.t=new Promise((t,e)=>{this.o=t,this.h=e}):3===this.i?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(t,e,i){this.p=0,this.i=0,(this._=t).addController(this);const s="object"==typeof e?e:{task:e,args:i};this.v=s.task,this.j=s.args,this.m=s.argsEqual??r,this.k=s.onComplete,this.A=s.onError,this.autoRun=s.autoRun??!0,"initialValue"in s&&(this.u=s.initialValue,this.i=2,this.O=this.T?.())}hostUpdate(){!0===this.autoRun&&this.S()}hostUpdated(){"afterUpdate"===this.autoRun&&this.S()}T(){if(void 0===this.j)return;const t=this.j();if(!Array.isArray(t))throw Error("The args function must return an array");return t}async S(){const t=this.T(),e=this.O;this.O=t,t===e||void 0===t||void 0!==e&&this.m(e,t)||await this.run(t)}async run(t){let e,i;t??=this.T(),this.O=t,1===this.i?this.q?.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,"afterUpdate"===this.autoRun?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();const s=++this.p;this.q=new AbortController;let o=!1;try{e=await this.v(t,{signal:this.q.signal})}catch(t){o=!0,i=t}if(this.p===s){if(e===n)this.i=0;else{if(!1===o){try{this.k?.(e)}catch{}this.i=2,this.o?.(e)}else{try{this.A?.(i)}catch{}this.i=3,this.h?.(i)}this.u=e,this.l=i}this._.requestUpdate()}}abort(t){1===this.i&&this.q?.abort(t)}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(t){switch(this.i){case 0:return t.initial?.();case 1:return t.pending?.();case 2:return t.complete?.(this.value);case 3:return t.error?.(this.error);default:throw Error("Unexpected status: "+this.i)}}}const r=(t,e)=>t===e||t.length===e.length&&t.every((t,i)=>!(0,s.Ec)(t,e[i]))},76174:(t,e,i)=>{i.r(e),i.d(e,{ArcgisMapConfigFontPicker:()=>y});var s=i(73679),o=i(4395),n=i(3897),a=i(44345),r=i(72993),l=i(66505),c=i(36486),h=i(85643),p=i(73801),d=i(47640),u=i(66228);const f=["Arial Bold","Arial Bold Italic","Arial Italic","Arial Regular","Arial Unicode MS Bold Italic","Arial Unicode MS Italic","Avenir Bold","Avenir Bold Italic","Avenir Italic","Avenir Regular","Palatino Linotype Regular","Times New Roman Bold","Times New Roman Bold Italic","Times New Roman Italic","Times New Roman Regular","Verdana Bold","Verdana Bold Italic","Verdana Italic","Verdana Regular"];var m=(t=>(t.ASCENDING="ascending",t.DESCENDING="descending",t))(m||{});const g=o.AH`.popover{--calcite-popover-z-index: 100}.panel{min-height:300px}.content{max-height:60vh}.font-mode-wrapper{width:100%}.font-preview{min-width:40px}`;class y extends p.WF{constructor(){super(...arguments),this._initialized=!1,this._loaded=!1,this._propWatcherTask=new d.YZ(this,{task:async([t,e,i])=>{if(!((0,u.i)(t)&&(0,u.i)(e)&&(0,u.i)(i)))throw console.error("[arcgis-map-config-font-picker] Required properties are missing."),new Error("Required properties are missing.");this._propWatcherTask.autoRun=!1,await this.init()},args:()=>[this.fontMap,this.font,this.popoverProps]}),this._messages=(0,c.u)({blocking:!0}),this.currentFont="",this.popoverNode=(0,h._)(),this.panelNode=(0,h._)(),this.listNode=(0,h._)(),this.mapSpecificFontMap=new Map,this.lastSortBy=m.ASCENDING,this.currentFontGroup="static-fonts",this.enableMapSpecificFontList=!1,this.hideCancel=!1,this.arcgisChange=(0,p.lh)(),this.arcgisClose=(0,p.lh)()}static{this.properties={lastSortBy:16,currentFontGroup:16,view:0,enableMapSpecificFontList:5,fontMap:0,font:0,popoverProps:0,hideCancel:5}}static{this.styles=g}async reposition(){this.popoverNode.value?.reposition()}async setFocus(){this.panelNode.value?.setFocus()}updated(){if(this._propWatcherTask.status===d.e1.COMPLETE&&this._initialized&&!this._loaded){this._loaded=!0;const{font:t}=this;t&&this.scrollToFont(),setTimeout(()=>requestAnimationFrame(()=>this.panelNode.value?.setFocus()),300)}}async init(){const{font:t,enableMapSpecificFontList:e}=this;this.currentFont=t&&(0,l.f)(t),this.currentFontGroup=e&&this.view?"map-fonts":"static-fonts",await this.loadAllFonts(),e&&await this.loadMapSpecificFonts(),this._initialized=!0}async loadAllFonts(){const{fontMap:t}=this,e=Array.from(t.entries());Promise.all(e.map(async t=>{try{f.includes(t[0])||await r.loadFont(t[1].font)}catch{}}))}async loadMapSpecificFonts(){const{view:t}=this;if(!t)return;const e=t.map?.allLayers;if(e?.length){const t=e.flatten(t=>"sublayers"in t?t.sublayers:null);await this.loadLayerFonts(t)}t.map.portalItem&&await this.loadItemFonts()}async loadLayerFonts(t){const e=[],i=t.filter(t=>"vector-tile"!==t.type)??[],s=t.filter(t=>"vector-tile"===t.type)??[];i.forEach(async t=>{const i=[...t.labelingInfo??[],...t.featureReduction?.labelingInfo??[]];i.length&&i.forEach(t=>{t.symbol?.font&&e.push(t.symbol.font)})}),this.loadNonVectorTileLayerFonts(e),await this.loadVectorTileLayerFonts(s)}async loadItemFonts(){const{view:t}=this,e=t.map.resourceInfo;if(e){const t=[...e.operationalLayers??[],...e.baseMap?.baseMapLayers??[]];if(t.length){const e=t.filter(t=>"VectorTileLayer"!==t.layerType)??[],i=t.filter(t=>"VectorTileLayer"===t.layerType)??[],s=[];e.forEach(t=>{const e=[...t.layerDefinition?.drawingInfo?.labelingInfo??[],...t.layerDefinition?.featureReduction?.drawingInfo?.labelingInfo??[]];e.length&&e.forEach(t=>{t.symbol?.font&&s.push(n.default.fromJSON(t.symbol?.font))})}),this.loadNonVectorTileLayerFonts(s),await this.loadVectorTileLayerFonts(i)}}}loadNonVectorTileLayerFonts(t){const{fontMap:e}=this;t.map(async t=>{const i=(0,l.f)(t);e.get(i)&&this.mapSpecificFontMap.set(i,e.get(i))})}async loadVectorTileLayerFonts(t){const e=t.map(async t=>await(0,a.default)(t.styleUrl,{query:{f:"json"},method:"get",responseType:"json"}));(await Promise.all(e)).forEach(t=>{const e=t?.data;if(e?.layers){const t=[];e.layers.forEach(e=>{const i=e.layout?.["text-font"]?.[0];i&&!t.includes(i)&&t.push(i)}),t.forEach(t=>{const e=this.fontMap.get(t);e&&this.mapSpecificFontMap.set(t,e)})}})}getSortedFontList(t){const{fontMap:e,mapSpecificFontMap:i,lastSortBy:s}=this,o="static-fonts"===t?e:i;return"map-fonts"===t&&this.currentFont&&i.set(this.currentFont,e.get(this.currentFont)),s===m.ASCENDING?[...o].sort():[...o].sort().reverse()}async getSelectedFont(){const{fontMap:t,font:e}=this;return t.get(this.listNode.value.selectedItems[0].value)?.font??e}scrollToFont(){setTimeout(()=>{this.listNode.value.selectedItems?.[0]?.scrollIntoView({behavior:"auto",block:"center",inline:"center"})},300)}render(){return this._propWatcherTask.render({complete:()=>{const{_messages:t,popoverProps:e}=this,i=e,s={width:`${i.popoverWidth??i.refElement.getBoundingClientRect().width}px`};return i.maxHeight&&(s.maxHeight=i.maxHeight),this.el.classList.add("js-app-flyout"),o.qy`<calcite-popover class="popover" .placement=${i.placement||"leading-start"} open pointer-disabled .referenceElement=${i.refElement} .offsetDistance=${i.offsetDistance??-Math.round(i.refElement.getBoundingClientRect().width)} .offsetSkidding=${i.offsetSkidding??0} .overlayPositioning=${i.overlayPositioning} trigger-disabled .autoClose=${i.autoClose} .label=${t.fonts} ${(0,h.K)(this.popoverNode)}><calcite-panel class="panel" .heading=${t.fonts} closable style=${(0,p.zl)(s)} @calcitePanelClose=${()=>this.arcgisClose.emit()} ${(0,h.K)(this.panelNode)}>${this.renderFontControls()}<calcite-list .label=${t.fonts} class="content" filter-enabled .filterPlaceholder=${t.searchFonts} selection-mode=single-persist ${(0,h.K)(this.listNode)}>${this.renderSortDropdown()}${[...this.getSortedFontList(this.currentFontGroup)].map(([t])=>this.renderListItem(t))}</calcite-list>${this.renderCancelButton()}</calcite-panel></calcite-popover>`}})}renderFontControls(){const{_messages:t,view:e,enableMapSpecificFontList:i}=this;return e&&i?o.qy`<div slot=content-top class="font-mode-wrapper"><calcite-segmented-control scale=s width=full @calciteSegmentedControlChange=${async t=>{const e=t.target.value;"map-fonts"===e&&(this.mapSpecificFontMap=new Map,await this.loadMapSpecificFonts()),this.currentFontGroup=e,this.scrollToFont()}}><calcite-segmented-control-item value=map-fonts checked>${t.mapFonts}</calcite-segmented-control-item><calcite-segmented-control-item value=static-fonts>${t.allFonts}</calcite-segmented-control-item></calcite-segmented-control></div>`:""}renderListItem(t){const{_messages:e,fontMap:i,mapSpecificFontMap:s,currentFont:n,currentFontGroup:a}=this,r="static-fonts"===a?i:s;return o.qy`<calcite-list-item .label=${t} .value=${t} .selected=${n===t} .metadata=${{label:t}} @calciteListItemSelect=${async()=>{const t=await this.getSelectedFont();this.arcgisChange.emit(t),this.arcgisClose.emit()}}><div class="font-preview" slot=actions-end style=${(0,p.zl)({fontFamily:r.get(t).font.family,fontStyle:r.get(t).font.style,fontWeight:r.get(t).font.weight})}>${e.fontPreview}</div></calcite-list-item>`}renderSortDropdown(){const{_messages:t}=this;return o.qy`<calcite-dropdown slot=filter-actions-end overlay-positioning=fixed placement=bottom-end><calcite-action slot=trigger icon=sortDescending .text=${t.sort} title=${t.sort??p.s6} icon-flip-rtl></calcite-action><calcite-dropdown-group><calcite-dropdown-item .selected=${this.lastSortBy===m.ASCENDING} @click=${()=>{this.lastSortBy=m.ASCENDING,this.scrollToFont()}} @keydown=${t=>{t.stopPropagation(),(" "===t.key||"Enter"===t.key)&&(this.lastSortBy=m.ASCENDING,this.scrollToFont())}}>${t.ascending}</calcite-dropdown-item><calcite-dropdown-item .selected=${this.lastSortBy===m.DESCENDING} @click=${()=>{this.lastSortBy=m.DESCENDING,this.scrollToFont()}} @keydown=${t=>{t.stopPropagation(),(" "===t.key||"Enter"===t.key)&&(this.lastSortBy=m.DESCENDING,this.scrollToFont())}}>${t.descending}</calcite-dropdown-item></calcite-dropdown-group></calcite-dropdown>`}renderCancelButton(){const{_messages:t,hideCancel:e}=this;return e?"":o.qy`<calcite-button slot=footer appearance=outline-fill width=full @click=${()=>this.arcgisClose.emit()}>${t.cancel}</calcite-button>`}}(0,s.c)("arcgis-map-config-font-picker",y)}}]);