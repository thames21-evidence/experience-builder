{
  "toolName": "FindHotSpots",
  "version": "0.1.0",
  "modelBuilderVersion": "V2",
  "validationRules": [
    {
      "expression": "(($[Data].analysisField not null AND $[Data].dividedByField not null) AND (($[Data].dividedByField.dataType = 'Field') AND ($[Data].analysisField.name = $[Data].dividedByField.value.name)))",
      "errorKey": "findHotSpots_1"
    },
    {
      "expression": "((($[Component].cellSize.resolvedValue.distance NOT null AND $[Component].distanceBand.resolvedValue.distance NOT null) AND ($[Component].cellSize.resolvedValue.units = $[Component].distanceBand.resolvedValue.units)) AND ($[Component].cellSize.resolvedValue.distance >= $[Component].distanceBand.resolvedValue.distance))",
      "errorKey": "findHotSpots_2"
    },
    {
      "expression": "((($[Component].analysisLayer.selectedLayers.geometryType = 'point') AND ($[Data].analysisField = null)) AND ($[Data].shapeType = null))",
      "errorKey": "findHotSpots_3"
    }
  ],
  "rules": [
    {
      "ruleType": "expression",
      "expression": "$[Component].analysisLayer.selectedLayers.geometryType = 'polygon'",
      "destination": "analysisField",
      "effectParams": {
        "visible": true,
        "required": true
      }
    },
    {
      "ruleType": "expression",
      "expression": "(($[Data].shapeType = 'Fishnet') OR ($[Data].shapeType = 'Hexagon'))",
      "destination": "aggregationPolygonLayer",
      "effectParams": {
        "visible": false,
        "required": false
      }
    },
    {
      "ruleType": "expression",
      "expression": "(($[Data].shapeType = 'Fishnet') OR ($[Data].shapeType = 'Hexagon'))",
      "destination": "boundingPolygonLayer",
      "effectParams": {
        "visible": true,
        "required": false
      }
    },
    {
      "ruleType": "expression",
      "expression": "(($[Data].shapeType = 'Fishnet') OR ($[Data].shapeType = 'Hexagon'))",
      "destination": "cellSize",
      "effectParams": {
        "visible": true,
        "required": false
      }
    },
    {
      "ruleType": "expression",
      "expression": "($[Component].cellSize.resolvedValue.distance NOT null) AND (($[Component].cellSize.resolvedValue.units NOT null) AND ($[Component].cellSize.resolvedValue.units = $[Component].distanceBand.resolvedValue.units))",
      "destination": "distanceBand",
      "effectParams": {
        "minimum": "$[Component].cellSize.resolvedValue.distance",
        "excludeMinValue": true
      }
    },
    {
      "ruleType": "expression",
      "expression": "($[Component].analysisLayer.user.portal.isPortal = false)",
      "destination": ["analysisField", "dividedByField.UIparameterInfos[0]"],
      "effectParams": {
        "allowGeometryFields": true
      }
    },
    {
      "ruleType": "expression",
      "expression": "$[Component].analysisLayer.selectedLayers.geometryType = 'polygon'",
      "destination": ["shapeType", "boundingPolygonLayer", "aggregationPolygonLayer", "cellSize"],
      "effectParams": {
        "visible": false,
        "required": false
      }
    },
    {
      "ruleType": "expression",
      "expression": "(($[Component].analysisLayer.selectedLayers.geometryType = 'point') AND ($[Data].analysisField NOT null))",
      "destination": ["shapeType", "aggregationPolygonLayer"],
      "effectParams": {
        "visible": false,
        "required": false
      }
    },
    {
      "ruleType": "expression",
      "expression": "($[Data].shapeType = null)",
      "destination": ["boundingPolygonLayer", "cellSize"],
      "effectParams": {
        "visible": false,
        "required": false
      }
    },
    {
      "ruleType": "expression",
      "expression": "$[Data].shapeType = 'PolygonLayer'",
      "destination": "aggregationPolygonLayer",
      "effectParams": {
        "visible": true,
        "required": true
      }
    },
    {
      "ruleType": "expression",
      "expression": "(($[Data].shapeType NOT 'Fishnet') AND ($[Data].shapeType NOT 'Hexagon'))",
      "destination": "dividedByField",
      "effectParams": {
        "visible": true
      }
    },
    {
      "ruleType": "expression",
      "expression": "(($[Data].analysisField NOT null) OR ($[Data].aggregationPolygonLayer NOT null))",
      "destination": "dividedByField",
      "effectParams": {
        "visible": true
      }
    },
    {
      "ruleType": "expression",
      "expression": "(($[Data].shapeType = 'Fishnet') OR ($[Data].shapeType = 'Hexagon'))",
      "destination": "dividedByField",
      "effectParams": {
        "visible": false
      }
    },
    {
      "ruleType": "set",
      "value": "$[Component].analysisLayer.selectedLayers",
      "destination": ["analysisField"],
      "property": "mapLayer"
    },
    {
      "ruleType": "expression",
      "expression": "(($[Data].shapeType = 'PolygonLayer') AND ($[Data].aggregationPolygonLayer NOT null))",
      "destination": "dividedByField.UIparameterInfos[0]",
      "effectParams": {
        "mapLayer": "$[Component].aggregationPolygonLayer.selectedLayers"
      }
    },
    {
      "ruleType": "expression",
      "expression": "(($[Data].analysisField NOT null))",
      "destination": "dividedByField.UIparameterInfos[0]",
      "effectParams": {
        "mapLayer": "$[Component].analysisLayer.selectedLayers"
      }
    }
  ],
  "UIparameters": [
    {
      "label": "$inputFeatures",
      "componentName": "analysis-block",
      "summaryText": "$inputFeaturesSectionText",
      "UIparameters": [
        {
          "name": "analysisLayer",
          "label": "$inputLayerGroupLabel",
          "componentName": "analysis-layer-input",
          "layerFilterType": ["feature_point", "feature_polygon", "feature_multiPoint"]
        }
      ]
    },
    {
      "label": "$FHSAnalysisSettingGroupLabel",
      "componentName": "analysis-block",
      "UIparameters": [
        {
          "name": "analysisField",
          "label": "$analysisFieldLabel",
          "componentName": "analysis-field-input",
          "fieldTypes": ["integer", "small-integer", "big-integer", "single", "double", "long"],
          "selectionMode": "single",
          "showFieldInfo": true,
          "visible": true
        },
        {
          "name": "shapeType",
          "label": "$shapeTypeLabel",
          "componentName": "analysis-string-input",
          "choiceList": ["Fishnet", "Hexagon", "PolygonLayer"],
          "choiceListLabels": {
            "Fishnet": "$fishnetLabel",
            "Hexagon": "$hexLabel",
            "PolygonLayer": "$polygonLayer"
          },
          "choiceListIcons": {
            "Fishnet": "grid-unit",
            "Hexagon": "grid-hexagon",
            "PolygonLayer": "layer-polygon"
          },
          "defaultValue": "",
          "visible": true,
          "clearEnabled": true
        },
        {
          "name": "aggregationPolygonLayer",
          "label": "$aggregationPolygonLayer",
          "componentName": "analysis-layer-input",
          "layerFilterType": ["feature_polygon"],
          "visible": false
        },
        {
          "name": "boundingPolygonLayer",
          "label": "$boundingPolygonLayer",
          "componentName": "analysis-layer-input",
          "layerFilterType": ["feature_polygon"],
          "required": false,
          "visible": false,
          "enableSketch": true
        },
        {
          "name": "dividedByField",
          "label": "$dividedByGroupLabel",
          "componentName": "analysis-gp-composite",
          "UIparameterInfos": [
            {
              "name": "normalizationField",
              "dataType": "Field",
              "fieldTypes": ["integer", "small-integer", "single", "double", "long"],
              "selectionMode": "single"
            }
          ]
        },
        {
          "label": "$collapsibleGroupLabel",
          "componentName": "analysis-section",
          "open": false,
          "UIparameters": [
            {
              "name": "cellSize",
              "label": "$cellSizeLabel",
              "minimum": 0,
              "excludeMinValue": true,
              "unitChoiceList": ["Meters", "Kilometers", "Miles", "Feet"],
              "choiceListLabels": {
                "Meters": "$meters",
                "Kilometers": "$kilometers",
                "Miles": "$miles",
                "Feet": "$feet"
              },
              "visible": false
            },
            {
              "name": "distanceBand",
              "label": "$distanceBandLabel",
              "minimum": 0,
              "excludeMinValue": true,
              "unitChoiceList": ["Meters", "Kilometers", "Miles", "Feet"],
              "choiceListLabels": {
                "Meters": "$meters",
                "Kilometers": "$kilometers",
                "Miles": "$miles",
                "Feet": "$feet"
              }
            }
          ]
        }
      ]
    },
    {
      "label": "$resultLayerGroupLabel",
      "componentName": "analysis-block",
      "summaryText": "$outputSectionText",
      "UIparameters": [
        {
          "name": "outputName",
          "label": "$outputName",
          "placeholderText": "$outputNamePlaceholderText",
          "componentName": "analysis-string-input",
          "required": true
        },
        {
          "name": "saveResultIn",
          "label": "$saveResultIn",
          "componentName": "analysis-folder-input"
        }
      ]
    }
  ],
  "outputParameters": [
    {
      "name": "hotSpotsResultLayer",
      "label": "$hotSpotsResultLayerOutput"
    },
    {
      "label": "$processInfoOutput",
      "name": "processInfo"
    }
  ]
}
