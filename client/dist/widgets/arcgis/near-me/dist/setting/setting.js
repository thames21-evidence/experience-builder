System.register(["jimu-core/emotion","jimu-core","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui","jimu-arcgis","jimu-ui/basic/color-picker","jimu-theme","jimu-ui/advanced/style-setting-components","jimu-ui/advanced/rich-text-editor","jimu-ui/advanced/map","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/expression-builder"],function(e,t){var s={},i={},a={},o={},l={},n={},r={},d={},h={},p={},c={},u={},y={},g={};return{setters:[function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.EsriFieldType=e.EsriFieldType,i.Immutable=e.Immutable,i.JimuFieldType=e.JimuFieldType,i.JimuMapViewStatus=e.JimuMapViewStatus,i.OrderRule=e.OrderRule,i.React=e.React,i.classNames=e.classNames,i.css=e.css,i.defaultMessages=e.defaultMessages,i.focusElementInKeyboardMode=e.focusElementInKeyboardMode,i.getAppStore=e.getAppStore,i.lodash=e.lodash,i.polished=e.polished,i.urlUtils=e.urlUtils},function(e){a.MapWidgetSelector=e.MapWidgetSelector,a.MultipleJimuMapConfig=e.MultipleJimuMapConfig,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection,a.SidePopper=e.SidePopper},function(e){o.BaseWidgetSetting=e.BaseWidgetSetting},function(e){l.Alert=e.Alert,l.AlertPopup=e.AlertPopup,l.Button=e.Button,l.Checkbox=e.Checkbox,l.CollapsablePanel=e.CollapsablePanel,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Label=e.Label,l.NumericInput=e.NumericInput,l.Option=e.Option,l.Popper=e.Popper,l.Radio=e.Radio,l.Select=e.Select,l.Switch=e.Switch,l.TextArea=e.TextArea,l.TextInput=e.TextInput,l.Tooltip=e.Tooltip,l.defaultMessages=e.defaultMessages},function(e){n.MapViewManager=e.MapViewManager,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.ThemeColorPicker=e.ThemeColorPicker},function(e){d.getTheme2=e.getTheme2},function(e){h.FontStyle=e.FontStyle,h.InputUnit=e.InputUnit},function(e){p.FontFamily=e.FontFamily},function(e){c.JimuSymbolType=e.JimuSymbolType,c.SymbolSelector=e.SymbolSelector},function(e){u.List=e.List,u.TreeItemActionType=e.TreeItemActionType},function(e){y.DataSourceSelector=e.DataSourceSelector,y.FieldSelector=e.FieldSelector},function(e){g.ExpressionBuilder=e.ExpressionBuilder,g.ExpressionBuilderType=e.ExpressionBuilderType}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=d},4108:e=>{"use strict";e.exports=o},12046:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},13089:e=>{"use strict";e.exports=y},14321:e=>{"use strict";e.exports=l},14962:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 3a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1zM1 6.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M1.5 9a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zM1.5 12a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},15562:e=>{"use strict";e.exports=h},27931:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgOCA4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgZmlsbD0nIzI4MjgyOCc+DQogICAgPHBhdGggZD0iTTMuNSAzLjV2LTNhLjUuNSAwIDAxMSAwdjNoM2EuNS41IDAgMDEwIDFoLTN2M2EuNS41IDAgMDEtMSAwdi0zaC0zYS41LjUgMCAwMTAtMWgzeiIgZmlsbC1ydWxlPSJldmVub2RkIj48L3BhdGg+DQo8L3N2Zz4="},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},33949:e=>{"use strict";e.exports=p},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},42588:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 4.429V15h14V1L6.833 7.857zM14 3v11H2V6.114l4.182 2.51a1.2 1.2 0 0 0 1.398-.118z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},48993:e=>{"use strict";e.exports=c},54337:e=>{"use strict";e.exports=r},54578:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 13a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1zM1 9.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5M1.5 7a.5.5 0 0 1 0-1h10a.5.5 0 0 1 0 1zM1.5 4a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1z"></path></svg>'},62686:e=>{"use strict";e.exports=n},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=s},74919:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7 2h2a2 2 0 0 1 2 2v7.817l-3 2.812-3-2.812V4a2 2 0 0 1 2-2m5 2v8.25L8 16l-4-3.75V4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3M9 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=a},84845:e=>{"use strict";e.exports=g},86058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.582 5 11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2z"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},98640:e=>{"use strict";e.exports=u}},t={};function m(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,m),a.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var s in t)m.o(t,s)&&!m.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var S={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(S),m.d(S,{__set_webpack_public_path__:()=>st,default:()=>tt});var e=m(67386),t=m(79244),s=m(79298),i=m(4108),a=m(14321),o=m(62686);const l={selectMapWidgetLabel:"Select a Map widget",keepResultsWhenClosed:"Keep results when closed",keepResultsWhenClosedTooltip:"The analysis results will not be cleared when the widget is closed or hidden.",warningMsgIfNoLayersOnMap:"This map does not contain any feature layers. Select a map with at least one feature layer.",generalSettingsLabel:"General Settings",highlightColor:"Sketch color",highlightColorTooltip:"Indicate the desired color for sketching on the map",searchAreaSymbolLabel:"Search area symbol",searchAreaSymbolTooltip:"Configure search area symbol and transparency",onlyShowResults:"Filter layers to only show results",onlyShowResultsTooltip:"Filter the data source to only show features from the analysis results. Other widgets connected to this data source will be filtered.",displayAllLayersResultLabel:"Display all layer results on map, regardless of visibility.",displayAllLayersResultTooltip:"Show configured layers on map, even if they are hidden, when results are returned.",enableProximitySearchLabel:"Enable proximity search",enableProximitySearchTooltip:"Use the currently selected feature as the input location to perform the analysis",saveInputLocationLabel:"Save input location",saveInputLocationTooltip:"Save input location in the appropriate configured point, line, or polygon layer.",saveSearchAreaLabel:"Save search area",saveSearchAreaTooltip:"Save search area in the configured polygon layer.",noResultsFoundLabel:"No results found message",noDataMessageDefaultText:"No results found.",promptMessageLabel:"Custom message",promptMessageLabelToolTip:"For example, provide users with instructions on how to start the workflow.",headingLabel:"Heading label",locationLabel:"Location",currentMapAreaLabel:"Explore features within current map area",disabledDefineSearchAreaLabel:"Explore all features",defineSearchAreaTooltip:"Assess all features within the map area, or specify a location using sketch tools or the output from another widget.",defineSearchAreaLabel:"Search Method",featuresOutsideMapArea:"Include features outside map area",searchAreaHint:"No search area is defined and all the features will be displayed. Any configured Closest Feature analysis will be ignored.",point:"Point",polyline:"Polyline",polygon:"Polygon",showSketchTools:"Sketch tools",activateToolOnLoadLabel:"Activate when widget opens",activateToolOnLoadTooltip:"Activate the selected sketch tool automatically when the widget opens.",bufferDistance:"Search distance",distanceUnits:"Distance units",meters:"Meters",feet:"Feet",kilometers:"Kilometers",miles:"Miles",yards:"Yards",searchByActiveMapArea:"Current map area",searchByLocation:"Specify a location",showDistanceSettings:"Distance settings",showDistFromInputLoc:"Approximate distance",inputAddress:"Input location label",mapSettingsHintMsg:"Click a map below to configure the analysis settings.",analysisSettingsLabel:"Analysis Settings",addAnalysisLabel:"Add Analysis",configureAnalysisTooltip:"Configure closest feature, proximity, or summary analysis for layers in the map. Configured layers will be used for analysis regardless of their visibility in the map.",closest:"Closest Feature",analysisTypeLabel:"Analysis Type",highlightResultsOnMapLabel:"Highlight results on map",highlightColorLabel:"Highlight color",closestAnalysisTypeTooltip:"Find the closest feature.",closestFeatureMaxDistLabel:"Maximum distance",warningMsgIfActiveMapArea:'"Current map area" is defined as the search method. No results will be shown for this analysis type.',proximity:"Proximity",proximityAnalysisTypeTooltip:"Find features within a specified distance.",displayFieldLabel:"Display field",sortFeaturesLabel:"Sort features",distanceLabel:"Distance",noSelectionItemLabel:"- Select -",groupFeaturesLabel:"Group features",groupFeaturesInfoToolTip:"Group features based on multiple field values",sortGroupsByCount:"Sort groups by count",noValueGroupLabel:'"No value" group label',expandOnOpen:"Expand analysis results",expandFeatureDetails:"Expand feature details",returnIntersectedPolygons:"Return intersected polygons",expandListTooltip:"Use with caution: performance may be impacted for analysis results with a large number of features.",configureFieldsLabel:"Configure fields to export",includeApproxDistance:"Include approximate distance",summary:"Summary",summaryAnalysisTypeTooltip:"Summarize numeric values.",addSummaryFields:"Add Summary",editSummaryField:"Edit Summary Field",editExpression:"Edit Expression",editAnalysis:"Edit Analysis",editSumOfIntersectedArea:"Edit sum of intersected area",editSumOfIntersectedLength:"Edit sum of intersected length",showSeparator:"Show thousand separator",sumOfIntersectedArea:"Sum of intersected area",sumOfIntersectedLength:"Sum of intersected length",sumOfAreaTooltip:"Sum of intersected area calculates the area of polygon intersected by search geometry",sumOfLengthTooltip:"Sum of intersected length calculates the length of polyline intersected by search geometry",noFormatting:"No formatting",round:"Round",truncate:"Truncate",significantDigitsLabel:"Significant digits",singleColor:"Single color",byCategory:"By category",summaryFieldColor:"Define summary colors",applyColors:"Apply colors",colorStrip:"Color strip",displayFeatureCountLabel:"Feature count",displayFeatureCountInfoTooltip:"Show number of features returned",displayAnalysisIconLabel:"Analysis icons",mapSymbolsLabel:"Map symbols",addSummaryHintMsg:"Add new summary expressions or only display the feature count.",noAnalysisConfiguredMsg:"Analysis is not configured for layers in this map.",resultsCollapsible:"Results",inputsCollapsible:"Inputs",analysisLabel:"Analysis",clipFeaturesLabel:"Clip features",clippedInfoLabel:"Intersected Area/Length",clipFeaturesTooltip:"Clip intersected line or polygon features"};function n(e,s){return t.css`
  .alignTooltip {
    margin-right: -6px;
  }
  
  .disabled-label{
    color: ${e.ref.palette.neutral[700]};
  }

  .labelStyle {
    justify-content: left!important;
  }

  .hideTooltip {
    display: none!important;
  }

  .nearme-analysis-list-items {
    .analysis-item {
      padding: 4px 2px 8px 2px;

      .layer-analysis-name {
        font-size: ${t.polished.rem(14)};
        font-weight: 400;
        width: ${s?"150px":"165px"};
       }

      .analysis-type-name {
        font-size: ${t.polished.rem(13)};
        padding-top: 10px;
        width: 165px;
      }
    }

    .cursor-pointer {
      cursor: pointer;
    }
  }

  .sort-field-section {
    display: flex;
    align-items: center;
    flex: 1;
    .sort-field-selector {
      background:${e.sys.color.secondary.light};
      border-radius: 2px;
      flex: 1;
      width: 0
    }

    .order-button {
        cursor: pointer;
        text-align:right;
        margin-left: ${t.polished.rem(2)};
    }

    .order-button svg {
        margin-right:0;
    }
  }

  .sort-icon {
    & {
        margin-left:5px;
    }

    .sort-button-l {
      border-radius: 2px 0 0 2px;
      border-right:none;
    }

    .sort-button-r {
      border-radius: 0px 2px 2px 0px;
      border-left:none;
    }

    .sort-button {
      border-color: ${e.sys.color.divider.primary};
    }

    svg {
      margin-right:0;
    }
  }

  .cursor-pointer {
    cursor: pointer;
  }

  .add-summary-field {
    height: ${t.polished.rem(40)};
    width: 100%;
    color: ${e.sys.color.primary.light};
    font-size: ${t.polished.rem(14)};
    cursor: pointer;
    &:hover {
      .add-summary-field-icon-container {
        background-color: ${t.polished.rgba(e.sys.color.primary.light,.8)};
      }
      color: ${t.polished.rgba(e.sys.color.primary.light,.8)};
    }
    .add-summary-field-icon-container {
      width: 20px;
      height: 20px;
      background-color: ${e.sys.color.primary.light};
      border-radius: 10px;
    }
    .add-summary-field-icon {
      color: ${e.ref.palette.neutral[400]};
    }
  }

  .fieldName {
    width: 180px;
  }

  .nearme-summary-fields-list-items {
    flex: 1;
    max-height: 290px;
    overflow-y: auto;
    margin-bottom: 10px;
    margin-top: 3px;

    .labelAlign {
      width: calc(100% - 65px);
      max-width: 155px;
    }

    .jimu-tree-item.jimu-tree-item_dnd-true {
      height: auto;
      padding-top: 0rem;
  
      .jimu-tree-item__body {
        padding: 4px 0px 4px 0px;
      }
    }
  }

  .colorModesWidth {
    width: calc(100% - 30px);
  }

  .analysisTypeWidth { 
    width: calc(100% - 16px);
  }
  `}function r(e){return t.css`
    position: absolute;
    top: 0;
    bottom: 0;
    width: 259px;
    height: 100%;
    padding-bottom: 1px;
    border-right: 1px solid ${e.ref.palette.white};
    border-bottom: 1px solid ${e.ref.palette.white};

    .setting-container {
      height: calc(100% - 52px);
      overflow: auto;
    }
`}function d(e){return t.css`
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: var(--ref-palette-neutral-1100);
    > .color-list {
      width: 100%;
      flex-grow: 1;
      overflow-y: auto;
      max-height: 562px;
    }
    > .footer {
      height: 57px;
      width: 100%;
      border-top: 1px solid #6a6a6a;
      > div {
        display: flex;
        width: 100%;
        justify-content: space-between;
      }
    }

    .colorItemStyle {
      display: flex;
      width: 100%;
      justify-content: space-between;
      label {
        width: 88%;
        flex-grow: 1;
        display: inline-flex;
        justify-content: space-between;
        .label {
          max-width: 70%;
        }
      }
    }
`}var h;!function(e){e.Closest="closest",e.Proximity="proximity",e.Summary="summary"}(h||(h={}));var p=m(31027),c=m.n(p),u=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const y=s=>{const i=window.SVG,{className:a}=s,o=u(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:c()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};const g=(e,t=0)=>{if(!(null==e?void 0:e.length))return;return e[t%e.length]},f=e=>t.DataSourceManager.getInstance().getDataSource(e);var b;!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(b||(b={}));const v=e=>{switch(e){case"feet":return b.Feet;case"miles":return b.Miles;case"kilometers":return b.Kilometers;case"meters":return b.Meters;case"yards":return b.Yards;default:return 1e3}},x=e=>{let s=null;const i=[];let a=!1;const l=o.MapViewManager.getInstance().getJimuMapViewById(e).getAllJimuLayerViews();return null==l||l.forEach(e=>{if(s=f(e.layerDataSourceId),s)if((null==s?void 0:s.type)===t.DataSourceTypes.MapService||(null==s?void 0:s.type)===t.DataSourceTypes.GroupLayer||(null==s?void 0:s.type)===t.DataSourceTypes.SubtypeGroupLayer){const e=s=>{s.getChildDataSources().forEach(s=>{(null==s?void 0:s.type)===t.DataSourceTypes.MapService||(null==s?void 0:s.type)===t.DataSourceTypes.GroupLayer||(null==s?void 0:s.type)===t.DataSourceTypes.SubtypeGroupLayer?e(s):(null==s?void 0:s.type)!==t.DataSourceTypes.FeatureLayer&&(null==s?void 0:s.type)!==t.DataSourceTypes.SubtypeSublayer||i.push(s)})};e(s)}else if((null==s?void 0:s.type)===t.DataSourceTypes.FeatureLayer||(null==s?void 0:s.type)===t.DataSourceTypes.SubtypeSublayer)if(i.length>0){i.find(e=>e.id===s.id)||(a=!0),a&&i.push(s)}else i.push(s)}),i},F=e=>{var t;let s="";const i=null==e?void 0:e.getLayerDefinition(),a=null==e?void 0:e.getIdField();return s=a||((null==i?void 0:i.displayField)?i.displayField:null===(t=null==i?void 0:i.fields)||void 0===t?void 0:t[0].name),s},C=()=>{const e=(0,t.getAppStore)().getState().portalSelf;return"english"===(null==e?void 0:e.units)?"miles":"kilometers"},w=(e,t,s)=>`${e}_output_${t}_${s}`,I=()=>`${Math.random()}`.slice(2).toString(),L=e=>{const t=f(e),s=t&&t.getSchema(),i=(null==s?void 0:s.fields)?Object.values(null==s?void 0:s.fields):[],a=[];return i&&i.length>0&&i.forEach(e=>{a.push(e.jimuName)}),a},A=(e,t)=>{const s=e;let i=[];i||(i=[]);let a=[];t&&(a=t.map(e=>e.value));for(const e in s)if(!t||a.includes(e)){const t=s[e].analysisSettings.layersInfo,a=s[e].analysisSettings.saveFeatures;if(null==t||t.forEach(t=>{var s,a,o,l,n,r,d,p,c;const u=t.analysisInfo,y=i.filter(e=>e.dataSourceId===t.useDataSource.dataSourceId);let g=(null==y?void 0:y.length)>0?y[0]:{dataSourceId:t.useDataSource.dataSourceId,mainDataSourceId:t.useDataSource.mainDataSourceId,rootDataSourceId:e,fields:[]};t.useDataSource.dataViewId&&(g={dataSourceId:t.useDataSource.dataSourceId,mainDataSourceId:t.useDataSource.mainDataSourceId,dataViewId:t.useDataSource.dataViewId,rootDataSourceId:e,fields:[]}),(u.analysisType===h.Closest||u.analysisType===h.Proximity||u.analysisType===h.Summary)&&(null===(s=u.fieldsToExport)||void 0===s?void 0:s.length)>0&&u.fieldsToExport.forEach(e=>{!g.fields.includes(e)&&"esriCTApproxDistance"!==e&&g.fields.push(e)}),u.analysisType===h.Proximity&&(null===(a=u.displayField)||void 0===a?void 0:a.length)>0&&!g.fields.includes(u.displayField)&&g.fields.push(u.displayField),(null===(l=null===(o=u.sortFeatures)||void 0===o?void 0:o.sortFeaturesByField)||void 0===l?void 0:l.length)>0&&!g.fields.includes(u.sortFeatures.sortFeaturesByField)&&g.fields.push(u.sortFeatures.sortFeaturesByField),(null===(r=null===(n=u.groupFeatures)||void 0===n?void 0:n.groupFeaturesByField)||void 0===r?void 0:r.length)>0&&!g.fields.includes(u.groupFeatures.groupFeaturesByField)&&g.fields.push(u.groupFeatures.groupFeaturesByField),(null===(p=null===(d=u.subGroupFeatures)||void 0===d?void 0:d.subGroupFeaturesByField)||void 0===p?void 0:p.length)>0&&!g.fields.includes(u.subGroupFeatures.subGroupFeaturesByField)&&g.fields.push(u.subGroupFeatures.subGroupFeaturesByField),u.analysisType===h.Summary&&(null===(c=u.summaryFields)||void 0===c||c.forEach(e=>{var t;null===(t=e.summaryFieldInfo.parts)||void 0===t||t.forEach(e=>{e.jimuFieldName&&!g.fields.includes(e.jimuFieldName)&&g.fields.push(e.jimuFieldName)})})),0===y.length&&i.push(g)}),a){["pointFeature","polylineFeature","polygonFeature","searchAreaFeature"].forEach(t=>{const s=a[t];if((null==s?void 0:s.enabled)&&s.useDataSource){const t=i.filter(e=>e.dataSourceId===s.useDataSource.dataSourceId),a=(null==t?void 0:t.length)>0?t[0]:{dataSourceId:s.useDataSource.dataSourceId,mainDataSourceId:s.useDataSource.mainDataSourceId,rootDataSourceId:e,fields:[]};0===t.length&&i.push(a)}})}}return i};var j=m(54337),D=m(45508),O=m.n(D),T=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const M=s=>{const i=window.SVG,{className:a}=s,o=T(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:O()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};var k=m(1888),N=m(15562),R=m(33949);class P extends t.React.PureComponent{constructor(e){var t,s,i,a,o,n,r;super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidUpdate=e=>{var t,s,i,a,o,l,n,r,d,h,p,c,u,y;e.hintMessage!==this.props.hintMessage&&this.setState({promptMessage:this.props.hintMessage}),(null===(t=e.textStyle)||void 0===t?void 0:t.fontFamily)!==(null===(s=this.props.textStyle)||void 0===s?void 0:s.fontFamily)&&this.setState({fontFamily:this.props.textStyle.fontFamily}),(null===(i=e.textStyle)||void 0===i?void 0:i.fontBold)!==(null===(a=this.props.textStyle)||void 0===a?void 0:a.fontBold)&&this.setState({fontBold:this.props.textStyle.fontBold}),(null===(o=e.textStyle)||void 0===o?void 0:o.fontItalic)!==(null===(l=this.props.textStyle)||void 0===l?void 0:l.fontItalic)&&this.setState({fontItalic:this.props.textStyle.fontItalic}),(null===(n=e.textStyle)||void 0===n?void 0:n.fontUnderline)!==(null===(r=this.props.textStyle)||void 0===r?void 0:r.fontUnderline)&&this.setState({fontUnderline:this.props.textStyle.fontUnderline}),(null===(d=e.textStyle)||void 0===d?void 0:d.fontStrike)!==(null===(h=this.props.textStyle)||void 0===h?void 0:h.fontStrike)&&this.setState({fontStrike:this.props.textStyle.fontStrike}),(null===(p=e.textStyle)||void 0===p?void 0:p.fontColor)!==(null===(c=this.props.textStyle)||void 0===c?void 0:c.fontColor)&&this.setState({fontColor:this.props.textStyle.fontColor}),(null===(u=e.textStyle)||void 0===u?void 0:u.fontSize)!==(null===(y=this.props.textStyle)||void 0===y?void 0:y.fontSize)&&this.setState({fontSize:this.props.textStyle.fontSize})},this.onTextAccept=e=>{this.props.noResultFound?this.props.onTextMessageChange(e,this.props.noResultFound):this.props.onTextMessageChange(e,this.props.promptTextMessage)},this.onTextChange=e=>{this.setState({promptMessage:e})},this.handleFontChange=e=>{this.setState({fontFamily:e},()=>{this.setFontStyleValues()})},this.setFontStyleValues=()=>{const e={fontFamily:this.state.fontFamily,fontBold:this.state.fontBold,fontItalic:this.state.fontItalic,fontUnderline:this.state.fontUnderline,fontStrike:this.state.fontStrike,fontColor:this.state.fontColor,fontSize:this.state.fontSize};this.props.noResultFound?this.props.onTextFormatChange(e,this.props.noResultFound):this.props.onTextFormatChange(e,this.props.promptTextMessage)},this.handleFontStyleChange=(e,t)=>{switch(e){case"bold":this.setState({fontBold:t},()=>{this.setFontStyleValues()});break;case"italic":this.setState({fontItalic:t},()=>{this.setFontStyleValues()});break;case"underline":this.setState({fontUnderline:t,fontStrike:!1},()=>{this.setFontStyleValues()});break;case"strike":this.setState({fontUnderline:!1,fontStrike:t},()=>{this.setFontStyleValues()})}},this.handleColorChange=e=>{this.setState({fontColor:e||"var(--ref-palette-black)"},()=>{this.setFontStyleValues()})},this.handleFontSizeChange=e=>{!e||e.distance<4||this.setState({fontSize:e.distance+e.unit},()=>{this.setFontStyleValues()})},this.state={promptMessage:this.props.hintMessage,fontFamily:null===(t=this.props.textStyle)||void 0===t?void 0:t.fontFamily,fontBold:null===(s=this.props.textStyle)||void 0===s?void 0:s.fontBold,fontItalic:null===(i=this.props.textStyle)||void 0===i?void 0:i.fontItalic,fontUnderline:null===(a=this.props.textStyle)||void 0===a?void 0:a.fontUnderline,fontStrike:null===(o=this.props.textStyle)||void 0===o?void 0:o.fontStrike,fontColor:null===(n=this.props.textStyle)||void 0===n?void 0:n.fontColor,fontSize:null===(r=this.props.textStyle)||void 0===r?void 0:r.fontSize}}render(){return(0,e.jsxs)("div",{style:{height:"100%",width:"100%"},children:[(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(a.TextArea,{tabIndex:0,className:"w-100",spellCheck:!1,"aria-label":this.state.promptMessage,value:this.state.promptMessage,onChange:e=>{this.onTextChange(e.target.value)},onAcceptValue:this.onTextAccept})}),(0,e.jsxs)("div",{className:"w-100 pt-2",children:[(0,e.jsx)(R.FontFamily,{className:"w-100",font:this.state.fontFamily,onChange:this.handleFontChange}),(0,e.jsxs)("div",{className:"d-flex justify-content-between mt-2",children:[(0,e.jsx)(N.FontStyle,{style:{width:"103px"},onChange:this.handleFontStyleChange,bold:this.state.fontBold,italic:this.state.fontItalic,underline:this.state.fontUnderline,strike:this.state.fontStrike}),(0,e.jsx)(j.ThemeColorPicker,{style:{width:"25px"},specificTheme:(0,k.getTheme2)(),value:this.state.fontColor,onChange:this.handleColorChange}),(0,e.jsx)(N.InputUnit,{style:{width:"76px"},min:4,max:72,value:this.state.fontSize,onChange:this.handleFontSizeChange})]})]})]})}}var B=m(48993),E=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function l(e){try{r(i.next(e))}catch(e){o(e)}}function n(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(l,n)}r((i=i.apply(e,t||[])).next())})};const G={tags:["semi-opaque"],title:"Blue",style:"esriSFSSolid",color:[0,76,163,128],name:"Blue 1",type:"esriSFS",outline:{style:"esriSLSSolid",color:[50,111,181,255],width:1.5,type:"esriSLS"}};class V extends t.React.PureComponent{constructor(e){super(e),this._jsonUtils=null,this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidUpdate=e=>E(this,void 0,void 0,function*(){if(e.theme.sys.color.primary.dark!==this.props.theme.sys.color.primary.dark){this.props.onGeneralSettingsUpdated("highlightColor",this.props.theme.sys.color.primary.dark);const e=yield(0,o.loadArcGISJSAPIModules)(["esri/Color"]),t=new e[0](this.props.theme.sys.color.primary.dark);t.a=.3;const s=new e[0](this.props.theme.sys.color.primary.dark);s.a=1;const i={type:"esriSFS",color:t,outline:{type:"esriSLS",color:s,width:1.5,style:"esriSLSSolid"},style:"esriSFSSolid"};this.props.onGeneralSettingsUpdated("searchAreaSymbol",i)}e.config.noResultsFoundText!==this.props.config.noResultsFoundText&&this.setState({noResultsFoundMessage:this.props.config.noResultsFoundText}),e.config.promptTextMessage!==this.props.config.promptTextMessage&&this.setState({promptMessage:this.props.config.promptTextMessage})}),this.componentDidMount=()=>{this.state.isApiLoaded||(0,o.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]).then(e=>{[this._jsonUtils]=e,this.setState({isApiLoaded:!0})})},this.onHighlightColorChange=e=>{this.props.onGeneralSettingsUpdated("highlightColor",e)},this.onBufferSymbolChanged=e=>{let t=e;null===e&&(t=this._jsonUtils.fromJSON(G)),this.props.onGeneralSettingsUpdated("searchAreaSymbol",null==t?void 0:t.toJSON())},this.onKeepResultOptionChange=e=>{this.props.onGeneralSettingsUpdated("keepResultsWhenClosed",e.target.checked)},this.updateOnTextStyleChange=(e,t)=>{"noResultFound"===t?this.props.onGeneralSettingsUpdated("noResultMsgStyleSettings",e):this.props.onGeneralSettingsUpdated("promptTextMsgStyleSettings",e)},this.updateTextMessage=(e,t)=>{"noResultFound"===t?this.props.onGeneralSettingsUpdated("noResultsFoundText",e):this.props.onGeneralSettingsUpdated("promptTextMessage",e)},this.props.config&&(this.state={noResultsFoundMessage:this.props.config.noResultsFoundText,promptMessage:this.props.config.promptTextMessage,isApiLoaded:!1})}render(){var i,o,l;const n=(null===(i=this.props.config)||void 0===i?void 0:i.searchAreaSymbol)?null===(o=this._jsonUtils)||void 0===o?void 0:o.fromJSON(this.props.config.searchAreaSymbol):null===(l=this._jsonUtils)||void 0===l?void 0:l.fromJSON(G);return(0,e.jsxs)("div",{css:(this.props.theme,t.css`
    .jimu-symbol-selector {
      width: 25px;
      height: 25px;
    }
  `),style:{height:"100%",width:"100%",marginTop:10},children:[(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(a.Label,{className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("highlightColor")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("highlightColor")+" "+this.nls("highlightColorTooltip"),title:this.nls("highlightColorTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-4 d-inline",children:(0,e.jsx)(M,{})})}),(0,e.jsx)(j.ThemeColorPicker,{"aria-label":this.nls("highlightColor"),specificTheme:(0,k.getTheme2)(),value:this.props.config.highlightColor?this.props.config.highlightColor:"#00FFFF",onChange:e=>{this.onHighlightColorChange(e)}})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(a.Label,{className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("searchAreaSymbolLabel")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("searchAreaSymbolTooltip"),title:this.nls("searchAreaSymbolTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-4 d-inline",children:(0,e.jsx)(M,{})})}),n&&(0,e.jsx)(B.SymbolSelector,{jimuSymbolType:B.JimuSymbolType.Polygon,symbol:n,onPolygonSymbolChanged:this.onBufferSymbolChanged.bind(this)})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(a.Label,{className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("keepResultsWhenClosed")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("keepResultsWhenClosedTooltip"),title:this.nls("keepResultsWhenClosedTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-3 d-inline",children:(0,e.jsx)(M,{})})}),(0,e.jsx)(a.Switch,{role:"switch",title:this.nls("keepResultsWhenClosed"),checked:this.props.config.keepResultsWhenClosed,onChange:this.onKeepResultOptionChange.bind(this)})]}),(0,e.jsxs)(s.SettingRow,{flow:"wrap",children:[(0,e.jsx)(a.Label,{"aria-label":this.nls("noResultsFoundLabel"),title:this.nls("noResultsFoundLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("noResultsFoundLabel")})}),(0,e.jsx)(P,{intl:this.props.intl,theme:this.props.theme,hintMessage:this.state.noResultsFoundMessage,noResultFound:"noResultFound",textStyle:this.props.config.noResultMsgStyleSettings,onTextMessageChange:this.updateTextMessage,onTextFormatChange:this.updateOnTextStyleChange})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(a.Label,{"aria-label":this.nls("promptMessageLabel"),title:this.nls("promptMessageLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"w-100 flex-grow-1 title3 hint-default",children:this.nls("promptMessageLabel")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("promptMessageLabelToolTip"),title:this.nls("promptMessageLabelToolTip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default ml-2 d-inline",children:(0,e.jsx)(M,{})})})]}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(P,{intl:this.props.intl,theme:this.props.theme,hintMessage:this.state.promptMessage,promptTextMessage:"promtMessage",textStyle:this.props.config.promptTextMsgStyleSettings,onTextMessageChange:this.updateTextMessage,onTextFormatChange:this.updateOnTextStyleChange})})]})}}const U=[{value:"feet",label:"Feet"},{value:"meters",label:"Meters"},{value:"kilometers",label:"Kilometers"},{value:"miles",label:"Miles"},{value:"yards",label:"Yards"}],W=[h.Closest,h.Proximity,h.Summary],z="#f507f5",J="#FFFFFF00",_=[{analysisId:"",analysisType:W[0],highlightResultsOnMap:!0,highlightColorOnMap:z,expandOnOpen:!0,returnIntersectedPolygons:!1,clipFeatures:!1,fieldsToExport:[],includeApproxDistance:!1,displayFeatureCount:!0},{analysisId:"",analysisType:W[1],displayField:"",sortFeaturesByDistance:!0,sortFeatures:{sortFeaturesByField:"",sortFeaturesOrder:"ASC"},groupFeaturesEnabled:!1,groupFeatures:{groupFeaturesByField:"",groupFeaturesOrder:"ASC",sortGroupsByCount:!1,noValueGroupLabel:""},subGroupFeatures:{subGroupFeaturesByField:"",subGroupFeaturesOrder:"ASC",sortSubGroupsByCount:!1,noValueSubGroupLabel:""},highlightResultsOnMap:!0,highlightColorOnMap:z,expandOnOpen:!1,expandFeatureDetails:!1,returnIntersectedPolygons:!1,fieldsToExport:[],includeApproxDistance:!1,displayFeatureCount:!0},{analysisId:"",analysisType:W[2],isSingleColorMode:!0,singleFieldColor:J,summaryFields:[],highlightResultsOnMap:!0,highlightColorOnMap:z,expandOnOpen:!1,fieldsToExport:[],displayFeatureCount:!0}],K={analysisSettings:{layersInfo:[],displayAnalysisIcon:!1,displayMapSymbols:!1,showDistFromInputLocation:!0,onlyShowLayersResult:!1,displayAllLayersResult:!1,enableProximitySearch:!1,saveFeatures:{saveInputLocation:!1,pointFeature:{enabled:!1,useDataSource:null},polylineFeature:{enabled:!1,useDataSource:null},polygonFeature:{enabled:!1,useDataSource:null},searchAreaFeature:{enabled:!1,useDataSource:null}}},searchSettings:{headingLabel:"",bufferDistance:1,distanceUnits:"",showDistanceSettings:!0,sketchTools:{showPoint:!0,showPolyline:!0,showPolygon:!0},activeToolWhenWidgetOpens:"none",searchByActiveMapArea:!1,includeFeaturesOutsideMapArea:!1,headingLabelStyle:{fontFamily:"Avenir Next",fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1,fontColor:"var(--sys-color-surface-paper-text)",fontSize:"13px"},showInputAddress:!0}};var H,$;!function(e){e.NoFormatting="noFormatting",e.Round="round",e.Truncate="truncate"}(H||(H={})),function(e){e.SumOfIntersectedArea="sumOfIntersectedArea",e.SumOfIntersectedLength="sumOfIntersectedLength"}($||($={}));$.SumOfIntersectedLength,H.NoFormatting,$.SumOfIntersectedArea,H.NoFormatting;var q;!function(e){e.SingleColor="singleColor",e.ByCategory="byCategory"}(q||(q={}));const Z=["#5E8FD0","#77B484","#DF6B35","#DBCF4E","#41546D","#8257C2","#D6558B"],Y=[Z,["#596A90","#85C2E4","#DEB3D9","#9FB6E1","#BBE4EF","#C5B2E1","#8482D0"],["#A6382F","#47707A","#F0CF35","#D18332","#B9C143","#E38B67","#AAC86A"],["#E49DAF","#B1F2D0","#F5F49A","#94CAFC","#E9C7A3","#C9A7E8","#DDF3AA"],["#004CA3","#005ECA","#076FE5","#2C8FFF","#65ADFF","#ACD3FF","#E6F2FF"],["#7D5D00","#AA7F00","#DDA400","#FFC300","#FFCE2F","#FFDE72","#FFEDB1"],["#4E427E","#6A5A9E","#8E7AC3","#A293D9","#B0A3E7","#C4B7EB","#DFD9F1"],["#BA4300","#ED5500","#FF7121","#FF8D4C","#FFA878","#FFC4A3","#FFE0CE"]];var Q=m(74919),X=m.n(Q),ee=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const te=s=>{const i=window.SVG,{className:a}=s,o=ee(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:X()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};var se=m(86058),ie=m.n(se),ae=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const oe=s=>{const i=window.SVG,{className:a}=s,o=ae(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:ie()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};var le=m(42588),ne=m.n(le),re=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const de=s=>{const i=window.SVG,{className:a}=s,o=re(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:ne()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};class he extends t.React.PureComponent{constructor(e){var t,s,i;super(e),this.nls=e=>{var t;const s=Object.assign({},l,a.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidUpdate=e=>{var t,s,i,a,o,l,n,r,d;(null===(t=e.config.sketchTools)||void 0===t?void 0:t.showPoint)!==(null===(s=this.props.config.sketchTools)||void 0===s?void 0:s.showPoint)?this.setState({showPoint:null===(i=this.props.config.sketchTools)||void 0===i?void 0:i.showPoint}):(null===(a=e.config.sketchTools)||void 0===a?void 0:a.showPolyline)!==(null===(o=this.props.config.sketchTools)||void 0===o?void 0:o.showPolyline)?this.setState({showPolyline:null===(l=this.props.config.sketchTools)||void 0===l?void 0:l.showPolyline}):(null===(n=e.config.sketchTools)||void 0===n?void 0:n.showPolygon)!==(null===(r=this.props.config.sketchTools)||void 0===r?void 0:r.showPolygon)&&this.setState({showPolygon:null===(d=this.props.config.sketchTools)||void 0===d?void 0:d.showPolygon})},this.onHeadingLabelChange=e=>{this.props.onSearchSettingsUpdated("headingLabel",e)},this.updateOnHeadingStyleChange=e=>{this.props.onSearchSettingsUpdated("headingLabelStyle",e)},this.onIncludeFeaturesMapAreaToggleChange=e=>{const t={headingLabel:e.target.checked?this.nls("disabledDefineSearchAreaLabel"):this.nls("currentMapAreaLabel"),bufferDistance:this.props.config.bufferDistance,distanceUnits:this.props.config.distanceUnits,showDistanceSettings:this.props.config.showDistanceSettings,sketchTools:{showPoint:this.props.config.sketchTools.showPoint,showPolyline:this.props.config.sketchTools.showPolyline,showPolygon:this.props.config.sketchTools.showPolygon},activeToolWhenWidgetOpens:this.props.config.activeToolWhenWidgetOpens,searchByActiveMapArea:this.props.config.searchByActiveMapArea,includeFeaturesOutsideMapArea:e.target.checked,headingLabelStyle:{fontFamily:this.props.config.headingLabelStyle.fontFamily,fontBold:this.props.config.headingLabelStyle.fontBold,fontItalic:this.props.config.headingLabelStyle.fontItalic,fontUnderline:this.props.config.headingLabelStyle.fontUnderline,fontStrike:this.props.config.headingLabelStyle.fontStrike,fontColor:this.props.config.headingLabelStyle.fontColor,fontSize:this.props.config.headingLabelStyle.fontSize},showInputAddress:this.props.config.showInputAddress};this.props.onSearchSettingsUpdated("searchSettings",t,!0)},this.onDistanceUnitChange=e=>{const t=((e,t)=>{const s=v(t);return e>s?s:e})(this.props.config.bufferDistance,e.target.value),s={headingLabel:this.props.config.headingLabel,bufferDistance:t,distanceUnits:e.target.value,showDistanceSettings:this.props.config.showDistanceSettings,sketchTools:{showPoint:this.props.config.sketchTools.showPoint,showPolyline:this.props.config.sketchTools.showPolyline,showPolygon:this.props.config.sketchTools.showPolygon},activeToolWhenWidgetOpens:this.props.config.activeToolWhenWidgetOpens,searchByActiveMapArea:this.props.config.searchByActiveMapArea,includeFeaturesOutsideMapArea:this.props.config.includeFeaturesOutsideMapArea,headingLabelStyle:{fontFamily:this.props.config.headingLabelStyle.fontFamily,fontBold:this.props.config.headingLabelStyle.fontBold,fontItalic:this.props.config.headingLabelStyle.fontItalic,fontUnderline:this.props.config.headingLabelStyle.fontUnderline,fontStrike:this.props.config.headingLabelStyle.fontStrike,fontColor:this.props.config.headingLabelStyle.fontColor,fontSize:this.props.config.headingLabelStyle.fontSize},showInputAddress:this.props.config.showInputAddress};this.props.onSearchSettingsUpdated("searchSettings",s,!0)},this.onBufferDistanceChange=e=>{this.props.onSearchSettingsUpdated("bufferDistance",null!=e?e:1)},this.handleSearchByChange=e=>{let t="";t=e?this.props.config.includeFeaturesOutsideMapArea?this.nls("disabledDefineSearchAreaLabel"):this.nls("currentMapAreaLabel"):this.nls("locationLabel");const s={headingLabel:t,bufferDistance:this.props.config.bufferDistance,distanceUnits:this.props.config.distanceUnits,showDistanceSettings:this.props.config.showDistanceSettings,sketchTools:{showPoint:this.props.config.sketchTools.showPoint,showPolyline:this.props.config.sketchTools.showPolyline,showPolygon:this.props.config.sketchTools.showPolygon},activeToolWhenWidgetOpens:this.props.config.activeToolWhenWidgetOpens,searchByActiveMapArea:e,includeFeaturesOutsideMapArea:this.props.config.includeFeaturesOutsideMapArea,headingLabelStyle:{fontFamily:this.props.config.headingLabelStyle.fontFamily,fontBold:this.props.config.headingLabelStyle.fontBold,fontItalic:this.props.config.headingLabelStyle.fontItalic,fontUnderline:this.props.config.headingLabelStyle.fontUnderline,fontStrike:this.props.config.headingLabelStyle.fontStrike,fontColor:this.props.config.headingLabelStyle.fontColor,fontSize:this.props.config.headingLabelStyle.fontSize},showInputAddress:this.props.config.showInputAddress};this.props.onSearchSettingsUpdated("searchSettings",s,!0)},this.onToggleInputs=()=>{this.setState({isInputSettingOpen:!this.state.isInputSettingOpen})},this.onShowDistanceSettingsChange=e=>{this.props.onSearchSettingsUpdated("showDistanceSettings",e.target.checked)},this.sketchToolsObj=(e,t,s)=>{const i={showPoint:e,showPolyline:t,showPolygon:s};let a=this.props.config.activeToolWhenWidgetOpens;(!e&&"point"===this.state.activeTool||!t&&"polyline"===this.state.activeTool||!s&&"polygon"===this.state.activeTool)&&(this.setState({activeTool:"none"}),a="none");const o={headingLabel:this.props.config.headingLabel,bufferDistance:this.props.config.bufferDistance,distanceUnits:this.props.config.distanceUnits,showDistanceSettings:this.props.config.showDistanceSettings,sketchTools:i,activeToolWhenWidgetOpens:a,searchByActiveMapArea:this.props.config.searchByActiveMapArea,includeFeaturesOutsideMapArea:this.props.config.includeFeaturesOutsideMapArea,headingLabelStyle:{fontFamily:this.props.config.headingLabelStyle.fontFamily,fontBold:this.props.config.headingLabelStyle.fontBold,fontItalic:this.props.config.headingLabelStyle.fontItalic,fontUnderline:this.props.config.headingLabelStyle.fontUnderline,fontStrike:this.props.config.headingLabelStyle.fontStrike,fontColor:this.props.config.headingLabelStyle.fontColor,fontSize:this.props.config.headingLabelStyle.fontSize},showInputAddress:this.props.config.showInputAddress};this.props.onSearchSettingsUpdated("searchSettings",o,!0)},this.showSketchTools=e=>{e.target.title===this.nls("point")&&this.setState({showPoint:e.target.checked},()=>{const e=this.state.onWidgetLoadOptions;let t;const s=[];this.state.onWidgetLoadOptions.forEach(e=>{s.push(e.value)}),this.state.showPoint&&!s.includes("point")&&e.push({value:"point",name:this.nls("point")}),this.state.showPoint||(t=e.filter(e=>"point"!==e.value)),this.setState({onWidgetLoadOptions:t||e}),this.sketchToolsObj(this.state.showPoint,this.state.showPolyline,this.state.showPolygon)}),e.target.title===this.nls("polyline")&&this.setState({showPolyline:e.target.checked},()=>{const e=this.state.onWidgetLoadOptions;let t;const s=[];this.state.onWidgetLoadOptions.forEach(e=>{s.push(e.value)}),this.state.showPolyline&&!s.includes("polyline")&&e.push({value:"polyline",name:this.nls("polyline")}),this.state.showPolyline||(t=e.filter(e=>"polyline"!==e.value)),this.setState({onWidgetLoadOptions:t||e}),this.sketchToolsObj(this.state.showPoint,this.state.showPolyline,this.state.showPolygon)}),e.target.title===this.nls("polygon")&&this.setState({showPolygon:e.target.checked},()=>{const e=this.state.onWidgetLoadOptions;let t;const s=[];this.state.onWidgetLoadOptions.forEach(e=>{s.push(e.value)}),this.state.showPolygon&&!s.includes("polygon")&&e.push({value:"polygon",name:this.nls("polygon")}),!this.state.showPolygon&&"polygon"===this.state.activeTool&&this.setState({activeTool:"none"}),this.state.showPolygon||(t=e.filter(e=>"polygon"!==e.value)),this.setState({onWidgetLoadOptions:t||e}),this.sketchToolsObj(this.state.showPoint,this.state.showPolyline,this.state.showPolygon)})},this.onActiveToolChange=e=>{this.setState({activeTool:e.target.value}),this.props.onSearchSettingsUpdated("activeToolWhenWidgetOpens",e.target.value)},this.onShowInputAddressSettingsChange=e=>{this.props.onSearchSettingsUpdated("showInputAddress",e.target.checked)},this.props.config&&(this.state={showPoint:null===(t=this.props.config.sketchTools)||void 0===t?void 0:t.showPoint,showPolyline:null===(s=this.props.config.sketchTools)||void 0===s?void 0:s.showPolyline,showPolygon:null===(i=this.props.config.sketchTools)||void 0===i?void 0:i.showPolygon,activeTool:this.props.config.activeToolWhenWidgetOpens?this.props.config.activeToolWhenWidgetOpens:"none",onWidgetLoadOptions:this.props.onWidgetLoadOptions,isInputSettingOpen:!1})}render(){return(0,e.jsx)("div",{css:(i=this.props.theme,t.css`
    .cursor-pointer {
      cursor: pointer;
    }

    .switchLabelWidth {
      width: calc(100% - 28px);
    }

    .nm-divider-top {
      border-top: 1px solid var(--ref-palette-neutral-700)
    }

    .color-label {
      color: ${i.ref.palette.neutral[900]};
    }

    .onlyShowResultsLabel {
      width: calc(100% - 52px);
    }
  `),style:{height:"100%",width:"100%"},children:(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsxs)(a.Label,{className:"m-0",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("searchByActiveMapArea"),className:"cursor-pointer",value:"searchByActiveMapArea",onChange:()=>{this.handleSearchByChange(!0)},checked:this.props.config.searchByActiveMapArea,"data-testid":"searchByActiveMapArea"}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{!this.props.config.searchByActiveMapArea&&this.handleSearchByChange(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!0)},children:this.nls("searchByActiveMapArea")})]})}),(0,e.jsx)(s.SettingRow,{className:"mt-2",flow:"wrap",children:(0,e.jsxs)(a.Label,{className:"m-0",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("searchByLocation"),className:"cursor-pointer",value:"searchByLocation",onChange:()=>{this.handleSearchByChange(!1)},checked:!this.props.config.searchByActiveMapArea,"data-testid":"searchByLocation"}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.props.config.searchByActiveMapArea&&this.handleSearchByChange(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!1)},children:this.nls("searchByLocation")})]})}),(0,e.jsxs)(s.SettingRow,{className:"ml-2",flow:"wrap",children:[(0,e.jsx)(a.Label,{"aria-label":this.nls("headingLabel"),title:this.nls("headingLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("headingLabel")})}),(0,e.jsx)(P,{intl:this.props.intl,theme:this.props.theme,hintMessage:this.props.config.headingLabel,noResultFound:"noResultFound",textStyle:this.props.config.headingLabelStyle,onTextMessageChange:this.onHeadingLabelChange,onTextFormatChange:this.updateOnHeadingStyleChange})]}),this.props.config.searchByActiveMapArea&&(0,e.jsx)(s.SettingRow,{tag:"label",className:"ml-2",label:this.nls("featuresOutsideMapArea"),children:(0,e.jsx)(a.Switch,{role:"switch",title:this.nls("featuresOutsideMapArea"),checked:this.props.config.includeFeaturesOutsideMapArea,onChange:this.onIncludeFeaturesMapAreaToggleChange,"data-testid":"featuresOutsideMapArea"})}),this.props.config.includeFeaturesOutsideMapArea&&this.props.config.searchByActiveMapArea&&(0,e.jsx)(s.SettingRow,{className:"ml-2",children:(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("searchAreaHint"),className:"font-italic w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default","data-testid":"searchAreaHint",children:this.nls("searchAreaHint")})})}),!this.props.config.searchByActiveMapArea&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingRow,{className:"mt-4 ml-2",flow:"wrap",children:[(0,e.jsx)(a.Label,{title:this.nls("bufferDistance"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("bufferDistance")})}),(0,e.jsx)(a.NumericInput,{"aria-label":this.nls("bufferDistance"),style:{width:"240px"},size:"sm",min:0,max:v(""!==this.props.config.distanceUnits?this.props.config.distanceUnits:C()),value:this.props.config.bufferDistance,onChange:this.onBufferDistanceChange,"data-testid":"bufferDistance"})]}),(0,e.jsxs)(s.SettingRow,{className:"ml-2",flow:"wrap",children:[(0,e.jsx)(a.Label,{title:this.nls("distanceUnits"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("distanceUnits")})}),(0,e.jsx)(a.Select,{style:{marginBottom:"1px"},"aria-label":this.nls("distanceUnits")+" "+this.props.config.distanceUnits!=""?this.props.config.distanceUnits:C(),size:"sm",value:""!==this.props.config.distanceUnits?this.props.config.distanceUnits:C(),onChange:e=>{this.onDistanceUnitChange(e)},"data-testid":"distanceUnits",children:U.map((t,s)=>(0,e.jsx)(a.Option,{role:"option",tabIndex:0,"aria-label":t.label,value:t.value,children:this.nls(t.value)},s))})]}),(0,e.jsx)(s.SettingRow,{className:"border-top pt-3",children:(0,e.jsx)(a.CollapsablePanel,{label:this.nls("inputsCollapsible"),isOpen:this.state.isInputSettingOpen,onRequestOpen:()=>{this.onToggleInputs()},onRequestClose:()=>{this.onToggleInputs()},children:(0,e.jsxs)("div",{style:{height:"100%",marginTop:10},children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsxs)(a.Label,{check:!0,centric:!0,style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("showDistanceSettings"),style:{cursor:"pointer"},className:"mr-2",checked:this.props.config.showDistanceSettings,onChange:this.onShowDistanceSettingsChange.bind(this)}),this.nls("showDistanceSettings")]})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsxs)(a.Label,{check:!0,centric:!0,style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("inputAddress"),style:{cursor:"pointer"},className:"mr-2",checked:this.props.config.showInputAddress,onChange:this.onShowInputAddressSettingsChange.bind(this)}),this.nls("inputAddress")]})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.Label,{title:this.nls("showSketchTools"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1",children:this.nls("showSketchTools")})})}),(0,e.jsxs)(s.SettingRow,{className:"mt-2 mx-2",children:[(0,e.jsx)(te,{size:"m"}),(0,e.jsxs)(a.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"},children:[this.nls("point"),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("point"),title:this.nls("point"),checked:this.state.showPoint,onChange:this.showSketchTools})]})]}),(0,e.jsxs)(s.SettingRow,{className:"mt-1 mx-2",children:[(0,e.jsx)(oe,{size:"m"}),(0,e.jsxs)(a.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"},children:[this.nls("polyline"),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("polyline"),title:this.nls("polyline"),checked:this.state.showPolyline,onChange:this.showSketchTools})]})]}),(0,e.jsxs)(s.SettingRow,{className:"mt-1 mx-2",children:[(0,e.jsx)(de,{size:"m"}),(0,e.jsxs)(a.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"},children:[this.nls("polygon"),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("polygon"),title:this.nls("polygon"),checked:this.state.showPolygon,onChange:this.showSketchTools})]})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("activateToolOnLoadLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break",children:this.nls("activateToolOnLoadLabel")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("activateToolOnLoadTooltip"),title:this.nls("activateToolOnLoadTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-2 d-inline",children:(0,e.jsx)(M,{})})})]}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.Select,{"aria-label":this.nls("activateToolOnLoadLabel"),className:"selectOption",size:"sm",name:"activateToolOnLoad",value:this.state.activeTool,onChange:this.onActiveToolChange,children:this.state.onWidgetLoadOptions.map((t,s)=>(0,e.jsx)(a.Option,{role:"option","aria-label":this.nls(t.value),value:t.value,children:this.nls(t.value)},s))})})]})})})]})]})});var i}}var pe=m(62838),ce=m.n(pe),ue=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const ye=s=>{const i=window.SVG,{className:a}=s,o=ue(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:ce()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};var ge=m(98640),me=m(28996),Se=m.n(me),fe=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const be=s=>{const i=window.SVG,{className:a}=s,o=fe(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:Se()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};class ve extends t.React.PureComponent{constructor(s){super(s),this.analysisSettingPopperTrigger=t.React.createRef(),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{1===this.state.addedLayerAnalysis.length&&this.setState({selectedAnalysis:this.props.addedLayerAnalysis.length-1})},this.componentDidUpdate=e=>{var t,s,i,a;(null===(t=null==e?void 0:e.addedLayerAnalysis)||void 0===t?void 0:t.length)!==(null===(i=null===(s=this.props)||void 0===s?void 0:s.addedLayerAnalysis)||void 0===i?void 0:i.length)&&this.setState({addedLayerAnalysis:this.props.addedLayerAnalysis,selectedAnalysis:this.props.addedLayerAnalysis.length-1}),(null==e?void 0:e.addedLayerAnalysis)!==(null===(a=this.props)||void 0===a?void 0:a.addedLayerAnalysis)&&this.setState({addedLayerAnalysis:this.props.addedLayerAnalysis})},this.onAnalysisOrderChanged=e=>{let t=-1;this.props.editCurrentLayer&&(t=e.findIndex(e=>{var t;return(null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===this.props.editCurrentLayer.analysisType}),this.setState({selectedAnalysis:t})),this.setState({addedLayerAnalysis:e},()=>{this.props.onLayersInfoSettingsUpdated(this.state.addedLayerAnalysis,this.props.analysisIndex,this.props.editCurrentLayer.layerDsId,this.props.editCurrentLayer.analysisType)})},this.onEditAction=(e,t,s)=>{this.props.onEditAction(!0,e,t,s),this.state.addedLayerAnalysis.some((e,t)=>s===t&&(this.setState({selectedAnalysis:s}),!0))},this.onRemoveAction=(e,t,s,i)=>{e.stopPropagation();const a=this.state.addedLayerAnalysis;a.splice(i,1);let o=-1;this.props.editCurrentLayer&&(o=a.findIndex(e=>e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===this.props.editCurrentLayer.analysisType),this.setState({selectedAnalysis:o})),this.setState({addedLayerAnalysis:a},()=>{this.props.onDeleteAction(this.state.addedLayerAnalysis,t,s,o)})},this.createAnalysisItem=(s,i)=>{var o,l;return(0,e.jsxs)("div",{className:(0,t.classNames)("flex-grow-1 analysis-item cursor-pointer"),children:[(0,e.jsxs)("div",{className:"d-flex w-100 justify-content-between align-items-center",children:[(0,e.jsx)("div",{className:"layer-analysis-name text-truncate",title:s.label,children:s.label}),this.props.isActiveMapAreaSelected&&s.analysisInfo.analysisType===h.Closest&&(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("warningMsgIfActiveMapArea"),title:this.nls("warningMsgIfActiveMapArea"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(be,{color:"var(--sys-color-warning-dark)"})})}),(0,e.jsx)(a.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),type:"tertiary",size:"sm",icon:!0,onClick:e=>{this.onRemoveAction(e,s.useDataSource.dataSourceId,s.analysisInfo.analysisType,i)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onRemoveAction(e,s.useDataSource.dataSourceId,s.analysisInfo.analysisType,i)},children:(0,e.jsx)(ye,{size:"s",className:"p-0"})})]}),(0,e.jsx)("div",{className:"hint-paper d-flex align-items-center analysis-type-name",children:(0,e.jsx)("div",{className:"w-100 text-truncate",title:this.nls(null===(o=null==s?void 0:s.analysisInfo)||void 0===o?void 0:o.analysisType),children:this.nls(null===(l=null==s?void 0:s.analysisInfo)||void 0===l?void 0:l.analysisType)})})]},i)},this.getLayersInfoList=()=>{var t;return(0,e.jsx)("div",{className:"nearme-analysis-list-items",children:(0,e.jsx)(ge.List,{itemsJson:null===(t=Array.from(this.state.addedLayerAnalysis?this.state.addedLayerAnalysis:null))||void 0===t?void 0:t.map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:this.props.showEditAnalysisPopper&&this.state.selectedAnalysis===t})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map(e=>e.itemStateDetailContent);this.onAnalysisOrderChanged(a)},onClickItemBody:(e,t)=>{var s;const{itemJsons:i}=t.props,a=i[0],o=i[1],l=a.itemStateDetailContent;this.onEditAction(null===(s=null==l?void 0:l.useDataSource)||void 0===s?void 0:s.dataSourceId,l.analysisInfo.analysisType,o.indexOf(a))},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:ge.TreeItemActionType.RenderOverrideItem,children:[{name:ge.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:ge.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:ge.TreeItemActionType.RenderOverrideItemBody,children:[{name:ge.TreeItemActionType.RenderOverrideItemDragHandle},{name:ge.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createAnalysisItem(i.itemStateDetailContent,a.indexOf(i))}})})},this.state={selectedAnalysis:this.props.analysisIndex?this.props.analysisIndex:-1,addedLayerAnalysis:this.props.addedLayerAnalysis}}render(){return(0,e.jsx)(t.React.Fragment,{children:this.getLayersInfoList()})}}var xe=m(12046),Fe=m.n(xe),Ce=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const we=s=>{const i=window.SVG,{className:a}=s,o=Ce(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:Fe()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};var Ie=m(93303),Le=m.n(Ie),Ae=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const je=s=>{const i=window.SVG,{className:a}=s,o=Ae(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:Le()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};var De=m(37568),Oe=m.n(De),Te=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Me=s=>{const i=window.SVG,{className:a}=s,o=Te(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:Oe()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};class ke extends t.React.PureComponent{constructor(){super(...arguments),this.backRef=t.React.createRef(),this.nls=e=>{var s;const i=Object.assign({},l,a.defaultMessages,t.defaultMessages);return(null===(s=this.props.intl)||void 0===s?void 0:s.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:i[e]}):i[e]},this.backRefFocus=()=>{setTimeout(()=>{var e;(0,t.focusElementInKeyboardMode)(null===(e=this.backRef)||void 0===e?void 0:e.current)},50)},this.onOkButtonClick=()=>{this.props.onOkButtonClicked()}}getStyle(e){var s,i;return t.css`
      .setting-header {
        padding: ${t.polished.rem(18)} ${t.polished.rem(16)} ${t.polished.rem(0)} ${t.polished.rem(16)}
      }

      .setting-title {
        font-size: ${t.polished.rem(16)};
        color: ${null===(i=null===(s=null==e?void 0:e.ref.palette)||void 0===s?void 0:s.neutral)||void 0===i?void 0:i[1e3]}
      }

      .commonOkButton {
        padding: 9px 17px 0px 17px;
      }

      .hideCursorPointer {
        cursor: default;
      }
    `}render(){return(0,e.jsxs)("div",{tabIndex:-1,className:"w-100 h-100",css:this.getStyle(this.props.theme),children:[(0,e.jsxs)("div",{tabIndex:-1,className:"w-100 d-flex align-items-center justify-content-between setting-header border-0",style:{height:"38px",marginBottom:"20px"},children:[this.props.hideBackArrow?(0,e.jsx)("div",{"aria-label":this.props.title,className:"setting-title mt-1",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title,children:this.props.title}):(0,e.jsx)("div",{tabIndex:-1,className:"h-100",children:(0,e.jsxs)("div",{ref:this.backRef,tabIndex:0,className:"d-flex align-items-center h-100",style:{cursor:"pointer"},onClick:this.props.onBack,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.props.onBack()},children:[(0,e.jsx)("div",{className:"d-flex align-items-center",title:this.nls("back"),"aria-label":this.nls("back"),children:(0,e.jsx)(Me,{autoFlip:!0,size:"14",className:"text-default"})}),(0,e.jsx)("div",{"aria-label":this.props.title,className:"pl-2 setting-title",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title,children:this.props.title})]})}),this.props.showCloseIcon&&(0,e.jsx)(a.Button,{role:"button","aria-label":this.props.title+" "+this.nls("close"),title:this.nls("close"),size:"sm",icon:!0,type:"tertiary",onClick:this.props.onBack,children:(0,e.jsx)(ye,{autoFlip:!0,size:"14",className:"text-default"})})]}),this.props.children,this.props.showOkButton&&(0,e.jsx)("div",{className:"commonOkButton",children:(0,e.jsx)(a.Button,{role:"button",className:(0,t.classNames)("w-100 text-dark",this.props.disableOkButton?"hideCursorPointer":""),type:"primary",disabled:this.props.disableOkButton,onClick:this.onOkButtonClick.bind(this),children:this.nls("commonModalOk")})})]})}}const Ne=t.css`
  padding: 12px 0px;
  .jimu-dropdown-item {
    padding: 4px 16px !important;
    &:hover {
      background-color: var(--ref-palette-neutral-500) !important;
    }
  }
`,Re=t.css`
  display: flex;
  width: 100%;
  > .color-item {
    width: 30px;
    height: 16px;
  }
`;class Pe extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.setState({colorUpdate:this.getFieldsColor()})},this.componentDidUpdate=e=>{if(e.summaryFieldsInfo!==this.props.summaryFieldsInfo){const e=Object.assign({},this.state.colorUpdate);this.props.summaryFieldsInfo.forEach((t,s)=>{e[t.fieldLabel+"_"+s]={_fieldLabel:t.fieldLabel,_fillColor:t.fieldColor}}),this.setState({colorUpdate:e})}},this.getFieldsColor=()=>{const e={};return this.props.summaryFieldsInfo.forEach((t,s)=>{e[t.fieldLabel+"_"+s]={_fieldLabel:t.fieldLabel,_fillColor:t.fieldColor===J?this.state.colorStrip[s%this.state.colorStrip.length]:t.fieldColor}}),e},this.onStripColorChange=(e,s)=>{e.stopPropagation();const i=((e,s)=>{if(!s)return;let i=(0,t.Immutable)({});return Object.entries(e).forEach(([e,t],a)=>{const o=g(s,a),l=Object.assign({},t);l._fillColor=o,i=i.set(e,l)}),i})(this.state.colorUpdate,s);this.setState({colorUpdate:i,colorStrip:s},()=>{this.props.updateFieldColorsValues(i,s)})},this.onIndividualFieldColorChange=(e,t)=>{const s=Object.assign({},this.state.colorUpdate);s[e]={_fillColor:t},this.setState({colorUpdate:s},()=>{this.props.updateFieldColorsValues(s,this.state.colorStrip)})},this.state={colorUpdate:null,colorStrip:this.props.colorstripValue?this.props.colorstripValue:Z}}render(){var t;return(0,e.jsxs)("div",{style:{width:"100%",overflow:"auto"},css:d,children:[(0,e.jsx)("div",{className:"color-list pt-1 px-4",children:this.state.colorUpdate&&(null===(t=Object.entries(this.state.colorUpdate))||void 0===t?void 0:t.map(([t,s],i)=>{const o=s;return(0,e.jsx)("div",{className:"mb-2 colorItemStyle",children:(0,e.jsxs)(a.Label,{check:!0,children:[(0,e.jsx)("span",{className:"label text-truncate",title:o._fieldLabel,children:o._fieldLabel}),(0,e.jsx)(j.ThemeColorPicker,{"aria-label":o._fieldLabel,specificTheme:(0,k.getTheme2)(),value:o._fillColor,onChange:e=>{this.onIndividualFieldColorChange(t,e)}})]})},i)}))}),(0,e.jsx)("div",{className:"footer",children:(0,e.jsx)("div",{className:"px-4",style:{marginTop:"14px"},children:(0,e.jsxs)(a.Dropdown,{className:"w-100",children:[(0,e.jsx)(a.DropdownButton,{size:"sm",title:this.nls("applyColors"),children:this.nls("applyColors")}),(0,e.jsx)(a.DropdownMenu,{showArrow:!0,css:Ne,children:(0,e.jsx)("div",{tabIndex:0,children:Y.map((t,s)=>(0,e.jsx)(a.DropdownItem,{tabIndex:0,className:"my-1",onClick:e=>{var s;null===(s=this.onStripColorChange)||void 0===s||s.call(this,e,t)},onKeyDown:e=>{var s;"Enter"!==e.key&&" "!==e.key||null===(s=this.onStripColorChange)||void 0===s||s.call(this,e,t)},children:(0,e.jsx)("div",{tabIndex:0,"aria-label":this.nls("colorStrip")+s,css:Re,children:t.map((t,s)=>(0,e.jsx)("div",{className:"color-item",style:{backgroundColor:t}},s))})},s))})})]})})})]})}}var Be=m(13089),Ee=m(14962),Ge=m.n(Ee),Ve=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Ue=s=>{const i=window.SVG,{className:a}=s,o=Ve(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:Ge()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};var We=m(54578),ze=m.n(We),Je=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const _e=s=>{const i=window.SVG,{className:a}=s,o=Je(s,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",a);return i?(0,e.jsx)(i,Object.assign({className:l,src:ze()},o)):(0,e.jsx)("svg",Object.assign({className:l},o))};var Ke=m(84845);class He extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.handleExpressionChange=e=>{null!=e&&(e.parts.forEach(e=>{var t;e.dataSourceId&&(e.dataSourceId=null===(t=this.state.useDataSource)||void 0===t?void 0:t[0].dataSourceId)}),this.setState({updatedFieldExpression:e}),this.updateSummaryField(e.name,e))},this.updateSummaryField=(e,t)=>{const s={fieldLabel:e,selectedExpression:t};this.props.expressionInfoUpdate(s)};const t=this.props.layersInfos.filter(e=>e.useDataSource.dataSourceId===this.props.currentLayerDsId.layerDsId);this.state={useDataSource:[t[0].useDataSource],updatedFieldExpression:null!==this.props.fieldsEditIndex?this.props.editingField.summaryFieldInfo:null}}render(){var s;return(0,e.jsx)(Ke.ExpressionBuilder,{className:"p-2",css:(this.props.theme,t.css`
    .component-main-data-and-view {
      display: none;
    }

    .component-expression-builder .expression-editor-helper {
      height: calc(100% - 25px)!important;
    }

    .component-expression-builder .statistics-tab div {
      padding-top: 0px!important;
    }

    .expression-editor-container div {
      padding: 0px!important;
    }

    .component-expression-editor .exp-editor-helper-tab {
      margin-left: 0px!important;
      margin-right: 0px!important;
    }

    .component-field-selector .item-selector-search {
      margin-top: 18px!important;
    }
  `),fieldTypes:(0,t.Immutable)([t.JimuFieldType.Number]),widgetId:this.props.widgetId,types:(0,t.Immutable)([Ke.ExpressionBuilderType.Statistics,Ke.ExpressionBuilderType.Expression]),useDataSources:(0,t.Immutable)([null===(s=this.state.useDataSource)||void 0===s?void 0:s[0]]),expression:this.state.updatedFieldExpression,onChange:this.handleExpressionChange})}}class $e extends t.React.PureComponent{constructor(e){var t,s,i,o;super(e),this.nls=e=>{var t;const s=Object.assign({},l,a.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onFieldLabelChange=e=>{const t=e.target.value;this.setState({summaryFieldLabel:t})},this.onFieldLabelAcceptValue=e=>{this.setState({summaryFieldLabel:e.trim()})},this.onOkButtonClicked=()=>{""!==this.state.summaryFieldLabel&&(this.setState({isEditSummaryPopperActive:!1}),this.props.onOkClick(this.state.summaryFieldLabel,this.state.showThousandSeparator,this.state.formattingOptions,this.state.significantDigit),this.props.onClose())},this.onCancelButtonClicked=()=>{this.setState({isEditSummaryPopperActive:!1}),this.props.onClose()},this.onSeparatorChange=e=>{this.setState({showThousandSeparator:e.target.checked})},this.handleFormattingChange=e=>{this.setState({formattingOptions:e.target.value}),e.target.value!==H.Round&&e.target.value!==H.Truncate||this.setState({significantDigit:2})},this.onDigitsChange=e=>{const t=Math.floor(e);this.setState({significantDigit:t})},this.state={isEditSummaryPopperActive:this.props.isOpen,showThousandSeparator:null===(t=this.props.editSummaryFields.summaryFieldInfo)||void 0===t?void 0:t.showSeparator,summaryFieldLabel:null===(s=this.props.editSummaryFields)||void 0===s?void 0:s.fieldLabel,formattingOptions:null===(i=this.props.editSummaryFields.summaryFieldInfo)||void 0===i?void 0:i.numberFormattingOption,significantDigit:null===(o=this.props.editSummaryFields.summaryFieldInfo)||void 0===o?void 0:o.significantDigits}}render(){const s=t.css`
      .hidden{
        display: none;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .separatorSwitch {
        margin-left: 130px;
      }

      .modal-content  {
        background: var(--ref-palette-neutral-400);
      }

      .invalid-value {
        border: 1px solid  ${this.props.theme.sys.color.error.main};
        box-shadow: 0 0 5px  ${this.props.theme.sys.color.error.main};
      }
    `;return(0,e.jsx)("div",{children:(0,e.jsx)(a.AlertPopup,{css:s,"aria-expanded":this.state.isEditSummaryPopperActive,isOpen:this.state.isEditSummaryPopperActive,onClickOk:this.onOkButtonClicked.bind(this),onClickClose:this.onCancelButtonClicked.bind(this),title:this.props.sumOfIntersectedFieldPopupTitle,children:(0,e.jsx)("table",{cellPadding:10,children:(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(a.Label,{className:"mt-2",children:this.nls("label")})}),(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(a.TextInput,{role:"textbox","aria-label":this.nls("label")+this.state.summaryFieldLabel,size:"sm",title:this.state.summaryFieldLabel,className:""===this.state.summaryFieldLabel?"invalid-value":"",value:this.state.summaryFieldLabel,onAcceptValue:this.onFieldLabelAcceptValue,onChange:this.onFieldLabelChange})})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(a.Label,{className:"mt-2",children:this.nls("showSeparator")})}),(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(a.Switch,{className:"separatorSwitch",role:"switch","aria-label":this.nls("showSeparator"),title:this.nls("showSeparator"),checked:this.state.showThousandSeparator,onChange:this.onSeparatorChange})})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsxs)(a.Label,{className:"m-0",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("noFormatting"),className:"cursor-pointer",value:"noFormatting",onChange:e=>{this.handleFormattingChange(e)},checked:"noFormatting"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",children:this.nls("noFormatting")})]})}),(0,e.jsx)("td",{children:(0,e.jsxs)(a.Label,{className:"m-0",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("round"),className:"cursor-pointer",value:"round",onChange:e=>{this.handleFormattingChange(e)},checked:"round"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",children:this.nls("round")})]})}),(0,e.jsx)("td",{children:(0,e.jsxs)(a.Label,{className:"m-0",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("truncate"),className:"cursor-pointer",value:"truncate",onChange:e=>{this.handleFormattingChange(e)},checked:"truncate"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",children:this.nls("truncate")})]})})]}),"noFormatting"!==this.state.formattingOptions&&(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{tabIndex:0,"aria-label":this.nls("significantDigitsLabel"),children:(0,e.jsx)(a.Label,{children:this.nls("significantDigitsLabel")})}),(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(a.NumericInput,{"aria-label":this.nls("significantDigitsLabel"),className:"significantDigitsLabel",size:"sm",min:0,max:10,defaultValue:this.state.significantDigit,value:this.state.significantDigit,onChange:this.onDigitsChange})})]})]})})})})}}const qe=m(27931);let Ze=[];class Ye extends t.React.PureComponent{constructor(i){super(i),this.supportedDsTypes=(0,t.Immutable)([t.DataSourceTypes.FeatureLayer,t.DataSourceTypes.SubtypeSublayer]),this.items=[],this.backRef=t.React.createRef(),this.colorSidePopperTrigger=t.React.createRef(),this.colorButtonRef=t.React.createRef(),this.addSummaryFieldsRef=t.React.createRef(),this.summaryFieldsSidePopperTrigger=t.React.createRef(),this.allSelectedLayers=[],this.defaultSelectedItem={name:""},this.nls=e=>{var t;const s=Object.assign({},l,a.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.props.availableFeatureLayer.forEach((e,t)=>{this.getLayerListProperty(e.id)}),this.setState({selectedLayers:this.allSelectedLayers}),this.editValueUpdate(!1)},this.getLayerListProperty=e=>{const t=f(e);if(t){const e={label:t.getLabel(),layer:{layerDsId:t.id}};this.allSelectedLayers.push(e)}},this.componentDidUpdate=(e,s)=>{this.props.editCurrentLayer.layerDsId===e.editCurrentLayer.layerDsId&&this.props.analysisIndex===e.analysisIndex&&t.lodash.isDeepEqual(this.props.analysisList,e.analysisList)||this.editValueUpdate(!1),t.lodash.isDeepEqual(this.state.analysisListSettings,s.analysisListSettings)||this.editValueUpdate(!0)},this.intersectedAreaLengthField=(e,t)=>(e.push({fieldLabel:t.fieldLabel,fieldColor:t.fieldColor,summaryFieldInfo:{summaryBy:t.summaryFieldInfo.summaryBy,showSeparator:t.summaryFieldInfo.showSeparator,numberFormattingOption:t.summaryFieldInfo.numberFormattingOption,significantDigits:t.summaryFieldInfo.significantDigits}}),e),this.setSummaryValues=e=>{let t=[];e.summaryFields.forEach(e=>{var s,i;this.setState({singleColorFields:e.fieldColor}),(null===(s=e.summaryFieldInfo)||void 0===s?void 0:s.summaryBy)===$.SumOfIntersectedArea?(t=this.intersectedAreaLengthField(t,e),this.setState({sumOfAreaLabel:e.fieldLabel,sumOfArea:!0,intersectedSummaryFieldList:t})):(null===(i=e.summaryFieldInfo)||void 0===i?void 0:i.summaryBy)===$.SumOfIntersectedLength?(t=this.intersectedAreaLengthField(t,e),this.setState({sumOfLengthLabel:e.fieldLabel,sumOfLength:!0,intersectedSummaryFieldList:t})):Ze.push({fieldLabel:e.fieldLabel,fieldColor:e.fieldColor,summaryFieldInfo:e.summaryFieldInfo})})},this.editValueUpdate=e=>{Ze=[],this.getFieldsDs(this.props.editCurrentLayer.layerDsId);(e?this.state.analysisListSettings:this.props.analysisList).forEach((e,t)=>{var s,i,a,o,l,n;const r=e.analysisInfo,d=f(null===(s=e.useDataSource)||void 0===s?void 0:s.dataSourceId);if((null===(i=null==e?void 0:e.useDataSource)||void 0===i?void 0:i.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===h.Closest&&this.props.analysisIndex===t)return this.props.disableOkButton(e.analysisInfo.analysisType===h.Closest&&this.props.isActiveMapAreaSelected),this.setState({closestAnalysisType:!0,proximityAnalysisType:!1,summaryAnalysisType:!1,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,highlightResultsOnMap:r.highlightResultsOnMap,highlightColorOnMap:r.highlightColorOnMap,expandOnOpen:r.expandOnOpen,returnIntersectedPolygons:r.returnIntersectedPolygons,fieldsToExport:null==r?void 0:r.fieldsToExport,includeApproxDistance:r.includeApproxDistance,displayFeatureCount:r.displayFeatureCount,clipFeatures:!1}),!0;if((null===(a=e.useDataSource)||void 0===a?void 0:a.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===h.Proximity&&this.props.analysisIndex===t)return this.props.disableOkButton(!1),this.setState({closestAnalysisType:!1,proximityAnalysisType:!0,summaryAnalysisType:!1,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,displayField:r.displayField?[r.displayField]:[F(d)],sortFeaturesByDistance:r.sortFeaturesByDistance,sortFeaturesField:r.sortFeatures.sortFeaturesByField?[r.sortFeatures.sortFeaturesByField]:[],sortFeaturesFieldOrder:r.sortFeatures.sortFeaturesOrder,isGroupFeatures:r.groupFeaturesEnabled,groupFeaturesField:r.groupFeatures.groupFeaturesByField?[r.groupFeatures.groupFeaturesByField]:[],groupFeaturesFieldOrder:r.groupFeatures.groupFeaturesOrder,isSortGroupsByCount:r.groupFeatures.sortGroupsByCount,noValueGroupLabel:r.groupFeatures.noValueGroupLabel,subGroupFeaturesField:r.subGroupFeatures.subGroupFeaturesByField?[r.subGroupFeatures.subGroupFeaturesByField]:[],subGroupFeaturesFieldOrder:r.subGroupFeatures.subGroupFeaturesOrder,isSortSubGroupsByCount:r.subGroupFeatures.sortSubGroupsByCount,noValueSubGroupLabel:r.subGroupFeatures.noValueSubGroupLabel,expandOnOpen:r.expandOnOpen,expandFeatureDetails:r.expandFeatureDetails,returnIntersectedPolygons:r.returnIntersectedPolygons,highlightResultsOnMap:r.highlightResultsOnMap,highlightColorOnMap:r.highlightColorOnMap,fieldsToExport:null==r?void 0:r.fieldsToExport,includeApproxDistance:r.includeApproxDistance,displayFeatureCount:r.displayFeatureCount,clipFeatures:null!==(o=null==r?void 0:r.clipFeatures)&&void 0!==o&&o},()=>{if(this.state.sortFeaturesByDistance&&(this.props.isActiveMapAreaSelected||this.props.isIncludeOutsideMapAreaSelected)){const e=(null==d?void 0:d.getIdField())||"";this.setState({sortFeaturesByDistance:!1,sortFeaturesField:[e]},()=>{this.updateItemValue()})}}),!0;if((null===(l=e.useDataSource)||void 0===l?void 0:l.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===h.Summary&&this.props.analysisIndex===t){this.props.disableOkButton(!1),this.setEditIndex=t;const s=f(this.props.editCurrentLayer.layerDsId);return this.updateSummaryFieldListSettings=r.summaryFields,r.summaryFields.length>0&&this.setSummaryValues(r),this.setState({closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!0,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,singleColorMode:r.isSingleColorMode,colorstripValues:r.selectedColorStrip||Z,singleColorFields:r.summaryFields.length>0?r.singleFieldColor:J,summaryFieldsList:Ze,selectedLayerGeometry:null===(n=null==s?void 0:s.getLayerDefinition())||void 0===n?void 0:n.geometryType,expandOnOpen:r.expandOnOpen,highlightResultsOnMap:r.highlightResultsOnMap,highlightColorOnMap:r.highlightColorOnMap,fieldsToExport:null==r?void 0:r.fieldsToExport,displayFeatureCount:r.displayFeatureCount,clipFeatures:!1}),!0}})},this.updateItemValue=(e,t)=>{let s;this.state.analysisListSettings.some((i,a)=>{var o,l,n,r,d,p;const c=f((null==t?void 0:t.dataSourceId)?null==t?void 0:t.dataSourceId:this.props.editCurrentLayer.layerDsId),u=e&&"layerLabel"in e?e.layerLabel:i.label;if(((null===(o=null==i?void 0:i.useDataSource)||void 0===o?void 0:o.dataSourceId)===(null==t?void 0:t.dataSourceId)||this.props.editCurrentLayer.layerDsId)&&this.state.analysisType===h.Closest&&this.props.analysisIndex===a)return this.setEditIndex=a,s={useDataSource:null!=t?t:i.useDataSource,label:u,analysisInfo:{analysisId:i.analysisInfo.analysisId,analysisType:this.state.analysisType,expandOnOpen:this.state.expandOnOpen,returnIntersectedPolygons:this.state.returnIntersectedPolygons,clipFeatures:!1,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap,fieldsToExport:this.state.fieldsToExport,includeApproxDistance:this.state.includeApproxDistance,displayFeatureCount:this.state.displayFeatureCount}},!0;if(((null===(l=i.useDataSource)||void 0===l?void 0:l.dataSourceId)===(null==t?void 0:t.dataSourceId)||this.props.editCurrentLayer.layerDsId)&&this.state.analysisType===h.Proximity&&this.props.analysisIndex===a){const o=i.analysisInfo,l=e&&"groupLabel"in e?e.groupLabel:(null===(n=o.groupFeatures)||void 0===n?void 0:n.noValueGroupLabel)?o.groupFeatures.noValueGroupLabel:"",h=e&&"subGroupLabel"in e?e.subGroupLabel:(null===(r=o.subGroupFeatures)||void 0===r?void 0:r.noValueSubGroupLabel)?null===(d=o.subGroupFeatures)||void 0===d?void 0:d.noValueSubGroupLabel:"";return this.setEditIndex=a,s={useDataSource:null!=t?t:i.useDataSource,label:u,analysisInfo:{analysisId:i.analysisInfo.analysisId,analysisType:this.state.analysisType,displayField:this.state.displayField.length>0?this.state.displayField[0]:F(c),sortFeaturesByDistance:this.state.sortFeaturesByDistance,sortFeatures:{sortFeaturesByField:this.state.sortFeaturesField.length>0?this.state.sortFeaturesField[0]:"",sortFeaturesOrder:this.state.sortFeaturesFieldOrder},groupFeaturesEnabled:this.state.isGroupFeatures,groupFeatures:{groupFeaturesByField:this.state.groupFeaturesField.length>0?this.state.groupFeaturesField[0]:"",groupFeaturesOrder:this.state.groupFeaturesFieldOrder,sortGroupsByCount:this.state.isSortGroupsByCount,noValueGroupLabel:l},subGroupFeatures:{subGroupFeaturesByField:this.state.subGroupFeaturesField.length>0?this.state.subGroupFeaturesField[0]:"",subGroupFeaturesOrder:this.state.subGroupFeaturesFieldOrder,sortSubGroupsByCount:this.state.isSortSubGroupsByCount,noValueSubGroupLabel:h},expandOnOpen:this.state.expandOnOpen,expandFeatureDetails:this.state.expandFeatureDetails,returnIntersectedPolygons:this.state.returnIntersectedPolygons,clipFeatures:this.state.clipFeatures,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap,fieldsToExport:this.state.fieldsToExport,includeApproxDistance:this.state.includeApproxDistance,displayFeatureCount:this.state.displayFeatureCount}},!0}return!((null===(p=i.useDataSource)||void 0===p?void 0:p.dataSourceId)!==(null==t?void 0:t.dataSourceId)&&!this.props.editCurrentLayer.layerDsId||this.state.analysisType!==h.Summary||this.props.analysisIndex!==a)&&(this.setEditIndex=a,this.updateSummaryFieldListSettings=this.state.summaryFieldsList.concat(this.state.intersectedSummaryFieldList),s={useDataSource:null!=t?t:i.useDataSource,label:u,analysisInfo:{analysisId:i.analysisInfo.analysisId,analysisType:this.state.analysisType,isSingleColorMode:this.state.singleColorMode,singleFieldColor:this.state.singleColorFields,selectedColorStrip:this.state.colorstripValues,summaryFields:this.updateSummaryFieldListSettings,expandOnOpen:this.state.expandOnOpen,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap,fieldsToExport:this.state.fieldsToExport,displayFeatureCount:this.state.displayFeatureCount}},!0)}),this.updateItem(this.setEditIndex,s,(null==t?void 0:t.dataSourceId)||this.props.editCurrentLayer.layerDsId,this.state.analysisType)},this.updateItem=(e,t,s,i)=>{const a=e;if(a>-1){const e=[...this.props.analysisList.slice(0,a),Object.assign({},this.props.analysisList[a],t),...this.props.analysisList.slice(a+1)];this.props.onAnalysisUpdate(e,s,i,a),this.setState({analysisListSettings:e})}},this.onAnalysisTypeChange=e=>{this.props.disableOkButton(!1),e===h.Closest?this.setState({closestAnalysisType:!0,proximityAnalysisType:!1,summaryAnalysisType:!1,expandOnOpen:!0,displayFeatureCount:!0}):e===h.Proximity?this.setState({closestAnalysisType:!1,proximityAnalysisType:!0,summaryAnalysisType:!1,expandOnOpen:!1,expandFeatureDetails:!1,displayFeatureCount:!0}):this.setState({closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!0,expandOnOpen:!1,displayFeatureCount:!0}),this.resetAnalysisValues(this.state.useDataSource),this.setState({analysisType:e},()=>{this.updateItemValue()})},this.onLayerLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({layerLabel:t})}},this.onLayerLabelAcceptValue=e=>{const t={layerLabel:e};this.updateItemValue(t,this.state.useDataSource)},this.handleSortFeaturesOptionsChange=e=>{this.setState({sortFeaturesByDistance:e},()=>{this.updateItemValue()})},this.onDisplayField=e=>{0===e.length?this.setState({displayField:[]},()=>{this.updateItemValue()}):this.setState({displayField:[e[0].jimuName]},()=>{this.updateItemValue()})},this.onSortFieldSelectChange=e=>{0===e.length?this.setState({sortFeaturesField:[]},()=>{this.updateItemValue()}):this.setState({sortFeaturesField:[e[0].jimuName]},()=>{this.updateItemValue()})},this.onGroupFieldSelectChange=e=>{0===e.length?this.setState({groupFeaturesField:[],subGroupFeaturesField:[],subGroupFeaturesFieldOrder:t.OrderRule.Asc,isSortSubGroupsByCount:!1,noValueSubGroupLabel:""},()=>{this.updateItemValue()}):this.setState({groupFeaturesField:[e[0].jimuName]},()=>{this.updateItemValue()})},this.onSubGroupFieldSelectChange=e=>{0===e.length?this.setState({subGroupFeaturesField:[]},()=>{this.updateItemValue()}):this.setState({subGroupFeaturesField:[e[0].jimuName]},()=>{this.updateItemValue()})},this.onConfiguredFieldsChanged=e=>{var t,s,i,a;let o=[];e.length>0&&e.forEach(e=>{o.push(e.jimuName)}),o.length>0&&(null===(t=this.state.fieldsToExport)||void 0===t?void 0:t.includes("esriCTApproxDistance"))?o.push("esriCTApproxDistance"):0===o.length&&(null===(s=this.state.fieldsToExport)||void 0===s?void 0:s.includes("esriCTApproxDistance"))&&(o=this.state.fieldsToExport.filter(e=>"esriCTApproxDistance"===e)),o.length>0&&(null===(i=this.state.fieldsToExport)||void 0===i?void 0:i.includes("esriCTClippedInfo"))?o.push("esriCTClippedInfo"):0===o.length&&(null===(a=this.state.fieldsToExport)||void 0===a?void 0:a.includes("esriCTClippedInfo"))&&(o=this.state.fieldsToExport.filter(e=>"esriCTClippedInfo"===e)),this.setState({fieldsToExport:o},()=>{this.updateItemValue()})},this.expandListOnChange=e=>{!e.target.checked&&this.state.proximityAnalysisType&&this.setState({expandFeatureDetails:!1}),this.setState({expandOnOpen:e.target.checked},()=>{this.updateItemValue()})},this.returnIntersectedPolygonsChanged=e=>{this.setState({returnIntersectedPolygons:e.target.checked},()=>{this.updateItemValue()})},this.clipFeaturesChanged=e=>{let t=[];t=e.target.checked?[...this.state.fieldsToExport,"esriCTClippedInfo"]:this.state.fieldsToExport.filter(e=>"esriCTClippedInfo"!==e),this.setState({clipFeatures:e.target.checked,fieldsToExport:t},()=>{this.updateItemValue()})},this.resetAnalysisValues=e=>{var s;const i=f(e.dataSourceId);this.setState({displayField:[],sortFeaturesByDistance:!0,sortFeaturesField:[],sortFeaturesFieldOrder:t.OrderRule.Asc,isGroupFeatures:!1,groupFeaturesField:[],groupFeaturesFieldOrder:t.OrderRule.Asc,isSortGroupsByCount:!1,noValueGroupLabel:"",subGroupFeaturesField:[],subGroupFeaturesFieldOrder:t.OrderRule.Asc,isSortSubGroupsByCount:!1,noValueSubGroupLabel:"",fieldsToExport:L(e.dataSourceId),includeApproxDistance:!1,selectedLayerGeometry:null===(s=null==i?void 0:i.getLayerDefinition())||void 0===s?void 0:s.geometryType,sumOfLength:!1,sumOfArea:!1,returnIntersectedPolygons:!1,summaryFieldsList:[],intersectedSummaryFieldList:[],sumOfAreaLabel:this.nls("sumOfIntersectedArea"),sumOfLengthLabel:this.nls("sumOfIntersectedLength"),clipFeatures:!1},()=>{const t={layerLabel:this.state.layerLabel,groupLabel:"",subGroupLabel:""};this.updateItemValue(t,e)})},this.onAddSummaryFieldsClick=e=>{e.stopPropagation(),this.setState({isAddNewSummaryField:!0,isNewFieldAdded:!0,summaryEditIndex:null},()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()})},this.editSummaryFields=(e,t,s)=>{e.stopPropagation(),this.setSidePopperAnchor(s),this.setState({isAddNewSummaryField:!0,isNewFieldAdded:!1,summaryEditField:t,summaryEditIndex:s},()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()})},this.setSidePopperAnchor=e=>{const t=this.summaryFieldsSidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:t})},this.deleteSummaryFields=(e,s)=>{let i;e.stopPropagation();const a=this.state.summaryFieldsList.concat(this.state.intersectedSummaryFieldList);a.splice(s,1),(0,t.focusElementInKeyboardMode)(0===a.length?this.addSummaryFieldsRef.current:this.summaryFieldsSidePopperTrigger.current),this.state.analysisListSettings.forEach(e=>{const t=e.analysisInfo;e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===h.Summary&&(i={useDataSource:e.useDataSource,label:e.label,analysisInfo:{analysisId:e.analysisInfo.analysisId,analysisType:e.analysisInfo.analysisType,isSingleColorMode:t.isSingleColorMode,singleFieldColor:t.singleFieldColor,selectedColorStrip:t.selectedColorStrip,summaryFields:a,expandOnOpen:t.expandOnOpen,highlightResultsOnMap:t.highlightResultsOnMap,highlightColorOnMap:t.highlightColorOnMap,fieldsToExport:t.fieldsToExport,displayFeatureCount:t.displayFeatureCount}})}),this.updateItem(this.setEditIndex,i,this.props.editCurrentLayer.layerDsId,this.state.analysisType)},this.editExistingIntersectedSummaryField=(e,t,s,i)=>{let a;this.state.intersectedSummaryFieldList.forEach((o,l)=>{a=this.updateSummaryIntersectedFields(e,t,s,i,o)}),this.state.summaryEditField.summaryFieldInfo.summaryBy===$.SumOfIntersectedArea?this.setState({sumOfAreaLabel:e}):this.state.summaryEditField.summaryFieldInfo.summaryBy===$.SumOfIntersectedLength&&this.setState({sumOfLengthLabel:e}),this.setState({intersectedSummaryFieldList:[...this.state.intersectedSummaryFieldList.slice(0,0),Object.assign({},this.state.intersectedSummaryFieldList[0],a),...this.state.intersectedSummaryFieldList.slice(1)]},()=>{this.updateItemValue()})},this.updateSummaryIntersectedFields=(e,t,s,i,a)=>{let o,l={};return"esriGeometryPolyline"===this.state.selectedLayerGeometry?o=$.SumOfIntersectedLength:"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(o=$.SumOfIntersectedArea),l={fieldLabel:e,fieldColor:a.fieldColor,summaryFieldInfo:{summaryBy:o,showSeparator:t,numberFormattingOption:s,significantDigits:i}},l},this.onOkButtonClick=(e,t,s,i)=>{this.editExistingIntersectedSummaryField(e,t,s,i)},this.createFieldsOptionElement=(s,i)=>(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)("div",{tabIndex:0,"aria-label":s.fieldLabel,className:"text-truncate labelAlign",title:s.fieldLabel,children:s.fieldLabel}),(0,e.jsx)(a.Button,{role:"button","aria-label":s.fieldLabel+this.nls("editExpression"),className:"ml-1",title:this.nls("editExpression"),icon:!0,type:"tertiary",size:"sm",onClick:e=>{this.editSummaryFields(e,s,i)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.editSummaryFields(e,s,i)},children:(0,e.jsx)(we,{size:"s"})}),(0,e.jsx)(a.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),icon:!0,type:"tertiary",size:"sm",onClick:e=>{this.deleteSummaryFields(e,i)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.deleteSummaryFields(e,i)},children:(0,e.jsx)(ye,{size:"s"})})]}),this.onEditPopperClose=()=>{this.setState({editSummaryAreaLengthFieldPopupOpen:!1})},this.updateSortedSummaryFields=e=>{this.setState({summaryFieldsList:e},()=>{this.updateItemValue()})},this.onColorSettingClick=()=>{this.openColorSetting(!0)},this.closeColorSettingsPanel=()=>{this.openColorSetting(!1),this.focusColorSetting()},this.focusColorSetting=()=>{setTimeout(()=>{(0,t.focusElementInKeyboardMode)(this.colorButtonRef.current)},50)},this.openColorSetting=e=>{this.setState({showSummaryColorSettings:e},()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus(),setTimeout(()=>{(0,t.focusElementInKeyboardMode)(this.colorSidePopperTrigger.current)},50)})},this.onUpdateFieldColorByCategory=(e,t,s)=>{var i,a;const o=null===(i=this.state.summaryFieldsList)||void 0===i?void 0:i.map((i,a)=>{var o,l;return Object.assign(Object.assign({},i),{fieldColor:(null===(o=null==e?void 0:e[i.fieldLabel+"_"+a])||void 0===o?void 0:o._fillColor)?null===(l=null==e?void 0:e[i.fieldLabel+"_"+a])||void 0===l?void 0:l._fillColor:s?this.state.colorstripValues[a%this.state.colorstripValues.length]:null==t?void 0:t[a%(null==t?void 0:t.length)]})}),l=null===(a=this.state.intersectedSummaryFieldList)||void 0===a?void 0:a.map((i,a)=>{var o,l;return Object.assign(Object.assign({},i),{fieldColor:(null===(o=null==e?void 0:e[i.fieldLabel+"_"+this.state.summaryFieldsList.length])||void 0===o?void 0:o._fillColor)?null===(l=null==e?void 0:e[i.fieldLabel+"_"+this.state.summaryFieldsList.length])||void 0===l?void 0:l._fillColor:s?this.state.colorstripValues[a%this.state.colorstripValues.length]:null==t?void 0:t[a%(null==t?void 0:t.length)]})});this.setState({summaryFieldsList:o,intersectedSummaryFieldList:l,byCategoryColorFields:e,colorstripValues:t},()=>{this.updateItemValue()})},this.handleColorTypeChange=e=>{e===q.SingleColor?this.updateFieldColorBySingleColor(this.state.singleColorFields):e===q.ByCategory&&this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues,!0),this.setState({singleColorMode:e===q.SingleColor},()=>{this.updateItemValue()})},this.handleSingleColorChange=e=>{this.setState({singleColorFields:e},()=>{this.updateFieldColorBySingleColor(this.state.singleColorFields)})},this.updateFieldColorBySingleColor=e=>{var t,s;const i=null===(t=this.state.summaryFieldsList)||void 0===t?void 0:t.map((t,s)=>Object.assign(Object.assign({},t),{fieldColor:e})),a=null===(s=this.state.intersectedSummaryFieldList)||void 0===s?void 0:s.map((t,s)=>Object.assign(Object.assign({},t),{fieldColor:e}));this.setState({summaryFieldsList:i,intersectedSummaryFieldList:a},()=>{this.updateItemValue()})},this.handleByCategorySettingColorChange=()=>{this.openColorSetting(!0)},this.handleSortOrderKeyUp=e=>{"Enter"!==e.key&&" "!==e.key||this.setState({sortFeaturesFieldOrder:this.state.sortFeaturesFieldOrder===t.OrderRule.Asc?t.OrderRule.Desc:t.OrderRule.Asc},()=>{this.updateItemValue()})},this.handleGroupOrderKeyUp=e=>{"Enter"!==e.key&&" "!==e.key||this.setState({groupFeaturesFieldOrder:this.state.groupFeaturesFieldOrder===t.OrderRule.Asc?t.OrderRule.Desc:t.OrderRule.Asc},()=>{this.updateItemValue()})},this.getFieldsDs=e=>{var t;const s=[],i=f(e);s.push({layerDsId:e}),this.setState({selectedFieldsDataSource:s,selectedLayerGeometry:null===(t=null==i?void 0:i.getLayerDefinition())||void 0===t?void 0:t.geometryType})},this.createDisplayFieldOption=s=>{const i=f(s.layerDsId);return(0,e.jsx)(Be.FieldSelector,{dataSources:i?[i]:[],onChange:this.onDisplayField.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.displayField),isMultiple:!1})},this.createSortFieldSelectorOption=(s,i)=>{const o=f(s.layerDsId);return(0,e.jsxs)("div",{className:"sort-field-section p-1",children:[(0,e.jsx)("div",{className:"sort-field-selector",children:(0,e.jsx)(Be.FieldSelector,{dataSources:o?[o]:[],onChange:this.onSortFieldSelectChange.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.sortFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})}),(0,e.jsx)("div",{className:"sort-icon",children:(0,e.jsxs)(a.Button,{size:"sm",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.sortFeaturesFieldOrder===t.OrderRule.Asc?this.nls("ascending"):this.nls("descending"),onKeyUp:e=>{this.handleSortOrderKeyUp(e)},onClick:()=>{this.setState({sortFeaturesFieldOrder:this.state.sortFeaturesFieldOrder===t.OrderRule.Asc?t.OrderRule.Desc:t.OrderRule.Asc},()=>{this.updateItemValue()})},children:[this.state.sortFeaturesFieldOrder===t.OrderRule.Desc&&(0,e.jsx)(_e,{size:"s",className:"sort-arrow-down-icon ml-0"}),this.state.sortFeaturesFieldOrder===t.OrderRule.Asc&&(0,e.jsx)(Ue,{size:"s",className:"sort-arrow-down-icon ml-0"})]})})]})},this.createGroupFieldSelectorOption=(s,i)=>{const o=f(s.layerDsId);return(0,e.jsxs)("div",{className:"sort-field-section pl-1",children:[(0,e.jsx)("div",{className:"sort-field-selector",children:(0,e.jsx)(Be.FieldSelector,{dataSources:o?[o]:[],onChange:e=>{this.onGroupFieldSelectChange(e)},isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.groupFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})}),(0,e.jsx)("div",{className:"sort-icon",children:(0,e.jsxs)(a.Button,{size:"default",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.groupFeaturesFieldOrder===t.OrderRule.Asc?this.nls("ascending"):this.nls("descending"),onKeyUp:e=>{this.handleGroupOrderKeyUp(e)},onClick:()=>{this.setState({groupFeaturesFieldOrder:this.state.groupFeaturesFieldOrder===t.OrderRule.Asc?t.OrderRule.Desc:t.OrderRule.Asc},()=>{this.updateItemValue()})},children:[this.state.groupFeaturesFieldOrder===t.OrderRule.Desc&&(0,e.jsx)(_e,{className:"sort-arrow-down-icon ml-0"}),this.state.groupFeaturesFieldOrder===t.OrderRule.Asc&&(0,e.jsx)(Ue,{className:"sort-arrow-down-icon ml-0"})]})})]})},this.createSubGroupFieldSelectorOption=(s,i)=>{const o=f(s.layerDsId);return(0,e.jsxs)("div",{className:"sort-field-section pl-1",children:[(0,e.jsx)("div",{className:"sort-field-selector",children:(0,e.jsx)(Be.FieldSelector,{dataSources:o?[o]:[],onChange:e=>{this.onSubGroupFieldSelectChange(e)},isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.subGroupFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})}),(0,e.jsx)("div",{className:"sort-icon",children:(0,e.jsxs)(a.Button,{size:"default",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.subGroupFeaturesFieldOrder===t.OrderRule.Asc?this.nls("ascending"):this.nls("descending"),onKeyUp:e=>{this.handleGroupOrderKeyUp(e)},onClick:()=>{this.setState({subGroupFeaturesFieldOrder:this.state.subGroupFeaturesFieldOrder===t.OrderRule.Asc?t.OrderRule.Desc:t.OrderRule.Asc},()=>{this.updateItemValue()})},children:[this.state.subGroupFeaturesFieldOrder===t.OrderRule.Desc&&(0,e.jsx)(_e,{className:"sort-arrow-down-icon ml-0"}),this.state.subGroupFeaturesFieldOrder===t.OrderRule.Asc&&(0,e.jsx)(Ue,{className:"sort-arrow-down-icon ml-0"})]})})]})},this.groupFeaturesOnChange=e=>{const s=f(this.state.useDataSource.dataSourceId),i="unique-value"===s.layer.renderer.type?[s.layer.renderer.field]:[];this.setState({isGroupFeatures:e.target.checked,groupFeaturesField:i,subGroupFeaturesField:[],subGroupFeaturesFieldOrder:t.OrderRule.Asc,isSortSubGroupsByCount:!1,noValueSubGroupLabel:""},()=>{this.updateItemValue()})},this.onGroupFeatureSettingsClick=()=>{this.setState({isGroupFeatureSetting:!this.state.isGroupFeatureSetting})},this.onSubGroupFeatureSettingsClick=()=>{this.setState({isSubGroupFeatureSetting:!this.state.isSubGroupFeatureSetting})},this.createConfigureFieldsOption=s=>{const i=f(s.layerDsId);return(0,e.jsx)(Be.FieldSelector,{"aria-label":this.nls("configureFieldsLabel"),dataSources:i?[i]:[],onChange:this.onConfiguredFieldsChanged.bind(this),selectedFields:(0,t.Immutable)(this.state.fieldsToExport),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})},this.onUpdateApproxDistanceOption=e=>{let t=[];t=e.target.checked?[...this.state.fieldsToExport,"esriCTApproxDistance"]:this.state.fieldsToExport.filter(e=>"esriCTApproxDistance"!==e),this.setState({includeApproxDistance:e.target.checked,fieldsToExport:t},()=>{this.updateItemValue()})},this.sortGroupsByCountOnChange=e=>{this.setState({isSortGroupsByCount:e.target.checked},()=>{this.updateItemValue()})},this.onNoValueGroupLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({noValueGroupLabel:null!=t?t:t.trim()})}},this.onNoValueGroupLabelAcceptValue=e=>{const t={groupLabel:null!=e?e:e.trim()};this.updateItemValue(t,this.state.useDataSource)},this.sortSubGroupsByCountOnChange=e=>{this.setState({isSortSubGroupsByCount:e.target.checked},()=>{this.updateItemValue()})},this.onNoValueSubGroupLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({noValueSubGroupLabel:null!=t?t:t.trim()})}},this.onNoValueSubGroupLabelAcceptValue=e=>{const t={subGroupLabel:null!=e?e:e.trim()};this.updateItemValue(t,this.state.useDataSource)},this.onSumOfAreaChange=(e,t)=>{this.updateIntersectedFields(e.target.checked,t),this.setState({sumOfArea:e.target.checked})},this.onSumOfLengthChange=(e,t)=>{this.updateIntersectedFields(e.target.checked,t),this.setState({sumOfLength:e.target.checked})},this.updateIntersectedFields=(e,t)=>{if(e){const e={fieldLabel:t===$.SumOfIntersectedLength?this.state.sumOfLengthLabel:this.state.sumOfAreaLabel,fieldColor:this.state.singleColorMode?this.state.singleColorFields:J,summaryFieldInfo:{summaryBy:t,showSeparator:!0,numberFormattingOption:H.NoFormatting,significantDigits:0}};this.setState({intersectedSummaryFieldList:[...this.state.intersectedSummaryFieldList.slice(0,0),Object.assign({},this.state.intersectedSummaryFieldList[0],e),...this.state.intersectedSummaryFieldList.slice(1)]},()=>{this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)})}else this.state.intersectedSummaryFieldList.splice(0,1),this.updateItemValue()},this.onSumOfAreaEditClick=e=>{this.onIntersectedFieldEdit(e)},this.onSumOfLengthEditClick=e=>{this.onIntersectedFieldEdit(e)},this.onIntersectedFieldEdit=e=>{this.setState({editSummaryAreaLengthFieldPopupOpen:!0,sumOfIntersectedFieldPopupTitle:e===$.SumOfIntersectedArea?this.nls("editSumOfIntersectedArea"):this.nls("editSumOfIntersectedLength")}),this.state.intersectedSummaryFieldList.forEach(t=>{t.summaryFieldInfo.summaryBy===e&&this.setState({summaryEditField:t})})},this.closeAddSummaryFieldPanel=()=>{this.setState({isAddNewSummaryField:!1},()=>{(0,t.focusElementInKeyboardMode)(this.addSummaryFieldsRef.current)})},this.onExpressionInfoUpdate=e=>{this.setState({isAddNewSummaryField:!1});const t={fieldLabel:e.fieldLabel,fieldColor:this.state.singleColorMode?this.state.singleColorFields:J,summaryFieldInfo:e.selectedExpression};this.state.isNewFieldAdded?this.setState({summaryFieldsList:[...this.state.summaryFieldsList,t],expressionInfo:e.selectedExpression},()=>{this.setSidePopperAnchor(this.state.summaryFieldsList.length-1),this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)}):this.setState({expressionInfo:e.selectedExpression},()=>{this.updateExistingField(t)})},this.updateExistingField=e=>{const t=this.state.summaryEditIndex;t>-1&&this.setState({summaryFieldsList:[...this.state.summaryFieldsList.slice(0,t),Object.assign({},this.state.summaryFieldsList[t],e),...this.state.summaryFieldsList.slice(t+1)]},()=>{this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)})},this.getDsRootIdsByWidgetId=()=>{var e,s;const i=null===(s=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===s?void 0:s.appConfig,a=[],o=null==i?void 0:i.dataSources[this.props.activeDs];return(null==o?void 0:o.type)!==t.DataSourceTypes.WebMap&&(null==o?void 0:o.type)!==t.DataSourceTypes.WebScene||a.push(this.props.activeDs),a.length>0?(0,t.Immutable)(a):void 0},this.dataSourceChangeSave=e=>{var s,i;if(!e)return;const a=e.map(e=>t.DataSourceManager.getInstance().getDataSource(e.dataSourceId));this.setState({layerLabel:a&&(null===(s=a[0])||void 0===s?void 0:s.getLabel())?null===(i=a[0])||void 0===i?void 0:i.getLabel():"",useDataSource:e[0]},()=>{this.resetAnalysisValues(this.state.useDataSource)})},this.expandFeatureOnChange=e=>{this.setState({expandFeatureDetails:e.target.checked},()=>{this.updateItemValue()})},this.displayFeatureCountStateChange=e=>{this.setState({displayFeatureCount:e.target.checked},()=>{this.updateItemValue()})},this.highlightResultsOnMapOnChange=e=>{this.setState({highlightResultsOnMap:e.target.checked},()=>{this.updateItemValue()})},this.onHighlightColorOnMapChange=e=>{this.setState({highlightColorOnMap:e},()=>{this.updateItemValue()})},this.renderGroupSettings=()=>(0,e.jsx)("div",{children:(0,e.jsx)(a.Popper,{style:{width:"227px"},open:this.state.isGroupFeatureSetting,reference:"groupFeature"+this.props.widgetId,placement:"bottom-end",arrowOptions:!0,toggle:e=>{this.onNoValueGroupLabelAcceptValue(this.state.noValueGroupLabel),this.setState({isGroupFeatureSetting:!this.state.isGroupFeatureSetting})},children:(0,e.jsxs)("div",{className:"p-3",children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("sortGroupsByCount"),children:(0,e.jsx)(a.Switch,{role:"switch",title:this.nls("sortGroupsByCount"),checked:this.state.isSortGroupsByCount,onChange:this.sortGroupsByCountOnChange})}),(0,e.jsxs)(s.SettingRow,{flow:"wrap",children:[(0,e.jsx)(a.Label,{"aria-label":this.nls("noValueGroupLabel"),title:this.nls("noValueGroupLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("noValueGroupLabel")})}),(0,e.jsx)(a.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("noValueGroupLabel")+this.state.noValueGroupLabel,title:this.state.noValueGroupLabel,size:"sm",value:this.state.noValueGroupLabel,onChange:this.onNoValueGroupLabelChange})]})]})})}),this.renderSubGroupSettings=()=>(0,e.jsx)("div",{children:(0,e.jsx)(a.Popper,{style:{width:"227px"},open:this.state.isSubGroupFeatureSetting,reference:"subgroupFeature"+this.props.widgetId,placement:"bottom-end",arrowOptions:!0,toggle:e=>{this.onNoValueSubGroupLabelAcceptValue(this.state.noValueSubGroupLabel),this.setState({isSubGroupFeatureSetting:!this.state.isSubGroupFeatureSetting})},children:(0,e.jsxs)("div",{className:"p-3",children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("sortGroupsByCount"),children:(0,e.jsx)(a.Switch,{role:"switch",title:this.nls("sortGroupsByCount"),checked:this.state.isSortSubGroupsByCount,onChange:this.sortSubGroupsByCountOnChange})}),(0,e.jsxs)(s.SettingRow,{flow:"wrap",children:[(0,e.jsx)(a.Label,{"aria-label":this.nls("noValueGroupLabel"),title:this.nls("noValueGroupLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("noValueGroupLabel")})}),(0,e.jsx)(a.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("noValueGroupLabel")+this.state.noValueSubGroupLabel,title:this.state.noValueSubGroupLabel,size:"sm",value:this.state.noValueSubGroupLabel,onChange:this.onNoValueSubGroupLabelChange})]})]})})}),this.state={closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!1,analysisListSettings:this.props.analysisList||[],selectedLayers:[],useDataSource:null,layerLabel:"",analysisType:"",displayField:[],sortFeaturesByDistance:!(this.props.isActiveMapAreaSelected||this.props.isIncludeOutsideMapAreaSelected),sortFeaturesField:[],sortFeaturesFieldOrder:t.OrderRule.Asc,selectedFieldsDataSource:[],isGroupFeatures:!1,isGroupFeatureSetting:!1,groupFeaturesField:[],groupFeaturesFieldOrder:t.OrderRule.Asc,isSortGroupsByCount:!1,noValueGroupLabel:"",isSubGroupFeatureSetting:!1,subGroupFeaturesField:[],subGroupFeaturesFieldOrder:t.OrderRule.Asc,isSortSubGroupsByCount:!1,noValueSubGroupLabel:"",expandOnOpen:!1,returnIntersectedPolygons:!1,editSummaryAreaLengthFieldPopupOpen:!1,sumOfArea:!1,sumOfLength:!1,sumOfAreaLabel:this.nls("sumOfIntersectedArea"),sumOfLengthLabel:this.nls("sumOfIntersectedLength"),selectedLayerGeometry:this.props.selectedLayerGeometry,summaryFieldsList:[],intersectedSummaryFieldList:[],summaryEditIndex:null,summaryEditField:null,expressionInfo:null,sumOfIntersectedFieldPopupTitle:"",isAddNewSummaryField:!1,isNewFieldAdded:!1,showSummaryColorSettings:!1,singleColorFields:J,byCategoryColorFields:null,singleColorMode:!0,colorstripValues:Z,popperFocusNode:null,expandFeatureDetails:!1,highlightResultsOnMap:!0,highlightColorOnMap:z,fieldsToExport:[],includeApproxDistance:!1,displayFeatureCount:!1,clipFeatures:!1},this.setEditIndex=0,this.defaultSelectedItem.name=this.nls("noSelectionItemLabel"),this.updateSummaryFieldListSettings=[]}render(){var i,o,l,d,p,c,u,y;const g=this.props.isActiveMapAreaSelected||this.props.isIncludeOutsideMapAreaSelected,m=t.DataSourceManager.getInstance().getDataSource(this.props.activeDs),S=(null==m?void 0:m.isDataSourceSet())&&(null==m?void 0:m.getChildDataSources());let f=!1;const b=[];S&&S.forEach(e=>{var s,i;if((null==e?void 0:e.type)===t.DataSourceTypes.MapService||(null==e?void 0:e.type)===t.DataSourceTypes.GroupLayer||(null==e?void 0:e.type)===t.DataSourceTypes.SubtypeGroupLayer){const s=e=>{e.getChildDataSources().forEach(e=>{var i;(null==e?void 0:e.type)===t.DataSourceTypes.MapService||(null==e?void 0:e.type)===t.DataSourceTypes.GroupLayer||(null==e?void 0:e.type)===t.DataSourceTypes.SubtypeGroupLayer?s(e):(null==e?void 0:e.type)!==t.DataSourceTypes.FeatureLayer&&(null==e?void 0:e.type)!==t.DataSourceTypes.SubtypeSublayer||(null===(i=null==e?void 0:e.getLayerDefinition())||void 0===i?void 0:i.geometryType)&&b.push(e.id)})};s(e)}else if((null==e?void 0:e.type)===t.DataSourceTypes.FeatureLayer||(null==e?void 0:e.type)===t.DataSourceTypes.SubtypeSublayer)if(b.length>0){b.find(t=>t.id===e.id)||(f=!0),f&&(null===(s=null==e?void 0:e.getLayerDefinition())||void 0===s?void 0:s.geometryType)&&b.push(e.id)}else(null===(i=null==e?void 0:e.getLayerDefinition())||void 0===i?void 0:i.geometryType)&&b.push(e.id)});const v={fromRootDsIds:this.getDsRootIdsByWidgetId(),fromDsIds:(0,t.Immutable)(b)},x=this.renderGroupSettings(),F=this.renderSubGroupSettings();return(0,e.jsxs)("div",{css:n(this.props.theme,this.props.isActiveMapAreaSelected),style:{height:"calc(100% - 112px)",width:"100%",overflow:"auto"},children:[(0,e.jsxs)(s.SettingSection,{children:[(0,e.jsx)(s.SettingRow,{label:this.nls("selectLayer"),flow:"wrap",children:(0,e.jsx)(Be.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.state.useDataSource?(0,t.Immutable)([this.state.useDataSource]):(0,t.Immutable)([]),fromRootDsIds:v.fromRootDsIds,fromDsIds:v.fromDsIds,mustUseDataSource:!0,onChange:this.dataSourceChangeSave,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideAddDataButton:!0,disableRemove:()=>!0,hideDataView:!1,useDataSourcesEnabled:!0})}),(0,e.jsx)(s.SettingRow,{label:this.nls("label"),flow:"wrap",children:(0,e.jsx)(a.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("label")+this.state.layerLabel,title:this.state.layerLabel,size:"sm",value:this.state.layerLabel,onAcceptValue:this.onLayerLabelAcceptValue,onChange:this.onLayerLabelChange})})]}),(0,e.jsxs)(s.SettingSection,{children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.Label,{className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title2 hint-paper",children:this.nls("analysisTypeLabel")})})}),(0,e.jsxs)(s.SettingRow,{className:"mt-4",flow:"wrap",children:[(0,e.jsxs)(a.Label,{className:"m-0 analysisTypeWidth",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls(h.Closest),className:"cursor-pointer","data-testid":"closestAnalysis",value:this.nls(h.Closest),onChange:()=>{this.onAnalysisTypeChange(h.Closest)},checked:this.state.analysisType===h.Closest,disabled:this.props.isActiveMapAreaSelected}),(0,e.jsx)("div",{tabIndex:0,className:(0,t.classNames)("ml-1 text-break",this.props.isActiveMapAreaSelected?"disabled-label":"cursor-pointer"),onClick:()=>{!this.props.isActiveMapAreaSelected&&this.state.analysisType!==h.Closest&&this.onAnalysisTypeChange(h.Closest)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!this.props.isActiveMapAreaSelected&&this.state.analysisType!==h.Closest&&this.onAnalysisTypeChange(h.Closest)},children:this.nls(h.Closest)})]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("closestAnalysisTypeTooltip"),title:this.nls("closestAnalysisTypeTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(M,{})})})]}),this.props.isActiveMapAreaSelected&&this.state.analysisType===h.Closest&&(0,e.jsx)(a.Alert,{tabIndex:0,style:{minWidth:"auto"},withIcon:!0,size:"small",type:"warning",className:"w-100 shadow mb-2 mt-2",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break settings-text-level",children:this.nls("warningMsgIfActiveMapArea")})}),(0,e.jsxs)(s.SettingRow,{className:"mt-2",flow:"wrap",children:[(0,e.jsxs)(a.Label,{className:"m-0 analysisTypeWidth",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls(h.Proximity),className:"cursor-pointer",value:this.nls(h.Proximity),onChange:()=>{this.onAnalysisTypeChange(h.Proximity)},checked:this.state.analysisType===h.Proximity}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{this.state.analysisType!==h.Proximity&&this.onAnalysisTypeChange(h.Proximity)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.state.analysisType!==h.Proximity&&this.onAnalysisTypeChange(h.Proximity)},children:this.nls(h.Proximity)})]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("proximityAnalysisTypeTooltip"),title:this.nls("proximityAnalysisTypeTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(M,{})})})]}),(0,e.jsxs)(s.SettingRow,{className:"mt-2",flow:"wrap",children:[(0,e.jsxs)(a.Label,{className:"m-0 analysisTypeWidth",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls(h.Summary),className:"cursor-pointer",value:this.nls(h.Summary),onChange:()=>{this.onAnalysisTypeChange(h.Summary)},checked:this.state.analysisType===h.Summary}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{this.state.analysisType!==h.Summary&&this.onAnalysisTypeChange(h.Summary)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.state.analysisType!==h.Summary&&this.onAnalysisTypeChange(h.Summary)},children:this.nls(h.Summary)})]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("summaryAnalysisTypeTooltip"),title:this.nls("summaryAnalysisTypeTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(M,{})})})]}),this.state.proximityAnalysisType&&this.state.analysisType===h.Proximity&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingRow,{label:this.nls("displayFieldLabel"),flow:"wrap",children:this.createDisplayFieldOption(this.state.selectedFieldsDataSource[0])}),(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("sortFeaturesLabel"),title:this.nls("sortFeaturesLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("sortFeaturesLabel")})})}),(0,e.jsx)(s.SettingRow,{className:"mt-1 ml-4",flow:"wrap",children:(0,e.jsxs)(a.Label,{className:"m-0",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("distanceLabel"),className:!g&&"cursor-pointer",value:"distanceLabel","data-testid":"distanceLabel",disabled:g,onChange:()=>{this.handleSortFeaturesOptionsChange(!0)},checked:this.state.sortFeaturesByDistance}),(0,e.jsx)("div",{tabIndex:0,className:(0,t.classNames)(g?"ml-1 text-break title3 hint-default":"ml-1 text-break cursor-pointer"),onClick:()=>{!g&&this.handleSortFeaturesOptionsChange(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!g&&this.handleSortFeaturesOptionsChange(!0)},children:this.nls("distanceLabel")})]})}),(0,e.jsx)(s.SettingRow,{className:"mt-2 ml-4",flow:"wrap",children:(0,e.jsxs)(a.Label,{className:"m-0",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("field"),className:"cursor-pointer",value:"field",onChange:()=>{this.handleSortFeaturesOptionsChange(!1)},checked:!this.state.sortFeaturesByDistance}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleSortFeaturesOptionsChange(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSortFeaturesOptionsChange(!1)},children:this.nls("field")})]})}),!this.state.sortFeaturesByDistance&&(0,e.jsx)(ge.List,{className:"pt-4 pb-4",size:"sm",itemsJson:null===(i=Array.from(this.state.selectedFieldsDataSource))||void 0===i?void 0:i.map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:ge.TreeItemActionType.RenderOverrideItem,children:[{name:ge.TreeItemActionType.RenderOverrideItemBody,children:[{name:ge.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createSortFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsxs)(s.SettingRow,{tag:"label",label:this.nls("groupFeaturesLabel"),children:[(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("groupFeaturesInfoToolTip"),title:this.nls("groupFeaturesInfoToolTip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-4 d-inline",children:(0,e.jsx)(M,{})})}),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("groupFeaturesLabel"),title:this.nls("groupFeaturesLabel"),"data-testid":"groupFeaturesLabel",checked:this.state.isGroupFeatures,onChange:this.groupFeaturesOnChange})]}),this.state.isGroupFeatures&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,e.jsx)(ge.List,{className:"pt-4 pb-4 pr-1 w-100",size:"sm",itemsJson:null===(o=Array.from(this.state.selectedFieldsDataSource))||void 0===o?void 0:o.map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:ge.TreeItemActionType.RenderOverrideItem,children:[{name:ge.TreeItemActionType.RenderOverrideItemBody,children:[{name:ge.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createGroupFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(a.Button,{role:"button","aria-label":this.nls("settings"),title:this.nls("settings"),icon:!0,type:"default","aria-haspopup":"dialog",size:"default",variant:this.state.isGroupFeatureSetting?"contained":"text",color:this.state.isGroupFeatureSetting?"primary":"default",id:"groupFeature"+this.props.widgetId,onClick:()=>{this.onGroupFeatureSettingsClick()},children:(0,e.jsx)(je,{})})]}),this.state.isGroupFeatureSetting&&x,this.state.groupFeaturesField.length>0&&(0,e.jsxs)("div",{className:"d-flex align-items-center justify-content-between",style:{marginTop:"-28px"},children:[(0,e.jsx)(ge.List,{className:"pt-4 pb-4 pr-1 w-100",size:"sm",itemsJson:null===(l=Array.from(this.state.selectedFieldsDataSource))||void 0===l?void 0:l.map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:ge.TreeItemActionType.RenderOverrideItem,children:[{name:ge.TreeItemActionType.RenderOverrideItemBody,children:[{name:ge.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createSubGroupFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(a.Button,{role:"button","aria-label":this.nls("settings"),title:this.nls("settings"),icon:!0,type:"default","aria-haspopup":"dialog",size:"default",variant:this.state.isSubGroupFeatureSetting?"contained":"text",color:this.state.isSubGroupFeatureSetting?"primary":"default",id:"subgroupFeature"+this.props.widgetId,onClick:()=>{this.onSubGroupFeatureSettingsClick()},children:(0,e.jsx)(je,{})})]}),this.state.isSubGroupFeatureSetting&&F]})]}),this.state.summaryAnalysisType&&this.state.analysisType===h.Summary&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)("div",{tabIndex:-1,className:"pt-2 pb-1",children:[(0,e.jsxs)("div",{ref:this.addSummaryFieldsRef,tabIndex:0,"aria-label":this.nls("addSummaryFields"),title:this.nls("addSummaryFields"),className:"d-flex align-items-center add-summary-field",onClick:e=>{this.onAddSummaryFieldsClick(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onAddSummaryFieldsClick(e)},"data-testid":"addSummaryFields",children:[(0,e.jsx)("div",{tabIndex:-1,className:"add-summary-field-icon-container d-flex align-items-center justify-content-center mr-2",children:(0,e.jsx)(a.Icon,{tabIndex:-1,icon:qe,size:12})}),(0,e.jsx)("div",{tabIndex:-1,className:"pt-1 text-truncate flex-grow-1",children:this.nls("addSummaryFields")})]}),0===this.state.summaryFieldsList.length&&(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("addSummaryHintMsg"),className:"font-italic w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("addSummaryHintMsg")})})]}),this.state.summaryFieldsList.length>0&&(0,e.jsx)("div",{ref:this.summaryFieldsSidePopperTrigger,className:(0,t.classNames)("nearme-summary-fields-list-items","esriGeometryPoint"===this.state.selectedLayerGeometry?"pb-2":""),children:(0,e.jsx)(ge.List,{itemsJson:null===(d=Array.from(this.state.summaryFieldsList||null))||void 0===d?void 0:d.map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map(e=>e.itemStateDetailContent);this.updateSortedSummaryFields(a)},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:ge.TreeItemActionType.RenderOverrideItem,children:[{name:ge.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:ge.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:ge.TreeItemActionType.RenderOverrideItemBody,children:[{name:ge.TreeItemActionType.RenderOverrideItemDragHandle},{name:ge.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createFieldsOptionElement(i.itemStateDetailContent,a.indexOf(i))}})}),!this.props.isActiveMapAreaSelected&&(0,e.jsxs)(t.React.Fragment,{children:[("esriGeometryPolyline"===this.state.selectedLayerGeometry||"esriGeometryPolygon"===this.state.selectedLayerGeometry)&&(0,e.jsx)(s.SettingRow,{label:"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfIntersectedLength"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfIntersectedArea"):"",children:(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfLengthTooltip"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfAreaTooltip"):"",title:"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfLengthTooltip"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfAreaTooltip"):"",showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default ml-2 d-inline",children:(0,e.jsx)(M,{})})})}),"esriGeometryPolyline"===this.state.selectedLayerGeometry&&(0,e.jsxs)("div",{className:(0,t.classNames)("pb-2 d-flex align-items-center justify-content-between"),children:[(0,e.jsxs)(a.Label,{title:this.state.sumOfLengthLabel,className:"pt-2 pl-1 text-truncate cursor-pointer",children:[(0,e.jsx)(a.Checkbox,{className:"mr-2 font-13",checked:this.state.sumOfLength,role:"checkbox","aria-label":this.nls("sumOfIntersectedLength"),onChange:e=>{this.onSumOfLengthChange(e,$.SumOfIntersectedLength)}}),this.state.sumOfLengthLabel]}),this.state.sumOfLength&&(0,e.jsx)(a.Button,{role:"button","aria-label":this.nls("edit"),title:this.nls("edit"),icon:!0,type:"tertiary","aria-haspopup":"dialog",size:"sm",onClick:()=>{this.onSumOfLengthEditClick($.SumOfIntersectedLength)},children:(0,e.jsx)(we,{size:"s"})})]}),"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(0,e.jsxs)("div",{className:(0,t.classNames)("pb-2 d-flex align-items-center justify-content-between"),children:[(0,e.jsxs)(a.Label,{title:this.state.sumOfAreaLabel,className:"pt-2 pl-1 text-truncate cursor-pointer",children:[(0,e.jsx)(a.Checkbox,{className:"mr-2 font-13",checked:this.state.sumOfArea,"data-testid":"sumOfIntersectedArea",role:"checkbox","aria-label":this.nls("sumOfIntersectedArea"),onChange:e=>{this.onSumOfAreaChange(e,$.SumOfIntersectedArea)}}),this.state.sumOfAreaLabel]}),this.state.sumOfArea&&(0,e.jsx)(a.Button,{role:"button","aria-label":this.nls("edit"),title:this.nls("edit"),icon:!0,type:"tertiary","aria-haspopup":"dialog",size:"sm",onClick:()=>{this.onSumOfAreaEditClick($.SumOfIntersectedArea)},children:(0,e.jsx)(we,{size:"s"})})]})]}),((null===(p=this.updateSummaryFieldListSettings)||void 0===p?void 0:p.length)>0&&!this.props.isActiveMapAreaSelected||(null===(c=this.state.summaryFieldsList)||void 0===c?void 0:c.length)>0&&this.props.isActiveMapAreaSelected)&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingRow,{className:(0,t.classNames)("pt-4",this.state.summaryFieldsList.length>0||this.state.sumOfArea||this.state.sumOfLength?"pt-2 nearme-divider":""),label:this.nls("themeSettingColorMode"),flow:"wrap"}),(0,e.jsxs)(s.SettingRow,{className:"mt-0",flow:"wrap",children:[(0,e.jsxs)(a.Label,{className:"mt-1 colorModesWidth",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("singleColor"),className:"cursor-pointer",value:"singleColor",onChange:()=>{this.handleColorTypeChange(q.SingleColor)},checked:this.state.singleColorMode}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleColorTypeChange(q.SingleColor)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleColorTypeChange(q.SingleColor)},children:this.nls("singleColor")})]}),this.state.singleColorMode&&(0,e.jsx)(j.ThemeColorPicker,{specificTheme:(0,k.getTheme2)(),value:this.state.singleColorFields,onChange:e=>{this.handleSingleColorChange(e)}})]}),(0,e.jsxs)(s.SettingRow,{className:"mt-0",flow:"wrap",children:[(0,e.jsxs)(a.Label,{className:"mt-1 mb-1 colorModesWidth",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("byCategory"),className:"cursor-pointer",value:"byCategory",onChange:()=>{this.handleColorTypeChange(q.ByCategory)},checked:!this.state.singleColorMode}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleColorTypeChange(q.ByCategory)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleColorTypeChange(q.ByCategory)},children:this.nls("byCategory")})]}),!this.state.singleColorMode&&(0,e.jsx)(a.Button,{ref:this.colorButtonRef,role:"button","aria-label":this.nls("byCategory"),title:this.nls("byCategory"),icon:!0,type:"tertiary",size:"sm",onClick:this.handleByCategorySettingColorChange.bind(this),children:(0,e.jsx)(je,{})})]})]}),(0,e.jsx)(s.SidePopper,{isOpen:this.state.isAddNewSummaryField&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeAddSummaryFieldPanel,trigger:null===(u=this.summaryFieldsSidePopperTrigger)||void 0===u?void 0:u.current,backToFocusNode:this.state.popperFocusNode,children:(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:r(this.props.theme),children:(0,e.jsx)(ke,{theme:this.props.theme,intl:this.props.intl,title:null!==this.state.summaryEditIndex?this.nls("editSummaryField"):this.nls("addSummaryFields"),ref:this.backRef,onBack:this.closeAddSummaryFieldPanel,children:(0,e.jsx)(He,{intl:this.props.intl,theme:this.props.theme,widgetId:this.props.widgetId,currentLayerDsId:this.props.editCurrentLayer,layersInfos:this.state.analysisListSettings,fieldsEditIndex:this.state.summaryEditIndex,editingField:this.state.summaryEditField,expressionInfoUpdate:this.onExpressionInfoUpdate.bind(this)})})})}),(0,e.jsx)(s.SidePopper,{isOpen:this.state.showSummaryColorSettings&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeColorSettingsPanel,trigger:null===(y=this.colorSidePopperTrigger)||void 0===y?void 0:y.current,children:(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:r(this.props.theme),children:(0,e.jsx)(ke,{theme:this.props.theme,intl:this.props.intl,title:this.nls("summaryFieldColor"),ref:this.backRef,onBack:this.closeColorSettingsPanel,children:(0,e.jsx)("div",{className:"setting-container",children:(0,e.jsx)(Pe,{intl:this.props.intl,theme:this.props.theme,summaryFieldsInfo:this.props.isActiveMapAreaSelected?this.state.summaryFieldsList:this.updateSummaryFieldListSettings,colorstripValue:this.state.colorstripValues,updateFieldColorsValues:this.onUpdateFieldColorByCategory})})})})}),this.state.editSummaryAreaLengthFieldPopupOpen&&(0,e.jsx)($e,{theme:this.props.theme,intl:this.props.intl,isOpen:this.state.editSummaryAreaLengthFieldPopupOpen,editSummaryFields:this.state.summaryEditField,sumOfIntersectedFieldPopupTitle:this.state.sumOfIntersectedFieldPopupTitle,onClose:this.onEditPopperClose,onOkClick:this.onOkButtonClick})]}),(0,e.jsxs)(s.SettingRow,{tag:"label",label:this.nls("displayFeatureCountLabel"),children:[(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("displayFeatureCountInfoTooltip"),title:this.nls("displayFeatureCountInfoTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-4 d-inline",children:(0,e.jsx)(M,{})})}),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("displayFeatureCountLabel"),title:this.nls("displayFeatureCountLabel"),checked:this.state.displayFeatureCount,onChange:this.displayFeatureCountStateChange})]}),!this.props.isActiveMapAreaSelected&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("highlightResultsOnMapLabel"),children:(0,e.jsx)(a.Switch,{role:"switch",title:this.nls("highlightResultsOnMapLabel"),"data-testid":"highlightResultsOnMapLabel",checked:this.state.highlightResultsOnMap,onChange:this.highlightResultsOnMapOnChange})}),this.state.highlightResultsOnMap&&(0,e.jsx)(s.SettingRow,{label:this.nls("highlightColorLabel"),children:(0,e.jsx)(j.ThemeColorPicker,{specificTheme:(0,k.getTheme2)(),value:this.state.highlightColorOnMap?this.state.highlightColorOnMap:z,onChange:e=>{this.onHighlightColorOnMapChange(e)}})})]}),(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("expandOnOpen"),children:(0,e.jsx)(a.Switch,{role:"switch",title:this.nls("expandOnOpen"),"data-testid":"expandOnOpen",checked:this.state.expandOnOpen,onChange:this.expandListOnChange})}),this.state.proximityAnalysisType&&this.state.expandOnOpen&&(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsxs)(a.Label,{title:this.nls("expandFeatureDetails"),className:"m-0 w-100",centric:!0,children:[(0,e.jsx)(a.Checkbox,{className:"mr-2 font-13",checked:this.state.expandFeatureDetails,role:"checkbox","aria-label":this.nls("expandFeatureDetails"),onChange:e=>{this.expandFeatureOnChange(e)}}),(0,e.jsx)("div",{className:"ml-1 w-100 text-break",onClick:e=>{"span"!==e.target.tagName.toLowerCase()&&e.preventDefault()},children:(0,e.jsx)("span",{className:"cursor-pointer",children:this.nls("expandFeatureDetails")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("expandListTooltip"),title:this.nls("expandListTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",onClick:e=>{e.preventDefault()},children:(0,e.jsx)(M,{})})})]})}),!this.props.isActiveMapAreaSelected&&this.state.proximityAnalysisType&&("esriGeometryPolygon"===this.state.selectedLayerGeometry||"esriGeometryPolyline"===this.state.selectedLayerGeometry)&&(0,e.jsxs)(s.SettingRow,{tag:"label",label:this.nls("clipFeaturesLabel"),children:[(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("clipFeaturesTooltip"),title:this.nls("clipFeaturesTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-4 d-inline",children:(0,e.jsx)(M,{})})}),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("clipFeaturesLabel"),title:this.nls("clipFeaturesLabel"),checked:this.state.clipFeatures,onChange:this.clipFeaturesChanged})]}),!this.props.isActiveMapAreaSelected&&!this.state.summaryAnalysisType&&"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("returnIntersectedPolygons"),children:(0,e.jsx)(a.Switch,{role:"switch",title:this.nls("returnIntersectedPolygons"),checked:this.state.returnIntersectedPolygons,onChange:this.returnIntersectedPolygonsChanged})}),(this.state.closestAnalysisType||this.state.proximityAnalysisType||this.state.summaryAnalysisType)&&(0,e.jsx)(s.SettingRow,{className:"border-top pt-3",label:this.nls("configureFieldsLabel"),flow:"wrap",children:this.createConfigureFieldsOption(this.state.selectedFieldsDataSource[0])}),!this.props.isActiveMapAreaSelected&&(this.state.closestAnalysisType||this.state.proximityAnalysisType)&&(0,e.jsx)(s.SettingRow,{className:"pt-1",tag:"label",label:this.nls("includeApproxDistance"),children:(0,e.jsx)(a.Switch,{role:"switch",title:this.nls("includeApproxDistance"),checked:this.state.includeApproxDistance,onChange:this.onUpdateApproxDistanceOption})})]})]})}}let Qe=[];class Xe extends t.React.PureComponent{constructor(e){var s,i,a,n,r,d,p,c,u,y,g,m,S,b,v,x,C,w,A,j;super(e),this.supportedDsTypes=(0,t.Immutable)([t.DataSourceTypes.FeatureLayer,t.DataSourceTypes.SubtypeSublayer]),this.analysisLayersPopperTrigger=t.React.createRef(),this.backRef=t.React.createRef(),this.mvManager=o.MapViewManager.getInstance(),this.allDsLayers=[],this.nls=e=>{const s=Object.assign({},l,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var e,t;Qe=this.collectionOfLayerInfos();const s=[];(null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo.length)>0&&(null===(t=this.props.activeDsLayersConfig)||void 0===t||t.layersInfo.map(e=>(s.push(e),!0)),this.setState({newAddedLayerAnalysis:s}))},this.componentDidUpdate=e=>{var s,i,a,o,l,n,r,d,h,p,c,u,y,g,m,S,f,b,v,x,F,C,w;e.activeDsSearchConfig.searchByActiveMapArea!==this.props.activeDsSearchConfig.searchByActiveMapArea&&(Qe=this.collectionOfLayerInfos()),e.activeDsSearchConfig.searchByActiveMapArea===this.props.activeDsSearchConfig.searchByActiveMapArea&&e.activeDsSearchConfig.includeFeaturesOutsideMapArea===this.props.activeDsSearchConfig.includeFeaturesOutsideMapArea||this.setState({searchActiveMapArea:this.props.activeDsSearchConfig.searchByActiveMapArea,includeOutsideMapArea:this.props.activeDsSearchConfig.includeFeaturesOutsideMapArea}),(null===(s=e.activeDsLayersConfig)||void 0===s?void 0:s.layersInfo.length)===(null===(i=this.props.activeDsLayersConfig)||void 0===i?void 0:i.layersInfo.length)&&t.lodash.isDeepEqual(null===(a=e.activeDsLayersConfig)||void 0===a?void 0:a.layersInfo,null===(o=this.props.activeDsLayersConfig)||void 0===o?void 0:o.layersInfo)||this.setState({newAddedLayerAnalysis:null===(l=this.props.activeDsLayersConfig)||void 0===l?void 0:l.layersInfo}),(null===(r=null===(n=e.activeDsLayersConfig.saveFeatures)||void 0===n?void 0:n.pointFeature)||void 0===r?void 0:r.enabled)!==(null===(h=null===(d=this.props.activeDsLayersConfig.saveFeatures)||void 0===d?void 0:d.pointFeature)||void 0===h?void 0:h.enabled)?this.setState({showPointFeature:null===(c=null===(p=this.props.activeDsLayersConfig.saveFeatures)||void 0===p?void 0:p.pointFeature)||void 0===c?void 0:c.enabled}):(null===(y=null===(u=e.activeDsLayersConfig.saveFeatures)||void 0===u?void 0:u.polylineFeature)||void 0===y?void 0:y.enabled)!==(null===(m=null===(g=this.props.activeDsLayersConfig.saveFeatures)||void 0===g?void 0:g.polylineFeature)||void 0===m?void 0:m.enabled)?this.setState({showPolylineFeature:null===(f=null===(S=this.props.activeDsLayersConfig.saveFeatures)||void 0===S?void 0:S.polylineFeature)||void 0===f?void 0:f.enabled}):(null===(v=null===(b=e.activeDsLayersConfig.saveFeatures)||void 0===b?void 0:b.polygonFeature)||void 0===v?void 0:v.enabled)!==(null===(F=null===(x=this.props.activeDsLayersConfig.saveFeatures)||void 0===x?void 0:x.polygonFeature)||void 0===F?void 0:F.enabled)&&this.setState({showPolygonFeature:null===(w=null===(C=this.props.activeDsLayersConfig.saveFeatures)||void 0===C?void 0:C.polygonFeature)||void 0===w?void 0:w.enabled})},this.onlyShowResultsOptionChange=e=>{this.props.onAnalysisSettingsUpdated("onlyShowLayersResult",e.target.checked)},this.displayAllLayersResultOptionChange=e=>{this.props.onAnalysisSettingsUpdated("displayAllLayersResult",e.target.checked)},this.enableProximitySearchOptionChange=e=>{this.props.onAnalysisSettingsUpdated("enableProximitySearch",e.target.checked)},this.enableSaveInputLocation=e=>{this.props.onAnalysisSettingsUpdated("saveInputLocation",e.target.checked,!0)},this.enableSaveSearchArea=e=>{const t={enabled:e.target.checked,useDataSource:this.state.searchAreaPolygonFeatureUseDs};this.props.onAnalysisSettingsUpdated("searchAreaFeature",t,!0)},this.onPointFeatureChange=e=>{this.setState({showPointFeature:e.target.checked});const t={enabled:e.target.checked,useDataSource:this.state.pointFeatureUseDs};this.props.onAnalysisSettingsUpdated("pointFeature",t,!0)},this.onPolylineFeatureChange=e=>{this.setState({showPolylineFeature:e.target.checked});const t={enabled:e.target.checked,useDataSource:this.state.polylineFeatureUseDs};this.props.onAnalysisSettingsUpdated("polylineFeature",t,!0)},this.onPolygonFeatureChange=e=>{this.setState({showPolygonFeature:e.target.checked});const t={enabled:e.target.checked,useDataSource:this.state.polygonFeatureUseDs};this.props.onAnalysisSettingsUpdated("polygonFeature",t,!0)},this.pointDataSourceChangeSave=e=>{if(!e)return;this.setState({pointFeatureUseDs:e[0]});const t={enabled:this.state.showPointFeature,useDataSource:e[0]};this.props.onAnalysisSettingsUpdated("pointFeature",t,!0)},this.polylineDataSourceChangeSave=e=>{if(!e)return;this.setState({polylineFeatureUseDs:e[0]});const t={enabled:this.state.showPolylineFeature,useDataSource:e[0]};this.props.onAnalysisSettingsUpdated("polylineFeature",t,!0)},this.polygonDataSourceChangeSave=e=>{if(!e)return;this.setState({polygonFeatureUseDs:e[0]});const t={enabled:this.state.showPolygonFeature,useDataSource:e[0]};this.props.onAnalysisSettingsUpdated("polygonFeature",t,!0)},this.searchAreaPolygonDataSourceChangeSave=e=>{if(!e)return;this.setState({searchAreaPolygonFeatureUseDs:e[0]});const t={enabled:!0,useDataSource:e[0]};this.props.onAnalysisSettingsUpdated("searchAreaFeature",t,!0)},this.onToggleResults=()=>{this.setState({isResultSettingsOpen:!this.state.isResultSettingsOpen})},this.onShowDistFromInputLocToolsChange=e=>{this.props.onAnalysisSettingsUpdated("showDistFromInputLocation",e.target.checked)},this.displayAnalysisIconStateChange=e=>{this.props.onAnalysisSettingsUpdated("displayAnalysisIcon",e.target.checked)},this.displayMapSymbolsStateChange=e=>{this.props.onAnalysisSettingsUpdated("displayMapSymbols",e.target.checked)},this.collectionOfLayerInfos=()=>{const e=[];this.props.allFeatureLayers.forEach((e,t)=>{if(e.value===this.props.selectedDs){e.availableLayers.forEach(e=>{const t=f(e.layerDsId);this.allDsLayers.push(t)})}});for(let t=0;t<this.allDsLayers.length;t++)for(let s=0;s<W.length;s++)this.props.activeDsSearchConfig.searchByActiveMapArea&&W[s]===h.Closest||e.push({analysisType:W[s],featureLayer:this.allDsLayers[t]});return e},this.onAddAnalysisClick=()=>{var e,t,s,i,a,o;if(this.setSidePopperAnchor(null,!0),!((null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo.length)>0))return this.displayDefaultClosestOrProximity(Qe,!1);{const e=[];for(let t=0;t<Qe.length;t++)for(let s=0;s<this.state.newAddedLayerAnalysis.length;s++)Qe[t].analysisType===this.state.newAddedLayerAnalysis[s].analysisInfo.analysisType&&Qe[t].featureLayer.id===this.state.newAddedLayerAnalysis[s].useDataSource.dataSourceId&&e.push(t);const l=[];Qe.forEach((t,s)=>{e.includes(s)||l.push(s)});const n={dataSourceId:null===(s=null===(t=Qe[null==l?void 0:l[0]])||void 0===t?void 0:t.featureLayer)||void 0===s?void 0:s.id,mainDataSourceId:null===(a=null===(i=Qe[null==l?void 0:l[0]])||void 0===i?void 0:i.featureLayer)||void 0===a?void 0:a.id,rootDataSourceId:this.props.selectedDs};if(!(l.length>0))return this.displayDefaultClosestOrProximity(Qe,!0);{const e=_.find(e=>e.analysisType===Qe[l[0]].analysisType),t=f(Qe[l[0]].featureLayer.id),s={useDataSource:n,label:null==t?void 0:t.getLabel(),analysisInfo:e},i=s.analysisInfo;i.analysisId=I(),i.fieldsToExport=L(Qe[l[0]].featureLayer.id),Qe[l[0]].analysisType===h.Proximity&&(i.displayField=F(t)),s.analysisInfo=i,this.setState({newAddedLayerAnalysis:[...this.state.newAddedLayerAnalysis,s],analysisIndex:this.state.newAddedLayerAnalysis.length,editCurrentLayer:{layerDsId:Qe[l[0]].featureLayer.id,analysisType:Qe[l[0]].analysisType},selectedLayerGeometryType:null===(o=null==t?void 0:t.getLayerDefinition())||void 0===o?void 0:o.geometryType,newLayerAdded:!0,showEditAnalysisPopper:!0},()=>this.state.newAddedLayerAnalysis)}}},this.displayDefaultClosestOrProximity=(e,t)=>{const s={dataSourceId:e[0].featureLayer.id,mainDataSourceId:e[0].featureLayer.id,rootDataSourceId:this.props.selectedDs},i=f(e[0].featureLayer.id),a={useDataSource:s,label:null==i?void 0:i.getLabel(),analysisInfo:this.props.activeDsSearchConfig.searchByActiveMapArea?_[1]:_[0]},o=a.analysisInfo;o.analysisId=I(),a.analysisInfo=o,a.analysisInfo.fieldsToExport=L(e[0].featureLayer.id);const l=t?[...this.state.newAddedLayerAnalysis,a]:[a];return this.setState({newAddedLayerAnalysis:l,analysisIndex:this.state.newAddedLayerAnalysis.length,editCurrentLayer:{layerDsId:e[0].featureLayer.id,analysisType:e[0].analysisType},showEditAnalysisPopper:!0,newLayerAdded:!0}),l},this.closeEditAnalysisPopper=()=>{var e,t,s;this.state.newLayerAdded?this.setSidePopperAnchor(null,!0):this.setSidePopperAnchor(this.state.analysisIndex);const i=null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo;this.setState({newAddedLayerAnalysis:(null===(s=null===(t=this.props.activeDsLayersConfig)||void 0===t?void 0:t.layersInfo)||void 0===s?void 0:s.length)>0?i:[],showEditAnalysisPopper:!1,analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""}},()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)})},this.editOkButtonCLick=()=>{this.setState({showEditAnalysisPopper:!1,newAddedLayerAnalysis:this.isAnalysisEdited?this.state.updatedAddedLayerAnalysis:this.state.newAddedLayerAnalysis},()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)}),this.isAnalysisEdited=!1},this.onEditButtonClick=(e,t,s,i)=>{this.setSidePopperAnchor(i),this.setState({showEditAnalysisPopper:e,analysisIndex:i,editCurrentLayer:{layerDsId:t,analysisType:s},newLayerAdded:!1})},this.setSidePopperAnchor=(e,t=!1)=>{var s;let i;i=t?this.analysisLayersPopperTrigger.current.getElementsByClassName("add-layer-btn")[0]:null===(s=this.analysisLayersPopperTrigger.current)||void 0===s?void 0:s.getElementsByClassName("jimu-tree-item__body")[e],this.setState({popperFocusNode:i})},this.onDeleteButtonClick=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:i},()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e),-1===this.state.analysisIndex&&this.state.editCurrentLayer.layerDsId===t&&this.state.editCurrentLayer.analysisType===s&&(this.setSidePopperAnchor(this.state.analysisIndex),this.setState({showEditAnalysisPopper:!1,analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""}},()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)}))})},this.updateLayersInfoSettings=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:t,editCurrentLayer:{layerDsId:s,analysisType:i}},()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e)})},this.onAnalysisInfoUpdate=(e,t,s,i)=>{this.isAnalysisEdited=!0,this.setState({updatedAddedLayerAnalysis:e,analysisIndex:i,editCurrentLayer:{layerDsId:t,analysisType:s}})},this.onDisableOkButton=e=>{this.setState({disableSidePopperOkButton:e})},this.getDsRootIdsByWidgetId=()=>{var e,s;const i=null===(s=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===s?void 0:s.appConfig,a=[],o=null==i?void 0:i.dataSources[this.props.selectedDs];return(null==o?void 0:o.type)!==t.DataSourceTypes.WebMap&&(null==o?void 0:o.type)!==t.DataSourceTypes.WebScene||a.push(this.props.selectedDs),a.length>0?(0,t.Immutable)(a):void 0},this.props.activeDsLayersConfig&&(this.state={showEditAnalysisPopper:!1,newAddedLayerAnalysis:(null===(i=null===(s=this.props.activeDsLayersConfig)||void 0===s?void 0:s.layersInfo)||void 0===i?void 0:i.length)>0?null===(a=this.props.activeDsLayersConfig)||void 0===a?void 0:a.layersInfo:[],updatedAddedLayerAnalysis:(null===(r=null===(n=this.props.activeDsLayersConfig)||void 0===n?void 0:n.layersInfo)||void 0===r?void 0:r.length)>0?null===(d=this.props.activeDsLayersConfig)||void 0===d?void 0:d.layersInfo:[],newLayerAdded:!1,layersAnalysisType:"",analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""},selectedLayerGeometryType:"",popperFocusNode:null,disableSidePopperOkButton:!1,isResultSettingsOpen:!1,showPointFeature:null===(c=null===(p=this.props.activeDsLayersConfig.saveFeatures)||void 0===p?void 0:p.pointFeature)||void 0===c?void 0:c.enabled,pointFeatureUseDs:null===(y=null===(u=this.props.activeDsLayersConfig.saveFeatures)||void 0===u?void 0:u.pointFeature)||void 0===y?void 0:y.useDataSource,showPolylineFeature:null===(m=null===(g=this.props.activeDsLayersConfig.saveFeatures)||void 0===g?void 0:g.polylineFeature)||void 0===m?void 0:m.enabled,polylineFeatureUseDs:null===(b=null===(S=this.props.activeDsLayersConfig.saveFeatures)||void 0===S?void 0:S.polylineFeature)||void 0===b?void 0:b.useDataSource,showPolygonFeature:null===(x=null===(v=this.props.activeDsLayersConfig.saveFeatures)||void 0===v?void 0:v.polygonFeature)||void 0===x?void 0:x.enabled,polygonFeatureUseDs:null===(w=null===(C=this.props.activeDsLayersConfig.saveFeatures)||void 0===C?void 0:C.polygonFeature)||void 0===w?void 0:w.useDataSource,searchAreaPolygonFeatureUseDs:null===(j=null===(A=this.props.activeDsLayersConfig.saveFeatures)||void 0===A?void 0:A.searchAreaFeature)||void 0===j?void 0:j.useDataSource,searchActiveMapArea:this.props.activeDsSearchConfig.searchByActiveMapArea,includeOutsideMapArea:this.props.activeDsSearchConfig.includeFeaturesOutsideMapArea}),this.isAnalysisEdited=!1}render(){var i,o,l,d,h,p,c;const u=t.DataSourceManager.getInstance().getDataSource(this.props.selectedDs),y=(null==u?void 0:u.isDataSourceSet())&&(null==u?void 0:u.getChildDataSources());let g=!1;const m=[],S=[],f=[];y&&y.forEach(e=>{if((null==e?void 0:e.type)===t.DataSourceTypes.MapService||(null==e?void 0:e.type)===t.DataSourceTypes.GroupLayer||(null==e?void 0:e.type)===t.DataSourceTypes.SubtypeGroupLayer){const s=e=>{e.getChildDataSources().forEach(e=>{if((null==e?void 0:e.type)===t.DataSourceTypes.MapService||(null==e?void 0:e.type)===t.DataSourceTypes.GroupLayer||(null==e?void 0:e.type)===t.DataSourceTypes.SubtypeGroupLayer)s(e);else if((null==e?void 0:e.type)===t.DataSourceTypes.FeatureLayer||(null==e?void 0:e.type)===t.DataSourceTypes.SubtypeSublayer){const t=null==e?void 0:e.getLayerDefinition();(null==t?void 0:t.geometryType)&&"esriGeometryPoint"===(null==t?void 0:t.geometryType)&&e.layer.capabilities.operations.supportsEditing?m.push(e.id):(null==t?void 0:t.geometryType)&&"esriGeometryPolyline"===(null==t?void 0:t.geometryType)&&e.layer.capabilities.operations.supportsEditing?S.push(e.id):(null==t?void 0:t.geometryType)&&"esriGeometryPolygon"===(null==t?void 0:t.geometryType)&&e.layer.capabilities.operations.supportsEditing&&f.push(e.id)}})};s(e)}else if((null==e?void 0:e.type)===t.DataSourceTypes.FeatureLayer||(null==e?void 0:e.type)===t.DataSourceTypes.SubtypeSublayer){const t=null==e?void 0:e.getLayerDefinition();if("esriGeometryPoint"===(null==t?void 0:t.geometryType)&&e.layer.capabilities.operations.supportsEditing)if(m.length>0){m.find(t=>t.id===e.id)||(g=!0),g&&(null==t?void 0:t.geometryType)&&m.push(e.id)}else(null==t?void 0:t.geometryType)&&m.push(e.id);else if("esriGeometryPolyline"===(null==t?void 0:t.geometryType)&&e.layer.capabilities.operations.supportsEditing)if(S.length>0){S.find(t=>t.id===e.id)||(g=!0),g&&(null==t?void 0:t.geometryType)&&S.push(e.id)}else(null==t?void 0:t.geometryType)&&S.push(e.id);else if("esriGeometryPolygon"===(null==t?void 0:t.geometryType)&&e.layer.capabilities.operations.supportsEditing)if(f.length>0){f.find(t=>t.id===e.id)||(g=!0),g&&(null==t?void 0:t.geometryType)&&f.push(e.id)}else(null==t?void 0:t.geometryType)&&f.push(e.id)}});const b=this.getDsRootIdsByWidgetId(),v={fromRootDsIds:b,fromDsIds:(0,t.Immutable)(m)},x={fromRootDsIds:b,fromDsIds:(0,t.Immutable)(S)},F={fromRootDsIds:b,fromDsIds:(0,t.Immutable)(f)};return(0,e.jsxs)("div",{css:n(this.props.theme,this.props.activeDsSearchConfig.searchByActiveMapArea),style:{height:"100%",width:"100%"},children:[(0,e.jsxs)("div",{ref:this.analysisLayersPopperTrigger,className:"mb-4",children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.Button,{role:"button",className:"w-100 text-dark add-layer-btn",type:"primary",onClick:this.onAddAnalysisClick.bind(this),children:this.nls("addAnalysisLabel")})}),0===this.state.newAddedLayerAnalysis.length&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.Alert,{tabIndex:0,style:{minWidth:"auto"},withIcon:!0,text:this.nls("noAnalysisConfiguredMsg"),type:"info","data-testid":"noAnalysisConfiguredMsg"})}),this.state.newAddedLayerAnalysis&&this.state.newAddedLayerAnalysis.length>0&&(0,e.jsx)("div",{tabIndex:-1,className:"w-100 mb-4 mt-2",children:(0,e.jsx)(ve,{intl:this.props.intl,theme:this.props.theme,addedLayerAnalysis:this.state.newAddedLayerAnalysis,showEditAnalysisPopper:this.state.showEditAnalysisPopper,analysisIndex:this.state.analysisIndex,editCurrentLayer:this.state.editCurrentLayer,onEditAction:this.onEditButtonClick,onDeleteAction:this.onDeleteButtonClick.bind(this),onLayersInfoSettingsUpdated:this.updateLayersInfoSettings,isActiveMapAreaSelected:this.props.activeDsSearchConfig.searchByActiveMapArea})})]}),(0,e.jsx)(s.SettingRow,{className:"border-top pt-3",children:(0,e.jsx)(a.CollapsablePanel,{label:this.nls("resultsCollapsible"),isOpen:this.state.isResultSettingsOpen,onRequestOpen:()=>{this.onToggleResults()},onRequestClose:()=>{this.onToggleResults()},children:(0,e.jsxs)("div",{style:{height:"100%",marginTop:10},children:[(0,e.jsx)(s.SettingRow,{className:"ml-2",children:(0,e.jsxs)(a.Label,{check:!0,centric:!0,style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("displayAnalysisIconLabel"),"data-testid":"displayAnalysisIcon",style:{cursor:"pointer"},className:"mr-2",checked:this.props.activeDsLayersConfig.displayAnalysisIcon,onChange:this.displayAnalysisIconStateChange.bind(this)}),this.nls("displayAnalysisIconLabel")]})}),(0,e.jsx)(s.SettingRow,{className:"ml-2",children:(0,e.jsxs)(a.Label,{check:!0,centric:!0,style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("mapSymbolsLabel"),"data-testid":"mapSymbols",style:{cursor:"pointer"},className:"mr-2",checked:this.props.activeDsLayersConfig.displayMapSymbols,onChange:this.displayMapSymbolsStateChange.bind(this)}),this.nls("mapSymbolsLabel")]})}),!this.props.activeDsSearchConfig.searchByActiveMapArea&&(0,e.jsx)(s.SettingRow,{className:"ml-2",children:(0,e.jsxs)(a.Label,{check:!0,centric:!0,style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("showDistFromInputLoc"),"data-testid":"showDistFromInputLoc",style:{cursor:"pointer"},className:"mr-2",checked:this.props.activeDsLayersConfig.showDistFromInputLocation,onChange:this.onShowDistFromInputLocToolsChange.bind(this)}),this.nls("showDistFromInputLoc")]})}),!this.props.activeDsSearchConfig.searchByActiveMapArea&&(0,e.jsxs)(s.SettingRow,{className:"ml-2",children:[(0,e.jsxs)(a.Label,{check:!0,centric:!0,className:"w-100 labelStyle",style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("onlyShowResults"),"data-testid":"onlyShowResults",style:{cursor:"pointer"},className:"mr-2",checked:this.props.activeDsLayersConfig.onlyShowLayersResult,onChange:this.onlyShowResultsOptionChange.bind(this)}),this.nls("onlyShowResults")]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("onlyShowResults")+" "+this.nls("onlyShowResultsTooltip"),title:this.nls("onlyShowResultsTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-2 d-inline",children:(0,e.jsx)(M,{})})})]}),(0,e.jsxs)(s.SettingRow,{className:"ml-2",children:[(0,e.jsxs)(a.Label,{check:!0,centric:!0,className:"w-100 labelStyle",style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("displayAllLayersResultLabel"),"data-testid":"displayAllLayersResult",style:{cursor:"pointer"},className:"mr-2",checked:this.props.activeDsLayersConfig.displayAllLayersResult,onChange:this.displayAllLayersResultOptionChange.bind(this)}),this.nls("displayAllLayersResultLabel")]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("displayAllLayersResultLabel")+" "+this.nls("displayAllLayersResultTooltip"),title:this.nls("displayAllLayersResultTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-2 d-inline",children:(0,e.jsx)(M,{})})})]}),!this.props.activeDsSearchConfig.searchByActiveMapArea&&(0,e.jsxs)(s.SettingRow,{className:"ml-2",children:[(0,e.jsxs)(a.Label,{check:!0,centric:!0,className:"w-100 labelStyle",style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("enableProximitySearchLabel"),"data-testid":"enableProximitySearch",style:{cursor:"pointer"},className:"mr-2",checked:this.props.activeDsLayersConfig.enableProximitySearch,onChange:this.enableProximitySearchOptionChange.bind(this)}),this.nls("enableProximitySearchLabel")]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("enableProximitySearchLabel")+" "+this.nls("enableProximitySearchTooltip"),title:this.nls("enableProximitySearchTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-2 d-inline",children:(0,e.jsx)(M,{})})})]}),!this.props.activeDsSearchConfig.searchByActiveMapArea&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingRow,{className:"ml-2",children:[(0,e.jsxs)(a.Label,{check:!0,centric:!0,className:"w-100 labelStyle",style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("saveInputLocationLabel"),"data-testid":"saveInputLocation",style:{cursor:"pointer"},className:"mr-2",disabled:!(m.length||S.length||f.length),checked:null===(o=null===(i=this.props.activeDsLayersConfig)||void 0===i?void 0:i.saveFeatures)||void 0===o?void 0:o.saveInputLocation,onChange:this.enableSaveInputLocation.bind(this)}),this.nls("saveInputLocationLabel")]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("saveInputLocationLabel")+" "+this.nls("saveInputLocationTooltip"),title:this.nls("saveInputLocationTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-2 d-inline",children:(0,e.jsx)(M,{})})})]}),(null===(d=null===(l=this.props.activeDsLayersConfig)||void 0===l?void 0:l.saveFeatures)||void 0===d?void 0:d.saveInputLocation)&&(0,e.jsxs)(t.React.Fragment,{children:[m.length&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingRow,{className:"mt-3 ml-3",children:[(0,e.jsx)(te,{size:"m"}),(0,e.jsxs)(a.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"},children:[this.nls("point"),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("point"),title:this.nls("point"),checked:this.state.showPointFeature,onChange:this.onPointFeatureChange})]})]}),this.state.showPointFeature&&(0,e.jsx)(Be.DataSourceSelector,{className:"mt-3 mb-3 pl-3",types:this.supportedDsTypes,useDataSources:this.state.pointFeatureUseDs?(0,t.Immutable)([this.state.pointFeatureUseDs]):(0,t.Immutable)([]),fromRootDsIds:v.fromRootDsIds,fromDsIds:v.fromDsIds,mustUseDataSource:!0,onChange:this.pointDataSourceChangeSave,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideAddDataButton:!0,disableRemove:()=>!0,hideDataView:!0,useDataSourcesEnabled:!0})]}),S.length>0&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingRow,{className:"mt-1 ml-3",children:[(0,e.jsx)(oe,{size:"m"}),(0,e.jsxs)(a.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"},children:[this.nls("polyline"),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("polyline"),title:this.nls("polyline"),checked:this.state.showPolylineFeature,onChange:this.onPolylineFeatureChange})]})]}),this.state.showPolylineFeature&&(0,e.jsx)(Be.DataSourceSelector,{className:"mt-3 mb-3 pl-3",types:this.supportedDsTypes,useDataSources:this.state.polylineFeatureUseDs?(0,t.Immutable)([this.state.polylineFeatureUseDs]):(0,t.Immutable)([]),fromRootDsIds:x.fromRootDsIds,fromDsIds:x.fromDsIds,mustUseDataSource:!0,onChange:this.polylineDataSourceChangeSave,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideAddDataButton:!0,disableRemove:()=>!0,hideDataView:!0,useDataSourcesEnabled:!0})]}),f.length>0&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingRow,{className:"mt-1 ml-3",children:[(0,e.jsx)(de,{size:"m"}),(0,e.jsxs)(a.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"},children:[this.nls("polygon"),(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("polygon"),title:this.nls("polygon"),checked:this.state.showPolygonFeature,onChange:this.onPolygonFeatureChange})]})]}),this.state.showPolygonFeature&&(0,e.jsx)(Be.DataSourceSelector,{className:"mt-3 mb-3 pl-3",types:this.supportedDsTypes,useDataSources:this.state.polygonFeatureUseDs?(0,t.Immutable)([this.state.polygonFeatureUseDs]):(0,t.Immutable)([]),fromRootDsIds:F.fromRootDsIds,fromDsIds:F.fromDsIds,mustUseDataSource:!0,onChange:this.polygonDataSourceChangeSave,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideAddDataButton:!0,disableRemove:()=>!0,hideDataView:!0,useDataSourcesEnabled:!0})]})]}),f.length>0&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingRow,{className:"ml-2",children:[(0,e.jsxs)(a.Label,{check:!0,centric:!0,className:"w-100 labelStyle",style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("saveSearchAreaLabel"),style:{cursor:"pointer"},className:"mr-2",checked:null===(h=this.props.activeDsLayersConfig.saveFeatures.searchAreaFeature)||void 0===h?void 0:h.enabled,onChange:this.enableSaveSearchArea.bind(this)}),this.nls("saveSearchAreaLabel")]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("saveSearchAreaLabel")+" "+this.nls("saveSearchAreaTooltip"),title:this.nls("saveSearchAreaTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-2 d-inline",children:(0,e.jsx)(M,{})})})]}),(null===(p=this.props.activeDsLayersConfig.saveFeatures.searchAreaFeature)||void 0===p?void 0:p.enabled)&&(0,e.jsx)(Be.DataSourceSelector,{className:"mt-3 mb-3 pl-3",types:this.supportedDsTypes,useDataSources:this.state.searchAreaPolygonFeatureUseDs?(0,t.Immutable)([this.state.searchAreaPolygonFeatureUseDs]):(0,t.Immutable)([]),fromRootDsIds:F.fromRootDsIds,fromDsIds:F.fromDsIds,mustUseDataSource:!0,onChange:this.searchAreaPolygonDataSourceChangeSave,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideAddDataButton:!0,disableRemove:()=>!0,hideDataView:!0,useDataSourcesEnabled:!0})]})]})]})})}),(0,e.jsx)(s.SidePopper,{isOpen:this.state.showEditAnalysisPopper&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeEditAnalysisPopper.bind(this),trigger:null===(c=this.analysisLayersPopperTrigger)||void 0===c?void 0:c.current,backToFocusNode:this.state.popperFocusNode,title:this.nls("editAnalysis"),children:(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:r(this.props.theme),children:(0,e.jsx)(ke,{theme:this.props.theme,intl:this.props.intl,title:this.nls("editAnalysis"),ref:this.backRef,hideBackArrow:!0,showCloseIcon:!0,disableOkButton:this.state.disableSidePopperOkButton,onBack:this.closeEditAnalysisPopper,showOkButton:!0,onOkButtonClicked:this.editOkButtonCLick,children:(0,e.jsx)(Ye,{widgetId:this.props.widgetId,intl:this.props.intl,theme:this.props.theme,jimuMapView:this.props.jimuMapView,isActiveMapAreaSelected:this.state.searchActiveMapArea,isIncludeOutsideMapAreaSelected:this.state.includeOutsideMapArea,activeDs:this.props.selectedDs,analysisIndex:this.state.analysisIndex,availableFeatureLayer:this.allDsLayers,editCurrentLayer:this.state.editCurrentLayer,analysisList:this.state.newAddedLayerAnalysis,selectedLayerGeometry:this.state.selectedLayerGeometryType,onAnalysisUpdate:this.onAnalysisInfoUpdate,disableOkButton:this.onDisableOkButton})})})})]})}}var et=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function l(e){try{r(i.next(e))}catch(e){o(e)}}function n(e){try{r(i.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(l,n)}r((i=i.apply(e,t||[])).next())})};class tt extends i.BaseWidgetSetting{constructor(e){super(e),this.mvManager=o.MapViewManager.getInstance(),this.Color=null,this._mapLoadedTimer=null,this.nls=e=>{var t;const s=Object.assign({},l,a.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var e,s;let i;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const a=null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0];(null===(s=(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[a])?(i=!1,this.checkLayersAvailability(this.props.useMapWidgetIds)):(this.resetAnalysisLayersConfig(this.props.useMapWidgetIds),i=!0)}else i=!0;this.updateConfigForMapWidget(i)},this.componentDidUpdate=e=>{var s,i,a;let o;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const e=null===(s=this.props.useMapWidgetIds)||void 0===s?void 0:s[0];o=!(null===(i=(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===i?void 0:i[e])}else o=!0;if(this.setState({mapWidgetExists:!o,isNoMapSelected:o}),!t.lodash.isDeepEqual(this.props.useMapWidgetIds,e.useMapWidgetIds)){let e;(null===(a=this.props.useMapWidgetIds)||void 0===a?void 0:a.length)>0?(e=!1,this.checkLayersAvailability(this.props.useMapWidgetIds)):e=!0,this.updateConfigForMapWidget(e)}},this.onMapWidgetSelected=e=>{let s;if(e.length>0)s=!1,this.checkLayersAvailability(e);else{s=!0;const i=this.props.config.set("configInfo",{}),a={id:this.props.id,useMapWidgetIds:e,config:i};a.useDataSources=(0,t.Immutable)([]),this.props.onSettingChange(a,[])}this.updateConfigForMapWidget(s)},this.resetAnalysisLayersConfig=e=>{const s=this.props.config.set("configInfo",{});s.set("useMapWidget",e.length>0);const i={id:this.props.id,useMapWidgetIds:e,config:s};0===e.length?(i.useDataSources=(0,t.Immutable)([]),this.props.onSettingChange(i,[])):this.props.onSettingChange(i)},this.updateConfigForMapWidget=e=>{this.setState({mapWidgetExists:!e,isNoMapSelected:e})},this.setDefaultConfigForDataSource=(e,t)=>{if(!t.configInfo.hasOwnProperty(e)){const s=K;return s.searchSettings.headingLabel=this.nls("locationLabel"),t.setIn(["configInfo",e],s)}return t},this.waitForChildDataSourcesReady=e=>et(this,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const s=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==s?void 0:s.isDataSourceSet())&&!s.areChildDataSourcesCreated()?s.childDataSourcesReady().then(()=>s).catch(e=>s):Promise.resolve(s)}),this.checkLayersAvailability=e=>et(this,void 0,void 0,function*(){let s=this.props.config.configInfo?this.props.config:this.props.config.set("configInfo",{});const i=this.mvManager.getJimuMapViewGroup(e),a=this.getInitOutDataSource(s.configInfo);if(null==i?void 0:i.jimuMapViews){this._mapLoadedTimer&&clearTimeout(this._mapLoadedTimer);const l=[];for(const a in i.jimuMapViews)if(i.jimuMapViews[a].dataSourceId)if(i.jimuMapViews[a].status===t.JimuMapViewStatus.Loaded){const e=[],t=i.jimuMapViews[a].dataSourceId;s=this.setDefaultConfigForDataSource(t,s);const n=o.MapViewManager.getInstance().getJimuMapViewById(i.jimuMapViews[a].id);yield this.waitForChildDataSourcesReady(n).finally(()=>{const t=x(i.jimuMapViews[a].id);this.setState({isLayerAvailable:!0,jimuMapViewId:i.jimuMapViews[a].id}),(i.jimuMapViews[a].isActive||void 0===i.jimuMapViews[a].isActive)&&this.setState({activeDataSource:i.jimuMapViews[a].dataSourceId,mapView:i.jimuMapViews[a]}),t.forEach(t=>{var s;(null===(s=null==t?void 0:t.layerDefinition)||void 0===s?void 0:s.geometryType)&&e.push({layerDsId:t.id})});this.canAddDataSource(i.jimuMapViews[a].dataSourceId,l)&&l.push({label:this.getDataSourceLabel(i.jimuMapViews[a].dataSourceId),value:i.jimuMapViews[a].dataSourceId,isValid:t.length>0,availableLayers:e})})}else this._mapLoadedTimer=setTimeout(()=>{this.checkLayersAvailability(e)},50);else this.setState({isLayerAvailable:!1});this.setState({dataSources:l},()=>et(this,void 0,void 0,function*(){s=yield this.updateConfigAsPerNewWebMap(s),s=s.setIn(["generalSettings","noResultsFoundText"],this.props.config.generalSettings.noResultsFoundText?this.props.config.generalSettings.noResultsFoundText:this.nls("noDataMessageDefaultText")),s=s.setIn(["generalSettings","highlightColor"],this.props.config.generalSettings.highlightColor?this.props.config.generalSettings.highlightColor:this.props.theme2.sys.color.primary.dark),(0,o.loadArcGISJSAPIModules)(["esri/Color"]).then(i=>{var o,l;[this.Color]=i;const n=new i[0](s.generalSettings.highlightColor);n.a=.3;const r=new i[0](s.generalSettings.highlightColor);r.a=1;const d={type:"esriSFS",color:n,outline:{type:"esriSLS",color:r,width:1.5,style:"esriSLSSolid"},style:"esriSFSSolid"};s=s.setIn(["generalSettings","searchAreaSymbol"],(null===(l=null===(o=this.props.config.generalSettings)||void 0===o?void 0:o.searchAreaSymbol)||void 0===l?void 0:l.type)?this.props.config.generalSettings.searchAreaSymbol:d);const h={id:this.props.id,useMapWidgetIds:e,config:s,useDataSources:A(s.configInfo,this.state.dataSources)};0===(null==e?void 0:e.length)?(h.useDataSources=(0,t.Immutable)([]),this.props.onSettingChange(h,[])):this.props.onSettingChange(h,a)})}))}else this._mapLoadedTimer=setTimeout(()=>{this.checkLayersAvailability(e)},50)}),this.canAddDataSource=(e,t)=>{let s=!0;return t.some(t=>{t.value===e&&(s=!1)}),s},this.getDataSourceLabel=e=>{if(!e)return"";return f(e).getLabel()||e},this.updateConfigAsPerNewWebMap=e=>{var s,i,a;let o=[];const l=e.configInfo.asMutable({deep:!0}),n=e.configInfo.asMutable({deep:!0});if((null===(s=this.props.useMapWidgetIds)||void 0===s?void 0:s.length)>0){const e=this.mvManager.getJimuMapViewGroup(this.props.useMapWidgetIds[0]);if(null==e?void 0:e.jimuMapViews){for(const t in e.jimuMapViews)e.jimuMapViews[t].dataSourceId?o.push(e.jimuMapViews[t].dataSourceId):o=[];for(const e in l)o.includes(e)||delete l[e];for(const s in e.jimuMapViews){const o=e.jimuMapViews[s].dataSourceId;if(l[o]&&e.jimuMapViews[s].status===t.JimuMapViewStatus.Loaded){const t=x(e.jimuMapViews[s].id),r=[];t.forEach(e=>{r.push(e.id)}),null===(a=null===(i=l[o].analysisSettings)||void 0===i?void 0:i.layersInfo)||void 0===a||a.forEach(e=>{if(!r.includes(e.useDataSource.mainDataSourceId)||e.useDataSource.dataViewId&&!r.includes(e.useDataSource.mainDataSourceId)){const t=n[o].analysisSettings.layersInfo,s=t.findIndex(t=>t.useDataSource.dataSourceId===e.useDataSource.dataSourceId);s>-1&&t.splice(s,1)}})}}}}return e.set("configInfo",(0,t.Immutable)(n))},this.showDsPanel=e=>{this.setState({activeDataSource:e,isAnalysisSettingsOpen:!1},()=>{this.setState({isAnalysisSettingsOpen:!0})})},this.isDataSourceValid=e=>{if(0===this.state.dataSources.length)return{isValid:!1,invalidMessage:this.nls("warningMsgIfNoLayersOnMap")};const s=t.DataSourceManager.getInstance().getDataSource(e),i=this.dataSourceHasValidLayers(e);return(null==s?void 0:s.isDataSourceSet())&&(null==s?void 0:s.getChildDataSources().length)>0&&i?{isValid:!0}:{isValid:!1,invalidMessage:this.nls("warningMsgIfNoLayersOnMap")}},this.onCloseDataItemPanel=()=>{this.setState({showDataItemPanel:!1}),this.index=0},this.onToggleGeneralSettings=()=>{this.setState({isGeneralSettingsOpen:!this.state.isGeneralSettingsOpen})},this.updateGeneralSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings",e],t)})},this.updateSearchSettings=(e,t,s)=>{let i;i=s?this.props.config.setIn(["configInfo",this.state.activeDataSource,"searchSettings"],t):this.props.config.setIn(["configInfo",this.state.activeDataSource,"searchSettings",e],t),this.props.onSettingChange({id:this.props.id,config:i}),this.updateOutputDS(i)},this.updateAnalysisSettings=(e,t,s)=>{let i;i=s?this.props.config.setIn(["configInfo",this.state.activeDataSource,"analysisSettings","saveFeatures",e],t):this.props.config.setIn(["configInfo",this.state.activeDataSource,"analysisSettings",e],t),this.updateOutputDS(i)},this.updateOutputDS=e=>{const t=this.getInitOutDataSource(e.configInfo);this.props.onSettingChange({id:this.props.id,config:e,useDataSources:A(e.configInfo,this.state.dataSources)},t)},this.getInitOutDataSource=e=>{var s,i;if(!this.props.useMapWidgetIds||0===this.props.useMapWidgetIds.length)return[];try{const a=[];for(const o in e){const l=null==e?void 0:e[o].searchSettings.searchByActiveMapArea;null===(i=null===(s=null==e?void 0:e[o])||void 0===s?void 0:s.analysisSettings.layersInfo)||void 0===i||i.forEach((e,s)=>{var i,o,n,r,d;const p=e.label+" ("+this.nls(e.analysisInfo.analysisType)+")",c=t.DataSourceManager.getInstance(),u=null==c?void 0:c.getDataSource(e.useDataSource.dataSourceId),y=null!==(i=e.analysisInfo.analysisId)&&void 0!==i?i:s.toString();let g,m;if(e.analysisInfo.analysisType===h.Summary)g=this.getInitSchema(p,e.analysisInfo.summaryFields);else if(u){g=u.getSchema();let t=[];t=(null===(n=null===(o=e.analysisInfo)||void 0===o?void 0:o.fieldsToExport)||void 0===n?void 0:n.length)>0?e.analysisInfo.fieldsToExport:L(e.useDataSource.dataSourceId),m=Object.keys(null==g?void 0:g.fields).filter(e=>t.includes(e)).reduce((e,t)=>(e[t]=null==g?void 0:g.fields[t],e),{})}if(g){const s={id:w(this.props.widgetId,e.analysisInfo.analysisType,y),type:t.DataSourceTypes.FeatureLayer,label:p,isOutputFromWidget:!0,schema:{idField:g.idField,fields:m||g.fields},geometryType:u.getGeometryType()};e.analysisInfo.analysisType!==h.Summary&&(null===(r=null==e?void 0:e.analysisInfo)||void 0===r?void 0:r.includeApproxDistance)&&(s.schema.fields.esriCTApproxDistance={alias:this.nls("showDistFromInputLoc"),esriType:t.EsriFieldType.String,format:null,type:t.JimuFieldType.String,jimuName:"esriCTApproxDistance",name:"esriCTApproxDistance"}),!l&&e.analysisInfo.analysisType===h.Proximity&&(null===(d=null==e?void 0:e.analysisInfo)||void 0===d?void 0:d.clipFeatures)&&(s.schema.fields.esriCTClippedInfo={alias:this.nls("clippedInfoLabel"),esriType:t.EsriFieldType.Double,format:{digitSeparator:!0,places:2},type:t.JimuFieldType.Number,jimuName:"esriCTClippedInfo",name:"esriCTClippedInfo"}),a.push(s)}})}return a}catch(e){return console.warn("Failed to create output data source in near me widget. ",e),[]}},this.getInitSchema=(e="",s)=>{const i={},a=[{alias:"OBJECTID",type:t.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"},{alias:this.nls("count"),type:t.JimuFieldType.Number,jimuName:"esriCTCOUNT",name:"esriCTCOUNT"}];return s.forEach(e=>{const s=e.fieldLabel.replace(/ /g,"");a.push({alias:e.fieldLabel,type:t.JimuFieldType.String,jimuName:s,name:s})}),null==a||a.forEach((e,t)=>{0===t?i.OBJECTID=e:"esriCTCOUNT"===(null==e?void 0:e.name)?i.esriCTCOUNT=e:i[null==e?void 0:e.jimuName]=e}),{label:e,idField:"OBJECTID",fields:i}},this.dataSourceHasValidLayers=e=>{var t;if(e){const s=null===(t=this.state.dataSources)||void 0===t?void 0:t.filter(t=>t.value===e&&t.availableLayers.length);return(null==s?void 0:s.length)>0}return!1},this.index=0,this.state={dataSources:[],showDataItemPanel:!1,dataSourceName:"",isNoMapSelected:!0,mapWidgetExists:!0,isAnalysisSettingsOpen:!1,isGeneralSettingsOpen:!0,isOutputSettingsOpen:!0,isLayerAvailable:!1,activeDataSource:null,popperFocusNode:null,jimuMapViewId:"",mapView:null}}render(){var i,o,l,n,r,d,h,p,c;const u=null===(l=null===(i=(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===i?void 0:i[null===(o=this.props.useMapWidgetIds)||void 0===o?void 0:o[0]])||void 0===l?void 0:l.useDataSources,g=null===(r=null===(n=this.props.config.configInfo)||void 0===n?void 0:n[this.state.activeDataSource])||void 0===r?void 0:r.asMutable({deep:!0}),m=[{value:"none",name:this.nls("none")}];return(null===(d=null==g?void 0:g.searchSettings.sketchTools)||void 0===d?void 0:d.showPoint)&&m.push({value:"point",name:this.nls("point")}),(null===(h=null==g?void 0:g.searchSettings.sketchTools)||void 0===h?void 0:h.showPolyline)&&m.push({value:"polyline",name:this.nls("polyline")}),(null===(p=null==g?void 0:g.searchSettings.sketchTools)||void 0===p?void 0:p.showPolygon)&&m.push({value:"polygon",name:this.nls("polygon")}),(0,e.jsx)("div",{css:(S=this.props.theme,t.css`
    .widget-setting-near-me {
      height: 100%;

      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }

      .nearme-analysis-tooltip {
        margin-bottom: 0rem!important;
        width: 177px;
      }

      .placeholder-container {
        height: calc(100% - 180px);

        .placeholder {
          flex-direction: column;

          .icon {
            color: var(--ref-palette-neutral-800);
          }

          .hint {
            font-size: ${t.polished.rem(14)};
            font-weight: 500;
            color: var(--ref-palette-neutral-1000);
            max-width: ${t.polished.rem(160)};
          }
        }
      }

      .color-label {
        color: ${S.ref.palette.neutral[900]};
      }

      .jimu-tree {
        width: 100%;
      }

      .data-item {
        display: flex;
        flex: 1;
        padding: 0.5rem 0.6rem;
        line-height: 23px;
        cursor: pointer;

        .data-item-name {
          word-break: break-word;
        }
      }
    }
  `),className:"h-100",children:(0,e.jsxs)("div",{className:"widget-setting-near-me",children:[(0,e.jsxs)(s.SettingSection,{className:(0,t.classNames)("map-selector-section",{"border-0":this.state.isNoMapSelected&&!(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0)}),children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",title:this.nls("selectMapWidgetLabel"),children:this.nls("selectMapWidgetLabel")})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(s.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds})}),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&!((null==u?void 0:u.length)>0)&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.Alert,{tabIndex:0,style:{minWidth:"auto"},onClose:()=>null,open:!((null==u?void 0:u.length)>0),text:this.nls("warningMsgIfNoLayersOnMap"),type:"warning"})})]}),this.state.isNoMapSelected&&!(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0)&&(0,e.jsx)("div",{className:"d-flex placeholder-container justify-content-center align-items-center",children:(0,e.jsxs)("div",{className:"d-flex text-center placeholder justify-content-center align-items-center ",children:[(0,e.jsx)(y,{size:48,className:"d-flex icon mb-2"}),(0,e.jsx)("p",{className:"hint",children:this.nls("selectMapHint")})]})}),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&this.state.isLayerAvailable&&(null==u?void 0:u.length)>0&&(null==g?void 0:g.searchSettings)&&(null==g?void 0:g.analysisSettings)&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingSection,{children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("analysisSettingsLabel"),title:this.nls("analysisSettingsLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label title2 hint-paper",children:this.nls("analysisSettingsLabel")})})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("mapSettingsHintMsg"),className:"font-italic w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("mapSettingsHintMsg")})})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)("div",{className:"w-100",children:this.state.dataSources.length>0&&(0,e.jsx)(s.MultipleJimuMapConfig,{mapWidgetId:null===(c=this.props.useMapWidgetIds)||void 0===c?void 0:c[0],onClick:this.showDsPanel,isDataSourceValid:this.isDataSourceValid,sidePopperContent:this.state.isAnalysisSettingsOpen&&(0,e.jsx)(t.React.Fragment,{children:(0,e.jsxs)(s.SettingSection,{children:[(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("defineSearchAreaLabel"),title:this.nls("defineSearchAreaLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title2 text-paper",children:this.nls("defineSearchAreaLabel")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("defineSearchAreaLabel")+" "+this.nls("defineSearchAreaTooltip"),title:this.nls("defineSearchAreaTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(M,{})})})]}),(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(he,{intl:this.props.intl,theme:this.props.theme2,config:null==g?void 0:g.searchSettings,onWidgetLoadOptions:m,onSearchSettingsUpdated:this.updateSearchSettings})}),(0,e.jsxs)(s.SettingRow,{className:"border-top pt-3",children:[(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("analysisLabel"),title:this.nls("analysisLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title2 text-paper",children:this.nls("analysisLabel")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("analysisLabel")+" "+this.nls("configureAnalysisTooltip"),title:this.nls("configureAnalysisTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(M,{})})})]}),(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(Xe,{widgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,jimuMapView:this.state.mapView,selectedDs:this.state.activeDataSource,activeDsSearchConfig:null==g?void 0:g.searchSettings,activeDsLayersConfig:null==g?void 0:g.analysisSettings,allFeatureLayers:this.state.dataSources,useDataSourceConfig:this.props.useDataSources,onAnalysisSettingsUpdated:this.updateAnalysisSettings})})]})})})})})]}),(0,e.jsx)(s.SettingSection,{children:(0,e.jsx)(a.CollapsablePanel,{label:this.nls("generalSettingsLabel"),"aria-label":this.nls("generalSettingsLabel"),isOpen:this.state.isGeneralSettingsOpen,onRequestOpen:()=>{this.onToggleGeneralSettings()},onRequestClose:()=>{this.onToggleGeneralSettings()},children:(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(V,{intl:this.props.intl,theme:this.props.theme2,config:this.props.config.generalSettings,onGeneralSettingsUpdated:this.updateGeneralSettings})})})})]})]})});var S}}function st(e){m.p=e}})(),S})())}}});