/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core/emotion","jimu-arcgis","jimu-core","jimu-ui","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/Color","esri/symbols/support/jsonUtils","esri/core/reactiveUtils","esri/geometry/SpatialReference","esri/rest/locator","esri/geometry/Polygon","esri/widgets/Features","esri/geometry/operators/unionOperator","esri/geometry/operators/equalsOperator","esri/geometry/operators/intersectionOperator","esri/geometry/operators/geodeticAreaOperator","esri/geometry/operators/areaOperator","esri/geometry/operators/geodeticLengthOperator","esri/geometry/operators/geodesicProximityOperator","esri/geometry/operators/lengthOperator","esri/widgets/FeatureForm","esri/layers/FeatureLayer","jimu-theme","esri/core/workers/workers"],function(e,t){var s={},i={},a={},o={},n={},r={},l={},d={},c={},u={},h={},p={},g={},y={},f={},m={},v={},b={},S={},w={},x={},I={},F={},A={},D={},C={};return{setters:[function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.MapViewManager=e.MapViewManager,i.geometryUtils=e.geometryUtils,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){a.BaseWidget=e.BaseWidget,a.CONSTANTS=e.CONSTANTS,a.DataActionManager=e.DataActionManager,a.DataLevel=e.DataLevel,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.ExpressionResolverComponent=e.ExpressionResolverComponent,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.MessageManager=e.MessageManager,a.MessageType=e.MessageType,a.MultipleDataSourceComponent=e.MultipleDataSourceComponent,a.MutableStoreManager=e.MutableStoreManager,a.OrderRule=e.OrderRule,a.React=e.React,a.ReactResizeDetector=e.ReactResizeDetector,a.UrlManager=e.UrlManager,a.WidgetState=e.WidgetState,a.WidgetVersionManager=e.WidgetVersionManager,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.defaultMessages=e.defaultMessages,a.geometryUtils=e.geometryUtils,a.getAppStore=e.getAppStore,a.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.lodash=e.lodash,a.urlUtils=e.urlUtils,a.utils=e.utils},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Collapse=e.Collapse,o.ConfirmDialog=e.ConfirmDialog,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.Icon=e.Icon,o.Label=e.Label,o.Loading=e.Loading,o.LoadingType=e.LoadingType,o.NumericInput=e.NumericInput,o.Option=e.Option,o.Paper=e.Paper,o.Row=e.Row,o.Select=e.Select,o.Surface=e.Surface,o.Switch=e.Switch,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.Typography=e.Typography,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages,o.richTextUtils=e.richTextUtils},function(e){n.default=e.default},function(e){r.default=e.default},function(e){l.default=e.default},function(e){d.default=e.default},function(e){c.fromJSON=e.fromJSON},function(e){u.watch=e.watch,u.when=e.when},function(e){h.default=e.default},function(e){p.locationToAddress=e.locationToAddress},function(e){g.default=e.default},function(e){y.default=e.default},function(e){f.executeMany=e.executeMany},function(e){m.execute=e.execute},function(e){v.execute=e.execute},function(e){b.execute=e.execute,b.isLoaded=e.isLoaded,b.load=e.load},function(e){S.execute=e.execute},function(e){w.execute=e.execute,w.isLoaded=e.isLoaded,w.load=e.load},function(e){x.isLoaded=e.isLoaded,x.load=e.load},function(e){I.execute=e.execute},function(e){F.default=e.default},function(e){A.default=e.default},function(e){D.colorUtils=e.colorUtils,D.getAppThemeVariables=e.getAppThemeVariables},function(e){C.default=e.default}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=D},8968:e=>{"use strict";e.exports=c},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},10624:e=>{"use strict";e.exports=l},11092:e=>{"use strict";e.exports=C},14321:e=>{"use strict";e.exports=o},15710:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.086 2H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V4.914zM3 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4.914a1 1 0 0 0-.293-.707l-2.914-2.914A1 1 0 0 0 11.086 1zm6.875 3H4v2h5.875zM4 3a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h5.875a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm6.048 7.5a1.548 1.548 0 1 1-3.096 0 1.548 1.548 0 0 1 3.096 0M8.5 13a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5" clip-rule="evenodd"></path></svg>'},18717:e=>{"use strict";e.exports=b},20320:e=>{"use strict";e.exports=p},21625:e=>{"use strict";e.exports=f},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},22089:e=>{"use strict";e.exports=n},23938:e=>{"use strict";e.exports=y},24883:e=>{"use strict";e.exports=v},27442:e=>{"use strict";e.exports=d},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},31526:e=>{"use strict";e.exports=g},33142:e=>{"use strict";e.exports=x},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},42588:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 4.429V15h14V1L6.833 7.857zM14 3v11H2V6.114l4.182 2.51a1.2 1.2 0 0 0 1.398-.118z" clip-rule="evenodd"></path></svg>'},42735:e=>{"use strict";e.exports=m},43751:e=>{"use strict";e.exports=S},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},46420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},46942:(e,t)=>{var s;!function(){"use strict";var i={}.hasOwnProperty;function a(){for(var e="",t=0;t<arguments.length;t++){var s=arguments[t];s&&(e=n(e,o(s)))}return e}function o(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return a.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var s in e)i.call(e,s)&&e[s]&&(t=n(t,s));return t}function n(e,t){return t?e?e+" "+t:e+t:e}e.exports?(a.default=a,e.exports=a):void 0===(s=function(){return a}.apply(t,[]))||(e.exports=s)}()},52349:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><g fill="#000" clip-path="url(#clip0_8058_7448)"><path fill-rule="evenodd" d="M10 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m0-1a1 1 0 1 0 0-2 1 1 0 0 0 0 2" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M5 4.988c0 1.997 2.955 5.636 4.344 7.25l.068.08c.212.245.383.438.494.563l.1.113L10 13c.065.065.062.06.005-.006.04-.042.292-.31.665-.731l.012-.014C12.05 10.697 15 7.105 15 4.989A4.994 4.994 0 0 0 10 0C7.239 0 5 2.233 5 4.988m5.029 6.49-.01.01a44 44 0 0 1-1.49-1.834c-.65-.85-1.302-1.781-1.786-2.65C6.236 6.093 6 5.402 6 4.987 6 2.788 7.789 1 10 1s4 1.788 4 3.988c0 .434-.213 1.098-.664 1.944-.434.816-1.026 1.685-1.635 2.493a37 37 0 0 1-1.672 2.052" clip-rule="evenodd"></path><path d="M0 14c0-2.273 2.107-4.251 5.213-5.269q.257.443.526.882c-.86.265-1.635.605-2.296 1.002C1.794 11.605 1 12.832 1 14s.794 2.396 2.443 3.385C5.073 18.363 7.39 19 10 19s4.927-.637 6.557-1.615C18.206 16.395 19 15.168 19 14s-.794-2.395-2.443-3.385a10.4 10.4 0 0 0-2.211-.976q.265-.438.517-.883C17.927 9.781 20 11.746 20 14c0 3.314-4.477 6-10 6S0 17.314 0 14"></path><path fill-rule="evenodd" d="M6 14.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m-1 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0M15.5 16a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m0-1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1M11.5 16.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m-1 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0" clip-rule="evenodd"></path></g><defs><clipPath id="clip0_8058_7448"><path fill="#fff" d="M0 0h20v20H0z"></path></clipPath></defs></svg>'},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},53205:e=>{"use strict";e.exports=h},57687:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><g fill="#000" clip-path="url(#clip0_24_51)"><path d="M8 16a8 8 0 0 0 3.425-.768 2 2 0 0 1-.4-.917 7 7 0 0 1-9.699-8.431 2 2 0 0 1-.855-.595A8 8 0 0 0 8 16M16 8a7.96 7.96 0 0 1-1.505 4.672 2 2 0 0 0-.83-.559A7 7 0 0 0 3.48 2.655a2 2 0 0 0-.875-.562A8 8 0 0 1 16 8M2 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2"></path><path d="M11 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2"></path><path fill-rule="evenodd" d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4m1-2a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path><path d="M14 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0M8 13a5 5 0 0 0 4.643-6.86 2 2 0 0 1-.819.683 4 4 0 1 1-2.647-2.647c.15-.33.387-.614.682-.819A5 5 0 1 0 8 13"></path></g><defs><clipPath id="clip0_24_51"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'},59028:e=>{"use strict";e.exports=w},59620:e=>{"use strict";e.exports=r},62243:e=>{"use strict";e.exports=u},62686:e=>{"use strict";e.exports=i},66884:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1 1v14h14V1zm9.082 13c-.005-.037-.113-.274-.122-.309a1.5 1.5 0 0 0 .718-1.267 1.2 1.2 0 0 0-.053-.358c.152-.176.263-.383.326-.607q.046.003.093.003c.3.002.593-.091.836-.266q.06.066.126.124c.42.412.977.654 1.564.68H14v2h-3.918M14 11h-.43a1.46 1.46 0 0 1-.906-.433c-.264-.23-.258-.782-.617-.782-.482 0-.52.677-1.003.677-.219 0-.38-.177-.599-.177-.193 0-.445.102-.445.293v.502c0 .424-.506.508-.506.934 0 .171.184.236.184.41 0 .58-.893.502-.893 1.08 0 .191.215.305.215.486V14H6.375q.087-.243.09-.502c0-.547-1.043-.393-1.207-.72-.407-.813.693-1.022.693-1.673 0-.16-.082-.488-.334-.513-.351-.035-.443.154-.797.154a.406.406 0 0 1-.437-.36c0-.386.308-.566.308-.952 0-.25-.102-.393-.102-.643a.62.62 0 0 1 .59-.643c.323 0 .464.264.618.54a.64.64 0 0 0 .617.308c.49 0 .798-.61.798-.977a.47.47 0 0 1 .437-.488c.347 0 .476.36.824.36.57 0 .55-.756 1.053-1.03.618-.332.438-1.052.36-1.44-.032-.169.29-.5.464-.487.72.05.412-.54.412-.823q0-.073.022-.142c.111-.332.595-.438.595-.836 0-.281-.233-.41-.233-.693a.65.65 0 0 1 .22-.44H14zM2 14V2h8.278c-.013.077-.132.356-.132.44 0 .194.038.387.112.567a1.6 1.6 0 0 0-.422.643 1.4 1.4 0 0 0-.074.442 1.7 1.7 0 0 0-.536.43 1.32 1.32 0 0 0-.32 1.091q.046.205.066.414a2 2 0 0 0-.649.67 1.46 1.46 0 0 0-.674-.166 1.45 1.45 0 0 0-1.383 1.086 1.44 1.44 0 0 0-1.086-.469 1.62 1.62 0 0 0-1.591 1.643c0 .254.113.293.084.574s-.29.535-.29 1.022a1.37 1.37 0 0 0 .984 1.29 1.58 1.58 0 0 0-.003 1.549c.143.286.636.774.534.774z"></path></svg>'},67386:e=>{"use strict";e.exports=s},68269:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M10 2a2 2 0 1 0-4 0H5v2h6V2z"></path><path fill="#000" d="M2 3h2v1H3v11h10V4h-1V3h2v13H2z"></path><path fill="#000" d="M12 6v1H4V6zM4 9v1h8V9zM12 12v1H4v-1z"></path></svg>'},71082:e=>{"use strict";e.exports=I},73387:e=>{"use strict";e.exports=F},74919:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7 2h2a2 2 0 0 1 2 2v7.817l-3 2.812-3-2.812V4a2 2 0 0 1 2-2m5 2v8.25L8 16l-4-3.75V4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3M9 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=a},85633:e=>{"use strict";e.exports=A},86058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.582 5 11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2z"></path></svg>'},86823:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.5 7a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m0-1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5M7 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-1 0a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-1 0a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0M16 3.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-1 0a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0" clip-rule="evenodd"></path></svg>'},96807:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><g fill="#000" clip-path="url(#clip0_24_45)"><path fill-rule="evenodd" d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4m1-2a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path><path d="M12 8a4 4 0 1 1-2.655-3.768c.183-.31.432-.578.727-.784a5 5 0 1 0 2.905 4.07c-.286.209-.617.359-.977.432z"></path><path d="M11.5 7a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"></path><path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0" clip-rule="evenodd"></path></g><defs><clipPath id="clip0_24_45"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'}},t={};function L(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,L),a.exports}L.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return L.d(t,{a:t}),t},L.d=(e,t)=>{for(var s in t)L.o(t,s)&&!L.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},L.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),L.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},L.p="";var M={};return L.p=window.jimuConfig.baseUrl,(()=>{"use strict";L.r(M),L.d(M,{__set_webpack_public_path__:()=>Et,default:()=>Bt});var e,t=L(67386),s=L(62686),i=L(79244),a=L(14321);!function(e){e.Closest="closest",e.Proximity="proximity",e.Summary="summary"}(e||(e={}));const o={_widgetLabel:"Near Me",_widgetDescription:"A widget to locate and analyze features within a specified distance of a defined location or the current extent of the map.",_action_locate_label:"Set location",mapLoadingMsg:"Please wait while the map is loading",meters:"Meters",metersAbbreviation:"m",feet:"Feet",feetAbbreviation:"ft",kilometers:"Kilometers",kilometersAbbreviation:"km",miles:"Miles",milesAbbreviation:"mi",yards:"Yards",yardsAbbreviation:"yd",bufferDistance:"Distance",closestAddress:"Input location",noDataMessageDefaultText:"No results found.",noValueForDisplayField:"No value",warningMsgIfNoLayersOnMap:"This map does not contain any feature layers. Select a map with at least one feature layer.",noAnalysisLayerMsg:"Analysis is not configured for layers in this map.",noClosestAddressMsg:"No address found at this location.",analysisTakingLongerMsg:"The analysis is taking longer than expected...",point:"Point",polyline:"Polyline",polygon:"Polygon",searchByActiveMapArea:"Search by map area",updateResultsLabel:"Update results",exportBtnTitle:"Export",exportToPdf:"Export to PDF",mergeRowsLabel:"Merge rows for groups and subgroups",mergeRowsTooltip:"Merge rows for each groups and sub groups to create row span when groups are configured",a3Portrait:"A3 Portrait",a3Landscape:"A3 Landscape",a4Portrait:"A4 Portrait",a4Landscape:"A4 Landscape",letterAnsiAPortrait:"Letter ANSI A Portrait",letterAnsiALandscape:"Letter ANSI A Landscape",tabloidAnsiBPortrait:"Tabloid ANSI B Portrait",tabloidAnsiBLandscape:"Tabloid ANSI B Landscape",areaOfInterestLabel:"Area of Interest (AOI) Information",aoiValueLabel:"Area: {areaValue}",dateValueLabel:"Date: {dateValue}",defaultReportTitle:"Near Me Report",reportDimensionsMsg:"This report is designed to be printed on {paperSize} Paper",unableToPrintMapMsg:"An error occurred while printing the map(s).",totalCountLabel:"{tableTitle} | Total count: {total}",closest:"Closest",proximity:"Proximity",summary:"Summary",closestApproxDistance:"Closest Approximate Distance",mapExtentChangeInfoMsg:"The current map extent has changed. Click Update results to update the analysis.",timeoutNoResultMessage:"The number of results exceeds the limit and cannot be displayed.",timeoutTryAgainMessage:"The number of results exceeds the limit. Try a smaller area and click Update results.",approximateDistance:"Approximate Distance",ariaLabelString:"{label} {formattedDist} {distUnit}",distanceUnitLabel:"{distanceLabel} {unitLabel}",summaryIntersectValueAndUnit:"{summaryIntersectValue} {unitLabel}",refreshTooltip:"Refresh",showMoreBtnTitle:"Show More",loadingText:"Analyzing...",promptTitleMessageFromDataAction:"Are you sure that you want to analyze all the features in {layerName}?",promptBottomMessageFromDataAction:"Results may not be immediate and could take a while.",okButtonLabel:"Proceed",queryAbortedMsg:"Query Aborted",stopQueryProgressMsg:"Querying features now...Click to stop the query progress",submit:"Submit",saveTooltip:"Save",saveInputLocationLabel:"Save input location to {layerName}",saveSearchAreaLabel:"Save search area to {layerName}",formSubmissionFailedMsg:"Form submission failed",clippedLengthLabel:"Intersected Length: {value} {unit}",clippedAreaLabel:"Intersected Area: {value} {unit}",lengthUnitLabel:"Intersected Length ({unitLabel})",areaUnitLabel:"Intersected Area ({unitLabel})",areaUnitForDSColumn:"Intersected Area (sq {unitLabel})"};function n(e,t,s,a,o,n){const r=e.sys.color.surface.paper;return i.css`
  background-color: ${r};
    .widget-near-me {
      width: 100%;
      height: 100%;
      padding: ${n?"0":"5px"};
      overflow: auto;
    }

    .layerContainer {
      max-height: ${t};
      overflow: auto;
      width: 100%;
      padding: 8px
    }

    .layer-Container {
      margin-bottom: 10px;
    }

    .shadow-none {
      box-shadow: none !important;
    }

    .card {
      width: 96% !important;
      margin: auto;
      margin-bottom: 0.4rem !important;
    }

    .applyTextStyle {
      font-family: ${s.fontFamily};
      font-weight: ${s.fontBold?"bold":""};
      font-style: ${s.fontItalic?"italic":""};
      text-decoration: ${s.fontUnderline?"underline":""};
      text-decoration: ${s.fontStrike?"line-through":""};
      color: ${s.fontColor};
      font-size: ${s.fontSize};
      white-space: pre-wrap;
    }

    .applyPromptTextStyle {
      font-family: ${a.fontFamily};
      font-weight: ${a.fontBold?"bold":""};
      font-style: ${a.fontItalic?"italic":""};
      text-decoration: ${a.fontUnderline?"underline":""};
      text-decoration: ${a.fontStrike?"line-through":""};
      color: ${a.fontColor};
      font-size: ${a.fontSize};
      white-space: pre-wrap;
    }

    .headingLabelStyle {
      font-family: ${null==o?void 0:o.fontFamily};
      font-weight: ${(null==o?void 0:o.fontBold)?"bold":""};
      font-style: ${(null==o?void 0:o.fontItalic)?"italic":""};
      text-decoration: ${(null==o?void 0:o.fontUnderline)?"underline":""};
      text-decoration: ${(null==o?void 0:o.fontStrike)?"line-through":""};
      color: ${null==o?void 0:o.fontColor};
      font-size: ${null==o?void 0:o.fontSize};
      margin: 0 !important;
      white-space: pre-wrap;
    }

    .map-loading-text {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      text-align: center;
      transform: translate(-50%, 50%);
      font-size: ${e.sys.typography.body.fontSize};
      color: ${e.sys.color.surface.paperText};
    }

    .loading-text {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      z-index: 3000;
      text-align: center;
      transform: translate(-50%, 50%);
      font-size: ${e.sys.typography.body.fontSize};
      color: ${e.sys.color.surface.paperText};
    }

    .cancel-button-pos {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, 40px);
    }

    .main-row {
      display: ${n?"none":""}
    }
  `}function r(e,t){return i.css`
    .main-row {
      flex-wrap: wrap;
      display: flex;
    }

    .closestAddressheadingLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .locate-incident {
      min-width: 140px;
      width: ${t?"50%":"100%"};
    }

    .buffer-distance {
      min-width: 140px;
      width: ${t?"50%":"100%"};
      align-items: center;
    }

    .hidden {
      display: none;
    }
  `}var l=L(30655),d=L.n(l),c=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const u=e=>{const s=window.SVG,{className:a}=e,o=c(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:d()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var h=L(52943),p=L.n(h),g=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const y=e=>{const s=window.SVG,{className:a}=e,o=g(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:p()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var f=L(46420),m=L.n(f),v=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const b=e=>{const s=window.SVG,{className:a}=e,o=v(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:m()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var S=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const w=e=>i.DataSourceManager.getInstance().getDataSource(e);var x;!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(x||(x={}));const I=e=>{switch(e){case"feet":return x.Feet;case"miles":return x.Miles;case"kilometers":return x.Kilometers;case"meters":return x.Meters;case"yards":return x.Yards;default:return 1e3}},F=e=>{let t=null;const a=[];let o=!1;const n=s.MapViewManager.getInstance().getJimuMapViewById(e).getAllJimuLayerViews();return null==n||n.forEach(e=>{if(t=w(e.layerDataSourceId),t)if((null==t?void 0:t.type)===i.DataSourceTypes.MapService||(null==t?void 0:t.type)===i.DataSourceTypes.GroupLayer||(null==t?void 0:t.type)===i.DataSourceTypes.SubtypeGroupLayer){const e=t=>{t.getChildDataSources().forEach(t=>{(null==t?void 0:t.type)===i.DataSourceTypes.MapService||(null==t?void 0:t.type)===i.DataSourceTypes.GroupLayer||(null==t?void 0:t.type)===i.DataSourceTypes.SubtypeGroupLayer?e(t):(null==t?void 0:t.type)!==i.DataSourceTypes.FeatureLayer&&(null==t?void 0:t.type)!==i.DataSourceTypes.SubtypeSublayer||a.push(t)})};e(t)}else if((null==t?void 0:t.type)===i.DataSourceTypes.FeatureLayer||(null==t?void 0:t.type)===i.DataSourceTypes.SubtypeSublayer)if(a.length>0){a.find(e=>e.id===t.id)||(o=!0),o&&a.push(t)}else a.push(t)}),a},A=(e,t)=>{let s=e;return"string"==typeof s&&(s=s.trim()),[null,void 0,""].includes(s)?t:s},D=()=>{const e=(0,i.getAppStore)().getState().portalSelf;return"english"===(null==e?void 0:e.units)?"miles":"kilometers"},C=e=>{const t={searchByLocation:!1,searchCurrentExtent:!1,showAllFeatures:!1};if(e){const{searchByActiveMapArea:s,includeFeaturesOutsideMapArea:i}=e;s?i?t.showAllFeatures=!0:t.searchCurrentExtent=!0:t.searchByLocation=!0}return t},T=(e,t,s)=>`${e}_output_${t}_${s}`,j=(e,t)=>S(void 0,void 0,void 0,function*(){const s=yield(0,i.loadArcGISJSAPIModule)("esri/symbols/support/symbolUtils");s.getDisplayedSymbol(e.feature).then(i=>S(void 0,void 0,void 0,function*(){var a,o;i.size>23&&i.set("size",23),"esriGeometryPoint"===(null===(a=e.dataSource)||void 0===a?void 0:a.getGeometryType())&&(i.height||i.width)&&(i.height<15&&i.set("height",15),i.width<15&&i.set("width",15));const n=document.createElement("div");if(n.className="w-100 h-100 d-flex justify-content-center align-items-center",yield s.renderPreviewHTML(i,{node:n}),t.current.innerHTML&&(t.current.innerHTML=""),null===(o=n.children)||void 0===o?void 0:o.length){const e=n.children[0];if(e){const s=Number(e.getAttribute("height")),i=Number(e.getAttribute("width"));i>30&&e.setAttribute("width","30"),e.setAttribute("viewBox",`0 0 ${i} ${s}`),t.current.appendChild(n)}}}))}),O=e=>{const t=w(e),s=t&&t.getSchema(),i=(null==s?void 0:s.fields)?Object.values(null==s?void 0:s.fields):[],a=[];return i&&i.length>0&&i.forEach(e=>{a.push(e.jimuName)}),a},R=(t,s)=>{const i=t;let a=[];a||(a=[]);let o=[];s&&(o=s.map(e=>e.value));for(const t in i)if(!s||o.includes(t)){const s=i[t].analysisSettings.layersInfo,o=i[t].analysisSettings.saveFeatures;if(null==s||s.forEach(s=>{var i,o,n,r,l,d,c,u,h;const p=s.analysisInfo,g=a.filter(e=>e.dataSourceId===s.useDataSource.dataSourceId);let y=(null==g?void 0:g.length)>0?g[0]:{dataSourceId:s.useDataSource.dataSourceId,mainDataSourceId:s.useDataSource.mainDataSourceId,rootDataSourceId:t,fields:[]};s.useDataSource.dataViewId&&(y={dataSourceId:s.useDataSource.dataSourceId,mainDataSourceId:s.useDataSource.mainDataSourceId,dataViewId:s.useDataSource.dataViewId,rootDataSourceId:t,fields:[]}),(p.analysisType===e.Closest||p.analysisType===e.Proximity||p.analysisType===e.Summary)&&(null===(i=p.fieldsToExport)||void 0===i?void 0:i.length)>0&&p.fieldsToExport.forEach(e=>{!y.fields.includes(e)&&"esriCTApproxDistance"!==e&&y.fields.push(e)}),p.analysisType===e.Proximity&&(null===(o=p.displayField)||void 0===o?void 0:o.length)>0&&!y.fields.includes(p.displayField)&&y.fields.push(p.displayField),(null===(r=null===(n=p.sortFeatures)||void 0===n?void 0:n.sortFeaturesByField)||void 0===r?void 0:r.length)>0&&!y.fields.includes(p.sortFeatures.sortFeaturesByField)&&y.fields.push(p.sortFeatures.sortFeaturesByField),(null===(d=null===(l=p.groupFeatures)||void 0===l?void 0:l.groupFeaturesByField)||void 0===d?void 0:d.length)>0&&!y.fields.includes(p.groupFeatures.groupFeaturesByField)&&y.fields.push(p.groupFeatures.groupFeaturesByField),(null===(u=null===(c=p.subGroupFeatures)||void 0===c?void 0:c.subGroupFeaturesByField)||void 0===u?void 0:u.length)>0&&!y.fields.includes(p.subGroupFeatures.subGroupFeaturesByField)&&y.fields.push(p.subGroupFeatures.subGroupFeaturesByField),p.analysisType===e.Summary&&(null===(h=p.summaryFields)||void 0===h||h.forEach(e=>{var t;null===(t=e.summaryFieldInfo.parts)||void 0===t||t.forEach(e=>{e.jimuFieldName&&!y.fields.includes(e.jimuFieldName)&&y.fields.push(e.jimuFieldName)})})),0===g.length&&a.push(y)}),o){["pointFeature","polylineFeature","polygonFeature","searchAreaFeature"].forEach(e=>{const s=o[e];if((null==s?void 0:s.enabled)&&s.useDataSource){const e=a.filter(e=>e.dataSourceId===s.useDataSource.dataSourceId),i=(null==e?void 0:e.length)>0?e[0]:{dataSourceId:s.useDataSource.dataSourceId,mainDataSourceId:s.useDataSource.mainDataSourceId,rootDataSourceId:t,fields:[]};0===e.length&&a.push(i)}})}}return a},P=e=>{if(0===e)return"0";if(Math.abs(e)>=.01)return e.toString();const t=e<0,s=Math.abs(e);let i;if(s<1e-15){const e=Math.min(Math.abs(Math.floor(Math.log10(s)))+1,15);i=s.toFixed(e)}else if(s.toString().includes("e")){const e=Math.abs(Math.floor(Math.log10(s)))+5;i=s.toFixed(Math.min(e,20))}else i=s.toString();const a=i.indexOf(".");if(-1===a)return e.toString();const o=i.substring(a+1);let n=-1;for(let e=0;e<o.length;e++)if("0"!==o[e]){n=e;break}if(-1===n)return"0";return`${t?"-":""}0.${o.substring(0,n+1)}`};var B=L(46942),E=L.n(B),k=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};class G extends i.React.PureComponent{constructor(s){var n;super(s),this.layerData=[],this.dropdownRef=i.React.createRef(),this.nls=e=>{var t;const s=Object.assign({},o);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>k(this,void 0,void 0,function*(){this.updateLayerLabelWidth(),this.props.displayMapSymbol&&j(this.props.selectedRecord,this.symbolRef),this.props.showExportButton&&(yield new Promise(e=>setTimeout(e,1e3)),yield this.buildExportOptions())}),this.buildDataSetArray=()=>k(this,void 0,void 0,function*(){const t=T(this.props.widgetId,this.props.analysisType,this.props.analysisId),s=i.DataSourceManager.getInstance().getDataSource(t);if(this.props.analysisType===e.Summary){if(this.props.dsId){const e=i.DataSourceManager.getInstance(),t={returnGeometry:!0,outFields:["*"],where:"1=1"},a=yield s.queryAll(t),o=yield e.createDataSource((0,i.Immutable)({id:"downloadCsv_layer"+(new Date).getTime(),type:i.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:s.getSchema(),label:s.getLabel()})),n=Object.assign(o.getDataSourceJson());i.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(o,(0,i.Immutable)(Object.assign(Object.assign({},n),{exportOptions:s.getExportOptions()}))),o.setSourceRecords(a.records);const r={records:a.records,dataSource:o,name:s.getLabel()};this.pushUniqueDataSet(r);const l=this.props.records[0].dataSource;this.pushUniqueDataSet({records:this.props.records,dataSource:l,name:l.getLabel(),fields:this.getFieldsToExport(this.props.analysisId)})}}else if(this.props.analysisType===e.Closest){const e={returnGeometry:!0,outFields:["*"],where:"1=1"},t=yield s.queryAll(e);this.pushUniqueDataSet({records:t.records,dataSource:s,name:s.getLabel()})}else this.pushUniqueDataSet({records:this.props.records,dataSource:s,name:s.getLabel()})}),this.pushUniqueDataSet=e=>{!this.dataSet.some(t=>t.dataSource.id===e.dataSource.id)&&this.dataSet.push(e)},this.componentDidUpdate=e=>{e.analysisIcon===this.props.analysisIcon&&e.featureCount===this.props.featureCount||this.setState({displayAnalysisIcon:!!this.props.analysisIcon,displayFeatureCount:!!this.props.featureCount},()=>{this.updateLayerLabelWidth()}),this.props.displayMapSymbol&&e.selectedRecord!==this.props.selectedRecord&&j(this.props.selectedRecord,this.symbolRef)},this.updateLayerLabelWidth=()=>{let e;this.props.isListView?(this.state.displayAnalysisIcon&&this.state.displayFeatureCount?e=130:this.state.displayAnalysisIcon||this.state.displayFeatureCount?this.state.displayAnalysisIcon&&!this.state.displayFeatureCount?e=80:!this.state.displayAnalysisIcon&&this.state.displayFeatureCount&&(e=100):e=50,this.state.showExportButton||(e-=24),this.setState({layerLabelWidth:"calc(100% - "+e+"px)"})):this.state.displayFeatureCount?this.setState({layerLabelWidth:"calc(100% - 64px) !important"}):this.setState({layerLabelWidth:"calc(100% - 24px) !important"})},this.onToggleSelectedLayer=()=>{this.props.canToggle&&this.setState({isFeatureLayerOpen:!this.state.isFeatureLayerOpen,isIconDown:!this.state.isIconDown},()=>{this.props.onToggle&&this.props.onToggle(this.props.index,this.state.isFeatureLayerOpen)})},this.handleFeaturesToShow=()=>{const e=this.state.start+20;let t=this.props.children;return this.canShowMoreFeatures&&(t=this.props.children.slice(0,e),e>=this.props.children.length&&(this.canShowMoreFeatures=!1)),t},this.renderIndividualExportList=()=>{var e;const s=i.css`
       padding-top: 7px!important;
      `,o=i.css`
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          position: absolute;
          width: 60%;
          height: 60%;
          top: 20%;
          left: 20%;
          border: 2px solid var(--sys-color-secondary-light);
          border-radius: 50%;
          border-top: 2px solid var(--sys-color-primary-main);
          box-sizing: border-box;
          animation:loading 2s infinite linear;
        `;return(0,t.jsxs)(i.React.Fragment,{children:[(0,t.jsxs)(a.Dropdown,{className:"float-right",direction:"down",size:"sm",title:this.nls("exportBtnTitle"),useKeyUpEvent:!0,toggle:this.onIndividualExportToggle,isOpen:this.state.showExportOptions,children:[(0,t.jsxs)(a.DropdownButton,{size:"sm",arrow:!1,css:s,icon:!0,ref:this.dropdownRef,className:"data-action-button",onClick:this.onIndividualExportToggle,type:"tertiary","aria-label":this.nls("exportBtnTitle"),children:[!this.state.isDropDownLoading&&(0,t.jsx)(b,{size:"m",title:this.nls("exportBtnTitle")}),this.state.isDropDownLoading&&(0,t.jsx)("div",{css:o})]}),(0,t.jsx)(a.DropdownMenu,{children:(null===(e=this.state.actionNames)||void 0===e?void 0:e.length)>0&&this.state.actionNames.map(e=>this.createActionItem(this.state.actionNamesGroups,e,i.DataLevel.Records))})]}),this.state.actionElement]})},this.onActionItemClick=(t,s)=>k(this,void 0,void 0,function*(){const a="active-data-action-item",o=document.querySelector(`.${a}`);o&&o.classList.remove(a),this.dropdownRef.current.className=E()(this.dropdownRef.current.className,a);let n=null,r=this.dataSet;if("export-csv"===t.id&&this.props.analysisType===e.Proximity){const e=T(this.props.widgetId,this.props.analysisType,this.props.analysisId)+"_Count",t=i.DataSourceManager.getInstance().getDataSource(e),s={returnGeometry:!0,outFields:["*"],where:"1=1"},a={records:(yield t.queryAll(s)).records,dataSource:t,name:t.getLabel()};r=[...r,a]}n=yield i.DataActionManager.getInstance().executeDataAction(t,r,s,this.props.widgetId),null!==n&&"boolean"!=typeof n&&this.setState({actionElement:i.React.cloneElement(n,{onClose:()=>{this.setState({actionElement:null})},onConfirm:(...e)=>(!n.props.keepOpenAfterConfirm&&this.setState({actionElement:null}),n.props.onConfirm(...e))})}),this.setState({showExportOptions:!1})}),this.createActionItem=(e,s,o)=>{const n=e[s];return"export"===s&&(null==n?void 0:n.length)>0&&n.length>0?(0,t.jsx)(i.React.Fragment,{children:n.map((e,s)=>{var n;let r=e.label;if(e.widgetId){const t=(0,i.getAppStore)().getState().appConfig.widgets[e.widgetId];r=null!==(n=null==t?void 0:t.label)&&void 0!==n?n:e.label}return(0,t.jsx)(a.DropdownItem,{header:!1,onClick:()=>{this.onActionItemClick(e,o)},children:r},s)})},"exportAction"):null},this.getAvailableActions=()=>k(this,void 0,void 0,function*(){let e=null;return e=i.DataActionManager.getInstance().getSupportedActions(this.props.widgetId,this.dataSet,i.DataLevel.Records),Promise.all([e||{}])}),this.buildExportOptions=()=>k(this,void 0,void 0,function*(){var e;this.setState({isDropDownLoading:!0});try{0===this.dataSet.length&&(yield this.buildDataSetArray());const[t]=yield this.getAvailableActions(),s=Object.keys(t);this.setState({showExportButton:null===(e=t.export)||void 0===e?void 0:e.length,actionNames:s,actionNamesGroups:t,isDropDownLoading:!1})}catch(e){console.error(e),this.setState({actionNamesGroups:{},isDropDownLoading:!1})}}),this.onIndividualExportToggle=e=>{null==e||e.stopPropagation(),this.setState({showExportOptions:!this.state.showExportOptions})},this.getFieldsToExport=e=>{var t;let s=[];const i=null===(t=this.props.analysisSettings)||void 0===t?void 0:t.layersInfo,{searchByLocation:a}=C(this.props.searchSettings);return i.forEach(t=>{var i;if(t.analysisInfo.analysisId===e)if((null===(i=t.analysisInfo.fieldsToExport)||void 0===i?void 0:i.length)>0){const e=[...t.analysisInfo.fieldsToExport];!a&&t.analysisInfo.fieldsToExport.includes("esriCTApproxDistance")&&e.splice(t.analysisInfo.fieldsToExport.indexOf("esriCTApproxDistance"),1),s=e}else s=O(t.useDataSource.dataSourceId)}),s},this.symbolRef=i.React.createRef(),this.canShowMoreFeatures=this.props.canShowMoreFeatures,this.dataSet=[],this.state={isFeatureLayerOpen:this.props.isExpanded,isIconDown:!this.props.isExpanded,label:null===(n=this.props)||void 0===n?void 0:n.label,layerLabelWidth:"",displayAnalysisIcon:!!this.props.analysisIcon,displayFeatureCount:!!this.props.featureCount,showExportButton:!1,start:0,actionNames:[],actionNamesGroups:{},isDropDownLoading:!1,actionElement:null,showExportOptions:!1}}render(){let e=(s=this.props.theme,o=this.state.layerLabelWidth,n=this.props.canToggle,i.css`
  .layer-title-Container {
    display: inline-flex;
    -webkit-box-align: baseline;
    align-items: center;
    width: 100%;
    cursor: ${n?"pointer":"default"};
    justify-content: space-between;
  }

  .icon {
    margin-left: 10px;
    width: 20px;
  }

  .layer-title {
    width:  ${o};
    padding: 10px 2px 10px 8px;
    font-weight: 500;
    margin-top: 2px;
  }

  .export-button .icon-btn-sizer{
    padding: 0 5px;
  }

  .count {
    width: 80px;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: auto;
    text-align: center;
    cursor: ${n?"pointer":"default"};
    font-weight: bold;
    padding-top: 3px;
  }

  .layer-title-label {
    width: 100%;
    margin: 0;
    cursor: ${n?"pointer":"default"};
    padding-top: 1px;
  }

  .row {
    margin-left: 0px;
    margin-right: 0px;
  }

  .toggle-button {
    visibility: ${n?"visible":"hidden"};
  }

  .show-more-button {
    display: grid;
  }

  .nm-border-top-color {
    border-top: 1px solid ${s.sys.color.divider.secondary};
  }
  `);var s,o,n;this.props.isListView||(e=function(e,t){return i.css`

  .layer-title-Container {
    display: inline-flex;
    -webkit-box-align: baseline;
    align-items: center;
    cursor: pointer;
    padding: 5px 5px 5px 0;
  }

  .card {
    width: 90% !important;
    margin: auto;
  }

  .icon {
    margin-left: 10px;
    width: 20px;
  }

  .layer-title {
    width: ${t};
    padding: 5px 2px 5px 10px;
    font-weight: 500;
    margin-top: 2px;
  }

  .count {
    width: 80px;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: auto;
    text-align: center;
    cursor: pointer;
    font-weight: bold;
    padding-top: 3px;
  }

  .layer-title-label {
    width: 100%;
    margin: 0;
    cursor: pointer;
    padding-top: 1px;
  }

  .row {
    margin-left: 0px;
    margin-right: 0px;
  }

  .layer-title-map-symbol {
    margin-left: 10px;
    width: 25px;
  }

  .nm-border-top-color {
    border-top: 1px solid ${e.sys.color.divider.secondary};
  }
  `}(this.props.theme,this.state.layerLabelWidth));const r=this.handleFeaturesToShow(),l=A(this.props.label,this.nls("noValueForDisplayField")),d=this.props.intl.formatNumber(this.props.featureCount,{maximumFractionDigits:0});return(0,t.jsxs)(a.Surface,{level:"overlay",css:e,style:{border:this.props.isListView?"":"1px solid var(--sys-color-divider-secondary)"},className:this.props.isListView?"layer-Container shadow-2 py-1 w-100":"layer-Container shadow-none py-0 w-100 card rounded-1",children:[(0,t.jsx)(a.Row,{flow:"wrap",children:(0,t.jsxs)("div",Object.assign({tabIndex:0,className:"layer-title-Container",onClick:this.onToggleSelectedLayer.bind(this),"aria-label":this.props.label,role:"button"},this.props.canToggle&&{"aria-expanded":this.state.isFeatureLayerOpen},{onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onToggleSelectedLayer()},children:[this.props.displayMapSymbol&&(0,t.jsx)("div",{className:"layer-title-map-symbol",ref:this.symbolRef}),this.state.displayAnalysisIcon&&(0,t.jsx)("div",{className:"icon",children:(0,t.jsx)(a.Icon,{size:"m",icon:this.props.analysisIcon})}),(0,t.jsx)("div",{className:"layer-title",children:(0,t.jsx)(a.Label,{className:"title3 layer-title-label text-break",title:l,children:l})}),this.props.isListView&&this.state.showExportButton&&this.renderIndividualExportList(),this.state.displayFeatureCount&&(0,t.jsx)(a.Label,{className:"count mx-0",title:d,children:d}),(0,t.jsxs)(a.Button,{tabIndex:-1,type:"tertiary",className:"toggle-button p-0",icon:!0,"aria-label":this.props.label,children:[this.state.isIconDown&&(0,t.jsx)(y,{size:"m",autoFlip:!0}),!this.state.isIconDown&&(0,t.jsx)(u,{size:"m"})]})]}))}),(0,t.jsxs)(a.Collapse,{isOpen:this.state.isFeatureLayerOpen,className:"w-100",children:[r,this.canShowMoreFeatures&&(0,t.jsx)("div",{className:"show-more-button p-1 nm-border-top-color",children:(0,t.jsx)(a.Button,{type:"secondary",title:this.nls("showMoreBtnTitle"),onClick:()=>{this.setState({start:r.length})},children:this.nls("showMoreBtnTitle")})})]})]})}}var V=L(22089),N=L(74919),U=L.n(N),z=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const _=e=>{const s=window.SVG,{className:a}=e,o=z(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:U()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var W=L(86058),H=L.n(W),$=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const J=e=>{const s=window.SVG,{className:a}=e,o=$(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:H()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var q=L(42588),Z=L.n(q),Q=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const K=e=>{const s=window.SVG,{className:a}=e,o=Q(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:Z()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var X=L(59620),Y=L(66884),ee=L.n(Y),te=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const se=e=>{const s=window.SVG,{className:a}=e,o=te(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:ee()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var ie=L(10624),ae=L(27442),oe=L(8968);const ne=(e,t)=>{var s;switch(t||(t="#00FFFF"),null===(s=null==e?void 0:e.geometry)||void 0===s?void 0:s.type){case"point":case"multipoint":return re(e,t);case"polyline":return de(e,t);case"polygon":return ce(e,t);default:return null}},re=(e,t)=>{var s,i,a,o;const n=e.layer;let r,l,d,c,u,h,p,g,y;if(l=!1,r={type:"simple-marker",style:"square",color:[0,255,255,0],outline:{color:t||"#00FFFF",width:2}},r.size=30,null==n?void 0:n.renderer)if(n.renderer.symbol)l=!0,r=le(r,n.renderer.symbol);else if((null===(s=n.renderer.infos)||void 0===s?void 0:s.length)>0){for(u=0;u<n.renderer.infos.length;u++)n.typeIdField?d=e.attributes[n.typeIdField]:n.renderer.attributeField&&(d=e.attributes[n.renderer.attributeField]),c=n.renderer.infos[u].value,null!=d&&""!==d&&null!=c&&""!==c&&d.toString()===c.toString()&&(l=!0,r=le(r,n.renderer.infos[u].symbol));l||n.renderer.defaultSymbol&&(l=!0,r=le(r,n.renderer.defaultSymbol))}if((null===(i=null==n?void 0:n.graphics)||void 0===i?void 0:i.length)>0&&n._getSymbol(e)){h=e.getShape(),(null==h?void 0:h.shape)?h.shape.hasOwnProperty("r")?(l=!0,r.size=2*h.shape.r+10):h.shape.hasOwnProperty("width")&&(l=!0,(null===(o=null===(a=n.renderer)||void 0===a?void 0:a.infos)||void 0===o?void 0:o.length)>0&&(r=le(r,n.renderer.infos[0].symbol)),r.size=h.shape.width+10):n.renderer.visualVariables&&(p=n._getRenderer(e),g=(e=>{let t=null;return e.renderer.visualVariables&&e.renderer.visualVariables.forEach(e=>{"sizeInfo"===e.type&&(t=e)}),t})(n),g&&(y=p.getSize(e,{sizeInfo:g,shape:n._getSymbol(e),resolution:n&&n.getResolutionInMeters&&n.getResolutionInMeters()}),null!==y&&(r.size=y+10)))}return new V.default({geometry:e.geometry,symbol:r,attributes:e.attributes})},le=(e,t)=>{let s,i,a;return t.hasOwnProperty("height")&&t.hasOwnProperty("width")&&(s=t.height,i=t.width,a=s>i?s:i,a+=10,e.size=a),t.hasOwnProperty("size")&&(!a||a<t.size)&&(e.size=t.size+10),t.hasOwnProperty("xoffset")&&(e.xoffset=t.xoffset),t.hasOwnProperty("yoffset")&&(e.yoffset=t.yoffset),e},de=(e,t)=>{var s,i,a;const o=e.layer;let n,r,l,d;if(n=4,null==o?void 0:o.renderer)if((null===(s=o.renderer)||void 0===s?void 0:s.symbol)&&o.renderer.symbol.hasOwnProperty("width"))n=o.renderer.symbol.width;else if((null===(a=null===(i=o.renderer)||void 0===i?void 0:i.infos)||void 0===a?void 0:a.length)>0)for(d=0;d<o.renderer.infos.length;d++)o.typeIdField?r=e.attributes[o.typeIdField]:o.renderer.attributeField&&(r=e.attributes[o.renderer.attributeField]),l=o.renderer.infos[d].value,null!=r&&""!==r&&null!=l&&""!==l&&r.toString()===l.toString()&&o.renderer.infos[d].symbol.hasOwnProperty("width")&&(n=o.renderer.infos[d].symbol.width);else o.renderer.defaultSymbol&&o.renderer.defaultSymbol.hasOwnProperty("width")&&(n=o.renderer.defaultSymbol.width);const c={type:"simple-line",color:t||"#00FFFF",width:4,style:"solid",outline:{color:"#00FFFF",width:n}};return new V.default({geometry:e.geometry,symbol:c,attributes:e.attributes})},ce=(e,t)=>{const s={type:"simple-fill",color:[0,255,255,0],style:"solid",outline:{color:t||"#00FFFF",width:2}};return new V.default({geometry:e.geometry,symbol:s,attributes:e.attributes})},ue=(e,t)=>{let s;t||(t="#00FFFF");const i=new ae.default(t),a=new ae.default(t);switch(a.a=1,e){case"point":case"multipoint":s={type:"simple-marker",style:"circle",color:i,outline:{color:i,width:1}};break;case"polyline":s={type:"simple-line",color:i,width:4,style:"solid",outline:{color:i,width:1}};break;case"polygon":s={type:"simple-fill",color:i,style:"solid",outline:{color:a,width:1}}}return s},he=(e,t)=>{const s=e?oe.fromJSON(e):null;if(s)return s;{const e=ue("polygon",t);return e&&(e.color.a=.3),e}};var pe=L(62243);class ge extends i.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},o,a.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var e;const{searchCurrentExtent:t}=C(this.props.config);(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)&&(this.createSketchVmInstance(),t&&this.onSearchClicked(),pe.when(()=>{var e,t;return null===(t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.stationary},()=>{t&&this.props.showInfoIcon(!0)}))},this.createSketchVmInstance=()=>{var e;const t=new ie.default({view:(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)?this.props.jimuMapView.view:null,layer:new X.default,pointSymbol:ue("point",this.props.highlightColor),polylineSymbol:ue("polyline",this.props.highlightColor),polygonSymbol:ue("polygon",this.props.highlightColor)});t.on("create",this.onCreateComplete),this.setState({currentSketchVM:t},()=>{"point"===this.props.activateToolOnWidgetLoad?(this.state.currentSketchVM.create("point"),this.setState({isPointActive:!0})):"polyline"===this.props.activateToolOnWidgetLoad?(this.state.currentSketchVM.create("polyline"),this.setState({isPolyLineActive:!0})):"polygon"===this.props.activateToolOnWidgetLoad?(this.state.currentSketchVM.create("polygon"),this.setState({isPolygonActive:!0})):"none"===this.props.activateToolOnWidgetLoad&&this.state.currentSketchVM.cancel()})},this.componentDidUpdate=e=>{var t,s,i,a,o,n;if(e.jimuMapView.id!==this.props.jimuMapView.id&&this.state.currentSketchVM&&!this.state.currentSketchVM.destroyed&&(this.state.currentSketchVM.destroy(),this.createSketchVmInstance()),e.jimuMapView.view!==this.props.jimuMapView.view){const{searchCurrentExtent:e}=C(this.props.config);this.createSketchVmInstance(),e&&this.onSearchClicked(),pe.when(()=>{var e,t;return null===(t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.stationary},()=>{e&&this.props.showInfoIcon(!0)})}const{searchCurrentExtent:r}=C(this.props.config);(null===(t=this.props.config)||void 0===t?void 0:t.searchByActiveMapArea)===(null===(s=e.config)||void 0===s?void 0:s.searchByActiveMapArea)&&(null===(i=this.props.config)||void 0===i?void 0:i.includeFeaturesOutsideMapArea)===(null===(a=e.config)||void 0===a?void 0:a.includeFeaturesOutsideMapArea)||r&&this.onSearchClicked(),this.props.highlightColor!==e.highlightColor&&this.state.currentSketchVM&&(this.state.isPolygonActive?this.state.currentSketchVM.set("polygonSymbol",ue("polygon",this.props.highlightColor)):this.state.isPolyLineActive?this.state.currentSketchVM.set("polylineSymbol",ue("polyline",this.props.highlightColor)):this.state.isPointActive&&this.state.currentSketchVM.set("pointSymbol",ue("point",this.props.highlightColor))),this.props.widgetClosed!==e.widgetClosed&&(this.props.widgetClosed?(this.state.currentSketchVM&&this.state.currentSketchVM.cancel(),(null===(n=null===(o=this.props.jimuMapView.view)||void 0===o?void 0:o.popup)||void 0===n?void 0:n.close)&&this.props.jimuMapView.view.popup.close()):this.state.isPointActive?this.state.currentSketchVM.create("point"):this.state.isPolyLineActive?this.state.currentSketchVM.create("polyline"):this.state.isPolygonActive&&this.state.currentSketchVM.create("polygon")),this.props.config.sketchTools.showPoint===e.config.sketchTools.showPoint&&this.props.config.sketchTools.showPolyline===e.config.sketchTools.showPolyline&&this.props.config.sketchTools.showPolygon===e.config.sketchTools.showPolygon||(!this.props.config.sketchTools.showPoint&&this.state.isPointActive&&this.state.currentSketchVM.cancel(),!this.props.config.sketchTools.showPolyline&&this.state.isPolyLineActive&&this.state.currentSketchVM.cancel(),!this.props.config.sketchTools.showPolygon&&this.state.isPolygonActive&&this.state.currentSketchVM.cancel())},this.componentWillUnmount=()=>{var e;this.state.currentSketchVM&&(null===(e=this.state.currentSketchVM)||void 0===e||e.cancel())},this.onSearchClicked=()=>{this.props.showInfoIcon(!1),this.props.searchByMapAreaClicked(),this.clearAll()},this.onResetButtonClick=()=>{this.props.refreshClicked()},this.clearAll=()=>{var e,t;this.state.currentSketchVM&&this.state.currentSketchVM.cancel(),(null===(t=null===(e=this.props.jimuMapView.view)||void 0===e?void 0:e.popup)||void 0===t?void 0:t.close)&&this.props.jimuMapView.view.popup.close(),this.setState({isPolygonActive:!1,isPointActive:!1,isPolyLineActive:!1})},this.onDrawToolBtnChanges=e=>{switch(this.clearAll(),e){case"polygon":this.state.isPolygonActive?this.state.currentSketchVM.cancel():(this.state.currentSketchVM.set("polygonSymbol",ue("polygon",this.props.highlightColor)),this.state.currentSketchVM.create("polygon"),this.setState({isPolygonActive:!0,isPointActive:!1,isPolyLineActive:!1}));break;case"point":this.state.isPointActive?this.state.currentSketchVM.cancel():(this.state.currentSketchVM.set("pointSymbol",ue("point",this.props.highlightColor)),this.state.currentSketchVM.create("point"),this.state.currentSketchVM.pointSymbol.size=14,this.setState({isPolygonActive:!1,isPointActive:!0,isPolyLineActive:!1}));break;case"polyline":this.state.isPolyLineActive?this.state.currentSketchVM.cancel():(this.state.currentSketchVM.set("polylineSymbol",ue("polyline",this.props.highlightColor)),this.state.currentSketchVM.create("polyline"),this.setState({isPolygonActive:!1,isPointActive:!1,isPolyLineActive:!0}));break;default:this.state.currentSketchVM.cancel()}},this.onCreateComplete=e=>{if("complete"===e.state)this.props.sketchComplete(e),this.setState({isPointActive:!1,isPolyLineActive:!1,isPolygonActive:!1});else if("cancel"===e.state){if(this.props.widgetClosed)return;this.setState({isPointActive:!1,isPolyLineActive:!1,isPolygonActive:!1})}},this.state={isPolygonActive:!1,isPointActive:!1,isPolyLineActive:!1,searchSettings:this.props.config,currentSketchVM:null,filterActionBinded:!1}}render(){const{searchCurrentExtent:e}=C(this.props.config),{sketchTools:s}=this.props.config,o=s.showPoint||s.showPolyline||s.showPolygon;return(0,t.jsxs)("div",{css:(this.props.theme,i.css`
    .main-row {
      flex-wrap: wrap;
      display: flex;
    }

    .headingLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .icon-verticalLine {
      border-right: 1px solid rgba(110,110,110,.3);
    }

    .column-section {
      display: flex;
      align-items: center;
      margin: 3px 0;
    }

    .hidden {
      display: none;
    }

   .pointer {
    cursor: pointer;
   }
  `),className:"jimu-widget",children:[!e&&o&&(0,t.jsx)("div",{className:"w-100 d-flex locate-incident-section",children:(0,t.jsxs)("div",{className:"column-section pr-1",children:[(null==s?void 0:s.showPoint)&&(0,t.jsx)(a.Button,{"data-testid":"pointButton",type:"tertiary",className:"action-button",icon:!0,"aria-label":this.nls("point"),title:this.nls("point"),variant:this.state.isPointActive?"contained":"text",color:this.state.isPointActive?"primary":"default",onClick:()=>{this.onDrawToolBtnChanges("point")},children:(0,t.jsx)(_,{size:"m"})}),(null==s?void 0:s.showPolyline)&&(0,t.jsx)(a.Button,{"data-testid":"polylineButton",type:"tertiary",className:"action-button",icon:!0,"aria-label":this.nls("polyline"),title:this.nls("polyline"),variant:this.state.isPolyLineActive?"contained":"text",color:this.state.isPolyLineActive?"primary":"default",onClick:()=>{this.onDrawToolBtnChanges("polyline")},children:(0,t.jsx)(J,{size:"m"})}),(null==s?void 0:s.showPolygon)&&(0,t.jsx)(a.Button,{"data-testid":"polygonButton",type:"tertiary",className:"action-button",icon:!0,"aria-label":this.nls("polygon"),title:this.nls("polygon"),variant:this.state.isPolygonActive?"contained":"text",color:this.state.isPolygonActive?"primary":"default",onClick:()=>{this.onDrawToolBtnChanges("polygon")},children:(0,t.jsx)(K,{size:"m"})})]})}),e&&!this.props.isFilterActionBinded&&(0,t.jsx)("div",{className:"column-section shadow-1 w-100",onClick:this.onSearchClicked,children:(0,t.jsxs)(a.Button,{className:"w-100",onClick:this.onSearchClicked,size:"default","aria-label":this.nls("searchByActiveMapArea"),title:this.nls("searchByActiveMapArea"),children:[(0,t.jsx)(se,{size:"m"}),(0,t.jsx)("label",{className:"mb-0 align-middle",children:this.nls("updateResultsLabel")})]})})]})}}const ye=[{value:"miles",label:o.miles},{value:"meters",label:o.meters},{value:"kilometers",label:o.kilometers},{value:"feet",label:o.feet},{value:"yards",label:o.yards}],fe=[{value:"meters",abbreviation:"metersAbbreviation"},{value:"feet",abbreviation:"feetAbbreviation"},{value:"kilometers",abbreviation:"kilometersAbbreviation"},{value:"miles",abbreviation:"milesAbbreviation"},{value:"yards",abbreviation:"yardsAbbreviation"}],me={a3Portrait:{height:16.54,width:11.69},a3Landscape:{height:11.69,width:16.54},a4Portrait:{height:11.69,width:8.27},a4Landscape:{height:8.27,width:11.69},letterAnsiAPortrait:{height:11,width:8.5},letterAnsiALandscape:{height:8.5,width:11},tabloidAnsiBPortrait:{height:17,width:11},tabloidAnsiBLandscape:{height:11,width:17}},ve={a3Portrait:{height:13.5,width:11.7},a3Landscape:{height:7.7,width:16.5},a4Portrait:{height:8.5,width:8.3},a4Landscape:{height:4.8,width:11.7},letterAnsiAPortrait:{height:7.8,width:8.5},letterAnsiALandscape:{height:4.5,width:11},tabloidAnsiBPortrait:{height:14.5,width:11},tabloidAnsiBLandscape:{height:7,width:17}},be={a3Portrait:{height:2,width:11.7},a3Landscape:{height:2,width:16.5},a4Portrait:{height:2,width:8.3},a4Landscape:{height:1,width:11.7},letterAnsiAPortrait:{height:2,width:8.5},letterAnsiALandscape:{height:2,width:11},tabloidAnsiBPortrait:{height:2,width:11},tabloidAnsiBLandscape:{height:2,width:17}};var Se;!function(e){e.Portrait="Portrait",e.Landscape="Landscape"}(Se||(Se={}));e.Closest,e.Proximity,e.Summary;const we="#f507f5",xe="#FFFFFF00",Ie={analysisSettings:{layersInfo:[],displayAnalysisIcon:!1,displayMapSymbols:!1,showDistFromInputLocation:!0,onlyShowLayersResult:!1,displayAllLayersResult:!1,enableProximitySearch:!1,saveFeatures:{saveInputLocation:!1,pointFeature:{enabled:!1,useDataSource:null},polylineFeature:{enabled:!1,useDataSource:null},polygonFeature:{enabled:!1,useDataSource:null},searchAreaFeature:{enabled:!1,useDataSource:null}}},searchSettings:{headingLabel:"",bufferDistance:1,distanceUnits:"",showDistanceSettings:!0,sketchTools:{showPoint:!0,showPolyline:!0,showPolygon:!0},activeToolWhenWidgetOpens:"none",searchByActiveMapArea:!1,includeFeaturesOutsideMapArea:!1,headingLabelStyle:{fontFamily:"Avenir Next",fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1,fontColor:"var(--sys-color-surface-paper-text)",fontSize:"13px"},showInputAddress:!0}};var Fe,Ae;!function(e){e.NoFormatting="noFormatting",e.Round="round",e.Truncate="truncate"}(Fe||(Fe={})),function(e){e.SumOfIntersectedArea="sumOfIntersectedArea",e.SumOfIntersectedLength="sumOfIntersectedLength"}(Ae||(Ae={}));Ae.SumOfIntersectedLength,Fe.NoFormatting,Ae.SumOfIntersectedArea,Fe.NoFormatting;var De;!function(e){e.SingleColor="singleColor",e.ByCategory="byCategory"}(De||(De={}));var Ce=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};class Le extends i.React.PureComponent{constructor(e){var t,s;super(e),this.nls=e=>{var t;const s=Object.assign({},o);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.props.unitChanged(this.state.distanceUnit),this.getBufferGeometry()},this.componentDidUpdate=e=>{var t,s,i,a,o,n;(null===(t=this.props)||void 0===t?void 0:t.geometry)!==(null==e?void 0:e.geometry)&&this.getBufferGeometry(),(null===(s=this.props)||void 0===s?void 0:s.distanceUnit)!==e.distanceUnit&&this.setState({distanceUnit:null===(i=this.props)||void 0===i?void 0:i.distanceUnit},()=>{this.onUnitChange(this.props.distanceUnit)}),(null===(a=this.props)||void 0===a?void 0:a.bufferDistance)!==e.bufferDistance&&this.setState({bufferDistance:null===(o=this.props)||void 0===o?void 0:o.bufferDistance},()=>{var e;this.props.distanceChanged(null===(e=this.props)||void 0===e?void 0:e.bufferDistance),this.getBufferGeometry()}),(null==e?void 0:e.refreshButtonClicked)!==(null===(n=this.props)||void 0===n?void 0:n.refreshButtonClicked)&&this.props.refreshButtonClicked&&this.setState({bufferDistance:this.props.bufferDistance,distanceUnit:this.props.distanceUnit})},this.getBufferGeometry=()=>Ce(this,void 0,void 0,function*(){if(this.props.geometry)if(this.state.bufferDistance&&this.state.distanceUnit&&this.state.bufferDistance>0){const e=yield i.geometryUtils.createBuffer(this.props.geometry,[this.state.bufferDistance],this.state.distanceUnit),t=Array.isArray(e)?e[0]:e;this.props.bufferComplete(t)}else this.props.bufferComplete(null)}),this.onDistanceHandleChange=e=>{this.checkIfDistanceChange=!0,this.setState({bufferDistance:null!=e?e:1})},this.onDistancePressEnter=()=>{this.numberValueInputRef.blur()},this.onDistanceBlur=()=>{this.checkIfDistanceChange&&(this.updateDistance(),this.checkIfDistanceChange=!1)},this.updateDistance=()=>{this.props.distanceChanged(this.state.bufferDistance),this.getBufferGeometry()},this.onUnitChange=e=>{const t=((e,t)=>{const s=I(t);return e>s?s:e})(this.state.bufferDistance,e);this.props.distanceChanged(t),this.props.unitChanged(e),this.setState({distanceUnit:e,bufferDistance:t},()=>{this.getBufferGeometry()})},this.state={distanceUnit:null===(t=this.props)||void 0===t?void 0:t.distanceUnit,bufferDistance:null===(s=this.props)||void 0===s?void 0:s.bufferDistance}}render(){var e;return(0,t.jsx)("div",{css:(null===(e=this.props)||void 0===e||e.theme,i.css`
  .headingLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .hidden {
      display: none;
    }

    .column-section {
      display: flex;
      align-items: center;
      margin: 6px 0;
    }
  `),children:this.props.config.showDistanceSettings&&(0,t.jsx)(i.React.Fragment,{children:(0,t.jsx)("div",{"data-testid":"distanceSettings",className:"d-inline w-100 pt-1",children:(0,t.jsxs)("div",{className:"column-section",children:[(0,t.jsx)(a.NumericInput,{"aria-label":this.props.bufferHeaderLabel,className:"w-50",value:this.state.bufferDistance,size:"sm",min:0,max:I(this.state.distanceUnit),ref:e=>{this.numberValueInputRef=e},onBlur:this.onDistanceBlur,onPressEnter:this.onDistancePressEnter,onChange:this.onDistanceHandleChange}),(0,t.jsx)(a.Select,{"aria-label":this.props.bufferHeaderLabel,className:"w-50 pl-2",size:"sm",value:this.state.distanceUnit,onChange:e=>{this.onUnitChange(e.target.value)},children:ye.map((e,s)=>(0,t.jsx)(a.Option,{value:e.value,children:this.nls(e.value)},s))})]})})})})}}var Me=L(53205),Te=L(20320),je=L(31526),Oe=L(45508),Re=L.n(Oe),Pe=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Be=e=>{const s=window.SVG,{className:a}=e,o=Pe(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:Re()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))},Ee=(0,i.getAppStore)().getState().portalSelf;class ke extends i.React.PureComponent{constructor(e){var t,i,a,n,r,l,d;super(e),this.nls=e=>{var t;const s=Object.assign({},o);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var e;(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)&&this.props.jimuMapView.view.when(()=>{this.state.searchByActiveMapArea&&this.clearAll()})},this.componentDidUpdate=e=>{var t,s,i,a,o,n,r,l,d,c,u,h,p,g,y,f,m,v,b,S,w,x,I;if((null===(t=e.jimuMapView)||void 0===t?void 0:t.id)!==(null===(s=this.props.jimuMapView)||void 0===s?void 0:s.id)&&this.clearAll(),(null===(i=this.props.config)||void 0===i?void 0:i.searchByActiveMapArea)!==(null===(a=e.config)||void 0===a?void 0:a.searchByActiveMapArea)&&(this.clearAll(),this.setState({searchByActiveMapArea:null===(o=this.props.config)||void 0===o?void 0:o.searchByActiveMapArea})),(null===(n=e.config)||void 0===n?void 0:n.distanceUnits)!==(null===(r=this.props.config)||void 0===r?void 0:r.distanceUnits)&&this.setState({defaultDistanceUnits:(null===(l=this.props.config)||void 0===l?void 0:l.distanceUnits)?null===(d=this.props.config)||void 0===d?void 0:d.distanceUnits:D()}),(null===(c=e.config)||void 0===c?void 0:c.bufferDistance)!==(null===(u=this.props.config)||void 0===u?void 0:u.bufferDistance)&&this.setState({defaultBufferDistance:null===(h=this.props.config)||void 0===h?void 0:h.bufferDistance}),(null===(p=e.config)||void 0===p?void 0:p.showDistanceSettings)!==(null===(g=this.props.config)||void 0===g?void 0:g.showDistanceSettings)&&this.setState({showDistSettings:null===(y=this.props.config)||void 0===y?void 0:y.showDistanceSettings},()=>{this.clearAll()}),e.highlightColor!==(null===(f=this.props)||void 0===f?void 0:f.highlightColor)){if(null===(v=null===(m=this.graphic)||void 0===m?void 0:m.geometry)||void 0===v?void 0:v.type){const e=ue(this.graphic.geometry.type,this.props.highlightColor);e&&this.graphic.set("symbol",e)}if((null===(S=null===(b=this.props.bufferLayer)||void 0===b?void 0:b.graphics)||void 0===S?void 0:S.length)>0){const e=he(this.props.bufferSymbol,this.props.highlightColor);e&&this.props.bufferLayer.graphics.forEach(t=>{t.set("symbol",e)})}}if(e.bufferSymbol!==(null===(w=this.props)||void 0===w?void 0:w.bufferSymbol)&&(null===(I=null===(x=this.props.bufferLayer)||void 0===x?void 0:x.graphics)||void 0===I?void 0:I.length)>0){const e=he(this.props.bufferSymbol,this.props.highlightColor);e&&this.props.bufferLayer.graphics.forEach(t=>{t.set("symbol",e)})}e.msgActionGeometry!==this.props.msgActionGeometry&&this.onDrawIncidentComplete(this.props.msgActionGeometry),this.props.widgetClosed!==e.widgetClosed&&this.setState({widgetClosed:this.props.widgetClosed})},this.componentWillUnmount=()=>{this.clearAll()},this.onSketchComplete=e=>{this.onDrawIncidentComplete(e.graphic.geometry)},this.onDrawIncidentComplete=e=>{if(!e)return;this.clearAll(),this.showClosestAddress(e);const t=this.props.jimuMapView.view.spatialReference;t&&(t.isWGS84||t.isWebMercator)?s.geometryUtils.projectToSpatialReference([e],new Me.default({wkid:4326})).then(t=>{(null==t?void 0:t.length)>0&&(this.graphic=new V.default({geometry:e,symbol:ue(e.type,this.props.highlightColor),attributes:{}}),this.props.drawingLayer.add(this.graphic),this.props.incidentGraphicChange(this.graphic),this.setState({incidentGeometry:e,incidentGeometry4326:t[0],bufferGeometry:null,geodesicBuffer:null}))},e=>{console.log(e)}):setTimeout(()=>{this.graphic=new V.default({geometry:e,symbol:ue(e.type,this.props.highlightColor),attributes:{}}),this.props.drawingLayer.add(this.graphic),this.props.incidentGraphicChange(this.graphic),this.setState({incidentGeometry:e,incidentGeometry4326:null,bufferGeometry:null,geodesicBuffer:null})},100)},this.onSearchByMapAreaClicked=()=>{this.getMapExtentGeometry()},this.getMapExtentGeometry=()=>{var e;if(this.clearAll(),null===(e=this.props)||void 0===e?void 0:e.jimuMapView){const e=this.props.jimuMapView.view.extent,t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],s=new je.default({spatialReference:this.props.jimuMapView.view.spatialReference});s.addRing(t),this.graphic=new V.default({geometry:s}),setTimeout(()=>{var e,t;this.setState({incidentGeometry:this.props.jimuMapView.view.center,bufferGeometry:null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view.extent,incidentGeometry4326:null,geodesicBuffer:null}),this.props.aoiComplete({incidentGeometry:this.props.jimuMapView.view.center,bufferGeometry:null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view.extent,incidentGeometry4326:null,geodesicBuffer:null,distanceUnit:this.currentDistanceUnit,bufferDistance:this.currentBufferDistance})},50),this.updateLayerListMaxHeight()}},this.refreshButtonClicked=()=>{this.currentBufferDistance=this.state.defaultBufferDistance,this.currentDistanceUnit=this.state.defaultDistanceUnits,this.clearAll(),this.setState({refreshButtonClicked:!0},()=>{setTimeout(()=>{this.setState({refreshButtonClicked:!1})},50)})},this.clearAll=()=>{var e,t;null===(e=this.props.bufferLayer)||void 0===e||e.removeAll(),null===(t=this.props.drawingLayer)||void 0===t||t.removeAll(),this.graphic=null,this.setState({bufferGeometry:null,incidentGeometry:null,incidentGeometry4326:null,geodesicBuffer:null,closestAddress:null},()=>{this.updateLayerListMaxHeight(),this.props.clear()})},this.onBufferComplete=e=>{e?s.geometryUtils.projectToSpatialReference([e],this.props.jimuMapView.view.spatialReference).then(t=>{var s,i;if((null==t?void 0:t.length)>0){const a=new V.default({geometry:t[0],symbol:he(this.props.bufferSymbol,this.props.highlightColor)});a&&(this.props.bufferLayer.removeAll(),null===(s=this.props.bufferLayer)||void 0===s||s.add(a),null===(i=this.props.jimuMapView)||void 0===i||i.view.goTo({center:"point"===a.geometry.type?a.geometry:a.geometry.extent.clone().expand(1.5)})),this.setState({bufferGeometry:t[0]},()=>{this.props.aoiComplete({incidentGeometry:this.state.incidentGeometry,bufferGeometry:t[0],incidentGeometry4326:this.state.incidentGeometry4326,geodesicBuffer:e,distanceUnit:this.currentDistanceUnit,bufferDistance:this.currentBufferDistance})})}}):this.props.aoiComplete({incidentGeometry:this.state.incidentGeometry,incidentGeometry4326:this.state.incidentGeometry4326,bufferGeometry:null,geodesicBuffer:null,distanceUnit:this.currentDistanceUnit,bufferDistance:this.currentBufferDistance})},this.onBufferDistanceChange=e=>{var t;this.currentBufferDistance=e,null===(t=this.props.bufferLayer)||void 0===t||t.removeAll()},this.onBufferUnitChange=e=>{var t;this.currentDistanceUnit=e,null===(t=this.props.bufferLayer)||void 0===t||t.removeAll()},this.getGeocodeServiceURL=()=>{var e,t,s,i,a;let o="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";return(null===(t=null===(e=null==Ee?void 0:Ee.helperServices)||void 0===e?void 0:e.geocode)||void 0===t?void 0:t.length)>0&&(null===(a=null===(i=null===(s=null==Ee?void 0:Ee.helperServices)||void 0===s?void 0:s.geocode)||void 0===i?void 0:i[0])||void 0===a?void 0:a.url)&&(o=Ee.helperServices.geocode[0].url),o},this.getClosestAddress=e=>{const t=this.getGeocodeServiceURL();return Te.locationToAddress(t,{location:e},{query:{}}).then(e=>Promise.resolve(e.address),e=>Promise.resolve(this.nls("noClosestAddressMsg")))},this.showClosestAddress=e=>{"point"===(null==e?void 0:e.type)?this.getClosestAddress(e).then(e=>{this.setState({closestAddress:e},()=>{this.updateLayerListMaxHeight()})}):this.setState({closestAddress:null},()=>{this.updateLayerListMaxHeight()})},this.updateLayerListMaxHeight=()=>{setTimeout(()=>{this.props.updateClosestAddressState(null!==this.state.closestAddress)},50)},this.handleShowInfoIcon=e=>{this.setState({showInfoIcon:e})};const c=this.props.config&&""!==this.props.config.distanceUnits?null===(t=this.props.config)||void 0===t?void 0:t.distanceUnits:D();this.currentBufferDistance=null!==(a=null===(i=this.props.config)||void 0===i?void 0:i.bufferDistance)&&void 0!==a?a:1,this.currentDistanceUnit=c,this.state={defaultDistanceUnits:c,defaultBufferDistance:null!==(r=null===(n=this.props.config)||void 0===n?void 0:n.bufferDistance)&&void 0!==r?r:1,bufferGeometry:null,incidentGeometry:null,incidentGeometry4326:null,geodesicBuffer:null,searchSettings:this.props.config,refreshButtonClicked:!1,closestAddress:null,searchByActiveMapArea:null===(l=this.props.config)||void 0===l?void 0:l.searchByActiveMapArea,showDistSettings:null===(d=this.props.config)||void 0===d?void 0:d.showDistanceSettings,showInfoIcon:!1,widgetClosed:this.props.widgetClosed}}render(){var e;const{searchCurrentExtent:s,searchByLocation:i}=C(this.props.config),{sketchTools:o}=this.props.config,n=o.showPoint||o.showPolyline||o.showPolygon,l=this.props.widgetWidth<306||!this.state.searchByActiveMapArea&&!this.state.showDistSettings||!this.props.headingLabel&&this.state.showDistSettings&&!n?"pb-1 buffer-distance w-100":"pb-1 buffer-distance",d=this.props.widgetWidth<306||this.state.searchByActiveMapArea?"locate-incident pb-1 w-100":"locate-incident pb-1";return(0,t.jsxs)("div",{className:"pt-2 px-2",css:r(null===(e=this.props)||void 0===e||e.theme,n),children:[(0,t.jsx)("div",{className:s&&this.props.headingLabel?"mb-2":"hidden",children:(0,t.jsxs)(a.Label,{className:"headingLabelStyle mb-0",children:[(0,t.jsx)("span",{className:s?"align-middle":"",children:this.props.headingLabel}),!1]})}),(0,t.jsx)("div",{className:i&&this.props.headingLabel?"mb-0":"hidden",children:(0,t.jsx)(a.Label,{className:"headingLabelStyle mb-0",children:(0,t.jsx)("span",{className:s?"align-middle":"",children:this.props.headingLabel})})}),(0,t.jsxs)("div",{className:"main-row w-100",children:[(0,t.jsx)("div",{className:d,children:(0,t.jsx)(ge,{theme:this.props.theme,intl:this.props.intl,config:this.props.config,widgetClosed:this.state.widgetClosed,activateToolOnWidgetLoad:this.props.activateToolOnWidgetLoad,isFilterActionBinded:this.props.isFilterActionBinded,jimuMapView:this.props.jimuMapView,sketchComplete:this.onSketchComplete,refreshClicked:this.refreshButtonClicked,searchByMapAreaClicked:this.onSearchByMapAreaClicked,highlightColor:this.props.highlightColor,showInfoIcon:this.handleShowInfoIcon})}),(0,t.jsx)("div",{className:this.state.searchByActiveMapArea?"hidden pb-1 buffer-distance":l,children:!this.state.searchByActiveMapArea&&(0,t.jsx)(Le,{theme:this.props.theme,intl:this.props.intl,config:this.props.config,geometry:this.state.incidentGeometry4326||this.state.incidentGeometry,distanceUnit:this.state.defaultDistanceUnits,bufferDistance:this.state.defaultBufferDistance,bufferHeaderLabel:this.nls("bufferDistance"),bufferComplete:this.onBufferComplete,distanceChanged:this.onBufferDistanceChange,unitChanged:this.onBufferUnitChange,refreshButtonClicked:this.state.refreshButtonClicked})})]}),this.state.closestAddress&&this.props.showInputAddress&&(0,t.jsxs)("div",{tabIndex:0,"aria-label":this.nls("closestAddress")+" "+this.state.closestAddress,className:"closest-address w-100 pt-1",children:[(0,t.jsx)(a.Label,{className:"closestAddressheadingLabel mb-0",children:this.nls("closestAddress")}),(0,t.jsx)("br",{}),(0,t.jsx)(a.Label,{className:"mb-0 pt-1",children:this.state.closestAddress})]})]})}}var Ge=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const Ve=(e,t,s,a,o,n)=>Ge(void 0,void 0,void 0,function*(){return new Promise(a=>{var r;if(!e)return void a([]);let l;void 0===o?l=["*"]:(l=Object.assign([],o),(null==o?void 0:o.includes("esriCTApproxDistance"))&&l.splice(o.indexOf("esriCTApproxDistance"),1));const d=null===(r=e.getSchema())||void 0===r?void 0:r.fields;if(d){const e=Object.keys(d).map(e=>e.toLowerCase());l=l.filter(t=>e.includes(t.toLowerCase()))}const c=e.getIdField();!c||l.includes("*")||l.includes(c)||l.push(c);const u={};t&&(u.geometry=t.toJSON(),u.geometryType=t?i.utils.getGeometryType(t):void 0),u.outFields=l,u.returnGeometry=s,u.notAddFieldsToClient=!0,e.queryAll(u,n,null,{excludeQuery:{widgetId:"filter-data-record-action",dataSourceId:e.id}}).then(e=>{n.aborted?(console.error(n.reason),a([])):(null==e?void 0:e.records)?a(e.records):a([])},e=>{console.log(e),a([])})})});var Ne=L(23938),Ue=L(86823),ze=L.n(Ue),_e=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const We=e=>{const s=window.SVG,{className:a}=e,o=_e(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:ze()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var He=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};class $e extends i.React.PureComponent{constructor(e){super(e),this.dropdownRef=i.React.createRef(),this.nls=e=>{var t;const s=Object.assign({},o,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>He(this,void 0,void 0,function*(){yield this.getDataSetForActions(),!this.props.popupTitleField||this.props.popupTitleField&&this.props.isExpanded?this.createFeatureItem(this.props.ifOneAnalysisResult&&this.props.expandOnOpen,this.props.displayMapSymbol):this.props.ifOneAnalysisResult&&this.props.popupTitleField&&this.props.expandOnOpen&&this.onToggleSelectedLayer(),this.props.displayMapSymbol&&(yield new Promise(e=>setTimeout(e,100)),j(this.props.selectedRecord,this.symbolRef))}),this.componentDidUpdate=e=>{e.selectedRecord!==this.props.selectedRecord&&this.props.displayMapSymbol&&j(this.props.selectedRecord,this.symbolRef)},this.getDataSetForActions=()=>He(this,void 0,void 0,function*(){var e,t,s;const a=this.props.selectedRecord,o=w(this.props.selectedLayerDsId);this.recordActionNames=[],this.recordActions={},this.dataSetPlanRoute=[],this.dataSetArray=[];const n=[{dataSource:o,records:[this.props.selectedRecord],name:o.getLabel(),type:"selected"}];this.dataSetArray=n;try{[this.recordActions]=yield this.getAvailableActions(),this.recordActionNames=Object.keys(this.recordActions).filter(e=>"export"!==e)}catch(e){console.error(e),this.recordActions={}}const r=this.props.startingPointGraphic?o.buildRecord(this.props.startingPointGraphic):null;if(this.props.showPlanRoute&&"point"===(null===(t=null===(e=a.feature)||void 0===e?void 0:e.geometry)||void 0===t?void 0:t.type)&&r){this.dataSetPlanRoute=[{dataSource:o,records:[r,this.props.selectedRecord],name:o.getLabel(),type:"selected"}];const e=yield i.DataActionManager.getInstance().getSupportedActions(this.props.widgetId,this.dataSetPlanRoute,i.DataLevel.Records);(null===(s=e.PlanRoute)||void 0===s?void 0:s.length)>0&&(this.planRouteAction=e.PlanRoute[0])}}),this.getAvailableActions=()=>{let e=null,t=0;for(const e of this.dataSetArray)t+=e.records.length;return 0!==t&&(e=i.DataActionManager.getInstance().getSupportedActions(this.props.widgetId,this.dataSetArray,i.DataLevel.Records)),Promise.all([e||{}])},this.createFeature=()=>{const e=this.props.selectedRecord;if(null==e?void 0:e.feature){const t=document&&document.createElement("div");t.className="jimu-widget bg-transparent pointer";const s=this.popUpContent.current;null==s||s.insertBefore(t,s.firstChild||null);const i=new Ne.default({container:t,view:this.props.jimuMapView.view,features:[e.feature],map:this.props.jimuMapView.view.map,spatialReference:this.props.jimuMapView.view.spatialReference,visible:!0,visibleElements:{heading:!1,actionBar:!1,closeButton:!1}});i.viewModel.defaultPopupTemplateEnabled=!0,pe.watch(()=>i.viewModel.title,e=>{var t;""!==e&&(null===(t=this.featureWidgetTitle)||void 0===t?void 0:t.current)&&(this.featureWidgetTitle.current.innerHTML=e)})}},this.displayPopupTitle=()=>{let e="";return this.props.selectedRecord&&(e=this.props.selectedRecord.getFormattedFieldValue(this.props.popupTitleField,this.props.intl)),A(e,this.nls("noValueForDisplayField"))},this.onToggleSelectedLayer=()=>{this.props.isExpanded||this.setState({isFeatureLayerOpen:!this.state.isFeatureLayerOpen,isIconRight:!this.state.isIconRight},()=>{this.state.isFeatureLayerOpen&&!this.state.featureItem?this.createFeatureItem(!0):this.onFeatureDetailsClick()})},this.onFeatureDetailsClick=e=>{if(e&&e.target.tagName.toLocaleLowerCase().startsWith("calcite"))return void e.stopPropagation();const t=this.props.selectedRecord;t&&(t.getFeature().geometry?this.selectOrClearRecord():t._dataSource.queryById(this.props.selectedRecord.getId()).then(e=>{this.selectOrClearRecord(e)}))},this.selectOrClearRecord=e=>{var t,s;!(null===(s=null===(t=this.popUpContent)||void 0===t?void 0:t.current)||void 0===s?void 0:s.classList.contains("record-selected"))&&this.state.isFeatureLayerOpen?this.props.selectRecord(this.props.index,this.popUpContent.current,null!=e?e:this.props.selectedRecord):this.props.clearRecord(this.props.index)},this.createFeatureItem=(e,s)=>{var i,o,n,r,l,d,c;const u=this.props.selectedRecord;let h=null;const p=this.props.intl.formatNumber(u.feature.distance,{maximumFractionDigits:2}),g=this.props.popupTitleField&&this.props.isExpanded?this.displayPopupTitle():this.nls("approximateDistance"),y=this.props.approximateDistanceUI&&(this.props.showDistFromInputLocation||this.props.popupTitleField);h=(0,t.jsxs)("div",{children:[(s||y&&this.props.isExpanded)&&(0,t.jsxs)("div",{className:"approximateDist-container nm-border-bottom-color",children:[s&&(0,t.jsx)("div",{className:"feature-title-map-symbol",ref:this.symbolRef}),y&&(0,t.jsx)("div",{className:"approximateDist-label",children:(0,t.jsx)(a.Label,{className:"mb-0",children:g})}),this.props.showDistFromInputLocation&&this.props.approximateDistanceUI&&(0,t.jsx)(a.Label,{tabIndex:-1,className:"approximateDist mb-0 pt-0 font-weight-bold",children:(0,t.jsx)("div",{tabIndex:0,"aria-label":this.getAriaLabelString(this.nls("approximateDistance"),p,this.props.distanceUnit),children:this.getLabelForDistUnit(p,this.props.distanceUnit)})})]}),(0,t.jsxs)("div",{className:"title2 feature-widget-title-container nm-border-bottom-color",children:[(0,t.jsx)("div",{ref:this.featureWidgetTitle,className:"feature-widget-title"}),this.props.showDataActions&&((null===(i=this.recordActionNames)||void 0===i?void 0:i.length)>0||this.planRouteAction)&&(0,t.jsx)("div",{className:"pr-1",children:this.renderSupportedActionList()})]}),(0,t.jsx)("div",{tabIndex:0,className:"pb-2 pointer record-container",ref:this.popUpContent,onClick:this.onFeatureDetailsClick.bind(this),children:this.props.showClippedFeaturesInfo&&void 0!==(null===(n=null===(o=u.feature)||void 0===o?void 0:o.attributes)||void 0===n?void 0:n.esriCTClippedInfo)&&null!==(null===(l=null===(r=u.feature)||void 0===r?void 0:r.attributes)||void 0===l?void 0:l.esriCTClippedInfo)&&this.getClippedFeaturesInfo(null===(c=null===(d=u.feature)||void 0===d?void 0:d.attributes)||void 0===c?void 0:c.esriCTClippedInfo)})]}),this.setState({featureItem:h},()=>{this.createFeature(),e&&this.onFeatureDetailsClick()})},this.renderSupportedActionList=()=>{var e;const s=i.css`
     padding-top: 3px!important;
    `;return(0,t.jsx)(i.React.Fragment,{children:(0,t.jsxs)(a.Dropdown,{className:"float-right",direction:"down",size:"sm",useKeyUpEvent:!0,"aria-label":this.nls("actions"),children:[(0,t.jsx)(a.DropdownButton,{size:"sm",arrow:!1,css:s,icon:!0,ref:this.dropdownRef,className:"data-action-button",type:"tertiary",title:this.nls("actions"),children:(0,t.jsx)(We,{size:"m"})}),(0,t.jsxs)(a.DropdownMenu,{children:[(null===(e=this.recordActionNames)||void 0===e?void 0:e.length)>0&&this.recordActionNames.map(e=>this.createActionItem(this.recordActions,e,i.DataLevel.Records)),this.planRouteAction&&this.createPlanRouteAction()]})]})})},this.createPlanRouteAction=()=>{const e=this.dataSetPlanRoute[0].dataSource.id,s=i.MutableStoreManager.getInstance().getStateValue(["dataActions",this.planRouteAction.name,e,"icon"])||this.planRouteAction.icon;return(0,t.jsx)(a.DropdownItem,{header:!1,"aria-label":this.planRouteAction.label,onClick:e=>He(this,void 0,void 0,function*(){yield this.onActionItemClick(this.planRouteAction,i.DataLevel.Records)}),children:(0,t.jsxs)("div",{className:"d-flex align-items-center",children:[s&&(0,t.jsx)(i.React.Fragment,{children:"string"==typeof s?(0,t.jsx)(a.Icon,{icon:s,className:"jimu-icon-auto-color"}):s}),(0,t.jsx)("span",{className:"ml-2",children:this.planRouteAction.label})]})},this.planRouteAction.id)},this.createActionItem=(e,s,o)=>{const n=e[s];if((null==n?void 0:n.length)>0&&this.dataSetArray.length>0){if("locate"===s&&!this.props.isEnableProximitySearch)return;const e=n[0],r=this.dataSetArray[0].dataSource.id,l=i.MutableStoreManager.getInstance().getStateValue(["dataActions",e.name,r,"icon"])||e.icon;if(1===n.length)return(0,t.jsx)(a.DropdownItem,{header:!1,"aria-label":e.label,onClick:t=>He(this,void 0,void 0,function*(){yield this.onActionItemClick(e,o)}),children:(0,t.jsxs)("div",{className:"d-flex align-items-center",children:[l&&(0,t.jsx)(i.React.Fragment,{children:"string"==typeof l?(0,t.jsx)(a.Icon,{icon:l,className:"jimu-icon-auto-color"}):l}),(0,t.jsx)("span",{className:"ml-2",children:e.label})]})},e.id)}return null},this.onActionItemClick=(e,t)=>He(this,void 0,void 0,function*(){const s="active-data-action-item",a=document.querySelector(`.${s}`);let o=null;a&&a.classList.remove(s),this.dropdownRef.current.className=(0,i.classNames)(this.dropdownRef.current.className,s),o="PlanRoute"===e.name?yield i.DataActionManager.getInstance().executeDataAction(e,this.dataSetPlanRoute,t,this.props.widgetId):yield i.DataActionManager.getInstance().executeDataAction(e,this.dataSetArray,t,this.props.widgetId),null!==o&&"boolean"!=typeof o&&this.setState({actionElement:i.React.cloneElement(o,{onClose:()=>{this.setState({actionElement:null})},onConfirm:(...e)=>(!o.props.keepOpenAfterConfirm&&this.setState({actionElement:null}),o.props.onConfirm(...e))})})}),this.getAriaLabelString=(e,t,s)=>{let i="";return i=this.props.intl.formatMessage({id:"ariaLabelString",defaultMessage:o.ariaLabelString},{label:e,formattedDist:t,distUnit:s}),i},this.getLabelForDistUnit=(e,t)=>{let s="";return s=this.props.intl.formatMessage({id:"distanceUnitLabel",defaultMessage:o.distanceUnitLabel},{distanceLabel:e,unitLabel:t}),s},this.popUpContent=i.React.createRef(),this.symbolRef=i.React.createRef(),this.featureWidgetTitle=i.React.createRef(),this.planRouteAction=null,this.recordActionNames=[],this.recordActions={},this.props.config&&(this.state={isFeatureLayerOpen:this.props.isExpanded,isIconRight:!this.props.isExpanded,title:"",isTitleLoaded:!1,featureItem:null,actionElement:null})}getClippedFeaturesInfo(e){const s=this.props.selectedRecord.feature;let i=this.props.intl.formatNumber(e,{useGrouping:!0,notation:"standard",maximumFractionDigits:2,minimumFractionDigits:2}),n="";"0.00"===i&&(i=P(e));const r=this.props.distanceUnit;if(s&&s.geometry){const e=s.geometry.type;"polyline"===e?n=this.props.intl.formatMessage({id:"clippedLengthLabel",defaultMessage:o.clippedLengthLabel},{value:i,unit:r}):"polygon"!==e&&"extent"!==e||(n=this.props.intl.formatMessage({id:"clippedAreaLabel",defaultMessage:o.clippedAreaLabel},{value:i,unit:r+"\xb2"}))}return(0,t.jsx)("div",{className:"px-2 pt-2",children:(0,t.jsx)(a.Label,{className:"mb-0 font-italic",role:"note",children:n})})}render(){const e=this.props.selectedRecord,s=this.displayPopupTitle();let o,n=s;void 0!==e.feature.distance&&(o=this.props.intl.formatNumber(e.feature.distance,{maximumFractionDigits:2}),n=this.getAriaLabelString(n,o,this.props.distanceUnit));const r=(l=this.props.theme,i.css`


  margin: 2px 0px;

  .feature-title-container {
    display: inline-flex;
    align-items: center;
    width: 100%;
    cursor: pointer;
    justify-content: space-between;
  }

  .pointer {
    cursor: pointer;
  }

  .record-container {
    border-left: 3px solid transparent;
    margin: 6px 12px 12px 12px !important;
  }

  .record-container .esri-features .esri-features__container {
    padding: 0 !important;
    overflow: hidden !important;
  }

  .record-selected {
    border-left: 3px solid ${null!==(c=null===(d=null==l?void 0:l.sys.color)||void 0===d?void 0:d.primary.main)&&void 0!==c?c:"#16eaf1"};
  }

  .feature-title {
    padding: 5px 2px 5px 10px;
  }

  .label-title {
    margin: 0;
    padding-top: 3px;
    word-break: break-word;
  }

  .expand-list-label-title {
    padding-left: 10px;
  }

  .approximateDist-container {
    display: inline-flex;
    align-items: center;
    width: 100%;
    padding: 5px 10px 5px 0;
  }

  .approximateDist-label{
    width: calc(100% - 60px);
    font-weight: bold;
    padding: 2px 0 0 10px;
  }

  .approximateDist{
    margin-bottom: 0px;
    width: 100px;
    text-align: end;
    padding-top: 3px;
  }

  .donutWidth {
    right: 26%;
  }

  .feature-title-map-symbol {
    margin-left: 10px;
    width: 20px;
  }

  .feature-widget-title-container {
    display: inline-flex;
    align-items: center;
    width: 100%;
    padding: 5px 0px 4px 0;
  }

  .feature-widget-title {
    width: calc(100% - 44px);
    font-weight: bold;
    font-size: 14px;
    word-break: break-word;
    word-wrap: break-word;
    margin-left: 10px;
  }

  .nm-border-bottom-color {
    border-bottom: 1px solid ${l.sys.color.divider.secondary};
  }
  `);var l,d,c;return(0,t.jsxs)("div",{style:{borderTop:"1px solid var(--sys-color-divider-secondary)"},className:"feature-container w-100 m-0",css:r,children:[this.props.selectedFeatureLength>0&&this.props.popupTitleField&&!this.props.isExpanded&&(0,t.jsxs)(i.React.Fragment,{children:[(0,t.jsx)(a.Row,{flow:"wrap",children:(0,t.jsxs)("div",{className:!this.props.approximateDistanceUI&&this.state.isFeatureLayerOpen?"feature-title-container nm-border-bottom-color":"feature-title-container",onClick:this.onToggleSelectedLayer.bind(this),tabIndex:0,role:"button","aria-label":n,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.props.isExpanded||this.onToggleSelectedLayer()},onMouseOver:()=>{this.props.highlightFeature(e,!0)},onMouseLeave:()=>{this.props.highlightFeature(e,!1)},children:[(0,t.jsxs)("div",{className:"d-inline-flex",children:[this.props.displayMapSymbol&&(0,t.jsx)("div",{className:"feature-title-map-symbol",ref:this.symbolRef}),(0,t.jsx)("div",{className:"feature-title",children:(0,t.jsx)(a.Label,{className:this.props.isExpanded?"label2 label-title expand-list-label-title":"label2 label-title",children:s})})]}),(0,t.jsxs)("div",{className:"d-inline-flex",children:[void 0!==e.feature.distance&&this.props.showDistFromInputLocation&&(0,t.jsx)(a.Label,{className:"label2 approximateDist pr-1",children:this.getLabelForDistUnit(o,this.props.distanceUnit)}),(0,t.jsxs)(a.Button,{tabIndex:-1,type:"tertiary",icon:!0,role:"button","aria-expanded":this.state.isFeatureLayerOpen,className:"actionButton p-0",children:[this.state.isIconRight&&(0,t.jsx)(y,{size:"m",autoFlip:!0}),!this.state.isIconRight&&(0,t.jsx)(u,{size:"m"})]})]})]})}),(0,t.jsx)(a.Collapse,{isOpen:this.state.isFeatureLayerOpen,className:"w-100",children:this.state.featureItem})]}),this.props.popupTitleField&&this.props.isExpanded&&this.state.featureItem,1===this.props.selectedFeatureLength&&!this.props.popupTitleField&&this.state.featureItem,this.state.actionElement]})}}var Je=L(21625),qe=L(42735),Ze=L(24883),Qe=L(18717),Ke=L(43751),Xe=L(59028),Ye=L(33142),et=L(71082),tt=L(73387),st=L(21935),it=L.n(st),at=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const ot=e=>{const s=window.SVG,{className:a}=e,o=at(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:it()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var nt=L(15710),rt=L.n(nt),lt=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const dt=e=>{const s=window.SVG,{className:a}=e,o=lt(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:rt()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var ct=L(9044),ut=L.n(ct),ht=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const pt=e=>{const s=window.SVG,{className:a}=e,o=ht(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:ut()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var gt=L(85633);class yt extends i.React.PureComponent{constructor(e){super(e),this.componentDidMount=()=>{this.updateTextColor()},this.componentDidUpdate=e=>{e.fieldColor!==this.props.fieldColor&&this.updateTextColor()},this.updateTextColor=()=>{const e=this.getTextColor(this.props.fieldColor);this.setState({textColor:e})},this.onResize=({width:e,height:t})=>{e>0&&setTimeout(()=>{if(e<280)this.setState({fieldLabelWidth:"100%"});else{const e=this.summaryValue.current.offsetWidth+9,t=this.summaryField.current.offsetWidth,s=this.summaryCardParent.current.offsetWidth-16;(t+e<=s||s===t+8)&&e>0&&this.setState({fieldLabelWidth:"calc(100% - "+e+"px)"})}},50)},this.getTextColor=e=>{if(""!==e&&"#FFFFFF00"!==e){return(299*parseInt(e.substr(1,2),16)+587*parseInt(e.substr(3,2),16)+114*parseInt(e.substr(4,2),16))/1e3<60?"#FFFFFF":"#000000"}return""},this.summaryValue=i.React.createRef(),this.summaryField=i.React.createRef(),this.summaryCardParent=i.React.createRef(),this.widgetConRef=i.React.createRef(),this.state={textColor:"",fieldLabelWidth:""}}render(){return(0,t.jsxs)("div",{ref:this.widgetConRef,css:(this.props.theme,e=this.props.fieldColor,s=this.state.textColor,o=this.state.fieldLabelWidth,i.css`

  .summaryCard {
    margin: auto;
    width: 96%;
    align-items: center;
    display: flex;
    flex-flow: row wrap;
  }

  .field {
    width: ${o};
    font-weight: 500;
  }

  .summary-value {
    font-size: large;
  }

  .summaryBgColor {
    background-color: ${e};
  }

  .textColor {
    color: ${s};
  }`),children:[(0,t.jsx)(a.Row,{flow:"wrap",children:(0,t.jsxs)("div",{className:"summaryCard pl-2 pr-2 pt-5 pb-5 mb-2 rounded-2 summaryBgColor shadow-2",ref:this.summaryCardParent,children:[(0,t.jsx)("div",{ref:this.summaryField,className:"title3 field textColor text-break mr-2",children:(0,t.jsx)("label",{className:"w-100 mb-0",children:this.props.fieldLabel})}),this.props.summaryDisplayValue&&(0,t.jsx)("div",{ref:this.summaryValue,children:(0,t.jsx)("div",{className:"font-weight-bold summary-value textColor",children:this.props.summaryDisplayValue})})]})}),(0,t.jsx)(i.ReactResizeDetector,{targetRef:this.widgetConRef,handleWidth:!0,handleHeight:!0,onResize:this.onResize})]});var e,s,o}}var ft=L(1888);class mt extends i.React.PureComponent{constructor(e){super(e),this.componentDidMount=()=>{this.updateSummaryValue()},this.componentDidUpdate=e=>{e.sumOfAreaOrLengthValue!==this.props.sumOfAreaOrLengthValue&&this.updateSummaryValue()},this.updateSummaryValue=()=>{if(this.props.useDataSource&&this.props.summaryFieldInfos){this.resolvedSummaryValues=[];const e=[];this.props.summaryFieldInfos.forEach(t=>{var s;let i;const a=t.summaryFieldInfo;Object.prototype.hasOwnProperty.call(t.summaryFieldInfo,"summaryBy")?(i=null===(s=this.props.sumOfAreaOrLengthValue)||void 0===s?void 0:s.toString(),e.push(i),this.resolvedSummaryValues.push(i),1===this.props.summaryFieldInfos.length&&this.onTextExpResolveChange({})):(i=this.getExpressionString(a),e.push(i))}),this.setState({formattedExpression:e.join("")})}},this.getExpressionString=e=>{try{let t=JSON.stringify(e);t=encodeURIComponent(t);const{parts:s}=e;let a="",o="";null==s||s.forEach(e=>{const{dataSourceId:t}=e;if(t&&(a=t),""!==a)return!1});const n=i.utils.getUUID();this.resolvedSummaryValues.push(n);const r=document&&document.createElement("exp");return r.setAttribute("data-uniqueid",n),r.setAttribute("data-dsid",a),r.setAttribute("data-expression",t),r.innerHTML=e.name,o+=r.outerHTML,o}catch(e){return console.error(e),""}},this.onTextExpResolveChange=e=>{const s={},i=[];this.resolvedSummaryValues.forEach((a,o)=>{let n=a;if(e[a]&&(n=e[a].isSuccessful?e[a].value:this.props.summaryFieldInfos[o].fieldLabel),void 0!==n){const e=this.props.summaryFieldInfos[o];s[e.fieldLabel.replace(/ /g,"")]=n,i.push((0,t.jsx)(yt,{widgetId:this.props.widgetId,theme:this.props.theme,fieldLabel:e.fieldLabel,fieldColor:ft.colorUtils.parseThemeVariable(this.props.singleFieldColor?this.props.singleFieldColor:e.fieldColor,this.props.theme),summaryDisplayValue:n},o))}}),this.setState({summaryFieldCards:i}),this.props.onSummaryFieldsResolved(s)},this.resolvedSummaryValues=[],this.state={formattedExpression:null,summaryFieldCards:[]}}render(){const e={};return e[this.props.useDataSource.dataSourceId]=this.props.records,(0,t.jsx)(i.React.Fragment,{children:this.props.useDataSource&&this.state.formattedExpression&&(0,t.jsxs)(i.React.Fragment,{children:[0===this.state.summaryFieldCards.length&&(0,t.jsx)(i.ExpressionResolverComponent,{useDataSources:(0,i.Immutable)([this.props.useDataSource]),expression:a.richTextUtils.getAllExpressions(this.state.formattedExpression),records:e,onChange:this.onTextExpResolveChange,widgetId:this.props.widgetId}),this.state.summaryFieldCards]})})}}var vt=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};class bt extends i.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.13.0",description:"To avoid crash, reset the previous configuration from beta release",upgrader:e=>{let t=e;if(t=t.setIn(["generalSettings","promptTextMessage"],""),t=t.setIn(["generalSettings","promptTextMsgStyleSettings"],{fontFamily:"Avenir Next",fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1,fontColor:"var(--ref-palette-black)",fontSize:"12px"}),t.configInfo)for(const e in t.configInfo)t=t.setIn(["configInfo",e],Ie);return t}},{version:"1.14.0",description:"Upgrade search settings and analysis settings config",upgrader:e=>{let t=e;if(t.configInfo)for(const s in t.configInfo){const i=e.configInfo[s].searchSettings;t=t.setIn(["configInfo",s,"searchSettings","showInputAddress"],!0),t=t.setIn(["configInfo",s,"searchSettings","headingLabelStyle"],{fontFamily:"Avenir Next",fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1,fontColor:"var(--ref-palette-black)",fontSize:"13px"}),t=t.setIn(["configInfo",s,"searchSettings","sketchTools"],{showPoint:i.showSketchTools,showPolyline:i.showSketchTools,showPolygon:i.showSketchTools}),t=t.setIn(["configInfo",s,"analysisSettings","displayMapSymbols"],!1),t=t.setIn(["configInfo",s,"analysisSettings","showDistFromInputLocation"],i.showDistFromInputLocation),t=t.setIn(["configInfo",s,"analysisSettings","onlyShowLayersResult"],i.onlyShowLayersResult)}return t}},{version:"1.15.0",description:"Upgrade analysis setting config for fieldsToExport, group, sub-group and use data sources with fields",upgradeFullInfo:!0,upgrader:t=>vt(this,void 0,void 0,function*(){let s=t.widgetJson.config;const a={subGroupFeaturesByField:"",subGroupFeaturesOrder:i.OrderRule.Asc,sortSubGroupsByCount:!1,noValueSubGroupLabel:""},o=[],n=[];if(s.configInfo){const e=i.DataSourceManager.getInstance();for(const t in s.configInfo)s.configInfo[t].analysisSettings.layersInfo.length>0&&s.configInfo[t].analysisSettings.layersInfo.forEach(t=>(t.useDataSource&&!n.includes(t.useDataSource.dataSourceId)&&(n.push(t.useDataSource.dataSourceId),o.push(e.createDataSourceByUseDataSource(t.useDataSource))),!1))}if(yield Promise.allSettled(o),s.configInfo)for(const i in s.configInfo)s.configInfo[i].analysisSettings.layersInfo.length>0&&s.configInfo[i].analysisSettings.layersInfo.forEach((o,n)=>{if(s=s.setIn(["configInfo",i,"analysisSettings","layersInfo",n,"analysisInfo","fieldsToExport"],O(o.useDataSource.dataSourceId)),o.analysisInfo.analysisType!==e.Summary&&(s=s.setIn(["configInfo",i,"analysisSettings","layersInfo",n,"analysisInfo","includeApproxDistance"],!1)),o.analysisInfo.analysisType===e.Proximity){const e=t.widgetJson.config.configInfo[i].analysisSettings.layersInfo[n].analysisInfo.sortGroupsByCount;s=s.setIn(["configInfo",i,"analysisSettings","layersInfo",n,"analysisInfo","groupFeatures","sortGroupsByCount"],e),s=s.setIn(["configInfo",i,"analysisSettings","layersInfo",n,"analysisInfo","groupFeatures","noValueGroupLabel"],""),s=s.setIn(["configInfo",i,"analysisSettings","layersInfo",n,"analysisInfo","subGroupFeatures"],a)}return!1});let r=t.widgetJson.set("config",s);r=r.set("useDataSources",R(r.config.configInfo));return Object.assign(Object.assign({},t),{widgetJson:r})})},{version:"1.16.0",description:"Upgrade analysis settings config",upgrader:t=>vt(this,void 0,void 0,function*(){let s=t;const a=[],o=[],n=i.DataSourceManager.getInstance();if(s.configInfo)for(const e in s.configInfo)s=s.setIn(["configInfo",e,"analysisSettings","displayAllLayersResult"],!1),s.configInfo[e].analysisSettings.layersInfo.length>0&&s.configInfo[e].analysisSettings.layersInfo.forEach((e,t)=>(e.useDataSource&&!o.includes(e.useDataSource.dataSourceId)&&(o.push(e.useDataSource.dataSourceId),a.push(n.createDataSourceByUseDataSource(e.useDataSource))),!1));if(yield Promise.allSettled(a),s.configInfo)for(const t in s.configInfo)s=s.setIn(["configInfo",t,"analysisSettings","displayAllLayersResult"],!1),s=s.setIn(["configInfo",t,"analysisSettings","enableProximitySearch"],!1),s.configInfo[t].analysisSettings.layersInfo.length>0&&s.configInfo[t].analysisSettings.layersInfo.forEach((i,a)=>{const o=n.getDataSource(i.useDataSource.dataSourceId);return"esriGeometryPolygon"!==(null==o?void 0:o.getGeometryType())||i.analysisInfo.analysisType!==e.Closest&&i.analysisInfo.analysisType!==e.Proximity||(s=s.setIn(["configInfo",t,"analysisSettings","layersInfo",a,"analysisInfo","returnIntersectedPolygons"],!1)),!1});return s})},{version:"1.17.0",description:"Upgrade analysis settings config in results section",upgrader:e=>{let t=e;const s={saveInputLocation:!1,pointFeature:{enabled:!1,useDataSource:null},polylineFeature:{enabled:!1,useDataSource:null},polygonFeature:{enabled:!1,useDataSource:null},searchAreaFeature:{enabled:!1,useDataSource:null}};if(t.configInfo)for(const e in t.configInfo)t=t.setIn(["configInfo",e,"analysisSettings","saveFeatures"],s);return t}},{version:"1.18.0",description:"Upgrade general settings config",upgrader:e=>vt(this,void 0,void 0,function*(){let t=e;const s=yield(0,i.loadArcGISJSAPIModules)(["esri/Color"]),a=ft.colorUtils.parseThemeVariable(t.generalSettings.highlightColor,(0,ft.getAppThemeVariables)()),o=new s[0](a);o.a=.3;const n=new s[0](a);n.a=1;const r={type:"esriSFS",color:o,outline:{type:"esriSLS",color:n,width:1.5,style:"esriSLSSolid"},style:"esriSFSSolid"};if(t&&(t=t.setIn(["generalSettings","searchAreaSymbol"],r),t=t.setIn(["generalSettings","keepResultsWhenClosed"],!0),t.configInfo))for(const e in t.configInfo)t=t.setIn(["configInfo",e,"searchSettings","activeToolWhenWidgetOpens"],"none");return t})},{version:"1.19.0",description:"Upgrade displayFeatureCount from analysisSettings to each analysisInfo",upgradeFullInfo:!0,upgrader:e=>{var t,s;let i=e.widgetJson.config;if(i.configInfo)for(const e in i.configInfo){const a=i.configInfo[e].analysisSettings,o=null===(t=null==a?void 0:a.displayFeatureCount)||void 0===t||t;(null===(s=null==a?void 0:a.layersInfo)||void 0===s?void 0:s.length)>0&&a.layersInfo.forEach((t,s)=>{i=i.setIn(["configInfo",e,"analysisSettings","layersInfo",s,"analysisInfo","displayFeatureCount"],o)})}let a=e.widgetJson.set("config",i);a=a.set("useDataSources",R(a.config.configInfo));return Object.assign(Object.assign({},e),{widgetJson:a})}}]}}const St=new bt;var wt=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const xt=Object.keys(me);class It extends i.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},o,a.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.handleLegendCreation()},this.getPageSizeInPixels=(e,t)=>({Height:me[e].height*t,Width:me[e].width*t}),this.getMapSizeInPixels=(e,t)=>({Height:ve[e].height*t,Width:ve[e].width*t}),this.getLegendSizeInPixels=(e,t)=>({Height:be[e].height*t,Width:be[e].width*t}),this.getPageWidthInPixels=()=>{let e;if(this.reportArea){const t=this.reportArea.layout;e=this.getPageSizeInPixels(t,this.reportArea.dpi)}return e.Width},this.getReportSizeMessage=()=>{const e=this.reportArea.layout,t=this.nls(e),s=" ("+me[e].width+"'' X "+me[e].height+"'') ";return this.props.intl.formatMessage({id:"reportDimensionsMsg",defaultMessage:o.reportDimensionsMsg},{paperSize:t+s})},this.handleLegendCreation=()=>{var e,t;null!=this.props.mapView.view&&(null===(t=null===(e=this.props.mapView)||void 0===e?void 0:e.view)||void 0===t||t.when(e=>wt(this,void 0,void 0,function*(){var t;null!=this.legend&&(this.legend.destroy(),this.legend=null);const i=document.createElement("div"),[a]=yield(0,s.loadArcGISJSAPIModules)(["esri/widgets/Legend"]);this.legend=new a({container:i,view:e,respectLayerDefinitionExpression:!0,style:{type:"card",layout:"side-by-side"}}),"ready"!==(null===(t=this.legend.viewModel)||void 0===t?void 0:t.state)?pe.watch(()=>{var e;return null===(e=this.legend.viewModel)||void 0===e?void 0:e.state},e=>{"ready"===e&&this.setState({enableExportButton:!0})}):this.setState({enableExportButton:!0})})))},this.formatAndRenderTables=(e,t)=>{const s=t.data,i=this.state.mergeRowsEnabled?t.groupFieldCol:null,a=this.state.mergeRowsEnabled?t.subgroupFieldCol:null;let n,r,l,d,c=3;if(s.maxNoOfCols&&(c=s.maxNoOfCols),s.cols.length>c){s.cols.length-c<=2&&(c=s.cols.length)}for(n=0,r=s.cols.length;n<r;n+=c){const r={cols:[],rows:[],title:"",totalCount:0,groupFieldCol:void 0,subgroupFieldCol:void 0};let u=n+c,h=!1;if(0===n){const e=this.props.intl.formatMessage({id:"totalCountLabel",defaultMessage:o.totalCountLabel},{tableTitle:t.title,total:t.totalCount});r.title=e}else r.title="";const p=s.cols.length-u;p<=2&&p>0&&(u+=p,h=!0),l=s.cols.slice(n,u),d=[];for(let e=0;e<s.rows.length;e++)d.push(s.rows[e].slice(n,u));r.cols=l,r.rows=d;const g=document.createElement("div");if(g.className="esriCTSectionTitle",g.innerHTML=r.title,e.appendChild(g),0===n&&(null!=i&&(r.groupFieldCol=i),null!=a&&(r.subgroupFieldCol=a)),this.renderTable(e,r,t.data.showRowIndex),h)break}return e},this.renderTable=(e,t,s)=>{const i=document.createElement("table");i.className="esriCTTable",i.style.width="100%",e.appendChild(i);const a=document.createElement("tbody");i.appendChild(a);const o=document.createElement("tr");if(a.appendChild(o),s){const e=document.createElement("th");e.innerHTML="#",e.style.width="50px",e.style.wordBreak="break-word",e.style.padding="4px",o.appendChild(e)}t.cols.forEach(e=>{const t=document.createElement("th");t.innerHTML=e,t.style.wordBreak="break-word",t.style.padding="4px",o.appendChild(t)}),t.rows.forEach((e,t)=>{const i=document.createElement("tr");if(a.appendChild(i),s){const e=document.createElement("td");e.style.padding="4px",e.style.wordBreak="break-word",e.style.wordBreak="normal",e.innerHTML=t+1,i.appendChild(e)}e.forEach(e=>{const t=document.createElement("td");t.style.padding="4px",e===this.nls("noData")&&(t.style.fontStyle="italic"),t.innerHTML=e,i.appendChild(t)})}),void 0!==t.groupFieldCol&&this.addRowSpans(i,[t.subgroupFieldCol,t.groupFieldCol])},this.renderHtmlContent=()=>{const e=document.createElement("div");let t;return this.props.reportData.forEach(s=>{t=this.formatAndRenderTables(e,s)}),t},this.onTemplateChange=e=>{this.setState({template:e.target.value});const t=xt.filter(t=>e.target.value===t);this.reportArea.layout=t[0],t[0].includes(Se.Portrait)?this.reportArea.orientation=Se.Portrait:this.reportArea.orientation=Se.Landscape},this.titleLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({templateTitle:null!=t?t:t.trim()})}},this.getReportTemplate=()=>wt(this,void 0,void 0,function*(){var e,t,s,i,a,o,n,r;const l=this.state.templateTitle,d=this.getPageWidthInPixels(),c=this.getLegendSizeInPixels(this.reportArea.layout,this.reportArea.dpi).Height-8,u=Math.trunc(d/200),h=["200px"];for(let e=1;e<u;e++)h.push("200px");const p=this.getReportSizeMessage(),g=this.renderHtmlContent();this.scaleBar=this.handleScaleBar(),this.compass=this.handleCompass(),this.attribution=this.handleAttribution();const y=yield this.viewScreenshot(),f=`${this.props.folderUrl}dist/runtime/assets/js/print.js`;let m="28px",v="18px";switch(this.reportArea.layout){case"a3Portrait":case"a4Landscape":case"letterAnsiALandscape":m="28px",v="27px";break;case"a3Landscape":m="42px",v="40px";break;case"a4Portrait":m="20px",v="18px";break;case"letterAnsiAPortrait":m="20px",v="19px";break;case"tabloidAnsiBPortrait":m="26px",v="25px";break;case"tabloidAnsiBLandscape":m="41px",v="40px"}return`\n      <!DOCTYPE HTML>\n      <html lang="en" dir="ltr">\n        <head id="reportHead">\n            <meta charset="utf-8">\n            <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">\n            <title></title>\n            \x3c!-- Report prev page css --\x3e\n            <style type="text/css">\n                .esriCTReportMapWait {\n                    height: 5px;\n                    width: 100%;\n                    position: relative;\n                    overflow: hidden;\n                    background-color: #ddd;\n                }\n\n                .esriCTReportMapWait:before {\n                    display: block;\n                    position: absolute;\n                    content: "";\n                    left: -200px;\n                    width: 200px;\n                    height: 5px;\n                    background-color: #2980b9;\n                    animation: loading 2s linear infinite;\n                }\n\n                .display-none {\n                  display: none;\n                }\n\n                .esrCTAOIInfoDiv {\n                  position: relative;\n                  margin-top: 8px;\n                }\n\n                .jimu-rtl .esrCTAOIInfoDiv {\n                  direction: rtl;\n                }\n\n                .esriAOITitle {\n                  font-size: 18px;\n                  font-weight: bold;\n                  color: #000000;\n                  width: 100%;\n                }\n\n                .esriCTAOITitleInput {\n                  font-size: 18px;\n                  font-weight: bold;\n                  color: #000000;\n                  width: 100%;\n                  border: none;\n                  padding: 0px;\n                }\n\n                .esriCTAOIArea {\n                  visibility: ${this.props.showAreaOfInterest?"visible":"hidden"};\n                  margin: 10px 0;\n                  font-size: 16px;\n                }\n\n                .esriCTAOIInputArea {\n                  border: none;\n                  font-size: 16px;\n                  width: 100%;\n                  padding: 0px;\n                }\n\n                .esriCTPrintLocaleDateDiv {\n                  margin: 10px 0;\n                  font-size: 16px;\n                }\n\n                .esriCTLocaleDateInputTitle {\n                  height: 30px;\n                  line-height: 30px;\n                  border: none;\n                  font-size: 16px;\n                  width: 100%;\n                  padding: 0px;\n                }\n\n                .compassContainer {\n                  display: ${(null===(e=this.compass)||void 0===e?void 0:e.innerHTML)?"block":"none"};\n                  position: absolute;\n                  top: 45px;\n                  left: 45px;\n                  background: #fff;\n                  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);\n                  --calcite-ui-icon-color: #000;\n                  border-radius: 50%;\n                }\n\n                .compassContainer .esri-compass {\n                  border-radius: 50%;\n                }\n\n                .compassContainer .esri-compass__icon.esri-icon-compass {\n                  color: #000;\n                }\n\n                .compassContainer .esri-widget--button {\n                  text-align: center;\n                  flex-flow: row;\n                  justify-content: center;\n                  align-items: center;\n                  width: 32px;\n                  height: 32px;\n                  margin: 0;\n                  padding: 0;\n                  font-size: 12px;\n                  transition: background-color .125s ease-in-out;\n                  display: flex;\n                  overflow: hidden;\n                }\n\n                .compassContainer .esri-compass__icon-container {\n                  justify-content: center;\n                  display: flex;\n                }\n\n                .scaleBarContainer {\n                  display: ${"3d"!==this.props.mapView.view.type&&(null===(t=this.scaleBar)||void 0===t?void 0:t.innerHTML)?"block":"none"};\n                  position: absolute;\n                  bottom: 4px;\n                  left: ${v};\n                }\n\n                .print__scale-bar-container .esri-scale-bar__label {\n                  color: #323232;\n                  font-size: 10px;\n                  padding: 0 4px;\n                }\n\n                .scaleBarContainer .esri-scale-bar__bar-container:nth-child(1n+3) {\n                    display: none;\n                }\n\n                .scaleBarContainer .esri-scale-bar__line--bottom {\n                  width: ${this.scaleWidth} !important;\n                  border-top: 2px solid #323232;\n\n                }\n\n                .scaleBarContainer .esri-scale-bar__label-container .esri-scale-bar__label {\n                  border-left: 1px solid #323232;\n                  border-right: 2px solid #323232;\n                  background-color: rgba(255, 255, 255, 0.66);\n                }\n\n                .scaleBarContainer .esri-scale-bar__line--top:before,\n                .scaleBarContainer .esri-scale-bar__line--top:after,\n                .scaleBarContainer .esri-scale-bar__line--bottom:before,\n                .scaleBarContainer .esri-scale-bar__line--bottom:after {\n                    background-color: #323232;\n                    border-right: 2px solid #323232;\n                }\n\n                .scale-attribution {\n                  position: absolute;\n                  bottom: 5px;\n                  right: ${m};\n                  text-align: right;\n                  max-width: calc(100% - ${"2d"===this.props.mapView.view.type?"300px":"80px"});\n\t\t              display: ${(null===(s=this.attribution)||void 0===s?void 0:s.innerHTML)?"block":"none"};\n                }\n\n                .attribution-group {\n                  width: 100%;\n                  display: flex;\n                  align-items: flex-start;\n                }\n\n                .shell-attribution {\n                  width: 100% !important;\n                  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.20);\n                }\n\n                .attribution-ui {\n                  pointer-events: auto;\n                  position: relative;\n                }\n\n                .attributionContainer {\n                  position: relative;\n                  color: #323232;\n                  background-color: rgba(255, 255, 255, 0.65);\n                  flex-flow: column;\n                  justify-content: space-between;\n                  align-items: center;\n                  font-size: 12px;\n                  line-height: 16px;\n                  display: flex;\n                }\n\n                .attributionContainer .esri-attribution__sources {\n                  flex: 1 0;\n                  align-self: flex-start;\n                  padding: 0 5px;\n                  font-weight: 300;\n                  overflow: hidden;\n                }\n\n                .attributionContainer .esri-attribution__powered-by {\n                  text-align: right;\n                  white-space: nowrap;\n                  align-self: flex-end;\n                  padding: 0 5px;\n                  font-weight: 400;\n                }\n\n                .printLegendContainer {\n                    background: #fff;\n                    width: 98%;\n                    max-height: ${this.state.limitLegend?c+"px":"auto"};\n                    margin: 20px 2%;\n                    display: block;\n                    overflow: ${this.state.limitLegend?"hidden":"initial"};\n                }\n\n                .jimu-rtl .printLegendContainer {\n                    direction: rtl;\n                }\n\n                .esri-legend {\n                    overflow: hidden auto;\n                }\n\n                .esri-widget {\n                    --esri-widget-padding-x: 15px;\n                    --esri-widget-padding-y: 12px;\n                    --esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);\n                    box-sizing: border-box;\n                    color: #323232;\n                    background-color: #fff;\n                    font-family: Avenir Next, Helvetica Neue, helvetica, arial, sans-serif;\n                    font-size: 14px;\n                    line-height: 1.3em;\n                }\n\n                .printLegendContainer .esri-legend--card {\n                    border: none;\n                    gap: 6pt 12pt;\n                    display: grid;\n                    grid-template-columns: ${h.join(" ")};\n                }\n\n                .esri-legend--card,\n                .esri-legend--card__service-content {\n                    flex-flow: row wrap;\n                }\n\n                .esri-legend--card__service-content {\n                    height: calc(100% - 60px);\n                    display: flex;\n                }\n\n                .printLegendContainer .esri-widget>*:not(.esri-scale-bar.esri-widget > *) {\n                    background: #fff;\n                    color: #323232;\n                }\n\n                .esri-legend--card {\n                    transition: max-width .25s ease-in-out;\n                    display: flex;\n                    position: relative;\n                }\n\n                .printLegendContainer .esri-legend--card__section {\n                    padding: 0pt 0 0pt;\n                    min-width: unset;\n                }\n\n                .printLegendContainer .esri-legend--card__section:first-child {\n                    border-left: none;\n                }\n\n                .esri-legend--card__section {\n                    font-size: 12px;\n                    overflow: visible;\n                }\n\n                .printLegendContainer .esri-legend--card__service {\n                    border: none;\n                    flex: 0 1 auto;\n                    break-inside: avoid;\n                }\n\n                section.esri-legend--card__service.esri-legend--card__group-layer-child {\n                    margin: ${this.props.isRTL?"10px 10px 0 0":"10px 0 0 10px"}\n                }\n\n                .esri-legend--card__service {\n                    min-width: fit-content;\n                }\n\n                .printLegendContainer .esri-legend--card__service-caption-container {\n                    padding: 0;\n                    border-bottom: none;\n                }\n\n                .esri-legend--card__service-caption-container {\n                    font-weight: 600;\n                }\n\n                .printLegendContainer .esri-legend--card__service-caption-text {\n                    padding-bottom: 4px;\n                    word-break: break-word;\n                }\n\n                .esri-legend--card__service-caption-text {\n                    margin: 0;\n                    overflow: auto;\n                }\n\n                .esri-legend--card__label-container {\n                    margin-bottom: 10px;\n                    flex-wrap: wrap;\n                    display: flex;\n                    column-gap: 20px;\n                    row-gap: 10px;\n                }\n\n                .esri-legend--card__label-element {\n                    min-height: 23px;\n                    min-width: 30px;\n                }\n\n                .esriCTReportMapImg {\n                    margin-top: 10px;\n                    border: 1px solid black;\n                }\n\n                @keyframes loading {\n                    from {\n                        left: -200px;\n                        width: 30%;\n                    }\n\n                    50% {\n                        width: 30%;\n                    }\n\n                    70% {\n                        width: 70%;\n                    }\n\n                    80% {\n                        left: 50%;\n                    }\n\n                    95% {\n                        left: 120%;\n                    }\n\n                    to {\n                        left: 100%;\n                    }\n                }\n\n                .esriCTHTMLData {\n                    position: relative;\n                    width: 100%;\n                    height: auto;\n                }\n\n                .jimu-rtl .esriCTHTMLData {\n                    direction: rtl;\n                }\n\n                .esriCTTable {\n                    margin-top: 10px;\n                    padding: 0;\n                    border-collapse: collapse;\n                    border-spacing: 0;\n                    width: 100%;\n                    page-break-inside: avoid;\n                    table-layout: fixed;\n                }\n\n                .jimu-rtl .esriCTTable {\n                    direction: rtl;\n                }\n\n                .esriCTTable th {\n                    border: 1px solid gray;\n                    background-color: ${this.props.theme.ref.palette.primary[100]};\n                    word-wrap: break-word;\n                }\n\n                .esriCTTable td {\n                    border: 1px solid gray;\n                    word-wrap: break-word;\n                }\n\n                .esriCTSectionTitle {\n                    font-size: 18px;\n                    font-weight: bold;\n                    margin: 15px 0px;\n                    width: calc(100% - 10px);\n                    word-break: break-all;\n                }\n\n                .jimu-rtl .esriCTSectionTitle {\n                    direction: rtl;\n                }\n\n                .jimu-rtl .esriCTReportMap .esriCTSectionTitle {\n                    float: none;\n                }\n\n                .esriCTReportLogo {\n                    float: left;\n                    max-width: calc(50% - 10px);\n                    margin: auto 10px auto 0;\n                    max-height: 90%;\n                    position: absolute;\n                    top: 0;\n                    bottom: 0;\n                }\n\n                .jimu-rtl .esriCTReportLogo {\n                    float: right;\n                    margin: auto 0 auto 10px;\n                }\n\n                .esriCTPrintTitleDiv {\n                    height: 56px;\n                    float: left;\n                    width: 100%;\n                }\n\n                .jimu-rtl .esriCTPrintTitleDiv {\n                    float: right;\n                    direction: rtl;\n                }\n\n                .esriCTInputTitle {\n                    height: 55px;\n                    line-height: 55px;\n                    border: none;\n                    font-size: 25px;\n                    width: 100%;\n                    padding: 0px;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    white-space: nowrap;\n                }\n\n                .esriCTInputTitle::-ms-clear {\n                    display: none;\n                }\n\n                .esriCTReportMain {\n                    background: #FFF;\n                    border: solid 1px #000;\n                    margin: 0 auto;\n                    padding: 20px;\n                    width: 797px;\n                }\n\n                .esriCTReportMap {\n                    text-align: center;\n                }\n\n                .esriCTReportLandscapeMapImg {\n                    max-width: 80%;\n                }\n\n                .esriCTReportMapFail {\n                    height: 50px;\n                }\n\n                .esriCTPrintPage {\n                    padding: 30px 0;\n                    margin: 20px auto;\n                    font-family: arial, sans-serif;\n                    font-size: 13px;\n                }\n\n                .jimu-rtl {\n                    padding: 30px 0;\n                    margin: 20px auto;\n                    font-family: arial, sans-serif;\n                    font-size: 13px;\n                }\n\n                .esriCTReportBar {\n                    width: 100%;\n                    position: fixed;\n                    left: 0;\n                    top: 0;\n                    z-index: 6;\n                    height: 50px;\n                    background: #e2f1fc;\n                    border-bottom: 1px solid #000;\n                }\n\n                .jimu-rtl .esriCTReportBar {\n                    left: inherit;\n                    right: 0;\n                }\n\n                .esriCTPrintButton,\n                .esriCTCloseButton {\n                    color: #444;\n                    font-family: Verdana, Helvetica, sans-serif;\n                    font-size: 12px;\n                    -moz-border-radius: 3px;\n                    -webkit-border-radius: 3px;\n                    border-radius: 3px;\n                    border: 1px solid #8b8b8b;\n                    box-shadow: none;\n                    -webkit-box-shadow: none;\n                    background: #F2F2F2;\n                    background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\n                    background: -moz-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\n                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #F2F2F2), color-stop(100%, #D1D1D1));\n                    background: -webkit-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\n                    background: -o-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\n                    background: -ms-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\n                    background: linear-gradient(to bottom, #F2F2F2 0%, #D1D1D1 100%);\n                    filter: progid: DXImageTransform.Microsoft.gradient(startColorstr='#F2F2F2', endColorstr='#D1D1D1', GradientType=0);\n                    margin: 10px 20px;\n                    line-height: 16px;\n                    display: block;\n                    padding: 5px 10px;\n                    outline: 0;\n                    text-decoration: none;\n                    cursor: pointer;\n                    font-weight: 400;\n                    white-space: nowrap;\n                    float: right;\n                }\n\n                .jimu-rtl .esriCTPrintButton,\n                .jimu-rtl .esriCTCloseButton {\n                    float: left;\n                }\n\n                .esriCTPrintButton:hover,\n                .esriCTPrintButton:focus,\n                .esriCTCloseButton:hover,\n                .esriCTCloseButton:focus {\n                    background: #E5E6E6;\n                    background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\n                    background: -moz-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\n                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #E5E6E6), color-stop(100%, #A0A1A1));\n                    background: -webkit-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\n                    background: -o-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\n                    background: -ms-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\n                    background: linear-gradient(to bottom, #E5E6E6 0%, #A0A1A1 100%);\n                    filter: progid: DXImageTransform.Microsoft.gradient(startColorstr='#E5E6E6', endColorstr='#A0A1A1', GradientType=0);\n                }\n\n                .esriCTReportHeader {\n                    display: block;\n                    width: 100%;\n                    height: 60px;\n                    border-bottom: 1px solid #000;\n                    margin-bottom: 5px;\n                    position: relative;\n                }\n\n                .esriCTReportBarMsg {\n                    text-align: center;\n                    margin-top: 16px;\n                }\n\n                .jimu-rtl .esriCTReportBarMsg {\n                    direction: rtl;\n                }\n\n                .esriCTHidden {\n                    display: none;\n                }\n            </style>\n            \x3c!-- Media print css --\x3e\n            <style type="text/css" media="print">\n                .esriCTPrintPage {\n                    padding: 0;\n                    color: #000;\n                    margin: 0;\n                    float: none;\n                    background: #fff url(none);\n                }\n\n                .esriCTTable {\n                    border-spacing: 0;\n                    margin-top: 10px;\n                    padding: 0;\n                    width: 100%;\n                    page-break-inside: avoid;\n                    table-layout: fixed;\n                }\n\n                .printLegendContainer {\n                  page-break-after: always;\n                }\n\n                .esriCTPageBreak {\n                    page-break-after: always;\n                }\n\n                .esriCTReportBar {\n                    display: none;\n                }\n\n                .esriCTReportMain {\n                    border: none;\n                }\n\n                .esriCTTable th {\n                    border: 1px solid gray;\n                    background-color: ${this.props.theme.ref.palette.primary[100]};\n                    -webkit-print-color-adjust: exact;\n                    color-adjust: exact;\n                    word-wrap: break-word;\n                }\n\n                .esriCTTable td {\n                    border: 1px solid gray;\n                }\n\n                .esriCTTable tr {\n                    page-break-inside: avoid;\n                    page-break-after: auto;\n                }\n            </style>\n        </head>\n\n        <body id="reportBody" class=${this.props.isRTL?"jimu-rtl":"esriCTPrintPage"}>\n          <div class="esriCTReportBar">\n            <div id="closeButton" class="esriCTCloseButton" title="Close">${this.nls("close")}</div>\n            <div id="printButton" class="esriCTPrintButton" title="Print">${this.nls("print")}</div>\n            <div id="reportBarMsg" class="esriCTReportBarMsg">${p}</div>\n          </div>\n          <div id="reportMain" style="width: ${d}px" class="esriCTReportMain">\n            <div id="reportHeader" class="esriCTReportHeader">\n              <img id="reportLogo" class="esriCTReportLogo esriCTHidden" src="">\n              <div id="printTitleDiv" class="esriCTPrintTitleDiv">\n                <div class="esriCTInputTitle">${l}</div>\n              </div>\n            </div>\n            <div class='esrCTAOIInfoDiv'>\n              <div class='esriAOITitle'>\n               <input class='esriCTAOITitleInput' tabindex='0' type='text' value='${this.nls("areaOfInterestLabel")}' role='textbox' aria-label=${this.nls("areaOfInterestLabel")}>\n              </div>\n              <div class='esriCTAOIArea'>\n                <input class='esriCTAOIInputArea' tabindex='0' type='text' value='${this.aoiValueLabel()}' role='textbox' aria-label='${this.aoiValueLabel()}'>\n              </div>\n              <div class='esriCTPrintLocaleDateDiv'>\n                <input type='text' tabindex='0' class='esriCTLocaleDateInputTitle' value='${this.dateValueLabel()}' role='textbox' aria-label='${this.dateValueLabel()}'>\n              </div>\n            </div>\n            <div style="text-align: center;position: relative;">\n              <img class='esriCTReportMapImg' src=${y}></img>\n              <div class="compassContainer">${null===(i=this.compass)||void 0===i?void 0:i.innerHTML}</div>\n              <div class="scaleBarContainer">${null===(a=this.scaleBar)||void 0===a?void 0:a.innerHTML}</div>\n              <div class="scale-attribution">\n                <div class="attribution-group">\n                  <div class="shell-attribution">\n                    <div class="attribution-ui">\n                      <div class="attributionContainer">${null===(o=this.attribution)||void 0===o?void 0:o.innerHTML}</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div id="legendDiv" class=${this.state.legendEnabled?"printLegendContainer":"display-none"}>\n              ${null===(r=null===(n=this.legend)||void 0===n?void 0:n.container)||void 0===r?void 0:r.innerHTML}\n            </div>\n            <div id="reportData">${g.innerHTML}</div>\n          </div>\n          <script src='${f}'><\/script>\n        </body>\n      </html>\n    `}),this.aoiValueLabel=()=>{let e="";return e=this.props.intl.formatMessage({id:"aoiValueLabel",defaultMessage:o.aoiValueLabel},{areaValue:this.props.aoiValue}),e},this.dateValueLabel=()=>{let e="";const t=new Date(Date.now());return e=this.props.intl.formatMessage({id:"dateValueLabel",defaultMessage:o.dateValueLabel},{dateValue:null==t?void 0:t.toString()}),e},this.exportOnClick=()=>wt(this,void 0,void 0,function*(){this.props.onReportExported();const e=yield this.getReportTemplate(),t=new Blob([e],{type:"text/html"}),s=URL.createObjectURL(t);window.open(s,"_blank")}),this.handleAttribution=()=>{var e,t,s;if(null!=this.props.mapView.view){const i=this.props.mapView.jimuMapTools.filter(e=>"Attribution"===e.name),a=null===(t=null===(e=null==i?void 0:i[0])||void 0===e?void 0:e.instance)||void 0===t?void 0:t.container;if((null===(s=null==a?void 0:a.className)||void 0===s?void 0:s.includes("esri-attribution"))&&null!=a&&"string"!=typeof a)return a.cloneNode(!0)}},this.handleCompass=()=>{var e,t,s;if(null!=this.props.mapView.view){const i=this.props.mapView.jimuMapTools.filter(e=>"Compass"===e.name),a=null===(s=null===(t=null===(e=null==i?void 0:i[0])||void 0===e?void 0:e.instance)||void 0===t?void 0:t.shadowRoot)||void 0===s?void 0:s.querySelectorAll(".compass");if(null!=a&&"string"!=typeof a&&a.length>0){const e=a[0].cloneNode(!0),t='style="transform: '+e.children[0].children[0].children[0].style.transform+'"';return e.children[0].children[0].children[0].innerHTML="<svg "+t+' aria-hidden="true" fill="currentColor" height="25" width="27" xmlns="http://www.w3.org/2000/svg" class=" svg " viewBox="0 0 24 24"><path d="M12 22.981l4.12-11.49L12 1.149 7.88 11.49zM9.125 12h5.75L12 20.019z"></path></svg>',e}}},this.handleScaleBar=()=>{var e,t,s;if(null!=this.props.mapView.view){const i=this.props.mapView.jimuMapTools.filter(e=>"ScaleBar"===e.name),a=null===(s=null===(t=null===(e=null==i?void 0:i[0])||void 0===e?void 0:e.instance)||void 0===t?void 0:t.shadowRoot)||void 0===s?void 0:s.querySelectorAll(".esri-scale-bar");if(null!=a&&"string"!=typeof a&&a.length>0)return a[0].cloneNode(!0)}},this.viewScreenshot=()=>wt(this,void 0,void 0,function*(){const e=this.getMapSizeInPixels(this.reportArea.layout,this.reportArea.dpi),t=this.getLegendSizeInPixels(this.reportArea.layout,this.reportArea.dpi),s=e.Width,i=this.state.legendEnabled?e.Height:e.Height+t.Height+30;return this.screenshot=yield this.props.mapView.view.takeScreenshot({width:s/100*95,height:i/100*95}),this.handleScaleBarSize(),this.screenshot.dataUrl}),this.handleScaleBarSize=()=>{if(this.scaleBar){const e=this.scaleBar.querySelector(".esri-scale-bar__line--bottom");this.scaleWidth=this.getScaleBarWidth(e)}},this.getScaleBarWidth=e=>{if(null!=e&&null!=this.screenshot){const t=this.screenshot.data.width/2;return Number(e.style.width.replace("px",""))/t*100}return null},this.onLegendOptionChange=e=>{this.setState({legendEnabled:e.target.checked})},this.onMergeRowsOptionChange=e=>{this.setState({mergeRowsEnabled:e.target.checked})},this.reportArea={layout:"a4Portrait",orientation:Se.Portrait,dpi:96},this.legend=null,this.scaleBar=null,this.screenshot=null,this.scaleWidth=null,this.compass=null,this.attribution=null,this.state={enableExportButton:!1,template:"a4Portrait",templateTitle:this.nls("defaultReportTitle"),legendEnabled:!0,mergeRowsEnabled:!1,limitLegend:!0}}addRowSpans(e,t){if(!e)return;const s=e.rows;t.forEach((e,i)=>{var a,o,n;const r=0===i;if(null==e)return;let l=null,d=null,c=0;for(let i=0;i<s.length;i++){const u=s[i].cells[e];let h=null;if(!u)continue;r&&(h=s[i].cells[t[1]].textContent);const p=u.textContent;p!==l||r&&h!==d?(i>c&&(null===(a=s[c])||void 0===a?void 0:a.cells[e])&&(s[c].cells[e].rowSpan=i-c),l=p,d=h,c=i,s.length>c&&c>=0&&e>=0&&(null===(n=null===(o=s[c])||void 0===o?void 0:o.cells)||void 0===n?void 0:n[e])&&(s[c].cells[e].rowSpan=s.length-c)):u&&u.remove&&u.remove()}})}render(){return(0,t.jsxs)("div",{style:{width:200},children:[(0,t.jsx)("div",{children:(0,t.jsx)(a.Label,{"aria-label":this.nls("template"),className:"text-break",children:this.nls("template")})}),(0,t.jsx)("div",{children:(0,t.jsx)(a.Select,{"aria-label":this.nls("template"),className:"pt-1",name:"template",size:"sm",value:this.state.template,onChange:this.onTemplateChange,children:xt.map(e=>(0,t.jsx)(a.Option,{role:"option","aria-label":this.nls(e),value:e,children:this.nls(e)},e))})}),(0,t.jsx)("div",{className:"pt-3",children:(0,t.jsx)(a.Label,{"aria-label":this.nls("title"),className:"text-break",children:this.nls("title")})}),(0,t.jsx)("div",{children:(0,t.jsx)(a.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("title"),title:this.state.templateTitle,size:"sm",value:this.state.templateTitle,onChange:this.titleLabelChange})}),(0,t.jsxs)("div",{className:"pt-3 d-flex",children:[(0,t.jsx)(a.Label,{className:"w-100 pr-2",children:this.nls("LegendLabel")}),(0,t.jsx)(a.Switch,{role:"switch","aria-label":this.nls("LegendLabel"),title:this.nls("LegendLabel"),checked:this.state.legendEnabled,onChange:this.onLegendOptionChange})]}),this.props.isGroupingEnabled&&(0,t.jsxs)("div",{className:"pt-3 d-flex",children:[(0,t.jsx)(a.Label,{"aria-label":this.nls("mergeRowsLabel"),className:"w-100 d-flex",children:(0,t.jsx)("div",{className:"flex-grow-1 text-break",children:this.nls("mergeRowsLabel")})}),(0,t.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("mergeRowsTooltip"),title:this.nls("mergeRowsTooltip"),showArrow:!0,placement:"top",children:(0,t.jsx)("div",{className:"title3 text-default mr-4 d-inline",children:(0,t.jsx)(Be,{})})}),(0,t.jsx)(a.Switch,{role:"switch",className:"mt-1","aria-label":this.nls("mergeRowsLabel"),title:this.nls("mergeRowsLabel"),checked:this.state.mergeRowsEnabled,onChange:this.onMergeRowsOptionChange})]}),(0,t.jsx)("div",{className:"pt-3",children:(0,t.jsx)(a.Button,{role:"button",disabled:!this.state.enableExportButton,className:"text-break w-100",size:"default",type:"primary",onClick:this.exportOnClick,children:this.nls("exportBtnTitle")})})]})}}var Ft=L(37568),At=L.n(Ft),Dt=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Ct=e=>{const s=window.SVG,{className:a}=e,o=Dt(e,["className"]),n=(0,i.classNames)("jimu-icon jimu-icon-component",a);return s?(0,t.jsx)(s,Object.assign({className:n,src:At()},o)):(0,t.jsx)("svg",Object.assign({className:n},o))};var Lt=L(11092),Mt=function(e,t,s,i){return new(s||(s=Promise))(function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,r)}l((i=i.apply(e,t||[])).next())})};const Tt=L(52349),jt=L(96807),Ot=L(57687),Rt=L(68269);class Pt extends i.BaseWidget{constructor(n){super(n),this.aoiToolRef=i.React.createRef(),this.dropdownRef=i.React.createRef(),this.widgetConRef=i.React.createRef(),this.abortControllerRef=[],this.nls=e=>{var t;const s=Object.assign({},o,a.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>Mt(this,void 0,void 0,function*(){var e,t,s,i,a;Xe.isLoaded()||(yield Xe.load()),Qe.isLoaded()||(yield Qe.load()),Ye.isLoaded()||(yield Ye.load()),(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedDataSource)&&this.props.selectedDataSource?this.setState({promptForDataAction:!0}):(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.selectedIncidentLocation)?this.geometriesByDsIdFromAction(null===(s=this.props)||void 0===s?void 0:s.selectedIncidentLocation):(null===(i=this.props.mutableStatePropsVersion)||void 0===i?void 0:i.currentLocation)&&this.recordSelectedFromAction(null===(a=this.props)||void 0===a?void 0:a.currentLocation)}),this.componentDidUpdate=(e,t)=>{var a,o,n,r,l,d,c,u,h,p,g,y,f,m,v,b,S,w,x,I,A,D,L,M,T,j,O,R,P,B,E,k,G,V,N,U,z,_,W,H,$,J;const q=null===(n=null===(o=null===(a=(0,i.getAppStore)())||void 0===a?void 0:a.getState())||void 0===o?void 0:o.widgetsRuntimeInfo[this.props.id])||void 0===n?void 0:n.state;if(q===i.WidgetState.Opened||!q||q===i.WidgetState.Hidden){if(null===(r=this.props)||void 0===r?void 0:r.selectedIncidentLocation){const t=null===(l=this.props)||void 0===l?void 0:l.selectedIncidentLocation;!t||e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedIncidentLocation&&(null===(d=null==e?void 0:e.mutableStatePropsVersion)||void 0===d?void 0:d.selectedIncidentLocation)===(null===(c=this.props.mutableStatePropsVersion)||void 0===c?void 0:c.selectedIncidentLocation)||this.geometriesByDsIdFromAction(t)}(null===(u=this.props)||void 0===u?void 0:u.selectedDataSource)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedDataSource&&(null===(h=null==e?void 0:e.mutableStatePropsVersion)||void 0===h?void 0:h.selectedDataSource)===(null===(p=this.props.mutableStatePropsVersion)||void 0===p?void 0:p.selectedDataSource)||this.setState({promptForDataAction:!0})),(null===(g=this.props)||void 0===g?void 0:g.currentLocation)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.currentLocation&&(null===(y=null==e?void 0:e.mutableStatePropsVersion)||void 0===y?void 0:y.currentLocation)===(null===(f=this.props.mutableStatePropsVersion)||void 0===f?void 0:f.currentLocation)||this.recordSelectedFromAction(null===(m=this.props)||void 0===m?void 0:m.currentLocation))}if(this.props.state===e.state||q!==i.WidgetState.Closed&&q!==i.WidgetState.Hidden||(this.setState({widgetClosed:!0}),this.props.config.generalSettings.keepResultsWhenClosed||null===(b=null===(v=this.aoiToolRef)||void 0===v?void 0:v.current)||void 0===b||b.clearAll()),this.props.state!==e.state&&q===i.WidgetState.Opened&&this.setState({widgetClosed:!1}),e.useMapWidgetIds!==this.props.useMapWidgetIds){const e=s.MapViewManager.getInstance().getJimuMapViewById(null===(S=this.state.jimuMapView)||void 0===S?void 0:S.id);e&&this.setState({jimuMapView:e})}if((null===(w=t.state)||void 0===w?void 0:w.activeDataSource)!==this.state.activeDataSource&&this.setState({activeDataSource:this.state.activeDataSource}),this.state.activeDataSource){const s=null===(x=this.props.config.configInfo)||void 0===x?void 0:x[this.state.activeDataSource],a=null===(I=e.config.configInfo)||void 0===I?void 0:I[this.state.activeDataSource];if(i.lodash.isDeepEqual(null==a?void 0:a.searchSettings,null==s?void 0:s.searchSettings)||(this.didSearchSettingsChanged(null==a?void 0:a.searchSettings,null==s?void 0:s.searchSettings)?(this.resetFeatureForm(),this.setState({aoiGeometries:null,searchSettings:null==s?void 0:s.searchSettings,showExportOptions:!1},()=>{this.isValidLayerConfigured();const{searchCurrentExtent:e,showAllFeatures:t}=C(this.state.searchSettings);e&&this.checkIfFilterMessageActionBinded(),t&&this.state.jimuMapView?(this.onClear(),this.queryLayers(),this.resizeLayerListHeight()):this.setState({showNoResultsFoundMsg:!1,queryAborted:!1,displayLayerAccordion:[]})})):this.setState({searchSettings:null==s?void 0:s.searchSettings},()=>{this.resizeLayerListHeight();const{searchCurrentExtent:e}=C(this.state.searchSettings);e&&this.checkIfFilterMessageActionBinded()})),this.didAnalysisSettingsChanged(null===(A=null==a?void 0:a.analysisSettings)||void 0===A?void 0:A.layersInfo,null===(D=null==s?void 0:s.analysisSettings)||void 0===D?void 0:D.layersInfo)||(null===(L=null==a?void 0:a.analysisSettings)||void 0===L?void 0:L.displayAnalysisIcon)!==(null===(M=null==s?void 0:s.analysisSettings)||void 0===M?void 0:M.displayAnalysisIcon)||(null===(T=null==a?void 0:a.analysisSettings)||void 0===T?void 0:T.displayMapSymbols)!==(null===(j=null==s?void 0:s.analysisSettings)||void 0===j?void 0:j.displayMapSymbols)||(null===(O=null==a?void 0:a.analysisSettings)||void 0===O?void 0:O.showDistFromInputLocation)!==(null===(R=null==s?void 0:s.analysisSettings)||void 0===R?void 0:R.showDistFromInputLocation)||(null===(P=null==a?void 0:a.analysisSettings)||void 0===P?void 0:P.onlyShowLayersResult)!==(null===(B=null==s?void 0:s.analysisSettings)||void 0===B?void 0:B.onlyShowLayersResult)||(null===(E=null==a?void 0:a.analysisSettings)||void 0===E?void 0:E.displayAllLayersResult)!==(null===(k=null==s?void 0:s.analysisSettings)||void 0===k?void 0:k.displayAllLayersResult)||(null===(G=null==a?void 0:a.analysisSettings)||void 0===G?void 0:G.enableProximitySearch)!==(null===(V=null==s?void 0:s.analysisSettings)||void 0===V?void 0:V.enableProximitySearch)||!i.lodash.isDeepEqual(null===(N=null==a?void 0:a.analysisSettings)||void 0===N?void 0:N.saveFeatures,null===(U=null==s?void 0:s.analysisSettings)||void 0===U?void 0:U.saveFeatures)){let e=this.state.isLayerAvailable;if(!e){this.availableLayersIds=[];const t=F(this.state.jimuMapView.id);t.length>0&&t.forEach(e=>{var t;(null===(t=null==e?void 0:e.layerDefinition)||void 0===t?void 0:t.geometryType)&&this.availableLayersIds.push(e.id)}),e=this.availableLayersIds.length>0}this.setState({analysisSettings:null==s?void 0:s.analysisSettings,isLayerAvailable:e,onWidgetLoadShowLoadingIndicator:!1},()=>{var e,o,n,r,l,d,c,u,h,p,g,y,f;i.lodash.isDeepEqual(null===(e=null==a?void 0:a.analysisSettings)||void 0===e?void 0:e.saveFeatures,null===(o=null==s?void 0:s.analysisSettings)||void 0===o?void 0:o.saveFeatures)||this.resetFeatureForm(),this.state.displayLayerAccordion.length>0&&(null===(n=null==a?void 0:a.analysisSettings)||void 0===n?void 0:n.displayAllLayersResult)!==(null===(r=null==s?void 0:s.analysisSettings)||void 0===r?void 0:r.displayAllLayersResult)?null===(l=null==s?void 0:s.analysisSettings)||void 0===l||l.layersInfo.forEach(e=>{var t;if(this.availableLayersIds.includes(e.useDataSource.dataSourceId)||e.useDataSource.dataViewId&&this.availableLayersIds.includes(e.useDataSource.mainDataSourceId)){const s=null===(t=this.state.jimuMapView.getJimuLayerViewByDataSourceId(e.useDataSource.dataSourceId))||void 0===t?void 0:t.layer;s&&!s.visible&&this.state.analysisSettings.displayAllLayersResult&&(s.visible=!0)}}):(this.isValidLayerConfigured(),(null===(d=this.state.analysisSettings)||void 0===d?void 0:d.onlyShowLayersResult)!==(null===(c=t.analysisSettings)||void 0===c?void 0:c.onlyShowLayersResult)?this.onOnlyShowLayerResultsChanged():this.isLayerQueryNeeded(null===(u=null==a?void 0:a.analysisSettings)||void 0===u?void 0:u.layersInfo,null===(h=null==s?void 0:s.analysisSettings)||void 0===h?void 0:h.layersInfo)?(this.onRefreshResult(),(null===(p=this.state.searchSettings)||void 0===p?void 0:p.searchByActiveMapArea)&&(null===(g=this.aoiToolRef.current)||void 0===g||g.getMapExtentGeometry())):(this.setState({dataSetArray:[]},()=>{this.displayAnalysisLayerInfo()}),(null===(y=this.state.searchSettings)||void 0===y?void 0:y.searchByActiveMapArea)&&(null===(f=this.aoiToolRef.current)||void 0===f||f.getMapExtentGeometry())))})}}if(i.lodash.isDeepEqual(e.config.generalSettings,this.props.config.generalSettings)||this.setState({generalSettings:this.props.config.generalSettings}),e.enableDataAction===this.props.enableDataAction&&i.lodash.isDeepEqual(this.props.dataActions,e.dataActions)||this.setState({showExportButton:void 0===this.props.enableDataAction||this.props.enableDataAction},()=>{this.setState({dataSetArray:[]}),this.displayAnalysisLayerInfo()}),this.selectedPopupContainer&&(null===(_=null===(z=e.theme)||void 0===z?void 0:z.sys.color)||void 0===_?void 0:_.primary.main)!==(null===(H=null===(W=this.props.theme)||void 0===W?void 0:W.sys.color)||void 0===H?void 0:H.primary.main)&&(this.selectedPopupContainer.style.borderColor=null===(J=null===($=this.props.theme)||void 0===$?void 0:$.sys.color)||void 0===J?void 0:J.primary.main),e.theme.ref.typeface.htmlFontSize!==this.props.theme.ref.typeface.htmlFontSize&&this.resizeLayerListHeight(),!i.lodash.isDeepEqual(e.messageConfigs,this.props.messageConfigs)||!i.lodash.isDeepEqual(e.useDataSources,this.props.useDataSources)){const{searchCurrentExtent:e}=C(this.state.searchSettings);e&&this.checkIfFilterMessageActionBinded()}},this.checkIfFilterMessageActionBinded=()=>{var e;let t=!1;for(const s in this.props.messageConfigs){const a=this.props.messageConfigs[s];if(this.props.useMapWidgetIds.includes(null==a?void 0:a.widgetId)&&(null==a?void 0:a.messageType)===i.MessageType.ExtentChange){const s=this.props.useDataSources.map(e=>e.dataSourceId);null===(e=a.actions)||void 0===e||e.some(e=>{var i;if("filter data record action"===e.actionName&&(null===(i=e.useDataSources)||void 0===i?void 0:i.length)){if(e.useDataSources.filter(e=>s.includes(e.dataSourceId)).length)return t=!0,!0}return!1})}}this.setState({isFilterActionBinded:t})},this.componentWillUnmount=()=>{this.onClear()},this.getSelectedFeatureRecordsOnLoad=()=>Mt(this,void 0,void 0,function*(){var e,t,s,a,o;const n=i.UrlManager.getInstance(),r=i.urlUtils.getDataSourceInfosFromUrlParams(n.getQueryObject(),n.getHashObject()),l=[];for(const n in r){let d=n;const c=i.DataSourceManager.getInstance().getDataSource(n);if((null==c?void 0:c.type)===i.DataSourceTypes.SubtypeGroupLayer){d=(yield c.getSublayerDataSourceByRecordId((null===(e=r[n])||void 0===e?void 0:e.selection).ids[0])).id}const u=null===(t=r[n])||void 0===t?void 0:t.selection;((null===(s=null==u?void 0:u.ids)||void 0===s?void 0:s.length)||(null===(a=null==u?void 0:u.queryParams)||void 0===a?void 0:a.geometry)||(null===(o=null==u?void 0:u.queryParams)||void 0===o?void 0:o.where))&&l.push(d)}l.length>0&&this.setState({dsToGetSelectedOnLoad:l})}),this.onDataSourceInfoChange=e=>{if(!e||Object.values(e).some(e=>!("selectedIds"in e)))return;const t={};Object.keys(e).forEach(e=>{var s;const a=i.DataSourceManager.getInstance().getDataSource(e);if(!a)return;const o=a.getSelectedRecords();for(const i of o){const a=null===(s=i.getFeature())||void 0===s?void 0:s.geometry;a&&(t[e]||(t[e]=[]),t[e].push(a))}}),Object.keys(t).length>0&&(this.skipHighlightRecordsOnMap=!0,this.geometriesByDsIdFromAction(t)),this.setState({dsToGetSelectedOnLoad:[]})},this.getAllFeaturesFromSelectedDs=()=>{var e;const t=new AbortController;this.abortControllerRef.push(t);const s={};let i="";i=null===(e=this.props.selectedDataSource)||void 0===e?void 0:e.id,s[i]||(s[i]=[]),this.setState({loadingAllFeaturesFromDs:!0,analysisTakingLongerTime:!1},()=>{let e,a=setTimeout(()=>{a&&(clearTimeout(a),a=null),this.setState({analysisTakingLongerTime:!0})},1e4);this.props.useDataSources.forEach(t=>{var s;t.dataSourceId===this.props.selectedDataSource.id&&(e=null!==(s=t.fields)&&void 0!==s?s:[])}),Ve(this.props.selectedDataSource,null,!0,this.state.jimuMapView.view.spatialReference,e,t.signal).then(e=>{a&&(clearTimeout(a),a=null),(null==e?void 0:e.length)>0?(e.forEach(e=>{s[i].push(e.feature.geometry)}),this.geometriesByDsIdFromAction(s)):this.setState({loadingAllFeaturesFromDs:!1,analysisTakingLongerTime:!1})},()=>{a&&(clearTimeout(a),a=null),this.setState({loadingAllFeaturesFromDs:!1,analysisTakingLongerTime:!1})})})},this.analyzeAllFeatures=()=>{this.setState({promptForDataAction:!1}),this.getAllFeaturesFromSelectedDs()},this.onCancelButtonClicked=()=>{this.setState({promptForDataAction:!1,loadingAllFeaturesFromDs:!1})},this.geometriesByDsIdFromAction=e=>{Object.keys(e).forEach(t=>{this.geometriesFromAction[t]=e[t]}),this.actionTimeout&&clearTimeout(this.actionTimeout),this.actionTimeout=setTimeout(()=>Mt(this,void 0,void 0,function*(){const e={point:[],polyline:[],polygon:[],multipoint:[]},t=[],a=Object.keys(this.geometriesFromAction),o=i.DataSourceManager.getInstance();a.forEach(s=>{const a=null==o?void 0:o.getDataSource(s);if(null==a?void 0:a.getGeometryType()){const o=i.dataSourceUtils.changeRestAPIGeometryTypeToJSAPIGeometryType(a.getGeometryType());t.includes(o)||t.push(o),e[o]=e[o].concat(this.geometriesFromAction[s])}});let n=null;if(1===t.length)n=e[t[0]].length>1?Je.executeMany(e[t[0]]):e[t[0]][0];else if(t.length>1){let t=e.point.concat(e.polyline);t=t.concat(e.multipoint);const i=(yield s.geometryUtils.createBuffer(t,[.1],"meters")).concat(e.polygon);n=Je.executeMany(i)}this.recordSelectedFromAction(n),this.geometriesFromAction={}}),1e3)},this.recordSelectedFromAction=e=>Mt(this,void 0,void 0,function*(){var t,i;const{searchByLocation:a}=C(this.state.searchSettings);if(a){const a=null===(i=null===(t=this.state.jimuMapView)||void 0===t?void 0:t.view)||void 0===i?void 0:i.spatialReference;if(a){const t=yield s.geometryUtils.projectToSpatialReference([e],a);(null==t?void 0:t.length)>0&&t[0]&&this.setState({msgActionGeometry:t[0]})}}}),this.isValidLayerConfigured=()=>{var t,s,i,a,o;let n;const{showAllFeatures:r,searchCurrentExtent:l}=C(this.state.searchSettings);(r||l)&&(null===(s=null===(t=this.state.analysisSettings)||void 0===t?void 0:t.layersInfo)||void 0===s?void 0:s.length)>0&&(n=null===(i=this.state.analysisSettings)||void 0===i?void 0:i.layersInfo.filter(t=>{const s=t.analysisInfo.analysisType;return s===e.Proximity||s===e.Summary})),n&&this.hasValidDsIds()?this.setState({isAnalysisLayerConfigured:(null==n?void 0:n.length)>0}):this.setState({isAnalysisLayerConfigured:this.hasValidDsIds()&&(null===(o=null===(a=this.state.analysisSettings)||void 0===a?void 0:a.layersInfo)||void 0===o?void 0:o.length)>0},()=>{this.state.isAnalysisLayerConfigured||this.onClear()})},this.hasValidDsIds=()=>{var e,t;let s=!1;return null===(t=null===(e=this.state.analysisSettings)||void 0===e?void 0:e.layersInfo)||void 0===t||t.some((e,t)=>!!(this.availableLayersIds.includes(e.useDataSource.dataSourceId)||e.useDataSource.dataViewId&&this.availableLayersIds.includes(e.useDataSource.mainDataSourceId))&&(s=!0,s)),s},this.didAnalysisSettingsChanged=(e,t)=>{let s=!1;return null==t||t.some((t,a)=>{var o,n,r;return(!e||t.useDataSource.dataSourceId!==(null===(o=e[a])||void 0===o?void 0:o.useDataSource.dataSourceId)||t.label!==(null===(n=e[a])||void 0===n?void 0:n.label)||!i.lodash.isDeepEqual(t.analysisInfo,null===(r=e[a])||void 0===r?void 0:r.analysisInfo))&&(s=!0,!0)}),(null==t?void 0:t.length)!==(null==e?void 0:e.length)||s},this.didSearchSettingsChanged=(e,t)=>{let s=!1;return e&&t&&t.includeFeaturesOutsideMapArea===e.includeFeaturesOutsideMapArea&&t.bufferDistance===e.bufferDistance&&t.distanceUnits===e.distanceUnits&&t.searchByActiveMapArea===e.searchByActiveMapArea?s:(s=!0,!0)},this.isLayerQueryNeeded=(t,s)=>{let a=!1;return null==s||s.some((s,o)=>{var n,r,l,d;return(!t||s.useDataSource.dataSourceId!==(null===(n=t[o])||void 0===n?void 0:n.useDataSource.dataSourceId)||(s.analysisInfo.analysisType===e.Closest||s.analysisInfo.analysisType===e.Proximity)&&s.analysisInfo.returnIntersectedPolygons!==(null===(r=t[o])||void 0===r?void 0:r.analysisInfo.returnIntersectedPolygons)||!i.lodash.isDeepEqual(s.analysisInfo.fieldsToExport,null===(l=t[o])||void 0===l?void 0:l.analysisInfo.fieldsToExport)||s.analysisInfo.includeApproxDistance!==(null===(d=t[o])||void 0===d?void 0:d.analysisInfo.includeApproxDistance))&&(a=!0,!0)}),(null==s?void 0:s.length)!==(null==t?void 0:t.length)||a},this.loadConfiguredDataSources=e=>{var t,s,a,o,n;const r=i.DataSourceManager.getInstance().getDataSource(e),l=[],d=[];return null===(n=null===(o=null===(a=null===(s=null===(t=this.props.config)||void 0===t?void 0:t.configInfo)||void 0===s?void 0:s[e])||void 0===a?void 0:a.analysisSettings)||void 0===o?void 0:o.layersInfo)||void 0===n||n.forEach(e=>{!d.includes(e.useDataSource.dataSourceId)&&d.push(e.useDataSource.dataSourceId)}),d.forEach(e=>{l.push(new Promise((t,s)=>{try{(null==r?void 0:r.isDataSourceSet())&&(null==r||r.createDataSourceById(e).then(e=>{t(e)},()=>{t(null)}))}catch(e){t(null)}}))}),l},this.onActiveViewChange=e=>Mt(this,void 0,void 0,function*(){var t;if(this.availableLayersIds=[],!e||!e.view)return void this.setState({isLayerAvailable:!1,loadingAllFeaturesFromDs:!1});this.setState({onWidgetLoadShowLoadingIndicator:!0}),yield Promise.all(this.loadConfiguredDataSources(e.dataSourceId));const s=F(e.id);s.length>0?(s.forEach(e=>{var t;(null===(t=null==e?void 0:e.layerDefinition)||void 0===t?void 0:t.geometryType)&&this.availableLayersIds.push(e.id)}),this.availableLayersIds.length?this.setState({isLayerAvailable:!0,onWidgetLoadShowLoadingIndicator:!1}):this.setState({isLayerAvailable:!1})):this.setState({isLayerAvailable:!1}),this.mapView=e.view,this.state.jimuMapView&&(this.onClear(),this.setState({analysisSettings:null})),e&&(null===(t=e.jimuMapTools)||void 0===t||t.forEach(e=>{var t;(null==e?void 0:e.instance)&&"Search"===e.name&&(null===(t=e.instance)||void 0===t||t.addEventListener("arcgisSelectResult",e=>{var t,s,i;(null===(i=null===(s=null===(t=null==e?void 0:e.detail)||void 0===t?void 0:t.result)||void 0===s?void 0:s.feature)||void 0===i?void 0:i.geometry)&&this.recordSelectedFromAction(e.detail.result.feature.geometry)}))}),this.setState({jimuMapView:e},()=>{this.createGraphicsLayers(),null===e.dataSourceId?this.setState({activeDataSource:null}):(this.state.jimuMapView.dataSourceId||this.props.config.configInfo[this.state.jimuMapView.dataSourceId])&&this.setState({activeDataSource:this.state.jimuMapView.dataSourceId},()=>{this.setConfigForDataSources()})}))}),this.setConfigForDataSources=()=>{if(""!==this.state.jimuMapView.dataSourceId){const e=this.props.config.configInfo[this.state.jimuMapView.dataSourceId];this.setState({searchSettings:null==e?void 0:e.searchSettings,analysisSettings:null==e?void 0:e.analysisSettings},()=>{this.isValidLayerConfigured();const{showAllFeatures:e,searchByLocation:t,searchCurrentExtent:s}=C(this.state.searchSettings);s&&this.checkIfFilterMessageActionBinded(),t&&this.getSelectedFeatureRecordsOnLoad(),e&&this.state.jimuMapView&&this.state.analysisSettings&&(this.queryLayers(),this.resizeLayerListHeight())})}},this.onAoiComplete=e=>{this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={},this.setState({aoiGeometries:e},()=>{this.calculateAoiForPrint(e),this.queryLayers()})},this.calculateAoiForPrint=e=>{this.aoiValue="";const{searchByLocation:t}=C(this.state.searchSettings);if(t&&null!==e.bufferGeometry&&"polygon"===e.bufferGeometry.type){const t=e.bufferGeometry.spatialReference;let s;s=4326===t.wkid||t.isWebMercator||t.isGeographic?Qe.execute(e.bufferGeometry,{unit:"square-"+e.distanceUnit}):Ke.execute(e.bufferGeometry,{unit:"square-"+e.distanceUnit}),this.aoiValue=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.getSelectedUnitsAbbr(e.distanceUnit)+"&sup2"}},this.onClear=()=>{var e,t,s;this.destroyHighlightGraphicsLayer(),null===(e=this.flashLayer)||void 0===e||e.removeAll(),this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={},this.resetFeatureForm(),this.resetFilters(),this.clearMessageAction(),null===(s=null===(t=this.props)||void 0===t?void 0:t.outputDataSources)||void 0===s||s.forEach(e=>{var t;null===(t=this.getOutputDataSource(e))||void 0===t||t.setStatus(i.DataSourceStatus.NotReady)}),this.setState({aoiGeometries:null,displayLayerAccordion:[],isClosestAddressShowing:!1,msgActionGeometry:null,showNoResultsFoundMsg:!1,queryAborted:!1})},this.onRefreshResult=e=>{var t,s,a,o;this.destroyHighlightGraphicsLayer(),null===(t=this.flashLayer)||void 0===t||t.removeAll(),this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={};const{searchByLocation:n}=C(this.state.searchSettings);!e&&n&&(null===(s=this.state.analysisSettings)||void 0===s?void 0:s.onlyShowLayersResult)&&this.resetFilters(),this.clearMessageAction(),null===(o=null===(a=this.props)||void 0===a?void 0:a.outputDataSources)||void 0===o||o.forEach(e=>{var t;null===(t=this.getOutputDataSource(e))||void 0===t||t.setStatus(i.DataSourceStatus.NotReady)}),this.setState({dataSetArray:[],showExportOptions:!1,showFeatureForm:!1,currentPage:1},()=>{this.queryLayers(e)})},this.getAnalysisTypeIcon=t=>{let s;return t===e.Closest&&(s=jt),t===e.Proximity&&(s=Ot),t===e.Summary&&(s=Rt),s},this.getFieldObj=e=>({name:e.name.replace(/\./g,"_").replace(/\(/g,"_").replace(/\)/g,"_"),alias:e.alias,type:e.type}),this.getAllFeaturesDistance=(e,t,s)=>Mt(this,void 0,void 0,function*(){return new Promise((i,a)=>{if(e){const o=[];for(let e=0;e<t.length;e++)t[e].feature.geometry&&o.push(t[e].feature.geometry.toJSON());if(o.length>0){let t;const n=`${this.props.context.folderUrl}dist/runtime/assets/workers/worker-distance-utils.js`;Lt.default.open(n).then(i=>{t=i;const a=new AbortController;this.abortControllerRef.push(a);const n=e.toJSON();return i.invoke("getDistance",{selectedGeometryJson:n,intersectedGeometryJsonArray:o,distanceUnit:s},{signal:a.signal})}).then(e=>{null==t||t.close(),t=null,i(e)},e=>{null==t||t.close(),t=null,a(e)})}}else i([])})}),this.getFeaturesDistance=e=>Mt(this,void 0,void 0,function*(){return new Promise(t=>{var s;const{showAllFeatures:i,searchCurrentExtent:a}=C(this.state.searchSettings),o=D(),n=i||a?o:(null===(s=this.state.aoiGeometries)||void 0===s?void 0:s.distanceUnit)||this.state.searchSettings.distanceUnits||o,r=this.state.aoiGeometries.incidentGeometry4326||this.state.aoiGeometries.incidentGeometry;let l;this.getAllFeaturesDistance(r,e,n).then(s=>{if(l=s,!l)return void t(null);const i=this.getSelectedUnitsAbbr(n);for(let t=0;t<e.length;t++){const s=e[t].feature;if(r&&s.geometry){s.distance=l[t];const e=this.props.intl.formatNumber(s.distance,{maximumFractionDigits:2})+" "+i;s.attributes?s.attributes.esriCTApproxDistance=e:s.attributes={esriCTApproxDistance:e}}else s.distance=0}t(e)},()=>{t(null)})})}),this.getSortedSubGroupFeatures=(t,s,a,o)=>{var n,r;let l="distance",d=!1,c=!1,u="",h=[];const p=s.analysisInfo;if(p.analysisType===e.Proximity&&(!p.sortFeaturesByDistance&&(null===(n=p.sortFeatures)||void 0===n?void 0:n.sortFeaturesByField)&&(l=p.sortFeatures.sortFeaturesByField,c=!0),p.groupFeaturesEnabled&&""!==p.groupFeatures.groupFeaturesByField&&""!==p.subGroupFeatures.subGroupFeaturesByField&&(d=!0,u=p.subGroupFeatures.subGroupFeaturesByField)),p.analysisType===e.Proximity&&a&&!c&&(l=o),d)for(let e=0;e<t.length;e++){const i=t[e],a=i.feature.attributes[u],o=i.getFormattedFieldValue(u,this.props.intl),n="subGroup_"+s.useDataSource.dataSourceId+"_"+u+"_"+a;let r,l=!0;if(h.length>0)for(let e=0;e<h.length;e++){const t=h[e];if(n===t.id&&a===t.value){l=!1,r=t;break}}l?h.push({id:n,value:a,count:1,label:o}):(h.forEach(e=>{e.id===n&&(r=e)}),r.count+=1)}if(d&&h.length>0){let e="";e=p.subGroupFeatures.sortSubGroupsByCount?"count":"value";const t=this.divideGroupsByEmptyValue(h,e);h=t.groupsWithNonEmptyValue.sort(this.sortGroups(e,p.subGroupFeatures.subGroupFeaturesOrder));const s=t.groupsWithEmptyValue.sort(this.sortGroups(e,p.subGroupFeatures.subGroupFeaturesOrder));h=e&&p.subGroupFeatures.subGroupFeaturesOrder===i.OrderRule.Desc?s.concat(h):h.concat(s)}if(p.analysisType===e.Proximity){const e=this.sortRecords(t,l);t=e.notEmptyRecordsArr.sort(this.sortFeatureList(l,p.analysisType,o));const s=e.emptyRecordArr.sort(this.sortFeatureList(l,p.analysisType,o));t=c&&(null===(r=null==p?void 0:p.sortFeatures)||void 0===r?void 0:r.sortFeaturesOrder)===i.OrderRule.Desc?s.concat(t):t.concat(s)}else t=t.sort(this.sortFeatureList(l,p.analysisType));return d&&h.length>0&&h.forEach(e=>{t.forEach(t=>{const s=t;e.value===s.feature.attributes[u]&&(e.features||(e.features=[]),e.features.push(t))})}),{features:t,featuresSubGroup:h}},this.getSortedFeatures=(t,s,a,o)=>{var n,r;let l="distance",d=!1,c=!1,u="",h=[];const p=s.analysisInfo;if(p.analysisType===e.Proximity&&(!p.sortFeaturesByDistance&&(null===(n=p.sortFeatures)||void 0===n?void 0:n.sortFeaturesByField)&&(l=p.sortFeatures.sortFeaturesByField,c=!0),p.groupFeaturesEnabled&&""!==p.groupFeatures.groupFeaturesByField&&(d=!0,u=p.groupFeatures.groupFeaturesByField)),p.analysisType===e.Proximity&&a&&!c&&(l=o),d)for(let e=0;e<t.length;e++){const i=t[e],a=i.feature.attributes[u],o=i.getFormattedFieldValue(u,this.props.intl),n="group_"+s.useDataSource.dataSourceId+"_"+u+"_"+a;let r,l=!0;if(h.length>0)for(let e=0;e<h.length;e++){const t=h[e];if(n===t.id&&a===t.value){l=!1,r=t;break}}l?h.push({id:n,value:a,count:1,label:o}):(h.forEach(e=>{e.id===n&&(r=e)}),r.count+=1)}if(d&&h.length>0){let e="";e=p.groupFeatures.sortGroupsByCount?"count":"value";const t=this.divideGroupsByEmptyValue(h,e);h=t.groupsWithNonEmptyValue.sort(this.sortGroups(e,p.groupFeatures.groupFeaturesOrder));const s=t.groupsWithEmptyValue.sort(this.sortGroups(e,p.groupFeatures.groupFeaturesOrder));h=e&&p.groupFeatures.groupFeaturesOrder===i.OrderRule.Desc?s.concat(h):h.concat(s)}if(p.analysisType===e.Proximity){const e=this.sortRecords(t,l);t=e.notEmptyRecordsArr.sort(this.sortFeatureList(l,p.analysisType,o));const s=e.emptyRecordArr.sort(this.sortFeatureList(l,p.analysisType,o));t=c&&(null===(r=null==p?void 0:p.sortFeatures)||void 0===r?void 0:r.sortFeaturesOrder)===i.OrderRule.Desc?s.concat(t):t.concat(s)}else t=t.sort(this.sortFeatureList(l,p.analysisType));return d&&h.length>0&&(h.forEach(e=>{t.forEach(t=>{const s=t;e.value===s.feature.attributes[u]&&(e.features||(e.features=[]),e.features.push(t))})}),""!==p.subGroupFeatures.subGroupFeaturesByField&&p.subGroupFeatures.subGroupFeaturesByField!==u&&h.forEach(e=>{e.subGroupInfo=this.getSortedSubGroupFeatures(e.features,s,!1,o)})),{features:t,featuresGroup:h}},this.sortRecords=(e,t)=>{const s=[],i=[];return e.forEach((e,a)=>{const o=e,n="distance"===t?o.feature[t]:o.feature.attributes[t];null==n||""===n?s.push(e):i.push(e)}),{emptyRecordArr:s,notEmptyRecordsArr:i}},this.divideGroupsByEmptyValue=(e,t)=>{const s=[],i=[];return e.forEach(e=>{const a=e[t];null==a||""===a?s.push(e):i.push(e)}),{groupsWithEmptyValue:s,groupsWithNonEmptyValue:i}},this.sortGroups=(e,t)=>(s,a)=>{if(s[e]===a[e]||null===s[e]&&null===a[e]){if(s.value<a.value)return t===i.OrderRule.Desc?-1:1;if(s.value>a.value)return t===i.OrderRule.Desc?1:-1}return s[e]<a[e]?-1:s[e]>a[e]?1:0},this.sortFeatureList=(t,s,i)=>(a,o)=>{let n=a.feature;let r=o.feature;const l=n,d=r;if("distance"!==t&&(n=n.attributes,r=r.attributes),s===e.Proximity&&(n[t]===r[t]||null===n[t]&&null===r[t]))if("distance"!==t)if(l.distance!==d.distance){if(l.distance<d.distance)return-1;if(l.distance>d.distance)return 1}else{if(n[i]<r[i])return-1;if(n[i]>r[i])return 1}else{if(n.attributes[i]<r.attributes[i])return-1;if(n.attributes[i]>r.attributes[i])return 1}return n[t]<r[t]?-1:n[t]>r[t]?1:void 0},this.getSelectedUnitsAbbr=e=>{const t=fe.find(t=>t.value===e);return this.nls(t.abbreviation)},this.displayApproximateDistanceUI=t=>{let s=!1;const i=t.analysisInfo,a=t.analysisInfo.analysisType,{searchByLocation:o}=C(this.state.searchSettings);return o&&(a===e.Closest||a===e.Proximity&&i.expandOnOpen&&i.expandFeatureDetails)&&(s=!0),s},this.createGraphicsLayers=()=>{var e,t,s;this.bufferLayer&&this.bufferLayer.destroy(),this.drawingLayer&&this.drawingLayer.destroy(),this.flashLayer&&this.flashLayer.destroy(),this.highlightLayer&&this.highlightLayer.destroy(),this.bufferLayer=new X.default({listMode:"hide"}),this.drawingLayer=new X.default({listMode:"hide"}),this.highlightLayer=new X.default({listMode:"hide"}),this.flashLayer=new X.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"}),null===(s=null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)||void 0===s||s.addMany([this.bufferLayer,this.drawingLayer,this.flashLayer,this.highlightLayer])},this.clearMessageAction=()=>{var e,t,s,a,o,n,r,l,d;(null===(e=this.selectedRecord)||void 0===e?void 0:e.dataSource)&&this.selectedRecord.dataSource.dataViewId!==i.CONSTANTS.SELECTION_DATA_VIEW_ID&&i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(this.props.id,[],[null===(s=null===(t=this.selectedRecord)||void 0===t?void 0:t.dataSource)||void 0===s?void 0:s.id])),this.selectedPopupContainer&&(this.selectedPopupContainer.style.borderColor=xe),null===(o=null===(a=this.selectedPopupContainer)||void 0===a?void 0:a.classList)||void 0===o||o.remove("record-selected"),(null===(r=null===(n=this.selectedRecord)||void 0===n?void 0:n.dataSource)||void 0===r?void 0:r.dataViewId)!==i.CONSTANTS.SELECTION_DATA_VIEW_ID&&(null===(d=null===(l=this.selectedRecord)||void 0===l?void 0:l.dataSource)||void 0===d||d.clearSelection()),this.selectedRecord=null,this.selectedPopupContainer=null,this.selectedRecordsKey=""},this.selectMessageAction=e=>{var t,s,a,o,n,r,l;this.selectedPopupContainer&&(this.selectedPopupContainer.style.borderColor=null===(s=null===(t=this.props.theme)||void 0===t?void 0:t.sys.color)||void 0===s?void 0:s.primary.main),null===(o=null===(a=this.selectedPopupContainer)||void 0===a?void 0:a.classList)||void 0===o||o.add("record-selected"),(null===(n=null==e?void 0:e.dataSource)||void 0===n?void 0:n.dataViewId)!==i.CONSTANTS.SELECTION_DATA_VIEW_ID&&(i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(this.props.id,[e],[null===(r=e.dataSource)||void 0===r?void 0:r.id])),this.skipHighlightRecordsOnMap||(this.skipDsInfoChange=!0,null===(l=e.dataSource)||void 0===l||l.selectRecordsByIds([e.getId()],[e]))),this.skipHighlightRecordsOnMap=!1,this.selectedRecord=e},this.highlightFeatureOnMap=(e,t)=>{var s,i,a;if(t){this.highlightLayer.removeAll(),null===(s=this.state.jimuMapView)||void 0===s||s.view.map.reorder(this.highlightLayer,(null===(i=this.state.jimuMapView)||void 0===i?void 0:i.view.map.layers.length)-1);const t=ne(e.getFeature(),"#FFFF00");null===(a=this.highlightLayer)||void 0===a||a.add(t)}else this.highlightLayer.removeAll()},this.executeSelectMessageAction=(e,t,s)=>{this.selectedRecordsKey===e?this.clearMessageAction():this.selectedRecordsKey!==e&&(this.selectedRecordsKey&&this.clearMessageAction(),this.selectedPopupContainer=t,this.selectedRecordsKey=e,this.selectMessageAction(s))},this.executeClearMessageAction=e=>{this.selectedRecordsKey===e&&this.clearMessageAction()},this.createFeatureSet=(s,a,o,n,r,l)=>{var d,c,u,h,p,g,y,f,m;const v=[];let b=[];const S=a.analysisInfo;let x,I="";const F=void 0===this.props.enableDataAction||this.props.enableDataAction;if(S.analysisType===e.Proximity&&""!==S.displayField)I=S.displayField;else{const e=a.useDataSource.dataSourceId,t=w(e);I=(e=>{var t;let s="";const i=null==e?void 0:e.getLayerDefinition(),a=null==e?void 0:e.getIdField();return s=a||((null==i?void 0:i.displayField)?i.displayField:null===(t=null==i?void 0:i.fields)||void 0===t?void 0:t[0].name),s})(t)}const A=a.analysisInfo.analysisType!==e.Proximity||S.expandOnOpen&&S.expandFeatureDetails;b=s;const{searchByLocation:D,searchCurrentExtent:L}=C(this.state.searchSettings);if(D?(x=this.getSortedFeatures(b,a,!1,o),b=x.features):(x=this.getSortedFeatures(b,a,!0,o),b=x.features),S.analysisType===e.Closest&&b.length>1){let e=[];const t=b[0].feature.geometry;(null===(c=null===(d=this.state.aoiGeometries)||void 0===d?void 0:d.incidentGeometry)||void 0===c?void 0:c.type)===t.type&&(e=b.filter(e=>qe.execute(e.feature.geometry,this.state.aoiGeometries.incidentGeometry))),b=e.length>0?e.splice(0,1):b.splice(0,1)}S.analysisType===e.Proximity&&(!S.sortFeaturesByDistance&&(null===(u=S.sortFeatures)||void 0===u?void 0:u.sortFeaturesByField)&&S.sortFeatures.sortFeaturesOrder===i.OrderRule.Desc&&(b=b.reverse()),S.groupFeaturesEnabled&&(S.groupFeatures.groupFeaturesOrder===i.OrderRule.Desc||S.groupFeatures.sortGroupsByCount)&&(x.featuresGroup=x.featuresGroup.reverse()));const M=w(a.useDataSource.dataSourceId);if(S.analysisType===e.Proximity&&(null===(h=null==x?void 0:x.featuresGroup)||void 0===h?void 0:h.length)>0){const s=(null===(p=this.state.analysisSettings)||void 0===p?void 0:p.displayMapSymbols)&&"unique-value"===(null===(y=null===(g=M.layer)||void 0===g?void 0:g.renderer)||void 0===y?void 0:y.type)&&S.groupFeatures.groupFeaturesByField===(null===(m=null===(f=M.layer)||void 0===f?void 0:f.renderer)||void 0===m?void 0:m.field);x.featuresGroup.forEach((o,d)=>{var c,u;!S.sortFeaturesByDistance&&(null===(c=S.sortFeatures)||void 0===c?void 0:c.sortFeaturesByField)&&S.sortFeatures.sortFeaturesOrder===i.OrderRule.Desc&&(o.features=o.features.reverse());const h=[];o.subGroupInfo?((S.subGroupFeatures.subGroupFeaturesOrder===i.OrderRule.Desc||S.subGroupFeatures.sortSubGroupsByCount)&&(o.subGroupInfo.featuresSubGroup=o.subGroupInfo.featuresSubGroup.reverse()),o.subGroupInfo.featuresSubGroup.forEach((o,c)=>{var u,p;const g=[];!S.sortFeaturesByDistance&&(null===(u=S.sortFeatures)||void 0===u?void 0:u.sortFeaturesByField)&&S.sortFeatures.sortFeaturesOrder===i.OrderRule.Desc&&(o.features=o.features.reverse()),o.features.forEach((s,i)=>{var u,h,p;g.push((0,t.jsx)($e,{index:d+"_"+c+"_"+r+"_"+i,widgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,config:this.props.config,jimuMapView:this.state.jimuMapView,popupTitleField:S.analysisType===e.Proximity?I:null,selectedRecord:s,showPlanRoute:this.canShowPlanRouteButton(s,S.analysisType,D),distanceUnit:D||L?this.getSelectedUnitsAbbr(n):null,selectedFeatureLength:o.features.length,ifOneAnalysisResult:l,isExpanded:A,expandOnOpen:S.expandOnOpen,approximateDistanceUI:this.displayApproximateDistanceUI(a),showDistFromInputLocation:null===(u=this.state.analysisSettings)||void 0===u?void 0:u.showDistFromInputLocation,displayMapSymbol:null===(h=this.state.analysisSettings)||void 0===h?void 0:h.displayMapSymbols,isEnableProximitySearch:null===(p=this.state.analysisSettings)||void 0===p?void 0:p.enableProximitySearch,showDataActions:F&&D,isGroup:!0,selectRecord:this.executeSelectMessageAction,clearRecord:this.executeClearMessageAction,graphicLayer:this.flashLayer,selectedLayerDsId:a.useDataSource.dataSourceId,showClippedFeaturesInfo:S.analysisType===e.Proximity&&D&&S.clipFeatures,startingPointGraphic:this.incidentGraphic,highlightFeature:this.highlightFeatureOnMap},r+"_"+c+"_"+i))}),h.push((0,t.jsx)(G,{theme:this.props.theme,index:c,intl:this.props.intl,label:null!==(p=o.label)&&void 0!==p?p:S.subGroupFeatures.noValueSubGroupLabel,analysisIcon:null,featureCount:a.analysisInfo.displayFeatureCount?o.count:null,isExpanded:A,dsId:a.useDataSource.dataSourceId,analysisId:a.analysisInfo.analysisId,analysisType:S.analysisType,isListView:!1,canShowMoreFeatures:(null==o?void 0:o.count)>20,selectedRecord:o.features[0],displayMapSymbol:s,canToggle:!0,children:g},c))})):o.features.forEach((s,i)=>{var o,c,u;h.push((0,t.jsx)($e,{index:d+"_"+r+"_"+i,widgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,config:this.props.config,jimuMapView:this.state.jimuMapView,popupTitleField:S.analysisType===e.Proximity?I:null,selectedRecord:s,showPlanRoute:this.canShowPlanRouteButton(s,S.analysisType,D),distanceUnit:D||L?this.getSelectedUnitsAbbr(n):null,selectedFeatureLength:b.length,ifOneAnalysisResult:l,isExpanded:A,expandOnOpen:S.expandOnOpen,approximateDistanceUI:this.displayApproximateDistanceUI(a),showDistFromInputLocation:null===(o=this.state.analysisSettings)||void 0===o?void 0:o.showDistFromInputLocation,displayMapSymbol:null===(c=this.state.analysisSettings)||void 0===c?void 0:c.displayMapSymbols,isEnableProximitySearch:null===(u=this.state.analysisSettings)||void 0===u?void 0:u.enableProximitySearch,showDataActions:F&&D,isGroup:!0,selectRecord:this.executeSelectMessageAction,clearRecord:this.executeClearMessageAction,graphicLayer:this.flashLayer,selectedLayerDsId:a.useDataSource.dataSourceId,startingPointGraphic:this.incidentGraphic,showClippedFeaturesInfo:S.analysisType===e.Proximity&&D&&S.clipFeatures,highlightFeature:this.highlightFeatureOnMap},r+"_"+i))}),v.push((0,t.jsx)(G,{theme:this.props.theme,index:d,intl:this.props.intl,label:null!==(u=o.label)&&void 0!==u?u:S.groupFeatures.noValueGroupLabel,analysisIcon:null,featureCount:S.displayFeatureCount?o.count:null,isExpanded:A,dsId:a.useDataSource.dataSourceId,analysisId:a.analysisInfo.analysisId,analysisType:S.analysisType,isListView:!1,canShowMoreFeatures:(null==o?void 0:o.count)>20,selectedRecord:o.features[0],displayMapSymbol:s,canToggle:!0,children:h},d))})}else b.forEach((s,i)=>{var o,d,c;v.push((0,t.jsx)($e,{intl:this.props.intl,widgetId:this.props.id,index:r+"_"+i,theme:this.props.theme,config:this.props.config,popupTitleField:S.analysisType===e.Proximity?I:null,jimuMapView:this.state.jimuMapView,selectedRecord:s,distanceUnit:D||L?this.getSelectedUnitsAbbr(n):null,showPlanRoute:this.canShowPlanRouteButton(s,S.analysisType,D),selectedFeatureLength:b.length,ifOneAnalysisResult:l,isExpanded:A,expandOnOpen:S.expandOnOpen,approximateDistanceUI:this.displayApproximateDistanceUI(a),showDistFromInputLocation:null===(o=this.state.analysisSettings)||void 0===o?void 0:o.showDistFromInputLocation,displayMapSymbol:null===(d=this.state.analysisSettings)||void 0===d?void 0:d.displayMapSymbols,isEnableProximitySearch:null===(c=this.state.analysisSettings)||void 0===c?void 0:c.enableProximitySearch,showDataActions:F&&D,isGroup:!1,selectRecord:this.executeSelectMessageAction,clearRecord:this.executeClearMessageAction,highlightFeature:this.highlightFeatureOnMap,startingPointGraphic:this.incidentGraphic,selectedLayerDsId:a.useDataSource.dataSourceId,showClippedFeaturesInfo:S.analysisType===e.Proximity&&D&&S.clipFeatures,graphicLayer:this.flashLayer},r+"_"+i))});return{items:v,count:b.length,layerInfo:a,records:b,allowExport:!1,featuresAndGroup:x}},this.canShowPlanRouteButton=(t,s,i)=>{var a,o;return this.incidentGraphic&&"point"===(null===(o=null===(a=null==t?void 0:t.feature)||void 0===a?void 0:a.geometry)||void 0===o?void 0:o.type)&&i&&s!==e.Summary},this.getRecords=e=>Mt(this,void 0,void 0,function*(){const t=e.useDataSource.dataSourceId,s=w(e.useDataSource.dataSourceId);if(!s)return Promise.resolve();return new Promise((e,i)=>{var a;const o=new AbortController;this.abortControllerRef.push(o);let n=null;const{searchByLocation:r,searchCurrentExtent:l}=C(this.state.searchSettings);let d,c=!1;(r||l)&&(l||(c=!0),n=(null===(a=this.state.aoiGeometries)||void 0===a?void 0:a.bufferGeometry)?this.state.aoiGeometries.bufferGeometry:this.state.aoiGeometries.incidentGeometry),this.props.useDataSources.forEach(e=>{var t;e.dataSourceId===s.id&&(d=null!==(t=e.fields)&&void 0!==t?t:[])}),Ve(s,n,c,this.state.jimuMapView.view.spatialReference,d,o.signal).then(s=>Mt(this,void 0,void 0,function*(){r&&(null==s?void 0:s.length)>0&&!(s=yield this.getFeaturesDistance(s))?e(null):(this.featuresByDsId[t]=s,e(s))}),t=>{e(null)})})}),this.performAnalysis=(t,s,i)=>Mt(this,void 0,void 0,function*(){const a=t.useDataSource.dataSourceId,o=w(a),n=yield o.allowToExportData();return new Promise((r,l)=>{var d,c;const u=null==o?void 0:o.getIdField();let h=null;const{showAllFeatures:p,searchByLocation:g,searchCurrentExtent:y}=C(this.state.searchSettings);if((g||y)&&(h=(null===(d=this.state.aoiGeometries)||void 0===d?void 0:d.bufferGeometry)?this.state.aoiGeometries.bufferGeometry:null===(c=this.state.aoiGeometries)||void 0===c?void 0:c.incidentGeometry),this.featuresByDsId.hasOwnProperty(a)){let l=[...this.featuresByDsId[a]];g&&t.analysisInfo.returnIntersectedPolygons&&"esriGeometryPolygon"===o.getGeometryType()&&(l=l.filter(e=>{var t;return Ze.execute(null===(t=this.state.aoiGeometries)||void 0===t?void 0:t.incidentGeometry,e.feature.geometry)}),this.featuresByAnalysisId[s]=l);let d={items:[],count:l.length,layerInfo:t,records:l,allowExport:n};const c=D(),f=p||y?c:this.state.aoiGeometries.distanceUnit||this.state.searchSettings.distanceUnits||c;l.length>0?t.analysisInfo.analysisType===e.Summary?(d=this.summaryAnalysis(l,t,f,h,s),d.allowExport=n,r(d)):(t.analysisInfo.analysisType===e.Closest&&g||t.analysisInfo.analysisType===e.Proximity)&&(d=this.createFeatureSet(l,t,u,f,s,i),d.allowExport=n,r(d)):r(d)}})}),this.summaryAnalysis=(e,s,i,a,o)=>{var n,r;const l=[];let d;d=null;const c=s.analysisInfo,u=s.label,{showAllFeatures:h,searchCurrentExtent:p}=C(this.state.searchSettings),g=h||p;return c.summaryFields.length>0?(c.summaryFields.forEach((t,s)=>{var o,n;g&&t.summaryFieldInfo.hasOwnProperty("summaryBy")||((null===(o=t.summaryFieldInfo)||void 0===o?void 0:o.summaryBy)===Ae.SumOfIntersectedArea&&(d=this.getArea(e,a,i),d=this.getSummaryDisplayValue(d,t.summaryFieldInfo,i,!0)),(null===(n=t.summaryFieldInfo)||void 0===n?void 0:n.summaryBy)===Ae.SumOfIntersectedLength&&(d=this.getLength(e,a,i),d=this.getSummaryDisplayValue(d,t.summaryFieldInfo,i,!1)))}),g&&1===c.summaryFields.length&&(null===(r=null===(n=c.summaryFields[0])||void 0===n?void 0:n.summaryFieldInfo)||void 0===r?void 0:r.hasOwnProperty("summaryBy"))?this.updateSummaryOutputDS(u,s.useDataSource.dataSourceId,c.summaryFields,o,e.length):l.push((0,t.jsx)(mt,{widgetId:this.props.widgetId,records:e,theme:this.props.theme,useDataSource:s.useDataSource,summaryFieldInfos:c.summaryFields,sumOfAreaOrLengthValue:d,singleFieldColor:c.isSingleColorMode?c.singleFieldColor:null,onSummaryFieldsResolved:t=>{this.updateSummaryOutputDS(u,s.useDataSource.dataSourceId,c.summaryFields,o,e.length,t)}},o))):this.updateSummaryOutputDS(u,s.useDataSource.dataSourceId,c.summaryFields,o,e.length),{items:l,count:e.length,layerInfo:s,records:e,allowExport:!1}},this.updateSummaryOutputDS=(t,s,i,a,o,n)=>{const r=n?Object.assign({},n):{};this.summaryAttributes=r;const l=T(this.props.widgetId,e.Summary,a);r.esriCTCOUNT=o,this.buildOutputDsResultsForSummary(t,s,i,a,l,r)},this.getSummaryDisplayValue=(e,t,s,i)=>{const a={useGrouping:t.showSeparator,notation:"standard"};let o;if(t.numberFormattingOption===Fe.Round)a.maximumFractionDigits=t.significantDigits,a.minimumFractionDigits=t.significantDigits,o=this.props.intl.formatNumber(e,a);else if(t.numberFormattingOption===Fe.Truncate){if(a.minimumSignificantDigits=t.significantDigits,!isNaN(e)&&null!==e){const s=t.significantDigits;o=new RegExp(s>0?"^\\d*[.]?\\d{0,"+s+"}":"^\\d*").exec(e.toString())[0]}o=this.props.intl.formatNumber(Number(o),a)}else o=this.props.intl.formatNumber(e,a);let n=this.getSelectedUnitsAbbr(s);return i&&(n+="\xb2"),this.summaryIntersectValueAndUnitLabel(o,n)},this.summaryIntersectValueAndUnitLabel=(e,t)=>{let s="";return s=this.props.intl.formatMessage({id:"summaryIntersectValueAndUnit",defaultMessage:o.summaryIntersectValueAndUnit},{summaryIntersectValue:e,unitLabel:t}),s},this.getArea=(e,t,s)=>{let i=0;const a="square-"+s;return e.forEach(e=>{const s=e;let o;if(o=t?Ze.execute(s.feature.geometry,t):s.feature.geometry,null!==o){const e=o.spatialReference;4326===e.wkid||e.isWebMercator||e.isGeographic?i+=Qe.execute(o,{unit:a}):i+=Ke.execute(o,{unit:a})}}),i},this.getLength=(e,t,s)=>{let i=0;const a=s;return e.forEach(e=>{const s=e;let o;if(o=t?Ze.execute(s.feature.geometry,t):s.feature.geometry,null!==o){const e=o.spatialReference;4326===e.wkid||e.isWebMercator||e.isGeographic?i+=Xe.execute(o,{unit:a}):i+=et.execute(o,{unit:a})}}),i},this.resizeLayerListHeight=()=>{var e,t,s;if(null===(e=this.divRef)||void 0===e?void 0:e.current){const{searchByLocation:e,showAllFeatures:i,searchCurrentExtent:a}=C(this.state.searchSettings),o=null===(s=null===(t=this.divRef)||void 0===t?void 0:t.current)||void 0===s?void 0:s.offsetHeight,n="125%"===this.props.theme.ref.typeface.htmlFontSize?35:27;let r=o;e||a?r=o+n:i&&("125%"===this.props.theme.ref.typeface.htmlFontSize?o<=34?r=35:o>34&&(r=o+n):o<=28?r=28:o>28&&(r=o+n)),this.setState({listMaxHeight:"calc(100% - "+r+"px)"})}},this.createHighlightGraphicsForLayer=(e,t,s,i,a)=>{var o,n,r;if(s){const s=new X.default({listMode:"hide",visible:t});this.highlightGraphicsLayers.push(s),null===(o=this.state.jimuMapView)||void 0===o||o.view.map.addMany([s]),null===(n=this.state.jimuMapView)||void 0===n||n.view.map.reorder(this.flashLayer,(null===(r=this.state.jimuMapView)||void 0===r?void 0:r.view.map.layers.length)-1),e.forEach(e=>{var t,o;const n=e.getFeature(),r=ne(n,ft.colorUtils.parseThemeVariable(i,this.props.theme));if(a&&(null===(t=this.state.aoiGeometries)||void 0===t?void 0:t.incidentGeometry)){const t=Ze.execute(n.geometry,null!==(o=this.state.aoiGeometries.bufferGeometry)&&void 0!==o?o:this.state.aoiGeometries.incidentGeometry);if(t&&(r.geometry=t),"polygon"===(null==t?void 0:t.type)){const s=this.getArea([e],t,this.state.aoiGeometries.distanceUnit||this.state.searchSettings.distanceUnits||D());n.attributes=Object.assign(Object.assign({},r.attributes),{esriCTClippedInfo:Number(s).toString()})}else if("polyline"===(null==t?void 0:t.type)){const s=this.getLength([e],t,this.state.aoiGeometries.distanceUnit||this.state.searchSettings.distanceUnits||D());n.attributes=Object.assign(Object.assign({},r.attributes),{esriCTClippedInfo:Number(s).toString()})}}s&&r&&s.add(r)})}else this.highlightGraphicsLayers.push(null)},this.destroyHighlightGraphicsLayer=()=>{this.highlightGraphicsLayers.forEach(e=>{e&&(e.removeAll(),e.destroy())}),this.highlightGraphicsLayers=[]},this.onLayerToggle=(e,t)=>{var s;if((null===(s=this.highlightGraphicsLayers)||void 0===s?void 0:s.length)>0&&this.highlightGraphicsLayers[e]){const s=this.highlightGraphicsLayers[e];s&&(s.visible=!!t)}},this.queryLayers=i.lodash.debounce(e=>{this.setState({showNoResultsFoundMsg:!1,queryAborted:!1,displayLayerAccordion:[],analysisTakingLongerTime:!1},()=>{var t,s,i;let a=setTimeout(()=>{a&&(clearTimeout(a),a=null),this.setState({analysisTakingLongerTime:!0})},1e4);this.destroyHighlightGraphicsLayer();const{showAllFeatures:o,searchByLocation:n,searchCurrentExtent:r}=C(this.state.searchSettings);!e&&n&&(null===(t=this.state.analysisSettings)||void 0===t?void 0:t.onlyShowLayersResult)&&this.resetFilters(),this.clearMessageAction();const l=[],d=[];(o||(n||r)&&this.state.aoiGeometries)&&this.state.jimuMapView&&(null===(i=null===(s=this.state.analysisSettings)||void 0===s?void 0:s.layersInfo)||void 0===i?void 0:i.length)>0&&this.state.analysisSettings.layersInfo.forEach(e=>{var t;if(this.availableLayersIds.includes(e.useDataSource.dataSourceId)||e.useDataSource.dataViewId&&this.availableLayersIds.includes(e.useDataSource.mainDataSourceId)){const s=null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId;s&&!d.includes(s)&&(d.push(s),this.featuresByDsId[s]||l.push(this.getRecords(e)))}}),Promise.all(l).then(()=>{this.abortControllerRef=[],a&&(clearTimeout(a),a=null),this.setState({analysisTakingLongerTime:!1},()=>{setTimeout(()=>{this.displayAnalysisLayerInfo(e)},500)})})})},300),this.getFieldsToExport=e=>{var t;let s=[];const i=null===(t=this.state.analysisSettings)||void 0===t?void 0:t.layersInfo,{searchByLocation:a}=C(this.state.searchSettings);return i.forEach(t=>{var i;if(t.analysisInfo.analysisId===e)if((null===(i=t.analysisInfo.fieldsToExport)||void 0===i?void 0:i.length)>0){const e=[...t.analysisInfo.fieldsToExport];!a&&t.analysisInfo.fieldsToExport.includes("esriCTApproxDistance")&&e.splice(t.analysisInfo.fieldsToExport.indexOf("esriCTApproxDistance"),1),s=e}else s=O(t.useDataSource.dataSourceId)}),s},this.displayAnalysisLayerInfo=s=>{var i;const a=[];this.setState({dataSetArray:[]}),this.state.displayLayerAccordion.length>0&&(this.setState({showNoResultsFoundMsg:!1,queryAborted:!1,displayLayerAccordion:[]}),this.destroyHighlightGraphicsLayer(),this.clearMessageAction());const o=[],n=null===(i=this.state.analysisSettings)||void 0===i?void 0:i.layersInfo,{showAllFeatures:r,searchByLocation:l,searchCurrentExtent:d}=C(this.state.searchSettings);if((r||(l||d)&&this.state.aoiGeometries)&&this.state.jimuMapView&&(null==n?void 0:n.length)>0){let i=0;n.forEach((t,s)=>{var a,o,n;const r=null!==(a=t.analysisInfo.analysisId)&&void 0!==a?a:s.toString(),l=null!==(o=this.featuresByAnalysisId[r])&&void 0!==o?o:this.featuresByDsId[t.useDataSource.dataSourceId];t.analysisInfo.analysisType===e.Closest?(null==l?void 0:l.length)>0&&(i+=1):i+=null!==(n=null==l?void 0:l.length)&&void 0!==n?n:0});const c=1===i;n.forEach((t,s)=>{var i;if((!r&&!d||t.analysisInfo.analysisType!==e.Closest)&&(this.availableLayersIds.includes(t.useDataSource.dataSourceId)||t.useDataSource.dataViewId&&this.availableLayersIds.includes(t.useDataSource.mainDataSourceId))){const e=null!==(i=t.analysisInfo.analysisId)&&void 0!==i?i:s.toString();o.push(this.performAnalysis(t,e,c))}}),Promise.all(o).then(i=>{i.length&&(this.analysisLayersResults=i),i.forEach((i,o)=>{var n,r,d,c;if(i){const t=null!==(n=i.layerInfo.analysisInfo.analysisId)&&void 0!==n?n:o.toString(),s=T(this.props.widgetId,i.layerInfo.analysisInfo.analysisType,t);i.layerInfo.analysisInfo.analysisType===e.Summary?0===i.count&&this.updateSummaryOutputDS(i.layerInfo.label,i.layerInfo.useDataSource.dataSourceId,i.layerInfo.analysisInfo.summaryFields,t,0):this.buildOutputDsResults(i.layerInfo.label,s,i.records,i)}if((null==i?void 0:i.count)>0){let n=!0;"summary"===i.layerInfo.analysisInfo.analysisType&&0===i.items.length&&(n=!1);const u=i.layerInfo.useDataSource.dataSourceId,h=this.state.showExportButton&&i.allowExport,p=i.layerInfo.analysisInfo.expandOnOpen;if(this.closestFeaturesByIndexAndDsId[a.length+"_"+u]=i.records,!s&&l&&(null===(r=this.state.analysisSettings)||void 0===r?void 0:r.onlyShowLayersResult)&&(this.checkOnlyClosestConfiguredForDS(u)?this.filterToOnlyShowResultFeatures(u,i.records):this.filterToOnlyShowResultFeatures(u)),l){let t=!0,s=we;t=i.layerInfo.analysisInfo.highlightResultsOnMap,s=i.layerInfo.analysisInfo.highlightColorOnMap;const a=i.layerInfo.analysisInfo.clipFeatures&&i.layerInfo.analysisInfo.analysisType===e.Proximity;this.createHighlightGraphicsForLayer(i.records,p,t,s,a)}const g=null!==(d=this.featuresByAnalysisId[i.layerInfo.analysisInfo.analysisId])&&void 0!==d?d:this.featuresByDsId[u];a.push((0,t.jsx)(G,{theme:this.props.theme,intl:this.props.intl,widgetId:this.props.widgetId,label:i.layerInfo.label,analysisIcon:(null===(c=this.state.analysisSettings)||void 0===c?void 0:c.displayAnalysisIcon)?this.getAnalysisTypeIcon(i.layerInfo.analysisInfo.analysisType):null,featureCount:i.layerInfo.analysisInfo.displayFeatureCount?null==i?void 0:i.count:null,isExpanded:p,isListView:!0,index:a.length,dsId:u,analysisId:i.layerInfo.analysisInfo.analysisId,analysisType:i.layerInfo.analysisInfo.analysisType,showExportButton:h,onToggle:this.onLayerToggle,records:g,searchSettings:this.state.searchSettings,analysisSettings:this.state.analysisSettings,canShowMoreFeatures:i.layerInfo.analysisInfo.analysisType===e.Proximity&&(null==i?void 0:i.count)>20,canToggle:n,children:i.items},o))}});const o=this.getSaveFeaturesConfig(a.length>0);this.setState({showSaveIcon:o.anyInputFeatureEnabled||o.onlySearchAreaEnabled,displayLayerAccordion:a,showNoResultsFoundMsg:0===a.length,loadingAllFeaturesFromDs:!1},()=>{this.state.displayLayerAccordion.length>0&&n.forEach((e,t)=>{var s;if(this.availableLayersIds.includes(e.useDataSource.dataSourceId)||e.useDataSource.dataViewId&&this.availableLayersIds.includes(e.useDataSource.mainDataSourceId)){const t=null===(s=this.state.jimuMapView.getJimuLayerViewByDataSourceId(e.useDataSource.dataSourceId))||void 0===s?void 0:s.layer;t&&!t.visible&&this.state.analysisSettings.displayAllLayersResult&&(t.visible=!0)}})})})}},this.getSaveFeaturesConfig=e=>{var t,s,i,a,o,n,r,l,d;const c={anyInputFeatureEnabled:!1,onlySearchAreaEnabled:!1};if(e&&(!(null===(t=this.state.searchSettings)||void 0===t?void 0:t.searchByActiveMapArea)||!(null===(s=this.state.searchSettings)||void 0===s?void 0:s.includeFeaturesOutsideMapArea))){if(null===(a=null===(i=this.state.analysisSettings)||void 0===i?void 0:i.saveFeatures)||void 0===a?void 0:a.saveInputLocation){switch(this.state.aoiGeometries.incidentGeometry.type){case"point":c.anyInputFeatureEnabled=this.state.analysisSettings.saveFeatures.pointFeature.enabled&&!!this.state.analysisSettings.saveFeatures.pointFeature.useDataSource;break;case"polyline":c.anyInputFeatureEnabled=this.state.analysisSettings.saveFeatures.polylineFeature.enabled&&!!this.state.analysisSettings.saveFeatures.polylineFeature.useDataSource;break;case"polygon":c.anyInputFeatureEnabled=this.state.analysisSettings.saveFeatures.polygonFeature.enabled&&!!this.state.analysisSettings.saveFeatures.polygonFeature.useDataSource}}c.anyInputFeatureEnabled||(c.onlySearchAreaEnabled=(null===(o=this.state.aoiGeometries)||void 0===o?void 0:o.bufferDistance)>0&&(null===(r=null===(n=this.state.analysisSettings.saveFeatures)||void 0===n?void 0:n.searchAreaFeature)||void 0===r?void 0:r.enabled)&&!!(null===(d=null===(l=this.state.analysisSettings.saveFeatures)||void 0===l?void 0:l.searchAreaFeature)||void 0===d?void 0:d.useDataSource))}return c},this.buildOutputDsResults=(t,s,a,n)=>Mt(this,void 0,void 0,function*(){var r,l,d,c,u,h,p,g;yield new Promise(e=>setTimeout(e,500));const{showAllFeatures:y,searchCurrentExtent:f}=C(this.state.searchSettings);let m=this.getOutputDataSource(s);const v=i.DataSourceManager.getInstance(),b=v.getDataSource(n.layerInfo.useDataSource.dataSourceId);if(m||(m=yield v.createDataSource(s)),!m)return;const S=m.getSchema(),w=this.getFieldsToExport(n.layerInfo.analysisInfo.analysisId),x=S,I=Object.assign({},m.getDataSourceJson());if(f||y)delete I.geometryType;else{const e=null===(l=null===(r=I.schema)||void 0===r?void 0:r.fields)||void 0===l?void 0:l.esriCTClippedInfo;if(e){const t=(null===(d=this.state.aoiGeometries)||void 0===d?void 0:d.distanceUnit)||(null===(c=this.state.searchSettings)||void 0===c?void 0:c.distanceUnits)||D(),s=this.getSelectedUnitsAbbr(t);"esriGeometryPolygon"===I.geometryType?e.alias=this.props.intl.formatMessage({id:"areaUnitForDSColumn",defaultMessage:o.areaUnitForDSColumn},{unitLabel:s}):e.alias=this.props.intl.formatMessage({id:"lengthUnitLabel",defaultMessage:o.lengthUnitLabel},{unitLabel:s})}}v.updateDataSourceByDataSourceJson(m,(0,i.Immutable)(Object.assign(Object.assign({},I),{disableExport:!n.allowExport,exportOptions:b.getExportOptions()})));const F=Object.keys(null==x?void 0:x.fields).filter(e=>w.includes(e)||n.layerInfo.analysisInfo.includeApproxDistance).reduce((e,t)=>(e[t]=null==S?void 0:S.fields[t],e),{}),A=[];for(const e in F){const t={fieldName:F[e].name,label:F[e].alias};A.push(t)}const L=this.getOutputDataSource(s),M=Object.assign(Object.assign({},i.dataSourceUtils.getLayerDefinitionIntersection(b.getLayerDefinition(),L)),{timeInfo:null});null==L||L.setLayerDefinition(M);const T=yield i.dataSourceUtils.createJSAPIFeatureLayerByRecords(L,a,null,{id:s+"_layer",title:s,popupTemplate:{title:null!==(u=null!=t?t:m.getLabel())&&void 0!==u?u:s,fieldInfos:A,content:[{type:"fields",fieldInfos:A}]},visible:!1,listMode:"hide",customParameters:{moveFeaturesToCenterWhenPrinting:!0}}).then(e=>e.layer);if((f||y)&&(Object.defineProperty(T,"isTable",{writable:!0}),T.isTable=!0),T&&L&&(L.layer=T),n.allowExport){const i=this.state.dataSetArray;i.push({records:a,dataSource:m,name:m.getLabel(),fields:w}),n.layerInfo.analysisInfo.analysisType===e.Proximity&&this.buildOutputDataSetForProximityCount(n,t,a,m,s),yield this.updateDataActionDataSet(i)}null===(h=this.getOutputDataSource(s))||void 0===h||h.setStatus(i.DataSourceStatus.Unloaded),null===(p=this.getOutputDataSource(s))||void 0===p||p.setCountStatus(i.DataSourceStatus.Unloaded),null===(g=this.getOutputDataSource(s))||void 0===g||g.addSourceVersion()}),this.buildOutputDataSetForProximityCount=(e,t,s,a,o)=>{var n,r,l,d,c;const u=[{alias:"OBJECTID",type:"double",name:"OBJECTID"},{alias:this.nls("layer"),type:"string",name:"layerName"},{alias:this.nls("count"),type:"double",name:"esriCTProximityLayerCount"}],h={OBJECTID:0};h.layerName=t,h.esriCTProximityLayerCount=s.length;const p={type:"point",x:null===(r=null===(n=this.state.jimuMapView)||void 0===n?void 0:n.view)||void 0===r?void 0:r.extent.center.x,y:null===(d=null===(l=this.state.jimuMapView)||void 0===l?void 0:l.view)||void 0===d?void 0:d.extent.center.y,spatialReference:{wkid:this.mapView.spatialReference.wkid}},g=new V.default({attributes:h,geometry:p}),y=[];u.forEach(e=>{e.name&&y.push({fieldName:e.name,label:e.alias})});const f=new gt.default({id:o+"_layer",title:o,fields:u,geometryType:"point",source:[g],objectIdField:"OBJECTID",popupTemplate:{title:null!==(c=null!=t?t:a.getLabel())&&void 0!==c?c:o,fieldInfos:y,content:[{type:"fields",fieldInfos:y}]},visible:!1,listMode:"hide",customParameters:{moveFeaturesToCenterWhenPrinting:!0}}),m={},v=[{alias:"OBJECTID",type:i.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"},{alias:this.nls("layer"),type:i.JimuFieldType.String,jimuName:"layerName",name:"layerName"},{alias:this.nls("count"),type:i.JimuFieldType.Number,jimuName:"esriCTProximityLayerCount",name:"esriCTProximityLayerCount"}];null==v||v.forEach((e,t)=>{0===t?m.OBJECTID=e:"esriCTProximityLayerCount"===(null==e?void 0:e.name)?m.esriCTProximityLayerCount=e:m[null==e?void 0:e.jimuName]=e});const b=o+"_Count",S=t+" ("+this.nls(e.layerInfo.analysisInfo.analysisType)+" "+this.nls("count")+")",w=i.DataSourceManager.getInstance();w.getDataSource(b)&&w.destroyDataSource(b),e.allowExport&&w.createDataSource((0,i.Immutable)({id:b,type:i.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:{idField:"OBJECTID",fields:m,label:S},layer:f})).then(e=>{const t=e.buildRecord(g);e.setSourceRecords([t]);const s={records:[t],dataSource:e,name:S};this.proximityCountDataSetArr.push(s)})},this.buildOutputDsResultsForSummary=(e,t,s,a,o,n)=>Mt(this,void 0,void 0,function*(){var r,l,d,c,u,h,p,g;let y=this.getOutputDataSource(o);if(y||(y=yield i.DataSourceManager.getInstance().createDataSource(o)),!y)return;const f=i.DataSourceManager.getInstance(),m=null==f?void 0:f.getDataSource(t),v=yield m.allowToExportData(),b=Object.assign(y.getDataSourceJson());i.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(y,(0,i.Immutable)(Object.assign(Object.assign({},b),{disableExport:!v,exportOptions:m.getExportOptions()})));const S=this.getFieldsToExport(a),w=[{alias:"OBJECTID",type:"double",name:"OBJECTID"},{alias:this.nls("count"),type:"double",name:"esriCTCOUNT"}],x={OBJECTID:0};n.hasOwnProperty("esriCTCOUNT")&&(x.esriCTCOUNT=n.esriCTCOUNT),s.forEach(e=>{const t=e.fieldLabel.replace(/ /g,"");w.push({alias:e.fieldLabel,type:"string",name:t}),n.hasOwnProperty(t)&&(x[t]=n[t])});const I={type:"point",x:null===(l=null===(r=this.state.jimuMapView)||void 0===r?void 0:r.view)||void 0===l?void 0:l.extent.center.x,y:null===(c=null===(d=this.state.jimuMapView)||void 0===d?void 0:d.view)||void 0===c?void 0:c.extent.center.y,spatialReference:{wkid:this.mapView.spatialReference.wkid}},F=new V.default({attributes:x,geometry:I}),A=[];w.forEach(e=>{e.name&&A.push({fieldName:e.name,label:e.alias})});const D=new gt.default({id:o+"_layer",title:o,fields:w,geometryType:"point",source:[F],objectIdField:"OBJECTID",popupTemplate:{title:null!==(u=null!=e?e:y.getLabel())&&void 0!==u?u:o,fieldInfos:A,content:[{type:"fields",fieldInfos:A}]},visible:!1,listMode:"hide",customParameters:{moveFeaturesToCenterWhenPrinting:!0}}),C=this.getOutputDataSource(o);let L;C.layer=D;const M=C.layer.createQuery();M.outSpatialReference=this.mapView.spatialReference,M.returnGeometry=!0,M.outFields=["*"],M.where="1=1",C.layer.queryFeatures(M).then(e=>Mt(this,void 0,void 0,function*(){var s;(null===(s=e.features)||void 0===s?void 0:s.length)>0&&(L=e.features.map(e=>C.buildRecord(e)));const a=this.state.dataSetArray,o=this.featuresByDsId[t];v&&a.push({records:n.esriCTCOUNT>0?L:[],dataSource:y,name:y.getLabel()}),v&&f.createDataSource((0,i.Immutable)({id:"downloadCsv_output"+(new Date).getTime(),type:i.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:m.getSchema(),exportOptions:m.getExportOptions()})).then(e=>{const t=Object.assign(e.getDataSourceJson());i.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(e,(0,i.Immutable)(Object.assign(Object.assign({},t),{disableExport:!v,exportOptions:m.getExportOptions()}))),e.setSourceRecords(o);const s={records:o,dataSource:e,name:m.getLabel(),fields:S};a.push(s)}),yield this.updateDataActionDataSet(a)})),null===(h=this.getOutputDataSource(o))||void 0===h||h.setStatus(i.DataSourceStatus.Unloaded),null===(p=this.getOutputDataSource(o))||void 0===p||p.setCountStatus(i.DataSourceStatus.Unloaded),null===(g=this.getOutputDataSource(o))||void 0===g||g.addSourceVersion()}),this.getOutputDataSource=e=>i.DataSourceManager.getInstance().getDataSource(e),this.onResize=({width:e,height:t})=>{this.setState({widgetWidth:e}),this.resizeLayerListHeight()},this.updateClosestAddressState=e=>{this.setState({isClosestAddressShowing:e},()=>{this.resizeLayerListHeight()})},this.onOnlyShowLayerResultsChanged=()=>{var e;(null===(e=this.state.analysisSettings)||void 0===e?void 0:e.onlyShowLayersResult)?this.featuresByDsId&&Object.keys(this.featuresByDsId).forEach(e=>{let t;this.checkOnlyClosestConfiguredForDS(e)&&this.closestFeaturesByIndexAndDsId&&Object.keys(this.closestFeaturesByIndexAndDsId).some(s=>s.split(/_(.*)/s)[1]===e&&(t=this.closestFeaturesByIndexAndDsId[s],!0)),this.filterToOnlyShowResultFeatures(e,t)}):this.resetFilters(!0)},this.filterToOnlyShowResultFeatures=(e,t)=>{var s,i,a;if((null===(s=this.state.analysisSettings)||void 0===s?void 0:s.onlyShowLayersResult)&&e&&this.featuresByDsId[e]){const s=w(e);if(s){const o=t||this.featuresByDsId[e],n=null==s?void 0:s.getIdField(),r=[];o.forEach(e=>{var t;r.push(null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[n])});let l={};r.length>0?l={where:"((("+n+" IN ("+r.join(",")+"))))"}:0===r.length&&(l={where:"1=2"}),null===(a=(i=s).updateQueryParams)||void 0===a||a.call(i,l,this.props.id),this.filtersAppliedOnDsId.includes(e)||this.filtersAppliedOnDsId.push(e)}}},this.resetFilters=e=>{var t;const s={where:"1=1",sqlExpression:null};((null===(t=this.state.analysisSettings)||void 0===t?void 0:t.onlyShowLayersResult)||e)&&this.state.jimuMapView&&(this.filtersAppliedOnDsId.forEach(e=>{var t,i;const a=w(e);a&&(null===(i=(t=a).updateQueryParams)||void 0===i||i.call(t,s,this.props.id))}),this.filtersAppliedOnDsId=[])},this.checkOnlyClosestConfiguredForDS=t=>{var s;const i=[];return null===(s=this.state.analysisSettings)||void 0===s||s.layersInfo.forEach(e=>{t===e.useDataSource.dataSourceId&&i.push(e.analysisInfo.analysisType)}),!i.includes(e.Proximity)&&!i.includes(e.Summary)},this.onResetButtonClick=()=>{var e;null===(e=this.aoiToolRef.current)||void 0===e||e.refreshButtonClicked(),this.setState({showExportOptions:!1,showFeatureForm:!1,currentPage:1})},this.onSaveInputLocationClick=()=>{const e=this.getSaveFeaturesConfig(!0);this.setState({showFeatureForm:!0,currentPage:e.onlySearchAreaEnabled?2:1},()=>{let e;e=1===this.state.currentPage?this.state.aoiGeometries.incidentGeometry.type:this.state.aoiGeometries.bufferGeometry.type,this.initializeForm(e)})},this.getLayerToSaveFeature=e=>{let t;if(2===this.state.currentPage)t=this.state.analysisSettings.saveFeatures.searchAreaFeature.useDataSource.dataSourceId;else switch(e){case"point":t=this.state.analysisSettings.saveFeatures.pointFeature.useDataSource.dataSourceId;break;case"polyline":t=this.state.analysisSettings.saveFeatures.polylineFeature.useDataSource.dataSourceId;break;case"polygon":t=this.state.analysisSettings.saveFeatures.polygonFeature.useDataSource.dataSourceId}return w(t).layer},this.initializeForm=e=>{var t,s,i,a;if(1===this.state.currentPage&&this.incidentGeomfeatureForm)return;if(2===this.state.currentPage&&this.bufferGeomfeatureForm)return;const o=this.getLayerToSaveFeature(e);let n="polygon"===e&&2===this.state.currentPage?this.state.aoiGeometries.bufferGeometry:this.state.aoiGeometries.incidentGeometry;if(n&&(n.hasZ||n.hasM)){const e=(null===(s=null===(t=o.capabilities)||void 0===t?void 0:t.data)||void 0===s?void 0:s.supportsZ)||o.hasZ||!1,r=(null===(a=null===(i=o.capabilities)||void 0===i?void 0:i.data)||void 0===a?void 0:a.supportsM)||o.hasM||!1,l=n.clone();n.hasZ&&!e&&(l.hasZ=!1),n.hasM&&!r&&(l.hasM=!1),n=l}const r="polygon"===e&&2===this.state.currentPage?"buffer-feature-form":"incident-feature-form",l=new V.default({geometry:n}),d=new tt.default({container:r,layer:o,feature:l});1===this.state.currentPage?this.incidentGeomfeatureForm=d:this.bufferGeomfeatureForm=d,this.handleFormSubmit()},this.handleFormSubmit=()=>{const e=new Promise(e=>{var t;null===(t=this.incidentGeomfeatureForm)||void 0===t||t.on("submit",t=>{t.invalid.length?this.pageChanged(1):this.bufferGeomfeatureForm?e(!0):this.submitForm()})}),t=new Promise(t=>{var s;null===(s=this.bufferGeomfeatureForm)||void 0===s||s.on("submit",s=>{this.incidentGeomfeatureForm?e.then(()=>{s.invalid.length?this.pageChanged(2):t(!0)}):s.invalid.length?this.pageChanged(2):this.submitForm()})});Promise.all([e,t]).then(()=>{this.submitForm()})},this.resetFeatureForm=()=>{this.state.showFeatureForm&&(this.incidentGeomfeatureForm=void 0,this.bufferGeomfeatureForm=void 0,this.setState({showFeatureForm:!1,currentPage:1,formFailedMsg:""}))},this.pageChanged=e=>{this.setState({currentPage:e},()=>{this.initializeForm(1===this.state.currentPage?this.state.aoiGeometries.incidentGeometry.type:this.state.aoiGeometries.bufferGeometry.type)})},this.submitBtnClicked=()=>{this.incidentGeomfeatureForm&&this.incidentGeomfeatureForm.submit(),this.bufferGeomfeatureForm&&this.bufferGeomfeatureForm.submit()},this.submitForm=()=>Mt(this,void 0,void 0,function*(){this.setState({isSubmittingForm:!0});try{if(this.incidentGeomfeatureForm){const e=this.incidentGeomfeatureForm.layer;this.incidentGeomfeatureForm.feature.attributes=this.incidentGeomfeatureForm.getValues(),yield e.applyEdits({addFeatures:[this.incidentGeomfeatureForm.feature]})}if(this.bufferGeomfeatureForm)try{const e=this.bufferGeomfeatureForm.layer;this.bufferGeomfeatureForm.feature.attributes=this.bufferGeomfeatureForm.getValues(),yield e.applyEdits({addFeatures:[this.bufferGeomfeatureForm.feature]}),this.incidentGeomfeatureForm=void 0,this.bufferGeomfeatureForm=void 0,this.setState({showFeatureForm:!1,currentPage:1,isSubmittingForm:!1,formFailedMsg:""})}catch(e){console.error(e),this.setState({formFailedMsg:e.message,showFeatureForm:!0,isSubmittingForm:!1},()=>{this.handleFormSubmit()})}else this.incidentGeomfeatureForm=void 0,this.bufferGeomfeatureForm=void 0,this.setState({showFeatureForm:!1,isSubmittingForm:!1,currentPage:1,formFailedMsg:""})}catch(e){console.error(e),this.setState({formFailedMsg:e.message,isSubmittingForm:!1},()=>{this.pageChanged(1),this.handleFormSubmit()})}}),this.stopLoading=()=>{this.abortControllerRef.forEach(e=>{e.abort()}),this.onResetButtonClick(),this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={},this.setState({queryAborted:!0,loadingAllFeaturesFromDs:!1})},this.getPromptMessageString=e=>{let t="";return t=this.props.intl.formatMessage({id:"promptTitleMessageFromDataAction",defaultMessage:o.promptTitleMessageFromDataAction},{layerName:e}),t},this.getSaveInputLocationHeaderString=e=>{let t="";return t=this.props.intl.formatMessage({id:"saveInputLocationLabel",defaultMessage:o.saveInputLocationLabel},{layerName:e}),t},this.getSaveSearchAreaLabelHeaderString=e=>{let t="";return t=this.props.intl.formatMessage({id:"saveSearchAreaLabel",defaultMessage:o.saveSearchAreaLabel},{layerName:e}),t},this.onBatchExportToggle=()=>Mt(this,void 0,void 0,function*(){if(this.state.showExportOptions)this.setState({showExportOptions:!this.state.showExportOptions});else{this.setState({isDropDownLoading:!0});try{const[e]=yield this.getAvailableActions(),t=Object.keys(e);this.setState({actionNames:t,actionNamesGroups:e})}catch(e){console.error(e),this.setState({actionNamesGroups:{}})}this.setState({showExportOptions:!this.state.showExportOptions}),this.setState({isDropDownLoading:!1})}}),this.getAvailableActions=()=>{let e=null;return 0!==this.getRecordsCount()&&(e=i.DataActionManager.getInstance().getSupportedActions(this.props.widgetId,this.state.dataSetArray,i.DataLevel.Records)),Promise.all([e||{}])},this.getRecordsCount=()=>{var e;let t=0;for(const s of this.state.dataSetArray)t+=null===(e=s.records)||void 0===e?void 0:e.length;return t},this.renderFormForSavingInputLocation=()=>{var e;const s=this.props.theme,o=(null===(e=this.state.analysisSettings)||void 0===e?void 0:e.saveFeatures.searchAreaFeature.enabled)&&!!this.state.analysisSettings.saveFeatures.searchAreaFeature.useDataSource&&this.state.aoiGeometries.bufferDistance>0,n=this.state.currentPage,r=o&&1===n?this.nls("next"):this.nls("submit"),l=1===n?this.state.aoiGeometries.incidentGeometry.type:this.state.aoiGeometries.bufferGeometry.type,d=this.getLayerToSaveFeature(l),c=1===n?this.getSaveInputLocationHeaderString(d.title):this.getSaveSearchAreaLabelHeaderString(d.title),u=i.css`
        display: flex;
        flex-direction: column;
        height: 100%;
        `,h=i.css`
        position: sticky;
        top: 0;
        display: flex;
        `,p=i.css`
        flex-shrink: 0;
        `,g=i.css`
        border-left: ${2===n?`1px solid ${s.sys.color.divider.secondary}`:"none"};
        `,y=i.css`
        flex: 1;
        overflow-y: auto;
        border-top: 1px solid ${s.sys.color.divider.secondary};
        border-bottom: 1px solid ${s.sys.color.divider.secondary};
        `,f=i.css`
        position: sticky;
        bottom: 5px;
        display: flex;
        `,m=i.css`
        border-radius: 0px !important;
       `;return(0,t.jsx)(i.React.Fragment,{children:(0,t.jsxs)("div",{css:u,children:[(0,t.jsxs)("div",{css:h,children:[2===this.state.currentPage&&this.incidentGeomfeatureForm&&(0,t.jsx)(a.Button,{css:p,"aria-label":this.nls("back"),type:"tertiary",icon:!0,onClick:()=>{2===n?this.pageChanged(1):this.resetFeatureForm()},children:(0,t.jsx)(Ct,{autoFlip:!0})}),(0,t.jsx)(a.Typography,{css:g,variant:"title2",color:"paperText",className:"py-3 px-2",children:c})]}),(0,t.jsxs)("div",{css:y,className:"mb-3",children:[this.state.formFailedMsg&&(0,t.jsx)(a.Alert,{style:{width:"100%"},"aria-live":"polite",closable:!0,form:"basic",onClose:()=>{this.setState({formFailedMsg:""})},open:!0,shape:"none",size:"medium",text:this.state.formFailedMsg,title:this.nls("formSubmissionFailedMsg"),type:"error",variant:"contained",withIcon:!0}),(0,t.jsx)("div",{style:{display:1===n?"block":"none"},id:"incident-feature-form"}),(0,t.jsx)("div",{style:{display:2===n?"block":"none"},id:"buffer-feature-form"})]}),(0,t.jsxs)("div",{css:f,className:"px-3",children:[(0,t.jsx)(a.Button,{block:!0,role:"button","aria-label":this.nls("cancel"),title:this.nls("cancel"),size:"default",type:"secondary",css:m,onClick:this.resetFeatureForm,children:this.nls("cancel")}),(0,t.jsx)(a.Button,{block:!0,role:"button","aria-label":r,title:r,size:"default",type:"primary",css:m,onClick:()=>{2===n?this.submitBtnClicked():o&&1===n?this.pageChanged(2):this.submitBtnClicked()},children:r})]})]})})},this.renderBatchExportList=()=>{var e;const{searchByLocation:s}=C(this.state.searchSettings);let o=!1;s&&(o=!0);const n=(0,i.getAppStore)().getState().appContext.isRTL,r=[];let l,d=!1;(this.analysisLayersResults.length||this.summaryAttributes)&&(l=this.createPrintReportData(r)),this.analysisLayersResults.forEach(e=>{var t,s;e.layerInfo.analysisInfo.groupFeaturesEnabled&&""!==e.layerInfo.analysisInfo.groupFeatures.groupFeaturesByField&&(null===(s=null===(t=e.featuresAndGroup)||void 0===t?void 0:t.featuresGroup)||void 0===s?void 0:s.length)>0&&(d=!0)});const c=i.css`
     padding-top: 7px!important;
    `,u=i.css`
        @keyframes loading {
          0% {transform: rotate(0deg); };
          100% {transform: rotate(360deg)};
        }
        position: absolute;
        width: 60%;
        height: 60%;
        top: 20%;
        left: 20%;
        border: 2px solid var(--sys-color-secondary-light);
        border-radius: 50%;
        border-top: 2px solid var(--sys-color-primary-main);
        box-sizing: border-box;
        animation:loading 2s infinite linear;
      `;return(0,t.jsxs)(i.React.Fragment,{children:[(0,t.jsxs)(a.Dropdown,{className:"float-right",direction:"down",size:"sm","aria-label":this.nls("exportBtnTitle"),useKeyUpEvent:!0,toggle:this.onBatchExportToggle,isOpen:this.state.showExportOptions,children:[(0,t.jsxs)(a.DropdownButton,{size:"sm",arrow:!1,css:c,icon:!0,ref:this.dropdownRef,className:"data-action-button",onClick:this.onBatchExportToggle,type:"tertiary",title:this.nls("exportBtnTitle"),children:[!this.state.isDropDownLoading&&(0,t.jsx)(b,{size:"m"}),this.state.isDropDownLoading&&(0,t.jsx)("div",{css:u})]}),(0,t.jsxs)(a.DropdownMenu,{children:[(0,t.jsxs)(a.Dropdown,{direction:"right",isSubMenuItem:!0,children:[(0,t.jsx)(a.DropdownButton,{size:"sm",type:"default",arrowRight:!0,onClick:this.onExportPdfOptionClick,children:(0,t.jsx)("div",{className:"d-flex align-items-center",children:(0,t.jsx)("span",{children:this.nls("exportToPdf")})})}),(0,t.jsx)(a.DropdownMenu,{children:(0,t.jsx)("div",{onClick:this.pdfPopupClick,className:"p-3 w-100",children:(0,t.jsx)(It,{theme:this.props.theme,intl:this.props.intl,mapView:this.state.jimuMapView,reportData:l,showAreaOfInterest:o,aoiValue:this.aoiValue,isGroupingEnabled:d,isRTL:n,folderUrl:this.props.context.folderUrl,onReportExported:this.onExportPdfClick})})})]},this.state.actionNames.length+1),(null===(e=this.state.actionNames)||void 0===e?void 0:e.length)>0&&this.state.actionNames.map(e=>this.createActionItem(this.state.actionNamesGroups,e,i.DataLevel.Records))]})]}),this.state.actionElement]})},this.onExportPdfOptionClick=()=>{var e,t;const{searchByLocation:s}=C(this.state.searchSettings);if(s){const s=(null===(e=this.state.aoiGeometries)||void 0===e?void 0:e.bufferGeometry)?this.state.aoiGeometries.bufferGeometry:this.state.aoiGeometries.incidentGeometry;null===(t=this.state.jimuMapView)||void 0===t||t.view.goTo({center:"point"===s.type?s:s.extent.clone().expand(1.5)})}},this.onExportPdfClick=()=>{this.setState({showExportOptions:!1})},this.pdfPopupClick=e=>{e.stopPropagation()},this.createPrintReportData=t=>{const s=t,i=!0;return this.analysisLayersResults.forEach(t=>{var a,n,r,l,d,c,u,h,p,g,y,f;const m=[],v=[];let b=[];if(t.allowExport)if(t.layerInfo.analysisInfo.analysisType===e.Summary){const i=T(this.props.widgetId,e.Summary,t.layerInfo.analysisInfo.analysisId),o=this.getOutputDataSource(i),r=null===(n=null===(a=null==o?void 0:o.layer)||void 0===a?void 0:a.source)||void 0===n?void 0:n.at(0),l=[];t.layerInfo.analysisInfo.summaryFields.forEach(e=>{const t=e.fieldLabel.replace(/ /g,"");(null==r?void 0:r.attributes.hasOwnProperty(t))&&(m.push(e.fieldLabel),l.push(r.attributes[t]))}),(null==r?void 0:r.attributes.esriCTCOUNT)>0&&0===m.length&&0===l.length&&(m.push(this.nls("count")),l.push(r.attributes.esriCTCOUNT)),v.push(l),s.push({data:{cols:m,rows:v,showRowIndex:!0},title:t.layerInfo.label,totalCount:t.records.length,maxNoOfCols:5})}else{const e=this.getFieldsToExport(t.layerInfo.analysisInfo.analysisId),a=t.layerInfo.analysisInfo;let n=t.records,S=null,w=null;a.groupFeaturesEnabled&&""!==a.groupFeatures.groupFeaturesByField&&(null===(l=null===(r=t.featuresAndGroup)||void 0===r?void 0:r.featuresGroup)||void 0===l?void 0:l.length)>0&&(n=[],null===(d=t.featuresAndGroup)||void 0===d||d.featuresGroup.forEach(e=>{var t,s;(null===(s=null===(t=e.subGroupInfo)||void 0===t?void 0:t.featuresSubGroup)||void 0===s?void 0:s.length)>0?e.subGroupInfo.featuresSubGroup.forEach(e=>{n.push(...e.features)}):n.push(...e.features)}));let x="",I="",F="",A="";for(const t in null===(c=n[0])||void 0===c?void 0:c.feature.attributes){let s;const i=n[0].feature.layer.fields;if(e.includes(t)){if("esriCTApproxDistance"===t)s=this.nls("closestApproxDistance");else if("esriCTClippedInfo"===t){const e=(null===(u=this.state.aoiGeometries)||void 0===u?void 0:u.distanceUnit)||(null===(h=this.state.searchSettings)||void 0===h?void 0:h.distanceUnits)||D();let t=this.getSelectedUnitsAbbr(e);"polygon"===(null===(p=n[0].feature.geometry)||void 0===p?void 0:p.type)?(t+="\xb2",s=this.props.intl.formatMessage({id:"areaUnitLabel",defaultMessage:o.areaUnitLabel},{unitLabel:t})):s=this.props.intl.formatMessage({id:"lengthUnitLabel",defaultMessage:o.lengthUnitLabel},{unitLabel:t})}else if(void 0!==t){s=(null===(g=i.filter(e=>e.name===t)[0])||void 0===g?void 0:g.alias)||t}void 0!==s&&(m.includes(s)||(t===(null===(y=a.groupFeatures)||void 0===y?void 0:y.groupFeaturesByField)||t===(null===(f=a.subGroupFeatures)||void 0===f?void 0:f.subGroupFeaturesByField)?(t===a.groupFeatures.groupFeaturesByField&&(S=1,x=s,F=t),""!==a.subGroupFeatures.subGroupFeaturesByField&&t===a.subGroupFeatures.subGroupFeaturesByField&&(w=2,I=s,A=t)):(m.push(s),b.push(t))))}}F&&A&&F===A&&(I="",w=null,A=""),A&&(m.unshift(I),b.unshift(A)),F&&(m.unshift(x),b.unshift(F)),n.forEach(t=>{const s=[];b.length||(b=Object.keys(t.feature.attributes)),b.forEach(i=>{var a,o;if(e.includes(i)){let e=null!==(a=t.getFormattedFieldValue(i,this.props.intl))&&void 0!==a?a:"";if(void 0!==e&&""!==e&&null!==e&&""!==e.toString().trim()||(e=this.nls("noData")),"esriCTClippedInfo"===i&&e!==this.nls("noData")){const s={useGrouping:!0,notation:"standard",maximumFractionDigits:2,minimumFractionDigits:2};if(e=this.props.intl.formatNumber(e,s),"0.00"===e){const s=null!==(o=t.getFormattedFieldValue(i,this.props.intl))&&void 0!==o?o:"";e=""!==s?P(s):""}}s.push(e)}}),v.push(s)}),s.push({data:{cols:m,rows:v,showRowIndex:i},title:t.layerInfo.label,totalCount:t.records.length,maxNoOfCols:5,groupFieldCol:S,subgroupFieldCol:w})}}),s},this.onActionItemClick=(e,t)=>Mt(this,void 0,void 0,function*(){const s="active-data-action-item",a=document.querySelector(`.${s}`);a&&a.classList.remove(s),this.dropdownRef.current.className=(0,i.classNames)(this.dropdownRef.current.className,s);let o=this.state.dataSetArray;"export-csv"===e.id&&this.proximityCountDataSetArr.length>0&&(o=[...o,this.proximityCountDataSetArr[0]]);const n=yield i.DataActionManager.getInstance().executeDataAction(e,o,t,this.props.widgetId);null!==n&&"boolean"!=typeof n&&this.setState({actionElement:i.React.cloneElement(n,{onClose:()=>{this.setState({actionElement:null})},onConfirm:(...e)=>(!n.props.keepOpenAfterConfirm&&this.setState({actionElement:null}),n.props.onConfirm(...e))})}),this.setState({showExportOptions:!1})}),this.createActionItem=(e,s,o)=>{const n=e[s];return"export"===s&&(null==n?void 0:n.length)>0&&this.state.dataSetArray.length>0&&n.length>0?(0,t.jsx)(i.React.Fragment,{children:n.map((e,s)=>{var n;let r=e.label;if(e.widgetId){const t=(0,i.getAppStore)().getState().appConfig.widgets[e.widgetId];r=null!==(n=null==t?void 0:t.label)&&void 0!==n?n:e.label}return(0,t.jsx)(a.DropdownItem,{header:!1,onClick:()=>Mt(this,void 0,void 0,function*(){yield this.onActionItemClick(e,o)}),children:r},s)})},"exportAction"):null},this.onIncidentGraphicChange=e=>{this.incidentGraphic="point"===e.geometry.type?e:null},this.onQueryRequired=(e,t)=>{if(t)for(const s in e){const a=e[s],o=null==t?void 0:t[s];if(!a||i.lodash.isDeepEqual(null==a?void 0:a.widgetQueries,null==o?void 0:o.widgetQueries))return(null==a?void 0:a.sourceVersion)!==(null==o?void 0:o.sourceVersion)?void this.updateOnDSInfoChange():void 0;let n=!1;if(a.widgetQueries){const{showAllFeatures:e,searchByLocation:t}=C(this.state.searchSettings),s=Object.keys(a.widgetQueries);(e||t)&&s.includes("filter-data-record-action")&&s.splice(s.indexOf("filter-data-record-action"),1),s.some(e=>{var t,s;return!(e===this.props.id||i.lodash.isDeepEqual(null===(t=null==a?void 0:a.widgetQueries)||void 0===t?void 0:t[e],null===(s=null==o?void 0:o.widgetQueries)||void 0===s?void 0:s[e]))&&(n=!0,!0)})}n&&this.updateOnDSInfoChange()}},this.updateOnDSInfoChange=i.lodash.debounce(()=>{var e,t;if(this.skipDsInfoChange)return void(this.skipDsInfoChange=!1);const{showAllFeatures:s,searchByLocation:i,searchCurrentExtent:a}=C(this.state.searchSettings);s||i?this.onRefreshResult(!0):a&&(null===(t=null===(e=this.aoiToolRef)||void 0===e?void 0:e.current)||void 0===t||t.onSearchByMapAreaClicked())},1e3),this.renderDataSourceComponent=()=>{var e;const s=[];return null===(e=this.props.useDataSources)||void 0===e||e.forEach((e,a)=>{s.push((0,t.jsx)(i.DataSourceComponent,{useDataSource:e,onQueryRequired:this.onQueryRequired,widgetId:this.props.id},a))}),s},this.divRef=i.React.createRef(),this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={},this.highlightGraphicsLayers=[],this.geometriesFromAction={},this.actionTimeout=null,this.filtersAppliedOnDsId=[],this.selectedPopupContainer=null,this.selectedRecordsKey="",this.selectedRecord=null,this.incidentGraphic=null,this.skipHighlightRecordsOnMap=!1,this.skipDsInfoChange=!1,this.analysisLayersResults={},this.summaryAttributes={},this.proximityCountDataSetArr=[],this.aoiValue="",this.state={jimuMapView:null,searchSettings:null,activeDataSource:null,analysisSettings:null,generalSettings:this.props.config.generalSettings,aoiGeometries:null,displayLayerAccordion:[],isClosestAddressShowing:!1,isMapAreaWarningMsgShowing:!1,listMaxHeight:"",noResultsFoundMsg:""!==this.props.config.generalSettings.noResultsFoundText?this.props.config.generalSettings.noResultsFoundText:this.nls("noDataMessageDefaultText"),showNoResultsFoundMsg:!1,queryAborted:!1,msgActionGeometry:null,showExportButton:void 0===this.props.enableDataAction||this.props.enableDataAction,isLayerAvailable:!0,isAnalysisLayerConfigured:!0,widgetWidth:null,loadingAllFeaturesFromDs:!1,promptForDataAction:!1,showExportOptions:!1,dataSetArray:[],actionNames:[],actionNamesGroups:{},isDropDownLoading:!1,actionElement:null,dataSetUpdated:!1,onWidgetLoadShowLoadingIndicator:!0,isFilterActionBinded:!1,analysisTakingLongerTime:!1,showSaveIcon:!1,showFeatureForm:!1,currentPage:1,formFailedMsg:"",isSubmittingForm:!1,widgetClosed:!1,dsToGetSelectedOnLoad:[]}}updateDataActionDataSet(e){return new Promise(t=>{this.setState({dataSetArray:e,dataSetUpdated:!this.state.dataSetUpdated},()=>{t()})})}render(){var e,o,r,l,d,c,u,h,p,g,y,f,m,v,b,S,w;const{showAllFeatures:x,searchByLocation:I,searchCurrentExtent:F}=C(this.state.searchSettings);if(!(null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0]))return(0,t.jsx)(a.WidgetPlaceholder,{"data-testid":"widgetPlaceholder",icon:Tt,widgetId:this.props.id,name:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:this.nls("_widgetLabel")})});const A=!this.state.onWidgetLoadShowLoadingIndicator&&(!(null===(o=this.state)||void 0===o?void 0:o.jimuMapView)||this.state.loadingAllFeaturesFromDs||0===this.state.displayLayerAccordion.length&&!this.state.showNoResultsFoundMsg&&(x||(I||F)&&this.state.aoiGeometries)&&(null===(r=this.state.analysisSettings)||void 0===r?void 0:r.layersInfo.length)>0&&null!==this.state.jimuMapView)&&!this.state.queryAborted,D=this.state.analysisTakingLongerTime?this.nls("analysisTakingLongerMsg"):this.nls("loadingText"),L=[];return(null===(l=this.state.dsToGetSelectedOnLoad)||void 0===l?void 0:l.length)>0&&this.state.dsToGetSelectedOnLoad.forEach(e=>{var t,s;const a=i.DataSourceManager.getInstance().getDataSource(e);a&&L.push({dataSourceId:e,mainDataSourceId:null===(t=a.getMainDataSource())||void 0===t?void 0:t.id,rootDataSourceId:null===(s=a.getRootDataSource())||void 0===s?void 0:s.id})}),(0,t.jsxs)(a.Paper,{ref:this.widgetConRef,variant:"flat",shape:"none",className:"jimu-widget",css:n(this.props.theme,this.state.listMaxHeight,this.state.generalSettings.noResultMsgStyleSettings,this.state.generalSettings.promptTextMsgStyleSettings,null===(d=this.state.searchSettings)||void 0===d?void 0:d.headingLabelStyle,this.state.showFeatureForm),children:[(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null===(c=this.props.useMapWidgetIds)||void 0===c?void 0:c[0],onActiveViewChange:this.onActiveViewChange}),this.renderDataSourceComponent(),L.length>0&&(0,t.jsx)(i.MultipleDataSourceComponent,{useDataSources:(0,i.Immutable)([...L]),onDataSourceInfoChange:this.onDataSourceInfoChange,widgetId:this.props.id}),(0,t.jsxs)("div",{className:"widget-near-me",children:[this.state.showFeatureForm&&this.renderFormForSavingInputLocation(),this.state.isSubmittingForm&&(0,t.jsx)(a.Loading,{type:a.LoadingType.Donut}),(0,t.jsxs)("div",{className:"main-row w-100 h-100",children:[(0,t.jsxs)("div",{ref:this.divRef,children:[(I||F)&&this.state.jimuMapView&&this.state.isLayerAvailable&&this.state.isAnalysisLayerConfigured&&(0,t.jsx)(ke,{ref:this.aoiToolRef,theme:this.props.theme,intl:this.props.intl,widgetClosed:this.state.widgetClosed,activateToolOnWidgetLoad:this.state.searchSettings.activeToolWhenWidgetOpens,isFilterActionBinded:this.state.isFilterActionBinded,headingLabel:null===(u=this.state.searchSettings)||void 0===u?void 0:u.headingLabel,showInputAddress:null===(h=this.state.searchSettings)||void 0===h?void 0:h.showInputAddress,config:this.state.searchSettings,highlightColor:ft.colorUtils.parseThemeVariable(this.state.generalSettings.highlightColor,this.props.theme),bufferSymbol:this.state.generalSettings.searchAreaSymbol,jimuMapView:this.state.jimuMapView,aoiComplete:this.onAoiComplete,clear:this.onClear,bufferLayer:this.bufferLayer,drawingLayer:this.drawingLayer,updateClosestAddressState:this.updateClosestAddressState,incidentGraphicChange:this.onIncidentGraphicChange,msgActionGeometry:this.state.msgActionGeometry,widgetWidth:this.state.widgetWidth}),x&&this.state.jimuMapView&&this.state.isLayerAvailable&&this.state.isAnalysisLayerConfigured&&(0,t.jsx)(a.Label,{className:"headingLabelStyle px-2 pt-2",children:null===(p=this.state.searchSettings)||void 0===p?void 0:p.headingLabel}),((null===(g=this.state.displayLayerAccordion)||void 0===g?void 0:g.length)>0||0===this.state.displayLayerAccordion.length&&this.state.showNoResultsFoundMsg&&(x||I&&this.state.aoiGeometries)&&(null===(y=this.state.analysisSettings)||void 0===y?void 0:y.layersInfo.length)>0&&this.state.isAnalysisLayerConfigured)&&this.state.isLayerAvailable&&(I||x)&&this.state.jimuMapView&&(0,t.jsxs)(i.React.Fragment,{children:[(0,t.jsx)("div",{className:"float-right",children:(0,t.jsx)(a.Button,{type:"tertiary","aria-label":this.nls("refreshTooltip"),icon:!0,title:this.nls("refreshTooltip"),onClick:()=>{this.onRefreshResult(!1)},children:(0,t.jsx)(ot,{})})}),I&&(0,t.jsx)("div",{className:"float-right",children:(0,t.jsx)(a.Button,{type:"tertiary","aria-label":this.nls("clear"),icon:!0,title:this.nls("clear"),onClick:this.onResetButtonClick,children:(0,t.jsx)(pt,{})})}),this.state.showSaveIcon&&(0,t.jsx)("div",{className:"float-right",children:(0,t.jsx)(a.Button,{type:"tertiary","aria-label":this.nls("saveTooltip"),icon:!0,title:this.nls("saveTooltip"),onClick:this.onSaveInputLocationClick,children:(0,t.jsx)(dt,{})})})]}),(null===(f=this.state.displayLayerAccordion)||void 0===f?void 0:f.length)>0&&this.state.isLayerAvailable&&(I||x)&&this.state.jimuMapView&&this.state.showExportButton&&this.getRecordsCount()>0&&(0,t.jsx)(i.React.Fragment,{children:this.renderBatchExportList()}),(null===(m=this.state.displayLayerAccordion)||void 0===m?void 0:m.length)>0&&this.state.isLayerAvailable&&F&&this.state.jimuMapView&&this.state.showExportButton&&this.getRecordsCount()>0&&(0,t.jsx)("div",{className:"pr-1",children:this.renderBatchExportList()})]}),(0,t.jsxs)("div",{className:"layerContainer",children:[this.state.onWidgetLoadShowLoadingIndicator&&this.state.isLayerAvailable&&(0,t.jsxs)(i.React.Fragment,{children:[(0,t.jsx)(a.Loading,{type:a.LoadingType.Donut}),(0,t.jsx)("p",{"data-testid":"mapLoadingMsg",className:"map-loading-text pt-4",children:this.nls("mapLoadingMsg")})]}),A&&(0,t.jsxs)(i.React.Fragment,{children:[(0,t.jsx)(a.Loading,{type:a.LoadingType.Donut}),(this.state.loadingAllFeaturesFromDs||(null===(v=this.state.analysisSettings)||void 0===v?void 0:v.layersInfo.length)>0)&&(0,t.jsxs)("p",{className:"loading-text pt-4",children:[D,this.state.analysisTakingLongerTime&&(0,t.jsx)(a.Button,{role:"button","aria-label":this.nls("commonModalCancel"),title:this.nls("stopQueryProgressMsg"),size:"default",type:"default",className:"cancel-button-pos",onClick:this.stopLoading,children:this.nls("commonModalCancel")})]})]}),this.state.displayLayerAccordion.length>0&&this.state.jimuMapView&&this.state.isLayerAvailable&&(0,t.jsx)(i.React.Fragment,{children:this.state.displayLayerAccordion}),!A&&0===this.state.displayLayerAccordion.length&&(!this.state.showNoResultsFoundMsg||this.state.queryAborted)&&(null===(b=this.state.analysisSettings)||void 0===b?void 0:b.layersInfo.length)>0&&this.state.jimuMapView&&this.state.isAnalysisLayerConfigured&&this.state.isLayerAvailable&&(0,t.jsx)("div",{className:"applyPromptTextStyle",children:this.state.generalSettings.promptTextMessage}),!A&&0===this.state.displayLayerAccordion.length&&(x||(I||F)&&this.state.aoiGeometries)&&(null===(S=this.state.analysisSettings)||void 0===S?void 0:S.layersInfo.length)>0&&this.state.jimuMapView&&this.state.isAnalysisLayerConfigured&&this.state.isLayerAvailable&&this.state.showNoResultsFoundMsg&&!this.state.queryAborted&&(0,t.jsx)("div",{className:"applyTextStyle",children:this.state.generalSettings.noResultsFoundText}),!this.state.isAnalysisLayerConfigured&&this.state.isLayerAvailable&&(0,t.jsx)(a.Alert,{tabIndex:0,withIcon:!0,size:"small",type:"info",className:"w-100 shadow-2 mb-1 m-0",children:(0,t.jsx)("div",{className:"flex-grow-1 text-break settings-text-level","data-testid":"noAnalysisLayerMsg",children:this.nls("noAnalysisLayerMsg")})}),!this.state.isLayerAvailable&&(0,t.jsx)(a.Alert,{tabIndex:0,withIcon:!0,size:"small",type:"info",className:"w-100 shadow-2 mb-1 m-0",children:(0,t.jsx)("div",{className:"flex-grow-1 text-break settings-text-level",children:this.nls("warningMsgIfNoLayersOnMap")})})]})]})]}),(0,t.jsx)(i.ReactResizeDetector,{targetRef:this.widgetConRef,handleWidth:!0,handleHeight:!0,onResize:this.onResize}),this.state.promptForDataAction&&(0,t.jsx)(a.ConfirmDialog,{level:"info",title:this.getPromptMessageString(null===(w=this.props.selectedDataSource)||void 0===w?void 0:w.getLabel()),hasNotShowAgainOption:!1,content:this.nls("promptBottomMessageFromDataAction"),confirmLabel:this.nls("okButtonLabel"),cancelLabel:this.nls("commonModalCancel"),onConfirm:this.analyzeAllFeatures.bind(this),onClose:this.onCancelButtonClicked.bind(this)})]})}}Pt.versionManager=St,Pt.mapExtraStateProps=(e,t)=>{var s,i,a,o;return{currentLocation:null===(s=null==t?void 0:t.mutableStateProps)||void 0===s?void 0:s.currentLocation,selectedIncidentLocation:null===(i=null==t?void 0:t.mutableStateProps)||void 0===i?void 0:i.selectedIncidentLocation,selectedDataSource:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedDataSource,messageConfigs:null===(o=null==e?void 0:e.appConfig)||void 0===o?void 0:o.messageConfigs}};const Bt=Pt;function Et(e){L.p=e}})(),M})())}}});