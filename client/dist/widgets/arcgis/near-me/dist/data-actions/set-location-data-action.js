System.register(["jimu-core","jimu-arcgis"],function(e,t){var o={},r={};return{setters:[function(e){o.AbstractDataAction=e.AbstractDataAction,o.AllDataSourceTypes=e.AllDataSourceTypes,o.DataLevel=e.DataLevel,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.MutableStoreManager=e.MutableStoreManager,o.getAppStore=e.getAppStore},function(){}],execute:function(){e((()=>{var e={62686:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=o}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,a),n.exports}a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var n={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(n),a.d(n,{default:()=>i});var e,t=a(79244);a(62686);!function(e){e.Closest="closest",e.Proximity="proximity",e.Summary="summary"}(e||(e={}));var o;!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(o||(o={}));var r=function(e,t,o,r){return new(o||(o=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(e){n(e)}}function u(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,u)}l((r=r.apply(e,t||[])).next())})};class i extends t.AbstractDataAction{constructor(){super(...arguments),this.supportProviderWidget=!0}isSupported(e,o){return r(this,void 0,void 0,function*(){var r,a,n,i,u,l,s,c,d,v,p;if(e.length>1)return Promise.resolve(!1);const f=e[0],g=f.dataSource,S=function(){var e,o,r;return window.jimuConfig.isBuilder?null===(o=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===o?void 0:o.appConfig:null===(r=(0,t.getAppStore)().getState())||void 0===r?void 0:r.appConfig}(),y=null===(r=null==S?void 0:S.widgets)||void 0===r?void 0:r[this.widgetId],m=null===(a=y.config)||void 0===a?void 0:a.configInfo;if(!m||0===Object.keys(m).length)return Promise.resolve(!1);let h=null===(l=null===(u=null===(n=null==S?void 0:S.widgets)||void 0===n?void 0:n[null===(i=y.useMapWidgetIds)||void 0===i?void 0:i[0]])||void 0===u?void 0:u.config)||void 0===l?void 0:l.initialMapDataSourceID;h||(h=Object.keys(m)[0]);const b=null===(c=null===(s=y.config)||void 0===s?void 0:s.configInfo)||void 0===c?void 0:c[h];if(!((null===(v=null===(d=null==b?void 0:b.analysisSettings)||void 0===d?void 0:d.layersInfo)||void 0===v?void 0:v.length)>0))return Promise.resolve(!1);if(null===(p=null==b?void 0:b.searchSettings)||void 0===p?void 0:p.searchByActiveMapArea)return Promise.resolve(!1);if(!g||g.getStatus()===t.DataSourceStatus.NotReady)return Promise.resolve(!1);return(null==g?void 0:g.supportSpatialInfo)&&(null==g?void 0:g.supportSpatialInfo())&&(f.records.length>0&&o===t.DataLevel.Records&&("current"===f.type||"selected"===f.type)||o===t.DataLevel.DataSource&&([t.AllDataSourceTypes.FeatureLayer].includes(f.dataSource.type)||[t.AllDataSourceTypes.SubtypeSublayer].includes(f.dataSource.type)))?Promise.resolve(!0):Promise.resolve(!1)})}onExecute(e,o){return r(this,void 0,void 0,function*(){const r=e[0],{records:a,dataSource:n}=r,i={},u={};let l,s="";if(o===t.DataLevel.DataSource)t.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedDataSource",n);else if((null==a?void 0:a.length)>0){if(a.forEach(e=>{var t;l||(l=e.feature.geometry.spatialReference.toJSON()),s=null===(t=null==e?void 0:e.dataSource)||void 0===t?void 0:t.id,i[s]||(i[s]=[]),e.hasFullGeometry?i[s].push(e.feature.geometry):(u[s]||(u[s]=[]),u[s].push(e.getId()))}),Object.keys(u).length){const e=yield((e,o)=>{const r=[],a={},n=Object.keys(e);return new Promise(i=>{n.forEach(a=>{const n=t.DataSourceManager.getInstance().getDataSource(a),i={};i.objectIds=e[a],i.returnGeometry=!0,i.returnFullGeometry=!0,i.returnZ=!0,i.outSR=o,r.push(n.query(i))}),Promise.all(r).then(e=>{e.forEach((e,t)=>{if((null==e?void 0:e.records.length)>0){const o=[];e.records.forEach(e=>{o.push(e.feature.geometry)}),a[n[t]]=o}}),i(a)})})})(u,l);Object.keys(e).forEach(t=>{i[t]?i[t]=[...i[t],...e[t]]:i[t]=e[t]})}t.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedIncidentLocation",i)}return Promise.resolve(!0)})}}})(),n})())}}});