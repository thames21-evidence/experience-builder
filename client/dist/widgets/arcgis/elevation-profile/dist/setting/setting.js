/*! For license information please see setting.js.LICENSE.txt */
System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-arcgis","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-ui/basic/color-picker","jimu-ui/advanced/map"],function(e,t){var i={},s={},a={},l={},n={},o={},r={},d={},p={},c={};return{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.defaultMessages=e.defaultMessages,s.focusElementInKeyboardMode=e.focusElementInKeyboardMode,s.getAppStore=e.getAppStore,s.lodash=e.lodash,s.polished=e.polished,s.urlUtils=e.urlUtils},function(e){a.Alert=e.Alert,a.AlertPopup=e.AlertPopup,a.Button=e.Button,a.Checkbox=e.Checkbox,a.CollapsablePanel=e.CollapsablePanel,a.Icon=e.Icon,a.Label=e.Label,a.Loading=e.Loading,a.LoadingType=e.LoadingType,a.NumericInput=e.NumericInput,a.Option=e.Option,a.Radio=e.Radio,a.Select=e.Select,a.Switch=e.Switch,a.TextArea=e.TextArea,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){l.MapWidgetSelector=e.MapWidgetSelector,l.MultipleJimuMapConfig=e.MultipleJimuMapConfig,l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection,l.SidePopper=e.SidePopper},function(e){n.BaseWidgetSetting=e.BaseWidgetSetting},function(e){o.MapViewManager=e.MapViewManager,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.List=e.List,r.TreeItemActionType=e.TreeItemActionType},function(e){d.AllDataSourceTypes=e.AllDataSourceTypes,d.DataSourceSelector=e.DataSourceSelector,d.FieldSelector=e.FieldSelector},function(e){p.ColorPicker=e.ColorPicker},function(e){c.JimuSymbolType=e.JimuSymbolType,c.SymbolSelector=e.SymbolSelector}],execute:function(){e((()=>{var e={928:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="#FFF" viewBox="0 0 28 28"><path d="M0 0v28h28V0z"></path></svg>'},4108:e=>{"use strict";e.exports=n},13089:e=>{"use strict";e.exports=d},14321:e=>{"use strict";e.exports=a},18109:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 46 1"><path fill="#fff" fill-rule="evenodd" d="M46 1H0V0h46z" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},27348:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="#FFF" viewBox="0 0 35 28"><path d="M0 0h35v28H0z"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},46942:(e,t)=>{var i;!function(){"use strict";var s={}.hasOwnProperty;function a(){for(var e="",t=0;t<arguments.length;t++){var i=arguments[t];i&&(e=n(e,l(i)))}return e}function l(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return a.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var i in e)s.call(e,i)&&e[i]&&(t=n(t,i));return t}function n(e,t){return t?e?e+" "+t:e+t:e}e.exports?(a.default=a,e.exports=a):void 0===(i=function(){return a}.apply(t,[]))||(e.exports=i)}()},48993:e=>{"use strict";e.exports=c},54337:e=>{"use strict";e.exports=p},54344:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 46 1"><path fill="#fff" fill-rule="evenodd" d="M0 1h1V0H0zm6 0h1V0H6zm7 0h-1V0h1zm5 0h1V0h-1zm7 0h-1V0h1zm5 0h1V0h-1zm7 0h-1V0h1zM3 1h1V0H3zm7 0H9V0h1zm5 0h1V0h-1zm7 0h-1V0h1zm5 0h1V0h-1zm7 0h-1V0h1zm5 0h1V0h-1zm4 0h-1V0h1zm2 0h1V0h-1z" clip-rule="evenodd"></path></svg>'},58825:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 512.055 512.055"><path d="M502.893 503.853H7.96L255.427 8.919z" style="fill:#fff"></path><path d="M502.893 512.386H7.96c-2.56 0-5.973-1.707-7.68-4.267s-1.707-5.973 0-8.533L247.747 4.653c2.56-5.973 11.947-5.973 15.36 0l247.467 494.933c1.707 2.56.853 5.973 0 8.533-.854 2.56-5.121 4.267-7.681 4.267m-481.28-17.067H489.24L255.427 27.693z" style="fill:#fff"></path></svg>'},62686:e=>{"use strict";e.exports=o},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},66633:(e,t,i)=>{var s={"./circle.svg":98829,"./dashed-line.svg":75218,"./dotted-line.svg":54344,"./rectangle.svg":27348,"./solid-line.svg":18109,"./square.svg":928,"./triangle.svg":58825};function a(e){var t=l(e);return i(t)}function l(e){if(!i.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}a.keys=function(){return Object.keys(s)},a.resolve=l,e.exports=a,a.id=66633},67386:e=>{"use strict";e.exports=i},75218:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 46 1"><path fill="#fff" d="M0 1h3V0H0zM6 1h3V0H6zM15 1h-3V0h3zM18 1h3V0h-3zM27 1h-3V0h3zM30 1h3V0h-3zM39 1h-3V0h3zM42 1h4V0h-4z"></path></svg>'},79244:e=>{"use strict";e.exports=s},79298:e=>{"use strict";e.exports=l},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},98640:e=>{"use strict";e.exports=r},98829:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="#FFF"><circle cx="6" cy="6" r="6"></circle></svg>'}},t={};function h(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,h),a.exports}h.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return h.d(t,{a:t}),t},h.d=(e,t)=>{for(var i in t)h.o(t,i)&&!h.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},h.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),h.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},h.p="";var g={};return h.p=window.jimuConfig.baseUrl,(()=>{"use strict";h.r(g),h.d(g,{__set_webpack_public_path__:()=>He,default:()=>_e});var e=h(67386),t=h(79244),i=h(14321),s=h(79298),a=h(4108),l=h(62686);const n={warningMsgToSelectMap:"A Map widget must be selected to generate an elevation profile.",dataConfigLabel:"Map Settings",keepResultsWhenClosed:"Keep results when closed",keepResultsWhenClosedTooltip:"The elevation profile will not be cleared when the widget is closed or hidden.",warningMsgIfDefaultDs:"The Map widget does not contain a web map or web scene. Draw on the default web map to view ground elevation.",dataConfigTooltip:"Click a map below to customize the elevation profile settings.",generalSettingsLabel:"General Settings",allowExportLabel:"Allow export",activateToolOnLoadLabel:"Activate when widget opens",activateToolOnLoadTooltip:"Activate the select or the draw tool automatically when the widget opens.",selectTool:"Select line",drawTool:"Draw profile",appearanceCollapsible:"Appearance",showChartGridsLabel:"Graph grids",showChartAxisTitlesLabel:"Graph axis titles",showLegend:"Legend",elevationLayers:"Elevation Layers",newLayerLabel:"New layer",noGroundLayerInfoMessage:"A reference layer is required to view profiles for Selectable and Intersecting layers.",setGroundLayer:"Set reference layer",groundLayer:"Reference layer",setGroundLayerTooltip:"The layer used as a base reference to draw all profiles.",addElevationLayer:"Add Elevation Layer",selectLayerTooltip:"The selected layer must a valid Elevation Layer or a tiled elevation service.",selectLayerLabel:"Select layer",emptyLabelWarning:"Label is required",groundLayerInfoTooltip:"The reference layer cannot be removed. Change the reference layer before removing this layer.",elevationLayerStyleTooltip:"Customize the style to display this elevation layer in the profile graph.",measurementUnitsHeadingLabel:"Display units",measurementUnitsHeadingTooltip:"Units used to convert and display values in the profile graph.",distanceUnitLabel:"Distance",elevationUnitLabel:"Elevation",displayGroundProfileStatsLabel:"Show profile statistics",volumetricObjectsLabel:"Volumetric objects",volumetricObjectsTooltip:"Generate elevation profile for Scene Layers, Integrated Mesh Layers and layers with volumetric 3D symbols. This is only supported in web scenes.",viewLineColor:"Line color",profileSettingsLabel:"Selectable Layers",noLineLayersMessage:"The web map or web scene does not contain any line layers to select.",selectableLayersLabel:"Customize selectable line layers",selectableLayersTooltip:"Add line layers from the web map or scene. Click a layer from the list to open the settings pane.",selectableLayersWarning:"No selectable layers are defined. Choose line layers from the map that can be selected to generate a profile.",chooseHighlightColor:"Map selection color",nextSelectableOptionLabel:"Highlight next selectable",selectionModeLabel:"Selection mode",nextSelectableTooltip:"Single \u2013 Selection is restricted to a single segment at a time for generating an elevation profile. Multiple \u2013 Select multiple line segments that connect at the start or end point.",singleSelectionMode:"Single",multipleSelectionMode:"Multiple",supportAddedLayers:"Select from added layers",supportAddedLayersTooltip:"Support selecting lines from layers added to the map using the Add Data widget.",distanceSettingLabel:"Distance Settings",distanceSettingsWarning:"These options are no longer available. The map projection is used to display and calculate an accurate topologic representation of distance values in the chart.",mapProjection:"Map Projection",sourceField:"Field",styleLineTooltip:"Customize the style to display in the profile graph for all selected lines from this layer.",assetSettingsLabel:"Intersecting Layers",noLinePointLayersMessage:"The web map or web scene does not contain any point or line layers to intersect.",intersectingLayersLabel:"Customize intersecting layers",intersectingLayersTooltip:"Add point or line layers from the web map or scene. Click a layer from the list to open the settings pane. Point or line features intersecting with the profile will be displayed on the graph.",intersectingLayersWarning:"No intersecting layers are defined. Choose point and line layers to display features that intersect with the profile.",intersectingBufferSettingsLabel:"Buffer",intersectingBufferSettingsTooltip:"Features are represented on the graph at their points of intersection with the buffer area. Connected points are used to represent traversing lines and points with two-field elevation.",displayFieldLabel:"Display Field",displayFieldTooltip:"The field value to be displayed on hover for each asset from this layer represented in the graph.",stylePointTooltip:"Point features from this layer that are intersecting with the profile will be displayed on the graph as markers at the point of intersection.",symbology:"Symbology",mapLabel:"Map",customLabel:"Custom",styleColor:"Style color",styleShape:"Style shape",styleSize:"Style size",assetTriangle:"Triangle",assetRectangle:"Rectangle",assetCircle:"Circle",assetSquare:"Square",profileRendering:"Profile rendering",profileRenderingTooltip:"Display selected line features on the ground or customize selectable layers and their elevation settings",groundElevation:"Ground elevation",groundElevationHint:"All line layers are selectable and their profile will display on the ground.",customizeSelectableLayersLabel:"Customize",selectableButton:"Choose Layer",styleLabel:"Style",valueType:"Elevation value",meters:"Meters",feet:"Feet",kilometers:"Kilometers",miles:"Miles",yards:"Yards",maxDistance:"MAX Distance",minElevation:"MIN Elevation",maxElevation:"MAX Elevation",avgElevation:"AVG Elevation",elevationGain:"Elevation Gain",elevationLoss:"Elevation Loss",maxPositiveSlope:"MAX Positive Slope",maxNegativeSlope:"MAX Negative Slope",avgPositiveSlope:"AVG Positive Slope",avgNegativeSlope:"AVG Negative Slope",noElevationHint:"Hint: Features with no elevation will display on the ground.",noVerticalParamHint:"Hint: No unit defined for vertical Z value in the layer, ground spatial reference unit will be used.",matchProfileHint:"Hint: Features will be represented along the profile with matching elevation values.",elevationSettingLabel:"Elevation Settings",elevationSettingTooltip:"Select how the elevation for a selected line is calculated using the elevation layer defined in the Profile Settings or using up to two field values.",elevationSettingIntersectingTooltip:"Select how the elevation for an intersecting feature is calculated using the elevation layer defined in the Profile Settings or using up to two field values.",noElevation:"No Elevation",zValue:"Z Value",noSelectionItemLabel:"- Select -",oneField:"One Field",twoField:"Two Fields",oneFieldLabel:"Field 1",twoFieldLabel:"Field 2",matchProfile:"Match Profile",valueUnit:"Units",legendLabel:"Legend",legendTooltip:"Legend",statsDisplayLabel:"Layer Statistics",statisticsListLabel:"Customize statistics",statisticsListTooltip:"Customize the display and order of the profile statistics.",deleteLayer:"Delete",backButton:"Back",alert:"Add Layer",alreadySelectedLayerMsg:"This layer is already added to the list."};function o(e){return t.css`
    .selectOption {
      width: 114px;
    }

    .color-label {
      color: ${e.ref.palette.neutral[900]};
    }

    .hidden {
      display: none;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .ep-tooltip {
      margin-right: 0.30rem!important;
    }

    .ep-divider-top {
      border-top: 1px solid var(--ref-palette-neutral-700)
    }

    .ep-layers-list {
      width: 100%;

      .layer-data-item {
        padding: 4px 2px 4px 2px;
      }

      .layer-data-item-name {
        font-size: ${t.polished.rem(14)};
        font-weight: 400;
        width: 145px;
      }

      .layer-type-name {
        font-size: ${t.polished.rem(13)};
        padding-top: 8px;
        width: 150px;
      }
    }
  `}function r(e){return t.css`
    .hidden {
      display: none;
    }

    .color-label {
      color: ${e.ref.palette.neutral[900]};
    }

    .hint {
      font-style: italic;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .fieldSelectorWidth {
      max-width: 110px;
    }

    .fieldLabel {
      width: 93px;
    }

    .selectOption {
      width: 110px;
    }

    .warningMsg {
      width: auto;
    }

    .ep-label {
      max-width: 80%;
      display: inline-block;
      margin-bottom: 0;
      margin-right: 20px;
    }

    .jimu-widget-setting--row-label:not(.form-inline) {
      max-width: none;
    }

    .ep-layers-list {
      width: 100%;

      .layer-data-item {
        display: flex;
        flex: 1;
        padding: ${t.polished.rem(7)} 0.25rem;
        cursor: pointer;

        .layer-data-item-name {
          overflow: hidden;
          text-overflow: ellipsis;
          display: -webkit-box;
          -webkit-box-orient: vertical;
          word-break: break-word;
          -webkit-line-clamp: 2;
          padding: 2px;
          line-height: 1.3;
        }
      }
    }

    .ep-data-source-selector {
      .ds-item {
        display: none;
      }
    }

    .tooltip-color {
      color: var(--ref-palette-neutral-1100);
    }

    .ep-divider-top {
      border-top: 1px solid var(--ref-palette-neutral-700)
    }
  `}function d(e){return t.css`
    position: absolute;
    top: 0;
    bottom: 0;
    width: 259px;
    height: 100%;
    padding-bottom: 1px;
    border-right: 1px solid ${e.ref.palette.white};
    border-bottom: 1px solid ${e.ref.palette.white};

    .setting-container {
      height: calc(100% - 52px);
      overflow: auto;
    }
`}var p,c=function(e,t,i,s){return new(i||(i=Promise))(function(a,l){function n(e){try{r(s.next(e))}catch(e){l(e)}}function o(e){try{r(s.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,o)}r((s=s.apply(e,t||[])).next())})};function u(e){const i=(e,s)=>{const a=(null==e?void 0:e.isDataSourceSet())&&(null==e?void 0:e.getChildDataSources());a&&a.forEach(e=>{(null==e?void 0:e.isDataSourceSet())?i(e,s):(null==e?void 0:e.type)!==t.DataSourceTypes.FeatureLayer&&(null==e?void 0:e.type)!==t.DataSourceTypes.SubtypeSublayer||s.push(e)})},s=[],a=t.DataSourceManager.getInstance(),l=null==a?void 0:a.getDataSource(e);return i(l,s),s}function v(e,t){var i,s,a,l;let n=null===(i=null==e?void 0:e.elevationLayersSettings)||void 0===i?void 0:i.elevationUnit,o=null===(s=null==e?void 0:e.elevationLayersSettings)||void 0===s?void 0:s.linearUnit;return(null===(a=null==e?void 0:e.elevationLayersSettings)||void 0===a?void 0:a.elevationUnit)||(n="english"===(null==t?void 0:t.units)?"feet":"meters"),(null===(l=null==e?void 0:e.elevationLayersSettings)||void 0===l?void 0:l.linearUnit)||(o="english"===(null==t?void 0:t.units)?"miles":"kilometers"),[n,o]}function m(){return"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(p||(p={}));const y=e=>{switch(e){case"feet":return p.Feet;case"miles":return p.Miles;case"kilometers":return p.Kilometers;case"meters":return p.Meters;case"yards":return p.Yards;default:return 1e3}},f=e=>"english"===(null==e?void 0:e.units)?"feet":"meters",S=(e,t,i)=>(i||(i=[]),null==t||t.forEach(t=>{const s=i.filter(e=>e.dataSourceId===t.layerId),a=(null==s?void 0:s.length)>0?s[0]:{dataSourceId:t.layerId,mainDataSourceId:t.layerId,rootDataSourceId:e,fields:[]};("one"===t.elevationSettings.type||"two"===t.elevationSettings.type)&&t.elevationSettings.field1&&!a.fields.includes(t.elevationSettings.field1)&&a.fields.push(t.elevationSettings.field1),"two"===t.elevationSettings.type&&t.elevationSettings.field2&&!a.fields.includes(t.elevationSettings.field2)&&a.fields.push(t.elevationSettings.field2),t.displayField&&!a.fields.includes(t.displayField)&&a.fields.push(t.displayField),0===s.length&&i.push(a)}),i),b=e=>{var t,i,s;let a=[];for(const l in e)(null===(t=e[l].profileSettings.layers)||void 0===t?void 0:t.length)>0&&(a=S(l,e[l].profileSettings.layers,a)),(null===(s=null===(i=e[l].assetSettings)||void 0===i?void 0:i.layers)||void 0===s?void 0:s.length)>0&&(a=S(l,e[l].assetSettings.layers,a));return a},x=()=>`${Math.random()}`.slice(2).toString()+Date.now(),L=h(45508),w=h(62838),I=h(37568),j=()=>({epConfigIcon:{infoIcon:L,iconClose:w,iconBack:I}});var D;!function(e){e.Single="single",e.Multiple="multiple"}(D||(D={}));const C="https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",T=[{value:"meters"},{value:"feet"},{value:"kilometers"},{value:"miles"},{value:"yards"}],O=[{value:"no elevation",name:"noElevation"},{value:"z",name:"zValue"},{value:"one",name:"oneField"},{value:"two",name:"twoField"}],M=[{value:"no elevation",name:"noElevation"},{value:"one",name:"oneField"},{value:"two",name:"twoField"}],A=[{value:"no elevation",name:"noElevation"},{value:"z",name:"zValue"},{value:"one",name:"oneField"},{value:"two",name:"twoField"},{value:"match profile",name:"matchProfile"}],N=[{value:"no elevation",name:"noElevation"},{value:"one",name:"oneField"},{value:"two",name:"twoField"},{value:"match profile",name:"matchProfile"}],E=[{value:"map",name:"mapLabel"},{value:"custom",name:"customLabel"}],P=[{value:"maxDistance",label:n.maxDistance},{value:"minElevation",label:n.minElevation},{value:"maxElevation",label:n.maxElevation},{value:"avgElevation",label:n.avgElevation},{value:"elevationGain",label:n.elevationGain},{value:"elevationLoss",label:n.elevationLoss},{value:"maxPositiveSlope",label:n.maxPositiveSlope},{value:"maxNegativeSlope",label:n.maxNegativeSlope},{value:"avgPositiveSlope",label:n.avgPositiveSlope},{value:"avgNegativeSlope",label:n.avgNegativeSlope}],k=[{value:"none",name:"none"},{value:"select line",name:"selectTool"},{value:"draw profile",name:"drawTool"}],F=[{value:"single",name:"singleSelectionMode"},{value:"multiple",name:"multipleSelectionMode"}],R=[{label:"#00FFFF",value:"#00FFFF",color:"#00FFFF"},{label:"#FF9F0A",value:"#FF9F0A",color:"#FF9F0A"},{label:"#089BDC",value:"#089BDC",color:"#089BDC"},{label:"#FFD159",value:"#FFD159",color:"#FFD159"},{label:"#74B566",value:"#74B566",color:"#74B566"},{label:"#FF453A",value:"#FF453A",color:"#FF453A"},{label:"#9868ED",value:"#9868ED",color:"#9868ED"},{label:"#43ABEB",value:"#43ABEB",color:"#43ABEB"}],U={elevationLayersSettings:{addedElevationLayers:[],groundLayerId:"",linearUnit:"",elevationUnit:"",showVolumetricObjLineInGraph:!0,volumetricObjSettingsOptions:{id:x(),style:{lineType:"solid-line",lineColor:"#cf4ccf",lineThickness:2},volumetricObjLabel:n.volumetricObjectsLabel,displayStatistics:!0,selectedStatistics:[]}},profileSettings:{isProfileSettingsEnabled:!1,isCustomizeOptionEnabled:!1,layers:[],selectionModeOptions:{selectionMode:"multiple",style:{lineType:"dotted-line",lineColor:"#fcfc03",lineThickness:3}},supportAddedLayers:!1},assetSettings:{isAssetSettingsEnabled:!1,layers:[],assetIntersectingBuffer:{enabled:!1,bufferDistance:10,bufferUnits:"",bufferSymbol:{type:"esriSFS",color:[239,132,38,128],outline:{type:"esriSLS",color:[184,115,59,255],width:1.5,style:"esriSLSSolid"},style:"esriSFSSolid"}}}},V={lineType:"solid-line",lineColor:"#b54900",lineThickness:2},B={id:"",useDataSource:null,label:"",elevationLayerUrl:"",style:V,displayStatistics:!1,selectedStatistics:[]},z={layerId:"",elevationSettings:{type:"",unit:"",field1:"",field2:""},distanceSettings:{type:"map",field:"",unit:""},style:{lineType:"solid-line",lineColor:"",lineThickness:3}},W={layerId:"",elevationSettings:{type:"",unit:"",field1:"",field2:""},displayField:"",style:{type:"custom",intersectingAssetShape:"",intersectingAssetSize:0,intersectingAssetColor:""}},G=[{value:"solid-line",label:"solid"},{value:"dotted-line",label:"dotted"},{value:"dashed-line",label:"dashed"}],_=[{value:"triangle",label:"assetTriangle"},{value:"rectangle",label:"assetRectangle"},{value:"circle",label:"assetCircle"},{value:"square",label:"assetSquare"}];var H=h(98640),J=h(13089),q=h(54337);class K extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidUpdate=e=>{const t=this.props.config;e.config.lineColor!==t.lineColor?this.setState({lineColor:t.lineColor}):e.config.lineType!==t.lineType?this.setState({lineType:t.lineType}):e.config.lineThickness!==t.lineThickness&&this.setState({lineThickness:t.lineThickness})},this.onLineColorChange=e=>{this.setState({lineColor:e}),this.props.onLineStyleChange(this.props.lineItem,"lineColor",e)},this.onlineTypeChange=e=>{this.setState({lineType:e.currentTarget.value}),this.props.onLineStyleChange(this.props.lineItem,"lineType",e.currentTarget.value)},this.onLineThicknessChange=e=>{null!==e&&(this.setState({lineThickness:e}),this.props.onLineStyleChange(this.props.lineItem,"lineThickness",e))};const t=this.props.config;this.state={lineColor:t.hasOwnProperty("lineColor")?t.lineColor:"#049546",lineType:t.hasOwnProperty("lineType")?t.lineType:"dashed-line",lineThickness:t.hasOwnProperty("lineThickness")?t.lineThickness:2}}render(){return(0,e.jsx)("div",{children:(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(q.ColorPicker,{"aria-label":this.nls("styleColor"),className:"mr-2",width:"54px",height:"26px",offset:[0,0],presetColors:this.props.isNextSelectable?R:void 0,placement:"auto",showArrow:!0,color:this.state.lineColor?this.state.lineColor:"#FFFFFF",onChange:this.onLineColorChange}),(0,e.jsx)(i.Select,{"aria-label":this.nls("styleShape")+this.state.lineType,size:"sm",name:"linePicker",value:this.state.lineType,onChange:this.onlineTypeChange,children:G.map((t,s)=>{const a=h(66633)(`./${t.value}.svg`);return(0,e.jsx)(i.Option,{role:"option","aria-label":t.label,value:t.value,title:this.nls(t.label),children:(0,e.jsx)(i.Icon,{width:60,height:12,icon:a})},s)})}),(0,e.jsx)(i.NumericInput,{"aria-label":this.nls("styleSize"),size:"sm",className:"ml-2",min:1,max:20,value:this.state.lineThickness,onChange:this.onLineThicknessChange})]})})}}const{epConfigIcon:$}=j();class Z extends t.React.PureComponent{constructor(e){super(e),this._defaultSelectedItem={name:""},this.componentDidUpdate=e=>{e.config.elevationSettings.field1!==this.props.config.elevationSettings.field1?this.setState({oneFields:""===this.props.config.elevationSettings.field1?[]:[this.props.config.elevationSettings.field1]}):e.config.elevationSettings.field2!==this.props.config.elevationSettings.field2?this.setState({twoFields:""===this.props.config.elevationSettings.field2?[]:[this.props.config.elevationSettings.field2]}):e.config.elevationSettings.type!==this.props.config.elevationSettings.type?this.setState({elevationType:this.props.config.elevationSettings.type}):e.config.elevationSettings.unit!==this.props.config.elevationSettings.unit?this.setState({elevationUnits:this.props.config.elevationSettings.unit}):t.lodash.isDeepEqual(e.config.style,this.props.config.style)||this.setState({style:this.props.config.style})},this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.onElevationValueChange=e=>{this.setState({elevationType:e.target.value},()=>{this.props.updateProfileSettings("elevationSettings","type",this.state.elevationType)})},this.onElevationValueUnitChange=e=>{this.setState({elevationUnits:e.target.value},()=>{this.props.updateProfileSettings("elevationSettings","unit",this.state.elevationUnits)})},this.updateLineStyle=(e,t,i)=>{const s={lineType:"lineType"===t?i:this.props.config.style.lineType,lineColor:"lineColor"===t?i:this.props.config.style.lineColor,lineThickness:"lineThickness"===t?i:this.props.config.style.lineThickness};this.setState({style:s},()=>{this.props.updateProfileSettings(e,t,i)})},this.onOneFieldSelect=e=>{0===e.length?(this.setState({oneFields:[]}),this.props.updateProfileSettings("elevationSettings","field1","")):(this.setState({oneFields:[e[0].jimuName]}),this.props.updateProfileSettings("elevationSettings","field1",e[0].jimuName))},this.onTwoFieldSelect=e=>{0===e.length?(this.setState({twoFields:[]}),this.props.updateProfileSettings("elevationSettings","field2","")):(this.setState({twoFields:[e[0].jimuName]}),this.props.updateProfileSettings("elevationSettings","field2",e[0].jimuName))},this.props.hasSupportForZValue?this.elevationTypeOptions=O:this.elevationTypeOptions=M,this._defaultSelectedItem.name=this.nls("noSelectionItemLabel"),this.state={oneFields:""===this.props.config.elevationSettings.field1?[]:[this.props.config.elevationSettings.field1],twoFields:""===this.props.config.elevationSettings.field2?[]:[this.props.config.elevationSettings.field2],elevationType:this.props.config.elevationSettings.type,elevationUnits:this.props.config.elevationSettings.unit,style:this.props.config.style}}render(){let a;return"no elevation"===this.state.elevationType?a=this.nls("noElevationHint"):"z"===this.state.elevationType&&(a=this.nls("noVerticalParamHint")),(0,e.jsx)("div",{style:{height:"100%",width:"100%"},css:r(this.props.theme),children:(0,e.jsxs)(s.SettingSection,{children:[(0,e.jsxs)(s.SettingRow,{className:"pt-1",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("elevationSettingLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label title2 hint-paper",children:this.nls("elevationSettingLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("elevationSettingTooltip"),title:this.nls("elevationSettingTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:$.infoIcon})})})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("valueType"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("valueType")})}),(0,e.jsx)(i.Select,{"aria-label":this.state.elevationType,className:"selectOption",name:"elevationValueType",size:"sm",value:this.state.elevationType,onChange:this.onElevationValueChange,children:this.elevationTypeOptions.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.name)},s))})]}),(0,e.jsxs)(s.SettingRow,{className:"one"===this.state.elevationType||"two"===this.state.elevationType?"":"hidden",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("oneFieldLabel"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("oneFieldLabel")})}),(0,e.jsx)(J.FieldSelector,{className:"fieldSelectorWidth",dataSources:[this.props.selectedLayerDataSource.layer],onChange:this.onOneFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.oneFields),isMultiple:!1,types:(0,t.Immutable)([t.JimuFieldType.Number]),noSelectionItem:this._defaultSelectedItem})]}),(0,e.jsxs)(s.SettingRow,{className:"two"===this.state.elevationType?"":"hidden",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("twoFieldLabel"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("twoFieldLabel")})}),(0,e.jsx)(J.FieldSelector,{className:"fieldSelectorWidth",dataSources:[this.props.selectedLayerDataSource.layer],onChange:this.onTwoFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.twoFields),types:(0,t.Immutable)([t.JimuFieldType.Number]),isMultiple:!1,noSelectionItem:this._defaultSelectedItem})]}),(0,e.jsx)(s.SettingRow,{className:"no elevation"===this.state.elevationType||"z"===this.state.elevationType&&!this.props.hasVerticalUnit?"hint":"hidden",children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":a,className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:a})})}),(0,e.jsxs)(s.SettingRow,{className:"no elevation"===this.state.elevationType||"z"===this.state.elevationType?"hidden":"",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("valueUnit"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("valueUnit")})}),(0,e.jsx)(i.Select,{"aria-label":this.state.elevationUnits,className:"selectOption",name:"valueunit",size:"sm",value:this.state.elevationUnits,onChange:this.onElevationValueUnitChange,children:T.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.value)},s))})]}),"map"!==this.props.config.distanceSettings.type&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingRow,{className:"pt-4 ep-divider-top",children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("distanceSettingLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label title2 hint-paper",children:this.nls("distanceSettingLabel")})})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)("div",{title:this.nls("distanceSettingsWarning"),children:(0,e.jsx)(i.Alert,{tabIndex:0,className:"warningMsg py-1",text:this.nls("distanceSettingsWarning"),type:"info"})})})]}),(0,e.jsxs)(s.SettingRow,{className:"pt-4 ep-divider-top",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("styleLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label title2 hint-paper",children:this.nls("styleLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("styleLineTooltip"),title:this.nls("styleLineTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:$.infoIcon})})})]}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(K,{intl:this.props.intl,lineItem:"style",onLineStyleChange:this.updateLineStyle,config:this.state.style})})]})})}}const{epConfigIcon:X}=j();class Y extends t.React.PureComponent{constructor(){super(...arguments),this.backRef=t.React.createRef(),this.nls=e=>{const s=Object.assign({},n,i.defaultMessages,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.backRefFocus=()=>{setTimeout(()=>{var e;(0,t.focusElementInKeyboardMode)(null===(e=this.backRef)||void 0===e?void 0:e.current)},50)},this.onOkButtonClick=()=>{this.props.onOkButtonClicked()}}getStyle(e){var i,s;return t.css`
      .setting-header {
        padding: ${t.polished.rem(18)} ${t.polished.rem(16)} ${t.polished.rem(0)} ${t.polished.rem(16)}
      }

      .setting-title {
        font-size: ${t.polished.rem(16)};
        color: ${null===(s=null===(i=null==e?void 0:e.ref.palette)||void 0===i?void 0:i.neutral)||void 0===s?void 0:s[1e3]}
      }

      .commonOkButton {
        padding: 9px 17px 0px 17px;
      }

      .hideCursorPointer {
        cursor: default;
      }
    `}render(){return(0,e.jsxs)("div",{tabIndex:-1,className:"w-100 h-100",css:this.getStyle(this.props.theme),children:[(0,e.jsxs)("div",{tabIndex:-1,className:"w-100 d-flex align-items-center justify-content-between setting-header border-0",style:{height:"38px"},children:[this.props.hideBackArrow?(0,e.jsx)("div",{"aria-label":this.props.title,tabIndex:0,className:"setting-title mt-1",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title,children:this.props.title}):(0,e.jsx)("div",{tabIndex:-1,className:"h-100",children:(0,e.jsxs)("div",{ref:this.backRef,tabIndex:0,className:"d-flex align-items-center h-100",style:{cursor:"pointer"},onClick:this.props.onBack,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.props.onBack()},children:[(0,e.jsx)("div",{className:"d-flex align-items-center",title:this.nls("backButton"),"aria-label":this.nls("backButton"),children:(0,e.jsx)(i.Icon,{icon:X.iconBack,autoFlip:!0,size:"14",className:"text-default"})}),(0,e.jsx)("div",{"aria-label":this.props.title,className:"pl-2 setting-title",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title,children:this.props.title})]})}),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("close"),title:this.nls("close"),size:"sm",icon:!0,type:"tertiary",onClick:this.props.onBack,children:(0,e.jsx)(i.Icon,{icon:X.iconClose,size:"16"})})]}),this.props.children,this.props.showOkButton&&(0,e.jsx)("div",{className:"commonOkButton",children:(0,e.jsx)(i.Button,{role:"button",className:(0,t.classNames)("w-100 text-dark",this.props.disableOkButton?"hideCursorPointer":""),type:"primary",disabled:this.props.disableOkButton,onClick:this.onOkButtonClick.bind(this),"data-testid":"commonModalOk",children:this.nls("commonModalOk")})})]})}}const{epConfigIcon:Q}=j(),ee=(0,t.getAppStore)().getState().portalSelf;class te extends t.React.PureComponent{constructor(s){super(s),this.supportedDsTypes=(0,t.Immutable)([t.DataSourceTypes.FeatureLayer,t.DataSourceTypes.SubtypeSublayer,t.DataSourceTypes.SceneLayer]),this.mvManager=l.MapViewManager.getInstance(),this.selectedLayerDataSource=null,this.layerSidePopperTrigger=t.React.createRef(),this.backRef=t.React.createRef(),this.allSelectedLayers=[],this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{var e;(null===(e=this.props.config)||void 0===e?void 0:e.layers)&&(this.props.config.layers.forEach((e,t)=>{this.getLayerListProperty(e.layerId)}),this.setState({selectedLayers:this.allSelectedLayers}))},this.componentDidUpdate=e=>{var i,s;t.lodash.isDeepEqual(null===(i=this.props.config)||void 0===i?void 0:i.layers,null===(s=e.config)||void 0===s?void 0:s.layers)||(this.allSelectedLayers=[],this.props.config.layers.forEach((e,t)=>{this.getLayerListProperty(e.layerId)}),this.setState({selectedLayers:this.allSelectedLayers}))},this.getLayerListProperty=e=>{const i=t.DataSourceManager.getInstance().getDataSource(e);if(i){const e={label:i.getLabel(),layer:{id:i.id}};this.allSelectedLayers.push(e)}},this.getDsRootIdsByWidgetId=()=>{var e,i;const s=[],a=(null===(i=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===i?void 0:i.appConfig).dataSources[this.props.activeDataSource];return(null==a?void 0:a.type)!==t.DataSourceTypes.WebMap&&(null==a?void 0:a.type)!==t.DataSourceTypes.WebScene||s.push(this.props.activeDataSource),s.length>0?(0,t.Immutable)(s):void 0},this.dataSourceChangeSave=e=>{if(!e)return;let t=!1;if(this.allSelectedLayers.some(i=>{if(i.layer.id===e[0].dataSourceId)return t=!0,this.setState({isAlertMsgPopupOpen:!0}),!0}),!t){e.forEach((e,t)=>{this.getLayerListProperty(e.dataSourceId)}),this.setState({selectedLayers:this.allSelectedLayers,selectedLayerIndex:this.allSelectedLayers.length}),this.updateLayersConfig=this.getLayersDefaultSettings(this.allSelectedLayers);const t=[...this.props.config.layers,this.updateLayersConfig[0]];this.props.onProfileSettingsUpdated("profileSettings",this.props.activeDataSource,null,null,t,!0)}},this.getLayersDefaultSettings=e=>{let t=[];return 0===this.props.config.layers.length?e.forEach((e,i)=>{t=this.getProfileDefaultConfigOnAdd(e.layer)}):e.forEach(e=>{this.isLayerAlreadyConfigured(e.layer.id)||(t=this.getProfileDefaultConfigOnAdd(e.layer))}),t},this.isLayerAlreadyConfigured=e=>{let t=!1;return this.props.config.layers.forEach(i=>{if(e===i.layerId)return t=!0,!0}),t},this.showLayerData=(e,i)=>{var s,a,l,n,o;this.setSidePopperAnchor(i),this.setState({showLayerDataItemPanel:!0,layerName:e.label,selectedLayerIndex:i},()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()});const r=t.DataSourceManager.getInstance().getDataSource(e.layer.id);this.selectedLayerDataSource={dataSourceId:r.id,rootDataSourceId:r.parentDataSource.id,layer:r},this.dsId=r.id,this.selectedLayerConfig=this.getSelectedLayerConfig(r.id),this.hasSupportForZValue=null===(s=null==r?void 0:r.layerDefinition)||void 0===s?void 0:s.hasZ,this._hasVerticalUnitParam=(null===(l=null===(a=null==r?void 0:r.layerDefinition)||void 0===a?void 0:a.sourceSpatialReference)||void 0===l?void 0:l.vcsWkid)||(null===(o=null===(n=null==r?void 0:r.layerDefinition)||void 0===n?void 0:n.sourceSpatialReference)||void 0===o?void 0:o.vcsWkt)},this.getSelectedLayerConfig=e=>{var t,i;let s;return null===(i=null===(t=this.props.config)||void 0===t?void 0:t.layers)||void 0===i||i.forEach(t=>{e===t.layerId&&(s=t)}),s},this.removeLayerDataItem=(e,t,i)=>{var s,a;e.stopPropagation();const l=this.state.selectedLayers;l.splice(t,1),this.allSelectedLayers=l,this.setState({selectedLayers:this.allSelectedLayers,selectedLayerIndex:t},()=>{this.setSidePopperAnchor(t),this.setState({selectedLayerIndex:null})}),null===(a=null===(s=this.props.config)||void 0===s?void 0:s.layers)||void 0===a||a.forEach((e,t)=>{if((null==e?void 0:e.layerId)===i){const e=this.props.config.layers.asMutable({deep:!0});e.splice(t,1),this.updateLayersConfig=e,this.props.onProfileSettingsUpdated("profileSettings",this.props.activeDataSource,null,null,this.updateLayersConfig,!0)}})},this.createLayerElement=(t,s)=>(0,e.jsxs)("div",{"aria-label":t.label,tabIndex:0,className:"layer-data-item align-items-center",children:[(0,e.jsx)("div",{className:"layer-data-item-name flex-grow-1",title:t.label,children:t.label}),(0,e.jsx)(i.Button,{role:"button",title:this.nls("deleteLayer"),"aria-label":this.nls("deleteLayer"),size:"sm",type:"tertiary",icon:!0,className:"p-0",onClick:e=>{this.removeLayerDataItem(e,s,t.layer.id)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.removeLayerDataItem(e,s,t.layer.id)},children:(0,e.jsx)(i.Icon,{icon:Q.iconClose,size:12})},s+Date.now())]},s+Date.now()),this.getLayerIndex=e=>{let t=-1;return this.props.config.layers.forEach((i,s)=>{e===i.layerId&&(t=s)}),t},this.updateConfig=(e,t,i)=>{const s={parentKey:e,childKey:t,value:i},a=this.getLayerIndex(this.selectedLayerConfig.layerId);this.setState({selectedLayerIndex:a}),this.props.onProfileSettingsUpdated("profileSettings",this.props.activeDataSource,a,s,null,!1)},this.closePanel=()=>{this.setSidePopperAnchor(this.state.selectedLayerIndex),this.setState({showLayerDataItemPanel:!1,selectedLayerIndex:null})},this.disableSelection=e=>!1,this.hideMessage=()=>{this.setState({isAlertMsgPopupOpen:!1})},this.setSidePopperAnchor=e=>{var t;const i=null===(t=this.layerSidePopperTrigger.current)||void 0===t?void 0:t.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:i})},this.updateLayersConfig=this.props.config.layers;const a=this.mvManager.jimuMapViewGroups[this.props.mapWidgetId];for(const e in a.jimuMapViews)a.jimuMapViews[e].dataSourceId===this.props.activeDataSource&&(this.mapView=a.jimuMapViews[e]);this.state={selectedLayers:[],showLayerDataItemPanel:!1,layerName:null,isAlertMsgPopupOpen:!1,popperFocusNode:null,selectedLayerIndex:null}}getProfileDefaultConfigOnAdd(e){var i,s,a;const l=t.DataSourceManager.getInstance().getDataSource(e.id),n=l,o=v(this.props.activeDsConfig,ee),r=[];if(n&&n.layerDefinition&&n.layerDefinition.geometryType&&"esriGeometryPolyline"===n.layerDefinition.geometryType){let e="no elevation";n.layerDefinition.hasZ&&(e="z");const d=Object.assign({},z);(null===(i=null==n?void 0:n.layerDefinition)||void 0===i?void 0:i.hasGeometryProperties)&&(null===(a=null===(s=null==n?void 0:n.layerDefinition)||void 0===s?void 0:s.geometryProperties)||void 0===a?void 0:a.shapeLengthFieldName)?d.distanceSettings.field=n.layerDefinition.geometryProperties.shapeLengthFieldName:d.distanceSettings.field="",d.style.lineColor=m(),d.elevationSettings.unit=o[0],d.distanceSettings.unit=o[1],d.layerId=l.id,d.elevationSettings.type=e,r.push((0,t.Immutable)(d))}return r}render(){var a;const l=[],n=u(this.props.activeDataSource);null==n||n.forEach(e=>{var t;"esriGeometryPolyline"===(null===(t=e.getLayerDefinition())||void 0===t?void 0:t.geometryType)&&l.push(e.id)});const o={fromRootDsIds:this.getDsRootIdsByWidgetId(),fromDsIds:(0,t.Immutable)(l)};return(0,e.jsxs)("div",{css:r(this.props.theme),style:{height:"100%",width:"100%",marginTop:5},children:[(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("selectableLayersLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label",children:this.nls("selectableLayersLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("selectableLayersTooltip"),title:this.nls("selectableLayersTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline color-label",children:(0,e.jsx)(i.Icon,{size:14,icon:Q.infoIcon})})})]}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(J.DataSourceSelector,{className:"ep-data-source-selector",types:this.supportedDsTypes,buttonLabel:this.nls("selectableButton"),fromRootDsIds:o.fromRootDsIds,fromDsIds:o.fromDsIds,mustUseDataSource:!0,onChange:this.dataSourceChangeSave,disableDataView:!0,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideTypeDropdown:!1,disableAddData:!0,disableRemove:()=>!0,disableSelection:this.disableSelection,widgetId:this.props.widgetId,hideDataView:!0})}),0===this.state.selectedLayers.length&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("selectableLayersWarning"),className:"hint w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("selectableLayersWarning")})})}),this.state.selectedLayers.length>0&&(0,e.jsx)("div",{ref:this.layerSidePopperTrigger,tabIndex:-1,className:"w-100 mt-4",children:(0,e.jsx)("div",{className:"ep-layers-list",children:(0,e.jsx)(H.List,{itemsJson:Array.from(this.state.selectedLayers).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!1,onClickItemBody:(e,t)=>{const{itemJsons:i}=t.props,s=i[0],a=i[1];this.showLayerData(s.itemStateDetailContent,a.indexOf(s))},overrideItemBlockInfo:()=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:i}=t.props,s=i[0],a=i[1];return this.createLayerElement(s.itemStateDetailContent,a.indexOf(s))}})})}),(0,e.jsx)(s.SidePopper,{title:this.state.layerName,isOpen:this.state.showLayerDataItemPanel&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closePanel,trigger:null===(a=this.layerSidePopperTrigger)||void 0===a?void 0:a.current,backToFocusNode:this.state.popperFocusNode,children:(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:d(this.props.theme),children:(0,e.jsx)(Y,{theme:this.props.theme,intl:this.props.intl,title:this.state.layerName,ref:this.backRef,onBack:this.closePanel,children:(0,e.jsx)("div",{className:"setting-container",children:(0,e.jsx)(Z,{config:this.getSelectedLayerConfig(this.dsId),hasVerticalUnit:this._hasVerticalUnitParam,hasSupportForZValue:this.hasSupportForZValue,selectedLayerDataSource:this.selectedLayerDataSource,intl:this.props.intl,theme:this.props.theme,updateProfileSettings:this.updateConfig.bind(this)})})})})}),this.state.isAlertMsgPopupOpen&&(0,e.jsx)(i.AlertPopup,{"aria-expanded":this.state.isAlertMsgPopupOpen,hideCancel:!0,isOpen:this.state.isAlertMsgPopupOpen&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,onClickOk:this.hideMessage.bind(this),onClickClose:this.hideMessage.bind(this),title:this.nls("alert"),children:(0,e.jsx)("div",{className:"p-2",children:this.nls("alreadySelectedLayerMsg")})})]})}}var ie=h(62838),se=h.n(ie),ae=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const le=i=>{const s=window.SVG,{className:a}=i,l=ae(i,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:n,src:se()},l)):(0,e.jsx)("svg",Object.assign({className:n},l))};var ne=h(93303),oe=h.n(ne),re=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const de=i=>{const s=window.SVG,{className:a}=i,l=re(i,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:n,src:oe()},l)):(0,e.jsx)("svg",Object.assign({className:n},l))};var pe=h(46942),ce=h.n(pe);const{epConfigIcon:he}=j();class ge extends t.React.PureComponent{constructor(t){super(t),this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{const e=[];this.props.availableStatistics.forEach(t=>{const i={name:t.name,label:t.label,enabled:t.enabled};e.push(i)}),e.length>0&&this._statistics.length!==e.length&&(this._statistics=e),this.props.onStatsListUpdated(this._statistics)},this.componentDidUpdate=e=>{this.isStatsPropsChange(e)&&(this._statistics=this.props.availableStatistics)},this.isStatsPropsChange=e=>{let t=!1;return e.availableStatistics.length>0&&e.availableStatistics.some(e=>this.props.availableStatistics.some(i=>e.name===i.name&&e.enabled!==i.enabled&&(t=!0,!0))),t},this.createOptionElement=(t,a)=>(0,e.jsx)("div",{style:{width:180},children:(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Checkbox,{role:"\xe7heckbox",className:"cursor-pointer mr-2 font-13","aria-label":t.label,checked:t.enabled,onChange:e=>{this.onCheckBoxChange(e,a)}}),(0,e.jsx)("div",{className:"text-truncate",title:t.label,children:this.nls(t.name)})]})}),this.onCheckBoxChange=(e,t)=>{let i;this._statistics.some((s,a)=>t===a&&(i={name:s.name,label:s.label,enabled:e.currentTarget.checked},!0)),e.stopPropagation(),this.updateItem(t,i)},this.updateItem=(e,t)=>{e>-1&&(this._statistics=[...this._statistics.slice(0,e),Object.assign({},this._statistics[e],t),...this._statistics.slice(e+1)],this.props.onStatsListUpdated(this._statistics))},this._statistics=[]}render(){return(0,e.jsxs)("div",{css:(a=this.props.theme,t.css`
    .color-label {
      color: ${a.ref.palette.neutral[900]};
    }

    .ep-statistics-list-items {
      flex: 1;

      .jimu-tree-item [data-dndzone-droppable=true] {
        border: 1px solid transparent;
      }

      .jimu-tree-item.jimu-tree-item_dnd-true {
        height: auto;
        padding-top: 0rem;

        .jimu-tree-item__body {
          padding: 8px 0px 8px 0px;
        }
      }
    }
  `),className:"pt-4 pb-2",children:[(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("statisticsListLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label",children:this.nls("statisticsListLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("statisticsListTooltip"),title:this.nls("statisticsListTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline color-label",children:(0,e.jsx)(i.Icon,{size:14,icon:he.infoIcon})})})]}),(0,e.jsx)("div",{className:"pt-2",children:(0,e.jsx)(H.List,{size:"sm",className:this.props.availableStatistics&&0===this.props.availableStatistics.length?"hidden":"ep-statistics-list-items",itemsJson:Array.from(this.props.availableStatistics).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,s]=i,a=s.map(e=>e.itemStateDetailContent);this._statistics=a,this.props.onStatsListUpdated(a)},overrideItemBlockInfo:()=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:H.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemDragHandle},{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:i}=t.props,s=i[0],a=i[1];return this.createOptionElement(s.itemStateDetailContent,a.indexOf(s))}})})]});var a}}const{epConfigIcon:ue}=j();class ve extends t.React.PureComponent{constructor(e){var s;super(e),this.supportedDsTypes=(0,t.Immutable)([t.DataSourceTypes.ElevationLayer]),this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{this.props.isVolumetricObjSettings?this.showVolumetricObjInfo(!1):this.showElevationLayersInfo(!1)},this.componentDidUpdate=(e,i)=>{this.props.editCurrentLayer===e.editCurrentLayer&&this.props.layerIndex===e.layerIndex&&t.lodash.isDeepEqual(this.props.elevationLayersList,e.elevationLayersList)||this.showElevationLayersInfo(!1),t.lodash.isDeepEqual(this.state.elevationLayersSettingsList,i.elevationLayersSettingsList)||this.showElevationLayersInfo(!0),t.lodash.isDeepEqual(this.props.volumetricObjOptionsConfig,e.volumetricObjOptionsConfig)||this.showVolumetricObjInfo(!1),t.lodash.isDeepEqual(this.state.volumetricObjOptionsSettings,i.volumetricObjOptionsSettings)||this.showVolumetricObjInfo(!0)},this.showElevationLayersInfo=e=>{(e?this.state.elevationLayersSettingsList:this.props.elevationLayersList).forEach((t,i)=>{if(t.elevationLayerUrl===this.props.editCurrentLayer&&this.props.layerIndex===i){this.props.editCurrentLayer?this.props.disableOkButton(!1):this.props.disableOkButton(!0),e&&""===t.label&&this.props.disableOkButton(!0);let i=t.label;t.useDataSource||t.elevationLayerUrl||(i=e&&t.label?t.label:""),this.setState({useDataSource:t.useDataSource,updatedElevationUrl:t.elevationLayerUrl,elevationLayerLabel:i,style:t.style,showProfileStats:t.displayStatistics,statisticsList:t.selectedStatistics})}})},this.updateLayersSettingsValue=(e,t)=>{let i;this.state.elevationLayersSettingsList.some((s,a)=>{if(((null==s?void 0:s.elevationLayerUrl)===t||t)&&this.props.layerIndex===a)return this.setEditIndex=a,i={id:s.id,useDataSource:e||this.state.useDataSource,label:this.state.elevationLayerLabel,elevationLayerUrl:this.state.updatedElevationUrl,style:this.state.style,displayStatistics:this.state.showProfileStats,selectedStatistics:this.state.statisticsList},!0}),this.updateItem(this.setEditIndex,i)},this.updateItem=(e,t)=>{const i=e;if(i>-1){const e=[...this.props.elevationLayersList.slice(0,i),Object.assign({},this.props.elevationLayersList[i],t),...this.props.elevationLayersList.slice(i+1)];this.props.onLayersUpdate(e,i),this.setState({elevationLayersSettingsList:e})}},this.showVolumetricObjInfo=e=>{const t=e?this.state.volumetricObjOptionsSettings:this.props.volumetricObjOptionsConfig;this.setState({elevationLayerLabel:t.volumetricObjLabel,style:t.style,showProfileStats:t.displayStatistics,statisticsList:t.selectedStatistics})},this.updateVolumetricSettingsValue=()=>{const e={id:this.props.volumetricObjOptionsConfig.id,style:this.state.style,volumetricObjLabel:this.state.elevationLayerLabel,displayStatistics:this.state.showProfileStats,selectedStatistics:this.state.statisticsList};this.setState({volumetricObjOptionsSettings:e}),this.props.onVolumetricSettingsUpdated(e)},this.updateElevationLayerLineStyle=(e,t,i)=>{if(this.props.isVolumetricObjSettings){const e={lineType:"lineType"===t?i:this.props.volumetricObjOptionsConfig.style.lineType,lineColor:"lineColor"===t?i:this.props.volumetricObjOptionsConfig.style.lineColor,lineThickness:"lineThickness"===t?i:this.props.volumetricObjOptionsConfig.style.lineThickness};this.setState({style:e},()=>{this.updateVolumetricSettingsValue()})}else{const e={lineType:"lineType"===t?i:this.state.elevationLayersSettingsList[this.props.layerIndex].style.lineType,lineColor:"lineColor"===t?i:this.state.elevationLayersSettingsList[this.props.layerIndex].style.lineColor,lineThickness:"lineThickness"===t?i:this.state.elevationLayersSettingsList[this.props.layerIndex].style.lineThickness};this.setState({style:e},()=>{this.updateLayersSettingsValue(this.state.useDataSource,this.state.updatedElevationUrl)})}},this.onElevationLayerSelect=e=>{if(!e)return;const i=t.DataSourceManager.getInstance().getDataSource(e[0].dataSourceId);i.type===t.DataSourceTypes.ElevationLayer&&this.setState({useDataSource:e[0],updatedElevationUrl:i.layer.url,elevationLayerLabel:this.state.elevationLayerLabel||i.layer.title},()=>{!this.props.isVolumetricObjSettings&&this.updateLayersSettingsValue(e[0],i.layer.url)})},this.onLayerLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({elevationLayerLabel:t})}},this.onLayerLabelAcceptValue=e=>{this.setState({elevationLayerLabel:e.trim()},()=>{this.props.isVolumetricObjSettings?this.updateVolumetricSettingsValue():this.updateLayersSettingsValue(this.state.useDataSource,this.state.updatedElevationUrl)})},this.checkLayerLabel=e=>this.props.isVolumetricObjSettings||this.state.useDataSource||this.state.updatedElevationUrl?""===e.trim()?(this.props.disableOkButton(!0),{valid:!1,msg:this.nls("emptyLabelWarning")}):(this.props.disableOkButton(!1),{valid:!0}):(this.props.disableOkButton(!0),""===e.trim()?{valid:!1,msg:this.nls("emptyLabelWarning")}:{valid:!0}),this.onDisplayGroundProfileStatsChange=e=>{this.setState({showProfileStats:e.target.checked},()=>{this.props.isVolumetricObjSettings?this.updateVolumetricSettingsValue():this.updateLayersSettingsValue(this.state.useDataSource,this.state.updatedElevationUrl)})},this.updateStatistics=e=>{this.setState({statisticsList:e},()=>{this.props.isVolumetricObjSettings?this.updateVolumetricSettingsValue():this.updateLayersSettingsValue(this.state.useDataSource,this.state.updatedElevationUrl)})},this.state={elevationLayersSettingsList:this.props.elevationLayersList||[],volumetricObjOptionsSettings:this.props.volumetricObjOptionsConfig,useDataSource:null,updatedElevationUrl:"",elevationLayerLabel:this.props.isVolumetricObjSettings?this.props.volumetricObjOptionsConfig.volumetricObjLabel:"",style:this.props.isVolumetricObjSettings?this.props.volumetricObjOptionsConfig.style:null===(s=this.props.elevationLayersList[this.props.layerIndex])||void 0===s?void 0:s.style,showProfileStats:!1,statisticsList:this.props.availableStats},this.setEditIndex=0}render(){return(0,e.jsx)("div",{style:{height:"calc(100% - 92px)",width:"100%",overflow:"auto"},css:o(this.props.theme),children:(0,e.jsxs)(s.SettingSection,{children:[!this.props.isVolumetricObjSettings&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingRow,{className:"pt-1",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("selectLayer"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title2 hint-paper",children:this.nls("selectLayer")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("selectLayerTooltip"),title:this.nls("selectLayerTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:ue.infoIcon})})})]}),!this.props.isNewLayerAdded&&!this.state.useDataSource&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.TextArea,{role:"textarea","aria-label":this.state.updatedElevationUrl,height:76,className:"w-100",spellCheck:!1,value:this.state.updatedElevationUrl,onClick:e=>{e.currentTarget.select()},readOnly:!0})}),(this.props.isNewLayerAdded||!this.props.isNewLayerAdded&&this.state.useDataSource)&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(J.DataSourceSelector,{"data-testid":"addLayer",types:this.supportedDsTypes,useDataSources:this.state.useDataSource?(0,t.Immutable)([this.state.useDataSource]):(0,t.Immutable)([]),buttonLabel:this.nls("selectLayerLabel"),onChange:this.onElevationLayerSelect,mustUseDataSource:!0,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideTypeDropdown:!1,hideAddDataButton:!1,disableRemove:()=>!0,widgetId:this.props.widgetId,hideDataView:!0,useDataSourcesEnabled:!0})})]}),(0,e.jsx)(s.SettingRow,{className:(0,t.classNames)(this.props.isVolumetricObjSettings?"pt-1":"ep-divider-top pt-4"),label:this.nls("label"),flow:"wrap",children:(0,e.jsx)(i.TextInput,{"data-testid":"layerLabel",className:"w-100",role:"textbox","aria-label":this.nls("label")+this.state.elevationLayerLabel,title:this.state.elevationLayerLabel,size:"sm",value:this.state.elevationLayerLabel,onAcceptValue:this.onLayerLabelAcceptValue,onChange:this.onLayerLabelChange,checkValidityOnChange:this.checkLayerLabel,checkValidityOnAccept:this.checkLayerLabel})}),(0,e.jsxs)(s.SettingRow,{className:"pt-4 ep-divider-top",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("styleLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label title2 hint-paper",children:this.nls("styleLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("elevationLayerStyleTooltip"),title:this.nls("elevationLayerStyleTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:ue.infoIcon})})})]}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(K,{intl:this.props.intl,lineItem:"style",onLineStyleChange:this.updateElevationLayerLineStyle,config:this.state.style})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("displayGroundProfileStatsLabel"),children:(0,e.jsx)(i.Switch,{role:"switch","data-testid":"profileStatsSwitch",title:this.nls("displayGroundProfileStatsLabel"),checked:this.state.showProfileStats,onChange:this.onDisplayGroundProfileStatsChange})}),this.state.showProfileStats&&(0,e.jsx)("div",{children:(0,e.jsx)(ge,{intl:this.props.intl,theme:this.props.theme,availableStatistics:this.state.statisticsList,onStatsListUpdated:this.updateStatistics})})]})})}}var me=h(23662),ye=h.n(me),fe=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const Se=i=>{const s=window.SVG,{className:a}=i,l=fe(i,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:n,src:ye()},l)):(0,e.jsx)("svg",Object.assign({className:n},l))},{epConfigIcon:be}=j(),xe=(0,t.getAppStore)().getState().portalSelf;class Le extends t.React.PureComponent{constructor(s){super(s),this.elevationLayerSidePopperTrigger=t.React.createRef(),this.mvManager=l.MapViewManager.getInstance(),this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidUpdate=e=>{if(this.props.currentDs!==e.currentDs||this.props.mapWidgetId!==e.mapWidgetId){const e=this.mvManager.jimuMapViewGroups[this.props.mapWidgetId];for(const t in null==e?void 0:e.jimuMapViews)e.jimuMapViews[t].dataSourceId===this.props.currentDs&&(this.mapView=e.jimuMapViews[t])}e.config.elevationUnit!==this.props.config.elevationUnit&&this.setElevationUnit(this.props.config.elevationUnit),e.config.linearUnit!==this.props.config.linearUnit&&this.setLinearUnit(this.props.config.linearUnit),e.config.addedElevationLayers!==this.props.config.addedElevationLayers&&this.setState({addedElevationLayers:this.props.config.addedElevationLayers})},this.setLinearUnit=e=>{""===e&&(e="english"===(null==xe?void 0:xe.units)?"miles":"kilometers"),this.setState({linearUnit:e})},this.setElevationUnit=e=>{""===e&&(e="english"===(null==xe?void 0:xe.units)?"feet":"meters"),this.setState({elevationUnit:e})},this.onNewLayerButtonClick=()=>{this.setSidePopperAnchor(null,!0,!1);const e=Object.assign({},B);e.selectedStatistics=this.props.availableStats,e.id=x(),e.style=Object.assign({},V),e.style.lineColor=m(),this.setState({newLayerAdded:!0,volumetricObjSettings:!1,addedElevationLayers:[...this.state.addedElevationLayers,e],layerIndex:this.state.addedElevationLayers.length,showElevationLayerDataItemPanel:!0,elevationLayerPopperTitle:this.nls("addElevationLayer"),editCurrentLayer:""},()=>{1===this.state.addedElevationLayers.length&&this.props.onElevationLayersSettingsUpdated("groundLayerId",this.state.addedElevationLayers[0].id)})},this.onDeleteLayer=(e,t,i)=>{e.stopPropagation();const s=Object.assign([],this.state.addedElevationLayers);s.splice(i,1),this.setState({layerIndex:i,addedElevationLayers:s},()=>{this.props.onElevationLayersSettingsUpdated("addedElevationLayers",this.state.addedElevationLayers),-1===this.state.layerIndex&&this.state.editCurrentLayer===t&&(this.setSidePopperAnchor(this.state.layerIndex,!1,!1),this.setState({showElevationLayerDataItemPanel:!1,layerIndex:null,editCurrentLayer:t},()=>{this.props.onElevationLayersSettingsUpdated("addedElevationLayers",this.state.addedElevationLayers)}))})},this.onSettingsClick=(e,t,i)=>{e.stopPropagation(),this.setSidePopperAnchor(i,!1,!1),this.setState({showElevationLayerDataItemPanel:!0,volumetricObjSettings:!1,newLayerAdded:!1,elevationLayerPopperTitle:t.label||this.nls("groundElevation"),layerIndex:i,editCurrentLayer:t.elevationLayerUrl})},this.setSidePopperAnchor=(e,t,i)=>{let s;i&&(s=this.elevationLayerSidePopperTrigger.current.getElementsByClassName("volumetric-obj-btn")[0]),t&&(s=this.elevationLayerSidePopperTrigger.current.getElementsByClassName("new-layer-btn")[0]),null!==e&&(s=this.elevationLayerSidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e]),this.setState({popperFocusNode:s})},this.closePanel=()=>{var e;if(this.state.volumetricObjSettings)this.setSidePopperAnchor(null,!1,!0),this.setState({volumetricObjSettingsOptions:this.props.config.volumetricObjSettingsOptions,showElevationLayerDataItemPanel:!1},()=>{this.props.onElevationLayersSettingsUpdated("volumetricObjSettingsOptions",this.state.volumetricObjSettingsOptions)});else{this.state.newLayerAdded?this.setSidePopperAnchor(null,!0,!1):this.setSidePopperAnchor(this.state.layerIndex,!1,!1);const t=this.props.config.addedElevationLayers;this.setState({addedElevationLayers:(null===(e=this.props.config.addedElevationLayers)||void 0===e?void 0:e.length)>0?t.asMutable():[],showElevationLayerDataItemPanel:!1,layerIndex:null,editCurrentLayer:""},()=>{this.props.onElevationLayersSettingsUpdated("addedElevationLayers",this.state.addedElevationLayers)})}},this.settingsOkButtonClick=()=>{this.state.volumetricObjSettings?this.setState({showElevationLayerDataItemPanel:!1,volumetricObjSettingsOptions:this.isVolumetricInfoEdited?this.state.updatedVolumetricObjSettingsOptions:this.state.volumetricObjSettingsOptions},()=>{this.props.onElevationLayersSettingsUpdated("volumetricObjSettingsOptions",this.state.volumetricObjSettingsOptions)}):(this.setState({showElevationLayerDataItemPanel:!1,addedElevationLayers:this.isLayerInfoEdited?this.state.updatedAddedLayersInfo:this.state.addedElevationLayers},()=>{this.props.onElevationLayersSettingsUpdated("addedElevationLayers",this.state.addedElevationLayers)}),this.isLayerInfoEdited=!1),this.isVolumetricInfoEdited=!1},this.onLayersInfoUpdate=(e,t)=>{this.isLayerInfoEdited=!0,this.setState({updatedAddedLayersInfo:e,layerIndex:t,editCurrentLayer:e[t].elevationLayerUrl})},this.onVolumetricSettingsUpdated=e=>{this.isVolumetricInfoEdited=!0,this.setState({updatedVolumetricObjSettingsOptions:e})},this.onDisableOkButton=e=>{this.setState({disableSidePopperOkButton:e})},this.createElevationLayerItem=(t,s)=>(0,e.jsxs)("div",{className:ce()("flex-grow-1 layer-data-item cursor-pointer"),children:[(0,e.jsxs)("div",{className:"d-flex w-100 justify-content-between align-items-center",children:[(0,e.jsx)("div",{className:"layer-data-item-name text-truncate",title:t.label||this.nls("groundElevation"),children:t.label||this.nls("groundElevation")}),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("settings"),title:this.nls("settings"),type:"tertiary",size:"sm",icon:!0,onClick:e=>{this.onSettingsClick(e,t,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onSettingsClick(e,t,s)},children:(0,e.jsx)(de,{size:"m",className:"p-0"})}),t.id===this.props.config.groundLayerId&&(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("groundLayerInfoTooltip"),title:this.nls("groundLayerInfoTooltip"),showArrow:!0,placement:"top","data-testid":"groundLayerInfoIcon",children:(0,e.jsx)("div",{className:"d-inline",style:{padding:6},children:(0,e.jsx)(i.Icon,{size:14,icon:be.infoIcon})})}),!(t.id===this.props.config.groundLayerId)&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),type:"tertiary",size:"sm",icon:!0,onClick:e=>{this.onDeleteLayer(e,t.elevationLayerUrl,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onDeleteLayer(e,t.elevationLayerUrl,s)},children:(0,e.jsx)(le,{size:"s",className:"p-0"})})]}),t.id===this.props.config.groundLayerId&&(0,e.jsx)("div",{className:"hint-paper d-flex align-items-center layer-type-name",children:(0,e.jsx)("div",{className:"w-100 text-truncate",title:this.nls("groundLayer"),children:this.nls("groundLayer")})})]},s),this.onElevationLayerOrderChanged=e=>{this.setState({addedElevationLayers:e},()=>{this.props.onElevationLayersSettingsUpdated("addedElevationLayers",e)})},this.onGroundLayerChange=e=>{this.props.onElevationLayersSettingsUpdated("groundLayerId",e.target.value)},this.onLinearUnitChange=e=>{this.setState({linearUnit:e.target.value},()=>{this.props.onElevationLayersSettingsUpdated("linearUnit",this.state.linearUnit)})},this.onElevationUnitChange=e=>{this.setState({elevationUnit:e.target.value},()=>{this.props.onElevationLayersSettingsUpdated("elevationUnit",this.state.elevationUnit)})},this.onShowVolumetricObjLineInGraphChange=e=>{this.props.onElevationLayersSettingsUpdated("showVolumetricObjLineInGraph",e.currentTarget.checked)},this.onVolumtericObjSettingsClick=e=>{e.stopPropagation(),this.setSidePopperAnchor(null,!1,!0),this.setState({showElevationLayerDataItemPanel:!0,volumetricObjSettings:!0,elevationLayerPopperTitle:this.nls("volumetricObjectsLabel")})};const a=this.mvManager.jimuMapViewGroups[this.props.mapWidgetId];for(const e in null==a?void 0:a.jimuMapViews)a.jimuMapViews[e].dataSourceId===this.props.currentDs&&(this.mapView=a.jimuMapViews[e]);let o=this.props.config.elevationUnit,r=this.props.config.linearUnit;""===this.props.config.elevationUnit&&(o=f(xe)),""===this.props.config.linearUnit&&(r=(e=>"english"===(null==e?void 0:e.units)?"miles":"kilometers")(xe)),this.state={addedElevationLayers:this.props.config.addedElevationLayers,newLayerAdded:!1,updatedAddedLayersInfo:this.props.config.addedElevationLayers,elevationLayerPopperTitle:null,popperFocusNode:null,showElevationLayerDataItemPanel:!1,layerIndex:null,editCurrentLayer:"",disableSidePopperOkButton:!1,elevationUnit:o,linearUnit:r,volumetricObjSettings:!1,volumetricObjSettingsOptions:this.props.config.volumetricObjSettingsOptions,updatedVolumetricObjSettingsOptions:this.props.config.volumetricObjSettingsOptions},this.isLayerInfoEdited=!1,this.isVolumetricInfoEdited=!1}render(){var a,l,n;let r=this.state.addedElevationLayers;return this.props.config.addedElevationLayers[this.state.layerIndex]&&(r=this.props.config.addedElevationLayers),(0,e.jsxs)("div",{style:{height:"100%",width:"100%",marginTop:5},css:o(this.props.theme),children:[(0,e.jsxs)("div",{ref:this.elevationLayerSidePopperTrigger,className:"mb-4",children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Button,{role:"button",className:"w-100 text-dark new-layer-btn",type:"primary",onClick:this.onNewLayerButtonClick.bind(this),children:(0,e.jsxs)("div",{className:"w-100 px-2 text-truncate",children:[(0,e.jsx)(Se,{className:"mr-1 mb-1"}),this.nls("newLayerLabel")]})})}),this.props.config.addedElevationLayers.length>0&&(0,e.jsx)("div",{tabIndex:-1,className:"w-100 mb-4 mt-4",children:(0,e.jsx)("div",{className:"ep-layers-list",children:(0,e.jsx)(H.List,{itemsJson:Array.from(this.props.config.addedElevationLayers).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,s]=i,a=s.map(e=>e.itemStateDetailContent);this.onElevationLayerOrderChanged(a)},overrideItemBlockInfo:()=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemDragHandle},{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:i}=t.props,s=i[0],a=i[1];return this.createElevationLayerItem(s.itemStateDetailContent,a.indexOf(s))}})})}),0===this.state.addedElevationLayers.length&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Alert,{tabIndex:0,style:{minWidth:"auto"},open:!0,text:this.nls("noGroundLayerInfoMessage"),type:"info"})}),this.state.addedElevationLayers.length>0&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingRow,{label:this.nls("setGroundLayer"),children:(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("setGroundLayerTooltip"),title:this.nls("setGroundLayerTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:be.infoIcon})})})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Select,{"aria-label":this.props.config.groundLayerId,size:"sm",name:"groundLayer",className:"select-class",value:this.props.config.groundLayerId,onChange:this.onGroundLayerChange,"data-testid":"refLayer",children:this.state.addedElevationLayers.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.id,value:t.id,children:t.label},s))})})]}),"3d"===(null===(l=null===(a=this.mapView)||void 0===a?void 0:a.view)||void 0===l?void 0:l.type)&&(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsxs)("div",{className:"d-flex w-100",children:[(0,e.jsx)(i.Checkbox,{"data-testid":"volumetricObject",checked:this.props.config.showVolumetricObjLineInGraph,onChange:this.onShowVolumetricObjLineInGraphChange,role:"checkbox","aria-label":this.nls("volumetricObjectsLabel")}),(0,e.jsx)("div",{className:"flex-grow-1 text-break ml-2",title:this.nls("volumetricObjectsLabel"),children:this.nls("volumetricObjectsLabel")})]}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("volumetricObjectsTooltip"),title:this.nls("volumetricObjectsTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:be.infoIcon})})}),(0,e.jsx)(i.Button,{className:"ml-3 volumetric-obj-btn",role:"button","aria-label":this.nls("settings"),title:this.nls("settings"),type:"tertiary",size:"sm",icon:!0,onClick:e=>{this.onVolumtericObjSettingsClick(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onVolumtericObjSettingsClick(e)},children:(0,e.jsx)(de,{size:"m",className:"p-0"})})]})]}),(0,e.jsx)(s.SidePopper,{title:this.state.elevationLayerPopperTitle,isOpen:this.state.showElevationLayerDataItemPanel&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closePanel,trigger:null===(n=this.elevationLayerSidePopperTrigger)||void 0===n?void 0:n.current,backToFocusNode:this.state.popperFocusNode,children:(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:d(this.props.theme),children:(0,e.jsx)(Y,{theme:this.props.theme,intl:this.props.intl,title:this.state.elevationLayerPopperTitle,onBack:this.closePanel,hideBackArrow:!0,showCloseIcon:!0,showOkButton:!0,disableOkButton:this.state.disableSidePopperOkButton,onOkButtonClicked:this.settingsOkButtonClick,children:(0,e.jsx)(ve,{intl:this.props.intl,theme:this.props.theme,widgetId:this.props.widgetId,layerIndex:this.state.layerIndex,editCurrentLayer:this.state.editCurrentLayer,isNewLayerAdded:this.state.newLayerAdded,elevationLayersList:r,availableStats:this.props.availableStats,isVolumetricObjSettings:this.state.volumetricObjSettings,volumetricObjOptionsConfig:this.props.config.volumetricObjSettingsOptions,onLayersUpdate:this.onLayersInfoUpdate,onVolumetricSettingsUpdated:this.onVolumetricSettingsUpdated,disableOkButton:this.onDisableOkButton})})})}),(0,e.jsxs)(s.SettingRow,{className:"pt-4 ep-divider-top",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("measurementUnitsHeadingLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label title2 hint-paper",children:this.nls("measurementUnitsHeadingLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("measurementUnitsHeadingTooltip"),title:this.nls("measurementUnitsHeadingTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:be.infoIcon})})})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("elevationUnitLabel"),style:{width:108},className:"d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("elevationUnitLabel")})}),(0,e.jsx)(i.Select,{"aria-label":this.state.elevationUnit,className:"selectOption",size:"sm",name:"elevationUnit",value:this.state.elevationUnit,onChange:this.onElevationUnitChange,children:T.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.value)},s))})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("distanceUnitLabel"),style:{width:108},className:"d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("distanceUnitLabel")})}),(0,e.jsx)(i.Select,{"aria-label":this.state.linearUnit,className:"selectOption",size:"sm",name:"linearUnit",value:this.state.linearUnit,onChange:this.onLinearUnitChange,children:T.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.value)},s))})]})]})}}var we=h(45508),Ie=h.n(we),je=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const De=i=>{const s=window.SVG,{className:a}=i,l=je(i,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:n,src:Ie()},l)):(0,e.jsx)("svg",Object.assign({className:n},l))},{epConfigIcon:Ce}=j();class Te extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{this.props.onGeneralSettingsUpdated("allowExport",!!this.props.config.allowExport&&this.props.config.allowExport)},this.allowExportOptionChange=e=>{this.props.onGeneralSettingsUpdated("allowExport",e.target.checked)},this.onKeepResultOptionChange=e=>{this.props.onGeneralSettingsUpdated("keepResultsWhenClosed",e.target.checked)},this.onActiveToolChange=e=>{this.setState({activeTool:e.target.value}),this.generalSettingsUpdate(e.target.value)},this.generalSettingsUpdate=e=>{const t={allowExport:this.props.config.allowExport,keepResultsWhenClosed:this.props.config.keepResultsWhenClosed,isSelectToolActive:e===k[1].value,isDrawToolActive:e===k[2].value,showGridAxis:this.props.config.showGridAxis,showAxisTitles:this.props.config.showAxisTitles,showLegend:this.props.config.showLegend,buttonStyle:this.props.config.buttonStyle};this.props.onGeneralSettingsUpdated("generalSettings",t,!0)},this.onToggleAppearance=()=>{this.setState({isAppearanceSettingsOpen:!this.state.isAppearanceSettingsOpen})},this.onShowGridChange=e=>{this.props.onGeneralSettingsUpdated("showGridAxis",e.target.checked)},this.onShowAxisTitlesChange=e=>{this.props.onGeneralSettingsUpdated("showAxisTitles",e.target.checked)},this.legendStateChange=e=>{this.props.onGeneralSettingsUpdated("showLegend",e.target.checked)};let t=k[0].value;this.props.config.isSelectToolActive?t=k[1].value:this.props.config.isDrawToolActive&&(t=k[2].value),this.state={activeTool:t,isAppearanceSettingsOpen:!1}}render(){const a=this.props.config.isSelectToolActive?k[1].value:this.props.config.isDrawToolActive?k[2].value:k[0].value;return(0,e.jsxs)("div",{style:{height:"100%",width:"100%",marginTop:5},css:(this.props.theme,t.css`
    .hidden {
      display: none;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .ep-tooltip {
      margin-right: 0.30rem!important;
    }
  `),children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("allowExportLabel"),children:(0,e.jsx)(i.Switch,{role:"switch",title:this.nls("allowExportLabel"),checked:!!this.props.config.allowExport&&this.props.config.allowExport,onChange:this.allowExportOptionChange})}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("keepResultsWhenClosed")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("keepResultsWhenClosedTooltip"),title:this.nls("keepResultsWhenClosedTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default mr-3 d-inline",children:(0,e.jsx)(De,{})})}),(0,e.jsx)(i.Switch,{role:"switch",title:this.nls("keepResultsWhenClosed"),checked:this.props.config.keepResultsWhenClosed,onChange:this.onKeepResultOptionChange.bind(this)})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("activateToolOnLoadLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break",children:this.nls("activateToolOnLoadLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("activateToolOnLoadTooltip"),title:this.nls("activateToolOnLoadTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:Ce.infoIcon})})})]}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Select,{"aria-label":this.nls("activateToolOnLoadLabel"),className:"selectOption",size:"sm",name:"activateToolOnLoad",value:a,onChange:this.onActiveToolChange,children:k.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":this.nls(t.name),value:t.value,children:this.nls(t.name)},s))})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.CollapsablePanel,{label:this.nls("appearanceCollapsible"),isOpen:this.state.isAppearanceSettingsOpen,onRequestOpen:()=>{this.onToggleAppearance()},onRequestClose:()=>{this.onToggleAppearance()},children:(0,e.jsxs)("div",{style:{height:"100%",marginTop:10},children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("showChartGridsLabel"),children:(0,e.jsx)(i.Switch,{role:"switch",title:this.nls("showChartGridsLabel"),checked:this.props.config.showGridAxis,onChange:this.onShowGridChange})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("showChartAxisTitlesLabel"),children:(0,e.jsx)(i.Switch,{role:"switch",title:this.nls("showChartAxisTitlesLabel"),checked:this.props.config.showAxisTitles,onChange:this.onShowAxisTitlesChange})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:this.nls("showLegend"),children:(0,e.jsx)(i.Switch,{role:"switch",title:this.nls("showLegend"),checked:this.props.config.showLegend,onChange:this.legendStateChange})})]})})})]})}}class Oe extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{this.props.onIntersectingAssetStyleChange(this.props.intersectingAssetItem,"intersectingAssetShape",this.state.intersectingAssetShape)},this.componentDidUpdate=e=>{e.config.intersectingAssetColor!==this.props.config.intersectingAssetColor?this.setState({intersectingAssetColor:this.props.config.intersectingAssetColor}):e.config.intersectingAssetShape!==this.props.config.intersectingAssetShape?this.setState({intersectingAssetShape:this.props.config.intersectingAssetShape}):e.config.intersectingAssetSize!==this.props.config.intersectingAssetSize&&this.setState({intersectingAssetSize:this.props.config.intersectingAssetSize})},this.onIntersectingAssetColorChange=e=>{this.setState({intersectingAssetColor:e}),this.props.onIntersectingAssetStyleChange(this.props.intersectingAssetItem,"intersectingAssetColor",e)},this.onIntersectingAssetShapeChange=e=>{this.setState({intersectingAssetShape:e.currentTarget.value}),this.props.onIntersectingAssetStyleChange(this.props.intersectingAssetItem,"intersectingAssetShape",e.currentTarget.value)},this.onIntersectingAssetSizeChange=e=>{null!==e&&(this.setState({intersectingAssetSize:e}),this.props.onIntersectingAssetStyleChange(this.props.intersectingAssetItem,"intersectingAssetSize",e))};const t="esriGeometryPoint"===this.props.layerGeometryType?6:4,s="esriGeometryPoint"===this.props.layerGeometryType?"circle":"solid-line";this.state={intersectingAssetColor:this.props.config.intersectingAssetColor?this.props.config.intersectingAssetColor:"#049546",intersectingAssetShape:this.props.config.intersectingAssetShape?this.props.config.intersectingAssetShape:s,intersectingAssetSize:this.props.config.intersectingAssetSize?this.props.config.intersectingAssetSize:t}}render(){return(0,e.jsx)("div",{className:"pt-5 pb-4",children:(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(q.ColorPicker,{"aria-label":this.nls("styleColor"),className:"mr-2",width:"54px",height:"26px",offset:[0,0],placement:"auto",showArrow:!0,color:this.state.intersectingAssetColor?this.state.intersectingAssetColor:"#FFFFFF",onChange:this.onIntersectingAssetColorChange}),(0,e.jsxs)(i.Select,{"aria-label":this.nls("styleShape")+this.state.intersectingAssetShape,size:"sm",name:"symbolPicker",onChange:this.onIntersectingAssetShapeChange,value:this.state.intersectingAssetShape,children:["esriGeometryPoint"===this.props.layerGeometryType&&_.map((t,s)=>{const a=h(66633)(`./${t.value}.svg`);return(0,e.jsx)(i.Option,{role:"option","aria-label":t.label,value:t.value,title:this.nls(t.label),children:(0,e.jsx)(i.Icon,{size:12,icon:a})},s)}),"esriGeometryPolyline"===this.props.layerGeometryType&&G.map((t,s)=>{const a=h(66633)(`./${t.value}.svg`);return(0,e.jsx)(i.Option,{role:"option","aria-label":t.label,value:t.value,title:this.nls(t.label),children:(0,e.jsx)(i.Icon,{width:60,height:12,icon:a})},s)})]}),(0,e.jsx)(i.NumericInput,{"aria-label":this.nls("styleSize"),size:"sm",className:"ml-2",min:1,max:20,value:this.state.intersectingAssetSize,onChange:this.onIntersectingAssetSizeChange})]})})}}const{epConfigIcon:Me}=j();class Ae extends t.React.PureComponent{constructor(e){super(e),this._defaultSelectedItem={name:""},this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidUpdate=e=>{e.config.elevationSettings.field1!==this.props.config.elevationSettings.field1?this.setState({oneFields:""===this.props.config.elevationSettings.field1?[]:[this.props.config.elevationSettings.field1]}):e.config.elevationSettings.field2!==this.props.config.elevationSettings.field2?this.setState({twoFields:""===this.props.config.elevationSettings.field2?[]:[this.props.config.elevationSettings.field2]}):t.lodash.isDeepEqual(e.config.displayField,this.props.config.displayField)?e.config.elevationSettings.type!==this.props.config.elevationSettings.type?this.setState({elevationType:this.props.config.elevationSettings.type}):e.config.elevationSettings.unit!==this.props.config.elevationSettings.unit?this.setState({elevationUnits:this.props.config.elevationSettings.unit}):e.config.style.type!==this.props.config.style.type?this.setState({symbology:this.props.config.style.type}):t.lodash.isDeepEqual(e.config.style,this.props.config.style)||this.setState({style:this.props.config.style}):(this.setState({displayField:""===this.props.config.displayField?[]:[this.props.config.displayField]}),0===this.props.config.displayField.length&&(this._defaultSelectedItem.name=this.nls("noSelectionItemLabel")))},this.onElevationValueChange=e=>{this.setState({elevationType:e.target.value},()=>{this.props.updateAssetSettings("elevationSettings","type",this.state.elevationType)})},this.onElevationValueUnitChange=e=>{this.setState({elevationUnits:e.target.value},()=>{this.props.updateAssetSettings("elevationSettings","unit",this.state.elevationUnits)})},this.onSymbologyChange=e=>{"map"===e.target.value?this.setState({isIntersectingAssetStylePickerOpen:!1}):this.setState({isIntersectingAssetStylePickerOpen:!0}),this.setState({symbology:e.target.value},()=>{this.props.updateAssetSettings("style","type",this.state.symbology)})},this.onIntersectingAssetStyleChange=(e,t,i)=>{this.props.updateAssetSettings(e,t,i)},this.onOneFieldSelect=e=>{0===e.length?(this.setState({oneFields:[]}),this.props.updateAssetSettings("elevationSettings","field1","")):(this.setState({oneFields:[e[0].jimuName]}),this.props.updateAssetSettings("elevationSettings","field1",e[0].jimuName))},this.onTwoFieldSelect=e=>{0===e.length?(this.setState({twoFields:[]}),this.props.updateAssetSettings("elevationSettings","field2","")):(this.setState({twoFields:[e[0].jimuName]}),this.props.updateAssetSettings("elevationSettings","field2",e[0].jimuName))},this.onDisplayFieldSelect=e=>{0===e.length?(this.setState({displayField:[]}),this.props.updateAssetSettings("displayField","","")):(this.setState({displayField:[e[0].jimuName]}),this.props.updateAssetSettings("displayField","",e[0].jimuName))},this.props.hasSupportForZValue?this._elevationTypeOptions=A:this._elevationTypeOptions=N,this._defaultSelectedItem.name=this.nls("noSelectionItemLabel");let s=!1;"map"!==this.props.config.style.type&&(s=!0),this.state={isIntersectingAssetStylePickerOpen:s,oneFields:""===this.props.config.elevationSettings.field1?[]:[this.props.config.elevationSettings.field1],twoFields:""===this.props.config.elevationSettings.field2?[]:[this.props.config.elevationSettings.field2],displayField:""===this.props.config.displayField?[]:[this.props.config.displayField],elevationType:this.props.config.elevationSettings.type,elevationUnits:this.props.config.elevationSettings.unit,symbology:this.props.config.style.type,style:this.props.config.style}}render(){var a;let l;"no elevation"===this.state.elevationType?l=this.nls("noElevationHint"):"z"===this.state.elevationType&&(l=this.nls("noVerticalParamHint"));const n=null===(a=this.props.selectedLayerDataSource)||void 0===a?void 0:a.layer.layerDefinition.geometryType;return(0,e.jsx)("div",{style:{height:"100%",width:"100%"},css:r(this.props.theme),children:(0,e.jsxs)(s.SettingSection,{children:[(0,e.jsxs)(s.SettingRow,{className:"pt-1",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("elevationSettingLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label title2 hint-paper",children:this.nls("elevationSettingLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("elevationSettingIntersectingTooltip"),title:this.nls("elevationSettingIntersectingTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:Me.infoIcon})})})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("valueType"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("valueType")})}),(0,e.jsx)(i.Select,{"aria-label":this.state.elevationType,className:"selectOption",size:"sm",name:"elevationValueType",value:this.state.elevationType,onChange:this.onElevationValueChange,children:this._elevationTypeOptions.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.name)},s))})]}),(0,e.jsx)(s.SettingRow,{className:"one"===this.state.elevationType||"two"===this.state.elevationType?"":"hidden",children:(0,e.jsxs)("div",{className:"left-and-right d-flex justify-content-between w-100",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("oneFieldLabel"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("oneFieldLabel")})}),(0,e.jsx)(J.FieldSelector,{className:"fieldSelectorWidth",dataSources:[this.props.selectedLayerDataSource.layer],onChange:this.onOneFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.oneFields),isMultiple:!1,types:(0,t.Immutable)([t.JimuFieldType.Number]),noSelectionItem:this._defaultSelectedItem})]})}),(0,e.jsx)(s.SettingRow,{className:"two"===this.state.elevationType?"":"hidden",children:(0,e.jsxs)("div",{className:"left-and-right d-flex justify-content-between w-100",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("twoFieldLabel"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("twoFieldLabel")})}),(0,e.jsx)(J.FieldSelector,{className:"fieldSelectorWidth",dataSources:[this.props.selectedLayerDataSource.layer],onChange:this.onTwoFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.twoFields),types:(0,t.Immutable)([t.JimuFieldType.Number]),isMultiple:!1,noSelectionItem:this._defaultSelectedItem})]})}),(0,e.jsx)(s.SettingRow,{className:"no elevation"===this.state.elevationType||"z"===this.state.elevationType&&!this.props.hasVerticalUnit?"hint":"hidden",children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":l,className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:l})})}),(0,e.jsx)(s.SettingRow,{className:"match profile"===this.state.elevationType?"hint":"hidden",children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("matchProfileHint"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("matchProfileHint")})})}),(0,e.jsxs)(s.SettingRow,{className:"no elevation"===this.state.elevationType||"z"===this.state.elevationType||"match profile"===this.state.elevationType?"hidden":"",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("valueUnit"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("valueUnit")})}),(0,e.jsx)(i.Select,{"aria-label":this.state.elevationUnits,className:"selectOption",name:"valueunit",size:"sm",value:this.state.elevationUnits,onChange:this.onElevationValueUnitChange,children:T.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.value)},s))})]}),(0,e.jsxs)(s.SettingRow,{className:"pt-4 ep-divider-top",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("styleLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label title2 hint-paper",children:this.nls("displayFieldLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("displayFieldTooltip"),title:this.nls("displayFieldTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:Me.infoIcon})})})]}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(J.FieldSelector,{dataSources:[this.props.selectedLayerDataSource.layer],onChange:this.onDisplayFieldSelect.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,t.Immutable)(this.state.displayField),isMultiple:!1,noSelectionItem:this._defaultSelectedItem})}),(0,e.jsxs)(s.SettingRow,{className:"pt-4 ep-divider-top",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("styleLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label title2 hint-paper",children:this.nls("styleLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("stylePointTooltip"),title:this.nls("stylePointTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:Me.infoIcon})})})]}),(0,e.jsxs)(s.SettingRow,{className:"hidden",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("symbology"),className:"flex-grow-1 ep-label",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("symbology")})}),(0,e.jsx)(i.Select,{"aria-label":this.state.symbology,className:"selectOption",size:"sm",name:"symbology",value:this.state.symbology,onChange:this.onSymbologyChange,children:E.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.name)},s))})]}),(0,e.jsx)(Oe,{intl:this.props.intl,intersectingAssetItem:"style",config:this.state.style,layerGeometryType:n,onIntersectingAssetStyleChange:this.onIntersectingAssetStyleChange})]})})}}var Ne=h(48993);const{epConfigIcon:Ee}=j(),Pe=(0,t.getAppStore)().getState().portalSelf,ke={tags:["semi-opaque"],title:"Orange",style:"esriSFSSolid",color:[239,132,38,128],name:"Orange 1",type:"esriSFS",outline:{style:"esriSLSSolid",color:[184,115,59,255],width:1.5,type:"esriSLS"}};class Fe extends t.React.PureComponent{constructor(s){super(s),this.supportedDsTypes=(0,t.Immutable)([J.AllDataSourceTypes.FeatureLayer,J.AllDataSourceTypes.SubtypeSublayer,J.AllDataSourceTypes.SceneLayer]),this.mvManager=l.MapViewManager.getInstance(),this.selectedLayerDataSource=null,this.layerSidePopperTrigger=t.React.createRef(),this.backRef=t.React.createRef(),this.allSelectedLayers=[],this._jsonUtils=null,this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.componentDidMount=()=>{var e,t,i,s;this.state.apiLoaded||(0,l.loadArcGISJSAPIModules)(["esri/symbols/support/jsonUtils"]).then(e=>{[this._jsonUtils]=e,this.setState({apiLoaded:!0})}),0===(null===(t=null===(e=this.props.config)||void 0===e?void 0:e.layers)||void 0===t?void 0:t.length)?this.setState({selectedLayers:[]}):null===(s=null===(i=this.props.config)||void 0===i?void 0:i.layers)||void 0===s||s.forEach(e=>{this.getLayerListProperty(e.layerId),this.setState({selectedLayers:this.allSelectedLayers})})},this.getLayerListProperty=e=>{const i=t.DataSourceManager.getInstance().getDataSource(e);if(i){const e={label:i.getLabel(),layer:{id:i.id}};this.allSelectedLayers.push(e)}},this.componentDidUpdate=e=>{var i,s;t.lodash.isDeepEqual(null===(i=this.props.config)||void 0===i?void 0:i.layers,null===(s=e.config)||void 0===s?void 0:s.layers)||(this.allSelectedLayers=[],this.props.config.layers.forEach((e,t)=>{this.getLayerListProperty(e.layerId)}),this.setState({selectedLayers:this.allSelectedLayers}))},this.getDsRootIdsByWidgetId=()=>{var e,i;const s=[],a=(null===(i=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===i?void 0:i.appConfig).dataSources[this.props.activeDataSource];return(null==a?void 0:a.type)!==t.DataSourceTypes.WebMap&&(null==a?void 0:a.type)!==t.DataSourceTypes.WebScene||s.push(this.props.activeDataSource),s.length>0?(0,t.Immutable)(s):void 0},this.dataSourceChangeSave=e=>{var t;if(!e)return;let i=!1;if(this.allSelectedLayers.some(t=>{if(t.layer.id===e[0].dataSourceId)return i=!0,this.setState({isAlertMsgPopupOpen:!0}),!0}),!i){let i;e.forEach((e,t)=>{this.getLayerListProperty(e.dataSourceId)}),this.setState({selectedLayers:this.allSelectedLayers,assetLayerIndex:this.allSelectedLayers.length}),this.updateLayersConfig=this.getLayersDefaultSettings(this.allSelectedLayers),i=(null===(t=this.props.config)||void 0===t?void 0:t.layers)?[...this.props.config.layers,this.updateLayersConfig[0]]:[this.updateLayersConfig[0]],this.props.onAssetSettingsUpdated("assetSettings",this.props.activeDataSource,null,null,i,!0)}},this.getLayersDefaultSettings=e=>{var t,i;let s=[];return 0===(null===(i=null===(t=this.props.config)||void 0===t?void 0:t.layers)||void 0===i?void 0:i.length)?e.forEach((e,t)=>{s=this.getAssetDefaultConfigOnAdd(e.layer)}):e.forEach(e=>{this.isLayerAlreadyConfigured(e.layer.id)||(s=this.getAssetDefaultConfigOnAdd(e.layer))}),s},this.isLayerAlreadyConfigured=e=>{var t,i;let s=!1;return null===(i=null===(t=this.props.config)||void 0===t?void 0:t.layers)||void 0===i||i.forEach(t=>{if(e===t.layerId)return s=!0,!0}),s},this.showLayerData=(e,i)=>{var s,a,l,n,o;this.setSidePopperAnchor(i),this.setState({showLayerDataItemPanel:!0,layerName:e.label,assetLayerIndex:i},()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()});const r=t.DataSourceManager.getInstance().getDataSource(e.layer.id);this.selectedLayerDataSource={dataSourceId:r.id,rootDataSourceId:r.parentDataSource.id,layer:r},this.dsId=r.id,this.selectedLayerConfig=this.getSelectedLayerConfig(r.id),this.hasSupportForZValue=null===(s=null==r?void 0:r.layerDefinition)||void 0===s?void 0:s.hasZ,this._hasVerticalUnitParam=(null===(l=null===(a=null==r?void 0:r.layerDefinition)||void 0===a?void 0:a.sourceSpatialReference)||void 0===l?void 0:l.vcsWkid)||(null===(o=null===(n=null==r?void 0:r.layerDefinition)||void 0===n?void 0:n.sourceSpatialReference)||void 0===o?void 0:o.vcsWkt)},this.getSelectedLayerConfig=e=>{let t;return this.props.config.layers.forEach(i=>{e===i.layerId&&(t=i)}),t},this.removeLayerDataItem=(e,t,i)=>{var s,a;e.stopPropagation();const l=this.state.selectedLayers;l.splice(t,1),this.allSelectedLayers=l,this.setState({selectedLayers:this.allSelectedLayers,assetLayerIndex:t},()=>{this.setSidePopperAnchor(t),this.setState({assetLayerIndex:null})}),null===(a=null===(s=this.props.config)||void 0===s?void 0:s.layers)||void 0===a||a.forEach((e,t)=>{if(e.layerId===i){const e=this.props.config.layers.asMutable({deep:!0});e.splice(t,1),this.updateLayersConfig=e,this.props.onAssetSettingsUpdated("assetSettings",this.props.activeDataSource,null,null,this.updateLayersConfig,!0)}})},this.createLayerElement=(t,s)=>(0,e.jsxs)("div",{"aria-label":t.label,tabIndex:0,className:"layer-data-item align-items-center",children:[(0,e.jsx)("div",{className:"layer-data-item-name flex-grow-1",title:t.label,children:t.label}),(0,e.jsx)(i.Button,{role:"button",title:this.nls("deleteLayer"),"aria-label":this.nls("deleteLayer"),size:"sm",type:"tertiary",icon:!0,className:"p-0",onClick:e=>{this.removeLayerDataItem(e,s,t.layer.id)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.removeLayerDataItem(e,s,t.layer.id)},children:(0,e.jsx)(i.Icon,{icon:Ee.iconClose,size:12})},s+Date.now())]},s+Date.now()),this.getLayerIndex=e=>{let t=-1;return this.props.config.layers.forEach((i,s)=>{e===i.layerId&&(t=s)}),t},this.updateConfig=(e,t,i)=>{const s={parentKey:e,childKey:t,value:i},a=this.getLayerIndex(this.selectedLayerConfig.layerId);this.setState({assetLayerIndex:a}),this.props.onAssetSettingsUpdated("assetSettings",this.props.activeDataSource,a,s,null,!1)},this.closePanel=()=>{this.setSidePopperAnchor(this.state.assetLayerIndex),this.setState({showLayerDataItemPanel:!1,assetLayerIndex:null})},this.onIntersectingBufferChange=e=>{this.props.onAssetBufferSettingsUpdated("enabled",e.currentTarget.checked)},this.onBufferDistanceChange=e=>{this.props.onAssetBufferSettingsUpdated("bufferDistance",null!=e?e:0)},this.onBufferUnitsChange=e=>{const t=((e,t)=>{const i=y(t);return e>i?i:e})(this.props.config.assetIntersectingBuffer.bufferDistance,e.target.value);this.props.onAssetBufferSettingsUpdated("bufferDistance",t),setTimeout(()=>{this.props.onAssetBufferSettingsUpdated("bufferUnits",e.target.value)},50)},this.onBufferSymbolChanged=e=>{let t=e;null===e&&(t=this._jsonUtils.fromJSON(ke)),this.props.onAssetBufferSettingsUpdated("bufferSymbol",null==t?void 0:t.toJSON())},this.disableSelection=e=>!1,this.hideMessage=()=>{this.setState({isAlertMsgPopupOpen:!1})},this.setSidePopperAnchor=e=>{var t;const i=null===(t=this.layerSidePopperTrigger.current)||void 0===t?void 0:t.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:i})},this.updateLayersConfig=this.props.config.layers;const a=this.mvManager.jimuMapViewGroups[this.props.mapWidgetId];for(const e in a.jimuMapViews)a.jimuMapViews[e].dataSourceId===this.props.activeDataSource&&(this.mapView=a.jimuMapViews[e]);this.state={selectedLayers:[],showLayerDataItemPanel:!1,layerName:null,isAlertMsgPopupOpen:!1,apiLoaded:!1,popperFocusNode:null,assetLayerIndex:null}}getAssetDefaultConfigOnAdd(e){const i=t.DataSourceManager.getInstance().getDataSource(e.id),s=v(this.props.activeDsConfig,Pe),a=[];if(i&&i.layerDefinition&&i.layerDefinition.geometryType&&("esriGeometryPolyline"===i.layerDefinition.geometryType||"esriGeometryPoint"===i.layerDefinition.geometryType)){let e="no elevation";i.layerDefinition.hasZ&&(e="z");const l=Object.assign({},W);l.style.intersectingAssetColor=m(),l.elevationSettings.unit=s[0],l.layerId=i.id,l.elevationSettings.type=e,a.push((0,t.Immutable)(l))}return a}render(){var a,l,n,o,p,c,h,g,v,m,S,b,x,L,w;const I=(null===(l=null===(a=this.props.config)||void 0===a?void 0:a.assetIntersectingBuffer)||void 0===l?void 0:l.bufferSymbol)?null===(n=this._jsonUtils)||void 0===n?void 0:n.fromJSON(null===(o=this.props.config.assetIntersectingBuffer)||void 0===o?void 0:o.bufferSymbol):null===(p=this._jsonUtils)||void 0===p?void 0:p.fromJSON(ke),j=[],D=u(this.props.activeDataSource);null==D||D.forEach(e=>{var t,i;"esriGeometryPolyline"!==(null===(t=e.getLayerDefinition())||void 0===t?void 0:t.geometryType)&&"esriGeometryPoint"!==(null===(i=e.getLayerDefinition())||void 0===i?void 0:i.geometryType)||j.push(e.id)});const C={fromRootDsIds:this.getDsRootIdsByWidgetId(),fromDsIds:(0,t.Immutable)(j)};let O;return(null===(c=this.props.config.assetIntersectingBuffer)||void 0===c?void 0:c.hasOwnProperty("bufferUnits"))?(O=null===(h=this.props.config.assetIntersectingBuffer)||void 0===h?void 0:h.bufferUnits,""===(null===(g=this.props.config.assetIntersectingBuffer)||void 0===g?void 0:g.bufferUnits)&&(O=f(Pe))):O=f(Pe),(0,e.jsxs)("div",{css:r(this.props.theme),style:{height:"100%",width:"100%",marginTop:5},children:[(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("intersectingLayersLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break color-label",children:this.nls("intersectingLayersLabel")})}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("intersectingLayersTooltip"),title:this.nls("intersectingLayersTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline color-label",children:(0,e.jsx)(i.Icon,{size:14,icon:Ee.infoIcon})})})]}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(J.DataSourceSelector,{className:"ep-data-source-selector",types:this.supportedDsTypes,buttonLabel:this.nls("selectableButton"),fromRootDsIds:C.fromRootDsIds,fromDsIds:C.fromDsIds,mustUseDataSource:!0,onChange:this.dataSourceChangeSave,disableDataView:!0,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideTypeDropdown:!1,hideAddDataButton:!0,disableRemove:()=>!0,disableSelection:this.disableSelection,widgetId:this.props.widgetId,hideDataView:!0})}),0===this.state.selectedLayers.length&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("intersectingLayersWarning"),className:"hint w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("intersectingLayersWarning")})})}),this.state.selectedLayers.length>0&&(0,e.jsx)("div",{ref:this.layerSidePopperTrigger,tabIndex:-1,className:"w-100 mb-4 mt-4",children:(0,e.jsx)("div",{className:"ep-layers-list",children:(0,e.jsx)(H.List,{itemsJson:Array.from(this.state.selectedLayers).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`})),dndEnabled:!1,onClickItemBody:(e,t)=>{const{itemJsons:i}=t.props,s=i[0],a=i[1];this.showLayerData(s.itemStateDetailContent,a.indexOf(s))},overrideItemBlockInfo:()=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:i}=t.props,s=i[0],a=i[1];return this.createLayerElement(s.itemStateDetailContent,a.indexOf(s))}})})}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsxs)(i.Label,{className:"w-100 d-flex cursor-pointer",children:[(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:null===(v=this.props.config.assetIntersectingBuffer)||void 0===v?void 0:v.enabled,onChange:this.onIntersectingBufferChange,role:"checkbox","aria-label":this.nls("intersectingBufferSettingsLabel")}),(0,e.jsx)("div",{className:"flex-grow-1 text-break",children:this.nls("intersectingBufferSettingsLabel")})]}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("intersectingBufferSettingsTooltip"),title:this.nls("intersectingBufferSettingsTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:Ee.infoIcon})})})]}),(null===(m=this.props.config.assetIntersectingBuffer)||void 0===m?void 0:m.enabled)&&(0,e.jsx)("div",{className:"pt-2 pb-2","aria-expanded":null===(S=this.props.config.assetIntersectingBuffer)||void 0===S?void 0:S.enabled,children:(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsx)(i.NumericInput,{style:{width:55},"aria-label":O,title:(null===(b=this.props.config.assetIntersectingBuffer)||void 0===b?void 0:b.bufferDistance)+"",size:"sm",min:0,max:y(O),value:(null===(x=this.props.config.assetIntersectingBuffer)||void 0===x?void 0:x.bufferDistance)?null===(L=this.props.config.assetIntersectingBuffer)||void 0===L?void 0:L.bufferDistance:10,showHandlers:!1,onChange:this.onBufferDistanceChange}),(0,e.jsx)(i.Select,{"aria-label":O,style:{width:141},className:"pl-2 pr-2",size:"sm",name:"bufferUnits",value:O,onChange:this.onBufferUnitsChange,children:T.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.value)},s))}),I&&(0,e.jsx)(Ne.SymbolSelector,{jimuSymbolType:Ne.JimuSymbolType.Polygon,symbol:I,onPolygonSymbolChanged:this.onBufferSymbolChanged.bind(this)})]})}),(0,e.jsx)(s.SidePopper,{title:this.state.layerName,isOpen:this.state.showLayerDataItemPanel&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closePanel,trigger:null===(w=this.layerSidePopperTrigger)||void 0===w?void 0:w.current,backToFocusNode:this.state.popperFocusNode,children:(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:d(this.props.theme),children:(0,e.jsx)(Y,{theme:this.props.theme,intl:this.props.intl,title:this.state.layerName,ref:this.backRef,onBack:this.closePanel,children:(0,e.jsx)("div",{className:"setting-container",children:(0,e.jsx)(Ae,{intl:this.props.intl,theme:this.props.theme,config:this.getSelectedLayerConfig(this.dsId),hasSupportForZValue:this.hasSupportForZValue,selectedLayerDataSource:this.selectedLayerDataSource,hasVerticalUnit:this._hasVerticalUnitParam,updateAssetSettings:this.updateConfig.bind(this)})})})})}),this.state.isAlertMsgPopupOpen&&(0,e.jsx)(i.AlertPopup,{"aria-expanded":this.state.isAlertMsgPopupOpen,hideCancel:!0,isOpen:this.state.isAlertMsgPopupOpen&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,onClickOk:this.hideMessage.bind(this),onClickClose:this.hideMessage.bind(this),title:this.nls("alert"),children:(0,e.jsx)("div",{className:"p-2",children:this.nls("alreadySelectedLayerMsg")})})]})}}var Re=h(31027),Ue=h.n(Re),Ve=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i};const Be=i=>{const s=window.SVG,{className:a}=i,l=Ve(i,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",a);return s?(0,e.jsx)(s,Object.assign({className:n,src:Ue()},l)):(0,e.jsx)("svg",Object.assign({className:n},l))},{epConfigIcon:ze}=j();class We extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const t=Object.assign({},n,i.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:t[e]}):t[e]},this.updateNextSelectableLineStyle=(e,t,i)=>{var s,a,l,n,o,r;const d={lineType:"lineType"===t?i:null===(a=null===(s=this.props.config.selectionModeOptions)||void 0===s?void 0:s.style)||void 0===a?void 0:a.lineType,lineColor:"lineColor"===t?i:null===(n=null===(l=this.props.config.selectionModeOptions)||void 0===l?void 0:l.style)||void 0===n?void 0:n.lineColor,lineThickness:"lineThickness"===t?i:null===(r=null===(o=this.props.config.selectionModeOptions)||void 0===o?void 0:o.style)||void 0===r?void 0:r.lineThickness};this.props.onSelectableLayersStyleUpdated("style",d,!0)},this.onAddedLayersOptionChange=e=>{this.props.onSelectableLayersStyleUpdated("supportAddedLayers",e.currentTarget.checked,!1)},this.onActiveToolChange=e=>{this.props.onSelectableLayersStyleUpdated("selectionMode",e.target.value,!0)},this.state={color:""}}render(){var a,l;const n=this.props.config.selectionModeOptions.selectionMode;return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:5},css:(this.props.theme,t.css`
   .ep-divider-top {
      border-top: 1px solid var(--ref-palette-neutral-700)
    }
  `),children:(0,e.jsxs)("div",{children:[(0,e.jsx)(s.SettingRow,{className:"pt-4 ep-divider-top",label:this.nls("selectionModeLabel"),children:(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("nextSelectableTooltip"),title:this.nls("nextSelectableTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline color-label",children:(0,e.jsx)(i.Icon,{size:14,icon:ze.infoIcon})})})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Select,{"aria-label":this.nls("selectionModeLabel"),className:"selectOption",size:"sm",name:"selectionMode",value:n,onChange:this.onActiveToolChange,children:F.map((t,s)=>(0,e.jsx)(i.Option,{role:"option","aria-label":this.nls(t.name),value:t.value,children:this.nls(t.name)},s))})}),(null===(a=this.props.config.selectionModeOptions)||void 0===a?void 0:a.selectionMode)===D.Multiple&&(0,e.jsxs)(s.SettingRow,{flow:"wrap",children:[(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("nextSelectableOptionLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break",children:this.nls("nextSelectableOptionLabel")})}),(0,e.jsx)(K,{intl:this.props.intl,lineItem:"style",isNextSelectable:!0,onLineStyleChange:this.updateNextSelectableLineStyle,config:null===(l=this.props.config.selectionModeOptions)||void 0===l?void 0:l.style})]}),(0,e.jsxs)(s.SettingRow,{children:[(0,e.jsxs)(i.Label,{className:"w-100 d-flex cursor-pointer",children:[(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.props.config.supportAddedLayers,onChange:this.onAddedLayersOptionChange,role:"checkbox","aria-label":this.nls("supportAddedLayers"),"data-testid":"supportAddedLayersOption"}),(0,e.jsx)("div",{className:"flex-grow-1 text-break",children:this.nls("supportAddedLayers")})]}),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("supportAddedLayersTooltip"),title:this.nls("supportAddedLayersTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline",children:(0,e.jsx)(i.Icon,{size:14,icon:ze.infoIcon})})})]})]})})}}const{epConfigIcon:Ge}=j();class _e extends a.BaseWidgetSetting{constructor(e){var s;super(e),this._mvManager=l.MapViewManager.getInstance(),this.ElevationLayer=null,this._dataSourceOptions=[],this._mapLoadedTimer=null,this._mapViewGroupLoad=null,this.componentDidMount=()=>{var e,i,s;let a;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const s=null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0];(null===(i=(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===i?void 0:i[s])?(a=!1,this.createStatistics(),this.setState({useMapWidget:this.props.useMapWidgetIds},()=>{(0,l.loadArcGISJSAPIModules)(["esri/layers/ElevationLayer"]).then(e=>{[this.ElevationLayer]=e,this.getAvailableDataSources(this.props.useMapWidgetIds)})})):(this.resetConfig(this.props.useMapWidgetIds),a=!0)}else{a=!0;const e=this.props.config.set("configInfo",{}),i={id:this.props.id,useMapWidgetIds:(null===(s=this.props.useMapWidgetIds)||void 0===s?void 0:s.length)>0?this.props.useMapWidgetIds:null,config:e};i.useDataSources=(0,t.Immutable)([]),this.props.onSettingChange(i,[])}this.updateConfigForMapWidget(a)},this.componentDidUpdate=e=>{var i;if(e.label!==this.props.label){const e=[this.getInitOutDataSource()];setTimeout(()=>{this.props.onSettingChange({id:this.props.id,useDataSources:[]},e)},100)}if(e.config.activeDataSource!==this.props.config.activeDataSource||!this.props.config.configInfo[e.config.activeDataSource]||!t.lodash.isDeepEqual(this.props.useMapWidgetIds,e.useMapWidgetIds)){let e;(null===(i=this.props.useMapWidgetIds)||void 0===i?void 0:i.length)>0?(e=!1,(0,l.loadArcGISJSAPIModules)(["esri/layers/ElevationLayer"]).then(e=>{[this.ElevationLayer]=e,this.getAvailableDataSources(this.props.useMapWidgetIds)})):e=!0,this.updateConfigForMapWidget(e)}},this.nls=e=>{const s=Object.assign({},n,i.defaultMessages,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.updateConfigForMapWidget=e=>{this.setState({mapWidgetExists:!e,isNoMapSelected:e})},this.onMapWidgetSelected=e=>{let i;if(e.length>0)i=!1,this.createStatistics(),this.setState({useMapWidget:e},()=>{(0,l.loadArcGISJSAPIModules)(["esri/layers/ElevationLayer"]).then(t=>{[this.ElevationLayer]=t,this.getAvailableDataSources(e)})});else{i=!0;const s=this.props.config.set("configInfo",{}),a={id:this.props.id,useMapWidgetIds:(null==e?void 0:e.length)>0?e:null,config:s};a.useDataSources=(0,t.Immutable)([]),this.props.onSettingChange(a,[])}this.updateConfigForMapWidget(i)},this.createStatistics=()=>{const e=[];P.forEach(t=>{const i={name:t.value,label:this.nls(t.value),enabled:!0};e.push(i)}),e.sort((e,t)=>e.label.localeCompare(t.label)),this.setState({availableStats:e})},this.resetConfig=e=>{const i=[this.getInitOutDataSource()],s=this.props.config.set("configInfo",{}),a={id:this.props.id,useMapWidgetIds:(null==e?void 0:e.length)>0?e:null,config:s};0===(null==e?void 0:e.length)?(a.useDataSources=(0,t.Immutable)([]),this.props.onSettingChange(a,[])):this.props.onSettingChange(a,i)},this.getLayersAvailability=e=>{let t=!1,i=!1;const s=u(e);return null==s||s.forEach(e=>{var s,a,l;"esriGeometryPolyline"===(null===(s=e.getLayerDefinition())||void 0===s?void 0:s.geometryType)&&(t=!0),"esriGeometryPolyline"!==(null===(a=e.getLayerDefinition())||void 0===a?void 0:a.geometryType)&&"esriGeometryPoint"!==(null===(l=e.getLayerDefinition())||void 0===l?void 0:l.geometryType)||(i=!0)}),{hasLineLayers:t,hasPointLayers:i}},this.getConfigForSelectedDs=(e,t,i,s,a)=>{if(this.setState(this.getLayersAvailability(e)),!t.configInfo.hasOwnProperty(e)){const i=U,l=[];let n=[];if("2d"===a){if(!s.length){const e=new this.ElevationLayer({url:C});n.push({id:x(),useDataSource:null,label:e.title,elevationLayerUrl:C,style:{lineType:"solid-line",lineColor:"#b54900",lineThickness:2},displayStatistics:!0,selectedStatistics:this.state.availableStats})}}else n=[];null==s||s.forEach((t,i)=>{const s={dataSourceId:e+"-"+t.groundElevationLayerId,mainDataSourceId:e+"-"+t.groundElevationLayerId,rootDataSourceId:e};l.push({id:x(),useDataSource:s,label:t.groundElevationLayerLabel,elevationLayerUrl:t.groundElevationLayerUrl,style:{lineType:"solid-line",lineColor:0===i?"#b54900":m(),lineThickness:2},displayStatistics:!0,selectedStatistics:this.state.availableStats})});const o=s.length?l:n;return i.elevationLayersSettings.addedElevationLayers=o,i.elevationLayersSettings.groundLayerId=o[0]?o[0].id:null,i.elevationLayersSettings.volumetricObjSettingsOptions.volumetricObjLabel=this.nls("volumetricObjectsLabel"),i.elevationLayersSettings.volumetricObjSettingsOptions.selectedStatistics=this.state.availableStats,i.profileSettings.layers="default"!==e?this.populateDefaultProfileSettings(e):[],t.setIn(["configInfo",e],i)}return t},this.getInitOutDataSource=()=>{const e=Object.assign({},i.defaultMessages),s=this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:e.outputStatistics},{name:this.props.label}),a=`${this.props.widgetId}-output`,l=this.getInitSchema(s);return{id:a,type:t.DataSourceTypes.FeatureLayer,label:s,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:l,geometryType:"esriGeometryPolyline"}},this.getInitSchema=(e="")=>{const i={},s=[];return s.push({alias:this.nls("name"),type:t.JimuFieldType.Number,jimuName:"name",name:"name"},{alias:"OBJECTID",type:t.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"}),P.forEach(e=>{const i=this.nls(e.value).replace(/ /g,"");s.push({alias:i,type:t.JimuFieldType.String,jimuName:e.value,name:e.value})}),null==s||s.forEach((e,t)=>{i[null==e?void 0:e.jimuName]=e,0===t&&(i.OBJECTID=e)}),{label:e,idField:"OBJECTID",fields:i}},this.populateDefaultProfileSettings=e=>{const i=[],s=u(e),a=v(this.props.config.configInfo[e],this.props.portalSelf);return null==s||s.forEach(e=>{var s,l,n,o;if("esriGeometryPolyline"===(null===(s=e.getLayerDefinition())||void 0===s?void 0:s.geometryType)){let s="no elevation";e.getLayerDefinition().hasZ&&(s="z");const r=Object.assign({},z);(null===(l=null==e?void 0:e.getLayerDefinition())||void 0===l?void 0:l.hasGeometryProperties)&&(null===(o=null===(n=null==e?void 0:e.getLayerDefinition())||void 0===n?void 0:n.geometryProperties)||void 0===o?void 0:o.shapeLengthFieldName)&&(r.distanceSettings.field=e.getLayerDefinition().geometryProperties.shapeLengthFieldName);const d=Object.assign({},r);d.layerId=e.id,d.elevationSettings.type=s,d.elevationSettings.unit=a[0],d.distanceSettings.unit=a[1],d.style.lineColor=m(),i.push((0,t.Immutable)(d))}}),i},this.getDataSourceLabel=e=>{if(!e)return"";return t.DataSourceManager.getInstance().getDataSource(e).getLabel()||e},this.updateConfigAsPerNewWebMap=e=>{var i,s;const a=[];let l=e.configInfo.asMutable({deep:!0});if(this.state.useMapWidget){const t=this.getMapViewGroupInstance(this.state.useMapWidget[0]),n=t[0],o=t[1];if(n&&n.jimuMapViews)for(const e in n.jimuMapViews)n.jimuMapViews[e].dataSourceId?a.push(n.jimuMapViews[e].dataSourceId):a.push("default");if(2!==(null===(s=null===(i=null==o?void 0:o.props)||void 0===i?void 0:i.useDataSources)||void 0===s?void 0:s.length))for(const t in l)"useMapWidgetIds"===t||"activeDataSource"===t||a.includes(t)?l=this.updateLayersFromConfig(t,e):delete l[t]}return e.set("configInfo",(0,t.Immutable)(l))},this.updateLayersFromConfig=(e,t)=>{var i,s,a,l;const n=[],o=[],r=[],d=[],p=t.configInfo.asMutable({deep:!0}),c=t.configInfo.asMutable({deep:!0}),h=u(e);return null==h||h.forEach(e=>{e&&e.getLayerDefinition()&&e.getLayerDefinition().geometryType&&("esriGeometryPoint"===e.getLayerDefinition().geometryType?n.push(e.id):"esriGeometryPolyline"===e.getLayerDefinition().geometryType&&o.push(e.id))}),null===(s=null===(i=p[e].profileSettings)||void 0===i?void 0:i.layers)||void 0===s||s.forEach((t,i)=>{o.includes(t.layerId)?d.push(t.layerId):c[e].profileSettings.layers.splice(i,1)}),null===(l=null===(a=p[e].assetSettings)||void 0===a?void 0:a.layers)||void 0===l||l.forEach((t,i)=>{n.includes(t.layerId)||o.includes(t.layerId)?r.push(t.layerId):c[e].assetSettings.layers.splice(i,1)}),c},this.getMapViewGroupInstance=e=>{var t,i,s,a,l;const n=this._mvManager.getJimuMapViewGroup(e);let o=n,r=null==o?void 0:o.mapWidgetInstance;if(this._mapViewGroupLoad&&clearInterval(this._mapViewGroupLoad),n){const e=n.mapWidgetId+"-"+(null===(i=null===(t=r.props.useDataSources)||void 0===t?void 0:t[0])||void 0===i?void 0:i.dataSourceId),d=n.mapWidgetId+"-"+(null===(a=null===(s=r.props.useDataSources)||void 0===s?void 0:s[1])||void 0===a?void 0:a.dataSourceId);2===(null===(l=r.props.useDataSources)||void 0===l?void 0:l.length)&&(n.jimuMapViews.hasOwnProperty(e)&&n.jimuMapViews.hasOwnProperty(d)?(o=n,r=o.mapWidgetInstance):this._mapViewGroupLoad=setTimeout(()=>{this.getAvailableDataSources(this.props.useMapWidgetIds)},50))}return[o,r]},this.getAvailableDataSources=e=>{this._dataSourceOptions=[];let i=this.props.config.configInfo[this.state.activeDataSource]?this.props.config:this.props.config.set("configInfo",{});const s=[this.getInitOutDataSource()];this._mapViewGroupLoad&&clearInterval(this._mapViewGroupLoad);const a=this.getMapViewGroupInstance(e)[0];if(a&&a.jimuMapViews){this._mapLoadedTimer&&clearInterval(this._mapLoadedTimer);for(const e in a.jimuMapViews)this.mapView=a.jimuMapViews[e];(l=this.mapView,c(void 0,void 0,void 0,function*(){yield null==l?void 0:l.whenAllJimuLayerViewLoaded();const e=t.DataSourceManager.getInstance().getDataSource(null==l?void 0:l.dataSourceId);return(null==e?void 0:e.isDataSourceSet())&&!e.areChildDataSourcesCreated()?e.childDataSourcesReady().then(()=>e).catch(t=>e):Promise.resolve(e)})).finally(()=>{this.setState({showLoadingIndicator:!1});for(const e in a.jimuMapViews)if(a.jimuMapViews[e].dataSourceId){const t=[],s=a.jimuMapViews[e].view.map.ground.layers,l=a.jimuMapViews[e].view.type;let n=!1;s.length>0&&(n=!0),s.length>0&&s.forEach(e=>{t.push({groundElevationLayerUrl:null==e?void 0:e.url,groundElevationLayerLabel:null==e?void 0:e.title,groundElevationLayerId:null==e?void 0:e.id})}),i=this.getConfigForSelectedDs(a.jimuMapViews[e].dataSourceId,i,n,t,l),i=this.checkBackwardForAdvanceOption(i),(a.jimuMapViews[e].isActive||void 0===a.jimuMapViews[e].isActive)&&(i=i.set("activeDataSource",a.jimuMapViews[e].dataSourceId),this.setState({activeDataSource:a.jimuMapViews[e].dataSourceId}));this.canAddDataSource(a.jimuMapViews[e].dataSourceId)&&this._dataSourceOptions.push({label:this.getDataSourceLabel(a.jimuMapViews[e].dataSourceId),value:a.jimuMapViews[e].dataSourceId})}if(0===this._dataSourceOptions.length&&a&&a.jimuMapViews)for(const e in a.jimuMapViews){let t=!1;const s=[],l=a.jimuMapViews[e].view.map.ground.layers,n=a.jimuMapViews[e].view.type;l.length>0&&(null==l||l.forEach(e=>{s.push({groundElevationLayerUrl:null==e?void 0:e.url,groundElevationLayerLabel:null==e?void 0:e.title,groundElevationLayerId:null==e?void 0:e.id})}),t=!0),i=i.set("activeDataSource","default"),this.setState({activeDataSource:"default"}),i=this.getConfigForSelectedDs("default",i,t,l,n)}i=this.updateConfigAsPerNewWebMap(i);const l={id:this.props.id,useMapWidgetIds:(null==e?void 0:e.length)>0?e:null,config:i,useDataSources:0===this._dataSourceOptions.length?[]:b(i.configInfo)};0===(null==e?void 0:e.length)?(l.useDataSources=(0,t.Immutable)([]),this.props.onSettingChange(l,[])):this.props.onSettingChange(l,s)})}else this._mapLoadedTimer=setTimeout(()=>{this.getAvailableDataSources(e)},50);var l},this.canAddDataSource=e=>{let t=!0;return this._dataSourceOptions.forEach(i=>{i.value===e&&(t=!1)}),t},this.checkBackwardForAdvanceOption=e=>{var t,i,s,a;let l;if((null===(t=null==e?void 0:e.configInfo)||void 0===t?void 0:t[this.state.activeDataSource])&&(null===(i=null==e?void 0:e.configInfo)||void 0===i?void 0:i[this.state.activeDataSource].hasOwnProperty("advanceOptions"))){l=e.setIn(["configInfo",this.state.activeDataSource,"profileSettings","isProfileSettingsEnabled"],!0);const t=null===(a=null===(s=null==e?void 0:e.configInfo)||void 0===s?void 0:s[this.state.activeDataSource])||void 0===a?void 0:a.advanceOptions;l=l.setIn(["configInfo",this.state.activeDataSource,"profileSettings","isCustomizeOptionEnabled"],t);const i=l.configInfo[this.state.activeDataSource],n=Object.assign({},i);return delete n.advanceOptions,l=e.setIn(["configInfo",this.state.activeDataSource],n),l}return e},this.updateAssetOrProfileLayersSettings=(e,i,s,a,l,n)=>{var o,r;let d,p,c,h=this.props.config;if(n&&null===s)h=this.props.config.setIn(["configInfo",i,e,"layers"],(0,t.Immutable)(l));else if(null!==s){p=null===(o=this.props.config.configInfo[i][e].layers[s])||void 0===o?void 0:o.asMutable({deep:!0}),a.childKey?p[a.parentKey][a.childKey]=a.value:p[a.parentKey]=a.value,c=null===(r=this.props.config.configInfo[i][e].layers)||void 0===r?void 0:r.asMutable({deep:!0}),c.splice(s,1,p),d=(0,t.Immutable)(c);const l=d.filter((e,t)=>t===d.findIndex(t=>t.layerId===e.layerId));h=this.props.config.setIn(["configInfo",i,e,"layers"],l)}const g=b(this.props.config.configInfo);this.props.onSettingChange({id:this.props.id,config:h,useDataSources:g})},this.showDsPanel=e=>{const t=this.getLayersAvailability(e);this.setState({activeDataSource:e,showLayersSettings:!1,hasLineLayers:t.hasLineLayers,hasPointLayers:t.hasPointLayers},()=>{this.setState({showLayersSettings:!0})})},this.onToggleElevationLayersSettings=()=>{this.setState({isElevationLayersSettingsOpen:!this.state.isElevationLayersSettingsOpen})},this.handleProfileRendering=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileSettings","isCustomizeOptionEnabled"],e)})},this.profileSettingsChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileSettings","isProfileSettingsEnabled"],e.target.checked)})},this.updateSelectableLayersStyle=(e,t,i)=>{i?this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileSettings","selectionModeOptions",e],t)}):this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"profileSettings",e],t)})},this.assetSettingsChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"assetSettings","isAssetSettingsEnabled"],e.target.checked)})},this.updateAssetBufferSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"assetSettings","assetIntersectingBuffer",e],t)})},this.updateElevationLayersSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"elevationLayersSettings",e],t)})},this.updateGeneralSettings=(e,t,i)=>{i?this.props.onSettingChange({id:this.props.id,config:this.props.config.set(e,t)}):this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings",e],t)})},this.state={showLayersSettings:!1,dataSourceName:"",isElevationLayersSettingsOpen:!0,activeDataSource:this.props.config.activeDataSource?this.props.config.activeDataSource:null,availableStats:[],isNoMapSelected:!0,mapWidgetExists:!0,useMapWidget:null,showLoadingIndicator:!0,hasLineLayers:!1,hasPointLayers:!1},this.isRTL=!1;const a=(0,t.getAppStore)().getState();this.isRTL=null===(s=null==a?void 0:a.appContext)||void 0===s?void 0:s.isRTL}render(){var a,l,n,o,r,d,p,c,h,g,u,v,m,y,f,S,b,x,L,w;return(0,e.jsxs)("div",{className:"jimu-widget-setting widget-setting-elevation-profile h-100",css:(w=this.props.theme,t.css`
    &.widget-setting-elevation-profile {
      height: 100%;

      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }

      .hidden {
        display: none;
      }

      .jimu-tree {
        width: 100%;
      }

      .data-item {
        display: flex;
        flex: 1;
        padding: 0.5rem 0.6rem;
        line-height: 23px;
        cursor: pointer;

        .data-item-name {
          word-break: break-word;
        }
      }

      .warningMsg {
        padding: 0.25rem!important;
        margin-top: -7px;
      }

      .warningMsg .left-part {
        margin-right: 0 !important;
      }

      .color-label {
        color: ${w.ref.palette.neutral[900]};
      }

      .ep-tooltip {
        margin-right: 0.30rem!important;
      }

      .ep-section-title {
        color: var(--ref-palette-neutral-1100);
      }

      .mapSettingsHint {
        color: var(--ref-palette-neutral-1000);
        font-size: ${t.polished.rem(13)};
      }

      .placeholder-container {
        height: calc(100vh - 468px);

        .placeholder {
          flex-direction: column;

          .icon {
            color: var(--ref-palette-neutral-800);
          }

          .hint {
            font-size: ${t.polished.rem(14)};
            font-weight: 500;
            color: var(--ref-palette-neutral-1000);
            max-width: ${t.polished.rem(160)};
          }
        }
      }

      .jimu-alert-panel {
        min-width: auto;
      }
    }
  `),children:[(0,e.jsxs)(s.SettingSection,{className:(0,t.classNames)("map-selector-section",{"border-0":this.state.isNoMapSelected}),children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("selectMapWidget"),title:this.nls("selectMapWidget"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("selectMapWidget")})})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(s.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds})})]}),this.state.isNoMapSelected&&(0,e.jsx)("div",{className:"d-flex placeholder-container justify-content-center align-items-center",children:(0,e.jsxs)("div",{className:"d-flex text-center placeholder justify-content-center align-items-center ",children:[(0,e.jsx)(Be,{size:48,className:"d-flex icon mb-2"}),(0,e.jsx)("p",{className:"hint",children:this.nls("selectMapHint")})]})}),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&(0,e.jsxs)("div",{children:[(0,e.jsxs)(s.SettingSection,{children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("dataConfigLabel"),title:this.nls("dataConfigLabel"),className:"w-100 d-flex",style:{maxWidth:"88%"},children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label title2 hint-paper",children:this.nls("dataConfigLabel")})})}),(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("dataConfigTooltip"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break mapSettingsHint",children:this.nls("dataConfigTooltip")})})}),(0,e.jsxs)(s.SettingRow,{children:[this.state.showLoadingIndicator&&(0,e.jsx)(i.Loading,{type:i.LoadingType.Secondary}),!this.state.showLoadingIndicator&&this.props.config.configInfo[this.state.activeDataSource]&&(0,e.jsx)("div",{className:"w-100",children:(0,e.jsx)(s.MultipleJimuMapConfig,{mapWidgetId:null===(a=this.props.useMapWidgetIds)||void 0===a?void 0:a[0],onClick:this.showDsPanel,showDefaultMapWhenEmpty:!0,sidePopperContent:(0,e.jsx)(t.React.Fragment,{children:this.state.activeDataSource&&this.props.config.configInfo[this.state.activeDataSource]&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingSection,{children:(0,e.jsx)(i.CollapsablePanel,{label:this.nls("elevationLayers"),"aria-label":this.nls("elevationLayers"),isOpen:this.state.isElevationLayersSettingsOpen,onRequestOpen:()=>{this.onToggleElevationLayersSettings()},onRequestClose:()=>{this.onToggleElevationLayersSettings()},children:(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(Le,{intl:this.props.intl,theme:this.props.theme,widgetId:this.props.id,currentDs:this.state.activeDataSource,mapWidgetId:null===(l=this.props.useMapWidgetIds)||void 0===l?void 0:l[0],config:this.props.config.configInfo[this.state.activeDataSource].elevationLayersSettings,isRTL:this.isRTL,availableStats:this.state.availableStats,onElevationLayersSettingsUpdated:this.updateElevationLayersSettings})})})}),(0,e.jsx)(s.SettingSection,{children:(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,e.jsx)("div",{className:"flex-grow-1 text-break title2 text-paper",children:this.nls("profileSettingsLabel")}),children:(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("profileSettingsLabel"),title:this.nls("profileSettingsLabel"),checked:null===(n=this.props.config.configInfo[this.state.activeDataSource])||void 0===n?void 0:n.profileSettings.isProfileSettingsEnabled,disabled:0===(null===(o=this.props.config.configInfo[this.state.activeDataSource])||void 0===o?void 0:o.elevationLayersSettings.addedElevationLayers.length),"aria-expanded":null===(r=this.props.config.configInfo[this.state.activeDataSource])||void 0===r?void 0:r.profileSettings.isProfileSettingsEnabled,onChange:this.profileSettingsChange})}),(null===(d=this.props.config.configInfo[this.state.activeDataSource])||void 0===d?void 0:d.profileSettings.isProfileSettingsEnabled)&&(0,e.jsxs)(t.React.Fragment,{children:[!this.state.hasLineLayers&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Alert,{tabIndex:0,className:"warningMsg py-1",style:{minWidth:"auto"},open:!0,text:this.nls("noLineLayersMessage"),type:"info"})}),(0,e.jsx)(s.SettingRow,{label:this.nls("profileRendering"),children:(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("profileRenderingTooltip"),title:this.nls("profileRenderingTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline color-label",children:(0,e.jsx)(i.Icon,{size:14,icon:Ge.infoIcon})})})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsxs)(i.Label,{className:"m-0 color-label",centric:!0,children:[(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("groundElevation"),className:"cursor-pointer",value:"groundElevation",onChange:()=>{this.handleProfileRendering(!1)},checked:!(null===(p=this.props.config.configInfo[this.state.activeDataSource])||void 0===p?void 0:p.profileSettings.isCustomizeOptionEnabled)}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleProfileRendering(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleProfileRendering(!1)},children:this.nls("groundElevation")})]})}),this.state.hasLineLayers&&!(null===(c=this.props.config.configInfo[this.state.activeDataSource])||void 0===c?void 0:c.profileSettings.isCustomizeOptionEnabled)&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("groundElevationHint"),className:"w-100 d-flex",children:(0,e.jsx)("div",{style:{fontStyle:"italic"},className:"flex-grow-1 text-break title3 hint-default",children:this.nls("groundElevationHint")})})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsxs)(i.Label,{className:"m-0 color-label",centric:!0,children:[(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("customizeSelectableLayersLabel"),className:"cursor-pointer",value:"customizeSelectableLayersLabel",onChange:()=>{this.handleProfileRendering(!0)},checked:null===(h=this.props.config.configInfo[this.state.activeDataSource])||void 0===h?void 0:h.profileSettings.isCustomizeOptionEnabled}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleProfileRendering(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleProfileRendering(!0)},children:this.nls("customizeSelectableLayersLabel")})]})}),(null===(g=this.props.config.configInfo[this.state.activeDataSource])||void 0===g?void 0:g.profileSettings.isCustomizeOptionEnabled)&&this.state.showLayersSettings&&(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(te,{widgetId:this.props.widgetId,intl:this.props.intl,theme:this.props.theme,activeDsConfig:this.props.config.configInfo[this.state.activeDataSource],config:this.props.config.configInfo[this.state.activeDataSource].profileSettings,onProfileSettingsUpdated:this.updateAssetOrProfileLayersSettings,activeDataSource:this.state.activeDataSource,mapWidgetId:null===(u=this.props.useMapWidgetIds)||void 0===u?void 0:u[0]})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(We,{intl:this.props.intl,theme:this.props.theme,currentDs:this.state.activeDataSource,config:this.props.config.configInfo[this.state.activeDataSource].profileSettings,onSelectableLayersStyleUpdated:this.updateSelectableLayersStyle})})]})]})}),(0,e.jsx)(s.SettingSection,{children:(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,e.jsx)("div",{className:"flex-grow-1 text-break title2 text-paper",children:this.nls("assetSettingsLabel")}),children:(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("assetSettingsLabel"),title:this.nls("assetSettingsLabel"),checked:(null===(m=null===(v=this.props.config.configInfo[this.state.activeDataSource])||void 0===v?void 0:v.assetSettings)||void 0===m?void 0:m.isAssetSettingsEnabled)||!1,disabled:0===(null===(y=this.props.config.configInfo[this.state.activeDataSource])||void 0===y?void 0:y.elevationLayersSettings.addedElevationLayers.length),"aria-expanded":(null===(S=null===(f=this.props.config.configInfo[this.state.activeDataSource])||void 0===f?void 0:f.assetSettings)||void 0===S?void 0:S.isAssetSettingsEnabled)||!1,onChange:this.assetSettingsChange})}),(null===(x=null===(b=this.props.config.configInfo[this.state.activeDataSource])||void 0===b?void 0:b.assetSettings)||void 0===x?void 0:x.isAssetSettingsEnabled)&&this.state.showLayersSettings&&(0,e.jsxs)(t.React.Fragment,{children:[!this.state.hasLineLayers&&!this.state.hasPointLayers&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Alert,{tabIndex:0,className:"warningMsg py-1",style:{minWidth:"auto"},open:!0,text:this.nls("noLinePointLayersMessage"),type:"info"})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(Fe,{widgetId:this.props.widgetId,intl:this.props.intl,theme:this.props.theme,activeDsConfig:this.props.config.configInfo[this.state.activeDataSource],config:this.props.config.configInfo[this.state.activeDataSource].assetSettings,activeDataSource:this.state.activeDataSource,mapWidgetId:null===(L=this.props.useMapWidgetIds)||void 0===L?void 0:L[0],onAssetSettingsUpdated:this.updateAssetOrProfileLayersSettings,onAssetBufferSettingsUpdated:this.updateAssetBufferSettings})})]})]})})]})})})})]}),"default"===this.state.activeDataSource&&(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Alert,{tabIndex:0,className:"warningMsg py-1",open:"default"===this.state.activeDataSource,text:this.nls("warningMsgIfDefaultDs"),type:"info"})})]}),this.state.activeDataSource&&(0,e.jsxs)(s.SettingSection,{children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("generalSettingsLabel"),title:this.nls("generalSettingsLabel"),className:"w-100 d-flex",style:{maxWidth:"88%"},children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label title2 hint-paper",children:this.nls("generalSettingsLabel")})})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",children:(0,e.jsx)(Te,{intl:this.props.intl,theme:this.props.theme,config:this.props.config.generalSettings,onGeneralSettingsUpdated:this.updateGeneralSettings})})]})]})]})}}function He(e){h.p=e}})(),g})())}}});