System.register(["jimu-core/emotion","jimu-core","jimu-ui"],function(e,t){var s={},i={},r={};return{setters:[function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){i.BaseWidget=e.BaseWidget,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.SessionManager=e.SessionManager,i.css=e.css,i.defaultMessages=e.defaultMessages,i.esri=e.esri,i.getAppStore=e.getAppStore,i.lodash=e.lodash,i.urlUtils=e.urlUtils},function(e){r.Alert=e.Alert,r.Button=e.Button,r.Checkbox=e.Checkbox,r.Col=e.Col,r.FormGroup=e.FormGroup,r.Icon=e.Icon,r.Input=e.Input,r.InputGroup=e.InputGroup,r.Label=e.Label,r.ListGroup=e.ListGroup,r.Modal=e.Modal,r.ModalBody=e.ModalBody,r.ModalFooter=e.ModalFooter,r.ModalHeader=e.ModalHeader,r.Pagination=e.Pagination,r.Paper=e.Paper,r.Popper=e.Popper,r.Select=e.Select,r.Switch=e.Switch,r.Table=e.Table,r.TextArea=e.TextArea,r.TextInput=e.TextInput,r.Tooltip=e.Tooltip,r.WidgetPlaceholder=e.WidgetPlaceholder,r.defaultMessages=e.defaultMessages}],execute:function(){e((()=>{var e={8363:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M8 2.5A2.5 2.5 0 0 1 10.5 0h7A2.5 2.5 0 0 1 20 2.5v9a2.5 2.5 0 0 1-2.5 2.5H16v.5a2.5 2.5 0 0 1-2.5 2.5H12v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2v-.5A2.5 2.5 0 0 1 6.5 3H8zM5 6h5a2 2 0 0 1 2 2v8h1.5a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 4h-7A1.5 1.5 0 0 0 5 5.5zm12.5 7H16V5.5A2.5 2.5 0 0 0 13.5 3H9v-.5A1.5 1.5 0 0 1 10.5 1h7A1.5 1.5 0 0 1 19 2.5v9a1.5 1.5 0 0 1-1.5 1.5M2 7h8a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},10540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},14321:e=>{"use strict";e.exports=r},18732:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26"><g fill="none" fill-rule="evenodd"><circle cx="13" cy="13" r="13" fill="#6A6A6A"></circle><path fill="#A8A8A8" d="M13 17a10 10 0 0 1 8.913 5.462A12.95 12.95 0 0 1 13 26c-3.45 0-6.586-1.344-8.914-3.537A10 10 0 0 1 13 17m0-12a5 5 0 1 1 0 10 5 5 0 0 1 0-10"></path></g></svg>'},18759:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M11 2v13h-1V2H6v13H5V2H1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2zM2 0h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2"></path></svg>'},21601:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M12.827 16a.5.5 0 0 1-.5-.5V.8a.8.8 0 0 1 1.407-.52l2.146 3.008a.5.5 0 0 1-.76.652l-1.793-2.598V15.5a.5.5 0 0 1-.5.5M.5 0h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1m0 7.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1m0 7.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1"></path></svg>'},26635:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var i=s(31601),r=s.n(i),o=s(76314),n=s.n(o)()(r());n.push([e.id,'.textAreaStyle{width:98%}.flexColumn1{flex:1;flex-Direction:"column";display:"flex"}.mobileContainer{position:absolute;bottom:0;width:100%;height:50px}',""]);const a=n},31601:e=>{"use strict";e.exports=function(e){return e[1]}},41113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},42449:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M2 28h28a2 2 0 1 1 0 4H2a2 2 0 1 1 0-4m8.025-3.239-2.278.253a3.2 3.2 0 0 1-3.534-3.534l.253-2.278a6.4 6.4 0 0 1 1.835-3.819L17.913 3.771a5.332 5.332 0 1 1 7.542 7.542L13.843 22.925a6.4 6.4 0 0 1-3.819 1.835z"></path></svg>'},53071:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},55056:(e,t,s)=>{"use strict";e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},58034:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M12.827 0a.5.5 0 0 1 .5.5v14.158l1.794-2.598a.5.5 0 1 1 .759.652l-2.146 3.008a.8.8 0 0 1-1.407-.52V.5a.5.5 0 0 1 .5-.5M.5 16a.5.5 0 0 1 0-1h9a.5.5 0 0 1 0 1zm0-7.5a.5.5 0 0 1 0-1h9a.5.5 0 0 1 0 1zM.5 1a.5.5 0 0 1 0-1h9a.5.5 0 0 1 0 1z"></path></svg>'},67106:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M16 32c8.837 0 16-7.163 16-16S24.837 0 16 0 0 7.163 0 16s7.163 16 16 16m0-4.571C9.688 27.429 4.571 22.312 4.571 16S9.688 4.571 16 4.571 27.429 9.688 27.429 16 22.312 27.429 16 27.429"></path></svg>'},67386:e=>{"use strict";e.exports=s},75625:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M8 0a4 4 0 0 1 4 4v3a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2V4a4 4 0 0 1 4-4m4 8H4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1M8 9v1h1v1H8v1h1v1H8v1H7V9zm0-8a3 3 0 0 0-3 3v3h1V4a2 2 0 1 1 4 0v3h1V4a3 3 0 0 0-3-3m0 2a1 1 0 0 0-1 1v3h2V4a1 1 0 0 0-1-1"></path></svg>'},76314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var s="",i=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),i&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),i&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s}).join("")},t.i=function(e,s,i,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(n[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);i&&n[h[0]]||(void 0!==o&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=o),s&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=s):h[2]=s),r&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=r):h[4]="".concat(r)),t.push(h))}},t}},77659:e=>{"use strict";var t={};e.exports=function(e,s){var i=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},79244:e=>{"use strict";e.exports=i},80261:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill-rule="evenodd" d="M3.5 3.5v-3a.5.5 0 0 1 1 0v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1z"></path></svg>'},84802:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},85072:e=>{"use strict";var t=[];function s(e){for(var s=-1,i=0;i<t.length;i++)if(t[i].identifier===e){s=i;break}return s}function i(e,i){for(var o={},n=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],h=o[c]||0,d="".concat(c," ").concat(h);o[c]=h+1;var u=s(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(p);else{var f=r(p,i);i.byIndex=a,t.splice(a,0,{identifier:d,updater:f,references:1})}n.push(d)}return n}function r(e,t){var s=t.domAPI(t);s.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,r){var o=i(e=e||[],r=r||{});return function(e){e=e||[];for(var n=0;n<o.length;n++){var a=s(o[n]);t[a].references--}for(var l=i(e,r),c=0;c<o.length;c++){var h=s(o[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}o=l}}},93226:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M13.444 3.582A7.01 7.01 0 0 0 8 1 7.014 7.014 0 0 0 1.05 7.03q-.025.183-.044.477A.525.525 0 0 1 .481 8 .48.48 0 0 1 0 7.492Q.017 7.2.04 7.016C.526 3.062 3.904 0 8 0c2.482 0 4.7 1.124 6.172 2.89l.19-1.356a.502.502 0 0 1 .994.138l-.441 3.126-3.03-.425a.5.5 0 0 1 .14-.99zM1.936 13.236l-.163 1.322a.502.502 0 0 1-.996-.121l.387-3.133 3.036.371a.5.5 0 0 1-.122.993l-1.463-.179A7.01 7.01 0 0 0 8 15a7.014 7.014 0 0 0 6.947-6q.028-.192.048-.507A.526.526 0 0 1 15.519 8a.48.48 0 0 1 .48.507 8 8 0 0 1-.042.505C15.458 12.952 12.087 16 8 16a8 8 0 0 1-6.064-2.764"></path></svg>'},97825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var r=void 0!==s.layer;r&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,r&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var o=s.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function o(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={id:s,exports:{}};return e[s](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="",o.nc=void 0;var n={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(n),o.d(n,{__set_webpack_public_path__:()=>U,default:()=>_});var e=o(67386),t=o(79244),s=o(14321),i=o(85072),r=o.n(i),a=o(97825),l=o.n(a),c=o(77659),h=o.n(c),d=o(55056),u=o.n(d),p=o(10540),f=o.n(p),g=o(41113),m=o.n(g),v=o(26635),S={};S.styleTagTransform=m(),S.setAttributes=u(),S.insert=h().bind(null,"head"),S.domAPI=l(),S.insertStyleElement=f();r()(v.A,S);v.A&&v.A.locals&&v.A.locals;var x=function(e,t,s,i){return new(s||(s=Promise))(function(r,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,a)}l((i=i.apply(e,t||[])).next())})};class y{constructor(){this.defaultVersion="sde.DEFAULT",this.isOrgUser=!1,this.uniqueURLs=[]}static getInstance(){return y.instance||(y.instance=new y),y.instance}getUniqueVMSURL(e){return new Promise((s,i)=>{const r=t.DataSourceManager.getInstance().getDataSources(),o=[],n=[];for(const s in r)if(e){if(s.includes(e)&&r[s].type===t.DataSourceTypes.FeatureLayer){const e=r[s].getDataSourceJson();if(e.url.includes("FeatureServer")){const t=e.url.substring(0,e.url.indexOf("FeatureServer"));o.includes(t)||o.push(t)}}}else if(r[s].type===t.DataSourceTypes.FeatureLayer){const e=r[s].getDataSourceJson();if(e.url.includes("FeatureServer")){const t=e.url.substring(0,e.url.indexOf("FeatureServer"));o.includes(t)||o.push(t)}}if(o.length>0){const e=o.map((e,t)=>x(this,void 0,void 0,function*(){let t=!1;if(t=yield this.checkValidVMS(e),t){const t=yield this.serviceNameLookup(e);n.push({url:e,name:t})}}));Promise.all(e).then(e=>{this.uniqueURLs=n,s(n)})}else this.uniqueURLs=n,s(n)})}checkValidVMS(e,t){return x(this,void 0,void 0,function*(){let s=!1,i=e;i.includes("FeatureServer")&&(i=i.substring(0,i.indexOf("FeatureServer"))),i.includes("MapServer")&&(i=i.substring(0,i.indexOf("MapServer")));const r=i+"VersionManagementServer";let o=null;return o=t?{f:"json",token:t}:{f:"json"},s=yield this.requestService({method:"POST",url:r,params:o}).then(e=>!!e.hasOwnProperty("name")&&"Version Management Server"===e.name).catch(e=>!1),s})}getVersions(e,t,s){return new Promise((i,r)=>{if(t){let e=t;e.includes("FeatureServer")&&(e=e.substring(0,e.indexOf("FeatureServer"))),e.includes("MapServer")&&(e=e.substring(0,e.indexOf("MapServer"))),i(s?this.requestVersions(e,s):this.requestVersions(e))}else if(0===this.uniqueURLs.length)this.getUniqueVMSURL().then(t=>{let r=t[0];e&&(r=t.filter(t=>t.name===e));const o=r[0].url;i(s?this.requestVersions(o,s):this.requestVersions(o))});else{let t=this.uniqueURLs[0];e&&(t=this.uniqueURLs.filter(t=>t.name===e));const r=t[0].url;i(s?this.requestVersions(r,s):this.requestVersions(r))}})}changeGDBVersion(e,s){let i=!1;for(const r in s){if(s[r].type===t.DataSourceTypes.FeatureLayer||s[r].type===t.DataSourceTypes.SubtypeGroupLayer||s[r].type===t.DataSourceTypes.SubtypeSublayer){this.getLayerObject(s[r]).changeGDBVersion(e),i=!0}(s[r].type===t.DataSourceTypes.FeatureService||s[r].type===t.DataSourceTypes.MapService)&&(s[r].changeGDBVersion(e),i=!0)}return i}createGDBVersion(e,t,s,i,r,o){return new Promise((n,a)=>{const l={};let c=null;if(this.isOrgUser){const a=this.checkValidVersionName(e.versionName);if(a.success){if(r)c=r,c.indexOf("FeatureServer")>=0?(c=c.substring(0,c.indexOf("FeatureServer")),c+="VersionManagementServer/create"):c.indexOf("MapServer")>=0?(c=c.substring(0,c.indexOf("MapServer")),c+="VersionManagementServer/create"):c+="VersionManagementServer/create";else{let e=this.uniqueURLs[0];i&&(e=this.uniqueURLs.filter(e=>e.name===i));c=e[0].url+"VersionManagementServer/create"}this.requestService({method:"POST",url:c,params:{f:"json",versionName:e.versionName,description:e.versionDescription,accessPermission:e.versionScope,token:t}}).then(e=>{o&&e.hasOwnProperty("versionInfo")&&this.changeGDBVersion(e.versionInfo.versionName,s),n(e)}).catch(e=>{n(e)})}else n(a)}else n(l)})}deleteGDBVersion(e,s,i,r,o){return new Promise((n,a)=>{if("sde.default"!==e.toLowerCase()){const a={};let l=null;if(this.isOrgUser){if(o)l=o,l.indexOf("FeatureServer")>=0?(l=l.substring(0,l.indexOf("FeatureServer")),l+="VersionManagementServer/delete"):l.indexOf("MapServer")>=0?(l=l.substring(0,l.indexOf("MapServer")),l+="VersionManagementServer/delete"):l+="VersionManagementServer/delete";else{let e=this.uniqueURLs[0];r&&(e=this.uniqueURLs.filter(e=>e.name===r));l=e[0].url+"VersionManagementServer/delete"}this.requestService({method:"POST",url:l,params:{f:"json",versionName:e,token:s}}).then(s=>{const r=[];for(const s in i)if(i[s].type===t.DataSourceTypes.FeatureLayer){this.getLayerObject(i[s]).getGDBVersion()===e&&(r[s]=i[s])}this.changeGDBVersion(this.defaultVersion,r),s.version=this.defaultVersion,n(s)}).catch(e=>{n(e)})}else n(a)}else n({error:{message:"Cannot delete Default version"}})})}alterGDBVersion(e,t,s,i,r,o){return new Promise((n,a)=>{const l={};let c=null;if(this.isOrgUser){const a=this.checkValidVersionName(e.versionName);if(a.success){let a=e.versionGuid.replace("{","");if(a=a.replace("}",""),r)c=r,c.indexOf("FeatureServer")>=0?(c=c.substring(0,c.indexOf("FeatureServer")),c=c+"VersionManagementServer/versions/"+a+"/alter"):c.indexOf("MapServer")>=0?(c=c.substring(0,c.indexOf("MapServer")),c=c+"VersionManagementServer/versions/"+a+"/alter"):c=c+"VersionManagementServer/versions/"+a+"/alter";else{let e=this.uniqueURLs[0];i&&(e=this.uniqueURLs.filter(e=>e.name===i));c=e[0].url+"VersionManagementServer/versions/"+a+"/alter"}this.requestService({method:"POST",url:c,params:{f:"json",versionName:e.versionName,description:e.versionDescription,accessPermission:e.versionScope,ownerName:e.versionOwner,token:t}}).then(t=>{o&&this.changeGDBVersion(e.versionOwner+"."+e.versionName,s),n(t)}).catch(e=>{n(e)})}else n(a)}else n(l)})}getVersionState(e,t,s,i){return new Promise((r,o)=>{let n=null,a=e.versionGuid.replace("{","");if(a=a.replace("}",""),i)n=i,n.indexOf("FeatureServer")>=0?(n=n.substring(0,n.indexOf("FeatureServer")),n=n+"VersionManagementServer/versions/"+a):n.indexOf("MapServer")>=0?(n=n.substring(0,n.indexOf("MapServer")),n=n+"VersionManagementServer/versions/"+a):n=n+"VersionManagementServer/versions/"+a;else{let e=this.uniqueURLs[0];s&&(e=this.uniqueURLs.filter(e=>e.name===s));n=e[0].url+"VersionManagementServer/versions/"+a}this.requestService({method:"POST",url:n,params:{f:"json",token:t}}).then(e=>{r(e)}).catch(e=>{r(e)})})}checkValidVersionName(e){const t={success:!0,error:{message:"Version is valid"}};return e.length<=62?" "===e.substring(0,1)?(t.success=!1,t.error.message="Version name can not start with a space"):e.match(/(?=.*[.;'"])/)&&(t.success=!1,t.error.message="Version name can not have a period, semicolon, and single or double quotes"):(t.success=!1,t.error.message="Exceeded 62 characters for version name"),t}requestVersions(e,t){return new Promise((s,i)=>{let r=e,o={};t?(r+="VersionManagementServer/versionInfos",o={f:"json",includeHidden:!0,token:t},this.isOrgUser=!0):(r+="VersionManagementServer/versions",o={f:"json",includeHidden:!0},this.isOrgUser=!1),this.requestService({method:"POST",url:r,params:o}).then(i=>{i.hasOwnProperty("error")?t?e?(console.log("second pass, service url"),this.getVersions(e).then(e=>{e.canManage=!1,s(e)})):(console.log("second pass, no service url"),this.getVersions().then(e=>{e.canManage=!1,s(e)})):(i.canManage=!1,s(i)):(i.canManage=!0,s(i))}).catch(e=>{s(e)})})}getLayerObject(e){return e.type,t.DataSourceTypes.FeatureLayer,e}serviceNameLookup(e){return new Promise((t,s)=>{const i=e+"FeatureServer";this.requestService({method:"POST",url:i,params:{f:"json"}}).then(e=>{e.hasOwnProperty("documentInfo")?t(e.documentInfo.Title):t("")}).catch(e=>{t(e)})})}versionRead(e){return new Promise((t,s)=>{let i=this.uniqueURLs[0],r=e.versionGuid.replace("{","");r=r.replace("}",""),i=i+"VersionManagementServer/versions/"+r+"/"+e.action+"Reading/",this.requestService({method:"POST",url:i,params:{f:"json",sessionId:e.versionGuid,token:e.token}}).then(e=>{t(e)})})}searchPortalUsers(e,t,s){return new Promise((i,r)=>{let o=e+"/sharing/rest/community/users";e.includes("sharing/rest")&&(o=e+"/community/users"),this.requestService({method:"POST",url:o,params:{f:"json",q:t,token:s}}).then(e=>{i(e)}).catch(e=>{i(e)})})}requestService(e){return new Promise(function(s,i){const r={params:e.params,httpMethod:e.method};t.esri.restRequest.request(e.url,r).then(e=>{s(e)}).catch(e=>{s(e)})})}}const V={_widgetLabel:"Branch Version Management",_widgetDescription:"A widget to switch and manage branch versions in a branch versioned service.",actionLabelsDelete:"Do you want to delete this version:",actionLabelsCannotDelete:"Sorry, cannot delete Default version",actionLabelsNameNotBlank:"Version name cannot be blank",actionLabelsNoServices:"No services configured",actionLabelsNoVersions:"No versions found",buttonsCancel:"Cancel",buttonsDelete:"Delete",buttonsPost:"Post",buttonsSave:"Save",fieldColumnsAccess:"Access",fieldColumnsColumnAvailable:"Available",fieldColumnsColumnShow:"Show",fieldColumnsCommonAncestorDate:"Common Ancestor Date",fieldColumnsCreationDate:"Creation Date",fieldColumnsDescription:"Description",fieldColumnsEvaluationDate:"Evaluation Date",fieldColumnsModifiedDate:"Modified Date",fieldColumnsPreviousAncestorDate:"Previous Ancestor Date",fieldColumnsReconcileDate:"Reconcile Date",fieldColumnsVersionGuid:"Version GUID",fieldColumnsVersionId:"Version ID",fieldColumnsVersionName:"Name",fieldColumnsVersionOwner:"Owner",modalheaderDeleteVersion:"Delete Version",modalheaderUpdateVersion:"Update Version",otherheadersColumnHeader:"Column",otherheadersManage:"Manage",otherheadersManageVersion:"Manage version",otherheadersNewVersion:"New version",otherheadersOrderHeader:"Order",otherheadersVisibleHeader:"Visible",placeholderLastUpdated:"Last updated on",placeholderNumberVersions:"Number of versions:",placeholderNumberVersionsSimple:"Versions:",placeholderSearchName:"Search version name or owner",placeholderSearchOwner:"Search Owner",placeholderSelectService:"Select a service",placeholderVersionNameText:"Version name",placeholderVersionDescriptionText:"Version Description",postSuccess:"This version is successfully posted",PostFail:"This version failed to post",postConflicts:"Cannot post this version due to conflicts",simplemodeActiveVersion:"Active version:",simplemodeLoadingWait:"Loading, please wait...",tooltipsAddToTable:"Add column to the table",tooltipsAsc:"ascending",tooltipsCurrentVersion:"Current active version",tooltipsCharLimit62:"Enter up to 62 characters",tooltipsCharLimit64:"Enter up to 64 characters",tooltipsCollapseSimpleMode:"Collapse the list of versions",tooltipsDesc:"descending",tooltipsNewVersion:"Create new version",tooltipsRefreshList:"Refresh versions list",tooltipsShowHideColumns:"Show/Hide Columns",tooltipsSwitchVersion:"Switch to this version",tooltipsUpdateVersionInfo:"Update version information",tooltipsExpandSimpleMode:"Expand to see a list of versions",tooltipsMoveColumnDown:"Move column down",tooltipsMoveColumnUp:"Move column up",tooltipsNotAvailableField:"Column can not be removed from the table",tooltipsRemoveFromTable:"Remove column from the table",tooltipsSortColumns:"Sort column",versionmanagementAccessPrivileges:"Access Privileges",versionmanagementActivateVersion:"Activate this version",versionmanagementChangeOwner:"Change Owner",versionmanagementCurrentOwner:"Current: ",versionmanagementDescription:"Description",versionmanagementNo:"No",versionmanagementNoUserFound:"No user found",versionmanagementPrivateAccess:"Private - Only the owner can view and edit",versionmanagementProtectedAccess:"Protected - Anyone can view, only owner can edit",versionmanagementPublicAccess:"Public - Anyone can view and edit",versionmanagementYes:"Yes"};var w=function(e,t,s,i){return new(s||(s=Promise))(function(r,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,a)}l((i=i.apply(e,t||[])).next())})};const b=o(93226),j=o(80261),M=o(18759),C=o(58034),O=o(21601),L=o(42449),D=o(75625),I=o(84802),k=o(53071),N=o(18732),A=o(67106),P=o(8363),T={fallbackPlacements:["top","left","right"],fallbackStrategy:"bestFit"};class _ extends t.BaseWidget{constructor(i){super(i),this.defaultVersion="sde.DEFAULT",this.refreshInterval=1,this.refreshHandler=null,this.vms=y.getInstance(),this.widRefForPopper=this.props.widgetId+"divSimpleContainer",this.delayClickPrevent=(new Date).getTime(),this._getMapViews=()=>(0,t.getAppStore)().getState().jimuMapViewsInfo,this._createChildDatasources=e=>w(this,void 0,void 0,function*(){const s=t.DataSourceManager.getInstance().getDataSource(e);s.isDataSourceSet()&&!s.areChildDataSourcesCreated()&&(yield s.childDataSourcesReady(),this._populateSwitchableSources(null))}),this._populateSwitchableSources=e=>{if(this.props.useDataSources&&this.props.useDataSources.length>0){const s=t.DataSourceManager.getInstance().getDataSources();this.setState({dsList:s},()=>{"runtime"===e&&this.loadConfig()})}},this._refreshHandler=()=>{""!==this.state.selectedService&&this.pullVersions(this.state.selectedService,!1).then(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})},this.loadConfig=()=>{const e=this.state.configObj;let t=[],s="";t=e.services,t.length>0&&(s=e.services[0].name,this.setState({isReady:!0,showServiceSelector:!0,vmsServices:t,maxDisplayRows:parseInt(e.pageCounter),selectedService:s},()=>{""!==this.state.selectedService&&(this._filterRuntimeFields(),this.pullVersions(this.state.selectedService,!0))}))},this.renderServiceSelector=()=>{const{theme:i}=this.props,r=[],o=this.state.configObj;let n="";null!==o&&o.services.forEach(t=>{r.push((0,e.jsx)("option",{value:t.name,children:t.name},t.name)),""!==this.state.selectedService&&this.state.selectedService===t.name&&(n=t.name)});const a=this._getRefreshInterval();a>-1&&(null!==this.refreshHandler&&clearInterval(this.refreshHandler),this.refreshHandler=setInterval(this._refreshHandler,a));let l=!0;const c=this._getConfigServiceObject();if(null!==c){l=c.configuredSettings.allowance.filter(e=>e.key.search(/\bDelete|\bUpdate|\bChange/g)>-1).some(e=>!0===e.enabled),null===this.props.user&&(l=!1)}let h=!0;const d=(0,t.getAppStore)().getState().widgetsRuntimeInfo;d.hasOwnProperty(this.props.widgetId)&&d[this.props.widgetId].hasOwnProperty("state")&&(h="OPENED"===d[this.props.widgetId].state);let u=(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"column",height:"96%"},children:[(0,e.jsx)("div",{style:{display:"flex"},children:r.length>0?(0,e.jsx)("table",{style:{width:"100%"},children:(0,e.jsx)("tbody",{children:this._createActiveRows(l)})}):this.formatMessage("actionLabelsNoServices")}),this.state.isModeExpand&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"},children:(0,e.jsx)("div",{style:{display:"flex",flex:1,fontWeight:"bold",alignItems:"center",paddingTop:5,paddingBottom:5},children:r.length>1?(0,e.jsx)(s.Select,{value:n,onChange:e=>{this.setState({selectedService:e.currentTarget.value,selectedVersion:"",currentDisplayIndex:0},()=>{if(this._filterRuntimeFields(),this.pullVersions(this.state.selectedService,!0),!1===this.state.isSimpleMode){const e=this._getRefreshInterval();e>-1&&(null!==this.refreshHandler&&clearInterval(this.refreshHandler),this.refreshHandler=setInterval(this._refreshHandler,e))}})},children:r}):r.length>0?(0,e.jsx)("h6",{style:{fontSize:"large"},children:o.services[0].name}):""})}),this.state.isModeExpand&&this.state.selectedService&&this.renderVersionManagement()]});return this.state.isSimpleMode&&(u=this.state.isModeExpand?r.length>0?(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"column",margin:0},children:[(0,e.jsxs)("div",{className:"simple-view-header-bgcolor display-flex-row-1 cursor-hand",onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})},children:[(0,e.jsx)("div",{style:{alignItems:"center",display:"flex",paddingLeft:10,paddingRight:10},children:this.state.selectedVersion.hasOwnProperty("isLocked")&&this.state.selectedVersion.isLocked?(0,e.jsx)(s.Icon,{icon:D,size:"15",color:i.sys.color.primary.text}):(0,e.jsx)("div",{style:{width:15,height:15}})}),(0,e.jsx)("div",{className:"flex-center",style:{paddingLeft:5,paddingRight:5,fontWeight:"bold",fontSize:"medium"},children:this.formatMessage("simplemodeActiveVersion")}),(0,e.jsxs)("div",{className:"flex-center",style:{fontWeight:"bold",flex:1,paddingLeft:5,paddingRight:5,fontSize:"medium"},children:[" ",this.state.selectedVersion.versionName]}),(0,e.jsx)("div",{style:{float:"right"},children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsCollapseSimpleMode"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})},children:(0,e.jsx)(s.Icon,{icon:I,size:"16",color:i.sys.color.primary.main})})})})]}),(0,e.jsxs)(s.Popper,{open:!!h&&this.state.isModeExpand,keepMount:!0,reference:this.widRefForPopper,placement:"bottom",arrowOptions:!0,zIndex:2001,flipOptions:T,children:[(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",margin:5},children:(0,e.jsx)("div",{style:{display:"flex",flex:1,fontWeight:"bold"},children:r.length>1?(0,e.jsx)(s.Select,{value:n,zIndex:2002,placeholder:this.formatMessage("placeholderSelectService"),onChange:e=>{this.setState({selectedService:e.currentTarget.value,selectedVersion:"",currentDisplayIndex:0},()=>{this._filterRuntimeFields(),this.pullVersions(this.state.selectedService,!0)})},children:r}):r.length>0?(0,e.jsx)("h6",{style:{fontSize:"large"},children:o.services[0].name}):this.formatMessage("actionLabelsNoServices")})}),this.state.selectedService&&this.renderVersionManagementSimple()]})]}):(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",margin:0},children:this.formatMessage("actionLabelsNoServices")}):r.length>0?(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",margin:0},children:(0,e.jsxs)("div",{className:"simple-view-header-bgcolor display-flex-row-1 cursor-hand",onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})},children:[(0,e.jsx)("div",{style:{alignItems:"center",display:"flex",paddingLeft:10,paddingRight:10},children:this.state.selectedVersion.hasOwnProperty("isLocked")&&this.state.selectedVersion.isLocked?(0,e.jsx)(s.Icon,{icon:D,size:"15",color:i.sys.color.primary.text}):(0,e.jsx)("div",{style:{width:15,height:15}})}),(0,e.jsx)("div",{className:"flex-center",style:{paddingLeft:5,paddingRight:5,fontWeight:"bold",fontSize:"medium"},children:""!=this.state.selectedVersion?this.formatMessage("simplemodeActiveVersion"):this.formatMessage("simplemodeLoadingWait")}),(0,e.jsxs)("div",{className:"flex-center",style:{fontWeight:"bold",flex:1,paddingLeft:5,paddingRight:5,fontSize:"medium"},children:[" ",this.state.selectedVersion.versionName]}),(0,e.jsx)("div",{style:{justifyItems:"flex-end",alignItems:"center",display:"flex"},children:""!=this.state.selectedVersion?(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsExpandSimpleMode"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})},children:(0,e.jsx)(s.Icon,{icon:k,size:"16",color:i.sys.color.primary.main})})}):""})]})}):(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"column",margin:0},children:this.formatMessage("actionLabelsNoServices")})),u},this.renderVersionManagement=()=>{const{theme:t}=this.props;let i=!0,r=!0,o=!0,n=!0,a=!0;const l=this._getConfigServiceObject();if(null!==l){a=null!==this.getServiceToken(l.url);const e=l.configuredSettings.allowance,t=e.filter(e=>"CreateNew"===e.key);t.length>0&&(r=t[0].enabled),a||(r=!1);o=e.filter(e=>e.key.search(/\bDelete|\bUpdate|\bChange/g)>-1).some(e=>!0===e.enabled),a||(o=!1);const s=e.filter(e=>"Switch"===e.key);s.length>0&&(n=s[0].enabled);const c=l.configuredSettings.displayInfo;if(c.length>0){i=c.filter(e=>!0===e.show||!0===e.available).length>1}}let c=this.state.versionList.length;return 0===c&&""===this.state.searchVersionValue&&(c=1),(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"column",height:"60%"},children:[(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[a&&r?this.state.showMgmtTools&&(0,e.jsx)("div",{style:{flex:1,flexDirection:"row"},children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsNewVersion"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,onClick:e=>{this.resetVersionObjectData()},type:"primary",children:(0,e.jsx)(s.Icon,{icon:j,size:"18",color:t.sys.color.primary.text})})})}):"",a&&r&&(0,e.jsx)("div",{style:{width:"1%"}}),(0,e.jsx)("div",{style:{flex:1,flexDirection:"row"},children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsRefreshList"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,onClick:()=>{this.pullVersions(this.state.selectedService,!1).then(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})},children:(0,e.jsx)(s.Icon,{icon:b,size:"18",color:t.sys.color.primary.main})})})}),(0,e.jsx)("div",{style:{width:"1%"}}),(0,e.jsx)(s.InputGroup,{children:(0,e.jsx)(s.TextInput,{type:"text",placeholder:this.formatMessage("placeholderSearchName"),value:this.state.searchVersionValue,onChange:e=>{this.searchVersions(e.currentTarget.value)},style:{display:"flex",flex:1}})}),i&&(0,e.jsx)("div",{style:{width:"1%"}}),i&&(0,e.jsx)("div",{style:{flex:1,flexDirection:"row"},children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsShowHideColumns"),placement:"bottom",children:(0,e.jsx)(s.Button,{id:this.props.widgetId+"_btnFieldMgmt",icon:!0,onClick:()=>{this.toggleDialogAction("fieldMgmt","showFieldMgmt")},children:(0,e.jsx)(s.Icon,{icon:M,size:"18",color:t.sys.color.primary.main})})})})]}),(0,e.jsx)("div",{style:{display:"flex",flex:2,flexDirection:"row",paddingTop:10,height:"60%"},children:(0,e.jsx)("div",{style:{display:"flex",flex:1,overflow:"auto"},children:(0,e.jsxs)(s.Table,{children:[this._createVersionHeader(o,n),(0,e.jsx)("tbody",{children:this.state.filteredVersionList.length>0?this._createVersionRows(o,n):""!==this.state.searchVersionValue?(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:99,children:this.formatMessage("actionLabelsNoVersions")})}):this.state.selectedVersion.hasOwnProperty("versionGuid")?this._createVersionRows(o,n):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:99})})})]})})}),(0,e.jsxs)("div",{style:{paddingTop:5,display:"flex",flexDirection:"row",borderTop:"3px solid"+t.sys.color.primary.main},children:[this.state.filteredVersionList.length>1&&(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start"},children:(0,e.jsx)(s.Pagination,{className:"mb-4",size:"lg",totalPage:this.state.filteredVersionList.length,current:this.state.currentDisplayIndex+1,onChangePage:e=>{this.setState({currentDisplayIndex:e-1},()=>{this._checkStatus()})}})}),(0,e.jsxs)("div",{style:{display:"flex",flex:1,justifyContent:this.state.filteredVersionList.length>1?"flex-end":"flex-start",fontSize:"small"},children:[this.formatMessage("placeholderLastUpdated")," ",this.state.timeStamp," ",(0,e.jsx)("br",{})," ",this.formatMessage("placeholderNumberVersions")," ",c.toLocaleString()]})]})]})},this.renderVersionManagementSimple=()=>{const{theme:t}=this.props;let i=!0;const r=this._getConfigServiceObject();if(null!==r){const e=r.configuredSettings.allowance.filter(e=>"Switch"===e.key);e.length>0&&(i=e[0].enabled)}let o=this.state.versionList.length;return 0===o&&""===this.state.searchVersionValue&&(o=1),(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"column",marginLeft:5,marginRight:5,marginBottom:5},children:[(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{flex:1,flexDirection:"row"},children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsRefreshList"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,type:"primary",onClick:()=>{this.pullVersions(this.state.selectedService,!1).then(()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})},children:(0,e.jsx)(s.Icon,{icon:b,size:"18"})})})}),(0,e.jsx)("div",{style:{width:"1%"}}),(0,e.jsx)(s.InputGroup,{children:(0,e.jsx)(s.TextInput,{type:"text",placeholder:this.formatMessage("placeholderSearchName"),value:this.state.searchVersionValue,onChange:e=>{this.searchVersions(e.currentTarget.value)},style:{display:"flex",flex:1}})})]}),(0,e.jsx)("div",{style:{paddingTop:5,display:"flex",flexDirection:"row"},children:(0,e.jsx)("table",{style:{fontSize:"medium",paddingTop:5,width:"100%"},children:(0,e.jsx)("tbody",{children:this.state.filteredVersionList.length>0?this._createVersionRowsSimple(i):""!==this.state.searchVersionValue?(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:99,children:this.formatMessage("actionLabelsNoVersions")})}):this.state.selectedVersion.hasOwnProperty("versionGuid")?this._createVersionRowsSimple(i):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:99})})})})}),(0,e.jsxs)("div",{style:{paddingTop:5,display:"flex",flexDirection:"column",borderTop:"3px solid"+t.sys.color.primary.main},children:[this.state.filteredVersionList.length>1&&(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start"},children:(0,e.jsx)(s.Pagination,{className:"mb-4",size:"sm",totalPage:this.state.filteredVersionList.length,current:this.state.currentDisplayIndex+1,onChangePage:e=>{this.setState({currentDisplayIndex:e-1},()=>{this._checkStatus()})}})}),(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start",fontSize:"small",flexDirection:"column"},children:(0,e.jsxs)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start",flexDirection:"column"},children:[(0,e.jsxs)("div",{children:[this.formatMessage("placeholderLastUpdated")," ",this.state.timeStamp]}),(0,e.jsxs)("div",{children:[this.formatMessage("placeholderNumberVersionsSimple")," ",o.toLocaleString()]})]})})]})]})},this._createVersionHeader=(t,i)=>{const{theme:r}=this.props,o=[];let n=!0;const a=this._getConfigServiceObject();if(null!==a){n=null!==this.getServiceToken(a.url)}let l=[...this.state.fieldColumns];return n||(l=l.filter(e=>"versionName"===e.field||"versionOwner"===e.field)),l.sort(this._compare("order","desc")),l.forEach(t=>{t.show&&o.push((0,e.jsxs)("th",{style:{position:"sticky",top:0,backgroundColor:r.sys.color.surface.background,border:r.sys.color.surface.backgroundText,color:r.sys.color.surface.backgroundText,fontSize:"medium",whiteSpace:"nowrap",alignItems:"top"},children:[t.alias,(0,e.jsx)(s.Tooltip,{title:"desc"===t.sort?this.formatMessage("tooltipsSortColumns")+" "+t.alias+" "+this.formatMessage("tooltipsDesc"):this.formatMessage("tooltipsSortColumns")+" "+t.alias+" "+this.formatMessage("tooltipsAsc"),placement:"bottom",children:(0,e.jsx)(s.Button,{type:"tertiary",icon:!0,onClick:()=>{this.sortVersions(t.field,"desc"===t.sort?"asc":"desc")},children:(0,e.jsx)(s.Icon,{icon:"desc"===t.sort?C:O,size:"15",color:r.sys.color.surface.backgroundText})})})]},t.field))}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[t||i?(0,e.jsxs)("th",{style:{position:"sticky",top:0,backgroundColor:r.sys.color.surface.background,border:r.sys.color.surface.backgroundText,color:r.sys.color.surface.backgroundText,fontSize:"medium",alignItems:"top",whiteSpace:"nowrap"},children:[this.formatMessage("otherheadersManage"),(0,e.jsx)(s.Button,{type:"tertiary",icon:!0})]}):(0,e.jsx)("th",{style:{position:"sticky",top:0,backgroundColor:r.sys.color.surface.background,border:r.sys.color.surface.backgroundText,color:r.sys.color.surface.backgroundText,fontSize:"medium",alignItems:"top",whiteSpace:"nowrap"}}),o]})})},this._createActiveRows=t=>{const{theme:i}=this.props,r=[];let o=!0;const n=this._getConfigServiceObject();if(null!==n){const e=this.getServiceToken(n.url);o=null!==e}const a=n=>{if(void 0!==n){const a=n.versionName;r.push((0,e.jsx)("tr",{className:"simple-view-header-bgcolor cursor-hand",onClick:e=>{this.setState({isModeExpand:!this.state.isModeExpand})},children:(0,e.jsx)("td",{style:{paddingLeft:"1rem"},children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row",flex:1},children:[(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{alignItems:"center",display:"flex"},children:n.hasOwnProperty("isLocked")&&n.isLocked?(0,e.jsx)(s.Icon,{icon:D,size:"15",color:i.sys.color.primary.text}):(0,e.jsx)("div",{style:{width:15,height:15}})}),o&&n.hasOwnProperty("isLocked")&&!1===n.isLocked&&t&&"sde.default"!==n.versionName.toLowerCase()?(0,e.jsx)("div",{style:{paddingLeft:5},children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsUpdateVersionInfo"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,onClick:e=>{e.stopPropagation(),this.setState({isModeExpand:!0},()=>{this.loadExistingVersion(n)})},children:(0,e.jsx)(s.Icon,{icon:L,size:"16",color:i.sys.color.primary.main})})})}):(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row",paddingLeft:5}})]}),(0,e.jsxs)("div",{style:{color:i.sys.color.primary.text,fontSize:"medium",fontWeight:"bold",wordBreak:"break-all",paddingLeft:10,paddingRight:10,flex:1,display:"flex",alignItems:"center"},children:[this.formatMessage("simplemodeActiveVersion")," ",a]}),(0,e.jsx)("div",{style:{justifyItems:"flex-end",alignItems:"center",display:"flex"},children:""!=this.state.selectedVersion?(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsExpandSimpleMode"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,onClick:e=>{this.toggleExpandAction()},children:(0,e.jsx)(s.Icon,{icon:this.state.isModeExpand?I:k,size:"16",color:i.sys.color.primary.main})})}):""})]})})},n.versionName))}};return this.state.selectedVersion.hasOwnProperty("versionGuid")&&""!==this.state.selectedVersion.versionGuid&&a(this.state.selectedVersion),r},this._createVersionRows=(t,i)=>{const{theme:r}=this.props,o=[];let n=!0;const a=this._getConfigServiceObject();if(null!==a){const e=this.getServiceToken(a.url);n=null!==e}const l=a=>{if(void 0!==a){const l=a.versionGuid===this.state.selectedVersion.versionGuid,c=[];let h=[...this.state.fieldColumns];n||(h=h.filter(e=>"versionName"===e.field||"versionOwner"===e.field)),h.sort(this._compare("order","desc")),h.forEach((t,s)=>{if(t.show)if("versionName"===t.field){const t=a.versionName.substring(a.versionName.lastIndexOf(".")+1,a.versionName.length);c.push((0,e.jsx)("td",{className:l?"color-primary-small-font td-middle":"color-dark-small-font td-middle",style:{fontSize:"medium",wordBreak:"break-all"},children:t},t+s))}else if("versionOwner"===t.field){const t=a.versionName.substring(0,a.versionName.lastIndexOf("."));c.push((0,e.jsx)("td",{className:l?"color-primary-small-font td-middle":"color-dark-small-font td-middle",style:{fontSize:"medium"},children:t},t+s))}else if(t.field.indexOf("Date")>-1){const i=new Date(a[t.field]).toLocaleString();c.push((0,e.jsx)("td",{className:l?"color-primary-small-font td-middle":"color-dark-small-font td-middle",style:{fontSize:"medium"},children:i.toLocaleString()},i.toLocaleString()+s))}else c.push((0,e.jsx)("td",{className:l?"color-primary-small-font td-middle":"color-dark-small-font td-middle",style:{fontSize:"medium"},children:a[t.field]},t.field+s))}),o.push((0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{style:{fontSize:"medium",verticalAlign:"middle"},children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{alignItems:"center",display:"flex"},children:a.hasOwnProperty("isLocked")&&a.isLocked?(0,e.jsx)(s.Icon,{icon:D,size:"15",color:r.sys.color.primary.main}):(0,e.jsx)("div",{style:{width:15,height:15}})}),i?(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingLeft:5},children:(0,e.jsx)(s.Tooltip,{title:l?this.formatMessage("tooltipsCurrentVersion"):this.formatMessage("tooltipsSwitchVersion"),placement:"bottom",children:l?(0,e.jsx)(s.Button,{icon:!0,disabled:!1,children:(0,e.jsx)(s.Icon,{icon:N,size:"16",color:l?r.sys.color.primary.main:r.sys.color.primary.light})}):(0,e.jsx)(s.Button,{icon:!0,onClick:()=>{this.switchVersion(a)},children:(0,e.jsx)(s.Icon,{icon:A,size:"16",color:r.sys.color.primary.light})})})}):"",a.hasOwnProperty("isLocked")&&!1===a.isLocked&&n&&t&&"sde.default"!==a.versionName.toLowerCase()&&(0,e.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row",paddingLeft:5},children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsUpdateVersionInfo"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,onClick:()=>{this.loadExistingVersion(a)},children:(0,e.jsx)(s.Icon,{icon:L,size:"16",color:r.sys.color.primary.main})})})})]})}),c]},a.versionName))}};return this.state.filteredVersionList.length>0&&this.state.filteredVersionList[this.state.currentDisplayIndex].forEach(e=>{this.state.selectedVersion.hasOwnProperty("versionGuid")&&l(e)}),o},this._createVersionRowsSimple=t=>{const{theme:i}=this.props,r=[],o=t=>{let o=!1;t.versionGuid===this.state.selectedVersion.versionGuid&&(o=!0);const n=[],a=[...this.state.fieldColumns];a.sort(this._compare("order","desc")),a.forEach((s,r)=>{s.show&&"versionName"===s.field&&(o?n.push((0,e.jsx)("td",{style:{width:"100%",color:i.sys.color.primary.main,fontWeight:"bold",wordBreak:"break-all"},children:t.versionName},t.versionGuid)):n.push((0,e.jsx)("td",{style:{width:"100%",wordBreak:"break-all"},children:t.versionName},t.versionGuid)))}),r.push((0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{style:{paddingTop:3,paddingBottom:3},children:(0,e.jsx)(s.Tooltip,{title:o?this.formatMessage("tooltipsCurrentVersion"):this.formatMessage("tooltipsSwitchVersion"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,onClick:()=>{this.switchVersion(t)},children:(0,e.jsx)(s.Icon,{icon:o?N:A,size:"16",color:o?i.sys.color.primary.main:i.sys.color.primary.light})})})}),(0,e.jsx)("td",{width:"1%"}),(0,e.jsx)("td",{children:t.hasOwnProperty("isLocked")&&t.isLocked?(0,e.jsx)(s.Icon,{icon:D,size:"15",color:i.sys.color.primary.main}):(0,e.jsx)("div",{style:{width:15,height:15}})}),(0,e.jsx)("td",{width:"1%"}),n]},t.versionName))};return this.state.filteredVersionList.length>0&&this.state.filteredVersionList[this.state.currentDisplayIndex].forEach(e=>{this.state.selectedVersion.hasOwnProperty("versionGuid")&&o(e)}),r},this.renderVersionModification=()=>{let t=!0,i=!0,r=!0,o=!0,n=!0,a=!0,l=null;const c=this._getConfigServiceObject();if(null!==c&&""!==this.state.selectedService){const e=c.configuredSettings.allowance,s=e.filter(e=>"DeleteExisting"===e.key);s.length>0&&(t=s[0].enabled);const h=e.filter(e=>"Switch"===e.key);h.length>0&&(i=h[0].enabled);const d=e.filter(e=>"UpdateName"===e.key);d.length>0&&(r=d[0].enabled);const u=e.filter(e=>"UpdateDescription"===e.key);u.length>0&&(o=u[0].enabled);const p=e.filter(e=>"ChangePrivileges"===e.key);p.length>0&&(n=p[0].enabled);const f=e.filter(e=>"ChangeOwner"===e.key);f.length>0&&(a=f[0].enabled),c.hasOwnProperty("url")&&(l=this.getSessionUserName(c.url))}return(0,e.jsxs)("div",{style:{flex:1,flexDirection:"column",display:"flex",margin:5,height:"98%"},children:[(0,e.jsx)(s.Alert,{form:"basic",type:"warning",className:"w-100 m-2",open:this.state.showCreationAlert,text:this.state.creationAlertMsg}),(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{flex:1,fontWeight:"bold",fontSize:"large"},children:"create"!==this.state.versionAction?this.formatMessage("otherheadersManageVersion"):this.formatMessage("otherheadersNewVersion")}),(0,e.jsx)("div",{style:{flex:3},children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsCharLimit62"),placement:"bottom",children:(0,e.jsx)(s.TextArea,{maxLength:62,className:"mb-4",placeholder:this.formatMessage("placeholderVersionNameText"),disabled:"create"!==this.state.versionAction&&!r,defaultValue:this.state.versionObject.versionName,onAcceptValue:e=>{""!==e?(this.manageNewVersionData(e,"versionName"),this.setState({creationAlertMsg:"",showCreationAlert:!1,disableSave:!1})):this.setState({invalidVersionName:!0,creationAlertMsg:this.formatMessage("actionLabelsNameNotBlank"),showCreationAlert:!0,disableSave:!0})}})})})]}),(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"large"},children:this.formatMessage("versionmanagementDescription")}),(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsCharLimit64"),placement:"bottom",children:(0,e.jsx)(s.TextArea,{maxLength:64,className:"mb-4",placeholder:this.formatMessage("placeholderVersionDescriptionText"),disabled:"create"!==this.state.versionAction&&!o,value:this.state.versionObject.versionDescription,onChange:e=>{this.manageNewVersionData(e.target.value,"versionDescription")}})})]}),(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1.5},children:[(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"large"},children:this.formatMessage("versionmanagementAccessPrivileges")}),(0,e.jsx)(s.FormGroup,{tag:"fieldset",row:!0,style:{fontSize:"medium"},children:(0,e.jsxs)(s.Col,{sm:10,children:[(0,e.jsx)(s.FormGroup,{check:!0,children:(0,e.jsxs)(s.Label,{check:!0,children:[(0,e.jsx)(s.Input,{type:"radio",name:"sharePublic",value:"public",disabled:!n,checked:"public"===this.state.versionObject.versionScope,onChange:e=>{this.manageNewVersionData(e.target.value,"versionScope")}})," ",this.formatMessage("versionmanagementPublicAccess")]})}),(0,e.jsx)(s.FormGroup,{check:!0,children:(0,e.jsxs)(s.Label,{check:!0,children:[(0,e.jsx)(s.Input,{type:"radio",name:"sharePublic",value:"protected",disabled:!n,checked:"protected"===this.state.versionObject.versionScope,onChange:e=>{this.manageNewVersionData(e.target.value,"versionScope")}})," ",this.formatMessage("versionmanagementProtectedAccess")]})}),(0,e.jsx)(s.FormGroup,{check:!0,children:(0,e.jsxs)(s.Label,{check:!0,children:[(0,e.jsx)(s.Input,{type:"radio",name:"sharePrivate",value:"private",disabled:!n,checked:"private"===this.state.versionObject.versionScope,onChange:e=>{this.manageNewVersionData(e.target.value,"versionScope")}})," ",this.formatMessage("versionmanagementPrivateAccess")]})})]})}),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingTop:10},children:(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"column"},children:[(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"large"},children:this.formatMessage("versionmanagementActivateVersion")}),(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"row"},children:[(0,e.jsx)("div",{style:{fontSize:"medium"},children:this.formatMessage("versionmanagementNo")}),(0,e.jsx)("div",{style:{paddingLeft:5,paddingRight:5,paddingTop:5},children:(0,e.jsx)(s.Label,{check:!0,children:(0,e.jsx)(s.Switch,{checked:this.state.autoSwitchVersion,disabled:!i,onChange:e=>{this.toggleAutoSwitch()}})})}),(0,e.jsx)("div",{style:{fontSize:"medium"},children:this.formatMessage("versionmanagementYes")})]})]})})]}),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",flex:1},children:(0,e.jsxs)(s.FormGroup,{children:[(0,e.jsx)("h6",{style:{fontWeight:"bold",fontSize:"large"},children:this.formatMessage("versionmanagementChangeOwner")}),(0,e.jsxs)("h6",{style:{fontWeight:"bold",fontSize:"medium"},children:[this.formatMessage("versionmanagementCurrentOwner"),""!==this.state.versionOwnerSnapshot?this.state.versionOwnerSnapshot:null!==l?l:this.props.user.username]}),(0,e.jsx)(s.InputGroup,{children:(0,e.jsx)(s.TextInput,{type:"text",style:{width:"100%"},placeholder:this.formatMessage("placeholderSearchOwner"),disabled:!a,value:this.state.userSearchValue,onChange:e=>{this.searchPortaluser(e.currentTarget.value)}})}),this.searchUserResultList()]})})]}),(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"row",paddingTop:10},children:[(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-start",alignItems:"flex-end",padding:15},children:(0,e.jsx)(s.Button,{type:"secondary",style:{fontSize:"medium",fontWeight:"bold"},onClick:e=>{this.toggleCreationModel(!0)},children:this.formatMessage("buttonsCancel")})}),(0,e.jsx)("div",{style:{display:"flex",flex:1,justifyContent:"flex-end",alignItems:"flex-end"},children:(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-end",padding:15},children:[(0,e.jsx)(s.Button,{type:"primary",style:{fontSize:"medium",fontWeight:"bold"},disabled:this.state.invalidVersionName?this.state.invalidVersionName:this.state.disableSave,onClick:()=>{(new Date).getTime()-this.delayClickPrevent>500&&this.setState({disableSave:!0},()=>{"create"===this.state.versionAction?this.createVersion():this.updateVersion()}),this.delayClickPrevent=(new Date).getTime()},children:this.formatMessage("buttonsSave")})," ","create"!==this.state.versionAction&&t?(0,e.jsx)("div",{style:{width:"2%"}}):"","create"!==this.state.versionAction&&t?(0,e.jsx)(s.Button,{type:"secondary",style:{fontSize:"medium",fontWeight:"bold"},disabled:this.state.invalidVersionName,onClick:()=>{this.setState({showDeleteModal:!0})},children:this.formatMessage("buttonsDelete")}):""]})})]})]})},this.renderFieldList=()=>{let t=!0;const i=this._getConfigServiceObject();if(null!==i){t=null!==this.getServiceToken(i.url)}const{theme:r}=this.props,o=[];let n=[...this.state.fieldColumns];t||(n=n.filter(e=>"versionName"===e.field||"versionOwner"===e.field));const a=(()=>{let e=!1;return n.filter(e=>!0===e.show).length<=1&&(e=!0),e})();return n.sort(this._compare("order","desc")),n.forEach((t,i)=>{(t.available||t.show)&&o.push((0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{style:{fontSize:"medium",paddingLeft:5,paddingRight:5},children:t.alias}),t.available?(0,e.jsx)("td",{children:(0,e.jsx)(s.Tooltip,{title:t.show?this.formatMessage("tooltipsRemoveFromTable"):this.formatMessage("tooltipsAddToTable"),placement:"bottom",children:(0,e.jsx)(s.Checkbox,{className:"m-4",checked:t.show,disabled:!!t.show&&a,onChange:e=>{this.changeFieldVisible(e,i)}})})}):(0,e.jsx)("td",{children:(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsNotAvailableField"),placement:"bottom",children:(0,e.jsx)(s.Checkbox,{className:"m-4",checked:t.show,disabled:!0})})}),(0,e.jsx)("td",{style:{paddingLeft:5,paddingRight:5},children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[i>0?(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsMoveColumnUp"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,type:"tertiary",size:"sm",onClick:()=>{this.changeFieldOrder("up",i)},children:(0,e.jsx)(s.Icon,{icon:I,size:"16"})})}):(0,e.jsx)(s.Button,{icon:!0,type:"tertiary",size:"sm"}),i<n.length-1?(0,e.jsx)(s.Tooltip,{title:this.formatMessage("tooltipsMoveColumnDown"),placement:"bottom",children:(0,e.jsx)(s.Button,{icon:!0,type:"tertiary",size:"sm",onClick:()=>{this.changeFieldOrder("down",i)},children:(0,e.jsx)(s.Icon,{icon:k,size:"16"})})}):(0,e.jsx)(s.Button,{icon:!0,type:"tertiary",size:"sm"})]})})]},t.field))}),(0,e.jsxs)("table",{style:{},children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{style:{fontSize:"medium",position:"sticky",top:0,backgroundColor:r.sys.color.primary.main,zIndex:999,color:r.sys.color.primary.text,padding:7},children:this.formatMessage("otherheadersColumnHeader")}),(0,e.jsx)("th",{style:{fontSize:"medium",position:"sticky",top:0,backgroundColor:r.sys.color.primary.main,zIndex:999,color:r.sys.color.primary.text,padding:7},children:this.formatMessage("otherheadersVisibleHeader")}),(0,e.jsx)("th",{style:{fontSize:"medium",textAlign:"right",position:"sticky",top:0,backgroundColor:r.sys.color.primary.main,zIndex:999,color:r.sys.color.primary.text,padding:7},children:this.formatMessage("otherheadersOrderHeader")})]})}),(0,e.jsx)("tbody",{children:o})]})},this.pullVersions=(e,t)=>new Promise((e,s)=>{const i=this._getConfigServiceObject();let r=null,o=null;const n=this.state.currentDisplayIndex;if(null!==i){let s=this.getServiceToken(i.url);null===s&&(s=void 0),this.vms.getVersions(i.name,i.url,s).then(s=>{if(s.hasOwnProperty("success")){if(s.success&&s.hasOwnProperty("versions")){const a=s.versions;if(""!==this.state.selectedVersion&&this.state.selectedVersion.hasOwnProperty("versionGuid")&&""!==this.state.selectedVersion.versionGuid){const e=a.findIndex(e=>e.versionGuid===this.state.selectedVersion.versionGuid);if(e>-1)r=a[e];else{const e=this.state.versionList.filter(e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase());e.length>0&&(r=e[0],this.switchVersion(e[0]))}}const l=this._getCurrentTime();o=null!==r?{versionList:a,showMgmtTools:s.canManage,currentDisplayIndex:0,timeStamp:l,selectedVersion:r}:{versionList:a,showMgmtTools:s.canManage,currentDisplayIndex:0,timeStamp:l},this.setState(o,()=>{const s=this.chunkVersions(this.state.versionList);let r=0;0!==n&&(r=s.length-1>n?n:s.length-1),this.setState({filteredVersionList:s,currentDisplayIndex:r},()=>{if(t){const t=this.state.versionList.filter(e=>""!==this.state.urlStartUpVersion?e.versionName===this.state.urlStartUpVersion:e.versionGuid===i.configuredSettings.persistVersion);if(t.length>0)this.switchVersion(t[0]);else{const e=this.state.versionList.filter(e=>e.versionGuid===i.configuredSettings.startupVersion);if(e.length>0)this.switchVersion(e[0]);else{const e=this.state.versionList.filter(e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase());e.length>0?this.switchVersion(e[0]):this.switchVersion({versionName:this.defaultVersion,versionGuid:null})}}this._checkStatus(),e(!0)}else this._checkStatus(),e(!0)})})}}else s.hasOwnProperty("error")?(this.setState({versionList:[],filteredVersionList:[],showMgmtTools:!1}),e(!1)):e(!0)})}}),this._checkStatus=()=>{this._getVersionStatus().then(e=>{this._mergeStatus(e)})},this._getVersionStatus=()=>new Promise((e,t)=>{if(this.state.filteredVersionList.length>0){const t=this._getConfigServiceObject();if(null!==t){let s=this.getServiceToken(t.url);null===s&&(s=void 0);const i=[],r=this.state.filteredVersionList[this.state.currentDisplayIndex].map(e=>w(this,void 0,void 0,function*(){yield this.vms.getVersionState(e,s,this.state.selectedService,t.url).then(e=>{e.hasOwnProperty("versionName")&&i.push(e)})}));this.state.selectedVersion.hasOwnProperty("versionGuid")&&null!==this.state.selectedVersion.versionGuid&&r.push(this.vms.getVersionState(this.state.selectedVersion,s,this.state.selectedService,t.url).then(e=>{e.hasOwnProperty("versionName")&&i.push(e)})),Promise.all(r).then(t=>{e(i)})}}else e([])}),this._mergeStatus=e=>{if(this.state.filteredVersionList.length>0){const t=[...this.state.filteredVersionList];if(t[this.state.currentDisplayIndex].forEach(t=>{const s=e.filter(e=>e.versionGuid===t.versionGuid);s.length>0&&(t.isLocked=s[0].isLocked)}),this.state.selectedVersion.hasOwnProperty("versionGuid")&&null!==this.state.selectedVersion.versionGuid){const s=Object.assign({},this.state.selectedVersion),i=e.filter(e=>e.versionGuid===s.versionGuid);i.length>0&&(s.isLocked=i[0].isLocked),this.setState({filteredVersionList:t,selectedVersion:s})}else this.setState({filteredVersionList:t})}},this.switchVersion=e=>{const s=[],i=this.state.vmsServices.filter(e=>e.name===this.state.selectedService);if(i.length>0)for(const e in this.state.dsList)if(this.state.dsList[e].hasOwnProperty("_url")&&this.state.dsList[e]._url){const t=decodeURI(this.state.dsList[e]._url),r=decodeURI(i[0].url);t.includes(r)&&(s[e]=this.state.dsList[e])}else this.state.dsList[e].type===t.DataSourceTypes.FeatureService&&(s[e]=this.state.dsList[e]),this.state.dsList[e].type===t.DataSourceTypes.MapService&&(s[e]=this.state.dsList[e]);if(i.length>0){this.vms.changeGDBVersion(e.versionName,s);const r=t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0});r.services.forEach(t=>{i[0].name===t.name&&(t.configuredSettings.persistVersion=e.versionGuid)}),this.setState({selectedVersion:e,selectedVersionInfo:e,configObj:r},()=>{this.pullVersions(this.state.selectedService,!1).then(e=>{""!==this.state.searchVersionValue&&this.searchVersions(this.state.searchVersionValue),""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})})}},this.createVersion=()=>{const e=this._getConfigServiceObject();if(null!==e)if(""!==this.state.versionObject.versionName){let s=this.getServiceToken(e.url);const i=this.getSessionUserName(e.url);null===s&&(s=void 0),this.setState({showCreationAlert:!1,creationAlertMsg:"",disableSave:!1},()=>{this.vms.createGDBVersion(this.state.versionObject,s,this.state.dsList,this.state.selectedService,e.url,this.state.autoSwitchVersion).then(e=>w(this,void 0,void 0,function*(){if(e.success)if(this.state.versionObject.versionOwner.toLowerCase()!==i.toLowerCase())if(""===this.state.versionObject.versionOwner)if(yield this.pullVersions(this.state.selectedService,!1),this.state.autoSwitchVersion){const s=t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0});s.services.forEach(t=>{this.state.selectedService===t.name&&(t.configuredSettings.persistVersion=e.versionInfo.versionGuid)}),this.setState({showVersionSettingsModal:!1,selectedVersion:e.versionInfo,selectedVersionInfo:e.versionInfo,autoSwitchVersion:!1,configObj:s},()=>w(this,void 0,void 0,function*(){yield this.pullVersions(this.state.selectedService,!1),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}else this.setState({showVersionSettingsModal:!1,autoSwitchVersion:!1},()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)});else{const t=Object.assign({},this.state.versionObject);t.versionGuid=e.versionInfo.versionGuid,this.state.autoSwitchVersion,this.setState({versionObject:t},()=>{this.updateVersion()})}else if(yield this.pullVersions(this.state.selectedService,!1),this.state.autoSwitchVersion){const s=t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0});s.services.forEach(t=>{this.state.selectedService===t.name&&(t.configuredSettings.persistVersion=e.versionInfo.versionGuid)}),this.setState({showVersionSettingsModal:!1,selectedVersion:e.versionInfo,selectedVersionInfo:e.versionInfo,autoSwitchVersion:!1,configObj:s},()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})}else this.setState({showVersionSettingsModal:!1,autoSwitchVersion:!1},()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)});else e.hasOwnProperty("response")?this.setState({showCreationAlert:!0,creationAlertMsg:e.response.error.message}):this.setState({showCreationAlert:!0,creationAlertMsg:e.error.message})}))})}else this.setState({showCreationAlert:!0,creationAlertMsg:this.formatMessage("actionLabelsNameNotBlank")})},this.deleteVersion=()=>{const e=this._getConfigServiceObject();if(null!==e){let s=this.getServiceToken(e.url);null===s&&(s=void 0),this.vms.deleteGDBVersion(this.state.versionObject.version,s,this.state.dsList,this.state.selectedService,e.url).then(e=>w(this,void 0,void 0,function*(){if(e.success)if(yield this.pullVersions(this.state.selectedService,!1),this.state.versionObject.versionGuid===this.state.selectedVersion.versionGuid){const e=this.state.versionList.filter(e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase());if(e.length>0){const s=t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0});s.services.forEach(t=>{this.state.selectedService===t.name&&(t.configuredSettings.persistVersion=e[0].versionGuid)}),this.setState({showDeleteModal:!1,showDeleteAlert:!1,deleteAlertMsg:"",selectedVersion:e.length>0?e[0]:this.defaultVersion,selectedVersionInfo:e.length>0?e[0]:"",showVersionSettingsModal:!1,configObj:s},()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})}else this.setState({showDeleteModal:!1,showDeleteAlert:!1,deleteAlertMsg:"",showVersionSettingsModal:!1},()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})}else this.setState({showDeleteModal:!1,showDeleteAlert:!1,deleteAlertMsg:"",showVersionSettingsModal:!1},()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)});else this.setState({showDeleteAlert:!0,deleteAlertMsg:e.hasOwnProperty("error")?e.error.message:e.message})}))}},this.updateVersion=()=>{const e=this._getConfigServiceObject();if(null!==e)if(""!==this.state.versionObject.versionName){let s=this.getServiceToken(e.url);null===s&&(s=void 0),this.setState({showCreationAlert:!1,creationAlertMsg:"",disableSave:!1},()=>{this.vms.alterGDBVersion(this.state.versionObject,s,this.state.dsList,this.state.selectedService,e.url,this.state.autoSwitchVersion).then(e=>w(this,void 0,void 0,function*(){if(e.success){yield this.pullVersions(this.state.selectedService,!1);const e=this.state.versionList.filter(e=>e.versionGuid===this.state.versionObject.versionGuid);if(e.length>0)if(this.state.autoSwitchVersion){const s=t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0});s.services.forEach(t=>{this.state.selectedService===t.name&&(t.configuredSettings.persistVersion=e[0].versionGuid)}),this.setState({showVersionSettingsModal:!1,versionAction:"create",userSearchValue:"",configObj:s,autoSwitchVersion:!1,selectedVersion:e[0],selectedVersionInfo:e[0]},()=>w(this,void 0,void 0,function*(){yield this.pullVersions(this.state.selectedService,!1),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}else if(e[0].versionName.toLowerCase()===this.state.selectedVersion.versionName.toLowerCase()){const e=this.state.versionList.filter(e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase());if(e.length>0){t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0}).services.forEach(t=>{this.state.selectedService===t.name&&(t.configuredSettings.persistVersion=e[0].versionGuid)}),this.setState({showVersionSettingsModal:!1,versionAction:"create",userSearchValue:"",autoSwitchVersion:!1,selectedVersion:e[0],selectedVersionInfo:e[0]},()=>{this.switchVersion(this.state.selectedVersion),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)})}}else this.setState({showVersionSettingsModal:!1,versionAction:"create",userSearchValue:"",autoSwitchVersion:!1},()=>{""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)});else if(this.state.autoSwitchVersion){t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0}).services.forEach(e=>{this.state.selectedService===e.name&&(e.configuredSettings.persistVersion=this.state.versionObject.versionGuid)}),this.setState({showVersionSettingsModal:!1,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:"",autoSwitchVersion:!1,selectedVersion:this.state.versionObject,selectedVersionInfo:this.state.versionObject},()=>w(this,void 0,void 0,function*(){yield this.pullVersions(this.state.selectedService,!1),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}else{const e=this.state.versionList.filter(e=>e.versionName.toLowerCase()===this.defaultVersion.toLowerCase());if(e.length>0){const s=t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0});s.services.forEach(t=>{this.state.selectedService===t.name&&(t.configuredSettings.persistVersion=e[0].versionGuid)}),this.setState({showVersionSettingsModal:!1,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:"",selectedVersion:e.length>0?e[0]:this.defaultVersion,selectedVersionInfo:e.length>0?e[0]:"",configObj:s},()=>w(this,void 0,void 0,function*(){yield this.pullVersions(this.state.selectedService,!1),""!==this.state.searchVersionValue?this.searchVersions(this.state.searchVersionValue):""!==this.state.sort.field&&this.sortVersions(this.state.sort.field,this.state.sort.direction)}))}else this.setState({showVersionSettingsModal:!1,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:""})}}else e.hasOwnProperty("response")?this.setState({showCreationAlert:!0,creationAlertMsg:e.response.error.message,userSearchValue:""}):this.setState({showCreationAlert:!0,creationAlertMsg:e.error.message,userSearchValue:""})}))})}else this.setState({showCreationAlert:!0,creationAlertMsg:this.formatMessage("actionLabelsNameNotBlank")})},this.searchVersions=e=>{const t=[...this.state.versionList].filter(t=>t.versionName.toLowerCase().indexOf(e.toLowerCase())>=0);""!==this.state.sort.field&&t.sort(this._compare(this.state.sort.field,this.state.sort.direction));const s=this.chunkVersions(t);this.setState({filteredVersionList:s,currentDisplayIndex:0,searchVersionValue:e},()=>{this._checkStatus()})},this.loadExistingVersion=e=>{if(e.versionName.toLowerCase()!==this.defaultVersion.toLowerCase()){const t=this.state.versionList.filter(t=>t.versionGuid===e.versionGuid);if(t.length>0){let e=!1;const s=Object.assign({},this.state.versionObject);t[0].versionGuid===this.state.selectedVersion.versionGuid&&(e=!0),s.version=t[0].versionName,s.versionName=t[0].versionName.substring(t[0].versionName.lastIndexOf(".")+1,t[0].versionName.length),s.versionDescription=t[0].description,s.versionScope=t[0].access,s.versionOwner=t[0].versionName.substring(0,t[0].versionName.lastIndexOf(".")),s.versionGuid=t[0].versionGuid,this.setState({versionObject:s,versionOwnerSnapshot:s.versionOwner,autoSwitchVersion:e},()=>{this.setState({showVersionSettingsModal:!0,versionAction:"edit",userSearchValue:"",portalUsers:[],disableSave:!1,invalidVersionName:!1})})}else if(e.versionGuid===this.state.selectedVersion.versionGuid){const e=!0,t=Object.assign({},this.state.versionObject);t.version=this.state.selectedVersion.versionName,t.versionName=this.state.selectedVersion.versionName.substring(this.state.selectedVersion.versionName.lastIndexOf(".")+1,this.state.selectedVersion.versionName.length),t.versionDescription=this.state.selectedVersion.description,t.versionScope=this.state.selectedVersion.access,t.versionOwner=this.state.selectedVersion.versionName.substring(0,this.state.selectedVersion.versionName.lastIndexOf(".")),t.versionGuid=this.state.selectedVersion.versionGuid,this.setState({versionObject:t,versionOwnerSnapshot:t.versionOwner,autoSwitchVersion:e},()=>{this.setState({showVersionSettingsModal:!0,versionAction:"edit",userSearchValue:"",portalUsers:[],disableSave:!1,invalidVersionName:!1})})}}else this.setState({showUpdateModal:!0})},this.manageNewVersionData=(e,t)=>{const s=Object.assign({},this.state.versionObject);s.hasOwnProperty(t)&&(s[t]=e),"versionOwner"===t?this.setState({versionObject:s,invalidVersionName:!1,userSearchValue:e},()=>{this.searchPortaluser(e)}):this.setState({versionObject:s,invalidVersionName:!1})},this.resetVersionObjectData=()=>{const e=this._getConfigServiceObject();let t=null;null!==e&&e.hasOwnProperty("url")&&(t=this.getSessionUserName(e.url));const s=Object.assign({},this.state.versionObject);s.versionName="",s.versionDescription="",s.versionScope="public",s.versionOwner=null!==t?t:"",s.versionGuid="",this.setState({versionObject:s,versionAction:"create",versionOwnerSnapshot:null!==t?t:"",userSearchValue:"",portalUsers:[],disableSave:!0},()=>{this.toggleCreationModel(!1)})},this.searchPortaluser=e=>{var s;const i=e;let r=null===(s=t.SessionManager.getInstance().getMainSession())||void 0===s?void 0:s.token;const o=this._getConfigServiceObject();null!==o&&(r=this.getServiceToken(o.url));const n=t.urlUtils.getUrlHost(o.url);let a=t.urlUtils.getProtocol(o.url)+"//"+n+"/portal";const l=this.checkPortalIfFederated(n);null!==l&&(a=l.portal,r=l._token),this.vms.searchPortalUsers(a,e,r).then(e=>{if(e.hasOwnProperty("results")){const t=e.results.filter(e=>-1===e.username.indexOf("esri_"));this.setState({userSearchValue:i,portalUsers:t})}else this.setState({userSearchValue:i,portalUsers:[]})})},this.searchUserResultList=()=>{const t=[];return this.state.portalUsers.length>0?this.state.portalUsers.forEach(i=>{t.push((0,e.jsx)(s.Button,{type:this.state.versionObject.versionOwner===i.username?"primary":"secondary",onClick:()=>{this.manageNewVersionData(i.username,"versionOwner")},children:i.fullName},i.username))}):""!==this.state.userSearchValue&&t.push((0,e.jsx)(s.Button,{type:"secondary",children:this.formatMessage("versionmanagementNoUserFound")},"no_user")),(0,e.jsx)(s.ListGroup,{children:t})},this.chunkVersions=e=>{const t=[...e];let s=[];return t.length>0&&(s=this.chunk(t,this.state.maxDisplayRows)),s},this.chunk=(e,t)=>{const s=[],i=t;let r,o;for(r=0,o=e.length;r<o;r+=i)s.push(e.slice(r,r+i));return s},this._filterRuntimeFields=()=>{const e=this._getConfigServiceObject();if(null!==e){const s=t.Immutable.asMutable((0,t.Immutable)(e.configuredSettings.displayInfo),{deep:!0}).filter(e=>!0===e.available||!0===e.show);s.forEach(e=>{for(const t in V)t.toLowerCase()===("fieldColumns"+e.field).toLowerCase()&&(e.alias=this.formatMessage(t))}),this.setState({fieldColumns:s})}},this._getRefreshInterval=()=>{let e=-1;const t=this._getConfigServiceObject();if(null!==t){const s=t.configuredSettings.allowance.filter(e=>"AutoRefreshList"===e.key);s.length>0&&s[0].enabled&&(e=6e4*parseInt(s[0].refreshInterval))}return e},this.sortVersions=(e,t)=>{const s=[...this.state.versionList],i=this.state.currentDisplayIndex;s.sort(this._compare(e,t));const r=this.chunkVersions(s);if(null!==this._getConfigServiceObject()){const s=[...this.state.fieldColumns];s.forEach(s=>{s.sort="desc",e===s.field&&(s.sort=t)});const o={field:e,direction:t};let n=0;0!==i&&(n=r.length-1>i?i:r.length-1),this.setState({filteredVersionList:r,currentDisplayIndex:n,sort:o,fieldColumns:s},()=>{""!==this.state.searchVersionValue&&this.searchVersions(this.state.searchVersionValue),this._checkStatus()})}},this._compare=(e,t)=>function(s,i){let r=0,o=s[e],n=i[e];return"versionOwner"===e?(o=s.versionName.toLowerCase(),n=i.versionName.toLowerCase()):"versionName"===e?(o=o.substring(o.lastIndexOf(".")+1,o.length).toLowerCase(),n=n.substring(n.lastIndexOf(".")+1,n.length).toLowerCase()):(isNaN(o)&&(o=o.toLowerCase()),isNaN(n)&&(n=n.toLowerCase())),"desc"===t?o>n?r=1:o<n&&(r=-1):o<n?r=1:o>n&&(r=-1),r},this._getCurrentTime=()=>(new Date).toLocaleString(),this.changeFieldVisible=(e,t)=>{const s=[...this.state.fieldColumns];s.sort(this._compare("order","desc")),s[t].show=e.currentTarget.checked,this.setState({fieldColumns:s})},this.changeFieldOrder=(e,t)=>{const s=[...this.state.fieldColumns];s.sort(this._compare("order","desc"));let i=t;"up"===e?(i-=1,s[t].order=i,s[t-1].order=t):(i+=1,s[t].order=i,s[t+1].order=t),this.setState({fieldColumns:s})},this.toggleExpandAction=()=>{this.state.isModeExpand?this.setState({isModeExpand:!1}):this.setState({isModeExpand:!0})},this.toggleDialogAction=(e,t)=>{if("fieldMgmt"===e)this.setState({showFieldMgmt:!this.state.showFieldMgmt})},this.toggleCreationModel=e=>{e?this.setState({showVersionSettingsModal:!1,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:"",portalUsers:[],autoSwitchVersion:!1}):this.setState({showVersionSettingsModal:!0,showCreationAlert:!1,creationAlertMsg:"",userSearchValue:"",portalUsers:[],autoSwitchVersion:!1})},this.toggleDeleteModal=e=>{e?this.setState({showDeleteModal:!1,showDeleteAlert:!1}):this.setState({showDeleteModal:!0})},this.toggleUpdateModal=e=>{e?this.setState({showUpdateModal:!1}):this.setState({showUpdateModal:!0})},this.toggleServiceSelectorModal=e=>{e?this.setState({showServiceSelector:!1}):this.setState({showServiceSelector:!0})},this.toggleAutoSwitch=()=>{this.state.autoSwitchVersion?this.setState({autoSwitchVersion:!1}):this.setState({autoSwitchVersion:!0})},this.toggleBackServiceSelector=()=>{this.setState({showServiceSelector:!0})},this._getConfigServiceObject=()=>{let e=null;const t=this.state.configObj;return null!==t&&t.services.forEach(t=>{""!==this.state.selectedService&&this.state.selectedService===t.name&&(e=t)}),e},this.getServiceToken=e=>{var s;const i=t.urlUtils.getUrlHost(e.toLowerCase()),r=t.SessionManager.getInstance().getSessions(),o=r.filter(e=>e.portal.toLowerCase().indexOf(i)>-1);let n=null;return this.props.portalUrl.toLowerCase().includes(i)&&(n=null===(s=t.SessionManager.getInstance().getMainSession())||void 0===s?void 0:s.token),o.length>0?n=o[0].token:null===n&&r.map(e=>{if(e.hasOwnProperty("federatedServers")){for(const t in e.federatedServers)t.toLowerCase().includes(i)&&(n=e.federatedServers[t].token);return!0}if(e.hasOwnProperty("trustedServers")){for(const t in e.trustedServers)t.toLowerCase().includes(i)&&(n=e.trustedServers[t].token);return!0}return!0}),n},this.checkPortalIfFederated=e=>{let s=null;const i=t.SessionManager.getInstance().getSessions(),r=i.filter(t=>t.portal.toLowerCase().indexOf(e)>-1);return r.length>0?s=r[0]:i.map(t=>{if(t.hasOwnProperty("federatedServers")){for(const i in t.federatedServers)if(i.toLowerCase().includes(e))return s=t,!0;return!1}if(t.hasOwnProperty("trustedServers")){for(const i in t.trustedServers)if(i.toLowerCase().includes(e))return s=t,!0;return!1}return!1}),s},this.getSessionUserName=e=>{const s=t.urlUtils.getUrlHost(e.toLowerCase()),i=t.SessionManager.getInstance().getSessions().filter(e=>e.portal.toLowerCase().indexOf(s)>-1);let r=null;return this.props.portalUrl.toLowerCase().includes(s)&&(r=this.props.user.username),i.length>0&&(r=i[0].username),r},this._sizePopperHeight=e=>{let t=null;return t=null!==this._getSizeOfContainer()?this._getSizeOfContainer().height-e:"auto",t},this._sizePopperWidth=e=>{let t=null;return t=null!==this._getSizeOfContainer()?this._getSizeOfContainer().width-e:"auto",t},this.formatMessage=(e,i)=>{const r=Object.assign({},V,s.defaultMessages,t.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:r[e]},i)},this.getStyle=e=>t.css`
      .td-middle {
        vertical-align: middle !important;
      }
      .background-light {
        background-color: ${e.sys.color.primary.main};
      }
      .display-flex-column-1 {
        flex: 1;
        flex-direction: column;
        display: flex;
      }
      .display-flex-row-1 {
        flex: 1;
        flex-direction: row;
        display: flex;
      }
      .simple-view-header-bgcolor {
        background: ${e.sys.color.primary.main};
        color: ${e.sys.color.primary.text};
      }
      .overflow-auto {
        overflow: "auto";
      }
      .button-inactive-color {
        background: ${e.sys.color.secondary.main};
      }
      .button-active-color {
        background: ${e.sys.color.primary.main};
      }
      .icon-inactive-color {
        background: ${e.sys.color.primary.light};
      }
      .icon-active-color {
        background: ${e.sys.color.primary.dark};
      }
      .flex-center {
        align-items: center;
        display: flex;
      }
      .padding-left-right-5 {
        padding-left: 5;
        padding-right: 5;
      }
      .color-dark-small-font {
        color: ${e.sys.color.surface.backgroundText};
        font-family: ${e.ref.typeface.fontFamily};
        font-size: ${e.sys.typography.h6.fontSize};
      }
      .color-primary-small-font {
        color: ${e.sys.color.primary.main};
        font-family: ${e.ref.typeface.fontFamily};
        font-size: ${e.sys.typography.h6.fontSize};
        font-weight: bold;
      }
      .color-light-small-font {
        color: ${e.sys.color.surface.backgroundText};
        font-family: ${e.ref.typeface.fontFamily};
        font-size: ${e.sys.typography.h6.fontSize};
      }
      .cursor-hand {
        cursor: pointer;
      }
    `,this.state={isReady:!1,isSimpleMode:!!this.props.config.versionConfig.hasOwnProperty("arrangement")&&"simple"===this.props.config.versionConfig.arrangement,isModeExpand:!this.props.config.versionConfig.hasOwnProperty("expandMode")||this.props.config.versionConfig.expandMode,showMgmtTools:!1,showVersionSettingsModal:!1,showDeleteModal:!1,showUpdateModal:!1,showCreationAlert:!1,showDeleteAlert:!1,showServiceSelector:!1,showFieldMgmt:!1,creationAlertMsg:"",deleteAlertMsg:"",invalidVersionName:!1,disableSave:!1,dsList:[],vmsServices:[],versionList:[],filteredVersionList:[],configObj:t.Immutable.asMutable((0,t.Immutable)(this.props.config.versionConfig),{deep:!0}),selectedService:"",selectedVersion:"sde.DEFAULT",selectedVersionInfo:"",versionAction:"create",versionObject:{versionName:"",versionDescription:"",versionScope:"public",versionOwner:"",versionGuid:""},versionOwnerSnapshot:"",portalUsers:[],userSearchValue:"",searchVersionValue:"",autoSwitchVersion:!1,maxDisplayRows:5,currentDisplayIndex:0,fieldColumns:[],timeStamp:"",sort:{field:"",direction:""},urlStartUpVersion:""}}componentWillMount(){const e=t.Immutable.asMutable((0,t.Immutable)(this.state.configObj),{deep:!0});e.services.forEach(e=>{e.configuredSettings.persistVersion=e.configuredSettings.startupVersion}),this.setState({configObj:e})}componentDidMount(){var e;const{config:s}=this.props;if((null===(e=s.versionConfig)||void 0===e?void 0:e.services.length)>0){const e=(0,t.getAppStore)().getState().queryObject;if(e&&(null==e?void 0:e.data_version)){e.data_version.split(",").forEach(e=>{const t=e.split(":");t.shift();const s=t.join(":");this.setState({urlStartUpVersion:s})})}}const i=this._getMapViews();if(Object.keys(i).length>0)for(const e in i)this._createChildDatasources(i[e].dataSourceId)}componentWillUnmount(){null!==this.refreshHandler&&clearInterval(this.refreshHandler)}componentDidUpdate(e,s){const{config:i}=this.props,r=this._getMapViews();if(Object.keys(r).length>0)for(const e in r)this._createChildDatasources(r[e].dataSourceId);if(window.jimuConfig.isInBuilder&&(this.props.hasOwnProperty("useDataSources")&&this.state.dsList.length<=0&&this._populateSwitchableSources("builder"),i.versionConfig.hasOwnProperty("arrangement")&&e.config.versionConfig.arrangement!==i.versionConfig.arrangement&&("simple"!==i.versionConfig.arrangement?this.setState({isSimpleMode:!1}):this.setState({isSimpleMode:!0})),i.versionConfig.hasOwnProperty("expandMode")&&e.config.versionConfig.expandMode!==i.versionConfig.expandMode&&(i.versionConfig.expandMode?this.setState({isModeExpand:!0}):this.setState({isModeExpand:!1})),i.versionConfig.hasOwnProperty("services")&&e.config.versionConfig.services.length!==i.versionConfig.services.length&&(i.versionConfig.services.length>0?this.setState({configObj:i.versionConfig},()=>{this.setState({selectedService:i.versionConfig.services[0].name,vmsServices:i.versionConfig.services},()=>{this._filterRuntimeFields(),this.pullVersions(this.state.selectedService,!1).then(()=>{const e=this.state.versionList.filter(e=>{let t=i.versionConfig.services[0].configuredSettings.startupVersion;return""!==this.state.urlStartUpVersion&&(t=this.state.urlStartUpVersion),e.versionName===t||e.versionGuid===t});e.length>0&&this.setState({selectedVersion:e[0]})})})}):this.setState({configObj:i.versionConfig,selectedService:""})),i.versionConfig.hasOwnProperty("pageCounter")&&e.config.versionConfig.pageCounter!==i.versionConfig.pageCounter&&this.setState({maxDisplayRows:parseInt(i.versionConfig.pageCounter)},()=>{this.pullVersions(this.state.selectedService,!1)}),i.versionConfig.hasOwnProperty("services")&&i.versionConfig.services.length>0&&""!==this.state.selectedService)){const s=e.config.versionConfig.services.filter(e=>!0===e.activeInBuilder),r=i.versionConfig.services.filter(e=>!0===e.activeInBuilder);t.lodash.isDeepEqual(e.config.versionConfig.services[0].name,i.versionConfig.services[0].name)||this.forceUpdate(),s.length>0&&r.length>0&&(t.lodash.isDeepEqual(s[0].configuredSettings.displayInfo,r[0].configuredSettings.displayInfo)||this.setState({configObj:i.versionConfig},()=>{this._filterRuntimeFields()}),t.lodash.isDeepEqual(s[0].configuredSettings.allowance,r[0].configuredSettings.allowance)||this.setState({configObj:i.versionConfig}),t.lodash.isDeepEqual(s[0].configuredSettings.startupVersion,r[0].configuredSettings.startupVersion)||this.pullVersions(this.state.selectedService,!1).then(()=>{const e=this.state.versionList.filter(e=>{let t=r[0].configuredSettings.startupVersion;return""!==this.state.urlStartUpVersion&&(t=this.state.urlStartUpVersion),e.versionName===t||e.versionGuid===t});e.length>0&&this.setState({selectedVersion:e[0]},()=>{this.switchVersion(e[0])})}))}}render(){const{theme:i}=this.props;if(this.props.config.versionConfig.services.length<=0)return(0,e.jsx)(s.WidgetPlaceholder,{icon:P,widgetId:this.props.id,name:this.formatMessage("_widgetLabel"),css:t.css`height: ${this.props.autoHeight?"75px":"100%"}; width: ${this.props.autoWidth?"350px":"100%"};`});let r=!0;const o=(0,t.getAppStore)().getState().widgetsRuntimeInfo;return o.hasOwnProperty(this.props.widgetId)&&o[this.props.widgetId].hasOwnProperty("state")&&(r="OPENED"===o[this.props.widgetId].state),(0,e.jsxs)(s.Paper,{className:"gdb-version-management jimu-widget display-flex-column-1 overflow-auto",shape:"none",style:{backgroundColor:i.sys.color.surface.paper,height:"100%",padding:10},css:this.getStyle(this.props.theme),children:[!1===this.state.isReady&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:this.props.useDataSources&&this.props.useDataSources[0],onAllChildDataSourcesCreated:()=>{setTimeout(()=>w(this,void 0,void 0,function*(){const e=this._getMapViews();if(Object.keys(e).length>0){const s=t.DataSourceManager.getInstance();for(const t in e){const i=s.getDataSource(e[t].dataSourceId);i.isDataSourceSet()&&!i.areChildDataSourcesCreated()&&(yield i.childDataSourcesReady())}setTimeout(()=>{this._populateSwitchableSources("runtime")},1e3)}else this._populateSwitchableSources("runtime")}),1e3)},widgetId:this.props.id}),this.state.isReady&&!this.state.showVersionSettingsModal&&(0,e.jsx)("div",{id:this.widRefForPopper,children:this.renderServiceSelector()}),this.state.showVersionSettingsModal&&this.renderVersionModification(),(0,e.jsxs)(s.Modal,{isOpen:this.state.showDeleteModal,children:[(0,e.jsx)(s.ModalHeader,{toggle:e=>{this.toggleDeleteModal(!0)},children:this.formatMessage("modalheaderDeleteVersion")}),(0,e.jsxs)(s.ModalBody,{children:[(0,e.jsx)(s.Alert,{form:"basic",type:"warning",className:"w-100",open:this.state.showDeleteAlert,text:this.state.deleteAlertMsg}),this.state.versionObject.hasOwnProperty("version")?this.state.versionObject.version.toLowerCase()!==this.defaultVersion.toLowerCase()?this.formatMessage("actionLabelsDelete")+" "+this.state.versionObject.version+"?":this.formatMessage("actionLabelsCannotDelete"):""]}),this.state.versionObject.hasOwnProperty("version")&&this.state.versionObject.version.toLowerCase()!==this.defaultVersion.toLowerCase()?(0,e.jsxs)(s.ModalFooter,{children:[(0,e.jsx)(s.Button,{type:"primary",onClick:this.deleteVersion,children:this.formatMessage("versionmanagementYes")})," ",(0,e.jsx)(s.Button,{type:"secondary",onClick:e=>{this.toggleDeleteModal(!0)},children:this.formatMessage("versionmanagementNo")})]}):""]}),(0,e.jsxs)(s.Modal,{isOpen:this.state.showUpdateModal,children:[(0,e.jsx)(s.ModalHeader,{toggle:e=>{this.toggleUpdateModal(!0)},children:this.formatMessage("modalheaderUpdateVersion")}),(0,e.jsx)(s.ModalBody,{children:(0,e.jsx)(s.Alert,{type:"warning",form:"basic",className:"w-100",text:this.formatMessage("actionLabelsCannotDelete")})})]}),(0,e.jsx)(s.Popper,{open:!!r&&this.state.showFieldMgmt,reference:this.props.widgetId+"_btnFieldMgmt",placement:"left-start",arrowOptions:!0,zIndex:2001,children:(0,e.jsx)("div",{style:{width:"100%",height:this.state.fieldColumns.length<5?"auto":this._sizePopperHeight(100),overflow:"auto",fontSize:"medium"},children:this.renderFieldList()})})]})}_getSizeOfContainer(){const e=document.querySelector("div.gdb-version-management");return e?e.getBoundingClientRect():null}}function U(e){o.p=e}})(),n})())}}});