System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/utility-selector","jimu-arcgis","jimu-theme","jimu-ui/advanced/map"],function(e,t){var i={},n={},o={},r={},l={},s={},a={},c={};return{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){n.AllDataSourceTypes=e.AllDataSourceTypes,n.DataSourceManager=e.DataSourceManager,n.DataSourceTypes=e.DataSourceTypes,n.Immutable=e.Immutable,n.JSAPILayerTypes=e.JSAPILayerTypes,n.React=e.React,n.SupportedUtilityType=e.SupportedUtilityType,n.UtilityManager=e.UtilityManager,n.classNames=e.classNames,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,n.lodash=e.lodash,n.polished=e.polished},function(e){o.AlertPopup=e.AlertPopup,o.Badge=e.Badge,o.Button=e.Button,o.CollapsablePanel=e.CollapsablePanel,o.Loading=e.Loading,o.Option=e.Option,o.Select=e.Select,o.Switch=e.Switch,o.Tooltip=e.Tooltip,o.defaultMessages=e.defaultMessages},function(e){r.JimuLayerViewSelectorDropdown=e.JimuLayerViewSelectorDropdown,r.MapWidgetSelector=e.MapWidgetSelector,r.SearchDataSetting=e.SearchDataSetting,r.SearchDataType=e.SearchDataType,r.SearchGeneralSetting=e.SearchGeneralSetting,r.SearchSuggestionSetting=e.SearchSuggestionSetting,r.SettingRow=e.SettingRow,r.SettingSection=e.SettingSection},function(e){l.UtilitySelector=e.UtilitySelector,l.addNewUtility=e.addNewUtility,l.extractService=e.extractService},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent,s.MapViewManager=e.MapViewManager},function(e){a.Global=e.Global,a.useTheme=e.useTheme},function(e){c.JimuMap=e.JimuMap}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=a},14321:e=>{"use strict";e.exports=o},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},48993:e=>{"use strict";e.exports=c},53195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},60044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 15 15"><path fill="#000" fill-rule="evenodd" d="M7 0h1v4H7zM0 8V7h4v1zm11-1v1h4V7zm-4 4h1v4H7zm2-5H6v3h3z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=s},67386:e=>{"use strict";e.exports=i},71371:e=>{"use strict";e.exports=l},72529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=r}},t={};function u(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,u),o.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var i in t)u.o(t,i)&&!u.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var d={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(d),u.d(d,{__set_webpack_public_path__:()=>K,default:()=>W});var e=u(67386),t=u(79244),i=u(14321),n=u(79298),o=u(71371),r=u(31027),l=u.n(r),s=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const a=i=>{const n=window.SVG,{className:o}=i,r=s(i,["className"]),a=(0,t.classNames)("jimu-icon jimu-icon-component",o);return n?(0,e.jsx)(n,Object.assign({className:a,src:l()},r)):(0,e.jsx)("svg",Object.assign({className:a},r))};var c=u(53195),p=u.n(c),g=u(72529),v=u.n(g);const f={routeSettings:"Route Settings",searchSettings:"Search settings",routeUrl:"Route URL",outputStops:"Stops",outputRoute:"Route",outputDirectionPoints:"Direction points",outputDirectionLines:"Direction lines",unitSystem:"Unit system",barrierLayers:"Barrier layers",barrierDescription:"Supports up to 250 point barriers, 500 polyline barrier intersections, and 2,000 polygon barrier intersections per routing request.",showRoutesInLayerLists:"Show routes in layer lists",enableRouteSaving:"Enable route saving",presetStops:"Preset stops",specifyStops:"Specify stops",startPoint:"Start point",endPoint:"End point"};var h;!function(e){e.Imperial="imperial",e.Metric="metric"}(h||(h={}));const m={includeDefaultSources:!1,locationEnabled:!1,maxSuggestions:6};var y=function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function l(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(l,s)}a((n=n.apply(e,t||[])).next())})};function S(e){return`${e}_output_stop`}function w(e){return`${e}_output_direction_point`}function b(e){return`${e}_output_direction_line`}function x(e){return`${e}_output_route`}function j(e){if(!e)return null;const i={};return e.forEach(e=>{i[e.name]=t.dataSourceUtils.convertFieldToJimuField(e,null)}),i}function C(){var e;return"english"===(null===(e=(0,t.getAppStore)().getState().user)||void 0===e?void 0:e.units)?h.Imperial:h.Metric}function M(e){var i;return e?null===(i=t.UtilityManager.getInstance().getUtilityJson(e.utilityId))||void 0===i?void 0:i.url:null}var I=u(62686),O=u(45508),R=u.n(O),P=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const D=i=>{const n=window.SVG,{className:o}=i,r=P(i,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",o);return n?(0,e.jsx)(n,Object.assign({className:l,src:R()},r)):(0,e.jsx)("svg",Object.assign({className:l},r))};var U=u(1888),N=u(48993),L=u(60044),T=u.n(L),_=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const A=i=>{const n=window.SVG,{className:o}=i,r=_(i,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",o);return n?(0,e.jsx)(n,Object.assign({className:l,src:T()},r)):(0,e.jsx)("svg",Object.assign({className:l},r))};var E=function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function l(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(l,s)}a((n=n.apply(e,t||[])).next())})};const V=(e,i)=>t.css`
    .stops-selector-alert-popup {
      justify-content: center;
      max-width: max-content !important;
      .stops-selector-alert-popup__content {
        width: ${window.innerHeight-200}px;
        height: ${window.innerHeight-300}px;
        display: flex;
        flex-direction: column;
        .jimu-map {
          cursor: ${i?"crosshair":""}
        }
        .search-widget-container {
          --calcite-color-foreground-1: #444;
          display: flex;
          min-height: 32px;
          max-height: 32px;
          overflow: hidden;
          justify-content: space-between;
          align-items: center;
          margin-top: 0.75rem;
          .stops-label {
            width: 178px;
          }
          .locate-button.locating {
            background-color: var(--sys-color-primary-main);
          }
          .search-widget-container__content {
            margin-left: 16px;
            flex: 1;
            .esri-search {
              width: 100%;
            }
          }
        }
      }
    }
  `;function k(n){var o,r,l,s,a,c,u,d,p,g;const[v,h]=t.React.useState(!1),[S,w]=t.React.useState(null),b=t.React.useRef(null),x=t.React.useRef(null),j=t.React.useRef(null),C=t.React.useRef(null),[I,O]=t.React.useState(!1),[R,P]=t.React.useState(!1),D=t.hooks.useTranslation(f),L=((0,U.useTheme)(),t.React.useRef(null)),T=t.React.useRef(null),_=t.React.useRef(null),k=t.React.useRef(null),F=t.React.useRef(null),J=t.React.useRef(null),[B,H]=t.React.useState(!1),[z,G]=t.React.useState(!1),[W,$]=t.React.useState(!1),q=()=>{h(!0)},Q=t.React.useCallback((e,t)=>{let i=n.directionsProps.config;i=i.setIn(["routeConfig","presetStart"],e?{name:e.name,geometry:e.graphic.geometry.toJSON()}:null),i=i.setIn(["routeConfig","presetEnd"],t?{name:t.name,geometry:t.graphic.geometry.toJSON()}:null),n.directionsProps.onSettingChange({id:n.directionsProps.id,config:i})},[n.directionsProps]),Z=t.React.useCallback(e=>t=>{if(!z)return;const i=t.result,n=i.feature.geometry,o=i.name,r=new(0,k.current)({geometry:n,symbol:{type:"simple-marker",color:e?"#00FF00":"#FF0000",size:12,outline:{color:"white",width:1}}});e&&T.current&&S.view.graphics.remove(T.current.graphic),!e&&_.current&&S.view.graphics.remove(_.current.graphic),e?T.current={graphic:r,name:o}:_.current={graphic:r,name:o},S.view.graphics.add(r)},[null===(o=null==S?void 0:S.view)||void 0===o?void 0:o.graphics,z]),K=t.React.useCallback(e=>()=>{var t,i;e&&T.current&&(null===(t=null==S?void 0:S.view)||void 0===t||t.graphics.remove(T.current.graphic),T.current=null),!e&&_.current&&(null===(i=null==S?void 0:S.view)||void 0===i||i.graphics.remove(_.current.graphic),_.current=null)},[null===(r=null==S?void 0:S.view)||void 0===r?void 0:r.graphics]),X=e=>t=>{e?(P(!1),O(!I)):(O(!1),P(!R))};t.React.useEffect(()=>{!function(){E(this,void 0,void 0,function*(){if(z)return;const[e,i,n]=yield(0,t.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/support/jsonUtils","esri/widgets/Search"]);k.current=e,J.current=i,F.current=n,G(!0)})}()},[z]),t.React.useEffect(()=>{!function(){var e,t,i,o;if(!B||!z)return;const r=null===(t=null===(e=null==n?void 0:n.directionsProps.config)||void 0===e?void 0:e.routeConfig)||void 0===t?void 0:t.presetStart,l=null===(o=null===(i=null==n?void 0:n.directionsProps.config)||void 0===i?void 0:i.routeConfig)||void 0===o?void 0:o.presetEnd;if(r){const e=J.current.fromJSON(r.geometry);j.current.search(e)}if(l){const e=J.current.fromJSON(l.geometry);C.current.search(e)}}()},[B,null===(s=null===(l=null==n?void 0:n.directionsProps.config)||void 0===l?void 0:l.routeConfig)||void 0===s?void 0:s.presetEnd,null===(c=null===(a=null==n?void 0:n.directionsProps.config)||void 0===a?void 0:a.routeConfig)||void 0===c?void 0:c.presetStart,z]),t.React.useEffect(()=>{(null==S?void 0:S.view)&&z&&(L.current&&L.current.remove(),L.current=S.view.on("click",function(e){return E(this,void 0,void 0,function*(){if(!(I||R))return;const t=e.mapPoint;I&&T.current&&S.view.graphics.remove(T.current.graphic),R&&_.current&&S.view.graphics.remove(_.current.graphic),yield I?j.current.search(t):C.current.search(t),I?O(!1):P(!1)})}))},[null==S?void 0:S.view,R,I,n.directionsProps.config.searchConfig,z]),t.hooks.useEffectWithPreviousValues(e=>{const[i,o]=e;!function(){E(this,void 0,void 0,function*(){if(!S||!z)return;if(i===S&&o===n.directionsProps.config.searchConfig)return;const e=F.current,r=document.createElement("div");r.className="search-container",b.current.innerHTML="",b.current.appendChild(r);const l=document.createElement("div");l.className="search-container",x.current.innerHTML="",x.current.appendChild(l);const s=yield function(e,i){return y(this,void 0,void 0,function*(){var n,o,r;const l=Object.assign({},m),s=(null===(n=null==e?void 0:e.generalConfig)||void 0===n?void 0:n.hint)||i;if(s&&(l.allPlaceholder=s),"number"==typeof(null===(o=null==e?void 0:e.suggestionConfig)||void 0===o?void 0:o.maxSuggestions)&&(l.maxSuggestions=e.suggestionConfig.maxSuggestions),"boolean"==typeof(null===(r=null==e?void 0:e.suggestionConfig)||void 0===r?void 0:r.isUseCurrentLoation)&&(l.locationEnabled=e.suggestionConfig.isUseCurrentLoation),Array.isArray(null==e?void 0:e.dataConfig)){const n=null==e?void 0:e.dataConfig.asMutable({deep:!0}).map(e=>y(this,void 0,void 0,function*(){var n,o;if(e.useUtility){const t={url:M(e.useUtility),name:e.label,placeholder:e.hint||i,withinViewEnabled:null!==(n=e.searchInCurrentMapExtent)&&void 0!==n&&n};return e.enableCountryCode&&(t.countryCode=e.countryCode),Promise.resolve(t)}if(e.useDataSource){const n=yield t.DataSourceManager.getInstance().createDataSourceByUseDataSource(e.useDataSource),r=t.dataSourceUtils.getJSAPILayer(n);if(!r)return null;const l={layer:r,searchFields:e.searchFields.map(e=>e.name),outFields:e.displayFields.map(e=>e.name),suggestionTemplate:e.displayFields.map(e=>`{${e.name}}`).join(", "),searchTemplate:e.displayFields.map(e=>`{${e.name}}`).join(", "),name:e.label,placeholder:e.hint||i,withinViewEnabled:null!==(o=e.searchInCurrentMapExtent)&&void 0!==o&&o};return Promise.resolve(l)}}));yield Promise.all(n).then(e=>{l.sources=e.filter(e=>!!e)})}return Promise.resolve(l)})}(n.directionsProps.config.searchConfig,D("findAddressOrPlace"));j.current=new e({view:S.view,container:r,sources:s.sources,includeDefaultSources:!1,locationEnabled:!1,popupEnabled:!1}),C.current=new e({view:S.view,container:l,sources:s.sources,includeDefaultSources:!1,locationEnabled:!1,popupEnabled:!1}),yield Promise.all([j.current.when(),C.current.when()]),H(!0),j.current.on("select-result",Z(!0)),C.current.on("select-result",Z(!1)),j.current.on("search-clear",K(!0)),C.current.on("search-clear",K(!1))})}()},[S,n.directionsProps.config.searchConfig,Z,D,z]);const Y=n.jimuMapConfig?n.jimuMapConfig.set("toolConfig",{canZoom:!0,canHome:!0,canSearch:!1,canCompass:!0}):(0,t.Immutable)({}),ee=I||R,te=(null===(d=null===(u=n.directionsProps.config)||void 0===u?void 0:u.routeConfig)||void 0===d?void 0:d.presetStart)||(null===(g=null===(p=n.directionsProps.config)||void 0===p?void 0:p.routeConfig)||void 0===g?void 0:g.presetEnd);return(0,e.jsxs)("div",{css:V(0,ee),children:[(0,e.jsx)(U.Global,{styles:V(0,ee)}),te?(0,e.jsx)(i.Badge,{dot:!0,color:"error",children:(0,e.jsx)(i.Button,{onClick:q,children:n.buttonLabel})}):(0,e.jsx)(i.Button,{onClick:q,children:n.buttonLabel}),(0,e.jsxs)(i.AlertPopup,{className:"stops-selector-alert-popup",isOpen:v,title:n.title,onClickOk:()=>{Q(T.current,_.current),h(!1),H(!1),$(!1)},onClickClose:()=>{T.current=null,_.current=null,h(!1),H(!1),$(!1)},children:[!W&&(0,e.jsx)(i.Loading,{}),(0,e.jsxs)("div",{className:"stops-selector-alert-popup__content",style:{visibility:W?"visible":"hidden"},children:[(0,e.jsx)("div",{className:"w-100 h-100 jimu-map",style:{backgroundColor:"gray",marginBottom:"0.75rem"},children:(0,e.jsx)(N.JimuMap,{id:n.id+"editor",useDataSources:n.useDataSources,jimuMapConfig:Y,onActiveViewChange:e=>E(this,void 0,void 0,function*(){w(e),yield e.whenJimuMapViewLoaded(),$(!0)})})}),(0,e.jsxs)("div",{className:"search-widget-container",children:[(0,e.jsx)("div",{className:"stops-label",children:D("startPoint")}),(0,e.jsxs)("div",{className:"d-flex search-widget-container__content",children:[(0,e.jsx)("div",{ref:b,className:"w-100 d-flex"}),(0,e.jsx)(i.Button,{className:(0,t.classNames)("locate-button",I?"locating":""),icon:!0,onClick:X(!0),children:(0,e.jsx)(A,{})})]})]}),(0,e.jsxs)("div",{className:"search-widget-container",children:[(0,e.jsx)("div",{className:"stops-label",children:D("endPoint")}),(0,e.jsxs)("div",{className:"d-flex search-widget-container__content",children:[(0,e.jsx)("div",{ref:x,className:"w-100 d-flex"}),(0,e.jsx)(i.Button,{className:(0,t.classNames)("locate-button",R?"locating":""),icon:!0,onClick:X(!1),children:(0,e.jsx)(A,{})})]})]})]})]})]})}var F=function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function l(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(l,s)}a((n=n.apply(e,t||[])).next())})};const{useMemo:J,useEffect:B,useState:H}=t.React,z={maxSuggestions:6},G=[t.SupportedUtilityType.Routing],W=r=>{var l,s,c,u,d,g,m,y,M,O,R;const{onSettingChange:P,id:U,config:N,useMapWidgetIds:L,useUtilities:T,portalUrl:_}=r,A=t.hooks.useTranslation(f,i.defaultMessages),E=null==N?void 0:N.routeConfig,V=null===(l=N.searchConfig)||void 0===l?void 0:l.dataConfig,W=null===(s=N.searchConfig)||void 0===s?void 0:s.generalConfig,K=J(()=>{var e;return(0,t.Immutable)(z).merge((null===(e=N.searchConfig)||void 0===e?void 0:e.suggestionConfig)||{})},[null===(c=N.searchConfig)||void 0===c?void 0:c.suggestionConfig]),X=t.React.useRef(null),[Y,ee]=H(null),[te,ie]=H(!1),[ne,oe]=H(null);B(()=>{X.current=N},[N]);const re=t.React.useCallback(e=>{var i,n,o;if(!t.lodash.isDeepEqual(e,V)){const t=X.current.setIn(["searchConfig","dataConfig"],e);P({id:U,config:t,useUtilities:q(null===(n=null===(i=X.current)||void 0===i?void 0:i.routeConfig)||void 0===n?void 0:n.useUtility,null===(o=null==e?void 0:e.filter(e=>!!e.useUtility).map(e=>e.useUtility))||void 0===o?void 0:o.asMutable())})}},[U,V,P]),le=e=>t=>{0===t.length?P({id:U,config:N.setIn(["routeConfig","barrierLayers"],N.getIn(["routeConfig","barrierLayers"]).without(e))}):P({id:U,config:N.setIn(["routeConfig","barrierLayers",e],t)})},se=e=>{var i;return!(e.type===t.JSAPILayerTypes.FeatureLayer&&["point","polyline","polygon"].includes(null===(i=e.layer)||void 0===i?void 0:i.geometryType))},ae=J(()=>(null==L?void 0:L.length)>0,[L]),ce=`${U}-desc`;return B(()=>{var e;const i=V&&function(e,t){return e.filter(e=>!!e.useDataSource||t.some(t=>{var i;return t.utilityId===(null===(i=null==e?void 0:e.useUtility)||void 0===i?void 0:i.utilityId)}))}(V,T),n=E&&function(e,t){if(e&&e.useUtility&&t.some(t=>t.utilityId===e.useUtility.utilityId))return e;return e.without("useUtility")}(E,T);t.lodash.isDeepEqual(i,V)&&t.lodash.isDeepEqual(n,E)||P({id:U,config:N.setIn(["searchConfig","dataConfig"],i).setIn(["routeConfig"],n),useUtilities:q(null==n?void 0:n.useUtility,null===(e=null==i?void 0:i.map(e=>e.useUtility))||void 0===e?void 0:e.asMutable())})},[N,U,P,E,V,T]),B(()=>{if(Y)return;const e=function(e){var i;const n=null===(i=(0,t.getAppStore)().getState().portalSelf)||void 0===i?void 0:i.helperServices;return(0,o.extractService)(n,t.SupportedUtilityType.Routing,null,null,e)}(A);if(!e||0===e.length)return;const i=e[0];(0,o.addNewUtility)(i);const n=t.UtilityManager.getInstance().getIdOfOrgUtility(i.name,i.url,i.index,i.label);!Y&&n&&ee(n)},[Y,A]),t.hooks.useEffectWithPreviousValues(e=>{var t,i,n;const[o]=e;if((!(null==o?void 0:o.routeConfig)||(null==N?void 0:N.routeConfig))&&Y&&!(null==N?void 0:N.routeConfig)&&!te){const e={utilityId:Y};P({id:U,config:N.setIn(["routeConfig","useUtility"],e),useUtilities:q(e,null===(n=null===(i=null===(t=N.searchConfig)||void 0===t?void 0:t.dataConfig)||void 0===i?void 0:i.map(e=>e.useUtility))||void 0===n?void 0:n.asMutable())}),ie(!0)}},[N,te,Y,U,P,A]),(0,e.jsxs)("div",{className:"widget-setting-directions jimu-widget-setting",css:$,children:[(0,e.jsx)(n.SettingSection,{title:A("selectMapWidget"),className:(0,t.classNames)({"border-0":!ae}),children:(0,e.jsx)(n.SettingRow,{children:(0,e.jsx)(n.MapWidgetSelector,{onSelect:e=>F(void 0,void 0,void 0,function*(){const i=yield function(e,i,n){return F(this,void 0,void 0,function*(){var o,r,l,s;if(!i||0===i.length)return Promise.resolve([]);try{const[i,a,c,u]=yield(0,t.loadArcGISJSAPIModules)(["esri/rest/support/Stop","esri/rest/support/DirectionPoint","esri/rest/support/DirectionLine","esri/rest/support/RouteInfo"]);return[{id:S(e),label:n("outputStops"),type:t.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPoint",schema:{idField:(null===(o=i.fields.find(e=>"esriFieldTypeOID"===e.type))||void 0===o?void 0:o.name)||"__OBJECTID",fields:Object.assign({},j(i.fields))}},{id:w(e),label:n("outputDirectionPoints"),type:t.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPoint",schema:{idField:(null===(r=a.fields.find(e=>"esriFieldTypeOID"===e.type))||void 0===r?void 0:r.name)||"__OBJECTID",fields:Object.assign({},j(a.fields))}},{id:b(e),label:n("outputDirectionLines"),type:t.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPolyline",schema:{idField:(null===(l=c.fields.find(e=>"esriFieldTypeOID"===e.type))||void 0===l?void 0:l.name)||"__OBJECTID",fields:Object.assign({},j(c.fields))}},{id:x(e),label:n("outputRoute"),type:t.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPolyline",schema:{idField:(null===(s=u.fields.find(e=>"esriFieldTypeOID"===e.type))||void 0===s?void 0:s.name)||"__OBJECTID",fields:Object.assign({},j(u.fields))}}]}catch(e){return console.warn("Failed to create output data source in directions widget. ",e),Promise.resolve([])}})}(U,e,A);P({id:U,useMapWidgetIds:e},i)}),useMapWidgetIds:L})})}),ae?(0,e.jsxs)("div",{children:[(0,e.jsx)(I.JimuMapViewComponent,{useMapWidgetId:null==L?void 0:L[0],onViewsChange:e=>{const t=1===Object.keys(e).length&&Object.keys(e)[0]===`${null==L?void 0:L[0]}-`;oe(t?null:e)}}),(0,e.jsxs)(n.SettingSection,{role:"group","aria-label":A("routeSettings"),title:A("routeSettings"),children:[(0,e.jsx)(n.SettingRow,{flow:"wrap",label:A("routeUrl"),children:(0,e.jsx)(o.UtilitySelector,{useUtilities:(0,t.Immutable)((null==E?void 0:E.useUtility)&&(null==T?void 0:T.some(e=>E.useUtility.utilityId===e.utilityId))?[E.useUtility]:[]),onChange:e=>{var t,i,n,o,r;if((null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.utilityId)!==(null===(i=null==E?void 0:E.useUtility)||void 0===i?void 0:i.utilityId)){let t=N;if(null==e?void 0:e[0])t=N.setIn(["routeConfig","useUtility"],null==e?void 0:e[0]);else{const e=N.getIn(["routeConfig"]).without("useUtility");t=N.setIn(["routeConfig"],e)}P({id:U,config:t,useUtilities:q(null==e?void 0:e[0],null===(r=null===(o=null===(n=N.searchConfig)||void 0===n?void 0:n.dataConfig)||void 0===o?void 0:o.map(e=>e.useUtility))||void 0===r?void 0:r.asMutable())})}},showRemove:!0,closePopupOnSelect:!0,types:G,"aria-describedby":ce})}),(0,e.jsx)(n.SettingRow,{className:"mt-0",children:(0,e.jsx)("i",{className:"text-break example-url",id:ce,children:A("exampleUrl",{url:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World"})})}),(0,e.jsx)(n.SettingRow,{flow:"wrap",label:A("presetStops"),children:(0,e.jsx)(k,{directionsProps:r,buttonLabel:A("specifyStops"),title:A("specifyStops"),id:null===(u=r.useMapWidgetIds)||void 0===u?void 0:u[0],jimuMapConfig:(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets[null===(d=r.useMapWidgetIds)||void 0===d?void 0:d[0]].config,useDataSources:(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets[null===(g=r.useMapWidgetIds)||void 0===g?void 0:g[0]].useDataSources})}),ne&&(0,e.jsx)(n.SettingRow,{flow:"no-wrap",label:A("barrierLayers"),children:(0,e.jsx)(i.Tooltip,{title:A("barrierDescription"),children:(0,e.jsx)(i.Button,{icon:!0,variant:"text",disableHoverEffect:!0,disableRipple:!0,className:"p-0",children:(0,e.jsx)(D,{})})})}),(0,e.jsx)(n.SettingRow,{flow:"wrap",className:"mt-2",children:ne&&(Q(ne)?Object.keys(ne).map(t=>{var o,r;return(0,e.jsx)(i.CollapsablePanel,{leftIcon:"2d"===ne[t].view.type?p():v(),label:Z(t),children:(0,e.jsx)(n.JimuLayerViewSelectorDropdown,{jimuMapViewId:t,onChange:le(t),selectedValues:null===(r=null===(o=null==E?void 0:E.barrierLayers)||void 0===o?void 0:o[t])||void 0===r?void 0:r.asMutable(),isMultiSelection:!0,autoHeight:!0,disableLayers:se})},t)}):(0,e.jsx)(n.JimuLayerViewSelectorDropdown,{jimuMapViewId:Object.keys(ne)[0],onChange:le(Object.keys(ne)[0]),selectedValues:null===(y=null===(m=null==E?void 0:E.barrierLayers)||void 0===m?void 0:m[Object.keys(ne)[0]])||void 0===y?void 0:y.asMutable(),isMultiSelection:!0,autoHeight:!0,disableLayers:se}))})]}),(0,e.jsxs)(n.SettingSection,{role:"group","aria-label":A("searchSettings"),title:A("searchSettings"),className:"search-settings",children:[(0,e.jsx)(n.SearchDataSetting,{id:U,datasourceConfig:V,createOutputDs:!1,portalUrl:_,searchDataSettingType:n.SearchDataType.Both,onSettingChange:re,autoSelectAllOrgGeocodeService:!0,hideIconSetting:!0,hideEnableFiltering:!0,showSearchInCurrentMapExtentSetting:!0,supportedDsTypes:[t.AllDataSourceTypes.FeatureLayer],hideDs:e=>"esriGeometryPoint"!==t.DataSourceManager.getInstance().getDataSource(e.id).getGeometryType()}),(0,e.jsx)(n.SearchGeneralSetting,{id:U,hint:null==W?void 0:W.hint,onGeneralSettingChange:(e,i)=>{var n;if("string"==typeof i&&i!==(null==W?void 0:W.hint)){const o=((null===(n=N.searchConfig)||void 0===n?void 0:n.generalConfig)||(0,t.Immutable)({})).setIn(e,i);P({id:U,config:N.setIn(["searchConfig","generalConfig"],o)})}}}),(0,e.jsx)(n.SearchSuggestionSetting,{id:U,settingConfig:K,onSettingChange:e=>{t.lodash.isDeepEqual(e,K)||P({id:U,config:N.setIn(["searchConfig","suggestionConfig"],e)})},hideRecentSearchSetting:!0})]}),(0,e.jsxs)(n.SettingSection,{role:"group","aria-label":A("generalSettings"),title:A("generalSettings"),className:"general-settings",children:[(0,e.jsx)(n.SettingRow,{flow:"wrap",tag:"label",label:A("unitSystem"),children:(0,e.jsxs)(i.Select,{value:null!==(M=null==N?void 0:N.unit)&&void 0!==M?M:C(),onChange:e=>{const t=e.target.value;P({id:U,config:N.set("unit",t)})},children:[(0,e.jsx)(i.Option,{value:h.Metric,children:A("unitsLabelMetric")}),(0,e.jsx)(i.Option,{value:h.Imperial,children:A("unitsLabelImperial")})]})}),(0,e.jsx)(n.SettingRow,{tag:"label",label:A("enableRouteSaving"),children:(0,e.jsx)(i.Switch,{checked:null===(O=null==N?void 0:N.enableRouteSaving)||void 0===O||O,onChange:e=>{const t=e.target.checked;P({id:U,config:N.set("enableRouteSaving",t)})}})}),(0,e.jsx)(n.SettingRow,{tag:"label",label:A("showRoutesInLayerLists"),children:(0,e.jsx)(i.Switch,{checked:null===(R=null==N?void 0:N.showRuntimeLayers)||void 0===R||R,onChange:e=>{const t=e.target.checked;P({id:U,config:N.set("showRuntimeLayers",t)})}})})]})]}):(0,e.jsx)("div",{className:"d-flex justify-content-center align-items-center placeholder-container",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)(a,{size:48,className:"d-inline-block placeholder-icon mb-2"}),(0,e.jsx)("p",{className:"placeholder-hint",children:A("selectMapHint")})]})})]})},$=t.css`
.route-url-input{
  min-height: ${t.polished.rem(100)}
}
.example-url{
  font-size: ${t.polished.rem(12)};
  color: var(--ref-palette-neutral-1000);
}
.warning-icon{
  color: var(--sys-color-error-main);
}
.warning-hint{
  width: calc(100% - 20px);
  margin: 0 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--sys-color-error-main);
}
.placeholder-container{
  height: calc(100% - 100px);
  .placeholder-hint{
    font-size: ${t.polished.rem(14)};
    font-weight: 500;
    color: var(--ref-palette-neutral-1000);
    max-width: ${t.polished.rem(160)};
  }
  .placeholder-icon{
    color: var(--ref-palette-neutral-800);
  }
}
.search-settings{
  >div>div {
    padding-left: 0 !important;
    padding-right: 0 !important;
    padding-top: 0 !important;
    border: 0 !important;
  }
}
`;function q(e,t){return(e?[e]:[]).concat(t).filter(e=>!!e)}function Q(e){return!!e&&Object.keys(e).length>1}function Z(e){return I.MapViewManager.getInstance().getJimuMapViewById(e).getMapDataSource().getLabel()}function K(e){u.p=e}})(),d})())}}});