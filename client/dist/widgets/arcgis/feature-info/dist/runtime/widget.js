System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","jimu-ui"],function(e,t){var a={},i={},s={},o={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.BaseVersionManager=e.BaseVersionManager,i.CONSTANTS=e.CONSTANTS,i.ClauseLogic=e.ClauseLogic,i.ClauseOperator=e.ClauseOperator,i.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.Immutable=e.Immutable,i.JSAPILayerTypes=e.JSAPILayerTypes,i.MessageManager=e.MessageManager,i.React=e.React,i.appConfigUtils=e.appConfigUtils,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.esri=e.esri,i.getAppStore=e.getAppStore,i.lodash=e.lodash,i.uuidv1=e.uuidv1},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent,s.MapViewManager=e.MapViewManager,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.Alert=e.Alert,o.Button=e.Button,o.DataActionList=e.DataActionList,o.DataActionListStyle=e.DataActionListStyle,o.DistanceUnits=e.DistanceUnits,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages}],execute:function(){e((()=>{var e={4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},6821:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M8.5 4a.5.5 0 0 0 0 1h8a.5.5 0 0 0 0-1zM8.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM8 10.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5M3.5 10a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zM4 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5M3.5 4a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zM4 15.5 6 14v3zM16 15.5 14 14v3z"></path><path fill="#000" fill-rule="evenodd" d="M20 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=o},62686:e=>{"use strict";e.exports=s},67386:e=>{"use strict";e.exports=a},79244:e=>{"use strict";e.exports=i}},t={};function r(a){var i=t[a];if(void 0!==i)return i.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var n={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(n),r.d(n,{__set_webpack_public_path__:()=>A,default:()=>O});var e,t,a=r(67386),i=r(79244),s=r(62686),o=r(14321);function d(e,a,s,o,r,n){let d;const u=s.backgroundColor?s.backgroundColor:e.sys.color.surface.paper;let l;const c="";let h,p,g=c,f=c,S=c,v=c,D=c,m=c,y=!1;"custom"===a?(y=!!s.textColor,d=s.textColor?s.textColor:e.sys.color.surface.paperText,l=s.fontSize,l&&0!==l.distance&&s.fontSizeType!==t.auto&&(h=l.unit,p=l.distance,g=p+h,f=Math.round(1.428*p)+h,S=Math.round(1.142*p)+h,v=p,D=Math.round(.857*p)+h,m=Math.round(.857*p)+h)):(p=c,d=e.sys.color.surface.paperText);const C=d||e.sys.color.surface.paperText;let I="10px",w="auto";return o&&(I="auto",w="10px"),i.css`
    .widget-featureInfo{
      overflow: auto;
      word-break: break-word;
      //border-radius: ${e.sys.shape.shape2};
      border-radius: 0px;
      //min-width: min-content;
      //min-width: 210px;
      ${n?"min-width: 210px":"min-width: min-content"};
      min-height: 53px;
      ${r?"width: max-content":""};
      height: 100%;
      background-color: ${u};
      color: ${d};
      --calcite-color-text-1: ${d};
      --calcite-color-text-3: ${d};
      font-size: ${g};
      --calcite-font-size--0: ${g};
      --calcite-font-size--1: ${g};
      --calcite-font-size--2: ${g};
      --calcite-color-foreground-1: ${u};

      .warning-icon{
        position: absolute;
        bottom: 10px;
        right: ${I};
        left: ${w};
      }
      .warning-inaccessible{
        position: absolute;
        left: 0.25rem;
        right: 0.25rem;
        bottom: 0.25rem;
        width: auto;
      }
      .header-section{
        //min-width: max-content;
        display: flex;
        justify-content: space-between;
        height: 40px;
        border-bottom: 1px solid #a8a8a8;
        background-color: ${u};
      }
      .nav-section{
        min-width: 0;
        flex-shrink: 0;
        height: 40px;
        background-color: transparent;
        .nav-btn{
          margin: 0 5px;
          //color: ${e.sys.color.primary.main};
          color: ${d};
        }
        .nav-btn: hover{
          //color: ${e.sys.color.primary.light};
        }
        .nav-btn: disabled{
          color: ${e.sys.color.action.disabled.text};
        }
        .nav-btn:focus{
          box-shadow: none;
        }
      }
      .header-operation-section {
        display: flex;
        min-width: 0;
        flex-grow: 2;
        justify-content: flex-end;
      }
      .data-source-selector {
        display: flex;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        height: 40px;
        justify-content: flex-end;
        align-items: center;
        .jimu-dropdown {
          min-width: 0;
          .jimu-dropdown-button {
            //color: ${C};
            color: ${d};
          }
        }
        .data-action-dropdown-content{
        }
      }
      .header-control-section{
        min-width: 0;
        flex-shrink: 0;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        height: 40px;
        //flex-grow: 2;
        margin: 0 10px;
        /*
        position: absolute;
        right: 0;
        */
        .clear-selection > button{
          color: ${d};
        }
        .clear-selection > button: disabled{
          color: ${e.sys.color.action.disabled.text};
        }
      }
      .feature-info-component{
        background-color: ${"transparent"};
        padding: 4px;
        .esri-feature__size-container{
          background-color: ${u};
          color: ${d};
        }
        h2 {
          font-family: inherit;
        }
        .esri-widget * ${y?"":":not(.esri-feature-content *)"} {
          font-size: ${g};
          color: ${d} !important;
        }
        .esri-widget {
          background-color: transparent !important;
        }
        .esri-feature__title{
          padding: 10px 7px 0 7px;
          margin: auto;
        }
        .esri-widget__heading {
          margin: 0 0 0.5rem 0;
        }
        .esri-feature__content-element{
          padding-top: 7px;
        }
        .esri-widget__table tr td, .esri-widget__table tr th {
          font-size: ${m};
          word-break: break-word !important;
        }
        .esri-feature__main-container{
        }
        .esri-feature__media-previous:focus{
          outline: none;
        }
        .esri-feature__media-next:focus{
          outline: none;
        }
        .esri-feature__title {
          font-size: ${g};
        }
        .esri-feature h1 {
          font-size: ${f};
        }
        .esri-feature h2 {
          font-size: ${S};
        }
        .esri-feature h3,
        .esri-feature h4,
        .esri-feature h5,
        .esri-feature h6 {
          font-size: ${v};
        }
        .esri-feature p {
          font-size: ${g};
        }

        .esri-feature-content {
          padding: 0 15px;
        }
        .esri-feature-content p {
          margin: 0 0 1.2em
        }

        .esri-feature-content a[href] {
          text-decoration-line: underline;
        }

        .esri-feature figcaption {
          font-size: ${m};
        }

        .esri-feature__media-item-title {
          font-size: ${S};
        }
        .esri-feature__media-item-caption {
          font-size: ${D};
        }
        .esri-feature__last-edited-info {
          font-size: ${m};
        }
        .esri-widget__table tr td, .esri-widget__table tr th {
          word-break: normal;
        }

      }
    }
  `}!function(e){e.syncWithTheme="syncWithTheme",e.usePopupDefined="usePopupDefined",e.custom="custom"}(e||(e={})),function(e){e.auto="auto",e.custom="custom"}(t||(t={}));const u="Feature Info",l="No data found.",c="{index} of {count}",h="{layer} feature info current record";var p;!function(e){e.Pending="Pending",e.Fulfilled="Fulfilled",e.Rejected="Rejected"}(p||(p={}));class g extends i.React.PureComponent{constructor(e){super(e),this.featureContainerRef=i.React.createRef(),this.state={loadStatus:p.Pending}}componentDidMount(){this.createFeature()}componentDidUpdate(e){if(this.features){this.updateDataSource(e);const t={popupTemplate:{content:""}},a=this.props.graphic?[this.props.graphic]:[t];this.updateGraphic(e,a),this.features.timeZone=this.getTimezone(),this.updateVisibleElementsContent(a)}}updateGraphic(e,t){var a,i,s,o,r,n,d;let u=(null===(a=this.props.graphic)||void 0===a?void 0:a.popupTemplate)||(null===(s=null===(i=this.props.graphic)||void 0===i?void 0:i.layer)||void 0===s?void 0:s.popupTemplate);u||(u=this.props.defaultPopupTemplate,this.props.graphic&&(this.props.graphic.popupTemplate=u));const l=this.isOutputDSFromChart();null===(o=null==u?void 0:u.fieldInfos)||void 0===o||o.forEach(e=>{var t,a,i,s,o;const r=null===(o=null===(s=null===(i=null===(a=null===(t=this.props.graphic)||void 0===t?void 0:t.layer)||void 0===a?void 0:a.fields)||void 0===i?void 0:i.find(t=>t.name===e.fieldName))||void 0===s?void 0:s.toJSON())||void 0===o?void 0:o.type;r&&"esriFieldTypeTimestampOffset"===r?e.visible=!1:l&&(e.visible=!0)}),void 0!==(null===(r=this.props.graphic)||void 0===r?void 0:r.uid)&&(null===(n=this.props.graphic)||void 0===n?void 0:n.uid)===(null===(d=e.graphic)||void 0===d?void 0:d.uid)||setTimeout(()=>{this.features.features=t},1)}updateDataSource(e){var t,a;const i=this.props.dataSource.getRootDataSource(),s=this.getViewByDataSourceId(null==i?void 0:i.id);this.features.spatialReference=(null==s?void 0:s.spatialReference)||(null===(a=null===(t=this.props.graphic)||void 0===t?void 0:t.layer)||void 0===a?void 0:a.spatialReference)||null,this.features.map=(null==i?void 0:i.map)||null,this.props.useMapWidget&&(this.features.view=s||null)}updateVisibleElementsContent(e){const t={actionBar:!1,closeButton:!1,heading:this.props.visibleElements.title};this.features.visibleElements=t;const a=this.features.viewModel.featureViewModelAbilities,i=this.props.visibleElements.content;if((null==a?void 0:a.attachmentsContent)!==i.attachments||(null==a?void 0:a.customContent)!==i.text||(null==a?void 0:a.fieldsContent)!==i.fields||(null==a?void 0:a.mediaContent)!==i.media||(null==a?void 0:a.textContent)!==i.text){const t={attachmentsContent:i.attachments,customContent:i.text,fieldsContent:i.fields,mediaContent:i.media,textContent:i.text};this.features.viewModel.featureViewModelAbilities=t,this.features.features=e}}getTimezone(){var e;return i.dataSourceUtils.getTimezoneAPIFromRuntime(null===(e=this.props.dataSource)||void 0===e?void 0:e.getTimezone())}isOutputDSFromChart(){var e;const t=null===(e=this.props.dataSource)||void 0===e?void 0:e.getDataSourceJson();return t.isOutputFromWidget&&t.schema}destroyFeature(){this.features&&!this.features.destroyed&&this.features.destroy()}getViewByDataSourceId(e){const t=s.MapViewManager.getInstance().getAllJimuMapViews().find(t=>t.dataSourceId===e);return(null==t?void 0:t.view)||null}createFeature(){let e;return e=this.Features?Promise.resolve():(0,s.loadArcGISJSAPIModules)(["esri/widgets/Features"]).then(e=>{[this.Features]=e}),e.then(()=>{this.destroyFeature(),this.features=new this.Features({container:this.featureContainerRef.current,visible:!0,features:[this.props.graphic],defaultPopupTemplateEnabled:!0,timeZone:this.props.timeZone,visibleElements:{actionBar:!1,closeButton:!1}})}).then(()=>{this.setState({loadStatus:p.Fulfilled})})}render(){return(0,a.jsx)("div",{className:"feature-info-component",children:(0,a.jsx)("div",{id:"features-container",role:"document",tabIndex:0,ref:this.featureContainerRef})})}}var f=function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function n(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,n)}d((i=i.apply(e,t||[])).next())})};class S extends i.React.PureComponent{constructor(e){super(e),this.countOfQueryGraphics=0,this.initDataLoader=()=>{this.previousIndex=0,this.previousData={id:null,count:-1,index:null,graphic:null,record:null,defaultPopupTemplate:null,dataSourceVersion:void 0,dataSourceId:null},this.dataBuffer={count:-1,dataMapByIndex:{},dataMapByObjectId:{},pagingNum:30},this.isFirstLoad=!1,this.previousSelectedId=null},this.getCurrentData=()=>{const e=this.props.objectId,t=this.getDataFromBuffer(this.props.index,e);t?this.onDataChanged(this.dataSource,t):e?this.getCurrentDataByObjectId(e):this.getCurrentDataByIndex()},this.getCurrentDataByObjectId=e=>{let t=null;this.queryGraphicByObjectId(e).then(a=>{0!==a.graphics.length&&(this.addObjectIdDataToBuffer(a,this.dataSource.id),t=this.getDataFromBuffer(-1,e)),this.onDataChanged(this.dataSource,t)})},this.getCurrentDataByIndex=()=>f(this,void 0,void 0,function*(){let e=this.props.index;this.props.index===this.previousIndex?this.clearDataBuffer():this.previousIndex=this.props.index,this.countOfQueryGraphics++;const t=this.countOfQueryGraphics,a=this.props.needCountInfo?this.dataSource.queryCount({}):Promise.resolve({count:-1});yield a.then(a=>{if(t<this.countOfQueryGraphics)return;const i=a.count;this.dataBuffer.count<0&&this.setDataBufferCount(i),e<0&&(e=0),this.queryGraphicByIndex(e).then(e=>{if(t<this.countOfQueryGraphics)return;let a=null;0!==e.graphics.length&&(this.addIndexDataToBuffer(e,this.dataSource.id),a=this.getDataFromBuffer(e.index)),this.onDataChanged(this.dataSource,a),this.isFirstLoad=!1})})}),this.onDataSourceStatusChanged=(e,t)=>{this.props.active&&this.props.onDataSourceStatusChanged(e,t)},this.getWherePhraseForField=(e,t)=>{var a;let s="";const o=(this.dataSource.getFetchedSchema().fields||{})[t].esriType;if("esriFieldTypeDate"===o){const o=i.dataSourceUtils.createSQLClause(t,i.ClauseOperator.DateOperatorIsBefore,[{value:e.attributes[t],label:""}]),r=(null===(a=i.dataSourceUtils.createSQLExpression(i.ClauseLogic.Or,[o],this.dataSource))||void 0===a?void 0:a.sql)||"";s=r.slice(r.indexOf("timestamp"))}else s="esriFieldTypeString"===o?`'${e.attributes[t]}'`:`${e.attributes[t]}`;return s},this.serializeDSQueryCondition=()=>{var e,t,a,i;const s=this.getQueryParamsFromDataSource(),o=(null==s?void 0:s.where)||"",r=null==s?void 0:s.geometry;return`${o}_${(null===(e=null==r?void 0:r.xmax)||void 0===e?void 0:e.toString())||""}_${(null===(t=null==r?void 0:r.xmin)||void 0===t?void 0:t.toString())||""}_${(null===(a=null==r?void 0:r.ymax)||void 0===a?void 0:a.toString())||""}_${(null===(i=null==r?void 0:r.ymin)||void 0===i?void 0:i.toString())||""}`},this.onDataSourceCreated=e=>{this.initDataLoader(),this.dataSource=e,this.previousIndex=this.props.index,this.isFirstLoad=!0,this.setState({dataSourceId:this.dataSource.id})},this.onCreateDataSourceFailed=e=>{this.onDataSourceStatusChanged(i.DataSourceStatus.CreateError)},this.onDataSourceInfoChange=e=>{var t;if(!e)return;const a=e.status;if(a===i.DataSourceStatus.NotReady&&(this.clearDataBuffer(),this.onDataSourceStatusChanged(i.DataSourceStatus.NotReady,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel())),this.setState({dataSourceStatus:a,dataSourceWidgetQueries:e.widgetQueries,dataSourceQueriesWhere:this.serializeDSQueryCondition(),dataSourceVersion:e.version,dataSourceSourceVersion:e.sourceVersion}),this.dataSource&&this.dataSource.isDataView&&this.dataSource.dataViewId===i.CONSTANTS.SELECTION_DATA_VIEW_ID){const e=this.dataSource.getMainDataSource(),t=null==e?void 0:e.getSelectedRecordIds();this.clearDataBuffer(),t&&t[0]&&this.props.onSelectedRecordIdChanged(this.props.dsConfigId,0)}else{const t=e.selectedIds&&e.selectedIds[0];t?this.previousSelectedId!==t&&(this.previousSelectedId=t,this.props.isBaseOnObjectId?this.props.onSelectedRecordIdChanged(this.props.dsConfigId,-1,t):this.getDataIndexByObjectId(t).then(e=>{e>-1&&this.props.onSelectedRecordIdChanged(this.props.dsConfigId,e)})):this.previousSelectedId&&(this.previousSelectedId=null)}},this.state={dataSourceId:null,dataSourceStatus:i.DataSourceStatus.Loaded,dataSourceVersion:void 0,dataSourceSourceVersion:void 0,dataSourceWidgetQueries:void 0,dataSourceQueriesWhere:""},this.initDataLoader()}componentDidUpdate(e,t){this.prevProps=e;const a=this.state.dataSourceQueriesWhere!==t.dataSourceQueriesWhere,s=e.isBaseOnObjectId&&!this.props.isBaseOnObjectId,o=!e.needCountInfo&&this.props.needCountInfo,r=this.state.dataSourceSourceVersion!==t.dataSourceSourceVersion;(a||s||o||r)&&this.clearDataBuffer(),this.props.useDataSource&&this.props.active&&this.state.dataSourceId===this.props.useDataSource.dataSourceId&&this.state.dataSourceStatus!==i.DataSourceStatus.NotReady&&this.state.dataSourceStatus!==i.DataSourceStatus.Loading&&this.getCurrentData()}onDataChanged(e,t){var a,s,o,r,n,d,u,l;this.props.active&&(t?this.props.active!==this.prevProps.active?this.props.onDataChanged(this.props.dsConfigId,this.dataSource,t,this.isFirstLoad):(null===(a=this.previousData)||void 0===a?void 0:a.dataSourceId)===(null==t?void 0:t.dataSourceId)&&(null===(s=this.previousData)||void 0===s?void 0:s.id)===(null==t?void 0:t.id)&&(null===(o=this.previousData)||void 0===o?void 0:o.count)===(null==t?void 0:t.count)&&(null===(r=this.previousData)||void 0===r?void 0:r.index)===(null==t?void 0:t.index)&&(null===(n=this.previousData)||void 0===n?void 0:n.dataSourceVersion)===(null==t?void 0:t.dataSourceVersion)&&i.lodash.isDeepEqual(null===(u=null===(d=this.previousData)||void 0===d?void 0:d.graphic)||void 0===u?void 0:u.attributes,null===(l=null==t?void 0:t.graphic)||void 0===l?void 0:l.attributes)||this.props.onDataChanged(this.props.dsConfigId,this.dataSource,t,this.isFirstLoad):this.props.onDataChanged(this.props.dsConfigId,this.dataSource,t),this.previousData=t)}addObjectIdDataToBuffer(e,t){e.records.forEach((a,i)=>{const s=a.getId();this.dataBuffer.dataMapByObjectId[s]={id:s,count:-1,index:-1,graphic:e.graphics[i],defaultPopupTemplate:e.defaultPopupTemplate,record:a,dataSourceId:t,dataSourceVersion:this.state.dataSourceVersion}})}addIndexDataToBuffer(e,t){e.records.forEach((a,i)=>{const s=e.start+i;this.dataBuffer.dataMapByIndex[s]={id:a.getId(),count:this.dataBuffer.count,index:s,graphic:e.graphics[i],defaultPopupTemplate:e.defaultPopupTemplate,record:a,dataSourceId:t,dataSourceVersion:this.state.dataSourceVersion}})}setDataBufferCount(e){this.dataBuffer.count=e}getDataFromBuffer(e,t){let a=null;return t?(a=this.dataBuffer.dataMapByObjectId[t],a||(a=Object.values(this.dataBuffer.dataMapByIndex).find(e=>e.id===t))):e>=0&&(a=this.dataBuffer.dataMapByIndex[e]),a}getDataIndexByObjectId(e){return f(this,void 0,void 0,function*(){var t;let a=-1;if(Object.entries(this.dataBuffer.dataMapByIndex).some(t=>{var i;return e===(null===(i=t[1])||void 0===i?void 0:i.id)&&(a=Number(t[0]),!0)}),a<0&&this.dataSource){const i=this.dataSource.getIdField(),s=null===(t=this.getQueryParamsFromDataSource())||void 0===t?void 0:t.orderByFields;if(s&&(null==s?void 0:s.length)>0){let t=0;const o=yield this.dataSource.queryById(e);let r=" ";if(null==o?void 0:o.feature)for(let e=0;e<s.length;e++){const n=s[e],d=null==n?void 0:n.split(" "),u=d[0],l=d[1]&&0===d[1].indexOf("DESC"),c=this.getWherePhraseForField(o.feature,u),h=s[e+1]||i,p=null==h?void 0:h.split(" "),g=p[0],f=p[1]&&0===p[1].indexOf("DESC"),S=this.getWherePhraseForField(o.feature,g);if(0===e){const e=l?`${u} > ${c}`:`${u} < ${c} or ${u} is NULL`;t+=(yield this.dataSource.queryCount({where:e}).then(e=>e.count).catch(e=>-1))}let v;v=f?g===i?">=":">":g===i?"<=":"<",r+=`${u} = ${c} and `;const D=f?`${r} ${g} ${v} ${S}`:`${r} ${g} ${v} ${S} or ${g} is NULL`;if(t+=(yield this.dataSource.queryCount({where:D}).then(e=>e.count).catch(e=>-1)),g===i){a=t-1;break}}}else a=yield this.dataSource.queryCount({where:`${i}<=${e}`}).then(e=>(a=e.count-1,a))}return Promise.resolve(a)})}clearDataBuffer(){this.dataBuffer.count=-1,this.dataBuffer.dataMapByIndex={},this.dataBuffer.dataMapByObjectId={}}getLayerObject(e){const t=this.dataSource.isDataView&&this.dataSource.dataViewId===i.CONSTANTS.SELECTION_DATA_VIEW_ID?e.getMainDataSource():e;return t.layer?t.layer.load().then(()=>Promise.resolve(t.layer)):t.createJSAPILayerByDataSource().then(e=>e.load().then(()=>Promise.resolve(e)))}queryGraphicByObjectId(e){var t;return this.onDataSourceStatusChanged(i.DataSourceStatus.Loading,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel()),this.getLayerObject(this.dataSource).then(t=>this.dataSource.queryById(e).then(e=>{var a,s;e.feature.sourceLayer=t.associatedLayer||t,e.feature.layer=t.associatedLayer||t;const o=(null===(a=t.associatedLayer)||void 0===a?void 0:a.defaultPopupTemplate)||t.defaultPopupTemplate;return this.onDataSourceStatusChanged(i.DataSourceStatus.Loaded,null===(s=this.dataSource)||void 0===s?void 0:s.getLabel()),{graphics:[e.feature],records:[e],defaultPopupTemplate:(null==o?void 0:o.clone())||{content:""}}})).catch(e=>{var t;return console.warn(e),this.onDataSourceStatusChanged(i.DataSourceStatus.Loaded,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel()),{graphics:[],records:[]}})}queryGraphicByIndex(e){var t;let a,s,o=e;return this.onDataSourceStatusChanged(i.DataSourceStatus.Loading,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel()),this.getLayerObject(this.dataSource).then(e=>f(this,void 0,void 0,function*(){s=e;const t=this.dataSource&&this.dataSource.isDataView&&this.dataSource.dataViewId===i.CONSTANTS.SELECTION_DATA_VIEW_ID;if(this.isFirstLoad&&!t){const e=this.dataSource.getSelectedRecordIds()[0];void 0!==e&&(yield this.getDataIndexByObjectId(e).then(e=>{o=-1===e?0:e}))}})).then(()=>{a=Math.floor(o/this.dataBuffer.pagingNum)*this.dataBuffer.pagingNum;const e={outFields:["*"],notAddFieldsToClient:!0,returnGeometry:!0,page:Math.floor(a/this.dataBuffer.pagingNum)+1,pageSize:this.dataBuffer.pagingNum};return this.dataSource.query(e)}).then(e=>{const t=e.records;if(this.dataSource.isDataView&&this.dataSource.dataViewId===i.CONSTANTS.SELECTION_DATA_VIEW_ID&&t.length>0){const e={objectIds:t.map(e=>e.feature.attributes[s.objectIdField]),outFields:["*"],notAddFieldsToClient:!0,returnGeometry:!0};return this.dataSource.getMainDataSource().query(e)}return e}).then(e=>{var t,r;const n=e.records,d=this.getQueryParamsFromDataSource().where;s.definitionExpression=d;const u=n.map(e=>(e.feature.sourceLayer=s.associatedLayer||s,e.feature.layer=s.associatedLayer||s,e.feature)),l=(null===(t=s.associatedLayer)||void 0===t?void 0:t.defaultPopupTemplate)||s.defaultPopupTemplate;return this.onDataSourceStatusChanged(i.DataSourceStatus.Loaded,null===(r=this.dataSource)||void 0===r?void 0:r.getLabel()),{index:o,start:a,num:this.dataBuffer.pagingNum,graphics:u,records:n,defaultPopupTemplate:(null==l?void 0:l.clone())||{content:""}}}).catch(e=>{var t;return console.warn(e),this.onDataSourceStatusChanged(i.DataSourceStatus.Loaded,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel()),{graphics:[],records:[]}})}getQueryParamsFromDataSource(){var e;return null===(e=this.dataSource)||void 0===e?void 0:e.getRealQueryParams({},"query")}render(){return(0,a.jsx)(i.DataSourceComponent,{useDataSource:this.props.useDataSource,widgetId:this.props.widgetId,onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}class v extends i.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.1.0",description:"added [styleType] and [fontSizeType]",upgrader:e=>{let t=e;return t=t.set("styleType","usePopupDefined"),t.getIn(["style","fontSize","distance"])||t.getIn(["style","textColor"])?t=t.setIn(["style","fontSizeType"],"custom"):(t=t.setIn(["style","fontSizeType"],"auto"),t=t.setIn(["style","fontSize","distance"],14)),t}},{version:"1.15.0",description:"added [styleType] and [fontSizeType]",upgrader:(e,t)=>{var a,s;const o=null===(s=null===(a=(0,i.getAppStore)().getState())||void 0===a?void 0:a.appConfig)||void 0===s?void 0:s.widgets[t],r=(null==o?void 0:o.useDataSources)&&o.useDataSources[0],n=e.asMutable();if(r){const t={id:"default_data_source_config",useDataSourceId:r.dataSourceId,contentConfig:{title:e.title,fields:e.fields,media:e.media,attachments:e.attachments,lastEditInfo:e.lastEditInfo}};n.dsConfigs=[t]}else n.dsConfigs=[];return n.dsNavigator=!0,n.featureNavigator=!0,delete n.title,delete n.fields,delete n.media,delete n.attachments,delete n.lastEditInfo,(0,i.Immutable)(n)}},{version:"1.16.0",description:"set useMapWidget property to false",upgrader:(e,t)=>{let a=e;return a=a.set("useMapWidget",!1),a}}]}}const D=new v;var m=r(6821),y=r.n(m);function C(e){const t=e.dsConfigs.find(t=>t.id===e.activeDSConfigId);return(0,a.jsx)("div",{className:"data-source-selector",style:{},children:(0,a.jsxs)(o.Dropdown,{activeIcon:!0,children:[(0,a.jsx)(o.DropdownButton,{type:"tertiary",size:"sm",style:{},title:null==t?void 0:t.label,children:null==t?void 0:t.label}),(0,a.jsx)(o.DropdownMenu,{offsetOptions:4,children:e.dsConfigs.map((t,i)=>(0,a.jsxs)(o.DropdownItem,{active:e.activeDSConfigId===t.id,onClick:()=>{e.onCurrentDSChange(t.id)},children:[" ",t.label," "]},i))})]})})}const I=(0,i.Immutable)([i.AllDataSourceTypes.FeatureLayer,i.AllDataSourceTypes.SceneLayer,i.AllDataSourceTypes.BuildingComponentSubLayer,i.AllDataSourceTypes.OrientedImageryLayer,i.AllDataSourceTypes.ImageryLayer,i.AllDataSourceTypes.SubtypeSublayer]);(0,i.Immutable)([i.JSAPILayerTypes.FeatureLayer,i.JSAPILayerTypes.SceneLayer,i.JSAPILayerTypes.BuildingComponentSublayer,i.JSAPILayerTypes.OrientedImageryLayer,i.JSAPILayerTypes.ImageryLayer,i.JSAPILayerTypes.SubtypeSublayer]),(0,i.Immutable)([i.AllDataSourceTypes.FeatureLayer,i.AllDataSourceTypes.SceneLayer,i.AllDataSourceTypes.WebMap,i.AllDataSourceTypes.WebScene,i.AllDataSourceTypes.MapService,i.AllDataSourceTypes.FeatureService,i.AllDataSourceTypes.SceneService,i.AllDataSourceTypes.GroupLayer,i.AllDataSourceTypes.BuildingComponentSubLayer,i.AllDataSourceTypes.BuildingGroupSubLayer,i.AllDataSourceTypes.BuildingSceneLayer,i.AllDataSourceTypes.OrientedImageryLayer,i.AllDataSourceTypes.ImageryLayer,i.AllDataSourceTypes.SubtypeGroupLayer,i.AllDataSourceTypes.SubtypeSublayer]),(0,i.Immutable)([i.AllDataSourceTypes.WebMap,i.AllDataSourceTypes.WebScene,i.AllDataSourceTypes.MapService,i.AllDataSourceTypes.FeatureService,i.AllDataSourceTypes.SceneService,i.AllDataSourceTypes.GroupLayer,i.AllDataSourceTypes.BuildingGroupSubLayer,i.AllDataSourceTypes.BuildingSceneLayer,i.AllDataSourceTypes.SubtypeGroupLayer]);function w(e){var t,a;return I.includes(null==e?void 0:e.type)&&!(null===(t=null==e?void 0:e.dataSourceJson)||void 0===t?void 0:t.isHidden)&&(null===(a=null==e?void 0:e.getSchema())||void 0===a?void 0:a.fields)}function b(e){var t,a;return(0,i.Immutable)({dataSourceId:e.id,mainDataSourceId:null===(t=e.getMainDataSource())||void 0===t?void 0:t.id,dataViewId:e.dataViewId,rootDataSourceId:null===(a=e.getRootDataSource())||void 0===a?void 0:a.id})}function x(e,t){const a=i.DataSourceManager.getInstance().getDataSource(e);return{id:(0,i.uuidv1)(),label:t||(null==a?void 0:a.getLabel())||e,useDataSourceId:e,contentConfig:{title:!0,fields:!0,media:!0,attachments:!0,lastEditInfo:!0}}}var M=r(4583),L=r.n(M),V=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const j=e=>{const t=window.SVG,{className:s}=e,o=V(e,["className"]),r=(0,i.classNames)("jimu-icon jimu-icon-component",s);return t?(0,a.jsx)(t,Object.assign({className:r,src:L()},o)):(0,a.jsx)("svg",Object.assign({className:r},o))};var T=function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function n(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,n)}d((i=i.apply(e,t||[])).next())})};class B extends i.React.PureComponent{constructor(e){super(e),this.featureInfoConRef=i.React.createRef(),this.getDSConfigs=()=>{let e;if(this.props.config.useMapWidget){const e=[],t=[],a=s.MapViewManager.getInstance().getJimuMapViewById(this.state.jimuMapViewId);return this.dsConfigsOfMapView.forEach(i=>{const s=null==a?void 0:a.getJimuLayerViewByDataSourceId(i.useDataSourceId);!s&&t.push(i),(null==s?void 0:s.isLayerVisible())&&e.push(i)}),e.concat(t)}return e=this.props.config.dsConfigs||(0,i.Immutable)([]),e.map(e=>{if(null===e.label||void 0===e.label){const t=i.DataSourceManager.getInstance().getDataSource(e.useDataSourceId);return e.set("label",(null==t?void 0:t.getLabel())||"")}return e})},this.getDSConfigById=e=>{const t=this.getDSConfigs();return t?t.find(t=>t.id===e):null},this.getCurrentDSConfig=()=>this.getDSConfigById(this.state.currentDSConfigId),this.getDefaultDSConfig=()=>this.getDSConfigs()[0],this.isValidData=e=>{var t;if(this.props.config.useMapWidget)return(null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t.length)>0;return(this.props.useDataSources||(0,i.Immutable)([])).some(t=>t.dataSourceId===e)},this.loadUseDataSourceById=e=>{const t=s.MapViewManager.getInstance().getJimuMapViewById(this.state.jimuMapViewId),a=null==t?void 0:t.getJimuLayerViewByDataSourceId(e);null==a||a.createLayerDataSource().then(e=>{const t=b(e);this.useDataSourcesOfMapView.push(t),this.setState({useDataSourceChangedFlag:(0,i.uuidv1)()})})},this.getUseDataSourceById=e=>{if(this.props.config.useMapWidget)return this.useDataSourcesOfMapView.find(t=>t.dataSourceId===e);return(this.props.useDataSources||(0,i.Immutable)([])).find(t=>t.dataSourceId===e)},this.clearSelection=()=>{var e;((null===(e=this.dataSource)||void 0===e?void 0:e.getSelectedRecordIds())||[]).length>0&&(this.dataSource.selectRecordsByIds([]),i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(this.props.id,[],[this.dataSource.id])))},this.onPreGraphicBtnClick=()=>{let e=this.state.currentDataIndex;e>0&&(this.setState({currentDataIndex:--e}),this.lockSelection=!1)},this.onNextGraphicBtnClick=()=>{let e=this.state.currentDataIndex;(!this.props.config.showCount||e<this.currentData.count-1)&&(this.setState({currentDataIndex:++e}),this.lockSelection=!1)},this.onClearSelectionBtnClick=()=>{this.clearSelection()},this.onSelectedRecordIdChanged=(e,t,a)=>{this.setState({currentDSConfigId:e,currentDataIndex:t,currentDataObjectId:a})},this.onUnselectedRecordIdChanged=e=>{var t;(null===(t=this.dataSource)||void 0===t?void 0:t.id)===e&&i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(this.props.id,[],[e]))},this.onDataSourceStatusChanged=(e,t)=>{this.setState({loadDataStatus:e,dataSourceLabel:t})},this.onDataChanged=(e,t,a,i)=>{e===this.state.currentDSConfigId&&(this.dataSource=t,this.previousData=this.currentData,this.currentData=a,this.setState({currentDataId:this.currentData?this.currentData.id:null,currentDataIndex:this.currentData?this.currentData.index:0,currentDataSourceVersion:this.currentData?this.currentData.dataSourceVersion:null}),this.lockSelection||(this.selectGraphic(),this.lockSelection=!0))},this.onCurrentFeatureClick=()=>{this.selectGraphic()},this.onCurrentDSChange=e=>{this.setState({currentDSConfigId:e,currentDataIndex:0})},this.onResize=({width:e,height:t})=>{let a=80;a=e<350?e/3:e/2,a=10*Math.floor(a/10),this.setState({widthOfDSSelector:Math.floor(a)})},this.onJimuLayerViewCreate=(e,t)=>T(this,void 0,void 0,function*(){var a,i;if(t.find(t=>e.id===t.id)||!e.isLayerVisible())return;const s=yield e.createLayerDataSource();if(!w(s))return;const o=b(s);this.useDataSourcesOfMapView.push(o),this.dsConfigsOfMapView.push(x(e.layerDataSourceId,null===(a=e.layer)||void 0===a?void 0:a.title)),this.setState({jimuLayerViewChangedFlag:e.id,currentDSConfigId:null===(i=this.getDefaultDSConfig())||void 0===i?void 0:i.id})}),this.onJimuLayerViewRemove=e=>{var t;this.dsConfigsOfMapView.some((t,a)=>t.useDataSourceId===e.layerDataSourceId&&(this.dsConfigsOfMapView.splice(a,1),!0)),this.useDataSourcesOfMapView.some((t,a)=>t.dataSourceId===e.layerDataSourceId&&(this.useDataSourcesOfMapView.splice(a,1),!0));const a=null===(t=this.getDefaultDSConfig())||void 0===t?void 0:t.id;a||(this.currentData=null,this.dataSource=null),this.setState({jimuLayerViewChangedFlag:(0,i.uuidv1)(),currentDSConfigId:a})},this.onJimuLayerViewVisibilityChange=e=>{var t;e.forEach(e=>T(this,void 0,void 0,function*(){var t,a;const s=this.getDSConfigs().find(t=>t.useDataSourceId===e.layerDataSourceId);if(!e.isLayerVisible()||s)return;const o=yield e.createLayerDataSource();if(w(o)){const s=b(o);this.useDataSourcesOfMapView.push(s),this.dsConfigsOfMapView.push(x(e.layerDataSourceId,null===(t=e.layer)||void 0===t?void 0:t.title)),this.setState({jimuLayerViewChangedFlag:(0,i.uuidv1)(),currentDSConfigId:null===(a=this.getDefaultDSConfig())||void 0===a?void 0:a.id})}}));const a=null===(t=this.getDefaultDSConfig())||void 0===t?void 0:t.id;a||(this.currentData=null,this.dataSource=null),this.setState({jimuLayerViewChangedFlag:(0,i.uuidv1)(),currentDSConfigId:a})},this.addNewDataForMapView=(e,t)=>{var a;if(w(e)){const i=b(e);this.useDataSourcesOfMapView.push(i),this.dsConfigsOfMapView.push(x(e.id,t)),this.setState({jimuLayerViewChangedFlag:e.id,currentDSConfigId:null===(a=this.getDefaultDSConfig())||void 0===a?void 0:a.id})}},this.onJimuMapViewLoaded=e=>{const t=i.DataSourceManager.getInstance().getDataSource(e.dataSourceId);t&&e.getJimuTables().forEach(a=>T(this,void 0,void 0,function*(){var i;const s=e.getDataSourceIdByAPILayer(a.table),o=yield t.createDataSourceById(s);this.addNewDataForMapView(o,null===(i=a.table)||void 0===i?void 0:i.title)}))},this.onActiveViewChange=e=>{if(this.currentData=null,this.dataSource=null,this.dsConfigsOfMapView=[],this.useDataSourcesOfMapView=[],this.onDataSourceStatusChanged(i.DataSourceStatus.Loaded),!e)return void this.setState({jimuMapViewId:null});const t=e.getAllJimuLayerViews();t.forEach(e=>T(this,void 0,void 0,function*(){var t,a;if(!e.isLayerVisible())return;const i=yield e.createLayerDataSource();if(w(i)){const s=b(i);this.useDataSourcesOfMapView.push(s),this.dsConfigsOfMapView.push(x(e.layerDataSourceId,null===(t=e.layer)||void 0===t?void 0:t.title)),this.setState({jimuLayerViewChangedFlag:e.id,currentDSConfigId:null===(a=this.getDefaultDSConfig())||void 0===a?void 0:a.id})}})),this.prevJimuMapView&&(this.jimuLayerViewCreatedListener&&this.prevJimuMapView.removeJimuLayerViewCreatedListener(this.jimuLayerViewCreatedListener),this.jimuLayerViewRemovedListener&&this.prevJimuMapView.removeJimuLayerViewRemovedListener(this.jimuLayerViewRemovedListener),this.jimuLayerViewsVisibleChangedListener&&this.prevJimuMapView.removeJimuLayerViewsVisibleChangeListener(this.jimuLayerViewsVisibleChangedListener)),this.prevJimuMapView=e,this.jimuLayerViewCreatedListener=e=>{this.onJimuLayerViewCreate(e,t)},e.addJimuLayerViewCreatedListener(this.jimuLayerViewCreatedListener),this.jimuLayerViewRemovedListener=e=>{this.onJimuLayerViewRemove(e)},e.addJimuLayerViewRemovedListener(this.jimuLayerViewRemovedListener),this.jimuLayerViewsVisibleChangedListener=e=>{this.onJimuLayerViewVisibilityChange(e)},e.addJimuLayerViewsVisibleChangeListener(this.jimuLayerViewsVisibleChangedListener),e.whenJimuMapViewLoaded().then(()=>{this.onJimuMapViewLoaded(e)}),this.setState({jimuMapViewId:e.id})},this.isDataSourceAccessible=e=>{var t;return!!this.props.config.useMapWidget||!!(null===(t=this.props.useDataSources)||void 0===t?void 0:t.find(t=>e===t.dataSourceId))},this.getPlaceholderContent=()=>(0,a.jsx)("div",{className:"widget-featureInfo",children:(0,a.jsx)(o.WidgetPlaceholder,{icon:y(),name:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:u}),widgetId:this.props.id})}),this.getLoadingContent=()=>{let e=null;return this.state.loadDataStatus===i.DataSourceStatus.Loading&&(e=(0,a.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"})),e},this.getHeaderContent=()=>{var e,t,s,r,n;let d=null;const u=this.props.intl.formatMessage({id:"featureInfoDataActionLabel",defaultMessage:h},{layer:(null===(e=this.dataSource)||void 0===e?void 0:e.getLabel())||""}),l=(void 0===this.props.enableDataAction||this.props.enableDataAction)&&this.dataSource&&this.currentData;l&&(d=(0,a.jsx)("div",{className:"data-action-dropdown-content",children:(0,a.jsx)(o.DataActionList,{widgetId:this.props.id,dataSets:[{dataSource:this.dataSource,records:(null===(t=this.currentData)||void 0===t?void 0:t.record)?[null===(s=this.currentData)||void 0===s?void 0:s.record]:[],name:u,type:"current",fields:this.dataSource.getPopupInfoFields()}],listStyle:o.DataActionListStyle.Dropdown,buttonType:"tertiary"})}));let p=null;const g=!this.props.config.showCount||(null===(r=this.currentData)||void 0===r?void 0:r.count)>1,f=this.currentData&&this.props.config.featureNavigator&&g;if(f){const e=this.props.intl.formatMessage({id:"featureNumbers",defaultMessage:c},{index:this.currentData.index+1,count:this.currentData.count});p=(0,a.jsxs)("div",{className:"nav-section d-flex justify-content-center align-items-center",children:[(0,a.jsxs)(o.Button,{className:"nav-btn",type:"tertiary",size:"sm",disabled:this.currentData.index<=0,onClick:this.onPreGraphicBtnClick,"aria-label":this.props.intl.formatMessage({id:"previous",defaultMessage:o.defaultMessages.previous}),"aria-describedby":"feature-numbers",children:[" ","<"," "]}),(0,a.jsxs)("span",{id:"feature-numbers",children:[" ",this.props.config.showCount?e:""," "]}),(0,a.jsxs)(o.Button,{className:"nav-btn",type:"tertiary",size:"sm",disabled:!!this.props.config.showCount&&this.currentData.index+1>=this.currentData.count,onClick:this.onNextGraphicBtnClick,"aria-label":this.props.intl.formatMessage({id:"next",defaultMessage:o.defaultMessages.next}),"aria-describedby":"feature-numbers",children:[" ",">"," "]})]})}let S=null;const v=this.props.config.dsNavigator&&this.getDSConfigs().length>1;if(v){const e=this.getDSConfigs().filter(e=>this.isDataSourceAccessible(e.useDataSourceId));S=(0,a.jsx)(C,{dsConfigs:e,activeDSConfigId:this.state.currentDSConfigId,onCurrentDSChange:this.onCurrentDSChange})}let D=null;const m=this.props.intl.formatMessage({id:"clearSelection",defaultMessage:"Clear selection"});if(this.props.config.clearSelection){const e=(null===(n=this.dataSource)||void 0===n?void 0:n.getSelectedRecordIds())||[];D=(0,a.jsx)("div",{className:"clear-selection d-flex justify-content-center align-items-center",children:(0,a.jsx)(o.Button,{title:m,type:"tertiary",size:"sm",icon:!0,disabled:e.length<=0,onClick:this.onClearSelectionBtnClick,"aria-label":m,children:(0,a.jsx)(j,{size:16})})})}let y=null;return(f||v||l)&&this.state.loadDataStatus!==i.DataSourceStatus.CreateError&&this.state.loadDataStatus!==i.DataSourceStatus.NotReady&&(y=(0,a.jsxs)("div",{className:"header-section",children:[p,(0,a.jsxs)("div",{className:"header-operation-section",children:[S,(0,a.jsxs)("div",{className:"header-control-section",children:[D,d]})]})]})),y},this.getDsErrorMessageContent=()=>(0,a.jsxs)("div",{className:"widget-featureInfo",children:[(0,a.jsx)(o.WidgetPlaceholder,{icon:y(),name:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:u}),widgetId:this.props.id}),(0,a.jsx)(o.Alert,{className:"warning-inaccessible",type:"warning",withIcon:!0,text:this.props.intl.formatMessage({id:"dataSourceCreateError",defaultMessage:"warning"})})]}),this.getWarningMessageContent=()=>{const e=this.props.dataSourceWidgetLabelInfos.find(e=>{var t;return e.dataSourceId===(null===(t=this.getCurrentDSConfig())||void 0===t?void 0:t.useDataSourceId)}),t=this.props.intl.formatMessage({id:"outputDataIsNotGenerated",defaultMessage:"warning"},{outputDsLabel:this.state.dataSourceLabel,sourceWidgetName:(null==e?void 0:e.label)||""});return(0,a.jsxs)("div",{className:"widget-featureInfo",children:[(0,a.jsx)(o.WidgetPlaceholder,{icon:y(),name:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:u}),widgetId:this.props.id}),(0,a.jsx)(o.Alert,{className:"warning-icon",form:"tooltip",size:"small",type:"warning",text:t})]})},this.getDefaultMessageContent=()=>{const e=new i.esri.Sanitizer;return(0,a.jsx)("div",{className:"no-data-message p-5 font-weight-bold",dangerouslySetInnerHTML:{__html:e.sanitize(this.props.config.noDataMessage)||this.props.intl.formatMessage({id:"noDataMessageDefaultText",defaultMessage:l})}})},this.getFeaturesContent=()=>{var e,t,i,s,o,r;const n=this.getCurrentDSConfig(),d=null==n?void 0:n.contentConfig,u={title:null==d?void 0:d.title,content:{fields:null===(e=null==d?void 0:d.fields)||void 0===e||e,text:null===(t=null==d?void 0:d.fields)||void 0===t||t,media:null===(i=null==d?void 0:d.media)||void 0===i||i,attachments:null===(s=null==d?void 0:d.attachments)||void 0===s||s,expression:!0},lastEditedInfo:null===(o=null==d?void 0:d.lastEditInfo)||void 0===o||o},l=((null===(r=this.dataSource)||void 0===r?void 0:r.getSelectedRecordIds())||[]).some(e=>{var t;return e===(null===(t=this.currentData)||void 0===t?void 0:t.id)}),c=l?"default":"pointer";return(0,a.jsx)("div",{style:{cursor:c},onClick:this.onCurrentFeatureClick,children:(0,a.jsx)(g,{graphic:this.currentData.graphic,defaultPopupTemplate:this.currentData.defaultPopupTemplate,visibleElements:u,dataSource:this.dataSource,timezone:this.props.timezone,useMapWidget:this.props.config.useMapWidget})})},this.getFeatureInfoContent=()=>{let e;return this.state.loadDataStatus===i.DataSourceStatus.CreateError?e=this.getDsErrorMessageContent():this.state.loadDataStatus===i.DataSourceStatus.NotReady?e=this.getWarningMessageContent():this.currentData&&this.dataSource?e=this.getFeaturesContent():this.state.loadDataStatus===i.DataSourceStatus.Loaded&&(e=this.getDefaultMessageContent()),e},this.getDataSourceContent=()=>{var e,t;let i=null,o=null;return i=this.getDSConfigs().map((e,t)=>{const i=this.getUseDataSourceById(null==e?void 0:e.useDataSourceId),s=!this.props.config.featureNavigator;return(0,a.jsx)(S,{active:this.state.currentDSConfigId===e.id,useDataSource:i,dsConfigId:e.id,widgetId:this.props.id,index:this.state.currentDataIndex,objectId:s?this.state.currentDataObjectId:null,limitGraphics:this.props.config.limitGraphics,maxGraphics:this.props.config.maxGraphics,onSelectedRecordIdChanged:this.onSelectedRecordIdChanged,onUnselectedRecordIdChanged:this.onUnselectedRecordIdChanged,onDataSourceStatusChanged:this.onDataSourceStatusChanged,needCountInfo:this.props.config.showCount,isBaseOnObjectId:s,onDataChanged:this.onDataChanged},t)}),o=(0,a.jsxs)("div",{style:{position:"absolute",display:"block"},children:[i,this.props.config.useMapWidget&&(null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0])&&(0,a.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.onActiveViewChange})]}),o},this.previousData=null,this.currentData=null,this.lockSelection=!0,this.dsConfigsOfMapView=[],this.useDataSourcesOfMapView=[],this.jimuLayerViewCreatedListener=null,this.jimuLayerViewRemovedListener=null,this.jimuLayerViewsVisibleChangedListener=null,this.prevJimuMapView=null;const t=this.props.config;this.state={currentDataId:null,currentDataIndex:0,currentDataObjectId:"",currentDataSourceVersion:null,loadDataStatus:i.DataSourceStatus.Loaded,dataSourceWidgetId:null,dataSourceLabel:"",currentDSConfigId:t.dsConfigs&&t.dsConfigs[0]&&t.dsConfigs[0].id,widthOfDSSelector:80,jimuMapViewId:null,jimuLayerViewChangedFlag:"",useDataSourceChangedFlag:""}}componentDidUpdate(e){var t,a,i,s,o,r;if((null===(a=null===(t=this.props)||void 0===t?void 0:t.stateProps)||void 0===a?void 0:a.currentDSConfigId)&&(null===(i=null==e?void 0:e.stateProps)||void 0===i?void 0:i.currentDSConfigId)!==this.props.stateProps.currentDSConfigId)return void this.onCurrentDSChange(null===(o=null===(s=this.props)||void 0===s?void 0:s.stateProps)||void 0===o?void 0:o.currentDSConfigId);const n=this.getCurrentDSConfig(),d=this.getDefaultDSConfig();if(!this.isValidData(null===(r=n||d)||void 0===r?void 0:r.useDataSourceId))return this.dsConfigsOfMapView=[],this.useDataSourcesOfMapView=[],this.setState({currentDSConfigId:"",currentDataId:null,currentDataIndex:0}),void(this.currentData=null);n||this.setState({currentDSConfigId:null==d?void 0:d.id})}selectGraphic(){var e;const t=null===(e=this.currentData)||void 0===e?void 0:e.record;if(t&&this.dataSource){i.MessageManager.getInstance().publishMessage(new i.DataRecordsSelectionChangeMessage(this.props.id,[t],[this.dataSource.id]));const e=this.dataSource.getSelectedRecordIds(),a=t.getId();e.includes(a)||this.dataSource.queryById(a).then(e=>{this.dataSource.selectRecordsByIds([a],[e])})}}getStyleConfig(){const e=this.props.config;return e.style?e.style:{textColor:"",fontSizeType:t.auto,fontSize:null,backgroundColor:""}}render(){var e,t,s;let o=null;this.isValidData(null===(e=this.getCurrentDSConfig())||void 0===e?void 0:e.useDataSourceId)?o=(0,a.jsxs)("div",{className:"widget-featureInfo",ref:this.featureInfoConRef,children:[this.getLoadingContent(),this.getHeaderContent(),this.getFeatureInfoContent(),this.getDataSourceContent()]}):(o=this.getPlaceholderContent(),this.currentData=null);const r=this.props.config.dsNavigator&&this.getDSConfigs().length>1;return(0,a.jsx)("div",{css:d(this.props.theme,this.props.config.styleType,this.getStyleConfig(),null===(s=null===(t=(0,i.getAppStore)().getState())||void 0===t?void 0:t.appContext)||void 0===s?void 0:s.isRTL,this.props.autoWidth,r),className:"jimu-widget",children:o})}}B.getFullConfig=a=>(0,i.Immutable)({useMapWidget:!0,limitGraphics:!1,maxGraphics:0,noDataMessage:"",styleType:e.usePopupDefined,style:{textColor:"",fontSizeType:t.auto,fontSize:{distance:14,unit:o.DistanceUnits.PIXEL},backgroundColor:""},dsNavigator:!0,featureNavigator:!0,showCount:!0,clearSelection:!0,dsConfigs:[],dsConfigsOfMapWidget:[]}).merge(a),B.versionManager=D,B.mapExtraStateProps=(e,t)=>{var a,s;const o=(t.useDataSources||[]).map(t=>{var a,s;const o=i.appConfigUtils.getWidgetIdByOutputDataSource(t);return{dataSourceId:t.dataSourceId,label:null===(s=null===(a=e.appConfig)||void 0===a?void 0:a.widgets[o])||void 0===s?void 0:s.label}});return{dataSourceWidgetLabelInfos:o,timezone:null===(s=null===(a=e.appConfig)||void 0===a?void 0:a.attributes)||void 0===s?void 0:s.timezone}};const O=B;function A(e){r.p=e}})(),n})())}}});