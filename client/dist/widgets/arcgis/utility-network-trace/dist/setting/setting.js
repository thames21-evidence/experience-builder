System.register(["jimu-core/emotion","jimu-core","jimu-for-builder","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/basic/color-picker","jimu-theme"],function(e,t){var s={},a={},i={},l={},r={},n={},o={},c={};return{setters:[function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.JimuMapViewStatus=e.JimuMapViewStatus,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.defaultMessages=e.defaultMessages,a.getAppStore=e.getAppStore,a.polished=e.polished},function(e){i.BaseWidgetSetting=e.BaseWidgetSetting},function(e){l.Alert=e.Alert,l.Checkbox=e.Checkbox,l.Label=e.Label,l.NumericInput=e.NumericInput,l.Option=e.Option,l.Radio=e.Radio,l.Select=e.Select,l.Switch=e.Switch,l.Tooltip=e.Tooltip,l.defaultMessages=e.defaultMessages},function(e){r.MapWidgetSelector=e.MapWidgetSelector,r.MultipleJimuMapConfig=e.MultipleJimuMapConfig,r.SettingRow=e.SettingRow,r.SettingSection=e.SettingSection},function(e){n.MapViewManager=e.MapViewManager,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.ThemeColorPicker=e.ThemeColorPicker},function(e){c.colorUtils=e.colorUtils,c.getAppThemeVariables=e.getAppThemeVariables,c.getTheme2=e.getTheme2}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=c},4108:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=l},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},54337:e=>{"use strict";e.exports=o},62686:e=>{"use strict";e.exports=n},67386:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=a},79298:e=>{"use strict";e.exports=r}},t={};function u(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,u),i.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var s in t)u.o(t,s)&&!u.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var h={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(h),u.d(h,{__set_webpack_public_path__:()=>T,default:()=>C});var e=u(67386),t=u(79244),s=u(4108),a=u(14321),i=u(79298);const l={selectMapWidgetHint:"The Map widget must have maps that contain a utility network (version 5 or later) and shared trace configurations (ArcGIS Enterprise 10.9 or later)",dataConfigLabel:"Trace Results",mapSettingsHintMsg:"Customize the trace result options for each map",resultAreaLabel:"Result area",resultAreaTooltip:"Generate a result area polygon with an information popup around the trace result elements.",createResultAreaLabel:"Create result area",colorLabel:"Color",showWhenTraceCompleteLabel:"Show when trace completes",shapeLabel:"Shape",convexHullLabel:"Convex Hull",convexHullTooltip:"The smallest convex polygon enclosing all input features. If a distance is defined, it will be applied as a buffer to the convex hull.",bufferLabel:"Buffer",bufferTooltip:"Polygon generated from an offset at each feature's vertices. The distance value will be used to buffer the features.",distanceLabel:"Distance",meters:"Meters",feet:"Feet",kilometers:"Kilometers",miles:"Miles",mAreaUnit:"m",ftAreaUnit:"ft",kiAreaUnit:"ki",miAreaUnit:"mi",warningMsgToSelectMap:"A Map widget must be selected to configure this widget.",warningNoMap:"This Map widget does not have any maps.",warningNoTraces:"This map cannot be used with this widget. A utility network or trace configurations are missing.",traceId:"Trace Id",traceName:"Trace name",traceDescription:"Trace description",startingPoints:"Starting points",barriers:"Barriers",username:"User",version:"Version",traceDate:"Date",elementCount:"Count of features",functionResult:"Trace functions",areaStatistic:"Area statistic"};var r=u(62686);function n(e){return t.css`
    .layer-item-panel {
      .setting-header {
        padding: ${t.polished.rem(10)} ${t.polished.rem(16)} ${t.polished.rem(0)}
          ${t.polished.rem(16)};
      }
      .setting-title {
        font-size: ${t.polished.rem(16)};
        .layer-item-label {
          color: ${e.sys.color.surface.paperHint};
        }
      }
      .setting-container {
        height: calc(100% - ${t.polished.rem(50)});
        overflow: auto;

        .title-desc {
          color: ${e.sys.color.action.inputField.placeholder};
        }
      }
    }
  `}var o=u(45508),c=u.n(o),p=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const d=s=>{const a=window.SVG,{className:i}=s,l=p(s,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:r,src:c()},l)):(0,e.jsx)("svg",Object.assign({className:r},l))},g={traceResultAreaSettings:{enableResultArea:!1,resultAreaProperties:{type:"convexhull",distance:10,unit:"",areaUnit:"",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1}}},m=[{value:"meters"},{value:"feet"},{value:"kilometers"},{value:"miles"}],f=[{value:"traceId",label:l.traceId},{value:"traceName",label:l.traceName},{value:"traceDescription",label:l.traceDescription},{value:"startingPoints",label:l.startingPoints},{value:"barriers",label:l.barriers},{value:"version",label:l.version},{value:"username",label:l.username},{value:"date",label:l.traceDate},{value:"elementCount",label:l.elementCount},{value:"functionResult",label:l.functionResult},{value:"areaStatistic",label:l.areaStatistic}];var v,S=u(54337),b=u(1888),x=function(e,t,s,a){return new(s||(s=Promise))(function(i,l){function r(e){try{o(a.next(e))}catch(e){l(e)}}function n(e){try{o(a.throw(e))}catch(e){l(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,n)}o((a=a.apply(e,t||[])).next())})};!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(v||(v={}));const w=e=>{switch(e){case"feet":return v.Feet;case"miles":return v.Miles;case"kilometers":return v.Kilometers;case"meters":return v.Meters;default:return 1e3}},y=()=>{const e=(0,t.getAppStore)().getState().portalSelf;return"english"===(null==e?void 0:e.units)?"feet":"meters"},M=e=>x(void 0,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const s=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==s?void 0:s.isDataSourceSet())&&!s.areChildDataSourcesCreated()?s.childDataSourcesReady().then(()=>s).catch(e=>s):Promise.resolve(s)});var A=function(e,t,s,a){return new(s||(s=Promise))(function(i,l){function r(e){try{o(a.next(e))}catch(e){l(e)}}function n(e){try{o(a.throw(e))}catch(e){l(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,n)}o((a=a.apply(e,t||[])).next())})};class I extends t.React.PureComponent{constructor(e){super(e),this.nls=e=>{const s=Object.assign({},l,a.defaultMessages,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.state.apiLoaded||this.loadAPIModule()},this.loadAPIModule=()=>A(this,void 0,void 0,function*(){if(this.state.apiLoaded)return Promise.resolve();yield(0,r.loadArcGISJSAPIModules)(["esri/Color"]).then(e=>{[this.EsriColor]=e,this.setState({apiLoaded:!0})})}),this.onEnableResultAreaChange=e=>{this.setState({enableResultArea:e.target.checked},()=>{this.props.onResultAreaSettingsUpdated("enableResultArea",this.state.enableResultArea)})},this.updateResultAreaProperty=()=>{const e=new this.EsriColor(b.colorUtils.getThemeColorVariableValue(this.state.resultAreaColor,(0,b.getAppThemeVariables)()));e.a=.5;const t={type:this.state.resultAreaShapeType,distance:this.state.shapeDistanceInput,unit:this.state.shapeUnit,areaUnit:"square-"+this.state.shapeUnit,color:{color:e.toRgba(),haloOpacity:g.traceResultAreaSettings.resultAreaProperties.color.haloOpacity,hex:b.colorUtils.getThemeColorVariableValue(this.state.resultAreaColor,(0,b.getAppThemeVariables)())},show:this.state.showWhenTraceComplete};this.props.onResultAreaSettingsUpdated("resultAreaProperties",t)},this.onResultAreaColorChange=e=>{this.setState({resultAreaColor:e},()=>{this.updateResultAreaProperty()})},this.onShowWhenTraceCompleteSwitchChange=e=>{this.setState({showWhenTraceComplete:e.target.checked},()=>{this.updateResultAreaProperty()})},this.handleShapeChange=e=>{this.setState({resultAreaShapeType:e},()=>{this.updateResultAreaProperty()})},this.onShapeDistanceChange=e=>{this.setState({shapeDistanceInput:e})},this.onShapeDistanceAcceptValue=e=>{this.setState({shapeDistanceInput:null!=e?e:10},()=>{this.updateResultAreaProperty()})},this.onShapeUnitsChange=e=>{const t=((e,t)=>{const s=w(t);return e>s?s:e})(this.state.shapeDistanceInput,e.target.value);this.setState({shapeUnit:e.target.value,shapeDistanceInput:t},()=>{this.updateResultAreaProperty()})},this.state={apiLoaded:!1,enableResultArea:this.props.config.enableResultArea,resultAreaColor:this.props.config.resultAreaProperties.color.hex?this.props.config.resultAreaProperties.color.hex:"#ffa500",showWhenTraceComplete:this.props.config.resultAreaProperties.show,resultAreaShapeType:this.props.config.resultAreaProperties.type,shapeUnit:this.props.config.resultAreaProperties.unit?this.props.config.resultAreaProperties.unit:y(),shapeDistanceInput:this.props.config.resultAreaProperties.distance}}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:"5px"},css:(this.props.theme,t.css`
    .cursor-pointer {
      cursor: pointer;
    }

    .shapeTypeWidth {
      width: calc(100% - 16px);
    }
  `),children:(0,e.jsxs)(i.SettingSection,{children:[(0,e.jsxs)(i.SettingRow,{children:[(0,e.jsx)(a.Label,{"aria-label":this.nls("resultAreaLabel"),title:this.nls("resultAreaLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"w-100 text-truncate flex-grow-1 title2 hint-paper",children:this.nls("resultAreaLabel")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("resultAreaTooltip"),title:this.nls("resultAreaTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(d,{})})})]}),(0,e.jsx)(i.SettingRow,{tag:"label",label:this.nls("createResultAreaLabel"),children:(0,e.jsx)(a.Switch,{role:"switch","aria-label":this.nls("createResultAreaLabel"),title:this.nls("createResultAreaLabel"),checked:this.state.enableResultArea,onChange:this.onEnableResultAreaChange})}),this.state.enableResultArea&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(i.SettingRow,{label:this.nls("colorLabel"),children:(0,e.jsx)(S.ThemeColorPicker,{"aria-label":this.nls("colorLabel"),specificTheme:(0,b.getTheme2)(),value:this.state.resultAreaColor?this.state.resultAreaColor:"#ffa500",onChange:e=>{this.onResultAreaColorChange(e)}})}),(0,e.jsx)(i.SettingRow,{children:(0,e.jsxs)(a.Label,{check:!0,centric:!0,style:{cursor:"pointer"},children:[(0,e.jsx)(a.Checkbox,{role:"checkbox","aria-label":this.nls("showWhenTraceCompleteLabel"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showWhenTraceComplete,onChange:this.onShowWhenTraceCompleteSwitchChange.bind(this)}),this.nls("showWhenTraceCompleteLabel")]})}),(0,e.jsx)(i.SettingRow,{flow:"wrap",children:(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("shapeLabel"),title:this.nls("shapeLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 text-default",children:this.nls("shapeLabel")})})}),(0,e.jsxs)(i.SettingRow,{className:"mt-2",flow:"wrap",children:[(0,e.jsxs)(a.Label,{className:"m-0 shapeTypeWidth",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("convexHullLabel"),className:"cursor-pointer",value:this.nls("convexHullLabel"),onChange:()=>{this.handleShapeChange("convexhull")},checked:"convexhull"===this.props.config.resultAreaProperties.type}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{"convexhull"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("convexhull")},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||"convexhull"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("convexhull")},children:this.nls("convexHullLabel")})]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("convexHullTooltip"),title:this.nls("convexHullTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(d,{})})})]}),(0,e.jsxs)(i.SettingRow,{className:"mt-2",flow:"wrap",children:[(0,e.jsxs)(a.Label,{className:"m-0 shapeTypeWidth",centric:!0,children:[(0,e.jsx)(a.Radio,{role:"radio","aria-label":this.nls("bufferLabel"),className:"cursor-pointer",value:this.nls("bufferLabel"),onChange:()=>{this.handleShapeChange("buffer")},checked:"buffer"===this.props.config.resultAreaProperties.type}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{"buffer"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("buffer")},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||"buffer"!==this.props.config.resultAreaProperties.type&&this.handleShapeChange("buffer")},children:this.nls("bufferLabel")})]}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("bufferTooltip"),title:this.nls("bufferTooltip"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"title3 text-default d-inline",children:(0,e.jsx)(d,{})})})]}),(0,e.jsx)(i.SettingRow,{flow:"wrap",children:(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("distanceLabel"),title:this.nls("distanceLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 text-default",children:this.nls("distanceLabel")})})}),(0,e.jsx)("div",{className:"pt-1",children:(0,e.jsxs)(i.SettingRow,{children:[(0,e.jsx)(a.NumericInput,{style:{width:103},"aria-label":this.state.shapeDistanceInput+"",title:this.state.shapeDistanceInput+"",size:"sm",defaultValue:this.state.shapeDistanceInput,min:0,max:w(this.state.shapeUnit),value:this.state.shapeDistanceInput,showHandlers:!1,onChange:this.onShapeDistanceChange,onAcceptValue:this.onShapeDistanceAcceptValue}),(0,e.jsx)(a.Select,{"aria-label":this.state.shapeUnit.toString(),style:{width:129},className:"pl-2",size:"sm",name:"shapeUnits",value:this.state.shapeUnit.toString(),onChange:this.onShapeUnitsChange,children:m.map((t,s)=>(0,e.jsx)(a.Option,{role:"option","aria-label":t.value,value:t.value,children:this.nls(t.value)},s))})]})})]})]})})}}var j=function(e,t,s,a){return new(s||(s=Promise))(function(i,l){function r(e){try{o(a.next(e))}catch(e){l(e)}}function n(e){try{o(a.throw(e))}catch(e){l(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,n)}o((a=a.apply(e,t||[])).next())})};class C extends s.BaseWidgetSetting{constructor(e){var s;super(e),this.dsRef=t.React.createRef(),this.mvManager=r.MapViewManager.getInstance(),this.dataSourceOptions=[],this._mapLoadedTimer=null,this.nls=e=>{const s=Object.assign({},l,a.defaultMessages,t.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.resetConfig=e=>{const s=this.props.config.set("configInfo",{}),a={id:this.props.id,useMapWidgetIds:(null==e?void 0:e.length)>0?e:null,config:s};a.useDataSources=(0,t.Immutable)([]),this.props.onSettingChange(a,[])},this.componentDidUpdate=e=>{if(e.label!==this.props.label){const e=[this.getInitOutDataSource()];setTimeout(()=>{this.props.onSettingChange({id:this.props.id},e)},100)}},this.onMapWidgetSelected=e=>j(this,void 0,void 0,function*(){let t;(null==e?void 0:e.length)>0?(t=!1,yield this.getAvailableDataSources(e)):(this.resetConfig(e),t=!0),this.updateConfigForMapWidget(t)}),this.getInitSchema=(e="",s)=>{const a={},i=[];return i.push({alias:"OBJECTID",type:t.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"}),f.forEach(e=>{var a,l,r,n;const o=(null===(n=null===(r=null===(l=null===(a=null==s?void 0:s.configInfo)||void 0===a?void 0:a[this.state.activeDataSource])||void 0===l?void 0:l.traceResultAreaSettings)||void 0===r?void 0:r.resultAreaProperties)||void 0===n?void 0:n.areaUnit)||"square-feet";"areaStatistic"===e.value?"square-miles"===o?i.push({alias:this.nls(e.value)+"("+this.nls("unitsLabelSquareMiles")+")",type:t.JimuFieldType.Number,jimuName:e.value,name:e.value}):"square-meters"===o?i.push({alias:this.nls(e.value)+"("+this.nls("unitsLabelSquareMeters")+")",type:t.JimuFieldType.Number,jimuName:e.value,name:e.value}):"square-feet"===o?i.push({alias:this.nls(e.value)+"("+this.nls("unitsLabelSquareFeet")+")",type:t.JimuFieldType.Number,jimuName:e.value,name:e.value}):"square-kilometers"===o&&i.push({alias:this.nls(e.value)+"("+this.nls("unitsLabelSquareKilometers")+")",type:t.JimuFieldType.Number,jimuName:e.value,name:e.value}):"version"===e.value||"elementCount"===e.value?i.push({alias:this.nls(e.value),type:t.JimuFieldType.Number,jimuName:e.value,name:e.value}):i.push({alias:this.nls(e.value),type:t.JimuFieldType.String,jimuName:e.value,name:e.value})}),null==i||i.forEach((e,t)=>{a[null==e?void 0:e.jimuName]=e,0===t&&(a.OBJECTID=e)}),{label:e,idField:"OBJECTID",fields:a}},this.getInitOutDataSource=e=>{const s=Object.assign({},a.defaultMessages),i=this.props.intl.formatMessage({id:"outputStatistics",defaultMessage:s.outputStatistics},{name:this.props.label+" "+this.nls("resultAreaLabel")}),l=`${this.props.widgetId}-output`;const r=this.getInitSchema(i,e||this.props.config);return{id:l,type:t.DataSourceTypes.FeatureLayer,label:i,geometryType:"esriGeometryPolygon",originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:r}},this.updateConfigForMapWidget=e=>{this.setState({isNoMapSelected:e})},this.getAvailableDataSources=e=>j(this,void 0,void 0,function*(){const s=this.mvManager.getJimuMapViewGroup(e);this.dataSourceOptions=[];let a=this.props.config?this.props.config:this.props.config.set("configInfo",{});const i=[this.getInitOutDataSource()];if(s&&s.jimuMapViews){this._mapLoadedTimer&&clearTimeout(this._mapLoadedTimer);for(const l in s.jimuMapViews){const n=s.jimuMapViews[l];if(n.dataSourceId)if(n.status===t.JimuMapViewStatus.Loaded){(n.isActive||void 0===n.isActive)&&this.setState({activeDataSource:n.dataSourceId});const s=r.MapViewManager.getInstance().getJimuMapViewById(n.id);yield M(s).finally(()=>j(this,void 0,void 0,function*(){const s=yield this.checkIfMapViewHasTraces(n);this.dataSourceOptions.push({label:this.getDataSourceLabel(n.dataSourceId),value:n.dataSourceId,isValid:s,dataSource:n});const l=[];if(s){const e=t.DataSourceManager.getInstance(),s=null==e?void 0:e.getDataSource(n.dataSourceId),i=(null==s?void 0:s.isDataSourceSet())&&(null==s?void 0:s.getChildDataSources());null==i||i.forEach(e=>{var t;let s;if("GROUP_LAYER"===e.type){const t=e.getChildDataSources();t&&t.forEach(e=>{var t;"Table"!==(null===(t=e.layerDefinition)||void 0===t?void 0:t.type)&&(s={dataSourceId:null==e?void 0:e.id,mainDataSourceId:null==e?void 0:e.id,rootDataSourceId:n.dataSourceId},l.push(s))})}else"Table"!==(null===(t=e.layerDefinition)||void 0===t?void 0:t.type)&&(s={dataSourceId:null==e?void 0:e.id,mainDataSourceId:null==e?void 0:e.id,rootDataSourceId:n.dataSourceId},l.push(s))});(yield this.getTracesInMapView(n)).length>0&&(a=this.setConfigForSelectedDs(n.dataSourceId,a))}const r={id:this.props.id,useMapWidgetIds:(null==e?void 0:e.length)>0?e:null,config:a,useDataSources:l.length>0?l:[]};this.props.onSettingChange(r,i)}))}else this._mapLoadedTimer=setTimeout(()=>{this.getAvailableDataSources(e)},50);else{const t={id:this.props.id,useMapWidgetIds:(null==e?void 0:e.length)>0?e:null,config:a,useDataSources:[]};this.props.onSettingChange(t,i)}}}else this._mapLoadedTimer=setTimeout(()=>{this.getAvailableDataSources(e)},50)}),this.checkIfMapViewHasTraces=e=>{let t=!1,s=!0;const a=e.view;return a.when().then(()=>{const e=a.map;if(e.hasOwnProperty("utilityNetworks")&&null!==e.utilityNetworks){const a=e.utilityNetworks.getItemAt(0);a.load().catch(()=>{s=!1}),s&&a.hasOwnProperty("sharedNamedTraceConfigurations")&&a.sharedNamedTraceConfigurations.length>0&&(t=!0)}return t})},this.getTracesInMapView=e=>j(this,void 0,void 0,function*(){const t=e.view;let s=[];return t.when().then(()=>j(this,void 0,void 0,function*(){const e=t.map;if(e.hasOwnProperty("utilityNetworks")&&null!==e.utilityNetworks){const t=e.utilityNetworks.getItemAt(0);return yield t.load(),t.hasOwnProperty("sharedNamedTraceConfigurations")&&(s=t.sharedNamedTraceConfigurations),s}return s}))}),this.getDataSourceLabel=e=>{if(!e)return"";return t.DataSourceManager.getInstance().getDataSource(e).getLabel()||e},this.setConfigForSelectedDs=(e,t)=>{if(!t.configInfo.hasOwnProperty(e)){const s=g;return s.traceResultAreaSettings.resultAreaProperties.unit=y(),s.traceResultAreaSettings.resultAreaProperties.areaUnit="square-"+y(),t.setIn(["configInfo",e],s)}return t},this.isDataSourceValid=e=>{var t,s,a,i;return 0===this.dataSourceOptions.length?{isValid:!1}:(null===(t=this.dataSourceOptions[0])||void 0===t?void 0:t.value)===e?{isValid:null===(s=this.dataSourceOptions[0])||void 0===s?void 0:s.isValid}:this.dataSourceOptions.length>0&&(null===(a=this.dataSourceOptions[1])||void 0===a?void 0:a.value)===e?{isValid:null===(i=this.dataSourceOptions[1])||void 0===i?void 0:i.isValid}:{isValid:!1}},this.showDsPanel=e=>{this.setState({activeDataSource:e,showTraceItemPanel:!1},()=>{this.setState({showTraceItemPanel:!0})})},this.updateResultAreaSettings=(e,t)=>{const s=this.props.config.setIn(["configInfo",this.state.activeDataSource,"traceResultAreaSettings",e],t),a=[this.getInitOutDataSource(s)];this.props.onSettingChange({id:this.props.id,config:s},a)},this.state={activeDataSource:null,isNoMapSelected:0===(null===(s=this.props.useMapWidgetIds)||void 0===s?void 0:s.length),showTraceItemPanel:!1}}componentDidMount(){var e,s;let a;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const i=null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0];(null===(s=(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[i])?(a=!1,this.getAvailableDataSources(this.props.useMapWidgetIds)):(this.resetConfig(this.props.useMapWidgetIds),a=!0)}else a=!0;this.updateConfigForMapWidget(a)}render(){var s,l,r,o,c;return(0,e.jsx)("div",{css:(c=this.props.theme,t.css`
    .widget-setting-utility-trace {
      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }

      .warningMsg {
        padding: 0.25rem !important;
        margin-top: -7px;
      }

      .warningMsg .left-part {
        margin-right: 0 !important;
      }

      .color-label {
        color: ${c.sys.color.surface.overlayHint};
      }
    }
  `),children:(0,e.jsxs)("div",{className:"widget-setting-utility-trace",children:[(0,e.jsxs)(i.SettingSection,{className:(0,t.classNames)("map-selector-section",{"border-0":this.state.isNoMapSelected&&0===(null===(s=this.props.useMapWidgetIds)||void 0===s?void 0:s.length)}),children:[(0,e.jsxs)(i.SettingRow,{children:[(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("selectMapWidget"),title:this.nls("selectMapWidget"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default",children:this.nls("selectMapWidget")})}),(0,e.jsx)(a.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("selectMapWidgetHint"),title:this.nls("selectMapWidgetHint"),showArrow:!0,placement:"top",children:(0,e.jsx)("div",{className:"ml-2 d-inline ep-tooltip",children:(0,e.jsx)(d,{size:"m"})})})]}),(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(i.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds})})]}),(null===(l=this.props.useMapWidgetIds)||void 0===l?void 0:l.length)>0&&(0,e.jsxs)(i.SettingSection,{children:[(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("dataConfigLabel"),title:this.nls("dataConfigLabel"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label title2 text-paper",children:this.nls("dataConfigLabel")})})}),(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(a.Label,{tabIndex:0,"aria-label":this.nls("mapSettingsHintMsg"),className:"w-100 d-flex",children:(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default",children:this.nls("mapSettingsHintMsg")})})}),(0,e.jsx)(i.SettingRow,{children:this.dataSourceOptions.length>0&&(0,e.jsx)("div",{className:"w-100",children:(0,e.jsx)(i.MultipleJimuMapConfig,{mapWidgetId:null===(r=this.props.useMapWidgetIds)||void 0===r?void 0:r[0],onClick:this.showDsPanel,disableSwitchMap:!0,isDataSourceValid:this.isDataSourceValid,sidePopperContent:this.state.showTraceItemPanel&&(0,e.jsx)(t.React.Fragment,{children:this.state.activeDataSource&&this.props.config.configInfo[this.state.activeDataSource]&&(0,e.jsx)("div",{className:"w-100 h-100",css:n(this.props.theme),children:(0,e.jsx)("div",{className:"setting-container",children:(0,e.jsx)(i.SettingRow,{flow:"wrap",children:(0,e.jsx)(I,{intl:this.props.intl,theme:this.props.theme,config:this.props.config.configInfo[this.state.activeDataSource].traceResultAreaSettings,onResultAreaSettingsUpdated:this.updateResultAreaSettings})})})})})})})}),(null===(o=this.props.useMapWidgetIds)||void 0===o?void 0:o.length)>0&&0===this.dataSourceOptions.length&&(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(a.Alert,{tabIndex:0,className:"warningMsg",onClose:()=>null,open:!0,text:this.nls("warningNoMap"),type:"warning"})})]})]})})}}function T(e){u.p=e}})(),h})())}}});