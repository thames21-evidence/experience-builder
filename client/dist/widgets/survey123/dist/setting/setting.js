System.register(["jimu-core/emotion","jimu-core","jimu-for-builder","jimu-for-builder/service","jimu-ui/advanced/setting-components","jimu-ui","jimu-ui/advanced/data-source-selector"],function(e,t){var s={},i={},r={},a={},n={},o={},l={};return{setters:[function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.SessionManager=e.SessionManager,i.classNames=e.classNames,i.css=e.css,i.dateUtils=e.dateUtils,i.esri=e.esri,i.getAppStore=e.getAppStore,i.moduleLoader=e.moduleLoader,i.portalUrlUtils=e.portalUrlUtils,i.semver=e.semver},function(e){r.builderAppSync=e.builderAppSync},function(e){a.appServices=e.appServices},function(e){n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection},function(e){o.AdvancedSelect=e.AdvancedSelect,o.AlertPopup=e.AlertPopup,o.Button=e.Button,o.Label=e.Label,o.Modal=e.Modal,o.Radio=e.Radio,o.Select=e.Select,o.Switch=e.Switch,o.TagInput=e.TagInput,o.TextArea=e.TextArea,o.TextInput=e.TextInput},function(e){l.DataSourceSelector=e.DataSourceSelector}],execute:function(){e((()=>{var e={4108:e=>{"use strict";e.exports=r},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},13089:e=>{"use strict";e.exports=l},14321:e=>{"use strict";e.exports=o},24186:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4 4h2.5v1H4a3 3 0 0 0 0 6h2.5v1H4a4 4 0 1 1 0-8M12 11H9.5v1H12a4 4 0 1 0 0-8H9.5v1H12a3 3 0 0 1 0 6"></path><path fill="#000" d="M5.5 7.5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1z"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=n},79860:e=>{"use strict";e.exports=a}},t={};function d(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,d),r.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var s in t)d.o(t,s)&&!d.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var u={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(u),d.d(u,{__set_webpack_public_path__:()=>I,default:()=>M});var e=d(67386),t=d(79244),s=d(4108),i=d(79860),r=d(79298),a=d(14321),n=d(13089);const o=new class{setQueryObject(e){const t=e?e.survey123:"",s=t?decodeURIComponent(t+""):"",i=this._urlParamToJson(s);this.queryObj=i}constructor(){this.surveyFeatureServices={},this._commonParams={},this.setCommonParams()}getSurveyHostUrlFromPortal(e){if(e=e||"https://www.arcgis.com",this.surveyUrlFromPortal||null===this.surveyUrlFromPortal)return Promise.resolve(this.surveyUrlFromPortal);e.endsWith("/")||(e+="/");const t=e+"home/js/arcgisonline/config.js",s=e+"sharing/rest/portals/self/settings?f=json";return Promise.resolve(!0).then(()=>fetch(s,{mode:"cors",method:"GET"}).then(e=>{if(e.ok)return e.json();throw new Error(e)}).then(e=>{var t;(null===(t=e.portalConfigProperties)||void 0===t?void 0:t.surveyUrl)&&(this.surveyUrlFromPortal=e.portalConfigProperties.surveyUrl)}).catch(()=>{})).then(()=>{if(this.surveyUrlFromPortal)return this.surveyUrlFromPortal;const e=document.createElement("script");e.type="text/javascript",e.src=t;const s=document.documentElement,i=s.getAttribute("dir");return new Promise((t,r)=>{e.onload=()=>{s.getAttribute("dir")!==i&&s.setAttribute("dir",i);const e=window.esriGeowConfig;e&&e.surveyUrl?(this.surveyUrlFromPortal=e.surveyUrl,t(e.surveyUrl)):(this.surveyUrlFromPortal=null,t(null))},e.onerror=()=>{s.getAttribute("dir")!==i&&s.setAttribute("dir",i),console.log("Failed to get survey url from portal's config.js, will fallback to use the default survey123 url."),this.surveyUrlFromPortal=null,t(null)},document.getElementsByTagName("head")[0].appendChild(e)})})}getSurvey123HostUrl(){let e="https://survey123.arcgis.com";this.surveyUrlFromPortal&&(e=this.surveyUrlFromPortal);let t=window.jimuConfig.hostEnv;if(this.queryObj&&this.queryObj.env&&(t=this.queryObj.env+"",t.startsWith("http://")||t.startsWith("https://")))return t;let s=!0;if("https://survey123.arcgis.com"!==e){const t=e.match(/https:\/\/survey123(\.[^\.]*)\.arcgis\.com/);s=!(!t||!t.length)}return t&&"prd"!==t&&"prod"!==t&&s&&(e=`https://survey123${t}.arcgis.com`),e}getSurvey123HostAPIUrl(){let e=this.getSurvey123HostUrl()+"/api/jsapi/3.24/";return this.queryObj&&this.queryObj.jsapi&&(e=this.getSurvey123HostUrl()+"/api/jsapi/"+this.queryObj.jsapi),e}createSurvey(e,t,s,i){return i=Object.assign({snippet:""},i||{}),Promise.resolve(!0).then(()=>{if(!(e&&s&&s.token&&s.username))throw new Error("missing title, tags, username or token")}).then(()=>{const r=`${this.getSurvey123HostUrl()}/api/survey/create`,a={title:e,tags:t&&Array.isArray(t)?t.join(","):t||null,snippet:i.snippet,thumbnailUrl:i.thumbnailUrl,token:s.token,username:s.username,portalUrl:s.portalUrl||"https://www.arcgis.com"};return fetch(r,{mode:"cors",method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(a)}).then(e=>{if(e.ok)return e.json();throw new Error(e)})})}isPortal(e){return!["www.arcgis.com","devext.arcgis.com","qaext.arcgis.com"].find((t,s)=>e.includes(t))}querySurvey(e,t){return t=Object.assign({isPublished:!1,isSearchAll:!0,surveyClientAPI:null},t||{}),Promise.resolve(!0).then(()=>{if(!e||!e.token||!e.username)throw new Error("missing token or username")}).then(()=>{const s={isPublished:t.isPublished,isSearchAll:t.isSearchAll,token:e.token,username:e.username,portalUrl:e.portalUrl||"https://www.arcgis.com"};return t.searchSurveyType&&(s.searchSurveyType=t.searchSurveyType),t.surveyClientAPI?t.surveyClientAPI.survey123.searchSurvey(s).then(e=>{if(e&&e.results)return e.results;throw new Error(e)}):(console.log("Survey client api is not provided."),null)})}queryOthersSurvey(e,t){return Promise.resolve(!0).then(()=>{if(!e||!e.token||!e.username)throw new Error("missing token or username")}).then(()=>{e.token;const s=e.username,i=e.portalUrl||"https://www.arcgis.com",r=t.orgId;let a=null;const n=`${i}/sharing/rest/search`,o={q:`((type:Form AND (typekeywords:xForm OR typekeywords:Form)) OR (type:'Code Sample' AND typekeywords:XForms AND tags:'xform')) AND (NOT owner:${s}) AND (access:shared OR access:org OR (access:public AND orgid:${r}) OR access:private)`};return this.searchAGO(n,o,e).then(t=>{if(a=t,t.results=(t.results||[]).map(t=>this.convertItemToSurveyInfo(t,e)),-1===t.nextStart)return a;const s=[];let i=Math.floor(t.total/t.num);t.total%t.num>0&&(i+=1);for(let r=1;r<i;r++){const i=Object.assign({},o,{start:r*t.num+1});i.start<=t.total&&s.push(this.searchAGO(n,i,e))}return Promise.all(s).then(s=>{if(!s)throw new Error("something wrong when searchAll");let i=t.results||[],r=-1;return s.forEach((t,a)=>{const n=t.results.map(t=>this.convertItemToSurveyInfo(t,e));i=i.concat(n),a===s.length-1&&(r=t.nextStart)}),a.nextStart=r,a.results=i,a})})}).then(e=>e&&e.results||[])}searchAGO(e,t,s){t=Object.assign({num:100,start:1,sortField:"title",sortOrder:"asc"},t);const i=Object.assign({},{f:"json",token:s.token},t),r=`${e}?${Object.keys(i).map(e=>e+"="+i[e]).join("&")}`;return fetch(r,{mode:"cors",method:"GET"}).then(e=>{if(e.ok)return e.json();throw new Error(e)})}convertItemToSurveyInfo(e,t){return{created:e.created,featureService:null,form:null,formItemInfo:e,id:e.id,owner:e.owner,report:null,snippet:e.snippet,tags:e.tags,thumbnail:`${t.portalUrl}/sharing/rest/content/items/${e.id}/info/${e.thumbnail}?token=${t.token}`,title:e.title}}getSurvey123DesignerUrl(e,t){t=Object.assign({},t||{});let s=`${this.getSurvey123HostUrl()}/surveys/${e}/design?embed=exb`;return t.portalUrl&&"https://www.arcgis.com"!==t.portalUrl&&(s+=`&portalUrl=${t.portalUrl}`),"https://survey123dev.arcgis.com"!==this.getSurvey123HostUrl()||t.portalUrl&&"https://www.arcgis.com"!==t.portalUrl||(s+=`&portalUrl=${t.portalUrl}`),s}getSurvey123WebformUrl(e,t){t=Object.assign({queryParams:[]},t||{});let s=`${this.getSurvey123HostUrl()}/share/${e}`;return t.queryParams.length>0&&(s+=`?${t.queryParams.join("&")}`),s}flatQuestions(e){let t=[];return e.forEach(e=>{e.questions?"esriQuestionTypeRepeat"!==e.type&&("esriQuestionTypeAddress"===e.type&&t.push(e),t=t.concat(this.flatQuestions(e.questions))):t.push(e)}),t}getSurveyQuestionFields(e,t){return Promise.resolve(!0).then(()=>{if(!e||!t||!t.token)throw new Error("missing surveyItemId or token")}).then(()=>{let s=`${this.getSurvey123HostUrl()}/api/survey/${e}/form`;const i={token:t.token,portalUrl:t.portalUrl};return s=`${s}?${Object.keys(i).map(e=>e+"="+i[e]).join("&")}`,fetch(s,{mode:"cors",method:"GET"}).then(e=>{if(e.ok)return e.json();throw new Error(e)})})}setCommonParams(){var e,s;const i=(0,t.getAppStore)().getState().portalUrl;this._commonParams={token:null===(e=t.SessionManager.getInstance().getMainSession())||void 0===e?void 0:e.token,username:null===(s=(0,t.getAppStore)().getState().user)||void 0===s?void 0:s.username,portalUrl:i}}getCommonParams(){return this._commonParams||this.setCommonParams(),this._commonParams}getBaseRequestOptions(){const e=t.SessionManager.getInstance(),s=(0,t.getAppStore)().getState().portalUrl,i=t.portalUrlUtils.getPortalRestUrl(s);return{authentication:e.getSessionByUrl(s),portal:i}}updateRelatedDataSources(e,s){const i=t.DataSourceManager.getInstance().getDataSourcesAsArray();if(i.length)return Promise.resolve(!0).then(()=>this.getSurveyFeatureServices(e)).then(e=>{i.filter(t=>{const s=t.itemId,i=t.url||"",r=e.find(e=>!(e.itemId!==s&&!i.startsWith(e.url)));return r&&t.afterAddRecord(null),r})})}getSurveyFeatureServices(e){const s=this.surveyFeatureServices[e];if(s)return Promise.resolve(s);const i=t.SessionManager.getInstance().getMainSession(),r=[];let a=`type:Feature Service AND typekeywords:${e} AND typekeywords:StakeholderView`;a+=" AND ((typekeywords:Hosted Service AND typekeywords:View Service) OR (NOT typekeywords:Hosted Service))";const n=`${this._commonParams.portalUrl}/sharing/rest/search`,o={q:a};return this.searchAGO(n,o,this._commonParams).then(e=>{if(!e||e.error)throw new Error(JSON.stringify(e));if(e.results&&0===e.results.length)return null;const t=e.results[0];r.push({type:"stakeholder",url:t.url,temId:t.id})}).then(()=>{const s=Object.assign({id:e,relationshipType:"Survey2Service"},this.getBaseRequestOptions());return t.esri.restPortal.getRelatedItems(s).then(s=>{s&&!s.error||console.warn("Failed to get related templates");const a=s.relatedItems[0];if(!a)return r;const n=a.typeKeywords;if(-1===n.indexOf(e)||-1===n.indexOf("FieldworkerView")&&-1===n.indexOf("View Service"))return r.push({type:"source",url:a.url,temId:a.id}),r;{r.push({type:"fieldworker",url:a.url,temId:a.id});const e=`${a.url}/sources`,s={httpMethod:"GET",authentication:i};return t.esri.restRequest.request(e,s).then(e=>{const t=e.services[0];return t?this.getItemInfo(t.serviceItemId).then(e=>(e&&r.push({type:"source",url:e.url,temId:e.id}),r)):r})}})}).catch(e=>(console.log("Error occurs when get related feature services with survey,",e),r)).finally(()=>{this.surveyFeatureServices[e]=r})}getItemInfo(e){return t.esri.restPortal.getItem(e,this.getBaseRequestOptions())}getQuesLabelString(e,t){var s;if(t=Object.assign({locales:[],currentLocale:"en"},t||{}),!e||!e.label)return"";let i=e.label;if("object"==typeof i){let r=Object.keys(t.locales||[]).find(e=>e.isDefault+""=="true");r&&(r=r.code||"en");const a=null===(s=t.locales)||void 0===s?void 0:s.map(e=>(e.code+"").trim()),n=this._findMatchedLocale(t.currentLocale,a)||r;if(n&&n in e.label)i=e.label[n];else{const t=Object.keys(e.label)[0];i=t?e.label[t]:""}}return i}_urlParamToJson(e){if(!e)return null;const t=(e+="").split(";");if(t.length<2&&e.split(":").length<2)return e.split(",").length>1?e.split(","):e;{const e={};return t.forEach(t=>{const s=(t+"").split(":");if(s.length>1){const t=s[0];let i=(Array.isArray(s.slice(1))?s.slice(1):[]).join(":");i.length&&"{"===i[0]&&(i=this._stringToJson(i)),"string"==typeof i&&i.split(",").length>1&&(i=i.split(",")),e[t]=i}}),e}}_findMatchedLocale(e,t){if(!t||!t.length||!e)return null;if(t.indexOf(e)>=0)return e;const s=e.split("-")[0];return t.indexOf(s)>=0?s:t.find(e=>e.startsWith(`${s}-`))}_stringToJson(e){let t=e;try{t=JSON.parse(e)}catch(s){t=e}return t}},l={errLoadS123JSAPI:"Failed to load Survey123 JavaScript API from {S123JSAPIURL}. Please check if this URL is available to you.",chooseSurvey:"Select which survey to run in the widget:",createNewSurveyLabel:"Create new survey",chooseSurveyLabel1:"Select my own survey",chooseSurveyLabel2:"Select others' survey",draftSurveyPostfix:" (draft)",previewDraftSurveyMsg:"This survey is not published yet. Edit and publish the survey to preview the content here.",selectSurveyTip:"Please select",noExistingSurvey:"There is no available survey to this account.",surveySearchHint:"Search",surveyDetailLabel:"Survey Details:",currentSurveyLabel:"Current survey",resetSurveyLabel:"Reset survey",summaryLabel:"Summary",insertLabel:"Insert",surveyTitleLabel:"Name",surveyTitleRequiredMsg:"The name of the survey is required.",surveyTitleDuplicateMsg:"A survey with this name already exists, please use a different name.",surveyTagLabel:"Tags",surveyTagHint:"Separate tags with commas",surveyTagsRequiredMsg:"One or more tags are required.",surveySummaryLabel:"Summary",createSurveyBtn:"Create",createSurveyErrDuplicateTitle:"A survey with this name already exists, please choose a different name.",createSurveyDisabled1:"You do not have permission to perform this action. Required privileges: publish hosted feature layers",editSurveyBtn:"Edit survey",editSurveyBtnDisabledTip1:'You do not have enough privileges for this operation. Required privileges: "admin" or "update" control to both form and source feature layer items.',appearanceTitle:"Appearance",showOptionsBarLabel:"Show options bar",showOptionsHeaderLabel:"Show survey header",showOptionsDesLabel:"Show survey description",showOptionsFooterLabel:"Show survey footer",useSurveyTheme:"Enable survey theme",resetSurveyTip:"Reset survey will remove all settings to this survey widget.",confirmResetSurveyTip:"Are you sure you want to continue?",surveyModeTitle:"Mode",surveyModeNew:"Submit a new record",surveyModeEdit:"Edit an existing record",surveyModeView:"View an existing record",chooseExistDataTitle:"Load data to this survey",chooseExistDataEditDesc:"Load existing survey data from the source layer when a feature is selected in related widgets. Submit the survey updates the selected feature.",chooseExistDataViewDesc:"Load existing survey data from the source layer when a feature is selected in related widgets. The survey is read-only.",selectSurveyLayerTip:"Please select a layer that contains at least one existing survey record.",sendDataToSurveyTitle:"Send data to this survey",sendDataToSurveyDesc:"Attributes and geometry of a feature in the source layer can be sent to survey questions when the feature is selected in related widgets.",selectionChangeBehaviorTitle:"Behavior on selection change",selectionChangeBehaviorTypeRefresh:"Refresh survey and update connected questions",selectionChangeBehaviorTypePreserve:"Only update connected questions",sourceLayer:"Source layer",addConnTitle:"Field/question connections",addConnSelectField:"Select a field",addConnSelectQuestion:"Select a survey question",addConnFailed1:"The survey question type is not compatible with the field type.",addConnBtn:"Add connection",geometryLabel:"*Shape",geometryTypePoint:"Point",geometryTypeMultiPoint:"MultiPoint",geometryTypePolyline:"Polyline",geometryTypePolygon:"Polygon",errmsgGeneralLoading:"An error occurred while loading.",errmsgGeneralCreatingNewSvy:"An error occurred while creating the new survey. Pleasey try again later.",msgUnsavedBeforeLeaving:"Changes you made may not be saved."};function c(e){return t.css`
    &.survey123__desinger_modal {
      z-index: 100000;
      overflow: hidden;
      max-width: 100% !important;
      .modal-content{
        width: 100%;
        height: 100%;
        .survey123__desinger {
          width: 100%;
          height: 80px;
          padding: 23px 60px 23px 30px;
          color: ${null==e?void 0:e.sys.color.surface.headerText};
          background-color: ${null==e?void 0:e.sys.color.surface.header};

          >p {
            font-size: 24px;
            margin-bottom: 0;
            line-height: 33px;
          }
          >button {
            position: absolute;
            top: 28px;
            right: 30px;
            background-color: ${null==e?void 0:e.sys.color.surface.header};
            color: ${null==e?void 0:e.sys.color.surface.headerText};
            border: none;
            cursor: pointer;
            padding: 0;
          }
        }
        >iframe {
          height: calc(100% - 90px);
          width: 100%;
          border: none;
        }
      }
    }

  `}var h=d(62838),p=d.n(h),g=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s};const y=s=>{const i=window.SVG,{className:r}=s,a=g(s,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",r);return i?(0,e.jsx)(i,Object.assign({className:n,src:p()},a)):(0,e.jsx)("svg",Object.assign({className:n},a))};var v=d(24186),m=d.n(v),S=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s};const f=s=>{const i=window.SVG,{className:r}=s,a=S(s,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",r);return i?(0,e.jsx)(i,Object.assign({className:n,src:m()},a)):(0,e.jsx)("svg",Object.assign({className:n},a))};var w=d(9044),x=d.n(w),b=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s};const j=s=>{const i=window.SVG,{className:r}=s,a=b(s,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",r);return i?(0,e.jsx)(i,Object.assign({className:n,src:x()},a)):(0,e.jsx)("svg",Object.assign({className:n},a))};class M extends t.React.PureComponent{constructor(r){super(r),this.supportedMapTypes=(0,t.Immutable)([t.DataSourceTypes.WebMap]),this.supportedLayerTypes=(0,t.Immutable)([t.DataSourceTypes.FeatureLayer,t.DataSourceTypes.SceneLayer,t.DataSourceTypes.SubtypeGroupLayer,t.DataSourceTypes.SubtypeSublayer]),this.dsManager=t.DataSourceManager.getInstance(),this.state={userTags:[],canCreateSurvey:!0,loadApiFailed:!1,newSurveyTitle:null,newSurveyTags:[],newSurveyTitleDirty:!1,newSurveyTagsDirty:!1,newSurveySnippet:null,newSurveyItemId:null,newSurveyThumbnailUrls:["https://survey123.arcgis.com/assets/img/default-thumbnails/Image01.png","https://survey123.arcgis.com/assets/img/default-thumbnails/Image02.png","https://survey123.arcgis.com/assets/img/default-thumbnails/Image03.png"],newSurveyMsg:null,newSurveyLoading:!1,existSurveyMsg:null,existSharedSurveyMsg:null,existSurveys:[],existSharedSurveys:[],selectedSurvey:null,selectedMyOwnSurvey:null,selectedSharedSurvey:null,currentActiveSurvey:null,modalIsOpen:!1,mode:"none",isCheckedSurveyItemId:!1,isShowSurveyQuestionField:!1,surveyQuestionFields:[],selectedQuestionField:null,createSurveyErrorMsg:null,surveyStatusCode:0,isShowCloseDesignerAlert:!1,surveyChanged:!1,dsMapView:null,dsFeatureLayer:null,dsFeatureLayerFields:[],addMapping:null,editMapping:null,layerViewInfoInNewMode:null,layerViewInfoInEditMode:null,layerViewInfoInViewMode:null},this.newDefaultValue={key:"",value:""},this.API={survey123:null,Survey123WebForm:null},this.isPortal=!1,this.isOrgAdmin=!1,this.isTagRequired=!1,this.setDefaultVal=()=>{var e,t;this.props.config.surveyItemId&&!this.props.config.mode&&this.setMode("new");const s=this.props.config.mode||"new";let i=this.props.config.layerViewInfo||null;if(i){const s=this.dsManager.getDataSource(i.dataSourceId);i={dataSourceId:i.dataSourceId,mainDataSourceId:i.mainDataSourceId?i.mainDataSourceId:null===(e=s.getMainDataSource())||void 0===e?void 0:e.id,rootDataSourceId:i.rootDataSourceId?i.rootDataSourceId:null===(t=s.getRootDataSource())||void 0===t?void 0:t.id}}"new"===s?this.setState({layerViewInfoInNewMode:i}):"edit"===s?this.setState({layerViewInfoInEditMode:i}):"view"===s&&this.setState({layerViewInfoInViewMode:i})},this.prepare=()=>Promise.resolve(!0).then(()=>{if(this.isPortal){const e=this.props.config.portalUrl||this.props.portalUrl;return o.getSurveyHostUrlFromPortal(e)}return!0}).then(()=>this.loadSurveyAPI()),this.componentDidMount=()=>{this.checkPrivilige();const e=this.props.useDataSources,s=e&&e.length?e[0].dataSourceId:null;if(s){const e=this.dsManager.getDataSource(s),t=e?e.getLayerDefinition():null;this.setState({dsFeatureLayer:t,dsFeatureLayerFields:this.getLayerFields(t)})}const i=this.props.user;this.isOrgAdmin=!(!i||"org_admin"!==i.role),this.isPortal=!t.portalUrlUtils.isAGOLDomain(this.props.config.portalUrl||this.props.portalUrl),this.checkTagRequired(),this.getUserTags()},this.loadSurveyAPI=()=>{const e=o.getSurvey123HostAPIUrl();return this.API.survey123?Promise.resolve(this.API.survey123):t.moduleLoader.loadModule(e).then(t=>{if(this.API=t,!t){const t=this.props.intl.formatMessage({id:"errLoadS123JSAPI",defaultMessage:l.errLoadS123JSAPI},{S123JSAPIURL:e});throw this.setState({loadApiFailed:!0}),new Error(t)}return this.setState({loadApiFailed:!1,existSurveyMsg:"",existSharedSurveyMsg:"",newSurveyMsg:""}),t})},this.checkPrivilige=()=>{const e=(0,t.getAppStore)().getState().user.privileges||[],s=e.includes("portal:user:createItem")&&e.includes("portal:publisher:publishFeatures");this.setState({canCreateSurvey:s})},this.checkTagRequired=()=>{let e=this.props.portalSelf?this.props.portalSelf.currentVersion:null;if(this.isTagRequired=!1,e&&this.isPortal){(e+"").split(".").length<3&&(e+=".0");try{this.isTagRequired=t.semver.lt(e,"9.2.0")}catch(e){}}return this.isTagRequired},this.getUserTags=()=>{if(window.jimuConfig.isDevEdition)return!1;const e=(0,t.getAppStore)().getState().user.username;i.appServices.getUserTags(e).then(e=>{var t;const s=null===(t=null==e?void 0:e.tags)||void 0===t?void 0:t.map(e=>e.tag);this.setState({userTags:s||[]})})},this.getLayerFields=e=>{if(!e)return[];const t=[].concat(e.fields||[]);if("feature"!==e.type&&"Feature Layer"!==e.type)return t;if((t||[]).find(e=>"geometry"===e.name))return t;let s=e.geometryType||"";s.startsWith("esriGeometry")&&(s=s.replace("esriGeometry","").toLowerCase());const i=this.nls("geometryType"+s.substr(0,1).toUpperCase()+s.substr(1));return t.push({alias:`${this.nls("geometryLabel")}(${i})`,name:"geometry"}),t},this.onValueChanged=e=>{const t=e.currentTarget;this.props.onSettingChange({id:this.props.id,config:this.props.config.set(t.name,t.value)})},this.nls=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:l[e]},t),this.addDefaultValue=e=>{this.newDefaultValue.key&&this.newDefaultValue.value&&(this.newDefaultValue={key:"",value:""})},this.addDesigerHandler=()=>{window.addEventListener("message",e=>{if(e.data){let t=e.data;try{"string"==typeof e.data&&(t=JSON.parse(e.data)||{})}catch(e){}if("survey123:design:onFormPublished"===t.event&&t.data){let e=this.state.surveyStatusCode||0;e++,s.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"surveyStatusCode",value:e}),this.setState({surveyStatusCode:e}),this.handleCloseModal()}else"survey123:design:onFormUnsaved"===t.event&&t.data?this.setState({surveyChanged:!0}):"survey123:design:onFormSaved"===t.event&&t.data&&this.setState({surveyChanged:!1})}})},this.getFielAlias=e=>{const t=(this.state.dsFeatureLayerFields||[]).find(t=>t.name===e);return t?t.alias||t.name:e},this.getQuestionLabel=e=>{const t=(this.state.surveyQuestionFields||[]).find(t=>t.name===e);return t?t.label||t.name:e},this.onNewSurveyValueChanged=(e,t)=>{const s=e.currentTarget;t&&this.setState({[t]:s.value}),"newSurveyTags"===t&&this.setState({newSurveyTagsDirty:!0}),"newSurveyTitle"===t&&this.setState({newSurveyTitleDirty:!0})},this.onSurveySourceTypeChange=e=>{this.setState({mode:e,currentActiveSurvey:"survey-selectExistingSharedSurvey"===e?this.state.selectedSharedSurvey:this.state.selectedMyOwnSurvey,selectedSurvey:"survey-selectExistingSharedSurvey"===e?this.state.selectedSharedSurvey:this.state.selectedMyOwnSurvey})},this.onExistSurveyChanged=e=>{e&&e.length?(this.setState({selectedSurvey:e[0],currentActiveSurvey:e[0]}),"survey-selectExistingSharedSurvey"===this.state.mode?this.setState({selectedSharedSurvey:e[0]}):this.setState({selectedMyOwnSurvey:e[0]})):(this.setState({selectedSurvey:null,currentActiveSurvey:null}),"survey-selectExistingSharedSurvey"===this.state.mode?this.setState({selectedSharedSurvey:null}):this.setState({selectedMyOwnSurvey:null}))},this.createSurvey=()=>{if(!this.state.canCreateSurvey)return;const e=this.state.newSurveyTitle?this.state.newSurveyTitle.trim():"";let s=null;this.state.newSurveyTags&&this.state.newSurveyTags.length&&(s=this.state.newSurveyTags.map(e=>e.trim()));const i=this.state.newSurveySnippet;return e||this.setState({newSurveyTitleDirty:!0}),this.isTagRequired&&(this.state.newSurveyTags&&this.state.newSurveyTags.length||this.setState({newSurveyTagsDirty:!0})),e&&(!this.isTagRequired||s&&s.length)?Promise.resolve(!0).then(()=>{var r;this.setState({newSurveyMsg:"",newSurveyLoading:!0});const a=parseInt(10*Math.random()+"")%3,n=this.state.newSurveyThumbnailUrls[a],o={title:e,tags:s,token:null===(r=t.SessionManager.getInstance().getMainSession())||void 0===r?void 0:r.token,thumbnailUrl:n,snippet:i,portalUrl:this.props.config.portalUrl||this.props.portalUrl};return this.API.survey123.createSurvey(o)}).then(e=>{if(e&&e.id)return this.setState({createSurveyErrorMsg:null,newSurveyItemId:e.id,selectedSurvey:e,newSurveyLoading:!1}),e.id;throw new Error(e)}).then(e=>{e&&(this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hides",["navbar","header","description","footer","theme"])}),this.showSurvey123DesignerModal(e))}).catch(t=>{if(t){const s=t.error?t.error:t;let i=s.message?s.message:"string"==typeof s?t:"";s.details&&s.details.length&&s.details.forEach(e=>{i+=" "+e}),"survey123_create14"===s.messageCode&&(i=this.nls("createSurveyErrDuplicateTitle",{folderName:`'${e}'`})||i),this.setState({newSurveyMsg:i||"Create survey failed.",newSurveyLoading:!1})}console.error(t)}):void 0},this.querySurvey=e=>(e=e||{},Promise.resolve(!0).then(()=>{var s,i;if(this.props.config.surveyItemId&&this.props.config.selectedSurvey){const r=this.props.config.selectedSurvey;setTimeout(()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("surveyItemId",r.id)}),this.setState({existSurveyMsg:null,mode:"settings",selectedSurvey:r})},0);const a={isPublished:Object.assign({isPublished:!1},e||{}).isPublished,surveyClientAPI:this.API};return o.querySurvey({username:null===(s=this.props.user)||void 0===s?void 0:s.username,token:null===(i=t.SessionManager.getInstance().getMainSession())||void 0===i?void 0:i.token,portalUrl:this.props.config.portalUrl||this.props.portalUrl},a).then(e=>{const t=this.getSurveyItems(e);this.setState({existSurveys:t})})}}).then(()=>{var s;"none"===this.state.mode&&this.setState({mode:"survey-createSurvey"}),this.setState({existSurveyMsg:'<div class="survey-list-loading-outter"><div class="jimu-secondary-loading"></div></div>'});const i={isPublished:Object.assign({isPublished:!1},e||{}).isPublished,surveyClientAPI:this.API};return o.querySurvey({username:this.props.user.username,token:null===(s=t.SessionManager.getInstance().getMainSession())||void 0===s?void 0:s.token,portalUrl:this.props.config.portalUrl||this.props.portalUrl},i)}).then(e=>{const t=this.getSurveyItems(e);this.setState({existSurveyMsg:null,existSurveys:t}),e&&e.length||this.setState({existSurveyMsg:`<p class="no-survey-message">${this.props.intl.formatMessage({id:"noExistingSurvey",defaultMessage:l.noExistingSurvey})}</p>`})}).then(()=>{var e;return this.setState({existSharedSurveyMsg:'<div class="survey-list-loading-outter"><div class="jimu-secondary-loading"></div></div>'}),o.queryOthersSurvey({username:this.props.user.username,token:null===(e=t.SessionManager.getInstance().getMainSession())||void 0===e?void 0:e.token,portalUrl:this.props.config.portalUrl||this.props.portalUrl},{orgId:this.props.portalSelf?this.props.portalSelf.id:null})}).then(e=>{const t=this.getSurveyItems(e);this.setState({existSharedSurveyMsg:null,existSharedSurveys:t}),e&&e.length||this.setState({existSharedSurveyMsg:`<p class="no-survey-message">${this.props.intl.formatMessage({id:"noExistingSurvey",defaultMessage:l.noExistingSurvey})}</p>`})}).then(()=>{const e=this.props.config.surveyItemId;if(e){const t=this.state.existSurveys.find(t=>t.id===e),s=this.state.existSharedSurveys.find(t=>t.id===e),i=t||s;i&&(this.setState({selectedSurvey:i}),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("selectedSurvey",i)}))}}).catch(e=>{this.setState({mode:"survey-createSurvey",existSurveyMsg:`<p class="error-message">${this.props.intl.formatMessage({id:"errmsgGeneralLoading",defaultMessage:l.errmsgGeneralLoading})}</p>`}),console.log(e)})),this.getSurveyItems=s=>((s||[]).forEach(s=>{s.value=s.id,s.label=s.title,s.render=()=>(0,e.jsx)("div",{css:t.css`width: 178px;text-overflow: ellipsis; white-space: nowrap;overflow: hidden;`,title:s.title,children:(0,e.jsx)("span",{children:s.title})})}),s),this.getSurveyQuestionFields=()=>{const e=this.props.config.surveyItemId;return Promise.resolve(!0).then(()=>{var s,i;if(e&&(null===(s=t.SessionManager.getInstance().getMainSession())||void 0===s?void 0:s.token)&&this.API.getForm){const s={itemId:e,token:null===(i=t.SessionManager.getInstance().getMainSession())||void 0===i?void 0:i.token,portalUrl:this.props.config.portalUrl||this.props.portalUrl||"https://www.arcgis.com"};return this.API.getForm(s)}return null}).then(s=>{const i=[],r=(0,t.getAppStore)().getState().appContext.locale||"en";if(s&&s.questions&&s.questions.length>0){o.flatQuestions(s.questions).forEach(e=>{const t=(e.type+"").replace("esriQuestionType","");(e.fieldName||["geopoint","polyline","polygon"].includes(t.toLowerCase()))&&i.push({name:e.fieldName||e.name,label:o.getQuesLabelString(e,{locales:s.locales,currentLocale:r})})})}return s.error&&s.error.message&&console.warn("Cannot get survey question fields for survey: "+e,s.error.message),this.setState({surveyQuestionFields:i}),i})},this.showSettingPage=()=>{this.setState({mode:"settings"}),this.getSurveyQuestionFields()},this.handleCloseModal=()=>{if(this.state.surveyChanged)return void this.setState({isShowCloseDesignerAlert:!0});this.setState({modalIsOpen:!1}),this.setState({surveyChanged:!1}),this.showSettingPage();const e=this.state.newSurveyItemId||this.props.config.surveyItemId;e&&this.props.onSettingChange({id:this.props.id,config:this.props.config.set("surveyItemId",e).set("timestamp",Date.now()).set("mode","new")}),this.querySurvey()},this.handleCloseDesignerAlert=e=>{this.setState({isShowCloseDesignerAlert:!1}),e&&(this.setState({surveyChanged:!1}),setTimeout(()=>{this.handleCloseModal()},0))},this.onTagInputChange=e=>{this.setState({newSurveyTags:e})},this.getThumbnailUrl=()=>{var e;const s=this.props.config.portalUrl||this.props.portalUrl||"https://www.arcgis.com",i=this.state.selectedSurvey.id,r=this.state.selectedSurvey.thumbnail;return(r+"").startsWith("http://")||(r+"").startsWith("https://")?r:`${s}/sharing/rest/content/items/${i}/info/${r}?token=${null===(e=t.SessionManager.getInstance().getMainSession())||void 0===e?void 0:e.token}`},this.setSurveyItemId=()=>{const e=this.state.selectedSurvey;e&&e.id&&(this.props.onSettingChange({id:this.props.id,config:this.props.config.set("surveyItemId",e.id).set("hides",["navbar","header","description","footer","theme"]).set("mode","new")}),this.setState({mode:"settings"}))},this.editSurvey=()=>{this.showSurvey123DesignerModal()},this.setAppearance=(e,t)=>{const s=[].concat(this.props.config.hides||[]);if(e&&s.indexOf(t)>=0){const e=s.indexOf(t);s.splice(e,1)}else s.push(t);this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hides",s)})},this.setMode=e=>{this.props.config.mode!==e&&this.props.onSettingChange({id:this.props.id,config:this.props.config.set("mode",e)})},this.selectionChangeBehavior=e=>{this.props.config.selectionChangeBehavior!==e&&this.props.onSettingChange({id:this.props.id,config:this.props.config.set("selectionChangeBehavior",e)})},this.handleUseDataSourceChange=e=>{let t;t=e&&e.length?e[0].dataSourceId:null,this.props.onSettingChange({id:this.props.id,useDataSources:t?[{dataSourceId:t,mainDataSourceId:e[0].mainDataSourceId,rootDataSourceId:e[0].rootDataSourceId}]:null,config:this.props.config.set("layerViewInfo",e[0]).set("fieldQuestionMapping",null)});const s=this.dsManager.getDataSource(t),i=s?s.getLayerDefinition():null,r=this.props.config.mode||"new";"new"===r?(t&&s&&i||this.clearMapping(),this.setState({layerViewInfoInNewMode:e[0],dsFeatureLayer:i,dsFeatureLayerFields:this.getLayerFields(i)})):"edit"===r?this.setState({layerViewInfoInEditMode:e[0]}):"view"===r&&this.setState({layerViewInfoInViewMode:e[0]})},this.activeLinkDataChange=e=>{const t=e.currentTarget.checked;this.props.onSettingChange({id:this.props.id,config:this.props.config.set("activeLinkData",t)})},this.addMapppingChange=(e,t)=>{const s=t.currentTarget.value;let i=this.state.addMapping?this.state.addMapping.field:null,r=this.state.addMapping?this.state.addMapping.question:null;"field"===e?i=s:r=s,this.setState({addMapping:{field:i,question:r}})},this.clearMapping=()=>{},this.showEditMappingPanel=(e,t)=>{if((this.state.editMapping||{}).index===e)return;let s=this.props.config.fieldQuestionMapping||[];s=e>=0&&e<s.length?s[e]:null;const i=Object.assign({},s);i.index=e,this.setState({editMapping:i,addMapping:null})},this.changeEditMapping=(e,t)=>{const s=t.currentTarget.value,i=Object.assign({},this.state.editMapping||{});"field"===e?i.field=s:i.question=s,this.setState({editMapping:i})},this.editMapping=e=>{const t=[].concat(this.props.config.fieldQuestionMapping||[]),s=this.state.editMapping||{};e>=0&&e<t.length&&(t[e]={field:s.field,question:s.question}),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("fieldQuestionMapping",t)})},this.activeAddFieldQuestionConnPanel=()=>{this.setState({addMapping:{field:null,question:null},editMapping:null})},this.deactiveAddFieldQuestionConnPanel=()=>{this.setState({addMapping:null})},this.deleteConnection=(e,t)=>{t&&t.stopPropagation();const s=[].concat(this.props.config.fieldQuestionMapping||[]);e>=0&&e<s.length&&s.splice(e,1),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("fieldQuestionMapping",s)})},this.addFieldQuestionConn=e=>{const t=this.state.addMapping.field,s=this.state.addMapping.question;if(!t||!s)return void console.log("Please ensure field/question is not null.");const i=[].concat(this.props.config.fieldQuestionMapping||[]);i.push({field:t,question:s}),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("fieldQuestionMapping",i)}),this.deactiveAddFieldQuestionConnPanel()},this.onSurveyQuestionFieldChanged=e=>{const t=e.currentTarget.value;t&&"null"!==t&&this.props.onSettingChange({id:this.props.id,config:this.props.config.set("selectedSurveyQuestionFields",[t])})},this.isDsConfigured=()=>!(!this.props.useDataSources||1!==this.props.useDataSources.length),this.resetSurvey=()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("surveyItemId",null).set("hides",[]).set("embeds",["fullScreen","onSubmitted"]).set("selectedSurveyQuestionFields",[]).set("fieldQuestionMapping",[]).set("activeLinkData",!1).set("dsType",null).set("selectedSurvey",null).set("mode","new").set("selectionChangeBehavior","").set("layerViewInfo","")}),this.setState({mode:"survey-createSurvey",selectedSurvey:null,selectedMyOwnSurvey:null,selectedSharedSurvey:null,currentActiveSurvey:null,isCheckedSurveyItemId:!1,surveyQuestionFields:[],dsMapView:null,dsFeatureLayer:null,dsFeatureLayerFields:[],layerViewInfoInNewMode:null,layerViewInfoInEditMode:null,layerViewInfoInViewMode:null})},o.setQueryObject(this.props.queryObject),this.isPortal=!t.portalUrlUtils.isAGOLDomain(this.props.config.portalUrl||this.props.portalUrl),this.checkTagRequired();const a=this.props.user;this.isOrgAdmin=!(!a||"org_admin"!==a.role),this.prepare().then(()=>{this.setDefaultVal(),this.querySurvey(),this.addDesigerHandler()}).catch(e=>{setTimeout(()=>{this.state.loadApiFailed&&this.setState({existSurveyMsg:`<p class="error-message">${e.message||""}</p>`,existSharedSurveyMsg:`<p class="error-message">${e.message||""}</p>`,mode:"survey-createSurvey",newSurveyMsg:e.message||"",loadApiFailed:!0})},0)})}showSurvey123DesignerModal(e){e=e||this.props.config.surveyItemId;const s=t.SessionManager.getInstance(),i=this.props.config.portalUrl||this.props.portalUrl;if(!e)throw new Error("cannot get survey item id to open survey123 designer");let r=o.getSurvey123DesignerUrl(e,{portalUrl:i});const a=s.getMainSession();a&&a.token&&a.username&&a.tokenDuration&&(r+=`#access_token=${a.token}&username=${a.username}&expires_in=${a.tokenDuration}`),this.setState({modalIsOpen:!0,newSurveyMsg:null});let n=0;const l=setInterval(()=>{this.state.modalIsOpen||this.setState({modalIsOpen:!0}),n++;const e=document.getElementById("survey123-designer");(e||n>100)&&(clearInterval(l),e.src=r)},50)}render(){var s,i,o,d,u,h,p,g,v,m,S,w,x,b;return this.state.selectedSurvey&&this.props.config.surveyItemId&&!1===this.state.isCheckedSurveyItemId&&(this.setState({isCheckedSurveyItemId:!0}),this.showSettingPage()),(0,e.jsxs)("div",{css:(b=this.props.theme,t.css`
    &.survey123{
      input:-webkit-autofill {
        -webkit-box-shadow: 0 0 0px 1000px ${b.ref.palette.white} inset;
        -webkit-text-fill-color: ${b.ref.palette.black};
      }
      .survey123__section {
        .choose-survey-label {
          margin-bottom: 0;
        }
        input + span {
          // margin-left:5px;
        }
        .jimu-widget-setting--section-header.row >h6 {
          font-size: 0.875rem;
          color: ${b.ref.palette.neutral[1e3]};
        }

        .survey-list-msg {
          padding: 0 5px;
        }
        .survey-list-loading-outter {
          position: relative;
          top: -18px;
        }
        .survey123__section-createSurvey {
          >.container >.w-100.setting-header {
            padding-bottom: 1rem!important;
            >div:first-of-type {
              padding-bottom: 0.5rem;
            }
            >.jimu-input span.input-wrapper {
              height: 1.625rem;
            }
            .summary{
              height: auto;
              textarea {
                resize: none;
              }
            }
          }
        }

        .survey123__section-createSurvey, .select-survey-section {
          .error-message {
            color: ${b.sys.color.error.main};
            word-break: break-word;
          }
          .no-survey-message {
            color: ${b.ref.palette.neutral[900]};
          }
          .newSurvey-msg {
            color: ${b.sys.color.error.main};
            marginTop: '10px';
            word-break: break-word;
          }
        }
        .select-survey-section {
          hr.split-line {
            display: none;
          }
        }
        .create-survey-container {
          .jimu-widget-setting--row.items {
            margin-top: 1.2rem;
            display: block;
            h6 {
              color: ${b.ref.palette.neutral[1e3]};
            }
            div.w-100 {
              font-size: 0.8125rem;
              line-height: 1.1875rem;
              margin-top: 0.3125rem;
            }
          }
          .jimu-widget-setting--row >label {
            font-size: 0.875rem;
            font-weight: 400;
            +p.w-100 {
              font-size: 0.8125rem;
              line-height: 1.1875rem;
              margin-top: 0.3125rem;
            }
          }
        }

        .appearance, .section-title {
          display: flex;
          justify-content: space-between;
          width:100%;
          h6 {
            margin-bottom: 0;
          }
        }

        .select{
          select {
            width: 100%;
          }
        }

        .mapping-container {
          padding: 0.615em;
          background: ${b.sys.color.secondary.main};
          border-radius: 2px;
          margin: 0.6em 0;
          position: relative;
          >select {
            height: 26px;
            vertical-align: middle;
            font-size: 1em;
            line-height: 26px;
            padding: 0 22px 0 6px;
            &:first-of-type {
              margin-bottom: 8px;
            }
          }
          .btn-group {
            width: 100%;
            overflow: hidden;
            .icon-remove-mapping {
              padding: 0 0.25em;
              margin-left: 0;
              margin-right: 0;
              cursor: pointer;
              .remove-mapping {
                margin-right: 0;
                margin-left: 0;
              }
            }
            button {
              margin: 8px 0 8px 8px;
              height: 26px;
              line-height: 26px;
              padding: 0;
              padding: 0px 14px;
            }
          }
          >.link-info {
            > p {
              margin-bottom: 0;
              line-height: 2em;
            }
            > div.center-line {
              width: 96%;
              height: 1px;
              background: ${b.sys.color.secondary.dark};
              text-align: center;
              margin: 0.5em 2% 0.5em 2%;
              >.connect {
                display: inline-block;
                width: 26px;
                height: 20px;
                background: ${b.sys.color.secondary.main};
                position: relative;
                top: -10px;
              }
            }
            > div.delete-connect {
              display: none;
              position: absolute;
              right: 0;
              top: 0;
              cursor: pointer;
              background: ${b.sys.color.secondary.main};
              text-align: center;
              width: 24px;
              height: 24px;
            }
            &:hover > div.delete-connect {
              display: block;
            }
          }

        }

        .setting-row {
          margin: 0.5rem 0 0 0;
          display: flex;
          flex-flow: row wrap;
          align-items: center;
        }

        .selection-behavior-item {
          margin-top: 0.5rem;
        }
        .section-title h5{
          display: inline-block;
          font-weight: 500;
        }

        .section-title h6{
          word-break: break-word;
        }

        .fea-layer-outter {
          flex-wrap:wrap;
          >div {
            width: 100%;
          }
        }

        .use-feature-layer-setting {
          width: 100%;
          margin-top: 0.25em;
        }
        .feature-layer-dropdown {
          width: 100%;
          margin: 0.5rem 0 0 0;
        }
        &-resetSurvey {
          position:relative;
          // top: -8px;
          height: 26px;
          float:right;
          line-height: 8px;

          svg {
            margin:0px !important;
          }
        }

        .cursor-pointer{
          &:hover{
            cursor:pointer;
          }
        }
        .select-survey-label {
          padding: 0 8px;
        }

        &-surveyMenu {}

        &-selectExistingSurvey {}

        &-createSurvey {
          overflow-y: hidden;

          span.isRequired{
            position:relative;
            /* left:-180px; */
            color: ${b.sys.color.error.main};
            top: 4px;
            left: 4px;
          }
        }

        &-surveySettings {

        }
      }
    }
  `),className:"jimu-widget-setting survey123",children:[(0,e.jsxs)("div",{className:"survey123__section",style:-1!==this.state.mode.indexOf("survey-")?{display:"block"}:{display:"none"},children:[(0,e.jsxs)(r.SettingSection,{role:"radiogroup","aria-label":this.nls("chooseSurvey"),children:[(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("p",{className:"choose-survey-label",children:this.props.intl.formatMessage({id:"chooseSurvey",defaultMessage:l.chooseSurvey})})}),(0,e.jsxs)(r.SettingRow,{children:[(0,e.jsx)(a.Radio,{name:"survey-survey",className:"cursor-pointer",id:"survey-survey-createNewSurvey",checked:"survey-createSurvey"===this.state.mode,onChange:()=>{this.setState({mode:"survey-createSurvey"})}}),(0,e.jsx)(a.Label,{for:"survey-survey-createNewSurvey",className:"cursor-pointer select-survey-label",children:this.props.intl.formatMessage({id:"createNewSurveyLabel",defaultMessage:l.createNewSurveyLabel})})]}),(0,e.jsxs)(r.SettingRow,{children:[(0,e.jsx)(a.Radio,{name:"survey-survey",className:"cursor-pointer",id:"survey-survey-chooseExistingSurvey",checked:"survey-selectExistingSurvey"===this.state.mode,onChange:()=>{this.onSurveySourceTypeChange("survey-selectExistingSurvey")}}),(0,e.jsx)(a.Label,{for:"survey-survey-chooseExistingSurvey",className:"cursor-pointer select-survey-label",children:this.props.intl.formatMessage({id:"chooseSurveyLabel1",defaultMessage:l.chooseSurveyLabel1})})]}),(0,e.jsxs)(r.SettingRow,{children:[(0,e.jsx)(a.Radio,{name:"survey-survey",className:"cursor-pointer",id:"survey-survey-chooseExistingSharedSurvey",checked:"survey-selectExistingSharedSurvey"===this.state.mode,onChange:()=>{this.onSurveySourceTypeChange("survey-selectExistingSharedSurvey")}}),(0,e.jsx)(a.Label,{for:"survey-survey-chooseExistingSharedSurvey",className:"cursor-pointer select-survey-label",children:this.props.intl.formatMessage({id:"chooseSurveyLabel2",defaultMessage:l.chooseSurveyLabel2})})]})]}),(0,e.jsxs)("div",{className:"survey123__section-selectExistingSurvey",role:"group","aria-label":this.nls("chooseSurveyLabel1"),style:"survey-selectExistingSurvey"===this.state.mode||"survey-selectExistingSharedSurvey"===this.state.mode?{display:"block"}:{display:"none"},children:["survey-selectExistingSurvey"===this.state.mode?(0,e.jsxs)(r.SettingSection,{className:"select-survey-section",children:[(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)(a.AdvancedSelect,{size:"sm",className:"survey-dropdown",staticValues:this.state.existSurveys,selectedValues:this.state.selectedMyOwnSurvey?[this.state.selectedMyOwnSurvey]:[],allTag:this.props.intl.formatMessage({id:"selectSurveyTip",defaultMessage:l.selectSurveyTip}),onChange:this.onExistSurveyChanged,placeholder:this.props.intl.formatMessage({id:"selectSurveyTip",defaultMessage:l.selectSurveyTip})})}),(0,e.jsx)("div",{className:"survey-list-msg",dangerouslySetInnerHTML:{__html:this.state.existSurveyMsg}})]}):(0,e.jsxs)(r.SettingSection,{className:"select-survey-section",children:[(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)(a.AdvancedSelect,{size:"sm",className:"survey-dropdown",staticValues:this.state.existSharedSurveys,selectedValues:this.state.selectedSharedSurvey?[this.state.selectedSharedSurvey]:[],allTag:this.props.intl.formatMessage({id:"selectSurveyTip",defaultMessage:l.selectSurveyTip}),onChange:this.onExistSurveyChanged,placeholder:this.props.intl.formatMessage({id:"selectSurveyTip",defaultMessage:l.selectSurveyTip})})}),(0,e.jsx)("div",{className:"survey-list-msg",dangerouslySetInnerHTML:{__html:this.state.existSharedSurveyMsg}})]}),(0,e.jsx)("div",{style:{display:this.state.currentActiveSurvey?"block":"none"},children:(0,e.jsx)(r.SettingSection,{title:this.nls("surveyDetailLabel"),className:"create-survey-container",children:this.state.currentActiveSurvey?[(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("img",{alt:this.nls("thumbnail"),src:this.state.currentActiveSurvey.thumbnail,style:{width:"100%",height:"auto"}})},"surveyThumnail"),(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("span",{style:{wordBreak:"break-word",fontSize:"0.8125rem",color:"#FFFFFF"},children:this.state.currentActiveSurvey.title})},"surveyTitle"),(0,e.jsx)(r.SettingRow,{className:"items",children:(0,e.jsx)("div",{className:"w-100",children:this.nls("ownerIs",{ownerName:this.state.currentActiveSurvey.owner||""})})},"surveyAuthor"),(0,e.jsx)(r.SettingRow,{className:"items",children:(0,e.jsx)("div",{className:"w-100",children:this.nls("updatedOn",{updatedDate:t.dateUtils.formatDateValue(this.state.currentActiveSurvey.formItemInfo.modified,this.props.intl)})})},"surveyCreationDate"),this.state.currentActiveSurvey.snippet?(0,e.jsxs)(r.SettingRow,{className:"items",children:[(0,e.jsx)("h6",{children:this.nls("summaryLabel")}),(0,e.jsx)("div",{className:"w-100",children:this.state.currentActiveSurvey.snippet})]},"surveySnippet"):null,(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)(a.Button,{type:"primary",className:"w-100",onClick:this.setSurveyItemId,children:this.props.intl.formatMessage({id:"insertLabel",defaultMessage:l.insertLabel})})},"surveyInsertBtn")]:null})})]}),(0,e.jsx)("div",{className:"survey123__section-createSurvey",role:"group","aria-label":this.nls("createNewSurveyLabel"),style:"survey-createSurvey"===this.state.mode?{display:"block"}:{display:"none"},children:(0,e.jsxs)(r.SettingSection,{children:[(0,e.jsxs)("div",{className:"w-100 d-flex flex-wrap align-items-center justify-content-between setting-header setting-title pb-2",children:[(0,e.jsxs)("div",{children:[this.nls("surveyTitleLabel"),(0,e.jsx)("span",{className:"isRequired",children:"*"})]}),(0,e.jsx)(a.TextInput,{"aria-label":this.nls("surveyTitleLabel"),"aria-required":"true",required:!0,className:"w-100",value:this.state.newSurveyTitle||"",onChange:e=>{this.onNewSurveyValueChanged(e,"newSurveyTitle")}}),this.state.newSurveyTitle&&this.state.newSurveyTitle.trim()||!this.state.newSurveyTitleDirty?"":(0,e.jsx)("div",{className:"error-message",children:this.props.intl.formatMessage({id:"surveyTitleRequiredMsg",defaultMessage:l.surveyTitleRequiredMsg})}),this.state.createSurveyErrorMsg&&!this.state.newSurveyTitleDirty?(0,e.jsx)("div",{className:"error-message",children:this.props.intl.formatMessage({id:"surveyTitleDuplicateMsg",defaultMessage:l.surveyTitleDuplicateMsg})}):""]}),(0,e.jsxs)("div",{className:"w-100 d-flex flex-wrap align-items-center justify-content-between setting-header setting-title pb-2",children:[(0,e.jsxs)("div",{children:[this.nls("surveyTagLabel"),this.isTagRequired?(0,e.jsx)("span",{className:"isRequired",children:"*"}):""]}),(0,e.jsx)(a.TagInput,{"aria-label":this.nls("surveyTagLabel"),values:this.state.newSurveyTags,suggestions:this.state.userTags,onChange:this.onTagInputChange,name:this.nls("surveyTagLabel"),maxListHeight:80}),this.state.newSurveyTags&&this.state.newSurveyTags.length||!this.state.newSurveyTagsDirty||!this.isTagRequired?"":(0,e.jsx)("div",{className:"error-message",children:this.props.intl.formatMessage({id:"surveyTagsRequiredMsg",defaultMessage:l.surveyTagsRequiredMsg})})]}),(0,e.jsxs)("div",{className:"w-100 d-flex flex-wrap align-items-center justify-content-between setting-header setting-title pb-2",children:[(0,e.jsx)("div",{children:this.nls("surveySummaryLabel")}),(0,e.jsx)(a.TextArea,{"aria-label":this.nls("surveySummaryLabel"),className:"w-100 summary",height:80,value:this.state.newSurveySnippet||"",onChange:e=>{this.onNewSurveyValueChanged(e,"newSurveySnippet")}})]}),(0,e.jsxs)(r.SettingRow,{flow:"wrap",children:[(0,e.jsx)(a.Button,{type:"primary",className:"w-100",disabled:!0===this.state.newSurveyLoading||!this.state.canCreateSurvey||this.state.loadApiFailed,onClick:this.createSurvey,children:this.props.intl.formatMessage({id:"createSurveyBtn",defaultMessage:l.createSurveyBtn})}),(0,e.jsx)("span",{className:"newSurvey-msg",children:this.state.canCreateSurvey?this.state.newSurveyMsg:this.nls("createSurveyDisabled1")}),(0,e.jsx)("div",{className:"w-100",style:{position:"relative",display:"block",marginTop:"50px"},children:(0,e.jsx)("div",{className:"jimu-secondary-loading",style:!0===this.state.newSurveyLoading?{display:"block"}:{display:"none"}})})]})]})})]}),(0,e.jsxs)("div",{className:"survey123__section",style:-1!==this.state.mode.indexOf("settings")?{display:"block"}:{display:"none"},children:[(0,e.jsxs)(r.SettingSection,{children:[(0,e.jsx)(r.SettingRow,{children:(0,e.jsxs)("div",{className:"section-title",children:[(0,e.jsx)("h6",{children:this.state.selectedSurvey?this.state.selectedSurvey.title:""}),(0,e.jsx)(a.Button,{"aria-label":this.nls("remove"),"aria-description":this.state.selectedSurvey?this.state.selectedSurvey.title:"",className:"survey123__section-resetSurvey",onClick:()=>{this.setState({mode:"confirmResetSurvey"})},children:(0,e.jsx)(y,{size:8})})]})}),(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)(a.Button,{"aria-description":this.state.selectedSurvey?this.state.selectedSurvey.title:"",className:"w-100",color:"primary",type:"primary",onClick:this.editSurvey,children:this.props.intl.formatMessage({id:"editSurveyBtn",defaultMessage:l.editSurveyBtn})})})]}),(0,e.jsxs)(r.SettingSection,{role:"group","aria-label":this.nls("appearanceTitle"),title:this.nls("appearanceTitle"),children:[(0,e.jsx)(r.SettingRow,{tag:"label",children:(0,e.jsxs)("div",{className:"appearance",children:[(0,e.jsx)("span",{children:this.props.intl.formatMessage({id:"showOptionsBarLabel",defaultMessage:l.showOptionsBarLabel})}),(0,e.jsx)(a.Switch,{className:"can-x-switch",checked:!this.props.config.hides.includes("navbar"),onChange:e=>{this.setAppearance(e.target.checked,"navbar")}})]})}),(0,e.jsx)(r.SettingRow,{tag:"label",children:(0,e.jsxs)("div",{className:"appearance",children:[(0,e.jsx)("span",{children:this.props.intl.formatMessage({id:"showOptionsHeaderLabel",defaultMessage:l.showOptionsHeaderLabel})}),(0,e.jsx)(a.Switch,{className:"can-x-switch",checked:!this.props.config.hides.includes("header"),onChange:e=>{this.setAppearance(e.target.checked,"header")}})]})}),(0,e.jsx)(r.SettingRow,{tag:"label",children:(0,e.jsxs)("div",{className:"appearance",children:[(0,e.jsx)("span",{children:this.props.intl.formatMessage({id:"showOptionsDesLabel",defaultMessage:l.showOptionsDesLabel})}),(0,e.jsx)(a.Switch,{className:"can-x-switch",checked:!this.props.config.hides.includes("description"),onChange:e=>{this.setAppearance(e.target.checked,"description")}})]})}),(0,e.jsx)(r.SettingRow,{tag:"label",children:(0,e.jsxs)("div",{className:"appearance",children:[(0,e.jsx)("span",{children:this.props.intl.formatMessage({id:"showOptionsFooterLabel",defaultMessage:l.showOptionsFooterLabel})}),(0,e.jsx)(a.Switch,{className:"can-x-switch",checked:!this.props.config.hides.includes("footer"),onChange:e=>{this.setAppearance(e.target.checked,"footer")}})]})}),(0,e.jsx)(r.SettingRow,{tag:"label",children:(0,e.jsxs)("div",{className:"appearance",children:[(0,e.jsx)("span",{children:this.props.intl.formatMessage({id:"useSurveyTheme",defaultMessage:l.useSurveyTheme})}),(0,e.jsx)(a.Switch,{className:"can-x-switch",checked:!this.props.config.hides.includes("theme"),onChange:e=>{this.setAppearance(e.target.checked,"theme")}})]})})]}),(0,e.jsxs)(r.SettingSection,{role:"radiogroup","aria-label":this.nls("surveyModeTitle"),title:this.nls("surveyModeTitle"),children:[(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center",children:(0,e.jsxs)("div",{className:"align-items-center d-flex",children:[(0,e.jsx)(a.Radio,{style:{cursor:"pointer"},onChange:()=>{this.setMode("new")},checked:"new"===this.props.config.mode,title:this.props.intl.formatMessage({id:"surveyModeNew",defaultMessage:l.surveyModeNew})}),(0,e.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"},onClick:()=>{this.setMode("new")},title:this.props.intl.formatMessage({id:"surveyModeNew",defaultMessage:l.surveyModeNew}),children:this.props.intl.formatMessage({id:"surveyModeNew",defaultMessage:l.surveyModeNew})})]})})}),(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center",children:(0,e.jsxs)("div",{className:"align-items-center d-flex",children:[(0,e.jsx)(a.Radio,{style:{cursor:"pointer"},onChange:()=>{this.setMode("edit")},checked:"edit"===this.props.config.mode,title:this.props.intl.formatMessage({id:"surveyModeEdit",defaultMessage:l.surveyModeEdit})}),(0,e.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"},onClick:()=>{this.setMode("edit")},title:this.props.intl.formatMessage({id:"surveyModeEdit",defaultMessage:l.surveyModeEdit}),children:this.props.intl.formatMessage({id:"surveyModeEdit",defaultMessage:l.surveyModeEdit})})]})})}),(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center",children:(0,e.jsxs)("div",{className:"align-items-center d-flex",children:[(0,e.jsx)(a.Radio,{style:{cursor:"pointer"},onChange:()=>{this.setMode("view")},checked:"view"===this.props.config.mode,title:this.props.intl.formatMessage({id:"surveyModeView",defaultMessage:l.surveyModeView})}),(0,e.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"},onClick:()=>{this.setMode("view")},title:this.props.intl.formatMessage({id:"surveyModeView",defaultMessage:l.surveyModeView}),children:this.props.intl.formatMessage({id:"surveyModeView",defaultMessage:l.surveyModeView})})]})})}),"new"===this.props.config.mode&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(r.SettingRow,{tag:"label",children:(0,e.jsxs)("div",{className:"section-title",children:[(0,e.jsx)("h6",{children:this.nls("sendDataToSurveyTitle")}),(0,e.jsx)(a.Switch,{"aria-describedby":this.props.config.activeLinkData?`survey_${this.props.id}_sendDataToSurveyDesc`:"",className:"can-x-switch",checked:this.props.config.activeLinkData,onChange:this.activeLinkDataChange})]})}),this.props.config.activeLinkData&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("span",{id:`survey_${this.props.id}_sendDataToSurveyDesc`,className:"w-100",children:this.nls("sendDataToSurveyDesc")})}),(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("span",{id:`survey_${this.props.id}_selectionChangeBehaviorTitle`,className:"w-100",children:this.nls("selectionChangeBehaviorTitle")})}),(0,e.jsx)(r.SettingRow,{className:"selection-behavior-item",children:(0,e.jsxs)("div",{className:"align-items-center d-flex",children:[(0,e.jsx)(a.Radio,{style:{cursor:"pointer"},onChange:()=>{this.selectionChangeBehavior("refresh")},checked:!this.props.config.selectionChangeBehavior||"refresh"===this.props.config.selectionChangeBehavior,title:this.nls("selectionChangeBehaviorTypeRefresh")}),(0,e.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"},onClick:()=>{this.selectionChangeBehavior("refresh")},title:this.nls("selectionChangeBehaviorTypeRefresh"),children:this.nls("selectionChangeBehaviorTypeRefresh")})]})}),(0,e.jsx)(r.SettingRow,{className:"selection-behavior-item",children:(0,e.jsxs)("div",{className:"align-items-center d-flex",children:[(0,e.jsx)(a.Radio,{style:{cursor:"pointer"},onChange:()=>{this.selectionChangeBehavior("preserve")},checked:"preserve"===this.props.config.selectionChangeBehavior,title:this.nls("selectionChangeBehaviorTypePreserve")}),(0,e.jsx)("label",{className:"m-0 ml-2",style:{cursor:"pointer"},onClick:()=>{this.selectionChangeBehavior("preserve")},title:this.nls("selectionChangeBehaviorTypePreserve"),children:this.nls("selectionChangeBehaviorTypePreserve")})]})}),(0,e.jsxs)(r.SettingRow,{className:"fea-layer-outter",children:[(0,e.jsx)(r.SettingRow,{className:"use-feature-layer-setting",children:(0,e.jsx)("span",{children:this.nls("sourceLayer")})}),(0,e.jsx)("div",{className:"feature-layer-dropdown",children:(0,e.jsx)(n.DataSourceSelector,{isMultiple:!1,hideDataView:!0,"aria-label":this.nls("sourceLayer"),"aria-describedby":"",mustUseDataSource:!0,closeDataSourceListOnChange:!0,hideTypeDropdown:!0,types:this.supportedLayerTypes,useDataSources:(null===(s=this.state)||void 0===s?void 0:s.layerViewInfoInNewMode)?(0,t.Immutable)([null===(i=this.state)||void 0===i?void 0:i.layerViewInfoInNewMode]):null,onChange:this.handleUseDataSourceChange,widgetId:null===(o=this.props)||void 0===o?void 0:o.id})})]}),(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("div",{role:"group","aria-owns":`survey_${this.props.id}_addNewMapping survey_${this.props.id}_addMappingBtn`,"aria-label":this.nls("addConnTitle"),children:(0,e.jsx)("span",{children:this.nls("addConnTitle")})})}),(null===(d=this.state)||void 0===d?void 0:d.layerViewInfoInNewMode)&&(null===(u=this.state)||void 0===u?void 0:u.layerViewInfoInNewMode.dataSourceId)?(0,e.jsxs)(t.React.Fragment,{children:[this.props.config.fieldQuestionMapping&&this.props.config.fieldQuestionMapping.length>0?(0,e.jsx)("div",{children:this.props.config.fieldQuestionMapping.asMutable().map((s,i)=>{const r=s.field,n=s.question;return(0,e.jsx)("div",{className:"mapping-container",children:this.state.editMapping&&this.state.editMapping.index===i?(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(a.Select,{value:this.state.editMapping.field||"",style:{marginBottom:"8px"},onChange:e=>{this.changeEditMapping("field",e)},children:this.state.dsFeatureLayerFields.map(t=>(0,e.jsx)("option",{value:t.name,children:t.alias||t.name},"edit_"+t.name+"_"+i))}),(0,e.jsx)(a.Select,{value:this.state.editMapping.question||"",onChange:e=>{this.changeEditMapping("question",e)},children:this.state.surveyQuestionFields.length>0&&this.state.surveyQuestionFields.map(t=>(0,e.jsx)("option",{value:t.name,children:t.label},"edit_"+t.name+"_"+i))}),(0,e.jsxs)("div",{className:"btn-group",children:[(0,e.jsx)(a.Button,{className:"float-left icon-remove-mapping",type:"primary",color:"primary",onClick:()=>{this.deleteConnection(i),this.setState({editMapping:null})},children:(0,e.jsx)(j,{className:"remove-mapping"})}),(0,e.jsx)(a.Button,{className:"float-right",type:"secondary",onClick:()=>{this.setState({editMapping:null})},children:this.nls("cancel")}),(0,e.jsx)(a.Button,{className:"float-right",type:"primary",color:"primary",onClick:()=>{this.editMapping(i),this.setState({editMapping:null})},children:this.nls("ok")})]})]}):(0,e.jsx)(t.React.Fragment,{children:(0,e.jsxs)("div",{className:"link-info",onClick:e=>{this.showEditMappingPanel(i,e)},children:[(0,e.jsx)("p",{children:this.getFielAlias(r)}),(0,e.jsx)("div",{className:"center-line",children:(0,e.jsx)("div",{className:"connect",children:(0,e.jsx)(f,{})})}),(0,e.jsx)("p",{children:this.getQuestionLabel(n)}),(0,e.jsx)("div",{className:"delete-connect",onClick:e=>{this.deleteConnection(i,e)},children:(0,e.jsx)(j,{size:"s"})})]})})},r+"_"+n+"_"+i)})}):"",this.state.addMapping&&this.state.dsFeatureLayer&&this.state.dsFeatureLayerFields&&this.state.dsFeatureLayerFields.length>0&&(0,e.jsxs)("div",{className:"mapping-container",id:`survey_${this.props.id}_addNewMapping`,children:[(0,e.jsxs)(a.Select,{"aria-label":this.nls("addConnSelectField"),value:this.state.addMapping.field||"null",style:{marginBottom:"8px"},onChange:e=>{this.addMapppingChange("field",e)},children:[(0,e.jsx)("option",{value:"null",children:this.nls("addConnSelectField")},"add_field_default"),this.state.dsFeatureLayerFields.map(t=>(0,e.jsx)("option",{value:t.name,children:t.alias||t.name},"add_"+t.name))]}),(0,e.jsxs)(a.Select,{"aria-label":this.nls("addConnSelectQuestion"),value:this.state.addMapping.question||"null",onChange:e=>{this.addMapppingChange("question",e)},children:[(0,e.jsx)("option",{value:"null",children:this.nls("addConnSelectQuestion")},"add_question_default"),this.state.surveyQuestionFields.length>0&&this.state.surveyQuestionFields.map(t=>(0,e.jsx)("option",{value:t.name,children:t.label},"add_"+t.name))]}),(0,e.jsxs)("div",{className:"btn-group",children:[(0,e.jsx)(a.Button,{className:"float-right",type:"secondary",onClick:this.deactiveAddFieldQuestionConnPanel,children:this.nls("cancel")}),(0,e.jsx)(a.Button,{className:"float-right",type:"primary",disabled:!this.state.addMapping.field||"null"===this.state.addMapping.field||!this.state.addMapping.question||"null"===this.state.addMapping.question,onClick:this.addFieldQuestionConn,children:this.nls("ok")})]})]})]}):"",(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)(a.Button,{className:"w-100",type:"primary",id:`survey_${this.props.id}_addMappingBtn`,disabled:null!==this.state.addMapping||null!==this.state.editMapping||!((null===(h=this.state)||void 0===h?void 0:h.layerViewInfoInNewMode)&&(null===(p=this.state)||void 0===p?void 0:p.layerViewInfoInNewMode.dataSourceId)),onClick:this.activeAddFieldQuestionConnPanel,children:this.nls("addConnBtn")})})]})]}),"edit"===this.props.config.mode&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(r.SettingRow,{className:"section-title",children:(0,e.jsx)("div",{role:"group","aria-describedby":`survey_${this.props.id}_chooseExistDataEditDesc`,"aria-label":this.nls("chooseExistDataTitle"),"aria-owns":`survey_${this.props.id}_selectSurveyLayerForEditMode`,children:(0,e.jsx)("h6",{children:this.nls("chooseExistDataTitle")})})}),(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("span",{id:`survey_${this.props.id}_chooseExistDataEditDesc`,className:"w-100",children:this.nls("chooseExistDataEditDesc")})}),(0,e.jsx)(r.SettingRow,{className:"fea-layer-outter",children:(0,e.jsxs)("div",{id:`survey_${this.props.id}_selectSurveyLayerForEditMode`,children:[(0,e.jsx)(r.SettingRow,{className:"use-feature-layer-setting",children:(0,e.jsx)("span",{title:this.nls("selectSurveyLayerTip"),children:this.nls("sourceLayer")})}),(0,e.jsx)("div",{className:"feature-layer-dropdown",title:this.nls("selectSurveyLayerTip"),children:(0,e.jsx)(n.DataSourceSelector,{isMultiple:!1,hideDataView:!0,"aria-label":this.nls("sourceLayer"),"aria-describedby":"",mustUseDataSource:!0,closeDataSourceListOnChange:!0,hideTypeDropdown:!0,types:this.supportedLayerTypes,useDataSources:(null===(g=this.state)||void 0===g?void 0:g.layerViewInfoInEditMode)?(0,t.Immutable)([null===(v=this.state)||void 0===v?void 0:v.layerViewInfoInEditMode]):null,onChange:this.handleUseDataSourceChange,widgetId:null===(m=this.props)||void 0===m?void 0:m.id})})]})})]}),"view"===this.props.config.mode&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("div",{role:"group",className:"section-title","aria-describedby":`survey_${this.props.id}_chooseExistDataViewDesc`,"aria-label":this.nls("chooseExistDataTitle"),"aria-owns":`survey_${this.props.id}_selectMapForVIewMode`,children:(0,e.jsx)("h6",{children:this.nls("chooseExistDataTitle")})})}),(0,e.jsx)(r.SettingRow,{children:(0,e.jsx)("span",{id:`survey_${this.props.id}_chooseExistDataViewDesc`,className:"w-100",children:this.nls("chooseExistDataViewDesc")})}),(0,e.jsx)(r.SettingRow,{className:"fea-layer-outter",children:(0,e.jsxs)("div",{id:`survey_${this.props.id}_selectMapForVIewMode`,children:[(0,e.jsx)(r.SettingRow,{className:"use-feature-layer-setting",children:(0,e.jsx)("span",{title:this.nls("selectSurveyLayerTip"),children:this.nls("sourceLayer")})}),(0,e.jsx)("div",{className:"feature-layer-dropdown",title:this.nls("selectSurveyLayerTip"),children:(0,e.jsx)(n.DataSourceSelector,{isMultiple:!1,hideDataView:!0,"aria-label":this.nls("sourceLayer"),"aria-describedby":"",mustUseDataSource:!0,closeDataSourceListOnChange:!0,hideTypeDropdown:!0,types:this.supportedLayerTypes,useDataSources:(null===(S=this.state)||void 0===S?void 0:S.layerViewInfoInViewMode)?(0,t.Immutable)([null===(w=this.state)||void 0===w?void 0:w.layerViewInfoInViewMode]):null,onChange:this.handleUseDataSourceChange,widgetId:null===(x=this.props)||void 0===x?void 0:x.id})})]})})]})]})]}),(0,e.jsx)("div",{className:"survey123__section",role:"group","aria-label":this.nls("resetSurveyLabel"),style:-1!==this.state.mode.indexOf("confirmResetSurvey")?{display:"block"}:{display:"none"},children:(0,e.jsxs)(r.SettingSection,{title:this.nls("resetSurveyLabel"),children:[(0,e.jsx)(r.SettingRow,{children:this.props.intl.formatMessage({id:"resetSurveyTip",defaultMessage:l.resetSurveyTip})}),this.props.intl.formatMessage({id:"confirmResetSurveyTip",defaultMessage:l.confirmResetSurveyTip}),(0,e.jsxs)(r.SettingRow,{children:[(0,e.jsx)(a.Button,{"aria-description":this.props.intl.formatMessage({id:"resetSurveyTip",defaultMessage:l.resetSurveyTip}),type:"primary",onClick:()=>{this.resetSurvey()},children:this.nls("yes")}),(0,e.jsx)(a.Button,{onClick:()=>{this.showSettingPage()},children:this.nls("no")})]})]})}),(0,e.jsxs)(a.Modal,{isOpen:this.state.modalIsOpen,className:"w-100 h-100 p-0 m-0 survey123__desinger_modal",css:c(this.props.theme),children:[(0,e.jsxs)("div",{className:"survey123__desinger",children:[(0,e.jsx)("p",{children:this.props.intl.formatMessage({id:"editSurveyBtn",defaultMessage:l.editSurveyBtn})}),(0,e.jsx)("button",{color:"primary",onClick:this.handleCloseModal,children:(0,e.jsx)(y,{size:24})})]}),(0,e.jsx)("iframe",{id:"survey123-designer",title:this.nls("editSurveyBtn"),width:"100%"}),(0,e.jsx)(a.AlertPopup,{isOpen:this.state.isShowCloseDesignerAlert,okLabel:this.nls("ok"),title:this.props.label,toggle:this.handleCloseDesignerAlert,children:(0,e.jsx)("div",{style:{fontSize:"1rem"},children:this.nls("msgUnsavedBeforeLeaving")})})]})]})}}function I(e){d.p=e}})(),u})())}}});