System.register(["jimu-core/emotion","jimu-core","jimu-ui/basic/runtime-components","jimu-ui","jimu-arcgis","jimu-theme"],function(e,t){var n={},o={},r={},l={},i={},s={};return{setters:[function(e){n.jsx=e.jsx,n.jsxs=e.jsxs},function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JSAPILayerTypes=e.JSAPILayerTypes,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.PageVisibilityContext=e.PageVisibilityContext,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UrlManager=e.UrlManager,o.UtilityManager=e.UtilityManager,o.ViewVisibilityContext=e.ViewVisibilityContext,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.i18n=e.i18n,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.moduleLoader=e.moduleLoader,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){r.getDsJsonOfOriginDs=e.getDsJsonOfOriginDs,r.getMultipleDefaultGeocodeConfigInRuntime=e.getMultipleDefaultGeocodeConfigInRuntime,r.getNewDataSourceConfig=e.getNewDataSourceConfig,r.getOutputDsJson=e.getOutputDsJson,r.getZoomScaleOfUseUtility=e.getZoomScaleOfUseUtility},function(e){l.Alert=e.Alert,l.Button=e.Button,l.Checkbox=e.Checkbox,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Link=e.Link,l.Loading=e.Loading,l.LoadingType=e.LoadingType,l.Paper=e.Paper,l.Popper=e.Popper,l.TextInput=e.TextInput,l.defaultMessages=e.defaultMessages,l.hooks=e.hooks},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){s.useTheme=e.useTheme}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=s},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=l},21210:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A46 46 0 0 1 8 14.492a48 48 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133m1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.751C5.768 13.444 2 8.817 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133M10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0m1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=i},67386:e=>{"use strict";e.exports=n},76002:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=o},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var u={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(u),a.d(u,{__set_webpack_public_path__:()=>_t,default:()=>zt});var e=a(67386),t=a(79244),n=a(76002);const o=[0,3],r={wkid:4326};var l,i,s,c,d,v;!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(l||(l={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(i||(i={})),function(e){e.Style1="Style1",e.Style2="Style2",e.Style3="Style3"}(s||(s={})),function(e){e.Classic="Classic",e.Compact="Compact"}(c||(c={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(d||(d={})),function(e){e.CustomSearchSources="CustomSearchSources",e.MapCentric="MapCentric"}(v||(v={}));var g=a(14321);const h={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistory:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var p=a(30655),m=a.n(p),f=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};const S=n=>{const o=window.SVG,{className:r}=n,l=f(n,["className"]),i=(0,t.classNames)("jimu-icon jimu-icon-component",r);return o?(0,e.jsx)(o,Object.assign({className:i,src:m()},l)):(0,e.jsx)("svg",Object.assign({className:i},l))};var y=a(94064),b=a.n(y),I=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};const x=n=>{const o=window.SVG,{className:r}=n,l=I(n,["className"]),i=(0,t.classNames)("jimu-icon jimu-icon-component",r);return o?(0,e.jsx)(o,Object.assign({className:i,src:b()},l)):(0,e.jsx)("svg",Object.assign({className:i},l))};var w=a(62686);const j="address";var C=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function i(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}a((o=o.apply(e,t||[])).next())})};const M=e=>C(void 0,void 0,void 0,function*(){const t=R(e),n={shouldConvertSR:!1,searchText:e};if(!t)return Promise.resolve(n);const o=yield D(e),r=yield function(e){return C(this,void 0,void 0,function*(){return(0,w.loadArcGISJSAPIModules)(["esri/geometry/coordinateFormatter","esri/geometry/SpatialReference"]).then(t=>{const[n,o]=t;if(n.load(),n.isSupported()){if(n.isLoaded()){const t=n.fromUtm(e,new o({wkid:4326}),"latitude-band-indicators");return t&&(null==t?void 0:t.x)&&(null==t?void 0:t.y)?Promise.resolve(!0):Promise.resolve(!1)}return Promise.resolve(!1)}return Promise.resolve(!0)})})}(e);return o?function(e){return C(this,void 0,void 0,function*(){let t=e;return(0,w.loadArcGISJSAPIModules)(["esri/geometry/SpatialReference","esri/rest/support/ProjectParameters","esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]).then(n=>{const[o,r,l,i]=n,s=new o({wkid:4326});if(s&&e){if(s.equals(e.spatialReference))return Promise.resolve(t);if(s.isWebMercator&&e.spatialReference.equals(s))return t=l.geographicToWebMercator(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);if(s.equals(s)&&e.spatialReference.isWebMercator)return t=l.webMercatorToGeographic(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);{const n=L();if(n){const o=new r;return o.geometries=[e],o.outSpatialReference=s,o.f="json",i.project(n,o).then(n=>(t=n&&n.length>0&&n[0],t?(t.isSinglePoint=e.isSinglePoint,Promise.resolve(t)):Promise.resolve(t)),e=>Promise.reject(new Error(e)))}return Promise.resolve(t)}}return Promise.resolve(null)})})}(o).then(t=>{const n=T(t);return Promise.resolve({shouldConvertSR:!!n,searchText:n||e,locationPoint:t})},e=>Promise.resolve(n)):r?function(e){return C(this,void 0,void 0,function*(){const t=L();return(0,w.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/request"]).then(n=>{const[o,r,l]=n;let i=null;const s={query:{sr:4326,conversionType:"UTM",conversionMode:"utmDefault",strings:[e],f:"json"},responseType:"json"};if(!t)return Promise.resolve(i);l(`${t}/fromGeoCoordinateString`,s).then(e=>{const t=Number(e[0][0]),n=Number(e[0][1]);return isNaN(t)||isNaN(n)||(i=new o(t,n,new r({wkid:4326}))),Promise.resolve(i)})})})}(e).then(t=>{const n=T(t);return Promise.resolve({shouldConvertSR:!!n,searchText:n||e,locationPoint:t})}):Promise.resolve(n)});function R(e){return e&&P(e)}const D=e=>C(void 0,void 0,void 0,function*(){return(0,w.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then(n=>{const[o,r]=n;return t.moduleLoader.loadModule("jimu-core/wkid").then(t=>{const{isValidWkid:n}=t;let l=null;if(!e)return l;const i=e.split(":"),s=i[0],a=Number(i[1]);if(a&&n(a)&&s){const e=s.split(","),t=Number(e[0]),n=Number(e[1]);isNaN(t)||isNaN(n)||(l=new o(t,n,new r({wkid:a})))}return Promise.resolve(l)})})});function T(e){let t=null;return!e||isNaN(e.x)||isNaN(e.y)||(t="Y:"+e.y+",X:"+e.x),t}function L(){var e,n;const o=(0,t.getAppStore)().getState();return(null===(n=((null===(e=null==o?void 0:o.portalSelf)||void 0===e?void 0:e.helperServices)||{}).geometry)||void 0===n?void 0:n.url)||null}const P=e=>null==e?void 0:e.includes(",");var N=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function i(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}a((o=o.apply(e,t||[])).next())})};const k={alias:"ADDRESS",type:"string",name:j},O=(Object.assign(Object.assign({},k),{jimuName:j}),(e,t,n,o)=>ce(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?E(t,e,n,o):Promise.resolve({})),E=(e,t,n,o)=>{var l;const i={geocodeURL:null==e?void 0:e.geocodeURL,address:t,maxSuggestion:null==e?void 0:e.maxSuggestions,utilityId:null===(l=null==e?void 0:e.useUtility)||void 0===l?void 0:l.utilityId,countryCode:null==e?void 0:e.countryCode,extent:n,enableLocalSearch:null==e?void 0:e.enableLocalSearch,minScale:null==e?void 0:e.minScale,jimuMapView:o,spatialReference:(null==e?void 0:e.spatialReference)||r};return V(i).then(n=>{if(!Array.isArray(n))return Promise.resolve({suggestionItem:[],layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon,err:n});let o=[];n.forEach((n,r)=>{const l=n.text;if(l&&!function(e,t){return e.filter(e=>t===(null==e?void 0:e.suggestion)).length>0}(o,l)){const r={suggestionHtml:ae(l,t),suggestion:l,configId:null==e?void 0:e.configId,magicKey:null==n?void 0:n.magicKey};o.push(r)}}),o=oe(o,"suggestion");const r={suggestionItem:o.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(r)}).catch(e=>Promise.reject(new Error(e)))},F=e=>{const{address:n,maxResultNumber:o,geocodeItem:r,searchResultView:l,extent:i,jimuMapView:s,id:a}=e;if(!ce(null==r?void 0:r.outputDataSourceId))return;return ue(ne(r.outputDataSourceId),t.DataSourceStatus.NotReady),A({address:n,maxResultNumber:o,searchResultView:l,geocodeItem:r,extent:i,jimuMapView:s,id:a})},A=e=>{const{address:n,maxResultNumber:o,geocodeItem:r,extent:l,jimuMapView:i,id:s}=e,{outputDataSourceId:a,singleLineFieldName:u,defaultAddressFieldName:c,enableLocalSearch:d}=r,v=ne(a),g={geocodeItem:r,address:n,maxResultNumber:o,singleLineFieldName:u,addressFields:(null==r?void 0:r.addressFields)||[],countryCode:null==r?void 0:r.countryCode,extent:l,enableLocalSearch:d,jimuMapView:i};return U(g).then(e=>N(void 0,void 0,void 0,function*(){if(!Array.isArray(e))return Promise.resolve(!1);const o=null==e?void 0:e.filter(e=>null==e?void 0:e.address),{extent:l,graphics:i}=function(e,t){let n;const o=(null==e?void 0:e.map((e,o)=>{var r,l;const i=e.attributes;i.address=e.address,t&&(i[t]=e.address),i.objectid=o;const s=n?null==n?void 0:n.clone():n;n=s?null==s?void 0:s.union(null===(r=e.extent)||void 0===r?void 0:r.clone()):null===(l=e.extent)||void 0===l?void 0:l.clone();return{attributes:i,geometry:e.location}}))||[];return{graphics:o,extent:n}}(o,c),u=v,d=(null==r?void 0:r.label)||u.getLabel(),g=function(e,t){var n;if(!e||0===(null==e?void 0:e.length))return;const o={content:[{type:"fields",fieldInfos:e.map(e=>({fieldName:e.name,isEditable:!1,label:e.name,visible:!0}))},{type:"attachments",displayType:"auto"}],title:`${t}: {${null===(n=e[0])||void 0===n?void 0:n.name}}`};return o}(null==r?void 0:r.displayFields,d),h={id:`${a}_layer`,geometryType:"point",fullExtent:l};g&&(h.popupTemplate=g),yield u.setSourceFeatures(i,h);const p=n?t.DataSourceStatus.Unloaded:t.DataSourceStatus.NotReady;ue(v,p);const m={where:"2=2",sqlExpression:null,pageSize:null==o?void 0:o.length,outFields:["*"],page:1,returnGeometry:!0};return u.load(m,{widgetId:s}).then(e=>{const n=u.getRecords();return n.forEach((e,t)=>{n[t].__extent=o[t].extent}),Promise.resolve(t.DataSourceStatus.Unloaded)})})).catch(e=>Promise.reject(new Error(e)))};const U=e=>N(void 0,void 0,void 0,function*(){const{geocodeItem:n,address:o,maxResultNumber:l,singleLineFieldName:i,addressFields:s,countryCode:a,extent:u,jimuMapView:c}=e,{geocodeURL:d,magicKey:v,useUtility:g,enableLocalSearch:h,minScale:p}=n,m=(null==n?void 0:n.spatialReference)||r,f=R(o);let S;return f&&(S=yield M(o)),(0,w.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then(e=>{var n,r;const[y,b]=e,I=(null===(n=null==c?void 0:c.view)||void 0===n?void 0:n.spatialReference)||new b(m),x=i||"SingleLine";let w=(0,t.Immutable)({maxSuggestions:l});(null===(r=null==s?void 0:s.map(e=>null==e?void 0:e.jimuName))||void 0===r?void 0:r.join(","))&&(w=w.set("outFields","*"));const j=f&&S.searchText?S.searchText:o;w=w.setIn([x],j),v&&(w=w.set("magicKey",v));const C={address:null==w?void 0:w.asMutable({deep:!0}),outSpatialReference:I};if(f&&S.locationPoint)C.location=S.locationPoint;else if(h){const e=J(h,p,c);e&&(C.location=e)}return a&&(C.countryCode=a),u&&(C.searchExtent=u.toJSON()),y.addressToLocations(d,C,{query:{}}).then(e=>(e=(e=e.sort((e,t)=>t.score-e.score)).filter(e=>!!(null==e?void 0:e.location)),G(null==g?void 0:g.utilityId),e),e=>{console.error(e.message);const t=z(null==g?void 0:g.utilityId,e);return $(null==g?void 0:g.utilityId,e),t?e:[]})})}),V=e=>{const{geocodeURL:t,address:n,maxSuggestion:o,utilityId:r,countryCode:l,extent:i,enableLocalSearch:s,jimuMapView:a,minScale:u,spatialReference:c}=e;return(0,w.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then(e=>{var d;const[v,g]=e,h={text:n,maxSuggestions:o,outSpatialReference:(null===(d=null==a?void 0:a.view)||void 0===d?void 0:d.spatialReference)||new g(c)};l&&(h.countryCode=l),i&&(h.searchExtent=i.toJSON());const p=J(s,u,a);return p&&(h.location=p),v.suggestLocations(t,h).then(e=>(G(r),e||[]),e=>{console.error(e.message);const t=z(r,e);return $(r,e),t?e:[]})})};function J(e,t,n){var o,r;if(!e||!n||!t)return;let l;const i=null===(o=n.view)||void 0===o?void 0:o.scale,s=null===(r=n.view)||void 0===r?void 0:r.center;return i<t&&s&&(l=s),l}function G(e){e&&t.UtilityManager.getInstance().reportUtilityState(e,!0)}function $(e,n){if(!e)return;const o=z(e,n),r=t.UtilityManager.getInstance().utilityHasSignInError(e);o?t.UtilityManager.getInstance().reportUtilityState(e,!1,r):t.UtilityManager.getInstance().reportUtilityState(e,!1)}function z(e,n){var o,r,l,i;const s=t.UtilityManager.getInstance().utilityHasSignInError(e);let a=404===(null===(o=null==n?void 0:n.details)||void 0===o?void 0:o.httpStatus);return 400===(null===(r=null==n?void 0:n.details)||void 0===r?void 0:r.httpStatus)&&(null===(i=null===(l=null==n?void 0:n.details)||void 0===l?void 0:l.message)||void 0===i?void 0:i.includes("Item does not exist"))&&(a=!0),s||a}const _=(e,t,n,o=!1)=>{const r=null==e?void 0:e.outputDataSourceId,l=ne(null==e?void 0:e.outputDataSourceId),i=null==l?void 0:l.getRecordsByPage(1,t);return Promise.resolve({records:i,configId:e.configId,dsId:r,isGeocodeRecords:!0,displayFields:null==e?void 0:e.displayFields,zoomScale:null==e?void 0:e.zoomScale})},K=(e,...t)=>N(void 0,[e,...t],void 0,function*(e,t=r){const n=e&&e.coords;return n?(0,w.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then(e=>{const[o,r]=e,l=new r(t);return new o({longitude:n.longitude,latitude:n.latitude,z:n.altitude||null,spatialReference:l})}):Promise.resolve(null)});var W=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function i(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}a((o=o.apply(e,t||[])).next())})};function B(e,n,o,r,l){return W(this,void 0,void 0,function*(){var i,s;if(!ce(null===(i=null==o?void 0:o.useDataSource)||void 0===i?void 0:i.dataSourceId))return Promise.resolve({});const a=(null==o?void 0:o.searchFields)||[],u=null===(s=null==r?void 0:r.filter(e=>(null==e?void 0:e.configId)===o.configId))||void 0===s?void 0:s[0];return function(e,n,o,r,l,i){return W(this,void 0,void 0,function*(){var s;const{label:a,icon:u,configId:c}=o,d=null===(s=null==n?void 0:n.useDataSource)||void 0===s?void 0:s.dataSourceId,v=ne(d),g={searchText:e,searchFields:r.map(e=>e.name),dataSource:v,maxSuggestions:l,extent:i};return t.dataSourceUtils.querySuggestions(g).then(e=>{const t={suggestionItem:null==e?void 0:e.map(e=>Object.assign(Object.assign({},e),{configId:c,isFromSuggestion:!0})),layer:a,icon:u};return Promise.resolve(t)}).catch(e=>Promise.resolve({suggestionItem:[],layer:null,icon:null}))})}(e,o,u,a,null==n?void 0:n.maxSuggestions,l)})}function q(e,n,o,r){const l=n.map(e=>e.jimuName);return t.dataSourceUtils.getSQL(e,l,o,r)}function H(e,t,n){const o=(null==e?void 0:e.map(e=>e.jimuName))||[],r=(null==t?void 0:t.map(e=>e.jimuName))||[],l=ne(n),i=(null==l?void 0:l.getAllUsedFields())||[];return"*"===i?"*":Array.from(new Set(o.concat(r).concat(i)))}const Q=(e,n,o,r=!1)=>{var l;const i=null===(l=null==e?void 0:e.useDataSource)||void 0===l?void 0:l.dataSourceId,s=de(e.configId,o);if(!ce(i,s))return Promise.resolve({});const a=ne(i,s),u=t.DataSourceManager.getInstance(),c=s?u.getLocalDataSourceId(i,s):null,d=(null==a?void 0:a.getRecordsByPage)&&(null==a?void 0:a.getRecordsByPage(1,n));return Promise.resolve({records:d,configId:e.configId,dsId:i,localDsId:c,layerDsIdActuallyUsed:c,isGeocodeRecords:!1})};var Z=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function i(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}a((o=o.apply(e,t||[])).next())})};const X=(e,t,n)=>{var o;let r;return e===v.MapCentric&&t&&n&&(r=null===(o=n.view)||void 0===o?void 0:o.extent),r},Y=(e,t,n,o)=>{var r;const l=null===(r=null==e?void 0:e.useDataSource)||void 0===r?void 0:r.dataSourceId,i=de(n,t),s=ne(l),a=i&&ne(l,i);if(o&&s)s&&s.updateQueryParams({},t);else if(!o){if(!a||!(null==a?void 0:a.updateQueryParams))return;a&&a.updateQueryParams({},i)}},ee=(e,t,n,o=!1,r=!1)=>{const i=[];for(const s in e){const a=e[s];let u;u=a.searchServiceType===l.FeatureService?Q(a,t,n,o):_(a,t,0,r),i.push(u)}return Promise.all(i)};function te(e){var n,o;const{serviceList:r,searchText:i,id:s}=e,a={};for(const e in r){const t=r[e],{searchServiceType:i,useDataSource:s}=t;if(i===l.FeatureService&&(null==s?void 0:s.dataSourceId)){const e=null==s?void 0:s.dataSourceId;let r=(null===(n=null==a?void 0:a[e])||void 0===n?void 0:n.sqlExpression)||null,l=(null===(o=a[e])||void 0===o?void 0:o.outFields)||[];const i=H(t.searchFields,t.displayFields,e)||[];a[e]?((null==t?void 0:t.SQL)&&r.push(null==t?void 0:t.SQL),l=Array.from(new Set(l.concat(i)))):(r=(null==t?void 0:t.SQL)?[null==t?void 0:t.SQL]:null,l=i,a[e]={}),a[e].sqlExpression=r,a[e].outFields=l}}!function(e,n,o){var r,l;for(const i in null==e?void 0:e.asMutable({deep:!0})){const s=null===(r=null==e?void 0:e[i])||void 0===r?void 0:r.sqlExpression,a=null===(l=null==e?void 0:e[i])||void 0===l?void 0:l.outFields,u=ne(i);let c,d;o?s?(d=t.dataSourceUtils.getMergedSQLExpressions(null==s?void 0:s.asMutable({deep:!0}),u,t.ClauseLogic.Or),c=d.sql):(c="1=0",d=null):(c="1=1",d=null);const v=(0,t.Immutable)({outFields:a,where:c,sqlExpression:d,returnGeometry:!0});u&&u.updateQueryParams(v,n)}}((0,t.Immutable)(a),s,i)}const ne=(e,n)=>{if(!e)return null;if(n){const o=t.DataSourceManager.getInstance(),r=o.getLocalDataSourceId(e,n);return o.getDataSource(r)}return t.DataSourceManager.getInstance().getDataSource(e)},oe=(e,t)=>{const n=e[0]?[e[0]]:[];for(let o=1;o<e.length;o++){const r=e[o];let l=!1;for(let e=0;e<n.length;e++)if(r[t]===n[e][t]){l=!0;break}l||n.push(r)}return n},re=e=>{const n=t.urlUtils.getAppIdPageIdFromUrl().appId,o=le(n,e);let r=t.utils.readLocalStorage(o);r&&(r=unescape(r));return r?null==r?void 0:r.split("/@/"):[]},le=(e,t)=>`exb-${e}-${t}_recent_searches`,ie=(e,t)=>{var n;return null===(n=null==e?void 0:e.filter(e=>e.configId===t))||void 0===n?void 0:n[0]},se=e=>{let t=0;for(const n in e)t++;return t};function ae(e,n){if(!n)return e;const o=t.dataSourceUtils.getRegOfSearchText(n);return e.match(o)?e.replace(o,"<strong >$1</strong>"):e}function ue(e,t){null==e||e.setStatus(t),null==e||e.setCountStatus(t)}function ce(e,t){return!!e&&!!ne(e,t)}const de=(e,t)=>`${t}_${e}_useDataSource`;const ve=(e,n)=>{var o;let r=!0;for(const i in e){const s=e[i];let a;if(s.searchServiceType===l.FeatureService){const e=null===(o=null==s?void 0:s.useDataSource)||void 0===o?void 0:o.dataSourceId,t=de(s.configId,n);a=ne(e,t)}else{const e=null==s?void 0:s.outputDataSourceId;a=ne(e)}const u=null==a?void 0:a.getStatus();u!==t.DataSourceStatus.Loading&&u!==t.DataSourceStatus.Unloaded||(r=!1)}return r},ge=(e,n)=>{let o=!0;for(const r in e){const e=null==n?void 0:n[r];e!==t.DataSourceStatus.Loading&&e!==t.DataSourceStatus.Unloaded||(o=!1)}return o},he=e=>{var n,o;if(!e)return;const r=null===(o=null===(n=(0,t.getAppStore)().getState().asMutable({deep:!0}))||void 0===n?void 0:n.urlHashObject)||void 0===o?void 0:o[e];let l={};return l=(null==r?void 0:r.search_status)?pe(JSON.parse(r.search_status)):pe(r),(null==l?void 0:l.serviceEnabledList)&&(l.enabledList=l.serviceEnabledList),(null==l?void 0:l.searchText)&&(l.text=l.searchText),l};function pe(e){if(!e)return{};if("string"==typeof e)return{text:e};return Object.keys(e).reduce((t,n)=>{let o;return"text"===n||"searchText"===n?(o=e[n],t[n]=o):"enabledList"===n||"status"===n?(o="object"==typeof e[n]?e[n]:JSON.parse(e[n]),t[n]=o):delete t[n],t},{})}const me=(e,t)=>{e&&fe(e,t)};function fe(e,n){if(!e)return;let o=null;if(n)if(t.UrlManager.getInstance().setWidgetUrlParams(e,null),n=Object.keys(n).reduce((e,t)=>{if(void 0!==n[t]&&null!==n[t]&&""!==n[t]){const o="object"==typeof n[t]?JSON.stringify(n[t]):n[t];"searchText"===t?e.text=o:"serviceEnabledList"===t?e.enabledList=o:e[t]=o}return e},{}),1===Object.keys(n).length&&n.text)o=Object.assign(Object.assign({},n),{search_status:null});else{o={search_status:n?JSON.stringify(n):null,status:null,enabledList:null,text:null,serviceEnabledList:null,searchText:null}}t.UrlManager.getInstance().setWidgetUrlParams(e,o)}function Se(e,o){return Z(this,void 0,void 0,function*(){return function(e){return Z(this,void 0,void 0,function*(){if(!e||0===e.length)return Promise.resolve([]);const n=e.map(e=>({id:e.dataSourceJson.id,dataSourceJson:(0,t.Immutable)(e.dataSourceJson)}));return yield Promise.allSettled(n.filter(e=>e.layer).map(e=>Z(this,void 0,void 0,function*(){var t;const n=null===(t=e.layer.sourceJSON)||void 0===t?void 0:t.capabilities;n&&(yield e.layer.load(),e.layer.sourceJSON.capabilities=n)}))),Promise.allSettled(n.map(e=>t.DataSourceManager.getInstance().createDataSource(e).then(e=>e.isDataSourceSet()&&!e.areChildDataSourcesCreated()?e.childDataSourcesReady().then(()=>e):e))).then(e=>e.filter(e=>"fulfilled"===e.status).map(e=>e.value)).then(t=>t.length<e.length?Promise.reject(new Error("Failed to create some data source.")):t)})}(null==(e=null==e?void 0:e.filter(e=>{const t=null==e?void 0:e.outputDataSourceId;return!ne(t)}))?void 0:e.map((e,t)=>({dataSourceJson:(0,n.getOutputDsJson)(e,!0),order:t})))})}const{useRef:ye,useState:be,useEffect:Ie}=t.React,xe=t.css`
& {
  box-sizing: border-box;
  width: 32px;
}
.setting-dropdown-button {
  height: 32px;
  border-radius: 0;
  .dropdown-button-content {
    text-align: center;
  }
  svg {
    margin: 0 !important;
  }
}
&.ds-setting-Style1 {
  .setting-dropdown-button {
    border-radius: var(--sys-shape-2) 0 0 var(--sys-shape-2);
  }
}
&.ds-setting-Style2 {
  & {
    margin-right: ${t.polished.rem(4)};
  }
  .setting-dropdown-button {
    border-radius: 50%;
  }
}
&.ds-setting-Style3 {
  .setting-dropdown-button {
    background: none;
    border: none;
    color: inherit !important;
  }
}
`,we=t.css`
  & {
    overflow: hidden
  }
`,je=n=>{const o=t.hooks.useTranslation(h,g.defaultMessages),[r,i]=be(!0),[s,a]=be(!1),[u,c]=t.React.useState(!1),{className:d,datasourceConfig:p,dsStatus:m,config:f,id:y,useDataSources:b,synchronizeSettings:I,showLoading:w,onDatasourceConfigChange:j}=n,C=ye(null),M=ye(null),R=ye(null),D=ye(null),T=e=>{const t=[];null==e||e.forEach(e=>{e.enable&&t.push(e.configId)});const n=t.length===(null==e?void 0:e.length)?null:{enabledList:t};clearTimeout(D.current),D.current=setTimeout(()=>{me(y,n)},200)};Ie(()=>{const e=null==p?void 0:p.filter(e=>!(null==e?void 0:e.enable)),t=0===(null==e?void 0:e.length),n=(null==e?void 0:e.length)>0&&(null==e?void 0:e.length)<(null==p?void 0:p.length);a(n),i(t)},[p]);return(0,e.jsxs)("div",{className:`${d||""} ds-setting-${f.arrangementStyle}`,onKeyDown:e=>{"Escape"===e.key&&(c(!1),(0,t.focusElementInKeyboardMode)(M.current))},css:xe,role:"group","aria-label":o("searchIn",{value:""}),children:[w&&(0,e.jsx)(g.Button,{icon:!0,className:"setting-dropdown-button",children:(0,e.jsx)(g.Loading,{width:14,height:14,type:g.LoadingType.Donut})}),!w&&(0,e.jsxs)(g.Dropdown,{className:"w-100 h-100",menuItemCheckMode:"multiCheck",toggle:e=>{u||setTimeout(()=>{(0,t.focusElementInKeyboardMode)(R.current,!0)},200),c(!u)},isOpen:u,children:[(0,e.jsxs)(g.DropdownButton,{ref:M,className:"setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""}),children:[!u&&(0,e.jsx)(S,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),u&&(0,e.jsx)(x,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})]}),(0,e.jsx)(g.DropdownMenu,{css:we,trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"},children:(0,e.jsxs)("div",{ref:C,children:[(0,e.jsxs)(g.DropdownItem,{toggle:!1,onClick:()=>{const e=!r,t=null==p?void 0:p.map(t=>{var n;return null===(n=t.setIn(["enable"],e))||void 0===n?void 0:n.asMutable({deep:!0})});T(t),j(t)},title:o("all"),ref:R,children:[(0,e.jsx)(g.Checkbox,{checked:r&&!s,indeterminate:s,className:"mr-2"}),o("all")]}),(0,e.jsx)(g.DropdownItem,{divider:!0}),null==p?void 0:p.map((n,r)=>{var i;const s=m[n.configId]===t.DataSourceStatus.LoadError||m[n.configId]===t.DataSourceStatus.CreateError,a=n.searchServiceType===l.GeocodeService,u=((e,n=!1)=>{var o;let r;if(!1!==I&&(null==f?void 0:f.sourceType)===v.MapCentric)return!0;if(n){const n=(0,t.getAppStore)().getState().appConfig,l=null===(o=null==n?void 0:n.widgets)||void 0===o?void 0:o[y],i=(null==l?void 0:l.outputDataSources)||[];r=(null==i?void 0:i.filter(t=>e===t).length)>0}else r=(null==b?void 0:b.filter(t=>e===t.dataSourceId).length)>0;return r&&e})(a?n.outputDataSourceId:n.useDataSource.dataSourceId,a),c=1===(null===(i=null==p?void 0:p.filter(e=>null==e?void 0:e.enable))||void 0===i?void 0:i.length)&&(null==n?void 0:n.enable)&&s;return(0,e.jsx)(g.DropdownItem,{toggle:!1,title:null==n?void 0:n.label,disabled:c,onClick:()=>{((e,t)=>{const n=null==p?void 0:p.setIn([t,"enable"],e);T(n),j(n)})(!(null==n?void 0:n.enable),r)},children:(0,e.jsxs)("div",{className:"d-flex w-100 h-100 align-items-center",children:[(0,e.jsxs)("div",{className:"flex-grow-1 d-flex align-items-center",children:[(0,e.jsx)(g.Checkbox,{checked:null==n?void 0:n.enable,disabled:c,className:"mr-2"}),(0,e.jsx)("div",{className:"flex-grow-1",children:null==n?void 0:n.label})]}),(s||!u)&&(0,e.jsx)(g.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})]})},`${null==n?void 0:n.label}${r}`)})]})})]})]})},Ce=(e,n,o)=>t.css`
    & {
      padding-top: 0;
      padding-bottom: 0;
      box-sizing: border-box;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: 32px;
      border-radius: 0;
      padding: ${e.sys.spacing(1,4)};
      background: transparent;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: 300px;
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      color: inherit;
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${e.sys.color.action.disabled.text};
      background-color: ${e.sys.color.action.disabled.default};
    }
    &.result-list-con button:hover, &.result-list-con button:focus-visible , &.result-list-con .show-result-button:hover, &.result-list-con .show-result-button:focus-visible{
      color: inherit;
      background: rgba(0, 0, 0, 0.2);
    }
    &.result-list-con .jimu-dropdown-item-divider {
      margin-left: 0;
      margin-right: 0;
    }
    button.active, &.result-list-con button.active {
      background: ${e.sys.color.action.selected.default};
      color: ${e.sys.color.action.selected.text};
    }
    .show-result-button:active {
      background-color: ${e.sys.color.action.default};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: 32px;
    }
    .clear-recent-search-con {
      color: ${e.sys.color.primary.main} !important;
      height: 40px;
      margin-top: -4px;
    }
    .jimu-dropdown-item-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: 42px !important;
    }
    .source-label-con {
      color: ${o?"inherit":"var(--sys-color-surface-header-text)"} !important;
      font-weight: bold !important;
      pointer-events: none;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: 11px;
        min-height: 11px;
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: 32px;
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 var(--sys-shape-2) var(--sys-shape-2) !important;
          padding: 0;
          height: 8px;
          min-height: 8px;
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: 8px;
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: ${e.sys.color.action.default};
      }
    }
  `;var Me=a(1888);const{useEffect:Re,useRef:De}=t.React,Te={apply({elements:e,rects:t}){const n=t.reference.width;n&&(e.floating.style.width=`${n}px`)}},Le={apply({elements:e,rects:t}){"33px"!==e.floating.style.width&&(e.floating.style.width="33px")}},Pe=t.css`
  border-radius: var(--sys-shape-2);
  overflow: hidden;
  &:has(.result-list-con-compact-close) {
    border-radius: 0 0 var(--sys-shape-2) var(--sys-shape-2) !important;
  }
`,Ne=n=>{const r=De(null),l=De(null),{children:i,isOpen:s,reference:a,searchInputRef:u,autoFocus:c,className:d,differentWithReferenceWidth:v,isFocusWithSearchInput:h,id:p,offset:m,containerEventPreventDefault:f,toggle:S}=n,y=(0,Me.useTheme)(),b=g.hooks.useClassicTheme(),I=t.ReactRedux.useSelector(e=>{var t;const n=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==n?void 0:n[p])||void 0===t?void 0:t.state});Re(()=>{var e;return(null==u?void 0:u.current)&&h&&(null===(e=u.current)||void 0===e||e.addEventListener("keydown",x,!0)),()=>{var e;h&&(null===(e=u.current)||void 0===e||e.removeEventListener("keydown",x,!0))}},[]);const x=t.hooks.useEventCallback(e=>{if(!s)return!1;const n=C()||[],o=(null==n?void 0:n.length)-1;"ArrowUp"===e.key?l.current=setTimeout(()=>{(0,t.focusElementInKeyboardMode)(n[o])}):"ArrowDown"===e.key&&(l.current=setTimeout(()=>{(0,t.focusElementInKeyboardMode)(n[0])}))}),w=t.hooks.useEventCallback(e=>{if(!s)return;const n="button"===e.target.getAttribute("role")||"option"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown","Escape"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),s&&n))if(clearTimeout(l.current),"Escape"===e.key)j(e);else if(["ArrowUp","ArrowDown","Tab"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const n=C();let o=n.indexOf(e.target),i=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey||"Tab"===e.key&&(e.shiftKey||1===n.length)?(o=0!==o?o-1:n.length-1,i=!0):("ArrowDown"===e.key||"Tab"===e.key||"n"===e.key&&e.ctrlKey)&&(i=!1,o=o===n.length-1?0:o+1);const s=0===o&&!i,a=o===n.length-1&&i;h&&(s||a)?l.current=setTimeout(()=>{(0,t.focusElementInKeyboardMode)(u.current,!0)}):((0,t.focusElementInKeyboardMode)(Array.prototype.slice.call(r.current.querySelectorAll(".popper-box"))[0],!0),l.current=setTimeout(()=>{(0,t.focusElementInKeyboardMode)(n[o],!0)})),["ArrowUp","ArrowDown"].includes(e.key)&&e.preventDefault()}else if("End"===e.key){const e=C();l.current=setTimeout(()=>{(0,t.focusElementInKeyboardMode)(e[e.length-1],!0)})}else if("Home"===e.key){const e=C();l.current=setTimeout(()=>{(0,t.focusElementInKeyboardMode)(e[0],!0)})}else if(e.which>=48&&e.which<=90){const n=C(),o=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<n.length;e+=1){if((n[e].textContent&&n[e].textContent[0].toLowerCase())===o){l.current=setTimeout(()=>{(0,t.focusElementInKeyboardMode)(n[e],!0)});break}}}}),j=e=>{e.preventDefault(),M(e),t.lodash.defer(()=>{(0,t.focusElementInKeyboardMode)(null==u?void 0:u.current,!0)})},C=()=>r?Array.prototype.slice.call(r.current.querySelectorAll('[role="button"], [role="option"]')).filter(e=>!e.disabled):[],M=e=>{S(e),"Escape"===(null==e?void 0:e.key)&&t.lodash.defer(()=>{(0,t.focusElementInKeyboardMode)(null==u?void 0:u.current)})};return(0,e.jsx)("div",{children:(0,e.jsx)(g.Popper,{autoFocus:c,placement:"bottom-start",open:s,toggle:M,reference:a,autoUpdate:!0,offsetOptions:m||o,ref:r,sizeOptions:v?Le:Te,forceLatestFocusElements:!0,css:Pe,children:(0,e.jsx)("div",{onMouseDown:e=>{f&&e.preventDefault()},css:Ce(y,0,b),role:"alert","aria-live":"assertive",className:(0,t.classNames)("result-list-popper",d,{"hide-popper":I===t.WidgetState.Closed}),children:(0,e.jsx)("div",{style:{userSelect:"none"},onKeyDown:w,children:i})})})})},{useState:ke,useRef:Oe,useEffect:Ee}=t.React,Fe=t.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,Ae=n=>{const o=t.hooks.useTranslation(g.defaultMessages,t.defaultMessages),r=Oe(null),{serviceList:i,open:s,toggleUtilityErrorRemind:a}=n,[u,c]=ke(null),d=t.ReactRedux.useSelector(e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates});Ee(()=>{s&&(clearTimeout(r.current),r.current=setTimeout(()=>{a(!1)},5e3))},[s]),Ee(()=>{v(d)},[d]);const v=e=>{var t;if(!i)return;let n=null,o=[],r=[];if(null===(t=Object.keys(i))||void 0===t||t.forEach(t=>{var n;const s=i[t];if(s.searchServiceType===l.GeocodeService){const t=null===(n=null==s?void 0:s.useUtility)||void 0===n?void 0:n.utilityId;if(t){const n=null==e?void 0:e[t];(null==n?void 0:n.isSignInError)?r.push(t):!1===(null==n?void 0:n.success)&&o.push(t)}}}),o=h(o),r=h(r),0===(null==o?void 0:o.length)&&(null==r?void 0:r.length)>0)n=p(r);else if(0===(null==r?void 0:r.length)&&(null==o?void 0:o.length)>0)n=m(o);else if((null==r?void 0:r.length)>0&&(null==o?void 0:o.length)>0){n=`${p(r)} ${m(o)}`}c(n)},h=(e=[])=>(e=Array.from(new Set(e))).map(e=>{const n=t.UtilityManager.getInstance().getUtilityJson(e);return null==n?void 0:n.label}),p=e=>{let t=null;return 1===se(i)?(null==e?void 0:e.length)>0&&(t=o("signInErrorDefault")):(null==e?void 0:e.length)>0&&(t=o("signInErrorsDefault",{names:e.join(", ")})),t},m=e=>{let t=null;return 1===se(i)?1===(null==e?void 0:e.length)&&(t=o("utilityInaccessible")):(null==e?void 0:e.length)>0&&(t=o("utilityNotAvailableWidthName",{name:e.join(", ")})),t};return(0,e.jsx)("div",{className:"position-relative w-100",css:Fe,children:(0,e.jsx)("div",{className:"w-100 utility-err-remind-con",children:(0,e.jsx)(g.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{a(!1)},text:u,title:u})})})},{useRef:Ue}=t.React,Ve=new(0,t.esri.Sanitizer),Je=n=>{const{className:o,reference:r,searchSuggestion:l,isOpen:i,canUseOutputDsLength:s,id:a,searchInputRef:u,openUtilityErrRemindInSuggestion:c,serviceList:d,searchText:v,toggleSuggestionUtilityError:h,toggle:p,onRecordItemClick:m,setSuggestionFirstItem:f}=n,S=Ue(!1),y=()=>{if((null==l?void 0:l.length)<2)return!1;let e=0,t=0;return null==l||l.forEach(n=>{var o;const r=null==n?void 0:n.icon;r&&(e+=1),(null===(o=n.suggestionItem)||void 0===o?void 0:o.length)>0&&r&&(t+=1)}),t>0&&e>0},b=(n,o=!1)=>{const r=null==n?void 0:n.suggestionItem,l=null==n?void 0:n.icon;return null==r?void 0:r.map((r,i)=>{const a=Ve.sanitize(r.suggestionHtml),u={configId:null==r?void 0:r.configId,isFromSuggestion:null==r?void 0:r.isFromSuggestion,magicKey:null==r?void 0:r.magicKey};return(0,e.jsxs)("button",{className:(0,t.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":o}),title:r.suggestion,"aria-label":r.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:n,isFromSuggestion:o,magicKey:r}=t||{};n&&(o||r)?m(e,t):m(e)})(r.suggestion,u)},ref:e=>{I(i,e)},children:[l&&1===s&&(0,e.jsx)(g.Icon,{className:"mr-2",size:16,icon:null==l?void 0:l.svg}),(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:a}})]},`${null==n?void 0:n.layer}${i}`)})},I=(e,t)=>{0===e&&!S.current&&t&&(f(t),S.current=!0)};return(0,e.jsx)("div",{children:(0,e.jsxs)(Ne,{isOpen:i&&!(()=>{let e=[];return l.forEach(t=>{const n=(null==t?void 0:t.suggestionItem)||[];e=e.concat(n)}),v&&0===e.length})()||c,autoFocus:!1,reference:r,searchInputRef:u,isFocusWithSearchInput:!0,toggle:p,id:a,containerEventPreventDefault:!0,className:(0,t.classNames)("result-list-con suggestion-list-con",o),children:[!c&&(S.current=null,null==l?void 0:l.map((t,n)=>{var o,r;const i=(null==l?void 0:l.length)>1&&(null===(o=null==t?void 0:t.suggestionItem)||void 0===o?void 0:o.length)>0;return(0,e.jsxs)("div",{role:"listbox","aria-label":null==t?void 0:t.layer,children:[i&&(0,e.jsxs)("button",{"aria-label":null==t?void 0:t.layer,role:"button",className:"source-label-con d-flex align-items-center jimu-outline-inside",disabled:!0,title:null==t?void 0:t.layer,children:[(null==t?void 0:t.icon)&&(0,e.jsx)(g.Icon,{className:"mr-2",size:16,icon:null===(r=null==t?void 0:t.icon)||void 0===r?void 0:r.svg}),(0,e.jsx)("div",{className:"flex-grow-1",children:null==t?void 0:t.layer})]}),b(t,y())]},`${null==t?void 0:t.layer}-${n}`)})),c&&(0,e.jsx)(Ae,{open:c,serviceList:d,toggleUtilityErrorRemind:h})]})})};var Ge=a(9044),$e=a.n(Ge),ze=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};const _e=n=>{const o=window.SVG,{className:r}=n,l=ze(n,["className"]),i=(0,t.classNames)("jimu-icon jimu-icon-component",r);return o?(0,e.jsx)(o,Object.assign({className:i,src:$e()},l)):(0,e.jsx)("svg",Object.assign({className:i},l))};var Ke=a(21210),We=a.n(Ke),Be=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};const qe=n=>{const o=window.SVG,{className:r}=n,l=Be(n,["className"]),i=(0,t.classNames)("jimu-icon jimu-icon-component",r);return o?(0,e.jsx)(o,Object.assign({className:i,src:We()},l)):(0,e.jsx)("svg",Object.assign({className:i},l))};var He=a(28996),Qe=a.n(He),Ze=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};const Xe=n=>{const o=window.SVG,{className:r}=n,l=Ze(n,["className"]),i=(0,t.classNames)("jimu-icon jimu-icon-component",r);return o?(0,e.jsx)(o,Object.assign({className:i,src:Qe()},l)):(0,e.jsx)("svg",Object.assign({className:i},l))},Ye=n=>{const o=t.hooks.useTranslation(h,g.defaultMessages),{serviceList:i,locationLoading:s,isGetLocationError:a,jimuMapView:u,onLocationChange:c,handleLocationLoadingChange:d}=n,[v,p]=t.React.useState(null);t.React.useEffect(()=>{m()},[i]);const m=()=>{var e;for(const t in i){const n=null===(e=i[t])||void 0===e?void 0:e.asMutable({deep:!0});if(n.searchServiceType===l.GeocodeService){p(n);break}}},f=t.React.useCallback(e=>{var t,n,o;d(!1);const l=`${e.coords.longitude},${e.coords.latitude}`;if(v){((e,t,n=r)=>t?(0,w.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then(o=>{const[r,l]=o;return K(t,n).then(t=>{const o=new l(n);return r.locationToAddress(e,{location:t,outSpatialReference:o},{query:{}}).then(e=>Promise.resolve(e.address),e=>(console.error(e.message),Promise.reject(new Error(e.message))))})}):Promise.resolve(null))(null==v?void 0:v.geocodeURL,e,(null===(t=null==u?void 0:u.view)||void 0===t?void 0:t.spatialReference)&&(null===(o=null===(n=null==u?void 0:u.view)||void 0===n?void 0:n.spatialReference)||void 0===o?void 0:o.toJSON())||(null==v?void 0:v.spatialReference)).then(e=>{c(e)},e=>{c(l)})}else c(l)},[v,u,c,d]),S=e=>{d(!1),c(null,null,!0)};return(0,e.jsxs)("div",{children:[!a&&(0,e.jsxs)(g.Button,{className:"text-left d-block",role:"button",onClick:()=>{if(s)return!1;d(!0),((e,t)=>{if(navigator.geolocation){const n={enableHighAccuracy:!0,timeout:3e3,maximumAge:1e4};navigator.geolocation.getCurrentPosition(e,t,n)}else t&&t()})(f,S)},"aria-label":o("useCurrentLocation"),title:o("useCurrentLocation"),children:[(0,e.jsx)(qe,{className:"mr-2"}),o("useCurrentLocation")]}),a&&(0,e.jsxs)(g.Button,{className:"text-left d-block",role:"button","aria-label":o("couldNotRetrieve"),title:o("couldNotRetrieve"),children:[(0,e.jsx)(Xe,{className:"mr-2"}),o("couldNotRetrieve")]})]})},{useRef:et}=t.React,tt=new(0,t.esri.Sanitizer),nt=n=>{var o,r,l,i;const s=t.hooks.useTranslation(h,g.defaultMessages),{className:a,reference:u,recentSearchesData:c,isOpen:d,isGetLocationError:v,serviceList:p,config:m,id:f,searchInputRef:S,locationLoading:y,jimuMapView:b,toggle:I,onRecordItemClick:x,clearSearches:w,setSuggestionFirstItem:j,handleLocationLoadingChange:C}=n,M=et(!1),R=n=>{const o=null==n?void 0:n.suggestionItem;return null==o?void 0:o.map((o,r)=>{const l=tt.sanitize(o.suggestionHtml),i={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,e.jsx)(g.Button,{className:(0,t.classNames)("d-flex align-items-center py-2 jimu-outline-inside"),title:o.suggestion,"aria-label":o.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:n,isFromSuggestion:o,magicKey:r}=t||{};n&&(o||r)?x(e,t):x(e)})(o.suggestion,i)},ref:e=>{D(r,e)},children:(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:l}})},`${null==n?void 0:n.layer}${r}`)})},D=(e,t)=>{0!==e||M.current||(j(t),M.current=!0)};return(0,e.jsx)("div",{children:(0,e.jsxs)(Ne,{isOpen:d,autoFocus:!1,reference:u,searchInputRef:S,isFocusWithSearchInput:!0,toggle:I,id:f,className:(0,t.classNames)("result-list-con suggestion-list-con",a),children:[m.isUseCurrentLoation&&(0,e.jsx)(Ye,{jimuMapView:b,serviceList:p,isShowCurrentLocation:!0,onLocationChange:x,locationLoading:y,isGetLocationError:v,handleLocationLoadingChange:C}),(M.current=null,null==c?void 0:c.map((t,n)=>(0,e.jsx)("div",{role:"group","aria-label":null==t?void 0:t.layer,children:R(t)},`${null==t?void 0:t.layer}-${n}`))),m.isShowRecentSearches&&(null===(r=null===(o=c[0])||void 0===o?void 0:o.suggestionItem)||void 0===r?void 0:r.length)>0&&(0,e.jsx)(g.DropdownItem,{divider:!0}),m.isShowRecentSearches&&(null===(i=null===(l=c[0])||void 0===l?void 0:l.suggestionItem)||void 0===i?void 0:i.length)>0&&(0,e.jsxs)(g.Button,{role:"button",className:"clear-recent-search-con jimu-outline-inside text-left d-block","aria-label":s("clearRecentSearches"),title:s("clearRecentSearches"),onClick:w,children:[(0,e.jsx)(_e,{className:"mr-2"}),s("clearRecentSearches")]})]})})},{useEffect:ot,useRef:rt}=t.React,lt=n=>{const r=t.hooks.useTranslation(h),{reference:l,searchText:s,id:a,config:u,dsStatus:d,serviceList:v,isOpenResultListDefault:p,searchInputRef:m,searchResult:f,selectionList:y,openUtilityErrRemindInResult:b,isOpenResultPopper:I,isToOtherWidget:w,datasourceConfig:j,toggleResultUtilityError:C,setResultFirstItem:M,handleDsIdOfSelectedResultItemChange:R}=n,{resultMaxNumber:D,enableFiltering:T}=u,L=rt([]),P=rt(!1),N=rt(null),k=rt(null),O=rt(!1),E=rt((0,t.Immutable)({})),F=rt({}),A=rt(null),U=rt(!1),V=rt(!1),J=rt(null),G=rt({}),$=rt(null),z=t.ReactRedux.useSelector(e=>e.appContext.isRTL),[_,K]=t.React.useState((0,t.Immutable)({})),[W,B]=t.React.useState(p),[q,H]=t.React.useState(c.Classic),[Q,Z]=t.React.useState(!1),[X,Y]=t.React.useState(o);ot(()=>{L.current=[],J.current=s},[s]),ot(()=>{P.current=!1;ge(null==v?void 0:v.asMutable({deep:!0}),d)&&(w||I)&&te()},[f,w,I,T,d]),ot(()=>{(I||w)&&(B(!0),V.current=!0,U.current=!1,K((0,t.Immutable)({})),F.current={})},[I,w]),ot(()=>{(null==u?void 0:u.searchResultStyle)&&(null==u?void 0:u.searchResultStyle)!==q&&H(null==u?void 0:u.searchResultStyle)},[u]),ot(()=>{Ie(q,W,Q)},[q,W,Q]);const te=()=>{const e=ee(null==v?void 0:v.asMutable({deep:!0}),D,a,null==u?void 0:u.enableFiltering);G.current={},Promise.all([e]).then(e=>{P.current=!0;let n=(0,t.Immutable)({}),o=[];null==e||e.forEach(e=>{o=o.concat(e)});const r={};o.forEach(e=>{const{records:t,configId:o}=e;r[o]=t;let l=he(e);l=oe(l),pe(l),n=n.setIn([o],l)}),E.current=n,(null==u?void 0:u.searchResultView)!==i.OtherWidgets&&K(n),F.current=r,fe()})},oe=e=>e.sort((e,t)=>{var n,o,r,l,i,s;const a=null===(o=null===(n=null==e?void 0:e.value)||void 0===n?void 0:n.join(","))||void 0===o?void 0:o.toLocaleLowerCase(),u=null===(l=null===(r=null==t?void 0:t.value)||void 0===r?void 0:r.join(","))||void 0===l?void 0:l.toLocaleLowerCase();return(a.startsWith(null===(i=J.current)||void 0===i?void 0:i.toLocaleLowerCase())?0:1)-(u.startsWith(null===(s=J.current)||void 0===s?void 0:s.toLocaleLowerCase())?0:1)}),re=()=>{var e;if(se(v)<2)return!1;let t=0,n=0;for(const o in _){const r=ie(j,o),l=null==r?void 0:r.icon;l&&(t+=1),(null===(e=_[o])||void 0===e?void 0:e.length)>0&&l&&(n+=1)}return n>0&&t>0},le=t.hooks.useEventCallback((n,o,r=!1)=>null==n?void 0:n.map((n,l)=>{var i,s;const{configId:a,value:u,recordId:c,outputDsId:d,zoomScale:h}=n,p=me(a,c),m=null===(s=null===(i=null==o?void 0:o.asMutable({deep:!0}))||void 0===i?void 0:i[a])||void 0===s?void 0:s.includes(c),f=ie(j,a),S=null==f?void 0:f.icon,y=se(v);return(0,e.jsxs)("button",{className:(0,t.classNames)("d-flex align-items-center jimu-outline-inside",{"item-p-l":r,active:m}),role:"option","aria-selected":m,title:u.join(", "),"aria-label":u.join(", "),ref:e=>{ae(l,e)},onClick:()=>{ce({isActive:m,key:p,recordId:c,dsId:d,configId:a,zoomScale:h})},children:[S&&1===y&&(0,e.jsx)(g.Icon,{className:"mr-2",size:16,icon:null==S?void 0:S.svg}),(0,e.jsx)("div",{className:"flex-grow-1",children:u.join(", ")})]},p)})),ae=(e,t)=>{0===e&&!O.current&&V.current&&t&&(M(t),O.current=!0)},ue=t.React.useCallback((e,n,o,r)=>{var l;if(n){const t=ne(e);o=o.map(e=>t.buildRecord(e.feature))}const i=new t.DataRecordsSelectionChangeMessage(a,o,[e]),s=null===(l=o[0])||void 0===l?void 0:l.__extent;s&&(i.extent=s),t.MessageManager.getInstance().publishMessage(i)},[a]),ce=t.React.useCallback(e=>{var t,n,o,r,l,i,s,a,u;const{isActive:c,recordId:d,dsId:v,configId:g,zoomScale:h}=e,p=null===(o=null===(n=null===(t=E.current)||void 0===t?void 0:t[g])||void 0===n?void 0:n[0])||void 0===o?void 0:o.localDsId,m=null===(i=null===(l=null===(r=E.current)||void 0===r?void 0:r[g])||void 0===l?void 0:l[0])||void 0===i?void 0:i.layerDsIdActuallyUsed,f=null===(u=null===(a=null===(s=E.current)||void 0===s?void 0:s[g])||void 0===a?void 0:a[0])||void 0===u?void 0:u.isGeocodeRecords,S=ne(f?v:m),y=c?[]:ve(g,d);ue(v,p,y,h),R(d?v:null),d&&(!c&&de(g),clearTimeout(A.current),A.current=setTimeout(()=>{c?null==S||S.selectRecordsByIds([]):null==S||S.selectRecordsByIds([d])},100))},[R,ue]),de=e=>{var t,n,o,r,l,i;const s=E.current;for(const a in s)if(e!==a){const e=null===(n=null===(t=s[a])||void 0===t?void 0:t[0])||void 0===n?void 0:n.outputDsId,u=null===(r=null===(o=null==s?void 0:s[a])||void 0===o?void 0:o[0])||void 0===r?void 0:r.layerDsIdActuallyUsed,c=null===(i=null===(l=null==s?void 0:s[a])||void 0===l?void 0:l[0])||void 0===i?void 0:i.isGeocodeRecords,d=ne(c?e:u);d&&d.selectRecordsByIds([])}},ve=(e,t)=>{var n;const o=(null===(n=F.current)||void 0===n?void 0:n[e])||[];return(null==o?void 0:o.filter(e=>(null==e?void 0:e.getId())===t))||[]},he=e=>{var n;const{records:o,configId:r,dsId:l,isGeocodeRecords:i,layerDsIdActuallyUsed:s,localDsId:a,zoomScale:u}=e,c=(null===(n=null==v?void 0:v[r])||void 0===n?void 0:n.displayFields)||[],d=[],g=t.i18n.getIntl();return null==o||o.forEach(e=>{const t=[];c.forEach(n=>{const o=e.getFormattedFieldValue(n.jimuName,g);(o||0===o)&&t.push(o)});const n={value:t,configId:r,outputDsId:l,dsId:l,recordId:null==e?void 0:e.getId(),isGeocodeRecords:i,layerDsIdActuallyUsed:s,localDsId:a,zoomScale:u};d.push(n)}),d},pe=e=>{e.forEach(e=>{var t;!(null===(t=G.current)||void 0===t?void 0:t.recordId)&&e.recordId&&(G.current=e)})},me=(e,t)=>`${e}_${t}`,fe=t.React.useCallback(()=>{var e;const t=ge(null==v?void 0:v.asMutable({deep:!0}),d);if(!(null==u?void 0:u.isAutoSelectFirstResult)||!(null===(e=G.current)||void 0===e?void 0:e.recordId)||U.current||!t)return;const{configId:n,recordId:o,outputDsId:r,zoomScale:l}=G.current,i=me(n,o);ce({isActive:!1,key:i,recordId:o,dsId:r,configId:n,zoomScale:l}),U.current=!0},[u,ce,v,d]),Se=()=>{Ie(q,!W,Q),W&&M(k.current),B(!W),V.current=!W},ye=t.React.useCallback(e=>{var t;let n=0;for(const o in e){n+=(null===(t=null==e?void 0:e[o])||void 0===t?void 0:t.length)||0}const o=se(v);Z(0===o||0===n&&P.current)},[v]),be=t.React.useCallback(e=>{V.current&&(B(!1),V.current=!1,M(k.current))},[M]),Ie=(e,t,n)=>{var r;let i=o;if(e===c.Compact)if(t||n)i=o;else{const e=(null===(r=null==l?void 0:l.current)||void 0===r?void 0:r.clientWidth)/2-15||0;i=z?[-e,0]:[e,0]}else i=o;Y(i)},xe=t.React.useCallback(e=>{var t;const n=null===(t=null==$?void 0:$.current)||void 0===t?void 0:t.contains(e.target),o="input"===e.target.tagName.toLowerCase();!(n||o)&&be(e)},[be]);return ot(()=>(document.addEventListener("focusin",xe),()=>{document.removeEventListener("focusin",xe)}),[xe]),ot(()=>{ye(_)},[_,ye]),(0,e.jsx)("div",{role:"group","aria-label":r("searchResults"),children:(0,e.jsx)(Ne,{isOpen:I,isFocusWithSearchInput:!0,autoFocus:!1,reference:l,searchInputRef:m,toggle:be,id:a,offset:X,differentWithReferenceWidth:((e,t,n)=>t===c.Compact&&!e&&!!n)(W,q,s),className:(0,t.classNames)("result-list-con",q!==c.Compact||Q?"":W?"result-list-con-compact-open":"result-list-con-compact-close"),children:(0,e.jsxs)("div",{className:"result-list-content",ref:$,role:"listbox",children:[!b&&(0,e.jsxs)("div",{ref:N,children:[Q&&(0,e.jsx)("button",{role:"button",className:"text-center",disabled:!0,"aria-label":r("noResult",{searchText:s}),title:r("noResult",{searchText:s}),children:(0,e.jsx)("span",{role:"warning",children:r("noResult",{searchText:s})})}),!Q&&(0,e.jsxs)("div",{children:[q===c.Classic&&(0,e.jsxs)("div",{children:[(0,e.jsxs)("button",{role:"button",ref:k,className:"d-flex align-items-center show-result-button jimu-outline-inside",onClick:Se,"aria-label":r("searchResults"),title:r("searchResults"),children:[(0,e.jsx)("div",{className:"flex-grow-1 font-weight-bold",children:r("searchResults")}),!W&&s?(0,e.jsx)(S,{}):(0,e.jsx)(x,{})]}),W&&(0,e.jsx)(g.DropdownItem,{divider:!0})]}),W&&(0,e.jsx)("div",{children:(()=>{var t;const n=[];O.current=null;for(const o in _){const r=null===(t=null==_?void 0:_.asMutable({deep:!0}))||void 0===t?void 0:t[o],l=ie(j,o),i=null==l?void 0:l.label,s=null==l?void 0:l.icon,a=se(v),u=(0,e.jsx)("div",{role:"group",title:"label","aria-label":i,children:r.length>0&&(0,e.jsxs)("div",{children:[a>1&&(0,e.jsx)("div",{onMouseDown:e=>{e.preventDefault()},children:(0,e.jsxs)("button",{role:"button","aria-label":i,className:"source-label-con d-flex align-items-center jimu-outline-inside",disabled:!0,title:i,children:[s&&(0,e.jsx)(g.Icon,{className:"mr-2",size:16,icon:null==s?void 0:s.svg}),(0,e.jsx)("div",{className:"flex-grow-1",children:i})]},`${o}_${i}`)}),le(r,y,re())]})},`${o}_${i}_con`);n.push(u)}return n})()}),q===c.Compact&&(0,e.jsxs)("div",{className:"show-result-button-style2-con",children:[W&&(0,e.jsx)(g.DropdownItem,{divider:!0}),(0,e.jsx)("button",{role:"button",className:"d-flex align-items-center show-result-button show-result-button-style2 jimu-outline-inside",onClick:Se,title:r("searchResults"),"aria-label":r("searchResults"),children:!W&&s?(0,e.jsx)(S,{size:10}):(0,e.jsx)(x,{size:10})})]})]})]}),b&&(0,e.jsx)(Ae,{open:b,serviceList:v,toggleUtilityErrorRemind:C})]})})})};var it=a(50170),st=a.n(it),at=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};const ut=n=>{const o=window.SVG,{className:r}=n,l=at(n,["className"]),i=(0,t.classNames)("jimu-icon jimu-icon-component",r);return o?(0,e.jsx)(o,Object.assign({className:i,src:st()},l)):(0,e.jsx)("svg",Object.assign({className:i},l))};var ct=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function i(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}a((o=o.apply(e,t||[])).next())})};const{useSelector:dt}=t.ReactRedux,{useState:vt,useEffect:gt,useRef:ht,useMemo:pt}=t.React,mt=n=>{var o;const r=(0,Me.useTheme)(),a=t.hooks.useTranslation(h,g.defaultMessages),u=dt(e=>null==e?void 0:e.queryObject),c=dt(e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode}),d=ht(e=>{}),p=ht(null),m=ht(null),f=ht([]),S=ht(null),y=ht(null),b=ht(null),I=ht(!1),x=ht(!1),w=ht(!1),j=ht(null),C=ht(null),M=ht(null),R=ht(!1),D=ht(!1),T=ht(null),L=ht(null),P=ht(null),N=ht(null),k=ht(null),E=ht(null),A=ht(!1),U=ht(null),V=ht(!1),J=ht(null),G=ht(null),$=ht(!1),z=ht(!1),_=ht(!1),{config:K,dsStatus:W,className:H,reference:Q,id:oe,isShowSearchInput:ie,isInCurrentView:ae,isWidgetInCurrentPage:ge,serviceList:pe,searchResult:fe,selectionList:Se,datasourceConfig:ye,loadingServiceList:be,showSearchSetting:Ie,jimuMapView:xe}=n,{handleServiceListChange:we,handleSearchTextForConfirmSearchChange:je}=n,{isShowRecentSearches:Ce,recentSearchesMaxNumber:Re,linkParam:De,searchResultView:Te,resultMaxNumber:Le}=K,[Pe,Ne]=vt(null),[ke,Oe]=vt(!1),[Ee,Fe]=vt(!1),[Ae,Ue]=vt(!1),[Ve,Ge]=vt([]),[$e,ze]=vt({}),[_e,Ke]=vt(!1),[We,Be]=vt(!1),[qe,He]=vt(!1),[Qe,Ze]=vt(null),[Xe,Ye]=vt(!1),[et,tt]=vt(!1),[ot,rt]=vt([]),[it,st]=vt(!1),[at,mt]=vt(null),[ft,St]=vt(!1),[yt,bt]=vt(!1),It=t.css`
    .input-wrapper {
      height: 100% !important;
    }
    input::-webkit-contacts-auto-fill-button{
      opacity: 0 !important;
      visibility: hidden;
    }
    .loading-con {
      left: 0;
      top: 0;
      right: var(--sys-shape-2);
      height: 2px;
    }
    .hide-loading {
      opacity: 0;
      visibility: hidden;
    }
    .search-button {
      width: 32px;
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
    &.arrangement-Style1 {
      .search-button {
        border-radius: 0 var(--sys-shape-2) var(--sys-shape-2) 0;
      }
      .input-wrapper {
        border-radius: var(--sys-shape-2) 0 0 var(--sys-shape-2);
      }
      .no-border-left .input-wrapper{
        border-radius: 0;
        border-left: none;
      }
    }
    &.arrangement-Style2 {
      & {
        padding-right: 1px;
      }
      .input-prefix-icon {
        color: var(--sys-color-action-disabled-text);
      }
      .input-wrapper {
        border-radius: ${t.polished.rem(32)} !important;
      }
    }
    &.arrangement-Style3 {
      .input-wrapper {
        background: none;
        border: none;
      }
      .search-button {
        background: none;
        color: inherit !important;
      }
    }
    //https://devtopia.esri.com/Beijing-R-D-Center/ExperienceBuilder-Web-Extensions/issues/26291#issuecomment-5527033
    //Because after the theme is updated, the color of the input placeholder is set, which causes a regression issue.
    //In order to deal with this regression issue, special processing is required under the dark theme.
    .in-dark-theme input::placeholder {
      color: #868686 !important;
    }
  `;gt(()=>{V.current&&ae&&ge?(He(!1),t.lodash.defer(()=>{At(!0)})):He(!0),ae&&ge||Ut()},[ae,ge]),gt(()=>{!Xe&&A.current&&wt(!0,!1),A.current=Xe},[_e,Xe]),gt(()=>{_e&&c===t.AppMode.Design&&Ut()},[c]),gt(()=>{d.current=t.lodash.debounce(Tt,400),ln(pe,null==K?void 0:K.hint)},[K]),gt(()=>{I.current&&(Ct(pe),jt(pe,x.current),kt(pe));const e=Et(pe);f.current=e,x.current=null==K?void 0:K.enableFiltering,w.current=!0},[pe,K.enableFiltering]),gt(()=>{b.current=pe,pe&&(I.current=!0);const e=(null==K?void 0:K.sourceType)!==v.MapCentric||!be;ln(pe,null==K?void 0:K.hint),Lt(pe),!D.current&&pe&&e&&(xt(pe),D.current=!0)},[pe,be]);const xt=t.hooks.useEventCallback(e=>{var t;const n=he(oe),{text:o,status:r}=n;r&&(r.isFromSuggestion=!0),o&&(e&&0!==(null===(t=Object.keys(e))||void 0===t?void 0:t.length)||(tn(o,r),zt(o,!1,r)),clearTimeout(U.current),U.current=setTimeout(()=>{((e,t)=>{var n;let o=!0;for(const r in e){const i=e[r];let s;if(i.searchServiceType===l.FeatureService)ce(null===(n=null==i?void 0:i.useDataSource)||void 0===n?void 0:n.dataSourceId,de(i.configId,t))||(o=!1);else{const e=null==i?void 0:i.outputDataSourceId;s=ne(e),s||(o=!1)}}return o})(null==e?void 0:e.asMutable({deep:!0}),oe)&&sn()>0?(tn(o,r),zt(o,!1,r)):xt(e)},300))}),wt=(e=!1,t=!0)=>{t&&st(!1),e||(z.current=!1),tt(e)},jt=(e,t)=>{if(!w.current)return!1;t!==(null==K?void 0:K.enableFiltering)&&(clearTimeout(m.current),m.current=setTimeout(()=>{var n;N.current&&Pt(!1);for(const o in e){(null===(n=e[o])||void 0===n?void 0:n.searchServiceType)===l.FeatureService&&Y(e[o],oe,o,t)}}))},Ct=e=>{if(!w.current||!N.current)return!1;const t=b.current||{},n=Mt(e),o=Mt(b.current),r=(null==o?void 0:o.filter(e=>!(null==n?void 0:n.includes(e))))||[];Object.keys(e||{}).length!==Object.keys(t||{}).length&&N.current&&(clearTimeout(m.current),m.current=setTimeout(()=>{Pt(!1),null==r||r.forEach(e=>{var n,o;(null===(n=t[e])||void 0===n?void 0:n.searchServiceType)===l.FeatureService?Y(t[e],oe,e,null==K?void 0:K.enableFiltering):Ft(null===(o=t[e])||void 0===o?void 0:o.outputDataSourceId)})}))},Mt=e=>e?Object.keys(e).map(e=>e):[],Rt=(e=!1)=>{St(e)},Dt=(e=!1)=>{bt(e)},Tt=t.hooks.useEventCallback(e=>{var t;if(0===(null==K?void 0:K.maxSuggestions))return void Oe(!1);!ke&&Oe(!0);const n=(e=>{const{searchText:t,serviceList:n,config:o,datasourceConfig:r,jimuMapView:i}=e,s=[];for(const e in n){const a=n[e];let u;a.maxSuggestions=o.maxSuggestions;const c=X(o.sourceType,null==a?void 0:a.searchInCurrentMapExtent,i);u=a.searchServiceType===l.FeatureService?B(t,o,a,r,c):O(t,a,c,i),s.push(u)}return Promise.all(s)})({searchText:e,serviceList:null===(t=null==j?void 0:j.current)||void 0===t?void 0:t.asMutable({deep:!0}),config:K,datasourceConfig:ye,jimuMapView:xe});Promise.all([n]).then(e=>{var t;const n=null==e?void 0:e[0];(null===(t=null==n?void 0:n.filter(e=>null==e?void 0:e.err))||void 0===t?void 0:t.length)>0&&Rt(!0),Oe(!1),n&&Ge(n),R.current||N.current&&Fe(!0),R.current=!1}).catch(e=>{Oe(!1)})}),Lt=t.hooks.useEventCallback(e=>{if(!w.current)return!1;let t=!1;for(const n in e){const o=e[n];((null==o?void 0:o.searchServiceType)===l.FeatureService||(null==o?void 0:o.isSupportSuggest))&&(t=!0)}Ue(t)}),Pt=(e=!0)=>{tn("",null,!0),Oe(!1),At(!1),zt("",!0),clearTimeout(E.current),e&&(0,t.focusElementInKeyboardMode)(k.current)},Nt=t.hooks.useEventCallback(()=>{var e,t;for(const n in pe)if((null===(e=pe[n])||void 0===e?void 0:e.searchServiceType)===l.GeocodeService){const e=null===(t=pe[n])||void 0===t?void 0:t.outputDataSourceId;Ft(e)}}),kt=e=>{var n;let o=!1;const r=Et(e);if(((null==r?void 0:r.length)!==f.current.length||(null===(n=null==r?void 0:r.filter(e=>!f.current.includes(e)))||void 0===n?void 0:n.length)>0)&&(o=!0),o){const e=new t.DataRecordSetChangeMessage(oe,t.RecordSetChangeType.Remove,f.current);t.MessageManager.getInstance().publishMessage(e)}},Ot=t.hooks.useEventCallback(()=>{const e=Et(pe),n=new t.DataRecordSetChangeMessage(oe,t.RecordSetChangeType.Remove,e);t.MessageManager.getInstance().publishMessage(n)}),Et=e=>{var t,n;const o=[];for(const r in e)if((null===(t=e[r])||void 0===t?void 0:t.searchServiceType)===l.GeocodeService){const t=null===(n=e[r])||void 0===n?void 0:n.outputDataSourceId;o.push(t)}return o},Ft=e=>{const n=ne(e);null==n||n.selectRecordsByIds([]),ue(n,t.DataSourceStatus.NotReady)},At=e=>{V.current=e,e||He(!0),Ke(e),Be(e)},Ut=()=>{Ke(!1)},Vt=()=>{let e=!0;if(!y.current)return e;const t=y.current;for(const n in t){const o=t[n];if(e=!((null==o?void 0:o.magicKey)||(null==o?void 0:o.isFromSuggestion)),!e)break}return e},Jt=(e,n,o)=>{if(o)return $t(),!1;Gt(e,n),tn(e,n),zt(e,!1,n),(0,t.focusElementInKeyboardMode)(k.current)},Gt=(e,t)=>{const n=he(oe)||{};if(e){if(n.text=e,t){const e={configId:null==t?void 0:t.configId};(null==t?void 0:t.magicKey)&&(e.magicKey=null==t?void 0:t.magicKey),n.status=e}else(null==n?void 0:n.status)&&delete n.status;me(oe,n)}else if(null==n?void 0:n.enabledList){const e={enabledList:null==n?void 0:n.enabledList};me(oe,e)}else me(oe,null)},$t=()=>{(0,t.focusElementInKeyboardMode)(k.current),st(!0),wt(!0,!1)},zt=t.hooks.useEventCallback((e,t=!1,n)=>{if(_e&&!t)return;e=null==e?void 0:e.trim(),Zt(e),Fe(!1),wt(!1),_t(),je(e),we(j.current),R.current=!0;const o={serviceList:y.current,searchText:e,searchResultView:Te,id:oe,sourceType:null==K?void 0:K.sourceType,jimuMapView:xe};(null==K?void 0:K.enableFiltering)&&(te(o),Wt()),Gt(e,n),Oe(!0),(e=>{const{serviceList:t,searchText:n,searchResultView:o,sourceType:r,jimuMapView:s,id:a}=e,u=[];for(const e in t){const c=t[e],{searchServiceType:d,resultMaxNumber:v}=c;if(d===l.GeocodeService){const e=o===i.ResultPanel?v:null,t=X(r,null==c?void 0:c.searchInCurrentMapExtent,s),l=F({address:n,maxResultNumber:e,geocodeItem:c,searchResultView:o,extent:t,jimuMapView:s,id:a});u.push(l)}}return Promise.all(u)})(o).then(t=>{var n;Oe(!1),(null===(n=null==t?void 0:t.filter(e=>"boolean"==typeof e))||void 0===n?void 0:n.length)>0&&Dt(!0),R.current=!1,e&&Bt(e)},e=>{Oe(!1)})}),_t=()=>{var e;const n=[];for(const t in j.current){const o=j.current[t],r=o.searchServiceType===l.FeatureService?null===(e=null==o?void 0:o.useDataSource)||void 0===e?void 0:e.dataSourceId:null==o?void 0:o.outputDataSourceId;n.push(r)}if(t.MessageManager.getInstance().publishMessage(new t.DataRecordsSelectionChangeMessage(oe,[],n)),at){const e=ne(at);null==e||e.selectRecordsByIds([]),Kt(null)}Ot(),Nt()},Kt=e=>{mt(e)},Wt=t.hooks.useEventCallback(()=>{var e;const n=[];for(const t in $e){const o=$e[t];let r;(null==o?void 0:o.searchServiceType)===l.FeatureService?(r=null===(e=null==o?void 0:o.useDataSource)||void 0===e?void 0:e.dataSourceId,n.push(r)):(null==o?void 0:o.outputDataSourceId)&&n.push(null==o?void 0:o.outputDataSourceId)}t.MessageManager.getInstance().publishMessage(new t.DataSourceFilterChangeMessage(oe,n))}),Bt=e=>{Te===i.OtherWidgets?e&&(Qt()?Xt():qt()):Ht()},qt=()=>{if(!ve(y.current,oe))return clearTimeout(C.current),C.current=setTimeout(()=>{qt()},200),!1;const e=ee(y.current,Le,oe,null==K?void 0:K.enableFiltering);Promise.all([e]).then(e=>{let t=[],n=[];null==e||e.forEach(e=>{t=t.concat(e)}),t.forEach(e=>{const t=(null==e?void 0:e.records)||[];n=n.concat(t)}),(null==n?void 0:n.length)>0?Xt():Ht()})},Ht=()=>{Yt(),At(!0)},Qt=()=>{let e=[];return Ve.forEach(t=>{e=e.concat(null==t?void 0:t.suggestionItem)}),e.length>0},Zt=e=>{(e=>{const{searchText:n,id:o,recentSearchesMaxNumber:r,isShowRecentSearches:l}=e,i=t.urlUtils.getAppIdPageIdFromUrl().appId,s=le(i,o);if(!l||!n)return!1;let a=re(o);a.includes(n)||(a.unshift(n),a=a.splice(0,r||10),t.utils.setLocalStorage(s,escape(a.join("/@/"))))})({searchText:e,id:oe,recentSearchesMaxNumber:Re,isShowRecentSearches:Ce})},Xt=()=>{var e;if(!(null==p?void 0:p.current))return!1;Yt(),Be(!0),null===(e=null==p?void 0:p.current)||void 0===e||e.click()},Yt=()=>ct(void 0,void 0,void 0,function*(){if(!ve(y.current,oe))return clearTimeout(M.current),M.current=setTimeout(()=>{Yt()},200),!1;const e=Te===i.ResultPanel?Le:100,n=ee(y.current,e,oe,null==K?void 0:K.enableFiltering,!0);if(!T.current||!L.current||!P.current){const e=yield function(){return Z(this,void 0,void 0,function*(){return(0,t.loadArcGISJSAPIModules)(["esri/geometry/support/geometryUtils","esri/geometry/Polygon","esri/Graphic"])})}();T.current=e[0],L.current=e[1],P.current=e[2]}Promise.all([n]).then(e=>{var n,o;let r=[];null==e||e.forEach(e=>{r=r.concat(e)});let l,i,s=[];null==r||r.forEach(e=>{const t=(null==e?void 0:e.records)||[];(null==t?void 0:t.length)>0&&(null==e?void 0:e.zoomScale)&&(l=null==e?void 0:e.zoomScale),s=s.concat(t)}),1===(null==s?void 0:s.length)&&(i=null===(n=s[0])||void 0===n?void 0:n.__extent),(e=>{const{widgetId:n,recordsArr:o,recordSetChangeType:r=t.RecordSetChangeType.CreateUpdate}=e,l=e.extent,i=[];null==o||o.forEach(e=>{var t;if(null==e?void 0:e.isGeocodeRecords){const n=ne(e.dsId),o=null===(t=null==e?void 0:e.displayFields)||void 0===t?void 0:t.map(e=>e.jimuName),r=null==n?void 0:n.getDataSourceJson(),l={records:e.records,fields:o,dataSource:n,name:n.id,label:null==r?void 0:r.label};i.push(l)}});const s=new t.DataRecordSetChangeMessage(n,r,i);l&&(s.extent=l),t.MessageManager.getInstance().publishMessage(s)})({widgetId:oe,recordsArr:r,recordSetChangeType:t.RecordSetChangeType.CreateUpdate,extent:i,zoomScale:l,scaleExtent:null===(o=T.current)||void 0===o?void 0:o.scaleExtent,Polygon:L.current,Graphic:P.current})})}),en=pt(()=>(e=>{let t,n;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,n={linkType:null==e?void 0:e.linkType},n.value=null==e?void 0:e.value),{linkTo:n,target:t}})(De),[De]),tn=(e,t,n)=>{Ge([]),Ne(e),N.current=e,(e||(null==K?void 0:K.enableFiltering)||n)&&nn(e,t)},nn=t.hooks.useEventCallback((e,n)=>{var o,r,i,s;const a=b.current;let u=b.current;e=null==e?void 0:e.trim();const c=K.sourceType===v.MapCentric?null===(o=null==xe?void 0:xe.view)||void 0===o?void 0:o.extent:null;for(const t in a){const n=null===(i=null===(r=a[t])||void 0===r?void 0:r.useDataSource)||void 0===i?void 0:i.dataSourceId;if(a[t].searchServiceType===l.GeocodeService||!ce(n))continue;const o=ne(n),d=(null===(s=a[t].searchFields)||void 0===s?void 0:s.asMutable({deep:!0}))||[],v=q(e,d,o,a[t].searchExact||!1),g=q(e,d,o,!1);if(u=u.setIn([t,"SQL"],v).setIn([t,"SuggestionSQL"],g).setIn([t,"searchText"],e),c){const e=(null==c?void 0:c.toJSON)?null==c?void 0:c.toJSON():{};u=u.setIn([t,"searchExtent"],e)}}j.current=u,((e,n)=>{const{configId:o,magicKey:r,isFromSuggestion:l}=n||{};let i=(0,t.Immutable)(e);const s={};for(const e in i)e===o&&(r||l)&&(r&&(i=i.setIn([o,"magicKey"],r||null)),l&&(i=i.setIn([o,"isFromSuggestion"],l||null)),s[o]=i[o]);(r||l)&&Object.keys(e).includes(o)&&(i=(0,t.Immutable)(s));y.current=null==i?void 0:i.asMutable({deep:!0}),ze(null==i?void 0:i.asMutable({deep:!0}))})(null==u?void 0:u.asMutable({deep:!0}),n)}),on=e=>{if(!e&&Ce){const e=re(oe).map(e=>({suggestionHtml:e,suggestion:e,isRecentSearch:!0}));rt([{suggestionItem:e,layer:null,icon:null}]),wt(!0)}},rn=e=>{!e&&(null==K?void 0:K.isUseCurrentLoation)&&(wt(!0),(null==K?void 0:K.isShowRecentSearches)||rt([{suggestionItem:[],layer:null,icon:null}]))},ln=t.hooks.useEventCallback((e,t)=>{var n,o;if(!e)return;let r;const l=sn(e);for(const t in e)r=(null===(n=null==e?void 0:e[t])||void 0===n?void 0:n.hint)&&(null===(o=null==e?void 0:e[t])||void 0===o?void 0:o.hint);const i=t||(null==K?void 0:K.hint)||a("findAddressOrPlace");r=r||a("findAddressOrPlace");Ze(1!==l?i:r)}),sn=t.hooks.useEventCallback(e=>se(e=e||pe)),an=e=>{40===e.keyCode&&J&&(Ee?(0,t.focusElementInKeyboardMode)(null==J?void 0:J.current,!0):_e?(0,t.focusElementInKeyboardMode)(null==S?void 0:S.current,!0):et&&((0,t.focusElementInKeyboardMode)(null==G?void 0:G.current,!0),z.current=!0))},un=()=>{if(Xe)return!0;if(ke||_e)return!1;let e=!1;return(null==K?void 0:K.maxSuggestions)>0&&(e=Ee&&Ae),e||($.current=!1),e},cn=()=>{Fe(!1)},dn=t.React.useCallback(()=>{var e,t;return!Pe&&(!!((null==K?void 0:K.isShowRecentSearches)&&ot&&(null===(t=null===(e=ot[0])||void 0===e?void 0:e.suggestionItem)||void 0===t?void 0:t.length)>0)||!!(null==K?void 0:K.isUseCurrentLoation)&&!Xe)},[K,Xe,ot,Pe]);return(0,e.jsxs)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${H||""} arrangement-${K.arrangementStyle}`,css:It,children:[(0,e.jsxs)("div",{className:"h-100 flex-grow-1 search-input-con",children:[(0,e.jsx)("div",{className:"h-100 w-100",onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){const e=un();$.current=e,z.current=et}"ArrowDown"===e.key&&e.preventDefault(),an(e)},children:ie&&(0,e.jsx)(g.TextInput,{value:Pe||"",onChange:e=>{var t;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=(null==n?void 0:n.length)>2;if(tn(n),_e&&zt("",!0),At(!1),!o||!Ae)return Fe(!1),0===(null==n?void 0:n.length)&&zt("",!0),!1;d.current(n)},onFocus:e=>{if($.current||z.current)return z.current=!1,$.current=!1,!1;on(N.current),rn(N.current)},onPressEnter:e=>{var t;if(!e||!e.target)return;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&Vt()&&(tn(n),zt(n)),an(e)},onBlur:e=>{E.current=setTimeout(()=>{$.current||Fe(!1),_.current||z.current||wt(!1)},200)},className:(0,t.classNames)("h-100 w-100",{"no-border-left":Ie,"in-dark-theme":"themes/dark/"===(null==r?void 0:r.uri)}),allowClear:!0,prefix:K.arrangementStyle===s.Style2?(0,e.jsx)(ut,{className:"input-prefix-icon"}):null,placeholder:Qe,title:Pe||Qe,ref:k,"aria-label":Pe||Qe,autoComplete:"off"})}),Pe&&(0,e.jsx)(Je,{canUseOutputDsLength:sn(),isOpen:un(),reference:Q,searchText:Pe,searchSuggestion:Ve,toggle:cn,onRecordItemClick:Jt,setSuggestionFirstItem:e=>{J.current=e},id:oe,config:K,toggleSuggestionUtilityError:Rt,openUtilityErrRemindInSuggestion:ft,searchInputRef:k,serviceList:pe}),dn()&&(0,e.jsx)(nt,{serviceList:se($e)>0?(0,t.Immutable)($e):pe,isOpen:et||Xe,reference:Q,isGetLocationError:it,recentSearchesData:ot,toggle:cn,onRecordItemClick:Jt,clearSearches:()=>{(e=>{const n=t.urlUtils.getAppIdPageIdFromUrl().appId,o=le(n,e);t.utils.setLocalStorage(o,"")})(oe),rt([]),tt(!1)},setSuggestionFirstItem:e=>{G.current=e},id:oe,config:K,searchInputRef:k,locationLoading:Xe,jimuMapView:xe,handleLocationLoadingChange:e=>{e?(Ye(e),_.current=e):setTimeout(()=>{Ye(e),_.current=e},300)}}),(0,e.jsx)(lt,{isOpenResultPopper:_e,isToOtherWidget:We,serviceList:(0,t.Immutable)($e),config:K,dsStatus:W,reference:Q,searchText:Pe,id:oe,setResultFirstItem:e=>{S.current=e},isOpenResultListDefault:qe,searchInputRef:k,searchResult:fe,selectionList:Se,openUtilityErrRemindInResult:yt,handleDsIdOfSelectedResultItemChange:Kt,toggleResultUtilityError:Dt,datasourceConfig:ye,scaleExtent:null===(o=T.current)||void 0===o?void 0:o.scaleExtent,Polygon:L.current,Graphic:P.current})]}),((n,o)=>{const r=n||o;return r?(0,e.jsx)("div",{className:(0,t.classNames)("position-absolute loading-con",{"hide-loading":!r}),children:(0,e.jsx)(g.Loading,{className:"w-100",type:g.LoadingType.Bar})}):null})(ke,Xe),K.arrangementStyle!==s.Style2&&(0,e.jsx)(g.Button,{className:"search-button h-100",type:K.arrangementStyle===s.Style3?"tertiary":"primary",icon:!0,"aria-label":a("SearchLabel"),onClick:()=>{(e=>{Vt()&&zt(e)})(Pe)},title:a("SearchLabel"),children:(0,e.jsx)(ut,{})}),Te===i.OtherWidgets&&(0,e.jsx)("div",{className:"search-link-con",children:(0,e.jsx)(g.Link,{ref:p,to:null==en?void 0:en.linkTo,target:null==en?void 0:en.target,queryObject:u})})]})},{useEffect:ft,useRef:St,useState:yt}=t.React,bt=n=>{const{config:o,id:r,serviceList:i,synchronizeSettings:s,jimuMapView:a,searchTextForConfirmSearch:u,handleSearchResultChange:c,handleSelectionListChange:d,handleDsStatusChange:g,clearSearchResult:h}=n,p=St(o),[m,f]=yt(!1);ft(()=>{p.current=o},[o]),ft(()=>{u&&f(!0),h()},[u,h]);const S=t.React.useCallback((e,t)=>{d(e,t)},[d]),y=t.React.useCallback((e,n)=>{const o=de(n,r),l=ne(e,o),i=((null==l?void 0:l.getSelectedRecords())||[]).map(e=>e.getId());d((0,t.Immutable)(i),n)},[r,d]),b=t.React.useCallback((e,t,n)=>{var i;const{searchServiceType:s}=e;switch(s){case l.GeocodeService:_(null==e?void 0:e.asMutable({deep:!0}),o.resultMaxNumber).then(e=>{const{records:n}=e,o=null==n?void 0:n.map(e=>e.getId());c(t,o)});break;case l.FeatureService:Q(null==e?void 0:e.asMutable({deep:!0}),o.resultMaxNumber,r,null===(i=p.current)||void 0===i?void 0:i.enableFiltering).then(n=>{var o;const{records:r}=n,l=null==r?void 0:r.map(e=>e.getId());c(t,l),y(null===(o=null==e?void 0:e.useDataSource)||void 0===o?void 0:o.dataSourceId,t)})}n&&g(t,n)},[o.resultMaxNumber,r,g,c,y]),I=t.React.useCallback((n,i,c)=>{if(n.searchServiceType===l.GeocodeService){const l=null==n?void 0:n.outputDataSourceId,a={dataSourceId:l,mainDataSourceId:l},u={where:"2=2",sqlExpression:null,pageSize:o.resultMaxNumber,outFields:["*"],page:1,returnGeometry:!0};if(!1!==s&&(null==o?void 0:o.sourceType)===v.MapCentric){const o=ne(l);return(0,e.jsx)("div",{children:l&&(0,e.jsx)(t.DataSourceComponent,{dataSource:o,query:u,onDataSourceInfoChange:e=>{b(n,i)},onDataSourceStatusChange:e=>{b(n,i,e)},onSelectionChange:e=>{S(e,i)},widgetId:r},`${i}_outputDataSource`)},`${i}_con`)}return(0,e.jsx)("div",{children:l&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:(0,t.Immutable)(a),query:u,onDataSourceInfoChange:e=>{b(n,i)},onDataSourceStatusChange:e=>{b(n,i,e)},onSelectionChange:e=>{S(e,i)},widgetId:r},`${i}_outputDataSource`)},`${i}_con`)}if(n.searchServiceType===l.FeatureService){const l=null==n?void 0:n.useDataSource,s=function(e){const{serviceListItem:n,searchTextForConfirmSearch:o,jimuMapView:r,sourceType:l,searchInCurrentMapExtent:i,enableFiltering:s}=e,{useDataSource:a}=n,u=!o&&s,c=null==n?void 0:n.SQL,d=u?"1=1":(null==c?void 0:c.sql)||"1=0",g=u?null:(null==c?void 0:c.sql)?c:null,h=H(n.searchFields,n.displayFields,null==a?void 0:a.dataSourceId);let p=(0,t.Immutable)({outFields:h,where:d,sqlExpression:g,returnGeometry:!0});if(l===v.MapCentric&&i){const e=null==r?void 0:r.view.extent,t=e?e.toJSON():{};p=p.set("geometry",t)}return p}({serviceListItem:null==n?void 0:n.asMutable({deep:!0}),searchTextForConfirmSearch:u,jimuMapView:a,sourceType:o.sourceType,searchInCurrentMapExtent:n.searchInCurrentMapExtent,enableFiltering:null==o?void 0:o.enableFiltering}),c=de(i,r);return(0,e.jsx)("div",{children:l&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:(0,t.Immutable)(l),query:m?s:null,onDataSourceInfoChange:e=>{b(n,i)},onSelectionChange:e=>{S(e,i)},onDataSourceCreated:e=>{e.setListenSelection(!0)},onDataSourceStatusChange:e=>{g(i,e)},onCreateDataSourceFailed:e=>{g(i,t.DataSourceStatus.CreateError)},localId:c},`${i}_useDataSource`)},`${i}_con`)}},[null==o?void 0:o.enableFiltering,o.resultMaxNumber,o.sourceType,g,b,r,a,m,S,u,s]);return(0,e.jsx)("div",{children:((e,t)=>{const n=[];for(const o in e)n.push(I(e[o],o,t));return n})(i,!!u)})};var It=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function i(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}a((o=o.apply(e,t||[])).next())})};const xt=(e,t=0)=>{let n="Default Address";return null==e||e.forEach(o=>{n=t?`${n}${t}`:n,o.jimuName===n&&(n=xt(e,t+=1))}),n};function wt(e){return It(this,void 0,void 0,function*(){yield function(e){return It(this,void 0,void 0,function*(){if(!e)return;const n=[];return Object.keys(e).forEach(o=>{const r=e[o],l=jt(r),i=(null==l?void 0:l.layers)||[],s=(null==l?void 0:l.tables)||[],a=[],u=[];if(s.forEach(e=>{a.includes(null==e?void 0:e.id)||a.push(null==e?void 0:e.id)}),i.forEach(e=>{u.includes(null==e?void 0:e.id)||u.push(null==e?void 0:e.id)}),null==l?void 0:l.enabled){const r=e[o],l=r.jimuLayerViews,i=r.jimuTables,s=t.DataSourceManager.getInstance();Object.keys(i).forEach(e=>{const t=i[e],o=r.getDataSourceIdByAPILayer(t),l=s.getDataSource(o),u=r.getMapDataSource();if(!l&&u&&a.includes(null==t?void 0:t.id)){const e=function(e,t){return It(this,void 0,void 0,function*(){return yield e.createDataSourceByLayer(t).then(e=>Promise.resolve(e),e=>Promise.resolve(null))})}(u,t);n.push(e)}}),Object.keys(l).forEach(e=>{var t;const o=l[e];if(!o.getLayerDataSource()&&u.includes(null===(t=o.layer)||void 0===t?void 0:t.id)){const e=function(e){return It(this,void 0,void 0,function*(){return yield e.createLayerDataSource().then(e=>Promise.resolve(e),e=>Promise.resolve(null))})}(o);n.push(e)}})}}),Promise.all(n)})}(e);const o={},r=Object.keys(e||{}).map(r=>It(this,void 0,void 0,function*(){var l,i,s,a,u,c,d,v;const g=e[r],h=Rt(g),p=Tt(g),m=null===(l=p[0])||void 0===l?void 0:l.jimuLayerViewsOrTable,f=null===(i=p[1])||void 0===i?void 0:i.jimuLayerViewsOrTable,S=0===(null===(s=Object.keys(m))||void 0===s?void 0:s.length)&&0===(null===(a=Object.keys(f))||void 0===a?void 0:a.length);let y=null===(u=null==o?void 0:o[r])||void 0===u?void 0:u.dataSourceConfig;if(S||0===(null==h?void 0:h.length))o[r]={dataSourceConfig:(null===(c=null==o?void 0:o[r])||void 0===c?void 0:c.dataSourceConfig)||[]};else{const e=t.DataSourceManager.getInstance();for(let l=0;l<p.length;l++){const{jimuLayerViewsOrTable:i,isTable:s}=p[l];for(const l in i||{}){const a=i[l],u=s?g.getDataSourceIdByAPILayer(a):null,c=s?null==a?void 0:a.id:null===(d=null==a?void 0:a.layer)||void 0===d?void 0:d.id,p=s?e.getDataSource(u):null==a?void 0:a.getLayerDataSource();if(!Pt(r,null==p?void 0:p.id,o)&&h.includes(c)){const e={dataSourceId:p.id,mainDataSourceId:p.id,dataViewId:p.dataViewId,rootDataSourceId:null===(v=p.getRootDataSource())||void 0===v?void 0:v.id,viewId:r},l=yield(0,n.getDsJsonOfOriginDs)(e);Lt(g,a,s).forEach(i=>{var s;const a=null==i?void 0:i.field,u=(null===(s=null==i?void 0:i.field)||void 0===s?void 0:s.exactMatch)||!1;let c;if(null==a?void 0:a.name){c=`${null==l?void 0:l.getLabel()}: ${a.name}`}const d={datasourceConfig:(0,t.Immutable)(y),dsJsonOriginDs:l,useDataSource:e,viewId:r,fieldsInMapSearchProperties:a?[a]:null,exactMatch:u,label:c},v=(0,n.getNewDataSourceConfig)(d);o[r]||(o[r]={}),o[r].dataSourceConfig=v.datasourceConfig,y=v.datasourceConfig})}}}}return Promise.resolve(o)}));return yield Promise.all(r),Promise.resolve(o)})}const jt=e=>{var t,n,o,r;if(!e)return null;const l=(null===(n=null===(t=e.view)||void 0===t?void 0:t.map)||void 0===n?void 0:n.applicationProperties)||null;return l?null===(r=null===(o=l.toJSON())||void 0===o?void 0:o.viewing)||void 0===r?void 0:r.search:null},Ct=[t.JSAPILayerTypes.FeatureLayer,t.JSAPILayerTypes.SceneLayer,t.JSAPILayerTypes.BuildingComponentSublayer,t.JSAPILayerTypes.ImageryTileLayer,t.JSAPILayerTypes.OrientedImageryLayer,t.JSAPILayerTypes.ImageryLayer,t.JSAPILayerTypes.SubtypeGroupLayer,t.JSAPILayerTypes.SubtypeSublayer];function Mt(e){if(!e||!e.type)return!1;const n=e.type,o=n!==t.JSAPILayerTypes.BuildingComponentSublayer||n===t.JSAPILayerTypes.BuildingComponentSublayer&&e.view;return!!(Ct.includes(n)&&o)}const Rt=e=>{const n=jt(e);if(!(null==n?void 0:n.enabled))return[];const o=[],r=t.DataSourceManager.getInstance();return Tt(e).forEach(t=>{var l,i;const{jimuLayerViewsOrTable:s,isTable:a}=t;for(const t in s||{}){const u=s[t];if(!Mt(u))continue;const c=a?e.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(l=null==u?void 0:u.layer)||void 0===l?void 0:l.id,v=a?r.getDataSource(c):null==u?void 0:u.getLayerDataSource();(null===(i=null==v?void 0:v.getDataSourceJson())||void 0===i?void 0:i.url)&&Dt(u,n,a)&&o.push(d)}}),o};function Dt(e,t,n){var o,r,l,i;const s=(null==t?void 0:t.layers)||[],a=(null==t?void 0:t.tables)||[],u=s.concat(a),c=n?null==e?void 0:e.id:null===(o=null==e?void 0:e.layer)||void 0===o?void 0:o.id;if("sublayer"===(null===(r=null==e?void 0:e.layer)||void 0===r?void 0:r.type)&&(null===(i=null===(l=null==e?void 0:e.layer)||void 0===l?void 0:l.parent)||void 0===i?void 0:i.id)){const t=e.layer.parent.id;let n=!1;return u.forEach(e=>{e.id===t&&(null==e?void 0:e.subLayer)===c&&(n=!0)}),n}{const e=(null==t?void 0:t.layers)||[],n=(null==t?void 0:t.tables)||[];return e.concat(n).map(e=>null==e?void 0:e.id).includes(c)}}const Tt=e=>[{jimuLayerViewsOrTable:null==e?void 0:e.jimuLayerViews,isTable:!1},{jimuLayerViewsOrTable:null==e?void 0:e.jimuTables,isTable:!0}],Lt=(e,t,n)=>{var o,r,l,i;const s=n?null==t?void 0:t.id:null===(o=null==t?void 0:t.layer)||void 0===o?void 0:o.id,a=jt(e),u=(null==a?void 0:a.layers)||[],c=(null==a?void 0:a.tables)||[],d=u.concat(c);let v;return v="sublayer"===(null===(r=null==t?void 0:t.layer)||void 0===r?void 0:r.type)&&(null===(i=null===(l=null==t?void 0:t.layer)||void 0===l?void 0:l.parent)||void 0===i?void 0:i.id)?d.filter(e=>(null==e?void 0:e.id)===t.layer.parent.id&&(null==e?void 0:e.subLayer)===s)||[]:d.filter(e=>(null==e?void 0:e.id)===s)||[],v};function Pt(e,t,n){var o;const r=null==n?void 0:n[e];if(!r)return!1;const l=null===(o=null==r?void 0:r.dataSourceConfig)||void 0===o?void 0:o.filter(e=>{var n;return t===(null===(n=null==e?void 0:e.useDataSource)||void 0===n?void 0:n.dataSourceId)});return(null==l?void 0:l.length)>0}var Nt=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function i(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}a((o=o.apply(e,t||[])).next())})};const kt={jimuName:j,alias:"ADDRESS",type:t.JimuFieldType.String,name:j},Ot=e=>Nt(void 0,void 0,void 0,function*(){return t.UtilityManager.getInstance().getUrlOfUseUtility(e).then(e=>Promise.resolve(e))});class Et extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use array of Schema to set displayFields",upgrader:e=>{var t,n;const o=null===(n=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===n?void 0:n.map(e=>((null==e?void 0:e.searchServiceType)===l.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[kt],e.addressFields=[kt],e.defaultAddressFieldName=kt.jimuName),e));return e.setIn(["datasourceConfig"],o)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:e=>Nt(this,void 0,void 0,function*(){var n,o;const r=null===(o=null===(n=null==e?void 0:e.asMutable({deep:!0}))||void 0===n?void 0:n.datasourceConfig)||void 0===o?void 0:o.map(e=>(null==e?void 0:e.searchServiceType)===l.FeatureService?Promise.resolve(e):Ot(null==e?void 0:e.useUtility).then(n=>Nt(this,void 0,void 0,function*(){return(0,t.loadArcGISJSAPIModules)(["esri/request"]).then(t=>{const[o]=t;return o(n,{query:{f:"json"},responseType:"json"}).then(t=>{var n;const o=(null==t?void 0:t.data)||{};if(null==o?void 0:o.capabilities){const t=(null===(n=null==o?void 0:o.capabilities)||void 0===n?void 0:n.split(","))||[],r=null==t?void 0:t.includes("Suggest");return e.isSupportSuggest=r,Promise.resolve(e)}return Promise.resolve(e)},t=>Promise.resolve(e))},t=>Promise.resolve(e))}))),i=r?yield Promise.all(r):[];return e.setIn(["datasourceConfig"],i)})},{version:"1.12.0",description:'For old search widgets, "enableFiltering" needs to be "true" by default, and the default value of "searchResultStyle" should be "Classic"',upgrader:e=>Nt(this,void 0,void 0,function*(){const n=yield(()=>Nt(this,void 0,void 0,function*(){var n,o;const r=null===(o=null===(n=null==e?void 0:e.asMutable({deep:!0}))||void 0===n?void 0:n.datasourceConfig)||void 0===o?void 0:o.map(e=>Nt(this,void 0,void 0,function*(){return(null==e?void 0:e.searchServiceType)===l.FeatureService?Promise.resolve(e):Ot(null==e?void 0:e.useUtility).then(n=>(0,t.loadArcGISJSAPIModules)(["esri/request"]).then(o=>{const[r]=o;return r(n,{query:{f:"json"},responseType:"json"}).then(n=>{const o=(null==n?void 0:n.data)||{};if(null==o?void 0:o.capabilities){const n=(null==o?void 0:o.candidateFields)||[],{addressFieldsSchema:r}=((e=[])=>{const n=null==e?void 0:e.map(e=>({jimuName:null==e?void 0:e.alias,alias:null==e?void 0:e.alias,type:t.JimuFieldType.String,name:null==e?void 0:e.alias})),o=xt(n,0),r={jimuName:o,alias:o,type:t.JimuFieldType.String,name:o};return n.unshift(r),{addressFieldsSchema:n,defaultAddressFieldName:o}})(n),l=((null==e?void 0:e.addressFields)||[]).concat(r);return e.addressFields=l,Promise.resolve(e)}return Promise.resolve(e)},t=>Promise.resolve(e))}))}));return r?yield Promise.all(r):[]}))();return e.setIn(["enableFiltering"],!0).setIn(["datasourceConfig"],n).setIn(["searchResultStyle"],c.Classic)})},{version:"1.15.0",description:"Add spatialReference for locator service",upgrader:e=>Nt(this,void 0,void 0,function*(){let n=!1;const o=yield(()=>Nt(this,void 0,void 0,function*(){var o,r;const i=null===(r=null===(o=null==e?void 0:e.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===r?void 0:r.map(e=>Nt(this,void 0,void 0,function*(){return(null==e?void 0:e.searchServiceType)===l.FeatureService?Promise.resolve(e):Ot(null==e?void 0:e.useUtility).then(o=>(0,t.loadArcGISJSAPIModules)(["esri/request"]).then(t=>{const[r]=t;return r(o,{query:{f:"json"},responseType:"json"}).then(t=>{const o=(null==t?void 0:t.data)||{};return(null==o?void 0:o.spatialReference)?(n=!0,e.spatialReference=o.spatialReference,Promise.resolve(e)):Promise.resolve(e)},t=>Promise.resolve(e))}))}));return i?yield Promise.all(i):[]}))(),r=e.setIn(["datasourceConfig"],o);return n?r:e})},{version:"1.16.0",description:"Update isAutoSelectFirstResult with searchResultView",upgrader:e=>{let t=e;return(null==e?void 0:e.searchResultView)===i.OtherWidgets&&(null==e?void 0:e.isAutoSelectFirstResult)&&(t=t.set("isAutoSelectFirstResult",!1)),t}},{version:"1.19.0",description:"Update zoomScale of geocode data source",upgrader:e=>{var t,o;const r=e=>{let t=!1;return{newDatasourceConfig:null==e?void 0:e.map(e=>{if((null==e?void 0:e.searchServiceType)===l.FeatureService)return e;if((null==e?void 0:e.useUtility)&&!(null==e?void 0:e.zoomScale)){const o=(0,n.getZoomScaleOfUseUtility)(null==e?void 0:e.useUtility);o&&(e.zoomScale=o,t=!0)}return e}),hadUpdateConfig:t}};let i=e;if(i.sourceType===v.MapCentric){const e=null===(t=null==i?void 0:i.dataSourceConfigWithMapCentric)||void 0===t?void 0:t.asMutable({deep:!0});Object.keys(e||{}).forEach(t=>{const n=null==e?void 0:e[t];if(!1===(null==n?void 0:n.synchronizeSettings)){const{newDatasourceConfig:e,hadUpdateConfig:o}=r(null==n?void 0:n.dataSourceConfig);if(o){const o=Object.assign(Object.assign({},n),{dataSourceConfig:e});i=i.setIn(["dataSourceConfigWithMapCentric",t],o)}}})}else{const{newDatasourceConfig:e,hadUpdateConfig:t}=r(null===(o=null==i?void 0:i.datasourceConfig)||void 0===o?void 0:o.asMutable({deep:!0}));t&&(i=i.setIn(["datasourceConfig"],e))}return i}}]}}const Ft=new Et;var At=function(e,t,n,o){return new(n||(n=Promise))(function(r,l){function i(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}a((o=o.apply(e,t||[])).next())})};const{useEffect:Ut,useState:Vt,useRef:Jt}=t.React,Gt=t.css`
  & {
    height: 32px;
    margin-top: 0;
    margin-left: 0;
  }
  &.search-con-in-controller {
    width: 300px !important;
  }
  &.search-con-Style3 {
    border-bottom: 1px solid var(--sys-color-divider-secondary);
  }
`,$t=o=>{const r=Jt(null),i=Jt(null),a=Jt(null),{config:u,id:c,useDataSources:d,useMapWidgetIds:h}=o,{resultMaxNumber:p}=u,m=Jt(null),f=Jt((0,t.Immutable)({})),S=Jt(!1),y=Jt((0,t.Immutable)({})),b=t.hooks.useTranslation(t.defaultMessages),[I,x]=Vt((0,t.Immutable)([])),[j,C]=Vt(!1),[M,R]=Vt(null),[D,T]=Vt((0,t.Immutable)({})),[L,P]=Vt((0,t.Immutable)({})),[N,k]=Vt((0,t.Immutable)({})),[O,E]=Vt(null),[F,A]=Vt(null),[U,V]=Vt(!1),[J,G]=Vt(null);Ut(()=>{const e=h&&(null==h?void 0:h.length)>0;(null==u?void 0:u.sourceType)!==v.MapCentric&&(E(null),i.current=null),(null==u?void 0:u.sourceType)===v.MapCentric&&e&&V(!0),(null==u?void 0:u.sourceType)===v.MapCentric&&i.current?e?$(u,i.current):(x((0,t.Immutable)([])),R(null),V(!1)):(!e&&V(!1),_(null==u?void 0:u.datasourceConfig)),r.current=u},[u,O,h]);const $=(e,o)=>At(void 0,void 0,void 0,function*(){var l,i,s;V(!0);const u=null==o?void 0:o.id,d=(null==e?void 0:e.dataSourceConfigWithMapCentric)!==(null===(l=r.current)||void 0===l?void 0:l.dataSourceConfigWithMapCentric)||(null==e?void 0:e.allowSearchSourceSelection)!==(null===(i=r.current)||void 0===i?void 0:i.allowSearchSourceSelection);let g=[];const h=null===(s=null==e?void 0:e.dataSourceConfigWithMapCentric)||void 0===s?void 0:s[u];!1!==(null==h?void 0:h.synchronizeSettings)&&(g=yield At(void 0,void 0,void 0,function*(){if(a.current)return Promise.resolve(F);{const e={nls:b,id:c,createOutputDs:!0,viewId:"default_geocode_custom",isSingle:!1,notAddNewUtility:!0};return(0,n.getMultipleDefaultGeocodeConfigInRuntime)(e).then(e=>(A(e),a.current=e,Promise.resolve(e)),e=>Promise.resolve([]))}}),yield Se(g)),function(e,n,o){return It(this,void 0,void 0,function*(){const r=null==e?void 0:e.id;if((null==n?void 0:n.sourceType)===v.MapCentric){const l=(null==n?void 0:n.dataSourceConfigWithMapCentric)||{},i=Object.keys(l)||[];let s;if(i.includes(r)?s=null==l?void 0:l[r]:(null==i?void 0:i.length)>0&&(s=null==l?void 0:l[i[0]]),!1===(null==s?void 0:s.synchronizeSettings))return Promise.resolve((0,t.Immutable)(null==s?void 0:s.dataSourceConfig));{const n={};return n[e.id]=e,wt(n).then(e=>{var n;let l=(null===(n=null==e?void 0:e[r])||void 0===n?void 0:n.dataSourceConfig)||[];const i=o||[];return l=l.concat(i),Promise.resolve((0,t.Immutable)(l))},e=>Promise.resolve((0,t.Immutable)(o)))}}return Promise.resolve(null==n?void 0:n.datasourceConfig)})}(o,e,g).then(e=>At(void 0,void 0,void 0,function*(){(S.current||d)&&(yield _(e),S.current=!1),V(!1)}),e=>{V(!1)})}),z=e=>{e&&x(e),X(e)},_=e=>At(void 0,void 0,void 0,function*(){const n=(e||(0,t.Immutable)([])).map(e=>At(void 0,void 0,void 0,function*(){const t=!1===(null==u?void 0:u.allowSearchSourceSelection)||W(e);let n=null==e?void 0:e.setIn(["enable"],t);return(null==e?void 0:e.useUtility)&&(yield K(e).then(e=>{n=n.setIn(["geocodeURL"],e)})),Promise.resolve(null==n?void 0:n.asMutable({deep:!0}))}));yield Promise.all(n).then(e=>{x((0,t.Immutable)(e)),X((0,t.Immutable)(e))})}),K=e=>At(void 0,void 0,void 0,function*(){var t;return(null===(t=null==e?void 0:e.useUtility)||void 0===t?void 0:t.utilityId)?B(null==e?void 0:e.useUtility):(null==e?void 0:e.geocodeURL)?Promise.resolve(null==e?void 0:e.geocodeURL):void 0}),W=e=>{if(I&&0!==(null==I?void 0:I.length)){let t=!0;return null==I||I.forEach(n=>{(null==e?void 0:e.configId)===(null==n?void 0:n.configId)&&(t=!!(null==n?void 0:n.enable))}),t}{const t=he(c),n=null==t?void 0:t.enabledList;return!n||n.includes(null==e?void 0:e.configId)}},B=e=>At(void 0,void 0,void 0,function*(){return t.UtilityManager.getInstance().getUrlOfUseUtility(e).then(e=>Promise.resolve(e))}),q=e=>{R(e)},H=e=>{G(e)},Q=()=>(null==u?void 0:u.arrangementStyle)===s.Style1||(null==u?void 0:u.arrangementStyle)===s.Style2||(null==u?void 0:u.arrangementStyle)===s.Style3||j,Z=e=>{C(e)},X=e=>{var n;let o=(0,t.Immutable)({});null===(n=null==e?void 0:e.asMutable({deep:!0}))||void 0===n||n.forEach(e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let n;n=(null==e?void 0:e.searchServiceType)===l.GeocodeService?ee(e):Y(e),o=o.setIn([t],n)}),R(o)},Y=t.hooks.useEventCallback(e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.GeocodeService)return!1;const{configId:n,useDataSource:o,displayFields:r,searchFields:i,searchExact:s,hint:a,searchServiceType:u,searchInCurrentMapExtent:c}=e,d=(null===(t=null==M?void 0:M[n])||void 0===t?void 0:t.asMutable({deep:!0}))||{},v={useDataSource:o,displayFields:r,searchFields:i,searchExact:s,resultMaxNumber:p,hint:a,searchServiceType:u,configId:n,searchInCurrentMapExtent:c};return Object.assign(d,v)}),ee=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.FeatureService)return!1;const{countryCode:n,configId:o,hint:r,zoomScale:i,geocodeURL:s,outputDataSourceId:a,label:u,searchInCurrentMapExtent:c,enableLocalSearch:d,minScale:v,searchServiceType:g,spatialReference:h,singleLineFieldName:m,displayFields:f,defaultAddressFieldName:S,addressFields:y,isSupportSuggest:b,useUtility:I}=e,x=(null===(t=null==M?void 0:M[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},w={hint:r,geocodeURL:s,outputDataSourceId:a,icon:null==e?void 0:e.icon,resultMaxNumber:p,label:u,searchServiceType:g,configId:o,singleLineFieldName:m||"",displayFields:f,defaultAddressFieldName:S,addressFields:y||[],isSupportSuggest:b,useUtility:I,spatialReference:h,countryCode:n,searchInCurrentMapExtent:c,enableLocalSearch:d,minScale:v,zoomScale:i};return Object.assign(x,w)},te=t.React.useCallback((e,n)=>{var o;if(((null==D?void 0:D[e])||[]).join(",")!==(null===(o=n||[])||void 0===o?void 0:o.join(","))){const o=D.set(e,n);T((0,t.Immutable)(o))}},[D]),ne=t.React.useCallback(()=>{T((0,t.Immutable)({}))},[]),oe=t.hooks.useEventCallback((e,t)=>{const n=f.current.setIn([t],e);P(n),f.current=n}),re=(e,t)=>{const n=y.current.set(e,t);k(n),y.current=n},le=e=>{var t;S.current=(null===(t=i.current)||void 0===t?void 0:t.id)!==(null==e?void 0:e.id),i.current=e,E(e)},ie=t.hooks.useEventCallback((e,t,n)=>!1!==n&&(e||(null==t?void 0:t.length)>1&&Q()));return(0,e.jsx)(t.ViewVisibilityContext.Consumer,{children:({isInView:n,isInCurrentView:o})=>{const r=!n||o;return(0,e.jsx)(t.PageVisibilityContext.Consumer,{children:t=>{var n,o,l,i;return(0,e.jsx)(g.Paper,{transparent:!0,className:"widget-search jimu-widget",children:(0,e.jsxs)("div",{className:`d-flex w-100 align-items-center search-con-${u.arrangementStyle}`,css:Gt,ref:m,children:[(0,e.jsx)("div",{children:ie(U,I,null==u?void 0:u.allowSearchSourceSelection)&&(0,e.jsx)(je,{showLoading:U,className:"h-100",config:u,dsStatus:N,datasourceConfig:I,id:c,useDataSources:d,onDatasourceConfigChange:z,synchronizeSettings:null===(o=null===(n=null==u?void 0:u.dataSourceConfigWithMapCentric)||void 0===n?void 0:n[null==O?void 0:O.id])||void 0===o?void 0:o.synchronizeSettings})}),(0,e.jsx)(mt,{showSearchSetting:ie(U,I,null==u?void 0:u.allowSearchSourceSelection),id:c,className:"flex-grow-1 h-100",reference:m,config:u,dsStatus:N,isShowSearchInput:Q(),onShowSearchInputChange:Z,isInCurrentView:r,isWidgetInCurrentPage:t,handleServiceListChange:q,handleSearchTextForConfirmSearchChange:H,searchResult:D,serviceList:M,selectionList:L,jimuMapView:O,datasourceConfig:I,loadingServiceList:U}),(0,e.jsx)(bt,{id:c,config:u,serviceList:M,dsStatus:N,jimuMapView:O,searchTextForConfirmSearch:J,handleSearchResultChange:te,handleSelectionListChange:oe,handleDsStatusChange:re,clearSearchResult:ne,synchronizeSettings:null===(i=null===(l=null==u?void 0:u.dataSourceConfigWithMapCentric)||void 0===l?void 0:l[null==O?void 0:O.id])||void 0===i?void 0:i.synchronizeSettings}),(null==u?void 0:u.sourceType)===v.MapCentric&&(0,e.jsx)(w.JimuMapViewComponent,{useMapWidgetId:null==h?void 0:h[0],onActiveViewChange:le})]})})}})}})};$t.versionManager=Ft;const zt=$t;function _t(e){a.p=e}})(),u})())}}});