System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder","jimu-arcgis"],function(e,t){var a={},n={},s={},l={},i={},o={},r={},c={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){n.AppMode=e.AppMode,n.CONSTANTS=e.CONSTANTS,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceTypes=e.DataSourceTypes,n.Immutable=e.Immutable,n.JSAPILayerTypes=e.JSAPILayerTypes,n.React=e.React,n.classNames=e.classNames,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.focusElementInKeyboardMode=e.focusElementInKeyboardMode,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.isKeyboardMode=e.isKeyboardMode,n.utils=e.utils,n.uuidv1=e.uuidv1},function(e){s.Alert=e.Alert,s.Button=e.Button,s.CollapsablePanel=e.CollapsablePanel,s.Collapse=e.Collapse,s.Icon=e.Icon,s.Label=e.Label,s.MultiSelect=e.MultiSelect,s.MultiSelectItem=e.MultiSelectItem,s.NumericInput=e.NumericInput,s.Radio=e.Radio,s.Select=e.Select,s.Switch=e.Switch,s.TextArea=e.TextArea,s.TextInput=e.TextInput,s.defaultMessages=e.defaultMessages},function(e){l.LayerSetting=e.LayerSetting,l.MapWidgetSelector=e.MapWidgetSelector,l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection,l.SidePopper=e.SidePopper},function(e){i.List=e.List},function(e){o.DataSourceSelector=e.DataSourceSelector},function(e){r.SqlExpressionBuilderPopup=e.SqlExpressionBuilderPopup},function(e){c.JimuMapViewComponent=e.JimuMapViewComponent,c.MapViewManager=e.MapViewManager}],execute:function(){e((()=>{var e={13089:e=>{"use strict";e.exports=o},14321:e=>{"use strict";e.exports=s},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},28359:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 3h12v2H2zm0 3v7h12V6zM1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1zm3 5h2v1H4zm8 0H7v1h5zm-8 2h2v1H4zm8 0H7v1h5z" clip-rule="evenodd"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=c},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=a},71442:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=l},98640:e=>{"use strict";e.exports=i}},t={};function u(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,u),s.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var d={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(d),u.d(d,{__set_webpack_public_path__:()=>ae,default:()=>te});var e=u(67386),t=u(79244);function a(e){const t=[];e.dataAttributeInfo&&e.dataAttributeInfo.dataSourceItems&&e.dataAttributeInfo.dataSourceItems.length>0&&e.dataAttributeInfo.dataSourceItems.forEach(e=>{const a=e.useDataSource.asMutable();t.push(a)}),e.mapInfo&&Object.values(e.mapInfo).forEach(e=>{const a=null==e?void 0:e.dataSourceItems;a&&a.length>0&&a.forEach(e=>{if(null==e?void 0:e.useDataSource){const a=e.useDataSource.asMutable();t.push(a)}})}),e.spatialSelection&&e.spatialSelection.useDataSources&&e.spatialSelection.useDataSources.length>0&&e.spatialSelection.useDataSources.forEach(e=>{const a=e.asMutable();t.push(a)});const a=[],n=[];if(t.forEach(e=>{const t=e.dataSourceId;a.includes(t)||(a.push(t),n.push(e))}),0!==n.length||!e.useMap)return n}function n(e,a){if(!a)return!1;const n=e.filter(e=>!!(null==e?void 0:e.useDataSource));if(0===n.length)return!0;if(n.find(e=>e.useDataSource.dataSourceId===a.dataSourceId||e.useDataSource.mainDataSourceId===a.mainDataSourceId))return!1;const s=t.DataSourceManager.getInstance(),l=s.getDataSource(a.mainDataSourceId);if(l)if(l.type===t.DataSourceTypes.SubtypeGroupLayer){if(n.some(e=>{const a=s.getDataSource(e.useDataSource.mainDataSourceId);return!(!a||a.type!==t.DataSourceTypes.SubtypeSublayer||a.parentDataSource!==l)}))return!1}else if(l.type===t.DataSourceTypes.SubtypeSublayer){if(n.some(e=>{const a=s.getDataSource(e.useDataSource.mainDataSourceId);return!(!a||a.type!==t.DataSourceTypes.SubtypeGroupLayer||l.parentDataSource!==a)}))return!1}return!0}const s={_widgetLabel:"Select",sourceLabel:"Source",selectByAttrbute:"Select by attributes",newData:"New data",allowGeneratedData:"Allow selection of data generated at runtime",configureLayerAttribute:"Configure layer attribute",labelForAttribution:"Label for attribution",spatialSelection:"Spatial selection",selectByData:"Select by data",addSelectingData:"Add selecting data",selectableLayers:"Selectable layers",interactiveSelection:"Interactive selection",atLeastOneToolTip:"At least one interactive tool is required.",interactiveSelectionMode:"Interactive selection mode",partiallyWithin:"Partially within",whollyWithin:"Wholly within",addAttributionTip:"Add label for attribution",noDataSourceTooltip:"Click the \u201cNew data\u201d button to add and configure data sources to be selected.",selectionViewOnly:"Support selected features view only"};var l=u(14321),i=u(79298),o=u(98640),r=u(23662),c=u.n(r),p=u(62838),S=u.n(p),m=u(13089);const f=[t.DataSourceTypes.FeatureLayer,t.DataSourceTypes.SceneLayer,t.DataSourceTypes.BuildingComponentSubLayer,t.DataSourceTypes.OrientedImageryLayer,t.DataSourceTypes.ImageryLayer,t.DataSourceTypes.SubtypeGroupLayer,t.DataSourceTypes.SubtypeSublayer],g=(0,t.Immutable)(f);const h=[t.JSAPILayerTypes.FeatureLayer,t.JSAPILayerTypes.SceneLayer,t.JSAPILayerTypes.BuildingComponentSublayer,t.JSAPILayerTypes.OrientedImageryLayer,t.JSAPILayerTypes.ImageryLayer,t.JSAPILayerTypes.SubtypeGroupLayer,t.JSAPILayerTypes.SubtypeSublayer];function b(e,t){let a=e;if(e&&e.length>0){const n=[];t&&t.length>0&&t.forEach(e=>{const t=null==e?void 0:e.dataSourceId;t&&n.push(t)});let s=!1;const l=e.filter(e=>{const t=null==e?void 0:e.useDataSource,a=null==t?void 0:t.dataSourceId,l=a&&n.includes(a);return l||(s=!0),l});a=s?l:e}return a||(a=e),a}function y(e,t){const a=t.slice();return e&&a.sort((t,a)=>{const n=I(e,t),s=I(e,a);return n&&s?function(e,t){const a=e.split(".").map(e=>parseInt(e)),n=t.split(".").map(e=>parseInt(e));for(;a.length>0&&n.length>0;){const e=a.shift(),t=n.shift();if(e<t)return-1;if(e>t)return 1}if(a.length>0)return 1;if(n.length>0)return-1;return 0}(n,s):0}),a}function I(e,t){let a="";if(e&&t){const n=t.jimuLayerViewId;if(n){const t=e.jimuLayerViews[n];t&&(a=t.hierarchyLevel)}}return a}function v(){var e;const a=function(){var e;return(null===(e=window.jimuConfig)||void 0===e?void 0:e.isBuilder)?(0,t.getAppStore)().getState().appStateInBuilder:(0,t.getAppStore)().getState()}();return(null===(e=null==a?void 0:a.appRuntimeInfo)||void 0===e?void 0:e.appMode)===t.AppMode.Express}function x(o){const r=o.rootSettingProps,{id:c,config:u}=r,d=t.hooks.useTranslation(l.defaultMessages,s),p=t.React.useCallback(e=>{const s=e&&e[0];if(!s)return;if(!n(u.dataAttributeInfo.dataSourceItems,s))return;const l=(0,t.uuidv1)(),i={uid:l,sqlHint:"",useDataSource:s},d=u.dataAttributeInfo.dataSourceItems.concat(i),p=u.setIn(["dataAttributeInfo","dataSourceItems"],d),S=a(p);r.onSettingChange({id:c,config:p,useDataSources:S}),o.onSelectNewDataSourceItem(l)},[u,o,r,c]);return(0,e.jsx)(i.SettingSection,{title:d("sourceLabel"),children:(0,e.jsx)(i.SettingRow,{"aria-label":d("sourceLabel"),role:"group",children:(0,e.jsx)(m.DataSourceSelector,{widgetId:c,isMultiple:!1,mustUseDataSource:!0,types:g,hideDataView:!0,hideCreateViewButton:!0,onChange:p})})})}var w=u(71442);function j(o){var r,c;const[u,d]=t.React.useState(!1),{rootSettingProps:p,currentDataSourceItem:S,lastSelectNewDataSourceItemTimestampRef:f}=o,{id:h,config:b}=p,y=t.React.useRef(null),I=t.React.useRef(null);I.current=null==f?void 0:f.current,t.React.useEffect(()=>{const e=I.current;if("number"==typeof e&&e>0){if(Date.now()-e<1e3&&y.current){const e=y.current.querySelector(".ds-item");if(e){(0,t.isKeyboardMode)()&&setTimeout(()=>{(0,t.focusElementInKeyboardMode)(e)},60)}}}},[]);const v=t.hooks.useTranslation(l.defaultMessages,s),x=(0,t.Immutable)(S),j=(0,t.Immutable)([S.useDataSource]),R=S.sqlHint||"",C=t.DataSourceManager.getInstance().getDataSource(S.useDataSource.dataSourceId);let D=(null===(r=x.sqlExpression)||void 0===r?void 0:r.displaySQL)||"";x.sqlExpression&&C&&(D=null===(c=t.dataSourceUtils.getArcGISSQL(x.sqlExpression,C))||void 0===c?void 0:c.displaySQL),D=D||"";const M=t.React.useCallback(e=>{const t=b.dataAttributeInfo.dataSourceItems.map(t=>t.uid===S.uid?e:t),n=b.setIn(["dataAttributeInfo","dataSourceItems"],t),s=a(n);p.onSettingChange({id:h,config:n,useDataSources:s})},[b,S.uid,p,h]),L=t.React.useCallback(e=>{var t;const a=e&&e[0];if(!a)return;const s=null===(t=null==x?void 0:x.useDataSource)||void 0===t?void 0:t.dataSourceId;let l=null;l=s?b.dataAttributeInfo.dataSourceItems.filter(e=>{var t;return(null===(t=e.useDataSource)||void 0===t?void 0:t.dataSourceId)!==s}):b.dataAttributeInfo.dataSourceItems;if(!n(l,a))return;const i=x.set("useDataSource",a).set("sqlExpression",null);M(i)},[x,M,b]),k=t.React.useCallback(e=>{const t=e.target.value,a=x.set("sqlHint",t);M(a)},[x,M]),A=t.React.useCallback(()=>{d(!0)},[d]),T=t.React.useCallback(()=>{d(!1)},[d]),E=t.React.useCallback(e=>{const t=x.set("sqlExpression",e);M(t)},[x,M]),N=t.React.useId();return(0,e.jsxs)("div",{ref:y,children:[(0,e.jsx)(i.SettingSection,{title:v("sourceLabel"),children:(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(m.DataSourceSelector,{widgetId:h,isMultiple:!1,types:g,mustUseDataSource:!0,hideDataView:!0,hideCreateViewButton:!0,useDataSources:j,onChange:L,disableRemove:()=>!0})})}),(0,e.jsx)(i.SettingSection,{title:v("labelForAttribution"),children:(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(l.TextInput,{className:"w-100",size:"sm",value:R,"aria-label":v(R?"labelForAttribution":"addAttributionTip"),onChange:k})})}),(0,e.jsxs)(i.SettingSection,{title:v("sqlExpr"),"aria-label":v("sqlExpr"),role:"group",children:[(0,e.jsxs)(i.SettingRow,{flow:"wrap",truncateLabel:!0,label:v("addSqlExprForSelection"),children:[(0,e.jsx)("span",{id:N,className:"d-none",children:v("addSqlExprForSelection")}),(0,e.jsx)(l.Button,{className:"w-100 text-default set-link-btn",type:"primary",disabled:!1,onClick:A,title:v("sqlExpressionBuilder"),"aria-describedby":N,children:v("sqlExpressionBuilder")})]}),(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(l.TextArea,{height:80,value:D,spellCheck:!1,readOnly:!0,placeholder:D?"":v("addSqlExprFirst"),onClick:e=>{e.currentTarget.select()}})}),C&&(0,e.jsx)(w.SqlExpressionBuilderPopup,{dataSource:C,isOpen:u,toggle:T,expression:x.sqlExpression,onChange:E})]})]})}function R(a){const{checked:n,titleKey:o,onSwitchChange:r}=a,c=!!a.disabled,u=t.hooks.useTranslation(l.defaultMessages,s);return(0,e.jsx)(i.SettingRow,{className:(0,t.classNames)("w-100",a.className),tag:"label",label:u(o),children:(0,e.jsx)(l.Switch,{checked:n,disabled:c,onChange:r})})}var C=u(31027),D=u.n(C),M=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const L=a=>{const n=window.SVG,{className:s}=a,l=M(a,["className"]),i=(0,t.classNames)("jimu-icon jimu-icon-component",s);return n?(0,e.jsx)(n,Object.assign({className:i,src:D()},l)):(0,e.jsx)("svg",Object.assign({className:i},l))},k=t.css`
  flex-direction: column;
  font-size: 0.875rem;
  text-align: center;
  color: var(--ref-palette-neutral-1000);
  span {
    padding: 0 1rem;
  }
`,A=t=>{const{text:a,style:n}=t;return(0,e.jsxs)("div",{css:k,style:n,className:"d-flex align-items-center justify-content-center",children:[(0,e.jsx)(L,{size:48,color:"var(--ref-palette-neutral-800)"}),(0,e.jsx)("span",{className:"mt-4",children:a})]})};var T,E=u(28359),N=u.n(E);function P(n){const{rootSettingProps:r}=n,{id:u,config:d,useDataSources:p,onSettingChange:m}=r,{dataAttributeInfo:f}=d,g=f.dataSourceItems,h=!!f.allowGenerated,y=t.React.useMemo(()=>b(g,p),[g,p]),I=(null==y?void 0:y.length)>0,w=t.hooks.useTranslation(l.defaultMessages,s),[C,D]=t.React.useState({}),M=t.React.useRef(null),L=t.React.useRef(null),k=t.React.useRef(null),E=t.React.useRef(null),[P,V]=t.React.useState({status:T.None,currentDataSourceItemUid:null}),O=t.React.useMemo(()=>{let e=null;return P.currentDataSourceItemUid&&(e=g.find(e=>e.uid===P.currentDataSourceItemUid)),e},[P.currentDataSourceItemUid,g]),q=P.status===T.AddNew,B=P.status===T.ShowDetail&&!!O,W=t.React.useCallback(e=>{e&&D(t=>{const a=e.id;return Object.assign({},t,{[a]:e})})},[D]),J=t.React.useCallback(()=>{V({status:T.None,currentDataSourceItemUid:null})},[V]),U=t.React.useCallback(e=>{V({status:T.ShowDetail,currentDataSourceItemUid:e})},[V]),_=t.React.useCallback(()=>{V({status:T.AddNew,currentDataSourceItemUid:null})},[V]),z=t.React.useCallback((e,t)=>{const a=d.setIn(["dataAttributeInfo","allowGenerated"],t);m({id:u,config:a})},[d,m,u]),F=t.React.useRef(null),G=t.React.useCallback(e=>{F.current=Date.now(),E.current=M.current,U(e)},[U]),H=t.React.useCallback(()=>{J()},[J]),K=t.React.useCallback(()=>{J()},[J]),Q=t.React.useCallback(e=>{O&&O.uid===e&&J();const t=g.filter(t=>t.uid!==e),n=d.setIn(["dataAttributeInfo","dataSourceItems"],t),s=a(n);m({id:u,config:n,useDataSources:s})},[d,O,g,m,J,u]),$=[];L.current&&$.push(L.current),k.current&&$.push(k.current);const X=null==P?void 0:P.currentDataSourceItemUid,Y=t.React.useCallback(e=>{var t;const a=null===(t=null==e?void 0:e.props)||void 0===t?void 0:t.itemJsons,n=(null==a?void 0:a.length)>0?a[0]:null;if(n){let e=null;const t=n.itemKey;if(t)if(t===X)E.current=null,J();else{if((null==g?void 0:g.length)>0){const a=g.findIndex(e=>(null==e?void 0:e.uid)===t);if(a>=0){const t=k.current.getElementsByClassName("jimu-tree-item__body");t&&t.length>0&&a<=t.length-1&&(e=t[a])}}E.current=e,U(t)}}},[X,g,J,U]),Z=t.React.useMemo(()=>{const e=[];return y.forEach(t=>{var a,n;const s=t.useDataSource.dataSourceId,l=!(!O||s!==O.useDataSource.dataSourceId);let i="";const o=C[s];o&&(i=o.getLabel());const r=[{label:w("remove"),iconProps:()=>({icon:S(),size:12}),action:({data:e})=>{const t=null==e?void 0:e.itemJsons,a=(null==t?void 0:t.length)>0?t[0]:null;if(a){const e=a.itemKey;Q(e)}}}];(null===(n=null===(a=t.sqlExpression)||void 0===a?void 0:a.parts)||void 0===n?void 0:n.length)>0&&r.unshift({label:"",iconProps:{icon:N(),size:16},action:({data:e})=>{Y(null==e?void 0:e.refComponent)}});const c={itemKey:t.uid,itemStateChecked:l,itemStateTitle:i,itemStateCommands:r};e.push(c)}),e},[O,C,y,Q,Y,w]),ee=!I&&!v(),te=t.React.useId();return(0,e.jsxs)(t.React.Fragment,{children:[g.map(a=>{const n=a.useDataSource;return(0,e.jsx)(t.DataSourceComponent,{useDataSource:n,onDataSourceCreated:W},n.dataSourceId)}),(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)("div",{className:"w-100",ref:L,children:(0,e.jsx)(l.Button,{className:"w-100 text-default set-link-btn",onClick:_,type:"primary","aria-label":w("newData"),"aria-describedby":te,ref:M,children:(0,e.jsxs)("div",{className:"w-100 px-2 text-truncate",children:[(0,e.jsx)(l.Icon,{icon:c(),className:"mr-1",size:14}),w("newData")]})})})}),ee&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(A,{text:w("noDataSourceTooltip"),style:{height:"calc(100% - 15rem)"}}),(0,e.jsx)("span",{id:te,className:"d-none",children:w("noDataSourceTooltip")})]}),I&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(i.SettingRow,{flow:"wrap",label:w("selectableLayers"),"aria-label":w("selectableLayers"),role:"group",children:(0,e.jsx)(R,{checked:h,titleKey:"allowGeneratedData",onSwitchChange:z})}),(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)("div",{className:"w-100",ref:k,children:(0,e.jsx)(o.List,{dndEnabled:!1,showCheckbox:!1,itemsJson:Z,onClickItemBody:(e,t)=>{Y(t)}})})})]}),(0,e.jsx)(i.SidePopper,{isOpen:q,toggle:H,position:"right",trigger:$,backToFocusNode:B?null:M.current,title:w("configureLayerAttribute"),children:q&&(0,e.jsx)(x,{rootSettingProps:r,onSelectNewDataSourceItem:G})}),(0,e.jsx)(i.SidePopper,{isOpen:B,toggle:K,position:"right",trigger:$,backToFocusNode:E.current,title:w("configureLayerAttribute"),children:B&&(0,e.jsx)(j,{rootSettingProps:r,currentDataSourceItem:O,lastSelectNewDataSourceItemTimestampRef:F})})]})}!function(e){e.None="None",e.AddNew="AddNew",e.ShowDetail="ShowDetail"}(T||(T={}));var V,O=u(62686);!function(e){e.Intersects="Intersects",e.Contains="Contains",e.Crosses="Crosses",e.EnvelopeIntersects="EnvelopeIntersects",e.IndexIntersects="IndexIntersects",e.Overlaps="Overlaps",e.Touches="Touches",e.Within="Within"}(V||(V={}));V.Intersects,V.Contains,V.Crosses,V.EnvelopeIntersects,V.IndexIntersects,V.Overlaps,V.Touches,V.Within;const q={[V.Intersects]:"spatialRelation_Intersect",[V.Contains]:"spatialRelation_Contain",[V.Crosses]:"spatialRelation_Cross",[V.EnvelopeIntersects]:"spatialRelation_EnvelopeIntersect",[V.IndexIntersects]:"spatialRelation_IndexIntersect",[V.Overlaps]:"spatialRelation_Overlap",[V.Touches]:"spatialRelation_Touch",[V.Within]:"spatialRelation_Within"};var B;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(B||(B={}));B.Miles,B.Kilometers,B.Feet,B.Meters,B.NauticalMiles;function W(){return{enable:!1,distance:0,unit:B.Meters}}function J(){const e=W();return{enable:!1,useDataSources:[],relationships:[V.Intersects],buffer:e}}var U;function _(){return{tools:[U.Rectangle],partiallyWithin:!0}}!function(e){e.Point="point",e.Polyline="polyline",e.Rectangle="rectangle",e.Circle="circle",e.Polygon="polygon"}(U||(U={}));var z=function(e,t,a,n){return new(a||(a=Promise))(function(s,l){function i(e){try{r(n.next(e))}catch(e){l(e)}}function o(e){try{r(n.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(i,o)}r((n=n.apply(e,t||[])).next())})};function F(a){var n,o;const{jimuMapView:r,currentDataSourceItem:c,onLayerItemDetailUpdate:u}=a,{jimuLayerViewId:d}=c,p=(0,t.Immutable)(c),S=p.sqlHint||"",m=t.hooks.useTranslation(l.defaultMessages,s),[f,g]=t.React.useState(!1),[h,b]=t.React.useState(null);let y=(null===(n=p.sqlExpression)||void 0===n?void 0:n.displaySQL)||"";p.sqlExpression&&h&&(y=null===(o=t.dataSourceUtils.getArcGISSQL(p.sqlExpression,h))||void 0===o?void 0:o.displaySQL),y=y||"",t.React.useEffect(()=>{!function(){z(this,void 0,void 0,function*(){try{if(r&&d){const e=yield r.whenJimuLayerViewLoaded(d);if(e){const t=yield e.createLayerDataSource();t&&b(t)}}}catch(e){console.error("LayerItemDetail create data source err",e)}})}()},[d,r]);const I=t.React.useCallback(e=>{const t=e.target.value,a=p.set("sqlHint",t);u(a)},[p,u]),v=t.React.useCallback(()=>{g(!0)},[g]),x=t.React.useCallback(()=>{g(!1)},[g]),j=t.React.useCallback(e=>{const t=p.set("sqlExpression",e);u(t)},[p,u]),R=t.React.useId();return(0,e.jsxs)("div",{children:[(0,e.jsx)(i.SettingSection,{title:m("labelForAttribution"),children:(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(l.TextInput,{className:"w-100",size:"sm",value:S,"aria-label":m(S?"labelForAttribution":"addAttributionTip"),onChange:I})})}),(0,e.jsxs)(i.SettingSection,{title:m("sqlExpr"),"aria-label":m("sqlExpr"),role:"group",children:[(0,e.jsxs)(i.SettingRow,{flow:"wrap",truncateLabel:!0,label:m("addSqlExprForSelection"),children:[(0,e.jsx)("span",{id:R,className:"d-none",children:m("addSqlExprForSelection")}),(0,e.jsx)(l.Button,{className:"w-100 text-default set-link-btn",type:"primary",disabled:!1,onClick:v,title:m("sqlExpressionBuilder"),"aria-describedby":R,children:m("sqlExpressionBuilder")})]}),(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(l.TextArea,{height:80,value:y,spellCheck:!1,readOnly:!0,placeholder:y?"":m("addSqlExprFirst"),onClick:e=>{e.currentTarget.select()}})}),h&&(0,e.jsx)(w.SqlExpressionBuilderPopup,{dataSource:h,isOpen:f,toggle:x,expression:p.sqlExpression,onChange:j})]})]})}var G=function(e,t,a,n){return new(a||(a=Promise))(function(s,l){function i(e){try{r(n.next(e))}catch(e){l(e)}}function o(e){try{r(n.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(i,o)}r((n=n.apply(e,t||[])).next())})};function H(e){const a=(0,t.uuidv1)(),n=function(e){const t=e.getLayerDataSource(),a=t.id,n=t.getMainDataSource(),s=t.getRootDataSource(),l=n?n.id:a,i=s?s.id:"",o={dataSourceId:a,mainDataSourceId:l,rootDataSourceId:i};return o}(e);return{uid:a,sqlHint:"",useDataSource:n,sqlExpression:null,jimuLayerViewId:e.id}}const K=t.React.memo(function(n){const{rootSettingProps:o}=n,{id:r,config:c,useMapWidgetIds:u,onSettingChange:d}=o,p=c.mapInfo||function(){const e={};return(0,t.Immutable)(e)}(),S=t.hooks.useTranslation(l.defaultMessages,s),m=u&&u.length>0?u[0]:"",[f,g]=t.React.useState([]),b=t.React.useCallback(e=>{e||(e=[]);const t=c.set("mapInfo",{}),n=a(t);d({id:r,config:t,useMapWidgetIds:e,useDataSources:n})},[c,d,r]);t.React.useEffect(()=>{g(e=>e.filter(e=>e.mapWidgetId===m))},[m,g]);const I=t.React.useCallback(e=>{const t=Object.values(e).filter(e=>e.dataSourceId&&e.mapWidgetId===m);g(t)},[m,g]),x=t.React.useCallback((e,t)=>{if(!e)return;const n=p.set(e,t),s=c.set("mapInfo",n),l=a(s);d({id:r,config:s,useDataSources:l})},[c,p,d,r]),w=t.React.useCallback((e,t,a)=>{if(e&&t){const n=t.set("dataSourceItems",a);x(e,n)}},[x]),j=t.React.useCallback(e=>p&&e&&p[e]||null,[p]),C=function(e){const a=[];if(e){const s=window.jimuConfig.isBuilder?null===(n=(0,t.getAppStore)().getState().appStateInBuilder)||void 0===n?void 0:n.appConfig:(0,t.getAppStore)().getState().appConfig;if(s.widgets){const t=s.widgets[e];if(t){const n=t.useDataSources;n&&n.length>0&&n.forEach(t=>{const n=null==t?void 0:t.dataSourceId;if(n){const t=e+"-"+n;a.push(t)}})}}}var n;return a}(m),D=(Object.keys(p)||[]).filter(e=>!C.includes(e));t.React.useEffect(()=>{if(D.length>0){const e=p.without(...D),t=c.set("mapInfo",e),n=a(t);d({id:r,config:t,useDataSources:n})}},[c,p,D,d,r]);const M=0===D.length,L=!m&&!v(),k=t.React.useId(),[T,E]=t.React.useState(null),[P,V]=t.React.useState(null),[q,B]=t.React.useState({}),W=t.React.useRef(null);W.current=q;const J=t.React.useMemo(()=>{let e=!1;return T&&q[T]&&(e=!0),e},[q,T]),U=t.React.useMemo(()=>{let e=null;return T&&(null==f?void 0:f.length)>0&&(e=f.find(e=>e.id===T)),e},[T,f]),_=t.React.useMemo(()=>p&&T&&p[T]||function(){const e={syncWithMap:!0,allowGenerated:!0,enableAttributeSelection:!1,dataSourceItems:void 0};return(0,t.Immutable)(e)}(),[T,p]),z=!!_.syncWithMap,K=!z,Q=!!_.allowGenerated,$=!!_.enableAttributeSelection,X=_.dataSourceItems,Y=!X,Z=t.React.useRef(Y);Z.current=Y;const ee=t.React.useMemo(()=>(0,t.Immutable)(X||[]),[X]),te=t.React.useMemo(()=>{let e=null;return T&&q&&(e=q[T]),e||(e=[]),e},[q,T]),ae=t.React.useMemo(()=>{const e={};return te.forEach(t=>{e[t.id]=!0;t.getAllAncestorJimuLayerViews().forEach(t=>{e[t.id]=!0})}),e},[te]),ne=t.React.useCallback(e=>{T&&_&&w(T,_,e)},[T,_,w]),se=t.React.useMemo(()=>{var e;return e=Q,!!z||e},[Q,z]),le=t.React.useMemo(()=>{const e={};if(p){const a=Object.keys(p);a.length>0&&a.forEach(a=>{const n=p[a],s=null==n?void 0:n.dataSourceItems,l=[];(null==s?void 0:s.length)>0&&s.forEach(e=>{l.push(e.jimuLayerViewId)}),e[a]=(0,t.Immutable)(l)})}return T&&!e[T]&&(e[T]=(0,t.Immutable)([])),e},[T,p]),ie=t.React.useCallback(e=>{if(!T)return;const a=!e;let n=_.set("syncWithMap",a);if(a)n=n.set("allowGenerated",!0).set("enableAttributeSelection",!1).set("dataSourceItems",void 0);else{let e=null;if(U&&J&&Z.current){const a=te.filter(e=>{var a,n;if(!e.isLayerVisible())return!1;if(!e.getLayerDataSource())return!1;if(e.type===t.JSAPILayerTypes.SubtypeGroupLayer){if((null===(n=null===(a=e.layer)||void 0===a?void 0:a.sublayers)||void 0===n?void 0:n.length)>0)return!1}return!0}).map(e=>H(e)),n=y(U,a);e=(0,t.Immutable)(n)}e||(e=(0,t.Immutable)([])),n=n.set("dataSourceItems",e)}x(T,n)},[te,J,U,_,T,x]),oe=t.React.useCallback(e=>{if(!T)return;const t=_.set("allowGenerated",e);x(T,t)},[_,T,x]),re=t.React.useCallback((e,t)=>{if(!T)return;let a=_.set("enableAttributeSelection",t);if(!t){const e=ee.map(e=>e.set("sqlExpression",null));a=a.set("dataSourceItems",e)}x(T,a)},[ee,_,T,x]),ce=t.React.useCallback(e=>{const t=e.id;return!ae[t]},[ae]),ue=t.React.useCallback(e=>!te.includes(e),[te]),de=t.React.useCallback(e=>{if(!U)return;if(!J)return;e=Array.from(new Set(e));let a=[];const n=ee.map(e=>e.jimuLayerViewId).asMutable(),{added:s}=t.utils.diffArrays(!0,n,e);s.forEach(e=>{var n;if(e){const s=null===(n=U.jimuLayerViews)||void 0===n?void 0:n[e];if(s)if(s.type===t.JSAPILayerTypes.SubtypeGroupLayer){const e=U.getChildJimuLayerViewIds(s.id);a.push(...e)}else s.type===t.JSAPILayerTypes.SubtypeSublayer&&s.parentJimuLayerViewId&&a.push(s.parentJimuLayerViewId)}}),a=Array.from(new Set(a)),e=e.filter(e=>!a.includes(e)),e=Array.from(new Set(e));const l=te.map(e=>e.id);let{saved:i}=t.utils.diffArrays(!0,e,l);i=Array.from(new Set(i));const o={};ee.forEach(e=>{const t=e.jimuLayerViewId;o[t]=e.asMutable()});const r=[];i.forEach(e=>{let t=o[e];if(!t&&U){const a=U.jimuLayerViews[e];a&&(t=H(a))}t&&r.push(t)});const c=(0,t.Immutable)(r);ne(c)},[te,ee,J,U,ne]),pe=t.React.useCallback(e=>{E(`${m}-${e}`)},[m]);t.React.useEffect(()=>{var e;if(!U)return;const a=U.id;(null===(e=W.current)||void 0===e?void 0:e[a])||function(){G(this,void 0,void 0,function*(){var e;const n=yield U.whenAllJimuLayerViewLoaded(),s=Object.values(n).filter(e=>!e.fromRuntime&&function(e){if(!e||!e.type)return!1;const a=e.type,n=a!==t.JSAPILayerTypes.BuildingComponentSublayer||a===t.JSAPILayerTypes.BuildingComponentSublayer&&e.view;return!(!h.includes(a)||!n)}(e)),l=s.map(e=>e.createLayerDataSource());try{yield Promise.all(l)}catch(e){console.log(e)}var i;U.isActive||(yield(i=500,new Promise(e=>{setTimeout(()=>{e()},i)})));const o=s.filter(e=>!!e.getLayerDataSource());(null===(e=W.current)||void 0===e?void 0:e[a])||B(e=>{const t=Object.assign({},e);return t[a]=o,t})})}()},[U]);const Se=t.React.useMemo(()=>{var e;let t=null;if(P){const a=P.jimuLayerViewId,n=P.jimuMapViewId,s=j(n);t=(null===(e=null==s?void 0:s.dataSourceItems)||void 0===e?void 0:e.find(e=>e.jimuLayerViewId===a))||null}return t},[P,j]),me=t.React.useCallback((e,t)=>{if(e&&t){const e=j(t);return!!(null==e?void 0:e.enableAttributeSelection)}return!1},[j]),fe=t.React.useCallback((e,t)=>!me(e,t),[me]),ge=t.React.useCallback((e,t)=>{var a,n,s;if(e&&t){const l=j(t),i=e&&(null===(a=null==l?void 0:l.dataSourceItems)||void 0===a?void 0:a.find(t=>t.jimuLayerViewId===e));return(null===(s=null===(n=null==i?void 0:i.sqlExpression)||void 0===n?void 0:n.parts)||void 0===s?void 0:s.length)>0?N():null}},[j]),he=t.React.useCallback((e,t)=>{let a=null;if(e&&t&&me(e,t)){const n=O.MapViewManager.getInstance().getJimuMapViewById(t);n?a={jimuLayerViewId:e,jimuMapViewId:t,jimuMapView:n}:console.error("can not get JimuMapView in onLayerItemClick prop of LayerSetting")}V(a)},[me]),be=t.React.useCallback((e,a)=>{if(e&&(null==a?void 0:a.length)>0){const n=j(e);if(n){const s=null==n?void 0:n.dataSourceItems,l={},i=[];(null==s?void 0:s.length)>0&&s.forEach(e=>{const t=null==e?void 0:e.jimuLayerViewId;t&&(l[t]=e,i.push(t))});const o=i.join(","),r=[];a.forEach(e=>{const t=null==e?void 0:e.itemKey;t&&r.push(t)});if(r.join(",")!==o){const a=[];r.forEach(e=>{const t=l[e];t&&a.push(t)});const s=(0,t.Immutable)(a);w(e,n,s)}}}},[j,w]),ye=t.React.useCallback(e=>{if(P&&Se&&e){const t=P.jimuMapViewId;if(t&&Se&&e.uid&&e.uid===Se.uid){const a=j(t);if(a){const n=a.dataSourceItems;if((null==n?void 0:n.length)>0){const s=n.map(t=>e.jimuLayerViewId&&t.jimuLayerViewId===e.jimuLayerViewId?e:t);w(t,a,s)}}}}},[P,Se,j,w]),Ie=z?null:(0,e.jsx)(R,{disabled:z,checked:(ve=z,xe=$,!ve&&xe),titleKey:"attributeSelection",className:"mt-3",onSwitchChange:re});var ve,xe;return(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(i.MapWidgetSelector,{useMapWidgetIds:u,"aria-describedby":k,onSelect:b})}),L&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)("span",{id:k,className:"d-none",children:S("selectMapHint")}),(0,e.jsx)(A,{text:S("selectMapHint"),style:{height:"calc(100% - 15rem)"}})]}),m&&(0,e.jsxs)(i.SettingRow,{children:[(0,e.jsx)(O.JimuMapViewComponent,{useMapWidgetId:m,onViewsCreate:I}),M&&(0,e.jsx)(i.LayerSetting,{mapWidgetId:m,disableSwitchMap:!0,onMapItemClick:pe,mapViewId:T,isJlvLoading:T&&!J,isCustomizeEnabled:K,isShowRuntimeAddedLayerEnabled:se,extraSettingOptions:Ie,selectedValues:le,showTable:!1,onToggleCustomize:ie,onShowRuntimeAddedLayersChange:oe,hideLayers:ce,disableLayers:ue,onSelectedLayerIdChange:de,showSelectedLayers:!0,dndEnabled:!0,isLayerDisabled:fe,getLayerCustomIcon:ge,onLayerItemClick:he,onLayerReorder:be,children:P&&P.jimuMapView&&Se&&(0,e.jsx)(F,{jimuMapView:P.jimuMapView,currentDataSourceItem:Se,onLayerItemDetailUpdate:ye})})]})]})}),Q=t.css`
.select-source-type-radio {
  cursor: pointer;
}

.select-source-type-label {
  cursor: pointer;
  word-break: break-all;
}

.multiple-jimu-map-config-component .jimu-tree .jimu-tree-command-list > button {
  pointer-events: none;
}
`;function $(a){const{rootSettingProps:n,showPlaceholder:o,onConfigUpdate:r}=a,{config:c}=n,u=t.hooks.useTranslation(l.defaultMessages,s),d=!c.useMap,p=c.useMap,S=t.React.useCallback(e=>{let t=c.set("useMap",!1);if(!t.dataAttributeInfo){const e={allowGenerated:!1,dataSourceItems:[]};t=t.set("dataAttributeInfo",e)}t=t.set("mapInfo",{}),r(t)},[c,r]),m=t.React.useCallback(e=>{let t=c.set("useMap",!0);if(!t.mapInfo){const e={};t=t.set("mapInfo",e)}t.dataAttributeInfo&&(t=t.setIn(["dataAttributeInfo","dataSourceItems"],[])),r(t)},[c,r]),f=o?"h-100":"";return(0,e.jsxs)(i.SettingSection,{title:u("sourceLabel"),className:f,css:Q,children:[(0,e.jsx)(i.SettingRow,{children:(0,e.jsxs)("div",{className:"source-radios",role:"radiogroup","aria-label":u("sourceLabel"),children:[(0,e.jsxs)("div",{className:"source-radio d-flex",children:[(0,e.jsx)(l.Radio,{id:"select-source-ds-radio",name:"select-source",checked:d,className:"select-source-type-radio",onChange:S}),(0,e.jsx)(l.Label,{for:"select-source-ds-radio",className:"ml-1 select-source-type-label","aria-label":u("selectByAttrbute"),children:u("selectByAttrbute")})]}),(0,e.jsxs)("div",{className:"source-radio d-flex mt-3",children:[(0,e.jsx)(l.Radio,{id:"select-source-map-radio",name:"select-source",checked:p,className:"select-source-type-radio",onChange:m}),(0,e.jsx)(l.Label,{for:"select-source-map-radio",className:"ml-1 select-source-type-label","aria-label":u("interactWithMap"),children:u("interactWithMap")})]})]})}),d&&(0,e.jsx)(P,{rootSettingProps:n,showPlaceholder:o}),p&&(0,e.jsx)(K,{rootSettingProps:n,showPlaceholder:o})]})}function X(a){const{rootSettingProps:n,onSpatialSelectionUpdate:o}=a,{id:r}=n,c=t.hooks.useTranslation(l.defaultMessages,s),u=t.React.useMemo(()=>{let e=a.imSpatialSelection;return e||(e=(0,t.Immutable)(J())),e.useDataSources||(e=e.set("useDataSources",[])),e.buffer||(e=e.set("buffer",W)),e},[a]);let d=null,p=null,S=!1,f=0,h=null;const b=!!u.enable;if(b){if(d=u.useDataSources,u.relationships){const e=[];u.relationships.forEach(t=>{e.push(t)}),p=(0,t.Immutable)(e)}u.buffer&&(S=!!u.buffer.enable,f=u.buffer.distance,h=u.buffer.unit)}d||(d=(0,t.Immutable)([])),p||(p=(0,t.Immutable)([])),"number"!=typeof f&&(f=0),h||(h=B.Meters);const y=t.React.useMemo(()=>(0,t.Immutable)(Object.entries(V).map(([e,t])=>({value:t,label:c(q[t])}))),[c]),I=t.React.useCallback((e,t)=>{let a=u.set("enable",t);t||(a=a.set("useDataSources",[])),o(a)},[u,o]),x=t.React.useCallback(e=>{const a=d.map(e=>e.dataSourceId).asMutable(),n=e.map(e=>e.dataSourceId),{added:s,deleted:l}=t.utils.diffArrays(!0,a,n),i=[];s.length>0&&0===l.length&&s.forEach(t=>{const a=e.find(e=>e.dataSourceId===t);a&&!a.dataViewId&&i.push(t)});let r=null;if(i.length>0){const a=t.DataSourceManager.getInstance();r=e.map(e=>{if(i.includes(e.dataSourceId)){const n=Object.assign({},e),s=t.CONSTANTS.SELECTION_DATA_VIEW_ID;return n.dataViewId=s,n.dataSourceId=a.getDataViewDataSourceId(e.mainDataSourceId,s),n}return e})}else r=e;const c=u.set("useDataSources",r);o(c)},[u,d,o]),w=t.React.useCallback(e=>c("numSelected",{number:e.length}),[c]),j=t.React.useCallback((e,t)=>{if(0===t.length)return;const a=u.set("relationships",t);o(a)},[u,o]),C=t.React.useCallback((e,t)=>{const a=u.setIn(["buffer","enable"],t);o(a)},[u,o]),D=t.React.useCallback(e=>{const t=u.setIn(["buffer","distance"],e);o(t)},[u,o]),M=t.React.useCallback(e=>{const t=e.target.value,a=u.setIn(["buffer","unit"],t);o(a)},[u,o]),L=v()?c("selectionViewOnly"):"";return(0,e.jsx)(i.SettingSection,{role:"group","aria-label":c("spatialSelection"),title:"",children:(0,e.jsxs)(l.CollapsablePanel,{label:c("spatialSelection"),level:1,type:"default",children:[(0,e.jsx)(R,{titleKey:"selectByData",checked:b,className:"title3 text-default mt-4",onSwitchChange:I}),(0,e.jsxs)(l.Collapse,{isOpen:b,children:[(0,e.jsx)(i.SettingRow,{flow:"wrap",truncateLabel:!0,label:L,className:"mt-4",children:(0,e.jsx)(m.DataSourceSelector,{buttonLabel:c("addSelectingData"),widgetId:r,types:g,isMultiple:!0,disableDataView:!1,isMultipleDataView:!1,disableDataSourceList:!1,mustUseDataSource:!0,useDataSources:d,onChange:x})}),(0,e.jsx)(i.SettingRow,{flow:"wrap",label:c("relationship"),children:(0,e.jsx)(l.MultiSelect,{"aria-label":c("relationship"),values:p,onChange:j,displayByValues:w,size:"sm",children:y.map(t=>(0,e.jsx)(l.MultiSelectItem,{value:t.value,label:t.label},t.value))})}),(0,e.jsx)(i.SettingRow,{tag:"label",label:c("enableBuffer"),children:(0,e.jsx)(l.Switch,{checked:S,onChange:C})}),S&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(i.SettingRow,{label:c("defaultDistance"),children:(0,e.jsx)(l.NumericInput,{css:t.css`
                    width: 40%;
                    flex: 0 0 40%;
                    flex-shrink: 0;
                    flex-grow: 0;
                  `,"aria-label":c("defaultDistance"),size:"sm",min:0,value:f,onChange:D})}),(0,e.jsx)(i.SettingRow,{label:c("defaultUnit"),children:(0,e.jsx)(l.Select,{css:t.css`
                    width: 40%;
                    flex: 0 0 40%;
                    flex-shrink: 0;
                    flex-grow: 0;
                  `,size:"sm",value:h,"aria-label":c("defaultUnit"),onChange:M,children:Object.values(B).map(t=>(0,e.jsx)("option",{value:t,children:c(`unit_${t}`)},t))})})]})]})]})})}const Y=t.css`
  .jimu-widget-setting--section.interactive-tools-setting-section,
  .jimu-widget-setting--section.interactive-selection-mode-setting-section {
    border-bottom: none;

    .jimu-widget-setting--section-header > * {
      font-size: 0.8125rem !important;
    }

    label.jimu-widget-setting--row:first-of-type {
      margin-top: 8px !important;
    }
  }

  .tool-alert-container {
    position: relative;
    min-height: 0.1px;

    .tool-alert {
      position: absolute;
      left: 0;
      top: 0;
      z-index: 1;
    }
  }
`;function Z(a){const{onInteractiveToolSectionUpdate:n}=a,o=t.hooks.useTranslation(l.defaultMessages,s),[r,c]=t.React.useState(!1),u=t.React.useRef(null),d=()=>{u.current&&(clearTimeout(u.current),u.current=null)};t.React.useEffect(()=>()=>{u.current&&(clearTimeout(u.current),u.current=null)},[]);const p=t.React.useMemo(()=>{let e=a.imInteractiveTools;return e||(e=(0,t.Immutable)(_())),e.tools||(e=e.set("tools",[U.Rectangle])),"boolean"!=typeof e.partiallyWithin&&(e=e.set("partiallyWithin",!0)),e},[a]),S=p.tools,m=t.React.useMemo(()=>[{value:U.Rectangle,label:o("SelectionByRectangle")},{value:U.Polygon,label:o("SelectionByLasso")},{value:U.Circle,label:o("SelectionByCircle")},{value:U.Polyline,label:o("SelectionByLine")},{value:U.Point,label:o("SelectionByPoint")}],[o]),f=(e,t)=>{let a=S.asMutable();if(t)a.includes(e)||a.push(e);else if(a=a.filter(t=>t!==e),0===a.length)return c(!0),d(),void(u.current=setTimeout(()=>{c(!1)},5e3));const s=p.set("tools",a);n(s)},g=t.React.useCallback((e,t)=>{if(t){const e=p.set("partiallyWithin",!0);n(e)}},[p,n]),h=t.React.useCallback((e,t)=>{if(t){const e=p.set("partiallyWithin",!1);n(e)}},[p,n]);return(0,e.jsx)(i.SettingSection,{role:"group","aria-label":o("interactiveSelection"),title:"",css:Y,children:(0,e.jsxs)(l.CollapsablePanel,{label:o("interactiveSelection"),level:1,type:"default",children:[(0,e.jsx)(i.SettingSection,{role:"group","aria-label":o("tools"),title:o("tools"),className:"pl-0 pr-0 pt-4 pb-0 interactive-tools-setting-section",children:m.map(t=>(0,e.jsx)(i.SettingRow,{tag:"label",label:t.label,level:3,className:"mt-3",children:(0,e.jsx)(l.Switch,{checked:S.includes(t.value),onChange:(e,a)=>{f(t.value,a)}})},t.value))}),(0,e.jsx)("div",{className:"tool-alert-container mt-2 mb-2",children:(0,e.jsx)(l.Alert,{closable:!0,className:"tool-alert w-100",form:"basic",onClose:()=>{d(),c(!1)},open:r,text:o("atLeastOneToolTip"),type:"warning",withIcon:!0})}),(0,e.jsxs)(i.SettingSection,{role:"radiogroup","aria-label":o("interactiveSelectionMode"),title:o("interactiveSelectionMode"),className:"p-0 interactive-selection-mode-setting-section",children:[(0,e.jsxs)(l.Label,{className:"w-100 d-flex align-items-center mt-2",children:[(0,e.jsx)(l.Radio,{name:"select-widget-interactive-selection-mode",className:"mr-2",checked:p.partiallyWithin,onChange:g}),o("partiallyWithin")]}),(0,e.jsxs)(l.Label,{className:"w-100 d-flex align-items-center",children:[(0,e.jsx)(l.Radio,{name:"select-widget-interactive-selection-mode",className:"mr-2",checked:!p.partiallyWithin,onChange:h}),o("whollyWithin")]})]})]})})}const ee=t.css`
`;function te(n){var s;const{config:l,useMapWidgetIds:i,useDataSources:o}=n,r=l.useMap,c=t.React.useCallback(e=>{const t=a(e),s={id:n.id,config:e,useDataSources:t};r&&!e.useMap&&(s.useMapWidgetIds=null),n.onSettingChange(s)},[n,r]),u=null===(s=null==l?void 0:l.dataAttributeInfo)||void 0===s?void 0:s.dataSourceItems,d=t.React.useMemo(()=>b(u,o),[u,o]),p=(null==d?void 0:d.length)>0,S=i&&i.length>0?i[0]:"",m=r&&S,f=r&&S||!r&&p,g=r&&!S||!r&&!p;return(0,e.jsxs)("div",{className:"jimu-widget-setting widget-setting-select",css:ee,children:[(0,e.jsx)($,{rootSettingProps:n,showPlaceholder:g,onConfigUpdate:c}),m&&(0,e.jsx)(Z,{rootSettingProps:n,imInteractiveTools:l.interactiveTools,onInteractiveToolSectionUpdate:e=>{const t=l.set("interactiveTools",e);c(t)}}),f&&(0,e.jsx)(X,{rootSettingProps:n,imSpatialSelection:l.spatialSelection,onSpatialSelectionUpdate:e=>{const t=l.set("spatialSelection",e);c(t)}})]})}function ae(e){u.p=e}})(),d})())}}});