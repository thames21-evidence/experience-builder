System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/basic/sql-expression-runtime","jimu-arcgis"],function(e,t){var n={},a={},o={},s={},r={};return{setters:[function(e){n.jsx=e.jsx,n.jsxs=e.jsxs},function(e){a.CONSTANTS=e.CONSTANTS,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceSelectionMode=e.DataSourceSelectionMode,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JSAPILayerTypes=e.JSAPILayerTypes,a.MessageManager=e.MessageManager,a.QueryScope=e.QueryScope,a.React=e.React,a.ReactDOM=e.ReactDOM,a.SqlExpressionMode=e.SqlExpressionMode,a.WidgetState=e.WidgetState,a.WidgetVersionManager=e.WidgetVersionManager,a.appActions=e.appActions,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.defaultMessages=e.defaultMessages,a.focusElementInKeyboardMode=e.focusElementInKeyboardMode,a.geometryUtils=e.geometryUtils,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.moduleLoader=e.moduleLoader,a.observeStore=e.observeStore,a.utils=e.utils,a.uuidv1=e.uuidv1},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.DataActionList=e.DataActionList,o.DataActionListStyle=e.DataActionListStyle,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.Label=e.Label,o.Loading=e.Loading,o.LoadingType=e.LoadingType,o.NumericInput=e.NumericInput,o.Paper=e.Paper,o.Progress=e.Progress,o.SVG=e.SVG,o.Select=e.Select,o.Switch=e.Switch,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){s.SqlExpressionRuntime=e.SqlExpressionRuntime,s.getShownClauseNumberByExpression=e.getShownClauseNumberByExpression},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},9155:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0M.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},13424:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path stroke="#000" d="M1 3.5h5M1 9.5h14M1 14.5h14M14 3.5H9l2.5 3z"></path></svg>'},14321:e=>{"use strict";e.exports=o},14907:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 5.5C16 2.462 13.456 0 10.318 0 7.933 0 5.828 1.435 5 3.56l.886.323.078-.187c.737-1.667 2.438-2.78 4.354-2.78 2.615 0 4.735 2.053 4.735 4.584s-2.12 4.583-4.735 4.583c-.98 0-1.915-.288-2.703-.82l-.54.753.22.142a5.8 5.8 0 0 0 3.023.842C13.456 11 16 8.538 16 5.5M.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},25813:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.95 3a2.5 2.5 0 0 1-4.9 0H.5a.5.5 0 0 1 0-1h3.55a2.5 2.5 0 0 1 4.9 0h6.55a.5.5 0 0 1 0 1zM6.5 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m7.45 4.5a2.5 2.5 0 0 1-4.9 0H.5a.5.5 0 0 1 0-1h8.55a2.5 2.5 0 0 1 4.9 0h1.55a.5.5 0 0 1 0 1zm-2.45 1a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m-7 6.5a2.5 2.5 0 0 0 2.45-2h8.55a.5.5 0 0 0 0-1H6.95a2.5 2.5 0 0 0-4.9 0H.5a.5.5 0 0 0 0 1h1.55a2.5 2.5 0 0 0 2.45 2M3 13.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0" clip-rule="evenodd"></path></svg>'},31579:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0L6 2.982v2.162h.91l-.001-1.49 8.182-2.44v8.882H8.434V11zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},32772:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M19.5 0H6v4.5h1V1h5v5.133l3.638 6.367H11.3v1h8.2zm-2.71 12.5h1.71V7.022l-3.35 2.606zM14.648 8.75 18.5 5.755V1H13v4.867z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M11.89 10.006 1 4.165v12.318l2.897-3.357 3.401 6.517 3.367-1.95-3.426-6.564zM2 13.793V5.837l7.11 3.813-3.35.808 3.575 6.85-1.633.947-3.6-6.897z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},56509:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m10.308.302-.589.808 3.84 2.796L9 6.555l5.013 3.736.597-.801-3.796-2.832 4.576-2.657zM.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},60882:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0H5v3.5h1V1h9v9H8.5v1zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=r},66364:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOC44OTIxOSA3Ljk2ODU2TDAuMjUwMDg4IDNMMC4yMzE5MzQgMTIuOTY4NkwyLjU4Mjk3IDEwLjM3NEw1LjMwNjcxIDE1LjgyMzdMOC4xOTM0NiAxNC4xNTdMNS40Njk3MiA4LjcwNzM0TDguODkyMTkgNy45Njg1NlpNMS4yMzYzMyAxMC4zNzAxTDEuMjQ2MzMgNC43MjYwN0w2LjEzOTMzIDcuNTM5MDdMMy45MTgwMyA4LjAxOTE5TDYuODI3MzMgMTMuNzkwMUw1LjY3MjMzIDE0LjQ1NzFMMi43NjMzMyA4LjY4NTg2TDEuMjM2MzMgMTAuMzcwMVoiIGZpbGw9ImJsYWNrIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTExIDAuNjg3NUw2IDMuNzgxMjVMMTEgNi44NzVMMTYgMy43ODEyNUwxMSAwLjY4NzVaTTE0LjcyNSA1LjgyNzYxTDE0LjM0NjMgNS41OTMxN0wxNC45ODM3IDUuMTk4NTVMMTYgNS44Mjc2MUwxMSA4LjkyMTM2TDYgNS44Mjc2MUw3LjAxNjg4IDUuMTk4NTVMNy42NTQzOCA1LjU5MzE3TDcuMjc1IDUuODI3NjFMMTEgOC4xMzI4TDE0LjcyNSA1LjgyNzYxWk0xNiA3Ljg5MDNMMTQuOTcwNiA3LjI1Mjk5TDE0LjMzMzEgNy42NDc2MkwxNC43MjUgNy44OTAzTDExIDEwLjE5NTVMNy4yNzUgNy44OTAzTDcuNjY3NSA3LjY0NzYyTDcuMDMgNy4yNTI5OUw2IDcuODkwM0wxMSAxMC45ODQxTDE2IDcuODkwM1pNMTEgMS40NzcwNUw3LjI3NTAyIDMuNzgxNTVMMTEgNi4wODY3NEwxNC43MjUgMy43ODE1NUwxMSAxLjQ3NzA1WiIgZmlsbD0iYmxhY2siLz4NCjwvc3ZnPg0K"},67386:e=>{"use strict";e.exports=n},71690:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7 14v-1h2v1zM9 12v-1H7v1zM10 13h4v1h-4zM14 11h-4v1h4z"></path><path fill="#000" fill-rule="evenodd" d="M15 6a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zM6 9V7h9v2zm9 6v-5H6v5zM0 10.5V12a1 1 0 0 0 1 1h1.5v-1H1v-1.5zM2.5 1H1a1 1 0 0 0-1 1v1.5h1V2h1.5zM0 8.5h1v-3H0zM4.5 1v1h3V1zm5 0v1H11v1.5h1V2a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>'},76117:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=a},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var l={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(l),i.d(l,{__set_webpack_public_path__:()=>Ze,default:()=>Ke});var e=i(67386),t=i(79244),n=i(14321),a=i(45508),o=i.n(a),s=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const r=n=>{const a=window.SVG,{className:r}=n,i=s(n,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",r);return a?(0,e.jsx)(a,Object.assign({className:l,src:o()},i)):(0,e.jsx)("svg",Object.assign({className:l},i))},c={_widgetLabel:"Select",selectByData:"Select by data",selectingFeatures:"Selecting features",bufferUnit:"Buffer unit",selectByLocationFeatureCountTip:"There are {count} features inside this data.",attributeFilterBatchOnTip:"Apply all attribution for active layers",attributeFilterBatchOffTip:"Remove all attribution for active layers",batchLayerSelectableStatus:"Control layers' selectable status",allSelectable:"All selectable",noneSelectable:"None selectable",buildCustomSQL:"Build custom SQL",customSQL:"Custom SQL",selectWidgetSelection:"{layerName} select widget selection",noLayersAvailableTip:"No layers are available to select.",openSettingPanelTip:"Please open the widget setting panel to update the configurations."};var u;!function(e){e.Intersects="Intersects",e.Contains="Contains",e.Crosses="Crosses",e.EnvelopeIntersects="EnvelopeIntersects",e.IndexIntersects="IndexIntersects",e.Overlaps="Overlaps",e.Touches="Touches",e.Within="Within"}(u||(u={}));const d={[u.Intersects]:"esriSpatialRelIntersects",[u.Contains]:"esriSpatialRelContains",[u.Crosses]:"esriSpatialRelCrosses",[u.EnvelopeIntersects]:"esriSpatialRelEnvelopeIntersects",[u.IndexIntersects]:"esriSpatialRelIndexIntersects",[u.Overlaps]:"esriSpatialRelOverlaps",[u.Touches]:"esriSpatialRelTouches",[u.Within]:"esriSpatialRelWithin"},p={[u.Intersects]:"spatialRelation_Intersect",[u.Contains]:"spatialRelation_Contain",[u.Crosses]:"spatialRelation_Cross",[u.EnvelopeIntersects]:"spatialRelation_EnvelopeIntersect",[u.IndexIntersects]:"spatialRelation_IndexIntersect",[u.Overlaps]:"spatialRelation_Overlap",[u.Touches]:"spatialRelation_Touch",[u.Within]:"spatialRelation_Within"};var f;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(f||(f={}));const m={[f.Miles]:"miles",[f.Kilometers]:"kilometers",[f.Feet]:"feet",[f.Meters]:"meters",[f.NauticalMiles]:"nautical-miles"};var g;!function(e){e.Point="point",e.Polyline="polyline",e.Rectangle="rectangle",e.Circle="circle",e.Polygon="polygon"}(g||(g={}));var S,h=i(76117);function y(e,t,n,a){const o={};return n.forEach(n=>{const s=n.uid;if(a[s])return;const r=n.sqlExpression,i=x(t,r),l=N(null),c=D(""),u={uid:s,displayTitle:"",dataSource:null,jimuLayerView:null,supportCustomSQLBuilder:t,shouldRenderFilterIcon:i,imDisplaySqlExpression:r,checked:!e,isSelecting:!1,latestSelectTaskInfo:{version:0,selectionMode:null,appliedGeometryInfo:l,appliedSql:c},isAttributeFilterOn:!1,tryExecuteSelectingByGeometryInfoAndSqlUI:null,enableAttributeFilter:null,clearSelection:null};o[s]=u}),o}function v(e,n){const a=(0,t.uuidv1)(),o=e.id;let s=o;const r=e.getMainDataSource();r&&(s=r.id);const i={uid:a,sqlHint:"",sqlExpression:null,useDataSource:{dataSourceId:o,mainDataSourceId:s},jimuLayerViewId:n};return(0,t.Immutable)(i)}function w(e,t){const n=function(e,t){const n=[];return e.forEach(e=>{const a=e.uid,o=t[a];o&&n.push({dataSourceItem:e,runtimeInfo:o})}),n}(e,t),a=[];return n.forEach(e=>{const{dataSourceItem:t,runtimeInfo:n}=e;t&&n&&n.displayTitle&&(t.jimuLayerViewId?n.jimuLayerView&&a.push(n):n.dataSource&&a.push(n))}),a}function b(e,t){return w(e,t).filter(e=>e.checked)}function I(e,t){return w(e,t).filter(e=>e.checked&&!e.isSelecting)}function x(e,t){let n=!1;return e?n=!0:t&&(n=!!D(t.sql)||R(e,t)),n}function R(e,t){let n=!1;return!e&&t&&(n=(0,h.getShownClauseNumberByExpression)(t)>0),n}function M(e,n,a){let o="";if(e&&n&&a){const e=t.dataSourceUtils.getArcGISSQL(n,a);e&&(o=e.sql)}return D(o)}function j(e){return"number"==typeof e&&e>0}function D(e){let t=e||"";return"1=1"===t&&(t=""),t}function N(e){return void 0===e?null:e}!function(e){e.Placeholder="Placeholder",e.Loading="Loading",e.NoLayersTip="NoLayersTip",e.Normal="Normal"}(S||(S={}));const L=[t.DataSourceTypes.FeatureLayer,t.DataSourceTypes.SceneLayer,t.DataSourceTypes.BuildingComponentSubLayer,t.DataSourceTypes.OrientedImageryLayer,t.DataSourceTypes.ImageryLayer,t.DataSourceTypes.SubtypeGroupLayer,t.DataSourceTypes.SubtypeSublayer];(0,t.Immutable)(L);function C(e){return L.includes(e)}const T=[t.JSAPILayerTypes.FeatureLayer,t.JSAPILayerTypes.SceneLayer,t.JSAPILayerTypes.BuildingComponentSublayer,t.JSAPILayerTypes.OrientedImageryLayer,t.JSAPILayerTypes.ImageryLayer,t.JSAPILayerTypes.SubtypeGroupLayer,t.JSAPILayerTypes.SubtypeSublayer];function k(e){if(!e||!e.type)return!1;const n=e.type,a=n!==t.JSAPILayerTypes.BuildingComponentSublayer||n===t.JSAPILayerTypes.BuildingComponentSublayer&&e.view;return!!(T.includes(n)&&a)}function E(e,t){return!e&&t}function O(e,t){const n=t.slice();return e&&n.sort((t,n)=>{const a=A(e,t),o=A(e,n);return a&&o?function(e,t){const n=e.split(".").map(e=>parseInt(e)),a=t.split(".").map(e=>parseInt(e));for(;n.length>0&&a.length>0;){const e=n.shift(),t=a.shift();if(e<t)return-1;if(e>t)return 1}if(n.length>0)return 1;if(a.length>0)return-1;return 0}(a,o):0}),n}function A(e,t){let n="";if(e&&t){const a=t.jimuLayerViewId;if(a){const t=e.jimuLayerViews[a];t&&(n=t.hierarchyLevel)}}return n}function V(e){var n;if(!e)return null;const a=function(){var e,n,a;return window.jimuConfig.isBuilder?null===(n=null===(e=(0,t.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===n?void 0:n.appConfig:null===(a=(0,t.getAppStore)().getState())||void 0===a?void 0:a.appConfig}();return null===(n=null==a?void 0:a.widgets)||void 0===n?void 0:n[e]}var P=i(60882),z=i.n(P),B=i(31579),F=i.n(B),U=i(14907),G=i.n(U),W=i(56509),J=i.n(W),q=i(9155),H=i.n(q),$=i(66364),_=i.n($),Y=function(e,t,n,a){return new(n||(n=Promise))(function(o,s){function r(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,i)}l((a=a.apply(e,t||[])).next())})};const Q=t.css`
  overflow: hidden;
  border-bottom: 1px solid var(--sys-color-divider-secondary);

  .dropdown-btn-container {
    position: relative;
    float: left;

    .api-modules-loading-progress {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      width: 100%;
      background-color: rgba(110,110,110,0.3);
      animation: esri-fade-in 500ms ease-in-out;
    }

    .api-modules-loading-progress:after {
      position: absolute;
      width: 20%;
      height: 2px;
      top: 0;
      content: "";
      opacity: 1;
      z-index: 0;
      background-color: var(--sys-color-primary-main);
      animation: looping-progresss-bar-ani 1500ms linear infinite;
      transition: opacity 500ms ease-in-out;
    }
  }

  .render-dropdown {
    .selected-tool-btn {
      border-right: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .select-dropdown-btn {
      font-size: 14px;
      border-left: 0;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      padding-left: 6px;
      padding-right: 6px;
    }
  }

  .clear-all-btn {
    float: right;
  }
`,K="data",Z={polygon:{mode:"hybrid"}},X={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},ee={tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},te={style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};function ne(a){var o,s;const{config:r,widgetId:i,mapWidgetId:l,autoControlWidgetId:u,widgetState:d,activeJimuMapView:p,setSelectByLocationVisible:f,allImDataSourceItems:m,dataSourceItemRuntimeInfoMap:S}=a,{useMap:h,interactiveTools:y,spatialSelection:v}=r,b=null==v?void 0:v.enable,x=t.hooks.useTranslation(n.defaultMessages,c),R=t.React.useRef(!1),[M,j]=t.React.useState(null),D=t.React.useRef(null);D.current=p;const[N,L]=t.React.useState(null),C=t.React.useMemo(()=>(null==N?void 0:N.view)||null,[N]),T=t.React.useRef(null),[k,O]=t.React.useState(!1),A=t.React.useRef(!1);A.current=k;const[V,P]=t.React.useState(!1),B=t.React.useRef([]),U=t.React.useRef(null),W=t.React.useRef(null),q=t.React.useRef("macOS"===(null===(s=null===(o=window.jimuUA)||void 0===o?void 0:o.os)||void 0===s?void 0:s.name)),$=!(!M||!C),ne=null==r?void 0:r.mapInfo,se=null==p?void 0:p.id,re=t.React.useMemo(()=>{let e=!1;if(se&&ne){const t=ne[se];e=!!t&&E(t.syncWithMap,t.enableAttributeSelection)}return e},[ne,se]),ie=t.React.useMemo(()=>{let e="esriSpatialRelIntersects";return y&&!1===y.partiallyWithin&&(e="esriSpatialRelContains"),e},[y]),le=t.React.useMemo(()=>w(m,S),[m,S]),ce=t.React.useMemo(()=>I(m,S),[m,S]),ue=t.React.useMemo(()=>({[g.Rectangle]:{order:1,label:x("SelectionByRectangle"),iconSrc:z()},[g.Polygon]:{order:2,label:x("SelectionByLasso"),iconSrc:F()},[g.Circle]:{order:3,label:x("SelectionByCircle"),iconSrc:G()},[g.Polyline]:{order:4,label:x("SelectionByLine"),iconSrc:J()},[g.Point]:{order:5,label:x("SelectionByPoint"),iconSrc:H()},[K]:{order:6,label:x("selectByData"),iconSrc:_()}}),[x]),de=t.React.useMemo(()=>{const e=[];return h&&y&&y.tools&&y.tools.length>0&&y.tools.forEach(t=>{e.push(t)}),b&&e.push(K),e.sort((e,t)=>ue[e].order-ue[t].order),e},[y,b,ue,h]),[pe,fe]=t.React.useState(de[0]),me=t.React.useRef(null);me.current=pe;const ge=t.React.useMemo(()=>de.filter(e=>e!==K).length>0,[de]),Se=ge&&!M,he=t.React.useMemo(()=>{let e="";if(pe){const t=ue[pe];t&&(e=t.iconSrc)}return e},[ue,pe]),ye=t.React.useCallback(e=>e!==K&&!$,[$]),ve=t.React.useMemo(()=>{const t=[];return de.forEach(a=>{a===K&&de.length>=2&&t.push((0,e.jsx)(n.DropdownItem,{divider:!0},"divider"));const o=a===pe,s=ue[a].iconSrc,r=ye(a),i=(0,e.jsxs)(n.DropdownItem,{active:o,disabled:r,onClick:()=>{fe(a)},children:[(0,e.jsx)(n.SVG,{src:s,className:"mr-2"}),ue[a].label]},a);t.push(i)}),t},[de,pe,ue,ye]);t.React.useEffect(()=>{const e=q.current,t=t=>{"Shift"===t.key?U.current={eventDate:new Date,isKeyDown:!0}:(e&&"Meta"===t.key||!e&&"Control"===t.key)&&(W.current={eventDate:new Date,isKeyDown:!0})},n=t=>{"Shift"===t.key?U.current={eventDate:new Date,isKeyDown:!1}:(e&&"Meta"===t.key||!e&&"Control"===t.key)&&(W.current={eventDate:new Date,isKeyDown:!1})};return document.addEventListener("keydown",t,!0),document.addEventListener("keyup",n,!0),()=>{document.removeEventListener("keydown",t,!0),document.removeEventListener("keyup",n,!0)}},[]),t.React.useEffect(()=>{const e=D.current;e&&e!==N&&e.whenJimuMapViewLoaded().then(()=>{e===D.current&&L(e)})},[p,N]),t.React.useEffect(()=>{!ge||M||R.current||(R.current=!0,(0,t.loadArcGISJSAPIModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/symbols/support/jsonUtils","esri/views/2d/interactive/editingTools","esri/views/3d/interactive/editingTools","esri/views/2d/layers/GraphicsLayerView2D","esri/views/3d/layers/GraphicsLayerView3D"]).then(e=>{const[t,n,a]=e;j({SketchViewModel:t,GraphicsLayer:n,jsonUtils:a})}).catch(e=>{console.error("select widget loads api error",e)}))},[M,R,ge]);const we=t.React.useMemo(()=>pe&&pe!==K?pe:null,[pe]),be=t.React.useMemo(()=>k&&pe&&pe!==K?pe:null,[k,pe]);t.React.useEffect(()=>{if(d===t.WidgetState.Closed){const e=me.current;A.current&&e&&"data"!==e&&O(!1)}},[d]),t.hooks.useEffectWithPreviousValues(e=>{const[n,a]=e;if(i){if(be!==n&&l)if(be&&u!==i){const e=t.appActions.requestAutoControlMapWidget(l,i);(0,t.getAppStore)().dispatch(e)}else if(!be&&u===i){const e=t.appActions.releaseAutoControlMapWidget(l);(0,t.getAppStore)().dispatch(e)}u!==a&&u!==i&&be&&O(!1)}},[be,u,i]),t.React.useEffect(()=>{if(pe&&!de.includes(pe)){const e=de.length>0?de[0]:null;fe(e),O(!1)}else if(!pe&&de.length>0){const e=de[0];fe(e),O(!1)}},[de,pe]);const Ie=!(!h||re||!we),xe=t.hooks.usePrevious(be),Re=t.React.useRef(null),Me=t.React.useCallback((e,n,a)=>{n?n.geometry?(Ie||(a=t.DataSourceSelectionMode.New),function(){Y(this,void 0,void 0,function*(){let o=n.geometry;try{if("point"===o.type||"polyline"===o.type){const n=10*(null==e?void 0:e.resolution);if(n>0){const e=yield t.geometryUtils.createBuffer(o,[n],"meters");e&&(o=e)}}}catch(e){console.error("geometryUtils.createBuffer() error of Select widget",e)}const s=t.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(o.type),r={geometry:o.toJSON(),geometryType:s,spatialRel:ie};B.current=ce;(B.current||[]).forEach(e=>{e.tryExecuteSelectingByGeometryInfoAndSqlUI(a,r)})})}()):console.log("sketch graphic.geometry is null"):console.log("sketch graphic is null")},[Ie,ie,ce]);Re.current=Me,t.React.useEffect(()=>{const e=T.current;let n=e;if(e){let t=!1;if(be)if(xe===be){const n=C||null,a=e.view||null;t=!n||n!==a}else t=!0;else t=!0;t&&(e&&oe(e),n=null)}const a=()=>{const e=T.current;if(e&&be){const t=Z[be];t?e.create(be,t):e.create(be)}};if(M&&C&&be&&!n){const e=C.on("key-down",e=>{"Shift"===e.key&&e.stopPropagation()}),o=C.on("key-up",e=>{"Shift"===e.key&&e.stopPropagation()}),{SketchViewModel:s,GraphicsLayer:r,jsonUtils:i}=M,l=new r;n=new s({view:C,layer:l,pointSymbol:i.fromJSON(X),polylineSymbol:i.fromJSON(ee),polygonSymbol:i.fromJSON(te)}),n.viewKeyDownHandle=e,n.viewKeyUpHandle=o,n.on("create",e=>{if("complete"===e.state&&(a(),Re.current)){const a=e.graphic,o=ae(U.current),s=ae(W.current);let r=t.DataSourceSelectionMode.New;r=o?s?t.DataSourceSelectionMode.SelectFromCurrent:t.DataSourceSelectionMode.AddToCurrent:s?t.DataSourceSelectionMode.RemoveFromCurrent:t.DataSourceSelectionMode.New,Re.current(n.view,a,r)}})}T.current=n,a()},[be,M,C,xe]),t.React.useEffect(()=>{f(k&&pe===K)},[k,pe,f]),t.hooks.useUnmount(()=>{const e=T.current;e&&(oe(e),T.current=null)});const je=t.React.useMemo(()=>{let e="";if(pe)if(pe===K)e=x("selectByData");else{let t="";t=pe===g.Point?x("SelectionByPoint"):pe===g.Rectangle?x("SelectionByRectangle"):pe===g.Polygon?x("SelectionByLasso"):pe===g.Circle?x("SelectionByCircle"):pe===g.Polyline?x("SelectionByLine"):x("SelectLabel");const n=x("newSelection"),a=x("addToCurrentSelection"),o=x("removeFromCurrentSelection"),s=x("selectFromCurrentSelection"),r=x("drawShape"),i=x("draw"),l=q.current?"Cmd":"Ctrl",c=`\u2219 ${n} (${r})`;e=Ie?`${t}\n${c}\n${`\u2219 ${a} (Shift + ${i})`}\n${`\u2219 ${o} (${l} + ${i})`}\n${`\u2219 ${s} (Shift + ${l} + ${i})`}`:`${t}\n${c}`}return e},[Ie,pe,x]),De=t.React.useCallback(()=>{P(e=>!e)},[P]),Ne=t.React.useCallback(()=>{O(!k)},[k]),Le=t.React.useCallback(()=>{le.forEach(e=>{e.clearSelection&&e.clearSelection()})},[le]),Ce=ve.length>=2;return(0,e.jsxs)("div",{className:"w-100 p-4",css:Q,children:[(0,e.jsxs)("div",{className:(0,t.classNames)(["d-flex align-items-center dropdown-btn-container",{"render-dropdown":Ce}]),children:[pe&&(0,e.jsx)(n.Button,{className:"selected-tool-btn",icon:!0,disabled:ye(pe),type:"default",selected:k,title:je,"aria-label":je,"aria-pressed":k,onClick:Ne,children:(0,e.jsx)(n.SVG,{src:he})}),Ce&&(0,e.jsxs)(n.Dropdown,{activeIcon:!0,isOpen:V,toggle:De,"aria-label":x("moreSelectionTools"),menuItemCheckMode:"singleCheck",children:[(0,e.jsx)(n.DropdownButton,{className:"select-dropdown-btn",type:"default",selected:V}),(0,e.jsx)(n.DropdownMenu,{alignment:"start",offsetOptions:4,children:ve})]}),Se&&(0,e.jsx)("div",{className:"api-modules-loading-progress"})]}),(0,e.jsx)(n.Button,{title:x("drawToolClearBtn"),className:"pl-4 pr-4 nowrap clear-all-btn",type:"default",icon:!0,onClick:Le,children:(0,e.jsx)("span",{className:"nowrap",children:x("drawToolClearBtn")})})]})}function ae(e){if(e){if(e.isKeyDown)return!0;return Date.now()-e.eventDate.getTime()<=500}return!1}function oe(e){e&&(e.viewKeyDownHandle&&(e.viewKeyDownHandle.remove(),e.viewKeyDownHandle=null),e.viewKeyUpHandle&&(e.viewKeyUpHandle.remove(),e.viewKeyUpHandle=null),e.destroyed||e.destroy())}var se=i(25813),re=i.n(se),ie=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const le=n=>{const a=window.SVG,{className:o}=n,s=ie(n,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",o);return a?(0,e.jsx)(a,Object.assign({className:r,src:re()},s)):(0,e.jsx)("svg",Object.assign({className:r},s))};var ce=i(4583),ue=i.n(ce),de=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const pe=n=>{const a=window.SVG,{className:o}=n,s=de(n,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",o);return a?(0,e.jsx)(a,Object.assign({className:r,src:ue()},s)):(0,e.jsx)("svg",Object.assign({className:r},s))};var fe=i(71690),me=i.n(fe),ge=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Se=n=>{const a=window.SVG,{className:o}=n,s=ge(n,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",o);return a?(0,e.jsx)(a,Object.assign({className:r,src:me()},s)):(0,e.jsx)("svg",Object.assign({className:r},s))};var he=function(e,t,n,a){return new(n||(n=Promise))(function(o,s){function r(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,i)}l((a=a.apply(e,t||[])).next())})};class ye{constructor(e,t){this.ds=e,this.widgetId=t}clearSelection(){return he(this,void 0,void 0,function*(){const e=[];yield this.ds.selectRecords({widgetId:this.widgetId,records:e}),this.publishMessage(e)})}selectRecords(e,n,a,o,s,r){return he(this,void 0,void 0,function*(){Object.values(n).includes(n)&&(n=t.DataSourceSelectionMode.New);let i=null;const l=this.widgetId,c=this.ds;if(n!==t.DataSourceSelectionMode.New||e.objectIds||e.geometry||e.where&&"1=1"!==e.where){const u=yield t.dataSourceUtils.selectBySelectionMode({widgetId:l,ds:c,query:e,selectionMode:n,signal:a,checkLayerVisibility:!1,jimuLayerView:o,progressCallback:s,updateSelectionIfAborted:r});u&&(i=u.records)}else i=[],c.selectRecords({widgetId:l,records:i});i&&this.publishMessage(i)})}publishMessage(e){const n=new t.DataRecordsSelectionChangeMessage(this.widgetId,e,[this.ds.id]);t.MessageManager.getInstance().publishMessage(n)}}var ve=i(96300),we=i.n(ve),be=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const Ie=n=>{const a=window.SVG,{className:o}=n,s=be(n,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",o);return a?(0,e.jsx)(a,Object.assign({className:r,src:we()},s)):(0,e.jsx)("svg",Object.assign({className:r},s))};var xe=function(e,t,n,a){return new(n||(n=Promise))(function(o,s){function r(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,i)}l((a=a.apply(e,t||[])).next())})};const Re=t.css`
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;

  .select-custom-sql-builder-header {
    padding: 16px;
  }

  .raw-sql-expression-builder {
    position: absolute;
    left: 16px;
    right: 16px;
    top: 53px;
    bottom: 16px;
    height: auto !important;
    overflow-x: auto;

    &.small-mode .sql-expression-builder .sql-expression-container {
      min-width: 240px;
    }
  }
`;function Me(a){const{isRTL:o,widgetId:s,widgetDomRef:r,dataSource:i,imSqlExpression:l,onBack:u}=a,d=null==r?void 0:r.current,p=t.hooks.useTranslation(n.defaultMessages,c),[f,m]=t.React.useState(null),[g,S]=t.React.useState(l),h=t.React.useCallback(()=>{u(g)},[g,u]),y=t.React.useCallback(e=>{S(e)},[S]);t.React.useEffect(()=>{!function(){xe(this,void 0,void 0,function*(){try{const e=yield t.moduleLoader.loadModules(["jimu-ui/advanced/sql-expression-builder"]);e&&e[0].SqlExpressionBuilder&&m(e[0].SqlExpressionBuilder)}catch(e){console.error("load SqlExpressionBuilder error",e)}})}()},[]);const v=t.React.useCallback(e=>{e&&(0,t.focusElementInKeyboardMode)(e)},[]);return d?t.ReactDOM.createPortal((0,e.jsxs)("div",{className:"select-custom-sql-builder surface-1 border-0",css:Re,children:[(0,e.jsxs)("div",{className:"select-custom-sql-builder-header",children:[(0,e.jsx)(n.Button,{type:"tertiary",color:"inherit",size:"sm",icon:!0,ref:v,"aria-label":p("back"),onClick:h,children:(0,e.jsx)(Ie,{autoFlip:o})}),(0,e.jsx)(n.Label,{children:p("buildCustomSQL")})]}),f&&i&&(0,e.jsx)(f,{className:"raw-sql-expression-builder",dataSource:i,mode:t.SqlExpressionMode.Simple,widgetId:s,expression:g,noScrollForList:!0,queryScope:t.QueryScope.InRuntimeView,onChange:y})]}),d):null}function je(a){const o=t.React.useMemo(()=>t.css`
      display: inline-block;
      position: relative;
      width: 20px;
      height: 20px;
      background: transparent;

      .select-circle-progress {
        position: absolute;
        left: 0;
        top: 0;

        .jimu-circular-progress-track {
          stroke: var(--sys-color-action-disabled);
        }

        .jimu-circular-progress-runner {
          stroke: var(--sys-color-surface-paper-text);
          transition: none !important;
        }
      }

      .progress-stop {
        position: absolute;
        width: 6px;
        height: 6px;
        left: 7px;
        top: 7px;
        background: var(--sys-color-surface-paper-text);
      }

      .progress-mask {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: transparent;
      }
    `,[]),s=t.hooks.useTranslation(n.defaultMessages,c),r=100*a.progress,i=parseFloat(r.toFixed(2)),l=s("selectingFeaturesTip");return(0,e.jsxs)("div",{css:o,onClick:a.onClick,className:"select-progress",title:l,"aria-label":l,children:[(0,e.jsx)(n.Progress,{className:"select-circle-progress",color:"var(--sys-color-surface-paper-text)",type:"circular",value:i,circleSize:20}),(0,e.jsx)("div",{className:"progress-stop"}),(0,e.jsx)("div",{className:"progress-mask"})]})}var De=function(e,t,n,a){return new(n||(n=Promise))(function(o,s){function r(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,i)}l((a=a.apply(e,t||[])).next())})};function Ne(a){var o;const{isRTL:s,widgetId:r,widgetDomRef:i,enableDataAction:l,imDataSourceItem:u,itemRuntimeInfo:d,jimuMapView:p,updateDataSourceItemRuntimeInfoForUid:f,onDataRecordSetChange:m}=a,g=u.uid,S=u.useDataSource,y=u.sqlHint||"",v=u.sqlExpression,w=S.dataSourceId,b=u.jimuLayerViewId,I=d.displayTitle,L=d.dataSource,C=d.jimuLayerView,T=d.checked,k=d.imDisplaySqlExpression,E=(null===(o=d.latestSelectTaskInfo)||void 0===o?void 0:o.version)||0,O=d.shouldRenderFilterIcon,A=d.isAttributeFilterOn,V=d.isSelecting,P=d.supportCustomSQLBuilder,z=P,B=t.hooks.useTranslation(t.defaultMessages,n.defaultMessages,c),F=t.React.useId(),[U,G]=t.React.useState([]),W=U.length,J=t.React.useRef(null),[q,H]=t.React.useState(!1),[$,_]=t.React.useState(!1),Y=t.React.useRef(d);Y.current=d;const[Q,K]=t.React.useState(0),Z=t.React.useRef(null),X=t.React.useRef(null),ee=t.React.useRef(0),te=t.React.useMemo(()=>R(P,v),[P,v]),ne=t.React.useMemo(()=>(P?B("customSQL"):y)||"",[y,P,B]),ae=t.React.useMemo(()=>{var e,n,a,o,s;let r=null;if(L&&U.length>0){const i=L.getLabel()||"",l=B("selectWidgetSelection",{layerName:i});r={dataSource:L,name:l,label:l,type:"selected",records:U};let c=!1;const u=L.getInfo&&(null===(n=null===(e=L.getInfo())||void 0===e?void 0:e.selectOptions)||void 0===n?void 0:n.widgetId);if(u){const e=null===(o=null===(a=(0,t.getAppStore)())||void 0===a?void 0:a.getState())||void 0===o?void 0:o.appConfig;if(e&&e.widgets){const t=e.widgets[u],n=null==t?void 0:t.uri;"widgets/arcgis/arcgis-map/"!==n&&"widgets/common/select/"!==n||(c=!0)}}const d=L.getAllUsedFields()||[];let p=[];if(C&&c){const e=C.view;e&&(null===(s=e.availableFields)||void 0===s?void 0:s.length)>0&&(p=e.availableFields.slice())}p||(p=[]);const f=L,m=f.getPopupInfoFields&&f.getPopupInfoFields()||[];let g=[].concat(d).concat(p).concat(m);if(g=Array.from(new Set(g)),g.includes("*")){g=g.filter(e=>"*"!==e);const e=L.getSchema();if(null==e?void 0:e.fields){const t=Object.keys(null==e?void 0:e.fields);t.length>0&&(g=t)}}g&&g.length>0&&(r.fields=g)}return r},[L,C,U,B]),oe=t.React.useMemo(()=>ae?[ae]:[],[ae]),[se,re]=t.React.useState(!1),ie=t.React.useMemo(()=>{const e=!b,n=j(E),a=O&&q&&te,o=O&&q&&$,s=(null==C?void 0:C.type)===t.JSAPILayerTypes.SubtypeSublayer;return se||e||n||a||o||s},[$,q,se,b,E,O,te,C]),ce=t.React.useCallback(()=>De(this,void 0,void 0,function*(){let e=L;if(!e){const n=t.DataSourceManager.getInstance();if(e=n.getDataSource(S.dataSourceId),!e)try{e=yield n.createDataSourceByUseDataSource(S)}catch(t){e=null,console.error("create data source error",S.dataSourceId,t)}e&&f(g,{dataSource:e})}return e}),[L,g,f,S]),ue=t.React.useCallback(()=>{var e,t;let n="";return L&&(n=L.getLabel()||(null===(e=L.getDataSourceJson())||void 0===e?void 0:e.sourceLabel)||""),n||C&&(n=null===(t=C.layer)||void 0===t?void 0:t.title),n||(n=""),n&&n!==I&&f(g,{displayTitle:n}),n},[L,I,C,g,f]);t.React.useEffect(()=>{ue()},[ue]),t.React.useEffect(()=>{if(!L){const e=t.DataSourceManager.getInstance().getDataSource(w);e&&f(g,{dataSource:e})}},[L,w,g,f]),t.React.useEffect(()=>{ie&&!L&&ce()},[L,ce,ie]),t.React.useEffect(()=>{if(b&&!C&&p&&0===b.indexOf(p.id)){function e(){return De(this,void 0,void 0,function*(){let e=null;try{e=yield p.whenJimuLayerViewLoaded(b)}catch(t){e=null,console.error("jimuLayerViewLoaded error",b,t)}if(e){const t=e.isLayerVisible();f(g,{checked:t,jimuLayerView:e})}})}e()}},[C,b,p,g,f]),t.React.useEffect(()=>{m(g,ae)},[ae,m,g]);const de=t.React.useCallback((e,n)=>{var a,o,s,i;let l=L;if(n){const c=(null===(a=null==e?void 0:e.selectedIds)||void 0===a?void 0:a.length)>0?null==e?void 0:e.selectedIds:null,u=(null===(o=n.selectedIds)||void 0===o?void 0:o.length)>0?n.selectedIds:null,d=(null===(s=n.selectOptions)||void 0===s?void 0:s.widgetId)||"";if(c!==u&&d!==r){const e=X.current;if(e){const t=`Select widget: selection changed by other widget ${d}, abort current on-the-fly selecting task`;e.ignoreAbortedSelection=!0,e.abort(t)}const n={isAttributeFilterOn:!1};if(null===(i=Y.current)||void 0===i?void 0:i.latestSelectTaskInfo){const e={version:Y.current.latestSelectTaskInfo.version,selectionMode:t.DataSourceSelectionMode.New,appliedGeometryInfo:N(null),appliedSql:D("")};n.latestSelectTaskInfo=e}f(g,n)}if(n.instanceStatus!==t.DataSourceStatus.Created&&L)f(g,{dataSource:null});else if(n.instanceStatus===t.DataSourceStatus.Created){const e=t.DataSourceManager.getInstance().getDataSource(w);e&&e!==L&&(l=e,f(g,{dataSource:e}))}}let c=[];l&&(c=l.getSelectedRecords()||[],G(c)),G(c),ue()},[L,w,r,g,f,ue]),fe=t.React.useRef(null);fe.current=de,t.React.useEffect(()=>{let e=null;const n=(0,t.getAppStore)().getState();return n&&n.dataSourcesInfo&&(e=n.dataSourcesInfo[w]),fe.current&&fe.current(e,e),J.current=(0,t.observeStore)((e,t)=>{fe.current&&fe.current(e,t)},["dataSourcesInfo",w]),()=>{J.current&&"function"==typeof J.current&&J.current(),J.current=null}},[w]),t.React.useEffect(()=>{const e=Y.current;if(!e)return;if(!L)return;const t=e.latestSelectTaskInfo;if(!t)return;const n=t.version;if(!j(n))return;if(n<=ee.current)return;K(0),X.current&&(X.current.abort(`cancel selecting task ${ee.current} because need to execute a new one`),X.current=null);const a=n;ee.current=a;const o=new AbortController;o.selectVersion=a,X.current=o;const s=o.signal;let i=null;e.imDisplaySqlExpression&&(i=e.imDisplaySqlExpression.asMutable());const l={returnGeometry:!0,sqlExpression:i},c=t.appliedSql;c&&(l.where=c);const u=t.appliedGeometryInfo;u&&(l.geometry=u.geometry,l.geometryType=u.geometryType,l.spatialRel=u.spatialRel);const d=L;d.getPopupInfoFields&&(l.outFields=d.getPopupInfoFields());const p=t.selectionMode,m=()=>Y.current&&Y.current.latestSelectTaskInfo.version===a,S=e=>{m()&&K(e)},h=new ye(d,r),y=()=>{var e;const t=m(),n=null===(e=X.current)||void 0===e?void 0:e.ignoreAbortedSelection;return t&&!n};!function(){De(this,void 0,void 0,function*(){try{yield h.selectRecords(l,p,s,C,S,y)}catch(e){console.error("Select widget select records error",e)}X.current&&X.current.selectVersion===a&&(X.current=null),m()&&(f(g,{isSelecting:!1}),K(1))})}()},[E,L,C,g,f,r]),t.React.useEffect(()=>{const e=x(P,v);f(g,{shouldRenderFilterIcon:e,imDisplaySqlExpression:v})},[P,v,g,f]);const me=t.React.useCallback((e,t)=>De(this,void 0,void 0,function*(){const n=Y.current;if(!n)return;let a=n.dataSource;if(a||(a=yield ce()),!a)return;t=N(t);const o=M(n.isAttributeFilterOn,n.imDisplaySqlExpression,a),s=n.latestSelectTaskInfo;if(s.version>0){const n=e===s.selectionMode,a=t===s.appliedGeometryInfo,r=o===s.appliedSql;if(n&&a&&r)return}const r=s.version+1;f(g,{latestSelectTaskInfo:{version:r,selectionMode:e,appliedGeometryInfo:t,appliedSql:o},isSelecting:!0})}),[ce,g,f]),ge=t.React.useRef(null);ge.current=me;const he=t.React.useCallback(e=>{e=!!e,O&&f(g,{isAttributeFilterOn:e})},[O,g,f]),ve=t.React.useCallback(()=>De(this,void 0,void 0,function*(){let e=L;if(e||(e=yield ce()),!e)return;new ye(e,r).clearSelection();const n=Y.current.latestSelectTaskInfo.version+1,a=N(null),o=D(""),s={version:n,selectionMode:t.DataSourceSelectionMode.New,appliedGeometryInfo:a,appliedSql:o};f(g,{latestSelectTaskInfo:s,isAttributeFilterOn:!1,isSelecting:!0})}),[L,ce,g,f,r]),we=t.React.useRef(!0);t.React.useEffect(()=>{const e=Y.current;if(!e)return;const n=we.current;if(we.current=!1,!L&&!n)return void re(!0);const a=e.latestSelectTaskInfo;M(A,k,L)!==a.appliedSql&&ge.current&&ge.current(t.DataSourceSelectionMode.New,a.appliedGeometryInfo)},[L,k,A]),t.React.useEffect(()=>{f(g,{tryExecuteSelectingByGeometryInfoAndSqlUI:me})},[me,g,f]),t.React.useEffect(()=>{f(g,{enableAttributeFilter:he})},[he,g,f]),t.React.useEffect(()=>{f(g,{clearSelection:ve})},[ve,g,f]);const be=t.React.useCallback((e,t)=>{f(g,{checked:t})},[f,g]),Ie=t.React.useCallback(()=>{H(!q)},[H,q]),xe=t.React.useCallback(()=>{ve()},[ve]),Re=t.React.useCallback(()=>{const e=X.current;e&&e.abort()},[X]),Ne=t.React.useCallback(e=>{Z.current=null==e?void 0:e.target,_(!0)},[_]),Le=t.React.useCallback((e,t)=>{V||he(t)},[he,V]),Ce=t.React.useCallback(e=>{const t=x(P,e);f(g,{shouldRenderFilterIcon:t,imDisplaySqlExpression:e})},[P,f,g]),Te=t.React.useCallback(e=>{Ce(e),_(!1),setTimeout(()=>{const e=Z.current;e&&(0,t.focusElementInKeyboardMode)(e)},100)},[Ce,_]),ke=t.React.useMemo(()=>{let e=38;O&&(e+=26),l&&(e+=26);const n=`${e}px`;let a=4;a+=V?20:4+10*W.toString().length+4;const o=`${a}px`;return t.css`
    .select-ds-list-item-top-row {
      position: relative;

      .ds-list-label-container {
        width: calc(100% - ${n});
        flex-basis: calc(100% - ${n});
        flex-shrink: 0;
        flex-grow: 0;

        .ds-list-label {
          max-width: calc(100% - ${o});
          flex-basis: auto;
          flex-shrink: 0;
          flex-grow: 0;

          .layer-name {
            width: calc(100% - 20px);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
          }
        }

        .selection-count-container {
          width: ${o};
          flex-basis: ${o};
          flex-shrink: 0;
          flex-grow: 0;

          .selection-count {
            display: inline;
            border-radius: 4px;
            background: var(--sys-color-action-disabled);
            padding: 1px 4px 0px 4px;
            line-height: 16px;
            font-size: 12px;
          }

          .aria-live-label {
            display: block;
            width: 0;
            height: 0;
            overflow: hidden;
          }
        }
      }

      .ds-list-icons {
        box-sizing: border-box;
        flex-direction: row;
        width: ${n};
        flex-basis: ${n};
        flex-shrink: 0;
        flex-grow: 0;
        padding-left: 12px;
      }
    }

    .select-sql-hint {
      word-break: break-all;
    }

    .sql-expr-runtime-disabled {
      touch-action: none;
      pointer-events: none;
    }
  `},[l,V,W,O]),Ee=t.React.useMemo(()=>{let e="";if(W>0){e=`${B("SelectionSelectedFeatures")}: ${W}`}return e},[W,B]),Oe=t.React.useMemo(()=>{let e="";return V?e=B("loading"):Ee&&(e=Ee),e},[V,Ee,B]),Ae=t.React.useId();return I?(0,e.jsxs)("div",{className:(0,t.classNames)(["select-ds-list-item w-100 mt-2",{"filer-panel-opened":q}]),css:ke,children:[(0,e.jsxs)("div",{className:"select-ds-list-item-top-row w-100 d-flex align-items-center",children:[(0,e.jsxs)("div",{className:"ds-list-label-container d-flex align-items-center",children:[(0,e.jsxs)(n.Label,{className:"ds-list-label d-flex align-items-center mb-0",children:[(0,e.jsx)(n.Checkbox,{checked:T,className:"mr-1",onChange:be,"aria-describedby":Ae}),(0,e.jsx)("span",{className:"layer-name",title:I,children:I})]}),(0,e.jsxs)("div",{className:"selection-count-container d-flex align-items-center pl-1",children:[!V&&W>0&&(0,e.jsx)("div",{id:Ae,className:"selection-count","aria-label":Ee,children:W}),V&&(0,e.jsx)(je,{progress:Q,onClick:Re}),(0,e.jsx)("label",{className:"aria-live-label","aria-live":"polite",children:Oe})]})]}),(0,e.jsxs)("div",{className:"ds-list-icons d-flex align-items-center",children:[O&&(0,e.jsx)(n.Button,{title:B("attributeSelection"),type:q?"primary":"tertiary",color:q?void 0:"inherit","aria-expanded":q,size:"sm",icon:!0,onClick:Ie,children:(0,e.jsx)(Se,{width:16,height:16})}),(0,e.jsx)(n.Button,{title:B("clearSelection"),type:"tertiary",color:"inherit",size:"sm",icon:!0,disabled:V||0===W,onClick:xe,children:(0,e.jsx)(pe,{size:16})}),l&&(0,e.jsx)(n.DataActionList,{widgetId:r,dataSets:oe,disableDataSourceLevelActions:!0,buttonType:"tertiary",listStyle:n.DataActionListStyle.Dropdown,hideGroupTitle:!0})]})]}),O&&(0,e.jsxs)("div",{className:(0,t.classNames)(["filter-panel w-100",{"d-none":!q}]),children:[(0,e.jsxs)("div",{className:"d-flex w-100 align-items-center mt-3",children:[(0,e.jsx)("label",{htmlFor:F,className:"w-100 pb-0 pr-1 select-sql-hint",children:ne}),z&&(0,e.jsx)(n.Button,{title:B("customSQL"),type:"tertiary",color:"inherit",size:"sm",icon:!0,onClick:Ne,children:(0,e.jsx)(le,{})}),(0,e.jsx)(n.Switch,{className:"where-switch",id:F,checked:A,onChange:Le})]}),te&&L&&(0,e.jsx)(h.SqlExpressionRuntime,{className:(0,t.classNames)([{"sql-expr-runtime-disabled":V}]),widgetId:r,dataSource:L,expression:k,onChange:Ce}),$&&L&&(0,e.jsx)(Me,{isRTL:s,widgetId:r,widgetDomRef:i,dataSource:L,imSqlExpression:k,onBack:Te})]})]}):null}var Le=i(13424),Ce=i.n(Le),Te=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n};const ke=n=>{const a=window.SVG,{className:o}=n,s=Te(n,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",o);return a?(0,e.jsx)(a,Object.assign({className:r,src:Ce()},s)):(0,e.jsx)("svg",Object.assign({className:r},s))};function Ee(a){const{isRTL:o,widgetId:s,widgetDomRef:r,jimuMapView:i,enableDataAction:l,allImDataSourceItems:u,notConfigDataSourceItems:d,configDataSourceItems:p,dataSourceItemRuntimeInfoMap:f,updateDataSourceItemRuntimeInfoForUid:m}=a,g=t.hooks.useTranslation(n.defaultMessages,c),[S,h]=t.React.useState({}),y=t.React.useMemo(()=>function(e,t){const n=[];return e.forEach(e=>{const a=e.uid,o=t[a];o&&n.push(o)}),n}(u,f),[f,u]),v=t.React.useCallback(()=>{y.forEach(e=>{e.checked||m(e.uid,{checked:!0})})},[y,m]),w=t.React.useCallback(()=>{y.forEach(e=>{e.checked&&m(e.uid,{checked:!1})})},[y,m]),I=t.React.useCallback(()=>{y.forEach(e=>{m(e.uid,{checked:!e.checked})})},[y,m]),x=t.React.useCallback((e,t)=>{h(n=>Object.assign({},n,{[e]:t}))},[h]),R=t.React.useCallback(e=>e.filter(e=>{const t=e.uid;return!!f[t]}),[f]),M=t.React.useMemo(()=>R(d),[d,R]),j=t.React.useMemo(()=>R(p),[p,R]),D=t.React.useMemo(()=>{const e=b(u,f),t={};e.forEach(e=>{const n=null==e?void 0:e.uid;n&&(t[n]=!0)});const n=[];return Object.keys(S).forEach(e=>{if(t[e]){const t=S[e];t&&n.push(t)}}),n},[u,f,S]),N=t.React.useMemo(()=>t.css`
      .layers-dropdown {
        margin-left: -4px;
      }

      .layers-dropdown-button {
        border: none;
      }

      .layers-header-tip {
        font-size: 0.875rem;
        font-weight: 600;
      }
    `,[]),L=g("batchLayerSelectableStatus");return(0,e.jsxs)("div",{className:"data-attribute-select p-4",css:N,children:[(0,e.jsxs)("div",{className:"w-100 d-flex align-items-center","aria-label":g("layers"),role:"group",children:[(0,e.jsxs)(n.Dropdown,{className:"layers-dropdown mr-1",direction:"down",menuItemCheckMode:"default",menuRole:"menu",size:"sm",children:[(0,e.jsx)(n.DropdownButton,{className:"layers-dropdown-button",size:"sm",icon:!0,arrow:!1,title:L,"aria-label":L,children:(0,e.jsx)(ke,{width:16,height:16})}),(0,e.jsxs)(n.DropdownMenu,{children:[(0,e.jsx)(n.DropdownItem,{onClick:v,children:g("allSelectable")}),(0,e.jsx)(n.DropdownItem,{onClick:w,children:g("noneSelectable")}),(0,e.jsx)(n.DropdownItem,{onClick:I,children:g("toggleAll")})]})]}),(0,e.jsxs)(n.Label,{className:"layers-header-tip mb-0 w-100",children:[" ",g("layers")," "]}),l&&(0,e.jsx)(n.DataActionList,{widgetId:s,dataSets:D,disableDataSourceLevelActions:!0,buttonType:"tertiary",listStyle:n.DataActionListStyle.Dropdown,hideGroupTitle:!0,alwaysShowBatchIcon:!0})]}),(0,e.jsx)("div",{className:"ds-list-items",children:M.map(t=>{const n=t.uid,a=f[n];return(0,e.jsx)(Ne,{isRTL:o,widgetId:s,widgetDomRef:r,jimuMapView:i,enableDataAction:l,imDataSourceItem:t,itemRuntimeInfo:a,updateDataSourceItemRuntimeInfoForUid:m,onDataRecordSetChange:x},n)})}),(0,e.jsx)("div",{className:"ds-list-items",children:j.map(t=>{const n=t.uid,a=f[n];return(0,e.jsx)(Ne,{isRTL:o,widgetId:s,widgetDomRef:r,jimuMapView:i,enableDataAction:l,imDataSourceItem:t,itemRuntimeInfo:a,updateDataSourceItemRuntimeInfoForUid:m,onDataRecordSetChange:x},n)})})]})}var Oe=i(62686),Ae=function(e,t,n,a){return new(n||(n=Promise))(function(o,s){function r(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,i)}l((a=a.apply(e,t||[])).next())})};function Ve(a){const{widgetId:o,visible:s,allImDataSourceItems:r,dataSourceItemRuntimeInfoMap:i,imSpatialSelection:l,updateDataSourceItemRuntimeInfoForUid:u}=a,g=l.buffer;let S=!1,h=0,y=null;g&&(S=g.enable,h=g.distance,y=g.unit),"number"!=typeof h&&(h=0),y||(y=f.Meters);const[v,w]=t.React.useState({}),[x,R]=t.React.useState(l.relationships&&l.relationships[0]),[M,j]=t.React.useState(""),[D,N]=t.React.useState(h),[L,C]=t.React.useState(y),[T,k]=t.React.useState(-1),[E,O]=t.React.useState(!1),A=t.React.useRef([]),V=t.hooks.useTranslation(n.defaultMessages,c);t.React.useEffect(()=>{"number"==typeof h&&N(h)},[h]),t.React.useEffect(()=>{y&&C(y)},[y]);const P=t.React.useMemo(()=>t.css`
      border-bottom: 1px solid var(--sys-color-divider-secondary);

      .select-by-location-title {
        font-size: 0.875rem;
        font-weight: 600;
      }

      .select-by-location-param-title {
        font-weight: 500;
      }

      .feature-count-info {
        background: var(--primary-100, #E6F2FF);
        border-color: var(--info-300, #60CEFF);
        border-width: 1px;
        border-style: solid;
        min-height: 32px;
      }
    `,[]),z=t.React.useMemo(()=>{if(!M)return null;return v[M]||t.DataSourceManager.getInstance().getDataSource(M)},[v,M]),B=t.React.useMemo(()=>{let e=null;return z&&(e=z.getMainDataSource()),e},[z]),F=t.React.useMemo(()=>b(r,i).length,[r,i]),U=t.React.useMemo(()=>I(r,i),[r,i]),G=U.length,W=t.React.useMemo(()=>{let e=x&&z&&!E&&F>0&&F===G;return e=!!e,e},[E,F,G,x,z]),J=t.React.useCallback(()=>{A.current=U;const e=A.current||[];O(!0),e.forEach(e=>{const t=e.uid;u(t,{isSelecting:!0})})},[A,U,u]),q=t.React.useCallback(e=>{const n=A.current||[];A.current=[],O(!1),n.forEach(n=>{n.tryExecuteSelectingByGeometryInfoAndSqlUI(t.DataSourceSelectionMode.New,e)})},[A,O]),H=t.React.useCallback(()=>{const e=A.current||[];A.current=[],O(!1),e.forEach(e=>{const t=e.uid;u(t,{isSelecting:!1})})},[A,O,u]),$=t.React.useCallback(()=>{if(!x)return;if(!z)return;J();const e=function(e,n,a,o){return Ae(this,void 0,void 0,function*(){const s={outFields:[],returnGeometry:!0,outSR:4326},r=yield e.ds.queryAll(s),i=yield(0,Oe.loadArcGISJSAPIModules)(["esri/geometry/support/jsonUtils","esri/geometry/operators/unionOperator"]),[l,c]=i,u=[];r&&r.records.length>0&&r.records.forEach(e=>{const t=e.getGeometry();if(t)if(t.declaredClass)u.push(t);else{const e=l.fromJSON(t);u.push(e)}});let d=null;if(u.length>0)if(n&&a>0&&o){const e=m[o],n=yield t.geometryUtils.createBuffer(u,[a],e);d=Array.isArray(n)?1===n.length?n[0]:n.length>=2?c.executeMany(n):null:n}else d=1===u.length?u[0]:c.executeMany(u);return d})}(new ye(z,o),S,D,L);e.then(e=>{if(!e)return void H();const n=t.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(e.type),a=d[x],o={geometry:e.toJSON(),geometryType:n,spatialRel:a};q(o)}).catch(e=>{console.error("can not get buffered union geometry",e),H()})},[D,L,S,H,q,J,x,z,o]);t.React.useEffect(()=>{k(-1),z&&z.queryCount({}).then(e=>{if(z.id===M){const t=(null==e?void 0:e.count)||0;k(t)}}).catch(e=>{console.error("query count error for location data source",e)})},[z,M]);const _=t.React.useCallback(e=>{if(z&&z.id===M&&Pe(z)){const t=(null==e?void 0:e.length)||0;k(t)}},[z,M]),Y=t.React.useCallback(e=>{const t=e.target.value;R(t)},[R]),Q=t.React.useCallback(e=>{const t=e.target.value;j(t)},[j]),K=t.React.useCallback(e=>{e&&w(t=>{const n=e.id;return Object.assign({},t,{[n]:e})})},[w]),Z=t.React.useCallback(e=>{N(e)},[N]),X=t.React.useCallback(e=>{const t=e.target.value;C(t)},[C]),ee=l.useDataSources,te=t.React.useMemo(()=>{const e=[];return ee.forEach(t=>{const n=t.dataSourceId,a=v[n];a&&e.push(a)}),e},[v,ee]);t.React.useEffect(()=>{if(!M&&ee.length>0&&te.length>0){const e=ee[0]&&ee[0].dataSourceId;if(e){te.find(t=>t.id===e)&&j(e)}}},[ee,te,M]);const ne=V("selectByData"),ae=V("apply"),oe=V("relationship"),se=V("selectingFeatures"),re=V("theBufferDistance"),ie=V("bufferUnit"),[le,ce]=t.React.useState("");return t.React.useEffect(()=>{setTimeout(()=>{const e=V("selectByLocationFeatureCountTip",{count:T});ce(e)},500)},[T,V]),(0,e.jsxs)("div",{className:(0,t.classNames)(["select-by-location p-4",{"d-none":!s}]),css:P,children:[(0,e.jsxs)("div",{className:"d-flex w-100 align-items-center mb-2","aria-label":ne,role:"group",children:[(0,e.jsx)("label",{className:"select-by-location-title w-100 mb-0",title:ne,children:ne}),(0,e.jsx)(n.Button,{className:"nowrap",type:"primary",disabled:!W,size:"sm",onClick:$,children:ae})]}),(0,e.jsxs)("div",{className:"relationship-param w-100 d-flex flex-column align-items-center mb-2",children:[(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:oe,children:oe}),(0,e.jsx)(n.Select,{className:"relationship-select w-100",size:"sm",value:x,"aria-label":oe,onChange:Y,children:l.relationships.map(t=>(0,e.jsx)("option",{value:t,children:V(p[t])},t))})]}),(0,e.jsxs)("div",{className:"data-view-param w-100 d-flex flex-column align-items-center mb-2",children:[(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:se,children:se}),(0,e.jsx)(n.Select,{className:"selecting-features-select w-100",size:"sm",value:M,"aria-label":se,onChange:Q,children:te.map(t=>(0,e.jsx)("option",{value:t.id,children:t.getLabel()||""},t.id))}),ee.map(n=>(0,e.jsx)(t.DataSourceComponent,{useDataSource:n,onDataSourceCreated:K},n.dataSourceId))]}),z&&B&&Pe(z)&&(0,e.jsx)(t.DataSourceComponent,{dataSource:B,onSelectionChange:_}),S&&(0,e.jsxs)("div",{className:"distance-unit-param w-100 d-flex flex-column align-items-center",children:[(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:re,children:re}),(0,e.jsxs)("div",{className:"d-flex w-100 justify-content-between",children:[(0,e.jsx)(n.NumericInput,{className:"distance-input w-45 mr-1","aria-label":re,size:"sm",value:D,min:0,onChange:Z}),(0,e.jsx)(n.Select,{className:"unit-select w-55",size:"sm",value:L,"aria-label":ie,onChange:X,children:Object.values(f).map(t=>(0,e.jsx)("option",{value:t,children:V(`unit_${t}`)},t))})]})]}),T>=0&&(0,e.jsx)(n.Alert,{type:"info",withIcon:!0,text:le,className:"w-100 mt-3","aria-live":"polite",buttonType:"default",closable:!1,form:"basic",open:!0,size:"medium"})]})}function Pe(e){return!!e&&(e.isDataView&&e.dataViewId===t.CONSTANTS.SELECTION_DATA_VIEW_ID)}function ze(n){const{isRTL:a,className:o,widgetProps:s,widgetDomRef:r,dataSourceItemRuntimeInfoMap:i,mixinDataSourceItemRuntimeInfoMap:l,updateDataSourceItemRuntimeInfoForUid:c,removeNotUsedDataSourceItemRuntimeInfoMap:u,updateWidgetDisplayMode:d}=n,p=t.React.useRef(null);p.current=u;const{widgetId:f,config:m,dataSourceCount:g,autoControlWidgetId:h}=s,{dataAttributeInfo:b,spatialSelection:I}=m,{allowGenerated:x,dataSourceItems:R}=b,M=!1!==s.enableDataAction,j=!!(null==I?void 0:I.enable),[D,N]=t.React.useState(!1),[L,T]=t.React.useState((0,t.Immutable)([])),k=t.React.useMemo(()=>L.concat(R),[R,L]),E=t.React.useRef(k);E.current=k,t.React.useEffect(()=>{let e=null;if(k.length>0){e=w(k,i).length>0?S.Normal:S.Loading}else e=S.Placeholder;d(e)},[k,i,d]),t.React.useEffect(()=>{if(!x)return void(0!==L.length&&T((0,t.Immutable)([])));const e=(0,t.getAppStore)().getState().dataSourcesInfo||(0,t.Immutable)({}),n=t.DataSourceManager.getInstance(),a=L.map(e=>e.useDataSource.dataSourceId).asMutable(),o=[];Object.keys(e).forEach(e=>{if(e.includes("view_in_table"))return;const a=n.getDataSource(e);if(a){const e=a.isAssociatedFeatureLayer,n=a.getDataSourceJson(),s=null==n?void 0:n.isOutputFromWidget;a.isInAppConfig()||a.isDataView||a.isLocal||s||e||C(a.type)&&a.type!==t.DataSourceTypes.SubtypeGroupLayer&&o.push(a.id)}});const{added:s,deleted:r,saved:c}=t.utils.diffArrays(!0,a,o);if(0===s.length&&0===r.length)return;const u=L.filter(e=>{const t=e.useDataSource.dataSourceId;return c.includes(t)}),d=[];if(s.length>0){s.forEach(e=>{const t=n.getDataSource(e);if(t){const e=v(t);d.push(e)}});const e=y(!1,!0,d,i);l(e)}const p=u.concat(d);T(p)},[g,x,L,l,T,i]),t.React.useEffect(()=>{const e=R.filter(e=>{const t=e.uid;return!i[t]});if(e.length>0){const t=y(!1,!1,e,i);l(t)}},[R,i,l]),t.React.useEffect(()=>{const e=setTimeout(()=>{if(E.current){const e=[];E.current.forEach(t=>{e.push(t.uid)}),p.current&&p.current(e)}},100);return()=>{clearTimeout(e)}},[k]);const O=["select-use-data-source-entry"];o&&O.push(o);const A=O.join(" ");return(0,e.jsxs)("div",{className:A,children:[(0,e.jsx)(ne,{config:m,widgetId:f,mapWidgetId:"",autoControlWidgetId:h,activeJimuMapView:null,setSelectByLocationVisible:N,allImDataSourceItems:k,dataSourceItemRuntimeInfoMap:i}),j&&(0,e.jsx)(Ve,{widgetId:f,visible:D,allImDataSourceItems:k,dataSourceItemRuntimeInfoMap:i,imSpatialSelection:I,updateDataSourceItemRuntimeInfoForUid:c}),(0,e.jsx)(Ee,{isRTL:a,widgetId:f,widgetDomRef:r,jimuMapView:null,enableDataAction:M,allImDataSourceItems:k,notConfigDataSourceItems:L,configDataSourceItems:R,dataSourceItemRuntimeInfoMap:i,updateDataSourceItemRuntimeInfoForUid:c})]})}var Be=function(e,t,n,a){return new(n||(n=Promise))(function(o,s){function r(e){try{l(a.next(e))}catch(e){s(e)}}function i(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,i)}l((a=a.apply(e,t||[])).next())})};function Fe(n){const{isRTL:a,className:o,widgetProps:s,widgetDomRef:r,dataSourceItemRuntimeInfoMap:i,mixinDataSourceItemRuntimeInfoMap:l,updateDataSourceItemRuntimeInfoForUid:c,clearAllDataSourceItemRuntimeInfoMap:u,removeNotUsedDataSourceItemRuntimeInfoMap:d,removeGeneratedJimuLayerViewDataSourceItemRuntimeInfoMap:p,updateWidgetDisplayMode:f}=n;t.React.useRef(null).current=i;const m=t.React.useRef(null);m.current=u;const g=t.React.useRef(null);g.current=d;const h=t.React.useRef(null);h.current=p;const{widgetId:b,config:I,dataSourceCount:x,mapWidgetId:R,autoControlWidgetId:M,state:j}=s,{spatialSelection:D}=I,N=I.mapInfo||function(){const e={};return(0,t.Immutable)(e)}(),L=!1!==s.enableDataAction,T=!!(null==D?void 0:D.enable),[A,P]=t.React.useState(!1),[z,B]=t.React.useState(null),F=t.React.useRef(z);F.current=z;const U=z?z.id:"",G=t.React.useMemo(()=>{let e=null;return N&&U&&(e=N[U]),e||(e=function(){const e={syncWithMap:!0,allowGenerated:!0,enableAttributeSelection:!1,dataSourceItems:void 0};return(0,t.Immutable)(e)}()),e},[U,N]),W=!!G.syncWithMap,J=t.React.useRef(W);J.current=W;const q=W,H=t.React.useRef(q);H.current=q;const $=function(e,t){return!!e||t}(W,G.allowGenerated),_=t.React.useRef($);_.current=$;const Y=E(W,G.enableAttributeSelection);t.React.useRef(Y).current=Y;const[Q,K]=t.React.useState((0,t.Immutable)([])),Z=t.React.useRef(null),X=t.React.useCallback(()=>{if(!q&&!$||!z)return void(0!==Q.length&&K((0,t.Immutable)([])));const e=t.DataSourceManager.getInstance(),n=Q.map(e=>e.useDataSource.dataSourceId).asMutable(),a=[];Ue(z,q,$).forEach(e=>{const n=e.getLayerDataSource();if(n&&C(n.type)&&n.type!==t.DataSourceTypes.SubtypeGroupLayer){const e=n.getDataSourceJson();(null==e?void 0:e.isOutputFromWidget)||a.push(n.id)}});const{added:o,saved:s}=t.utils.diffArrays(!0,n,a),r=Q.filter(e=>{const t=e.useDataSource.dataSourceId;return s.includes(t)}),i=[];o.length>0&&o.forEach(t=>{const n=e.getDataSource(t);if(n){const e=z.getJimuLayerViewByDataSourceId(n.id),t=v(n,null==e?void 0:e.id);i.push(t)}});const l=r.concat(i).asMutable(),c=O(z,l),u=(0,t.Immutable)(c);K(u)},[z,$,q,Q]);Z.current=X,t.React.useEffect(()=>{const e=Q.filter(e=>{const t=e.uid;return!i[t]});if(e.length>0){let t=!1;t=!!Y;const n=y(!0,t,e,i);l(n)}},[i,Y,Q,l]);const ee=t.React.useCallback(e=>{We(Ue(e,H.current,_.current)).finally(()=>{Z.current&&Z.current()})},[]),te=t.React.useRef(null);te.current=ee,t.React.useEffect(()=>{m.current&&m.current(),te.current&&F.current&&te.current(F.current)},[W]),t.React.useEffect(()=>{te.current&&F.current&&te.current(F.current)},[$]),t.React.useEffect(()=>{h.current&&h.current()},[Y]),t.React.useEffect(()=>{m.current&&m.current(),te.current&&te.current(z);const e=e=>Be(this,void 0,void 0,function*(){if(e&&Ge(e,H.current,_.current)&&e.type!==t.JSAPILayerTypes.SubtypeGroupLayer){yield We([e]);const t=e.getLayerDataSource();t&&C(t.type)&&Z.current&&Z.current()}}),n=e=>Be(this,void 0,void 0,function*(){if(!J.current)return;const t=e.filter(e=>k(e));if(t.length>0){const e=t.filter(e=>Ge(e,H.current,_.current));e.length>0&&(yield We(e)),Z.current&&Z.current()}}),a=e=>{e&&e.fromRuntime&&Z.current&&Z.current()};return z&&(z.addJimuLayerViewCreatedListener(e),z.addJimuLayerViewsVisibleChangeListener(n),z.addJimuLayerViewRemovedListener(a)),()=>{z&&(z.removeJimuLayerViewCreatedListener(e),z.removeJimuLayerViewsVisibleChangeListener(n),z.removeJimuLayerViewRemovedListener(a))}},[z]),t.React.useEffect(()=>{Z.current&&Z.current()},[x]);const ae=t.React.useMemo(()=>{let e=null;if(G&&!W){const t=G.dataSourceItems;t&&t.length>0&&(e=t)}return e||(e=(0,t.Immutable)([])),e},[G,W]),oe=t.React.useMemo(()=>Q.concat(ae),[ae,Q]),se=t.React.useRef(oe);se.current=oe;const re=Q.length,ie=t.React.useMemo(()=>{var e,t;let n=0;if(R){const a=V(R);(null===(e=null==a?void 0:a.useDataSources)||void 0===e?void 0:e.length)>0&&(n=null===(t=a.useDataSources)||void 0===t?void 0:t.length)}return n},[R]);t.React.useEffect(()=>{let e=null;if(R){let t=0;if(N&&Object.values(N).forEach(e=>{if(e&&!e.syncWithMap&&e.dataSourceItems){const n=e.dataSourceItems.length;n>0&&(t+=n)}}),0===re&&0===t&&0===ie)e=S.NoLayersTip;else if(U)if(oe.length>0){e=w(oe,i).length>0?S.Normal:S.Loading}else e=S.NoLayersTip;else e=S.Loading}else e=S.Placeholder;f(e)},[U,oe,i,re,ie,N,R,f]),t.React.useEffect(()=>{const e=ae.filter(e=>{const t=e.uid;return!i[t]});if(e.length>0){const t=y(!0,!1,e,i);l(t)}},[ae,i,l]),t.React.useEffect(()=>{const e=setTimeout(()=>{if(se.current){const e=[];se.current.forEach(t=>{e.push(t.uid)}),g.current&&g.current(e)}},100);return()=>{clearTimeout(e)}},[oe]);const le=t.React.useCallback(e=>{B(e)},[B]),ce=["select-use-map-entry"];o&&ce.push(o);const ue=ce.join(" ");return(0,e.jsxs)("div",{className:ue,children:[R&&(0,e.jsx)(Oe.JimuMapViewComponent,{useMapWidgetId:R,onActiveViewChange:le}),(0,e.jsx)(ne,{config:I,widgetId:b,mapWidgetId:R,autoControlWidgetId:M,widgetState:j,activeJimuMapView:z,setSelectByLocationVisible:P,allImDataSourceItems:oe,dataSourceItemRuntimeInfoMap:i}),T&&(0,e.jsx)(Ve,{widgetId:b,visible:A,allImDataSourceItems:oe,dataSourceItemRuntimeInfoMap:i,imSpatialSelection:D,updateDataSourceItemRuntimeInfoForUid:c}),(0,e.jsx)(Ee,{isRTL:a,widgetId:b,widgetDomRef:r,jimuMapView:z,enableDataAction:L,allImDataSourceItems:oe,notConfigDataSourceItems:Q,configDataSourceItems:ae,dataSourceItemRuntimeInfoMap:i,updateDataSourceItemRuntimeInfoForUid:c})]})}function Ue(e,t,n){const a=[];return e&&Object.values(e.jimuLayerViews).forEach(e=>{e&&Ge(e,t,n)&&a.push(e)}),a}function Ge(e,t,n){return!!(e&&k(e)&&function(e){var t,n,a;if(e){const o=e.getJimuMapView(),s=(null===(a=null===(n=null===(t=null==o?void 0:o.view)||void 0===t?void 0:t.map)||void 0===n?void 0:n.layers)||void 0===a?void 0:a.toArray())||[],r=function(e){let t=null;if(e){const n=e.getJimuMapView();if(n){const a=n.getParentJimuLayerViews(e.id);t=a.length>0?a[a.length-1]:e}}return t}(e),i=null==r?void 0:r.layer;if((null==s?void 0:s.length)>0&&i)return s.includes(i)}return!1}(e)&&e.isLayerVisible())&&(e.fromRuntime?n:t)}function We(e){const t=e.map(e=>{const t=e.getLayerDataSource();if(t)return Promise.resolve(t);return function(e){return new Promise(t=>{e.then(e=>{t(e)}).catch(()=>{t(null)})})}(e.createLayerDataSource())});return Promise.all(t)}var Je=i(32772),qe=i.n(Je);function He(e){const t=[];e.dataAttributeInfo&&e.dataAttributeInfo.dataSourceItems&&e.dataAttributeInfo.dataSourceItems.length>0&&e.dataAttributeInfo.dataSourceItems.forEach(e=>{const n=e.useDataSource.asMutable();t.push(n)}),e.mapInfo&&Object.values(e.mapInfo).forEach(e=>{const n=null==e?void 0:e.dataSourceItems;n&&n.length>0&&n.forEach(e=>{if(null==e?void 0:e.useDataSource){const n=e.useDataSource.asMutable();t.push(n)}})}),e.spatialSelection&&e.spatialSelection.useDataSources&&e.spatialSelection.useDataSources.length>0&&e.spatialSelection.useDataSources.forEach(e=>{const n=e.asMutable();t.push(n)});const n=[],a=[];if(t.forEach(e=>{const t=e.dataSourceId;n.includes(t)||(n.push(t),a.push(e))}),0!==a.length||!e.useMap)return a}class $e extends t.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.15.0",description:"remove useless useDataSources from Select widget",upgradeFullInfo:!0,upgrader:e=>{var t,n,a;const o=null==e?void 0:e.widgetJson,s=null==o?void 0:o.config;if(!s)return e;let r=s;if(r.useMap)(null===(n=null===(t=r.dataAttributeInfo)||void 0===t?void 0:t.dataSourceItems)||void 0===n?void 0:n.length)>0&&(r=r.setIn(["dataAttributeInfo","dataSourceItems"],[]));else{const e=null===(a=r.mapInfo)||void 0===a?void 0:a.jimuMapViews;e&&Object.keys(e).length>0&&(r=r.setIn(["mapInfo","jimuMapViews"],{}))}if(s===r)return e;const i=He(r),l=o.set("config",r).set("useDataSources",i),c=Object.assign({},e);return c.widgetJson=l,c}},{version:"1.16.0",description:"Select widget supports syncWithMap option",upgradeFullInfo:!0,upgrader:e=>{const t=null==e?void 0:e.widgetJson,n=null==t?void 0:t.config;if(!n)return e;let a=n;const o=n.mapInfo;if(a=a.set("mapInfo",{}),o&&Object.keys(o).length>0){const e=!!o.allowGenerated,t=!!o.enableAttributeSelection,n=o.jimuMapViews;if(n){const o={};Object.keys(n).forEach(a=>{const s=n[a]||[];o[a]={syncWithMap:!1,allowGenerated:e,enableAttributeSelection:t,dataSourceItems:s}}),a=a.set("mapInfo",o)}}const s=He(a);let r=t.set("config",a).set("useDataSources",s);a.useMap||(r=r.set("useMapWidgetIds",null));const i=Object.assign({},e);return i.widgetJson=r,i}}]}}const _e=new $e,Ye=t.css`
  position: relative;
  overflow-x: hidden;
  overflow-y: auto;

  .nowrap {
    white-space: nowrap;
    text-wrap: nowrap;
  }

  .no-layers-panel-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding-left: 50px;
    padding-right: 50px;
    overflow-y: hidden;
  }

  :has(.select-custom-sql-builder) {
    .select-use-data-source-entry, .select-use-map-entry {
      display: none;
    }
  }
`,Qe=a=>{var o;const{isRTL:s,widgetId:i,config:l}=a,{useMap:u}=l,d=t.hooks.useTranslation(n.defaultMessages,c),p=t.React.useRef(null),[f,m]=t.React.useState(S.Placeholder),g=t.React.useRef(f);g.current=f;const h=t.React.useRef(!1),y=t.React.useRef(null),[v,w]=t.React.useState({}),b=t.React.useCallback(e=>{if(e!==g.current){if(e===S.Loading){if(h.current)return;h.current=!0,y.current||(y.current=setTimeout(()=>{g.current===S.Loading&&m(S.NoLayersTip)},2e4))}m(e)}},[]);t.React.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]);const I=t.React.useCallback(e=>{e&&0!==Object.keys(e).length&&w(t=>Object.assign({},t,e))},[w]),x=t.React.useCallback((e,t)=>{w(n=>{const a=n[e];if(!a)return n;const o=Object.assign({},a,t),s=Object.assign({},n);return s[e]=o,s})},[w]),R=t.React.useCallback(()=>{w(()=>({}))},[w]),M=t.React.useRef(null);M.current=R;const j=t.React.useCallback(e=>{w(t=>{const n=[];if(Object.keys(t).forEach(t=>{e.includes(t)||n.push(t)}),n.length>0){const e=Object.assign({},t);return n.forEach(t=>{delete e[t]}),e}return t})},[w]),D=t.React.useCallback(()=>{w(e=>{const t=[];if(Object.keys(e).forEach(n=>{var a;const o=e[n];(null===(a=null==o?void 0:o.jimuLayerView)||void 0===a?void 0:a.fromRuntime)&&t.push(n)}),t.length>0){const n=Object.assign({},e);return t.forEach(e=>{delete n[e]}),n}return e})},[w]);t.hooks.useEffectWithPreviousValues(e=>{const t=e[0]||!1;u!==t&&M.current&&M.current()},[u]);const N=f===S.Placeholder?{borderRadius:0}:{};return(0,e.jsxs)(n.Paper,{shape:"none",ref:p,className:"jimu-widget widget-select",css:Ye,style:N,children:[!u&&(0,e.jsx)(ze,{isRTL:s,className:f===S.Normal?"":"d-none",widgetProps:a,widgetDomRef:p,dataSourceItemRuntimeInfoMap:v,mixinDataSourceItemRuntimeInfoMap:I,updateDataSourceItemRuntimeInfoForUid:x,removeNotUsedDataSourceItemRuntimeInfoMap:j,updateWidgetDisplayMode:b}),u&&(0,e.jsx)(Fe,{isRTL:s,className:f===S.Normal?"":"d-none",widgetProps:a,widgetDomRef:p,dataSourceItemRuntimeInfoMap:v,mixinDataSourceItemRuntimeInfoMap:I,updateDataSourceItemRuntimeInfoForUid:x,clearAllDataSourceItemRuntimeInfoMap:R,removeNotUsedDataSourceItemRuntimeInfoMap:j,removeGeneratedJimuLayerViewDataSourceItemRuntimeInfoMap:D,updateWidgetDisplayMode:b}),f===S.NoLayersTip&&(0,e.jsx)("div",{className:"no-layers-panel w-100 h-100 d-flex align-items-center",children:(0,e.jsxs)("div",{className:"no-layers-panel-content w-100 h-100",children:[(0,e.jsx)(r,{width:24,height:24}),(0,e.jsx)("div",{className:"mt-2 mb-2",children:d("noLayersAvailableTip")}),(null===(o=window.jimuConfig)||void 0===o?void 0:o.isInBuilder)&&(0,e.jsx)("div",{children:d("openSettingPanelTip")})]})}),f===S.Loading&&(0,e.jsx)(n.Loading,{type:n.LoadingType.Secondary}),f===S.Placeholder&&(0,e.jsx)(n.WidgetPlaceholder,{widgetId:i,icon:qe(),name:d("_widgetLabel")})]})};Qe.mapExtraStateProps=(e,n)=>{var a,o;let s=!1,r=0,i="",l="";const c=function(e,t){var n,a,o;if(e&&!e.useMap&&(null===(a=null===(n=e.dataAttributeInfo)||void 0===n?void 0:n.dataSourceItems)||void 0===a?void 0:a.length)>0){const n=null===(o=e.dataAttributeInfo)||void 0===o?void 0:o.dataSourceItems,a=function(e,t){let n=e;if(e&&e.length>0){const a=[];t&&t.length>0&&t.forEach(e=>{const t=null==e?void 0:e.dataSourceId;t&&a.push(t)});let o=!1;const s=e.filter(e=>{const t=null==e?void 0:e.useDataSource,n=null==t?void 0:t.dataSourceId,s=n&&a.includes(n);return s||(o=!0),s});n=o?s:e}return n||(n=e),n}(n,t);a&&a!==n&&(e=e.setIn(["dataAttributeInfo","dataSourceItems"],a))}return e}(n.config,n.useDataSources)||n.config;(null===(a=e.appContext)||void 0===a?void 0:a.isRTL)&&(s=!0),e.dataSourcesInfo&&Object.values(e.dataSourcesInfo).forEach(e=>{e&&e.instanceStatus===t.DataSourceStatus.Created&&r++});const u=n.useMapWidgetIds;return u&&u.length>0&&(i=u[0]),e.mapWidgetsInfo&&i&&(l=(null===(o=e.mapWidgetsInfo[i])||void 0===o?void 0:o.autoControlWidgetId)||""),{isRTL:s,dataSourceCount:r,mapWidgetId:i,autoControlWidgetId:l,config:c}},Qe.versionManager=_e;const Ke=Qe;function Ze(e){i.p=e}})(),l})())}}});