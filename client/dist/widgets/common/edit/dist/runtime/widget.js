System.register(["jimu-core/emotion","jimu-core","jimu-ui","esri/form/FormTemplate","esri/rest/support/Query","esri/form/elements/FieldElement","esri/form/elements/GroupElement","jimu-theme","esri/widgets/FeatureForm","esri/widgets/BatchAttributeForm","esri/Graphic","esri/core/Collection","jimu-arcgis","esri/core/reactiveUtils","esri/widgets/Editor"],function(e,t){var o={},n={},a={},i={},r={},l={},s={},c={},d={},u={},p={},f={},m={},v={},g={};return{setters:[function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceTypes=e.DataSourceTypes,n.ExBAddedJSAPIProperties=e.ExBAddedJSAPIProperties,n.ExtensionManager=e.ExtensionManager,n.Immutable=e.Immutable,n.JSAPILayerTypes=e.JSAPILayerTypes,n.React=e.React,n.ServiceManager=e.ServiceManager,n.SessionManager=e.SessionManager,n.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,n.WidgetState=e.WidgetState,n.WidgetVersionManager=e.WidgetVersionManager,n.appActions=e.appActions,n.classNames=e.classNames,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.defaultMessages=e.defaultMessages,n.esri=e.esri,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.privilegeUtils=e.privilegeUtils,n.useIntl=e.useIntl},function(e){a.Button=e.Button,a.ConfirmDialog=e.ConfirmDialog,a.Loading=e.Loading,a.LoadingType=e.LoadingType,a.Paper=e.Paper,a.Select=e.Select,a.TextInput=e.TextInput,a.Typography=e.Typography,a.WidgetPlaceholder=e.WidgetPlaceholder,a.defaultMessages=e.defaultMessages,a.hooks=e.hooks},function(e){i.default=e.default},function(e){r.default=e.default},function(e){l.default=e.default},function(e){s.default=e.default},function(e){c.useTheme=e.useTheme},function(e){d.default=e.default},function(e){u.default=e.default},function(e){p.default=e.default},function(e){f.default=e.default},function(e){m.JimuMapViewComponent=e.JimuMapViewComponent,m.SnappingUtils=e.SnappingUtils},function(e){v.watch=e.watch},function(e){g.default=e.default}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=c},14321:e=>{"use strict";e.exports=a},16219:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.795 5.281c.387-.387 1.028-.373 1.432.03l1.461 1.462c.404.404.417 1.045.03 1.432L8.414 14.51l-2.674.48a.637.637 0 0 1-.73-.73l.48-2.673zm-5.362 6.825-.32 1.782 1.782-.32 3.99-3.992-1.461-1.462zm4.692-4.693 1.46 1.462 1.402-1.401-1.462-1.461z" clip-rule="evenodd"></path><path fill="#000" d="M4 11H1v-1h3zM7 8H1V7h6zM10 5H1V4h9zM12 2H1V1h11z"></path></svg>'},18200:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="m14.071 2.828 1.414-1.414 2.829 2.829-1.415 1.414zm-.707.708L8.038 8.86l.236 2.593 2.593.236 5.325-5.326zm-6.01 8.838 3.889.354 8.485-8.485L15.485 0 7 8.485zM8.5 3H0v17h17v-8.5h-1V19H1V4h7.5z" clip-rule="evenodd"></path></svg>'},20277:e=>{"use strict";e.exports=s},22089:e=>{"use strict";e.exports=p},23321:e=>{"use strict";e.exports=f},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},36510:e=>{"use strict";e.exports=r},38410:e=>{"use strict";e.exports=i},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},48816:e=>{"use strict";e.exports=g},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},57523:e=>{"use strict";e.exports=u},62243:e=>{"use strict";e.exports=v},62686:e=>{"use strict";e.exports=m},67386:e=>{"use strict";e.exports=o},73387:e=>{"use strict";e.exports=d},79244:e=>{"use strict";e.exports=n},82228:e=>{"use strict";e.exports=l}},t={};function h(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,h),a.exports}h.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return h.d(t,{a:t}),t},h.d=(e,t)=>{for(var o in t)h.o(t,o)&&!h.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},h.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),h.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},h.p="";var y={};return h.p=window.jimuConfig.baseUrl,(()=>{"use strict";h.r(y),h.d(y,{__set_webpack_public_path__:()=>Be,default:()=>Pe});var e,t,o,n,a=h(67386),i=h(79244);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(t||(t={})),function(e){e.NoMap="NOMAP",e.NoLayer="NOEDITABLE"}(o||(o={})),function(e){e.Prescriptive="PRESCRIPTIVE",e.Flexible="FLEXIBLE"}(n||(n={}));var r=h(14321),l=h(38410);const s={_widgetLabel:"Edit",initAttEmptyMessage:"Please add an editable source.",noRecordTips:"No valid record is selected, select one or add one.",addFeature:"Add feature",update:"Update",deleteRecord:"Delete this record?",deleteRecordTips:"This record will be permanently removed.",deleteRecordsTips:"These records will be permanently removed.",keepRecord:"Keep record",_action_edit_label:"Edit",selectionChangeConfirmTitle:"Discard the edits?",selectionChangeConfirmTips:"You have unsaved edits that could be lost.",discardConfirm:"Discard edits",discardCancel:"Continue editing",ownerAdminNotice:"Editing is restricted but you have privileges to edit this layer.",editTheseRecords:"Edit these records"},c=["CreationDate","Creator","EditDate","Editor","GlobalID"],d=[i.JSAPILayerTypes.FeatureLayer,i.JSAPILayerTypes.SceneLayer,i.JSAPILayerTypes.BuildingComponentSublayer,i.JSAPILayerTypes.OrientedImageryLayer,i.JSAPILayerTypes.SubtypeSublayer],u=(0,i.Immutable)([i.DataSourceTypes.FeatureLayer,i.DataSourceTypes.SceneLayer,i.DataSourceTypes.BuildingComponentSubLayer,i.DataSourceTypes.OrientedImageryLayer,i.DataSourceTypes.SubtypeSublayer]),p=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),f=e=>{const t=null==e?void 0:e.allowGeometryUpdates,o=null==e?void 0:e.capabilities;return{allowGeometryUpdates:t,create:p(o,"create"),update:p(o,"update"),deletable:p(o,"delete")}};function m(e){if(!e)return[];const t=e.objectIdField,{creationDateField:o,creatorField:n,editDateField:a,editorField:i}=e.editFieldsInfo||{},{shapeAreaFieldName:r,shapeLengthFieldName:l}=e.geometryProperties||{};return[t,o,n,a,i,r,l].filter(Boolean)}const v=e=>{const t=[];return null==e||e.forEach(e=>{"group"===e.type?t.push(...v(e.elements)):t.push(e)}),t},g=e=>i.DataSourceManager.getInstance().getDataSource(e),b=e=>{const t=(null==e?void 0:e.type)===i.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===i.DataSourceTypes.BuildingComponentSubLayer;null==e||e.type,i.DataSourceTypes.OrientedImageryLayer;let o;return o=t?e.getAssociatedDataSource():e,o};var x=h(36510),S=h(82228),w=h(20277),j=h(1888),C=function(e,t,o,n){return new(o||(o=Promise))(function(a,i){function r(e){try{s(n.next(e))}catch(e){i(e)}}function l(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,l)}s((n=n.apply(e,t||[])).next())})};const I=e=>{const t=[];for(const o in e)(null==e?void 0:e[o])&&t.push(...e[o]);return t},R=(e,t)=>{const o=[],n=null==t?void 0:t.dataSourceId;for(const t in e)0===t.indexOf(n)&&(null==e?void 0:e[t])&&o.push(...e[t]);return o};const T=e=>C(void 0,void 0,void 0,function*(){if(!e)return!1;const t=i.esri.restRequest.request;try{const o=yield t(`${e}?f=json`);return!Object.keys(o).includes("error")}catch(e){return!1}}),E=e=>C(void 0,void 0,void 0,function*(){var t;const o=yield null==e?void 0:e.fetchItemInfo().then(e=>e).catch(e=>{console.error(e)});if(!o||!o.url)return!1;const n=null===(t=yield i.ServiceManager.getInstance().fetchArcGISServerInfo(o.url))||void 0===t?void 0:t.owningSystemUrl;if(!n)return!1;const a=i.SessionManager.getInstance().getSessionByUrl(n);if(!a)return!1;const r=yield a.getUser(),l="org_admin"===(null==r?void 0:r.role),s=null==o?void 0:o.isOrgItem,c=((null==r?void 0:r.privileges)||[]).includes("portal:admin:updateItems"),d=l&&s&&c,u=o.owner===(null==r?void 0:r.username),p=yield i.privilegeUtils.isItemInTheUpdatedGroup(o.id,a);return d||u||p}),k=e=>i.dataSourceUtils.getTimezoneAPIFromRuntime(e.getTimezone()),L=(e,t)=>Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((e,o)=>t[o]===e),N=e=>{var t;const o=null==e?void 0:e.getLayerDefinition(),n=null===(t=e.belongToDataSource)||void 0===t?void 0:t.getLayerDefinition();return(null==o?void 0:o.displayField)||(null==n?void 0:n.displayField)||(null==o?void 0:o.objectIdField)||(null==n?void 0:n.objectIdField)||"OBJECTID"},F=e=>({layer:e,enabled:!1,addEnabled:!1,updateEnabled:!1,deleteEnabled:!1,attributeUpdatesEnabled:!1,geometryUpdatesEnabled:!1,attachmentsOnUpdateEnabled:!1}),D=(e,t,o)=>e.filter(e=>!t.includes(e.jimuName)).map(e=>{if(e.children)return new w.default({label:e.name,description:e.subDescription||(null==e?void 0:e.description),elements:e.children.filter(e=>!t.includes(e.jimuName)).map(e=>new S.default({fieldName:e.jimuName,label:e.alias||e.name,description:e.subDescription||e.description,editableExpression:e.editAuthority?"true":"false"}))});{const t=o.find(t=>t.fieldName===e.jimuName),n=t?t.clone():new S.default({fieldName:e.jimuName,label:(null==e?void 0:e.alias)||(null==e?void 0:e.name)});return n.description=e.subDescription||(null==e?void 0:e.description),n.editableExpression=e.editAuthority&&!n.valueExpression?"true":"false",n}}),O=(e,o,n,a,r)=>C(void 0,void 0,void 0,function*(){let s,c=!1;const d=n.layer,u=null==d?void 0:d.userHasFullEditingPrivileges,p=yield E(e),g=d.editingEnabled;let h=o;h||(h=((e,o)=>{var n,a,r,l,s;const c=e.getLayerDefinition(),{allowGeometryUpdates:d,create:u,update:p,deletable:g}=f(c),h=(null===(r=null===(a=null===(n=e.getSchema())||void 0===n?void 0:n.fields)||void 0===a?void 0:a.asMutable)||void 0===r?void 0:r.call(a,{deep:!0}))||{};let y=Object.values(h);y=y.filter(e=>!m(c).includes(e.name));const b=null===(l=o.formTemplate)||void 0===l?void 0:l.elements;if(b){const e=v(b).filter(e=>"field"===e.type).map(e=>e.fieldName);y=y.filter(t=>e.includes(t.name))}(null==y?void 0:y.length)>50&&(y=y.slice(0,50));const x=(null==c?void 0:c.fields)||[],S=y.map(e=>{const t=x.find(t=>t.name===e.jimuName),o=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:o,subDescription:(null==e?void 0:e.description)||"",editable:o})}),w={dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(s=e.getRootDataSource())||void 0===s?void 0:s.id};return{id:e.id,name:e.getLabel(),useDataSource:(0,i.Immutable)(w),addRecords:u,deleteRecords:g,updateRecords:p,updateAttributes:p,updateGeometries:d&&p,showFields:y,groupedFields:S,layerHonorMode:t.Webmap}})(e,d));const y=e.getLayerDefinition(),b=m(y),x=((e,o,n,a)=>{const{groupedFields:i,layerHonorMode:r}=o,s=e.formTemplate,c=s?s.clone():new l.default,d=((null==s?void 0:s.elements)||[]).filter(e=>"field"===e.type);if(r===t.Custom&&(c.elements=D(i,a,d)),!n&&c.elements)for(const e of c.elements)"relationship"===e.type&&(e.editableExpression="false");return c.title=(null==s?void 0:s.title)||e.title,c})(d,h,a,b);if(p||u)c=!0,s={layer:d,formTemplate:x,enabled:!0,addEnabled:!0,updateEnabled:!0,deleteEnabled:!0,attributeUpdatesEnabled:!0,geometryUpdatesEnabled:!0};else if(g&&e){const{addRecords:e,deleteRecords:t,updateRecords:o,updateAttributes:n,updateGeometries:a}=h;(p||(o||t))&&(c=!0);const i=(yield T(null==d?void 0:d.url))||r,{allowGeometryUpdates:l,create:u,update:m,deletable:v}=f(y);s={layer:d,formTemplate:x,enabled:i&&(e||o||t),addEnabled:e&&u,updateEnabled:o&&m,deleteEnabled:t&&v,attributeUpdatesEnabled:n&&m,geometryUpdatesEnabled:a&&l}}else s=F(d);return{showUpdateBtn:c,editorLayerInfo:s}}),M=(e,t)=>{var o;const{addFeatures:n=[],updateFeatures:a=[],deleteFeatures:i=[]}=t;for(const t of n){const o=e.buildRecord(t);e.afterAddRecord(o)}const r=e.getIdField(),l=[];for(const t of a){const n=t.attributes[r],a=null===(o=e.getRecordById(n))||void 0===o?void 0:o.feature,i=(null==a?void 0:a.attributes)||{},s=Object.assign(i,null==t?void 0:t.attributes);t.attributes=s;const c=e.buildRecord(t);l.push(c)}e.afterUpdateRecords(l);const s=[];for(const e of i)if("attributes"in e){const t=e.getObjectId();s.push(t.toString())}else s.push((null==e?void 0:e.objectId.toString())||(null==e?void 0:e.globalId));e.afterDeleteRecordsByIds(s)},A=(e,t)=>C(void 0,void 0,void 0,function*(){const o=e.dataSource,n=e.layer,a=o.getGDBVersion();return n.applyEdits(t,{gdbVersion:a})}),_=()=>{const e=r.hooks.useClassicTheme(),t="dark"===(0,j.useTheme)().sys.color.mode;return e&&!t?i.css`--calcite-color-background: #f7f7f7;`:""},V=i.css`
  .esri-widget {
    background-color: unset !important;
  }
  .esri-feature-form__text-element {
    color: inherit;
  }
  .esri-feature-form__text-element p {
    color: inherit;
  }
  .esri-widget__content--empty {
    color: var(--sys-color-surface-paper-hint);
  }
  .esri-attachments__add-attachment-button {
    border-radius: var(--calcite-button-corner-radius);
    font-size: 0.875rem;
  }
  .esri-editor__prompt--danger .esri-editor__prompt__header__heading {
    color: var(--sys-color-surface-paper-text);
  }
`;var P=h(45508),B=h.n(P),U=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o};const $=e=>{const t=window.SVG,{className:o}=e,n=U(e,["className"]),r=(0,i.classNames)("jimu-icon jimu-icon-component",o);return t?(0,a.jsx)(t,Object.assign({className:r,src:B()},n)):(0,a.jsx)("svg",Object.assign({className:r},n))},J=i.css`
  .edit-blank {
    min-height: 300px;
    & > div{
      top: calc(50% + 20px);
      transform: translateY(-50%);
    }
    p{
      margin-top: 16px;
      margin-bottom: 16px;
      color: var(--sys-color-surface-paper-hint);
    }
  }
`,W=e=>{const{emptyTips:t}=e;return(0,a.jsx)("div",{className:"surface-1 border-0 h-100",css:J,children:(0,a.jsx)("div",{className:"w-100 text-center edit-blank",children:(0,a.jsxs)("div",{className:"position-absolute edit-blank-content w-100",children:[(0,a.jsx)($,{size:32,color:"var(--sys-color-surface-paper-hint)"}),(0,a.jsx)(r.Typography,{component:"p",variant:"label1",className:"empty-tips",children:t})]})})})},G=e=>{const{title:t,message:o,confirmText:n,cancelText:i,onConfirm:l,onCancel:s}=e;return(0,a.jsx)("calcite-scrim",{"data-testid":"prompt",children:(0,a.jsxs)("div",{className:"esri-editor__prompt--danger",children:[(0,a.jsxs)("div",{className:"esri-editor__prompt__header",children:[(0,a.jsx)("calcite-icon",{icon:"exclamation-mark-triangle"}),(0,a.jsx)(r.Typography,{component:"span",variant:"title2",className:"esri-widget__heading esri-editor__prompt__header__heading",children:t})]}),(0,a.jsx)(r.Typography,{component:"div",variant:"label1",className:"esri-editor__prompt__message",children:o}),(0,a.jsx)("div",{className:"esri-editor__prompt__divider"}),(0,a.jsxs)("div",{className:"esri-editor__prompt__actions",children:[(0,a.jsx)("calcite-button",{appearance:"outline",className:"esri-editor__prompt__half-width-button","data-testid":"secondary-prompt-button",kind:"danger",onClick:s,width:"full",children:(0,a.jsx)(r.Typography,{variant:"label1",children:i})},"prompt-secondary-button"),(0,a.jsx)("calcite-button",{appearance:"solid",className:"esri-editor__prompt__half-width-button","data-testid":"primary-prompt-button",kind:"danger",onClick:l,width:"full",children:(0,a.jsx)(r.Typography,{variant:"label1",children:n})},"prompt-primary-button")]})]})},"prompt")};var H=h(23662),z=h.n(H),q=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o};const K=e=>{const t=window.SVG,{className:o}=e,n=q(e,["className"]),r=(0,i.classNames)("jimu-icon jimu-icon-component",o);return t?(0,a.jsx)(t,Object.assign({className:r,src:z()},n)):(0,a.jsx)("svg",Object.assign({className:r},n))},Y=i.css`
  border-bottom: 1px solid var(--sys-color-divider-secondary);
  border-top-left-radius: var(--sys-shape-2);
  border-top-right-radius: var(--sys-shape-2);
  .list-empty {
    padding: 12px 15px;
    .list-empty-header {
      margin: 0;
      .list-empty-header-title {
        line-height: 1.2;
        margin-bottom: 8px;
      }
      .list-empty-description-text {
        margin: 0;
        line-height: 1.4;
      }
    }
  }
  .form-header {
    min-height: 56px;
    .form-heading{
      margin: 0 8px;
      padding: 1px 0;
      height: 56px;
      line-height: 54px;
    }
  }
  .back-button{
    width: 32px;
    padding-inline: 8px;
    padding-block: 4px;
    line-height: 16px;
    color: var(--sys-color-surface-surface-text);
    background-color: transparent;
    border-top: 0px !important;
    border-left: 0px !important;
    border-bottom: 0px !important;
    border-style: solid;
    border-color: var(--sys-color-divider-secondary);
    border-inline-end-width: 1px;
  }
  .add-feature-btn {
    position: absolute;
    right: 15px;
    top: 12px;
    button{
      width: 32px;
      height: 32px;
    }
  }
`,X=e=>{const{activeLayerInfo:t,widgetLabel:o,description:n,activeFeatures:l,editCount:c,hasTableLayerAdd:d,featureFormStep:u,onBack:p,onNew:f}=e,m="list"===u||"empty"===u,v="form"===u||"new"===u;let g="";const h=i.hooks.useTranslation(s);if("new"===u)g=h("addFeature");else if("form"===u&&t&&l)if(l.length>1)g=t.dataSource.getLabel();else if(1===l.length){const e=N(t.dataSource);g=l[0].attributes[e]||""}const y=(0,i.useIntl)(),b=c>1?` (${y.formatNumber(c)})`:"";return(0,a.jsxs)("div",{className:(0,i.classNames)({"d-flex":v}),css:Y,children:[v&&(0,a.jsx)("button",{className:"back-button",title:h("back"),onClick:p,children:"<"}),m&&(0,a.jsx)("div",{className:"list-empty",children:(0,a.jsxs)("div",{className:"list-empty-header",children:[(0,a.jsx)(r.Typography,{variant:"title1",className:"list-empty-header-title",children:o+b}),n&&(0,a.jsx)(r.Typography,{variant:"title3",color:"var(--sys-color-surface-paper-hint)",noWrap:!0,title:n,className:"list-empty-description-text",children:n})]})}),v&&(0,a.jsx)("header",{className:"form-header",children:(0,a.jsx)(r.Typography,{variant:"title1",noWrap:!0,title:g,className:"form-heading",children:g})}),d&&m&&(0,a.jsxs)(r.Button,{size:"sm",icon:!0,type:"tertiary",color:"inherit",className:"add-feature-btn",onClick:f,title:h("addFeature"),"aria-label":h("addFeature"),children:[(0,a.jsx)(K,{className:"mr-1"}),h("add")]})]})},Z=i.css`
  &.form-buttons{
    border-top: 1px solid var(--sys-color-divider-secondary);
    padding: 12px 15px;
    display: flex;
    .single-button {
      flex: 1;
    }
    .multi-buttons {
      width: 49%;
    }
  }
`,Q=e=>{const{buttons:t}=e;return(0,a.jsx)("div",{className:"d-flex justify-content-between form-buttons",css:Z,children:t.map(({disabled:e=!1,label:o,type:n,clickHandler:l},s)=>(0,a.jsx)(r.Button,{className:(0,i.classNames)({"single-button":1===t.length,"multi-buttons":t.length>1}),type:n,disabled:e,onClick:l,children:o},s))})};var ee=h(50170),te=h.n(ee),oe=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o};const ne=e=>{const t=window.SVG,{className:o}=e,n=oe(e,["className"]),r=(0,i.classNames)("jimu-icon jimu-icon-component",o);return t?(0,a.jsx)(t,Object.assign({className:r,src:te()},n)):(0,a.jsx)("svg",Object.assign({className:r},n))};var ae=h(16219),ie=h.n(ae),re=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o};const le=e=>{const t=window.SVG,{className:o}=e,n=re(e,["className"]),r=(0,i.classNames)("jimu-icon jimu-icon-component",o);return t?(0,a.jsx)(t,Object.assign({className:r,src:ie()},n)):(0,a.jsx)("svg",Object.assign({className:r},n))},se=i.css`
  &.feature-list {
    padding: 8px 16px;
    max-height: unset;
    background-color: var(--calcite-color-background);
    .feature-list-no-match {
      justify-content: center;
      align-items: center;
      height: 96px;
      display: flex;
    }
    .feature-list-group {
      padding: 12px 12px 0;
      .feature-list-group-header {
        margin-bottom: 8px;
      }
      .feature-list-group-label {
        line-height: 1.286;
      }
    }
    .feature-list-items {
      list-style: none;
      margin: 0;
      padding: 0;
      .feature-list-item {
        background-color: var(--sys-color-action);
        color: var(--sys-color-action-text);
        cursor: pointer;
        margin-bottom: 6px;
        min-height: 48px;
        transition: border 250ms ease-in-out;
        display: flex;
        justify-content: space-between;
        .feature-list-item-container {
          display: flex;
          margin: 9px 2px;
          width: 100%;
          .feature-list-item-label{
            flex: 1;
            margin: 0;
            display: flex;
            align-items: center;
            word-break: break-word;
            padding-left: 20px;
          }
        }
        &:last-child {
          margin-bottom: 0;
        }
        :hover {
          cursor: pointer;
          background-color: var(--sys-color-action-hover);
        }
        :focus,
        :focus-visible {
          outline-offset: -2px !important;
        }
      }
    }
  }
`,ce=e=>{const{editFeatures:t,layersOrder:o,layersInfo:n,batchEditing:l,onBatchEdit:c,onClickItem:d}=e,[u,p]=i.React.useState(""),f=i.hooks.useTranslation(i.defaultMessages,s),{count:m,groupedSelectedFeatures:v}=i.React.useMemo(()=>{var e;let a=0;const i=[];for(const o in t){const r=t[o];if(0===r.length||!n[o])continue;const l=null===(e=n[o])||void 0===e?void 0:e.dataSource,s=l.getLabel(),c=N(l),d=l.getIdField(),p={id:o,dsId:o,label:s,items:r.filter(e=>{var t,o,n,a;const i=(null===(t=e.feature.attributes)||void 0===t?void 0:t[c])||(null===(o=e.feature.attributes)||void 0===o?void 0:o[d])||(null===(n=e.feature.attributes)||void 0===n?void 0:n.objectid),r=u.toLowerCase();return!r||(null===(a=null==i?void 0:i.toString())||void 0===a?void 0:a.toLowerCase().indexOf(r))>-1}).map(e=>{var t,o,n;return{label:(null===(t=e.feature.attributes)||void 0===t?void 0:t[c])||(null===(o=e.feature.attributes)||void 0===o?void 0:o[d])||(null===(n=e.feature.attributes)||void 0===n?void 0:n.objectid),data:e.feature}})};a+=p.items.length,i.push(p)}return i.sort((e,t)=>o.findIndex(t=>t===e.id)-o.findIndex(e=>e===t.id)),{count:a,groupedSelectedFeatures:i}},[t,u,n,o]);return(0,a.jsxs)("div",{className:"feature-list h-100 overflow-auto",css:se,children:[(0,a.jsx)("div",{className:"feature-list-search d-flex align-items-center m-2",children:(0,a.jsx)(r.TextInput,{className:"w-100",placeholder:f("search"),onChange:e=>{p(e.target.value)},value:u,prefix:(0,a.jsx)(ne,{color:"var(--sys-color-action-input-field-placeholder)"}),allowClear:!0,title:u})}),0===m&&(0,a.jsx)("div",{className:"feature-list-no-match",children:(0,a.jsx)(r.Typography,{variant:"title1",children:f("noItemsFound")})}),m>0&&(0,a.jsx)("div",{className:"feature-list-groups",children:v.map(e=>(0,a.jsxs)("div",{role:"group","aria-label":e.label,className:"feature-list-group",children:[(0,a.jsxs)("h4",{className:"feature-list-group-header d-flex align-items-center justify-content-between",title:e.label,children:[(0,a.jsx)(r.Typography,{component:"span",variant:"title2",className:"feature-list-group-label",children:e.label}),l&&(0,a.jsx)(r.Button,{size:"sm",variant:"text",icon:!0,disabled:0===e.items.length,title:f("editTheseRecords"),onClick:()=>{(e=>{const t=e.items.map(e=>e.data);null==c||c(e.dsId,t)})(e)},children:(0,a.jsx)(le,{})})]}),(0,a.jsx)("div",{className:"feature-list-items",role:"listbox",children:e.items.map((t,o)=>(0,a.jsx)(r.Button,{role:"option",className:"w-100 border-0 feature-list-item",onClick:()=>{d(e.dsId,t.data)},children:(0,a.jsx)("div",{className:"feature-list-item-container",children:(0,a.jsx)("span",{className:"feature-list-item-label",children:t.label})})},`${e.dsId}__${t.label}_${o}`))})]},e.id))})]})},de=i.css`
  &.layer-selector{
    padding: 12px 15px;
    label {
      margin-bottom: 12px;
    }
  }
`,ue=e=>{const{activeId:t,addLayersConfig:o,onChange:n}=e,l=i.hooks.useTranslation(r.defaultMessages),s=1===o.length,c=s?o[0].name:l("selectLayer"),d=i.React.useCallback(e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;n(o)},[n]);return(0,a.jsxs)("div",{className:"layer-selector",css:de,children:[(0,a.jsx)("label",{children:(0,a.jsx)(r.Typography,{variant:"label1",children:c})}),!s&&(0,a.jsx)(r.Select,{value:t,onChange:d,children:o.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})]})};class pe extends i.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{var t,o;null===(o=null===(t=this.props)||void 0===t?void 0:t.onDataSourceCreated)||void 0===o||o.call(t,this.props.useDataSource.dataSourceId,e)},this.onSelectionChange=(e,t)=>{var o,n;!L(e,t)&&(0!==(null==e?void 0:e.length)||0!==(null==t?void 0:t.length))&&(null===(n=(o=this.props).onSelectionChange)||void 0===n||n.call(o,this.props.useDataSource.dataSourceId))},this.onDataSourceInfoChange=(e,t)=>{var o,n;if(!e)return;e.sourceVersion!==(null==t?void 0:t.sourceVersion)&&(null===(n=(o=this.props).onSourceVersionChange)||void 0===n||n.call(o,this.props.useDataSource.dataSourceId,e.sourceVersion))}}render(){const{useDataSource:e}=this.props;return(0,a.jsx)(i.DataSourceComponent,{useDataSource:e,onDataSourceCreated:this.onDataSourceCreated,onSelectionChange:this.onSelectionChange,onDataSourceInfoChange:this.onDataSourceInfoChange})}}const fe=e=>{const{useDataSources:t,unsavedChange:o,onDataSourceCreated:n,onSelectionChange:l,onSourceVersionChange:c}=e,[d,u]=i.React.useState(!1),p=i.React.useRef([]),f=i.React.useRef(null),m=i.React.useCallback(()=>{p.current.length>0&&(null!==f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(()=>{null==l||l(p.current),p.current=[]},500))},[l]),v=i.React.useCallback(e=>{p.current.includes(e)||p.current.push(e),o?u(!0):m()},[m,o]),g=i.React.useCallback(()=>{u(!1),m()},[m]),h=i.React.useCallback(()=>{u(!1)},[]);i.React.useEffect(()=>{o||m()},[m,o]);const y=i.hooks.useTranslation(s);return(0,a.jsxs)(i.React.Fragment,{children:[null==t?void 0:t.map(e=>(0,a.jsx)(pe,{useDataSource:e,onDataSourceCreated:n,onSelectionChange:v,onSourceVersionChange:c},e.dataSourceId)),d&&(0,a.jsx)(r.ConfirmDialog,{level:"warning",title:y("selectionChangeConfirmTitle"),hasNotShowAgainOption:!1,content:y("selectionChangeConfirmTips"),confirmLabel:y("discardConfirm"),cancelLabel:y("discardCancel"),onConfirm:g,onClose:h})]})};var me=h(73387),ve=h(57523),ge=h(22089),he=h(23321),ye=function(e,t,o,n){return new(o||(o=Promise))(function(a,i){function r(e){try{s(n.next(e))}catch(e){i(e)}}function l(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,l)}s((n=n.apply(e,t||[])).next())})};const be=e=>{const{activeLayerInfo:t,activeFeatures:o,sourceVersion:n,editContainer:a}=e,r=null==t?void 0:t.id,l=null==t?void 0:t.layer,s=null==t?void 0:t.formTemplate,[c,d]=i.React.useState(null),[u,p]=i.React.useState(!1),[f,m]=i.React.useState(!1),h=i.React.useRef(null),y=i.React.useCallback(()=>{var e,t;(null===(e=h.current)||void 0===e?void 0:e.destroy)&&!(null===(t=h.current)||void 0===t?void 0:t.destroyed)&&(h.current.destroy(),d(null))},[]),x=i.React.useCallback(()=>ye(void 0,void 0,void 0,function*(){try{y();const e=g(r),t=b(e),n=document&&document.createElement("div");let c;if(a.current.appendChild(n),o&&0!==o.length){const e=t.getIdField()||"OBJECTID",n=o.map(t=>t.attributes[e]),a=`${e} IN (${n.join(",")})`,r=yield t.query({where:a,returnGeometry:!0,notAddFieldsToClient:!0,outFields:["*"]}),l=(null==r?void 0:r.records)||[];c=yield Promise.all(l.map(e=>ye(void 0,void 0,void 0,function*(){return yield i.dataSourceUtils.changeToJSAPIGraphic(e.feature)})))}else c=[new ge.default({layer:l})];const u=l.fields;if(u&&"loaded"===l.loadStatus||(yield l.load(),u&&u.length>0&&l.set({fields:u})),c.length>1){const e=new he.default(c),o=new ve.default({container:n,features:e,timeZone:k(t)});h.current=o,o.on("value-change",e=>{const t=o.viewModel.valid,n=o.viewModel.userHasChangedValues?we.Normal:we.Arcade;d(n),p(t)})}else if(1===c.length){const e=c[0],o=new me.default({container:n,feature:c[0],layer:l,formTemplate:s,timeZone:k(t)});h.current=o,o.on("value-change",n=>{var a;const i=t.getIdField(),{fieldName:r}=n;if(r===i)return;const l=o.viewModel.submittable,s=e.attributes,c=o.viewModel.getValues();let u=null;if(c){const e=v((null===(a=o.viewModel.formTemplate)||void 0===a?void 0:a.elements)||[]).map(e=>"field"===e.type&&e.valueExpression&&e.fieldName).filter(e=>!!e)||[];for(const t in c)if((null==s?void 0:s[t])!==c[t]){const o=e.includes(t);if(o&&!u&&(u=we.Arcade),!o){u=we.Normal;break}}}d(u),p(l)})}}catch(e){console.error(e)}}),[o,r,l,y,a,s]),S=i.React.useCallback(()=>ye(void 0,void 0,void 0,function*(){const e=h.current;if(!e)return;let o={};if(e instanceof ve.default){if(!e.viewModel.valid)return;const n=e.viewModel.activeForm.allFieldInputs,a={};n.forEach(e=>{if(1!==e.distinctValues.length)return;const t=e.distinctValues[0];(e.userHasChangedValue||e.template.hasValueCalculations)&&(a[e.fieldName]=t)});const i=t.layer.objectIdField;o={updateFeatures:e.features.map(e=>({attributes:Object.assign(Object.assign({},a),{[i]:e.getObjectId()})}))}}else if(e instanceof me.default){if(!e.viewModel.submittable)return;const t=e.feature;if(!t)return;(null==t?void 0:t.geometry)&&(t.geometry=null);const n=e.getValues();Object.keys(n).forEach(e=>{t.attributes[e]=n[e]}),o={updateFeatures:[t]}}m(!0),d(null);try{yield A(t,o);let e=o;if(o.updateFeatures.length>1)try{const n=t.dataSource,a=n.getIdField()||"OBJECTID",i=o.updateFeatures.map(e=>{const t=e.attributes[a];return"number"==typeof t?t:parseInt(t)}),r=yield n.query({where:`${a} IN (${i.join(",")})`,outFields:["*"],returnGeometry:!1});e={updateFeatures:((null==r?void 0:r.records)||[]).map(e=>e.feature)}}catch(e){console.error(e)}M(t.dataSource,e)}catch(e){console.error(e)}return m(!1),!0}),[t]),w=i.React.useCallback(()=>ye(void 0,void 0,void 0,function*(){const e=h.current,o=null==e?void 0:e.viewModel,n=null==o?void 0:o.submittable,a=null==o?void 0:o.feature;if(n&&a){const o=e.getValues();a.attributes=o;const n={addFeatures:[a]};m(!0),d(null);try{yield A(t,n),M(t.dataSource,n)}catch(e){console.error(e)}return m(!1),!0}}),[t]),j=i.React.useCallback(()=>ye(void 0,void 0,void 0,function*(){const e=h.current;if(!e)return;let o={};if(e instanceof me.default){const t=e.feature.getObjectId();o={deleteFeatures:[{objectId:"number"==typeof t?t:parseInt(t)}]}}else if(e instanceof ve.default){o={deleteFeatures:e.features.map(e=>e.getObjectId()).toArray().map(e=>({objectId:"number"==typeof e?e:parseInt(e)}))}}m(!0),d(null);try{yield A(t,o),M(t.dataSource,o)}catch(e){console.error(e)}return m(!1),!0}),[t]),C=i.React.useRef(null);return i.React.useEffect(()=>{window.clearTimeout(C.current),C.current=window.setTimeout(()=>{r&&l&&a.current?x():y()},500)},[r,l,n,a,y,x,null==o?void 0:o.length]),i.React.useEffect(()=>{(new me.default).destroy()},[]),{loading:f,formChange:c,formSubmittable:u,saveForm:S,addForm:w,deleteForm:j}};var xe=function(e,t,o,n){return new(o||(o=Promise))(function(a,i){function r(e){try{s(n.next(e))}catch(e){i(e)}}function l(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,l)}s((n=n.apply(e,t||[])).next())})};const Se=i.css`
  ${V}
  &.widget-edit {
    .jimu-loading {
      z-index: 1;
    }
    .edit-con {
      display: flex;
      flex-direction: column;
    }
    .attr-height {
      overflow-y: auto;
      height: calc(100% - 113px);
      .edit-notice {
        margin: 12px 15px;
      }
    }
  }
`;var we;!function(e){e.Arcade="arcade",e.Normal="normal"}(we||(we={}));const je=e=>{var o,n;const{label:c,config:d,canEditFeature:u,useDataSources:p}=e,{description:v,layersConfig:h,noDataMessage:y,batchEditing:x}=d,[S,w]=i.React.useState(null),[j,C]=i.React.useState(null),[R,k]=i.React.useState({}),[L,F]=i.React.useState(null),[O,M]=i.React.useState({}),[A,V]=i.React.useState((0,i.Immutable)([])),[P,B]=i.React.useState(!1),[U,$]=i.React.useState(!1),J=i.React.useRef(void 0),H=i.React.useMemo(()=>O[S],[S,O]),z=i.hooks.useTranslation(s,i.defaultMessages,r.defaultMessages);i.React.useEffect(()=>{const e=Object.assign({},R);let t=!1;for(const o in R){h.find(e=>e.id===o)||(delete e[o],t=!0)}t&&k(e)},[R,h]);const{loading:q,formChange:K,formSubmittable:Y,saveForm:Z,addForm:ee,deleteForm:te}=be({sourceVersion:L,activeLayerInfo:H,activeFeatures:j,editContainer:J}),oe="full"===(null==H?void 0:H.privilege),ne="normal"===(null==H?void 0:H.privilege),ae=(null==H?void 0:H.isPublic)||u||oe,ie=h.find(e=>e.id===S),re=null===(n=null===(o=null==H?void 0:H.dataSource)||void 0===o?void 0:o.getLayerDefinition)||void 0===n?void 0:n.call(o),{create:le,update:se,deletable:de}=f(re),pe=(null==ie?void 0:ie.updateRecords)&&se,me=(null==ie?void 0:ie.deleteRecords)&&de,ve=(null==ie?void 0:ie.addRecords)&&le,ge=(null==re?void 0:re.type)===i.SupportedLayerServiceTypes.Table,he=(0,i.useIntl)(),ye=(null==j?void 0:j.length)>1?` (${he.formatNumber(j.length)})`:"",je=[];(oe||ne&&pe)&&je.push({label:z("update")+ye,type:"primary",disabled:!(K&&Y),clickHandler:Z});const Ce=i.React.useCallback(()=>{B(!0)},[]),Ie=i.React.useCallback(()=>{B(!1)},[]),Re=i.React.useCallback(()=>xe(void 0,void 0,void 0,function*(){(yield te())&&B(!1)}),[te]);(oe||ne&&me)&&je.push({label:z("delete")+ye,type:"danger",clickHandler:Ce});const Te=[],Ee=i.React.useCallback(()=>xe(void 0,void 0,void 0,function*(){(yield ee())&&w(null)}),[ee]);ge&&(oe||ne&&ve)&&Te.push({label:z("add"),type:"primary",disabled:!1,clickHandler:Ee});const ke=i.React.useCallback(()=>{const e=I(R);if(1===e.length){let t=!0;const o=e[0],n=o.dataSource,a=n.getSelectedRecordIds();(a.length>1||!a.includes(o.getId()))&&(t=!1),n&&t&&n.clearSelection()}$(!1),w(null),C(null)},[R]),Le=i.React.useCallback(()=>{K?$(!0):ke()},[K,ke]),Ne=i.React.useCallback(()=>{$(!1)},[]),Fe=i.React.useCallback((e,t)=>{w(e),C([t])},[]),De=i.React.useCallback((e,t)=>{w(e),C(t)},[]);i.React.useEffect(()=>{if("boolean"!=typeof u)return;const e=h.filter(e=>{const t=O[e.id];if(!t)return!1;const o=t.dataSource.getLayerDefinition(),n=(null==o?void 0:o.type)===i.SupportedLayerServiceTypes.Table;return(t.isPublic||u)&&n&&("full"===t.privilege||"normal"===t.privilege&&e.addRecords)});V(e)},[u,h,O]);const Oe=i.React.useCallback(()=>{const e=A[0].id;w(e),C(null)},[A]),Me=i.React.useCallback(e=>xe(void 0,void 0,void 0,function*(){var o,n;try{const a=g(e),i=b(a),r=yield i.createJSAPILayerByDataSource();let s;const c=h.filter(t=>t.id===e)[0];if(!c)return;if(c.layerHonorMode===t.Webmap)s=r.formTemplate;else{const e=m(i.getLayerDefinition()),t=((null===(o=r.formTemplate)||void 0===o?void 0:o.elements)||[]).filter(e=>"field"===e.type),n=D(c.groupedFields.asMutable({deep:!0}),e,t);s=r.formTemplate?r.formTemplate.clone():new l.default,s.elements=n}const d=yield E(i),u=r.userHasFullEditingPrivileges,p=null===(n=r.editingEnabled)||void 0===n||n;let f;f=d||u&&p?"full":p?"normal":"none";const v=yield T(r.url);return{id:c.id,dataSource:i,layer:r,formTemplate:s,isPublic:v,privilege:f}}catch(e){console.error(e)}}),[h]),Ae=i.React.useCallback(e=>xe(void 0,void 0,void 0,function*(){const t=yield Me(e);M(o=>{const n={};for(const a of h)a.id===e?n[a.id]=t:o[a.id]&&(n[a.id]=o[a.id]);return n})}),[Me,h]),_e=i.hooks.useLatest(S);i.React.useEffect(()=>{xe(void 0,void 0,void 0,function*(){const e={};for(const t of h){const o=t.id;g(o)&&(e[t.id]=yield Me(t.id))}M(e),_e.current&&!e[_e.current]&&(w(null),C(null))})},[h,Me,_e]);const Ve=i.hooks.useLatest(R),Pe=i.React.useCallback((e,t)=>xe(void 0,void 0,void 0,function*(){const o=Object.assign({},Ve.current);for(const t of e){const e=g(t);if(!e)return;let n=e.getSelectedRecords();const a=Object.keys(e.getSchema().fields||{}),i=e.getIdField(),r=N(e);if(n.length>0&&!n[0].getFieldValue(r)&&a.includes(r))try{const t=n.map(e=>e.getId()),o=yield e.query({outFields:[i,r],where:`${i} in (${t.join(",")})`});o.records&&(n=o.records)}catch(e){console.error(e)}o[t]=n}k(o);if(1===I(o).length){const[e,n]=Object.entries(o).find(([e,t])=>t.length>0);w(e),F(t),C([n[0].feature])}else w(null),C(null)}),[Ve]),Be=i.React.useCallback((e,t)=>{Pe([e],t)},[Pe]),Ue=i.React.useMemo(()=>h.map(e=>e.id).asMutable(),[h]),$e=I(R).length,Je=h.length>0,We=z("initAttEmptyMessage"),Ge=Je?y||z("noRecordTips"):We;let He;He=S?j?"form":"new":$e>1?"list":"empty";let ze=!1;"form"===He?ze=(!pe||!me)&&oe:"new"===He&&(ze=!ve&&oe);const qe=_();return(0,a.jsxs)(r.Paper,{shape:"none",className:"jimu-widget widget-edit esri-widget",css:[Se,qe],children:[q&&(0,a.jsx)(r.Loading,{type:r.LoadingType.Secondary}),(0,a.jsxs)("div",{className:"edit-con surface-1 border-0 h-100",children:[(0,a.jsx)(X,{widgetLabel:c,description:v,hasTableLayerAdd:A.length>0,featureFormStep:He,activeLayerInfo:H,activeFeatures:j,editCount:$e,onBack:Le,onNew:Oe}),(0,a.jsxs)("div",{className:(0,i.classNames)("attr-height",{"d-none":"form"!==He&&"new"!==He}),ref:J,children:["new"===He&&(0,a.jsx)(ue,{addLayersConfig:A,activeId:S,onChange:w}),ze&&(0,a.jsx)("calcite-notice",{className:"edit-notice",kind:"brand",open:!0,scale:"s",children:(0,a.jsx)("div",{slot:"message",children:(0,a.jsx)(r.Typography,{variant:"label3",children:z("ownerAdminNotice")})})})]}),"list"===He&&(0,a.jsx)(ce,{editFeatures:R,layersInfo:O,layersOrder:Ue,onClickItem:Fe,batchEditing:x,onBatchEdit:De}),"empty"===He&&(0,a.jsx)(W,{emptyTips:Ge}),"form"===He&&je.length>0&&ae&&(0,a.jsx)(Q,{buttons:je}),"new"===He&&Te.length>0&&(0,a.jsx)(Q,{buttons:Te})]}),P&&(0,a.jsx)(G,{title:z("deleteRecord"),message:(null==j?void 0:j.length)>1?z("deleteRecordsTips"):z("deleteRecordTips"),confirmText:z("delete"),cancelText:z("keepRecord"),onConfirm:Re,onCancel:Ie}),U&&(0,a.jsx)(G,{title:z("selectionChangeConfirmTitle"),message:z("selectionChangeConfirmTips"),confirmText:z("discardConfirm"),cancelText:z("discardCancel"),onConfirm:ke,onCancel:Ne}),(0,a.jsx)(fe,{useDataSources:p,unsavedChange:K===we.Normal&&(null==j?void 0:j.length)>0,onDataSourceCreated:Ae,onSelectionChange:Pe,onSourceVersionChange:Be})]})};var Ce=h(62686),Ie=h(62243),Re=h(18200),Te=h.n(Re);const Ee=e=>{const{id:t,formChange:o}=e,[n,l]=i.React.useState(!1),[c,d]=i.React.useState(!1),u=i.hooks.useTranslation(s),p=i.React.useMemo(()=>i.ExtensionManager.getInstance().getExtensionById(`${t}-reduxActionInterceptor`),[t]),f=i.React.useCallback(()=>{l(!1),p&&(p.confirmClose=!0),c?(0,i.getAppStore)().dispatch(i.appActions.widgetRuntimeInfoChange(t,"state",i.WidgetState.Hidden)):(0,i.getAppStore)().dispatch(i.appActions.closeWidget(t))},[p,t,c]),m=i.React.useCallback(()=>{l(!1)},[]);return i.React.useEffect(()=>{p&&(p.formChange=o)},[p,o]),i.React.useEffect(()=>{p&&(p.showWarningBeforeClose=e=>{d(e),l(!0)})},[p]),n&&(0,a.jsx)(r.ConfirmDialog,{level:"warning",title:u("selectionChangeConfirmTitle"),hasNotShowAgainOption:!1,content:u("selectionChangeConfirmTips"),confirmLabel:u("discardConfirm"),cancelLabel:u("discardCancel"),onConfirm:f,onClose:m})};var ke=h(48816),Le=function(e,t,o,n){return new(o||(o=Promise))(function(a,i){function r(e){try{s(n.next(e))}catch(e){i(e)}}function l(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,l)}s((n=n.apply(e,t||[])).next())})};const Ne=e=>{const{config:t,jimuMapView:o,editContainer:a,canEditFeature:r}=e,{mapViewsConfig:l,relatedRecords:s,liveDataEditing:c}=t,u=i.React.useRef(null),p=i.React.useCallback(()=>{u.current&&!u.current.destroyed&&u.current.destroy()},[]);i.React.useEffect(()=>()=>{p()},[p]);const[f,m]=i.React.useState([]),[v,h]=i.React.useState(!1),y=i.React.useCallback(()=>{var e,t,n,a;if(!o||"boolean"!=typeof r)return;let u=o.getAllJimuLayerViews();const p=null==l?void 0:l[o.id],f=null==p?void 0:p.customizeLayers,v=null==p?void 0:p.customJimuLayerViewIds,g=(null==p?void 0:p.layersConfig)||(0,i.Immutable)([]);f&&(u=u.sort((e,t)=>g.findIndex(t=>t.id===e.layerDataSourceId)-g.findIndex(e=>e.id===t.layerDataSourceId)));const y=((null===(a=null===(n=null===(t=null===(e=o.view)||void 0===e?void 0:e.map)||void 0===t?void 0:t.allLayers)||void 0===n?void 0:n.toArray)||void 0===a?void 0:a.call(n))||[]).filter(e=>{const t=d.includes(e.type),o=!u.find(t=>t.layer===e);return t&&o}),x=u.filter(e=>{const t=e.layer;return d.includes(t.type)}),S=[];x.forEach(e=>{const t=function(e,t,o,n){const a=e.layer,r=!!a.url,l=a.id.toString().includes("jimu-draw-measurements-layer"),s=a[i.ExBAddedJSAPIProperties.EXB_NOT_EDITABLE];let c=!0;c=e.fromRuntime?n:!t||o.includes(e.id);const d=e.isLayerVisible();return r&&!l&&!s&&c&&d}(e,f,v,c);t?S.push(e):y.push(e.layer)});const w=y.map(e=>F(e)),j=S.map(e=>Le(void 0,void 0,void 0,function*(){var t,o,n;const a=yield e.getOrCreateLayerDataSource();if(!a)return null;const i=null===(n=null===(o=null===(t=g.filter(e=>e.id===(null==a?void 0:a.id)))||void 0===t?void 0:t[0])||void 0===o?void 0:o.asMutable)||void 0===n?void 0:n.call(o,{deep:!0}),l=b(a);return O(l,i,e,s,r)}));Promise.all(j).then(e=>{var t;const n=e.filter(e=>!!e);h(n.some(e=>e.showUpdateBtn));const a=n.map(e=>e.editorLayerInfo).concat(w),i=[],r=o.view.map.allTables.toArray()||[];for(const e of a){if(!((null===(t=e.formTemplate)||void 0===t?void 0:t.elements)||[]).some(e=>"relationship"===e.type))continue;const o=e.layer.relationships;for(const t of o){const o=t.relatedTableId,n=r.find(e=>e.layerId===o);if(!n)continue;i.find(e=>e.layer===n)||i.push({layer:n,enabled:!0,addEnabled:e.addEnabled,updateEnabled:e.updateEnabled,deleteEnabled:e.deleteEnabled})}}m(a.concat(i))})},[r,o,c,l,s]);i.React.useEffect(()=>{y()},[y]);const x=i.hooks.useLatest(y);i.React.useEffect(()=>{var e,t;if(!(null===(t=null===(e=null==o?void 0:o.view)||void 0===e?void 0:e.map)||void 0===t?void 0:t.layers))return;const n=()=>{x.current()};let a=null,i=o.getAllJimuLayerViews().length;const r=e=>{e.fromRuntime?x.current():(a&&window.clearTimeout(a),a=window.setTimeout(()=>{const e=o.getAllJimuLayerViews().length;e!==i&&(x.current(),i=e)},5e3))};return o.addJimuLayerViewsVisibleChangeListener(n),o.addJimuLayerViewCreatedListener(r),o.addJimuLayerViewRemovedListener(r),()=>{var e,t,a;null===(e=null==o?void 0:o.removeJimuLayerViewsVisibleChangeListener)||void 0===e||e.call(o,n),null===(t=null==o?void 0:o.removeJimuLayerViewCreatedListener)||void 0===t||t.call(o,r),null===(a=null==o?void 0:o.removeJimuLayerViewRemovedListener)||void 0===a||a.call(o,r)}},[o,x]);const S=i.React.useCallback(()=>Le(void 0,void 0,void 0,function*(){var e;const a=u.current,{selfSnapping:i,featureSnapping:r,gridSnapping:l=!1,defaultSelfEnabled:s,defaultFeatureEnabled:c,defaultGridEnabled:d=!1,snapSettingMode:p,defaultSnapLayers:f,tooltip:m,defaultTooltipEnabled:v=!1,segmentLabel:g=!0,defaultSegmentLabelEnabled:h=!1,templateFilter:y,initialReshapeMode:b,batchEditing:x=!1}=t;a.tooltipOptions.enabled=v,a.labelOptions.enabled=h,a.snappingOptions.enabled=s||c||d,a.snappingOptions.selfEnabled=s,a.snappingOptions.featureEnabled=c,a.snappingOptions.gridEnabled=d&&l,a.snappingOptions.featureSources=yield Ce.SnappingUtils.getSnappingFeatureSourcesCollection(o,f);const S=p===n.Flexible&&(i||r||l);a.visibleElements.selectionToolbar=x,a.visibleElements.snappingControls=S,a.visibleElements.snappingControlsElements={enabledToggle:i||r||l,selfEnabledToggle:i,featureEnabledToggle:r,layerList:r,layerListToggleLayersButton:r,gridEnabledToggle:l,gridControls:l},a.visibleElements.tooltipsToggle=m,a.visibleElements.labelsToggle=g;const w=S||m||g&&"3d"===(null===(e=o.view)||void 0===e?void 0:e.type);a.visibleElements.settingsMenu=w,a.supportingWidgetDefaults={featureTemplates:{visibleElements:{filter:y}},sketch:{defaultUpdateOptions:{tool:b?"reshape":"transform"}}}}),[t,o]),w=i.hooks.usePrevious(o),j=i.hooks.usePrevious(t),C=i.React.useCallback((e,t)=>Le(void 0,void 0,void 0,function*(){var n;if(!(null===(n=u.current)||void 0===n?void 0:n.viewModel.syncing))return;const a=o.getDataSourceIdByAPILayer(e),i=g(a);if(!i)return;const r=e.objectIdField,l=t.addedFeatures.map(e=>e.objectId);let s=[];if(l.length>0){const t=yield e.queryFeatures({where:`${r} IN (${l.join(",")})`,outFields:["*"],returnGeometry:!1});s=(null==t?void 0:t.features)||[]}const c=t.updatedFeatures.map(e=>e.objectId);let d=[];if(c.length>0){const t=yield e.queryFeatures({where:`${r} IN (${c.join(",")})`,outFields:["*"],returnGeometry:!1});d=(null==t?void 0:t.features)||[]}const p=t.deletedFeatures.map(e=>({objectId:e.objectId}));M(i,{addFeatures:s,updateFeatures:d,deleteFeatures:p})}),[o]);return i.React.useEffect(()=>{if(o&&a.current)if(u.current&&o===w)t!==j&&S();else{p();const e=document.createElement("div");e.className="h-100",a.current.appendChild(e),u.current=new ke.default({container:e,view:o.view}),S()}},[t,p,a,o,j,w,S]),i.React.useEffect(()=>{const e=u.current;if(!e)return;const t=[];for(const e of f){if(!e.enabled)continue;const o=e.layer;if("subtype-sublayer"===o.type){const e=o.parent,n=null==e?void 0:e.on("edits",t=>{C(e,t)});t.push(n)}else{const e=o,n=e.on("edits",t=>{C(e,t)});t.push(n)}}return e.layerInfos=f,e.visibleElements.editFeaturesSection=v,()=>{for(const e of t)e.remove()}},[f,v,C]),u.current};var Fe=function(e,t,o,n){return new(o||(o=Promise))(function(a,i){function r(e){try{s(n.next(e))}catch(e){i(e)}}function l(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,l)}s((n=n.apply(e,t||[])).next())})};const De=e=>i.css`
  ${V}
  overflow: clip;
  --calcite-flow-header-background-color: ${e.sys.color.surface.paper};
  --calcite-flow-heading-text-color: ${e.sys.color.surface.paperText};
  --calcite-flow-footer-background-color: ${e.sys.color.surface.paper};
  --calcite-panel-footer-text-color: ${e.sys.color.surface.paperText};
  --calcite-accordion-item-heading-text-color: ${e.sys.color.surface.paperText};
  --calcite-accordion-item-expand-icon-color: ${e.sys.color.surface.paperText};
  --calcite-action-background-color: ${e.sys.color.action.default};
  --calcite-action-text-color: ${e.sys.color.action.text};
  --calcite-action-background-color-press: ${e.sys.color.action.pressed};
  --calcite-action-background-color-hover: ${e.sys.color.action.hover};
  --calcite-action-text-color-press: ${e.sys.color.action.text};
  --calcite-list-content-text-color: ${e.sys.color.action.text};
  --calcite-list-label-text-color: ${e.sys.color.action.text};
  --calcite-list-description-text-color: ${e.sys.color.action.text};
  .esri-editor__panel-toolbar {
    background-color: ${e.sys.color.surface.paper};
    color: ${e.sys.color.surface.paperText};
  }
  .esri-sketch-tooltip-controls__block, .esri-snapping-controls__toggle-block, .esri-snapping-controls__layer-list-block {
    background-color: ${e.sys.color.surface.paper};
    color: ${e.sys.color.surface.paperText};
  }
`,Oe=e=>{var t;const{config:o,canEditFeature:n,useMapWidgetIds:l,visible:c}=e,{mapViewsConfig:d,batchEditing:p=!1}=o,[f,m]=i.React.useState(null),[h,y]=i.React.useState(),[S,w]=i.React.useState({}),I=i.hooks.useTranslation(s),T=(0,j.useTheme)(),E=i.React.useRef(null),k=Ne({config:o,jimuMapView:f,editContainer:E,canEditFeature:n}),N=i.React.useCallback(e=>Fe(void 0,void 0,void 0,function*(){if(!f||f.isDestroyed()||!e)return;const t=null==d?void 0:d[f.id],o=null==t?void 0:t.customizeLayers,n=null==t?void 0:t.customJimuLayerViewIds,a=[];for(const t of e)try{if(!t.enabled||t.layer.isTable)continue;const e=f.getJimuLayerViewIdByAPILayer(t.layer);if(o&&!(null==n?void 0:n.includes(e)))continue;const r=(yield f.whenJimuLayerViewLoaded(e)).getLayerDataSource();if(!r||!u.includes(r.type))continue;const l=r.getMainDataSource(),s=r.getRootDataSource(),c=(0,i.Immutable)({dataSourceId:r.id,mainDataSourceId:null==l?void 0:l.id,dataViewId:r.dataViewId,rootDataSourceId:null==s?void 0:s.id});a.push(c)}catch(e){continue}y(a)}),[f,d]),F=i.React.useCallback(e=>{m(e)},[]),D=i.React.useCallback(e=>Fe(void 0,void 0,void 0,function*(){if(!k||!f||O.current)return;k.activeWorkflow&&k.cancelWorkflow();const t=k.effectiveSelectionManager;if(0===R(e,f).length)(null==t?void 0:t.hasSelection)&&t.clear();else{M.current=!0;let o=[];try{o=yield((e,t)=>C(void 0,void 0,void 0,function*(){const o=[];for(const n in t){const a=g(n),i=b(a).getIdField(),r=t[n];if((null==r?void 0:r.length)>0){const a=`${i} IN (${t[n].map(e=>{var t;return(null===(t=e)||void 0===t?void 0:t.feature).attributes[i]}).join()})`,r=e.getJimuLayerViewByDataSourceId(n),l=null==r?void 0:r.layer;if(!l)continue;const s=new x.default({where:a,outFields:["*"],returnGeometry:!0});o.push(l.queryFeatures(s))}}return(yield Promise.all(o)).reduce((e,t)=>Array.isArray(t.features)?e.concat(t.features):e,[])}))(f,e)}catch(e){console.error("Failed to query editing features:",e)}if(0===o.length)(null==t?void 0:t.hasSelection)&&t.clear(),console.error("No features found for the selected data records.");else if(1===o.length){(null==t?void 0:t.hasSelection)&&t.clear();const e=o[0];k.startUpdateWorkflowAtFeatureEdit(e)}else o.length>1&&("2d"===f.view.type&&p?((null==t?void 0:t.hasSelection)&&t.clear(),t&&t.updateSelection({current:o,added:[],removed:[]})):k.startUpdateWorkflowAtMultipleFeatureSelection(o))}}),[p,k,f]),O=i.React.useRef(!1),M=i.React.useRef(!1),A=i.React.useCallback(e=>{const t=Object.assign({},S);for(const o of e){const e=g(o);if(!e)continue;const n=e.getSelectedRecords();t[o]=n}w(t),O.current?window.setTimeout(()=>{O.current=!1},50):c&&D(t)},[S,D,c]),V=i.React.useCallback(e=>{const t=R(S,f).length;(null==k?void 0:k.viewModel.syncing)&&1!==t||A([e])},[S,k,A,f]),P=i.hooks.useLatest(S);i.React.useEffect(()=>{var e,t;c&&!(null===(e=null==k?void 0:k.activeWorkflow)||void 0===e?void 0:e.started)&&D(P.current),!c&&(null===(t=null==k?void 0:k.activeWorkflow)||void 0===t?void 0:t.started)&&k.activeWorkflow.cancel()},[P,k,D,c]);const[B,U]=i.React.useState(!1),$=i.React.useRef([]);i.React.useEffect(()=>{if(!k||!f)return;const e=k.effectiveSelectionManager,t="2d"===f.view.type&&p&&e.on("selection-change",e=>Fe(void 0,void 0,void 0,function*(){var t;if(M.current)return void(M.current=!1);const o=f.getMapDataSource();for(const n of e.changes||[]){const e=n.layer;if(!e)continue;const a=i.dataSourceUtils.getDataSourceIdByJSAPILayer(o,e),r=g(a);if(!r)continue;const l=n.selection.map(e=>e.toString())||[],s=r.getSelectedRecordIds();if(!L(l,s)&&(0!==l.length||0!==s.length)){if(0===l.length)r.clearSelection();else{const e=null===(t=yield r.query({objectIds:l.map(e=>e.toString()),outFields:["*"],returnGeometry:!0}))||void 0===t?void 0:t.records;r.selectRecordsByIds(e.map(e=>e.getId()),e)}O.current=!0}}})),o=Ie.watch(()=>{var e,t,o;return null===(o=null===(t=null===(e=k.viewModel)||void 0===e?void 0:e.activeWorkflow)||void 0===t?void 0:t.data)||void 0===o?void 0:o.candidates},(t,o)=>{var n,a,r,l,s;const c=null===(a=null===(n=k.viewModel)||void 0===n?void 0:n.activeWorkflow)||void 0===a?void 0:a.data,d=(null===(l=null===(r=null==c?void 0:c.rootFeatures)||void 0===r?void 0:r.toArray)||void 0===l?void 0:l.call(r))||[],u=0===$.current.length&&1===d.length,m=1===$.current.length&&0===d.length,v=(u||m)&&!(null==e?void 0:e.hasSelection);if("2d"===f.view.type&&p&&!v)return;$.current=d||[];const h=k.viewModel.selectionToolbarViewModel;if(h&&h.activeOperation&&(null===(s=h.cancel)||void 0===s||s.call(h)),M.current||k.viewModel.syncing)return void(void 0!==t&&(M.current=!1));const y=(null==t?void 0:t.length)>0?t:d,b={};for(const e of y||[])b[e.layer.id]||(b[e.layer.id]=[]),b[e.layer.id].push(e);const x=k.layerInfos.map(e=>e.layer);for(const e of x){const t=f.getMapDataSource(),o=i.dataSourceUtils.getDataSourceIdByJSAPILayer(t,e),n=g(o);if(!n)continue;const a=b[e.id]||[],r=[],l=[];for(const e of a){const t=n.buildRecord(e);l.push(t),r.push(t.getId())}const s=n.getSelectedRecordIds();L(s,r)||0===s.length&&0===r.length||(n.selectRecordsByIds(r,l),O.current=!0)}}),n=Ie.watch(()=>{var e;return null===(e=k.viewModel)||void 0===e?void 0:e.formViewModel},e=>{if(e){if("features"in e){const t=e;t.on("value-change",e=>{U(t.userHasChangedValues)})}else if("feature"in e){const t=e,o=t.getValues();t.on("value-change",e=>{var n;const a=t.layer.objectIdField,i=v((null===(n=t.formTemplate)||void 0===n?void 0:n.elements)||[]).map(e=>"field"===e.type&&e.valueExpression&&e.fieldName).filter(e=>!!e)||[],{fieldName:r}=e;if(r===a||i.includes(r))return;const l=t.getValues();let s=!1;if(l)for(const e in l)if(!i.includes(e)&&(null==o?void 0:o[e])!==l[e]){s=!0;break}U(s)}),t.on("submit",()=>{U(!1)})}}else U(!1)});return()=>{var e,a;null===(e=null==t?void 0:t.remove)||void 0===e||e.call(t),null===(a=null==o?void 0:o.remove)||void 0===a||a.call(o),n.remove()}},[k,f,p]),i.React.useEffect(()=>{if(!k)return;const e=Ie.watch(()=>null==k?void 0:k.layerInfos,e=>{N(e)},{initial:!0});return()=>{e.remove()}},[k,N]);const J=null==l?void 0:l[0],W=_();return(0,a.jsxs)(r.Paper,{shape:"none",className:"jimu-widget widget-edit",css:[De(T),W],children:[J&&(0,a.jsx)("div",{className:"edit-con h-100",ref:E}),!J&&(0,a.jsx)(r.WidgetPlaceholder,{autoFlip:!0,icon:Te(),name:I("_widgetLabel"),"data-testid":"editPlaceholder"}),(0,a.jsx)(Ce.JimuMapViewComponent,{useMapWidgetId:J,onActiveViewChange:F}),J&&!f&&(0,a.jsx)("div",{className:"jimu-secondary-loading"}),k&&(0,a.jsx)(fe,{useDataSources:h,unsavedChange:B&&!!(null===(t=k.viewModel)||void 0===t?void 0:t.formViewModel),onSelectionChange:A,onSourceVersionChange:V}),(0,a.jsx)(Ee,{id:e.id,formChange:B})]})};var Me=function(e,t,o,n){return new(o||(o=Promise))(function(a,i){function r(e){try{s(n.next(e))}catch(e){i(e)}}function l(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,l)}s((n=n.apply(e,t||[])).next())})};class Ae extends i.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.7.0",description:"Add layerHonorMode to config for support smart form.",upgrader:e=>Me(this,void 0,void 0,function*(){let o=e;const n=(e,t)=>{const o=[],n=e=>(e.forEach(e=>{if(e.groupKey)n(e.children);else{const n=t.find(t=>t.name===e.jimuName);c.includes(e.jimuName)||o.push(Object.assign(Object.assign({},e),{editable:null==n?void 0:n.editable,editAuthority:!!(null==n?void 0:n.editable)&&(null==e?void 0:e.editAuthority)}))}}),o);return n(e)};return yield Promise.all(o.layersConfig.map(e=>new Promise(t=>{i.DataSourceManager.getInstance().createDataSourceByUseDataSource(e.useDataSource).then(o=>{const a=null==o?void 0:o.getLayerDefinition(),i=(null==a?void 0:a.fields)||[],r=e.groupedFields.map(e=>{var t;const o=i.find(t=>t.name===e.jimuName);return e.groupKey?Object.assign(Object.assign({},e),{editable:!0,editAuthority:!(null===(t=null==e?void 0:e.children)||void 0===t?void 0:t.some(e=>!1===e.editAuthority)),children:n(null==e?void 0:e.children,i)}):Object.assign(Object.assign({},e),{editable:null==o?void 0:o.editable,editAuthority:!!(null==o?void 0:o.editable)&&(null==e?void 0:e.editAuthority)})}).filter(e=>!c.includes(e.jimuName));t(r)}).catch(()=>{t([])})}))).then(e=>(e.forEach((e,n)=>{const a=o.layersConfig[n].showFields.filter(e=>!c.includes(e.jimuName));let r=[];const l=e.asMutable({deep:!0});e.forEach(e=>{e.groupKey?r=r.concat(e.children):r.push(e)}),a.forEach(e=>{r.find(t=>t.jimuName===e.jimuName)||l.push(e)}),o=o.setIn(["layersConfig",n,"groupedFields"],(0,i.Immutable)(l)),o=o.setIn(["layersConfig",n,"layerHonorMode"],t.Custom)}),Promise.resolve(o))).catch(()=>Promise.resolve(o))})},{version:"1.10.0",description:"Set old app default snapping to true",upgrader:e=>{let t=e;return t=t.set("selfSnapping",!0).set("featureSnapping",!0),t}},{version:"1.12.0",description:'Set "undefined" option to "false", and remove not editable layer',upgrader:t=>Me(this,void 0,void 0,function*(){var o,n,a;let r=t;const l=r.editMode===e.Geometry,s=i.DataSourceManager.getInstance(),c=[];for(const e of r.layersConfig){let t;try{t=yield s.createDataSourceByUseDataSource(null==e?void 0:e.useDataSource)}catch(e){console.error(e)}if(!t){c.push(e);continue}const r=null==t?void 0:t.getLayerDefinition(),d=(null===(o=null==t?void 0:t.layer)||void 0===o?void 0:o.isTable)||(null==r?void 0:r.type)===i.SupportedLayerServiceTypes.Table;if(l&&d)continue;const u=null==r?void 0:r.allowGeometryUpdates;if(null===(a=null===(n=null==t?void 0:t.layer)||void 0===n?void 0:n.editingEnabled)||void 0===a||a){let t;t=e.updateGeometries?Object.assign(Object.assign({},e),{updateRecords:!0,updateAttributes:!0,updateGeometries:u&&!0}):Object.assign(Object.assign({},e),{updateRecords:!1,updateAttributes:!1,updateGeometries:!1}),c.push(t)}}return r=r.setIn(["layersConfig"],c),r})},{version:"1.13.0",description:"Update snap options",upgrader:e=>{let t=e;return t.selfSnapping&&(t=t.set("defaultSelfEnabled",!0)),t.featureSnapping&&(t=t.set("defaultFeatureEnabled",!0)),t}},{version:"1.14.0",description:"Add predefine snapping options",upgrader:e=>{let t=e;return t=t.set("snapSettingMode",n.Flexible),t}},{version:"1.15.0",description:"Add general setting options",upgrader:e=>{let t=e;return t=t.set("tooltip",!0).set("templateFilter",!0).set("relatedRecords",!0),t}},{version:"1.16.0",description:"Update map mode config",upgradeFullInfo:!0,upgrader:t=>Me(this,void 0,void 0,function*(){const o=t.widgetJson,n=o.config;if(!n)return t;let a=n;const{editMode:r,layersConfig:l}=n,s={},c=(e,t,o)=>Me(this,void 0,void 0,function*(){try{const n=yield i.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,i.Immutable)({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:t}));if(!n)return console.error("Cannot create layer data source.",e),null;return`${o}-${n.jimuLayerId}`}catch(e){return console.error("Cannot create layer data source.",e),null}});if(r===e.Geometry){const e=o.useMapWidgetIds[0];for(const t of l){const o=t.id,n=o.indexOf("-"),a=t.id.substring(0,n),i=`${e}-${a}`,r=yield c(o,a,i);if(!r)continue;const l=t.asMutable({deep:!0});if(s[i]){s[i].customJimuLayerViewIds.push(r);const e=s[i].layersConfig;e.push(l),s[i].layersConfig=e}else{const e={customizeLayers:!0,customJimuLayerViewIds:[r],layersConfig:[l]};s[i]=e}}a=a.set("mapViewsConfig",s)}const d=o.set("config",(0,i.Immutable)(a));return Object.assign(Object.assign({},t),{widgetJson:d})})}]}}const _e=new Ae,Ve=t=>{const{id:o,label:n,config:r,useDataSources:l,useMapWidgetIds:s,controllerWidgetId:c,state:d}=t,u=r.editMode===e.Attribute,[p,f]=i.React.useState(void 0);i.React.useEffect(()=>{C(void 0,void 0,void 0,function*(){var e;const t=yield i.privilegeUtils.checkExbAccess(i.privilegeUtils.CheckTarget.Experience);return null===(e=null==t?void 0:t.capabilities)||void 0===e?void 0:e.canEditFeature}).then(e=>{f(e)}).catch(()=>{f(!1)})},[]);const m=c?[i.WidgetState.Active,i.WidgetState.Opened].includes(d):d!==i.WidgetState.Hidden;return u?(0,a.jsx)(je,{label:n,config:r,canEditFeature:p,useDataSources:l}):(0,a.jsx)(Oe,{id:o,visible:m,config:r,canEditFeature:p,useMapWidgetIds:s})};Ve.versionManager=_e;const Pe=Ve;function Be(e){h.p=e}})(),y})())}}});