System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-theme"],function(e,t){var a={},i={},n={},l={},o={},s={},r={},c={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.JSAPILayerTypes=e.JSAPILayerTypes,i.React=e.React,i.ServiceManager=e.ServiceManager,i.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,i.SupportedServerTypes=e.SupportedServerTypes,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.hooks=e.hooks},function(e){n.AdvancedSelect=e.AdvancedSelect,n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.ConfirmDialog=e.ConfirmDialog,n.Label=e.Label,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.PanelHeader=e.PanelHeader,n.Popper=e.Popper,n.Radio=e.Radio,n.Select=e.Select,n.Switch=e.Switch,n.TextArea=e.TextArea,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.defaultMessages=e.defaultMessages},function(e){l.LayerSetting=e.LayerSetting,l.MapWidgetSelector=e.MapWidgetSelector,l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection,l.SidePopper=e.SidePopper},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent,o.SnappingUtils=e.SnappingUtils},function(e){s.List=e.List,s.Tree=e.Tree,s.TreeAlignmentType=e.TreeAlignmentType,s.TreeCollapseStyle=e.TreeCollapseStyle,s.TreeItemActionType=e.TreeItemActionType},function(e){r.DataSourceSelector=e.DataSourceSelector,r.FieldSelector=e.FieldSelector,r.dataComponentsUtils=e.dataComponentsUtils},function(e){c.useTheme=e.useTheme}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=c},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},13089:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=n},19556:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h4a1 1 0 0 1 1 1v1h8a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1m0 1v11h13V4.913H5V3zm6 3h1v3h3v1H8v3H7v-3H4V9h3z" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=o},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=a},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=l},98640:e=>{"use strict";e.exports=s}},t={};function d(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,d),n.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var a in t)d.o(t,a)&&!d.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var u={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(u),d.d(u,{__set_webpack_public_path__:()=>xe,default:()=>Se});var e,t,a,i,n=d(67386),l=d(79244),o=d(14321),s=d(79298),r=d(62686);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(t||(t={})),function(e){e.NoMap="NOMAP",e.NoLayer="NOEDITABLE"}(a||(a={})),function(e){e.Prescriptive="PRESCRIPTIVE",e.Flexible="FLEXIBLE"}(i||(i={}));const c={newEdit:"New editable source",newEditTips:"Support selected features view only",attrMode:"Attribute only",layerConfig:"Layer configuration",capability:"Capability",addRecords:"Add records",deleteRecords:"Delete records",updateRecords:"Update records",snappingSettings:"Snapping settings",configFields:"Configure fields",configFieldsTip:"Select fields to show",addGroup:"Add a group",group:"Group",checkAll:"Check all",uncheckAll:"Uncheck all",noDataMessageDefaultText:"No valid record is selected, select one or add one.",editBlankStatus:'Click the "{EditString}" button to add and configure {ModeString}',editableSource:"editable data sources",changeModeConfirmTitle:"Are you sure you want to switch the mode?",changeModeConfirmTips:"You will lose the settings configured.",editable:"Editable",editFieldDescription:"Please input the description.",editableCount:"{count} Editable",layerHonorSetting:"Use layer settings",layerCustomize:"Customize",noLayerTips:"The Map does not contain any editable data.",uneditableTips:"The layer is in a read-only state.",templateFilter:"Template filter",relatedRecords:"Related records",runtimeDataEditing:"Runtime data editing",initialReshapeMode:"Display vertices while editing",editGeometryGuides:"Show visual aids to help identify perpendicular and parallel lines when creating or updating a feature.",editFeatureToFeature:"Snap vertices of a feature that is currently being drawn or reshaped to that of an existing feature's vertex, edge, or end point.",batchEditingSetting:"Batch editing",layerLabel:"Layer label",fieldGroupLabel:"Group label",fieldDescription:"Field description",groupDescription:"Group description"},m=e=>{const{config:a,onPropertyChange:i,onMultiplePropertyChange:r}=e,{description:d,noDataMessage:u,batchEditing:m=!1}=a,p=l.hooks.useTranslation(c,o.defaultMessages);return(0,n.jsxs)(s.SettingSection,{role:"group","aria-label":p("iconGroup_general"),title:p("iconGroup_general"),children:[(0,n.jsx)(s.SettingRow,{tag:"label",label:p("batchEditingSetting"),children:(0,n.jsx)(o.Switch,{checked:m,"data-key":"batchEditing",onChange:(e,n)=>{var o;if(n&&(null===(o=a.layersConfig)||void 0===o?void 0:o.length)>0){let e=a.layersConfig;for(let a=0;a<e.length;a++){let i=e[a];i.layerHonorMode===t.Custom&&(i=i.set("layerHonorMode",t.Webmap),e=l.Immutable.set(e,a,i))}r([{name:"batchEditing",value:n},{name:"layersConfig",value:e}])}else i("batchEditing",n)}})}),(0,n.jsx)(s.SettingRow,{flow:"wrap",label:p("description"),children:(0,n.jsx)(o.TextArea,{className:"w-100",height:90,"aria-label":p("description"),placeholder:p("editFieldDescription"),defaultValue:null!=d?d:"",onBlur:e=>{i("description",e.target.value)}})}),(0,n.jsx)(s.SettingRow,{flow:"wrap",label:p("noDataMessage"),children:(0,n.jsx)(o.TextArea,{className:"w-100",height:75,"aria-label":p("noDataMessage"),placeholder:p("noDataMessageDefaultText"),defaultValue:u,onBlur:e=>{i("noDataMessage",e.target.value)}})})]})};var p=d(23662),g=d.n(p),h=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const f=e=>{const t=window.SVG,{className:a}=e,i=h(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",a);return t?(0,n.jsx)(t,Object.assign({className:o,src:g()},i)):(0,n.jsx)("svg",Object.assign({className:o},i))};var y=d(98640),b=d(62838),v=d.n(b);const S=[l.JSAPILayerTypes.FeatureLayer,l.JSAPILayerTypes.SceneLayer,l.JSAPILayerTypes.BuildingComponentSublayer,l.JSAPILayerTypes.OrientedImageryLayer,l.JSAPILayerTypes.SubtypeSublayer],x=(0,l.Immutable)([l.DataSourceTypes.FeatureLayer,l.DataSourceTypes.SceneLayer,l.DataSourceTypes.BuildingComponentSubLayer,l.DataSourceTypes.OrientedImageryLayer,l.DataSourceTypes.SubtypeSublayer]),j=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),C=e=>{const t=null==e?void 0:e.allowGeometryUpdates,a=null==e?void 0:e.capabilities;return{allowGeometryUpdates:t,create:j(a,"create"),update:j(a,"update"),deletable:j(a,"delete")}};function w(e){if(!e)return[];const t=e.objectIdField,{creationDateField:a,creatorField:i,editDateField:n,editorField:l}=e.editFieldsInfo||{},{shapeAreaFieldName:o,shapeLengthFieldName:s}=e.geometryProperties||{};return[t,a,i,n,l,o,s].filter(Boolean)}const R=e=>{const t=[];return null==e||e.forEach(e=>{"group"===e.type?t.push(...R(e.elements)):t.push(e)}),t},I=(e,a)=>{var i,n,o,s,r;const c=e.getLayerDefinition(),{allowGeometryUpdates:d,create:u,update:m,deletable:p}=C(c),g=(null===(o=null===(n=null===(i=e.getSchema())||void 0===i?void 0:i.fields)||void 0===n?void 0:n.asMutable)||void 0===o?void 0:o.call(n,{deep:!0}))||{};let h=Object.values(g);h=h.filter(e=>!w(c).includes(e.name));const f=null===(s=a.formTemplate)||void 0===s?void 0:s.elements;if(f){const e=R(f).filter(e=>"field"===e.type).map(e=>e.fieldName);h=h.filter(t=>e.includes(t.name))}(null==h?void 0:h.length)>50&&(h=h.slice(0,50));const y=(null==c?void 0:c.fields)||[],b=h.map(e=>{const t=y.find(t=>t.name===e.jimuName),a=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:a,subDescription:(null==e?void 0:e.description)||"",editable:a})}),v={dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(r=e.getRootDataSource())||void 0===r?void 0:r.id};return{id:e.id,name:e.getLabel(),useDataSource:(0,l.Immutable)(v),addRecords:u,deleteRecords:p,updateRecords:m,updateAttributes:m,updateGeometries:d&&m,showFields:h,groupedFields:b,layerHonorMode:t.Webmap}},T=e=>l.DataSourceManager.getInstance().getDataSource(e),k=e=>{const t=(null==e?void 0:e.type)===l.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===l.DataSourceTypes.BuildingComponentSubLayer;null==e||e.type,l.DataSourceTypes.OrientedImageryLayer;let a;return a=t?e.getAssociatedDataSource():e,a};const D={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:y.TreeItemActionType.RenderOverrideItem,children:[{name:y.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemBody,children:[{name:y.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:y.TreeItemActionType.RenderOverrideItemDragHandle},{name:y.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:y.TreeItemActionType.RenderOverrideItemTitle},{name:y.TreeItemActionType.RenderOverrideItemDetailToggle},{name:y.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},M=l.css`
  display: block !important;
  &.setting-ui-unit-list {
    width: 100%;
    .tree-item {
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      &.tree-item_level-1 {
      }
      .jimu-checkbox {
        margin-right: 8px;
      }
    }
    .setting-ui-unit-list-new {
      padding-top: 4px;
    }
  }
`,N=e=>{const{layersConfig:t,activeIndex:a,failedDataSourceIds:i,onRemove:r,onSort:c,onClick:d}=e,u=l.hooks.useTranslation(o.defaultMessages,l.defaultMessages),m=t.length,p=l.React.useMemo(()=>t.asMutable({deep:!0}).map((e,t)=>({itemStateDetailContent:e,itemKey:e.id,itemStateTitle:e.name,itemStateChecked:t===a,itemStateCommands:[{label:u("remove"),iconProps:()=>({icon:v(),size:12}),action:()=>{r(e.id)}}]})),[a,t,r,u]),g=l.React.useMemo(()=>(0,n.jsx)(o.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:u("dataSourceCreateError")}),[u]),h=l.React.useCallback((e,t)=>{var a,n;const{itemJsons:l}=t.props,[o]=l,s=null===(n=null===(a=null==o?void 0:o.itemStateDetailContent)||void 0===a?void 0:a.useDataSource)||void 0===n?void 0:n.dataSourceId;return i.includes(s)?g:null},[g,i]),f=l.React.useCallback((e,t)=>{if("handleDidDrop"===e.updateType){const t=e.targetDropItemChildren.map(e=>e.itemKey);c(t)}},[c]),b=l.React.useCallback((e,t)=>{const{itemJsons:[a]}=t.props;d(a.itemKey)},[d]),S=l.React.useMemo(()=>[{itemStateDetailContent:"......",itemKey:`${a}`,itemStateTitle:"......",itemStateChecked:!0,itemStateCommands:[]}],[a]);return(0,n.jsxs)(s.SettingRow,{className:"setting-ui-unit-list",css:M,children:[m>0&&(0,n.jsx)(y.List,Object.assign({className:"w-100",itemsJson:p,dndEnabled:!0,renderOverrideItemDetailToggle:h,onUpdateItem:f,onClickItemBody:b},D)),m===a&&(0,n.jsx)(y.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:S,dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},D))]})};var O=d(13089);const L=l.css`
  .disabled-label{
    color: var(--ref-palette-neutral-700);
  }
`,A=e=>{const{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:r,onChange:d}=e,{addRecords:u,deleteRecords:m,updateRecords:p,updateAttributes:g,updateGeometries:h}=t,f=l.hooks.useTranslation(c,o.defaultMessages),y=(null==i?void 0:i.type)===l.SupportedLayerServiceTypes.Table,{allowGeometryUpdates:b,create:v,update:S,deletable:x}=C(i),j=l.React.useCallback((e,a)=>{const i=e.currentTarget;i&&d(t.set(a,i.checked))},[t,d]),w=l.React.useCallback((e,a)=>{const i=e.currentTarget;if(!i)return;const n=i.checked;d(t.set("updateRecords",n).set("updateAttributes",n).set("updateGeometries",b&&n))},[b,t,d]),R=l.React.useCallback((e,a)=>{const i=e.currentTarget;if(!i)return;const n=i.checked;d("updateAttributes"===a&&!n&&!h||"updateGeometries"===a&&!n&&!g?t.set("updateRecords",!1).set("updateAttributes",!1).set("updateGeometries",!1):t.set(a,n))},[t,d,g,h]);return(0,n.jsx)(s.SettingSection,{title:f("capability"),css:L,children:r?(0,n.jsxs)(l.React.Fragment,{children:[(!a&&y||a)&&(0,n.jsx)(s.SettingRow,{tag:"label",label:f("addRecords"),children:(0,n.jsx)(o.Switch,{"aria-label":f("addRecords"),checked:u,onChange:e=>{j(e,"addRecords")},disabled:!v})}),(0,n.jsx)(s.SettingRow,{tag:"label",label:f("deleteRecords"),children:(0,n.jsx)(o.Switch,{"aria-label":f("deleteRecords"),checked:m,onChange:e=>{j(e,"deleteRecords")},disabled:!x})}),(0,n.jsx)(s.SettingRow,{tag:"label",label:f("updateRecords"),children:(0,n.jsx)(o.Switch,{"aria-label":f("updateRecords"),checked:p,onChange:w,disabled:!S})}),a&&p&&(0,n.jsxs)("div",{className:"ml-4 mt-2",children:[(0,n.jsxs)(o.Label,{className:"w-100 d-flex",children:[(0,n.jsx)(o.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:g,"aria-label":f("attribute"),onChange:e=>{R(e,"updateAttributes")},disabled:!S}),(0,n.jsx)("div",{className:"m-0 ml-2 flex-grow-1 omit-label",children:f("attribute")})]}),(0,n.jsxs)(o.Label,{className:"w-100 d-flex",children:[(0,n.jsx)(o.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:h,"aria-label":f("geometry"),onChange:e=>{R(e,"updateGeometries")},disabled:!b}),(0,n.jsx)("div",{className:`m-0 ml-2 flex-grow-1 omit-label ${!b&&"disabled-label"}`,children:f("geometry")})]})]})]}):f("uneditableTips")})};var E=d(1888),F=d(19556),P=d.n(F),V=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const G=e=>{const t=window.SVG,{className:a}=e,i=V(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",a);return t?(0,n.jsx)(t,Object.assign({className:o,src:P()},i)):(0,n.jsx)("svg",Object.assign({className:o},i))};var B=d(9044),J=d.n(B),z=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const H=e=>{const t=window.SVG,{className:a}=e,i=z(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",a);return t?(0,n.jsx)(t,Object.assign({className:o,src:J()},i)):(0,n.jsx)("svg",Object.assign({className:o},i))};var _=d(45508),U=d.n(_),W=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const K=e=>{const t=window.SVG,{className:a}=e,i=W(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",a);return t?(0,n.jsx)(t,Object.assign({className:o,src:U()},i)):(0,n.jsx)("svg",Object.assign({className:o},i))},$="root item for tree data entry",Y={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:y.TreeItemActionType.RenderOverrideItem,children:[{name:y.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemContent,children:[{name:y.TreeItemActionType.RenderOverrideItemBody,children:[{name:y.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:y.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemDragHandle},{name:y.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:y.TreeItemActionType.RenderOverrideItemIcon},{name:y.TreeItemActionType.RenderOverrideItemTitle},{name:y.TreeItemActionType.RenderOverrideItemCommands},{name:y.TreeItemActionType.RenderOverrideItemDetailToggle}]}]},{name:y.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]},{name:y.TreeItemActionType.RenderOverrideItemSubitems}]})},X=l.css`
  .fields-list-header {
    background: var(--ref-palette-neutral-300);
    border-bottom: 1px solid var(--ref-palette-neutral-600);
    height: 34px;
    width: 100%;
    flex-wrap: nowrap;
    .jimu-checkbox {
      margin-top: 2px;
    }
    .fields-list-check {
      margin-left: 18px;
    }
  }
  .selected-fields-con{
    margin-top: 0 !important;
    .selected-fields-list {
      flex: 1;
      max-height: 300px;
      overflow-y: auto;
    }
    .jimu-tree-item{
      background: var(--ref-palette-neutral-300);
      border-bottom: 1px solid var(--ref-palette-neutral-400);
      .jimu-tree-item__content{
        div:first-of-type{
          padding-left: 2px;
        }
        .jimu-tree-item__body{
          background: var(--ref-palette-neutral-300);
          .jimu-tree-item__title{
            .jimu-input{
              width: 125px;
            }
          }
          .item-remove-button {
            padding: 0 2px; /** consistent with detail icon from tree. */
          }
          &:hover {
            background: none !important;
          }
        }
      }
    }
  }
`,q=l.css`
  &.jimu-tree-item__detail-toggle {
    display: flex;
    align-items: center;
    cursor: pointer;

    .icon-btn-sizer {
      margin: 0;
      min-width: 0.5rem;
      min-height: 0.5rem;
    }
  }
`,Q=(e,t)=>{let a=!1;for(const i of e)if(i.jimuName===t.jimuName){a=!0;break}return a},Z=e=>{const t=[];return e.forEach(e=>{(null==e?void 0:e.groupKey)&&t.push(null==e?void 0:e.groupKey)}),t.length>0?Math.max.apply(null,t):0},ee=e=>{const{layerConfig:a,layerDefinition:i,layerEditingEnabled:r,onChange:d}=e,{useDataSource:u,showFields:m,groupedFields:p,layerHonorMode:g}=a,[h,f]=l.React.useState(null),[b,v]=l.React.useState(!1),[S,x]=l.React.useState(null),[j,C]=l.React.useState(!1),R=l.React.useRef(null),I=l.React.useRef(null),k=(0,E.useTheme)(),D=l.hooks.useTranslation(c,o.defaultMessages),M=l.React.useMemo(()=>p.asMutable({deep:!0}),[p]),N=l.React.useMemo(()=>{let e=0;return null==M||M.forEach(t=>{(null==t?void 0:t.children)?t.children.forEach(t=>{t.editAuthority&&e++}):t.editAuthority&&e++}),e},[M]),L=l.React.useMemo(()=>m.map(e=>e.jimuName),[m]),A=l.React.useMemo(()=>(0,l.Immutable)(w(i)||[]),[i]),F=l.React.useMemo(()=>!!M&&M.some(e=>!e.editAuthority&&e.editable),[M]),P=l.React.useMemo(()=>{if(!M)return!1;const e=M.some(e=>e.editAuthority&&e.editable),t=M.some(e=>!e.editAuthority&&e.editable);return e&&t},[M]),V=l.React.useCallback(e=>{const t=T(null==u?void 0:u.dataSourceId),a=null==t?void 0:t.getSchema(),i=(null==a?void 0:a.fields)?Object.values(null==a?void 0:a.fields):[],n=e=>e.filter(e=>!A.includes(e.jimuName)).map(e=>Object.assign({itemKey:e.jimuName,itemStateChecked:!!r&&(null==e?void 0:e.editAuthority),itemStateTitle:e.alias||e.jimuName||e.name,itemStateIcon:O.dataComponentsUtils.getIconFromFieldType(e.type,k),itemStateDetailContent:e,itemStateDisabled:!(null==e?void 0:e.groupKey)&&!Q(i,e),itemStateCommands:[],isCheckboxDisabled:!r||!e.editable},e.children?{itemChildren:n(e.children)}:{})),l=n(e);f({itemKey:$,itemStateTitle:$,itemChildren:l})},[A,r,k,null==u?void 0:u.dataSourceId]),B=l.hooks.useLatest(h),J=l.hooks.usePrevious(a.id);l.React.useEffect(()=>{(!B.current&&M||J!==a.id)&&V(M)},[V,M,J,a.id,B]);const z=l.React.useCallback((e,t)=>{d(a.set("layerHonorMode",t))},[a,d]),_=l.React.useCallback(e=>{if(!e)return;const t=e.filter(e=>e);let n=M;const l=t.filter(e=>!m.find(t=>t.jimuName===e.jimuName));for(const e of l){const t=((null==i?void 0:i.fields)||[]).find(t=>t.name===e.jimuName),a=null==t?void 0:t.editable;n.push(Object.assign(Object.assign({},e.asMutable({deep:!0})),{editAuthority:a,subDescription:(null==e?void 0:e.description)||"",editable:a}))}const o=m.filter(e=>!t.find(t=>t.jimuName===e.jimuName)).map(e=>e.jimuName);n=n.filter(e=>!o.includes(e.jimuName));for(let e=0;e<n.length;e++){const t=n[e];t.children&&(t.children=t.children.filter(e=>!o.includes(e.jimuName)))}d(a.set("showFields",t).set("groupedFields",n)),V(n)},[V,M,a,null==i?void 0:i.fields,d,m]),U=l.React.useCallback(()=>{const e=M;e.forEach(e=>{e.editable&&(e.editAuthority=F),e.children&&e.children.forEach(e=>{e.editAuthority=F})}),d(a.set("groupedFields",e)),V(e)},[V,M,F,a,d]),W=l.React.useCallback(()=>{C(()=>(setTimeout(()=>{C(!1)},1e3),!0));const e=Z(M)+1,t=[{jimuName:`${D("group")}-${e}`,name:`${D("group")}-${e}`,alias:`${D("group")}-${e}`,subDescription:"",editAuthority:!1,editable:!0,children:[],groupKey:e},...M];d(a.set("groupedFields",t)),V(t)},[V,M,a,d,D]),ee=l.React.useCallback(e=>{let t=[];for(const a of M)t=a.jimuName===e?t.concat(a.children):t.concat(a);d(a.set("groupedFields",t)),(null==S?void 0:S.jimuName)===e&&v(!1),V(t)},[V,null==S?void 0:S.jimuName,M,a,d]),te=l.React.useCallback((e,t)=>{const{itemJsons:a}=t.props,[i]=a,{groupKey:l,jimuName:s}=(null==i?void 0:i.itemStateDetailContent)||{};return l?(0,n.jsx)(o.Button,{icon:!0,size:"sm",type:"tertiary",disableHoverEffect:!0,disableRipple:!0,className:"item-remove-button",onClick:e=>{null==e||e.stopPropagation(),ee(s)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||ee(s)},title:D("remove"),"aria-label":D("remove"),children:(0,n.jsx)(H,{})}):""},[ee,D]),ae=l.React.useCallback((e,t)=>{R.current=e.current,x(t),v(e=>!e)},[]),ie=l.React.useCallback((e,t)=>{const{itemJsons:a,itemJsons:[{itemStateDetailVisible:i,itemStateDetailContent:l,itemStateDisabled:s}]}=t.props,[r]=a,c=null==r?void 0:r.itemStateDetailContent;return l?(0,n.jsx)(o.Button,{icon:!0,type:"tertiary",size:"sm",title:D("description"),"aria-label":D("description"),disabled:!!s,disableHoverEffect:!0,disableRipple:!0,"aria-expanded":!!i,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),ae(t.dragRef,c)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),ae(t.dragRef,c))},css:q,children:(0,n.jsx)(K,{autoFlip:!i})}):null},[ae,D]),ne=l.React.useCallback((e,t)=>{var a,i,n;const{draggingItemJsons:l,targetItemJsons:o,dropType:s}=e,r=null===(a=o[0])||void 0===a?void 0:a.itemChildren,c=null===(i=o[Math.min(1,o.length-2)])||void 0===i?void 0:i.itemChildren,d=null===(n=l[0])||void 0===n?void 0:n.itemChildren;let u=!0;return"to-inside"!==s||r&&!d||(u=!1),"to-inside"!==s&&c&&d&&(u=!1),u},[]),le=l.React.useCallback((e,t)=>{const{targetItemJsons:a}=e,[i]=a,{groupKey:n}=(null==i?void 0:i.itemStateDetailContent)||{};return!!n},[]),oe=l.React.useCallback((e,t)=>{var i;const{itemJsons:n,updateType:l}=e,o=n[0],s=null==o?void 0:o.itemStateDetailContent;if(!(null==s?void 0:s.groupKey)&&l===y.TreeItemActionType.HandleStartEditing)return;const r=n[n.length-1];f(r);const c=null===(i=r.itemChildren)||void 0===i?void 0:i.map((e,t)=>{var a;const i=e.itemStateDetailContent;if(e.itemChildren){e.itemStateTitle||(e.itemStateTitle=null===(a=e.itemStateDetailContent)||void 0===a?void 0:a.jimuName),i.name=e.itemStateTitle,i.alias=e.itemStateTitle;const t=e.itemChildren.length>0&&!e.itemChildren.some(e=>!e.isCheckboxDisabled&&!e.itemStateChecked);i.editAuthority=t;const n=e.itemChildren.map(e=>(e.itemStateDetailContent.editAuthority=e.itemStateChecked,e.itemStateDetailContent));i.children=n}else i.editAuthority=e.itemStateChecked;return i});d(a.set("groupedFields",c))},[a,d]),se=l.React.useCallback(e=>{let t;return M.forEach((a,i)=>{if(a.jimuName===e)t=[i];else if(null==a?void 0:a.children){const n=a.children.findIndex(t=>t.jimuName===e);n>-1&&(t=[i,n])}}),t},[M]),re=l.React.useCallback(()=>{var e;const t=M,i=se(null==S?void 0:S.jimuName),n=(null===(e=I.current)||void 0===e?void 0:e.value)||"";if(2===i.length){const[e,a]=i,l=t[e].children[a];l&&(l.subDescription=n)}else if(1===i.length){const[e]=i;t[e].subDescription=n}d(a.set("groupedFields",t)),v(!1),V(t)},[V,null==S?void 0:S.jimuName,se,M,a,d]);return(0,n.jsxs)(s.SettingSection,{title:D("configFields"),css:X,children:[(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Select,{size:"sm",className:"w-100",value:g,onChange:z,children:[(0,n.jsx)("option",{value:t.Webmap,children:D("layerHonorSetting")}),(0,n.jsx)("option",{value:t.Custom,children:D("layerCustomize")})]})}),g===t.Custom&&(0,n.jsxs)(l.React.Fragment,{children:[(0,n.jsx)(s.SettingRow,{flow:"wrap",label:D("configFieldsTip"),children:(0,n.jsx)(O.FieldSelector,{useDataSources:u?(0,l.Immutable)([u]):(0,l.Immutable)([]),selectedFields:(0,l.Immutable)(L),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,hiddenFields:A,onChange:_})}),(0,n.jsx)(s.SettingRow,{flow:"wrap",label:r&&D("editableCount",{count:N}),children:(0,n.jsxs)("div",{className:"fields-list-header form-inline",children:[(0,n.jsxs)("div",{className:"d-flex w-100 fields-list-check",children:[r&&(0,n.jsx)(o.Checkbox,{id:"editAll","data-field":"editAll",onClick:U,checked:!F,indeterminate:P,title:F?`${D("editable")} (${D("checkAll")})`:`${D("editable")} (${D("uncheckAll")})`}),(0,n.jsx)(o.Label,{for:"editAll",style:{cursor:"pointer"},className:"ml-2",title:D("field"),children:D("field")})]}),(0,n.jsx)(o.Button,{icon:!0,size:"sm",type:"tertiary",disableHoverEffect:!0,disableRipple:!0,onClick:W,title:D("addGroup"),"aria-label":D("addGroup"),disabled:j,children:(0,n.jsx)(G,{})})]})}),(0,n.jsxs)(s.SettingRow,{className:"selected-fields-con",children:[(0,n.jsx)(y.Tree,Object.assign({className:"selected-fields-list",rootItemJson:h,treeAlignmentType:y.TreeAlignmentType.Intact,dndEnabled:!0,checkboxLinkage:r,collapseStyle:y.TreeCollapseStyle.Arrow,renderOverrideItemCommands:te,renderOverrideItemDetailToggle:ie,isItemDroppable:ne,isFolder:le,onUpdateItem:oe},Y)),S&&(0,n.jsx)(o.Popper,{placement:"bottom-start",reference:R,offsetOptions:[-27,3],open:b,arrowOptions:!1,toggle:()=>{v(!1)},children:(0,n.jsxs)("div",{style:{width:228},className:"p-4",children:[(0,n.jsx)(o.TextArea,{ref:I,id:null==S?void 0:S.jimuName,className:"w-100",height:60,placeholder:D("editFieldDescription"),defaultValue:(null==S?void 0:S.subDescription)||(null==S?void 0:S.description)}),(0,n.jsxs)("div",{className:"d-flex justify-content-end mt-4",children:[(0,n.jsx)(o.Button,{size:"sm",type:"primary",onClick:re,children:D("commonModalOk")}),(0,n.jsx)(o.Button,{size:"sm",className:"ml-1",onClick:()=>{v(!1)},children:D("commonModalCancel")})]})]})})]})]})]})};var te=function(e,t,a,i){return new(a||(a=Promise))(function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}r((i=i.apply(e,t||[])).next())})};const ae=l.css`
  .layer-config-panel {
    .panel-inner {
      .title {
        max-width: 70%;
      }
    }
    .setting-container {
      height: calc(100% - 58px);
      overflow: auto;
    }
  }
`,ie=e=>{const{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:r,batchEditing:d=!1,filterDs:u,onChange:m,onClose:p}=e,[g,h]=l.React.useState(""),[f,y]=l.React.useState(null);l.React.useEffect(()=>{h((null==t?void 0:t.name)||"")},[null==t?void 0:t.name]);const b=l.hooks.useTranslation(c,o.defaultMessages),v=(null==t?void 0:t.useDataSource)?(0,l.Immutable)([t.useDataSource]):(0,l.Immutable)([]),S=l.React.useCallback(e=>te(void 0,void 0,void 0,function*(){const t=null==e?void 0:e[0];if(t)try{y((0,l.Immutable)(e));const a=yield l.DataSourceManager.getInstance().createDataSourceByUseDataSource(t),i=k(a),n=yield i.createJSAPILayerByDataSource(),o=I(i,n);m((0,l.Immutable)(o))}catch(e){console.error(e)}finally{y(null)}}),[m]),j=l.React.useCallback(e=>{const t=e.target.value;h(t)},[]),C=l.React.useCallback(e=>{(e=""===(e=null==e?void 0:e.trim())?null==t?void 0:t.name:e)!==g&&h(e),m(t.set("name",e))},[g,t,m]);return(0,n.jsxs)("div",{className:"w-100 h-100",css:ae,children:[f&&(0,n.jsx)(o.Loading,{type:o.LoadingType.Secondary}),(0,n.jsxs)("div",{className:"w-100 h-100 layer-config-panel",children:[!a&&(0,n.jsx)("div",{className:"w-100 d-flex px-4 py-0",children:(0,n.jsx)(o.PanelHeader,{level:1,className:"px-0 py-4 panel-inner",showClose:!!p,onClose:p,title:b("layerConfig")})}),(0,n.jsxs)("div",{className:"setting-container",children:[(0,n.jsx)(s.SettingSection,{title:b("data"),className:"pt-0",children:(0,n.jsx)(s.SettingRow,{children:(0,n.jsx)(O.DataSourceSelector,{types:x,disableRemove:()=>!0,disableDataSourceList:a,hideDataView:!0,useDataSources:f||v,mustUseDataSource:!0,onChange:S,closeDataSourceListOnChange:!0,hideDs:u,hideTabs:(0,l.Immutable)(["OUTPUT"])})})}),t&&(0,n.jsxs)(l.React.Fragment,{children:[!a&&(0,n.jsx)(s.SettingSection,{title:b("label"),children:(0,n.jsx)(s.SettingRow,{children:(0,n.jsx)(o.TextInput,{size:"sm",type:"text",className:"w-100",value:g,onChange:j,onAcceptValue:C,"aria-label":b("label")})})}),(0,n.jsx)(A,{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:r,onChange:m}),!d&&(0,n.jsx)(ee,{layerConfig:t,layerDefinition:i,layerEditingEnabled:r,onChange:m})]})]})]})]})};class ne extends l.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=e=>{this.props.onDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,n.jsx)(l.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var le=function(e,t,a,i){return new(a||(a=Promise))(function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}r((i=i.apply(e,t||[])).next())})};const oe=l.css`
  .edit-tips{
    font-style: italic;
    font-size: 12px;
    color: var(--ref-palette-neutral-1000);
  }
`,se="NEW_LAYER_CONFIG_ID",re=e=>{const{widgetId:t,config:a,useDataSources:i,onSettingChange:r}=e,{layersConfig:d,batchEditing:u}=a,[m,p]=l.React.useState(null),[g,h]=l.React.useState(!1),[y,b]=l.React.useState([]),[v,S]=l.React.useState({}),j=l.hooks.useTranslation(c,o.defaultMessages),w=j("newEdit"),R=l.React.useRef(null),I=l.React.useRef(null),D=l.React.useMemo(()=>m===se?d.length:d.findIndex(e=>e.id===m),[m,d]),M=l.React.useMemo(()=>{const e=d.find(e=>e.id===m);return(0,l.Immutable)(e)},[m,d]),O=l.React.useMemo(()=>v[m],[m,v]),L=l.React.useCallback((e,t)=>{const a=d.findIndex(t=>t.id===e);let i;i=t?R.current.getElementsByClassName("add-edit-btn")[0]:R.current.getElementsByClassName("jimu-tree-item__body")[a],I.current=i,e!==m||t?(h(!0),p(e)):(h(!1),p(null))},[m,d]),A=l.React.useCallback(()=>le(void 0,void 0,void 0,function*(){const t=l.DataSourceManager.getInstance().getDataSourcesAsArray().filter(e=>x.includes(e.type)&&!e.isDataView),a=l.ServiceManager.getInstance(),i=t.map(e=>a.fetchArcGISServerInfo(e.url));yield Promise.allSettled(i),L(se,!0);const n=l.DataSourceManager.getInstance();n.createAllDataSources().then(()=>{if(e.useDataSources.length>=1)for(let t=0;t<e.useDataSources.length;t++){const a=e.useDataSources[t],i=n.getDataSource(a.dataSourceId).getDataSourceJson(),l=a.dataSourceId+"_copy_"+Date.now();n.createDataSource({id:l,dataSourceJson:i})}})}),[L,e.useDataSources]),E=l.React.useCallback(()=>{h(!1),p(null)},[]),F=l.React.useCallback(e=>{const n=a.layersConfig.filter(t=>t.id!==e);let l=a.set("layersConfig",n);0===n.length&&(l=l.set("description",""));const o=i?i.asMutable({deep:!0}):[];r({id:t,config:l,useDataSources:o.filter(t=>t.dataSourceId!==e)}),e===m&&E()},[m,a,E,r,i,t]),P=l.React.useCallback(e=>{const i=e.map(e=>d.find(t=>t.id===e));r({id:t,config:a.set("layersConfig",i)})},[a,d,r,t]),V=l.React.useCallback(e=>{if(!(null==e?void 0:e.url)||(null==e?void 0:e.isOutputFromWidget))return!0;const t=d.map(e=>e.id),a=(l.dataSourceUtils.getFullArcGISServiceUrl(e.url,!1)||"").toLowerCase().endsWith(l.SupportedServerTypes.MapService.toLowerCase()),i=T(e.id),n=null==i?void 0:i.getLayerDefinition(),{create:o,update:s,deletable:r}=C(n),c=l.ServiceManager.getInstance().getServerInfoByServiceUrl(e.url),u=!(!c||c.owningSystemUrl||o||s||r);return t.includes(e.id)||a||u},[d]),G=l.React.useCallback(e=>{const n=D>-1?D:d.length;let o=i||(0,l.Immutable)([]);(null==M?void 0:M.id)!==e.id&&(o=o.filter(e=>e.dataSourceId!==(null==M?void 0:M.id)),o=o.concat(e.useDataSource)),r({id:t,config:a.setIn(["layersConfig",`${n}`],e),useDataSources:o.asMutable()}),p(e.id)},[D,null==M?void 0:M.id,a,d.length,r,i,t]),B=l.React.useCallback((e,t)=>le(void 0,void 0,void 0,function*(){const a=d.map(e=>e.id);if(t){const a=k(t),i=yield a.createJSAPILayerByDataSource(),n={id:e,dataSource:a,layer:i,layerDefinition:null==a?void 0:a.getLayerDefinition(),layerEditingEnabled:i.editingEnabled};S(t=>{const a={};for(const i of d)i.id===e?a[i.id]=n:t[i.id]&&(a[i.id]=t[i.id]);return a})}else b(t=>[...t,e].filter(e=>a.includes(e)))}),[d]);return(0,n.jsxs)(l.React.Fragment,{children:[d.map(e=>(0,n.jsx)(ne,{useDataSource:e.useDataSource,onDataSourceCreatedOrFailed:B},e.useDataSource.dataSourceId)),(0,n.jsxs)("div",{className:"mt-4",ref:R,children:[(0,n.jsx)(s.SettingRow,{children:(0,n.jsx)(o.Button,{className:"w-100 add-edit-btn",type:"primary",onClick:A,title:w,"aria-label":w,"aria-describedby":"edit-blank-msg",children:(0,n.jsxs)("div",{className:"w-100 px-2 text-truncate",children:[(0,n.jsx)(f,{className:"mr-1 mb-1"}),w]})})}),(0,n.jsx)(s.SettingRow,{css:oe,children:(0,n.jsx)("div",{className:"text-break edit-tips",children:j("newEditTips")})}),d.length>0&&(0,n.jsx)(N,{layersConfig:d,activeIndex:D,failedDataSourceIds:y,onRemove:F,onSort:P,onClick:L})]}),(0,n.jsx)(s.SidePopper,{position:"right",isOpen:g,toggle:E,trigger:null==R?void 0:R.current,backToFocusNode:I.current,children:(0,n.jsx)(ie,{layerConfig:M,isGeoMode:!1,layerDefinition:null==O?void 0:O.layerDefinition,layerEditingEnabled:null==O?void 0:O.layerEditingEnabled,filterDs:V,batchEditing:u,onChange:G,onClose:E})})]})},ce=e=>{const{config:a,isActiveScene:i,onPropertyChange:r,onMultiplePropertyChange:d}=e,{tooltip:u,defaultTooltipEnabled:m=!1,templateFilter:p,relatedRecords:g,liveDataEditing:h,initialReshapeMode:f,segmentLabel:y=!0,defaultSegmentLabelEnabled:b=!1,batchEditing:v=!1}=a,S=l.hooks.useTranslation(c,o.defaultMessages);return(0,n.jsxs)(s.SettingSection,{role:"group","aria-label":S("iconGroup_general"),title:S("iconGroup_general"),children:[(0,n.jsx)(s.SettingRow,{tag:"label",label:S("tooltip"),children:(0,n.jsx)(o.Switch,{checked:u,"data-key":"tooltip",onChange:e=>{var t;t=e.target.checked,d([{name:"tooltip",value:t},{name:"defaultTooltipEnabled",value:!1}])}})}),u&&(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Checkbox,{checked:m,className:"mr-1",onChange:e=>{r("defaultTooltipEnabled",e.target.checked)}}),S("defaultEnabled")]})}),i&&(0,n.jsxs)(l.React.Fragment,{children:[(0,n.jsx)(s.SettingRow,{tag:"label",label:S("segmentLabel"),children:(0,n.jsx)(o.Switch,{checked:y,onChange:e=>{var t;t=e.target.checked,d([{name:"segmentLabel",value:t},{name:"defaultSegmentLabelEnabled",value:!1}])}})}),y&&(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Checkbox,{checked:b,className:"mr-1",onChange:e=>{r("defaultSegmentLabelEnabled",e.target.checked)}}),S("defaultEnabled")]})})]}),(0,n.jsx)(s.SettingRow,{tag:"label",label:S("templateFilter"),children:(0,n.jsx)(o.Switch,{checked:p,"data-key":"templateFilter",onChange:e=>{r("templateFilter",e.target.checked)}})}),(0,n.jsx)(s.SettingRow,{tag:"label",label:S("relatedRecords"),children:(0,n.jsx)(o.Switch,{checked:g,"data-key":"relatedRecords",onChange:e=>{r("relatedRecords",e.target.checked)}})}),(0,n.jsx)(s.SettingRow,{tag:"label",label:S("runtimeDataEditing"),children:(0,n.jsx)(o.Switch,{checked:h,"data-key":"liveDataEditing",onChange:e=>{r("liveDataEditing",e.target.checked)}})}),(0,n.jsx)(s.SettingRow,{tag:"label",label:S("initialReshapeMode"),children:(0,n.jsx)(o.Switch,{checked:f,"data-key":"initialReshapeMode",onChange:e=>{r("initialReshapeMode",e.target.checked)}})}),(0,n.jsx)(s.SettingRow,{tag:"label",label:S("batchEditingSetting"),children:(0,n.jsx)(o.Switch,{checked:v,"data-key":"batchEditing",onChange:(e,i)=>{if(i&&a.mapViewsConfig&&Object.keys(a.mapViewsConfig).length>0){let e=a.mapViewsConfig;Object.entries(e).forEach(([a,i])=>{let n=i.layersConfig;if(n)for(let i=0;i<n.length;i++){let o=n[i];o.layerHonorMode===t.Custom&&(o=o.set("layerHonorMode",t.Webmap),n=l.Immutable.set(n,i,o),e=e.setIn([a,"layersConfig"],n))}}),d([{name:"batchEditing",value:i},{name:"mapViewsConfig",value:e}])}else r("batchEditing",i)}})})]})},de=e=>{const{widgetId:t,config:a,useMapWidgetIds:i,onSettingChange:l}=e;return(0,n.jsx)(s.SettingRow,{children:(0,n.jsx)(s.MapWidgetSelector,{useMapWidgetIds:i,onSelect:e=>{const i=a.set("mapViewsConfig",{}).set("defaultSnapLayers",[]);l({id:t,config:i,useMapWidgetIds:e})}})})};var ue=function(e,t,a,i){return new(a||(a=Promise))(function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}r((i=i.apply(e,t||[])).next())})};const me=e=>{var t,a,i,r,c;const{useMapWidgetIds:d,mapEmpty:u,jimuMapViews:m,mapViewsConfig:p,batchEditing:g,onChange:h}=e,[f,y]=l.React.useState(null),[b,v]=l.React.useState(null),[x,j]=l.React.useState([]),[w,R]=l.React.useState(!1),D=l.hooks.useTranslation(o.defaultMessages),M=null==d?void 0:d[0],N=l.React.useCallback(e=>ue(void 0,void 0,void 0,function*(){const t=`${M}-${e}`;y(t),R(!0);const a=m.find(e=>e.id===t),i=a.getAllJimuLayerViews();let n=Object.values(i).filter(e=>!e.fromRuntime&&function(e){var t;if(!e||!e.type)return!1;const a=e.layer.type,i=a!==l.JSAPILayerTypes.BuildingComponentSublayer||e.view,n=S.includes(a),o=!!(null===(t=e.layer)||void 0===t?void 0:t.url);return i&&n&&o}(e));const o=l.ServiceManager.getInstance(),s=n.map(e=>ue(void 0,void 0,void 0,function*(){const t=yield e.createLayerDataSource();return yield o.fetchArcGISServerInfo(e.layer.url),t?e:null}));try{n=(yield Promise.all(s)).filter(e=>!!e)}catch(e){console.log(e)}var r;a.isActive||(yield(r=500,new Promise(e=>{setTimeout(()=>{e()},r)}))),n=n.filter(e=>{var t;const a=e.getLayerDataSource(),i=null===(t=null==a?void 0:a.getLayerDefinition)||void 0===t?void 0:t.call(a),{create:n,update:l,deletable:s}=C(i),r=o.getServerInfoByServiceUrl(e.layer.url);return!!(!r||r.owningSystemUrl||n||l||s)}),j(n),R(!1)}),[m,M]),O=!!(null===(t=p[f])||void 0===t?void 0:t.customizeLayers),L=l.React.useMemo(()=>{const e={};for(const[t,a]of Object.entries(p||{}))a.customizeLayers&&(e[t]=a.customJimuLayerViewIds||[]);return e},[p]),A=l.React.useMemo(()=>{const e=[];return x.forEach(t=>{e.push(t.id);t.getAllAncestorJimuLayerViews().forEach(t=>{e.push(t.id)})}),e},[x]),E=l.React.useCallback(e=>{const t=p[f]||(0,l.Immutable)({customizeLayers:!1});if(e){const e=[],a=[];for(const t of x){const i=t.getLayerDataSource();if(!i)continue;const n=I(i,t.layer);a.push(n),e.push(t.id)}h(f,t.set("customizeLayers",!0).set("customJimuLayerViewIds",e).set("layersConfig",a))}else h(f,t.set("customizeLayers",!1).set("customJimuLayerViewIds",[]).set("layersConfig",[]))},[p,f,x,h]),F=l.React.useCallback(e=>!A.includes(e.id),[A]),P=l.React.useCallback(e=>!x.includes(e),[x]),V=l.React.useCallback(e=>{const t=p[f],a=t.layersConfig,i=e.map(e=>{var t;return null===(t=x.find(t=>t.id===e))||void 0===t?void 0:t.layerDataSourceId});let n=a.filter(e=>i.includes(e.id));const l=a.map(e=>e.id);for(const t of e)try{const e=x.find(e=>e.id===t);if(!e||l.includes(e.layerDataSourceId))continue;const a=e.getLayerDataSource();if(!a)continue;n=n.concat(I(a,e.layer))}catch(e){continue}h(f,t.set("customJimuLayerViewIds",e).set("layersConfig",n))},[p,f,h,x]),G=l.React.useCallback(e=>{for(const t of m){const a=t.getAllJimuLayerViews().find(t=>t.id===e);if(a){v(a);break}}},[m]),B=l.React.useCallback((e,t)=>{const a=m.find(t=>t.id===e),i=t.map(e=>{var t,i;return null===(i=null===(t=a.jimuLayerViews)||void 0===t?void 0:t[e.itemKey])||void 0===i?void 0:i.id}),n=t.map(e=>{var t,i;return null===(i=null===(t=a.jimuLayerViews)||void 0===t?void 0:t[e.itemKey])||void 0===i?void 0:i.layerDataSourceId}),l=p[e].layersConfig.asMutable({deep:!0});l.sort((e,t)=>n.indexOf(e.id)-n.indexOf(t.id));const o=p[e].set("layersConfig",l).set("customJimuLayerViewIds",i);h(e,o)},[h,m,p]);let J,z;const H=null==b?void 0:b.layerDataSourceId,_=T(H),U=k(_);if(b&&U)for(const[e,t]of Object.entries(p))if(t.customizeLayers&&(null===(a=t.customJimuLayerViewIds)||void 0===a?void 0:a.includes(null==b?void 0:b.id))){const a=(null===(r=null===(i=null==t?void 0:t.layersConfig)||void 0===i?void 0:i.filter(e=>e.id===H))||void 0===r?void 0:r[0])||(0,l.Immutable)(I(U,null==b?void 0:b.layer));J=e,z=a;break}const W=null==U?void 0:U.getLayerDefinition(),K=null===(c=null==U?void 0:U.layer)||void 0===c?void 0:c.editingEnabled,$=l.React.useCallback(e=>{const t=p[J].layersConfig,a=t.findIndex(e=>e.id===H),i=l.Immutable.set(t,a,e),n=p[J].set("layersConfig",i);h(J,n)},[p,J,h,H]);return(0,n.jsxs)(s.SettingRow,{children:[!u&&(0,n.jsx)(s.LayerSetting,{mapWidgetId:M,mapViewId:f,keepLastTimeMap:!0,isJlvLoading:w,onMapItemClick:N,isCustomizeEnabled:O,selectedValues:L,hideLayers:F,disableLayers:P,isShowRuntimeAddedLayerEnabled:!1,showRuntimeAddedLayerOption:!1,showTable:!1,onToggleCustomize:E,onSelectedLayerIdChange:V,showSelectedLayers:!0,dndEnabled:!0,onLayerItemClick:G,onLayerReorder:B,children:(0,n.jsx)(ie,{layerConfig:z,isGeoMode:!0,layerDefinition:W,layerEditingEnabled:K,batchEditing:g,onChange:$})}),u&&(0,n.jsx)(o.Alert,{tabIndex:0,type:"warning",fullWidth:!0,open:!0,text:D("noWebMapWebSceneTip")})]})};const pe=e=>{const{config:t,jimuMapViews:a,onPropertyChange:d}=e,{selfSnapping:u,featureSnapping:m,defaultSelfEnabled:p,defaultFeatureEnabled:g,gridSnapping:h=!1,defaultGridEnabled:f=!1,defaultSnapLayers:y,snapSettingMode:b}=t,v=l.hooks.useTranslation(c,o.defaultMessages,l.defaultMessages),S=r.SnappingUtils.getAllSnappingLayerItems(a),x=l.React.useMemo(()=>S.filter(e=>null==y?void 0:y.includes(e.value)),[S,y]),j=(0,n.jsx)(l.React.Fragment,{children:(0,n.jsxs)("div",{className:"plain-tooltip",style:{maxWidth:260},children:[(0,n.jsxs)("div",{className:"mt-1",style:{fontWeight:700},children:[" ",v("geometryGuides")," "]}),(0,n.jsxs)("div",{className:"mb-3",children:[" ",v("editGeometryGuides")]}),(0,n.jsxs)("div",{className:"mt-2",style:{fontWeight:700},children:[" ",v("featureToFeature")," "]}),(0,n.jsxs)("div",{className:"mb-3",children:[" ",v("editFeatureToFeature")]}),(0,n.jsxs)("div",{className:"mt-2",style:{fontWeight:700},children:[" ",v("grid")," "]}),(0,n.jsxs)("div",{className:"mb-3",children:[" ",v("tipsForGrid")]})]})}),C=(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,n.jsx)("span",{className:"text-wrap",children:v("snappingSettings")}),(0,n.jsx)(o.Tooltip,{showArrow:!0,role:"tooltip",title:j,children:(0,n.jsx)(o.Button,{icon:!0,disableHoverEffect:!0,disableRipple:!0,variant:"text",size:"sm",className:"flex-shrink-0",children:(0,n.jsx)(K,{})})})]});return(0,n.jsxs)(s.SettingSection,{role:"group",title:C,"aria-label":v("snappingSettings"),children:[(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Select,{size:"sm",className:"w-100",value:b,onChange:e=>{d("snapSettingMode",e.target.value)},children:[(0,n.jsx)("option",{value:i.Prescriptive,children:v("prescriptiveMode")}),(0,n.jsx)("option",{value:i.Flexible,children:v("flexibleMode")})]})}),b===i.Prescriptive?(0,n.jsxs)(l.React.Fragment,{children:[(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Checkbox,{checked:p,className:"mr-1",onChange:e=>{d("defaultSelfEnabled",e.target.checked)}}),v("geometryGuides")]})}),(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Checkbox,{checked:g,className:"mr-1",onChange:e=>{d("defaultFeatureEnabled",e.target.checked)}}),v("featureToFeature")]})})]}):(0,n.jsxs)(l.React.Fragment,{children:[(0,n.jsx)(s.SettingRow,{tag:"label",label:v("geometryGuides"),children:(0,n.jsx)(o.Switch,{checked:u,"data-key":"selfSnapping",onChange:e=>{d("selfSnapping",e.target.checked)}})}),u&&(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Checkbox,{checked:p,className:"mr-1",onChange:e=>{d("defaultSelfEnabled",e.target.checked)}}),v("defaultEnabled")]})}),(0,n.jsx)(s.SettingRow,{tag:"label",label:v("featureToFeature"),children:(0,n.jsx)(o.Switch,{checked:m,"data-key":"featureSnapping",onChange:e=>{d("featureSnapping",e.target.checked)}})}),m&&(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Checkbox,{checked:g,className:"mr-1",onChange:e=>{d("defaultFeatureEnabled",e.target.checked)}}),v("defaultEnabled")]})}),(0,n.jsx)(s.SettingRow,{tag:"label",label:v("grid"),children:(0,n.jsx)(o.Switch,{checked:h,"data-key":"gridSnapping",onChange:e=>{d("gridSnapping",e.target.checked)}})}),h&&(0,n.jsx)(s.SettingRow,{children:(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Checkbox,{checked:f,className:"mr-1",onChange:e=>{d("defaultGridEnabled",e.target.checked)}}),v("defaultEnabled")]})})]}),(0,n.jsx)(s.SettingRow,{flow:"wrap",label:v("chooseDefaultSnappingLayers"),className:"select-option",children:(0,n.jsx)(o.AdvancedSelect,{size:"sm",title:v("chooseDefaultSnappingLayers"),hideCheckAll:!1,hideBottomTools:!0,hideSearchInput:!0,staticValues:S,sortList:!1,isMultiple:!0,selectedValues:x,disabled:0===a.length,onChange:e=>{const t=(e||[]).map(e=>e.value);d("defaultSnapLayers",t)},"aria-label":v("chooseDefaultSnappingLayers")})})]})};var ge=d(31027),he=d.n(ge),fe=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const ye=e=>{const t=window.SVG,{className:a}=e,i=fe(e,["className"]),o=(0,l.classNames)("jimu-icon jimu-icon-component",a);return t?(0,n.jsx)(t,Object.assign({className:o,src:he()},i)):(0,n.jsx)("svg",Object.assign({className:o},i))},be=l.css`
  &.empty-placeholder {
    display: flex;
    flex-flow: column;
    justify-content: center;
    height: calc(100% - 260px);
    overflow: hidden;
    .empty-placeholder-inner {
      padding: 0px 20px;
      flex-direction: column;
      align-items: center;
      display: flex;

      .empty-placeholder-text {
        color: var(--ref-palette-neutral-1000);
        font-size: 14px;
        margin-top: 16px;
        text-align: center;
      }
      .empty-placeholder-icon {
        color: var(--ref-palette-neutral-800);
      }
    }
  }
`,ve=e=>{const{isGeoMode:t}=e,a=l.hooks.useTranslation(c,o.defaultMessages),i=a("newEdit"),s=a("editableSource"),r=t?a("selectMapHint"):a("editBlankStatus",{EditString:i,ModeString:s});return(0,n.jsx)("div",{className:"empty-placeholder w-100",css:be,children:(0,n.jsxs)("div",{className:"empty-placeholder-inner",children:[(0,n.jsx)("div",{className:"empty-placeholder-icon",children:(0,n.jsx)(ye,{size:48})}),(0,n.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",children:r})]})})},Se=t=>{const{id:a,config:i,useDataSources:d,useMapWidgetIds:u,onSettingChange:p}=t,{editMode:g,layersConfig:h=(0,l.Immutable)([]),mapViewsConfig:f=(0,l.Immutable)({}),batchEditing:y=!1}=i,[b,v]=l.React.useState(!1),[S,x]=l.React.useState(!0),[j,C]=l.React.useState([]),[w,R]=l.React.useState(!1),I=l.React.useRef(null),T=g===e.Attribute,k=g===e.Geometry,D=(null==u?void 0:u.length)>0,M=T&&h.length>0||k&&Object.keys(f).length>0,N=l.hooks.useTranslation(c,o.defaultMessages),O=l.React.useCallback((e,t)=>{if(t===i[e])return;const n=i.set(e,t);p({id:a,config:n})},[i,p,a]),L=l.React.useCallback(e=>{let t=i;e.forEach(e=>{e.value!==i[e.name]&&(t=t.set(e.name,e.value))}),p({id:a,config:t})},[i,p,a]),A=l.React.useCallback(()=>{p({id:a,config:i.set("editMode",I.current).set("layersConfig",[]).set("mapViewsConfig",{}),useDataSources:[],useMapWidgetIds:[]}),I.current=null,v(!1)},[i,p,a]),E=l.React.useCallback(e=>{g!==e&&(I.current=e,M?v(!0):A())},[g,A,M]),F=l.React.useCallback(e=>{C([]);const t=Object.values(e);1!==Object.keys(t).length||Object.values(t)[0].dataSourceId?x(!1):x(!0),C(t)},[x]),P=l.React.useCallback(e=>{e&&R("3d"===e.view.type)},[]),V=l.React.useCallback((e,t)=>{p({id:a,config:i.setIn(["mapViewsConfig",e],t)})},[i,p,a]);return(0,n.jsx)("div",{className:"h-100",children:(0,n.jsxs)("div",{className:"jimu-widget-setting widget-setting-edit h-100",children:[(0,n.jsxs)(s.SettingSection,{role:"group",title:N("mode"),children:[(0,n.jsxs)("div",{role:"radiogroup",className:"mb-4",children:[(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:T,onChange:()=>{E(e.Attribute)}}),N("attrMode")]}),(0,n.jsxs)(o.Label,{className:"d-flex align-items-center",children:[(0,n.jsx)(o.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:k,onChange:()=>{E(e.Geometry)}}),N("interactWithMap")]})]}),T&&(0,n.jsx)(re,{widgetId:a,config:i,useDataSources:d,onSettingChange:p}),k&&(0,n.jsx)(de,{widgetId:a,config:i,useMapWidgetIds:u,onSettingChange:p}),k&&D&&(0,n.jsx)(me,{useMapWidgetIds:u,mapEmpty:S,jimuMapViews:j,mapViewsConfig:f,batchEditing:y,onChange:V})]}),T&&M&&(0,n.jsx)(m,{config:i,onPropertyChange:O,onMultiplePropertyChange:L}),T&&!M&&(0,n.jsx)(ve,{isGeoMode:!1}),k&&D&&(0,n.jsx)(pe,{config:i,jimuMapViews:j,onPropertyChange:O}),k&&D&&(0,n.jsx)(ce,{config:i,isActiveScene:w,onPropertyChange:O,onMultiplePropertyChange:L}),k&&!D&&(0,n.jsx)(ve,{isGeoMode:!0}),k&&(0,n.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null==u?void 0:u[0],onViewsCreate:F,onActiveViewChange:P}),b&&(0,n.jsx)(o.ConfirmDialog,{level:"warning",title:N("changeModeConfirmTitle"),hasNotShowAgainOption:!1,content:N("changeModeConfirmTips"),onConfirm:A,onClose:()=>{v(!1)}})]})})};function xe(e){d.p=e}})(),u})())}}});