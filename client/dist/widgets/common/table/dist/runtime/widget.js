System.register(["jimu-core/emotion","jimu-core","jimu-theme","jimu-ui","jimu-core/react","esri/widgets/FeatureTable/support/TableTemplate","esri/core/reactiveUtils","esri/widgets/FeatureTable","jimu-arcgis","jimu-layouts/layout-runtime","esri/geometry/Polygon"],function(e,t){var o={},n={},l={},a={},i={},r={},s={},c={},d={},u={},v={};return{setters:[function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){n.AppMode=e.AppMode,n.BaseVersionManager=e.BaseVersionManager,n.CONSTANTS=e.CONSTANTS,n.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.DataSourceTypes=e.DataSourceTypes,n.Immutable=e.Immutable,n.JSAPILayerTypes=e.JSAPILayerTypes,n.MessageManager=e.MessageManager,n.MutableStoreManager=e.MutableStoreManager,n.QueryScope=e.QueryScope,n.React=e.React,n.ReactRedux=e.ReactRedux,n.ReactResizeDetector=e.ReactResizeDetector,n.ServiceManager=e.ServiceManager,n.SessionManager=e.SessionManager,n.WidgetState=e.WidgetState,n.appActions=e.appActions,n.appConfigUtils=e.appConfigUtils,n.classNames=e.classNames,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.defaultMessages=e.defaultMessages,n.esri=e.esri,n.focusElementInKeyboardMode=e.focusElementInKeyboardMode,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,n.lodash=e.lodash,n.polished=e.polished,n.privilegeUtils=e.privilegeUtils,n.useIntl=e.useIntl},function(e){l.Global=e.Global,l.useTheme=e.useTheme},function(e){a.AdvancedSelect=e.AdvancedSelect,a.Alert=e.Alert,a.Button=e.Button,a.DataActionList=e.DataActionList,a.DataActionListStyle=e.DataActionListStyle,a.Dropdown=e.Dropdown,a.DropdownButton=e.DropdownButton,a.DropdownItem=e.DropdownItem,a.DropdownMenu=e.DropdownMenu,a.Paper=e.Paper,a.Popper=e.Popper,a.Select=e.Select,a.Tab=e.Tab,a.Tabs=e.Tabs,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.WidgetPlaceholder=e.WidgetPlaceholder,a.defaultMessages=e.defaultMessages},function(e){i.Fragment=e.Fragment,i.useEffect=e.useEffect},function(e){r.default=e.default},function(e){s.watch=e.watch},function(e){c.default=e.default},function(e){d.JimuMapViewComponent=e.JimuMapViewComponent},function(e){u.LayoutItemSizeModes=e.LayoutItemSizeModes},function(e){v.default=e.default}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=l},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},7835:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},13440:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=a},20904:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15.88 2.825a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.707l1.265 1.265a1 1 0 0 0 1.466-.056zm0 8a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.708l1.265 1.264a1 1 0 0 0 1.466-.056zM9 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M8.5 13a.5.5 0 0 0 0-1h-8a.5.5 0 0 0 0 1z" clip-rule="evenodd"></path></svg>'},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},27964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M16 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M5.146 2.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 4.327a.5.5 0 0 1 .708-.707l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055M5.146 10.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 12.328a.5.5 0 1 1 .708-.708l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055" clip-rule="evenodd"></path></svg>'},31526:e=>{"use strict";e.exports=v},41496:e=>{"use strict";e.exports=u},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},49419:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M16 0H0v1h16z"></path><path fill="#000" fill-rule="evenodd" d="M5 11a3 3 0 1 0 6 0 3 3 0 0 0-6 0m3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 6q3.874 0 7.75 4.349a.97.97 0 0 1 0 1.302Q11.874 16.001 8 16T.25 11.651a.97.97 0 0 1 0-1.302Q4.126 5.999 8 6m0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.698 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7" clip-rule="evenodd"></path><path fill="#000" d="M0 3h13v1H0zM3 6H0v1h3z"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},59374:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},62243:e=>{"use strict";e.exports=s},62686:e=>{"use strict";e.exports=d},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},65959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 1v1.5h-.058L7.944 7.689v7.821c0 .27-.207.49-.464.49a.45.45 0 0 1-.325-.14l-2.1-2.18V7.681L.066 2.5H0V1zm-.929.98H.93v.041l5.055 5.25v5.998l1.031 1.071V7.278l5.056-5.25z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M10.359 14.118 9 14.878v-1.146l.75-.42v-3.52l-.75.42V9.066l1.402-.785 2.049 1.331L15.25 8v5.825l-2.906 1.626zM10.75 9.7v3.476l1.25.84v-3.504zm2.25.75 1.25-.72v3.508l-1.25.7z" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=o},68972:e=>{"use strict";e.exports=i},71758:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=n},92799:e=>{"use strict";e.exports=c},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'}},t={};function p(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,p),l.exports}p.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return p.d(t,{a:t}),t},p.d=(e,t)=>{for(var o in t)p.o(t,o)&&!p.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p.p="";var h={};return p.p=window.jimuConfig.baseUrl,(()=>{"use strict";p.r(h),p.d(h,{__set_webpack_public_path__:()=>pt,default:()=>vt});var e,t,o,n,l,a,i,r,s,c=p(67386),d=p(79244);!function(e){e.Layer="LAYER",e.Map="MAP"}(e||(e={})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(t||(t={})),function(e){e.Beginning="beginning",e.End="end"}(o||(o={})),function(e){e.Start="start",e.Center="center",e.End="end"}(n||(n={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(l||(l={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(a||(a={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(i||(i={})),function(e){e.Scroll="SCROLL",e.Multiple="MULTIPLE"}(r||(r={})),function(e){e.View="VIEW",e.Add="ADD"}(s||(s={}));class u extends d.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.6.0",description:"Add editable to table fields.",upgrader:(e,t)=>{let o=e;return 0===o.layersConfig.length||o.layersConfig.forEach((e,t)=>{const n=e.tableFields.map(e=>Object.assign(Object.assign({},e),{editAuthority:!0}));o=o.setIn(["layersConfig",t,"tableFields"],n)}),o}},{version:"1.10.0",description:"Add visible to table fields.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach((e,o)=>{const n=e.tableFields.map(e=>Object.assign(Object.assign({},e),{visible:!0}));t=t.setIn(["layersConfig",o,"tableFields"],n)}),t}},{version:"1.12.0",description:"Add header setting options.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach((e,o)=>{e=e.set("headerFontSetting",{backgroundColor:"",fontSize:14,bold:!1,color:""}),t=t.setIn(["layersConfig",o],e)}),t}},{version:"1.13.0",description:'Add "showCount" and "updateText" options.',upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach((e,o)=>{if(e=e.set("showCount",!1).set("updateText",!0),t=t.setIn(["layersConfig",o],e),(null==e?void 0:e.searchFields)&&"string"==typeof(null==e?void 0:e.searchFields)){const n=e.searchFields.split(",")||[];t=t.setIn(["layersConfig",o,"searchFields"],n)}else(null==e?void 0:e.searchFields)||(t=t.setIn(["layersConfig",o,"searchFields"],[]))}),t}},{version:"1.14.0",description:"Update honor webmap options",upgrader:e=>{let t=e;const o=t.layersConfig.map(e=>Object.assign(Object.assign({},e),{layerHonorMode:a.Custom}));return t=t.setIn(["layersConfig"],o),t}},{version:"1.15.0",description:"Update column setting",upgrader:e=>{let t=e;const o=t.layersConfig.map(e=>Object.assign(Object.assign({},e),{columnSetting:{responsiveType:i.Fixed,columnWidth:200}}));return t=t.setIn(["layersConfig"],o),t}},{version:"1.16.0",description:"Modify a property spelling error",upgrader:t=>{let o=t;const n=o.layersConfig.map(e=>{const t=e.enableAttachements,o=Object.assign(Object.assign({},e),{enableAttachments:t});return delete o.enableAttachements,o});return o=o.setIn(["layersConfig"],n).setIn(["tableMode"],e.Layer),o}},{version:"1.19.0",description:"Support new override general settings",upgrader:e=>{let t=e;const o=t.layersConfig.map(e=>Object.assign(Object.assign({},e),{overrideGeneralSettings:!0,enableAttachments:null==t?void 0:t.enableAttachments,enableMapExtentFilter:null==t?void 0:t.enableMapExtentFilter,defaultExtentFilterEnabled:null==t?void 0:t.defaultExtentFilterEnabled})),n=t.mapViewsConfig,l=Object.keys(n||{});l.length>0&&l.forEach(e=>{var o;const l=n[e];if((null===(o=null==l?void 0:l.layersConfig)||void 0===o?void 0:o.length)>0){const o=l.layersConfig.map(e=>Object.assign(Object.assign({},e),{overrideGeneralSettings:!0,enableRelatedRecords:null==t?void 0:t.enableRelatedRecords,enableAttachments:null==t?void 0:t.enableAttachments,enableMapExtentFilter:null==t?void 0:t.enableMapExtentFilter,defaultExtentFilterEnabled:null==t?void 0:t.defaultExtentFilterEnabled}));t=t.setIn(["mapViewsConfig",e,"layersConfig"],o)}});const a={enableRelatedRecords:!1,enableAttachments:!1,columnSetting:{responsiveType:"FIXED",columnWidth:200,wrapText:!1,textAlign:"start"},headerFontSetting:{backgroundColor:"",fontSize:14,bold:!1,color:""},enableSelect:!0,selectMode:"SINGLE",enableRefresh:!0,enableDelete:!1,enableShowHideColumn:!0,showCount:!0};return["enableRelatedRecords","enableAttachments"].forEach(e=>{e in t&&delete a[e]}),t=t.merge(a).set("layersConfig",o).set("pagingStyle",r.Scroll).set("pageSize",50),t}}]}}const v=new u;var g=p(1888),m=p(62838),f=p.n(m),b=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const y=e=>{const t=window.SVG,{className:o}=e,n=b(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:f()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var S=p(14321);const x={_widgetLabel:"Table",_widgetDescription:"This is an interactive table widget",showAllRecords:"Show all records",showHideCols:"Show/hide columns",toggleSelect:"Show selection/all",_action_viewInTable_label:"View in table",tableDataActionLabel:"{layer} table selection",tableCount:"Total: {total} | Selection: {selected}",_action_addToTable_label:"Add to table",deleteRecords:"Delete selection",enableMapExtentFilter:"Filter by map extent",openSearch:"Open search",closeSearch:"Close search",noSelectionTips:"No features are selected in {layer}.",selectSheet:"Select a sheet to display"},w=e=>{const{allLayersConfig:t,isHorizontalTab:o,activeTabId:n,searchOn:l,toolListNode:a,onTabClick:i,onCloseTab:r}=e,s=d.hooks.useTranslation(x);return(0,c.jsxs)("div",{className:"d-flex table-tab-select "+(o?"horizontal-tab-select":"dropdown-tab-select"),css:d.css`
  &.table-tab-select{
    .horizontal-tab-select{
      margin-bottom: 4px;
      .activeBtn{
        color: #fff;
        background-color: #076fe5;
      }
    }
    .dropdown-tab-select{
      height: 40px;
      margin-bottom: 4px;
      .dropdown-button{
        height: 32px;
      }
    }
    .tab-flex{
      width: 100%;
      overflow-x: auto;
      .closeable{
        height: 31px;
      }
    }
  }
`,children:[o?(0,c.jsx)(S.Tabs,{scrollable:!0,type:"underline",className:"tab-flex",value:n,onChange:i,onClose:r,children:t.map(e=>{const t=!!e.dataActionObject;return(0,c.jsx)(S.Tab,{id:e.id,title:e.name,className:"text-truncate",closeable:t,children:(0,c.jsx)("div",{className:"mt-2"})},e.id)})}):(0,c.jsx)(S.Select,{size:"sm",value:n,onChange:e=>{var t;i(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)},className:"top-drop","aria-label":s("selectSheet"),children:t.map(e=>(0,c.jsx)("option",{value:e.id,title:e.name,children:(0,c.jsxs)("div",{className:"table-action-option",children:[(0,c.jsx)("div",{className:"table-action-option-tab",title:e.name,children:e.name}),e.dataActionObject&&(0,c.jsx)("div",{className:"table-action-option-close",children:(0,c.jsx)(S.Button,{size:"sm",icon:!0,type:"tertiary",onClick:t=>{r(e.id,t)},children:(0,c.jsx)(y,{size:"s"})})})]})},e.id))}),!l&&a]})};var j=p(50170),R=p.n(j),T=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const O=e=>{const t=window.SVG,{className:o}=e,n=T(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:R()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var I=p(96300),C=p.n(I),M=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const D=e=>{const t=window.SVG,{className:o}=e,n=M(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:C()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))},E=e=>d.css`
  &.table-search-div{
    .table-search{
      .search-icon{
        z-index: 2;
      }
      .search-input{
        .input-wrapper{
          height: 30px;
        }
        input::placeholder {
          color: ${e.sys.color.action.inputField.text};
        }
      }
    }
  }
`,A=e=>{const{searchToolTowed:t,hint:o,tableLoaded:n,searchText:l,handleSearchChange:a,closeSuggestionAndSearch:i,closeSuggestion:r}=e,[s,u]=d.React.useState(!1),v=d.React.useRef(null),p=d.hooks.useTranslation(x,d.defaultMessages),h=(0,g.useTheme)(),m=o||p("search"),f=e=>{e&&e.target&&"Enter"===e.key&&i()},b=()=>(0,c.jsx)(O,{color:h.sys.color.action.inputField.text});return(0,c.jsx)("div",{className:"table-search-div",css:E(h),children:t?(0,c.jsxs)("div",{className:"table-search-popper",children:[(0,c.jsx)(S.Button,{type:"tertiary",icon:!0,size:"sm",className:"tools-menu",title:p("openSearch"),"aria-label":p("openSearch"),onClick:e=>{u(!s)},ref:v,children:(0,c.jsx)(O,{color:"var(--sys-color-surface-paper-text)"})}),(0,c.jsx)(S.Popper,{placement:"right-start",reference:v.current,offsetOptions:[-10,-30],open:s,arrowOptions:!1,hideOptions:!1,children:(0,c.jsxs)("div",{className:"d-flex align-items-center table-popup-search m-2",children:[(0,c.jsx)(S.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{r(),u(!1),(0,d.focusElementInKeyboardMode)(v.current,!0)},className:"search-back mr-1",title:p("closeSearch"),"aria-label":p("closeSearch"),children:(0,c.jsx)(D,{color:"var(--sys-color-surface-overlay-text)"})}),(0,c.jsx)(S.TextInput,{className:"popup-search-input",placeholder:m,onChange:e=>{a(e.target.value)},value:l||"",onKeyDown:e=>{f(e)},prefix:b(),allowClear:!0,title:m,disabled:!n,"aria-label":m})]})})]}):(0,c.jsx)("div",{className:"d-flex align-items-center table-search",children:(0,c.jsx)(S.TextInput,{className:"search-input",placeholder:m,onChange:e=>{a(e.target.value)},value:l||"",onKeyDown:e=>{f(e)},prefix:b(),allowClear:!0,title:m,disabled:!n,"aria-label":m})})})};function N(e,t,o,n,l){const{id:a,isHeightAuto:i,isWidthAuto:r,headerFontSetting:s,widgetWidth:c,isMultiPage:u}=l;return d.css`
    ${"&.table-widget-"+a} {
      ${n&&" display: none;"};
      .table-indent{
        width: calc(100% - 32px);
        height: ${u?"calc(100% - 18px);":"calc(100% - 26px);"}
        margin: 10px 16px ${u?"8px;":"16px;"}
        display: inline-block;
        ${i&&"min-height: 190px;"};
        ${r&&"min-width: 360px;"};
        .horizontal-action-dropdown{
          button{
            width: 32px;
            height: 32px;
          }
        }
        .tool-dividing-line{
          height: 16px;
          width: 1px;
          display: inline-flex;
          background-color: ${e.sys.color.divider.secondary};
          margin: 8px 4px;
        }
        .data-action-btn{
          position: relative;
        }
      }
      .tab-title{
        user-select: none;
        margin: auto;
      }
      .tab-flex{
        width: 100%;
        overflow-x: auto;
        .closeable{
          height: 31px;
        }
      }
      .top-drop{
        width: 30%;
        min-width: 150px;
        button{
          line-height: 1.5;
        }
      }
      .nav-underline{
        height: 32px;
        border-bottom: 1px solid ${e.sys.color.divider.secondary};
        .nav-item{
          height: 31px;
          max-width: calc(${c/2}px - ${t?"40px":"120px"});
        }
      }
      .nav-item + .nav-item{
        margin-left: 0;
      }
      .csv-dropdown-con{
        button{
          border-radius: 13px;
        }
      }
      .vertical-tab-select{
        width: 20%;
        display: inline-block;
        .tagBtn{
          width: 100%;
        }
      }
      .horizontal-tab-select{
        .tagBtn{
          width: 150px;
        }
        .tab-content{
          height: 8px;
        }
      }
      .vertical-tab-select,
      .horizontal-tab-select{
        margin-bottom: 4px;
        .activeBtn{
          color: #fff;
          background-color: #076fe5;
        }
      }
      .dropdown-tab-select{
        height: 40px;
        margin-bottom: 4px;
        .dropdown-button{
          height: 32px;
        }
      }
      .vertical-render-con{
        width: 80%;
        position: absolute;
        left: 20%;
        height: 100%;
        top: 0;
      }
      .dropdown-render-con,
      .horizontal-render-con{
        width: 100%;
        height: calc(100% - 45px);
      }
      .mobile-map-button{
        display: inline-flex;
        button{
          width: 32px;
          height: 32px;
        }
      }
      .table-header{
        height: ${o?"40px":"0"};
        width: 100%;
        display: flex;
        justify-content: space-between;
      }
      .table-con{
        width: 100%;
        height: ${o?"calc(100% - 40px);":"100%"};
        // Attachment
        .esri-feature-table__attachments-view__list {
          --calcite-color-text-2: ${e.sys.color.divider.secondary};
          calcite-list-item {
            --calcite-list-background-color: ${e.sys.color.surface.paper};
            --calcite-list-background-color-hover: color-mix(in srgb, ${e.sys.color.surface.paper} 80%, transparent);
            --calcite-color-text-1: ${e.sys.color.surface.paperText};
            calcite-action {
              --calcite-action-text-color: ${e.sys.color.surface.paperText};
              --calcite-action-text-color-press: color-mix(in srgb, ${e.sys.color.surface.paperText} 80%, transparent);
            }
          }
        }
        // Attachment navigation
        .esri-feature-table__table-navigation {
          --calcite-color-foreground-1: ${e.sys.color.surface.paper};
          --calcite-action-background-color: ${e.sys.color.surface.paper};
          --calcite-action-text-color: ${e.sys.color.surface.paperText};
          --calcite-action-text-color-press: color-mix(in srgb, ${e.sys.color.surface.paperText} 80%, transparent);
          // related records switch
          --calcite-switch-handle-background-color: ${e.sys.color.action.inputField.text};
          --calcite-switch-background-color-hover: ${e.sys.color.action.hover};
          --calcite-switch-background-color: ${e.sys.color.action.inputField.default};
          calcite-switch[checked] {
            --calcite-switch-handle-background-color: ${e.sys.color.action.selected.text};
            --calcite-switch-background-color: ${e.sys.color.action.selected.default};
          }
        }
        // Attachment empty
        .esri-feature-table__attachments-view {
          calcite-button {
            --calcite-button-border-color: transparent;
            --calcite-button-background-color: ${e.sys.color.action.default};
            --calcite-internal-button-background-color: ${e.sys.color.action.hover};
            --calcite-button-text-color: ${e.sys.color.action.text};
            --calcite-color-transparent: ${e.sys.color.action.default};
            --calcite-color-transparent-hover: ${e.sys.color.action.hover};
            button:hover {
              --calcite-button-background-color: ${e.sys.color.action.hover};
            }
          }
        }
        // Attachment selected count
        .esri-feature-table__table-navigation {
          calcite-chip {
            --calcite-internal-chip-background-color: ${e.sys.color.action.selected.default};
            --calcite-chip-text-color: ${e.sys.color.action.selected.text};
            --calcite-chip-close-icon-color: ${e.sys.color.action.selected.text};
            --calcite-color-inverse-hover: ${e.sys.color.action.hover};
            // --calcite-chip-close-icon-color: ${e.sys.color.action.text};
          }
        }
        .esri-widget {
          background-color: transparent;
          vaadin-grid-cell-content:has(.esri-column__header-content) {
            ${(null==s?void 0:s.backgroundColor)&&`background-color: ${s.backgroundColor};`}
            ${(null==s?void 0:s.fontSize)&&`font-size: ${s.fontSize}px;`}
            ${(null==s?void 0:s.bold)&&"font-weight: bold;"}
            ${(null==s?void 0:s.color)&&`color: ${s.color};`}
            ${function(e,t){const o=[];e&&(e.backgroundColor&&(o.push(`--calcite-color-foreground-1: ${e.backgroundColor};`),o.push("--calcite-color-foreground-2: #0000000a;"),o.push("--calcite-color-foreground-3: #0000000a;")),e.color&&(o.push(`--calcite-color-text-3: ${e.color};`),o.push(`--calcite-color-text-1: ${e.color};`)),e.fontSize&&o.push(`--calcite-font-size--2: ${e.fontSize};`),e.bold&&o.push("--calcite-ui-text-3: bold;"));return o.push(`--calcite-action-text-color: ${t.sys.color.surface.paperText};`),o.push(`--calcite-internal-action-text-color: ${t.sys.color.surface.paperText};`),o.join(" ")}(s,e)}
            .esri-column__header-content {
              ${(null==s?void 0:s.bold)&&"font-weight: bold;"}
            }
          }
          vaadin-grid {
            --_lumo-grid-border-color: ${e.sys.color.divider.secondary};
          }
          vaadin-grid::part(header-cell direction) {
            --calcite-color-foreground-1: color-mix(in srgb, ${e.sys.color.surface.paper} 80%, white);
          }
          vaadin-grid-cell-content {
            --calcite-button-text-color: ${e.sys.color.surface.paperText};
            &:focus, &:focus-visible {
              outline-color: var(--sys-color-success-main);
            }
            :hover {
              > a {
                color: ${e.sys.color.action.selected.text};
              }
            }
            > a {
              color: ${e.sys.color.surface.paperText};
            }
          }
          vaadin-grid-cell-content {
            ${function(e){const t=[];return t.push(`--calcite-color-text-1: ${e.sys.color.surface.paperText};`),t.push(`--lumo-tertiary-text-color: ${e.sys.color.action.text};`),t.push(`--lumo-primary-color-50pct: ${e.sys.color.action.text};`),t.join(" ")}(e)}
          }
          vaadin-grid::part(body-cell) {
            --lumo-base-color: color-mix(in srgb, ${e.sys.color.surface.paper} 80%, white);
            --_lumo-grid-selected-row-color: ${e.sys.color.action.selected.default};
          }
          vaadin-grid::part(body-cell):hover {
            --calcite-color-foreground-2: color-mix(in srgb, ${e.sys.color.action.selected.default} 80%, white);
            color: ${e.sys.color.action.selected.text};
          }
          vaadin-grid::part(selected-row-cell) {
            color: ${e.sys.color.action.selected.text};
            > a {
              color: ${e.sys.color.surface.paperText};
            }
          }
          vaadin-grid::part(row) {
            --sys-color-surface-paper: white;
            background-color: white;
          }
          .esri-grid__no-data-message {
            color: ${e.sys.color.surface.paperText};
          }
          calcite-pagination {
            ${function(e){const t=[];return t.push(`--calcite-color-brand: ${e.sys.color.action.selected.default};`),t.push(`--calcite-color-text-3: ${e.sys.color.surface.paperHint};`),t.push(`--calcite-color-text-1: ${e.sys.color.surface.paperText};`),t.join(" ")}(e)}
          }
        }
        .esri-grid .esri-column__sorter{
          overflow-x: auto;
          overflow-y: hidden;
        }
        .esri-field-column__header-content{
          width: calc(100% - 26px);
          overflow: unset;
        }
        .esri-feature-table__loader-container{
          position: absolute;
          left: 50%;
          top: 50%;
          margin-left: -16px;
          margin-top: -20px;
          z-index: 2;
        }
        .esri-feature-table__content{
          min-height: 145px;
        }
        .esri-feature-table vaadin-grid::part(body-cell) {
          font-size: var(--calcite-font-size--1);
        }
      }
      .table-bottom-info {
        position: absolute;
        width: 100%;
        left: 0;
        bottom: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .adv-select-con{
        width: 200px;
        visibility: hidden;
        position: absolute;
        right: 17px;
        top: 56px;
      }
      .ds-container{
        position: absolute;
        display: none;
      }
      .dropdown-button-content{
        .table-action-option-close{
          display: none;
        }
      }
    }
  `}var L=p(68972);(0,d.Immutable)([d.DataSourceTypes.FeatureLayer,d.DataSourceTypes.SceneLayer,d.DataSourceTypes.BuildingComponentSubLayer,d.DataSourceTypes.OrientedImageryLayer,d.DataSourceTypes.ImageryLayer,d.DataSourceTypes.SubtypeSublayer]),(0,d.Immutable)([d.DataSourceTypes.WebMap,d.DataSourceTypes.WebScene,d.DataSourceTypes.MapService,d.DataSourceTypes.FeatureService,d.DataSourceTypes.SceneService,d.DataSourceTypes.GroupLayer,d.DataSourceTypes.BuildingGroupSubLayer,d.DataSourceTypes.BuildingSceneLayer,d.DataSourceTypes.SubtypeGroupLayer]);const F=[d.JSAPILayerTypes.FeatureLayer,d.JSAPILayerTypes.SceneLayer,d.JSAPILayerTypes.BuildingComponentSublayer,d.JSAPILayerTypes.OrientedImageryLayer,d.JSAPILayerTypes.ImageryLayer,d.JSAPILayerTypes.SubtypeSublayer];function P(e){if(!e||!e.type)return!1;const t=e.type,o=t!==d.JSAPILayerTypes.BuildingComponentSublayer||t===d.JSAPILayerTypes.BuildingComponentSublayer&&e.view,n=F.includes(t);return o&&n}const z=e=>d.DataSourceManager.getInstance().getDataSource(e);function V(e,t,o){const n=o||"jimuName",l=e.length>t.length,a=l?t:e;return(l?e:t).filter(e=>!a.some(t=>(null==t?void 0:t[n])===(null==e?void 0:e[n])))}const k=(e,t)=>{let o=[];const n=Object.keys(e||{});return(null==t?void 0:t.length)>=(null==n?void 0:n.length)?o=t.filter(e=>n.includes(e.name||e.alias)).map(t=>{var o;return Object.assign(Object.assign({},t),{format:null===(o=null==e?void 0:e[t.name])||void 0===o?void 0:o.format})}):n.forEach(n=>{const l=e[n],a=t.find(e=>e.name===n);o.push(Object.assign(Object.assign({},l),a))}),o};var $=p(71758),B=function(e,t,o,n){return new(o||(o=Promise))(function(l,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function r(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,r)}s((n=n.apply(e,t||[])).next())})};const H=d.DataSourceManager.getInstance();function _(e){return d.dataSourceUtils.getTimezoneAPIFromRuntime(e.getTimezone())}const G=(e,t)=>{const o=((null==e?void 0:e.fields)||[]).find(e=>e.name===t);return!o||(null==o?void 0:o.editable)},W={shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"},U=e=>W[e]||e,J=(e,t,l,r,s)=>{var c,d,u,v;const p=null==e?void 0:e.getSchema(),h=(null==p?void 0:p.fields)?Object.values(null==p?void 0:p.fields):[],g=null==e?void 0:e.getLayerDefinition(),{columnSetting:m}=l||{},{layerHonorMode:f,isFreezeFields:b,frozenFields:y,freezeLocation:S}=t,x=(null==m?void 0:m.responsiveType)===i.Fit?{autoWidth:!0,textAlign:null!==(c=null==m?void 0:m.textAlign)&&void 0!==c?c:n.Start,textWrap:null!==(d=null==m?void 0:m.wrapText)&&void 0!==d&&d}:{autoWidth:!1,width:(null==m?void 0:m.columnWidth)||200,textWrap:null!==(u=null==m?void 0:m.wrapText)&&void 0!==u&&u,textAlign:null!==(v=null==m?void 0:m.textAlign)&&void 0!==v?v:n.Start},w=V(h,r?r.map(e=>({jimuName:e.value})):t.tableFields.filter(e=>e.visible)).map(e=>e.jimuName),j=null==e?void 0:e.getCurrentQueryParams(),R=(null==j?void 0:j.orderByFields)||[],T={};let O;R.forEach((e,t)=>{var o;const n=e.split(" ");T[n[0]]={direction:null===(o=n[1])||void 0===o?void 0:o.toLowerCase(),initialSortPriority:t}});const I=f===a.Webmap,C=[];let M;if(I){const{hasPopup:t,honorUsedFields:n}=(e=>{var t,o,n;const l=null==e?void 0:e.getSchema(),a=(null==l?void 0:l.fields)?Object.values(null==l?void 0:l.fields):[],i=null==e?void 0:e.getLayerDefinition(),r=(null===(t=null==i?void 0:i.fields)||void 0===t?void 0:t.length)>0?i.fields:a,s=null===(o=null==e?void 0:e.getPopupInfo)||void 0===o?void 0:o.call(e),c=(null==s?void 0:s.fieldInfos)||[],d=Object.keys((null==l?void 0:l.fields)||{}),u=c.filter(e=>d.includes(e.fieldName)),v=k(null==l?void 0:l.fields,r),p=(null===(n=null==s?void 0:s.fieldInfos)||void 0===n?void 0:n.length)>0,h=[];return d.forEach(e=>{p?!u.find(t=>t.fieldName===e)&&h.push(e):!v.find(t=>(t.name||t.alias)===e)&&h.push(e)}),{hasPopup:p,honorUsedFields:p?u:v,honorHiddenFields:h}})(e);if(t){if(n.forEach(e=>{var t,n;const l=e.fieldName,a=b&&(null==y?void 0:y.includes(l)),i=!S||S===o.Beginning,r=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),x),{type:"field",editable:null!==(t=e.isEditable)&&void 0!==t&&t,format:e.format?Object.assign(Object.assign({},e.format),(null===(n=e.format)||void 0===n?void 0:n.dateFormat)?{dateFormat:U(e.format.dateFormat)}:{}):null}),T[l]?T[l]:{}),a?i?{frozen:!0}:{frozenToEnd:!0}:{});a?M=r:C.push(r)}),M){!S||S===o.Beginning?C.unshift(M):C.push(M)}}else if(n.forEach(e=>{var t;const n=e.jimuName||e.name,l=b&&(null==y?void 0:y.includes(n)),a=!S||S===o.Beginning,i=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),x),{type:"field",fieldName:n,label:e.alias||e.name,editable:G(g,n),visible:!0,format:e.format?Object.assign(Object.assign({},e.format),(null===(t=e.format)||void 0===t?void 0:t.dateFormat)?{dateFormat:U(e.format.dateFormat)}:{}):null}),T[n]?T[n]:{}),l?a?{frozen:!0}:{frozenToEnd:!0}:{});l?M=i:C.push(i)}),M){!S||S===o.Beginning?C.unshift(M):C.push(M)}O=new $.default({columnTemplates:C})}else if(!I){if(t.tableFields.forEach(e=>{var t,n;const l=e.jimuName||e.name,a=null===(t=null==p?void 0:p.fields)||void 0===t?void 0:t[l],i=b&&(null==y?void 0:y.includes(l)),r=!S||S===o.Beginning,c=Object.assign(Object.assign(Object.assign(Object.assign({format:(null==a?void 0:a.format)?Object.assign(Object.assign({},e.format),(null===(n=e.format)||void 0===n?void 0:n.dateFormat)?{dateFormat:U(e.format.dateFormat)}:{}):null,type:"field"},x),{fieldName:l,label:null==a?void 0:a.alias,editable:G(g,l)&&(null==e?void 0:e.editAuthority),visible:s?e.visible:w.indexOf(l)<0}),T[l]?T[l]:{}),i?r?{frozen:!0}:{frozenToEnd:!0}:{});i?M=c:C.push(c)}),M){!S||S===o.Beginning?C.unshift(M):C.push(M)}O=new $.default({columnTemplates:C})}return O},Q=(e,t,o,r)=>{var s,c,u;const v=e.getSchema(),p=null==e?void 0:e.getLayerDefinition(),h=(null==v?void 0:v.fields)?Object.values(null==v?void 0:v.fields):[],g=(null==p?void 0:p.fields)||[];let m=h.map(e=>{const t=g.find(t=>t.name===e.jimuName),o=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:o,editable:o,visible:!0})});const f=null===(s=null==e?void 0:e.getPopupInfo())||void 0===s?void 0:s.fieldInfos;if("output"!==e.dataViewId&&f&&(null==f?void 0:f.length)>0){const e=[];f.forEach(t=>{(null==t?void 0:t.visible)&&e.push(t.fieldName)}),m=m.filter(t=>e.includes(t.name))}(null==m?void 0:m.length)>50&&(m=m.slice(0,50));const b={dataSourceId:e.id,mainDataSourceId:null===(c=e.getMainDataSource())||void 0===c?void 0:c.id,dataViewId:e.dataViewId,rootDataSourceId:null===(u=e.getRootDataSource())||void 0===u?void 0:u.id},y=(0,d.Immutable)(b),S=m.map(e=>e.jimuName),x=y.set("fields",S);return{id:t?e.id:o?o(e.id):e.id,name:e.getLabel(),useDataSource:x.asMutable({deep:!0}),allFields:h,tableFields:m,enableAttachments:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:[],enableRefresh:!0,enableShowHideColumn:!0,enableSelect:!0,enableDelete:!1,selectMode:l.Single,showCount:!0,headerFontSetting:{backgroundColor:"",fontSize:14,bold:!1,color:""},columnSetting:{responsiveType:i.Fixed,columnWidth:200,wrapText:!1,textAlign:n.Start},layerHonorMode:a.Webmap,parentViewId:r}},q=e=>{const{searchToolTowed:t,curLayerConfig:o,dataSource:n,tableLoaded:l,widgetState:a,toolListNode:i,handleSubmit:r}=e,[s,u]=d.React.useState(),[v,p]=d.React.useState(!1),[h,g]=d.React.useState([]),m=d.React.useRef(null),f=d.React.useRef(null),b=d.ReactRedux.useSelector(e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode}),y=d.ReactRedux.useSelector(e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.currentPageId}),x=new(0,d.esri.Sanitizer),w=d.React.useCallback(()=>{if((null==s?void 0:s.length)<3)return!1;(function(e,t,o){return B(this,void 0,void 0,function*(){const n={searchText:e,searchFields:(null==t?void 0:t.searchFields)||[],dataSource:o,exact:null==t?void 0:t.searchExact};return d.dataSourceUtils.querySuggestions(n)})})(s,o,n).then(e=>{g(e)})},[s,o,n]);(0,L.useEffect)(()=>(s?(clearTimeout(f.current),f.current=setTimeout(()=>{w()},200)):r(""),()=>{clearTimeout(f.current)}),[s,v,r,w]),(0,L.useEffect)(()=>{const e=a===d.WidgetState.Closed,t=b===d.AppMode.Design;(e||t)&&(u(""),p(!1))},[a,b]),(0,L.useEffect)(()=>{p(!1)},[y]);return(0,c.jsxs)("div",{className:"table-header",ref:m,css:d.css`
  &.table-header{
    height: 40px;
    width: 100%;
    display: flex;
    justify-content: space-between;
  }
`,children:[(0,c.jsx)(A,{searchToolTowed:t,hint:null==o?void 0:o.searchHint,tableLoaded:l,searchText:s,handleSearchChange:e=>{e?(u(e),p((null==e?void 0:e.length)>2)):(u(e),p(!1),g([]))},closeSuggestionAndSearch:()=>{p(!1),r(s)},closeSuggestion:()=>{p(!1)}}),(0,c.jsx)(S.Popper,{css:d.css`
    & {
      max-height: ${d.polished.rem(300)};
      min-width: ${d.polished.rem(200)};
      overflow: auto;
    }
    button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
      color: var(--sys-color-surface-overlay-text);
    }
    button:hover {
      border: none;
    }
  `,placement:"bottom-start",reference:m,offsetOptions:[t?35:0,-2],open:v&&(null==h?void 0:h.length)>0,trapFocus:!1,autoFocus:!1,toggle:()=>{p(!v)},hideOptions:!1,children:h.map((e,t)=>{const o=x.sanitize(e.suggestionHtml);return(0,c.jsx)(S.Button,{type:"secondary",size:"sm",onClick:()=>{(e=>{u(e),p(!1),r(e)})(e.suggestion)},children:(0,c.jsx)("div",{className:"w-100",dangerouslySetInnerHTML:{__html:o}})},t)})}),i]})},Y=e=>d.css`
    &.placeholder-table-con{
      height: ${e?"calc(100% - 40px)":"100%"};
      width: 100%;
      position: relative;
      .jimu-widget-placeholder{
        width: 100%;
      }
      .placeholder-alert-con{
        position: absolute;
        right: 10px;
        bottom: 10px;
      }
    }
  `,K=e=>{const{searchOn:t,notReady:o,dataSourceLabel:n,widgetLabel:l,isSelectionView:a}=e,i=d.hooks.useTranslation(x,S.defaultMessages),r=a?i("noSelectionTips",{layer:n}):i("outputDataIsNotGenerated",{outputDsLabel:n,sourceWidgetName:l});return(0,c.jsxs)("div",{className:"placeholder-table-con",css:Y(t),children:[(0,c.jsx)(S.WidgetPlaceholder,{icon:p(59374),name:i("noData")}),o&&(0,c.jsx)("div",{className:"placeholder-alert-con",children:(0,c.jsx)(S.Alert,{form:"tooltip",size:"small",type:"warning",text:r})})]})};var X=p(62243);const Z=e=>d.css`
  &.table-count{
    height: 16px;
    .total-count-text{
      background: ${e.sys.color.surface.overlay};
      color: ${e.sys.color.surface.overlayText};
      font-size: ${d.polished.rem(12)};
      line-height: 16px;
      padding: 0 7px;
    }
  }
`,ee=e=>{var t;const{table:o,showCount:n,onSelectedChange:l}=e,[a,i]=d.React.useState((null==o?void 0:o.size)||0),[r,s]=d.React.useState((null===(t=null==o?void 0:o.highlightIds)||void 0===t?void 0:t.length)||0),u=(0,d.useIntl)(),v=d.React.useMemo(()=>u.formatNumber(a,{useGrouping:!0}),[u,a]),p=d.React.useMemo(()=>u.formatNumber(r,{useGrouping:!0}),[u,r]);d.React.useEffect(()=>{let e,t;return o?(e=X.watch(()=>null==o?void 0:o.size,e=>{i(e||0)},{initial:!0,sync:!0}),t=X.watch(()=>{var e;return null===(e=null==o?void 0:o.highlightIds)||void 0===e?void 0:e.length},e=>{s(e||0),l(e||0)},{initial:!0,sync:!0})):(i(0),s(0)),()=>{null==e||e.remove(),null==t||t.remove()}},[l,o]);const h=(0,g.useTheme)(),m=d.hooks.useTranslation(x);return(0,c.jsx)(d.React.Fragment,{children:n&&(0,c.jsx)("div",{className:"table-count d-flex align-items-center",css:Z(h),children:(0,c.jsx)("div",{className:"flex-grow-1 total-count-text text-truncate",children:m("tableCount",{total:v,selected:p})})})})};var te=p(45508),oe=p.n(te),ne=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const le=e=>{const t=window.SVG,{className:o}=e,n=ne(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:oe()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))},ae=6e4,ie=(e,t)=>d.css`
  &.refresh-loading-con {
    height: 16px;
    .auto-refresh-loading {
      background: ${e.sys.color.surface.overlay};
      color: ${e.sys.color.surface.overlayText};
      font-size: ${d.polished.rem(12)};
      line-height: ${d.polished.rem(16)};
      ${!t&&`padding: 0 ${d.polished.rem(7)};`}
      .icon-btn {
        color: ${e.sys.color.surface.paperText};
      }
    }
  }
`,re=e=>{const{showLoading:t,interval:o,isMobile:n,bottomResponsive:l,refreshTime:a}=e,i=d.hooks.useTranslation(S.defaultMessages),[r,s]=d.React.useState(i("lastUpdateAFewTime")),u=d.React.useRef(0),v=d.React.useCallback(()=>{let e=i("lastUpdateAFewTime");const t=(new Date).getTime()-a;return t>ae&&t<=12e4?e=i("lastUpdateAMinute"):t>12e4&&(e=i("lastUpdateTime",{updateTime:Math.floor(t/ae)})),e},[a,i]);d.React.useEffect(()=>(o<=0?(s(i("lastUpdateAFewTime")),window.clearInterval(u.current),u.current=null):(s(i("lastUpdateAFewTime")),u.current=window.setInterval(()=>{s(v())},ae)),()=>{window.clearInterval(u.current),u.current=null}),[o,v,i]);const p=(0,g.useTheme)();return(0,c.jsxs)("div",{className:"refresh-loading-con d-flex align-items-center",css:ie(p,n),children:[t&&(0,c.jsx)("div",{className:"loading-con"}),o>0&&(0,c.jsx)("div",{className:"flex-grow-1 auto-refresh-loading text-truncate",title:l?"":r,children:l?(0,c.jsx)(S.Tooltip,{title:r,showArrow:!0,placement:"top-end",children:(0,c.jsx)(S.Button,{icon:!0,size:"sm",type:"tertiary",className:"d-inline jimu-outline-inside border-0 p-0 icon-btn",children:(0,c.jsx)(le,{size:14,color:p.sys.color.surface.overlayText})})}):r})]})};var se=p(92799),ce=function(e,t,o,n){return new(o||(o=Promise))(function(l,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function r(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,r)}s((n=n.apply(e,t||[])).next())})};const de=e=>{var t,o,n,c,u,v,p,h,g;const{dataInvalid:m,layerConfig:f,activeView:b,tableContainer:y,canEditFeature:S,selectQueryFlag:x,tableShowColumns:w,dataActionRecords:j,selectionViewIds:R,maxCount:T,sourceVersion:O,isMapMode:I,tableSelectAsyncDs:C,isSelfEditing:M,activeTabId:D,respectMapRange:E,pagingStyle:A,pageSize:N,usedConfig:L}=e,[F,P]=d.React.useState(),[V,k]=d.React.useState(!1),[$,H]=d.React.useState(!1),[G,W]=d.React.useState(!1),[U,Q]=d.React.useState(!1),[q,Y]=d.React.useState(null),K=d.React.useRef(null),Z=d.React.useRef(null),ee=d.React.useRef(null),te=d.React.useRef(null),oe=d.React.useRef(null),ne=d.React.useRef(null),le=d.React.useRef(null),ae=d.React.useRef(""),ie=(e=>{const t=(null==e?void 0:e.type)===d.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===d.DataSourceTypes.BuildingComponentSubLayer;let o;return null==e||e.type,d.DataSourceTypes.OrientedImageryLayer,null==e||e.type,d.DataSourceTypes.ImageryLayer,o=t?e.getAssociatedDataSource():e,o})(z((null===(t=null==f?void 0:f.useDataSource)||void 0===t?void 0:t.dataSourceId)||(null===(o=null==f?void 0:f.dataActionDataSource)||void 0===o?void 0:o.id))),re=d.ReactRedux.useSelector(e=>{var t,o;return null===(o=null===(t=e.dataSourcesInfo)||void 0===t?void 0:t[null==ie?void 0:ie.id])||void 0===o?void 0:o.status}),de=d.hooks.usePrevious(re)!==d.DataSourceStatus.Unloaded&&re===d.DataSourceStatus.Unloaded,ue=(null==ie?void 0:ie.dataViewId)===d.CONSTANTS.OUTPUT_DATA_VIEW_ID&&de,ve=d.React.useCallback(()=>{var e,t,o,n,l;(null===(e=oe.current)||void 0===e?void 0:e.remove)&&oe.current.remove(),(null===(t=ne.current)||void 0===t?void 0:t.remove)&&ne.current.remove(),(null===(o=Z.current)||void 0===o?void 0:o.remove)&&Z.current.remove(),(null===(n=ee.current)||void 0===n?void 0:n.remove)&&ee.current.remove(),(null===(l=te.current)||void 0===l?void 0:l.remove)&&te.current.remove(),K.current&&!K.current.destroyed&&(K.current.destroy(),K.current=null),y.current&&(y.current.innerHTML="")},[y]);d.React.useEffect(()=>()=>{ve()},[ve]),d.React.useEffect(()=>{ae.current!==(null==ie?void 0:ie.id)&&(P(void 0),K.current&&ve())},[null==ie?void 0:ie.id,D,ve]),d.React.useEffect(()=>{if(!ie)return;function e(){return ce(this,void 0,void 0,function*(){let e;try{if((null==j?void 0:j.length)>0){e=(yield d.dataSourceUtils.createJSAPIFeatureLayerByRecords(ie,j)).layer}else e=yield null==ie?void 0:ie.createJSAPILayerByDataSource()}catch(e){console.log(e)}return e})}const t=function(){return ce(this,void 0,void 0,function*(){let e=null;try{const t=null==ie?void 0:ie.getCurrentQueryParams();e=yield d.dataSourceUtils.changeJimuArcGISQueryToJSAPIQuery(ie,(0,d.Immutable)(t)).then(e=>e&&e.geometry?e.geometry:null)}catch(e){console.log(e)}return e})}();Promise.resolve(t).then(t=>{var o;if(Y(t),I&&!(null==f?void 0:f.dataActionObject)){const t=null==b?void 0:b.getAllJimuLayerViews(),n=null==t?void 0:t.find(e=>{var t;return e.layerDataSourceId===(null===(t=null==f?void 0:f.useDataSource)||void 0===t?void 0:t.dataSourceId)}),l=null===(o=null==n?void 0:n.layer)||void 0===o?void 0:o.type;if(!n||!l||"feature"!==l&&"subtype-sublayer"!==l){const t=e();Promise.resolve(t).then(e=>{P(e)})}else{const e=null==n?void 0:n.layer;P(e)}}else{const t=e();Promise.resolve(t).then(e=>{P(e)})}}),ae.current=null==ie?void 0:ie.id},[ie,O,b,I,null===(n=null==f?void 0:f.useDataSource)||void 0===n?void 0:n.dataSourceId,null==f?void 0:f.dataActionObject,ue,j,R]),d.React.useEffect(()=>{const e=K.current;e&&(e.maxSize=T)},[T]),d.React.useEffect(()=>{"boolean"==typeof S&&function(){ce(this,void 0,void 0,function*(){var e;if((null==f?void 0:f.dataActionType)===s.View)return void k(!1);const t=yield(o=null==F?void 0:F.url,B(void 0,void 0,void 0,function*(){if(!o)return!1;const e=d.esri.restRequest.request;try{const t=yield e(`${o}?f=json`);return!Object.keys(t).includes("error")}catch(e){return!1}}));var o;const n=yield(e=>B(void 0,void 0,void 0,function*(){var t;if(!e)return!1;const o=yield null==e?void 0:e.fetchItemInfo().then(e=>e).catch(e=>{console.error(e)});if(!o||!o.url)return!1;const n=null===(t=yield d.ServiceManager.getInstance().fetchArcGISServerInfo(o.url))||void 0===t?void 0:t.owningSystemUrl;if(!n)return!1;const l=d.SessionManager.getInstance().getSessionByUrl(n);if(!l)return!1;const a=yield l.getUser(),i="org_admin"===(null==a?void 0:a.role),r=null==o?void 0:o.isOrgItem,s=((null==a?void 0:a.privileges)||[]).includes("portal:admin:updateItems"),c=i&&r&&s,u=o.owner===(null==a?void 0:a.username),v=yield d.privilegeUtils.isItemInTheUpdatedGroup(o.id,l);return c||u||v}))(ie),l=null==F?void 0:F.userHasFullEditingPrivileges,i=null===(e=null==F?void 0:F.editingEnabled)||void 0===e||e,r=(null==f?void 0:f.layerHonorMode)===a.Webmap,c=t||S,u=(r||(null==f?void 0:f.enableEdit))&&c;let v=!1;v=!!(n||l&&i)||!(l&&!i)&&u,k(v)})}()},[F,S,ie,f]);const pe=d.React.useCallback(()=>{const e=K.current;if(null==e?void 0:e.layer){const t=(ie&&ie.getCurrentQueryParams()).where;e.definitionExpression=t}},[ie]),he=d.React.useCallback(()=>{var e,t;const o=K.current,n=null==L?void 0:L.selectMode;if(!n||!o)return;(null===(e=Z.current)||void 0===e?void 0:e.remove)&&Z.current.remove(),$||(Z.current=o.on("cell-click",({feature:e,objectId:t})=>{if(!e)return;if($)return;const a=o.highlightIds;clearTimeout(le.current),le.current=setTimeout(()=>{var i;const r=t||e.getObjectId(),s=a.includes(r),c=o.attachmentsViewOptions.objectId,d=o.relatedTable;if(c||d)C([t||e.getObjectId()]);else{n===l.Single&&o.highlightIds.removeAll(),s?o.highlightIds.remove(r):o.highlightIds.add(r);const e=null===(i=o.highlightIds)||void 0===i?void 0:i.toArray();0===(null==e?void 0:e.length)&&(x&&(o.filterBySelectionEnabled=!1),pe()),C(e)}},200)})),(null===(t=ee.current)||void 0===t?void 0:t.remove)&&ee.current.remove(),ee.current=o.on("cell-dblclick",({feature:e,objectId:t})=>{clearTimeout(le.current)})},[$,null==L?void 0:L.selectMode,pe,x,C]),ge=d.React.useCallback(()=>{var e;const t=K.current,o=null==L?void 0:L.selectMode;if(!o||!t)return;(null===(e=te.current)||void 0===e?void 0:e.remove)&&te.current.remove(),$||(te.current=t.on("cell-keydown",({feature:e,native:n,objectId:a})=>{var i;if(!e)return;if($)return;const r=n.keyCode;if(n.shiftKey&&32===r){const n=t.highlightIds,r=a||e.getObjectId(),s=n.includes(r);if(!t.attachmentsViewOptions.objectId){o===l.Single&&t.highlightIds.removeAll(),s?t.highlightIds.remove(r):t.highlightIds.add(r);const e=null===(i=t.highlightIds)||void 0===i?void 0:i.toArray();0===(null==e?void 0:e.length)&&(x&&(t.filterBySelectionEnabled=!1),pe()),C(e)}else C([a||e.getObjectId()])}}))},[$,null==L?void 0:L.selectMode,pe,x,C]);d.React.useEffect(()=>{var e,t,o;(null==L?void 0:L.enableSelect)?(he(),ge()):((null===(e=Z.current)||void 0===e?void 0:e.remove)&&Z.current.remove(),(null===(t=ee.current)||void 0===t?void 0:t.remove)&&ee.current.remove(),(null===(o=te.current)||void 0===o?void 0:o.remove)&&te.current.remove())},[null==L?void 0:L.enableSelect,$,he,ge]);const me=d.React.useCallback(e=>{var t,o;const n=K.current;if(!f||!n)return;const l=J(ie,f,L,w,e),a=!d.lodash.isDeepEqual(null===(t=n.tableTemplate)||void 0===t?void 0:t.columnTemplates,null==l?void 0:l.columnTemplates);(e||a)&&(n.tableTemplate=l),0===(null===(o=l.columnTemplates)||void 0===o?void 0:o.length)?n.visible=!1:n.visible=!0},[ie,f,L]),fe=d.React.useCallback(()=>{var e;const t=K.current;if(!(null==f?void 0:f.columnSetting)||!t)return;const o=f.columnSetting;if((null==o?void 0:o.responsiveType)===i.Fixed){const n=o.columnWidth||200;((null===(e=t.columns)||void 0===e?void 0:e.toArray())||[]).forEach((e,t)=>{const o=e,l="EsriFeatureTableAttachmentsColumn"===o.fieldName,a=o.fieldName.indexOf("EsriFeatureTableRelationshipColumn")>=0;(l||a)&&setTimeout(()=>{K.current.columns.toArray()[t].width=n},200)})}},[null==f?void 0:f.columnSetting]);d.React.useEffect(()=>{G&&me()},[G,me]),d.React.useEffect(()=>{G&&!U&&fe()},[G,U,fe]);const{enableRelatedRecords:be,enableAttachments:ye,enableSelect:Se}=L,xe=d.hooks.usePrevious(f),we=d.hooks.usePrevious(L),je=d.hooks.usePrevious(be),Re=d.hooks.usePrevious(ye),Te=d.hooks.usePrevious(F),Oe=d.hooks.usePrevious(A),Ie=d.hooks.usePrevious(N),Ce=d.hooks.usePrevious(V),Me=d.React.useCallback(e=>{var t,o,n,l;if(!(null===(t=K.current)||void 0===t?void 0:t.isQueryingOrSyncing))return;M.current=!0;const{updatedFeatures:a,deletedFeatures:i}=e,r=a&&a.length>0,s=i&&i.length>0;if(r){const t=null===(n=null===(o=null==e?void 0:e.edits)||void 0===o?void 0:o.updateFeatures)||void 0===n?void 0:n[0];if(t){const e=ie.buildRecord(t);ie.afterUpdateRecord(e)}}if(s){const t=null===(l=null==e?void 0:e.edits)||void 0===l?void 0:l.deleteFeatures;if((null==t?void 0:t.length)>0){const e=[];t.forEach(t=>{const o=ie.buildRecord(t);e.push(o.getId())}),ie.afterDeleteRecordsByIds(e)}}},[ie,M]);if(m)K.current&&ve();else if(y.current&&ie&&F){const e=f.id!==(null==xe?void 0:xe.id)&&(null===(c=null==f?void 0:f.useDataSource)||void 0===c?void 0:c.dataSourceId)===(null===(u=null==xe?void 0:xe.useDataSource)||void 0===u?void 0:u.dataSourceId),t=!d.lodash.isDeepEqual(f,xe)||!d.lodash.isDeepEqual(L,we),o=!d.lodash.isDeepEqual(F,Te);if(!K.current||o||e){ve();const e=document.createElement("div");e.className="h-100",y.current.appendChild(e),K.current=new se.default(Object.assign(Object.assign(Object.assign({container:e,layer:F},(null==b?void 0:b.view)?{view:b.view}:{}),T?{maxSize:T}:{}),{paginationEnabled:A===r.Multiple,pageSize:N||50,attachmentsEnabled:ye,relatedRecordsEnabled:be,visibleElements:{columnDescriptions:!1,header:!1,menu:!1,menuItems:{clearSelection:!1,refreshData:!1,toggleColumns:!1},selectionColumn:!1},menuConfig:{items:[]},multiSortEnabled:!0,editingEnabled:V,timeZone:_(ie),filterGeometry:q})),Se?(he(),ge()):((null===(v=Z.current)||void 0===v?void 0:v.remove)&&Z.current.remove(),(null===(p=ee.current)||void 0===p?void 0:p.remove)&&ee.current.remove(),(null===(h=te.current)||void 0===h?void 0:h.remove)&&te.current.remove())}const n=K.current;V!==Ce&&(n.editingEnabled=V),Re!==ye&&(n.attachmentsEnabled=ye,me(!0)),je!==be&&(n.relatedRecordsEnabled=be,me(!0)),Oe!==A&&(n.paginationEnabled=A===r.Multiple),Ie!==N&&(n.pageSize=N||50),f&&f.id===(null==xe?void 0:xe.id)&&t&&me(!0)}d.React.useEffect(()=>{let e;if(F){if("subtype-sublayer"===F.type){const t=F.parent;t.on&&(e=t.on("edits",Me))}else F.on&&(e=F.on("edits",Me));return()=>{null==e||e.remove()}}},[F,Me]);const De=K.current;return d.React.useEffect(()=>{const e=X.watch(()=>null==De?void 0:De.state,e=>{W("loaded"===e)},{initial:!0,sync:!0}),t=X.watch(()=>{var e;return null===(e=null==De?void 0:De.columns)||void 0===e?void 0:e.toArray().some(e=>e.editInfo)},e=>{H(!!e)},{initial:!0,sync:!0}),o=X.watch(()=>null==De?void 0:De.relatedTable,e=>{e&&(e.visibleElements.selectionColumn=!1)},{sync:!0}),n=X.watch(()=>null==De?void 0:De.isQueryingOrSyncing,e=>{Q(e)},{initial:!0,sync:!0});return()=>{null==e||e.remove(),null==t||t.remove(),null==o||o.remove(),null==n||n.remove()}},[De]),d.React.useEffect(()=>{let e;if(E){const t=null==b?void 0:b.getAllJimuLayerViews(),o=null==t?void 0:t.find(e=>{var t;return e.layerDataSourceId===(null===(t=null==f?void 0:f.useDataSource)||void 0===t?void 0:t.dataSourceId)});if(!o)return void(De&&(De.maxSize=null));e=X.watch(()=>null==o?void 0:o.isLayerVisibleForRendering(),e=>{e?De&&(De.maxSize=null):De&&(De.maxSize=0)},{initial:!0,sync:!0})}else De&&(De.maxSize=null);return()=>{null==e||e.remove()}},[De,E,b,null===(g=null==f?void 0:f.useDataSource)||void 0===g?void 0:g.dataSourceId]),[K.current,G,ae.current]};var ue=p(65959),ve=p.n(ue),pe=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const he=e=>{const t=window.SVG,{className:o}=e,n=pe(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:ve()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var ge=p(7835),me=p.n(ge),fe=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const be=e=>{const t=window.SVG,{className:o}=e,n=fe(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:me()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var ye=p(27964),Se=p.n(ye),xe=p(20904),we=p.n(xe),je=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Re=e=>{const t=window.SVG,{className:o}=e,n=je(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component has-rtl-svg",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:Se(),srcRTL:we()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var Te=p(4583),Oe=p.n(Te),Ie=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Ce=e=>{const t=window.SVG,{className:o}=e,n=Ie(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:Oe()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var Me=p(21935),De=p.n(Me),Ee=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Ae=e=>{const t=window.SVG,{className:o}=e,n=Ee(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:De()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var Ne=p(9044),Le=p.n(Ne),Fe=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Pe=e=>{const t=window.SVG,{className:o}=e,n=Fe(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:Le()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var ze=p(49419),Ve=p.n(ze),ke=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const $e=e=>{const t=window.SVG,{className:o}=e,n=ke(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:Ve()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))};var Be=p(4651),He=p.n(Be),_e=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Ge=e=>{const t=window.SVG,{className:o}=e,n=_e(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",o);return t?(0,c.jsx)(t,Object.assign({className:l,src:He()},n)):(0,c.jsx)("svg",Object.assign({className:l},n))},We=(e,t,o)=>d.css`
    &.top-button-list{
      ${!e&&!t&&"\n        position: absolute;\n        right: 16px;\n      "}
      ${o?"display: none":"display: flex"};
      .top-button{
        display: inline-flex;
        button{
          width: 32px;
          height: 32px;
        }
        .map-extent-filter {
          &.active {
            color: var(--sys-color-action-selected-text);
            background-color: var(--sys-color-action-selected);
          }
        }
      }
    }
  `,Ue=(e,t,o)=>d.css`
    &.dropdown-list-container{
      ${!e&&!t&&"\n        position: absolute;\n        right: 17px;\n      "}
      .dropdown-list{
        ${!o&&"display: none;"}
        width: 32px;
        height: 32px;
      }
      .horizontal-action-dropdown{
        button{
          width: 32px;
          height: 32px;
        }
      }
    }
  `,Je=e=>{const{usedState:n,curLayerConfig:l,usedConfig:i,dataSource:r,dsSelection:s,isMapMode:u,arrangeType:v,widgetId:p,enableDataAction:h,enableMapExtentFilter:g,onShowSelection:m,resetTable:f,onTableRefresh:b,onDeleteSelection:y,onValueChangeFromRuntime:w,toggleMapFilter:j}=e,{activeTabId:R,selectQueryFlag:T,tableShowColumns:O,mobileFlag:I,emptyTable:C,tableLoaded:M,tableSelected:D,allowDel:E,mapFilterEnabled:A,allLayersConfig:N,columns:F,enableRelatedRecords:P,enableAttachments:z,setTableShowColumns:V}=n,{enableSelect:$,enableRefresh:B,enableShowHideColumn:H=!0}=i,{enableSearch:_=!1,searchFields:G=[],isFreezeFields:W,frozenFields:U,freezeLocation:J}=l,[Q,q]=d.React.useState(),[Y,K]=d.React.useState(),X=d.hooks.useTranslation(x,S.defaultMessages),Z=_&&0!==(null==G?void 0:G.length),ee=v===t.Tabs,te=D>0,oe=u&&g,ne=null==r?void 0:r.getLabel(),le=X("tableDataActionLabel",{layer:ne||""}),ae=(null==r?void 0:r.dataViewId)===d.CONSTANTS.SELECTION_DATA_VIEW_ID,ie=d.React.useMemo(()=>{const e=O||Y;if(!e)return[];const t=e.filter(e=>{const t="EsriFeatureTableAttachmentsColumn"!==e.value,o=0!==e.value.toString().indexOf("EsriFeatureTableRelationshipColumn");return t&&o});if(W&&U&&U.length>0){const e=t.findIndex(e=>{var t;return U.includes(null===(t=e.value)||void 0===t?void 0:t.toString())});if(e>-1){const n=t.splice(e,1)[0];J===o.End?t.push(n):t.unshift(n)}}return null==t?void 0:t.map(e=>{var t;return null===(t=e.value)||void 0===t?void 0:t.toString()})},[O,Y,W,U,J]),re=null==F?void 0:F.toArray(),se=d.hooks.useLatest(re);d.React.useEffect(()=>{var e,t,o;if(!(null==l?void 0:l.layerHonorMode)||!M)return;const n=[];null===(e=se.current)||void 0===e||e.forEach(e=>{var t;const o=e.name||e.fieldName,l=e.effectiveLabel||e.alias||e.fieldName,a="EsriFeatureTableAttachmentsColumn"===o,i=0===(null===(t=null==o?void 0:o.toString())||void 0===t?void 0:t.indexOf("EsriFeatureTableRelationshipColumn"));(a||i)&&n.push({value:o,label:l,hidden:e.hidden,type:a?"attachment":"relationship"})});const i=[],s=[];if(l.layerHonorMode===a.Webmap){const e=null===(t=null==r?void 0:r.getPopupInfo)||void 0===t?void 0:t.call(r),n=(null==e?void 0:e.fieldInfos)||[],l=null==r?void 0:r.getLayerDefinition(),a=null==r?void 0:r.getSchema(),c=(null==a?void 0:a.fields)?Object.values(null==a?void 0:a.fields):[],d=Object.keys((null==a?void 0:a.fields)||{}),u=n.filter(e=>d.includes(e.fieldName)),v=(null===(o=null==l?void 0:l.fields)||void 0===o?void 0:o.length)>0?l.fields:c,p=k(null==a?void 0:a.fields,v);if((null==n?void 0:n.length)>0)for(const e of u){const t={value:e.fieldName,label:e.label};i.push(t),e.visible&&s.push(t)}else for(const e of p){const t={value:e.name,label:e.alias};i.push(t),s.push(t)}}else for(const e of l.tableFields){const t={value:e.name,label:e.alias};i.push(t),e.visible&&s.push(t)}n.forEach(e=>{("attachment"===e.type&&z||"relationship"===e.type&&P)&&(i.push({value:e.value,label:e.label}),e.hidden||s.push(e))}),q(i),K(s),V(s)},[M,r,se,P,z,null==l?void 0:l.layerHonorMode,null==l?void 0:l.tableFields,V]);const ce=(0,c.jsxs)("div",{className:"d-flex ml-2 dropdown-list-container",css:Ue(Z,ee,I),children:[(0,c.jsxs)(S.Dropdown,{size:"sm",className:"d-inline-flex dropdown-list",children:[(0,c.jsx)(S.DropdownButton,{arrow:!1,icon:!0,size:"sm",title:X("options"),children:(0,c.jsx)(Ge,{})}),(0,c.jsxs)(S.DropdownMenu,{children:[!ae&&(0,c.jsxs)(S.DropdownItem,{onClick:m,disabled:!M||C||!te,children:[T?(0,c.jsx)(be,{className:"mr-1"}):(0,c.jsx)(Re,{className:"mr-1",autoFlip:!0}),X(T?"showAll":"showSelection")]},"showSelection"),$&&(0,c.jsxs)(S.DropdownItem,{onClick:f,disabled:!M||C||!te,children:[(0,c.jsx)(Ce,{className:"mr-1"}),X("clearSelection")]},"clearSelection"),B&&(0,c.jsxs)(S.DropdownItem,{onClick:b,disabled:!M||C,children:[(0,c.jsx)(Ae,{className:"mr-1"}),X("refresh")]},"refresh"),E&&(0,c.jsxs)(S.DropdownItem,{onClick:y,disabled:!M||C||!te,children:[(0,c.jsx)(Pe,{className:"mr-1"}),X("deleteRecords")]},"delete"),Q&&H&&(0,c.jsx)(S.AdvancedSelect,{size:"sm",className:"table-dropdown-column",title:X("showHideCols"),arrow:!1,isSubMenuItem:!0,staticValues:Q,sortList:!1,isMultiple:!0,selectedValues:O||Y,isEmptyOptionHidden:!1,disabled:!M||C,onChange:w,customDropdownButtonContent:()=>(0,c.jsxs)(L.Fragment,{children:[(0,c.jsx)($e,{className:"mr-1"}),X("showHideCols")]}),variant:"contained",color:"primary"})]})]}),r&&I&&(0,c.jsxs)(L.Fragment,{children:[oe&&(0,c.jsxs)(L.Fragment,{children:[(0,c.jsx)("span",{className:"tool-dividing-line"}),(0,c.jsx)("div",{className:"mobile-map-button "+(h?"mr-2":""),children:(0,c.jsx)(S.Button,{icon:!0,size:"sm",onClick:j,variant:"contained",title:X("enableMapExtentFilter"),"aria-label":X("enableMapExtentFilter"),disabled:!M||C,"aria-pressed":A,children:(0,c.jsx)(he,{})})})]}),h&&(0,c.jsx)(L.Fragment,{children:N.map(e=>e.id===R&&!C?(0,c.jsxs)(L.Fragment,{children:[!oe&&(0,c.jsx)("span",{className:"tool-dividing-line"}),(0,c.jsx)("div",{className:"horizontal-action-dropdown",children:(0,c.jsx)(S.DataActionList,{widgetId:p,listStyle:S.DataActionListStyle.Dropdown,dataSets:[{dataSource:r,type:"selected",records:s,fields:ie,name:le}]})})]},e.id):"")})]})]}),de=(0,c.jsxs)("div",{className:"top-button-list",css:We(Z,ee,I),children:[!ae&&(0,c.jsx)("div",{className:"top-button ml-2",children:(0,c.jsx)(S.Button,{size:"sm",onClick:m,icon:!0,title:X(T?"showAll":"showSelection"),"aria-label":X(T?"showAll":"showSelection"),disabled:!M||C||!te,children:T?(0,c.jsx)(be,{}):(0,c.jsx)(Re,{autoFlip:!0})})}),$&&(0,c.jsx)("div",{className:"top-button ml-2",children:(0,c.jsx)(S.Button,{size:"sm",onClick:f,icon:!0,title:X("clearSelection"),"aria-label":X("clearSelection"),disabled:!M||C||!te,children:(0,c.jsx)(Ce,{})})}),B&&(0,c.jsx)("div",{className:"top-button ml-2",children:(0,c.jsx)(S.Button,{size:"sm",onClick:b,icon:!0,title:X("refresh"),"aria-label":X("refresh"),disabled:!M||C,children:(0,c.jsx)(Ae,{})})}),E&&(0,c.jsx)("div",{className:"top-button ml-2",children:(0,c.jsx)(S.Button,{size:"sm",onClick:y,icon:!0,title:X("deleteRecords"),"aria-label":X("deleteRecords"),disabled:!M||C||!te,children:(0,c.jsx)(Pe,{})})}),Q&&H&&(0,c.jsx)("div",{className:"top-button ml-2",children:(0,c.jsx)(S.AdvancedSelect,{size:"sm",title:X("showHideCols"),"aria-label":X("showHideCols"),icon:!0,arrow:!1,disabled:!M||C,staticValues:Q,sortList:!1,isMultiple:!0,selectedValues:O||Y,isEmptyOptionHidden:!1,onChange:w,customDropdownButtonContent:()=>(0,c.jsx)($e,{})})}),oe&&(0,c.jsxs)(L.Fragment,{children:[(0,c.jsx)("span",{className:"tool-dividing-line"}),(0,c.jsx)("div",{className:"top-button "+(h?"mr-2":""),children:(0,c.jsx)(S.Button,{icon:!0,size:"sm",onClick:j,variant:"contained",className:(0,d.classNames)("map-extent-filter",{active:A}),title:X("enableMapExtentFilter"),"aria-label":X("enableMapExtentFilter"),disabled:!M||C,"aria-pressed":A,children:(0,c.jsx)(he,{})})})]}),r&&!I&&h&&(0,c.jsx)(L.Fragment,{children:N.map(e=>e.id===R&&!C?(0,c.jsxs)(L.Fragment,{children:[!oe&&(0,c.jsx)("span",{className:"tool-dividing-line"}),(0,c.jsx)("div",{className:"top-button data-action-btn",children:(0,c.jsx)(S.DataActionList,{widgetId:p,listStyle:S.DataActionListStyle.Dropdown,dataSets:[{dataSource:r,type:"selected",records:s,fields:ie,name:le}]})})]},e.id):"")})]});return I?ce:de};var Qe=p(62686),qe=function(e,t,o,n){return new(o||(o=Promise))(function(l,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function r(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,r)}s((n=n.apply(e,t||[])).next())})};const Ye=e=>{const{widgetId:t,useMapWidgetIds:o,mapViewsConfig:n,mapFilterEnabled:l,onUpdateViewExtent:a,onRestTableGeometry:i,onLayersConfigChange:r,onViewChange:s}=e,[u,v]=d.React.useState(null),p=null==o?void 0:o[0],h=d.React.useCallback(()=>qe(void 0,void 0,void 0,function*(){var e,o;if(u){const l=null===(o=null===(e=null==n?void 0:n[null==u?void 0:u.id])||void 0===e?void 0:e.asMutable)||void 0===o?void 0:o.call(e,{deep:!0}),a=yield((e,t,o)=>B(void 0,void 0,void 0,function*(){if(!t)return[];const n=[];yield t.whenJimuMapViewLoaded();const l=t.getAllJimuLayerViews(),a=t.getJimuTables(),{layersConfig:i=[],customJimuLayerViewIds:r=[],customizeLayers:s,displayRuntimeLayers:c=!0}=e||{},u={};for(const e of l){const t=e.id;if(!P(e))continue;const{layerDataSourceId:o}=e,l=null==e?void 0:e.fromRuntime,a=e.isLayerVisible();if(c&&l&&a){let t=(null==e?void 0:e.getLayerDataSource())||H.getDataSource(o);if(!t)try{t=yield e.createLayerDataSource()}catch(e){continue}const n=null==t?void 0:t.getSchema();if(!t||!(null==n?void 0:n.fields))continue;const l=Q(t,!0,void 0,e.jimuMapViewId);u[l.id]=l;continue}if(!(s?r.includes(t):a))continue;const d=t.indexOf("-"),v=t.substring(d+1),p=i.find(e=>e.id===v);let h=(null==e?void 0:e.getLayerDataSource())||H.getDataSource(o);if(!h)try{h=yield e.createLayerDataSource()}catch(e){continue}const g=null==h?void 0:h.getSchema();if(!h||!(null==g?void 0:g.fields))continue;const m=Q(h,!0,void 0,e.jimuMapViewId);if(p)if(0!==V(m.allFields,p.allFields).length){const e=Object.assign(Object.assign({},p),{name:m.name,useDataSource:m.useDataSource,allFields:m.allFields,tableFields:m.tableFields});n.push(e)}else n.push(p);else n.push(m)}d.MutableStoreManager.getInstance().updateStateValue(o,"runtimeTableObj",u);for(const e of a){const o=e.table,l=e.jimuTableId,{visible:a}=o,c=t.getDataSourceIdByAPILayer(o);if(!(s?r.includes(l):a))continue;const d=l.indexOf("-"),u=l.substring(d+1),v=i.find(e=>e.id===u),p=H.getDataSource(c),h=t.getMapDataSource();let g=p;if(!p&&h)try{g=yield h.createDataSourceByLayer(o)}catch(e){continue}if(!g)continue;const m=Q(g,!0);if(v)if(0!==V(m.allFields,v.allFields).length){const e=Object.assign(Object.assign({},v),{name:m.name,useDataSource:m.useDataSource,allFields:m.allFields,tableFields:m.tableFields});n.push(e)}else n.push(v);else n.push(m)}if((null==i?void 0:i.length)>0){const e=i.map(e=>e.id);n.sort((t,o)=>e.indexOf(t.id)-e.indexOf(o.id))}return n}))(l,u,t);r(a)}else r([])}),[t,u,n,r]),g=d.React.useCallback(e=>{v(e),s(e)},[s]),m=d.hooks.useLatest(h),f=d.React.useCallback(e=>{var t;null===(t=m.current)||void 0===t||t.call(m)},[m]),b=d.React.useCallback(e=>{var t;null===(t=m.current)||void 0===t||t.call(m)},[m]),y=d.React.useCallback(e=>{var t;e.fromRuntime&&(null===(t=m.current)||void 0===t||t.call(m))},[m]);d.React.useEffect(()=>{const e=window.setTimeout(h,50);return()=>{window.clearTimeout(e)}},[h]),d.React.useEffect(()=>{if(!u||!u.view)return;u.addJimuLayerViewsVisibleChangeListener(f),u.addJimuLayerViewCreatedListener(b),u.addJimuLayerViewRemovedListener(y);const e=u;return()=>{e&&(e.removeJimuLayerViewsVisibleChangeListener(f),e.removeJimuLayerViewCreatedListener(b),e.removeJimuLayerViewRemovedListener(y))}},[u,b,y,f]);const S=d.React.useRef(null),x=d.React.useCallback(e=>{null!==S.current&&window.clearTimeout(S.current),S.current=window.setTimeout(()=>{a(e)},500)},[a]),w=d.hooks.usePrevious(l);return d.React.useEffect(()=>{let e;if(u&&u.view&&l){const t=u.view,o=t.extent.clone();x(o),e=X.watch(()=>null==t?void 0:t.extent,e=>{x(e)})}return w&&!l&&(x(),i()),()=>{var t;null===(t=null==e?void 0:e.remove)||void 0===t||t.call(e)}},[x,u,w,l,i]),(0,c.jsx)(Qe.JimuMapViewComponent,{useMapWidgetId:p,onActiveViewChange:g})};var Ke=function(e,t,o,n){return new(o||(o=Promise))(function(l,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function r(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,r)}s((n=n.apply(e,t||[])).next())})};function Xe(e){return d.css`
    .esri-button-menu__item .esri-button-menu__item-label{
      padding: 4px 15px !important;
    }
    .table-popup-search{
      .search-icon{
        z-index: 2;
      }
      .popup-search-input{
        border-radius: 2px;
        .input-wrapper{
          height: 30px;
        }
      }
    }
    .table-action-option{
      width: 100%;
      display: inline-flex;
      flex-direction: row;
      .table-action-option-tab{
        margin: auto 8px;
      }
      .table-action-option-close{
        flex: 1;
        button{
          :hover {
            color: ${e.sys.color.action.default};
          }
          float: right;
        }
      }
    }
    .esri-popover--open{
      z-index: 1005 !important;
      .esri-date-picker__calendar{
        background-color: ${e.sys.color.action.default};
      }
    }
  `}var Ze=p(41496);const et={notReady:!1,emptyTable:!1,showLoading:!1,interval:0,needRefresh:!1,selectedRecords:[],refreshTime:(new Date).getTime()},tt=e=>{const{widgetId:t,curLayerConfig:o,isSelfEditing:n,onDataSourceCreated:l,onCreateDataSourceFailed:a,onUpdateLayerInfo:i,onTimeExtentChange:r,onGdbVersionChange:s,onBelongToSourceVersionChange:u,onSourceVersionChange:v,onNeedRefresh:p,onWidgetQueryChange:h}=e,[g,m]=d.React.useState(et);d.React.useEffect(()=>{i(g)},[g,i]);const f=d.React.useCallback((e,t)=>{if(!o)return;const l=window.jimuConfig.isInBuilder,a=Object.assign({},g),i=ot(o);if(!e||!i)return a.notReady=!1,a.emptyTable=!0,void m(a);const r=i.getLastDataLoadTime(),s=i.getLastAutoRefreshCheckTime(),c=s>r?s:r;a.refreshTime=c;const u=null==t?void 0:t.sourceVersion,v=null==e?void 0:e.sourceVersion,h=v!==u,f=h&&!n.current;n.current&&(n.current=!1),f&&p();const b=(null==i?void 0:i.getSourceRecords())||[],y=b.map(e=>e.getId()).join(",");if(h&&l)return a.notReady=!1,a.emptyTable=!1,a.selectedRecords=null==i?void 0:i.getSelectedRecords(),a.selectionViewIds=y,a.sourceVersion=v,void m(a);const S=(null==i?void 0:i.dataViewId)===d.CONSTANTS.SELECTION_DATA_VIEW_ID;if(S&&0!==(null==b?void 0:b.length))return a.notReady=!1,a.emptyTable=!1,a.selectedRecords=null==i?void 0:i.getSelectedRecords(),a.selectionViewIds=y,void m(a);const x=S&&0===(null==b?void 0:b.length);if(!o.dataActionObject&&(e.status===d.DataSourceStatus.NotReady||x))return a.notReady=!0,a.emptyTable=!0,a.selectionViewIds=y,void m(a);a.notReady=!1,a.emptyTable=!1,a.selectionViewIds=y;const w=null==i?void 0:i.getMaxRecordCount();a.maxCount=w,a.showLoading=function(e,t){let o=!1;(window.jimuConfig.isInBuilder||e&&t===d.DataSourceStatus.Loading)&&(o=!0);return o}(i,e.status);const j=i.getAutoRefreshInterval()||0;a.interval=j;const R=null==t?void 0:t.selectedIds,T=null==e?void 0:e.selectedIds;d.lodash.isDeepEqual(R,T)||(a.selectedRecords=i.getSelectedRecords()),m(a)},[o,n,g,p]),b=d.React.useCallback((e,t,o=!1)=>{const{widgetQueries:n,gdbVersion:l,sourceVersion:a}=t,{widgetQueries:i,gdbVersion:r,needRefresh:c,sourceVersion:d}=e;if(l&&r&&r!==l)return void s(r);c&&p();if(o&&a!==d)return void u();a!==d&&v();i&&i!==n&&h()},[u,v,s,p,h]),y=d.React.useCallback((e,t)=>{var n;if(!t||!o)return;const l=ot(o);if(!l)return;const a=l.getCurrentQueryParams(),i=null==a?void 0:a.time;r(i);const s=l.id,c=null==e?void 0:e[s],d=null==t?void 0:t[s],u=null===(n=null==l?void 0:l.belongToDataSource)||void 0===n?void 0:n.id,v=null==e?void 0:e[u],p=null==t?void 0:t[u];(c||v)&&(v?b(v,p,!0):b(c,d))},[b,o,r]),S=null==o?void 0:o.useDataSource,x=nt(o);return(0,c.jsx)(d.DataSourceComponent,{widgetId:t,useDataSource:(0,d.Immutable)(S),dataSource:x,onDataSourceCreated:l,onCreateDataSourceFailed:a,onDataSourceInfoChange:f,onQueryRequired:y})};function ot(e){var t;const o=null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId;let n=z(o);return n||(n=nt(e)),n}function nt(e){let t=null;return(null==e?void 0:e.dataActionObject)&&(t=e.dataActionDataSource),t}var lt=p(31526),at=p(13440),it=p.n(at),rt=function(e,t,o,n){return new(o||(o=Promise))(function(l,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function r(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,r)}s((n=n.apply(e,t||[])).next())})};const{BREAK_POINTS:st,SELECTION_DATA_VIEW_ID:ct}=d.CONSTANTS,dt={where:"1=1",sqlExpression:null},ut=o=>{var n,l,i,u,v;const{id:p,config:h,useMapWidgetIds:m,layoutId:f,layoutItemId:b,stateProps:y,mutableStateProps:j,state:R}=o,{tableMode:T,respectMapRange:O,arrangeType:I,pagingStyle:C,pageSize:M,layersConfig:D,mapViewsConfig:E,enableMapExtentFilter:A,defaultExtentFilterEnabled:L,enableRelatedRecords:F,enableAttachments:P,columnSetting:z,headerFontSetting:k,enableSelect:$,selectMode:B,showCount:H,enableRefresh:_,enableDelete:G,enableShowHideColumn:W}=h,U=(0,g.useTheme)(),Q=T===e.Map,[Y,Z]=d.React.useState(void 0),[te,oe]=d.React.useState([]),[ne,le]=d.React.useState([]),[ae,ie]=d.React.useState(),[se,ce]=d.React.useState(!1),[ue,ve]=d.React.useState(!1),[pe,he]=d.React.useState(!1),[ge,me]=d.React.useState(!1),[fe,be]=d.React.useState(600),[ye,Se]=d.React.useState(),[xe,we]=d.React.useState(0),[je,Re]=d.React.useState(!1),[Te,Oe]=d.React.useState(!1),[Ie,Ce]=d.React.useState(!1),[Me,De]=d.React.useState(!1),[Ee,Ae]=d.React.useState(0),[Ne,Le]=d.React.useState([]),[Fe,Pe]=d.React.useState(""),[ze,Ve]=d.React.useState(),[ke,$e]=d.React.useState(),[Be,He]=d.React.useState(0),[_e,Ge]=d.React.useState(null),We=d.React.useRef(null),Ue=d.React.useRef({}),Qe=d.React.useRef(!1),qe=d.React.useRef(!1),et=d.React.useRef(null),ot=d.React.useRef(null),nt=d.React.useRef(null),at=d.React.useRef(!1),ut=d.React.useRef(null),vt=d.hooks.useTranslation(x),pt=d.ReactRedux.useSelector(e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode}),ht=d.ReactRedux.useSelector(e=>{var t;const o=e.appConfig,n=null===(t=null==o?void 0:o.widgets)||void 0===t?void 0:t[p],l=null==n?void 0:n.enableDataAction;return void 0===l||l}),gt=d.ReactRedux.useSelector(e=>{var t,o,n,l,a;const i=e.appConfig,r=null===(t=null==i?void 0:i.layouts)||void 0===t?void 0:t[f],s=null===(n=null===(o=null==r?void 0:r.content)||void 0===o?void 0:o[b])||void 0===n?void 0:n.setting;return(null===(l=null==s?void 0:s.autoProps)||void 0===l?void 0:l.height)===Ze.LayoutItemSizeModes.Auto||!0===(null===(a=null==s?void 0:s.autoProps)||void 0===a?void 0:a.height)}),mt=d.ReactRedux.useSelector(e=>{var t,o,n,l,a;const i=e.appConfig,r=null===(t=null==i?void 0:i.layouts)||void 0===t?void 0:t[f],s=null===(n=null===(o=null==r?void 0:r.content)||void 0===o?void 0:o[b])||void 0===n?void 0:n.setting;return(null===(l=null==s?void 0:s.autoProps)||void 0===l?void 0:l.width)===Ze.LayoutItemSizeModes.Auto||!0===(null===(a=null==s?void 0:s.autoProps)||void 0===a?void 0:a.width)}),ft=d.ReactRedux.useSelector(e=>{var t;return null===(t=e.appConfig)||void 0===t?void 0:t.messageConfigs}),bt=(0,d.classNames)("jimu-widget","widget-table","table-widget-"+p),yt=I===t.Tabs,St=ne.find(e=>e.id===ae),xt=null===(n=(0,d.getAppStore)().getState())||void 0===n?void 0:n.appConfig,wt=null==St?void 0:St.useDataSource,jt=d.appConfigUtils.getWidgetIdByOutputDataSource(wt),Rt=null===(i=null===(l=null==xt?void 0:xt.widgets)||void 0===l?void 0:l[jt])||void 0===i?void 0:i.label,Tt=(null==St?void 0:St.enableSearch)&&0!==(null===(u=null==St?void 0:St.searchFields)||void 0===u?void 0:u.length),Ot=d.DataSourceManager.getInstance(),It=d.ReactRedux.useSelector(e=>{var t;return wt?Ot.getDataSource(null===(t=null==St?void 0:St.useDataSource)||void 0===t?void 0:t.dataSourceId):null==St?void 0:St.dataActionDataSource}),Ct=(null==j?void 0:j.viewInTableObj)&&Object.keys(j.viewInTableObj).join("|"),Mt=(null==j?void 0:j.runtimeTableObj)&&Object.keys(j.runtimeTableObj).join("|"),Dt=d.React.useCallback(e=>{if(!It)return;const t=e=>{d.MessageManager.getInstance().publishMessage(new d.DataRecordsSelectionChangeMessage(p,e,[It.id])),e.length>0?It.selectRecordsByIds(e.map(e=>e.getId()),e):It.clearSelection()};(null==e?void 0:e.length)>0?It.query({objectIds:e,returnGeometry:!0,outFields:["*"],notAddFieldsToClient:!0},{scope:d.QueryScope.InAllData}).then(e=>{const o=null==e?void 0:e.records;o&&t(o)}):t([])},[It,p]),Et=d.React.useMemo(()=>{const e=null==St?void 0:St.overrideGeneralSettings,t={enableRelatedRecords:F,enableAttachments:P,columnSetting:z,headerFontSetting:k,enableSelect:$,selectMode:B,enableRefresh:_,enableDelete:G,enableShowHideColumn:W,showCount:H};if(!St)return t;const o=["enableRelatedRecords","enableAttachments","columnSetting","headerFontSetting","enableSelect","selectMode","showCount","enableRefresh","enableDelete","enableShowHideColumn"],n=Object.keys(St).reduce((e,t)=>(o.includes(t)&&(e[t]=St[t]),e),t);return e?n:{enableRelatedRecords:F,enableAttachments:P,columnSetting:z,headerFontSetting:k,enableSelect:$,selectMode:B,showCount:H,enableRefresh:_,enableDelete:G,enableShowHideColumn:W}},[F,z,P,$,_,G,W,k,B,H,St]),At={dataInvalid:Te,layerConfig:St,activeView:_e,tableContainer:We,canEditFeature:Y,selectQueryFlag:se,tableShowColumns:ye,dataActionRecords:null===(v=Ue.current)||void 0===v?void 0:v[null==St?void 0:St.id],selectionViewIds:Fe,maxCount:ze,sourceVersion:ke,isMapMode:Q,tableSelectAsyncDs:Dt,isSelfEditing:at,activeTabId:ae,respectMapRange:O,pagingStyle:C,pageSize:M,usedConfig:Et},[Nt,Lt,Ft]=de(At),Pt={id:p,enableDataAction:ht,isHeightAuto:gt,isWidthAuto:mt,headerFontSetting:null==Et?void 0:Et.headerFontSetting,emptyTable:Te,isHorizontalTab:yt,widgetWidth:fe,isMultiPage:C===r.Multiple},zt={activeTabId:ae,selectQueryFlag:se,tableShowColumns:ye,mobileFlag:ue,emptyTable:Te,tableLoaded:Lt,tableSelected:xe,allowDel:Y&&(null==Et?void 0:Et.enableDelete),mapFilterEnabled:je,allLayersConfig:ne,columns:null==Nt?void 0:Nt.columns,enableRelatedRecords:F,enableAttachments:P,setTableShowColumns:Se},Vt=d.hooks.usePrevious(Tt),kt=d.hooks.usePrevious(Ct),$t=d.React.useCallback(()=>{const e=null==j?void 0:j.viewInTableObj,t=[];if(!Ct)return t;const o=Ct.split("|");return null==o||o.forEach(o=>{const n=e[o];n&&(Ue.current[o]=n.records,t.push(Object.assign({},n.daLayerItem)))}),t},[null==j?void 0:j.viewInTableObj,Ct]),Bt=d.React.useCallback(()=>{const e=null==j?void 0:j.runtimeTableObj,t=[];if(!Mt)return t;const o=Mt.split("|");return null==o||o.forEach(o=>{const n=e[o];n&&t.push(Object.assign({},n))}),t},[null==j?void 0:j.runtimeTableObj,Mt]),Ht=d.React.useCallback(e=>{oe(e)},[]),_t=d.React.useCallback(e=>{Ge(e)},[]),Gt=d.React.useCallback(e=>{if(!St||!It)return;const t=((e,t,o)=>{let n="1=1",l=null;if(!o)return null;if(!o.query)return null;if(t&&e.enableSearch&&e.searchFields){const a=d.dataSourceUtils.getSQL(t,e.searchFields,o,null==e?void 0:e.searchExact);n=a.sql,l=a}return{where:n,sqlExpression:l}})(St,e,It),o=It.getCurrentQueryParams(),n=Object.assign(Object.assign({},o),t);It.updateQueryParams(n,p)},[St,It,p]),Wt=d.React.useCallback(e=>{ie(e),ce(!1),Se(void 0),(0,d.getAppStore)().dispatch(d.appActions.widgetStatePropChange(p,"activeTabId",e))},[p]),Ut=d.React.useCallback(()=>{if(null==Nt?void 0:Nt.layer){const e=(It&&It.getCurrentQueryParams()).where;Nt.definitionExpression=e}},[It,Nt]),Jt=d.React.useCallback(()=>{var e,t;if(!It)return;let o=It.getSelectedRecordIds();const n=(null===(e=null==It?void 0:It.belongToDataSource)||void 0===e?void 0:e.getSelectedRecordIds())||[];It.isDataView&&o.length!==n.length&&(o=n||o),(null===(t=Nt.highlightIds)||void 0===t?void 0:t.removeAll)&&Nt.highlightIds.removeAll();const l=o.map(e=>parseInt(e));Nt.highlightIds.addMany(l)},[It,Nt]),Qt=d.React.useCallback((e,t,o)=>rt(void 0,void 0,void 0,function*(){var n;const l=null==e?void 0:e.spatialReference,a=null==e?void 0:e.type,{isWGS84:i,isWebMercator:r}=l;let s;i||r?(nt.current||(nt.current=yield(0,d.loadArcGISJSAPIModule)("esri/geometry/operators/geodesicBufferOperator")),nt.current.isLoaded()||(yield nt.current.load()),s=nt.current):(ot.current||(ot.current=yield(0,d.loadArcGISJSAPIModule)("esri/geometry/operators/bufferOperator")),s=ot.current);const c=null===(n=null==Nt?void 0:Nt.filterGeometry)||void 0===n?void 0:n.toJSON();if("polygon"!==a&&t&&t<=0){const e=new lt.default({rings:[]});d.lodash.isDeepEqual(c,null==e?void 0:e.toJSON())||(Nt.filterGeometry=e)}else if(t&&o){const n=s.execute(e,t,{unit:o});d.lodash.isDeepEqual(c,null==n?void 0:n.toJSON())||(Nt.filterGeometry=n)}else Nt.filterGeometry=e}),[Nt]),qt=d.React.useCallback(e=>{if((!(null==Nt?void 0:Nt.layer)&&It||(null==Nt?void 0:Nt.layer)&&It&&Ft!==It.id)&&(Qe.current=!0),!(null==Nt?void 0:Nt.layer)||!It)return;const t=(null==It?void 0:It.type)===d.DataSourceTypes.SubtypeSublayer;if(Ft!==It.id)return;Qe.current=!1;const o=null==It?void 0:It.getCurrentQueryParams(),n=Nt.definitionExpression;if(!(""===n&&"1=1"===(null==o?void 0:o.where))&&n!==(null==o?void 0:o.where))if(Lt)if(Nt.isQueryingOrSyncing){let e=X.watch(()=>Nt.isQueryingOrSyncing,()=>{if(!Nt.isQueryingOrSyncing){e&&(e.remove(),e=null);const n=null==It?void 0:It.getCurrentQueryParams();Nt.layer&&(null==o?void 0:o.where)===(null==n?void 0:n.where)&&Nt.definitionExpression!==(null==o?void 0:o.where)&&(t?Nt.layer.parent.definitionExpression=null==o?void 0:o.where:Nt.definitionExpression=null==o?void 0:o.where)}})}else t?Nt.layer.parent.definitionExpression=null==o?void 0:o.where:Nt.definitionExpression=null==o?void 0:o.where;else Qe.current=!0;if(ut.current&&!d.lodash.isDeepEqual(ut.current,null==o?void 0:o.orderByFields)){const e=J(It,St,Et,ye,!0);Nt.tableTemplate=e}ut.current=null==o?void 0:o.orderByFields,e||d.dataSourceUtils.changeJimuArcGISQueryToJSAPIQuery(It,(0,d.Immutable)(o)).then(e=>rt(void 0,void 0,void 0,function*(){if(!e)return Promise.resolve();const{geometry:t,distance:o,units:n}=e;if(!t)return Nt.filterGeometry=null,Promise.resolve();if(Lt)if(Nt.isQueryingOrSyncing){let e=X.watch(()=>Nt.isQueryingOrSyncing,()=>{Nt.isQueryingOrSyncing||(e&&(e.remove(),e=null),Qt(t,o,n))})}else Qt(t,o,n);else Qe.current=!0;return Promise.resolve()})).then(()=>{qe.current=!0}).catch(()=>{qe.current=!0})},[Ft,It,Nt,Lt,St,ye,Et,Qt]);d.React.useEffect(()=>{if(T===e.Layer){d.MutableStoreManager.getInstance().updateStateValue(p,"runtimeTableObj",{})}},[T,p]),d.React.useEffect(()=>{const e=$t(),t=Bt(),o=te.concat(e).concat(t);le(o)},[te,$t,Bt]),d.React.useEffect(()=>{const e=Ct?Ct.split("|"):[],t=kt?kt.split("|"):[],o=e.length,n=t.length;if(o>n){const o=((e,t)=>{const o=e.length>t.length,n=o?t:e;return(o?e:t).filter(e=>!n.some(t=>t===e))})(e,t);ie(o[0])}var l,a;o>0&&o===n&&(a=t,(l=e).length!==a.length||!l.every((e,t)=>e===a[t]))&&ie(e[o-1])},[kt,Ct]),d.React.useEffect(()=>()=>{const e=d.MutableStoreManager.getInstance();e.updateStateValue(p,"viewInTableObj",{}),e.updateStateValue(p,"runtimeTableObj",{})},[p]),d.React.useEffect(()=>{Ke(void 0,void 0,void 0,function*(){var e;const t=yield d.privilegeUtils.checkExbAccess(d.privilegeUtils.CheckTarget.Experience);return null===(e=null==t?void 0:t.capabilities)||void 0===e?void 0:e.canEditFeature}).then(e=>{Z(e)}).catch(()=>{Z(!1)})},[]),d.React.useEffect(()=>{var e;const t=R===d.WidgetState.Active;if(Nt&&It&&t&&qe.current&&(qe.current=!1,Jt()),Nt&&It&&!t){const t=((null==St?void 0:St.dataActionType)===s.View?It.getSelectedRecords():Ne)||[];(null===(e=Nt.highlightIds)||void 0===e?void 0:e.removeAll)&&Nt.highlightIds.removeAll();const o=t.map(e=>parseInt(e.getId()));Nt.highlightIds.addMany(o)}},[R,Nt,It,null==St?void 0:St.dataActionType,Ne,Jt]),d.React.useEffect(()=>{Nt&&It&&Lt&&qe.current&&(qe.current=!1,Jt())},[Nt,It,Lt,Jt]),d.React.useEffect(()=>{var e;const t=R===d.WidgetState.Active;if(Nt&&It&&t){const t=It.getSelectedRecords()||[];(null===(e=Nt.highlightIds)||void 0===e?void 0:e.removeAll)&&Nt.highlightIds.removeAll();const o=t.map(e=>parseInt(e.getId()));Nt.highlightIds.addMany(o)}},[R,Nt,It]),d.React.useEffect(()=>{Nt&&It&&se&&0===(null==Ne?void 0:Ne.length)&&(Nt.filterBySelectionEnabled=!1,Ut(),ce(!se))},[Nt,It,se,Ne,Ut]),d.React.useEffect(()=>{Q||oe(null==D?void 0:D.asMutable({deep:!0}))},[Q,D]),d.React.useEffect(()=>{(!ae||ne.findIndex(e=>e.id===ae)<0)&&ne.length>0&&ie(ne[0].id)},[ne,ae]),d.React.useEffect(()=>{Re(A&&L)},[A,L]),d.React.useEffect(()=>{const e=(null==y?void 0:y.settingChangeTab)||!1,t=null==y?void 0:y.activeTabId;e&&t&&ae!==t&&((0,d.getAppStore)().dispatch(d.appActions.widgetStatePropChange(p,"settingChangeTab",!1)),Wt(t))},[y,ae,pt,p,Wt]),d.React.useEffect(()=>{Vt&&!Tt&&It&&It.updateQueryParams(dt,p)},[It,p,Vt,Tt]),d.React.useEffect(()=>{Lt&&Qe.current&&setTimeout(()=>{qt()},300)},[Lt,It,qt]);const Yt=d.React.useCallback(e=>{var t,o;if(!Ot.getDataSource(null==It?void 0:It.id))return;let n=!1;const l=Object.values(ft),a=null==m?void 0:m[0],i=l.find(e=>"EXTENT_CHANGE"===e.messageType&&e.widgetId===a);if(i){(i.actions||[]).find(e=>((null==e?void 0:e.config)||[]).findIndex(e=>e.actionUseDataSource.dataSourceId===It.id)>-1)&&(n=!0)}if(n)return;const r=null===(o=null===(t=It.getInfo())||void 0===t?void 0:t.widgetQueries)||void 0===o?void 0:o[p];let s;e?s=Object.assign(Object.assign({},r),{geometry:e.toJSON()}):(s=Object.assign({},r),delete s.geometry),It.updateQueryParams(s,p)},[Ot,It,p,ft,m]),Kt=d.React.useCallback(()=>{Nt&&(Nt.filterGeometry=null)},[Nt]),Xt=d.lodash.debounce(({width:e,height:t})=>{(e=>{const t=A?360:320;e<st[0]?ve(!0):ve(!1),he(e<t),me(e<430),be(e)})(e)},200),Zt=()=>{Nt&&Nt.refresh()},eo=0===ne.length,to=St&&(0,c.jsx)(Je,{usedState:zt,curLayerConfig:St,usedConfig:Et,dataSource:It,dsSelection:Ne,isMapMode:Q,arrangeType:I,enableMapExtentFilter:A,widgetId:p,enableDataAction:ht,getInitFields:()=>{var e;const t=[],o=ne.find(e=>e.id===ae);if(!o)return t;const{tableFields:n,allFields:l,layerHonorMode:i}=o;if(i===a.Webmap&&It){const o=null===(e=null==It?void 0:It.getPopupInfo)||void 0===e?void 0:e.call(It);if(o){const e=o.fieldInfos||[];for(const o of e)t.push({value:o.fieldName,label:o.label})}else for(const e of l)t.push({value:e.name,label:e.alias})}else for(const e of n)e.visible&&t.push({value:e.name,label:e.alias});return t},onShowSelection:()=>{se?(Nt.filterBySelectionEnabled=!1,Ut()):Nt.filterBySelectionEnabled=!0,ce(!se)},resetTable:()=>{se&&(Ut(),ce(!1)),d.MessageManager.getInstance().publishMessage(new d.DataRecordsSelectionChangeMessage(p,[],[It.id])),setTimeout(()=>{It.clearSelection(),Nt&&(Nt.highlightIds.removeAll(),se&&(Nt.filterBySelectionEnabled=!1))},500)},onTableRefresh:Zt,onDeleteSelection:()=>{Nt&&Nt.deleteSelection(!0)},onValueChangeFromRuntime:e=>{var t;e||(e=[]);const{columnsVisibleFields:o}=((e,t)=>{const o=[],n=[];return null==e||e.forEach(e=>{const l=e.name||e.fieldName,a=e.effectiveLabel||e.alias||e.fieldName;o.push({value:l,label:a});const i=null==t?void 0:t.find(e=>e.jimuName===l||e.name===l);(i?i.visible:!e.hidden)&&n.push({value:l,label:a})}),{columnsAllFields:o,columnsVisibleFields:n}})(null===(t=null==Nt?void 0:Nt.columns)||void 0===t?void 0:t.toArray());V(ye||o,e,"value").forEach(e=>{Nt.toggleColumnVisibility(e.value)}),Se(e)},toggleMapFilter:()=>{Re(!je)}});return(0,c.jsxs)(d.React.Fragment,{children:[eo&&(0,c.jsx)(S.WidgetPlaceholder,{icon:it(),name:vt("_widgetLabel"),"data-testid":"tablePlaceholder"}),(0,c.jsxs)(S.Paper,{shape:"none",className:bt,css:N(U,ue,Tt,eo,Pt),ref:et,children:[(0,c.jsx)("div",{className:"h-100",children:(0,c.jsxs)("div",{className:"table-indent",children:[ne&&ae&&(0,c.jsx)(w,{allLayersConfig:ne,isHorizontalTab:yt,activeTabId:ae,searchOn:Tt,toolListNode:to,onTabClick:Wt,onCloseTab:(e,t)=>{t&&t.stopPropagation(),Se(void 0);const o=null==j?void 0:j.viewInTableObj;delete o[e],delete Ue.current[e],d.MutableStoreManager.getInstance().updateStateValue(p,"viewInTableObj",o),e===ae&&ie(ne[0].id)}}),(0,c.jsxs)("div",{className:yt?"horizontal-render-con":"dropdown-render-con",children:[St&&Tt&&(0,c.jsx)(q,{searchToolTowed:pe,curLayerConfig:St,dataSource:It,tableLoaded:Lt,widgetState:R,toolListNode:to,handleSubmit:Gt}),Te&&(0,c.jsx)(K,{searchOn:Tt,notReady:Ie,dataSourceLabel:null==It?void 0:It.getLabel(),widgetLabel:Rt,isSelectionView:(null==It?void 0:It.dataViewId)===ct}),(0,c.jsx)("div",{className:"table-con",ref:We}),(0,c.jsxs)("div",{className:"table-bottom-info",children:[(0,c.jsx)(ee,{table:Nt,showCount:null==Et?void 0:Et.showCount,onSelectedChange:e=>{we(e)}}),(void 0===(null==St?void 0:St.updateText)||St.updateText)&&(Me||Ee>0)&&(0,c.jsx)(re,{showLoading:Me,interval:Ee,isMobile:ue,bottomResponsive:ge,refreshTime:Be})]}),Q&&(0,c.jsx)(Ye,{widgetId:p,useMapWidgetIds:m,mapViewsConfig:E,mapFilterEnabled:je,onUpdateViewExtent:Yt,onRestTableGeometry:Kt,onLayersConfigChange:Ht,onViewChange:_t}),(0,c.jsx)(tt,{widgetId:p,curLayerConfig:St,isSelfEditing:at,onUpdateLayerInfo:e=>{if(!e||!ae||!St)return;const{notReady:t,emptyTable:o,showLoading:n,interval:l,selectedRecords:a,selectionViewIds:i,maxCount:r,sourceVersion:s,refreshTime:c}=e;Ce(t),Oe(o),De(n),Ae(l),Le(a),Pe(i),Ve(r),$e(s),He(c)},onTimeExtentChange:e=>{var t,o;const n=null==Nt?void 0:Nt.layer;if(e){const l=d.dataSourceUtils.changeJimuTimeToJSAPITimeExtent(e),a=null==n?void 0:n.timeExtent;!((null==e?void 0:e[0])===(null===(t=null==a?void 0:a.start)||void 0===t?void 0:t.getTime())&&(null==e?void 0:e[1])===(null===(o=null==a?void 0:a.end)||void 0===o?void 0:o.getTime()))&&n&&(n.timeExtent=l)}else n&&(n.timeExtent=null)},onGdbVersionChange:e=>{Nt.layer.gdbVersion=e,Zt()},onSourceVersionChange:()=>rt(void 0,void 0,void 0,function*(){if(It&&!It.url){const e=It;if(null==Nt?void 0:Nt.layer){const t=yield null==e?void 0:e.createJSAPILayerByDataSource();Nt.layer=t}}}),onBelongToSourceVersionChange:()=>rt(void 0,void 0,void 0,function*(){if(It&&!It.url){const e=It;if(null==Nt?void 0:Nt.layer){const t=yield null==e?void 0:e.createJSAPILayerByDataSource();Nt.layer=t}}else qt(),Zt()}),onNeedRefresh:()=>{Zt()},onWidgetQueryChange:()=>{(null==Nt?void 0:Nt.layer)?qt():Qe.current=!0}}),(0,c.jsx)(g.Global,{styles:Xe(U)})]})]})}),(0,c.jsx)(d.ReactResizeDetector,{targetRef:et,handleWidth:!0,handleHeight:!0,onResize:Xt})]})]})};ut.versionManager=v;const vt=ut;function pt(e){p.p=e}})(),h})())}}});