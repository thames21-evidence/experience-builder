System.register(["jimu-core","jimu-arcgis"],function(e,t){var i={},o={};return{setters:[function(e){i.Immutable=e.Immutable,i.dataSourceUtils=e.dataSourceUtils},function(e){o.mapViewUtils=e.mapViewUtils}],execute:function(){e((()=>{var e={62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,s),a.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var a={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(a),s.d(a,{default:()=>o});var e=s(79244),t=s(62686);const i=(0,e.Immutable)([]);class o{constructor(){this.id="table-app-config-operation"}afterWidgetCopied(o,s,a,r,n){var u,l;if(!n)return r;let c=r;const d=s.widgets[o],g=null!==(u=d.useDataSources)&&void 0!==u?u:i,f=null==d?void 0:d.config;if(f.mapViewsConfig){let i=(0,e.Immutable)({});for(const[o,s]of Object.entries(f.mapViewsConfig)){const a=(s.customJimuLayerViewIds||(0,e.Immutable)([])).map(e=>t.mapViewUtils.getCopiedJimuLayerViewId(n,e)),r=s.set("customJimuLayerViewIds",a),u=t.mapViewUtils.getCopiedJimuMapViewId(n,o);i=i.set(u,r)}c=c.setIn(["widgets",a,"config","mapViewsConfig"],i)}const m=g.filter(e=>!!n[e.mainDataSourceId]);if(!m||0===(null==m?void 0:m.length))return c;const p=c.widgets[o],S=null==p?void 0:p.useDataSources,w=e.dataSourceUtils.mapUseDataSources(n,S);w.isChanged&&(c=c.setIn(["widgets",a,"config","useDataSources"],w.useDataSources));const v=null===(l=null==p?void 0:p.config)||void 0===l?void 0:l.layersConfig;return null==v||v.forEach((t,i)=>{var o;const s=null==t?void 0:t.useDataSource,r=e.dataSourceUtils.mapUseDataSources(n,(0,e.Immutable)([s]));if(r.isChanged){const e=(null===(o=r.useDataSources)||void 0===o?void 0:o[0])||s,n=t.id.replace(s.dataSourceId,e.dataSourceId);c=c.setIn(["widgets",a,"config","layersConfig",i,"useDataSource"],e),c=c.setIn(["widgets",a,"config","layersConfig",i,"id"],n)}}),c}useDataSourceWillChange(e,t){const i=e.widgets[this.widgetId];let o=e,s=i;const a=i.config,n=a.layersConfig,u=n.filter(e=>r(e.useDataSource,t));n.length!==u.length&&(s=s.setIn(["config","layersConfig"],u));for(const[e,i]of Object.entries(a.mapViewsConfig||{})){const o=i.layersConfig,a=o.filter(e=>r(e.useDataSource,t));o.length!==a.length&&(s=s.setIn(["config","mapViewsConfig",e,"layersConfig"],a))}return s!==i&&(o=o.setIn(["widgets",this.widgetId],s)),o}}const r=(e,t)=>![null==e?void 0:e.dataSourceId,null==e?void 0:e.rootDataSourceId].includes(t)})(),a})())}}});