System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-for-builder","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-theme","jimu-layouts/layout-runtime","jimu-ui/advanced/style-setting-components","jimu-ui/basic/color-picker"],function(e,t){var a={},i={},l={},n={},o={},s={},r={},c={},d={},u={},m={},g={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){i.CONSTANTS=e.CONSTANTS,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.JSAPILayerTypes=e.JSAPILayerTypes,i.JimuFieldType=e.JimuFieldType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ServiceManager=e.ServiceManager,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.hooks=e.hooks,i.polished=e.polished},function(e){l.Alert=e.Alert,l.AlertPopup=e.AlertPopup,l.Button=e.Button,l.Checkbox=e.Checkbox,l.CollapsablePanel=e.CollapsablePanel,l.ConfirmDialog=e.ConfirmDialog,l.DistanceUnits=e.DistanceUnits,l.Icon=e.Icon,l.Label=e.Label,l.Loading=e.Loading,l.LoadingType=e.LoadingType,l.NumericInput=e.NumericInput,l.PanelHeader=e.PanelHeader,l.Radio=e.Radio,l.Select=e.Select,l.Switch=e.Switch,l.TextInput=e.TextInput,l.Tooltip=e.Tooltip,l.defaultMessages=e.defaultMessages},function(e){n.LayerSetting=e.LayerSetting,n.MapWidgetSelector=e.MapWidgetSelector,n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection,n.SidePopper=e.SidePopper},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.builderAppSync=e.builderAppSync},function(e){r.List=e.List,r.Tree=e.Tree,r.TreeAlignmentType=e.TreeAlignmentType,r.TreeItemActionType=e.TreeItemActionType},function(e){c.DataSourceSelector=e.DataSourceSelector,c.FieldSelector=e.FieldSelector,c.FieldSelectorWithFullTextIndex=e.FieldSelectorWithFullTextIndex,c.dataComponentsUtils=e.dataComponentsUtils},function(e){d.useTheme=e.useTheme,d.useTheme2=e.useTheme2},function(e){u.defaultMessages=e.defaultMessages},function(e){m.FontStyle=e.FontStyle,m.InputUnit=e.InputUnit},function(e){g.ThemeColorPicker=e.ThemeColorPicker}],execute:function(){e((()=>{var e={778:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.829 2.535a.909.909 0 0 0-1.657 0L2.291 13.356a.456.456 0 0 0 .831.377L4.818 10h6.365l1.696 3.733a.456.456 0 0 0 .831-.377zM5.272 9 8 3l2.729 6z" clip-rule="evenodd"></path></svg>'},1888:e=>{"use strict";e.exports=d},4108:e=>{"use strict";e.exports=s},8377:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iMzgiIGhlaWdodD0iOCIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTQiIHk9IjE0IiB3aWR0aD0iMjgiIGhlaWdodD0iNCIgZmlsbD0iIzE4MTgxOCIvPg0KPHBhdGggZD0iTTQ0IDE1SDQ4TDQ2IDE3TDQ0IDE1WiIgZmlsbD0iIzE4MTgxOCIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},13089:e=>{"use strict";e.exports=c},14321:e=>{"use strict";e.exports=l},15562:e=>{"use strict";e.exports=m},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},26490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.154 3.154a.527.527 0 0 1 .746 0l1.317 1.317A8.6 8.6 0 0 1 8 4c2.667 0 5.667 1.333 7 4-.696 1.393-1.847 2.422-3.168 3.087l1.014 1.013a.527.527 0 1 1-.746.746l-1.317-1.317A8.6 8.6 0 0 1 8 12c-2.667 0-5.667-1.333-7-4 .696-1.393 1.847-2.422 3.168-3.087L3.154 3.9a.527.527 0 0 1 0-.746m1.698 2.443C3.726 6.087 2.782 6.882 2 8c1.422 2.033 3.382 3 6 3a8.7 8.7 0 0 0 2.03-.225l-.675-.674A2.5 2.5 0 0 1 5.9 6.644zm6.296 4.805C12.275 9.913 13.218 9.119 14 8c-1.422-2.033-3.382-3-6-3q-1.088 0-2.03.225l.675.674a2.5 2.5 0 0 1 3.457 3.456zM6.5 8c0-.221.048-.431.134-.62l1.987 1.986A1.5 1.5 0 0 1 6.5 8m.88-1.366 1.986 1.987a1.5 1.5 0 0 0-1.987-1.987" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},41496:e=>{"use strict";e.exports=u},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},54337:e=>{"use strict";e.exports=g},62686:e=>{"use strict";e.exports=o},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=a},73529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 12c-2.667 0-5.667-1.333-7-4 1.333-2.667 4.333-4 7-4s5.667 1.333 7 4c-1.333 2.667-4.333 4-7 4m0-7c-2.618 0-4.578.967-6 3 1.422 2.033 3.382 3 6 3s4.578-.967 6-3c-1.422-2.033-3.382-3-6-3m0 5.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0-1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},79226:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iODUiIGhlaWdodD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iMTYiIGhlaWdodD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTIiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMzAiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNDgiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=n},98640:e=>{"use strict";e.exports=r}},t={};function p(a){var i=t[a];if(void 0!==i)return i.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,p),l.exports}p.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return p.d(t,{a:t}),t},p.d=(e,t)=>{for(var a in t)p.o(t,a)&&!p.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p.p="";var I={};return p.p=window.jimuConfig.baseUrl,(()=>{"use strict";p.r(I),p.d(I,{__set_webpack_public_path__:()=>ke,default:()=>ze});var e,t,a,i,l,n,o,s,r,c=p(67386),d=p(79244),u=p(14321),m=p(79298),g=p(62686);!function(e){e.Layer="LAYER",e.Map="MAP"}(e||(e={})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(t||(t={})),function(e){e.Beginning="beginning",e.End="end"}(a||(a={})),function(e){e.Start="start",e.Center="center",e.End="end"}(i||(i={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(l||(l={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(n||(n={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(o||(o={})),function(e){e.Scroll="SCROLL",e.Multiple="MULTIPLE"}(s||(s={})),function(e){e.View="VIEW",e.Add="ADD"}(r||(r={}));const h={newSheet:"New sheet",sheetStyle:"Arrangement style",layerConfig:"Sheet configuration",enableAttachments:"Show attachments",enableSearch:"Search",searchFields:"Select searching fields",fullMatch:"Exact match",allowCsv:"Allow exporting to CSV",enableSelect:"Select records",enableEdit:"Allow editing",showCount:"Show record count",enableRefresh:"Refresh",enableShowHideColumn:"Show/hide columns",configFields:"Configure fields",freezeFields:"Freeze field",freezeLocation:"Freeze location",dropdown:"Dropdown",configTips:"Select fields for initial display",tableBlankStatus:'Click the "{SheetString}" button to add and configure data sheets.',selectFields:"Select fields",checkAll:"Check all",uncheckAll:"Uncheck all",editable:"Editable",editableCount:"{count} Editable",tableOptions:"Table options",columnSize:"Column sizing",beginning:"Beginning",fitToData:"Fit to data",columnWidth:"Column width",updateText:"Last update text",layerHonorSetting:"Use layer settings",layerCustomize:"Customize",enableDelete:"Delete records",noMapSelectedTips:"Select a map for further configurations.",changeModeConfirmTitle:"Are you sure you want to switch the mode?",changeModeConfirmTips:"You will lose the settings configured.",enableMapExtentFilter:"Filter by map extent",enableHighlightOnHover:"Highlight map features on hover",enableRelatedRecords:"Show related data",selectLayers:"Select layers",enableSyncVisibilities:"Synchronize with layer visibilities",displayRuntimeLayers:"Display layers generated at runtime",overrideGeneralSettings:"Override general settings",tableLayerLabel:"Layer label",tableSearchHint:"Layer search hint",respectMapRangeLabel:"Respect layer visible range",deleteOptionTips:"The delete records feature is available only to users with editing privileges.",tableAction_OpenInSameTab:"Open in the same sheet"};var b=p(4108),f=p(23662),S=p.n(f),v=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};const y=e=>{const t=window.SVG,{className:a}=e,i=v(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",a);return t?(0,c.jsx)(t,Object.assign({className:l,src:S()},i)):(0,c.jsx)("svg",Object.assign({className:l},i))};var D=p(98640),j=p(62838),x=p.n(j);const M={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:D.TreeItemActionType.RenderOverrideItem,children:[{name:D.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:D.TreeItemActionType.RenderOverrideItemContent,children:[{name:D.TreeItemActionType.RenderOverrideItemBody,children:[{name:D.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:D.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:D.TreeItemActionType.RenderOverrideItemDragHandle},{name:D.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:D.TreeItemActionType.RenderOverrideItemIcon},{name:D.TreeItemActionType.RenderOverrideItemTitle},{name:D.TreeItemActionType.RenderOverrideItemDetailToggle},{name:D.TreeItemActionType.RenderOverrideItemCommands}]}]},{name:D.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]}]})},w=(0,d.Immutable)([d.DataSourceTypes.FeatureLayer,d.DataSourceTypes.SceneLayer,d.DataSourceTypes.BuildingComponentSubLayer,d.DataSourceTypes.OrientedImageryLayer,d.DataSourceTypes.ImageryLayer,d.DataSourceTypes.SubtypeSublayer]),C=(0,d.Immutable)([d.DataSourceTypes.WebMap,d.DataSourceTypes.WebScene,d.DataSourceTypes.MapService,d.DataSourceTypes.FeatureService,d.DataSourceTypes.SceneService,d.DataSourceTypes.GroupLayer,d.DataSourceTypes.BuildingGroupSubLayer,d.DataSourceTypes.BuildingSceneLayer,d.DataSourceTypes.SubtypeGroupLayer]),T=(e,t,a,s)=>{var r,c,u;const m=e.getSchema(),g=null==e?void 0:e.getLayerDefinition(),p=(null==m?void 0:m.fields)?Object.values(null==m?void 0:m.fields):[],I=(null==g?void 0:g.fields)||[];let h=p.map(e=>{const t=I.find(t=>t.name===e.jimuName),a=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:a,editable:a,visible:!0})});const b=null===(r=null==e?void 0:e.getPopupInfo())||void 0===r?void 0:r.fieldInfos;if("output"!==e.dataViewId&&b&&(null==b?void 0:b.length)>0){const e=[];b.forEach(t=>{(null==t?void 0:t.visible)&&e.push(t.fieldName)}),h=h.filter(t=>e.includes(t.name))}(null==h?void 0:h.length)>50&&(h=h.slice(0,50));const f=s||e,S={dataSourceId:f.id,mainDataSourceId:null===(c=f.getMainDataSource())||void 0===c?void 0:c.id,dataViewId:f.dataViewId,rootDataSourceId:null===(u=f.getRootDataSource())||void 0===u?void 0:u.id},v=(0,d.Immutable)(S),y=h.map(e=>e.jimuName),D=v.set("fields",y);return{id:t?e.id:a?a(e.id):e.id,name:e.getLabel(),useDataSource:D.asMutable({deep:!0}),allFields:p,tableFields:h,overrideGeneralSettings:!1,enableAttachments:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:[],enableRefresh:!0,enableShowHideColumn:!0,enableSelect:!0,enableDelete:!1,selectMode:l.Single,showCount:!0,headerFontSetting:{backgroundColor:"",fontSize:14,bold:!1,color:""},columnSetting:{responsiveType:o.Fixed,columnWidth:200,wrapText:!1,textAlign:i.Start},layerHonorMode:n.Webmap}},N=[d.JSAPILayerTypes.FeatureLayer,d.JSAPILayerTypes.SceneLayer,d.JSAPILayerTypes.BuildingComponentSublayer,d.JSAPILayerTypes.OrientedImageryLayer,d.JSAPILayerTypes.ImageryLayer,d.JSAPILayerTypes.SubtypeSublayer];const R=e=>d.DataSourceManager.getInstance().getDataSource(e),z=e=>{const t=(null==e?void 0:e.type)===d.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===d.DataSourceTypes.BuildingComponentSubLayer;null==e||e.type,d.DataSourceTypes.OrientedImageryLayer,null==e||e.type,d.DataSourceTypes.ImageryLayer;let a;return a=t?e.getAssociatedDataSource():e,a};const k=e=>{var t,a,i;const l=null==e?void 0:e.getSchema(),n=(null==l?void 0:l.fields)?Object.values(null==l?void 0:l.fields):[],o=null==e?void 0:e.getLayerDefinition(),s=(null===(t=null==o?void 0:o.fields)||void 0===t?void 0:t.length)>0?o.fields:n,r=null===(a=null==e?void 0:e.getPopupInfo)||void 0===a?void 0:a.call(e),c=(null==r?void 0:r.fieldInfos)||[],d=Object.keys((null==l?void 0:l.fields)||{}),u=c.filter(e=>d.includes(e.fieldName)),m=((e,t)=>{let a=[];const i=Object.keys(e||{});return(null==t?void 0:t.length)>=(null==i?void 0:i.length)?a=t.filter(e=>i.includes(e.name||e.alias)).map(t=>{var a;return Object.assign(Object.assign({},t),{format:null===(a=null==e?void 0:e[t.name])||void 0===a?void 0:a.format})}):i.forEach(i=>{const l=e[i],n=t.find(e=>e.name===i);a.push(Object.assign(Object.assign({},l),n))}),a})(null==l?void 0:l.fields,s),g=(null===(i=null==r?void 0:r.fieldInfos)||void 0===i?void 0:i.length)>0,p=[];return d.forEach(e=>{if(g){!u.find(t=>t.fieldName===e)&&p.push(e)}else{!m.find(t=>(t.name||t.alias)===e)&&p.push(e)}}),{hasPopup:g,honorUsedFields:g?u:m,honorHiddenFields:p}},P=e=>{const{layersConfig:t,activeIndex:a,failedDataSourceIds:i,onRemove:l,onSort:n,onClick:o}=e,s=d.hooks.useTranslation(u.defaultMessages,d.defaultMessages),r=t.length,g=d.React.useMemo(()=>t.asMutable({deep:!0}).map((e,t)=>({itemStateDetailContent:e,itemKey:e.id,itemStateTitle:e.name,itemStateChecked:t===a,itemStateCommands:[{label:s("remove"),iconProps:()=>({icon:x(),size:12}),action:()=>{l(e.id)}}]})),[a,t,l,s]),p=d.React.useMemo(()=>(0,c.jsx)(u.Alert,{variant:"text",form:"tooltip",size:"small",type:"error",text:s("dataSourceCreateError")}),[s]),I=d.React.useCallback((e,t)=>{var a,l;const{itemJsons:n}=t.props,[o]=n,s=null===(l=null===(a=null==o?void 0:o.itemStateDetailContent)||void 0===a?void 0:a.useDataSource)||void 0===l?void 0:l.dataSourceId;return i.includes(s)||!R(s)?p:null},[p,i]),h=d.React.useCallback((e,t)=>{if("handleDidDrop"===e.updateType){const t=e.targetDropItemChildren.map(e=>e.itemKey);n(t)}},[n]),b=d.React.useCallback((e,t)=>{const{itemJsons:[a]}=t.props;o(a.itemKey)},[o]),f=d.React.useMemo(()=>[{itemStateDetailContent:"......",itemKey:`${a}`,itemStateTitle:"......",itemStateChecked:!0,itemStateCommands:[]}],[a]);return(0,c.jsxs)(m.SettingRow,{className:"setting-ui-unit-list",css:d.css`
    display: block !important;
    &.setting-ui-unit-list {
      width: 100%;
      .tree-item {
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        &.tree-item_level-1 {
        }
        .jimu-checkbox {
          margin-right: 8px;
        }
      }
      .setting-ui-unit-list-new {
        padding-top: 4px;
      }
    }
  `,children:[r>0&&(0,c.jsx)(D.List,Object.assign({className:"w-100",itemsJson:g,dndEnabled:!0,renderOverrideItemDetailToggle:I,onUpdateItem:h,onClickItemBody:b},M)),r===a&&(0,c.jsx)(D.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:f,dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},M))]})};var O=p(13089),L=p(1888),A=p(73529),W=p.n(A),H=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};const B=e=>{const t=window.SVG,{className:a}=e,i=H(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",a);return t?(0,c.jsx)(t,Object.assign({className:l,src:W()},i)):(0,c.jsx)("svg",Object.assign({className:l},i))};var E=p(26490),F=p.n(E),Y=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};const J=e=>{const t=window.SVG,{className:a}=e,i=Y(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",a);return t?(0,c.jsx)(t,Object.assign({className:l,src:F()},i)):(0,c.jsx)("svg",Object.assign({className:l},i))},Q="root item for tree data entry",K=e=>d.css`
    .fields-list-header {
      background: ${e.ref.palette.neutral[300]};
      border-bottom: 1px solid ${e.ref.palette.neutral[600]};
      height: 34px;
      width: 100%;
      flex-wrap: nowrap;
      .jimu-checkbox {
        margin-top: 2px;
      }
      .fields-list-check {
        margin-left: 18px;
      }
    }
    .selected-fields-con{
      margin-top: 0 !important;
      .selected-fields-list {
        flex: 1;
        max-height: 300px;
        overflow-y: auto;
        .jimu-tree-item_disabled-true .jimu-tree-item__droppable {
          background: unset;
        }
      }
      .jimu-tree-item{
        background: ${e.ref.palette.neutral[300]};
        border-bottom: 1px solid ${e.ref.palette.neutral[400]};
        .jimu-tree-item__content{
          div:first-of-type{
            padding-left: 2px;
          }
          .jimu-tree-item__body{
            background: ${e.ref.palette.neutral[300]};
            .jimu-tree-item__title{
              .jimu-input{
                width: 125px;
              }
            }
            .item-remove-button {
              padding: 0 2px; /** consistent with detail icon from tree. */
            }
            &:hover {
              background: none !important;
            }
          }
        }
      }
    }
  `,G=(e,t)=>{let a=!1;for(const i of e)if(i.jimuName===t.jimuName){a=!0;break}return a},V=e=>{const{layerConfig:t,layerDefinition:i,isEditableDs:l,onChange:o}=e,{enableEdit:s,useDataSource:r,searchFields:g,tableFields:p,allFields:I,layerHonorMode:b,isFreezeFields:f=!1,frozenFields:S,freezeLocation:v}=t,[y,j]=d.React.useState(null),x=(0,L.useTheme)(),w=d.hooks.useTranslation(h,u.defaultMessages),C=l,T=((e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)))(null==i?void 0:i.capabilities,"update")&&C,N=d.React.useMemo(()=>p.asMutable({deep:!0}),[p]),z=d.React.useMemo(()=>{let e=0;return null==N||N.forEach(t=>{(null==t?void 0:t.editAuthority)&&e++}),e},[N]),P=d.React.useMemo(()=>N.map(e=>e.jimuName),[N]),A=d.React.useMemo(()=>!!N&&N.some(e=>!e.editAuthority&&e.editable),[N]),W=d.React.useMemo(()=>{if(!N)return!1;const e=N.some(e=>e.editAuthority&&e.editable),t=N.some(e=>!e.editAuthority&&e.editable);return e&&t},[N]),H=d.React.useCallback((e,t)=>{const a=((null==e?void 0:e.fields)||[]).find(e=>e.name===t);return!a||(null==a?void 0:a.editable)},[]),E=d.React.useCallback(e=>{const t=R(null==r?void 0:r.dataSourceId),l=null==t?void 0:t.getSchema(),n=(null==l?void 0:l.fields)?Object.values(null==l?void 0:l.fields):[],o=(e=>{const t=f&&S&&S.length>0?e.findIndex(e=>S.includes(e.jimuName)):-1,l=[];let o;if(e.forEach((e,a)=>{a===t?o={itemKey:e.jimuName,itemStateChecked:!!s&&(null==e?void 0:e.editAuthority),itemStateTitle:e.alias||e.jimuName||e.name,itemStateIcon:O.dataComponentsUtils.getIconFromFieldType(e.type,x),itemStateDetailContent:e,itemStateDisabled:!0,itemStateCommands:[],isCheckboxDisabled:!H(i,e.jimuName)}:l.push({itemKey:e.jimuName,itemStateChecked:!!s&&(null==e?void 0:e.editAuthority),itemStateTitle:e.alias||e.jimuName||e.name,itemStateIcon:O.dataComponentsUtils.getIconFromFieldType(e.type,x),itemStateDetailContent:e,itemStateDisabled:!G(n,e),itemStateCommands:[],isCheckboxDisabled:!H(i,e.jimuName)})}),o){!v||v===a.Beginning?l.unshift(o):l.push(o)}return l})(e);j({itemKey:Q,itemStateTitle:Q,itemChildren:o})},[s,x,null==r?void 0:r.dataSourceId,H,i,f,S,v]);d.React.useEffect(()=>{N&&E(N)},[E,N]);const F=d.React.useCallback(e=>{o(t.set("layerHonorMode",e.target.value))},[t,o]),Y=d.React.useCallback(e=>{const t=e.map(e=>e.jimuName);return g.filter(e=>t.includes(e))},[g]),V=d.React.useCallback(e=>{const t=e.map(e=>e.jimuName);return(null==S?void 0:S.filter(e=>t.includes(e)))||(0,d.Immutable)([])},[S]),Z=d.React.useCallback(e=>{var a;if(!e)return;const l=e.filter(e=>e);let n=N;const s=l.filter(e=>!N.find(t=>t.jimuName===e.jimuName));for(const e of s){const t=((null==i?void 0:i.fields)||[]).find(t=>t.name===e.jimuName),a=null==t?void 0:t.editable;n.push(Object.assign(Object.assign({},e.asMutable({deep:!0})),{editAuthority:a,editable:a,visible:!0}))}const r=N.filter(e=>!l.find(t=>t.jimuName===e.jimuName)).map(e=>e.jimuName);n=n.filter(e=>!r.includes(e.jimuName));const c=Y(n),d=V(n),u=e.map(e=>e.jimuName),m=null===(a=null==t?void 0:t.useDataSource)||void 0===a?void 0:a.set("fields",u);o(t.set("searchFields",c).set("frozenFields",d).set("tableFields",n).set("useDataSource",m)),E(n)},[E,Y,V,N,t,null==i?void 0:i.fields,o]),U=d.React.useCallback(()=>{const e=N;e.forEach(e=>{e.editable&&(e.editAuthority=A)}),o(t.set("tableFields",e)),E(e)},[E,N,A,t,o]),_=d.React.useCallback(e=>{const a=e.target.checked,i=N.map(e=>Object.assign(Object.assign({},e),{editAuthority:e.editable}));o(t.set("enableEdit",a).set("tableFields",i))},[t,N,o]),$=d.React.useCallback(e=>{const a=N.findIndex(t=>t.jimuName===e),i=N[a].visible;N[a].visible=!i,o(t.set("tableFields",N))},[N,t,o]),q=d.React.useCallback((e,t)=>{e&&"Enter"===e.key&&$(t)},[$]),X=d.React.useCallback((e,t)=>{const{itemJsons:a,itemJsons:[{itemStateDetailContent:i}]}=t.props,[l]=a,{jimuName:n}=(null==l?void 0:l.itemStateDetailContent)||{},o=N.find(e=>e.jimuName===n),s=null==o?void 0:o.visible,r=w("visible"),m=w("invisible");return i?(0,c.jsx)(u.Button,{icon:!0,type:"tertiary",title:s?r:m,"aria-label":s?r:m,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),$(n)},onKeyUp:e=>{q(e,n)},css:()=>d.css`
        &.jimu-tree-item__detail-toggle {
          display: flex;
          align-items: center;
          cursor: pointer;

          .icon-btn-sizer {
            margin: 0;
            min-width: 0.5rem;
            min-height: 0.5rem;
          }
        }
      `,children:s?(0,c.jsx)(B,{}):(0,c.jsx)(J,{})}):null},[w,$,q,N]),ee=d.React.useCallback((e,t)=>{var a,i,l;const{draggingItemJsons:n,targetItemJsons:o,dropType:s}=e,r=null===(a=o[0])||void 0===a?void 0:a.itemChildren,c=null===(i=o[Math.min(1,o.length-2)])||void 0===i?void 0:i.itemChildren,d=null===(l=n[0])||void 0===l?void 0:l.itemChildren;let u=!0;return"to-inside"!==s||r&&!d||(u=!1),"to-inside"!==s&&c&&d&&(u=!1),u},[]),te=d.React.useCallback((e,a)=>{var i;const{itemJsons:l,updateType:n}=e;if(s||n===D.TreeItemActionType.HandleDidDrop){const e=l[l.length-1];j(e);const a=null===(i=e.itemChildren)||void 0===i?void 0:i.map(e=>Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked}));o(t.set("tableFields",a))}},[s,t,o]),ae=d.React.useMemo(()=>{if(b===n.Webmap){const e=R(null==r?void 0:r.dataSourceId),{honorHiddenFields:t}=k(e);return t||[]}{const e=[];return I.forEach(t=>{!p.find(e=>e.jimuName===t.jimuName)&&e.push(t.jimuName)}),e}},[null==r?void 0:r.dataSourceId,I,p,b]),ie=d.React.useCallback(e=>{const i=null==e?void 0:e.map(e=>e.jimuName||e.name);if(o(t.set("frozenFields",i)),y){const e=y.itemChildren||[],t=e.findIndex(e=>i.includes(e.itemKey));if(e.forEach(e=>{e.itemStateDisabled=!1}),t>-1){const i=e.splice(t,1)[0];i.itemStateDisabled=!0;!v||v===a.Beginning?e.unshift(i):e.push(i)}j(y)}},[t,o,y,v]);return(0,c.jsxs)(m.SettingSection,{title:w("configFields"),css:K(x),children:[(0,c.jsx)(m.SettingRow,{children:(0,c.jsxs)(u.Select,{size:"sm",className:"w-100",value:b,onChange:F,children:[(0,c.jsx)("option",{value:n.Webmap,children:w("layerHonorSetting")}),(0,c.jsx)("option",{value:n.Custom,children:w("layerCustomize")})]})}),b===n.Custom&&(0,c.jsxs)(d.React.Fragment,{children:[(0,c.jsx)(m.SettingRow,{flow:"wrap",label:w("configTips"),children:(0,c.jsx)(O.FieldSelector,{useDataSources:r?(0,d.Immutable)([r]):(0,d.Immutable)([]),selectedFields:(0,d.Immutable)(P),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,onChange:Z})}),(0,c.jsx)(m.SettingRow,{flow:"wrap",label:s&&w("editableCount",{count:z}),children:(0,c.jsx)("div",{className:"fields-list-header form-inline",children:(0,c.jsxs)("div",{className:"d-flex w-100 fields-list-check",children:[s&&(0,c.jsx)(u.Checkbox,{id:"editAllField","data-field":"editAllField",onClick:U,checked:!A,indeterminate:W,title:A?`${w("editable")} (${w("checkAll")})`:`${w("editable")} (${w("uncheckAll")})`}),(0,c.jsx)(u.Label,{for:"editAllField",style:{cursor:"pointer"},className:"ml-2",title:w("field"),children:w("field")})]})})}),(0,c.jsx)(m.SettingRow,{className:"selected-fields-con",children:(0,c.jsx)(D.Tree,Object.assign({className:"selected-fields-list",rootItemJson:y,treeAlignmentType:D.TreeAlignmentType.Intact,dndEnabled:!0,isMultiSelection:s,renderOverrideItemDetailToggle:X,isItemDroppable:ee,onUpdateItem:te},M))}),T&&(0,c.jsx)(m.SettingRow,{children:(0,c.jsxs)("div",{className:"d-flex w-100",children:[(0,c.jsx)(u.Checkbox,{id:"editable-cb","data-field":"enableEdit",onClick:_,checked:s}),(0,c.jsx)(u.Label,{for:"editable-cb",style:{cursor:"pointer"},className:"ml-2",title:w("enableEdit"),children:w("enableEdit")})]})})]}),(0,c.jsx)(m.SettingRow,{tag:"label",label:(0,c.jsx)("strong",{children:w("freezeFields")}),children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:f,onChange:e=>{o(t.set("isFreezeFields",e.target.checked))},"aria-label":w("freezeFields")})}),f&&(0,c.jsxs)(d.React.Fragment,{children:[(0,c.jsx)(m.SettingRow,{children:(0,c.jsx)(O.FieldSelector,{useDataSources:r?(0,d.Immutable)([r]):(0,d.Immutable)([]),selectedFields:S,hiddenFields:(0,d.Immutable)(ae),isDataSourceDropDownHidden:!0,useDropdown:!0,isSearchInputHidden:!0,noSelectionItem:{name:"None"},onChange:ie})}),(0,c.jsx)(m.SettingRow,{label:w("freezeLocation"),flow:"wrap",role:"group","aria-label":w("freezeLocation"),children:(0,c.jsx)("div",{className:"jimu-builder--background-setting",children:(0,c.jsxs)("div",{role:"radiogroup",children:[(0,c.jsxs)(u.Label,{className:"d-flex align-items-center",children:[(0,c.jsx)(u.Radio,{style:{cursor:"pointer"},name:"responsiveType",className:"mr-2",checked:!v||v===a.Beginning,onChange:()=>{o(t.set("freezeLocation",a.Beginning))}}),w("beginning")]}),(0,c.jsxs)(u.Label,{className:"d-flex align-items-center",children:[(0,c.jsx)(u.Radio,{style:{cursor:"pointer"},name:"displayOrderType",className:"mr-2",checked:v===a.End,onChange:()=>{o(t.set("freezeLocation",a.End))}}),w("end")]})]})})})]})]})};var Z=p(41496),U=p(15562),_=p(54337),$=p(778),q=p.n($),X=p(45508),ee=p.n(X),te=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};const ae=e=>{const t=window.SVG,{className:a}=e,i=te(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",a);return t?(0,c.jsx)(t,Object.assign({className:l,src:ee()},i)):(0,c.jsx)("svg",Object.assign({className:l},i))},ie=e=>d.css`
  &.general-settings-collapsable-area {
    .general-settings-collapse {
      padding-bottom: ${e.sys.spacing(3)};
      border-bottom: 1px solid ${e.sys.color.divider.secondary};
    }
    .jimu-widget-setting--row, .setting-collapse {
      margin-top: 16px;
    }
  }
`,le=e=>{const{isMapMode:t,level:a,config:n,onPropertyChange:s}=e,r="widget"===a,{columnSetting:g,headerFontSetting:p,enableSelect:I,selectMode:b}=n,{textAlign:f,wrapText:S,responsiveType:v,columnWidth:y}=g||{},{fontSize:D,bold:j,backgroundColor:x,color:M}=p||{},[w,C]=d.React.useState(!1),[T,N]=d.React.useState(!1),[R,z]=d.React.useState(!1),[k,P]=d.React.useState(!1),O=(0,L.useTheme)(),A=(0,L.useTheme2)(),W=d.hooks.useTranslation(h,u.defaultMessages,Z.defaultMessages),H=t?["enableRelatedRecords","enableAttachments"]:["enableAttachments"],B=()=>{C(!w)},E=()=>{N(!T)},F=()=>{z(!R)},Y=()=>{P(!k)},J=d.React.useCallback(()=>[(0,c.jsx)("option",{value:i.Start,children:W("start")},i.Start),(0,c.jsx)("option",{value:i.Center,children:W("center")},i.Center),(0,c.jsx)("option",{value:i.End,children:W("end")},i.End)],[W]),Q=d.React.useCallback(()=>[(0,c.jsx)("option",{value:l.Single,children:W("single")},l.Single),(0,c.jsx)("option",{value:l.Multiple,children:W("multiple")},l.Multiple)],[W]),K=d.React.useCallback((e,t)=>{if(g)s("columnSetting",g.setIn([e],t));else{({responsiveType:o.Fixed,columnWidth:200,wrapText:!1,textAlign:i.Start})[e]=t,s("columnSetting",g.setIn([e],t))}},[g,s]),G=d.React.useCallback((e,t)=>{if(p)s("headerFontSetting",p.setIn([e],t));else{const a={backgroundColor:"",fontSize:14,bold:!1,color:""};a[e]=t,s("headerFontSetting",a)}},[p,s]),V=(0,c.jsxs)("div",{className:"w-100 d-flex tip-container",children:[(0,c.jsx)(u.Label,{className:"tip-text",for:"embed-honor-theme-font",title:W("enableDelete"),children:W("enableDelete")}),(0,c.jsx)(u.Tooltip,{title:W("deleteOptionTips"),showArrow:!0,placement:"bottom",children:(0,c.jsx)(u.Button,{icon:!0,type:"tertiary",className:"d-inline jimu-outline-inside",disableHoverEffect:!0,disableRipple:!0,children:(0,c.jsx)(ae,{})})})]}),$=(0,c.jsxs)("div",{className:"general-settings-collapsable-area",css:ie(O),children:[(0,c.jsxs)(u.CollapsablePanel,{role:"group",label:W("col"),isOpen:w,onRequestOpen:B,onRequestClose:B,"aria-label":W("col"),className:"general-settings-collapse",children:[(0,c.jsx)(m.SettingRow,{label:(0,c.jsx)("strong",{children:W("columnSize")}),flow:"wrap",role:"group","aria-label":W("columnSize"),children:(0,c.jsxs)("div",{className:"jimu-builder--background-setting",children:[(0,c.jsxs)("div",{role:"radiogroup",children:[(0,c.jsxs)(u.Label,{className:"d-flex align-items-center",children:[(0,c.jsx)(u.Radio,{style:{cursor:"pointer"},name:"responsiveType",className:"mr-2",checked:v===o.Fit,onChange:()=>{K("responsiveType",o.Fit)}}),W("fitToData")]}),(0,c.jsxs)(u.Label,{className:"d-flex align-items-center",children:[(0,c.jsx)(u.Radio,{style:{cursor:"pointer"},name:"displayOrderType",className:"mr-2",checked:v===o.Fixed,onChange:()=>{K("responsiveType",o.Fixed)}}),W("fixed")]})]}),v===o.Fixed&&(0,c.jsx)(m.SettingRow,{label:W("columnWidth"),children:(0,c.jsx)(U.InputUnit,{style:{width:"35%"},"aria-label":W("columnWidth"),min:80,max:8192,value:{distance:null!=y?y:80,unit:u.DistanceUnits.PIXEL},onChange:({distance:e})=>{K("columnWidth",e)}})})]})}),H.map((e,t)=>{const a=n[e]||!1;return(0,c.jsx)(m.SettingRow,{tag:"label",label:W(e),children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:a,onChange:t=>{s(e,t.target.checked)},"aria-label":W(e)})})})]}),(0,c.jsxs)(u.CollapsablePanel,{role:"group",label:W("variableHeader"),isOpen:T,onRequestOpen:E,onRequestClose:E,"aria-label":W("variableHeader"),className:"general-settings-collapse",children:[(0,c.jsxs)(m.SettingRow,{truncateLabel:!0,flow:"no-wrap",role:"group",label:W("font"),"aria-label":W("font"),className:"mt-2",children:[(0,c.jsx)(U.FontStyle,{"aria-label":W("fontStyle"),bold:j,types:["bold"],onChange:(e,t)=>{G("bold",t)}}),(0,c.jsx)(_.ThemeColorPicker,{icon:q(),type:"with-icon",title:W("fontColor"),"aria-label":W("fontColor"),specificTheme:A,value:M,onChange:e=>{G("color",e)},className:"jimu-outline-inside"}),(0,c.jsx)(U.InputUnit,{style:{width:"35%"},"aria-label":W("fontSize"),min:12,max:99,value:{distance:null!=D?D:14,unit:u.DistanceUnits.PIXEL},onChange:({distance:e})=>{G("fontSize",e)}})]}),(0,c.jsx)(m.SettingRow,{label:W("backgroundColor"),children:(0,c.jsx)(_.ThemeColorPicker,{noBackground:!0,specificTheme:A,"aria-label":W("backgroundColor"),value:x,onChange:e=>{G("backgroundColor",e)}})})]}),(0,c.jsxs)(u.CollapsablePanel,{role:"group",label:W("variableBody"),isOpen:R,onRequestOpen:F,onRequestClose:F,"aria-label":W("variableBody"),className:"general-settings-collapse",children:[(0,c.jsx)(m.SettingRow,{flow:"no-wrap",label:W("textAlign"),className:"select-option",truncateLabel:!0,children:(0,c.jsx)("div",{style:{width:"40%"},children:(0,c.jsx)(u.Select,{size:"sm",value:f||"start",onChange:e=>{K("textAlign",e.target.value)},"aria-label":W("textAlign"),children:J()})})}),(0,c.jsx)(m.SettingRow,{tag:"label",label:W("wrapText"),children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:S,onChange:e=>{K("wrapText",e.target.checked)},"aria-label":W("wrapText")})})]}),(0,c.jsx)(u.CollapsablePanel,{role:"group",label:W("tools"),isOpen:k,onRequestOpen:Y,onRequestClose:Y,"aria-label":W("tools"),children:["enableSelect","enableRefresh","enableDelete","enableShowHideColumn","showCount"].map((e,t)=>{const a=n[e]||!1,i="enableDelete"===e;return(0,c.jsxs)(d.React.Fragment,{children:[(0,c.jsx)(m.SettingRow,{tag:"label",label:i?V:W(e),children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:a,onChange:t=>{s(e,t.target.checked)},"aria-label":W(e)})}),"enableSelect"===e&&I&&(0,c.jsx)(m.SettingRow,{flow:"no-wrap",label:W("selectMode"),className:"select-option",truncateLabel:!0,children:(0,c.jsx)("div",{style:{width:"40%"},children:(0,c.jsx)(u.Select,{size:"sm",value:b||l.Multiple,onChange:e=>{s("selectMode",e.target.value)},"aria-label":W("selectMode"),children:Q()})})})]},t)})})]});return r?(0,c.jsx)(m.SettingSection,{role:"group",className:"general-settings-container",title:W("options"),"aria-label":W("options"),children:$}):$},{useState:ne}=d.React,oe=e=>{const{widgetId:t,layerConfig:a,onChange:i}=e,{enableSearch:l,searchFields:n,searchExact:o,searchHint:s,useDataSource:r}=a,[g,p]=ne(s),I=d.hooks.useTranslation(h,u.defaultMessages,Z.defaultMessages),f=d.React.useCallback(e=>{i(a.set("searchFields",e.map(e=>e.name)))},[a,i]);return(0,c.jsxs)(m.SettingSection,{children:[(0,c.jsx)(m.SettingRow,{tag:"label",label:I("enableSearch"),truncateLabel:!0,children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:l||!1,onChange:e=>{const l=e.target.checked;b.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:t,propKey:"optionChangeSuggestion",value:!0}),i(a.set("enableSearch",l))},"aria-label":I("enableSearch")})}),l&&(0,c.jsxs)(d.React.Fragment,{children:[(0,c.jsx)(m.SettingRow,{flow:"wrap",label:I("searchFields"),children:(0,c.jsx)("div",{className:"w-100 search-container",style:{zIndex:3},children:(0,c.jsx)(O.FieldSelectorWithFullTextIndex,{useDataSources:r?(0,d.Immutable)([r]):(0,d.Immutable)([]),onChange:f,selectedFields:n?(0,d.Immutable)(n):(0,d.Immutable)([]),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,widgetId:t,types:(0,d.Immutable)([d.JimuFieldType.Number,d.JimuFieldType.String]),"aria-label":I("searchFields")})})}),(0,c.jsx)(m.SettingRow,{className:"w-100 d-flex justify-content-between",children:(0,c.jsxs)(u.Label,{children:[(0,c.jsx)(u.Checkbox,{style:{cursor:"pointer"},checked:o,"aria-label":I("fullMatch"),onChange:(e,t)=>{i(a.set("searchExact",t))}}),(0,c.jsx)("div",{className:"m-0 ml-2 flex-grow-1 omit-label",children:I("fullMatch")})]})}),(0,c.jsx)(m.SettingRow,{flow:"wrap",label:I("searchHint"),children:(0,c.jsx)(u.TextInput,{size:"sm",className:"search-placeholder w-100",placeholder:I("search"),value:g||"",onChange:e=>{const t=e.target.value;p(t)},onAcceptValue:e=>{e!==g&&p(e),i(a.set("searchHint",e))},"aria-label":I("searchHint")})})]})]})};var se=p(28996),re=p.n(se),ce=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};const de=e=>{const t=window.SVG,{className:a}=e,i=ce(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",a);return t?(0,c.jsx)(t,Object.assign({className:l,src:re()},i)):(0,c.jsx)("svg",Object.assign({className:l},i))};var ue=function(e,t,a,i){return new(a||(a=Promise))(function(l,n){function o(e){try{r(i.next(e))}catch(e){n(e)}}function s(e){try{r(i.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}r((i=i.apply(e,t||[])).next())})};const me=e=>d.css`
    .layer-config-panel {
      .panel-inner {
        .title {
          max-width: 70%;
        }
      }
      .setting-container {
        height: ${e?"100%":`calc(100% - ${d.polished.rem(58)})`};
        overflow: auto;
      }
    }
  `,ge=e=>{const{widgetId:t,config:a,layerConfig:i,isMapMode:l,layerDefinition:n,isEditableDs:o,isNewAdd:s,handleBatchAdd:r,onConfigSaved:g,getLayerModeConfigId:p,filterDs:I,onChange:b,onClose:f}=e,[S,v]=d.React.useState(""),[y,D]=d.React.useState(null),[j,x]=d.React.useState(!1),M=d.hooks.useTranslation(h,u.defaultMessages),C=d.ReactRedux.useSelector(e=>{var t,a,l,n,o,s;const r=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig,c=null==r?void 0:r.dataSources,d=null===(a=null==i?void 0:i.useDataSource)||void 0===a?void 0:a.dataSourceId;if(!d)return!1;const u=d.indexOf("-");if(u<0)return!1;const m=d.substring(0,u),g=d.substring(u+1),p=(null===(l=null==i?void 0:i.useDataSource)||void 0===l?void 0:l.rootDataSourceId)||m,I=null===(o=null===(n=null==c?void 0:c[p])||void 0===n?void 0:n.childDataSourceJsons)||void 0===o?void 0:o[g];if(!I)return!1;return(null===(s=null==I?void 0:I.query)||void 0===s?void 0:s.refreshInterval)>0}),N=d.ReactRedux.useSelector(e=>{var a,i;const l=null===(a=null==e?void 0:e.appStateInBuilder)||void 0===a?void 0:a.appConfig,n=null===(i=null==l?void 0:l.widgets)||void 0===i?void 0:i[t];return(null==n?void 0:n.useDataSources)||(0,d.Immutable)([])}),R=d.hooks.usePrevious(C);d.React.useEffect(()=>{v((null==i?void 0:i.name)||"")},[null==i?void 0:i.name]),d.React.useEffect(()=>{R&&R!==C&&i&&b(i.set("updateText",C))},[R,C,b,i]);const k=(null==i?void 0:i.useDataSource)&&(null==N?void 0:N.find(e=>{var t;return e.dataSourceId===(null===(t=null==i?void 0:i.useDataSource)||void 0===t?void 0:t.dataSourceId)}))?(0,d.Immutable)([i.useDataSource]):(0,d.Immutable)([]),P=d.React.useCallback(e=>ue(void 0,void 0,void 0,function*(){if((null==e?void 0:e.length)>1){const t=[];for(const[a,i]of e.entries()){0===a&&D((0,d.Immutable)([e[0]]));try{const e=yield d.DataSourceManager.getInstance().createDataSourceByUseDataSource(i),a=(null==e?void 0:e.type)===d.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===d.DataSourceTypes.BuildingComponentSubLayer,n=z(e),o=T(n,l,p,a?e:void 0);t.push(o)}catch(e){console.error(e)}a===e.length-1&&D(null)}r((0,d.Immutable)(t)),g()}else{const t=null==e?void 0:e[0];if(!t)return;const a=i&&d.dataSourceUtils.areDerivedFromSameMain(t.dataSourceId,i.useDataSource.dataSourceId);try{D((0,d.Immutable)(e));const n=yield d.DataSourceManager.getInstance().createDataSourceByUseDataSource(t),o=(null==n?void 0:n.type)===d.DataSourceTypes.SceneLayer||(null==n?void 0:n.type)===d.DataSourceTypes.BuildingComponentSubLayer,s=z(n),r=a?((e,t,a,i)=>{var l,n;const o=i||e,s={dataSourceId:o.id,mainDataSourceId:null===(l=o.getMainDataSource())||void 0===l?void 0:l.id,dataViewId:o.dataViewId,rootDataSourceId:null===(n=o.getRootDataSource())||void 0===n?void 0:n.id},r=(0,d.Immutable)(s),c=t.tableFields.map(e=>e.jimuName),u=r.set("fields",c),m=a?a(e.id):e.id;return Object.assign(Object.assign({},t.asMutable({deep:!0})),{id:m,name:e.getLabel(),useDataSource:u.asMutable({deep:!0})})})(s,i,p,o?n:void 0):T(s,l,p,o?n:void 0);b((0,d.Immutable)(r)),g()}catch(e){console.error(e)}finally{D(null)}}}),[l,i,p,r,b,g]),L=d.React.useCallback(e=>{const t=e.target.value;v(t)},[]),A=d.React.useCallback(e=>{(e=""===(e=null==e?void 0:e.trim())?null==i?void 0:i.name:e)!==S&&v(e),b(i.set("name",e))},[S,i,b]),W=d.React.useCallback(()=>{x(!j)},[j]),H=d.React.useCallback(e=>{if(e){const t=["enableRelatedRecords","enableAttachments","columnSetting","headerFontSetting","enableSelect","selectMode","showCount","enableRefresh","enableDelete","enableShowHideColumn","enableMapExtentFilter","defaultExtentFilterEnabled"].reduce((e,t)=>(t in a&&(e[t]=a[t]),e),{});b(i.merge(t).set("overrideGeneralSettings",e))}else W()},[W,a,i,b]),B=d.css`
    .remind-con {
      padding-left: ${d.polished.rem(25)};
      color: var(--ref-palette-neutral-1100);
      margin-bottom: ${d.polished.rem(60)};
      margin-top: ${d.polished.rem(19)};
      font-size: ${d.polished.rem(13)};
    }
    .modal-body {
      padding: ${d.polished.rem(30)} ${d.polished.rem(30)} 0 ${d.polished.rem(30)};
    }
    .modal-footer {
      padding: 0 ${d.polished.rem(30)} ${d.polished.rem(30)} ${d.polished.rem(30)};
    }
    .remind-title {
      font-size: ${d.polished.rem(16)};
      font-weight: 500;
    }
  `;return(0,c.jsxs)("div",{className:"w-100 h-100",css:me(l),children:[y&&(0,c.jsx)(u.Loading,{type:u.LoadingType.Secondary}),(0,c.jsxs)("div",{className:"w-100 h-100 layer-config-panel",children:[!l&&(0,c.jsx)("div",{className:"w-100 d-flex px-4 py-0",children:(0,c.jsx)(u.PanelHeader,{level:1,className:"px-0 py-4 panel-inner",showClose:!!f,onClose:f,title:M("layerConfig")})}),(0,c.jsxs)("div",{className:"setting-container",children:[(0,c.jsxs)(m.SettingSection,{title:M("data"),className:"pt-0",children:[(0,c.jsx)(m.SettingRow,{children:(0,c.jsx)(O.DataSourceSelector,{types:w,disableRemove:()=>!0,disableDataSourceList:l,hideDataView:l,useDataSources:y||k,mustUseDataSource:!0,onChange:P,closeDataSourceListOnChange:!0,hideDs:I,isMultiple:s,isBatched:!0})}),(y||k)&&C&&(0,c.jsx)(m.SettingRow,{tag:"label",label:M("updateText"),children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:void 0===(null==i?void 0:i.updateText)||i.updateText,onChange:e=>{b(i.set("updateText",e.target.checked))},"aria-label":M("updateText")})})]}),i&&(0,c.jsxs)(d.React.Fragment,{children:[(0,c.jsx)(m.SettingSection,{title:M("label"),children:(0,c.jsx)(m.SettingRow,{children:(0,c.jsx)(u.TextInput,{size:"sm",type:"text",className:"w-100",value:S,onChange:L,onAcceptValue:A,"aria-label":M("label")})})}),(0,c.jsx)(V,{layerConfig:i,layerDefinition:n,isEditableDs:o,onChange:b}),(0,c.jsx)(oe,{widgetId:t,layerConfig:i,onChange:b}),(0,c.jsxs)(m.SettingSection,{role:"group","aria-label":M("overrideGeneralSettings"),children:[(0,c.jsx)(m.SettingRow,{tag:"label",label:M("overrideGeneralSettings"),children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:i.overrideGeneralSettings,onChange:e=>{H(e.target.checked)},"aria-label":M("overrideGeneralSettings")})}),(0,c.jsxs)(u.AlertPopup,{isOpen:j,toggle:W,hideHeader:!0,onClickOk:()=>{b(i.set("overrideGeneralSettings",!1))},onClickClose:W,css:B,children:[(0,c.jsxs)("div",{className:"align-middle pt-2 remind-title d-flex align-items-center","aria-label":M("overrideSettingsTitle"),children:[(0,c.jsx)("div",{className:"mr-1",children:(0,c.jsx)(de,{className:"align-middle",size:"l",color:"var(--sys-color-warning-main)"})}),(0,c.jsx)("span",{className:"align-middle flex-grow-1",children:M("overrideSettingsTitle")})]}),(0,c.jsx)("div",{className:"remind-con",children:M("overrideSettingsRemind")})]}),i.overrideGeneralSettings&&(0,c.jsx)(le,{isMapMode:l,level:"layer",config:i,onPropertyChange:(e,t)=>{b(i.set(e,t))}})]})]})]})]})]})};class pe extends d.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=e=>{this.props.onDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,c.jsx)(d.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var Ie=function(e,t,a,i){return new(a||(a=Promise))(function(l,n){function o(e){try{r(i.next(e))}catch(e){n(e)}}function s(e){try{r(i.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}r((i=i.apply(e,t||[])).next())})};const he="NEW_LAYER_CONFIG_ID",be=e=>{const{widgetId:t,config:a,useDataSources:i,onSettingChange:l}=e,{layersConfig:n}=a,[o,s]=d.React.useState(null),[r,g]=d.React.useState(!1),[p,I]=d.React.useState(!1),[f,S]=d.React.useState([]),[v,D]=d.React.useState({}),j=d.hooks.useTranslation(h,u.defaultMessages)("newSheet"),{OUTPUT_DATA_VIEW_ID:x}=d.CONSTANTS,M=d.React.useRef(null),T=d.React.useRef(null),N=d.React.useMemo(()=>o===he?n.length:n.findIndex(e=>e.id===o),[o,n]),R=d.React.useMemo(()=>{const e=n.find(e=>e.id===o);return(0,d.Immutable)(e)},[o,n]),k=d.React.useMemo(()=>v[o],[o,v]),O=d.React.useCallback((e,t)=>{const a=n.findIndex(t=>t.id===e);let i;i=t?M.current.getElementsByClassName("add-edit-btn")[0]:M.current.getElementsByClassName("jimu-tree-item__body")[a],T.current=i,e!==o||t?(g(!0),s(e)):(g(!1),s(null)),I(t)},[o,n]),L=d.React.useCallback(()=>{O(he,!0)},[O]),A=d.React.useCallback(e=>{O(e,!1),b.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:t,propKey:"activeTabId",value:e}),b.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:t,propKey:"settingChangeTab",value:!0})},[O,t]),W=d.React.useCallback(()=>{g(!1),s(null)},[]),H=d.React.useCallback(e=>{const i=a.layersConfig.filter(t=>t.id!==e);let n=a.set("layersConfig",i);0===i.length&&(n=n.set("description",""));const s=i.map(e=>{var t;return null===(t=e.useDataSource)||void 0===t?void 0:t.asMutable({deep:!0})});l({id:t,config:n,useDataSources:null==s?void 0:s.asMutable({deep:!0})}),e===o&&W()},[o,a,W,l,t]),B=d.React.useCallback(e=>{const i=e.map(e=>n.find(t=>t.id===e));l({id:t,config:a.set("layersConfig",i)})},[a,n,l,t]),E=d.React.useCallback(e=>{const i=N>-1?N:n.length,o=a.setIn(["layersConfig",`${i}`],e),r=[];o.layersConfig.forEach(t=>{const a=r.findIndex(e=>e.dataSourceId===t.useDataSource.dataSourceId);if(a>-1){const t=r[a],i=((e,t)=>{if(!e||!t)return e||t;if(e.dataSourceId&&t.dataSourceId&&e.dataSourceId!==t.dataSourceId)return null;if(!e.dataSourceId&&!t.dataSourceId)return e;if(e.fields&&t.fields){const a=Array.from(new Set(e.fields.asMutable().concat(t.fields.asMutable())));return e.merge(t.asMutable({deep:!0})).set("fields",a)}return e.merge(t.asMutable({deep:!0}))})(e.useDataSource,(0,d.Immutable)(t)).asMutable({deep:!0});r.splice(a,1,i)}else r.push(t.useDataSource.asMutable({deep:!0}))}),l({id:t,config:o,useDataSources:r}),s(e.id)},[N,a,n.length,l,t]),F=d.React.useCallback(e=>{let o=i||(0,d.Immutable)([]);for(const t of e)o=o.concat(t.useDataSource);const r=n.concat(e);l({id:t,config:a.set("layersConfig",r),useDataSources:o.asMutable()}),s(e[0].id)},[i,a,n,t,l]),Y=d.React.useCallback(()=>{I(!1)},[I]),J=d.React.useCallback(e=>{const t=n.length>0?(e=>{const t=e.map(e=>e.id.split("-").reverse()[0]);return t.length>0?Math.max.apply(null,t):0})(n):0;return`${e}-${t+1}`},[n]),Q=d.React.useCallback((e,t)=>Ie(void 0,void 0,void 0,function*(){const a=n.map(e=>e.id);if(t){const a=z(t),i=yield a.createJSAPILayerByDataSource(),l={id:e,dataSource:a,layer:i,layerDefinition:null==a?void 0:a.getLayerDefinition(),layerEditingEnabled:i.editingEnabled,isDsAutoRefresh:(null==a?void 0:a.getAutoRefreshInterval())>0,isEditableDs:(null==a?void 0:a.url)&&(null==a?void 0:a.dataViewId)!==x};D(t=>{var a;const i={};for(const o of n)(null===(a=null==o?void 0:o.useDataSource)||void 0===a?void 0:a.dataSourceId)===e?i[o.id]=l:t[o.id]&&(i[o.id]=t[o.id]);return i})}else S(t=>[...t,e].filter(e=>a.includes(e)))}),[n,x]);return(0,c.jsxs)(d.React.Fragment,{children:[n.map(e=>(0,c.jsx)(pe,{useDataSource:e.useDataSource,onDataSourceCreatedOrFailed:Q},e.id)),(0,c.jsxs)("div",{className:"mt-4",ref:M,children:[(0,c.jsx)(m.SettingRow,{children:(0,c.jsx)(u.Button,{className:"w-100 add-edit-btn",type:"primary",onClick:L,title:j,"aria-label":j,"aria-describedby":"edit-blank-msg",children:(0,c.jsxs)("div",{className:"w-100 px-2 text-truncate",children:[(0,c.jsx)(y,{className:"mr-1 mb-1"}),j]})})}),n.length>0&&(0,c.jsx)(P,{layersConfig:n,activeIndex:N,failedDataSourceIds:f,onRemove:H,onSort:B,onClick:A})]}),(0,c.jsx)(m.SidePopper,{position:"right",isOpen:r,toggle:W,trigger:null==M?void 0:M.current,backToFocusNode:T.current,children:(0,c.jsx)(ge,{widgetId:t,config:a,layerConfig:R,isMapMode:!1,layerDefinition:null==k?void 0:k.layerDefinition,layerEditingEnabled:null==k?void 0:k.layerEditingEnabled,isDsAutoRefresh:null==k?void 0:k.isDsAutoRefresh,isEditableDs:null==k?void 0:k.isEditableDs,isNewAdd:p,handleBatchAdd:F,onConfigSaved:Y,getLayerModeConfigId:J,filterDs:e=>{let t=!1;if(C.includes(e.type)){const a=d.DataSourceManager.getInstance().getDataSource(e.id),i=(a.isDataSourceSet()?a.getAllChildDataSources():[]).filter(e=>w.includes(e.type));0===(null==i?void 0:i.length)&&(t=!0)}return t},onChange:E,onClose:W})})]})};var fe=function(e,t,a,i){return new(a||(a=Promise))(function(l,n){function o(e){try{r(i.next(e))}catch(e){n(e)}}function s(e){try{r(i.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}r((i=i.apply(e,t||[])).next())})};const Se=e=>{var t,a,i,l,o,s,r;const{widgetId:g,config:p,useMapWidgetIds:I,mapEmpty:f,jimuMapViews:S,mapViewsConfig:v,useDataSources:y=(0,d.Immutable)([]),onChange:D}=e,[j,x]=d.React.useState(null),[M,w]=d.React.useState(null),[C,k]=d.React.useState([]),[P,O]=d.React.useState([]),L=d.hooks.useTranslation(u.defaultMessages,h),{OUTPUT_DATA_VIEW_ID:A}=d.CONSTANTS,W=null==I?void 0:I[0],H=d.React.useCallback(e=>fe(void 0,void 0,void 0,function*(){const t=`${W}-${e}`;x(t);const a=S.find(e=>e.id===t),i=a.getAllJimuLayerViews(),l=a.getJimuTables().filter(e=>{var t;return null===(t=e.table)||void 0===t?void 0:t.visible});let n=Object.values(i).filter(e=>!e.fromRuntime&&function(e){if(!e||!e.type)return!1;const t=e.type,a=t!==d.JSAPILayerTypes.BuildingComponentSublayer||t===d.JSAPILayerTypes.BuildingComponentSublayer&&e.view,i=N.includes(t);return a&&i}(e));const o=d.ServiceManager.getInstance(),s=n.map(e=>fe(void 0,void 0,void 0,function*(){const t=yield e.createLayerDataSource();return yield o.fetchArcGISServerInfo(e.layer.url),t?e:null}));try{n=(yield Promise.all(s)).filter(e=>!!e)}catch(e){console.log(e)}var r;a.isActive||(yield(r=500,new Promise(e=>{setTimeout(()=>{e()},r)}))),n=n.filter(e=>!!e.getLayerDataSource()),k(n),O(l)}),[S,W]),B=!!(null===(t=v[j])||void 0===t?void 0:t.customizeLayers),E=void 0===(null===(a=v[j])||void 0===a?void 0:a.displayRuntimeLayers)||(null===(i=v[j])||void 0===i?void 0:i.displayRuntimeLayers),F=d.React.useCallback(e=>{const t=v[j]||(0,d.Immutable)({customizeLayers:!1}),a=y.asMutable({deep:!0});D(j,t.set("displayRuntimeLayers",e),a)},[j,v,y,D]),Y=d.React.useMemo(()=>{const e={};for(const[t,a]of Object.entries(v||{}))a.customizeLayers&&(e[t]=a.customJimuLayerViewIds||(0,d.Immutable)([]));return e},[v]),J=d.React.useMemo(()=>{const e=[];C.forEach(t=>{const a="imagery"===t.type,i=null==t?void 0:t.getLayerDataSource(),l=null==i?void 0:i.getSchema();a&&!(null==l?void 0:l.fields)||e.push(t.id);t.getAllAncestorJimuLayerViews().forEach(t=>{const a="imagery"===t.type,i=null==t?void 0:t.getLayerDataSource(),l=null==i?void 0:i.getSchema();a&&!(null==l?void 0:l.fields)||e.push(t.id)})});const t=S.find(e=>e.id===j);return P.forEach(a=>fe(void 0,void 0,void 0,function*(){const i=a.table,l=t.getDataSourceIdByAPILayer(i),n=d.DataSourceManager.getInstance().getDataSource(l),o=t.getMapDataSource();let s=n;if(!n&&o)try{s=yield o.createDataSourceByLayer(i)}catch(e){console.log(e)}s&&e.push(a.jimuTableId)})),e},[C,P,j,S]),Q=d.React.useCallback(e=>fe(void 0,void 0,void 0,function*(){let t=y.asMutable({deep:!0});const a=S.find(e=>e.id===j),i=v[j]||(0,d.Immutable)({customizeLayers:!1});if(e){const e=C.filter(e=>null==e?void 0:e.isLayerVisible()),l=e.map(e=>e.id),n=P.map(e=>e.jimuTableId),o=l.concat(n),s=[];for(const a of e){if(null==a?void 0:a.fromRuntime)continue;let e;try{e=yield a.getOrCreateLayerDataSource()}catch(e){continue}if(!e)continue;const i=T(e,!0),l="imagery"===a.type,n=null==e?void 0:e.getSchema();if(l&&!(null==n?void 0:n.fields))continue;s.push(i);const o=V(e,!0);t=ve(t,"add",o)}for(const e of P){const i=e.table,l=a.getDataSourceIdByAPILayer(i),n=d.DataSourceManager.getInstance().getDataSource(l),o=a.getMapDataSource();let r=n;if(!n&&o)try{r=yield o.createDataSourceByLayer(i)}catch(e){continue}if(!r)continue;const c=T(r,!0);s.push(c);const u=V(r,!0);t=ve(t,"add",u)}D(j,i.set("customizeLayers",!0).set("customJimuLayerViewIds",o).set("layersConfig",s),t)}else{for(const e of C){let a;try{a=yield e.getOrCreateLayerDataSource()}catch(e){continue}if(!a)continue;const i="imagery"===e.type,l=null==a?void 0:a.getSchema();if(i&&!(null==l?void 0:l.fields))continue;const n=V(a,!0);t=ve(t,"remove",n)}for(const e of P){const i=e.table,l=a.getDataSourceIdByAPILayer(i),n=d.DataSourceManager.getInstance().getDataSource(l),o=a.getMapDataSource();let s=n;if(!n&&o)try{s=yield o.createDataSourceByLayer(i)}catch(e){continue}if(!s)continue;const r=V(s,!0);t=ve(t,"remove",r)}t&&0===t.length&&(t=void 0),D(j,i.set("customizeLayers",!1).set("customJimuLayerViewIds",[]).set("displayRuntimeLayers",!0).set("layersConfig",[]),t)}}),[y,C,P,j,S,v,D]),K=d.React.useCallback(e=>!J.includes(e.id),[J]),G=d.React.useCallback(e=>!C.includes(e),[C]),V=(e,t)=>{var a;return e?Object.assign({dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(a=e.getRootDataSource())||void 0===a?void 0:a.id},t?{useFieldsInPopupInfo:!0}:{}):null},Z=d.React.useCallback(e=>fe(void 0,void 0,void 0,function*(){var t;const a=v[j],i=a.layersConfig,l=S.find(e=>e.id===j),n=e.map(e=>{var t,a;return(null===(t=C.find(t=>t.id===e))||void 0===t?void 0:t.layerDataSourceId)||l.getDataSourceIdByAPILayer(null===(a=P.find(t=>t.jimuTableId===e))||void 0===a?void 0:a.table)});let o=i.filter(e=>n.includes(e.id));const s=e.filter(e=>{var t,a;const n=(null===(t=C.find(t=>t.id===e))||void 0===t?void 0:t.layerDataSourceId)||l.getDataSourceIdByAPILayer(null===(a=P.find(t=>t.jimuTableId===e))||void 0===a?void 0:a.table);return n&&!i.find(e=>e.id===n)}),r=[];for(const e of s){const t=C.find(t=>t.id===e),a=P.find(t=>t.jimuTableId===e);let i;if(t)try{i=yield t.getOrCreateLayerDataSource()}catch(e){console.log(e)}else if(a){const e=l.getDataSourceIdByAPILayer(a.table),t=d.DataSourceManager.getInstance().getDataSource(e),n=l.getMapDataSource();if(i=t,!t&&n)try{i=yield n.createDataSourceByLayer(a.table)}catch(e){console.log(e)}}i&&r.push(T(i,!0))}o=o.concat(r);const c=null===(t=null==a?void 0:a.customJimuLayerViewIds)||void 0===t?void 0:t.asMutable({deep:!0}),{add:u,remove:m,diff:g}=((e,t)=>{const a=[],i=[];return e.forEach(e=>{t.includes(e)||i.push(e)}),t.forEach(t=>{e.includes(t)||a.push(t)}),{add:a,remove:i,diff:a.concat(i)}})(c,e);let p=y.asMutable({deep:!0});for(const e of g){const t=C.find(t=>t.id===e),a=P.find(t=>t.jimuTableId===e);let i;if(t)i=t.getLayerDataSource();else if(a){const e=l.getDataSourceIdByAPILayer(a.table),t=d.DataSourceManager.getInstance().getDataSource(e),n=l.getMapDataSource();i=t,!t&&n&&(i=yield n.createDataSourceByLayer(a.table))}const n=V(i,!0);u.includes(e)?p=ve(p,"add",n):m.includes(e)&&(p=ve(p,"remove",n))}D(j,a.set("customJimuLayerViewIds",e).set("layersConfig",o),p)}),[j,S,C,P,y,v,D]),U=d.React.useCallback((e,t,a)=>{if("layerView"===t){const t=e,a=t.jimuMapViewId,i=v[a].layersConfig,l=null==t?void 0:t.layerDataSourceId,n=i.find(e=>e.id===l);b.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:g,propKey:"activeTabId",value:n.id}),b.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:g,propKey:"settingChangeTab",value:!0})}else if("table"===t){const t=e,i=t.jimuTableId,l=t.table,n=l.id,o=i.substring(0,i.indexOf(n)-1),s=v[o].layersConfig,r=a.getDataSourceIdByAPILayer(l),c=s.find(e=>e.id===r);b.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:g,propKey:"activeTabId",value:c.id}),b.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:g,propKey:"settingChangeTab",value:!0})}},[v,g]),_=d.React.useCallback(e=>{for(const t of S){const a=t.getAllJimuLayerViews(),i=t.getJimuTables(),l=a.find(t=>t.id===e),n=i.find(t=>t.jimuTableId===e);if(l){w(l),U(l,"layerView");break}if(n){w(n),U(n,"table",t);break}}},[S,U]),$=d.React.useCallback((e,t)=>{const a=y.asMutable({deep:!0}),i=S.find(t=>t.id===e),l=i.jimuLayerViews,n=i.jimuTables,o=t.map(e=>{var t;return(null===(t=null==l?void 0:l[e.itemKey])||void 0===t?void 0:t.id)||e.itemKey}),s=t.map(e=>{var t;return(null===(t=null==l?void 0:l[e.itemKey])||void 0===t?void 0:t.layerDataSourceId)||i.getDataSourceIdByAPILayer(null==n?void 0:n[e.itemKey])}),r=v[e].layersConfig.asMutable({deep:!0});r.sort((e,t)=>s.indexOf(e.id)-s.indexOf(t.id));const c=v[e].set("layersConfig",r).set("customJimuLayerViewIds",o);D(e,c,a)},[y,S,v,D]);let q,X;const ee=S.find(e=>{var t;return null===(t=null==M?void 0:M.jimuTableId)||void 0===t?void 0:t.includes(e.id)}),te=(null==M?void 0:M.layerDataSourceId)||(null==ee?void 0:ee.getDataSourceIdByAPILayer(null==M?void 0:M.table)),ae=R(te),ie=z(ae);if(M&&ie)for(const[e,t]of Object.entries(v))if(t.customizeLayers&&(null===(l=t.customJimuLayerViewIds)||void 0===l?void 0:l.includes((null==M?void 0:M.id)||(null==M?void 0:M.jimuTableId)))){const a=(null===(s=null===(o=null==t?void 0:t.layersConfig)||void 0===o?void 0:o.filter(e=>e.id===te))||void 0===s?void 0:s[0])||(0,d.Immutable)(T(ie,!0));q=e,X=a;break}const le=(null==ie?void 0:ie.getAutoRefreshInterval())>0,ne=(null==ie?void 0:ie.url)&&(null==ie?void 0:ie.dataViewId)!==A,oe=null==ie?void 0:ie.getLayerDefinition(),se=null===(r=null==ie?void 0:ie.layer)||void 0===r?void 0:r.editingEnabled,re=d.React.useCallback(e=>{let t=y.asMutable({deep:!0});const a=t.findIndex(t=>{var a;return t.dataSourceId===(null===(a=e.useDataSource)||void 0===a?void 0:a.dataSourceId)});if(e.layerHonorMode===n.Custom){const i=e.tableFields.map(e=>e.jimuName);t[a].fields=i,t[a].useFieldsInPopupInfo=!1}else t[a].fields=[],t[a].useFieldsInPopupInfo=!0;t=ve(t,"update");const i=v[q].layersConfig,l=i.findIndex(e=>e.id===te),o=d.Immutable.set(i,l,e),s=v[q].set("layersConfig",o);D(q,s,t)},[v,q,te,y,D]);return(0,c.jsxs)(m.SettingRow,{children:[(0,c.jsx)(m.LayerSetting,{mapWidgetId:W,mapViewId:j,keepLastTimeMap:!0,onMapItemClick:H,isCustomizeEnabled:B,showRuntimeAddedLayerOption:!0,isShowRuntimeAddedLayerEnabled:E,onShowRuntimeAddedLayersChange:F,selectedValues:Y,hideLayers:K,disableLayers:G,showTable:!0,onToggleCustomize:Q,onSelectedLayerIdChange:Z,showSelectedLayers:!0,dndEnabled:!0,onLayerItemClick:_,onLayerReorder:$,children:(0,c.jsx)(ge,{widgetId:g,config:p,layerConfig:X,isMapMode:!0,layerDefinition:oe,layerEditingEnabled:se,isDsAutoRefresh:le,isEditableDs:ne,onChange:re})}),f&&(0,c.jsx)(u.Alert,{tabIndex:0,type:"warning",fullWidth:!0,open:!0,text:L("noWebMapWebSceneTip")})]})};const ve=(e,t,a)=>{let i=e||[];"remove"===t?i=i.filter(e=>e.dataSourceId!==a.dataSourceId):"add"===t&&a&&!i.find(e=>e.dataSourceId===a.dataSourceId)?i=i.concat([a]):"update"===t&&(i=e);const l="remove"===t?[]:void 0;return i.length>0?i:l},ye=e=>{const{widgetId:t,config:a,useMapWidgetIds:i,mapEmpty:l,jimuMapViews:n,useDataSources:o,onSettingChange:s,onPropertyChange:r}=e,g=(0,d.Immutable)({}),{mapViewsConfig:p=g,respectMapRange:I,enableMapExtentFilter:b,defaultExtentFilterEnabled:f}=a,S=(null==i?void 0:i.length)>0,v=d.hooks.useTranslation(u.defaultMessages,h),y=d.React.useCallback((e,i,l)=>{s({id:t,config:a.setIn(["mapViewsConfig",e],i),useDataSources:l})},[a,s,t]);return(0,c.jsxs)(d.React.Fragment,{children:[(0,c.jsx)(m.SettingRow,{children:(0,c.jsx)(m.MapWidgetSelector,{useMapWidgetIds:i,onSelect:e=>{const i=a.set("mapViewsConfig",{});s({id:t,config:i,useMapWidgetIds:e})}})}),S&&!l&&(0,c.jsx)(Se,{widgetId:t,config:a,useMapWidgetIds:i,mapEmpty:l,mapViewsConfig:p||g,jimuMapViews:n,useDataSources:o,onChange:y}),S&&l&&(0,c.jsx)(m.SettingRow,{children:(0,c.jsx)(u.Alert,{tabIndex:0,type:"warning",className:"warningMsg",open:!0,text:v("noWebMapWebSceneTip")})}),(0,c.jsx)(m.SettingRow,{tag:"label",label:v("respectMapRangeLabel"),children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:I,onChange:e=>{r("respectMapRange",e.target.checked)},"aria-label":v("respectMapRangeLabel")})}),(0,c.jsx)(m.SettingRow,{tag:"label",label:v("enableMapExtentFilter"),children:(0,c.jsx)(u.Switch,{className:"can-x-switch",checked:b,onChange:e=>{r("enableMapExtentFilter",e.target.checked)},"aria-label":v("enableMapExtentFilter")})}),b&&(0,c.jsx)(m.SettingRow,{children:(0,c.jsxs)(u.Label,{className:"d-flex align-items-center ml-2",children:[(0,c.jsx)(u.Checkbox,{checked:f,className:"mr-1",onChange:e=>{r("defaultExtentFilterEnabled",e.target.checked)}}),v("defaultEnabled")]})})]})},De=e=>d.css`
  &.arrange-style-container {
    .arrange_container {
      margin-top: 10px;
      display: flex;
      .jimu-btn {
        padding: 0;
        background: ${e.ref.palette.neutral[300]};
        &.active {
          border: 2px solid ${e.sys.color.primary.light};
        }
      }
      .icon-size {
        width: 109px;
        height: 70px;
      }
    }
  }
`,je=e=>{const{config:a,onPropertyChange:i}=e,{arrangeType:l,pagingStyle:n,pageSize:o}=a,r=(0,L.useTheme)(),g=d.hooks.useTranslation(h,u.defaultMessages);return(0,c.jsxs)(m.SettingSection,{role:"group",className:"arrange-style-container",title:g("sheetStyle"),"aria-label":g("sheetStyle"),css:De(r),children:[(0,c.jsxs)(m.SettingRow,{className:"arrange_container",children:[(0,c.jsx)(u.Tooltip,{title:g("tabs"),placement:"bottom",children:(0,c.jsx)(u.Button,{onClick:()=>{i("arrangeType",t.Tabs)},icon:!0,size:"sm",type:"tertiary",active:l===t.Tabs,"aria-pressed":l===t.Tabs,children:(0,c.jsx)(u.Icon,{autoFlip:!0,className:"icon-size",icon:p(79226)})})}),(0,c.jsx)(u.Tooltip,{title:g("dropdown"),placement:"bottom",children:(0,c.jsx)(u.Button,{onClick:()=>{i("arrangeType",t.Dropdown)},className:"ml-2",icon:!0,size:"sm",type:"tertiary",active:l===t.Dropdown,"aria-pressed":l===t.Dropdown,children:(0,c.jsx)(u.Icon,{autoFlip:!0,className:"icon-size",icon:p(8377)})})})]}),(0,c.jsx)(m.SettingRow,{flow:"wrap",label:g("pagingStyle"),children:(0,c.jsxs)(u.Select,{size:"sm",className:"w-100",value:n,onChange:e=>{i("pagingStyle",e.target.value)},children:[(0,c.jsx)("option",{value:s.Scroll,children:g("scroll")}),(0,c.jsx)("option",{value:s.Multiple,children:g("multiPage")})]})}),n===s.Multiple&&(0,c.jsx)(m.SettingRow,{flow:"wrap",label:g("pageSize"),children:(0,c.jsx)(u.NumericInput,{style:{width:"100%"},"aria-label":g("pageSize"),size:"sm",min:1,max:200,showHandlers:!0,value:null!=o?o:50,onAcceptValue:e=>{i("pageSize",e)}})})]})};var xe=p(31027),Me=p.n(xe),we=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};const Ce=e=>{const t=window.SVG,{className:a}=e,i=we(e,["className"]),l=(0,d.classNames)("jimu-icon jimu-icon-component",a);return t?(0,c.jsx)(t,Object.assign({className:l,src:Me()},i)):(0,c.jsx)("svg",Object.assign({className:l},i))},Te=e=>d.css`
    &.empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;
        .empty-placeholder-text {
          color: ${e.ref.palette.neutral[1e3]};
          font-size: 14px;
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${e.ref.palette.neutral[800]};
        }
      }
    }
  `,Ne=e=>{const{isMapMode:t}=e,a=d.hooks.useTranslation(h,u.defaultMessages),i=(0,L.useTheme)(),l=a("newSheet"),n=t?a("noMapSelectedTips"):a("tableBlankStatus",{SheetString:l});return(0,c.jsx)("div",{className:"empty-placeholder w-100",css:Te(i),children:(0,c.jsxs)("div",{className:"empty-placeholder-inner",children:[(0,c.jsx)("div",{className:"empty-placeholder-icon",children:(0,c.jsx)(Ce,{size:48})}),(0,c.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",children:n})]})})};var Re=function(e,t,a,i){return new(a||(a=Promise))(function(l,n){function o(e){try{r(i.next(e))}catch(e){n(e)}}function s(e){try{r(i.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}r((i=i.apply(e,t||[])).next())})};const ze=t=>{const{id:a,config:i,useDataSources:l,useMapWidgetIds:n,onSettingChange:o}=t,{tableMode:s,layersConfig:r=(0,d.Immutable)([]),mapViewsConfig:p=(0,d.Immutable)({})}=i,[I,b]=d.React.useState(!1),[f,S]=d.React.useState(!1),[v,y]=d.React.useState([]),[D,j]=d.React.useState(),x=d.React.useRef(null),M=window.isExpressBuilder,w=s===e.Map,C=s===e.Layer,T=(null==n?void 0:n.length)>0,N=C&&r.length>0||w&&p&&Object.keys(p).length>0,R=C&&!N&&!M,z=w&&!T&&!M,k=w&&!z||C&&!R,P=d.hooks.useTranslation(h,u.defaultMessages),O=d.React.useCallback((e,t)=>{if(t===i[e])return;const l=i.set(e,t);o({id:a,config:l})},[i,o,a]),L=d.React.useCallback(()=>{const t=x.current===e.Map;o(Object.assign(Object.assign({id:a,config:i.set("tableMode",x.current).set("layersConfig",[]).set("mapViewsConfig",{}).set("enableMapExtentFilter",t).set("defaultExtentFilterEnabled",!1).set("enableHighlightOnHover",!1)},t?{}:{useMapWidgetIds:[]}),{useDataSources:t?void 0:[]})),x.current=null,b(!1)},[i,o,a]),A=d.React.useCallback(e=>{s!==e&&(x.current=e,N?b(!0):L())},[s,L,N]),W=d.React.useCallback(e=>{y([]);const t=Object.values(e);1!==Object.keys(t).length||Object.values(t)[0].dataSourceId?S(!1):S(!0);const a=Object.values(e).map(e=>Re(void 0,void 0,void 0,function*(){yield e.whenJimuMapViewLoaded(),yield e.whenAllJimuLayerViewLoaded()}));Promise.allSettled(a).then(()=>{y(t)})},[S]);return(0,c.jsxs)("div",{className:"jimu-widget-setting widget-setting-table",children:[(0,c.jsxs)(m.SettingSection,{role:"group",title:P("mode"),children:[(0,c.jsxs)("div",{role:"radiogroup",className:"mb-4",children:[(0,c.jsxs)(u.Label,{className:"d-flex align-items-center",children:[(0,c.jsx)(u.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:!w,onChange:()=>{A(e.Layer)}}),P("selectLayers")]}),(0,c.jsxs)(u.Label,{className:"d-flex align-items-center",children:[(0,c.jsx)(u.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:w,onChange:()=>{A(e.Map)}}),P("interactWithMap")]})]}),C&&(0,c.jsx)(be,{widgetId:a,config:i,useDataSources:l,onSettingChange:o}),w&&(0,c.jsx)(ye,{widgetId:a,config:i,useMapWidgetIds:n,mapEmpty:f,jimuMapViews:v,activeMapView:D,useDataSources:l,onSettingChange:o,onPropertyChange:O})]}),(0,c.jsx)(je,{config:i,onPropertyChange:O}),k&&(0,c.jsx)(le,{isMapMode:w,level:"widget",config:i,onPropertyChange:O}),R&&(0,c.jsx)(Ne,{isMapMode:!1}),z&&(0,c.jsx)(Ne,{isMapMode:!0}),w&&(0,c.jsx)(g.JimuMapViewComponent,{useMapWidgetId:null==n?void 0:n[0],onViewsCreate:W,onActiveViewChange:e=>{j(e)}}),I&&(0,c.jsx)(u.ConfirmDialog,{level:"warning",title:P("changeModeConfirmTitle"),hasNotShowAgainOption:!1,content:P("changeModeConfirmTips"),onConfirm:L,onClose:()=>{b(!1)}})]})};function ke(e){p.p=e}})(),I})())}}});