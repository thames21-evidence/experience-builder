System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-layouts/layout-runtime","jimu-theme"],function(e,t){var o={},i={},s={},n={},a={};return{setters:[function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){i.AppMode=e.AppMode,i.BrowserSizeMode=e.BrowserSizeMode,i.ExpressionResolverComponent=e.ExpressionResolverComponent,i.Immutable=e.Immutable,i.LayoutItemType=e.LayoutItemType,i.LinkType=e.LinkType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ReactResizeDetector=e.ReactResizeDetector,i.TransitionDirection=e.TransitionDirection,i.TransitionType=e.TransitionType,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.defaultMessages=e.defaultMessages,i.getAppStore=e.getAppStore,i.getNextAnimationId=e.getNextAnimationId,i.getTransition=e.getTransition,i.jimuHistory=e.jimuHistory,i.lodash=e.lodash,i.motion=e.motion,i.urlUtils=e.urlUtils,i.utils=e.utils},function(e){s.Link=e.Link,s.LinkTip=e.LinkTip,s.Paper=e.Paper,s.WidgetPlaceholder=e.WidgetPlaceholder,s.hooks=e.hooks,s.styleUtils=e.styleUtils},function(e){n.LayoutEntry=e.LayoutEntry,n.LayoutItemSizeModes=e.LayoutItemSizeModes,n.searchUtils=e.searchUtils},function(e){a.getThemeModule=e.getThemeModule,a.mapping=e.mapping}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=a},10527:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m2.116 1.5.969 1.678H1.05v3H0l1.5 2 1.5-2h-.951v-2h1.614l4.618 8H2.049v-2H1.05v3h7.809l1.257 2.178.866-.5L2.982 1zm9.982 8.678h.95v2h-2.611l.576 1h3.036v-3h1.05l-1.501-2zm.951-4v-2H5.817l-.578-1h8.81v3z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=s},41496:e=>{"use strict";e.exports=n},67386:e=>{"use strict";e.exports=o},73027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.049 6V3h13v3h-1V4h-11v2H3L1.5 7.999 0 6zm12 4h-.952l1.5-2 1.5 2h-1.049v3H1.05v-3h1v2h11z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},86800:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#FFF" fill-rule="nonzero" d="M2 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4m5-3a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4m0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4m0 7a1 1 0 0 0 0 2h7a1 1 0 0 0 0-2zm0-1h7a2 2 0 1 1 0 4H7a2 2 0 1 1 0-4M2 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 1a2 2 0 1 1 0-4 2 2 0 0 1 0 4"></path></svg>'}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var l={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(l),r.d(l,{Widget:()=>U,__set_webpack_public_path__:()=>$,default:()=>_});var e,t=r(67386),o=r(79244),i=r(14321);!function(e){e.AUTO="Auto",e.CUSTOM="Custom"}(e||(e={}));o.TransitionType.None,o.TransitionDirection.Horizontal;var s,n,a,d;!function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3",e.Style4="STYLE4",e.Style5="STYLE5",e.Style6="STYLE6",e.Style7="STYLE7",e.Style8="STYLE8",e.Style9="STYLE9",e.Style10="STYLE10"}(s||(s={})),function(e){e.Default="DEFAULT",e.Hover="HOVER"}(n||(n={})),function(e){e.None="NONE",e.Default="DEFAULT",e.Hover="HOVER"}(a||(a={})),function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(d||(d={}));var u=r(41496);class c extends o.React.PureComponent{constructor(){super(...arguments),this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.getStyle=e=>{const{widgetId:t}=this.props;let i;return e&&(i=this.checkIsBackgroundTransparent(e)),o.css`
      & {
        overflow: hidden;
      }
      .card-link {
        cursor: pointer;
      }
      .card-content .animate-wrapper{
        height: 100%;
      }
      .hover-content {
        pointer-events: none;
      }
      &:hover {
        .hover-content {
          pointer-events: auto;
        }
        .card-surface {
          border: none !important;
          background-color: ${this.checkIsBackgroundTransparent(n.Hover)&&"none !important"};
        }
      }
      .animation-list, .card-editor-con {
        overflow: hidden;
        background-color: ${i&&"none !important"};
      }
      .card-editor-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }
      ${"&.card-"+t} {
        padding: 0;
        border: 0;
        background-color: transparent;
        height: 100%;
        position: relative;
        .card-content {
          width: 100%;
          height: 100%;
          background-color: ${!i&&"var(--sys-color-surface-paper)"};
          /* overflow: hidden; */
          & > div {
            width: 100%;
            height: 100%;
          }
        }
      }
      .edit-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 10;
      }
      .clear-background {
        background: transparent !important;
      }
      .card-link {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }
      .clear-background:focus {
        outline: none;
      }
      .card-viewer-con {
        border: none !important;
        background-color: ${i&&"none !important"};
      }
      ${"&.card-"+t}:hover {
      }
    `}}checkIsBackgroundTransparent(e){var t,o,i;const{cardConfigs:s}=this.props,n=null===(i=null===(o=null===(t=null==s?void 0:s[e])||void 0===t?void 0:t.backgroundStyle)||void 0===o?void 0:o.background)||void 0===i?void 0:i.color,a=null==n?void 0:n.match(/^rgba\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*,\s*(\d*\.?\d+)\s*\)$/);if(a){return 0===parseFloat(a[1])}return"rgba(0,0,0,0)"===n}checkIsNotSetBackground(e){var t,o;const{cardConfigs:i}=this.props,s=null===(t=null==i?void 0:i[e])||void 0===t?void 0:t.backgroundStyle,n=null==s?void 0:s.background;return!(null==n?void 0:n.color)&&!(null===(o=null==n?void 0:n.image)||void 0===o?void 0:o.url)}}var p=r(73027),h=r.n(p),g=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(o[i[s]]=e[i[s]])}return o};const v=e=>{const i=window.SVG,{className:s}=e,n=g(e,["className"]),a=(0,o.classNames)("jimu-icon jimu-icon-component",s);return i?(0,t.jsx)(i,Object.assign({className:a,src:h()},n)):(0,t.jsx)("svg",Object.assign({className:a},n))};var y=r(10527),f=r.n(y),m=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(o[i[s]]=e[i[s]])}return o};const S=e=>{const i=window.SVG,{className:s}=e,n=m(e,["className"]),a=(0,o.classNames)("jimu-icon jimu-icon-component",s);return i?(0,t.jsx)(i,Object.assign({className:a,src:f()},n)):(0,t.jsx)("svg",Object.assign({className:a},n))};var b=r(1888);function I(e,t){const i=null==e?void 0:e.setIn(["boxShadow","color"],"transparent").asMutable({deep:!0}),s=(null==i?void 0:i.border)||{};let n=e;if((null==s?void 0:s.color)||!(null==i?void 0:i.border)?n=e:(null==i||delete i.border,n=(0,o.Immutable)(Object.assign(Object.assign({},i),s))),(null==n?void 0:n.textColor)||(n=n.set("textColor","var(--sys-color-surface-paper-text)")),!(null==n?void 0:n.borderRadius)){const e=w(t);n=n.set("borderRadius",e)}return n}function w(e){var t;const o=(0,b.getThemeModule)(null==e?void 0:e.uri),i=b.mapping.whetherIsNewTheme(o),s=null===(t=e.sys.shape)||void 0===t?void 0:t.shape2,n=i?null==s?void 0:s.split("px")[0]:0;return{number:[n,n,n,n],unit:"px"}}function C(e,t){const o=w(t);return(null==e?void 0:e.borderRadius)||o}const j=[0,5],x=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","bottom-start","top-start","top-end"]}}],k=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}];const T=o.ReactRedux.connect((e,t)=>{var i;const{appMode:s}=t;if(!window.jimuConfig.isInBuilder||s===o.AppMode.Run)return{selection:void 0};return{selection:t.selectionIsInCard&&(null===(i=null==e?void 0:e.appRuntimeInfo)||void 0===i?void 0:i.selection)}})(class extends c{constructor(s){var a,r;super(s),this.lastResizeCall=null,this.handleCopyTo=(e,t,o,i)=>{if(!o)return;const{layouts:s,builderSupportModules:n,browserSizeMode:a,builderStatus:r}=this.props,l=n.jimuForBuilderLib;let d=l.getAppConfigAction(),c=d.appConfig;const p=u.searchUtils.findLayoutId(s[r],a,c.mainSizeMode),h=u.searchUtils.findLayoutId(s[t],a,c.mainSizeMode);if(i){const e=n.widgetModules.searchUtils,t=o.widgetId,i=c.widgets[t].parent[a],s=i.find(e=>e.layoutId===p),r=i.find(e=>e.layoutId===h),l=e.findLayoutItem(c,s);d.editLayoutItemProperty(r,"bbox",l.bbox).editLayoutItemProperty(r,"setting",l.setting)}else{const e=l.LayoutServiceProvider.getService(c,h).createBlankItem(c,h);c=e[0];const t=e[1],i={layoutId:h,layoutItemId:t},s=u.searchUtils.findLayoutItem(c,{layoutId:p,layoutItemId:o.id});c=l.widgetService.addParent(c,o.widgetId,i,a),d=l.getAppConfigAction(c),d.editLayoutItemProperty(i,"bbox",s.bbox).editLayoutItemProperty(i,"setting",s.setting).editLayoutItemProperty(i,"type",s.type).editLayoutItemProperty(i,"widgetId",s.widgetId).adjustOrderOfItem(i,-1)}this.setState({widgetsUpdate:Symbol()}),d.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.editStatus=(e,t)=>{const{dispatch:i,widgetId:s}=this.props;i(o.appActions.widgetStatePropChange(s,e,t))},this.handleBreakLink=e=>{const{builderSupportModules:t,browserSizeMode:i,selection:s,builderStatus:n,dispatch:a,widgetId:r}=this.props,l=t.jimuForBuilderLib;let d=l.getAppConfigAction();const c=d.appConfig,p=u.searchUtils.findLayoutItem(c,s);if(!p)return;const h=c.widgets[r].layouts[n][i],g=d.duplicateLayoutItemInSameLayout({layoutId:h,layoutItemId:p.id});d.editLayoutItemProperty({layoutId:s.layoutId,layoutItemId:g},"bbox",p.bbox).removeLayoutItem({layoutId:h,layoutItemId:p.id},!1);const v=u.searchUtils.findLayoutItem(d.appConfig,{layoutId:h,layoutItemId:g}),y=new l.ContentServiceWrapper(d.appConfig,v);y.removeSizeModeParent(i),y.addParent({layoutId:h,layoutItemId:g},i),d=l.getAppConfigAction(y.getConfig()),s.layoutId===h&&s.layoutItemId===p.id&&a(o.appActions.selectionChanged(null));const f=d.appConfig.layouts[h].content,m=Object.keys(f)[Object.keys(f).length-1];if(m){const e=f[m];a(o.appActions.selectionChanged({layoutId:h,layoutItemId:e.id}))}d.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.initParentOfNewWidgetAfterIsolate=(e,t)=>{const{browserSizeMode:o}=this.props,i=e.parent[o],s=null==i?void 0:i.filter(e=>e.layoutId===t);return e.setIn(["parent",o],s)},this.getCopyDropdownItems=t=>{const{cardConfigs:i,layouts:s,browserSizeMode:a,selection:r,builderStatus:l,builderSupportModules:d}=this.props,c=d.jimuForBuilderLib.getAppConfigAction().appConfig,p=u.searchUtils.findLayoutItem(c,r);if(!r||!p||!window.jimuConfig.isInBuilder)return{items:(0,o.Immutable)([]),title:""};const h=[];let g="",v=!0,y=!0;const f=(e,t)=>d.widgetModules.searchUtils.getContentsInLayoutWithRecursiveLayouts(c,e,o.LayoutItemType.Widget,a).indexOf(t)>-1,m=()=>{const{cardLayout:t}=this.props;if(i[n.Hover]&&t!==e.AUTO){const e=u.searchUtils.findLayoutId(s[n.Hover],a,c.mainSizeMode);f(e,c.layouts[r.layoutId].content[r.layoutItemId].widgetId)||(y=!1),h.push({label:this.formatMessage("applyTo",{status:this.formatMessage("hover").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,n.Hover,p,y)}})}},S=()=>{const{cardLayout:t}=this.props;if(t!==e.AUTO){const e=u.searchUtils.findLayoutId(s[n.Default],a,c.mainSizeMode);f(e,c.layouts[r.layoutId].content[r.layoutItemId].widgetId)||(v=!1),h.push({label:this.formatMessage("applyTo",{status:this.formatMessage("default").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,n.Default,p,v)}})}};return l===n.Default?(m(),g=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()})):l===n.Hover&&(S(),g=this.formatMessage("linkedTo",{where:this.formatMessage("default").toLocaleLowerCase()})),t?h.push({label:this.formatMessage("isolate"),event:this.handleBreakLink}):g=this.formatMessage("isolate"),{items:(0,o.Immutable)(h),title:g}},this.getCardToolsStyle=e=>o.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{if(!window.jimuConfig.isInBuilder)return;const{builderSupportModules:e,selectionIsCard:i,selectionIsInCard:s,appMode:a,hideCardTool:r,cardConfigs:l}=this.props,{BuilderPopper:d,GLOBAL_RESIZING_CLASS_NAME:u,GLOBAL_H5_DRAGGING_CLASS_NAME:c,GLOBAL_DRAGGING_CLASS_NAME:p}=e.widgetModules;let h=!0;return(!s&&!i||a===o.AppMode.Run||r)&&(h=!1),this.props.isEditing&&l[n.Hover].enable&&(0,t.jsx)(d,{placement:"left-start",trapFocus:!1,autoFocus:!1,css:o.css`
            .${p} &,
            .${u} &,
            .${c} & {
              &.popper {
                display: none;
              }
            }
          `,reference:this.layoutRef.current,offset:j,modifiers:x,open:h,children:this.getCardMenuElement()})},this.getCardMenuElement=()=>{if(!window.jimuConfig.isInBuilder)return;const{selection:e,widgetId:o,builderSupportModules:i,browserSizeMode:s,builderStatus:a,selectionIsCard:r}=this.props,l=i.jimuForBuilderLib.getAppConfigAction().appConfig,{searchUtils:d,BuilderDropDown:u,BuilderButton:c,withBuilderTheme:p}=i.widgetModules,h=r,g=!h&&e&&d&&d.getRelatedLayoutItemsInWidgetByLayoutInfo(l,e,o,s).length>1,{items:y,title:f}=this.getCopyDropdownItems(g),m=y&&y.length>0,b=p(e=>(0,t.jsxs)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:this.getCardToolsStyle(e),children:[(0,t.jsx)(c,{active:a===n.Default,onClick:e=>{this.handleBuilderStatusChange(e,n.Default)},children:this.formatMessage("default")}),(0,t.jsx)(c,{active:a===n.Hover,className:"mt-1",onClick:e=>{this.handleBuilderStatusChange(e,n.Hover)},children:this.formatMessage("hover")}),!h&&(m||g)&&(0,t.jsx)(u,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:f,toggleType:"default",direction:"left",toggleContent:e=>g?(0,t.jsx)(v,{size:16}):(0,t.jsx)(S,{size:16}),modifiers:k,items:y})]}));return(0,t.jsx)(b,{})},this.getEditorStyle=()=>o.css`
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      &.card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.renderCardEditor=()=>{var s,a;const{cardConfigs:r,LayoutEntry:l,layouts:d,cardLayout:u,builderStatus:c,theme:p}=this.props,h=d[n.Default],g=u===e.AUTO?h:d[n.Hover],v=c===n.Hover,y=I(r[n.Default].backgroundStyle,p),f=I(r[n.Hover].backgroundStyle,p),m=r.transitionInfo,S=(0,o.getTransition)(null===(s=null==m?void 0:m.transition)||void 0===s?void 0:s.type,null===(a=null==m?void 0:m.transition)||void 0===a?void 0:a.direction),b=(null==S?void 0:S.getVariants())||{},w=[],C=Object.assign({},i.styleUtils.toCSSStyle(y||{})),j=(0,t.jsx)(o.motion.div,{className:"card-content d-flex animation-list card-editor-con",css:o.css`${this.getEditorStyle()}; z-index: ${v?0:1};`,ref:this.regularLayoutRef,style:C,variants:{default:{zIndex:v?0:1,x:0,y:0,rotateX:0,rotateY:0,transition:{type:"tween",duration:0}},ready:{zIndex:1,transition:{type:"tween",duration:0}},go:Object.assign(Object.assign({},b.toPrevious),{zIndex:0,transition:{type:"tween",duration:.5,ease:"easeOut"}})},children:(0,t.jsx)(l,{className:"h-100",isRepeat:!0,layouts:h,isInWidget:!0})},n.Default);if(w.push(j),!r[n.Hover].enable)return w;const x=Object.assign({},i.styleUtils.toCSSStyle(f||{})),k=u===e.AUTO&&r[n.Hover].enable,T=(0,t.jsxs)(o.motion.div,{className:"card-content hover-content d-flex card-surface animation-list card-editor-con",css:o.css`${this.getEditorStyle()}; z-index: ${v?1:0};`,ref:this.hoverLayoutRef,style:x,variants:{default:{zIndex:v?1:0,x:0,y:0,rotateX:0,rotateY:0,transition:{type:"tween",duration:0}},ready:Object.assign(Object.assign({},b.toNext),{transition:{type:"tween",duration:0}}),go:Object.assign(Object.assign({},b.fromNext),{transition:{type:"tween",duration:.5,ease:"easeOut"}})},children:[(0,t.jsx)(l,{className:"h-100",isRepeat:!0,layouts:g,isInWidget:!0}),k&&(0,t.jsx)("div",{className:"card-editor-mask position-absolute"})]},n.Hover);return w.push(T),w},this.getCardStyle=()=>{var e,t,o;const{builderStatus:s,cardConfigs:a,theme:r}=this.props,l=a[n.Hover].enable?s:n.Default,d={boxShadow:null===(t=null===(e=a[l])||void 0===e?void 0:e.backgroundStyle)||void 0===t?void 0:t.boxShadow,borderRadius:C(null===(o=a[l])||void 0===o?void 0:o.backgroundStyle,r)};return Object.assign({},i.styleUtils.toCSSStyle(d))},this.handleAnimationEnd=e=>{"ready"===e?this.setState({animate:"go"}):"go"===e&&this.setState({animate:"default"})},this.state={didMount:!1,animate:"default",widgetsUpdate:null},this.regularLayoutRef=o.React.createRef(),this.hoverLayoutRef=o.React.createRef(),this.layoutRef=o.React.createRef(),this.isUpdateFirst=!0,this.previousPreviewId=(null===(r=null===(a=s.cardConfigs)||void 0===a?void 0:a.transitionInfo)||void 0===r?void 0:r.previewId)||0}componentDidMount(){this.setState({didMount:!0})}componentDidUpdate(){var e;const{cardConfigs:t}=this.props;this.isUpdateFirst&&(this.isUpdateFirst=!1),(null===(e=null==t?void 0:t.transitionInfo)||void 0===e?void 0:e.previewId)>0&&t.transitionInfo.previewId!==this.previousPreviewId&&(this.previousPreviewId=t.transitionInfo.previewId,this.setState({animate:"ready"}))}handleBuilderStatusChange(e,t){var o;this.editStatus("showCardSetting",t),this.editStatus("builderStatus",t),null===(o=null==this?void 0:this.props)||void 0===o||o.selectSelf(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}render(){const{widgetId:e,isShowMask:i,builderStatus:s,selectionIsCard:n,selectionIsInCard:a}=this.props,{didMount:r}=this.state,l=`card-${e}`;return(0,t.jsxs)("div",{css:this.getStyle(s),style:this.getCardStyle(),className:l,children:[r&&this.renderCardTools(),(0,t.jsx)(o.motion.div,{className:"w-100 h-100",ref:this.layoutRef,animate:n||a?this.state.animate:"default",onAnimationComplete:this.handleAnimationEnd,variants:{default:{opacity:1},ready:{opacity:1},go:{opacity:1}},children:this.renderCardEditor()}),i&&(0,t.jsx)("div",{className:"edit-mask position-absolute"})]})}}),{useRef:L,useState:M}=o.React,O=e=>{var s;const{useDataSources:n,appMode:a,linkParam:r,widgetId:l,queryObject:d,children:u,role:c,changeIsCanClickLink:p}=e,h=L(null),g=L(null),v=o.React.useContext(o.jimuHistory.HistoryContext),[y,f]=M(!1),[m,S]=M(null),b=i.hooks.useApplyLinkResult(),I=e=>{if(p&&!p())return;const t=window.jimuConfig.isInBuilder;if(a===o.AppMode.Design&&t)return!1;const i=j(e),s=C();if(!i&&(null==r?void 0:r.linkType)&&(null==r?void 0:r.linkType)!==o.LinkType.None){const i=T(d);if(s){if(t)return w(),!1;"_self"===r.openType?window.location.href=i.linkTo.value:i.linkTo.value&&window.open(i.linkTo.value,r.openType)}else if((null==r?void 0:r.linkType)===o.LinkType.Block)h.current.click();else{if(t&&(null==r?void 0:r.linkType)===o.LinkType.PrintPreview)return w(),!1;b({evt:e,linkTo:i.linkTo,target:i.target,replace:!1,queryObject:i.queryObject})}}"linkClick"===e.exbEventType&&delete e.exbEventType},w=()=>{clearTimeout(g.current),f(!0),setTimeout(()=>{f(!1)},3e3)},C=o.React.useCallback(()=>{var e,t;let i=!1;if((null==r?void 0:r.linkType)===o.LinkType.WebAddress){const s=m||r.value;s?i=o.urlUtils.isAbsoluteUrl(s):(null===(e=null==r?void 0:r.expression)||void 0===e?void 0:e.name)&&(i=o.urlUtils.isAbsoluteUrl(null===(t=null==r?void 0:r.expression)||void 0===t?void 0:t.name))}return i},[r,m]),j=e=>{const t=e.target;return x(t,e)||x(null==t?void 0:t.parentNode,e)},x=(e,t)=>{if(!e)return!1;const o=null==e?void 0:e.getAttribute("z-index"),i=null==e?void 0:e.role,s=e&&e.tagName||"",n="button"===s.toLowerCase()||"button"===i,a="a"===s.toLowerCase()||"linkClick"===t.exbEventType,r="input"===s.toLowerCase()||"input"===i;return n||a||!!o&&o>-1||r},k=o.css`
    .list-clear-background {
      background: transparent !important;
    }
    .list-link {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
    }
  `,T=o.React.useCallback(e=>{const t=null==r?void 0:r.openType,i={linkType:null==r?void 0:r.linkType,value:null==r?void 0:r.value};let s=e;return(null==r?void 0:r.linkType)===o.LinkType.WebAddress&&(i.value=m||(null==i?void 0:i.value),s=void 0),{queryObject:s,target:t,linkTo:i}},[r,m]),O=e=>{e.stopPropagation()},R=o.React.useCallback(()=>C()||(null==r?void 0:r.linkType)===o.LinkType.PrintPreview,[C,null==r?void 0:r.linkType]);return(0,t.jsxs)("div",{className:"w-100 h-100","aria-label":null==e?void 0:e["aria-label"],role:c,onClick:I,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||I(e)},css:k,children:[(()=>{var e;const s=T(d),n=null===(e=null==s?void 0:s.linkTo)||void 0===e?void 0:e.linkType;return n&&n!==o.LinkType.None&&(0,t.jsx)(i.Link,{className:"p-0 w-100 h-100 border-0 list-clear-background list-link",ref:h,unstyled:!0,to:s.linkTo,target:s.target,queryObject:s.queryObject,onClick:O,tabIndex:-1})})(),u,n&&(0,t.jsx)(o.ExpressionResolverComponent,{useDataSources:n,expression:null==r?void 0:r.expression,onChange:e=>{if(e.isSuccessful)S(e.value);else{S("")}},widgetId:l}),window.jimuConfig.isInBuilder&&R()&&(0,t.jsx)(i.LinkTip,{reference:null===(s=h.current)||void 0===s?void 0:s.id,open:y,href:(()=>{const e=T(d);return o.urlUtils.getHrefFromLinkTo(e.linkTo,d,v&&v.location)||""})()})]})},{useState:R,useRef:A,useEffect:P}=o.React,E={type:"tween",duration:.5,ease:"easeOut"},z={transition:{type:o.TransitionType.Fade,direction:o.TransitionDirection.Horizontal},oneByOneEffect:null,previewId:1},N=o.css`
  & {
    left: 0;
    top: 0
  }
`,H=function(s){var a,r,l,d,c,p;const{cardConfigs:h,browserSizeMode:g,layouts:v,appMode:y,linkParam:f,cardLayout:m,queryObject:S,LayoutEntry:b,theme:w}=s,[j,x]=R("default"),k=!(null==h?void 0:h.transitionInfo)||(null===(r=null===(a=null==h?void 0:h.transitionInfo)||void 0===a?void 0:a.transition)||void 0===r?void 0:r.type)===o.TransitionType.None,T=k?z:null==h?void 0:h.transitionInfo,L=(null===(l=null==h?void 0:h.HOVER)||void 0===l?void 0:l.enable)||!1,M=(null===(d=window.jimuConfig)||void 0===d?void 0:d.isInBuilder)||!1,H=(0,o.getTransition)(null===(c=null==T?void 0:T.transition)||void 0===c?void 0:c.type,null===(p=null==T?void 0:T.transition)||void 0===p?void 0:p.direction),D=L&&null!=H,B=A(null==T?void 0:T.previewId);P(()=>{(null==T?void 0:T.previewId)>0&&T.previewId!==B.current&&(B.current=T.previewId,x("ready"))},[null==T?void 0:T.previewId]);const U=o.React.useCallback(e=>M&&y===o.AppMode.Express?(0,t.jsx)(b,{layouts:e,isInWidget:!0}):(0,t.jsx)(u.LayoutEntry,{layouts:e}),[M,y,b]),_=o.React.useMemo(()=>g===o.BrowserSizeMode.Small,[g]),$=o.React.useCallback(e=>I(h[e].backgroundStyle,w),[h,w]),W=o.React.useCallback(e=>({borderRadius:C(h[e].backgroundStyle,w)}),[h,w]),F=o.React.useCallback(()=>(E.duration=k?0:.5,E),[k]),q=o.React.useCallback(s=>{const a=[];let r,l,d,u,c,p;M&&y===o.AppMode.Design?(l=$(n.Default),c=W(n.Default),r=v[n.Default],L&&(u=$(n.Hover),p=W(n.Hover),d=m===e.AUTO?r:v[n.Hover])):(r=v[n.Default],l=$(n.Default),c=W(n.Default),L&&(d=m===e.AUTO?r:v[n.Hover],u=$(n.Hover),p=W(n.Hover)));const h=Object.assign({},i.styleUtils.toCSSStyle(l||{}));c&&(c=Object.assign({},i.styleUtils.toCSSStyle(c||{}))),p&&(p=Object.assign({},i.styleUtils.toCSSStyle(p||{})));const g=null==H?void 0:H.getVariants(),S=(null==f?void 0:f.linkType)&&(null==f?void 0:f.linkType)!==o.LinkType.None,b=F(),I=(0,t.jsx)(o.motion.div,{className:(0,o.classNames)("card-content d-flex card-viewer-con position-absolute",S?"card-link":""),variants:D?{default:Object.assign(Object.assign({},g.fromPrevious),{x:0,y:0,rotateX:0,rotateY:0,opacity:1,transition:b}),hover:Object.assign(Object.assign({},g.toPrevious),{opacity:0,transition:b}),ready:{opacity:1,transition:{type:"tween",duration:0}},go:Object.assign(Object.assign({},g.toPrevious),{opacity:0,transition:b})}:void 0,children:(0,t.jsx)("div",{className:"w-100 animation-list",style:h,children:(0,t.jsx)("div",{className:"d-flex w-100 h-100",style:c,children:U(r)},n.Default)})},n.Default);if(a.push(I),L){const e=Object.assign({},i.styleUtils.toCSSStyle(u||{})),s=(0,t.jsx)(o.motion.div,{className:(0,o.classNames)("card-content hover-content d-flex card-surface w-100 h-100 position-absolute",S?"card-link":""),css:N,variants:D?{default:Object.assign(Object.assign({},g.toNext),{opacity:0,transition:b}),hover:Object.assign(Object.assign({},g.fromNext),{opacity:1,transition:b}),ready:Object.assign(Object.assign({},g.toNext),{opacity:0,transition:{type:"tween",duration:0}}),go:Object.assign(Object.assign({},g.fromNext),{opacity:1,transition:b})}:void 0,children:(0,t.jsx)("div",{className:"w-100 h-100 animation-list",style:e,children:(0,t.jsx)("div",{className:"d-flex w-100 h-100",style:p,children:U(d)},n.Hover)})},n.Hover);a.push(s)}return a},[M,y,H,null==f?void 0:f.linkType,L,D,F,U,$,W,v,m]),V=o.React.useCallback(e=>{_&&L&&x(e?"default":"hover")},[_,L]);return(0,t.jsx)(O,{linkParam:f,appMode:y,queryObject:S,children:(0,t.jsx)("div",{className:"w-100 h-100",onMouseLeave:e=>{V(!0)},onMouseEnter:e=>{V()},children:(0,t.jsx)(o.motion.div,{className:"w-100 h-100 position-relative",initial:D?"default":void 0,animate:D?j:void 0,whileHover:D?"hover":void 0,onAnimationComplete:e=>{"ready"===e?x("go"):"go"===e&&x("default")},variants:D?{default:{opacity:1},hover:{opacity:1},ready:{opacity:1},go:{opacity:1}}:void 0,children:q(h)})})})};class D extends c{constructor(e){super(e),this.getCardShadowStyle=()=>{var e,t;const{cardConfigs:s,theme:a}=this.props,r=C(s[n.Default].backgroundStyle,a),l=C(s[n.Hover].backgroundStyle,a),d=o.css`
      box-shadow: ${i.styleUtils.toCSSBoxshadow(null===(e=s[n.Default].backgroundStyle)||void 0===e?void 0:e.boxShadow)};
      border-radius: ${i.styleUtils.toCSSBorderRadius(r)};
    `;return s[n.Hover].enable?o.css`
        ${d}
        &:hover {
          box-shadow: ${i.styleUtils.toCSSBoxshadow(null===(t=s[n.Hover].backgroundStyle)||void 0===t?void 0:t.boxShadow)};
          border-radius: ${i.styleUtils.toCSSBorderRadius(l)};
        }
      `:d},this.onMouse=(e,t=!1)=>{var o;const{cardConfigs:i}=this.props,{currenStatus:s}=this.state;let a=s;a=(null===(o=null==i?void 0:i.HOVER)||void 0===o?void 0:o.enable)&&t?n.Hover:n.Default,a!==s&&this.setState({currenStatus:a})},this.state={url:"",currenStatus:n.Default},this.regularLayoutRef=o.React.createRef(),this.hoverLayoutRef=o.React.createRef(),this.linkRef=o.React.createRef(),this.didMount=!1}componentDidMount(){this.didMount=!0}componentDidUpdate(e){var t,i;const s=this.props.cardConfigs,{cardConfigs:n}=e;(null===(t=null==s?void 0:s.transitionInfo)||void 0===t?void 0:t.previewId)===(null===(i=null==n?void 0:n.transitionInfo)||void 0===i?void 0:i.previewId)||this.setState({hoverPlayId:(0,o.getNextAnimationId)(),regularPlayId:(0,o.getNextAnimationId)()})}render(){const{widgetId:e,cardConfigs:i,linkParam:s,queryObject:n,layouts:a,appMode:r,browserSizeMode:l,cardLayout:d,LayoutEntry:u,theme:c}=this.props,{currenStatus:p}=this.state,h=`card-${e}`;return(0,t.jsx)("div",{css:o.css`${this.getStyle(p)} ${this.getCardShadowStyle()}`,className:h,onMouseLeave:e=>{this.onMouse(e,!1)},onMouseEnter:e=>{this.onMouse(e,!0)},children:(0,t.jsx)(H,{linkParam:s,queryObject:n,cardConfigs:i,layouts:a,appMode:r,browserSizeMode:l,cardLayout:d,LayoutEntry:u,theme:c})})}}const B={_layout_REGULAR_label:"Regular",_layout_HOVER_label:"Hover",_layout_DEFAULT_label:"Default",applyTo:"Apply to {status}",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a card template.",showSelected:"Show selection",_widgetLabel:"Card"};class U extends o.React.PureComponent{constructor(e){super(e),this.widgetConRef=o.React.createRef(),this.setListParentSizeInWidgetState=()=>{const{browserSizeMode:e,id:t,parentSize:i,layoutId:s}=this.props,n=(0,o.getAppStore)().getState().appConfig,a=o.utils.findViewportSize(n,e),r=`div.layout[data-layoutid=${s}]`,l=document.querySelector(r),d={width:(null==l?void 0:l.clientWidth)||a.width,height:(null==l?void 0:l.clientHeight)||a.height};i&&i.height===d.height&&i.width===d.width||this.props.dispatch(o.appActions.widgetStatePropChange(t,"parentSize",d))},this.setSelectionStatus=()=>{const{id:e,selectionIsInSelf:t}=this.props;this.props.dispatch(o.appActions.widgetStatePropChange(e,"selectionIsInSelf",t))},this.setSettingLayout=()=>{const{layoutId:e,layoutItemId:t,id:i,selectionIsSelf:s}=this.props,{isSetlayout:n}=this.state;e&&i&&t&&!n&&s&&(this.props.dispatch(o.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:e,layoutItemId:t})),this.setState({isSetlayout:!0}))},this.onResize=(e,t)=>{this.updateCardToolPosition()},this.updateCardToolPosition=()=>{const{selectionIsSelf:e}=this.props;e&&(this.setState({hideCardTool:!0}),this.updateCardToolTimeout&&(clearTimeout(this.updateCardToolTimeout),this.updateCardToolTimeout=void 0),this.updateCardToolTimeout=setTimeout(()=>{this.setState({hideCardTool:!1})},500))},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},B),o.defaultMessages)[e]},t),this.editStatus=(e,t)=>{const{dispatch:i,id:s}=this.props;i(o.appActions.widgetStatePropChange(s,e,t))},this.editWidgetConfig=e=>{if(!window.jimuConfig.isInBuilder)return;this.props.builderSupportModules.jimuForBuilderLib.getAppConfigAction().editWidgetConfig(this.props.id,e).exec()},this.isEditing=()=>{const{appMode:e,config:t,selectionIsSelf:i,selectionIsInSelf:s}=this.props;return!!window.jimuConfig.isInBuilder&&((i||s)&&window.jimuConfig.isInBuilder&&e===o.AppMode.Design&&t.isItemStyleConfirm)},this.checkIsShowMask=()=>{const{appMode:e,config:t}=this.props;return!!window.jimuConfig.isInBuilder&&!(window.jimuConfig.isInBuilder&&e===o.AppMode.Design&&t.isItemStyleConfirm)},this.editBuilderAndSettingStatus=e=>{this.editStatus("showCardSetting",e),this.editStatus("builderStatus",e)},this.getAppConfig=()=>(0,o.getAppStore)().getState().appConfig,this.getStyle=e=>{const{id:t}=this.props;return o.css`
      ${"&.card-widget-"+t} {
        overflow: visible;
        background-color: transparent;
        width: 100%;
        height: 100%;
      }
      &:has(a.list-link:focus) {
        outline: 2px solid ${e.sys.color.action.focus} !important;
      }
    `},this.getCardProps=()=>{const{config:e,selectionIsInSelf:t,selectionIsSelf:i,builderStatus:s,appMode:n,queryObject:a}=this.props,r=window.jimuConfig.isInBuilder&&n===o.AppMode.Design?{hideCardTool:this.state.hideCardTool,selectionIsCard:i,selectionIsInCard:t,isEditing:this.isEditing(),isShowMask:this.checkIsShowMask(),builderStatus:s,selectSelf:this.selectSelf}:{linkParam:e.linkParam,queryObject:a};return Object.assign(Object.assign({},this.getOtherProps()),r)},this.getOtherProps=()=>{const{config:e,theme:t,id:o,appMode:i,builderSupportModules:s,layouts:n,browserSizeMode:a,dispatch:r,isRTL:l,isHeightAuto:d,isWidthAuto:u}=this.props;return{browserSizeMode:a,isRTL:l,builderSupportModules:s,formatMessage:this.formatMessage,dispatch:r,widgetId:o,interact:window.jimuConfig.isInBuilder&&s.widgetModules.interact,appMode:i,theme:t,LayoutEntry:this.state.LayoutEntry,layouts:n,cardConfigs:e,isHeightAuto:d,isWidthAuto:u,cardLayout:null==e?void 0:e.cardLayout}},this.cardRender=()=>{const e=this.getCardProps(),{appMode:i}=this.props,s=window.jimuConfig.isInBuilder&&i===o.AppMode.Design?T:D;return(0,t.jsx)(s,Object.assign({},e))},this.selectSelf=()=>{if(!window.jimuConfig.isInBuilder)return!1;const{layoutId:e,layoutItemId:t}=this.props,i={layoutId:e,layoutItemId:t};this.props.dispatch(o.appActions.selectionChanged(i))};const i={LayoutEntry:null,hideCardTool:!1,isSetlayout:!1};window.jimuConfig.isInBuilder?i.LayoutEntry=this.props.builderSupportModules.LayoutEntry:i.LayoutEntry=u.LayoutEntry,this.state=i,this.onResize=this.onResize.bind(this),this.selectSelf=this.selectSelf.bind(this),this.debounceOnResize=o.lodash.debounce(({width:e,height:t})=>{this.onResize(e,t)},200)}componentDidUpdate(e,t){var i;const{appMode:s,selectionStatus:a,builderStatus:r,left:l,top:d}=this.props;s===o.AppMode.Design&&a!==r&&a&&this.editBuilderAndSettingStatus(a),e.appMode!==s&&s!==o.AppMode.Design&&this.editBuilderAndSettingStatus(n.Default),(null==e?void 0:e.selectionIsInSelf)!==(null===(i=this.props)||void 0===i?void 0:i.selectionIsInSelf)&&this.setSelectionStatus(),d===e.top&&l===e.left||this.updateCardToolPosition(),this.setSettingLayout(),this.setListParentSizeInWidgetState()}render(){const{config:e,id:s}=this.props,n=(0,o.classNames)("jimu-widget","widget-card","card-widget-"+s);return e.itemStyle?(0,t.jsxs)(i.Paper,{transparent:!0,role:"group","aria-label":this.formatMessage("_widgetLabel"),className:n,css:this.getStyle(this.props.theme),ref:this.widgetConRef,children:[this.cardRender(),(0,t.jsx)(o.ReactResizeDetector,{targetRef:this.widgetConRef,handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize})]}):(0,t.jsx)(i.WidgetPlaceholder,{name:this.formatMessage("_widgetLabel"),icon:r(86800),message:this.formatMessage("placeHolderTip")})}}U.mapExtraStateProps=(e,t)=>{var o,i,s,a,r,l,d,c,p,h,g,v,y,f,m;const S=e&&e.appConfig,{layouts:b,layoutId:I,layoutItemId:w,builderSupportModules:C,id:j}=t,x=null==e?void 0:e.browserSizeMode,k=(null==e?void 0:e.widgetsState[t.id])&&(null===(o=null==e?void 0:e.widgetsState[t.id])||void 0===o?void 0:o.builderStatus)||n.Default,T=e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection,L=T&&C&&C.widgetModules&&C.widgetModules.selectionInCard(T,j,S,!1);let M;L&&(M=Object.keys(b).find(e=>u.searchUtils.findLayoutId(b[e],x,S.mainSizeMode)===T.layoutId));const O=null===(i=S.layouts)||void 0===i?void 0:i[I],R=null===(a=null===(s=null==O?void 0:O.content)||void 0===s?void 0:s[w])||void 0===a?void 0:a.setting,A=(null===(r=null==R?void 0:R.autoProps)||void 0===r?void 0:r.height)===u.LayoutItemSizeModes.Auto||!0===(null===(l=null==R?void 0:R.autoProps)||void 0===l?void 0:l.height),P=(null===(d=null==R?void 0:R.autoProps)||void 0===d?void 0:d.width)===u.LayoutItemSizeModes.Auto||!0===(null===(c=null==R?void 0:R.autoProps)||void 0===c?void 0:c.width);let E;if(window.jimuConfig.isInBuilder){const e=null===(v=null===(g=null===(h=null===(p=S.layouts)||void 0===p?void 0:p[I])||void 0===h?void 0:h.content)||void 0===g?void 0:g[w])||void 0===v?void 0:v.bbox;E=e&&{left:e.left,top:e.top}}return{selectionIsSelf:(null==T?void 0:T.layoutId)===I&&(null==T?void 0:T.layoutItemId)===w,selectionIsInSelf:L,selectionStatus:M,appMode:null===(y=null==e?void 0:e.appRuntimeInfo)||void 0===y?void 0:y.appMode,browserSizeMode:null==e?void 0:e.browserSizeMode,builderStatus:k,isRTL:null===(f=null==e?void 0:e.appContext)||void 0===f?void 0:f.isRTL,left:E&&E.left,top:E&&E.top,isHeightAuto:A,isWidthAuto:P,queryObject:e.queryObject,parentSize:(null===(m=e.widgetsState[t.id])||void 0===m?void 0:m.parentSize)||null}};const _=U;function $(e){r.p=e}})(),l})())}}});