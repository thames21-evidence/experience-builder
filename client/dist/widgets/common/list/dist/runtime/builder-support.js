System.register(["jimu-core/emotion","jimu-core","jimu-core/dnd","jimu-ui","jimu-for-builder","jimu-layouts/layout-runtime","jimu-layouts/layout-builder","jimu-theme"],function(e,t){var o={},i={},s={},n={},r={},l={},a={},d={};return{setters:[function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){i.AppMode=e.AppMode,i.BrowserSizeMode=e.BrowserSizeMode,i.Immutable=e.Immutable,i.LayoutItemType=e.LayoutItemType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.defaultMessages=e.defaultMessages,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.utils=e.utils},function(e){s.interact=e.interact},function(e){n.Button=e.Button,n.ButtonGroup=e.ButtonGroup,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.ListGroupItem=e.ListGroupItem,n.Popper=e.Popper,n.defaultMessages=e.defaultMessages,n.styleUtils=e.styleUtils},function(e){r.LayoutServiceProvider=e.LayoutServiceProvider,r.builderAppSync=e.builderAppSync,r.getAppConfigAction=e.getAppConfigAction,r.widgetService=e.widgetService},function(e){l.searchUtils=e.searchUtils},function(e){a.GLOBAL_DRAGGING_CLASS_NAME=e.GLOBAL_DRAGGING_CLASS_NAME,a.GLOBAL_H5_DRAGGING_CLASS_NAME=e.GLOBAL_H5_DRAGGING_CLASS_NAME,a.GLOBAL_RESIZING_CLASS_NAME=e.GLOBAL_RESIZING_CLASS_NAME},function(e){d.getThemeModule=e.getThemeModule,d.mapping=e.mapping,d.withBuilderTheme=e.withBuilderTheme}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=d},4108:e=>{"use strict";e.exports=r},6055:e=>{"use strict";e.exports=a},10527:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m2.116 1.5.969 1.678H1.05v3H0l1.5 2 1.5-2h-.951v-2h1.614l4.618 8H2.049v-2H1.05v3h7.809l1.257 2.178.866-.5L2.982 1zm9.982 8.678h.95v2h-2.611l.576 1h3.036v-3h1.05l-1.501-2zm.951-4v-2H5.817l-.578-1h8.81v3z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=n},26245:e=>{"use strict";e.exports=s},41496:e=>{"use strict";e.exports=l},67386:e=>{"use strict";e.exports=o},73027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.049 6V3h13v3h-1V4h-11v2H3L1.5 7.999 0 6zm12 4h-.952l1.5-2 1.5 2h-1.049v3H1.05v-3h1v2h11z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i}},t={};function c(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,c),s.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var o in t)c.o(t,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{default:()=>F});var e,t=c(67386),o=c(79244),i=c(26245),s=c(14321),n=c(4108),r=c(41496);!function(e){e.AUTO="Auto",e.CUSTOM="Custom"}(e||(e={}));var l,a,d,p,g,h,m,f,y,S,v;!function(e){e.None="NONE",e.Arrangement="ARRANGEMENT",e.States="STATES",e.Tools="TOOLS"}(l||(l={})),function(e){e.None="NONE",e.Single="SINGLE",e.Multiple="MULTIPLE"}(a||(a={})),function(e){e.Scroll="SCROLL",e.MultiPage="MULTIPAGE"}(d||(d={})),function(e){e.Start="FLEX-START",e.Center="CENTER",e.End="FLEX-END"}(p||(p={})),function(e){e.Horizon="HORIZON",e.Vertical="VERTICAL"}(g||(g={})),function(e){e.Row="ROW",e.Column="COLUMN",e.GRID="GRID"}(h||(h={})),function(e){e.Glide="GLIDE",e.Fade="FADE",e.Float="FLOAT"}(m||(m={})),function(e){e.Hover0="HOVER0",e.Hover1="HOVER1",e.Hover2="HOVER2",e.Hover3="HOVER3"}(f||(f={})),function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3"}(y||(y={})),function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3",e.Style4="STYLE4",e.Style5="STYLE5",e.Style6="STYLE6",e.Style7="STYLE7",e.Style8="STYLE8",e.Style9="STYLE9",e.Style10="STYLE10",e.Style11="STYLE11",e.Style12="STYLE12"}(S||(S={})),function(e){e.Default="DEFAULT",e.Selected="SELECTED",e.Hover="HOVER"}(v||(v={}));var b=c(6055);class I extends o.React.PureComponent{constructor(e){super(e),this.onDropDownToggle=e=>{e.stopPropagation();const{isDropDownOpen:t,onDropDownOpenChange:o}=this.props;if(void 0!==t)o&&o(!t);else{const{isOpen:e}=this.state;this.setState({isOpen:!e})}},this.onItemClick=(e,t)=>{const{isDropDownOpen:o,onDropDownOpenChange:i}=this.props;void 0!==o?i&&i(!1):this.setState({isOpen:!1}),t.event(e,t),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.onDropDownMouseClick=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.getStyle=()=>{const{theme:e}=this.props;return o.css`
      & button {
        padding: 0;
      }
      .list-toggle-button {
        background: ${e.sys.color.action.default};
        border: none;
        &:hover, &[aria-expanded="true"] {
          background: ${e.sys.color.action.hover};
        }
      }
    `},this.state={isOpen:!1};const{withBuilderTheme:t}=e;this.MyDropdown=t?t(s.Dropdown):s.Dropdown,this.MyDropdownButton=t?t(s.DropdownButton):s.DropdownButton,this.MyDropdownMenu=t?t(s.DropdownMenu):s.DropdownMenu,this.MyDropdownItem=t?t(s.DropdownItem):s.DropdownItem}render(){const{items:e,toggleContent:i,toggleType:s,toggleArrow:n,menuContent:r,appMode:l,modifiers:a,toggleIsIcon:d,theme:c,isDropDownOpen:u,size:p,appendToBody:g,toggleTitle:h,direction:m,menuCss:f,className:y,showActive:S,activeLabel:v,fluid:b,activeIcon:I}=this.props;let{isOpen:w}=this.state;w=void 0===u?w:u;const{MyDropdown:L,MyDropdownButton:C,MyDropdownMenu:A,MyDropdownItem:x}=this;return(0,t.jsxs)(L,{size:p,toggle:this.onDropDownToggle,direction:m,fluid:b,isOpen:w&&l!==o.AppMode.Design,className:`my-dropdown ${y}`,css:this.getStyle(),activeIcon:I,menuRole:"listbox",children:[i&&(0,t.jsx)(C,{icon:d,title:h,size:p,type:s,className:"list-toggle-button",arrow:n,role:"combobox",children:i&&i(c)}),(0,t.jsx)(A,{appendToBody:g,modifiers:a,css:f&&f(c),referenceHiddenVisibility:!0,children:r?r(c):e&&e.asMutable().map((e,o)=>!e.hide&&(0,t.jsx)(x,{className:"no-user-select",title:e.label,active:S&&e.label===v,onClick:t=>{this.onItemClick(t,e)},children:e.label},o))})]})}}class w extends o.React.Component{constructor(){super(...arguments),this.shouldComponentUpdateExcept=(e,t,o,i=[])=>{let s=!1;return this.props&&Object.keys(this.props).some(t=>!o.includes(t)&&(this.props[t]!==e[t]&&(s=!0,!0))),this.state&&Object.keys(this.state).some(e=>!i.includes(e)&&(this.state[e]!==t[e]&&(s=!0,!0))),s},this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.getStyle=e=>{const{widgetId:t,config:i,appMode:s}=this.props,n=i.cardConfigs[v.Selected].selectionMode!==a.None,r=this.checkIsBackgroundTransparent(e);return o.css`
      ${"&.list-card-"+t} {
        padding: 0;
        border: 0;
        background-color: transparent;
        .list-card-content {
          width: 100%;
          height: 100%;
          overflow: hidden;
        }
      }
      .list-card-content {
        background-color: var(--sys-color-surface-paper);
      }
      .flex-row-layout {
        width: 100%;
      }
      &.surface-1 {
        border: none !important;
        background: ${r&&"none !important"};
      }
      .list-item-con {
        overflow: hidden;
      }
      ${"&.list-card-"+t}:hover {
        ${window.jimuConfig.isInBuilder&&s===o.AppMode.Design||!n?"":"cursor: pointer;"}
      }
      .card-editor-mask {
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 100;
      }
      .jimu-link {
        text-align: left;
      }
    `}}checkIsBackgroundTransparent(e){var t,o,i,s;const{config:n}=this.props;return"rgba(0,0,0,0)"===(null===(s=null===(i=null===(o=null===(t=null==n?void 0:n.cardConfigs)||void 0===t?void 0:t[e])||void 0===o?void 0:o.backgroundStyle)||void 0===i?void 0:i.background)||void 0===s?void 0:s.color)}}var L=c(1888);function C(e,t,i){var n,r,l,a,d,c,u,p,g;if(null==t?void 0:t.background){const o=(null===(n=null==e?void 0:e.background)||void 0===n?void 0:n.asMutable({deep:!0}))||{},i=(null===(r=null==t?void 0:t.background)||void 0===r?void 0:r.asMutable({deep:!0}))||{};(null==i?void 0:i.color)&&(o.color=null==i?void 0:i.color),(null==i?void 0:i.fillType)&&(o.fillType=null==i?void 0:i.fillType),(null==i?void 0:i.image)&&(o.image=null==i?void 0:i.image),e=e.set("background",o)}if((null==e?void 0:e.textColor)||(e=e.set("textColor","var(--sys-color-surface-paper-text)")),null==t?void 0:t.borderRadius){const o=s.styleUtils.mixinBorderRadiusWithDynamicStyle(null===(l=null==t?void 0:t.borderRadius)||void 0===l?void 0:l.asMutable({deep:!0}),null===(a=null==e?void 0:e.borderRadius)||void 0===a?void 0:a.asMutable({deep:!0}));e=e.set("borderRadius",o)}if(function(e){const t=null==e?void 0:e.borderRadius;if(t){const e=null==t?void 0:t.number;return!(null==e?void 0:e.some(e=>e||0===e))}return!0}(e)){const t=function(e){var t;const o=(0,L.getThemeModule)(null==e?void 0:e.uri),i=L.mapping.whetherIsNewTheme(o),s=null===(t=e.sys.shape)||void 0===t?void 0:t.shape2,n=i?null==s?void 0:s.split("px")[0]:0;return{number:[n,n,n,n],unit:"px"}}(i);e=e.set("borderRadius",t)}if(null==t?void 0:t.border){const i=(null===(d=null==e?void 0:e.border)||void 0===d?void 0:d.color)?{border:null===(c=null==e?void 0:e.border)||void 0===c?void 0:c.asMutable({deep:!0})}:null===(u=null==e?void 0:e.border)||void 0===u?void 0:u.asMutable({deep:!0}),n=s.styleUtils.mixinBorderWithDynamicStyle(null===(p=null==t?void 0:t.border)||void 0===p?void 0:p.asMutable({deep:!0}),i);e=(0,o.Immutable)(Object.assign(Object.assign({},e),n))}if(null==e?void 0:e.border){const t="var(--sys-color-divider-secondary)",i=["border","borderLeft","borderRight","borderTop","borderBottom"];Object.keys(null==e?void 0:e.border).some(e=>i.includes(e))&&(e=(0,o.Immutable)(Object.assign(Object.assign({},e),e.border))),Object.keys(e).some(e=>i.includes(e))&&(null===(g=Object.keys(e))||void 0===g||g.forEach(o=>{if(i.includes(o)){const i=e[o];(null==i?void 0:i.color)||(e=e.setIn([o,"color"],t))}}))}return e}const A={_widgetLabel:"List",_widgetDescription:"A widget to display data in a list view.",_action_filter_label:"Filter",_layout_REGULAR_label:"Regular",_layout_DEFAULT_label:"Default",_layout_HOVER_label:"Hover",_layout_SELECTED_label:"Selected",applyTo:"Apply to {status}",listLoading:"Loading",pleaseSelect:"Please select",listNoData:"No data",selectSortFields:"Select sorting fields",clearFilter:"Clear filter",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a list template.",showSelected:"Show selected",clearSelected:"Clear selected",listSorting:"Sorting",listSort:"Sort",guideStep2Title:"Template",guideStep2Content:"Click on a template and click start.",guideStep3Title:"Data",guideStep3Content:"Click on select data to add a data source.",guideStep4Title:"Add new data",guideStep4Content:"Click add new data to select a web map.",guideStep5Title:"Select data",guideStep5Content:"Click the feature layer in the select data panel and close the panel.",guideStep6Title:"Data",guideStep6Content:"Specifies the data source, allows you to filter the data and limit the number of features that appear in the list.",guideStep7Title:"Arrangement",guideStep7Content:"Click the expand icon to explore the Arrangement section. In here, it allows you to define the direction, height, spacing, and paging style for your list.",guideStep8Title:"States",guideStep8Content:"Click the expand icon to explore the available States. In this section, it provides a visual representation to communicate the state of the list items. There are three states: regular, selected, and hover. By default, the selected state is always on.",guideStep9Title:"Tools",guideStep9Content:"Click the expand icon to explore the available Tools. In here, you can include search, sort, filter, and show selected tools in your list.",guideStep10Title:"Select image",guideStep10Content:"Click the image widget to configure it in the content panel.",guideStep10Title2:"Image settings",guideStep10Content2:"Allows you to select the image source and other settings for your widget.",guideStep11Title:"Select text",guideStep11Content:"Click the text widget to add attributes in the widget toolbar.",guideStep11Title2:"Text settings",guideStep11Content2:"Provides the configurations and style, including adding dynamic content from the widget toolbar. ",guideStep12Title:"End of tour",guideStep12Content:"Add other widgets to enhance your experience.",clearSearch:"Clear search",minimize:"Minimize",topToolBack:"Back",showAllListRecords:"Show all records",listDataActionLabel:"{layer} list selection",searchResult:"Search result",describeMessage:"List item",listArea:"list area"};var x=c(73027),T=c.n(x),R=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(o[i[s]]=e[i[s]])}return o};const M=e=>{const i=window.SVG,{className:s}=e,n=R(e,["className"]),r=(0,o.classNames)("jimu-icon jimu-icon-component",s);return i?(0,t.jsx)(i,Object.assign({className:r,src:T()},n)):(0,t.jsx)("svg",Object.assign({className:r},n))};var E=c(10527),O=c.n(E),j=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(o[i[s]]=e[i[s]])}return o};const D=e=>{const i=window.SVG,{className:s}=e,n=j(e,["className"]),r=(0,o.classNames)("jimu-icon jimu-icon-component",s);return i?(0,t.jsx)(i,Object.assign({className:r,src:O()},n)):(0,t.jsx)("svg",Object.assign({className:r},n))},{useState:N,useEffect:k,useRef:B,Fragment:z}=o.React,G=[0,5],_=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","left-start","bottom-start","top-end","top-start"]}}],U=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}],P=i=>{var n,l,d,c;const u=o.hooks.useTranslation(A,s.defaultMessages,o.defaultMessages),p=B(null),g=B(null),h=B(null),m=B(null),{builderSupportModules:f,widgetId:y,reference:S,layouts:b,builderStatus:I,selection:w,selectionIsInList:L,datasourceId:C,selectionIsList:x,hideCardTool:T,config:R}=i,{selectCard:E}=i,{BuilderPopper:O,BuilderDropDown:j,BuilderButton:P,GLOBAL_RESIZING_CLASS_NAME:H,GLOBAL_H5_DRAGGING_CLASS_NAME:$,GLOBAL_DRAGGING_CLASS_NAME:F}=f.widgetModules,W=o.ReactRedux.useSelector(e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode}),Y=o.ReactRedux.useSelector(e=>null==e?void 0:e.browserSizeMode),[V,Z]=N(!1),[q,X]=N(!1),[J,K]=N(""),[Q,ee]=N(1);k(()=>{let e=!0;(!L&&!x||W===o.AppMode.Run||T||!C)&&(e=!1),Z(e)},[L,x,W,T,C]),k(()=>{const e=f.jimuForBuilderLib.getAppConfigAction().appConfig,t=(null===r.searchUtils||void 0===r.searchUtils?void 0:r.searchUtils.getRelatedLayoutItemsInWidgetByLayoutInfo(e,w,y,Y))||[],o=!x&&w&&t.length>1;X(o)},[x,w,y,Y,r.searchUtils,Q]),k(()=>{te(q,b,w,I,R)},[q,b,w,I,R,Y]);const te=(e,t,o,i,s)=>{const n=ne(e,t,o,i,s);m.current=n,de(e)},oe=o.hooks.useEventCallback(()=>{ee(Q+1)}),ie=(e,t)=>{se("showCardSetting",t),se("builderStatus",t),E(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},se=(e,t)=>{(0,o.getAppStore)().dispatch(o.appActions.widgetStatePropChange(y,e,t))},ne=(t,i,s,n,l)=>{var d,c;const m=null==l?void 0:l.cardConfigs,f=le(),y=r.searchUtils.findLayoutItem(f,s);if(!s||!y||!window.jimuConfig.isInBuilder)return(0,o.Immutable)([]);const S=[];h.current=!0,g.current=m[v.Selected].selectionMode!==a.None,p.current=!!m[v.Hover].enable;const b=(null===(d=m[v.Hover])||void 0===d?void 0:d.listLayout)!==(null==e?void 0:e.AUTO),I=(null===(c=m[v.Selected])||void 0===c?void 0:c.listLayout)!==(null==e?void 0:e.AUTO),w=()=>{if(m[v.Hover].enable){const e=re(v.Hover,i);S.push(e)}},L=()=>{if(m[v.Selected].selectionMode!==a.None){const e=re(v.Selected,i);S.push(e)}},C=()=>{const e=re(v.Default,i);S.push(e)};return n===v.Default?(b&&w(),I&&L()):n===v.Hover?(C(),I&&L()):(C(),b&&w()),t&&S.push({label:u("isolate"),event:ce}),S},re=(e,t)=>{const o=le(),i=r.searchUtils.findLayoutId(t[e],Y,o.mainSizeMode),s=o.layouts[w.layoutId].content[w.layoutItemId].widgetId;ae(i,s)||(e===v.Default&&(h.current=!1),e===v.Hover&&(p.current=!1),e===v.Selected&&(g.current=!1));let n="",l=!1;switch(e){case v.Default:n="default",l=h.current;break;case v.Hover:n="hover",l=p.current;break;case v.Selected:n="selected",l=g.current}return{label:u("applyTo",{status:u(n).toLocaleLowerCase()}),event:t=>{ue(t,e,l)}}},le=o.hooks.useEventCallback(()=>f.jimuForBuilderLib.getAppConfigAction().appConfig),ae=(e,t)=>{const i=le();return f.widgetModules.searchUtils.getContentsInLayoutWithRecursiveLayouts(i,e,o.LayoutItemType.Widget,Y).indexOf(t)>-1},de=e=>{let t="";const o=le(),i=r.searchUtils.findLayoutItem(o,w);return w&&i&&window.jimuConfig.isInBuilder?e?(I===v.Default?p.current&&g.current?t=u("linkedToAnd",{where1:u("selected").toLocaleLowerCase(),where2:u("hover").toLocaleLowerCase()}):p.current?t=u("linkedTo",{where:u("hover").toLocaleLowerCase()}):g.current&&(t=u("linkedTo",{where:u("selected").toLocaleLowerCase()})):I===v.Hover?h.current&&g.current?t=u("linkedToAnd",{where1:u("default").toLocaleLowerCase(),where2:u("selected").toLocaleLowerCase()}):h.current?t=u("linkedTo",{where:u("default").toLocaleLowerCase()}):g.current&&(t=u("linkedTo",{where:u("selected").toLocaleLowerCase()})):h.current&&p.current?t=u("linkedToAnd",{where1:u("default").toLocaleLowerCase(),where2:u("hover").toLocaleLowerCase()}):h.current?t=u("linkedTo",{where:u("default").toLocaleLowerCase()}):p.current&&(t=u("linkedTo",{where:u("hover").toLocaleLowerCase()})),void K(t)):(t=u("isolate"),void K(t)):(t="",void K(t))},ce=o.hooks.useEventCallback(e=>{const t=f.jimuForBuilderLib.getAppConfigAction(),i=le(),s=r.searchUtils.findLayoutItem(i,w);if(!s)return;const n=i.widgets[y].layouts[I][Y],l=t.duplicateLayoutItemInSameLayout({layoutId:n,layoutItemId:s.id});t.editLayoutItemProperty({layoutId:n,layoutItemId:l},"bbox",s.bbox).removeLayoutItem({layoutId:n,layoutItemId:s.id},!1),t.exec(),(0,o.getAppStore)().dispatch(o.appActions.selectionChanged({layoutId:n,layoutItemId:l})),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}),ue=o.hooks.useEventCallback((e,t,o)=>{let i=f.jimuForBuilderLib.getAppConfigAction();const s=r.searchUtils.findLayoutItem(i.appConfig,w);if(!s)return;let n=i.appConfig;const l=r.searchUtils.findLayoutId(b[I],Y,n.mainSizeMode),a=r.searchUtils.findLayoutId(b[t],Y,n.mainSizeMode);if(o){const e=f.widgetModules.searchUtils,t=s.widgetId,o=n.widgets[t].parent[Y],r=o.find(e=>e.layoutId===l),d=o.find(e=>e.layoutId===a),c=e.findLayoutItem(n,r);i.editLayoutItemProperty(d,"bbox",c.bbox).editLayoutItemProperty(d,"setting",c.setting)}else{const e=f.jimuForBuilderLib.LayoutServiceProvider.getService(n,a).createBlankItem(n,a);n=e[0];const t=e[1],o={layoutId:a,layoutItemId:t},d=r.searchUtils.findLayoutItem(n,{layoutId:l,layoutItemId:s.id});n=f.jimuForBuilderLib.widgetService.addParent(n,s.widgetId,o,Y),i=f.jimuForBuilderLib.getAppConfigAction(n),i.editLayoutItemProperty(o,"bbox",d.bbox).editLayoutItemProperty(o,"setting",d.setting).editLayoutItemProperty(o,"type",d.type).editLayoutItemProperty(o,"widgetId",d.widgetId).adjustOrderOfItem(o,-1)}i.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),oe()});return(0,t.jsx)(z,{children:(0,t.jsx)(O,{placement:"left-start",trapFocus:!1,autoFocus:!1,css:o.css`
        .${F} &,
        .${H} &,
        .${$} & {
          &.popper {
            display: none;
          }
        }
      `,reference:S,offset:G,modifiers:_,open:V,children:(0,t.jsxs)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:o.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,children:[(0,t.jsx)(P,{active:I===v.Default,onClick:e=>{ie(e,v.Default)},children:u("default")}),(null===(l=null===(n=R.cardConfigs)||void 0===n?void 0:n[v.Hover])||void 0===l?void 0:l.enable)&&(0,t.jsx)(P,{active:I===v.Hover,className:"mt-1",onClick:e=>{ie(e,v.Hover)},children:u("hover")}),(null===(c=null===(d=null==R?void 0:R.cardConfigs)||void 0===d?void 0:d[v.Selected])||void 0===c?void 0:c.selectionMode)!==a.None&&(0,t.jsx)(P,{active:I===v.Selected,className:"mt-1",onClick:e=>{ie(e,v.Selected)},children:u("selected")}),((t,o,i)=>{var s;const n=m.current&&m.current.length>0,r=(null===(s=null==i?void 0:i.cardConfigs[I])||void 0===s?void 0:s.listLayout)||e.CUSTOM;return!o&&(n||t)&&r===e.CUSTOM})(q,x,R)&&(0,t.jsx)(j,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:J,toggleType:"default",direction:"left",toggleArrow:!1,toggleContent:e=>q?(0,t.jsx)(M,{size:16}):(0,t.jsx)(D,{size:16}),modifiers:U,items:(0,o.Immutable)(m.current)})]})})})},H=16;const $=o.ReactRedux.connect((e,t)=>{const{appMode:i}=t;if(!window.jimuConfig.isInBuilder||i===o.AppMode.Run)return{selection:void 0};return{selection:0===t.itemIdex&&t.selectionIsInList&&e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection}})(class extends w{constructor(i){super(i),this.lastResizeCall=null,this.updateLayoutEntryWhenLayoutIdChange=e=>{this.getLayoutIdForListItem(this.props)!==this.getLayoutIdForListItem(e)&&this.setState({showLayoutEntry:!1},()=>{this.setState({showLayoutEntry:!0})})},this.getNewCardSize=(e,t=!1)=>{const{config:o,isWidthPercentage:i}=this.props,{layoutType:s,horizontalSpace:n,gridItemSizeRatio:r,keepAspectRatio:l}=o;let a,d=e.right-e.left;return!t&&i&&(d=e.right-e.left+n),a=s===h.GRID&&l?{width:d,height:d*r}:{width:d,height:e.bottom-e.top},a},this.handleItemClick=e=>{const{selectCard:t}=this.props;e&&e.stopPropagation(),t()},this._renderAction=()=>{const e=[],{theme:i,config:s}=this.props,{layoutType:n,keepAspectRatio:r}=s,l=o.css`
      box-shadow: none;

      &:after {
        position: absolute;
        content: '';
        width: ${12}px;
        height: ${12}px;
        background-color: ${i.sys.color.primary.main};
        border: 2px solid ${i.sys.color.surface.paper};
        border-radius: 50%;
        z-index: ${20};
      }
    `,a=o.css`
      box-shadow: none;
      height: ${H}px;
      left: 0px;
      right: 0px;
      bottom: ${-8}px;
      &:after {
        position: absolute;
        content: '';
        bottom: 50%;
        left: 0;
        right: 0;
        height: 2px;
        background-color: ${i.sys.color.primary.light};
        z-index: ${20};
      }
    `,d=o.css`
      box-shadow: none;
      width: ${H}px;
      top: 0px;
      bottom: 0px;
      right: ${-8}px;
      &:after {
        position: absolute;
        content: '';
        right: 50%;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: ${i.sys.color.primary.light};
        z-index: ${20};
      }
    `,c=o.css`
      position: absolute;
    `,u=o.css`
      width: ${H}px;
      top: ${10}px;
      bottom: ${10}px;
      right: ${-8}px;

      &:after {
        top: 50%;
        right: 50%;
        margin-top: ${-5}px;
        margin-right: ${-5}px;
      }
    `,p=o.css`
      height: ${H}px;
      left: ${10}px;
      right: ${10}px;
      bottom: ${-8}px;

      &:after {
        left: 50%;
        bottom: 50%;
        margin-left: ${-5}px;
        margin-bottom: ${-5}px;
      }
    `;switch(n){case h.Column:e.push((0,t.jsx)("span",{className:"list-card-rnd-resize-left-line",css:[c,d]},"10")),e.push((0,t.jsx)("span",{className:"list-card-rnd-resize-right",css:[c,l,u]},"4"));break;case h.Row:e.push((0,t.jsx)("span",{className:"list-card-rnd-resize-bottom-line",css:[c,a]},"9")),e.push((0,t.jsx)("span",{className:"list-card-rnd-resize-bottom",css:[c,l,p]},"6"));break;case h.GRID:e.push((0,t.jsx)("span",{className:"list-card-rnd-resize-left-line",css:[c,d]},"10")),e.push((0,t.jsx)("span",{className:"list-card-rnd-resize-right",css:[c,l,u]},"4")),r||(e.push((0,t.jsx)("span",{className:"list-card-rnd-resize-bottom-line",css:[c,a]},"9")),e.push((0,t.jsx)("span",{className:"list-card-rnd-resize-bottom",css:[c,l,p]},"6")))}return e},this.getCardToolsStyle=e=>o.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{const{itemIdex:e}=this.props;if(!window.jimuConfig.isInBuilder||e>0)return;const{builderSupportModules:o,datasourceId:i,selectionIsInList:s,selectionIsList:n,hideCardTool:r,selection:l,widgetId:d,config:c,isEditing:u,builderStatus:p,layouts:g,selectCard:h}=this.props,m=null==c?void 0:c.cardConfigs;return u&&(m[v.Hover].enable||m[v.Selected].selectionMode!==a.None)&&(0,t.jsx)(P,{builderSupportModules:o,widgetId:d,selection:l,config:c,selectionIsInList:s,selectionIsList:n,hideCardTool:r,datasourceId:i,reference:this.resizeRef.current,itemIdex:e,builderStatus:p,layouts:g,selectCard:h})},this.isItemAccept=(e,t)=>{const{isEditing:o,builderSupportModules:i,widgetId:s}=this.props;return function(e,t,o,i,s){var n,r;if(!e)return!1;const l=null===(r=null===(n=e.manifest)||void 0===n?void 0:n.properties)||void 0===r?void 0:r.supportRepeat,a=s.jimuForBuilderLib.getAppConfigAction().appConfig,d=s.widgetModules.selectionInList;return o&&l&&(!e.layoutInfo||e.layoutInfo&&d(e.layoutInfo,i,a,!1))}(e,0,o,s,i)},this.getEditorStyle=()=>o.css`
      &.list-card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.getLayoutIdForListItem=t=>{var o;const{config:i,builderStatus:s,layouts:n}=t,{cardConfigs:r}=i,l=n[v.Default],a=n[s];return((null===(o=r[s])||void 0===o?void 0:o.listLayout)||e.CUSTOM)===e.AUTO?l:a},this.state={didMount:!1,showLayoutEntry:!0},this.resizeRef=o.React.createRef()}shouldComponentUpdate(e,t){let i=this.shouldComponentUpdateExcept(e,t,["listStyle","selection"]);if(i=i||!o.utils.isDeepEqual(this.props.listStyle,e.listStyle),!i){const{selectionIsInList:t,selectionIsList:s}=this.props;(s||t)&&(i=!o.utils.isDeepEqual(this.props.selection,e.selection))}return i}componentDidUpdate(e){const{selectionIsInList:t,isEditing:o,config:i,isRTL:s,itemIdex:n}=this.props,{layoutType:r,keepAspectRatio:l,lockItemRatio:a}=i;window.jimuConfig.isInBuilder&&0===n&&this.interactable&&(o&&!t?r===h.GRID?(this.interactable.resizable({edges:{top:!1,left:s,bottom:!l,right:!s}}),this.interactable.resizable(!0)):a?this.interactable.resizable(!1):(this.interactable.resizable({edges:{top:!1,left:r===h.Column&&s,bottom:r===h.Row,right:r===h.Column&&!s}}),this.interactable.resizable(!0)):this.interactable.resizable(!1)),this.updateLayoutEntryWhenLayoutIdChange(e)}componentDidMount(){const{itemIdex:e,toggleCardTool:t,config:o}=this.props,{layoutType:i,keepAspectRatio:s,lockItemRatio:n}=o;if(0===e&&window.jimuConfig.isInBuilder&&this.resizeRef.current){const{interact:e,handleResizeCard:o,isRTL:r}=this.props;this.interactable=e(this.resizeRef.current).resizable({edges:{top:!1,left:(i===h.Column||i===h.GRID)&&r,bottom:i===h.Row&&!n||i===h.GRID&&!s,right:(i===h.Column&&!n||i===h.GRID)&&!r},modifiers:[e.modifiers.restrictEdges({endOnly:!0}),e.modifiers.restrictSize({min:{width:20,height:20}})],inertia:!1,onstart:e=>{const{changeIsResizingCard:t}=this.props;t&&t(!0),e.stopPropagation()},onmove:e=>{e.stopPropagation(),this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall);const i=e.rect,s=this.getNewCardSize(i,!0);t(!0),this.lastResizeCall=requestAnimationFrame(()=>{const e={};o(s,!1,e.top,e.left)})},onend:e=>{e.stopPropagation(),this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall),this.lastResizeCall=requestAnimationFrame(()=>{const i=e.rect,s=this.getNewCardSize(i);o(s,!0);const{changeIsResizingCard:n}=this.props;t(!1),n&&n(!1)})}})}this.setState({didMount:!0})}componentWillUnMount(){this.lastResizeCall&&cancelAnimationFrame(this.lastResizeCall),this.interactable&&(this.interactable.unset(),this.interactable=null)}render(){var i,n;const{active:r,LayoutEntry:l,selectionIsInList:d,isEditing:c,widgetId:u,listStyle:p,builderStatus:g,config:m,dynamicStyleOfCard:f,theme:y,className:S}=this.props,{cardConfigs:b,layoutType:I,lockItemRatio:w}=m,L=m.cardConfigs[v.Selected].selectionMode!==a.None,{didMount:A,showLayoutEntry:x}=this.state,T=(null===(i=b[g])||void 0===i?void 0:i.listLayout)||e.CUSTOM,R=this.getLayoutIdForListItem(this.props),M=C(b[g].backgroundStyle,null==f?void 0:f[g],y),E=T===e.AUTO&&g!==v.Default,O=Object.assign({},s.styleUtils.toCSSStyle(M||{})),j=Object.assign({},s.styleUtils.toCSSStyle({borderRadius:null===(n=null==M?void 0:M.asMutable({deep:!0}))||void 0===n?void 0:n.borderRadius})),D=I!==h.GRID&&w;return(0,t.jsxs)(s.ListGroupItem,{active:L&&r,css:this.getStyle(g),style:Object.assign(Object.assign({},j),p),className:(0,o.classNames)(`list-card-${u}`,S),onClick:this.handleItemClick,role:"listCardEditor",children:[E&&(0,t.jsx)("div",{className:"card-editor-mask position-absolute"}),A&&this.renderCardTools(),(0,t.jsxs)("div",{className:"list-card-content d-flex",style:O,css:this.getEditorStyle(),ref:this.resizeRef,children:[x&&(0,t.jsx)(l,{isItemAccepted:this.isItemAccept,isRepeat:!0,layouts:R,isInWidget:!0}),c&&!d&&!D&&this._renderAction()]})]})}}),F={ButtonGroup:s.ButtonGroup,interact:i.interact,searchUtils:r.searchUtils,getAppConfigAction:n.getAppConfigAction,LayoutServiceProvider:n.LayoutServiceProvider,widgetService:n.widgetService,GLOBAL_DRAGGING_CLASS_NAME:b.GLOBAL_DRAGGING_CLASS_NAME,GLOBAL_RESIZING_CLASS_NAME:b.GLOBAL_RESIZING_CLASS_NAME,GLOBAL_H5_DRAGGING_CLASS_NAME:b.GLOBAL_H5_DRAGGING_CLASS_NAME,withBuilderTheme:L.withBuilderTheme,BuilderDropDown:(0,L.withBuilderTheme)(e=>(0,t.jsx)(I,Object.assign({},e,{withBuilderTheme:L.withBuilderTheme}))),BuilderPopper:(0,L.withBuilderTheme)(s.Popper),BuilderButton:(0,L.withBuilderTheme)(s.Button),ListCardEditor:$,handleResizeCard:(e,t=!1)=>{const o=function(e){const{widgetId:t,browserSizeMode:o,newCardSize:i,widgetConfig:s}=e;let r=null==e?void 0:e.appConfig;r||(r=(0,n.getAppConfigAction)().appConfig);const l=(0,n.getAppConfigAction)(r);return l.editWidgetConfig(t,s.setIn(["cardConfigs",v.Default,"cardSize",o],i).setIn(["cardConfigs",v.Hover,"cardSize",o],i).setIn(["cardConfigs",v.Selected,"cardSize",o],i)),l}(e);o&&o.exec(t)},selectSelf:e=>{!function(e,t){const i=(0,o.getAppStore)().getState().browserSizeMode,s=(0,n.getAppConfigAction)().appConfig,l=r.searchUtils.getContentLayoutInfosInOneSizeMode(s,e,o.LayoutItemType.Widget,i);if(l)if(l.length>1){const e=r.searchUtils.getWidgetIdThatUseTheLayoutId(s,l[0].layoutId);if(e){const a=s.widgets[e];if(a&&a.manifest&&a.manifest.name&&"list"===a.manifest.name){const e=(0,o.getAppStore)().getState().widgetsState&&(0,o.getAppStore)().getState().widgetsState[a.id]&&(0,o.getAppStore)().getState().widgetsState[a.id].builderStatus;if(e){const d=r.searchUtils.findLayoutId(a.layouts[e],i,s.mainSizeMode),c=l.find(e=>e.layoutId===d);t?(0,o.getAppStore)().dispatch(o.appActions.selectionChanged(c)):n.builderAppSync.publishChangeSelectionToApp(c)}}}}else l.length>0&&(t?(0,o.getAppStore)().dispatch(o.appActions.selectionChanged(l[0])):n.builderAppSync.publishChangeSelectionToApp(l[0]))}(e,!0)},selectionInList:(e,t,i,s=!0)=>{if(!e||!e.layoutItemId||!e.layoutId)return!1;let n;return s?n=r.searchUtils.getRelatedLayoutItemsInWidgetByLayoutInfo(i,e,t,(0,o.getAppStore)().getState().browserSizeMode):(n=[],n.push(...r.searchUtils.getRelatedLayoutItemsInWidgetByLayoutInfo(i,e,t,o.BrowserSizeMode.Large)),n.push(...r.searchUtils.getRelatedLayoutItemsInWidgetByLayoutInfo(i,e,t,o.BrowserSizeMode.Medium)),n.push(...r.searchUtils.getRelatedLayoutItemsInWidgetByLayoutInfo(i,e,t,o.BrowserSizeMode.Small))),n.length>0}}})(),u})())}}});