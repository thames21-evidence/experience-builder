System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-arcgis","jimu-theme"],function(e,t){var l={},o={},i={},n={},r={};return{setters:[function(e){l.jsx=e.jsx,l.jsxs=e.jsxs},function(e){o.AllDataSourceTypes=e.AllDataSourceTypes,o.BaseVersionManager=e.BaseVersionManager,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.DataSourceTypes=e.DataSourceTypes,o.Immutable=e.Immutable,o.React=e.React,o.ReactRedux=e.ReactRedux,o.ServiceManager=e.ServiceManager,o.SessionManager=e.SessionManager,o.UtilityManager=e.UtilityManager,o.WidgetState=e.WidgetState,o.appActions=e.appActions,o.appConfigUtils=e.appConfigUtils,o.classNames=e.classNames,o.css=e.css,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.moduleLoader=e.moduleLoader,o.polished=e.polished},function(e){i.Alert=e.Alert,i.Button=e.Button,i.Checkbox=e.Checkbox,i.Icon=e.Icon,i.Loading=e.Loading,i.LoadingType=e.LoadingType,i.NumericInput=e.NumericInput,i.Option=e.Option,i.Paper=e.Paper,i.Popper=e.Popper,i.Radio=e.Radio,i.SVG=e.SVG,i.Select=e.Select,i.Tab=e.Tab,i.Tabs=e.Tabs,i.TextArea=e.TextArea,i.TextInput=e.TextInput,i.WidgetPlaceholder=e.WidgetPlaceholder,i.defaultMessages=e.defaultMessages},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.MapViewManager=e.MapViewManager,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.colorUtils=e.colorUtils,r.getAppThemeVariables=e.getAppThemeVariables}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=i},22167:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4 4.796 4.796 4 8.02 7.224l3.184-3.184.796.796L8.816 8.02l3.144 3.144-.796.796L8.02 8.816 4.836 12l-.796-.796L7.224 8.02z"></path><path fill="#000" fill-rule="evenodd" d="m0 4 4-4h8l4 4v8l-4 4H4l-4-4zm1 .414L4.414 1h7.172L15 4.414v7.172L11.586 15H4.414L1 11.586z" clip-rule="evenodd"></path></svg>'},29435:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},55886:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M10.167 0H1.833A.845.845 0 0 0 1 .857v10.286c0 .473.373.857.833.857h8.334c.46 0 .833-.384.833-.857V.857A.845.845 0 0 0 10.167 0M2 11V1h8v10zm1.6-8h4.8c.331 0 .6.224.6.5s-.269.5-.6.5H3.6c-.331 0-.6-.224-.6-.5s.269-.5.6-.5m4.8 3H3.6c-.331 0-.6.224-.6.5s.269.5.6.5h4.8c.331 0 .6-.224.6-.5S8.731 6 8.4 6" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=n},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=l},68108:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#C5C5C5" fill-rule="evenodd" d="M2.4.8V4h-.8A1.6 1.6 0 0 0 0 5.6v3.2a1.6 1.6 0 0 0 1.136 1.532c.249.075.464-.143.464-.403 0-.182-.154-.323-.32-.396A.8.8 0 0 1 .8 8.8V5.6a.8.8 0 0 1 .8-.8h12.8a.8.8 0 0 1 .8.8v3.2a.8.8 0 0 1-.48.733c-.166.073-.32.214-.32.396 0 .26.215.478.464.403A1.6 1.6 0 0 0 16 8.8V5.6A1.6 1.6 0 0 0 14.4 4h-.8V.8a.8.8 0 0 0-.8-.8H3.2a.8.8 0 0 0-.8.8m10.4 0H3.2V4h9.6z" clip-rule="evenodd"></path><path fill="#C5C5C5" d="M5.2 10.4a.4.4 0 0 0 0 .8h5.6a.4.4 0 0 0 0-.8zM5.2 12.8a.4.4 0 0 0 0 .8h3.2a.4.4 0 0 0 0-.8z"></path><path fill="#C5C5C5" fill-rule="evenodd" d="M2.4 15.2V8.8H2A.4.4 0 0 1 2 8h12a.4.4 0 0 1 0 .8h-.4v6.4a.8.8 0 0 1-.8.8H3.2a.8.8 0 0 1-.8-.8m10.4-6.4v6.4H3.2V8.8z" clip-rule="evenodd"></path><path fill="#C5C5C5" d="M12 6c0-.22.18-.4.4-.4h.8a.4.4 0 0 1 0 .8h-.8A.4.4 0 0 1 12 6"></path></svg>'},79244:e=>{"use strict";e.exports=o},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'}},t={};function a(l){var o=t[l];if(void 0!==o)return o.exports;var i=t[l]={exports:{}};return e[l](i,i.exports,a),i.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var s={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(s),a.d(s,{__set_webpack_public_path__:()=>_t,default:()=>Bt});var e=a(67386),t=a(79244),l=a(14321),o=a(62686);const i="CIMMarkerNorthArrow",n={color:"#000",size:"4px"};var r,u,d;!function(e){e.ExportWebMap="ExportWebMap",e.GetLayoutTemplatesInfo="GetLayoutTemplatesInfo",e.GetReportTemplatesInfo="GetReportTemplatesInfo"}(r||(r={})),function(e){e.CurrentMapExtent="CURRENT MAP EXTENT",e.CurrentMapScale="CURRENT MAP SCALE",e.SetMapScale="SET MAP SCALE"}(u||(u={})),function(e){e.Point="POINT",e.Inch="INCH",e.Centimeter="CENTIMETER",e.Millimeter="MILLIMETER"}(d||(d={}));const c={layoutOptions:{customTextElements:[],hasAuthorText:!0,hasCopyrightText:!0,hasLegend:!0,hasTitleText:!0},mapSurroundInfos:[],pageSize:null,pageUnits:null,webMapFrameSize:null},p={scalePreserved:!1,outScale:36978595.474472,layoutOptions:{titleText:"ArcGIS Web Map"},exportOptions:{dpi:96},printExtentType:u.CurrentMapExtent,attributionVisible:!1,forceFeatureAttributes:!0,wkid:null,wkidLabel:null,enableTitle:!0,legendEnabled:!0,enableMapPrintExtents:!0,enableOutputSpatialReference:!0,enableQuality:!0,enableFeatureAttribution:!0,enableMapSize:!0,overrideCommonSetting:!1,enableAuthor:!0,enableCopyright:!0,enableLegend:!0,enableScalebarUnit:!0,enableCustomTextElements:!0};var v,m,h,f,y,g,x,w,b;!function(e){e.LayoutTemplate="Layout Template",e.ReportTemplate="Report Template"}(v||(v={})),function(e){e.Classic="CLASSIC",e.Compact="COMPACT"}(m||(m={})),function(e){e.OrganizationService="ORGANIZATION SERVICE",e.Customize="CUSTOMIZE"}(h||(h={})),function(e){e.OrganizationTemplate="ORGANIZATION TEMPLATE",e.Customize="CUSTOMIZE"}(f||(f={})),function(e){e.Loading="LOADING",e.Success="SUCCESS",e.Error="ERROR"}(y||(y={})),function(e){e.PrintTemplate="PRINT TEMPLATE",e.PrintResult="PRINT RESULT"}(g||(g={})),function(e){e.ServiceLayout="Service Layout",e.CustomLayout="Custom Layout"}(x||(x={})),function(e){e.RPTT="RPTT",e.RPTX="RPTX"}(w||(w={})),function(e){e.ServiceReport="Service Report",e.CustomReport="Custom Report"}(b||(b={}));var S=a(68108),I=a.n(S);const T={_widgetLabel:"Print",printPlaceholder:"Select or switch to a webmap to enable print.",chooseMapTip:"Please select a map with 2D data.",chooseUseUtility:"Please select utility.",printTemplate:"Print template",printResult:"Print result",previewPrint:"Preview print extents",fileFormat:"File format",mapPrintingExtents:"Map printing extents",outputSpatialReference:"Output spatial reference",printQuality:"Print quality",featureAttribution:"Feature attribution",selectEditableSettings:"Select editable settings",currentMapExtent:"Current map extent",currentMapScale:"Current map scale",setMapScale:"Set map scale",useCurrentScale:"Use current scale",wellKnownId:"Enter a well-known ID ({wkid})",allowEditing:"Select settings that allow editing at runtime",includeAttribution:"Include attribution",includeAttributes:"Include attributes",includeLegend:"Include legend",templateConfiguration:"Template configuration",templateName:"Template name",printLayout:"Layout",MapOnlyOptions:"Map-only options",LayoutOptions:"Layout options",mapSize:"Map size",spatialReference:"Output spatial reference {WKID}",printAuthor:"Author",printCopyright:"Copyright",scaleBarUnit:"Scalebar unit",mapAttribution:"Map attribution",resultEmptyMessage:"Your printed files will appear here.",northArrow:"North arrow",includeNorthArrow:"Include north arrow",resultsNumber:"Results {number}",wkidPlaceholder:"Basemap: {wkid}",printing:"Printing.",printSuccess:"Print completed successfully.",printError:"Printing failed."};var O=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};const j=e=>O(void 0,void 0,void 0,function*(){return J(e).then(e=>t.ServiceManager.getInstance().fetchArcGISServerInfo(e).then(e=>Promise.resolve(null==e?void 0:e.owningSystemUrl),e=>Promise.reject(new Error(e))))}),C=(e,t,l)=>O(void 0,void 0,void 0,function*(){return J(t).then(t=>B(t,l,e))});const M=(e,t,l)=>O(void 0,void 0,void 0,function*(){const o=U(null==t?void 0:t.utilityId);return ie(e).then(i=>{let n=l;return B(e,v.LayoutTemplate).then(r=>O(void 0,void 0,void 0,function*(){let a;if(i.supportCustomReport||i.supportReport){const l=(yield B(e,v.ReportTemplate))||[],o=P(l);n=n.set("reportTemplateChoiceList",o).set("defaultReportTemplate",null==i?void 0:i.defaultReportTemplate).set("defaultCustomReportItem",null==i?void 0:i.defaultCustomReportItem),a=yield R(l,i,t)}const s=yield L(i,t),u={templateTaskInfo:r,templatesInTask:null==i?void 0:i.templates,reportOption:a,defaultLayoutOptionInfo:s,printTemplateType:null==l?void 0:l.printTemplateType,printServiceType:o},d=E(u),c=k(null==i?void 0:i.templates,d);return n=n.set("printCustomTemplate",d).set("useUtility",t).set("formatList",null==i?void 0:i.formatList).set("defaultFormat",null==i?void 0:i.defaultFormat).set("layoutChoiceList",c).set("supportCustomLayout",i.supportCustomLayout||!1).set("supportReport",i.supportReport||!1).set("supportCustomReport",i.supportCustomReport||!1).setIn(["commonSetting","forceFeatureAttributes"],i.supportReport||i.supportCustomReport||!1),Promise.resolve(n)}))})}),L=(e,t)=>O(void 0,void 0,void 0,function*(){var l;const o={layoutTypes:x.ServiceLayout};if((null==e?void 0:e.supportCustomLayout)&&(null==e?void 0:e.defaultCustomLayoutItem)){const i=yield C(null===(l=null==e?void 0:e.defaultCustomLayoutItem)||void 0===l?void 0:l.id,t,v.ReportTemplate),n=null==i?void 0:i[0];o.customLayoutItem=null==e?void 0:e.defaultCustomLayoutItem,o.templateInfo=n}return Promise.resolve(o)}),R=(e,t,l)=>O(void 0,void 0,void 0,function*(){var o,i,n,r,a;if(!(null==t?void 0:t.supportCustomReport)||!(null==t?void 0:t.supportReport))return null;const s={reportTypes:b.ServiceReport};if((null==t?void 0:t.supportReport)&&(null==t?void 0:t.defaultReportTemplate)){let l;null==e||e.forEach(e=>{(null==e?void 0:e.reportTemplate)===(null==t?void 0:t.defaultReportTemplate)&&(l=null==e?void 0:e.reportOptions)}),s.report=null==t?void 0:t.defaultReportTemplate,s.reportOptions=l}if((null==t?void 0:t.supportCustomReport)&&(null==t?void 0:t.defaultCustomReportItem)){const e=yield C(null===(o=null==t?void 0:t.defaultCustomReportItem)||void 0===o?void 0:o.id,l,v.ReportTemplate),u=null===(i=null==e?void 0:e[0])||void 0===i?void 0:i.reportOptions;s.customReportItem={id:null===(n=null==t?void 0:t.defaultCustomReportItem)||void 0===n?void 0:n.id,title:(null===(r=null==e?void 0:e[0])||void 0===r?void 0:r.reportTemplate)||(null===(a=null==t?void 0:t.defaultCustomReportItem)||void 0===a?void 0:a.id)},s.reportOptions=u,s.reportTypes=b.CustomReport}return Promise.resolve(s)}),P=e=>{if(!e)return[];return e.filter(e=>function(e){if(!e)return null;let t=w.RPTX;const l=(null==e?void 0:e.reportSectionOverrides)||{};return Object.keys(l).forEach(e=>{const o=l[e];((null==o?void 0:o.fieldElements)||(null==o?void 0:o.fieldLabelElements))&&(t=w.RPTT)}),t}(null==e?void 0:e.reportOptions)===w.RPTX)},N=(e,t)=>{var l,o;if(!t)return e;const i=null===(l=null==t?void 0:t.customTextElements)||void 0===l?void 0:l.map(e=>{const t={};for(const l in e)t[l]=!0;return t}),n=A(t);return e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,e.layoutOptions.customTextElements=(null==t?void 0:t.customTextElements)||[],e.layoutOptions.elementOverrides=n,e.customTextElementEnableList=i||[],e.enableNorthArrow=!!H(n),e.enableLegend=e.hasLegend,e.enableAuthor=e.hasAuthorText,e.enableCopyright=e.hasCopyrightText,e.enableScalebarUnit=!0,e.hasLegend&&(null==e?void 0:e.layoutOptions)&&(e.layoutOptions.legendLayers=[]),(null===(o=e.layoutOptions)||void 0===o?void 0:o.scalebarUnit)||(e.layoutOptions.scalebarUnit="Miles"),e},E=e=>{const{templateTaskInfo:t,templatesInTask:l,reportOption:o,defaultLayoutOptionInfo:i,printServiceType:n,printTemplateType:r}=e,a=l?le(l,n,r):[];return null==a?void 0:a.map(e=>{var l;let n;if(t&&0!==(null==t?void 0:t.length)?t.forEach(t=>{e.label===t.layoutTemplate&&(n=t)}):n=c,(null==e?void 0:e.layout)&&(e.layout=$(null==e?void 0:e.layout)),(null==e?void 0:e.format)&&(e.format=null===(l=null==e?void 0:e.format)||void 0===l?void 0:l.toLowerCase()),(null==n?void 0:n.webMapFrameSize)&&(e.mapFrameSize=null==n?void 0:n.webMapFrameSize,e.mapFrameUnit=null==n?void 0:n.pageUnits),(e=N(e,null==n?void 0:n.layoutOptions)).mapFrameUnit=null==n?void 0:n.pageUnits,e.selectedFormatList=[null==e?void 0:e.format],"boolean"!=typeof e.showLabels&&(e.showLabels=!0),o&&((null==o?void 0:o.customReportItem)&&(e.customReportItem=null==o?void 0:o.customReportItem),(null==o?void 0:o.report)&&(e.report=null==o?void 0:o.report),(null==o?void 0:o.reportOptions)&&(e.reportOptions=null==o?void 0:o.reportOptions),(null==o?void 0:o.reportTypes)&&(e.reportTypes=null==o?void 0:o.reportTypes)),i){(null==i?void 0:i.layoutTypes)&&(e.layoutTypes=null==i?void 0:i.layoutTypes),(null==i?void 0:i.customLayoutItem)&&(e.customLayoutItem=null==i?void 0:i.customLayoutItem);const t=null==i?void 0:i.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=null==t?void 0:t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=null==t?void 0:t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=null==t?void 0:t.webMapFrameSize))}return e})},A=e=>{const t=(null==e?void 0:e.mapSurroundInfos)||[],l={};return null==t||t.forEach(e=>{e.type===i&&(e.visible=!0),l[e.name]=e}),l},k=(e,t)=>(null==e?void 0:e.map(e=>{e.layoutTemplate=$(null==e?void 0:e.layout);const l=W(null==e?void 0:e.layout);return null==t||t.forEach(t=>{(null==e?void 0:e.layout)===(null==t?void 0:t.layout)&&(e.mapFrameSize=null==t?void 0:t.mapFrameSize,e.mapFrameUnit=null==t?void 0:t.mapFrameUnit,e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,!l&&(e.layoutOptions=null==t?void 0:t.layoutOptions),e.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e.enableNorthArrow=null==t?void 0:t.enableNorthArrow)}),e}))||[],U=e=>{const l=t.UtilityManager.getInstance().getUtilityJson(e);return"org"===(null==l?void 0:l.source)?h.OrganizationService:h.Customize};var D,V=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};!function(e){e.AsynchronousSubmit="esriExecutionTypeAsynchronous",e.SynchronousExecute="esriExecutionTypeSynchronous"}(D||(D={}));const z=(e,l)=>{let o=l;return(null==e?void 0:e.exportOptions)&&(o=o.set("exportOptions",Object.assign(Object.assign({},e.exportOptions||{}),(null==l?void 0:l.exportOptions)||{}))),(null==e?void 0:e.layoutOptions)&&(null==l?void 0:l.layoutOptions)&&(o=o.set("layoutOptions",Object.assign(Object.assign({},(null==e?void 0:e.layoutOptions)||{}),(null==l?void 0:l.layoutOptions)||{}))),(0,t.Immutable)(Object.assign(Object.assign({},e),o))},F=(e,t)=>{let l;return null==e||e.forEach((e,o)=>{(null==e?void 0:e.templateId)===t&&(l=o)}),l},$=e=>e,W=e=>"map-only"===(e=>{var t,l;return null===(l=null===(t=null==e?void 0:e.replace(/\_/gi,"-"))||void 0===t?void 0:t.replace(/\s+/gi,"-"))||void 0===l?void 0:l.toLowerCase()})(e),G=(e,t)=>{let l=!1;return null==e||e.forEach(e=>{(null==e?void 0:e.templateId)===t&&(l=!0)}),l},J=e=>V(void 0,void 0,void 0,function*(){return t.UtilityManager.getInstance().getUrlOfUseUtility(e).then(e=>Promise.resolve(e))});function B(e,l,o){return V(this,void 0,void 0,function*(){const i={query:{"env:outSR":"","env:processSR":"",returnZ:!1,returnM:!1,returnTrueCurves:!1,returnFeatureCollection:!1,context:"",f:"json"},responseType:"json"},n=yield(a=e,O(void 0,void 0,void 0,function*(){return t.ServiceManager.getInstance().fetchArcGISServerInfo(a).then(e=>Promise.resolve(null==e?void 0:e.owningSystemUrl),e=>Promise.reject(new Error(e)))}));var a;const s=n?t.SessionManager.getInstance().getSessionByUrl(n):null;if(o){const e={id:o};s&&(e.token=s.token),l===v.LayoutTemplate&&(s&&(i.query.token=s.token),i.query.Layout_Item_ID=JSON.stringify(e)),l===v.ReportTemplate&&(i.query.Report_Item_ID=JSON.stringify(e))}return function(e){return V(this,void 0,void 0,function*(){var l;if(!e)return Promise.resolve(null);const o=`${null===(l=e.split("/GPServer"))||void 0===l?void 0:l[0]}/GPServer`,i=function(){var e,l;const o=(null===(e=(0,t.getAppStore)().getState().portalSelf)||void 0===e?void 0:e.helperServices)||{};return(null===(l=null==o?void 0:o.asyncPrintTask)||void 0===l?void 0:l.url)||null}(),n=(yield _(o))||{},{tasks:a,supportedOperations:s,executionType:u}=n;let d=u,c=null,p=null,v=null,m=null;const h=null==a?void 0:a.map(e=>function(e,l){return V(this,void 0,void 0,function*(){if(!e||!l)return Promise.resolve(null);const o=`${l}/${e}`,i={query:{f:"json"},responseType:"json"};return(0,t.loadArcGISJSAPIModules)(["esri/request"]).then(e=>{const[t]=e;return t(o,i).then(e=>{var t;const l=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.name;return Promise.resolve(l)})})})}(e,o).then(t=>{t===r.GetLayoutTemplatesInfo&&(c=`${o}/${e}`,p=`${c}/${s}`),t===r.GetReportTemplatesInfo&&(v=`${o}/${e}`,m=`${o}/${e}/${s}`)}));if(yield Promise.all(h),i===e){const e=yield function(e){return V(this,void 0,void 0,function*(){const t=`${null==e?void 0:e.split("/arcgis/")[0]}/arcgis/rest/services/Utilities/PrintingTools/GPServer`,l=(yield _(t))||{},{tasks:o,supportedOperations:i,executionType:n}=l;let r=null,a=null,s=null;return null==o||o.forEach(e=>{((null==e?void 0:e.includes("Layout"))||(null==e?void 0:e.includes("Layout")))&&(s=e)}),r=`${t}/${s}`,a=`${r}/${i}`,{layoutTemplatesInfoTaskUrl:r,layoutTemplatesInfoRequestUrl:a,executionType:n}})}(o);c=e.layoutTemplatesInfoTaskUrl,p=e.layoutTemplatesInfoRequestUrl,d=e.executionType}return Promise.resolve({url:o,layoutTemplatesInfoTaskUrl:c,layoutTemplatesInfoRequestUrl:p,reportTemplatesInfoTaskUrl:v,reportTemplatesInfoRequestUrl:m,executionType:u,layoutTemplateTaskExecutionType:d})})}(e).then(e=>{const{layoutTemplatesInfoRequestUrl:o,reportTemplatesInfoRequestUrl:n,reportTemplatesInfoTaskUrl:r,executionType:a,layoutTemplatesInfoTaskUrl:s,layoutTemplateTaskExecutionType:u}=e,d=l===v.ReportTemplate?n:o,c=l===v.LayoutTemplate?u:a;return d?(0,t.loadArcGISJSAPIModules)(["esri/request"]).then(e=>{const[t]=e;return t(d,i).then(e=>V(this,void 0,void 0,function*(){var o,n,a;if(c===D.AsynchronousSubmit){const n=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.jobId;return function(e,t,l,o){return V(this,void 0,void 0,function*(){const i=`${e}/jobs/${t}/results/Output_JSON`;return new Promise((e,t)=>{let n=0;const r=10,a=3e3,s=()=>{o(i,l).then(t=>{var l;(null===(l=null==t?void 0:t.data)||void 0===l?void 0:l.value)?e(t.data.value):(n++,n<r?setTimeout(s,a):e([]))}).catch(e=>{t(new Error(e))})};s()})})}(l===v.ReportTemplate?r:s,n,i,t)}return Promise.resolve((null===(a=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.results[0])||void 0===a?void 0:a.value)||[])}),e=>Promise.reject(new Error(e))).catch(e=>Promise.reject(new Error(e)))}):Promise.resolve(null)})})}function _(e){return V(this,void 0,void 0,function*(){var l;if(!e)return Promise.resolve(null);const o=`${null===(l=e.split("/GPServer"))||void 0===l?void 0:l[0]}/GPServer`,i={query:{f:"json"},responseType:"json"};return(0,t.loadArcGISJSAPIModules)(["esri/request"]).then(e=>{const[t]=e;return t(o,i).then(e=>{var t,l;const o=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.tasks,i=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.executionType,n=i===D.SynchronousExecute?"execute":"submitJob";return Promise.resolve({tasks:o,supportedOperations:n,executionType:i})})})})}function q(e){return[{value:"Miles",label:e("unitsLabelMiles")},{value:"Kilometers",label:e("unitsLabelKilometers")},{value:"Meters",label:e("unitsLabelMeters")},{value:"Feet",label:e("unitsLabelFeet")}]}function H(e={}){var t;let l=null;for(const o in e)(null===(t=null==e?void 0:e[o])||void 0===t?void 0:t.type)===i&&(l=o);return l}function K(e,t){const l=Q(e,t),{reportsAvailable:o,elementOverridesAvailable:i}=l;return o&&i}function Q(e,t){var l;const{defaultCustomReportItem:o,defaultReportTemplate:i,supportCustomReport:n,supportReport:r}=t,a=function(e){const{reportOptions:t,defaultCustomReportItem:l,defaultReportTemplate:o,supportCustomReport:i,supportReport:n,reportTypes:r}=e;if(!i&&!n)return!0;switch(r){case b.CustomReport:return t?X(t):!l&&!o;case b.ServiceReport:return t?X(t):!o}}({defaultCustomReportItem:o,defaultReportTemplate:i,supportCustomReport:n,supportReport:r,reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes});return{reportsAvailable:a,elementOverridesAvailable:function(e){if(!e)return!0;let t=!0;for(const l in e){Z(e[l])||(t=!1)}return t}(null===(l=null==e?void 0:e.layoutOptions)||void 0===l?void 0:l.elementOverrides)}}function Z(e){let t=!0;if(e.visible&&("CIMTableFrame"===e.type||"CIMGraphicElement"===e.type)){const l=null==e?void 0:e.exbDataSource;l&&0!==(null==l?void 0:l.length)||(t=!1)}return t}function X(e){if(!(null==e?void 0:e.reportSectionOverrides))return!1;const t=(null==e?void 0:e.reportSectionOverrides)||{};let l=!0;return Object.keys(t).forEach((e,o)=>{var i,n;const r=t[e];if((null==r?void 0:r.exbDatasource)&&0!==(null===(i=null==r?void 0:r.exbDatasource)||void 0===i?void 0:i.length)){const e=Y()||[],t=null===(n=null==r?void 0:r.exbDatasource)||void 0===n?void 0:n[0],o=(null==t?void 0:t.rootDataSourceId)||(null==t?void 0:t.mainDataSourceId);(null==e?void 0:e.includes(o))||(l=!1)}else l=!1}),l}const Y=()=>{var e;const l=(0,t.getAppStore)().getState(),o=(null==l?void 0:l.appStateInBuilder)?null===(e=null==l?void 0:l.appStateInBuilder)||void 0===e?void 0:e.appConfig:null==l?void 0:l.appConfig,i=null==o?void 0:o.dataSources,n=[];return Object.keys(i).forEach(e=>{const l=i[e];(null==l?void 0:l.type)!==t.DataSourceTypes.WebScene&&n.push(l.id)}),n.length>0?(0,t.Immutable)(n):void 0},ee=(e,t)=>{if(e&&0!==(null==e?void 0:e.length)&&t){let l=!0;const o=te(null==t?void 0:t[0])||[],i=null==e?void 0:e[0];if(null==i?void 0:i.dataViewId)return!1;const n=(null==i?void 0:i.rootDataSourceId)||(null==i?void 0:i.mainDataSourceId);return(null==o?void 0:o.includes(n))||(l=!1),l}return!0},te=e=>{var l,o,i;const n=(0,t.getAppStore)().getState(),r=(null==n?void 0:n.appStateInBuilder)?null===(l=null==n?void 0:n.appStateInBuilder)||void 0===l?void 0:l.appConfig:null==n?void 0:n.appConfig,a=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[e],s=[],u=t.DataSourceManager.getInstance();return null===(i=null==a?void 0:a.useDataSources)||void 0===i||i.forEach(e=>{const l=u.getDataSource(e.dataSourceId);(null==l?void 0:l.type)===t.DataSourceTypes.WebMap&&s.push(e.dataSourceId)}),s.length>0?(0,t.Immutable)(s):void 0},le=(e,l,o)=>{const i=e.map(e=>{var l;let o=(0,t.Immutable)(e);return o=o.set("layout",$(null==e?void 0:e.layout)),o=o.setIn(["layoutOptions","scalebarUnit"],"Miles").setIn(["layoutOptions","legendLayers"],null),o=o.set("reportTypes",b.ServiceReport).set("layoutTypes",x.ServiceLayout),W(null==o?void 0:o.layout)&&(o=o.set("exportOptions",Object.assign({width:800,height:1100},null==e?void 0:e.exportOptions))),null===(l=z((0,t.Immutable)(p),(0,t.Immutable)(o)))||void 0===l?void 0:l.asMutable({deep:!0})});return oe(i,l,o)},oe=(e,t,l)=>{const o=((e,t)=>e===h.Customize||t===f.Customize?"custom":"org")(t,l);return e.map((e,t)=>(e.templateId=`config_${o}_${t}`,e))};function ie(e){const l={query:{f:"json"},responseType:"json"};return(0,t.loadArcGISJSAPIModules)(["esri/request"]).then(t=>{const[o]=t;return o(e,l).then(e=>function(e){return V(this,void 0,void 0,function*(){let t=!1,l=!1;const o=(null==e?void 0:e.parameters)||[],i="web_map_as_json",n="output_file",r="layout_item_id",a="layout_template",s="report_template",u="report_item_id";let d=[],c=[],p="pdf",v=!1,m=!1,h=!1,f="",y="",g="",x="";return null==o||o.forEach(e=>{var t,l;if("Format"===e.name){const o=(null===(t=null==e?void 0:e.choiceList)||void 0===t?void 0:t.map(e=>null==e?void 0:e.toLowerCase()))||[];if(e.defaultValue)p=null===(l=e.defaultValue)||void 0===l?void 0:l.toLowerCase();else if((null==o?void 0:o.length)>0){const e=[];null==o||o.forEach(t=>{(t.includes("pdf")||t.includes("png"))&&e.push(t)}),p=(null==e?void 0:e[0])||o[0]}c=o}}),null==o||o.forEach(e=>{if("Layout_Template"===e.name){const t=e.choiceList,l=e.defaultValue;t?d=null==t?void 0:t.map(e=>ae(e,c,p)):d.push(ae(l,c,p))}e.name.toLowerCase()===a&&(f=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===r&&(v=!0,y=null==e?void 0:e.defaultValue),e.name.toLowerCase()===s&&(h=!0,g=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===u&&(m=!0,x=null==e?void 0:e.defaultValue),"string"==typeof e.name&&e.name.toLowerCase()===i&&(t=!0),"string"==typeof e.name&&e.name.toLowerCase()===n&&(l=!0)}),Promise.resolve({templates:d,formatList:c,defaultFormat:p,defaultReportTemplate:g,defaultCustomReportItem:x,hasWebmapParam:t,hasOutputParam:l,supportCustomLayout:v,supportReport:h,supportCustomReport:m,defaultLayout:f,defaultCustomLayoutItem:y})})}(null==e?void 0:e.data))})}function ne(e,l,o){var i,n,r,a;const s=t.UtilityManager.getInstance().utilityHasSignInError(e);let u=404===(null===(i=null==o?void 0:o.details)||void 0===i?void 0:i.httpStatus);400===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus)&&(null===(a=null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.message)||void 0===a?void 0:a.includes("Item does not exist"))&&(u=!0),s||u?(l&&l(!0),t.UtilityManager.getInstance().reportUtilityState(e,!1,s)):(l&&l(!1),t.UtilityManager.getInstance().reportUtilityState(e,!0))}function re(e){const l=t.DataSourceManager.getInstance().getDataSource(e);return l&&l.supportSpatialInfo&&!l.supportSpatialInfo()}function ae(e,t,l){const o=W(e)?{}:{layoutOptions:{legend:!1}},i=l||t[0]||"PNG32";return Object.assign({label:e,layout:e,format:i},o)}var se=a(30655),ue=a.n(se),de=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const ce=l=>{const o=window.SVG,{className:i}=l,n=de(l,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:r,src:ue()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var pe=a(94064),ve=a.n(pe),me=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const he=l=>{const o=window.SVG,{className:i}=l,n=me(l,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:r,src:ve()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var fe=a(29435),ye=a.n(fe),ge=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const xe=l=>{const o=window.SVG,{className:i}=l,n=ge(l,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:r,src:ye()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var we=a(1888);const be=(e,t)=>{if(t=t||.3,!e)return null;let l;if(e.includes("var(")||e.includes("#")){const o=we.colorUtils.parseThemeVariable(e,(0,we.getAppThemeVariables)());l=we.colorUtils.rgba(o,t)}if(e.includes("rgba")){const o=e.split("(")[1].split(")")[0].split(","),i=o[o.length-1];l=Number(i)>.6?we.colorUtils.rgba(e,t):e}return Se(l)},Se=e=>{if(!e||!e.startsWith("rgba"))return[];return e.split("(")[1].split(")")[0].split(",").map(e=>e.trim())};var Ie=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};const{useState:Te,useEffect:Oe,useRef:je,useCallback:Ce}=t.React,Me=o=>{var i,n,r,a;const{id:s,scale:d,printExtentType:c,jimuMapView:p,selectedTemplate:v,className:m,config:h,updatePreviewOverlayItem:f}=o,y=t.hooks.useTranslation(T,l.defaultMessages),g=t.ReactRedux.useSelector(e=>{var t;return null===(t=e.widgetsRuntimeInfo)||void 0===t?void 0:t[s]}),[x,w]=Te(!1),[b,S]=Te(null===(i=null==p?void 0:p.view)||void 0===i?void 0:i.extent),[I,O]=Te(null===(n=null==p?void 0:p.view)||void 0===n?void 0:n.scale),[j,C]=Te(!1),M=je(null),L=je(null),R=je(null),P=je(null),N=je(null===(r=null==p?void 0:p.view)||void 0===r?void 0:r.extent),E=je(null===(a=null==p?void 0:p.view)||void 0===a?void 0:a.scale),A=je(!1),k=je(null),U=je(null),D=je(null),V=je(null),z=je(null),F=je(null),$=je(null),G=je(null),J=je(null),B=je(!1),_=je(!1),q=Ce(()=>Ie(void 0,void 0,void 0,function*(){V.current||(V.current=yield(0,t.loadArcGISJSAPIModule)("esri/core/unitUtils")),D.current||(D.current=yield(0,t.loadArcGISJSAPIModule)("esri/core/jsonMap")),z.current||(z.current=yield(0,t.loadArcGISJSAPIModule)("esri/views/overlay/BoxOverlayItem")),_.current=!0,C(!0)}),[]),H=Ce((e=!1)=>{const t=z.current;if(t){if(!M.current||e){const e=K(null==h?void 0:h.previewOutLine);M.current=new t({strokeDash:[5],strokeWidth:e,backgroundFillColor:[0,0,0,0],strokeColor:(null==h?void 0:h.previewOutLine)?be(h.previewOutLine.color,1):[30,144,255,255],fillColor:h.previewBackgroundColor?be(h.previewBackgroundColor,.5):[0,0,0,.5]})}return M.current}},[h.previewOutLine,h.previewBackgroundColor]),K=e=>{if(!e||!e.size)return 2;const t=e.size.toString().toLowerCase();return t.endsWith("px")?parseFloat(t.replace("px","")):t.endsWith("pt")?.75*parseFloat(t.replace("pt","")):parseFloat(t)},Q=Ce(()=>c===u.SetMapScale?d:I,[I,d,c]),Z=Ce((e,t,l)=>{var o,i;const{exportOptions:n}=t;let r=null===(o=null==e?void 0:e.view)||void 0===o?void 0:o.width,a=null===(i=null==e?void 0:e.view)||void 0===i?void 0:i.height;if(null!=n.width&&null!=n.height)if(l)r=n.width,a=n.height;else{const t=((e,t)=>{var l,o,i,n,r;const a=(null===(l=null==e?void 0:e.view)||void 0===l?void 0:l.width)/(null===(o=null==e?void 0:e.view)||void 0===o?void 0:o.height),s=(null==t?void 0:t.width)/(null==t?void 0:t.height),u=null===(i=N.current)||void 0===i?void 0:i.toJSON(),d=(null==u?void 0:u.height)||(null===(n=null==e?void 0:e.view)||void 0===n?void 0:n.height),c=(null==u?void 0:u.width)||(null===(r=null==e?void 0:e.view)||void 0===r?void 0:r.width);let p=d,v=c;return a<s?p=c/s:a>s&&(v=d*s),{width:.9*v,height:.9*p}})(e,n);r=t.width,a=t.height}return{width:r,height:a}},[]),X=Ce((e,t,l)=>{var o;let i=0,n=0;const{convertUnit:r,getMetersPerUnitForSR:a,inchesPerMeter:s,unitType:u}=V.current,d=Q(),c=e.view,p=c.spatialReference,[v,m]=c.state.paddedViewState.size,h=null===(o=t.exportOptions)||void 0===o?void 0:o.dpi,{mapFrameSize:f,mapFrameUnit:y}=null!=t?t:{};let g=!1;if(f&&y){const e=(()=>{const{JSONMap:e}=D.current;return new e({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"})})().fromJSON(y.toLowerCase()),t=p.unit;u(e)===u(t)?(i=r(f[0],e,t),n=r(f[1],e,t)):(g=!0,i=f[0],n=f[1])}if(l&&d){const e=g?Math.min(v/i,m/n):a(p)*s*h;i*=e,n*=e}else if(0===i||0===n)i=v,n=m;else{const e=(v-.1*v)/i,t=(m-.1*m)/n,l=Math.min(e,t);i*=l,n*=l}return{width:i,height:n}},[Q]),Y=Ce(e=>{var t;if(!(null==p?void 0:p.view)||!v)return;const l=v,{layout:o}=l,i=H(e);if(!i||!_.current)return;const n=p.view,[r,a]=n.state.paddedViewState.size,s=n.state.padding,d=null===(t=l.exportOptions)||void 0===t?void 0:t.dpi;let c=0,m=0;const h=W(o),y=(null==l?void 0:l.printExtentType)!==u.CurrentMapExtent,g=Q();let x;h?x=Z(p,l,y):o&&(x=X(p,l,y)),c=null==x?void 0:x.width,m=null==x?void 0:x.height;const w=y&&g?g/p.view.scale:1,b=y&&g?96/d:1;i.boxWidth=c*w*b||r,i.boxHeight=m*w*b||a,s&&(i.padding=s),i.backgroundWidth=null!=r?r:0,i.backgroundHeight=null!=a?a:0,M.current=i,f(i)},[p,v,H,Q,f,Z,X]),ee=Ce(()=>{if(!(null==h?void 0:h.enablePreview))return!1;return!!W(null==v?void 0:v.layout)||!!(null==v?void 0:v.mapFrameSize)},[v,null==h?void 0:h.enablePreview]),te=Ce(()=>{(null==p?void 0:p.view)&&(Y(),p.view.overlay.addItem(M.current),B.current=!0)},[p,Y]),le=Ce(()=>{var e,t;(null==p?void 0:p.view)&&(null===(t=null===(e=p.view)||void 0===e?void 0:e.overlay)||void 0===t||t.removeItem(M.current),B.current=!1)},[p]);G.current=le,J.current=te;const oe=Ce(()=>{var e,t,l,o,i,n;if(!W(null==v?void 0:v.layout))return!1;const r=(null===(e=null==v?void 0:v.exportOptions)||void 0===e?void 0:e.width)!==(null===(l=null===(t=R.current)||void 0===t?void 0:t.exportOptions)||void 0===l?void 0:l.width),a=(null===(o=null==v?void 0:v.exportOptions)||void 0===o?void 0:o.height)!==(null===(n=null===(i=R.current)||void 0===i?void 0:i.exportOptions)||void 0===n?void 0:n.height);return r||a},[v]),ie=Ce(()=>{w(!x),A.current=!x,x?le():te()},[x,te,le]),ne=Ce(()=>{_.current&&(le(),Y(!0),A.current&&te())},[le,te,Y]);$.current=ne,Oe(()=>{P.current=t.lodash.debounce(Y,400)},[Y]),Oe(()=>{j&&p&&!M.current&&P.current()},[j,p]),Oe(()=>{var e,t,l,o,i,n;const r=(null==v?void 0:v.templateId)!==(null===(e=R.current)||void 0===e?void 0:e.templateId),a=(null==v?void 0:v.printExtentType)!==(null===(t=R.current)||void 0===t?void 0:t.printExtentType),s=(null==v?void 0:v.outScale)!==(null===(l=R.current)||void 0===l?void 0:l.outScale),u=(null===(o=null==v?void 0:v.exportOptions)||void 0===o?void 0:o.dpi)!==(null===(n=null===(i=R.current)||void 0===i?void 0:i.exportOptions)||void 0===n?void 0:n.dpi),d=oe();R.current=v,(r||a||s||d||u)&&P.current()},[v,x,oe]),Oe(()=>{b&&P.current()},[b,I,x]),Oe(()=>{_.current&&$.current()},[h.previewBackgroundColor,h.previewOutLine]),Oe(()=>{L.current=g,A.current&&((null==g?void 0:g.state)===t.WidgetState.Hidden||(null==g?void 0:g.state)===t.WidgetState.Closed?G.current():!B.current&&J.current())},[g]),Oe(()=>(q(),()=>{le()}),[q,le]),Oe(()=>(p&&Ie(void 0,void 0,void 0,function*(){return F.current||(F.current=yield(0,t.loadArcGISJSAPIModule)("esri/core/reactiveUtils")),F.current}).then(()=>{var e,l;k.current=null===(e=F.current)||void 0===e?void 0:e.watch(()=>{var e;return null===(e=null==p?void 0:p.view)||void 0===e?void 0:e.extent},()=>{var e,l,o;let i=null;const n=null===(l=null===(e=null==p?void 0:p.view)||void 0===e?void 0:e.extent)||void 0===l?void 0:l.toJSON();n&&(i=JSON.parse(JSON.stringify(n))),S((0,t.Immutable)(i)),N.current=null===(o=null==p?void 0:p.view)||void 0===o?void 0:o.extent},{initial:!0}),U.current=null===(l=F.current)||void 0===l?void 0:l.watch(()=>{var e;return null===(e=null==p?void 0:p.view)||void 0===e?void 0:e.scale},()=>{var e;const t=null===(e=null==p?void 0:p.view)||void 0===e?void 0:e.scale;O(t),E.current=t},{initial:!0})}),()=>{var e,t,l,o,i,n;(null===(e=k.current)||void 0===e?void 0:e.remove)&&(null===(l=null===(t=k.current)||void 0===t?void 0:t.remove)||void 0===l||l.call(t)),(null===(o=U.current)||void 0===o?void 0:o.remove)&&(null===(n=null===(i=U.current)||void 0===i?void 0:i.remove)||void 0===n||n.call(i))}),[p]);const re=t.css`
    .checkbox-con {
      color: inherit;
      font-size: ${t.polished.rem(14)};
      line-height: ${t.polished.rem(22)};
      margin: ${t.polished.rem(4)} 0 ${t.polished.rem(8)} 0;
    }
  `;return(0,e.jsx)("div",{className:m,css:re,children:ee()&&(0,e.jsxs)("div",{title:y("showPrintArea"),"aria-label":y("showPrintArea"),className:"d-flex w-100 align-items-center checkbox-con",onClick:ie,children:[(0,e.jsx)(l.Checkbox,{title:y("showPrintArea"),className:"lock-item-ratio","data-field":"mapSize",checked:x}),(0,e.jsx)("div",{className:"text-left ml-2 text-truncate",children:y("showPrintArea")})]})})},Le=l=>{const{label:o,className:i,children:n,flowWrap:r}=l,a=t.css`
    .title {
      font-size: 14px;
    }
  `;return(0,e.jsxs)("div",{className:(0,t.classNames)("mb-2 align-items-center",{className:i,"d-flex":!r}),css:a,children:[(0,e.jsx)("div",{className:(0,t.classNames)("title flex-grow-1",{"mb-2":r}),children:o}),n]})},Re=t.css`
  & .alert-panel {
    background: none !important;
    border: none !important;
    padding: 0 !important;
  }
`,Pe=o=>{const i=t.hooks.useTranslation(l.defaultMessages),{supportReport:n,supportCustomReport:r,outputDataSourceWarning:a}=o;return(0,e.jsx)("div",{css:Re,children:(n||r)&&!!(null==a?void 0:a.label)&&(0,e.jsx)(Le,{children:(0,e.jsx)(l.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,text:i("outputDataIsNotGenerated",{outputDsLabel:null==a?void 0:a.label,sourceWidgetName:null==a?void 0:a.widgets})})})})};var Ne=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};const Ee=new(0,t.esri.Sanitizer),{useState:Ae,useEffect:ke,useRef:Ue}=t.React,De=o=>{var i,n,r,a,s,d,c;const p=t.hooks.useTranslation(T,l.defaultMessages,t.defaultMessages),v=Ue(null),m=Ue(null),h=Ue(null),f=Ue(!1),y=Ue(null),x=t.css`
    padding-bottom: ${t.polished.rem(16)};
    padding-top: ${t.polished.rem(16)};
    .setting-con {
      overflow-y: auto;
      padding-left: ${t.polished.rem(16)};
      padding-right: ${t.polished.rem(16)};
    }
    .button-radius {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      border-top-right-radius: var(--sys-shape-input-field);
      border-bottom-right-radius: var(--sys-shape-input-field);
    }
    .print-button-con {
      padding-left: ${t.polished.rem(16)};
      padding-right: ${t.polished.rem(16)};
    }
    .collapse-button {
      color: var(--sys-color-surface-paper-text);
    }
    .no-right-padding .jimu-interactive-node{
      padding-right: 0;
    }
    .scalebar-unit {
      width: ${t.polished.rem(160)};
    }
    .map-size-con input {
      width: 100%;
    }
    .wkid-describtion {
      font-size: ${t.polished.rem(12)};
      color: var(--sys-color-surface-paper-tex);
    }
    .wkid-describtion-invalid {
      color: var(--sys-color-error-dark)
    }
    .outscale-con, .dpi-con {
      input {
        border-right: 0;
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      button {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        height: ${t.polished.rem(26)};
        svg {
          margin-right: 0;
        }
      }
    }
    .radio-con, .checkbox-con {
      color: var(--sys-color-surface-paper-tex);
      font-size: ${t.polished.rem(14)};
      line-height: ${t.polished.rem(22)};
      margin: ${t.polished.rem(4)} 0 ${t.polished.rem(8)} 0;
    }
  `,{templateList:w,jimuMapView:b,selectedTemplate:S,id:I,config:O,outputDataSourceWarning:j,confirmPrint:C,views:M,updatePreviewOverlayItem:L,handleSelectedTemplateChange:R,setSelectedTemplateByIndex:P}=o,[N,E]=Ae((null===(i=null==S?void 0:S.layoutOptions)||void 0===i?void 0:i.titleText)||""),[A,k]=Ae((null==S?void 0:S.wkid)||""),[U,D]=Ae(null==S?void 0:S.outScale),[V,z]=Ae((null===(n=null==S?void 0:S.layoutOptions)||void 0===n?void 0:n.authorText)||""),[$,G]=Ae((null===(r=null==S?void 0:S.layoutOptions)||void 0===r?void 0:r.copyrightText)||""),[J,B]=Ae(null===(a=null==S?void 0:S.layoutOptions)||void 0===a?void 0:a.customTextElements),[_,K]=t.React.useState(null===(s=null==S?void 0:S.exportOptions)||void 0===s?void 0:s.dpi),[Q,Z]=t.React.useState(null===(d=null==S?void 0:S.exportOptions)||void 0===d?void 0:d.width),[X,Y]=t.React.useState(null===(c=null==S?void 0:S.exportOptions)||void 0===c?void 0:c.height),[ee,te]=Ae(!1),[le,oe]=t.React.useState(null),[ie,ne]=Ae(null),[re,ae]=Ae(!1),[se,ue]=Ae(!1),[de,pe]=Ae(!1);ke(()=>{var e,t,l,o,i,n,r,a,s,u,d,c;const p=H(null===(e=null==S?void 0:S.layoutOptions)||void 0===e?void 0:e.elementOverrides);E((null===(t=null==S?void 0:S.layoutOptions)||void 0===t?void 0:t.titleText)||""),z((null===(l=null==S?void 0:S.layoutOptions)||void 0===l?void 0:l.authorText)||""),G((null===(o=null==S?void 0:S.layoutOptions)||void 0===o?void 0:o.copyrightText)||""),B(null===(i=null==S?void 0:S.layoutOptions)||void 0===i?void 0:i.customTextElements),k(null==S?void 0:S.wkid),D(null==S?void 0:S.outScale),K(null===(n=null==S?void 0:S.exportOptions)||void 0===n?void 0:n.dpi),Z(null===(r=null==S?void 0:S.exportOptions)||void 0===r?void 0:r.width),Y(null===(a=null==S?void 0:S.exportOptions)||void 0===a?void 0:a.height),ne(p),Ze(ee),ae(!!(null===(s=null==S?void 0:S.layoutOptions)||void 0===s?void 0:s.legendLayers)),ue(!!(null===(c=null===(d=null===(u=null==S?void 0:S.layoutOptions)||void 0===u?void 0:u.elementOverrides)||void 0===d?void 0:d[p])||void 0===c?void 0:c.visible)),v.current=null==S?void 0:S.wkid,(null==S?void 0:S.wkidLabel)?oe(null==S?void 0:S.wkidLabel):m.current&&ve(null==S?void 0:S.wkid).then(e=>{oe(e)})},[S]);const ve=t.React.useCallback(e=>Ne(void 0,void 0,void 0,function*(){if(f.current){const{getSRLabel:t}=m.current;return Promise.resolve(t(e))}return t.moduleLoader.loadModule("jimu-core/wkid").then(t=>{m.current=t,f.current=!0;const{getSRLabel:l}=m.current;return Promise.resolve(l(e))})}),[]),me=t.React.useCallback(e=>e?le:de,[de,le]),fe=e=>Ne(void 0,void 0,void 0,function*(){if(f.current){const{isValidWkid:t}=m.current;return Promise.resolve(t(e))}return t.moduleLoader.loadModule("jimu-core/wkid").then(t=>{m.current=t,f.current=!0;const{isValidWkid:l}=m.current;return Promise.resolve(l(e))})}),ye=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=F(null==w?void 0:w.asMutable({deep:!0}),l);P(o)},ge=t.React.useCallback((e,t)=>{const l=S.setIn(e,t);R(l)},[R,S]),we=()=>{ge(["forceFeatureAttributes"],!(null==S?void 0:S.forceFeatureAttributes))},be=()=>{ge(["attributionVisible"],!(null==S?void 0:S.attributionVisible))},Se=e=>{ge(["layoutOptions","legendLayers"],re?null:[]),ae(!re)},Ie=()=>{var e,t,l;const o=null===(l=null===(t=null===(e=null==S?void 0:S.layoutOptions)||void 0===e?void 0:e.elementOverrides)||void 0===t?void 0:t[ie])||void 0===l?void 0:l.visible;ge(["layoutOptions","elementOverrides",ie,"visible"],!o)},Te=e=>{ge(["layoutOptions","titleText"],e)},Oe=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;E(l)};ke(()=>{S&&b&&je("")},[b]);const je=e=>Ne(void 0,void 0,void 0,function*(){if(!(!e||(yield fe(e)))){k(v.current);const e=yield ve(v.current);return oe(e),!1}v.current=e;const t=e?yield ve(e):"";oe(t),k(e);const l=S.set("wkid",e||"").set("wkidLabel",t||"");R(l)}),Ce=e=>Ne(void 0,void 0,void 0,function*(){if(!e||(yield fe(e))){const t=yield ve(e);oe(t)}else oe(p("invalidWKID"));k(e)}),Re=e=>{ge(["outScale"],e)},De=()=>{var e;const t=null===(e=null==b?void 0:b.view)||void 0===e?void 0:e.scale;D(t),ge(["outScale"],t)},Ve=e=>{D(e)},ze=e=>{ge(["layoutOptions","authorText"],e)},Fe=e=>{if(e<1)return!1;K(parseInt(e))},$e=e=>{if(e<1)return!1;ge(["exportOptions","dpi"],parseInt(e))},We=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;z(l)},Ge=e=>{ge(["layoutOptions","copyrightText"],e)},Je=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;G(l)},Be=e=>{var t;if(!e||Number(e)<1)return Z(null===(t=null==S?void 0:S.exportOptions)||void 0===t?void 0:t.width),!1;ge(["exportOptions","width"],e)},_e=e=>{Z(e)},qe=e=>{var t;if(!e||Number(e)<1)return Y(null===(t=null==S?void 0:S.exportOptions)||void 0===t?void 0:t.height),!1;ge(["exportOptions","height"],e)},He=e=>{Y(e)},Ke=e=>{const t=e.target.value;ge(["format"],t)},Qe=e=>{const t=e.target.value;ge(["layoutOptions","scalebarUnit"],t)},Ze=e=>{const t=it(),{showOutputSpatialReference:l}=t;e&&l&&!(null==S?void 0:S.wkidLabel)&&(Ne(void 0,void 0,void 0,function*(){const e=yield ve(null==S?void 0:S.wkid);oe(e)}),tt(b))},Xe=()=>{Ze(!ee),te(!ee)},Ye=e=>{var t;if(e===u.SetMapScale){const l=null===(t=null==b?void 0:b.view)||void 0===t?void 0:t.scale;D(l),ge(["outScale"],l);const o=S.set("outScale",l).set("printExtentType",e);R(o)}else ge(["printExtentType"],e)},et=e=>{if(m.current){const{isValidWkid:t}=m.current;return!e||t(e)}return!0},tt=t.React.useCallback(e=>Ne(void 0,void 0,void 0,function*(){var t,l;if(e){const o=null===(l=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.spatialReference)||void 0===l?void 0:l.wkid,i=o?yield ve(o):"";pe(i)}}),[ve]);ke(()=>(tt(b),b&&Ne(void 0,void 0,void 0,function*(){return h.current||(h.current=yield(0,t.loadArcGISJSAPIModule)("esri/core/reactiveUtils")),h.current}).then(()=>{var e;y.current=null===(e=h.current)||void 0===e?void 0:e.watch(()=>{var e,t;return null===(t=null===(e=null==b?void 0:b.view)||void 0===e?void 0:e.spatialReference)||void 0===t?void 0:t.wkid},()=>{tt(b)})}),()=>{var e,t,l;(null===(e=y.current)||void 0===e?void 0:e.remove)&&(null===(l=null===(t=y.current)||void 0===t?void 0:t.remove)||void 0===l||l.call(t))}),[b,tt]);const lt=e=>{var t,l;return p("wkidPlaceholder",{wkid:(null===(l=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.spatialReference)||void 0===l?void 0:l.wkid)||null})},ot=()=>{const o=W(null==S?void 0:S.layout),i=it(),{showLayoutOption:n,showFeatureAttribution:r,showMapAttribution:a,showQuality:s,showMapSize:d,showMapPrintExtents:c,showScalebarUnit:v,showOutputSpatialReference:m}=i,h=n||r||a||s||d||c||v||m;return(0,e.jsxs)("div",{children:[h&&(0,e.jsxs)("div",{className:"d-flex align-items-center",role:"group","aria-label":p("advance"),onClick:Xe,children:[(0,e.jsx)("div",{className:"flex-grow-1",children:p("advance")}),(0,e.jsx)(l.Button,{icon:!0,className:"collapse-button",size:"sm",type:"tertiary",title:p(ee?"collapse":"expand"),"aria-label":p(ee?"collapse":"expand"),"aria-expanded":ee,children:ee?(0,e.jsx)(he,{}):(0,e.jsx)(ce,{})})]}),ee&&(0,e.jsxs)("div",{children:[c&&(0,e.jsx)(Le,{flowWrap:!0,label:p("mapPrintingExtents"),children:(0,e.jsxs)("div",{role:"group","aria-label":p("mapPrintingExtents"),children:[(0,e.jsxs)("div",{title:p("currentMapExtent"),"aria-label":p("currentMapExtent"),className:"d-flex align-items-center radio-con mt-1 checkbox-con",onClick:()=>{Ye(u.CurrentMapExtent)},children:[(0,e.jsx)(l.Radio,{"aria-label":p("currentMapExtent"),title:p("currentMapExtent"),checked:(null==S?void 0:S.printExtentType)===u.CurrentMapExtent,className:"mr-2"})," ",p("currentMapExtent")]}),(0,e.jsxs)("div",{title:p("currentMapScale"),"aria-label":p("currentMapScale"),className:"d-flex align-items-center radio-con checkbox-con",onClick:()=>{Ye(u.CurrentMapScale)},children:[(0,e.jsx)(l.Radio,{"aria-label":p("currentMapScale"),title:p("currentMapScale"),checked:(null==S?void 0:S.printExtentType)===u.CurrentMapScale,className:"mr-2"})," ",p("currentMapScale")]}),(0,e.jsxs)("div",{title:p("setMapScale"),"aria-label":p("setMapScale"),className:"d-flex align-items-center radio-con checkbox-con",onClick:()=>{Ye(u.SetMapScale)},children:[(0,e.jsx)(l.Radio,{"aria-label":p("setMapScale"),title:p("setMapScale"),checked:(null==S?void 0:S.printExtentType)===u.SetMapScale,className:"mr-2"})," ",p("setMapScale")]}),(null==S?void 0:S.printExtentType)===u.SetMapScale&&(0,e.jsxs)("div",{className:"w-100 d-flex align-items-center outscale-con",children:[(0,e.jsx)(l.NumericInput,{size:"sm",className:"flex-grow-1 dpi-input no-right-padding",value:U,onAcceptValue:Re,onChange:Ve,showHandlers:!1,"aria-label":p("setMapScale")}),(0,e.jsx)(l.Button,{className:"button-radius",size:"sm",onClick:De,title:p("useCurrentScale"),children:(0,e.jsx)(xe,{})})]})]})}),m&&(0,e.jsxs)(Le,{flowWrap:!0,label:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:vt()}}),children:[(0,e.jsx)(l.NumericInput,{size:"sm",className:"w-100 dpi-input no-right-padding",value:A||"",onAcceptValue:je,onChange:Ce,showHandlers:!1,placeholder:lt(b),"aria-label":p("spatialReference",{WKID:""}),"aria-describedby":"print-wkid-describtion"}),(0,e.jsx)("div",{id:"print-wkid-describtion",title:me(A),"aria-label":me(A),className:(0,t.classNames)("text-truncate mt-1 wkid-describtion",{"wkid-describtion-invalid":!et(Number(A))}),children:me(A)})]}),!o&&rt(),o&&ct()]})]})},it=()=>{const e=W(null==S?void 0:S.layout),t=(null==S?void 0:S.hasAuthorText)&&(null==S?void 0:S.enableAuthor)&&!e,l=(null==S?void 0:S.hasCopyrightText)&&(null==S?void 0:S.enableCopyright)&&!e,o=(null==S?void 0:S.hasLegend)&&(null==S?void 0:S.enableLegend)&&!e,i=nt()&&!e;return{showLayoutOption:t||l||o||i||(null==S?void 0:S.enableScalebarUnit),showAuthor:t,showCopyright:l,showLegend:o,showCustomTextElements:i,showTitle:null==S?void 0:S.enableTitle,showFeatureAttribution:null==S?void 0:S.enableFeatureAttribution,showMapAttribution:(null==S?void 0:S.enableMapAttribution)&&e,showQuality:null==S?void 0:S.enableQuality,showMapSize:(null==S?void 0:S.enableMapSize)&&e,showMapPrintExtents:null==S?void 0:S.enableMapPrintExtents,showScalebarUnit:(null==S?void 0:S.enableScalebarUnit)&&!e,showOutputSpatialReference:null==S?void 0:S.enableOutputSpatialReference,showNorthArrow:null==S?void 0:S.enableNorthArrow}},nt=()=>{var e,t;const l=[];return null===(e=null==S?void 0:S.customTextElementEnableList)||void 0===e||e.forEach(e=>{for(const t in e)l.push(e[t])}),(null===(t=null==l?void 0:l.filter(e=>e))||void 0===t?void 0:t.length)>0},rt=()=>{var t;const o=it(),{showAuthor:i,showCopyright:n,showLegend:r,showLayoutOption:a,showFeatureAttribution:s,showQuality:u,showScalebarUnit:d,showNorthArrow:c}=o;return(0,e.jsxs)("div",{role:"group","aria-label":p("LayoutOptions"),children:[a&&(0,e.jsx)("div",{className:"mb-2",children:p("LayoutOptions")}),i&&(0,e.jsx)(Le,{flowWrap:!0,label:p("printAuthor"),children:(0,e.jsx)(l.TextInput,{size:"sm",className:"w-100 dpi-input",value:V,onAcceptValue:ze,onChange:We,"aria-label":p("printAuthor")})}),n&&(0,e.jsx)(Le,{flowWrap:!0,label:p("printCopyright"),children:(0,e.jsx)(l.TextInput,{size:"sm",className:"w-100 dpi-input",value:$,onAcceptValue:Ge,onChange:Je,"aria-label":p("printCopyright")})}),at(),r&&(0,e.jsx)(Le,{children:(0,e.jsxs)("div",{title:p("includeLegend"),"aria-label":p("includeLegend"),className:"w-100 align-items-center d-flex checkbox-con",onClick:Se,children:[(0,e.jsx)(l.Checkbox,{title:p("includeLegend"),className:"lock-item-ratio",checked:re}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1",children:p("includeLegend")})]})}),c&&(0,e.jsx)(Le,{children:(0,e.jsxs)("div",{title:p("includeNorthArrow"),"aria-label":p("includeNorthArrow"),className:"w-100 align-items-center d-flex checkbox-con",onClick:Ie,children:[(0,e.jsx)(l.Checkbox,{title:p("includeNorthArrow"),className:"lock-item-ratio",checked:se}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1",children:p("includeNorthArrow")})]})}),d&&(0,e.jsx)(Le,{label:p("scaleBarUnit"),flowWrap:!1,children:(0,e.jsx)(l.Select,{value:null===(t=null==S?void 0:S.layoutOptions)||void 0===t?void 0:t.scalebarUnit,onChange:Qe,size:"sm",className:"scalebar-unit","aria-label":p("scaleBarUnit"),children:q(p).map((t,o)=>(0,e.jsx)(l.Option,{value:t.value,title:t.label,children:t.label},`unit${o}`))})}),u&&(0,e.jsx)(Le,{label:p("printQuality"),flowWrap:!0,children:(0,e.jsxs)("div",{className:"d-flex align-items-center w-100 dpi-con",children:[(0,e.jsx)(l.NumericInput,{size:"sm",className:"flex-grow-1 no-right-padding",value:_,min:1,onAcceptValue:$e,onChange:Fe,showHandlers:!1,"aria-label":p("printQuality")}),(0,e.jsx)(l.Button,{className:"button-radius",disabled:!0,size:"sm",title:"DPI",children:"DPI"})]})}),s&&(0,e.jsx)(Le,{children:(0,e.jsxs)("div",{title:p("includeAttributes"),"aria-label":p("includeAttributes"),className:"w-100 align-items-center d-flex checkbox-con",onClick:we,children:[(0,e.jsx)(l.Checkbox,{title:p("includeAttributes"),className:"lock-item-ratio","data-field":"mapSize",checked:null==S?void 0:S.forceFeatureAttributes}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1",children:p("includeAttributes")})]})})]})},at=()=>{const t=[];return null==J||J.forEach((o,i)=>{var n,r;for(const a in o){if(!(null===(r=null===(n=null==S?void 0:S.customTextElementEnableList)||void 0===n?void 0:n[i])||void 0===r?void 0:r[a]))continue;const s=(0,e.jsx)(Le,{flowWrap:!0,className:"align-item-center",label:a,children:(0,e.jsx)(l.TextArea,{className:"flex-grow-1",value:o[a]||"",onAcceptValue:e=>{st(i,a,e)},onChange:e=>{ut(i,a,e)},"aria-label":a})},`${a}_${i}`);t.push(s)}}),t},st=(e,t,l)=>{const o=J[e].set(t,l),i=null==J?void 0:J.asMutable({deep:!0});i.splice(e,1,o),ge(["layoutOptions","customTextElements"],i)},ut=(e,l,o)=>{var i;const n=null===(i=null==o?void 0:o.target)||void 0===i?void 0:i.value,r=J[e].set(l,n),a=null==J?void 0:J.asMutable({deep:!0});a.splice(e,1,r),B((0,t.Immutable)(a))},dt=()=>{var t,o,i,n,r;const a=it(),{showTitle:s}=a;return(0,e.jsxs)("div",{className:"base-setting-con",children:[(0,e.jsx)(Le,{flowWrap:!0,label:p("template"),children:(0,e.jsx)(l.Select,{value:(null==S?void 0:S.templateId)||"",onChange:ye,size:"sm","aria-label":p("template"),children:null==w?void 0:w.map((t,o)=>(0,e.jsx)(l.Option,{value:null==t?void 0:t.templateId,title:null==t?void 0:t.label,children:null==t?void 0:t.label},null==t?void 0:t.templateId))})}),(0,e.jsx)(Pe,{supportCustomReport:null==O?void 0:O.supportCustomReport,supportReport:null==O?void 0:O.supportReport,outputDataSourceWarning:j}),s&&(0,e.jsx)(Le,{flowWrap:!0,label:p("title"),children:(0,e.jsx)(l.TextInput,{size:"sm",className:"w-100",value:N,"aria-label":p("title"),onAcceptValue:Te,onChange:Oe})}),(null===(t=null==S?void 0:S.selectedFormatList)||void 0===t?void 0:t.length)>1&&(0,e.jsx)(Le,{flowWrap:!0,label:p("fileFormat"),children:(0,e.jsxs)(l.Select,{value:(null===(o=null==S?void 0:S.format)||void 0===o?void 0:o.toLowerCase())||"",onChange:Ke,size:"sm","aria-label":p("fileFormat"),children:[!(null===(i=null==S?void 0:S.selectedFormatList)||void 0===i?void 0:i.includes(null==S?void 0:S.format))&&(0,e.jsx)(l.Option,{className:"sr-only",value:null===(n=null==S?void 0:S.format)||void 0===n?void 0:n.toLowerCase(),title:null==S?void 0:S.format,children:null==S?void 0:S.format},`${null==S?void 0:S.format}0`),null===(r=null==S?void 0:S.selectedFormatList)||void 0===r?void 0:r.map((t,o)=>(0,e.jsx)(l.Option,{value:t,title:t,children:t},`format${o}`))]})})]})},ct=()=>{const t=it(),{showFeatureAttribution:o,showMapAttribution:i,showQuality:n}=t;return(0,e.jsxs)("div",{children:[o&&(0,e.jsx)(Le,{className:"mb-1",children:(0,e.jsxs)("div",{title:p("includeAttributes"),"aria-label":p("includeAttributes"),className:"w-100 align-items-center mt-1 d-flex checkbox-con",onClick:we,children:[(0,e.jsx)(l.Checkbox,{title:p("includeAttributes"),className:"lock-item-ratio","data-field":"mapSize",checked:null==S?void 0:S.forceFeatureAttributes}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1",children:p("includeAttributes")})]})}),i&&(0,e.jsx)(Le,{children:(0,e.jsxs)("div",{title:p("includeAttribution"),"aria-label":p("includeAttribution"),className:"w-100 align-items-center d-flex checkbox-con",onClick:be,children:[(0,e.jsx)(l.Checkbox,{title:p("includeAttribution"),className:"lock-item-ratio","data-field":"mapSize",checked:null==S?void 0:S.attributionVisible}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1",children:p("includeAttribution")})]})}),n&&(0,e.jsx)(Le,{label:p("printQuality"),flowWrap:!0,children:(0,e.jsxs)("div",{className:"d-flex align-items-center w-100 dpi-con",children:[(0,e.jsx)(l.NumericInput,{size:"sm",className:"flex-grow-1 no-right-padding",value:_,onAcceptValue:$e,onChange:Fe,showHandlers:!1,min:1,"aria-label":p("printQuality")}),(0,e.jsx)(l.Button,{className:"button-radius",disabled:!0,size:"sm",title:"DPI",children:"DPI"})]})})]})},pt=()=>{const t=it(),{showMapSize:o}=t;return(0,e.jsx)("div",{children:o&&(0,e.jsxs)("div",{className:"d-flex align-items-center",children:[(0,e.jsxs)("div",{className:"flex-grow-1",children:[(0,e.jsx)("div",{className:"mb-1",children:p("width")}),(0,e.jsx)(l.NumericInput,{size:"sm",className:"w-100 map-size-con",value:Q,onAcceptValue:Be,onChange:_e,showHandlers:!1,"aria-label":p("width")})]}),(0,e.jsxs)("div",{className:"flex-grow-1 ml-2",children:[(0,e.jsx)("div",{className:"mb-1",children:p("height")}),(0,e.jsx)(l.NumericInput,{size:"sm",className:"w-100 map-size-con",value:X,onAcceptValue:qe,onChange:He,showHandlers:!1,"aria-label":p("height")})]})]})})},vt=()=>Ee.sanitize(p("spatialReference",{WKID:'<a target="_blank" href="https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references.htm">WKID</a>'}));return(0,e.jsx)("div",{className:(0,t.classNames)("w-100 h-100",{invisible:M!==g.PrintTemplate}),css:x,children:(0,e.jsxs)("div",{className:"w-100 h-100 d-flex flex-column",children:[(0,e.jsx)("div",{className:"flex-grow-1 w-100 setting-con",children:(0,e.jsxs)("div",{className:"w-100",children:[dt(),(0,e.jsxs)("div",{children:[W(null==S?void 0:S.layout)&&pt(),ot()]})]})}),(0,e.jsxs)("div",{className:"print-button-con",children:[(0,e.jsx)(Me,{id:I,jimuMapView:b,className:"w-100",scale:U,selectedTemplate:S,printExtentType:null==S?void 0:S.printExtentType,config:O,updatePreviewOverlayItem:L}),(0,e.jsx)(l.Button,{className:"w-100 mt-2",type:"primary",onClick:()=>{C(S)},title:p("_widgetLabel"),children:p("_widgetLabel")})]})]})})};var Ve=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};const ze=(e,t)=>{let l=1,o=e;return t.forEach(i=>{o===(null==i?void 0:i.title)&&(o=`${e} (${l})`,l++,ze(o,t))}),o},Fe=e=>{const t=(e=>{var t;return e?null===(t=null==e?void 0:e.asMutable())||void 0===t?void 0:t.map(e=>e.resultId):[]})(e);if(!t||0===(null==t?void 0:t.length))return"result_0";return`config_${$e(t)+1}`},$e=e=>{var t;if(!e||0===(null==e?void 0:e.length))return 0;const l=null==e?void 0:e.map(e=>{var t;const l=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return l?Number(l):0});return null===(t=null==l?void 0:l.sort((e,t)=>t-e))||void 0===t?void 0:t[0]};function We(e,t){return`exb-print-layer-${t}-${e}`}function Ge(e){return Ve(this,void 0,void 0,function*(){if(e)return(0,o.loadArcGISJSAPIModules)(["esri/kernel"]).then(([t])=>J(e).then(e=>{const l=t.id.findCredential(e);return Promise.resolve(null==l?void 0:l.token)}))})}function Je(e,t,l,o,i,n){!function(e,t,l,o){var i;if(!(t&&e&&o&&l&&0!==(null===(i=Object.keys(e))||void 0===i?void 0:i.length)))return;Object.keys(e).forEach(i=>{const n=e[i];Be(null==n?void 0:n.exbDataSource,t,l,o)})}(e,l,o,i),n&&function(e,t,l,o){if(!(e&&t&&o&&l))return;const i=(null==t?void 0:t.reportSectionOverrides)||{};Object.keys(i).forEach(t=>Ve(this,void 0,void 0,function*(){const n=i[t];Be(null==n?void 0:n.exbDatasource,e,l,o)}))}(l,t,o,i)}function Be(e,t,l,o){return Ve(this,void 0,void 0,function*(){var i;if((null==e?void 0:e.length)>0){const n=ee(e,o),r=null===(i=null==e?void 0:e[0])||void 0===i?void 0:i.dataSourceId;if(!n&&t){if(re(r)){const e=yield He(r,l);t.view.map.tables.remove(e)}else{const e=We(r,l);t.view.map.findLayerById(e)&&t.removeLayerFromMap(e)}}}})}function _e(e,l,o,i,n){return Ve(this,void 0,void 0,function*(){return yield Promise.all(Object.keys(e).map(r=>Ve(this,void 0,void 0,function*(){const a=function(e){var l,o;const i=null==e?void 0:e.exbDataSource;if((null==i?void 0:i.length)>0){const n=null===(l=null==i?void 0:i[0])||void 0===l?void 0:l.dataSourceId,r=t.DataSourceManager.getInstance().getDataSource(n),a=r?r.getSelectedRecordIds():[];if((null==a?void 0:a.length)>0)if(null==e?void 0:e.dynamicTextElements){const t=null===(o=e.dynamicTextElements)||void 0===o?void 0:o.map(e=>(e.filterType="selected",e));e.dynamicTextElements=t}else e.filterType="selected";return e}return e}(e[r]),s=null==a?void 0:a.exbDataSource;if((null==s?void 0:s.length)>0){const t=yield qe(s,l,o,i);if("CIMGraphicElement"===a.type&&(null==a?void 0:a.dynamicTextElements)){const e=null==a?void 0:a.dynamicTextElements,l=null==e?void 0:e.map(e=>(e.sourceLayerId=t,e));a.dynamicTextElements=l}else e[r].sourceLayerId=t;delete e[r].exbDataSource,delete e[r].isDsOutputDs}"CIMLegend"===a.type&&(e[r].visible=n)}))),Promise.resolve(e||{})})}function qe(e,l,i,n){return Ve(this,void 0,void 0,function*(){var r,a;const s=ee(e,i),u=null===(r=null==e?void 0:e[0])||void 0===r?void 0:r.dataSourceId;let d;if(s){const l=t.DataSourceManager.getInstance(),o=l.getDataSource(u);if(!o)return l.createDataSourceByUseDataSource(null==e?void 0:e[0]).then(e=>{var t;return d=(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.id)||"",Promise.resolve(d)});d=(null===(a=null==o?void 0:o.layer)||void 0===a?void 0:a.id)||""}else d=We(u,n),l&&!function(e,t){var l,o,i;const n=t.getAllJimuLayerViews().map(e=>{var t;return null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.id})||[],r=(null===(i=null===(o=null===(l=t.view.map)||void 0===l?void 0:l.tables)||void 0===o?void 0:o.toArray())||void 0===i?void 0:i.map(e=>null==e?void 0:e.id))||[];return n.concat(r).includes(e)}(d,l)&&(yield function(e,l,i){return Ve(this,void 0,void 0,function*(){const n=We(l,i);if(e){const r=e.view.map.findLayerById(n),a=function(e){var l,o;return null===(o=null===(l=t.DataSourceManager.getInstance().getDataSource(e))||void 0===l?void 0:l.getDataSourceJson())||void 0===o?void 0:o.isOutputFromWidget}(l);if(!function(e){var l;const o=null===(l=t.DataSourceManager.getInstance().getDataSource(e))||void 0===l?void 0:l.getStatus();return o!==t.DataSourceStatus.NotCreated&&o!==t.DataSourceStatus.CreateError&&o!==t.DataSourceStatus.LoadError&&o!==t.DataSourceStatus.SaveError&&o!==t.DataSourceStatus.NotReady}(l))return;let s;const u=re(l);let d;const c=t.DataSourceManager.getInstance().getDataSource(l),p=c._layer;if(r&&a)s=e.getJimuLayerViewByAPILayer(r);else if(u){const t=yield He(l,i),o=function(e,t){const l=e.view.map.tables.map(e=>e.id);return l.includes(null==t?void 0:t.id)}(e,t);o||e.view.map.tables.add(t)}else{const t=(null==c?void 0:c.isDataView)&&"selection"===(null==c?void 0:c.dataViewId);if(t){const e=p.sourceJSON.capabilities;e&&function(e){return!!(null==e?void 0:e.toLowerCase().split(",").map(e=>e.trim()).includes("map"))}(e)&&(d=e,p.sourceJSON.capabilities=function(e){return e.split(",").filter(e=>!(null==e?void 0:e.toLocaleLowerCase().trim().includes("map"))).join(",")}(d))}s=yield e.addLayerToMap(l,n),d&&(p.sourceJSON.capabilities=d),t&&!s.layer.outFields&&(s.layer.outFields=["*"])}s&&(yield e.whenJimuLayerViewLoaded(s.id),s.layer.opacity=0,yield function(e,t){return Ve(this,void 0,void 0,function*(){var l,i,n,r;if(!(null===(i=null===(l=e.layer)||void 0===l?void 0:l.customParameters)||void 0===i?void 0:i.moveFeaturesToCenterWhenPrinting))return;const a=yield null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.queryFeatures({returnGeometry:!0}),s=(null==a?void 0:a.features)||[];if(0===s.length)return;const u=null===(r=t.view.extent)||void 0===r?void 0:r.center,d=null==e?void 0:e.layer;if("point"===d.geometryType){const[e]=yield(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]),l={type:"point",x:u.x,y:u.y,spatialReference:t.view.spatialReference},i=s.map(t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:l}));yield d.applyEdits({updateFeatures:i})}else if("polyline"===d.geometryType){const[e,l]=yield(0,o.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polyline"]),i=new l({hasZ:!1,hasM:!1,paths:[[[t.view.extent.center.x,t.view.extent.center.y],[t.view.extent.center.x+5,t.view.extent.center.y+5]]],spatialReference:t.view.spatialReference}),n=s.map(t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:i}));yield d.applyEdits({updateFeatures:n})}else if("polygon"===d.geometryType){const[e,l]=yield(0,o.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polygon"]),i=new l({hasZ:!1,hasM:!1,rings:[[[t.view.extent.xmin,t.view.extent.ymin],[t.view.extent.xmin,t.view.extent.ymax],[t.view.extent.xmax,t.view.extent.ymax],[t.view.extent.xmin,t.view.extent.ymin]]],spatialReference:t.view.spatialReference}),n=s.map(t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:i}));yield d.applyEdits({updateFeatures:n})}})}(s,e),yield s.whenCurrentLayerViewNotUpdating(),yield function(e,t){return Ve(this,void 0,void 0,function*(){var l,i,n;if(!(null===(l=null==e?void 0:e.view)||void 0===l?void 0:l.queryFeatureCount)||!(null==e?void 0:e.whenCurrentLayerViewNotUpdating))return!1;yield e.whenCurrentLayerViewNotUpdating();const r=null===(i=null==t?void 0:t.view)||void 0===i?void 0:i.extent,a=null==e?void 0:e.layer,s=yield null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.queryFeatureCount({geometry:r});if(0===s&&"point"===a.geometryType){const e={type:"point",x:t.view.extent.center.x,y:t.view.extent.center.y,spatialReference:t.view.spatialReference},l={},i=new Date;l[a.objectIdField]=i.getTime(),yield(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then(([t])=>{const o=new t({geometry:e,attributes:l});return a.applyEdits({addFeatures:[o]}).then(()=>Promise.resolve(!0))})}else if(0===s&&"polyline"===a.geometryType){const e={},l=new Date;e[a.objectIdField]=l.getTime(),yield(0,o.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polyline"]).then(([l,o])=>{const i=new l({geometry:new o({hasZ:!1,hasM:!1,paths:[[[t.view.extent.center.x,t.view.extent.center.y],[t.view.extent.center.x+5,t.view.extent.center.y+5]]],spatialReference:t.view.spatialReference}),attributes:e});return a.applyEdits({addFeatures:[i]}).then(()=>Promise.resolve(!0))})}else{if(0!==s||"polygon"!==a.geometryType)return Promise.resolve(!0);{const e={},l=new Date;e[a.objectIdField]=l.getTime(),yield(0,o.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polygon"]).then(([l,o])=>{const i=new l({geometry:new o({hasZ:!1,hasM:!1,rings:[[[t.view.extent.xmin,t.view.extent.ymin],[t.view.extent.xmin,t.view.extent.ymax],[t.view.extent.xmax,t.view.extent.ymax],[t.view.extent.xmin,t.view.extent.ymin]]],spatialReference:t.view.spatialReference}),attributes:e});return a.applyEdits({addFeatures:[i]}).then(()=>Promise.resolve(!0))})}}})}(s,e),yield s.whenCurrentLayerViewNotUpdating())}})}(l,u,n));return Promise.resolve(d)})}function He(e,l){return Ve(this,void 0,void 0,function*(){const o=We(e,l),i=t.DataSourceManager.getInstance().getDataSource(e),n=yield i.createJSAPILayerByDataSource();return n.id=o,n.opacity=0,n})}function Ke(e){return Ve(this,void 0,void 0,function*(){var t,l,i,n,r,a,s,d,c;const{printTemplateProperties:p,mapView:v,locale:m,utility:h,isSupportReport:f,useMapWidgetIds:y,widgetId:g}=e;try{const e=!1===(null==p?void 0:p.hasTitleText),c=!1===(null==p?void 0:p.hasLegend);let w=p.without("enableTitle","enableAuthor","enableOutputSpatialReference","enableMapPrintExtents","enableQuality","enableMapSize","enableFeatureAttribution","enableCopyright","enableLegend","enableMapAttribution","enableCustomTextElements","hasAuthorText","hasCopyrightText","hasLegend","hasTitleText","selectedFormatList","mapFrameSize","mapFrameUnit","legendEnabled","templateId","printExtentType","customTextElementEnableList");switch(null==p?void 0:p.printExtentType){case u.CurrentMapExtent:w=w.set("scalePreserved",!1);break;case u.CurrentMapScale:w=w.set("outScale",null===(t=null==v?void 0:v.view)||void 0===t?void 0:t.scale).set("scalePreserved",!0);break;case u.SetMapScale:w=w.set("scalePreserved",!0)}let S=null==w?void 0:w.asMutable({deep:!0});e&&(null===(l=null==S?void 0:S.layoutOptions)||void 0===l||delete l.titleText),c&&(null===(i=null==S?void 0:S.layoutOptions)||void 0===i||delete i.legendLayers),v.getAllJimuLayerViews().every(e=>{var t,l;const o=null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.labelingInfo;return!o||0===o.length||!(null===(l=null==e?void 0:e.layer)||void 0===l?void 0:l.labelsVisible)})&&(S.showLabels=!1);const I=null===(n=null==p?void 0:p.layoutOptions)||void 0===n?void 0:n.legendLayers;if(S.layoutOptions.legendLayers=I?null:[],S.showLabels=!0,p.layoutTypes!==x.CustomLayout&&p.reportTypes!==b.CustomReport||(S=yield function(e,t){return Ve(this,void 0,void 0,function*(){const l=e;return(0,o.loadArcGISJSAPIModules)(["esri/portal/PortalItem"]).then(o=>{const[i]=o;return j(t).then(t=>{var o,n;if(e.layoutTypes===x.CustomLayout&&(null===(o=e.customLayoutItem)||void 0===o?void 0:o.id)){const o=new i({id:e.customLayoutItem.id,portal:t});l.layoutItem=o}if(e.reportTypes===b.CustomReport&&(null===(n=e.customReportItem)||void 0===n?void 0:n.id)){const o=new i({id:e.customReportItem.id,portal:t});l.reportItem=o}return delete l.customLayoutItem,delete l.customReportItem,delete l.layoutTypes,delete l.reportTypes,Promise.resolve(l)})},e=>Promise.resolve(l)).catch(e=>Promise.resolve(l))})}(S,h)),f){const e=yield function(e,t,l,o){return Ve(this,void 0,void 0,function*(){const i=(null==e?void 0:e.reportSectionOverrides)||{};return yield Promise.all(Object.keys(i).map(e=>Ve(this,void 0,void 0,function*(){var n;const r=i[e];if((null===(n=null==r?void 0:r.exbDatasource)||void 0===n?void 0:n.length)>0){const n=yield qe(null==r?void 0:r.exbDatasource,t,l,o);i[e].sourceId=n,delete i[e].exbDatasource}}))),e&&(e.reportSectionOverrides=i),Promise.resolve(e||{})})}(null==S?void 0:S.reportOptions,v,y,g);S.reportOptions=e}const T=(null===(r=null==S?void 0:S.layoutOptions)||void 0===r?void 0:r.elementOverrides)||{};if((null===(a=Object.keys(T))||void 0===a?void 0:a.length)>0){const e=yield _e(T,v,y,g,!!I);S.layoutOptions.elementOverrides=e}return(null==S?void 0:S.wkid)||(S.wkid=null===(d=null===(s=null==v?void 0:v.view)||void 0===s?void 0:s.spatialReference)||void 0===d?void 0:d.wkid),S=function(e,t){var l;const o=(null===(l=e.layoutOptions)||void 0===l?void 0:l.customTextElements)||[];let i=!1;o.forEach(e=>{e.date&&(i=!0)}),i||o.push({Date:(new Date).toLocaleString(t)});return e.layoutOptions.customTextElements=o,e}(S,m),Promise.resolve(S)}catch(e){return console.error(e),Je(null===(c=null==p?void 0:p.layoutOptions)||void 0===c?void 0:c.elementOverrides,null==p?void 0:p.reportOptions,v,g,y,f),Promise.resolve(null)}})}var Qe=a(62838),Ze=a.n(Qe),Xe=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const Ye=l=>{const o=window.SVG,{className:i}=l,n=Xe(l,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:r,src:Ze()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var et=a(55886),tt=a.n(et),lt=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const ot=l=>{const o=window.SVG,{className:i}=l,n=lt(l,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:r,src:tt()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))};var it=a(22167),nt=a.n(it),rt=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const at=l=>{const o=window.SVG,{className:i}=l,n=rt(l,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:r,src:nt()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))},{useEffect:st,useState:ut}=t.React,dt=o=>{const i=t.hooks.useTranslation(T,l.defaultMessages),n=t.css`
    & {
      overflow: auto;
      padding: ${t.polished.rem(16)} ${t.polished.rem(16)} ${t.polished.rem(16)} ${t.polished.rem(16)};
    }
    .result-button {
      padding-left: 0;
      padding-right: 0;
    }
    a {
      padding: 0;
    }
    .print-loading-con {
      width: 16px;
      height: 16px;
      margin-right: ${t.polished.rem(4)};
    }
    a.result-button{
      color: inherit;
      &:hover {
        color: inherit;
        background: none;
        text-decoration: underline;
      }
    }
    .close-button {
      color: inherit;
    }
    .error-link, .error-link:hover {
      color: var(--sys-color-surface-paper-text);
      & svg {
        color: var(--sys-color-error-dark);
      }
    }
  `,{printResultList:r,config:a,id:s,deleteResultItem:u}=o,[d,c]=ut(null);st(()=>{Ge(a.useUtility).then(e=>{c(e)})},[a.useUtility]);const p=t=>{switch(t.state){case y.Loading:return(0,e.jsx)("div",{className:"print-loading-con position-relative",children:(0,e.jsx)(l.Loading,{width:16,height:16,type:l.LoadingType.Donut})});case y.Success:return(0,e.jsx)(ot,{});case y.Error:return(0,e.jsx)("span",{className:"mr-2",title:i("uploadImageError"),children:(0,e.jsx)(at,{})})}};return(0,e.jsxs)("div",{className:"w-100 h-100",css:n,children:[0===(null==r?void 0:r.length)&&(0,e.jsx)("div",{id:`resultEmptyMessage${s}`,children:i("resultEmptyMessage")}),r.map((o,n)=>(0,e.jsxs)("div",{className:"d-flex align-items-center mb-2 w-100",children:[(0,e.jsxs)(l.Button,{href:d?`${null==o?void 0:o.url}?token=${d}`:null==o?void 0:o.url,disabled:!(null==o?void 0:o.url),target:"_blank",size:"sm","aria-label":null==o?void 0:o.title,type:"tertiary",tag:(null==o?void 0:o.url)?"a":"div",className:(0,t.classNames)("flex-grow-1 p-0 d-flex align-items-center result-button",{"error-link":(null==o?void 0:o.state)===y.Error}),children:[p(o),(0,e.jsx)("div",{className:"ml-2 flex-grow-1 text-left",title:null==o?void 0:o.title,children:null==o?void 0:o.title})]}),(0,e.jsx)(l.Button,{className:"close-button",icon:!0,size:"sm",type:"tertiary",onClick:()=>{u(n)},"aria-label":i("remove"),title:i("remove"),children:(0,e.jsx)(Ye,{})})]},null==o?void 0:o.resultId))]})};var ct=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};const pt=e=>ct(void 0,void 0,void 0,function*(){var l;const{printTemplateProperties:i,useUtility:n,isSupportReport:r,widgetId:a,useMapWidgetIds:s,jimuMapView:u,reportOptions:d,elementOverrides:c,previewOverlayItem:p,toggleUtilityErrorRemind:v}=e,m=null===(l=e.mapView)||void 0===l?void 0:l.timeExtent,h=function(e,l){const o=null==l?void 0:l.dataSourceId;if(!e||!o)return e;let i=!0;const n=(0,t.getAppStore)().getState().appConfig.widgets;if(Object.keys(n).forEach(e=>{var l,r;const a=n[e];if("widgets/common/timeline/"===a.uri){const e=((null==a?void 0:a.useDataSources)||[]).filter(e=>e.rootDataSourceId===o||e.mainDataSourceId===o);(null==e?void 0:e.length)>0&&(null===(l=a.config)||void 0===l?void 0:l.dataSourceType)!==t.AllDataSourceTypes.Map&&(null===(r=a.config)||void 0===r?void 0:r.dataSourceType)!==t.AllDataSourceTypes.WebMap&&(i=!1)}}),i){let t;return(l.getAllJimuLayerViews().map(e=>e.layer)||[]).forEach(e=>{(null==e?void 0:e.timeExtent)&&(t=null==e?void 0:e.timeExtent)}),t&&(e.timeExtent=t),e}return e}(e.mapView,u),f=yield(y=(0,t.Immutable)(n),O(void 0,void 0,void 0,function*(){const e=yield j(y);return e?t.SessionManager.getInstance().getSessionByUrl(e):null}));var y;const g=p?yield function(e,t,l){return ct(this,void 0,void 0,function*(){return(0,o.loadArcGISJSAPIModules)(["esri/geometry/Extent","esri/views/2d/viewpointUtils"]).then(o=>{var i;const[n,r]=o,{getExtent:a}=r,s=a(new n,t.viewpoint,"map-only"===(null===(i=l.layout)||void 0===i?void 0:i.toLocaleLowerCase())?[l.exportOptions.width,l.exportOptions.height]:[e.boxWidth,e.boxHeight]);return Promise.resolve(s)})})}(p,h,i):null;return J(n).then(t=>(0,o.loadArcGISJSAPIModules)(["esri/rest/support/PrintParameters","esri/rest/support/PrintTemplate","esri/rest/print","esri/geometry/SpatialReference"]).then(l=>{var o;const[p,y,x,w]=l;i.includeTables=!0;const b=new y(i),S={view:mt(h),template:b};i.wkid!==(null===(o=null==h?void 0:h.spatialReference)||void 0===o?void 0:o.wkid)&&(S.outSpatialReference=new w({wkid:i.wkid})),g&&(S.extent=g);const I=new p(S),T={timeout:12e4,token:null==f?void 0:f.token};return(null==f?void 0:f.token)&&(T.token=f.token),x.execute(t,I,T).then(t=>(ne(null==n?void 0:n.utilityId,v),Je(c,d,u,a,s,r),vt(e.mapView,m),mt(h,!0),Promise.resolve(t)),t=>(Je(c,d,u,a,s,r),ne(null==n?void 0:n.utilityId,v,t),vt(e.mapView,m),mt(h,!0),Promise.reject(new Error(t)))).catch(t=>(Je(c,d,u,a,s,r),ne(null==n?void 0:n.utilityId,v,t),vt(e.mapView,m),mt(h,!0),Promise.reject(new Error(t))))}))});function vt(e,t){e.timeExtent=t}function mt(e,t=!1){return e.map.layers.toArray().forEach(e=>{var l,o,i,n;if(null===(l=null==e?void 0:e.id)||void 0===l?void 0:l.includes("jimu-draw-groupLayer")){(null===(o=null==e?void 0:e.layers)||void 0===o?void 0:o.toArray()).forEach(e=>{var l;null===(l=e.graphics)||void 0===l||l.forEach(e=>{var l;(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.jimuDrawId)&&(e.geometry.hasZ=t)})})}(null===(i=null==e?void 0:e.id)||void 0===i?void 0:i.includes("bookmark-layer-"))&&(null===(n=null==e?void 0:e.graphics)||void 0===n||n.forEach(e=>{var l;(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.jimuDrawId)&&(e.geometry.hasZ=t)}))}),e}const ht=t.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,ft=o=>{const i=t.hooks.useTranslation(l.defaultMessages,t.defaultMessages),{utilityId:n,toggleUtilityErrorRemind:r}=o,a=t.ReactRedux.useSelector(e=>{var t,l,o;const r=null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates;return!0===(null===(l=null==r?void 0:r[n])||void 0===l?void 0:l.isSignInError)?i("signInErrorDefault"):!1===(null===(o=null==r?void 0:r[n])||void 0===o?void 0:o.success)?i("utilityNotAvailable"):void 0});return(0,e.jsx)("div",{className:"position-relative w-100",css:ht,children:(0,e.jsx)("div",{className:"position-absolute w-100 utility-err-remind-con",children:(0,e.jsx)(l.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{r(!1)},text:a})})})};var yt=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};const{useState:gt,useRef:xt,useEffect:wt}=t.React,bt=t.css`
  .classic-setting-con {
    height: 0;
  }
  .jimu-tabs-tab-content {
    height: calc(100% - 40px);
  }
  .jimu-nav-type-underline {
    height: ${t.polished.rem(40)};
    border-bottom: 1px solid var(--sys-color-divider-secondary) !important;
    display: flex;
    align-items: center;
    &>li {
      flex: 1;
    }
    .loading-con {
      min-width: 16px;
      height: 16px;
      margin-top: -1px;
    }
    .badge-dot {
      top: ${t.polished.rem(4)};
      right: ${t.polished.rem(4)};
    }
  }

`,St=i=>{var n;const r=t.hooks.useTranslation(T,l.defaultMessages),a=xt([]),s=xt([]),u=xt(null),d=xt(null),c=xt(null),{config:p,jimuMapView:v,templateList:m,id:h,locale:f,useMapWidgetIds:x,outputDataSourceWarning:w,showUtilityErrorRemind:b,previewOverlayItem:S}=i,{handlePrintStatusMessageChange:I,handleSelectedTemplateIndexChange:O,toggleUtilityErrorRemind:j}=i,[C,M]=gt(g.PrintTemplate),[L,R]=gt((0,t.Immutable)([])),[P,N]=gt(null);wt(()=>{U(0)},[]),wt(()=>{var e;if(P&&G(m,null==P?void 0:P.templateId)){const l=F(null==m?void 0:m.asMutable({deep:!0}),null==P?void 0:P.templateId),o=null===(e=D(null==m?void 0:m[l]))||void 0===e?void 0:e.asMutable({deep:!0});E(o),u.current=(0,t.Immutable)(o)}P&&G(m,null==P?void 0:P.templateId)||U(0)},[m,p]);const E=e=>{var l;let o=null==P?void 0:P.asMutable({deep:!0});for(const e in o)e.includes("enable")&&delete o[e];const i=A(e,null===(l=u.current)||void 0===l?void 0:l.asMutable({deep:!0}));i.length>0&&i.forEach(l=>{const i=k(e,l);o=(0,t.Immutable)(o).setIn(l.split("."),i).asMutable({deep:!0})}),o.customTextElementEnableList=null==e?void 0:e.customTextElementEnableList,o.selectedFormatList=null==e?void 0:e.selectedFormatList;const n=(0,t.Immutable)(Object.assign(Object.assign({},e),o));V(n)},A=(e,t)=>{const l=[],o=(e,t,i)=>{for(const n in e){const r=e[n],a=null==t?void 0:t[n],s=i?`${i}.${n}`:n;"object"==typeof r&&"object"==typeof a&&(null!==r&&null!==a)?o(r,a,s):r!==a&&l.push(s)}};return o(e,t,""),l},k=(e,t)=>{const l=t.split(".");let o=e;for(const e of l)o=null==o?void 0:o[e];return o},U=e=>{if(0===(null==m?void 0:m.length))return!1;const t=D(null==m?void 0:m[e]);u.current=t,O(e),V(t)},D=e=>e?((null==e?void 0:e.overrideCommonSetting)?e=z((0,t.Immutable)(null==p?void 0:p.commonSetting),(0,t.Immutable)(e)):(e=e.set("wkid",null),e=z((0,t.Immutable)(e),(0,t.Immutable)(null==p?void 0:p.commonSetting))),e):null,V=e=>{N(e)},$=(e,l,o)=>{let i;I(l),o&&(e.url=o),e.state=l;const n=a.current;n.forEach((t,l)=>{t.resultId===e.resultId&&(i=l)}),(i||0===i)&&(n.splice(i,1,e),R((0,t.Immutable)(n)),a.current=n)},W=(e,l=!1)=>{if("Escape"===e.key){const o=l?d.current:c.current;(0,t.focusElementInKeyboardMode)(o),e.preventDefault()}};return(0,e.jsx)("div",{className:"w-100 h-100 d-flex flex-column",css:bt,children:(0,e.jsx)("div",{className:"flex-grow-1 w-100 classic-setting-con overflow-hidden",children:(0,e.jsxs)(l.Tabs,{defaultValue:g.PrintTemplate,keepMount:!0,onChange:e=>{M(e),e===g.PrintResult&&(s.current=(0,t.Immutable)(a.current).asMutable())},type:"underline",className:"h-100 w-100",children:[(0,e.jsx)(l.Tab,{innerRef:d,id:g.PrintTemplate,title:r("printTemplate"),className:"flex-grow-1 h-100",children:(0,e.jsxs)("div",{className:"w-100 h-100",onKeyUp:e=>{W(e,!0)},children:[(0,e.jsx)(De,{id:h,config:p,jimuMapView:v,selectedTemplate:P,templateList:m,outputDataSourceWarning:w,confirmPrint:e=>yt(void 0,void 0,void 0,function*(){var l,i;const n={resultId:Fe((0,t.Immutable)(a.current)),url:null,title:ze(null===(l=null==e?void 0:e.layoutOptions)||void 0===l?void 0:l.titleText,(0,t.Immutable)(a.current)),state:y.Loading},r=a.current,s=(null==p?void 0:p.supportCustomReport)||(null==p?void 0:p.supportReport);r.push(n),a.current=r,R((0,t.Immutable)(r));const u={printTemplateProperties:P,mapView:v,locale:f,utility:p.useUtility,useMapWidgetIds:x,widgetId:h,isSupportReport:s},d=yield Ke(u);if(!d)return void $(n,y.Error);let c;s&&(c=o.MapViewManager.getInstance().getJimuMapViewById(v.id));const m=c||v;I(y.Loading),pt({useUtility:null==p?void 0:p.useUtility,mapView:null==m?void 0:m.view,printTemplateProperties:d,toggleUtilityErrorRemind:j,jimuMapView:v,useMapWidgetIds:x,widgetId:h,isSupportReport:s,reportOptions:null==P?void 0:P.reportOptions,elementOverrides:null===(i=null==P?void 0:P.layoutOptions)||void 0===i?void 0:i.elementOverrides,previewOverlayItem:S}).then(e=>{$(n,y.Success,null==e?void 0:e.url)},e=>{$(n,y.Error)})}),views:C,handleSelectedTemplateChange:V,setSelectedTemplateByIndex:U,updatePreviewOverlayItem:i.updatePreviewOverlayItem}),b&&(0,e.jsx)(ft,{utilityId:null===(n=null==p?void 0:p.useUtility)||void 0===n?void 0:n.utilityId,toggleUtilityErrorRemind:j})]})}),(0,e.jsx)(l.Tab,{id:g.PrintResult,title:(()=>{var t;const o=(()=>{var e,t;return(null===(t=null===(e=null==a?void 0:a.current)||void 0===e?void 0:e.filter(e=>e.state===y.Loading))||void 0===t?void 0:t.length)>0})()&&C===g.PrintTemplate,i=null===(t=null==a?void 0:a.current)||void 0===t?void 0:t.length,n=!o&&i>0?`(${i})`:"";return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"d-inline-block",children:r("resultsNumber",{number:n})}),o&&(0,e.jsx)("div",{className:"loading-con position-relative ml-1 d-inline-block align-middle",children:(0,e.jsx)(l.Loading,{width:16,height:16,type:l.LoadingType.Donut})})]})})(),innerRef:c,"aria-describedby":0===(null==L?void 0:L.length)?`resultEmptyMessage${h}`:"",className:"flex-grow-1 h-100",children:(0,e.jsx)("div",{className:"w-100 h-100",onKeyUp:e=>{W(e)},children:(0,e.jsx)(dt,{id:h,config:p,printResultList:L,deleteResultItem:e=>{var l,o;const i=a.current;i.splice(e,1),R((0,t.Immutable)(i)),a.current=null===(l=(0,t.Immutable)(i))||void 0===l?void 0:l.asMutable({deep:!0}),s.current=null===(o=(0,t.Immutable)(i))||void 0===o?void 0:o.asMutable({deep:!0})}})})})]})})})};var It=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(l[o[i]]=e[o[i]])}return l};const Tt=l=>{const o=window.SVG,{className:i}=l,n=It(l,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return o?(0,e.jsx)(o,Object.assign({className:r,src:I()},n)):(0,e.jsx)("svg",Object.assign({className:r},n))},{useEffect:Ot,useState:jt}=t.React,Ct=o=>{const i=t.hooks.useTranslation(T,l.defaultMessages),{printResult:n,useUtility:r,restPrint:a}=o,[s,u]=jt(null),d=t.css`
    .error-link, .error-link:hover {
      color: var(--sys-color-surface-paper-text);
      & svg {
        color: var(--sys-color-error-dark);
      }
    }
    a.result-button{
      color: inherit;
      &:hover {
        color: inherit;
        background: none;
        text-decoration: underline;
      }
    }
  `;Ot(()=>{Ge(r).then(e=>{u(e)})},[r]);return(0,e.jsxs)("div",{className:"d-flex flex-column h-100 w-100 result-con",css:d,children:[(0,e.jsxs)(l.Button,{href:s?`${null==n?void 0:n.url}?token=${s}`:null==n?void 0:n.url,disabled:!(null==n?void 0:n.url),target:"_blank",size:"sm","aria-label":null==n?void 0:n.title,tag:(null==n?void 0:n.url)?"a":"div",type:"tertiary",className:(0,t.classNames)("d-flex p-0 align-items-center result-button",{"error-link":(null==n?void 0:n.state)===y.Error}),children:[(()=>{switch(null==n?void 0:n.state){case y.Loading:return(0,e.jsx)("div",{children:(0,e.jsx)(l.Loading,{type:l.LoadingType.Donut,width:16,height:16})});case y.Success:return(0,e.jsx)(ot,{});case y.Error:return(0,e.jsx)("span",{title:i("uploadImageError"),children:(0,e.jsx)(at,{})})}})(),(0,e.jsx)("div",{className:"ml-2 flex-grow-1 text-left",title:null==n?void 0:n.title,children:null==n?void 0:n.title})]}),(0,e.jsxs)("div",{className:"flex-grow-1 d-flex align-items-end",children:[(0,e.jsx)("div",{className:"flex-grow-1"}),(0,e.jsx)(l.Button,{type:"primary","aria-label":i("reset"),title:i("reset"),onClick:a,children:i("reset")})]})]})};var Mt=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};const{useState:Lt,useRef:Rt,useEffect:Pt}=t.React,{useSelector:Nt}=t.ReactRedux,Et=i=>{var n,r;const{config:a,templateList:s,jimuMapView:u,errorTip:d,id:c,locale:p,useMapWidgetIds:v,outputDataSourceWarning:m,previewOverlayItem:h,showPlaceholder:f,showUtilityErrorRemind:g,controllerWidgetId:x}=i,{handlePrintStatusMessageChange:w,toggleUtilityErrorRemind:b,updatePreviewOverlayItem:S}=i,I=t.hooks.useTranslation(T,l.defaultMessages),O=Rt(null),j=Rt(null),C=Nt(e=>{var t,l;return null===(l=null===(t=null==e?void 0:e.appConfig)||void 0===t?void 0:t.widgets)||void 0===l?void 0:l[c]}),M=t.css`
    .compact-con {
      padding: 0;
      svg {
        margin: 0 auto;
      }
      .compact-icon {
        color: ${null===(r=null===(n=null==C?void 0:C.icon)||void 0===n?void 0:n.properties)||void 0===r?void 0:r.color};
      }
    }
    .off-panel-con {
      min-height: 32px;
      min-width: 32px;
    }
    .operate-con-width-controller-widget {
      min-width: 295px;
      padding: 12px;
      .close-con button{
        padding: 0;
        svg {
          margin: 0 auto;
        }
      }
    }
  `,L=t.css`
    & {
      padding: ${t.polished.rem(12)};
      width: ${t.polished.rem(320)};
    }
    .select-con {
      min-height: ${t.polished.rem(107)};
    }
    .result-con {
      min-height: ${t.polished.rem(107)};
    }
    .close-con button{
      padding: 0;
      svg {
        margin: 0 auto;
      }
    }
    .result-list-con button {
      padding: 0;
    }
    .compact-preview-con {
      width: 0;
    }
    .close-button {
      color: inherit;
    }
  `,[R,P]=Lt(!1),[N,E]=Lt(!1),[A,k]=Lt(null),[U,D]=Lt(null);Pt(()=>{V(0)},[]),Pt(()=>{if(U&&G(s,null==U?void 0:U.templateId)||V(0),U&&G(s,null==U?void 0:U.templateId)){const e=F(null==s?void 0:s.asMutable({deep:!0}),null==U?void 0:U.templateId);V(e)}},[s,a]);const V=e=>{if(0===(null==s?void 0:s.length))return!1;let t=null==s?void 0:s[e];t=(null==t?void 0:t.overrideCommonSetting)?z(null==a?void 0:a.commonSetting,t):z(t,null==a?void 0:a.commonSetting),D(t)},$=(e,l)=>{const o="clickOutside"!==l&&!R;P(o),clearTimeout(j.current),j.current=setTimeout(()=>{!o&&(0,t.focusElementInKeyboardMode)(O.current)})},W=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=F(null==s?void 0:s.asMutable({deep:!0}),l);V(o)},J=()=>{k(null),E(!1)},B=(e,l)=>{e.state=l,w(l),k((0,t.Immutable)(e))},_=()=>Mt(void 0,void 0,void 0,function*(){var e,l;const i={resultId:null==U?void 0:U.templateId,url:null,title:null===(e=null==U?void 0:U.layoutOptions)||void 0===e?void 0:e.titleText,state:y.Loading},n=(null==a?void 0:a.supportCustomReport)||(null==a?void 0:a.supportReport);k((0,t.Immutable)(i)),E(!N);const r={printTemplateProperties:U,mapView:u,locale:p,utility:a.useUtility,useMapWidgetIds:v,widgetId:c,isSupportReport:n},s=yield Ke(r);if(!s)return void B(i,y.Error);let d;n&&(d=o.MapViewManager.getInstance().getJimuMapViewById(u.id));const m=d||u;w(y.Loading),pt({useUtility:null==a?void 0:a.useUtility,mapView:null==m?void 0:m.view,printTemplateProperties:s,toggleUtilityErrorRemind:b,jimuMapView:u,useMapWidgetIds:v,widgetId:c,isSupportReport:n,reportOptions:null==U?void 0:U.reportOptions,elementOverrides:null===(l=null==U?void 0:U.layoutOptions)||void 0===l?void 0:l.elementOverrides,previewOverlayItem:h}).then(e=>{i.url=null==e?void 0:e.url,B(i,y.Success)},e=>{B(i,y.Error)})}),q=()=>{var o;return(0,e.jsxs)("div",{className:(0,t.classNames)("w-100 h-100",{"operate-con-width-controller-widget":x}),children:[!f&&(0,e.jsxs)("div",{className:"d-flex flex-column w-100 h-100",children:[!x&&(0,e.jsx)("div",{className:"text-right close-con",children:(0,e.jsx)(l.Button,{className:"print-button close-button",type:"tertiary","aria-label":I("closeTour"),title:I("closeTour"),onClick:$,children:(0,e.jsx)(Ye,{})})}),(0,e.jsxs)("div",{className:"flex-grow-1",children:[!N&&(0,e.jsx)("div",{className:(0,t.classNames)("w-100 h-100 select-con",{"sr-only":N}),children:(0,e.jsxs)("div",{className:"d-flex flex-column",children:[(0,e.jsx)(Le,{flowWrap:!0,className:"flex-grow-1",label:I("template"),children:(0,e.jsx)(l.Select,{value:(null==U?void 0:U.templateId)||"",onChange:W,size:"sm",className:"scalebar-unit","aria-label":I("template"),children:null==s?void 0:s.map((t,o)=>(0,e.jsx)(l.Option,{value:t.templateId,title:t.label,children:t.label},t.templateId))})}),(0,e.jsx)(Pe,{supportCustomReport:null==a?void 0:a.supportCustomReport,supportReport:null==a?void 0:a.supportReport,outputDataSourceWarning:m}),(0,e.jsxs)("div",{className:"print-button-con d-flex align-items-center mt-2",children:[(0,e.jsx)(Me,{className:"flex-grow-1 compact-preview-con",id:c,jimuMapView:u,scale:null==U?void 0:U.outScale,selectedTemplate:U,printExtentType:null==U?void 0:U.printExtentType,config:a,updatePreviewOverlayItem:S}),(0,e.jsx)(l.Button,{className:"print-button text-truncate ml-1",type:"primary",onClick:_,title:I("_widgetLabel"),"aria-label":I("_widgetLabel"),children:I("_widgetLabel")})]})]})}),N&&(0,e.jsx)(Ct,{printResult:A,restPrint:J,useUtility:null==a?void 0:a.useUtility})]})]}),f&&(0,e.jsx)("div",{children:d}),g&&(0,e.jsx)(ft,{utilityId:null===(o=null==a?void 0:a.useUtility)||void 0===o?void 0:o.utilityId,toggleUtilityErrorRemind:b})]})};return(0,e.jsxs)("div",{className:"w-100 h-100",css:M,children:[x&&(0,e.jsx)(l.Paper,{variant:"flat",className:"w-100 h-100",children:q()}),!x&&(0,e.jsxs)("div",{className:"w-100 h-100",children:[(0,e.jsx)(l.Button,{className:(0,t.classNames)("w-100 h-100 compact-con",{"off-panel-con":null==C?void 0:C.offPanel}),type:"tertiary",ref:O,title:I("_widgetLabel"),"aria-label":I("_widgetLabel"),onClick:$,children:(()=>{const t=null==C?void 0:C.icon;return t?"string"==typeof t?(0,e.jsx)(l.SVG,{src:t}):(0,e.jsx)(l.Icon,{className:"compact-icon",icon:null==t?void 0:t.svg}):(0,e.jsx)(Tt,{})})()}),(0,e.jsx)(l.Popper,{open:R,placement:"bottom",reference:O,shiftOptions:{crossAxis:!0},flipOptions:{fallbackPlacements:["left-start","left-end"]},arrowOptions:!0,toggle:$,css:L,children:q()})]})]})};var At=function(e,t,l,o){return new(l||(l=Promise))(function(i,n){function r(e){try{s(o.next(e))}catch(e){n(e)}}function a(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(r,a)}s((o=o.apply(e,t||[])).next())})};class kt extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.10.0",description:"update layoutChoiceList of old print widget",upgrader:e=>At(this,void 0,void 0,function*(){const l=null==e?void 0:e.useUtility,o=e=>{var l,o,i,n,r,a;let s=(0,t.Immutable)(e);if(null===(l=null==e?void 0:e.exportOptions)||void 0===l?void 0:l.dpi){const t=Number(null===(o=null==e?void 0:e.exportOptions)||void 0===o?void 0:o.dpi);t<0?s=s.setIn(["exportOptions","dpi"],1):parseInt(t)!==t&&(s=s.setIn(["exportOptions","dpi"],parseInt(t)))}if(null===(i=null==e?void 0:e.exportOptions)||void 0===i?void 0:i.width){Number(null===(n=null==e?void 0:e.exportOptions)||void 0===n?void 0:n.width)<1&&(s=s.setIn(["exportOptions","width"],800))}else(null==e?void 0:e.layout)&&W(null==e?void 0:e.layout)&&(s=s.setIn(["exportOptions","width"],800));if(null===(r=null==e?void 0:e.exportOptions)||void 0===r?void 0:r.height){Number(null===(a=null==e?void 0:e.exportOptions)||void 0===a?void 0:a.height)<1&&(s=s.setIn(["exportOptions","height"],1100))}else(null==e?void 0:e.layout)&&W(null==e?void 0:e.layout)&&(s=s.setIn(["exportOptions","height"],1100));return null==s?void 0:s.asMutable({deep:!0})};e=(e=>{var t,l;return(null===(l=null===(t=null==e?void 0:e.commonSetting)||void 0===t?void 0:t.exportOptions)||void 0===l?void 0:l.dpi)?e.setIn(["commonSetting"],o(e.commonSetting)):e})(e);if(l){const t=yield(i=l,n=e,O(void 0,void 0,void 0,function*(){return J(i).then(e=>M(e,i,n))}));if(null==t?void 0:t.layoutChoiceList){const l=((e,t)=>{var l;const i=(null===(l=null==e?void 0:e.printCustomTemplate)||void 0===l?void 0:l.asMutable({deep:!0}))||[];return i?null==i?void 0:i.map(e=>{var l;if(null==e?void 0:e.mapFrameSize)return o(e);{const i=null===(l=null==t?void 0:t.filter(t=>(null==t?void 0:t.layout)===(null==e?void 0:e.layout)))||void 0===l?void 0:l[0],n={mapFrameSize:null==i?void 0:i.mapFrameSize,mapFrameUnit:null==i?void 0:i.mapFrameUnit,hasAuthorText:null==i?void 0:i.hasAuthorText,hasCopyrightText:null==i?void 0:i.hasCopyrightText,hasLegend:null==i?void 0:i.hasLegend,hasTitleText:null==i?void 0:i.hasTitleText};return Object.assign(Object.assign({},o(e)),n)}}):i})(e,null==t?void 0:t.layoutChoiceList);return e.setIn(["layoutChoiceList"],null==t?void 0:t.layoutChoiceList).set("printCustomTemplate",l)}return e}return e;var i,n})},{version:"1.13.0",description:"Add default print preview style for old print widget",upgrader:e=>{let t=e;return"boolean"!=typeof(null==e?void 0:e.enablePreview)&&(t=t.set("enablePreview",!0).set("previewBackgroundColor","rgba(0,216,237,1)").set("previewOutLine",n)),t}},{version:"1.14.0",description:"Add default layout template or report template for old print widget",upgrader:e=>At(this,void 0,void 0,function*(){var t,l,o;let i=e;if(i.useUtility){i=(yield(r=i,At(void 0,void 0,void 0,function*(){let e=r;return J(e.useUtility).then(t=>ie(t).then(l=>At(void 0,void 0,void 0,function*(){var o,i;const{supportCustomLayout:n,defaultCustomLayoutItem:a,supportCustomReport:s,supportReport:u}=l;let d={layoutTypes:x.ServiceLayout},c={reportTypes:b.ServiceReport};if(n&&a&&(d=yield L(l,e.useUtility)),u||s){const o=(yield B(t,v.ReportTemplate))||[],i=P(o);e=e.set("reportTemplateChoiceList",i).set("defaultReportTemplate",null==l?void 0:l.defaultReportTemplate).set("defaultCustomReportItem",null==l?void 0:l.defaultCustomReportItem),c=yield R(o,l,e.useUtility)}const p=((null==e?void 0:e.printTemplateType)===f.Customize?null===(o=e.printCustomTemplate)||void 0===o?void 0:o.asMutable({deep:!0}):null===(i=e.printOrgTemplate)||void 0===i?void 0:i.asMutable({deep:!0})).map(e=>{if((u||s)&&(e.reportTypes=d.reportTypes,(null==c?void 0:c.customReportItem)&&(e.customReportItem=c.customReportItem),(null==c?void 0:c.report)&&(e.report=c.report),(null==c?void 0:c.reportOptions)&&(e.reportOptions=c.reportOptions)),e.layoutTypes=d.layoutTypes,n&&a){(null==d?void 0:d.customLayoutItem)&&(e.customLayoutItem=d.customLayoutItem);const t=null==d?void 0:d.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=t.webMapFrameSize))}return e});return e=(null==r?void 0:r.printTemplateType)===f.Customize?e.set("printCustomTemplate",p):e.set("printOrgTemplate",p),Promise.resolve(e)}),t=>Promise.resolve(e)))})))||i;const e=(null==i?void 0:i.printTemplateType)===f.Customize?null===(t=i.printCustomTemplate)||void 0===t?void 0:t.asMutable({deep:!0}):null===(l=i.printOrgTemplate)||void 0===l?void 0:l.asMutable({deep:!0});if(e&&i.layoutChoiceList){const t=(n=e,(null===(o=i.layoutChoiceList)||void 0===o?void 0:o.asMutable({deep:!0})).map(e=>{const t=(null==n?void 0:n.filter(t=>t.layout===e.layout)[0])||{};return e.customTextElementEnableList=t.customTextElementEnableList||[],e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e}));i=i.set("layoutChoiceList",t)}}var n,r;return i})}]}}const Ut=new kt,{useState:Dt,useEffect:Vt,useRef:zt}=t.React,Ft=l=>{const o=zt({}),i=zt(null),{reportOptions:n,id:r,handleWarningLabelChange:a}=l,[s,u]=Dt(null),[d,c]=Dt(null);Vt(()=>{const e=(null==n?void 0:n.reportSectionOverrides)||{},t=[],l=[],r=[],s=[];Object.keys(e).forEach(o=>{var i;const n=e[o],a=null===(i=null==n?void 0:n.exbDatasource)||void 0===i?void 0:i[0],u=null==n?void 0:n.isDsOutputDs;a&&u&&!(null==l?void 0:l.includes(null==a?void 0:a.dataSourceId))&&(t.push(a),l.push(null==a?void 0:a.dataSourceId)),!a||u||(null==r?void 0:r.includes(null==a?void 0:a.dataSourceId))||(s.push(a),r.push(null==a?void 0:a.dataSourceId))}),function(e,t){if((null==e?void 0:e.length)!==(null==t?void 0:t.length)||!e||!t)return!1;const l=e.sort(),o=t.sort();let i=!0;return null==l||l.forEach((e,t)=>{l[t]!==o[t]&&(i=!1)}),i}(l,i.current)||(a(null),o.current={}),i.current=l,u(t),c(s)},[n]);const p=(e,l)=>{var i,n;const r=l.dataSourceId,s=o.current,u=(null===(i=(0,t.getAppStore)().getState().appConfig)||void 0===i?void 0:i.widgets)||{};if((null==s?void 0:s[r])!==e){s[r]=e,o.current=s;const l=[],i={};Object.keys(s).forEach(e=>{var o;if(!s[e]){const n=t.DataSourceManager.getInstance().getDataSource(e),r=null==n?void 0:n.getLabel(),a=v(n),s=null===t.appConfigUtils||void 0===t.appConfigUtils?void 0:t.appConfigUtils.getWidgetIdByOutputDataSource(a),d=null===(o=null==u?void 0:u[s])||void 0===o?void 0:o.label;s&&(l.push(r),i[s]=d)}});let d=null,c=null;(null===(n=Object.keys(i))||void 0===n?void 0:n.length)>0&&(c=l.join(", "),d=Object.keys(i).map(e=>i[e]).join(", ")),a({label:c,widgets:d})}},v=e=>{var t;return e?{dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(t=e.getRootDataSource())||void 0===t?void 0:t.id}:null};return(0,e.jsxs)("div",{children:[null==s?void 0:s.map(l=>(0,e.jsx)(t.DataSourceComponent,{query:null,useDataSource:l,onDataSourceCreated:()=>{(e=>{p(!0,e)})(l)},onCreateDataSourceFailed:e=>{((e,t)=>{p(!1,t)})(0,l)},widgetId:r,queryCount:!0,onDataSourceInfoChange:e=>{((e,l)=>{const o=null==e?void 0:e.status,i=o!==t.DataSourceStatus.NotCreated&&o!==t.DataSourceStatus.CreateError&&o!==t.DataSourceStatus.LoadError&&o!==t.DataSourceStatus.SaveError&&o!==t.DataSourceStatus.NotReady;p(i,l)})(e,l)}},l.dataSourceId)),null==d?void 0:d.map(l=>(0,e.jsx)(t.DataSourceComponent,{query:null,useDataSource:l,widgetId:r,queryCount:!0},l.dataSourceId))]})},{useState:$t,useRef:Wt,useEffect:Gt}=t.React,Jt=i=>{var n;const{id:r,config:a,dispatch:s,useMapWidgetIds:u,layoutId:d,layoutItemId:c,locale:p,controllerWidgetId:v}=i,g=t.hooks.useTranslation(T,l.defaultMessages),x=t.ReactRedux.useSelector(e=>{var t;const l=null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.selection;return!(!l||l.layoutId!==d||l.layoutItemId!==c)}),w=t.ReactRedux.useSelector(e=>{var t,l;return null===(l=null===(t=e.widgetsState)||void 0===t?void 0:t[r])||void 0===l?void 0:l.loadingPrintService}),b=Wt(!1),S=Wt(null),[O,j]=$t(null),[C,M]=$t(g("printPlaceholder")),[L,R]=$t(null),[P,N]=$t(0),[E,A]=$t(null),[k,U]=$t(!1),[D,V]=$t(!1),[z,F]=$t(" "),[$,W]=$t(null),G=t.css`
    .jimu-widget-placeholder {
      border: none;
    }
    &.surface-1 {
      border: none !important;
    }
    .checkbox-con:hover {
      color: var(--sys-color-surface-paper-text);
    }
  `;Gt(()=>{q()},[x]),Gt(()=>{_()},[a]),Gt(()=>{ee(O,L,a)},[L,a,O]),Gt(()=>{w&&R(null)},[w]);const J=e=>{W(e)},B=e=>{switch(e){case y.Loading:F(g("printing"));break;case y.Error:F(g("printError"));break;case y.Success:F(g("printSuccess"))}},_=()=>{var e,t;let l=(e=null==a?void 0:a.printServiceType,t=null==a?void 0:a.printTemplateType,e===h.Customize||t===f.Customize)?null==a?void 0:a.printCustomTemplate:null==a?void 0:a.printOrgTemplate;((null==a?void 0:a.supportCustomReport)||(null==a?void 0:a.supportReport))&&(l=null==l?void 0:l.filter(e=>K(null==e?void 0:e.asMutable({deep:!0}),a))),R(l)},q=()=>{d&&r&&c&&!b.current&&x&&(s(t.appActions.widgetStatePropChange(r,"layoutInfo",{layoutId:d,layoutItemId:c})),b.current=!0)},H=e=>{var t;const l=!u||0===(null==u?void 0:u.length);return(null!=e||l)&&(l||"2d"===(null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.type))?(l&&M(g("printPlaceholder")),void j(e)):(M(g("chooseMapTip")),void j(null))},Z=e=>{},X=()=>{let e=C;return O&&!(null==a?void 0:a.useUtility)&&(e=""),e},Y=(e=!1)=>{V(e),e&&(clearTimeout(S.current),S.current=setTimeout(()=>{V(!1)},5e3))},ee=t.hooks.useEventCallback((e,t,l)=>{var o;const{supportCustomReport:i,supportReport:n}=l;let r=!1;if(!e||!(null==l?void 0:l.useUtility))return r=!0,void U(r);if(n||i){let e=!0;if(null==t||t.forEach(t=>{K(null==t?void 0:t.asMutable({deep:!0}),l)&&(e=!1)}),e){const e=((e,t,l)=>{const o=Q(e,t),{reportsAvailable:i,elementOverridesAvailable:n}=o;let r;return i||(r=l("reportTemplateRemind")),n||(r=r?`${r} ${l("dynamicElementTemplateRemind")}`:l("dynamicElementTemplateRemind")),r})(null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.asMutable({deep:!0}),l,g);C&&M(e),r=!0}}t&&0!==(null==t?void 0:t.length)&&!w||(r=!0,M(null)),U(r)});return(0,e.jsxs)(l.Paper,{transparent:(null==a?void 0:a.modeType)===m.Compact,className:"jimu-widget widget-print",css:G,children:[(0,e.jsx)("div",{className:"map",children:(0,e.jsx)("div",{children:(0,e.jsx)(o.JimuMapViewComponent,{useMapWidgetId:null==u?void 0:u[0],onActiveViewChange:H,onViewGroupCreate:Z})})}),(null==a?void 0:a.modeType)===m.Classic&&(0,e.jsxs)("div",{className:"w-100 h-100",children:[!k&&(0,e.jsx)(St,{outputDataSourceWarning:E,handleSelectedTemplateIndexChange:e=>{N(e)},useMapWidgetIds:u,id:r,locale:p,config:a,jimuMapView:O,templateList:L,showUtilityErrorRemind:D,previewOverlayItem:$,toggleUtilityErrorRemind:Y,updatePreviewOverlayItem:J,handlePrintStatusMessageChange:B}),k&&(0,e.jsx)(l.WidgetPlaceholder,{name:g("_widgetLabel"),icon:I(),message:X()})]}),(null==a?void 0:a.modeType)===m.Compact&&(0,e.jsx)("div",{className:"w-100 h-100",children:(0,e.jsx)(Et,{showPlaceholder:k,outputDataSourceWarning:E,useMapWidgetIds:u,id:r,config:a,locale:p,jimuMapView:O,templateList:L,controllerWidgetId:v,errorTip:X(),showUtilityErrorRemind:D,toggleUtilityErrorRemind:Y,previewOverlayItem:$,updatePreviewOverlayItem:J,handlePrintStatusMessageChange:B})}),((null==a?void 0:a.supportReport)||(null==a?void 0:a.supportCustomReport))&&(0,e.jsx)(Ft,{id:r,reportOptions:null===(n=null==L?void 0:L[P])||void 0===n?void 0:n.reportOptions,handleWarningLabelChange:e=>{A(e)}}),(0,e.jsx)("div",{role:"alert","aria-live":"assertive",className:"sr-only",children:z})]})};Jt.versionManager=Ut;const Bt=Jt;function _t(e){a.p=e}})(),s})())}}});