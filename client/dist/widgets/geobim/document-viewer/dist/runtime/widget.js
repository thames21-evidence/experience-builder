System.register(["jimu-core/emotion","jimu-core","jimu-ui","widgets/shared-code/geobim"],function(e,t){var n={},i={},o={},s={};return{setters:[function(e){n.Fragment=e.Fragment,n.jsx=e.jsx,n.jsxs=e.jsxs},function(e){i.React=e.React,i.ReactRedux=e.ReactRedux,i.WidgetState=e.WidgetState,i.classNames=e.classNames,i.css=e.css,i.lodash=e.lodash},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Loading=e.Loading,o.Paper=e.Paper,o.Typography=e.Typography},function(e){s.ApsLogIn=e.ApsLogIn,s.ExBThemeSpacing=e.ExBThemeSpacing,s.GeoBIMProvider=e.GeoBIMProvider,s.ModelViewerErrorCodes=e.ModelViewerErrorCodes,s.ModelViewerProvider=e.ModelViewerProvider,s.ReactModelViewer=e.ReactModelViewer,s.UserTypeNotPermissible=e.UserTypeNotPermissible,s.areIDocumentsEqual=e.areIDocumentsEqual,s.areModelViewerLinkedDocumentsEqual=e.areModelViewerLinkedDocumentsEqual,s.defaultSharedMessages=e.defaultSharedMessages,s.geoBIMWidgetContainerStyle=e.geoBIMWidgetContainerStyle,s.hidableContainerStyle=e.hidableContainerStyle,s.loadingContainerStyle=e.loadingContainerStyle,s.modelViewerDisabledSelector=e.modelViewerDisabledSelector,s.modelViewerLinkedDocumentSelector=e.modelViewerLinkedDocumentSelector,s.setModelViewerDisabled=e.setModelViewerDisabled,s.setModelViewerLinkedDocument=e.setModelViewerLinkedDocument,s.useApsAuth=e.useApsAuth,s.useGeoBIM=e.useGeoBIM,s.useLinks=e.useLinks,s.useModelViewer=e.useModelViewer,s.useMultipleSelectionWarning=e.useMultipleSelectionWarning,s.useSharedMessages=e.useSharedMessages,s.widgetHeaderStyle=e.widgetHeaderStyle}],execute:function(){e((()=>{var e={8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=o},38512:e=>{"use strict";e.exports=s},51334:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 3.5a3.5 3.5 0 1 0-7 0V6H3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-2V3.5l.005-.164A2.5 2.5 0 0 1 12.5 1l.164.005A2.5 2.5 0 0 1 15 3.5a.5.5 0 0 0 1 0M9 7H3v8h9V7H9m-1.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=i}},t={};function l(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,l),o.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var r={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(r),l.d(r,{__set_webpack_public_path__:()=>C,default:()=>F});var e=l(67386),t=l(79244),n=l(14321),i=l(38512);const o={_widgetLabel:"Document Viewer",_widgetDescription:"A widget to display and interact with 2D and 3D documents from Autodesk Construction Cloud.",widgetTitle:"Document Viewer",geobim_logInText:" to your Autodesk account to view documents.",noDocument:"No document to display.",geobim_multipleFeatures:"Multiple feature selection is currently not supported by the Document Viewer widget. Please select a single feature and continue.",noDocumentTitle:"(No Document Title)",documentLockDisabledMessage:"Make a selection to lock documents",documentUnlockedMessage:"Lock current document",documentLockedMessage:"Unlock current document",documentNotViewable:"Processing Error: File cannot be previewed in Viewer."};var s=l(8547),a=l.n(s),c=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n};const d=n=>{const i=window.SVG,{className:o}=n,s=c(n,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?(0,e.jsx)(i,Object.assign({className:l,src:a()},s)):(0,e.jsx)("svg",Object.assign({className:l},s))};var u=l(51334),m=l.n(u),g=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n};const p=n=>{const i=window.SVG,{className:o}=n,s=g(n,["className"]),l=(0,t.classNames)("jimu-icon jimu-icon-component",o);return i?(0,e.jsx)(i,Object.assign({className:l,src:m()},s)):(0,e.jsx)("svg",Object.assign({className:l},s))},{useState:v,useMemo:w,useRef:h}=t.React,{useSelector:x}=t.ReactRedux,{useRef:M}=t.React,{useDispatch:b}=t.ReactRedux;var y=function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function l(e){try{a(i.next(e))}catch(e){s(e)}}function r(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,r)}a((i=i.apply(e,t||[])).next())})};const{useMemo:f}=t.React,S=(e,n,o,s)=>{const{geoBIMLoading:l,geoBIMInitialized:r}=(0,i.useGeoBIM)(),{bimDocument:a,documentLoading:c,multipleFeatureSelectionWarning:d,cancelMultipleFeatureSelectionWarning:u}=((e,t)=>{const{linksLoading:n,linksInitialized:o}=(0,i.useLinks)(),{hasMapWidget:s,geoBIMInitialized:l,geoBIMLoading:r,selectionUpdating:a,selectedFeatures:c}=(0,i.useGeoBIM)(),{multipleFeatureSelectionWarning:d,cancelMultipleFeatureSelectionWarning:u}=(0,i.useMultipleSelectionWarning)(c,!t),m=x(t=>(0,i.modelViewerLinkedDocumentSelector)(e,t)),g=w(()=>{var e;return null!==(e=null==m?void 0:m.asMutable({deep:!0}))&&void 0!==e?e:null},[m]),p=h(null),[M,b]=v(null),y=w(()=>!(l&&(!s||o&&!r&&!a))||n,[l,r,s,o,n,a]);return y||(0,i.areModelViewerLinkedDocumentsEqual)(p.current,g)||(p.current=g,null!=(null==g?void 0:g.document)?(b(g),u()):t||b(null)),w(()=>({bimDocument:M,documentLoading:y,multipleFeatureSelectionWarning:d,cancelMultipleFeatureSelectionWarning:u}),[M,y,d,u])})(e,n);(e=>{var n,o,s;const{featureDocumentLinks:l}=(0,i.useLinks)(),{selectedFeatures:r}=(0,i.useGeoBIM)(),a=b(),c=M(null),d=M(null),u=null!==(o=null!==(n=null==l?void 0:l.documents.find(e=>e.isDefault))&&void 0!==n?n:null==l?void 0:l.documents[0])&&void 0!==o?o:null,m=null!==(s=null==l?void 0:l.feature.bimIds)&&void 0!==s?s:null;(0,i.areIDocumentsEqual)(c.current,u)&&t.lodash.isDeepEqual(d.current,m)||(d.current=m,c.current=u,(null==r?void 0:r.length)>0&&(0,i.setModelViewerLinkedDocument)(e,u,m,a))})(e);const m=f(()=>null==(null==a?void 0:a.document)?s("widgetTitle"):a.document.displayName||s("noDocumentTitle"),[a,s]),g=f(()=>({getAccessToken:()=>y(void 0,void 0,void 0,function*(){var e,t;const n=yield o();return{accessToken:null!==(e=null==n?void 0:n.accessToken)&&void 0!==e?e:null,expiresInSeconds:null!==(t=null==n?void 0:n.expiresInSeconds)&&void 0!==t?t:null}})}),[o]),p=f(()=>!n&&(c||l||!r),[c,r,l,n]);return f(()=>({modelViewerTitle:m,modelViewerOptions:g,bimDocument:a,documentLoading:c,widgetLoading:p,multipleFeatureSelectionWarning:d,cancelMultipleFeatureSelectionWarning:u}),[m,g,a,c,p,d,u])},{useMemo:j,useState:V,useEffect:I}=t.React,D=e=>(0,t.css)({label:"modelViewerAlert",width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",padding:`0 ${e.sys.spacing(i.ExBThemeSpacing.Five)} ${e.sys.spacing(i.ExBThemeSpacing.Five)} ${e.sys.spacing(i.ExBThemeSpacing.Five)}`,"div.jimu-alert-panel":{width:"100% !important"}}),L=e=>(0,t.css)({label:"multipleSelectionAlert",position:"absolute",bottom:0,left:0,padding:`0 ${e.sys.spacing(i.ExBThemeSpacing.Five)} ${e.sys.spacing(i.ExBThemeSpacing.Five)} ${e.sys.spacing(i.ExBThemeSpacing.Five)}`,"div.jimu-alert-panel":{width:"100% !important"}}),T=e=>(0,t.css)({label:"noDocumentMessage",width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:e.sys.color.surface.paperHint}),k=o=>{const{bimDocument:s,theme:l,i18nMessage:r}=o,{viewerErrorMessage:a,documentVisible:c}=((e,n)=>{var o,s;const{showModelViewer:l,viewDocument:r,viewerError:a}=(0,i.useModelViewer)(),{widgetState:c}=(0,i.useGeoBIM)(),[d,u]=V(!1),m=null===(o=null==e?void 0:e.document)||void 0===o?void 0:o.url,g=null==e?void 0:e.selectedIds,p=null===(s=null==e?void 0:e.document)||void 0===s?void 0:s.issue;I(function(){null!=m&&c!==t.WidgetState.Closed?(l(!0),u(!0),r(m,void 0,null!=g?g:void 0,void 0!==p?[p]:void 0)):(l(!1),u(!1))},[g,m,l,r,p,c]);const v=j(()=>null===a?null:a.errorCode===i.ModelViewerErrorCodes.NOT_VIEWABLE?n("documentNotViewable"):null!=a.internalErrorCode?`Code ${a.internalErrorCode}: ${a.message}`:a.message,[a,n]);return j(()=>({viewerErrorMessage:v,documentVisible:d}),[d,v])})(s,r);return(0,e.jsxs)("div",{css:(0,t.css)({label:"modelViewerWrapper",position:"relative",width:"100%",height:"100%"}),children:[null!==a&&(0,e.jsx)("div",{css:D(l),children:(0,e.jsx)(n.Alert,{text:a,"aria-live":"polite",open:!0,size:"medium",type:"warning",withIcon:!0})}),null===a&&!c&&(0,e.jsx)("div",{css:T(l),children:r("noDocument")}),(0,e.jsx)("div",{css:(0,i.hidableContainerStyle)(l,null!==a),children:(0,e.jsx)(i.ReactModelViewer,{})})]})},{useSelector:B,useDispatch:O}=t.ReactRedux,{useState:E}=t.React,P=o=>{const{theme:s,widgetId:l,i18nMessage:r}=o,a=B(e=>(0,i.modelViewerDisabledSelector)(l,e)),{apsAuthenticated:c,userHasPermission:u,geoBIMInitialized:m}=(0,i.useGeoBIM)(),{getApsAuthToken:g}=(0,i.useApsAuth)(),v=O(),{modelViewerTitle:w,modelViewerOptions:h,bimDocument:x,documentLoading:M,widgetLoading:b,multipleFeatureSelectionWarning:y,cancelMultipleFeatureSelectionWarning:f}=S(l,a,g,r),[j,V]=E(!1);!j&&x&&V(!0);const I=M||!c||null==x,D=y&&!b,P=b&&!j||D,A=!u&&m;return(0,e.jsxs)("div",{css:(0,i.geoBIMWidgetContainerStyle)(s),children:[(0,e.jsxs)("div",{css:(0,i.widgetHeaderStyle)(s),children:[(0,e.jsx)(n.Typography,{variant:"title1",color:"overlayText",children:w}),(0,e.jsx)("div",{title:r(I?"documentLockDisabledMessage":a?"documentLockedMessage":"documentUnlockedMessage"),children:(0,e.jsx)(n.Button,{type:a?"primary":"default",onClick:()=>{(0,i.setModelViewerDisabled)(l,!a,v)},disabled:I,icon:!0,children:a?(0,e.jsx)(d,{}):(0,e.jsx)(p,{})})})]}),A&&(0,e.jsx)(i.UserTypeNotPermissible,{userTypeNotPermissibleLinkText:r("geobim_userTypeLink"),userTypeNotPermissibleText:r("geobim_userTypeNote",{widget_name:r("widgetTitle")}),theme:s}),!c&&!A&&(0,e.jsx)(i.ApsLogIn,{logInLinkText:r("geobim_logInLink"),loginMessageFirstLine:r("geobim_logInText"),loginMessageSecondLine:r("geobim_logInTip"),theme:s}),c&&!A&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{css:(0,t.css)({label:"modelViewerBody",position:"relative",width:"100%",height:"100%"}),children:[b&&(0,e.jsx)("div",{css:(0,i.loadingContainerStyle)(s),children:(0,e.jsx)(n.Loading,{})}),D&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{css:T(s),children:r("noDocument")}),(0,e.jsx)("div",{css:L(s),children:(0,e.jsx)(n.Alert,{text:r("geobim_multipleFeatures"),"aria-live":"polite",closable:!0,open:!0,onClose:()=>{f()},size:"medium",type:"warning",withIcon:!0})})]}),(0,e.jsx)("div",{css:(0,i.hidableContainerStyle)(s,P),children:(0,e.jsx)(i.ModelViewerProvider,{options:h,children:(0,e.jsx)(k,{bimDocument:x,theme:s,i18nMessage:r})})})]})})]})},{useCallback:A}=t.React,F=t=>{const{useMapWidgetIds:s,intl:l,theme:r,widgetId:a,state:c,manifest:d}=t,{translateMessage:u}=(0,i.useSharedMessages)(l,d.translatedLocales),m=null==s?void 0:s[0],g=A((e,t)=>{const n=Object.assign(Object.assign({},i.defaultSharedMessages.default),o);return u(e,n,t)},[u]);return(0,e.jsx)(n.Paper,{shape:"none",className:"jimu-widget widget-document-viewer",children:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(i.GeoBIMProvider,{mapWidgetId:m,widgetId:a,widgetState:c,children:(0,e.jsx)(P,{i18nMessage:g,theme:r,widgetId:a})})})})};function C(e){l.p=e}})(),r})())}}});