"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-cb9ce4"],{4712:(e,t,i)=>{i.d(t,{a:()=>r,g:()=>a,s:()=>n});var s=i(8249),o=i(7212);function r(e,t){try{return null!=e&&e.length>0?null!=t&&t.length>0?(s.T.setToken(e,t),o.B.i18n("ok")):o.B.i18n("invalid-token"):o.B.i18n("invalid-username")}catch(e){return e}}function n(e){try{return null!=e&&e.length>0?(s.S.setEnvironment(e),o.B.i18n("ok")):o.B.i18n("invalid-environment")}catch(e){return e}}async function a(e,t=!1,i){return await s.G.getInfographicTemplatesList(e,t,i)}},9622:(e,t,i)=>{i.r(t),i.d(t,{arcgis_infographic_selector:()=>h,arcgis_infographic_tree:()=>l});var s=i(982),o=i(7212),r=i(8249),n=i(4712);class a{static show=(e,t,i,s,r)=>{t&&i&&r&&o.b.hasText(r)&&(e==this._reportId?this._resetTimer():(this.hidePopup(),this.timeoutSeconds||(this.timeoutSeconds=6),this._container=t,this._reportId=e,this._generatePopup(i,s,r),this._startTimer()))};static nextCallback(e){e&&(this._callbackNext=e)}static previousCallback(e){e&&(this._callbackPrev=e)}static hidePopup(){this._cancelTimer(),this._removePopup(),this._reportId=""}static timeoutSeconds;static _container;static _popupElement;static _reportId;static _callbackNext;static _callbackPrev;static _rightPad=60;static _timer;static _onTimerTick(){this._timer=void 0,this.hidePopup()}static _onGoToNext(){this._callbackNext&&this._callbackNext(this._reportId)}static _onGoToPrev(){this._callbackPrev&&this._callbackPrev(this._reportId)}static _startTimer(){const e=this;e._cancelTimer(),e._timer=setTimeout(()=>{e._onTimerTick.call(e)},1e3*this.timeoutSeconds)}static _cancelTimer(){this._timer&&(clearTimeout(this._timer),this._timer=void 0)}static _resetTimer(){this._cancelTimer(),this._startTimer()}static _removePopup(){this._popupElement&&this._popupElement.remove(),this._popupElement=void 0}static _generatePopup(e,t,i){const s=this,o=document.createElement("div");o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.width=this._container.offsetWidth-this._rightPad+"px",o.style.height=this._container.offsetHeight+"px",o.style.backgroundColor="transparent",o.style.zIndex="900",this._popupElement=o,this._container.appendChild(this._popupElement),o.addEventListener("mouseover",()=>{s.hidePopup()}),this._placeImageDiv(e,t,i)}static _placeImageDiv(e,t,i){try{const s=20,o=document.createElement("img");let r={click:{y:e},popup:{top:0,right:0,wt:1,ht:1},adjustedContHt:this._popupElement.offsetHeight-2*s,adjustedContWt:this._popupElement.offsetWidth-s,ratio:t};r.ratio>=1?(r.popup.wt=r.adjustedContWt,r.popup.ht=r.popup.wt/r.ratio,r.popup.ht>r.adjustedContHt&&(r.popup.ht=r.adjustedContHt,r.popup.wt=r.adjustedContHt*r.ratio)):(r.popup.ht=r.adjustedContHt,r.popup.wt=r.popup.ht*r.ratio,r.popup.wt>r.adjustedContWt&&(r.popup.wt=r.adjustedContWt,r.popup.ht=r.adjustedContWt/r.ratio));const n=e/2-r.popup.ht/2+s,a=this._popupElement.offsetHeight-r.popup.ht-s,l=s;r.popup.top=Math.max(Math.min(n,a),l),o.style.position="absolute",o.style.right=`${r.popup.right}px`,o.style.top=`${r.popup.top}px`,o.style.width=`${r.popup.wt}px`,o.style.height=`${r.popup.ht}px`,o.src=i,this._popupElement.appendChild(o),o.addEventListener("mouseover",e=>(e.stopPropagation(),e.preventDefault(),!1))}catch(e){console.error("PreviewPopup error:",e)}return document.createElement("img")}}const l=class{get el(){return(0,s.g)(this)}baseConfig;_instanceId;_idPrefix="arcgis-infographic-tree-";_busyId;_idPrefixBusy="arcgis-infographic-tree-busy-";_containerId;_busyIdPrefix="ig-tree-busy-";_containerPrefix="ait-container-";_infographics;_elementIds={};_idListPrefix="ig-tree-list-";_idSearchPrefix="ig-tree-search-";_idSortPrefix="ig-tree-sort-";_reportsId;_idPrefixReports="selector-popover-reports-";_debounceTimer;_imgOffset=1;_content;_selectedReport;_configFilteredReports;_dbg=!1;_cachedReports;_onResizeRef=()=>{this.adjustTreeItemsWidth(),this._syncCategoryPopoverWidth(),this._syncSortPopoverWidth()};constructor(e){(0,s.r)(this,e),this.reportSelected=(0,s.c)(this,"reportSelected",7),this.stSelectedCategory="all",this.stSelectedCategoryLabel=o.B.i18n("all-infographics"),this.config=void 0,this.colors=void 0,this.theme=void 0,this.env=void 0,this.token=void 0,this.username=void 0,this.langCode=void 0,this.sourceCountry=void 0,this.selectedHierarchy=void 0,this.geoenrichmentUrl=void 0,this.selectedReportId=void 0,this.portalUrl=void 0,this.reportList=void 0,this.portalOnlineGEProxy=void 0,this.stEnv=void 0,this.stToken=void 0,this.stUsername=void 0,this.stLangCode=void 0,this.stSourceCountry="US",this.stSelectedHierarchy=o.U,this.stColors=void 0,this.stTheme=void 0,this.stMultipleChoice=!1,this.stSelectedReportId=void 0,this.stColorTheme=void 0,this.stReportList=void 0,this.stGeoenrichmentUrl=void 0,this.stSortType="newest",this.stTimestamp=void 0,this.isSortOpen=!1,this._isInitialized=!1,this.openPopoverId=null,this.isCategoryOpen=!1,this.defaultReport=void 0,this.stDefaultReport=void 0,this.baseConfig=new o.a("tree",this,this.onUpdateUI),o.A.announceVersion(),this._instanceId=o.E.generateId(this._idPrefix).id,this._busyId=o.E.generateId(this._idPrefixBusy).id,this._infographics={MyInfographics:{dataId:2,tag:"report-my-infographics",data:void 0},EsriInfographics:{dataId:3,tag:"report-esri-infographics",data:void 0},SharedInfographics:{dataId:4,tag:"report-shared-infographics",data:void 0},GalleryInfographics:{dataId:5,tag:"report-gallery-infographics",data:void 0},TabularReports:{dataId:6,tag:"report-tabular-reports",data:void 0}},this.langCode="en-us",this.sourceCountry="US",this.stMultipleChoice=!1,o.B._initialize(this.langCode)}_categoryKeyMap={public:"esri",user:"my",shared:"shared",gallery:"gallery",tabular:"tabular"};_labels={all:o.B.i18n("all-infographics"),esri:o.B.i18n("esri-infographics"),my:o.B.i18n("my-infographics"),shared:o.B.i18n("shared-infographics"),gallery:o.B.i18n("gallery-infographics"),tabular:o.B.i18n("tabular-reports")};_activeLists(){const e=this._configFilteredReports||this.stReportList||this._cachedReports;return e&&Object.keys(e).length?{user:e.user??[],public:e.public??[],shared:e.shared??[],gallery:e.gallery??[],tabular:e.tabular??[]}:{user:this._infographics?.MyInfographics?.data??[],public:this._infographics?.EsriInfographics?.data??[],shared:this._infographics?.SharedInfographics?.data??[],gallery:this._infographics?.GalleryInfographics?.data??[],tabular:this._infographics?.TabularReports?.data??[]}}_availableCategoryValues(){if(this.baseConfig?.config?.reportList){const e="string"==typeof this.baseConfig.config.reportList?JSON.parse(this.baseConfig.config.reportList):this.baseConfig.config.reportList,t=o.A.getKeys(e);if(0===t?.length)return["esri"]}const e=this._configFilteredReports||this.stReportList||this._cachedReports||this._activeLists(),t=[];return Object.keys(this._categoryKeyMap).forEach(i=>{const s=e?.[i]??[];Array.isArray(s)&&s.some(e=>e&&!1!==e.isChecked)&&t.push(this._categoryKeyMap[i])}),!t.length&&this._infographics?.EsriInfographics?.data?.length&&t.push("esri"),t}_categoryOptionsForUI(){const e=this._availableCategoryValues(),t=[];e.length>1&&t.push({value:"all",label:this._labels.all});for(const i of e)t.push({value:i,label:this._labels[i]});return t}_ensureValidCategorySelection(){const e=this._categoryOptionsForUI().map(e=>e.value);if(!e.includes(this.stSelectedCategory)){const t=e.includes("all")?"all":e[0];this.stSelectedCategory=t,this.stSelectedCategoryLabel=this._labels[t]}}_getReportsByCategory(e){const{user:t,public:i,shared:s,gallery:o,tabular:r}=this._activeLists();switch(e||"all"){case"esri":return i;case"my":return t;case"shared":return s;case"gallery":return o;case"tabular":return r;default:return this._dedupeById([...i,...t,...s,...o,...r])}}_dedupeById(e){const t=new Set;return e.filter(e=>{const i=e&&(e.id??e.reportID);return!(!i||t.has(i))&&(t.add(i),!0)})}handleCategorySelect(e){if(e===this.stSelectedCategory){const e=o.A.queryElementById.call(this,this._elementIds.category+"-popover");return void(e&&(e.open=!1))}this.stSelectedCategory=e;const t=this._categoryOptionsForUI().find(t=>t.value===e);this.stSelectedCategoryLabel=t?t.label:"";const i=o.A.queryElementById.call(this,this._elementIds.category+"-popover");i&&(i.open=!1),this.stTimestamp=Date.now(),requestAnimationFrame(()=>this.adjustTreeItemsWidth())}onConfigChange(e,t){if(o.a.LogConfig("TREE config change",e,t),e&&"string"==typeof e&&this.baseConfig&&o.A.hasText(e)){const t=JSON.parse(e);if(this.baseConfig.updateConfig(t),this.baseConfig.config?.reportList){let e={};const t="string"==typeof this.baseConfig.config.reportList?JSON.parse(this.baseConfig.config.reportList):this.baseConfig.config.reportList,i=o.A.getKeys(t);if(i&&i.length>0)for(let s=0;s<i.length;s++){let o=[];const r=i[s],n=t[r];Array.isArray(n)&&n.length>0&&n.forEach(e=>{e.isChecked&&o.push(e)}),o.length>0&&(e[r]=o)}this._configFilteredReports=e}else this._configFilteredReports=void 0;if(e&&o.A.hasText(e)){const t=JSON.parse(e);t&&this.setDefaultReport(t.defaultReport)}this._ensureValidCategorySelection()}}onDefaultReportChanged(){if(o.a.Log("TREE updating defaultReport",this.defaultReport),"string"==typeof this.defaultReport){if(this.defaultReport&&o.A.hasText(this.defaultReport)){const e=JSON.parse(this.defaultReport);e&&e.id&&e.name?(this.stDefaultReport=e,this.stSelectedReportId=e.id):(this.stDefaultReport=void 0,this.stSelectedReportId="")}}else void 0===this.defaultReport?(this.stDefaultReport=void 0,this.stSelectedReportId=""):this.defaultReport?.id&&this.defaultReport?.name&&o.A.hasText(this.defaultReport?.id)&&o.A.hasText(this.defaultReport?.name)?(this.stDefaultReport=this.defaultReport,this.stSelectedReportId=this.defaultReport.id):(this.stDefaultReport=void 0,this.stSelectedReportId="")}_hasReport(e){return e&&e.id&&o.A.hasText(e.id)&&e.name&&o.A.hasText(e.name)}_sameReport(e,t){return!e&&!t||e&&t&&e.id==t.id&&e.name==t.name}_getSelectedReport(){let e;const t=this.baseConfig.getParentConfigProperty("selectedReport");return e=this._sameReport(this._selectedReport,t)?this._selectedReport:t,this._sameReport(this._selectedReport,t)||(this._selectedReport=t),e}async setDefaultReport(e){o.a.Log("TREE setDefaultReport",e),e&&e.id&&o.A.hasText(e.id)&&e.name&&o.A.hasText(e.name)?(this.stDefaultReport=e,this.stSelectedReportId=e.id):(this.stDefaultReport=void 0,this.stSelectedReportId="")}onEnvChanged(){this.stEnv=this.env,r.E.setEnvironment(this.env),this.baseConfig&&this.baseConfig.updateConfig({env:this.env})}onLangCodeChanged(){this.stLangCode=this.langCode,o.B._initialize(this.stLangCode),this.baseConfig&&this.baseConfig.updateConfig({langCode:this.langCode})}onReportListChanged(){if(!this.reportList)return this.stReportList=void 0,void this._ensureValidCategorySelection();this.stReportList="string"==typeof this.reportList?JSON.parse(this.reportList):this.reportList,this._ensureValidCategorySelection()}onSourceCountryChanged(){this.stSourceCountry=this.sourceCountry,this.baseConfig&&this.baseConfig.updateConfig({sourceCountry:this.sourceCountry}),this._configFilteredReports=void 0,this._cachedReports=void 0,this.stReportList=void 0,this._ensureValidCategorySelection()}onSelectedHierarchyChanged(){this.stSelectedHierarchy=this.selectedHierarchy,this.baseConfig&&this.baseConfig.updateConfig({selectedHierarchy:this.selectedHierarchy}),this._configFilteredReports=void 0,this._cachedReports=void 0,this.stReportList=void 0,this._ensureValidCategorySelection()}onTokenChanged(){this.stToken=this.token,this.baseConfig&&this.baseConfig.updateConfig({token:this.token}),this.username&&o.A.hasText(this.username)&&this.token&&o.A.hasText(this.token)&&(0,n.a)(this.username,this.token),r.T.setToken(this.username,this.token)}onUsernameChanged(){this.stUsername=this.username,this.baseConfig&&this.baseConfig.updateConfig({username:this.username}),this.username&&o.A.hasText(this.username)&&(0,n.a)(this.username,r.T.token.access_token)}onSelectedReportChanged(){this.stSelectedReportId=this.selectedReportId}onThemeChanged(){this.stTheme=this.theme,this.baseConfig&&this.baseConfig.setTheme(this.theme)}onPortalUrlChanged(){this.portalUrl&&r.E.setPortalUrl(this.portalUrl)}onGeoenrichmentUrlChanged(){this.stGeoenrichmentUrl=this.geoenrichmentUrl,this.baseConfig&&this.baseConfig.updateConfig({geoenrichmentUrl:this.geoenrichmentUrl}),this.geoenrichmentUrl&&r.E.setGeoenrichmentUrl(this.geoenrichmentUrl)}reportSelected;async updateLayout(){this.adjustTreeItemsWidth()}async getConfig(){return this.baseConfig}async initialize(e,t,i,s,a,l,h){const d=this;if(d.token=t,d.username=e,d.sourceCountry=s,d.selectedHierarchy=a,d.langCode=l,d.env=i,h){const e="string"==typeof h?JSON.parse(h):h;d.stReportList=e&&Object.keys(e).length?e:{}}else d.stReportList||(d.stReportList={});d.onTokenChanged(),r.E.setEnvironment(d.env),d.geoenrichmentUrl&&r.E.setGeoenrichmentUrl(d.geoenrichmentUrl),d.portalUrl&&r.E.setPortalUrl(d.portalUrl),(0,n.a)(e,t);try{let e,t,i,o,r;const l=await(0,n.g)(s,!1,a);Object.keys(d.stReportList).length?(e=d.stReportList.user,t=d.stReportList.public,i=d.stReportList.shared,o=d.stReportList.gallery,r=d.stReportList.tabular):(e=(l.user??[]).map(e=>({...e,isChecked:!1})),t=(l.public??[]).map(e=>({...e,isChecked:!0})),i=(l.shared??[]).map(e=>({...e,isChecked:!1})),o=(l.gallery??[]).map(e=>({...e,isChecked:!1})),r=(l.tabular??[]).map(e=>({...e,isChecked:!1})),d.stReportList={user:e,public:t,shared:i,gallery:o,tabular:r}),l?(d._infographics.MyInfographics.data=e,d._infographics.EsriInfographics.data=t,d._infographics.SharedInfographics.data=i,d._infographics.GalleryInfographics.data=o,d._infographics.TabularReports.data=r):(d._infographics.MyInfographics.data=void 0,d._infographics.EsriInfographics.data=void 0,d._infographics.SharedInfographics.data=void 0,d._infographics.GalleryInfographics.data=void 0,d._infographics.TabularReports.data=void 0),this._isInitialized=!0,this._ensureValidCategorySelection()}catch(e){o.a.Log("arcgis-infographic-tree request for esri reports failed",e)}}setLocaleStrings(){}showBusy(e){const t=o.A.queryElementById.call(this,this._busyId);t&&(t.style.display=e?"block":"none")}async getReportName(e){let t,i,s;if(e&&o.A.hasText(e)&&this._infographics){if(this._infographics.MyInfographics?.data)for(s=this._infographics.MyInfographics.data,i=0;i<s.length;i++)if(s[i].id===e){t=s[i].title;break}if(!t&&this._infographics.EsriInfographics?.data)for(s=this._infographics.EsriInfographics.data,i=0;i<s.length;i++)if(s[i].id===e){t=s[i].title;break}if(!t&&this._infographics.SharedInfographics?.data)for(s=this._infographics.SharedInfographics.data,i=0;i<s.length;i++)if(s[i].id===e){t=s[i].title;break}if(!t&&this._infographics.GalleryInfographics?.data)for(s=this._infographics.GalleryInfographics.data,i=0;i<s.length;i++)if(s[i].id===e){t=s[i].title;break}if(!t&&this._infographics.TabularReports?.data)for(s=this._infographics.TabularReports.data,i=0;i<s.length;i++)if(s[i].id===e){t=s[i].title;break}}return t}async setColorTheme(e){e&&o.A.hasText(e)&&this.el&&(this.stColorTheme=e.trim().toLowerCase())}_loadInstances(){this._instanceId||(this._instanceId=o.E.generateId(this._idPrefix).id),this._busyId||(this._busyId=o.E.generateId(this._idPrefixBusy).id),this._elementIds.list||(this._elementIds.list=o.E.generateId(this._idListPrefix).id),this._elementIds.search||(this._elementIds.search=o.E.generateId(this._idSearchPrefix).id),this._elementIds.sort||(this._elementIds.sort=o.E.generateId(this._idSortPrefix).id)}onUpdateUI(){}onClickTreeItem(e,t){return a.hidePopup(),this.reportSelected.emit({report:t}),e.stopPropagation(),e.preventDefault(),!1}applySort(e){if(!e?.length)return e;const t=[...e],i=this.stSortType||"newest",s=e=>{const t="number"==typeof e?e:e?new Date(e).getTime():0;return Number.isFinite(t)?t:0};switch(i){case"oldest":t.sort((e,t)=>s(e.date)-s(t.date));break;case"ascending":t.sort((e,t)=>(e.title||"").localeCompare(t.title||""));break;case"descending":t.sort((e,t)=>(t.title||"").localeCompare(e.title||""));break;default:t.sort((e,t)=>s(t.date)-s(e.date))}return t}_syncCategoryPopoverWidth=()=>{const e=o.A.queryElementById.call(this,this._elementIds.category+"-button"),t=o.A.queryElementById.call(this,this._elementIds.category+"-content"),i=o.A.queryElementById.call(this,this._elementIds.category+"-popover");if(!e||!t)return;const s=Math.ceil(e.getBoundingClientRect().width);t.style.width=`${s}px`,i&&i.style.setProperty("--calcite-popover-max-width",`${s}px`)};_syncSortPopoverWidth=()=>{const e=o.A.queryElementById.call(this,this._elementIds.sort+"-button"),t=o.A.queryElementById.call(this,this._elementIds.sort+"-content"),i=o.A.queryElementById.call(this,this._elementIds.sort+"-popover");if(!e||!t)return;const s=Math.ceil(e.getBoundingClientRect().width);t.style.width=`${s}px`,i&&i.style.setProperty("--calcite-popover-max-width",`${s}px`)};handleSortSelect(e){if(!e||e===this.stSortType){const e=o.A.queryElementById.call(this,this._elementIds.sort+"-popover");return e&&(e.open=!1),void(this.isSortOpen=!1)}this.stSortType=e;const t=o.A.queryElementById.call(this,this._elementIds.sort+"-popover");t&&(t.open=!1),this.isSortOpen=!1,this.stTimestamp=Date.now()}_onSortChange=e=>{const t=e.currentTarget,i=t?.selectedItems?.[0],s=i?.value??i?.getAttribute?.("value");s&&this.handleSortSelect(String(s))};_onDocumentClickSort=e=>{const t=o.A.queryElementById.call(this,this._elementIds.sort+"-popover"),i=o.A.queryElementById.call(this,this._elementIds.sort+"-button");if(!t||!i)return;const s=e.composedPath&&e.composedPath()||[];s.includes(t)||s.includes(i)||(t.open=!1,this.isSortOpen=!1)};isOnlyConfiguredReportList(e){const t={MyInfographics:"user",EsriInfographics:"public",SharedInfographics:"shared",GalleryInfographics:"gallery",TabularReports:"tabular"}[e],i=this._configFilteredReports||this.stReportList||this._cachedReports,s=i?.[t];return!!s&&1===Object.keys(i).length}async getNumberOfConfiguredReports(){const e=this._configFilteredReports||this.stReportList||this._cachedReports;if(e){let t=Object.keys(e).length;for(let i=0;i<Object.keys(e).length;i++)t+=Object.values(e)[i].length;return t}return null}onUpdateThumbnailPopoverSize(){if(!this.el)return;let e=100;const t=document.documentElement.clientHeight,i=document.documentElement.clientWidth,s=this.el.offsetTop,r=t-(this.el.offsetTop+this.el.offsetHeight)+window.scrollY;let n=i/2;const a=i-this.el.offsetLeft+window.scrollX;e=r<100&&r<s?s-36:r-36,n=Math.max(200,Math.min(a-16,735));const l=o.A.queryElementById.call(this.el,this._elementIds.content);l&&(l.style.height=e+"px");const h=o.A.queryElementById.call(this.el,this._elementIds.popover);h&&(h.style.width=n+"px");const d=o.A.queryElementById.call(this.el,this._elementIds.reports);d&&d.updateLayout()}handleMouseOver(e,t){const i=e.clientY,s=t;return this._debounce2(()=>{a.hidePopup();const e=l._getThumbnailUrl(s);if(e&&e.isOk){const t=this.el.closest("calcite-popover");if(t){const o=t.getBoundingClientRect(),r=i-o.top,n=t.shadowRoot;if(n){const t=n.querySelector("div");t&&a.show(s,t,r,e.ratio,e.url)}}}},200),!0}handleMouseOut(){this._debounce2(()=>{a.hidePopup()},300)}static ThumbnailIndex={};static _setThumbnailIndex(e,t,i,s){l.ThumbnailIndex[e]={url:i,ratio:t,isOk:s}}static _getThumbnailUrl(e){return l.ThumbnailIndex[e]}_cacheThumbnailUrlAndData(e,t,i,s,n){if(!o.A.hasText(e)||!o.A.hasText(t)||!o.A.hasText(i))return;const a=t,h=i,d=s,c=e=>{const t=this.el.querySelector(o.A.fixId(h));t&&t.remove();const i=this.el.querySelector(o.A.fixId(e));if(i){const t=i.querySelector("calcite-tooltip");t&&t.remove();const s=document.createElement("calcite-tooltip");s.setAttribute("reference-element",e),s.style.minWidth="160px",s.style.left="-40px";const r=document.createElement("span");r.innerText=o.B.i18n("preview-not-available"),s.appendChild(r),i.appendChild(s)}},p="EsriInfographics"===n||"esri"===n;let g=!0;const u=l._getThumbnailUrl(t);if(!u||!0!==u.isOk&&!1!==u.isOk||(g=!1),!g)return;let f="";(()=>!!p&&!(!this.portalOnlineGEProxy||r.E.isAGOPortal(r.E.getPortalBase())))()?f=`https://www.arcgis.com/sharing/rest/content/items/${a}/resources/thumbnail.png`:(f=`${r.E.getPortalBase()}/sharing/rest/content/items/${a}/resources/thumbnail.png`,r.T.token?.access_token&&(f+=`?token=${r.T.token?.access_token}`));const m=(e,t,i,s,r)=>{l._setThumbnailIndex(i,s/r,t,!0);const n=this.el.querySelector(o.A.fixId(e));if(n){const e=n.querySelector("calcite-tooltip");e&&e.remove()}},y=(e,t,i)=>{l._setThumbnailIndex(i,1,t,!1),c(e)};try{const e=new Image;e.onload=function(){const e=this.width,t=this.height;m(d,f,a,e,t)},e.onerror=()=>{y(d,f,a)},e.src=f}catch(e){y(d,f,a)}}async refreshInfographicList(){const e=this;let t,i,s,r,a;o.a.Log("TREE refreshInfographicList",e.stReportList);let l,h=this._configFilteredReports||this.stReportList||this._cachedReports;if(this.baseConfig.config?.reportList&&Object.keys(this.baseConfig.config.reportList).length>0){const e="string"==typeof this.baseConfig.config?.reportList?JSON.parse(this.baseConfig.config?.reportList):this.baseConfig.config?.reportList,t=o.A.getKeys(e);h||(h=e),0==t?.length&&(delete h?.user,delete h?.shared,delete h?.gallery,delete h?.tabular)}if(h&&Object.keys(h).length)t=h.user,i=h.public,s=h.shared,r=h.gallery,a=h.tabular;else{e._isInitialized=!1;try{l=await(0,n.g)(e.sourceCountry,!1,e.selectedHierarchy)}catch(e){l={public:[],user:[],shared:[],gallery:[],tabular:[]}}t=l.user.map(e=>({...e,isChecked:!1})),i=l.public.map(e=>({...e,isChecked:!0})),s=l.shared.map(e=>({...e,isChecked:!1})),r=l.gallery.map(e=>({...e,isChecked:!1})),a=l.tabular.map(e=>({...e,isChecked:!1})),this._configFilteredReports=void 0;const o={user:t,public:i,shared:s,gallery:r,tabular:a};e.stReportList=o,e._cachedReports=o,e._isInitialized=!0}h||l?(e._infographics.MyInfographics.data=t,e._infographics.EsriInfographics.data=i,e._infographics.SharedInfographics.data=s,e._infographics.GalleryInfographics.data=r,e._infographics.TabularReports.data=a):(e._infographics.MyInfographics.data=void 0,e._infographics.EsriInfographics.data=void 0,e._infographics.SharedInfographics.data=void 0,e._infographics.GalleryInfographics.data=void 0,e._infographics.TabularReports.data=void 0),this._ensureValidCategorySelection()}async getLocalFilteredInfographicsList(){}async componentWillLoad(){const e=this;e.env&&e.onEnvChanged(),e.token&&e.onTokenChanged(),e.username&&e.onUsernameChanged(),e.selectedReportId&&e.onSelectedReportChanged(),e.reportList&&e.onReportListChanged(),e.langCode&&e.onLangCodeChanged(),e.geoenrichmentUrl&&e.onGeoenrichmentUrlChanged(),e.sourceCountry&&e.onSourceCountryChanged(),e.selectedHierarchy&&e.onSelectedHierarchyChanged(),e.portalUrl&&e.onPortalUrlChanged(),e.config&&e.onConfigChange(e.config,""),this.theme?this.baseConfig.setTheme(this.theme):this.baseConfig.setTheme("light"),this.defaultReport&&o.A.hasText(this.defaultReport)&&(this.stDefaultReport=JSON.parse(this.defaultReport));const t=this.config?JSON.parse(this.config):{};t.selectedReportId&&(this.selectedReportId=this.stSelectedReportId=t.selectedReportId),e._loadInstances();try{await e.refreshInfographicList(),e._isInitialized=!0,this.stTimestamp=Date.now()}catch(e){o.a.Error("arcgis-infographic-tree request for esri reports failed",e)}}componentDidUpdate(){this.showBusy(!1),this.baseConfig?.onComponentHasRendered?.(),this._cachedReports&&this._cachedReports!==this.stReportList&&(this.stReportList=this._cachedReports,this._cachedReports=void 0),this.isCategoryOpen&&this._syncCategoryPopoverWidth(),this.isSortOpen&&this._syncSortPopoverWidth()}componentDidLoad(){const e=this;requestAnimationFrame(()=>{e._loadInstances(),e.showBusy.call(e,!1),this._elementIds.category||(this._elementIds.category="ig-tree-category");const t=e.el.querySelector("#"+e._elementIds.search);window.removeEventListener("resize",this._onResizeRef),window.addEventListener("resize",this._onResizeRef);const i=()=>{e._debounce2(()=>{e.stTimestamp=(new Date).getTime()},500)};t&&(t.removeEventListener("input",i),t.addEventListener("input",i),t.addEventListener("calciteInputChange",i)),e.adjustTreeItemsWidth()})}disconnectedCallback(){document.removeEventListener("click",this._onDocumentClick),document.removeEventListener("click",this._onDocumentClickSort),window.removeEventListener("resize",this._onResizeRef)}_debounce2(e,t){const i=this;i._debounceTimer&&clearTimeout(i._debounceTimer),i._debounceTimer=setTimeout(function(){i._debounceTimer=null,e.apply(i)},t)}_onCategoryChange=e=>{const t=e.currentTarget,i=t?.selectedItems?.[0],s=i?.value??i?.getAttribute?.("value");s&&this.handleCategorySelect(String(s))};adjustTreeItemsWidth(){const e=this.el.parentElement?.parentElement,t=e?.style?.width;if(t&&o.A.hasText(t)){const e=parseInt(t);if(!Number.isNaN(e)){const t=.95*e;if(t>300){const e=this.el.querySelectorAll("img.thumbnail-preview");e&&e.forEach(e=>{e.style.maxWidth=t+"px",e.style.maxHeight=.66*t+"px"})}}}}render(){const e=o.B.i18n("search-infos-by-name"),t=o.B.i18n("date-sort-newest"),i=o.B.i18n("date-sort-oldest"),r=o.B.i18n("name-sort-asc"),n=o.B.i18n("name-sort-desc");this._elementIds.category||(this._elementIds.category="ig-tree-category");const a=["selector-dropdown","infographic-selector",this.isCategoryOpen?"selector--open":""].join(" "),l=["selector-dropdown-arrow","selector-arrow",this.isCategoryOpen?"selector--open":""].join(" "),h=this._categoryOptionsForUI(),d=h.map(e=>e.value);let c=this.stSelectedCategory||"all";d.includes(c)||(c=d.includes("all")?"all":d[0],this.stSelectedCategory=c);const p=h.find(e=>e.value===c)?.label||this.stSelectedCategoryLabel||this._labels.all,g=this._getReportsByCategory(c),u=this.el?.querySelector("#"+this._elementIds.search),f=(u?.value||"").trim().toLowerCase(),m=(f?g.filter(e=>(e?.title||"").toLowerCase().includes(f)):g).filter(e=>e&&!1!==e.isChecked),y=this.applySort(m),_=h.length>1;return(0,s.h)("div",{key:"62463ca087700273bc1c81594e844a3fa8c1544e",id:this._instanceId,style:{position:"absolute",width:"calc(100% - 12px)",height:"calc(100% - 8px)","overflow-x":"hidden","overflow-y":"auto"},class:"arcgis-tree-outer"},(0,s.h)("div",{key:"9acb1a0b39faab9d6e9717b7d32e7116864f9907",id:this._busyId,class:"infographic-tree-busy"}),(0,s.h)("div",{key:"98ee7ade4ab3c10f460d18a14fe991132c5d7a03",class:"info-tree-search-row"},(0,s.h)("div",{key:"3df84038628fb9de8a25d4bd1f02de7ff0e42221",class:"info-tree-search-div-full"},(0,s.h)("div",{key:"072f7f66e647aa89eb9c602649c8a8bad81f2920",class:"info-tree-search-input-wrapper"},(0,s.h)("calcite-input",{key:"447785a8b2f8ca8aa6596b7f92814f5c7de14fa0",icon:"search",clearable:!0,id:this._elementIds.search,placeholder:e,class:"info-tree-search-full info-tree-search-with-icon"}))),(0,s.h)("div",{key:"16e314cd5b27cf168fe600064517cfaa8097397e",class:"info-tree-dropdown-row"},_?(0,s.h)("div",{class:"info-tree-category-full"},(0,s.h)("div",{id:this._elementIds.category+"-button",class:a,onClick:()=>{const e=o.A.queryElementById.call(this,this._elementIds.category+"-popover");e?(e.open=!e.open,this.isCategoryOpen=e.open):this.isCategoryOpen=!this.isCategoryOpen}},(0,s.h)("div",{id:this._elementIds.category+"-label",class:"selector-dropdown-label"},p),(0,s.h)("svg",{id:this._elementIds.category+"-arrow",class:l,width:"24",height:"24",viewBox:"0 0 16 16",fill:"none"},(0,s.h)("path",{fill:"currentColor",stroke:"currentColor",d:"M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z","fill-rule":"evenodd","clip-rule":"evenodd"}))),(0,s.h)("calcite-popover",{id:this._elementIds.category+"-popover",label:"Choose category",pointerDisabled:!0,triggerDisabled:!0,overlayPositioning:"fixed",placement:"bottom",flipDisabled:!0,offsetSkidding:4,autoClose:!1,focusTrapDisabled:!0,referenceElement:this._elementIds.category+"-button",onCalcitePopoverOpen:()=>{this.isCategoryOpen=!0,this._syncCategoryPopoverWidth(),document.addEventListener("click",this._onDocumentClick)},onCalcitePopoverClose:()=>{this.isCategoryOpen=!1,document.removeEventListener("click",this._onDocumentClick)}},(0,s.h)("div",{style:{boxSizing:"border-box"},id:this._elementIds.category+"-content"},(0,s.h)("calcite-list",{id:this._elementIds.category+"-list",class:"category-list no-separators",selectionMode:"single",selectionAppearance:"border",label:"Infographic Categories",onCalciteListChange:this._onCategoryChange},h.map(e=>(0,s.h)("calcite-list-item",{id:this._elementIds.category+"-item-"+e.value,key:e.value,value:e.value,label:e.label,selected:c===e.value},(0,s.h)("span",{style:{fontWeight:c===e.value?"bold":"normal"}},e.label))))))):(0,s.h)("div",{class:"info-tree-category-full"},(0,s.h)("div",{class:"info-tree-category-label-static"},o.B.i18n("infographics-label"))),(0,s.h)("div",{key:"851002cb183ede090fc3489d36dc39b3c6239aa0",class:"info-tree-sort-label-group"},(()=>{const e=[{value:"newest",label:t},{value:"oldest",label:i},{value:"ascending",label:r},{value:"descending",label:n}],a=this.stSortType||"newest",l=e.find(e=>e.value===a)?.label||t,h=["selector-dropdown","infographic-selector",this.isSortOpen?"selector--open":""].join(" "),d=["selector-dropdown-arrow","selector-arrow",this.isSortOpen?"selector--open":""].join(" ");return(0,s.h)("div",{class:"info-tree-sort-full"},(0,s.h)("div",{id:this._elementIds.sort+"-button",class:h,onClick:()=>{const e=o.A.queryElementById.call(this,this._elementIds.sort+"-popover");e?(e.open=!e.open,this.isSortOpen=e.open,this.isSortOpen&&this._syncSortPopoverWidth()):this.isSortOpen=!this.isSortOpen}},(0,s.h)("div",{id:this._elementIds.sort+"-label",class:"selector-dropdown-label"},l),(0,s.h)("svg",{id:this._elementIds.sort+"-arrow",class:d,width:"24",height:"24",viewBox:"0 0 16 16",fill:"none"},(0,s.h)("path",{fill:"currentColor",stroke:"currentColor",d:"M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z","fill-rule":"evenodd","clip-rule":"evenodd"}))),(0,s.h)("calcite-popover",{id:this._elementIds.sort+"-popover",label:"Choose sort",pointerDisabled:!0,triggerDisabled:!0,overlayPositioning:"fixed",placement:"bottom",flipDisabled:!0,offsetSkidding:4,autoClose:!0,referenceElement:this._elementIds.sort+"-button",onCalcitePopoverOpen:()=>{this.isSortOpen=!0,this._syncSortPopoverWidth(),document.addEventListener("click",this._onDocumentClickSort)},onCalcitePopoverClose:()=>{this.isSortOpen=!1,document.removeEventListener("click",this._onDocumentClickSort)}},(0,s.h)("div",{style:{boxSizing:"border-box"},id:this._elementIds.sort+"-content"},(0,s.h)("calcite-list",{id:this._elementIds.sort+"-list",class:"sort-list no-separators",selectionMode:"single",selectionAppearance:"border",label:"Sort Reports",onCalciteListChange:this._onSortChange},e.map(e=>(0,s.h)("calcite-list-item",{id:this._elementIds.sort+"-item-"+e.value,key:e.value,value:e.value,label:e.label,selected:a===e.value},(0,s.h)("span",{style:{fontWeight:a===e.value?"bold":"normal"}},e.label)))))))})()))),(0,s.h)("div",{key:"a54a30cbd2e3cc8cdb3cdb9ec3678dc9df690d8f",id:this._elementIds.list,class:"info-tree-list"},(0,s.h)("calcite-tree",{key:"5c09dbdda8a67b73a8694ff0482186e19817575b",scale:"m",selectionMode:"single"},0===y.length?(0,s.h)("div",{style:{padding:"16px",color:"#888",textAlign:"center"}},"No reports found."):y.map(e=>{const t="tree-item-"+e.id,i=t+"-prev",o=t+"-pop",r=this._instanceId+"-img"+this._imgOffset++,n=this.stDefaultReport&&this.stDefaultReport.id===e.id?{textDecoration:"underline"}:{};return this._cacheThumbnailUrlAndData(r,e.id,o,i,c),(0,s.h)("calcite-tree-item",{key:e.id,id:t,selected:e.id===this.stSelectedReportId,class:"reportItems",onClick:t=>this.onClickTreeItem(t,{thumbnail:o,id:e.id,reportID:e.reportID,name:e.title})},(0,s.h)("div",{class:"report-item-content"},(0,s.h)("div",{class:"report-item-text",style:n},e.title),(0,s.h)("div",{class:"report-item-buttons"},(0,s.h)("div",null,(0,s.h)("div",{id:i,class:"report-item-preview",onMouseOver:t=>this.handleMouseOver(t,e.id),onMouseOut:()=>this.handleMouseOut()},(0,s.h)("svg",{"aria-hidden":"true",class:"svg",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,s.h)("path",{d:"M17 16h-5.525a5.95 5.95 0 0 0-.172-1H17zm2-7h-9v1h9zm0 3h-9v.544q.193.22.364.456H19zm3 8H11.818l-.913-.913c.014-.028.023-.059.037-.087H21V7h-4V3H8v8.053a5.945 5.945 0 0 0-1-.356V2h11.4L22 5.6zM21 5.69L18.31 3H18v3h3zM8.926 19.23l3.085 3.084a.476.476 0 0 1 0 .674l-.017.017a.476.476 0 0 1-.673 0L8.237 19.92A4.383 4.383 0 1 1 9.9 16.5a4.358 4.358 0 0 1-.974 2.73zM5.5 19.9a3.4 3.4 0 1 0-3.4-3.4 3.404 3.404 0 0 0 3.4 3.4z"})))))))}))))}_onDocumentClick=e=>{const t=o.A.queryElementById.call(this,this._elementIds.category+"-popover"),i=o.A.queryElementById.call(this,this._elementIds.category+"-button");if(!t||!i)return;const s=e.composedPath&&e.composedPath()||[];s.includes(t)||s.includes(i)||(t.open=!1,this.isCategoryOpen=!1)};static get watchers(){return{config:["onConfigChange"],defaultReport:["onDefaultReportChanged"],env:["onEnvChanged"],langCode:["onLangCodeChanged"],reportList:["onReportListChanged"],sourceCountry:["onSourceCountryChanged"],selectedHierarchy:["onSelectedHierarchyChanged"],token:["onTokenChanged"],username:["onUsernameChanged"],selectedReportId:["onSelectedReportChanged"],theme:["onThemeChanged"],portalUrl:["onPortalUrlChanged"],geoenrichmentUrl:["onGeoenrichmentUrlChanged"]}}};l.style=':host{}.infographic-selector{display:flex;align-items:center;padding:0 12px;height:32px;min-height:32px;box-sizing:border-box;width:100%}.info-tree-sort-full{display:flex;align-items:center}.selector-arrow{display:inline-block;width:16px;height:16px;background:url(\'data:image/svg+xml;utf8,<svg fill="%23666" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"/></svg>\') center/contain no-repeat;transition:transform 0.2s}.selector--open .selector-arrow{transform:rotate(180deg)}.info-tree-sort-label-group{display:flex;align-items:center;}.info-tree-sort-label{margin-right:6px;font-weight:400;white-space:nowrap}:host{display:block}::slotted([slot="children"]){width:100%}.reportList{font-weight:200}.reportItems{font-weight:200;margin-inline-end:0.25rem}.report-item-buttons{position:relative;width:30px;height:28px;flex-shrink:0}.report-item-preview{position:absolute;top:5px;right:0;width:22px;height:22px}.report-item-dots{position:absolute;top:7px;right:25px;width:22px;height:22px}.reportTree{padding-bottom:2px}.infographic-tree-busy{position:absolute;top:0;left:0;width:100%;height:100%;background:url(./assets/largeBusy.gif);background-repeat:no-repeat;background-position:center;z-index:999;display:none}calcite-tree-item [selected]{font-weight:bold}.report-item-content{width:100%;display:flex}.report-refresh-button{position:absolute;top:8px;right:10px;width:18px;height:18px}.info-tree-search-row{width:100%;display:flex;flex-direction:column;gap:4px;margin-bottom:4px}.info-tree-search-div-full{width:100%;display:flex;align-items:center;position:relative}.info-tree-search-input-wrapper{position:relative;width:100%;box-sizing:border-box}.info-tree-search-full::part(input){padding-left:48px !important}.info-tree-icon-inside{position:absolute;left:12px;top:50%;transform:translateY(-50%);z-index:2;pointer-events:none;display:flex;align-items:center;height:20px}.info-tree-search-full{width:100%;height:32px;box-sizing:border-box}.info-tree-dropdown-row{width:100%;display:grid;grid-template-columns:minmax(0, 260px) 1fr max-content;column-gap:8px;align-items:center;margin-top:4px;box-sizing:border-box}.info-tree-category-full{grid-column:1;min-width:0;height:32px;max-width:260px;position:relative}.info-tree-sort-label-group{grid-column:3;justify-self:end;}.info-tree-sort-full{width:180px;height:32px;margin:0 !important;}.info-tree-category-full calcite-popover{--calcite-popover-max-width:none;--calcite-popover-min-width:0}.info-tree-category-label-static{font-size:var(--calcite-font-size--1, 1.15em);color:var(--calcite-color-text-2);padding-left:10px;padding-top:10px}.info-tree-list{position:static;width:100%;margin-top:8px}.report-item-text{position:relative;top:7px;flex:1 1 0%;text-align:left;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-weight:200}.report-item-popover{width:auto;height:auto;min-width:300px;min-height:200px;}.report-item-popover-content{min-height:32px;line-height:200px;text-align:right}.report-item-default-popover{min-width:140px;padding:3px;height:42px}.tree-container{position:absolute;width:calc(100% - 12px);height:calc(100% - 18px);overflow-x:hidden;overflow-y:scroll}.thumbnail-preview{position:absolute;top:0;right:0;max-width:300px;max-height:200px;border:none;z-index:6;opacity:1;object-fit:cover}.report-item-popover-not-found{position:absolute;top:4px;right:41px;min-width:160px;height:32px !important;line-height:24px !important}.no-separators{--calcite-color-border-3:transparent}.no-separators calcite-list-item{--calcite-color-border-3:transparent}.no-separators calcite-list-item::part(container){border-block-end:0}.no-separators::part(list){border:0}';const h=class{get el(){return(0,s.g)(this)}baseConfig;_localeSettings={};_popoverIsOpen=!1;_instanceId;_idPrefix="arcgis-infographic-selector-";_elementIds={};_idButtonPrefix="selector-dropdown-button-";_idDropdownArrowPrefix="selector-dropdown-arrow-";_idDropdownLabelPrefix="selector-dropdown-label-";_idReportListPrefix="selector-report-list-";_idPopoverPrefix="selector-popover-";_idPopoverContentPrefix="selector-popover-content-";_report={id:null,name:""};_selectedReport;constructor(e){(0,s.r)(this,e),this.selectorPopupOpened=(0,s.c)(this,"selectorPopupOpened",6),this.selectorPopupClosed=(0,s.c)(this,"selectorPopupClosed",6),this.colors=void 0,this.theme=void 0,this.env=void 0,this.token=void 0,this.username=void 0,this.langCode=void 0,this.sourceCountry=void 0,this.geoenrichmentUrl=void 0,this.portalOnlineGEProxy=void 0,this.defaultReport=void 0,this.stDefaultReport=void 0,this.stTheme=void 0,this.config=void 0,this.baseConfig=new o.a("selector",this,this.onUpdateUI),o.A.announceVersion(),this.langCode=this.langCode||"en-us",o.B._initialize(this.langCode),this.setLocaleStrings(),this.sourceCountry=this.sourceCountry||"US",this.baseConfig.updateLocaleSettings({language:this.langCode,country:this.sourceCountry})}onDefaultReportChanged(){o.a.Log("SELECTOR updating defaultReport",this.defaultReport),this._setDefaultReport(this.defaultReport)}updateChildrenDefaultReport(e){const t=o.A.queryElementById.call(this.el,this._elementIds.reports);t&&t.setDefaultReport(e)}_setDefaultReport(e){this._sameReport(this.stDefaultReport,this._selectedReport)&&(this._selectedReport=void 0),this._hasReport(e)?(this.stDefaultReport=e,this.updateChildrenDefaultReport(e),this._selectedReport||(this._selectedReport={id:e.id,name:e.name})):(this._selectedReport||this._showPlaceholder(),this.stDefaultReport=void 0,this.updateChildrenDefaultReport(void 0)),this._selectedReport&&this._selectedReport.name&&(this._hidePlaceholderAndShowLabel(this._selectedReport.name),this.hidePopover())}_hasReport(e){return e&&e.id&&o.A.hasText(e.id)&&e.name&&o.A.hasText(e.name)}_sameReport(e,t){return!e&&!t||e&&t&&e.id==t.id&&e.name==t.name}_getSelectedReport(){let e;const t=this.baseConfig.getParentConfigProperty("selectedReport");return e=this._sameReport(this._selectedReport,t)?this._selectedReport:t,this._sameReport(this._selectedReport,t)||(this._selectedReport=t),e}_getDefaultReport(e){let t;const i=this.baseConfig.getParentConfigProperty("defaultReport");return t=this._sameReport(this.stDefaultReport,i)?this.stDefaultReport:i,e&&(this._sameReport(this.stDefaultReport,i)||(this.stDefaultReport=i)),t}async setDefaultReport(e){o.a.Log("SELECTOR updating setDefaultReport",e),this._setDefaultReport(e)}selectorPopupOpened;selectorPopupClosed;onEnvChanged(){r.E.setEnvironment(this.env),this.baseConfig&&this.baseConfig.updateConfig({env:this.env})}onTokenChanged(){o.a.Log("selector: token changed",this.token);const e=this.token,t=this.baseConfig?.config?.username;e&&o.A.hasText(e)&&t&&o.A.hasText(t)&&r.T.setToken(t,e),this.baseConfig&&this.baseConfig.updateConfig({token:this.token})}onUsernameChanged(){o.a.Log("selector: username changed",this.username);const e=this.username,t=this.baseConfig?.config?.token;t&&o.A.hasText(t)&&e&&o.A.hasText(e)&&r.T.setToken(e,t),this.baseConfig&&this.baseConfig.updateConfig({username:this.username})}onLangCodeChanged(){this.baseConfig&&this.baseConfig.updateConfig({langCode:this.langCode})}onGeoenrichmentUrlChanged(){this.baseConfig&&this.baseConfig.updateConfig({geoenrichmentUrl:this.geoenrichmentUrl})}onSourceCountryChanged(){this.baseConfig&&this.baseConfig.updateConfig({sourceCountry:this.sourceCountry})}onThemeChanged(){this.stTheme=this.theme,this.baseConfig&&this.baseConfig.setTheme(this.theme)}onConfigChange(e,t){if(this.baseConfig&&e&&o.A.hasText(e)){const i=JSON.parse(e);o.a.LogConfig("SELECTOR config change",i,t),this.baseConfig.updateConfig(i)}if(e&&o.A.hasText(e)){const t=JSON.parse(e);t&&t.defaultReport&&t.defaultReport.id&&t.defaultReport.name&&this.setDefaultReport(t.defaultReport)}}async getConfig(){return this.baseConfig}reportSelectedEventHandler(e){const t=e.detail?.report;t?.id&&t?.name&&(this._selectedReport={id:t.id,name:t.name},this.baseConfig.updateConfig({selectedReport:{id:t.id,name:t.name}}),o.a.LogConfig("SELECTOR selected report change",t),this._hidePlaceholderAndShowLabel(t.name),this.hidePopover())}async _getReportNameFromId(e){let t;const i=o.A.queryElementById.call(this.el,this._elementIds.reports);return i&&(t=await i.getReportName(e)),t}onUpdateUI(){}_loadInstances(){this._instanceId||(this._instanceId=o.E.generateId(this._idPrefix).id),this._elementIds.label||(this._elementIds.label=o.E.generateId(this._idDropdownLabelPrefix).id),this._elementIds.button||(this._elementIds.button=o.E.generateId(this._idButtonPrefix).id),this._elementIds.popover||(this._elementIds.popover=o.E.generateId(this._idPopoverPrefix).id),this._elementIds.content||(this._elementIds.content=o.E.generateId(this._idPopoverContentPrefix).id),this._elementIds.arrow||(this._elementIds.arrow=o.E.generateId(this._idDropdownArrowPrefix).id),this._elementIds.reports||(this._elementIds.reports=o.E.generateId(this._idReportListPrefix).id)}setLocaleStrings(){}async componentWillLoad(){this.env&&this.onEnvChanged(),this.token&&this.onTokenChanged(),this.username&&this.onUsernameChanged(),this.langCode&&this.onLangCodeChanged(),this.geoenrichmentUrl&&this.onGeoenrichmentUrlChanged(),this.sourceCountry&&this.onSourceCountryChanged(),this.config&&this.onConfigChange(this.config,""),this.theme?this.baseConfig.setTheme(this.theme):this.baseConfig.setTheme("light"),this.defaultReport&&o.A.hasText(this.defaultReport)&&(this.stDefaultReport=JSON.parse(this.defaultReport)),this._loadInstances()}componentDidUpdate(){const e=this;e.baseConfig&&e.baseConfig.onComponentHasRendered()}onClickDropdown(e){e.stopPropagation(),this.onUpdatePopoverSize();const t=o.A.queryElementById.call(this.el,this._elementIds.popover),i=o.A.queryElementById.call(this.el,this._elementIds.arrow);if(t){const e=!t.open;t.open=e,this._popoverIsOpen=e,e?(this.selectorPopupOpened.emit(),i?.classList.add("selector-drop-open")):(this.selectorPopupClosed.emit(),i?.classList.remove("selector-drop-open"))}return!1}componentDidLoad(){const e=this;requestAnimationFrame(()=>{function t(t){e.onClickDropdown.call(e,t)}o.a.Log("arcgis-infographic-selector didUpdate"),e._loadInstances();const i=o.A.queryElementById.call(e.el,e._elementIds.button);i&&(i.removeEventListener("click",t),i.addEventListener("click",t));const s=o.A.queryElementById.call(e.el,e._elementIds.label);s&&(s.removeEventListener("click",t),s.addEventListener("click",t));const r=o.A.queryElementById.call(e.el,e._elementIds.arrow);function n(){e.hidePopover(),e.onUpdatePopoverSize()}r&&(r.removeEventListener("click",t),r.addEventListener("click",t)),window.removeEventListener("resize",n),window.addEventListener("resize",n),e.baseConfig&&e.baseConfig.onComponentHasRendered()})}hidePopover(){const e=o.A.queryElementById.call(this.el,this._elementIds.popover),t=o.A.queryElementById.call(this.el,this._elementIds.arrow);e&&(e.open=!1),this._popoverIsOpen=!1,this.selectorPopupClosed.emit(),t&&t.classList.remove("selector-drop-open")}async onUpdatePopoverSize(){if(!this.el)return;let e=100;const t=document.documentElement.clientHeight,i=document.documentElement.clientWidth,s=this.el.getBoundingClientRect(),r=o.A.queryElementById.call(this.el,this._elementIds.reports),n=await(r?.getNumberOfConfiguredReports())||0,a=s.top,l=t-(s.top+s.height)+window.scrollY;let h=i/2;const d=i-s.left+window.scrollX;e=l<100&&l<a||a>l&&a>=100?a-36:l-36,n>0&&(e=Math.min(e,32*n+45)),h=d<s.width&&s.left>d||s.left>d&&s.left>=s.width?s.left-16:i-s.left-16,h=Math.min(450,h);const c=o.A.queryElementById.call(this.el,this._elementIds.content);c&&c&&(c.style.height=e+"px");const p=o.A.queryElementById.call(this.el,this._elementIds.popover);p&&(p.style.width=Math.min(450,h)+"px"),r&&r.updateLayout()}_showPlaceholder(){const e=o.B.i18n("select-infographic"),t=o.A.queryElementById.call(this,this._elementIds.label);t&&(t.classList.add("selector-label-placeholder"),t.innerText=e)}_hidePlaceholderAndShowLabel(e){const t=o.A.queryElementById.call(this,this._elementIds.label);t&&(t.classList.remove("selector-label-placeholder"),e&&(t.innerText=e))}_getDropdownLabel(){const e=this._getSelectedReport(),t=this._getDefaultReport();let i=o.B.i18n("select-infographic");return this._hasReport(e)?i=e.name:this._hasReport(t)&&(i=t.name),i}render(){this.baseConfig.config?.username&&o.A.hasText(this.baseConfig.config.username)||o.a.Error("ERROR: arcgis-infographic-selector missing [username]"),this.baseConfig.config?.token&&o.A.hasText(this.baseConfig.config.token)||o.a.Error("ERROR: arcgis-infographic-selector missing [token]");const e=this._getDropdownLabel();o.a.Log("SELECTOR RENDER pText=",e,this.baseConfig?.config?.selectedReport,this.stDefaultReport);return o.a.Log("SELECTOR RENDER def rep=",this.stDefaultReport),o.a.Log("SELECTOR RENDER selected rep=",this._selectedReport),(0,s.h)("div",{id:this._instanceId,class:"infographicSelectorOuter"},(0,s.h)("div",{id:this._elementIds.button,class:"selector-dropdown"},(0,s.h)("div",{id:this._elementIds.label,class:"selector-dropdown-label"},e),(0,s.h)("svg",{id:this._elementIds.arrow,class:"selector-dropdown-arrow",width:"24",height:"24",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,s.h)("path",{fill:"currentColor","fill-rule":"evenodd",stroke:"currentColor",d:"M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z","clip-rule":"evenodd"}))),(0,s.h)("calcite-popover",{id:this._elementIds.popover,style:{position:"absolute",top:"0px",left:"0px",transform:"translate(-312px, 7px)",border:"none",boxShadow:"none",minWidth:"450px",zIndex:"1"},label:"Choose infographics","pointer-disabled":"true","trigger-disabled":"true","overlay-positioning":"fixed",placement:"bottom-start","offset-skidding":"4","auto-close":"true","focus-trap-disabled":"true",referenceElement:this._elementIds.button,onCalcitePopoverClose:e=>{if(e.target!==e.currentTarget)return;this._popoverIsOpen=!1,this.selectorPopupClosed.emit();const t=o.A.queryElementById.call(this.el,this._elementIds.arrow);t&&t.classList.remove("selector-drop-open")}},(0,s.h)("div",{id:this._elementIds.content,style:{width:"100%",minWidth:"450px",height:"auto"},onClick:e=>{e.stopPropagation()}},(0,s.h)("div",{style:{padding:"6px"}},(0,s.h)("arcgis-infographic-tree",{id:this._elementIds.reports,portalOnlineGEProxy:this.portalOnlineGEProxy,class:"arcSel-reports",defaultReport:this.stDefaultReport?JSON.stringify(this.stDefaultReport):void 0,config:this.baseConfig.getConfigString()})))))}static get watchers(){return{defaultReport:["onDefaultReportChanged"],env:["onEnvChanged"],token:["onTokenChanged"],username:["onUsernameChanged"],langCode:["onLangCodeChanged"],geoenrichmentUrl:["onGeoenrichmentUrlChanged"],sourceCountry:["onSourceCountryChanged"],theme:["onThemeChanged"],config:["onConfigChange"]}}};h.style=":host{display:block}.infographicSelectorOuter{position:relative;width:100%;height:30px;justify-content:left;align-items:center}.infoSel-magnify{position:absolute;top:2px;left:100px;height:32px;width:32px;}.arcSel-combo{width:100%;height:32px;}.arcSel-reports{width:calc(100% - 16px);height:100%;overflow:auto}.selector-dropdown-label{position:absolute;top:7px;left:6px;font-size:var(--calcite-font-size--1, 1.15em);width:calc(100% - 35px);height:25px;text-align:left;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;cursor:pointer}.selector-dropdown{position:relative;height:32px;width:100%;cursor:pointer;background-color:var(--calcite-color-background-1);border:solid 1px var(--calcite-color-border-1);border-radius:var(--calcite-button-corner-radius, var(--calcite-internal-button-corner-radius, 0));color:var(--calcite-color-text-1)}.selector-dropdown-arrow{position:absolute;top:9px;right:7px;width:12px;height:12px;transition:all 0.15s 0.15s;transform:rotate(0)}.selector-drop-open{transform:rotate(180deg)}calcite-popover ::-webkit-scrollbar{width:8px;height:8px}calcite-popover ::-webkit-scrollbar-corner{width:8px;height:8px}"}}]);