"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-f74507"],{8249:(e,t,r)=>{r.d(t,{E:()=>o,G:()=>u,R:()=>h,S:()=>l,T:()=>i});var a,s=r(7212);class i{static token={access_token:"",expires_in:null,persist:"true",ssl:"true",username:"mark_ba"};static getToken(){return new Promise(e=>{e(i.token.access_token)})}static setToken(e,t){e&&e.length>0&&t&&t.length>0&&(this.token.access_token=t,this.token.username=e)}}class o{static _env="www";static portalUrl="";static geoenrichmentUrl="";static orgGeocoders=null;static geocodeUrl="";static setEnvironment(e){let t="prod"===e||"localhost"===e?"www":e;o._env=t}static getEnvironment(){return o._env}static setPortalUrl(e){o.portalUrl=e}static setGeoenrichmentUrl(e){o.geoenrichmentUrl=e}static setGeocodeUrl(e){o.geocodeUrl=s.A.fixUrlEndingSlash(e)}static getPortalBase(){if(o.portalUrl)return o.portalUrl;const e=o._env;if(!e)return"";return"https://"+("dev"===e?"devext":"qa"===e?"qaext":"www")+".arcgis.com"}static getGeocoders(){return new Promise((e,t)=>{this.orgGeocoders?e():n.getPortalSettings().then(r=>{if(r&&r.helperServices&&r.helperServices.geocode){const a=r.helperServices.geocode;a.length>0?(o.orgGeocoders=[],a.forEach(e=>{o.orgGeocoders?.push({url:e.url,name:e.name})}),o.geocodeUrl||(o.geocodeUrl=s.A.fixUrlEndingSlash(a[0].url)),e()):t()}else t()}).catch(t)})}static getUrl(e){if(s.a.Log("Environments.getUrl -  - - - --"),!o._env)return console.log("Environments error: env not set"),"";if(!e||!s.b.hasText(e))return console.log("Environments error: invalid subdomain"),"";const t=o.getPortalBase();if(""===t)return"";try{let r="";switch(e){case"geocode":if(o.geocodeUrl){r=s.A.fixUrlEndingSlash(o.geocodeUrl);break}r="qa"===o._env?"https://geocodeqa.arcgis.com/arcgis/rest/services/World/GeocodeServer":"dev"===o._env?"https://geocodedev.arcgis.com/arcgis/rest/services/World/GeocodeServer":"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";break;case"arcgis":r=t;break;case"infographics":r="qa"===o._env?"https://baoqa.arcgis.com/InfographicsPlayer/BAMobile/25.R03/reportPlayer/ReportPlayerMobile.html":"dev"===o._env?"https://baodev.arcgis.com/InfographicsPlayer/BAMobile/25.R03/reportPlayer/ReportPlayerMobile.html":"https://bao.arcgis.com/InfographicsPlayer/BAMobile/25.R03/reportPlayer/ReportPlayerMobile.html";break;case"routing":r="qa"===o._env?"https://logisticsqa.arcgis.com/arcgis/rest/services/World/Utilities/GPServer":"dev"===o._env?"https://logisticsdev.arcgis.com/arcgis/rest/services/World/Utilities/GPServer":"https://logistics.arcgis.com/arcgis/rest/services/World/Utilities/GPServer";break;case"geoenrich":if(o.geoenrichmentUrl){r=o.geoenrichmentUrl;break}r="qa"===o._env?"https://geoenrichqa.arcgis.com/arcgis/rest/services/World/geoenrichmentserver":"dev"===o._env?"https://geoenrichdev.arcgis.com/arcgis/rest/services/World/geoenrichmentserver":"https://geoenrich.arcgis.com/arcgis/rest/services/World/geoenrichmentserver"}return r}catch(e){s.a.Error("Environments.getUrl() error ",e)}return""}static isOnlineGeocoder(e){return!!(e.toLowerCase().startsWith("https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer".toLowerCase())||e.toLowerCase().startsWith("https://geocodeqa.arcgis.com/arcgis/rest/services/World/GeocodeServer".toLowerCase())||e.toLowerCase().startsWith("https://geocodedev.arcgis.com/arcgis/rest/services/World/GeocodeServer".toLowerCase()))}static isAGOPortal(e){return!!(e.toLowerCase().startsWith("https://www.arcgis.com".toLowerCase())||e.toLowerCase().includes("qaext.arcgis.com")||e.toLowerCase().includes("devext.arcgis.com"))}}class n{static _lastSelfToken;static _selfResult;static executeSelf(){return new Promise((e,t)=>{i.getToken().then(r=>{if(r===n._lastSelfToken)e(n._selfResult);else{let a={taskPath:"/portals/self",data:{culture:"en-us"}};n.executeRequest(a).then(t=>{n._lastSelfToken=r,n._selfResult=t,e(t)}).catch(e=>{n._lastSelfToken="",n._selfResult="",t(e)})}}).catch(e=>t(e))})}static getGeoenrichmentUrl(){return o.getUrl("geoenrich")}static getHelperServiceUrl(e){return new Promise((t,r)=>{n.executeSelf().then(function(a){let s=a.helperServices;if(s){let a=s[e];if(a){let s=Array.isArray(a)?a[0].url:a.url;s?t(s):r(e+" helper service is not configured.")}else r(e+" helper service is not configured.")}else r("Helper services are not configured.")}).catch(e=>r(e))})}static getPortalResource(e){return n.executeRequest({taskPath:"/portals/self/resources/"+e})}static getPortalSettings(){return n.executeRequest({taskPath:"/portals/self/settings"})}static getItemData(e){return n.executeRequest({taskPath:"/content/items/"+e+"/data"})}static searchAllItems(e,t){return new Promise((r,a)=>{let s=[],i=this,o=function(e,t,n){i.searchItems(e,t,n).then(function(a){a.items.length&&(s=s.concat(a.items));let i=a.context;i.nextStart>0?o(e,t,i):r(s)},function(e){s&&s.length?r(s):a(e)})};o(e,t,null)})}static searchItems(e,t,r){return new Promise((a,s)=>{let i=t?JSON.parse(JSON.stringify(t)):{};if(r){i.q=t.q;let e=r.total,s=r.nextStart;e&&s&&(s>0&&e>=s?i.start=s:a({items:[],context:r})),r.sortField&&r.sortOrder&&(i.sortOrder=r.sortOrder,i.sortField=r.sortField)}else{let t=[];Object.getOwnPropertyNames(e).forEach(function(r){t.push(r+':"'+e[r]+'"')}),t.length&&(i.q=t.join(" AND "))}n.portalSearch(i).then(e=>{let t=e.results,r={query:e.query,total:e.total,nextStart:e.nextStart,sortOrder:null,sortField:null};i.sortOrder&&i.sortField&&(r.sortOrder=i.sortOrder,r.sortField=i.sortField),a({items:t,context:r})}).catch(s)})}static portalSearch(e){return n.executeRequest({taskPath:"/search",data:e})}static async getPortalUrl(){return o.getUrl("arcgis")+"/sharing/rest"}static executeRequest(e){return new Promise((t,r)=>{i.getToken().then(async a=>{e.data||(e.data={}),e.data.f||(e.data.f="json"),e.data.token=a||e.data.token,e.data.token||delete e.data.token,e.data.langCode=e.data?.langCode?e.data.langCode:"en-us";const s=new FormData;for(let t in e.data)s.append(t,e.data[t]);let i;i=Object.prototype.hasOwnProperty.call(e,"url")?e.url:await n.getPortalUrl(),e.taskPath&&(i+=e.taskPath);let o={};if(e.isStandardGeoQuery){const t=new Headers;t.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");let r="",a=!0;for(const t in e.data)r+=a?"":"&",r+=t+"="+encodeURI(e.data[t]),a=!1;o={method:"POST",body:r,headers:t}}else o={method:"POST",body:s};fetch(i,o).then(t=>{if(!t.ok)throw new Error("Network response ended with error.");return"bin"===e.data.f?t.blob():t.json()}).then(e=>{e.error?r(e.error):t(e)}).catch(e=>{console.error("Error:",e),r(e)})}).catch(e=>r(e))})}}class c{static getBusinessAnalystOrganizationalSettings(){return n.getPortalResource("BusinessAnalyst_Organizational_Settings.json")}static getDisabledReports(){return new Promise(e=>{let t=t=>{e({}),console.log("WebAppSettings error",t)};n.executeSelf().then(r=>{let a=r.user?.roleId||r.user?.role;a?c.getBusinessAnalystOrganizationalSettings().then(t=>{let r=t["userRoles.disabledAreas.reports"];r&&r[a]?e(r[a]):e({})}).catch(t):e({})}).catch(t)})}static getUserGalleryInfographicReportIds(){return new Promise((e,t)=>{c._searchGalleryInfographicPreferencesItem().then(r=>{if(!r)return void t(null);let a=r.id;n.getItemData(a).then(t=>{e(t&&t.data&&t.data.myGalleryInfographicReportIds)}).catch(e=>t(e))}).catch(e=>t(e))})}static _searchGalleryInfographicPreferencesItem(){return c._searchUserItem("esriFavoriteReportTemplates")}static _searchUserItem(e){return new Promise((t,r)=>{n.executeSelf().then(a=>{let s=a.user.username,i={type:"Web Mapping Application",typekeywords:e,owner:s};n.searchItems(i,{num:1},void 0).then(e=>{t(e&&e.length&&e[0])}).catch(e=>r(e))}).catch(e=>r(e))})}}class l{static environment;static getEnvironment(){return new Promise(e=>{e(o.getEnvironment())})}static setEnvironment(e){e&&e.length>0?o.setEnvironment(e):console.log("ba-reports error: setEnvironment() invalid arg")}static async getPortalBaseUrl(){return o.getUrl("arcgis")}static isTrueString(e){return"true"===String(e).toLowerCase()}}!function(e){e[e.REPORT=0]="REPORT",e[e.STD_REPORT=1]="STD_REPORT"}(a||(a={}));class h{static _geReportTemplatesCache={};static _condenseResultsArray(e){if(!e||0===e.length)return[];const t=e.map(e=>({id:e.id,title:e.title,date:e.modified,reportID:e.reportID})),r=t.map(e=>e.title);return t.filter((e,t)=>r.indexOf(e.title)==t)}static _condenseResultsArrayGEInfographics(e){if(!e||0===e.length)return[];let t,r,a;const s=e.map(e=>{try{e.metadata.lastRevisionDate&&(a=e.metadata.lastRevisionDate),e.metadata.creationDate&&(r=e.metadata.creationDate),r&&(t=a&&a>r?a:r)}catch(e){console.log("ReportTemplatesManager error",e)}return{id:e.itemID,reportID:e.reportID,title:e.metadata.title,date:t}}),i=s.map(e=>e.title);return s.filter((e,t)=>i.indexOf(e.title)==t)}static async getReportTemplates(e,t=!1){let r={ge:void 0,shared:void 0,user:void 0,favoriteIds:void 0};let a=(await n.executeSelf()).user.username;const s=await Promise.allSettled([h._getSharedCustomReportTemplateItems(a),h._getMyCustomReportTemplateItems(a),h._getFavoriteReportsIds(a,e)]);r.ge=s[0].value?s[0].value:[],r.shared=await h._createReportTemplateInfos(s[1]&&s[1].value?s[1].value:[],e),r.user=await h._createReportTemplateInfos(s[2]&&s[2].value?s[2].value:[],e),r.favoriteIds=s[3]&&s[3].value?s[3].value:[];const i=await c.getDisabledReports();let o=r.ge,l=r.shared;return null!=o&&(r.ge=o.filter(e=>!i[e.reportID]),null!=l&&(r.shared=l.filter(e=>!i[e.reportID.itemid]))),t||(r.ge=h._condenseResultsArray(r.ge),r.shared=h._condenseResultsArray(r.shared),r.user=h._condenseResultsArray(r.user),r.favoriteIds=h._condenseResultsArray(r.favoriteIds)),r}static _getGEReportTemplates(e){return new Promise((t,r)=>{let a=h._geReportTemplatesCache[e];a?t(a):u.execute({taskPath:"/GeoEnrichment/Reports/"+e}).then(r=>{let a=r.reports;h._geReportTemplatesCache[e]=a,t(a)}).catch(r)})}static _getSharedCustomReportTemplateItems(e){let t='type:"Report Template" (access:shared OR access:org) typekeywords:(esriWebReport NOT esriWebInfographicReport) NOT owner:'+e;return h._searchItems(t,h._removeInfographicTemplates)}static _getMyCustomReportTemplateItems(e){let t='type:"Report Template" typekeywords:(esriWebReport NOT esriWebInfographicReport) owner:'+e;return h._searchItems(t,h._removeInfographicTemplates)}static _removeInfographicTemplates(e){return!l.isTrueString(e.properties.isGraphicReport)}static getInfographicReportTemplateItems(e,t=!1,r){return new Promise(async(a,o)=>{let l={public:[],shared:[],user:[],favoriteIds:[],gallery:[],tabular:[]};if(!e||e.length<=0)return void o("ReportTemplatesManager: invalid countryCode");if(s.A.isEmptyString(r,s.c.RETURN_TRUE_EMPTY_TEXT_ONLY)&&!(r=await u.getGEDefaultHierarchy(e)))return void o("No default hierarchy found for country "+e);let p=r;n.executeSelf().then(r=>{let s=i.token?.username||r.user?.username,n=r.user?.orgId||r.id,u=[h._getEsriInfographicReportTemplateItems(e,p)];if(s&&n)u.push(h._getSharedInfographicReportTemplateItems(s,n),h._getUserInfographicReportTemplateItems(s),h._getFavoriteReportsIds(s,e));else{const e=new Promise(e=>e(!1));u.push(e,e,e)}u.push(h._getGalleryInfographicReportTemplateItems()),u.push(h._getTabularReportTemplateItems()),Promise.allSettled(u).then(r=>{let s=h._byCountryAndDefaultHiearchy(e,p);if(!r||r.length<6)return void o("Error retrieving infographic templates");"fulfilled"===r[0].status&&(l.public=r[0].value?r[0].value.filter(s):[]),"fulfilled"===r[1].status&&(l.shared=r[1].value?r[1].value.filter(s):[]),"fulfilled"===r[2].status&&(l.user=r[2].value?r[2].value.filter(s):[]),"fulfilled"===r[3].status&&(l.favoriteIds=r[3].value?r[3].value:[]),"fulfilled"===r[4].status&&(l.gallery=r[4].value?r[4].value.filter(s):[]),"fulfilled"===r[5].status&&(l.tabular=r[5].value?r[5].value.filter(s):[]);let i=l.user;null!=i&&i.length>0&&i.sort(function(e,t){return e.title.localeCompare(t.title)}),c.getDisabledReports().then(e=>{let r=function(t){return!e[t.id]},s=l.public;null!=s&&s&&s.length>0?l.public=s.filter(r):l.public=[];let i=l.shared;null!=i&&i.length>0?l.shared=i.filter(r):l.shared=[];let o=l.gallery;null!=o&&o.length>0?l.gallery=o.filter(r):l.gallery=[];let n=l.tabular;null!=n&&n.length>0?l.tabular=n.filter(r):l.tabular=[],t||(l.public=h._condenseResultsArrayGEInfographics(l.public),l.shared=h._condenseResultsArray(l.shared),l.user=h._condenseResultsArray(l.user),l.favoriteIds=h._condenseResultsArray(l.favoriteIds),l.gallery=h._condenseResultsArray(l.gallery),l.tabular=h._condenseResultsArray(l.tabular)),a(l)}).catch(e=>o(e))})}).catch(e=>o(e))})}static _byCountryAndDefaultHiearchy(e,t){return function(r){let a=r&&r.properties&&r.properties.countries.toLowerCase()||r&&r.metadata&&r.metadata.countries.toLowerCase();a=a.split(",").map(e=>e.trim());let s=r&&r.properties&&r.properties.hierarchy||r&&r.metadata&&r.metadata.hierarchy;return s=s.split(",").map(e=>e.trim()),a&&a.includes(e.toLowerCase())&&s&&s.includes(t)}}static _getEsriInfographicReportTemplateItems(e,t){let r="/GeoEnrichment/Infographics/Standard/"+e;return t&&t.length>0&&(r+="/"+t),u.execute({taskPath:r}).then(e=>e.reports)}static _getSharedInfographicReportTemplateItems(e,t){let r='type:"Report Template" (access:shared OR access:org OR (access:public AND orgid:'+t+"))  typekeywords:esriWebInfographicReport  NOT owner:"+e;return h._searchItems(r,h._infographicFilter)}static _getGalleryInfographicReportTemplateItems(){let e='type:"Report Template"  typekeywords:esriWebGalleryInfographicReport  owner:(esri_reports)';return h._searchItems(e,h._infographicFilter,{start:1,num:1e3,sortField:"modified",sortOrder:"desc",q:e})}static _getTabularReportTemplateItems(){let e='type:"Report Template"  typekeywords:esriTabularInfographicReport  owner:(esri_reports)';return h._searchItems(e,e=>{const t=h._infographicFilter(e),r=(e.title||e.metadata?.title||"").startsWith("Dominant Tapestry Map");return t&&!r},{start:1,num:1e3,sortField:"modified",sortOrder:"desc",q:e})}static _getUserInfographicReportTemplateItems(e){return new Promise((t,r)=>{let a='type:"Report Template" typekeywords:esriWebInfographicReport  owner:'+e,s=h._searchItems(a,h._infographicFilter),i=h._getUserGalleryInfographicReportTemplateItems();Promise.allSettled([s,i]).then(e=>{let r=e[0].value?e[0].value:[],a=e[1].value?e[1].value:[];t(r.concat(a))},e=>{r(e)})})}static _getFavoriteReportsIds(e,t){return new Promise((r,a)=>{let s='type:"Web Mapping Application" typekeywords:"BAUserData.FavoriteReports" owner:'+e;h._searchItems(s,null).then(e=>{let s=e&&e[0];s?n.getItemData(s.id).then(e=>{if(!e)return void r([]);let a=e.data&&e.data["favorites"+t];if(!a)return void r([]);let s=a.map(function(e){return e.reportID});r(s)}).catch(e=>a(e)):r([])}).catch(e=>a(e))})}static _getUserGalleryInfographicReportTemplateItems(){return new Promise((e,t)=>{c.getUserGalleryInfographicReportIds().then(r=>{if(!r||!r.length)return void e([]);let a=r.map(e=>"id:"+e).join(" OR ");h._searchItems(a,h._infographicFilter).then(t=>{e(t)}).catch(e=>t(e))}).catch(e=>t(e))})}static _searchItems(e,t,r){return new Promise((a,s)=>{let i=r||{start:1,num:1e3,sortField:"title",sortOrder:"asc",q:e};n.searchAllItems({},i).then(e=>{let r=t?e.filter(t):e;a(r)}).catch(e=>s(e))})}static async _createReportTemplateInfos(e,t){let r=[],a=[];async function i(e,t){const a=await u.getGEDefaultHierarchy(t);e.metadata.hierarchy=a,r.push(e)}e.forEach(function(e){let r=e.properties;if(r){let i=r.countries;if(l.isTrueString(r.isComparisonReport))return;if(i&&-1!==i.indexOf(t)){let t={reportID:{itemid:e.id},formats:r.formats&&r.formats.split(","),headers:[],metadata:{author:r.author,categories:[],countries:i,coverage:r.coverage,hierarchy:s.U,keywords:r.keywords,owner:e.owner,title:e.title,type:r.type}};a.push(t)}}});for(let e=0;e<a.length;e++)await i(a[e],t);return r}static _infographicFilter(e){let t=e.properties;return l.isTrueString(t.isGraphicReport)&&!l.isTrueString(t.isSingleInfographic)&&!l.isTrueString(t.isHidden)&&!l.isTrueString(t.isBlank)}static getLatestHierarchy(e){let t=null;const r=function(e){let t=-1/0,r=-1;try{if(!Array.isArray(e)||0===e.length)return-1;e.forEach((e,a)=>{if("string"!=typeof e||""===e.trim())return;const s=e.match(/\d+/);if(s){const e=parseInt(s[0],10);e>t&&(t=e,r=a)}})}catch(e){return-1}return r}(e);return t=r>=0?e[r]:s.U,t}static ERR_INVALID_PARAMS="Invalid parameters";static ERR_NO_HIERARCHIES="No valid hierarchies found";static ERR_NO_REPORTID="No reportId provided";static ERR_REPORTID_NOT_IN_ANY_HIERARCHY="No matching report found in any hierarchy";static hierarchyReportIdIndex={};static async verifyReportExistence(e,t,r,i){let o=await u.replaceEmptyHierarchyWithLatest(t,r,i);if(!s.A.hasText(e)||null==o||!s.A.hasText(r))return{reportId:void 0,hierarchies:void 0,errorMessage:h.ERR_INVALID_PARAMS};const n=s.A.isEmptyString(o,s.c.RETURN_TRUE_IF_UNDEFINED);if(h.hierarchyReportIdIndex){const e=Object.keys(h.hierarchyReportIdIndex);e.length>0&&(h.hierarchyReportIdIndex=e.reduce((e,t)=>{const a=h.hierarchyReportIdIndex[t];return a&&a.country&&a.country===r&&(e[t]=a),e},{}))}if(!h.hierarchyReportIdIndex||0===Object.keys(h.hierarchyReportIdIndex).length){h.hierarchyReportIdIndex={};const e=await u.getValidHierarchies(r,i);if(!e||!e.dataSources||0===Object.keys(e.dataSources).length)return{reportId:void 0,hierarchies:void 0,errorMessage:h.ERR_NO_HIERARCHIES};const t=[];e.dataSources.forEach(e=>{t.push(e.id)});const o=t.filter(e=>!h.hierarchyReportIdIndex[e]);if(o.length>0)for(let e=0;e<o.length;e++){const t=o[e],i=await h.getInfographicReportTemplateItems(r,!1,t);i&&(h.hierarchyReportIdIndex[t]={country:r,reportIds:{}},Object.keys(i).forEach(e=>{i[e].forEach(e=>{e&&e.id&&s.A.hasText(e.id)&&(e.reportID&&s.A.hasText(e.reportID)?(h.hierarchyReportIdIndex[t].reportIds[e.id]={reportID:e.reportID,source:a.STD_REPORT},h.hierarchyReportIdIndex[t].reportIds[e.reportID]={source:a.STD_REPORT}):h.hierarchyReportIdIndex[t].reportIds[e.id]={source:a.REPORT})})}))}}if(n||h.hierarchyReportIdIndex[o]){if(!n&&h.hierarchyReportIdIndex[o].reportIds[e])return{reportId:e,hierarchies:[o],errorMessage:void 0};{const t=[],r=Object.keys(h.hierarchyReportIdIndex);for(let s=0;s<r.length;s++){const i=r[s],c=h.hierarchyReportIdIndex[i];if((n||i!==o)&&c.reportIds[e]&&(t.push(i),c.reportIds[e].source===a.STD_REPORT)){const t=c.reportIds[e].reportID;if(c.reportIds[t]){return{reportId:c.reportIds[e].reportID,hierarchies:[o],errorMessage:void 0}}}}if(t.length>0){return{reportId:e,hierarchies:[h.getLatestHierarchy(t)],errorMessage:void 0}}return{reportId:e,hierarchies:o?[o]:void 0,errorMessage:void 0}}}return{reportId:void 0,hierarchies:void 0,errorMessage:h.ERR_NO_HIERARCHIES}}}class u{static _defaultHierarchyStorageName="GEClient-default-hierarchy";static _defaultHierarchies;static _validHierarchies;static _geographyLevelsCache;static _standardInfographicsCache;static _infographicItemIDtoReportIDMap;static appID="esriexperiencebuilder";static async getInfographicTemplatesList(e,t=!1,r){return await h.getInfographicReportTemplateItems(e||"US",t,r)}static async getClassicReportsTemplatesList(e,t=!1){return await h.getReportTemplates(e||"US",t)}static execute(e){return new Promise((t,r)=>{const a=n.getGeoenrichmentUrl();var s=e?JSON.parse(JSON.stringify(e)):{};s.data||(s.data={}),s.data.forStorage=!1,s.data.appID=u.appID,n.executeRequest({url:a+s.taskPath,data:s.data,isStandardGeoQuery:s.isStandardGeoQuery}).then(t).catch(r)})}static enrich=function(e){return new Promise(async(t,r)=>{const a=e;var s=o.getUrl("geoenrich")+"/Geoenrichment/Enrich";a.forStorage=!1,a.appID=u.appID,n.executeRequest({url:s,data:a}).then(function(e){var a=e&&e.results&&e.results.length&&e.results[0],s=a&&a.value&&a.value.FeatureSet&&a.value.FeatureSet.length&&a.value.FeatureSet[0];if(s.features&&s.features.length)t(e);else{var i=e&&e.messages&&e.messages.length&&e.messages[0].description;i||(i="getfacts-no-data"),r(i)}},function(e){r(e)})})};static getTravelModes=function(e,t,r){return new Promise(async(a,s)=>{if(e){t&&o.setEnvironment(t);var i=(r||o.getUrl("routing"))+"/GetTravelModes/execute";n.executeRequest({url:i,data:{appID:u.appID,token:e}}).then(function(e){try{const t={...e,results:e.results?.map(e=>"supportedTravelModes"===e.paramName&&e.value?.features?{...e,value:{...e.value,features:e.value.features.map(e=>{const t=e.attributes;let r=null;try{t.TravelMode&&"string"==typeof t.TravelMode&&(r=JSON.parse(t.TravelMode))}catch(e){console.warn(`Error parsing TravelMode JSON for ${t.Name}:`,e)}const a={...e,attributes:{...t,Name:t.Name||t.AltName||"Unknown Mode",TravelModeId:t.TravelModeId||"",TravelMode:t.TravelMode||"{}",AltName:t.AltName||t.Name||"Unknown Mode"}};return r&&(a.parsedTravelMode={impedanceAttributeName:r.impedanceAttributeName||"",timeAttributeName:r.timeAttributeName||"",distanceAttributeName:r.distanceAttributeName||"",description:r.description||"",type:r.type||"AUTOMOBILE",name:r.name||t.Name}),a}).filter(e=>{const t=e.attributes;return t.Name&&t.TravelModeId&&t.TravelMode})}}:e)||[]};a(t)}catch(t){console.error("Error processing travel modes response:",t),a(e)}},function(e){s(e)})}else s("Token is required for getTravelModes")})};static createReport(e){return new Promise((t,r)=>{const a=n.getGeoenrichmentUrl();e.appID=u.appID;let s=a.toString()+"/Geoenrichment/CreateReport";n.executeRequest({url:s,data:e}).then(t).catch(r)})}static searchStdGeography(e,t){return new Promise(async(r,a)=>{if(!e||!e.length)return void r([]);let i=t?.optionalCountryHierarchy;i&&s.A.hasText(i)||(i=await this.getGEDefaultHierarchy(t?.sourceCountry||"US",t?.token));let o={geographyQuery:e,featureLimit:t?.featureLimit||10,geographyLayers:t?.geographyLayers||["US.States","US.Counties","US.Places"],useFuzzySearch:t?.useFuzzySearch,sourceCountry:t?.sourceCountry||"US",langCode:t?.langCode||"en-us",optionalCountryHierarchy:i,outSR:4326};this.standardGeographyQuery(o).then(e=>r(e)).catch(e=>a(e))})}static requestStdGeography(e,t,r){return new Promise(async(a,i)=>{let o=r?.optionalCountryHierarchy;o&&s.A.hasText(o)||(o=await this.getGEDefaultHierarchy(r?.sourceCountry||"US",r?.token));let n={geographyLayers:[e],featureLimit:r?.featureLimit||1,returnGeometry:r?.returnGeometry,generalizationLevel:r?.generalizationLevel||0,geographyIDs:[t],sourceCountry:r?.sourceCountry||"US",langCode:r?.langCode||"en-us",optionalCountryHierarchy:o,outSR:4326};this.standardGeographyQuery(n).then(e=>a(e)).catch(e=>i(e))})}static standardGeographyQuery(e){return new Promise((t,r)=>{let a={data:e,isStandardGeoQuery:!0,taskPath:"/StandardGeographyQuery/execute",appID:u.appID};u.execute(a).then(e=>{let a=e&&e.results&&e.results.length&&e.results[0],s=a&&a.value&&a.value.features;if(s)t(s);else{let t=e&&e.messages&&e.messages.length;r(t)}}).catch(e=>{r(e)})})}static getStoredDefaultHierarchy(e){let t;if(window.localStorage){let r=localStorage.getItem(u._defaultHierarchyStorageName);if(r&&s.b.hasText(r)){let a=JSON.parse(r);t=a[e],u._defaultHierarchies=a}}return t}static setStoredDefaultHierarchy(e,t){try{u.getStoredDefaultHierarchy(e),u._defaultHierarchies||(u._defaultHierarchies={}),u._defaultHierarchies[e]=t,window.localStorage&&localStorage.setItem(u._defaultHierarchyStorageName,JSON.stringify(u._defaultHierarchies))}catch(e){console.log("GEClient error",e)}}static preStdInfographicIds={country:"US",list:{hardcoded:!0,"2020-census-summary":!0,"at-risk-population":!0,"childhood-and-female-equity":!0,"community-change-snapshot":!0,"community-summary":!0,"commute-profile":!0,"demographic-profile":!0,"demographic-summary":!0,"dominant-tapestry-profile":!0,"eating-places":!0,"economic-development-profile":!0,"emergency-information":!0,"employment-overview":!0,"executive-summary-call-outs":!0,"health-care-and-insurance":!0,"housing-market-characteristics":!0,"k12-education-overview":!0,"key-facts":!0,"multi-area-comparison":!0,"nonprofit-charitable-profile":!0,"office-market-profile":!0,"population-trends":!0,"property-details":!0,"retail-demand-by-industry-tabular":!0,"shopping-and-spending":!0,skyscraper:!0,"tapestry-profile":!0,"target-market-summary":!0,"whats-in-my-community":!0}};static async requestStandardInfographicIds(e,t,r,a){let i;e&&s.b.hasText(e)||(i="invalid country"),t&&s.b.hasText(t)||(i="invalid token"),r&&!s.b.hasText(r)&&(i="invalid env"),r&&o.setEnvironment(r);const c={country:i?"":e,list:{},error:i};if(!i&&"US"==e){if(!a){const e=u._standardInfographicsCache;if(e&&"US"==e.country&&!e.error&&!e.list.hardcoded)return e}let r=n.getGeoenrichmentUrl().toString()+"/Geoenrichment/Infographics/Standard/"+e+"?f=pjson";const s=t?{appID:u.appID,token:t}:{appID:u.appID},i=await n.executeRequest({url:r,data:s});i&&i.reports&&i.reports.length>0&&(i.reports.forEach(e=>{e.reportID&&(c.list[e.reportID]=!0)}),u._standardInfographicsCache=c)}return c}static async applyUseLatestDataSource(e,t,r,a,i){let o=r;if((o.length<=0||o==s.U)&&(o=await u.getGEDefaultHierarchy(t||"US",a,null,!0)),e&&"US"==t&&s.A.hasText(i)){const e=await u.requestStandardInfographicIds(t,a);e?e.error&&console.warn("InfographicCard error: "+e.error):console.warn("InfographicCard: Standard infographic ids not found")}return o}static async replaceEmptyHierarchyWithLatest(e,t,r){if(s.A.isEmptyString(e,s.c.RETURN_TRUE_EMPTY_TEXT_ONLY)){const a=await u.replaceAnyEmptyHierarchyWithLatest([e],t||"US",r);if(a&&a.length>0)return a[0]}return e}static async replaceAnyEmptyHierarchyWithLatest(e,t,r){let a=["esri2025"];if(!e||0==e.length)return a;let i=s.U;if(e&&e.length>0){for(let a=0;a<e.length;a++){const o=e[a];(o&&o.length<=0||o==s.U)&&(i&&i!=s.U||(i=await u.getGEDefaultHierarchy(t||"US",r,null,!0)),e[a]=i)}a=e}return a}static getValidHierarchies(e,t,r){return new Promise((a,i)=>{if(e&&s.b.hasText(e)&&t&&s.b.hasText(t),u._validHierarchies&&u._validHierarchies.country===e)a(u._validHierarchies);else if(r)u._validHierarchies=function(t){const r={country:e,dataSources:[]};if(t&&t.length>0)for(let e=0;e<t.length;e++){let a=t[e];"landscape"!==a.ID&&r.dataSources.push({id:a.ID,alias:a.alias})}return r}(r),a(u._validHierarchies);else{let r={country:e,dataSources:[]};let s=n.getGeoenrichmentUrl().toString()+"/Geoenrichment/Countries/"+e+"?f=pjson";const o=t?{appID:u.appID,token:t}:{appID:u.appID};n.executeRequest({url:s,data:o}).then(e=>{let t=e.countries[0].hierarchies;if(t&&t.length>0)for(let e=0;e<t.length;e++){let a=t[e];"landscape"!==a.ID&&r.dataSources.push({id:a.ID,alias:a.alias})}else i("getValidHierarchies: no hierarchies found");u._validHierarchies=r,a(u._validHierarchies)}).catch(i)}})}static _latestHierarchyInfo={hierarchy:s.U,country:void 0};static async getGEDefaultHierarchy(e,t,r,a){let i="US",o=null!=a&&!1!==a;async function c(e){let t=!1;if(r){if(t=!1===s.A.isEmptyString(r.hierarchy,s.c.RETURN_TRUE_IF_UNDEFINED),!r.useLatestDataSource||r.country!=i||!r.reportID||!t)return r.hierarchy||e||s.U;null!==r.useLatestDataSource&&void 0!==r.useLatestDataSource&&(o=r.useLatestDataSource);return await u.applyUseLatestDataSource(o,r.country,r.hierarchy,r.token,r.reportID)}return e||s.U}if(o||r&&!s.A.isEmptyString(r.hierarchy,s.c.RETURN_TRUE_IF_UNDEFINED)||(o=!0,u.setStoredDefaultHierarchy(e||"US",s.U)),e&&s.b.hasText(e)||(e="US"),e&&s.b.hasText(e)&&(i=e),u._latestHierarchyInfo&&u._latestHierarchyInfo.country==i&&s.A.hasText(u._latestHierarchyInfo.hierarchy))return u.setStoredDefaultHierarchy(i,u._latestHierarchyInfo.hierarchy),u._latestHierarchyInfo.hierarchy;if(!o){let e=u.getStoredDefaultHierarchy(i);if(e&&s.b.hasText(e)){if(r){r.hierarchy=e;return await c(e)}return e}}let l=n.getGeoenrichmentUrl().toString()+"/Geoenrichment/Countries/"+e+"?f=pjson";const h=t?{appID:u.appID,token:t}:{appID:u.appID};let p=s.U;const d=await n.executeRequest({url:l,data:h}),g=d?.countries;if(g){const e=g.find(e=>e.id==i);if(e&&e.hierarchies&&e.hierarchies.length>=1){let t=e.hierarchies.find(e=>1==e.default);t&&s.A.hasText(t.ID)&&"landscape"!=t.ID&&(r?(r.hierarchy=t.ID,p=await c(t.ID)):p=t.ID)}}return s.b.hasText(p)&&(u._latestHierarchyInfo={hierarchy:p,country:i},u.setStoredDefaultHierarchy(i,p)),p}static async getStandardGeographyLevels(e,t,r,a){e&&s.b.hasText(e)||(e="US"),s.a.Log("GEClient.getStandardGeographyLevels -",e,t,r,a);let i=await u.getGEDefaultHierarchy(e,a);i&&s.b.hasText(i)||(i=r&&s.A.hasText(r)?r:"esri2025");let o=n.getGeoenrichmentUrl().toString()+"/Geoenrichment/StandardGeographyLevels/"+e;o+=i?"/"+i+"?f=pjson":"?f=pjson",a&&(o+="&token="+a);const c=await n.executeRequest({url:o,data:{langCode:t||"en-us",appID:u.appID}});let l=[];if(console.log("here2"),c&&c.geographyLevels&&c.geographyLevels.length>0){const e=c.geographyLevels[0];if(e.hierarchies&&e.hierarchies.length>0){const t=e.hierarchies[0];if(t.levels&&t.levels.length>0)for(let e=0;e<t.levels.length;e++){const r=t.levels[e],a={id:r.id,name:r.name,show:!0,defaultGeneralization:r.defaultGeneralizationLevel};l.push(a)}}}return{levels:l}}}}}]);