System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-arcgis","esri/layers/GraphicsLayer","widgets/shared-code/lrs","esri/time/TimeExtent","calcite-components","esri/Graphic"],function(e,t){var i={},l={},o={},n={},a={},r={},d={},s={},u={};return{setters:[function(e){i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){l.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,l.DataSourceComponent=e.DataSourceComponent,l.DataSourceManager=e.DataSourceManager,l.DataSourceStatus=e.DataSourceStatus,l.Immutable=e.Immutable,l.MessageManager=e.MessageManager,l.React=e.React,l.ReactRedux=e.ReactRedux,l.RecordSetChangeType=e.RecordSetChangeType,l.css=e.css,l.getAppStore=e.getAppStore,l.hooks=e.hooks,l.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule},function(e){o.Button=e.Button,o.CollapsablePanel=e.CollapsablePanel,o.DataActionList=e.DataActionList,o.DataActionListStyle=e.DataActionListStyle,o.FloatingPanel=e.FloatingPanel,o.Icon=e.Icon,o.Label=e.Label,o.Pagination=e.Pagination,o.Paper=e.Paper,o.Select=e.Select,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){a.default=e.default},function(e){r.GetUnits=e.GetUnits,r.LrsLayerType=e.LrsLayerType,r.MapViewLoader=e.MapViewLoader,r.ModeType=e.ModeType,r.QueryRouteMeasures=e.QueryRouteMeasures,r.findFirstArcgisMapWidgetId=e.findFirstArcgisMapWidgetId,r.formatMessage=e.formatMessage,r.getCalciteBasicTheme=e.getCalciteBasicTheme,r.getConfigValue=e.getConfigValue,r.getDateWithTZOffset=e.getDateWithTZOffset,r.getDefaultAttributeSet=e.getDefaultAttributeSet,r.getDefaultEvent=e.getDefaultEvent,r.getDefaultNetwork=e.getDefaultNetwork,r.getGeometryGraphic=e.getGeometryGraphic,r.getHoverGraphic=e.getHoverGraphic,r.getModeType=e.getModeType,r.getRouteFromEndMeasures=e.getRouteFromEndMeasures,r.getSimpleLineGraphic=e.getSimpleLineGraphic,r.getSimplePointGraphic=e.getSimplePointGraphic,r.highlightColor=e.highlightColor,r.isDefined=e.isDefined,r.measureFields=e.measureFields},function(e){d.default=e.default},function(e){s.CalciteTable=e.CalciteTable,s.CalciteTableCell=e.CalciteTableCell,s.CalciteTableHeader=e.CalciteTableHeader,s.CalciteTableRow=e.CalciteTableRow},function(e){u.default=e.default}],execute:function(){e((()=>{var e={14321:e=>{"use strict";e.exports=o},22089:e=>{"use strict";e.exports=u},47626:e=>{"use strict";e.exports=r},52066:e=>{"use strict";e.exports=d},59620:e=>{"use strict";e.exports=a},62686:e=>{"use strict";e.exports=n},66454:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3.5 4.5H1v1h12.5V10h1V5.5H17v-1H4.5V0h-1zM6 11v-1H5v1zM6 14v-2H5v2H4v1h3v-1z"></path><path fill="#000" fill-rule="evenodd" d="M5 17.978A5.5 5.5 0 1 1 10.793 14H20v6H5zm5-5.478a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0m.4 2.5a5.5 5.5 0 0 1-4.407 2.978H6V19h3.5v-1h1v1h2v-4zm6.1 2h-1v2h-2v-4H19v4h-2.5z" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=l},99037:e=>{"use strict";e.exports=s}},t={};function v(i){var l=t[i];if(void 0!==l)return l.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,v),o.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var i in t)v.o(t,i)&&!v.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var c={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(c),v.d(c,{__set_webpack_public_path__:()=>se,default:()=>de});var e=v(67386),t=v(79244);const i={_widgetLabel:"LRS Identify",method:"Method",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",network:"Network",referent:"Referent",routeIdLabel:"Route Id",routeNameLabel:"Route Name",invalidMeasure:"Invalid measure value",invalidRouteField:"Route could not be found with provided value",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",backLabel:"Back",checkResult:"Check results",clearResult:"Clear results",resultsDisplay:"Results:",searchLabel:"Search",results:"Results",searchDisabled:"Provide route",typeStr:"Type:",routeStr:"Route",measureLabel:"Measure:",startMeasure:"Start Measure:",endMeasure:"End Measure:",dateStr:"Date:",networkLabel:"Network:",routeId:"Route ID:",routeName:"Route Name:",identifyResults:"Identify Routes",eventInformation:"Event Information",attr:"Attribute",val:"Value",toStr:"to",layerField:"{layerName}.{fieldName}",identifyWidget:"LRS Identify",routePicker:"Route Picker",nullStr:"null",lineEvent:"Line Events",pointEvent:"Point Events"};var l=v(14321),o=v(66454),n=v.n(o),a=v(62686),r=v(59620),d=v(47626);const s=new Map;function u(i){const{widgetId:l,lrsLayers:o,selectedNetwork:n,dataSourcesReady:a,onCreatePointDs:r,handleSetDataSources:u}=i,[v,c]=t.React.useState(null!=o?o:null),[h,f]=t.React.useState([]);t.React.useEffect(()=>{if(o){c(o);const e=Array(o.length).fill(!1);f(e)}},[o]);const p=t.React.useCallback((e,t)=>{const i=h;i[e]=t,f(i),i.every(e=>e)&&a(!0)},[a,h]),m=t.React.useCallback((e,t)=>{s[l]||(s[l]=[]);s[l].findIndex(t=>t.id===e.id)<0&&s[l].push(e),(null==o?void 0:o.length)===s[l].length&&u(s[l]),p(t,!0)},[l,null==o?void 0:o.length,p,u]),y=t.React.useCallback((e,i)=>{if(e){const{status:l,instanceStatus:o}=e;o===t.DataSourceStatus.NotCreated||o===t.DataSourceStatus.CreateError||l===t.DataSourceStatus.LoadError||l===t.DataSourceStatus.NotReady?p(i,!1):p(i,!0)}},[p]),g=t.React.useCallback(e=>{p(e,!1)},[p]),S=e=>{r(e)},w=t.React.useMemo(()=>(0,t.Immutable)({dataSourceId:null==n?void 0:n.outputPointDsId,mainDataSourceId:null==n?void 0:n.outputPointDsId}),[null==n?void 0:n.outputPointDsId]);return(0,e.jsx)("div",{children:(0,d.isDefined)(v)&&v.map((i,l)=>{var o;const n=null===(o=null==i?void 0:i.layerType)||void 0===o?void 0:o.toLocaleLowerCase();return(0,e.jsxs)("div",{children:["network"===n&&(0,d.isDefined)(w)&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:w,onDataSourceCreated:S}),(0,e.jsx)(t.DataSourceComponent,{useDataSource:i.useDataSource,onDataSourceInfoChange:e=>{y(e,l)},onCreateDataSourceFailed:e=>{g(l)},onDataSourceCreated:e=>{m(e,l)}},l)]},l)})})}var h=v(52066);const f="object"==typeof global&&global&&global.Object===Object&&global;var p="object"==typeof self&&self&&self.Object===Object&&self;const m=f||p||Function("return this")();var y=/\s/;const g=function(e){for(var t=e.length;t--&&y.test(e.charAt(t)););return t};var S=/^\s+/;const w=function(e){return e?e.slice(0,g(e)+1).replace(S,""):e};const b=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const D=m.Symbol;var I=Object.prototype,x=I.hasOwnProperty,L=I.toString,j=D?D.toStringTag:void 0;const R=function(e){var t=x.call(e,j),i=e[j];try{e[j]=void 0;var l=!0}catch(e){}var o=L.call(e);return l&&(t?e[j]=i:delete e[j]),o};var k=Object.prototype.toString;const C=function(e){return k.call(e)};var M=D?D.toStringTag:void 0;const N=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":M&&M in Object(e)?R(e):C(e)};const P=function(e){return null!=e&&"object"==typeof e};const T=function(e){return"symbol"==typeof e||P(e)&&"[object Symbol]"==N(e)};var G=/^[-+]0x[0-9a-f]+$/i,F=/^0b[01]+$/i,E=/^0o[0-7]+$/i,A=parseInt;const V=function(e){if("number"==typeof e)return e;if(T(e))return NaN;if(b(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=b(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=w(e);var i=F.test(e);return i||E.test(e)?A(e.slice(2),i?2:8):G.test(e)?NaN:+e};var O=1/0;const U=function(e){return e?(e=V(e))===O||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const W=function(e){var t=U(e),i=t%1;return t==t?i?t-i:t:0};const H=function(e,t){for(var i=-1,l=null==e?0:e.length,o=Array(l);++i<l;)o[i]=t(e[i],i,e);return o};const z=Array.isArray;var B=D?D.prototype:void 0,_=B?B.toString:void 0;const J=function e(t){if("string"==typeof t)return t;if(z(t))return H(t,e)+"";if(T(t))return _?_.call(t):"";var i=t+"";return"0"==i&&1/t==-1/0?"-0":i};const Z=function(e){return null==e?"":J(e)};var Q=m.isFinite,$=Math.min;const q=function(e){var t=Math[e];return function(e,i){if(e=V(e),(i=null==i?0:$(W(i),292))&&Q(e)){var l=(Z(e)+"e").split("e"),o=t(l[0]+"e"+(+l[1]+i));return+((l=(Z(o)+"e").split("e"))[0]+"e"+(+l[1]-i))}return t(e)}}("round");var K=function(e,t,i,l){return new(i||(i=Promise))(function(o,n){function a(e){try{d(l.next(e))}catch(e){n(e)}}function r(e){try{d(l.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}d((l=l.apply(e,t||[])).next())})};const Y=t.css`
    .route-picker-btn {
      background-color: var(--sys-color-primary-main);
      color: var(--sys-color-surface-overlay);
      width: 32px;
      height: 32px;
      border-radius: 0px;

      &:hover {
        color: var(--sys-color-surface-paper);
      }
    }
    .route-picker-btn-disabled {
      color: var(--sys-color-surface-paperText);
      background-color: var(--sys-color-surface-overlay);
      width: 32px;
      height: 32px;
      border-radius: 0px;

      &:hover {
        color: var(--sys-color-primary-main);
      }
    }
  `;function X(i){const{intl:o,isReady:a,active:r,jimuMapView:s,hoverGraphic:u,allDataSources:v,lrsLayers:c,defaultPointAttributeSet:f,defaultLineAttributeSet:p,attributeSets:m,onActiveChange:y,clearFlashGraphic:g,clearPickedGraphic:S,handleShowPp:w}=i;let{eventDataRecords:b}=i;const D=t.React.useRef(null),I=t.React.useRef(null),x=t.React.useRef(!1),L=t.React.useRef(!1),[j,R]=t.React.useState(!1),k=t.React.useRef(null);t.React.useEffect(()=>{r?C():M()},[r]);const C=()=>{a&&(D.current=null==s?void 0:s.view.on("pointer-move",G),I.current=null==s?void 0:s.view.on("pointer-down",F))},M=()=>{(0,d.isDefined)(D.current)&&(D.current.remove(),D.current=null),(0,d.isDefined)(I.current)&&(I.current.remove(),I.current=null),L.current&&(L.current=!1),x.current&&(x.current=!1)},N=()=>{(0,d.isDefined)(u)&&u.removeAll()},P=e=>{N(),(0,d.isDefined)(e)&&u.add(e)},T=()=>K(this,void 0,void 0,function*(){return null===k.current&&(k.current=yield(0,t.loadArcGISJSAPIModule)("esri/geometry/operators/proximityOperator")),k.current}),G=e=>K(this,void 0,void 0,function*(){x.current||v&&0!==v.length&&(yield Promise.all(v.map(t=>K(this,void 0,void 0,function*(){const i=yield T(),l=t,o=null==l?void 0:l.layer,n=c.find(e=>e.serviceId===o.layerId);if((0,d.isDefined)(n)&&n.layerType===d.LrsLayerType.Network&&(0,d.isDefined)(o)){x.current=!0;const t=o.spatialReference,n=o.createQuery(),a=null==s?void 0:s.view.toMap(e),r="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);n.geometry=a,n.units="meters",n.returnM=!0,n.distance=(null==s?void 0:s.view.resolution)*r,n.spatialRelationship="intersects",n.returnGeometry=!0;const u=l.getCurrentQueryParams();(null==u?void 0:u.time)&&(n.timeExtent=new h.default({start:u.time[0],end:u.time[1]})),n.gdbVersion=u.gdbVersion,n.outFields=["*"],o.queryFeatures(n).then(e=>K(this,void 0,void 0,function*(){if(e&&e.features.length>0&&x.current){const t=e.features[0].geometry,l=i.getNearestCoordinate(t,a),o=i.getNearestVertex(t,a);o.distance<3*n.distance&&(l.coordinate=o.coordinate),P(yield(0,d.getHoverGraphic)(yield(0,d.getSimplePointGraphic)(l.coordinate))),x.current=!1}else P(null),x.current=!1}))}}))))}),F=e=>K(this,void 0,void 0,function*(){if(e.stopPropagation(),L.current)return;if(!v||0===v.length)return;const t=[],l=[];let n;b=[],yield Promise.all(v.map(i=>K(this,void 0,void 0,function*(){const a=yield T(),r=i,u=null==r?void 0:r.layer,v=(e=>{const t={routeIdFieldName:null,routeNameFieldName:null,layer:null};for(let i=0;i<c.length;i++){const l=c[i];if((null==l?void 0:l.serviceId)===(null==e?void 0:e.layerId)){if((null==l?void 0:l.layerType)===d.LrsLayerType.Event){const e=null==l?void 0:l.eventInfo;t.routeIdFieldName=e.routeIdFieldName,t.routeNameFieldName=null==e?void 0:e.routeNameFieldName,t.layer=l}else if((null==l?void 0:l.layerType)===d.LrsLayerType.Network){const e=null==l?void 0:l.networkInfo,i=null==e?void 0:e.routeIdFieldSchema;t.routeIdFieldName=null==i?void 0:i.jimuName,t.layer=l}break}}return t})(u);if((0,d.isDefined)(u)){const c=u.popupEnabled;u.popupEnabled=!1,L.current=!0;const y=u.spatialReference,g=u.createQuery(),S=null==s?void 0:s.view.toMap(e),w="degrees"===y.unit?4:Math.max(3*y.metersPerUnit,3);g.geometry=S,g.units="meters",g.distance=(null==s?void 0:s.view.resolution)*w,g.spatialRelationship="intersects",g.returnGeometry=!0,g.returnM=!0,g.returnZ=!0,g.outFields=["*"];const D=r.getCurrentQueryParams();(null==D?void 0:D.time)&&(g.timeExtent=new h.default({start:D.time[0],end:D.time[1]})),g.gdbVersion=D.gdbVersion;const I=[];yield u.queryFeatures(g).then(e=>K(this,void 0,void 0,function*(){var s;yield Promise.all(null===(s=null==e?void 0:e.features)||void 0===s?void 0:s.map(e=>K(this,void 0,void 0,function*(){var s,c,h,y,w,D,x,L,j,R,k,C,M,N,P,T;const G=(0,d.getRouteFromEndMeasures)(e.geometry),F=e.geometry,E=a.getNearestCoordinate(F,S),A=a.getNearestVertex(F,S);A.distance<3*g.distance&&(E.coordinate=A.coordinate),n||(n=E.coordinate,n.hasZ=!0);const V=null==e?void 0:e.attributes;if((null===(s=null==v?void 0:v.layer)||void 0===s?void 0:s.layerType)===d.LrsLayerType.Network){const a=null===(c=null==v?void 0:v.layer)||void 0===c?void 0:c.networkInfo;yield((e,t,i)=>{if(e)return new Promise((l,o)=>{var n,a,r,d,s,u;const v=e.getCurrentQueryParams();if(!(null===(a=null===(n=null==i?void 0:i.layer)||void 0===n?void 0:n.networkInfo)||void 0===a?void 0:a.supportsLines))return l([]),[];{const o=null===(d=null===(r=null==i?void 0:i.layer)||void 0===r?void 0:r.networkInfo)||void 0===d?void 0:d.lineIdFieldName,n=null===(u=null===(s=null==i?void 0:i.layer)||void 0===s?void 0:s.networkInfo)||void 0===u?void 0:u.lineOrderFieldName,a={where:`${o} LIKE '%${t[o]}'`,outFields:["*"],orderByFields:[n]};(null==v?void 0:v.time)&&(a.time=[v.time[0],v.time[1]]),a.gdbVersion=v.gdbVersion,e.query(a).then(e=>(l(e),e))}})})(r,V,v).then(s=>K(this,void 0,void 0,function*(){var c,h,f,p,m,y;yield(0,d.QueryRouteMeasures)(r,a,G,V[null===(f=null===(h=null===(c=null==v?void 0:v.layer)||void 0===c?void 0:c.networkInfo)||void 0===h?void 0:h.fromDateFieldSchema)||void 0===f?void 0:f.name],V[null===(y=null===(m=null===(p=null==v?void 0:v.layer)||void 0===p?void 0:p.networkInfo)||void 0===m?void 0:m.routeIdFieldSchema)||void 0===y?void 0:y.name]).then(c=>K(this,void 0,void 0,function*(){var h,f,p,m,y,g;const S=Math.min(...c),w=Math.max(...c);yield(0,d.QueryRouteMeasures)(r,a,[E.coordinate],V[null===(p=null===(f=null===(h=null==v?void 0:v.layer)||void 0===h?void 0:h.networkInfo)||void 0===f?void 0:f.fromDateFieldSchema)||void 0===p?void 0:p.name],V[null===(g=null===(y=null===(m=null==v?void 0:v.layer)||void 0===m?void 0:m.networkInfo)||void 0===y?void 0:y.routeIdFieldSchema)||void 0===g?void 0:g.name]).then(a=>{var c,h,f,p,m,y,g,b,D,x,L,j,R,k,C,M,N,P,T,G,F,E,A,O,U,W,H,z,B,_,J,Z,Q,$,K,Y,X,ee,te,ie,le,oe,ne,ae,re,de,se,ue,ve;const ce=[];a.forEach(e=>{var t,i;ce.push(q(e,null===(i=null===(t=null==v?void 0:v.layer)||void 0===t?void 0:t.networkInfo)||void 0===i?void 0:i.measurePrecision))});const he={objectIdFieldName:null===(h=null===(c=null==v?void 0:v.layer)||void 0===c?void 0:c.networkInfo)||void 0===h?void 0:h.objectIdFieldName,ds:i,records:s,featureDS:r,supportsLines:null===(p=null===(f=null==v?void 0:v.layer)||void 0===f?void 0:f.networkInfo)||void 0===p?void 0:p.supportsLines,routeId:V[null===(g=null===(y=null===(m=null==v?void 0:v.layer)||void 0===m?void 0:m.networkInfo)||void 0===y?void 0:y.routeIdFieldSchema)||void 0===g?void 0:g.name],routeIdFieldName:null===(x=null===(D=null===(b=null==v?void 0:v.layer)||void 0===b?void 0:b.networkInfo)||void 0===D?void 0:D.routeIdFieldSchema)||void 0===x?void 0:x.name,routeName:V[null===(R=null===(j=null===(L=null==v?void 0:v.layer)||void 0===L?void 0:L.networkInfo)||void 0===j?void 0:j.routeNameFieldSchema)||void 0===R?void 0:R.name],routeNameFieldName:null===(M=null===(C=null===(k=null==v?void 0:v.layer)||void 0===k?void 0:k.networkInfo)||void 0===C?void 0:C.routeNameFieldSchema)||void 0===M?void 0:M.name,lineOrderFieldName:null===(P=null===(N=null==v?void 0:v.layer)||void 0===N?void 0:N.networkInfo)||void 0===P?void 0:P.lineOrderFieldName,fromDate:V[null===(F=null===(G=null===(T=null==v?void 0:v.layer)||void 0===T?void 0:T.networkInfo)||void 0===G?void 0:G.fromDateFieldSchema)||void 0===F?void 0:F.name],toDate:V[null===(O=null===(A=null===(E=null==v?void 0:v.layer)||void 0===E?void 0:E.networkInfo)||void 0===A?void 0:A.toDateFieldSchema)||void 0===O?void 0:O.name],selectedPoint:n,selectedPolyline:e.geometry,validRoute:!0,measureUnit:(0,d.GetUnits)(null===(W=null===(U=null==v?void 0:v.layer)||void 0===U?void 0:U.networkInfo)||void 0===W?void 0:W.unitsOfMeasure,o),timeDependedInfo:[{objectId:V[null===(z=null===(H=null==v?void 0:v.layer)||void 0===H?void 0:H.networkInfo)||void 0===z?void 0:z.objectIdFieldName],fromDate:V[null===(J=null===(_=null===(B=null==v?void 0:v.layer)||void 0===B?void 0:B.networkInfo)||void 0===_?void 0:_.fromDateFieldSchema)||void 0===J?void 0:J.name],toDate:V[null===($=null===(Q=null===(Z=null==v?void 0:v.layer)||void 0===Z?void 0:Z.networkInfo)||void 0===Q?void 0:Q.toDateFieldSchema)||void 0===$?void 0:$.name],fromMeasure:q(S,null===(Y=null===(K=null==v?void 0:v.layer)||void 0===K?void 0:K.networkInfo)||void 0===Y?void 0:Y.measurePrecision),toMeasure:q(w,null===(ee=null===(X=null==v?void 0:v.layer)||void 0===X?void 0:X.networkInfo)||void 0===ee?void 0:ee.measurePrecision),selectedMeasures:ce,attributes:V}],fieldInfos:null==u?void 0:u.fields};if(null==t?void 0:t.includes(null===(te=null==v?void 0:v.layer)||void 0===te?void 0:te.serviceId)){const e=l.find(e=>{var t;return e.id===(null===(t=null==v?void 0:v.layer)||void 0===t?void 0:t.serviceId)}),t=null==e?void 0:e.routes;let i=!1;t.forEach(e=>{var t,l,n,a,r,s,u,c,h,f,p,m,y,g;if((null==e?void 0:e.routeId)===V[null==v?void 0:v.routeIdFieldName]){i=!0;const b=e;b.timeDependedInfo.push({objectId:V[null===(l=null===(t=null==v?void 0:v.layer)||void 0===t?void 0:t.networkInfo)||void 0===l?void 0:l.objectIdFieldName],measureUnit:(0,d.GetUnits)(null===(a=null===(n=null==v?void 0:v.layer)||void 0===n?void 0:n.networkInfo)||void 0===a?void 0:a.unitsOfMeasure,o),fromMeasure:q(S,null===(s=null===(r=null==v?void 0:v.layer)||void 0===r?void 0:r.networkInfo)||void 0===s?void 0:s.measurePrecision),toMeasure:q(w,null===(c=null===(u=null==v?void 0:v.layer)||void 0===u?void 0:u.networkInfo)||void 0===c?void 0:c.measurePrecision),selectedMeasures:ce,fromDate:V[null===(p=null===(f=null===(h=null==v?void 0:v.layer)||void 0===h?void 0:h.networkInfo)||void 0===f?void 0:f.fromDateFieldSchema)||void 0===p?void 0:p.name],toDate:V[null===(g=null===(y=null===(m=null==v?void 0:v.layer)||void 0===m?void 0:m.networkInfo)||void 0===y?void 0:y.toDateFieldSchema)||void 0===g?void 0:g.name],attributes:V}),b.timeDependedInfo.sort((e,t)=>e.fromDate-t.fromDate)}}),i||null===(ie=null==e?void 0:e.routes)||void 0===ie||ie.push(he)}else{const e={id:null===(le=null==v?void 0:v.layer)||void 0===le?void 0:le.serviceId,networkId:null===(ne=null===(oe=null==v?void 0:v.layer)||void 0===oe?void 0:oe.networkInfo)||void 0===ne?void 0:ne.lrsNetworkId,layerName:null===(ae=null==v?void 0:v.layer)||void 0===ae?void 0:ae.name,configFields:null===(de=null===(re=null==v?void 0:v.layer)||void 0===re?void 0:re.networkInfo)||void 0===de?void 0:de.attributeFields,useFieldAlias:null===(ue=null===(se=null==v?void 0:v.layer)||void 0===se?void 0:se.networkInfo)||void 0===ue?void 0:ue.useFieldAlias,routes:[he]};l.push(e),t.push(null===(ve=null==v?void 0:v.layer)||void 0===ve?void 0:ve.serviceId)}I.push(he)})}))}))}else(null===(h=null==v?void 0:v.layer)||void 0===h?void 0:h.layerType)===d.LrsLayerType.Event&&b.push({parentNetworkId:null===(w=null===(y=null==v?void 0:v.layer)||void 0===y?void 0:y.eventInfo)||void 0===w?void 0:w.parentNetworkId,attributes:V,attributeSets:m,defaultLineAttributeSet:p,defaultPointAttributeSet:f,eventLayerId:null===(D=null==v?void 0:v.layer)||void 0===D?void 0:D.serviceId,fromDate:null===(L=null===(x=null==v?void 0:v.layer)||void 0===x?void 0:x.eventInfo)||void 0===L?void 0:L.fromDateFieldName,toDate:null===(R=null===(j=null==v?void 0:v.layer)||void 0===j?void 0:j.eventInfo)||void 0===R?void 0:R.toDateFieldName,fieldInfos:null==u?void 0:u.fields,routeIdFieldName:null===(C=null===(k=null==v?void 0:v.layer)||void 0===k?void 0:k.eventInfo)||void 0===C?void 0:C.routeIdFieldName,toRouteIdFieldName:null===(N=null===(M=null==v?void 0:v.layer)||void 0===M?void 0:M.eventInfo)||void 0===N?void 0:N.toRouteIdFieldName,canSpanRoutes:null===(T=null===(P=null==v?void 0:v.layer)||void 0===P?void 0:P.eventInfo)||void 0===T?void 0:T.canSpanRoutes})})))})).finally(()=>{c&&(u.popupEnabled=!1),L.current=!1}).catch(e=>{console.error(e)})}}))).then(()=>{i.setSelectedPoint(n),i.setRouteDetails(l),i.setEventDetails(b)})});return(0,e.jsx)("div",{css:Y,children:(0,e.jsx)(l.Button,{className:r?"route-picker-btn":"route-picker-btn-disabled",size:"sm",tabIndex:-1,type:"tertiary",icon:!0,disabled:!a,onClick:()=>{y(),S(),g(),N(),w(!j),R(!j),j||(i.setRouteDetails([]),i.setEventDetails([]))},children:(0,e.jsx)(l.Icon,{size:"m",icon:n(),className:"border-0"})})})}const ee="#008000";var te=v(99037),ie=v(22089);function le(o){var n;const{intl:a,lrsLayers:r,widgetId:s,outputDS:u,networkLayers:v,selectedLocationInfo:c,eventDetails:h,jimuMapView:f,allDataSources:p,measuresOids:m,isNetworkChange:y,selectedPoint:g,lineEventToggle:S,pointEventToggle:w,onRouteInfoUpdated:b,clearPickedGraphic:D,handleSelectedNetworkChange:I}=o,x=t.React.useRef(null),[L,j]=t.React.useState(!0),[R,k]=t.React.useState({x:0,y:0}),[C,M]=t.React.useState({width:400,height:500}),[N,P]=t.React.useState(null),[T,G]=t.React.useState(),[F,E]=t.React.useState(),[A,V]=t.React.useState(0),[O,U]=t.React.useState(null),[W,H]=t.React.useState(null),[z,B]=t.React.useState(null),_=T&&(null==T?void 0:T[A]),J=t.hooks.useTranslation(i);t.React.useEffect(()=>{var e,t,i,l;const n=c,a=null==f?void 0:f.view.toScreen(n.routes[0].selectedPoint);if(c&&(j(!0),x.current=n,a&&!y)){const e=R;e.x=a.x+16,e.y=a.y+16;const t=X(a.x,a.y,null==f?void 0:f.view);t&&(e.x=t.x+16,e.y=t.y+16),k(e)}(()=>{var e,t,i,l,n,r,d,s,h,f;const p=null===(t=null===(e=null==c?void 0:c.routes)||void 0===e?void 0:e[0])||void 0===t?void 0:t.objectIdFieldName;try{const e=o.dataRecords,t=[];e.forEach((e,i)=>{var l;const o=null===(l=v[i])||void 0===l?void 0:l.id;t[o]=e}),B(t);const y=[].concat.apply([],t[null==c?void 0:c.id]),g=[];u&&(null==y||y.forEach(e=>{var t,i;const l=m[null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[p]],o=Z(a,null===(i=null==e?void 0:e.feature)||void 0===i?void 0:i.attributes,l),n=null==u?void 0:u.buildRecord(o);g.push(n)}));const S=null===(n=null===(l=null===(i=null==c?void 0:c.routes)||void 0===i?void 0:i[0])||void 0===l?void 0:l.timeDependedInfo)||void 0===n?void 0:n[0].objectId,w=null===(h=null===(s=null===(d=null===(r=null==c?void 0:c.routes)||void 0===r?void 0:r[0])||void 0===d?void 0:d.timeDependedInfo)||void 0===s?void 0:s[0])||void 0===h?void 0:h.selectedMeasures[0];U([].concat.apply([],e));const b=$(y,S,p),D=Z(a,null===(f=null==b?void 0:b.feature)||void 0===f?void 0:f.attributes,w),I=null==u?void 0:u.buildRecord(D);H(I),Q(g,I,S)}catch(e){console.error("Error fetching data:",e)}})(),V(0),P(n),I(n,!1),G(null==n?void 0:n.routes),E(null===(i=null===(t=null===(e=null==n?void 0:n.routes)||void 0===e?void 0:e[0])||void 0===t?void 0:t.timeDependedInfo)||void 0===i?void 0:i[0]),b(null===(l=null==n?void 0:n.routes)||void 0===l?void 0:l[0],!0)},[null==f?void 0:f.view,c,v,u]);const Z=(e,t,i)=>{i&&(t[d.measureFields.at(0).value]=i);return new ie.default({geometry:g,attributes:t})},Q=(e,i,l)=>{null==u||u.clearRecords(),null==u||u.clearSelection(),null==u||u.setCountStatus(t.DataSourceStatus.NotReady),null==u||u.setStatus(t.DataSourceStatus.NotReady),null==u||u.setStatus(t.DataSourceStatus.Unloaded),null==u||u.setCountStatus(t.DataSourceStatus.Unloaded),null==u||u.setSourceRecords(e),null==u||u.setRecords(e),null==u||u.selectRecordById(l),Y(u,s)},$=(e,t,i)=>{for(let l=0;l<(null==e?void 0:e.length);l++){if(e[l].getData()[i]===t)return e[l]}},q=t.ReactRedux.useSelector(e=>{var t;return null===(t=e.appConfig.widgets[s].enableDataAction)||void 0===t||t}),K=t.React.useMemo(()=>({dataSource:u,type:"selected",records:[W],name:null==N?void 0:N.layerName}),[u,W,N]),Y=(e,i)=>{if(!e)return;const l=e.getOriginDataSources()[0],o=l.getPopupInfo(),n=l.getLayerDefinition(),a=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==n?void 0:n.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==o?void 0:o.fieldInfos)||[]).filter(e=>e.visible)),r=new t.DataRecordSetChangeMessage(i,t.RecordSetChangeType.CreateUpdate,[{records:e.getRecords(),fields:a.map(e=>e.fieldName),dataSource:e,name:e.id}]);t.MessageManager.getInstance().publishMessage(r)},X=(e,t,i)=>{if(!i)return;const l=C.width,o=C.height;return e>=0&&t>=0&&e+l<=window.innerWidth&&t+o<=window.innerHeight?null:(e+l>window.innerWidth&&(e=window.innerWidth-l),t+o>window.innerHeight&&(t=window.innerHeight-o),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},ee=t.React.useCallback(e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,l=null==v?void 0:v.find(e=>e.id===i),o=z[i];null==v||v.forEach((e,t)=>{var n,a,r,d,s,v,h,p,y,g,S,w,D,x,L,j;if((null==e?void 0:e.id)===i){const t=null===(d=null===(r=null===(a=null===(n=null==e?void 0:e.routes)||void 0===n?void 0:n[0])||void 0===a?void 0:a.timeDependedInfo)||void 0===r?void 0:r[0])||void 0===d?void 0:d.objectId,R=null===(y=null===(p=null===(h=null===(v=null===(s=null==e?void 0:e.routes)||void 0===s?void 0:s[0])||void 0===v?void 0:v.timeDependedInfo)||void 0===h?void 0:h[0])||void 0===p?void 0:p.selectedMeasure)||void 0===y?void 0:y[0],k=null===(S=null===(g=null==e?void 0:e.routes)||void 0===g?void 0:g[0])||void 0===S?void 0:S.objectIdFieldName,C=$(O,t,k),M=Z(null==f?void 0:f.view.toScreen(null==e?void 0:e.routes[0].selectedPoint),null===(w=null==C?void 0:C.feature)||void 0===w?void 0:w.attributes,R),N=null==u?void 0:u.buildRecord(M);P(l),I(l,!0),G(null==e?void 0:e.routes),E(null===(L=null===(x=null===(D=null==e?void 0:e.routes)||void 0===D?void 0:D[0])||void 0===x?void 0:x.timeDependedInfo)||void 0===L?void 0:L[0]),V(0),b(null===(j=null==e?void 0:e.routes)||void 0===j?void 0:j[0],!0),H(N);const T=[].concat.apply([],o),F=[],A=null==f?void 0:f.view.toScreen(c.routes[0].selectedPoint);u&&(null==T||T.forEach(e=>{var t,i;const l=m[null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[k]],o=Z(A,null===(i=null==e?void 0:e.feature)||void 0===i?void 0:i.attributes,l),n=null==u?void 0:u.buildRecord(o);F.push(n)})),Q(F,N,i)}})},[O,I,z,b,u,c,s]),le=t.React.useCallback(e=>{k(e)},[]),oe=t.React.useCallback((e,t)=>{M(e),k(t)},[]),ne=(e,t,i)=>{const l=null==i?void 0:i.find(t=>t.name===e);if((0,d.isDefined)(l)&&(0,d.isDefined)(l.domain)&&"coded-value"===l.domain.type){const e=l.domain.codedValues.find(e=>"string"==typeof e.code&&"string"==typeof t?e.code.toLowerCase()===t.toLowerCase():e.code===t);if(e)return`${e.code} - ${e.name}`}},ae=e=>{if(!N)return;const t=864e13,i=-864e13,l=[],o=null==N?void 0:N.networkId,n=null!==(null==F?void 0:F.fromDate)?null==F?void 0:F.fromDate:i,a=null!==(null==F?void 0:F.toDate)?null==F?void 0:F.toDate:t;return h.sort((e,t)=>{const i=null==e?void 0:e.attributes,l=null==t?void 0:t.attributes;return i[e.fromDate]-l[t.fromDate]}),null==h||h.forEach(s=>{var u,v,c,h,f,m,y,g,S,w;const b=null==s?void 0:s.fieldInfos,D=null==s?void 0:s.attributes,I=null==s?void 0:s.fromDate,x=null==s?void 0:s.toDate,L=D[null==s?void 0:s.routeIdFieldName],j=D[I],R=(0,d.isDefined)(j)?(0,d.getDateWithTZOffset)(j,N.routes[A].ds).toLocaleDateString():J("nullStr"),k=D[x],C=(0,d.isDefined)(k)?(0,d.getDateWithTZOffset)(k,N.routes[A].ds).toLocaleDateString():J("nullStr");let M=null==s?void 0:s.defaultLineAttributeSet;"point"===e&&(M=null==s?void 0:s.defaultPointAttributeSet);let P=!1;if((null==s?void 0:s.parentNetworkId)===o)if("line"===e&&N&&(null===(u=T[A])||void 0===u?void 0:u.supportsLines)&&(null==s?void 0:s.canSpanRoutes)){const e=null===(c=null===(v=null==N?void 0:N.routes)||void 0===v?void 0:v[A])||void 0===c?void 0:c.routeIdFieldName,t=s.routeIdFieldName,i=s.toRouteIdFieldName,l=null===(f=null===(h=null==N?void 0:N.routes)||void 0===h?void 0:h[A])||void 0===f?void 0:f.lineOrderFieldName,o=null===(g=null===(y=null===(m=null==N?void 0:N.routes)||void 0===m?void 0:m[A])||void 0===y?void 0:y.records)||void 0===g?void 0:g.records;if(o){const n=null==F?void 0:F.attributes[l],a=o.find(i=>i.feature.attributes[e]===s.attributes[t]),r=o.find(t=>t.feature.attributes[e]===s.attributes[i]);r&&r.feature.attributes[l]>=n&&n>=a.feature.attributes[l]&&(P=!0)}}else(null==s?void 0:s.parentNetworkId)===o&&(null===(S=T[A])||void 0===S?void 0:S.routeId)===L&&(P=!0);if(P){const e=null===(w=s.attributeSets)||void 0===w?void 0:w.attributeSet.find(e=>e.title===M),o=null==e?void 0:e.layers;null==o||o.forEach(e=>{const o=[],u=r.find(t=>t.serviceId===e.layerId),v=(0,d.isDefined)(u)?u.name:null==e?void 0:e.layerName,c=(e=>{const t=p.find(t=>{var i,l;return(null===(l=null===(i=null==t?void 0:t.getLayerDefinition)||void 0===i?void 0:i.call(t))||void 0===l?void 0:l.id)===(null==e?void 0:e.layerId)});return t})(e);if(c){const r=(null==c?void 0:c.layer).fields,u=null!==D[I]?D[I]:i,h=null!==D[x]?D[x]:t;if((null==e?void 0:e.layerId)===s.eventLayerId&&(n<=u<=a||n<=h<=a)){(null==e?void 0:e.fields).forEach(e=>{const t=r.find(t=>t.name===e.name),i=null==e?void 0:e.name,l=null==t?void 0:t.type,n=ne(i,D[i],b);let a;a=n||D[i],"date"===(null==l?void 0:l.toLowerCase())&&(a=(0,d.isDefined)(a)?(0,d.getDateWithTZOffset)(a,N.routes[A].ds).toLocaleDateString():null),o.push({name:i,val:a,layerName:v,fromDate:R,toDate:C})}),l.push(de(o)),l.push(re())}}else;})}}),l},re=()=>(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}}),de=t=>{var i,o,n;const r=null===(i=null==t?void 0:t[0])||void 0===i?void 0:i.fromDate,s=null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.toDate,u=(null===(n=null==t?void 0:t[0])||void 0===n?void 0:n.layerName)+" ("+r+" - "+s+")";return(0,e.jsx)(l.CollapsablePanel,{label:u,level:0,type:"default",children:(0,e.jsxs)(te.CalciteTable,{className:"w-100 h-100",caption:J("routePicker"),bordered:!0,scale:"s",layout:"fixed",children:[(0,e.jsxs)(te.CalciteTableRow,{children:[(0,e.jsx)(te.CalciteTableHeader,{heading:(0,d.formatMessage)(a,"attribute")}),(0,e.jsx)(te.CalciteTableHeader,{heading:(0,d.formatMessage)(a,"value")})]}),null==t?void 0:t.map((t,i)=>(0,e.jsxs)(te.CalciteTableRow,{children:[(0,e.jsx)(te.CalciteTableCell,{children:t.name}),(0,e.jsx)(te.CalciteTableCell,{children:t.val})]},i))]})})},se=()=>{var t;return(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{width:"30%"},children:(0,e.jsx)(l.Label,{className:"label2",children:J("dateStr")})}),(0,e.jsx)("div",{children:(0,e.jsx)(l.Select,{size:"sm",value:F,onChange:e=>{(e=>{var t,i,l,o,n;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;E(a);const r=null==a?void 0:a.objectId,d=null===(l=null===(i=null==c?void 0:c.routes)||void 0===i?void 0:i[A])||void 0===l?void 0:l.objectIdFieldName,s=$(O,r,d),v=null===(o=null==a?void 0:a.selectedMeasures)||void 0===o?void 0:o[0],h=Z(null==f?void 0:f.view.toScreen(null==c?void 0:c.routes[A].selectedPoint),null===(n=null==s?void 0:s.feature)||void 0===n?void 0:n.attributes,v),p=null==u?void 0:u.buildRecord(h);H(p)})(e)},children:null===(t=null==_?void 0:_.timeDependedInfo)||void 0===t?void 0:t.map((t,i)=>(0,e.jsxs)(Option,{title:t.fromDate,value:t,label:t.fromDate,children:[(0,e.jsx)("span",{children:(0,d.isDefined)(t.fromDate)?(0,d.getDateWithTZOffset)(t.fromDate,N.routes[A].ds).toLocaleDateString():J("nullStr")}),(0,e.jsx)("span",{style:{paddingLeft:"0.3rem",paddingRight:"0.3rem"},children:J("toStr")}),(0,e.jsx)("span",{children:(0,d.isDefined)(t.toDate)?(0,d.getDateWithTZOffset)(t.toDate,N.routes[A].ds).toLocaleDateString():J("nullStr")})]},i))})})]})},ue=t=>(0,e.jsxs)(te.CalciteTable,{className:"w-100 h-100",caption:J("routePicker"),bordered:!0,scale:"s",layout:"fixed",children:[(0,e.jsxs)(te.CalciteTableRow,{slot:"table-header",children:[(0,e.jsx)(te.CalciteTableHeader,{heading:(0,d.formatMessage)(a,"attribute")}),(0,e.jsx)(te.CalciteTableHeader,{heading:(0,d.formatMessage)(a,"value")})]}),null==t?void 0:t.map((t,i)=>(0,e.jsxs)(te.CalciteTableRow,{children:[(0,e.jsx)(te.CalciteTableCell,{children:t.name}),(0,e.jsx)(te.CalciteTableCell,{children:t.val})]},i))]}),ve=e=>ae(e),ce=()=>{const t=null==F?void 0:F.selectedMeasures,i=[];for(let l=1;l<t.length;l++)i.push((0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row",paddingBottom:"0.5rem"},children:[(0,e.jsx)("div",{style:{width:"30%"}}),(0,e.jsx)("span",{children:t[l]}),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"},children:T[A].measureUnit})]}));return i};return(0,e.jsx)("div",{style:{position:"relative"},children:L&&c&&(0,e.jsx)(l.FloatingPanel,{headerTitle:J("identifyResults"),size:C,defaultPosition:R,position:R,disableActivateOverlay:!1,dragBounds:"body",onDrag:le,onResize:oe,onHeaderClose:()=>{D(),j(!1)},children:(0,e.jsxs)("div",{css:(0,d.getCalciteBasicTheme)(),children:[(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",padding:"10px",overflowY:"scroll",height:"inherit"},children:[q&&(0,e.jsx)(t.React.Fragment,{children:(0,e.jsx)("div",{className:"ml-auto",children:(0,e.jsx)(l.DataActionList,{widgetId:s,dataSets:[K],listStyle:l.DataActionListStyle.Dropdown,buttonSize:"sm",buttonType:"tertiary"})})}),(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{width:"30%"},children:(0,e.jsx)(l.Label,{className:"label2",children:J("networkLabel")})}),(0,e.jsx)("div",{style:{width:"50%"},children:N&&(0,e.jsx)(l.Select,{size:"sm",value:N.id,onChange:ee,children:v.map((t,i)=>(0,e.jsx)(Option,{title:t.layerName,value:t.id,label:t.layerName,children:t.layerName},i))})})]}),_&&(t=>{var i,o;const n=((e,t,i)=>{if(!N)return;const l=[null==i?void 0:i.routeIdFieldName,null==i?void 0:i.routeNameFieldName],o=N?N.configFields:null,n=N?N.useFieldAlias:null,a=[];return(null==o?void 0:o.length)>0&&e&&o.forEach(i=>{var o,r,s,u,v;const c=null==i?void 0:i.enabled;let h=null===(o=null==i?void 0:i.field)||void 0===o?void 0:o.name;if(c&&!l.includes(h)){const l=ne(h,e[null===(r=null==i?void 0:i.field)||void 0===r?void 0:r.name],t);n&&(h=null===(s=null==i?void 0:i.field)||void 0===s?void 0:s.alias);const o=null===(u=null==i?void 0:i.field)||void 0===u?void 0:u.type;let c;l?c=l:(c=e[null===(v=null==i?void 0:i.field)||void 0===v?void 0:v.name],"date"===(null==o?void 0:o.toLowerCase())&&(c=(0,d.isDefined)(c)?(0,d.getDateWithTZOffset)(c,N.routes[A].ds).toLocaleDateString():null)),h&&a.push({name:h,val:c})}}),a})(null==F?void 0:F.attributes,null==t?void 0:t.fieldInfos,t),a=ve("line"),r=ve("point");return(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[t.routeId&&(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row",paddingTop:"0.5rem"},children:[(0,e.jsx)("div",{style:{width:"30%",flex:"none"},children:(0,e.jsx)(l.Label,{className:"label2",children:J("routeId")})}),(0,e.jsx)("div",{title:t.routeId,style:{width:"fitContent",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.routeId})]}),t.routeName&&(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{width:"30%"},children:(0,e.jsx)(l.Label,{className:"label2",children:J("routeName")})}),(0,e.jsx)("div",{children:t.routeName})]}),(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{width:"30%"},children:(0,e.jsx)(l.Label,{className:"label2",children:J("measureLabel")})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:null===(i=F.selectedMeasures)||void 0===i?void 0:i[0]}),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"},children:T[A].measureUnit})]})]}),(null===(o=F.selectedMeasures)||void 0===o?void 0:o.length)>1&&ce(),(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{width:"30%"},children:(0,e.jsx)(l.Label,{className:"label2",children:J("startMeasure")})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:F.fromMeasure}),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"},children:T[A].measureUnit})]})]}),(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,e.jsx)("div",{style:{width:"30%"},children:(0,e.jsx)(l.Label,{className:"label2",children:J("endMeasure")})}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("span",{children:[" ",F.toMeasure]}),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"},children:T[A].measureUnit})]})]}),se(),n&&(null==n?void 0:n.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"0.5rem"},children:ue(n)}),S&&(null==a?void 0:a.length)>0&&(0,e.jsxs)("div",{style:{paddingTop:"1.5rem"},children:[J("lineEvent"),a]}),w&&(null==r?void 0:r.length)>0&&(0,e.jsxs)("div",{style:{paddingTop:"0.5rem"},children:[J("pointEvent"),r]})]})})(_)]}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,e.jsx)(l.Pagination,{current:A+1,onChangePage:e=>{(e=>{var t,i,l,o,n,a,r,d,s,v,h,p,m,y,g,S;D();const w=e-1,I=null===(o=null===(l=null===(i=null===(t=null==c?void 0:c.routes)||void 0===t?void 0:t[w])||void 0===i?void 0:i.timeDependedInfo)||void 0===l?void 0:l[0])||void 0===o?void 0:o.objectId,x=null===(a=null===(n=null==c?void 0:c.routes)||void 0===n?void 0:n[0])||void 0===a?void 0:a.objectIdFieldName,L=$(O,I,x),j=null===(h=null===(v=null===(s=null===(d=null===(r=null==c?void 0:c.routes)||void 0===r?void 0:r[w])||void 0===d?void 0:d.timeDependedInfo)||void 0===s?void 0:s[0])||void 0===v?void 0:v.selectedMeasures)||void 0===h?void 0:h[0],R=Z(null==f?void 0:f.view.toScreen(null==c?void 0:c.routes[w].selectedPoint),null===(p=null==L?void 0:L.feature)||void 0===p?void 0:p.attributes,j),k=null==u?void 0:u.buildRecord(R);V(w),E(null===(g=null===(y=null===(m=null==c?void 0:c.routes)||void 0===m?void 0:m[w])||void 0===y?void 0:y.timeDependedInfo)||void 0===g?void 0:g[0]),H(k),b(null===(S=null==c?void 0:c.routes)||void 0===S?void 0:S[w],!0)})(e)},simple:!0,size:"sm",totalPage:null===(n=null==N?void 0:N.routes)||void 0===n?void 0:n.length})})]})})})}var oe=function(e,t,i,l){return new(i||(i=Promise))(function(o,n){function a(e){try{d(l.next(e))}catch(e){n(e)}}function r(e){try{d(l.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}d((l=l.apply(e,t||[])).next())})};var ne=function(e,t,i,l){return new(i||(i=Promise))(function(o,n){function a(e){try{d(l.next(e))}catch(e){n(e)}}function r(e){try{d(l.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}d((l=l.apply(e,t||[])).next())})};function ae(i){const{widgetId:l,intl:o,lrsLayers:n,JimuMapView:a,defaultShowPp:r,hoverGraphic:s,highlightStyle:v,defaultPointAttributeSet:c,defaultLineAttributeSet:h,attributeSets:f,lineEventToggle:p,pointEventToggle:m,defaultNetwork:y,lrsControllerToggled:g,onClearFlashGraphics:S,onClearPickedGraphics:w,onUpdateGraphics:b,flashSelectedGeometry:D}=i,[I,x]=t.React.useState(!1),[L,j]=t.React.useState(!1),[R,k]=t.React.useState(null),[C,M]=t.React.useState(null),[N,P]=t.React.useState(null),[T,G]=t.React.useState(null),[F,E]=t.React.useState(null),[A,V]=t.React.useState(null),[O,U]=t.React.useState(null),[W,H]=t.React.useState(!1),[z,B]=t.React.useState(g),[_,J]=t.React.useState(null),[Z,Q]=t.React.useState(!0),[$,q]=t.React.useState(null);t.React.useEffect(()=>{if(n&&n.length>0){const e=null==n?void 0:n.find(e=>(null==e?void 0:e.name)===(null==y?void 0:y.name));e&&(null==e?void 0:e.networkInfo)&&M(null==e?void 0:e.networkInfo)}},[y,n]),t.React.useEffect(()=>{z!==g&&(ie(),B(g))},[g]),t.React.useEffect(()=>{Q(!1),w()},[n]),t.React.useEffect(()=>{if(!(null==a?void 0:a.view)||!W)return;const e=a.view.on("click",e=>{var t,i;null===(t=e.stopPropagation)||void 0===t||t.call(e),null===(i=e.preventDefault)||void 0===i||i.call(e)});return()=>{null==e||e.remove()}},[a,W]);const K=t.React.useCallback(e=>{x(e)},[x]),Y=t.React.useCallback(e=>{G(e)},[G]),te=(e,...t)=>ne(this,[e,...t],void 0,function*(e,t=!1){const i=v.routeColor,l=v.width;(0,d.isDefined)(e.selectedPolyline)&&t&&D(yield(0,d.getGeometryGraphic)(yield(0,d.getSimpleLineGraphic)(e.selectedPolyline),i,l)),(0,d.isDefined)(e.selectedPoint)?b(yield(0,d.getGeometryGraphic)(yield(0,d.getSimplePointGraphic)(e.selectedPoint),ee)):w(),a.clearSelectedFeatures()}),ie=()=>{var e;const t=!W;H(t),t?((null===(e=null==a?void 0:a.view)||void 0===e?void 0:e.popupEnabled)&&(a.view.popupEnabled=!1),S(),w()):a.view.popupEnabled=r};return(0,e.jsxs)("div",{children:[(0,e.jsx)(u,{widgetId:l,selectedNetwork:C,onCreatePointDs:e=>{k(e)},lrsLayers:n,dataSourcesReady:K,handleSetDataSources:Y}),(0,e.jsx)(X,{intl:o,isReady:I,active:W,allDataSources:T,lrsLayers:n,jimuMapView:a,symbolColor:null,hoverGraphic:s,onActiveChange:ie,onRouteInfoUpdated:te,clearPickedGraphic:w,clearFlashGraphic:S,setSelectedPoint:e=>{E(e)},setRouteDetails:e=>ne(this,void 0,void 0,function*(){const t=[],i={};e.forEach(e=>{var l,o,n,a,r;const d=[];null===(l=null==e?void 0:e.routes)||void 0===l||l.forEach(e=>{var t;null===(t=null==e?void 0:e.timeDependedInfo)||void 0===t||t.forEach(e=>{var t;const l=null==e?void 0:e.objectId;d.push(l),i[l]=null===(t=null==e?void 0:e.selectedMeasures)||void 0===t?void 0:t[0]})}),t.push(function(e,t,i){return oe(this,void 0,void 0,function*(){var l;if(!e||0===e.length||!t)return[];const o={where:t+" IN ("+e.join(",")+")",outFields:["*"],returnGeometry:!0},n=yield i.query(o);return 0===(null===(l=null==n?void 0:n.records)||void 0===l?void 0:l.length)?[]:null==n?void 0:n.records})}(d,null===(n=null===(o=null==e?void 0:e.routes)||void 0===o?void 0:o[0])||void 0===n?void 0:n.objectIdFieldName,null===(r=null===(a=null==e?void 0:e.routes)||void 0===a?void 0:a[0])||void 0===r?void 0:r.featureDS))});const l=yield Promise.all(t);q(i),J(l),(e=>{let t=e.find(e=>y.name===(null==e?void 0:e.layerName));t||(t=e[0]);const i=n.find(e=>{var i;return(null===(i=null==e?void 0:e.layerInfo)||void 0===i?void 0:i.serviceId)===(null==t?void 0:t.id)});P(t),M(null==i?void 0:i.networkInfo),j(!1)})(e),V(e)}),setEventDetails:e=>{U(e)},eventDataRecords:[],defaultLineAttributeSet:h,defaultPointAttributeSet:c,attributeSets:f,handleShowPp:e=>{Q(e)}}),A&&A.length>0&&_.length>0&&Z&&(0,e.jsx)(le,{intl:o,lrsLayers:n,allDataSources:T,selectedPoint:F,eventDetails:O,jimuMapView:a,onRouteInfoUpdated:te,clearPickedGraphic:w,pointEventToggle:m,lineEventToggle:p,isNetworkChange:L,widgetId:l,outputDS:R,dataRecords:_,measuresOids:$,selectedLocationInfo:N||A[0],networkLayers:A,handleSelectedNetworkChange:(e,t)=>{const i=n.find(t=>{var i;return(null===(i=null==t?void 0:t.layerInfo)||void 0===i?void 0:i.serviceId)===(null==e?void 0:e.id)}),l=A.find(t=>t.id===(null==e?void 0:e.id));P(l),M(null==i?void 0:i.networkInfo),j(t)}})]})}var re=function(e,t,i,l){return new(i||(i=Promise))(function(o,n){function a(e){try{d(l.next(e))}catch(e){n(e)}}function r(e){try{d(l.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}d((l=l.apply(e,t||[])).next())})};class de extends t.React.PureComponent{constructor(e){super(e),this.supportedLrsLayerTypes=(0,t.Immutable)([d.LrsLayerType.Network,d.LrsLayerType.Event,d.LrsLayerType.LineEvent,d.LrsLayerType.PointEvent,d.LrsLayerType.Intersection]),this.clearPickedGraphics=()=>{(0,d.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll()},this.clearFlashGraphic=()=>{(0,d.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()},this.updatePickedGraphic=e=>{(0,d.isDefined)(e)?(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.add(e)):this.clearPickedGraphics()},this.flashSelectedGeometry=e=>{(0,d.isDefined)(e)&&(this.state.flashGraphic.add(e),setTimeout(()=>{this.state.flashGraphic.removeAll(),setTimeout(()=>{this.state.flashGraphic.add(e),setTimeout(()=>{this.state.flashGraphic.removeAll(),setTimeout(()=>{this.state.flashGraphic.add(e),setTimeout(()=>{this.state.flashGraphic.removeAll()},800)},800)},800)},800)},800))},this.updateGraphics=(e,t)=>re(this,void 0,void 0,function*(){(0,d.isDefined)(e.selectedPolyline)&&t&&this.flashSelectedGeometry(yield(0,d.getGeometryGraphic)(yield(0,d.getSimpleLineGraphic)(e.selectedPolyline),"#00FFFF")),(0,d.isDefined)(e.selectedPoint)?this.updatePickedGraphic(yield(0,d.getGeometryGraphic)(yield(0,d.getSimplePointGraphic)(e.selectedPoint),ee)):this.clearPickedGraphics()}),this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally(()=>{this.setState({jimuMapView:e})})},this.waitForChildDataSourcesReady=e=>re(this,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const i=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==i?void 0:i.isDataSourceSet())&&!i.areChildDataSourcesCreated()?i.childDataSourcesReady().then(()=>i).catch(e=>i):Promise.resolve(i)}),this.getI18nMessage=(e,t)=>{const o=Object.assign({},i,l.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},t)},this.handleLrsLayersChanged=e=>{this.setState({activeLrsLayers:e})},this.handleViewChange=e=>{e&&this.setState({activeMapViewId:e.id})},this.getToggledFromController=()=>{var e;return(null===(e=this.props.mutableStateProps)||void 0===e?void 0:e.active)||""},this.state={jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null,activeMapViewId:"",activeLrsLayers:this.props.config.lrsLayers}}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,t){t.jimuMapView!==this.state.jimuMapView&&(0,d.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers())}removeGraphicLayers(){(0,d.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,d.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,d.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,d.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const i=new r.default({listMode:"hide"}),l=new r.default({listMode:"hide"}),o=new r.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([l,o,i]),this.setState({hoverGraphic:i}),this.setState({pickedGraphic:l}),this.setState({flashGraphic:o})}}clearGraphics(){(0,d.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,d.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,d.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}getConfigValues(e,t,i){const l={networkLayers:t.networkLayers,eventLayers:t.eventLayers,intersectionLayers:t.intersectionLayers,defaultEvent:t.defaultEvent,highlightStyle:t.highlightStyle,defaultPointAttributeSet:t.defaultPointAttributeSet,defaultLineAttributeSet:t.defaultLineAttributeSet,attributeSets:t.attributeSets,lineEventToggle:t.lineEventToggle,pointEventToggle:t.pointEventToggle,defaultNetwork:t.defaultNetwork};return Object.entries(l).reduce((t,[l,o])=>(t[l]=(0,d.getConfigValue)(e,l,i,o),t),{})}render(){var i,o,r,s;const{config:u,id:v}=this.props;let{useMapWidgetIds:c}=this.props;const{mapViewsConfig:h}=u,f=u.mode&&u.mode!==d.ModeType.Map?u.lrsLayers:this.state.activeLrsLayers,p=(0,d.isDefined)(u.settingsPerView)&&(0,d.isDefined)(u.settingsPerView[this.state.activeMapViewId]);let m=(null===(i=u.settingsPerView)||void 0===i?void 0:i[this.state.activeMapViewId])||function(){const e={networkLayers:[],eventLayers:[],intersectionLayers:[],defaultEvent:{index:-1,name:""},highlightStyle:{routeColor:d.highlightColor,width:3},defaultPointAttributeSet:"",defaultLineAttributeSet:"",attributeSets:{attributeSet:[]},lineEventToggle:!1,pointEventToggle:!1,defaultNetwork:{index:-1,name:""}};return(0,t.Immutable)(e)}();!p&&f.length>0&&(m=function(e,t,i){if(i){const i=t.filter(e=>e.layerType===d.LrsLayerType.Network).map(e=>e.name),l=t.filter(e=>e.layerType===d.LrsLayerType.Event).map(e=>e.name),o=t.filter(e=>e.layerType===d.LrsLayerType.Intersection).map(e=>e.name);e=e.set("networkLayers",i).set("eventLayers",l).set("intersectionLayers",o)}const l=(0,d.getDefaultEvent)(t,e.defaultEvent,!1),o=(0,d.getDefaultNetwork)(t,e.defaultNetwork),n=(0,d.getDefaultAttributeSet)(null==e?void 0:e.attributeSets,e.defaultPointAttributeSet,!0),a=(0,d.getDefaultAttributeSet)(null==e?void 0:e.attributeSets,e.defaultLineAttributeSet,!1);return e.set("defaultEvent",l||e.defaultEvent).set("highlightStyle",e.highlightStyle||{routeColor:d.highlightColor,width:3}).set("defaultPointAttributeSet",n||e.defaultPointAttributeSet).set("defaultLineAttributeSet",a||e.defaultLineAttributeSet).set("attributeSets",e.attributeSets||!1).set("lineEventToggle",e.lineEventToggle||!1).set("pointEventToggle",e.pointEventToggle||!1).set("defaultNetwork",o||e.defaultNetwork)}(m,f,!0));const y=this.getConfigValues(u,m,this.state.activeMapViewId),{networkLayers:g,defaultNetwork:S,highlightStyle:w,defaultPointAttributeSet:b,defaultLineAttributeSet:D,attributeSets:I,lineEventToggle:x,pointEventToggle:L}=y,j=(0,d.getModeType)(u.mode,f),{jimuMapView:R}=this.state,k=g&&g.length>0,C=this.getToggledFromController();if(!c){const e=null===(r=null===(o=(0,t.getAppStore)())||void 0===o?void 0:o.getState())||void 0===r?void 0:r.appConfig;c=(0,d.findFirstArcgisMapWidgetId)(e)}return(0,e.jsxs)(l.Paper,{variant:"flat",shape:"none",css:t.css`
    min-width: 32px;
    min-height: 32px;
  `,children:[(0,e.jsx)(a.JimuMapViewComponent,{useMapWidgetId:null==c?void 0:c[0],onActiveViewChange:this.onActiveViewChange}),j&&(0,e.jsx)(d.MapViewLoader,{config:u,widgetId:v,supportedLrsLayerTypes:this.supportedLrsLayerTypes,useMapWidgetIds:c,mapViewsConfig:h,jimuMapView:R,outputDataSourceType:"identify",onLrsLayersChanged:this.handleLrsLayersChanged,onViewChange:this.handleViewChange}),k&&(0,e.jsx)(ae,{intl:this.props.intl,widgetId:v,lrsLayers:f,highlightStyle:w,defaultPointAttributeSet:b,defaultLineAttributeSet:D,attributeSets:I,lineEventToggle:x,pointEventToggle:L,JimuMapView:R,hoverGraphic:this.state.hoverGraphic,defaultNetwork:S,lrsControllerToggled:C,onClearPickedGraphics:this.clearPickedGraphics.bind(this),onClearFlashGraphics:this.clearFlashGraphic.bind(this),onUpdateGraphics:this.updatePickedGraphic.bind(this),flashSelectedGeometry:this.flashSelectedGeometry.bind(this),defaultShowPp:null===(s=null==R?void 0:R.view)||void 0===s?void 0:s.popupEnabled}),!k&&(0,e.jsx)(l.WidgetPlaceholder,{icon:n(),widgetId:v,message:this.getI18nMessage("_widgetLabel")})]})}}function se(e){v.p=e}})(),c})())}}});