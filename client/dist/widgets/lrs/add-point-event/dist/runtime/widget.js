System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-arcgis","widgets/shared-code/lrs","calcite-components","jimu-core/react","jimu-theme","esri/layers/GraphicsLayer","jimu-for-builder"],function(e,t){var a={},n={},o={},i={},s={},r={},c={},l={},u={},d={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){n.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.Immutable=e.Immutable,n.MessageManager=e.MessageManager,n.React=e.React,n.RecordSetChangeType=e.RecordSetChangeType,n.WidgetState=e.WidgetState,n.classNames=e.classNames,n.css=e.css,n.focusElementInKeyboardMode=e.focusElementInKeyboardMode,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,o.Label=e.Label,o.Option=e.Option,o.Paper=e.Paper,o.Select=e.Select,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.AttributeTable=e.AttributeTable,s.CopyAttributeTool=e.CopyAttributeTool,s.GetUnits=e.GetUnits,s.InlineEditableDropdown=e.InlineEditableDropdown,s.Intellisense=e.Intellisense,s.LockAction=e.LockAction,s.LockManagerComponent=e.LockManagerComponent,s.LrsApplyEdits=e.LrsApplyEdits,s.LrsLayerType=e.LrsLayerType,s.MapViewLoader=e.MapViewLoader,s.ModeType=e.ModeType,s.PointConcurrencyTable=e.PointConcurrencyTable,s.QueryMeasureOnRoute=e.QueryMeasureOnRoute,s.QueryRouteConcurrencies=e.QueryRouteConcurrencies,s.QueryRouteMeasures=e.QueryRouteMeasures,s.RoutePicker=e.RoutePicker,s.RoutePickerPopup=e.RoutePickerPopup,s.SearchMethod=e.SearchMethod,s.checkConflictPrevention=e.checkConflictPrevention,s.convertStationToNumber=e.convertStationToNumber,s.findFirstArcgisMapWidgetId=e.findFirstArcgisMapWidgetId,s.getAttributeSets=e.getAttributeSets,s.getCalciteBasicTheme=e.getCalciteBasicTheme,s.getConfigValue=e.getConfigValue,s.getDateToUTC=e.getDateToUTC,s.getDateWithRouteTime=e.getDateWithRouteTime,s.getDateWithTZOffset=e.getDateWithTZOffset,s.getDateWithoutTZOffset=e.getDateWithoutTZOffset,s.getDateWithoutTime=e.getDateWithoutTime,s.getDefaultAttributeSet=e.getDefaultAttributeSet,s.getDefaultEvent=e.getDefaultEvent,s.getDefaultNetwork=e.getDefaultNetwork,s.getGeometryGraphic=e.getGeometryGraphic,s.getInitialRouteInfoState=e.getInitialRouteInfoState,s.getIntialLocksInfo=e.getIntialLocksInfo,s.getModeType=e.getModeType,s.getNetworkOutFields=e.getNetworkOutFields,s.getRouteFromEndMeasures=e.getRouteFromEndMeasures,s.getRoutesByRouteIds=e.getRoutesByRouteIds,s.getSimpleLineGraphic=e.getSimpleLineGraphic,s.getSimplePointGraphic=e.getSimplePointGraphic,s.getSuggestions=e.getSuggestions,s.getUUID=e.getUUID,s.isDate=e.isDate,s.isDefined=e.isDefined,s.isInWidgetController=e.isInWidgetController,s.isNumber=e.isNumber,s.isPointEvent=e.isPointEvent,s.queryRouteIdOrName=e.queryRouteIdOrName,s.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,s.useEditSession=e.useEditSession,s.useVmsManager=e.useVmsManager,s.validateContingencyConstraints=e.validateContingencyConstraints,s.validateField=e.validateField,s.validateRangeDomain=e.validateRangeDomain,s.waitTime=e.waitTime},function(e){r.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){c.useImperativeHandle=e.useImperativeHandle},function(e){l.getTheme=e.getTheme},function(e){u.default=e.default},function(e){d.getAppConfigAction=e.getAppConfigAction}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=l},4108:e=>{"use strict";e.exports=d},14321:e=>{"use strict";e.exports=o},40643:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M2 4h15a1 1 0 0 1 1 1v6h1V5a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h9v-1H2a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1"></path><path fill="#000" d="M5.5 7.5v-2h-1v2H3v1h10.5v2h1v-2H16v-1z"></path><path fill="#000" fill-rule="evenodd" d="M7 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0m-1 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path><path fill="#000" d="M16 19v-3h-3v-1h3v-3h1v3h3v1h-3v3z"></path></svg>'},47626:e=>{"use strict";e.exports=s},59620:e=>{"use strict";e.exports=u},62686:e=>{"use strict";e.exports=i},67386:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=c},79244:e=>{"use strict";e.exports=n},99037:e=>{"use strict";e.exports=r}},t={};function f(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,f),o.exports}f.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return f.d(t,{a:t}),t},f.d=(e,t)=>{for(var a in t)f.o(t,a)&&!f.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.p="";var h={};return f.p=window.jimuConfig.baseUrl,(()=>{"use strict";f.r(h),f.d(h,{__set_webpack_public_path__:()=>Tn,default:()=>Nn});var e,t=f(67386),a=f(79244);!function(e){e.single="SINGLE",e.multiple="MULTIPLE"}(e||(e={}));const n={_widgetLabel:"Add Point Event",addToDominantRouteLabel:"Add event to dominant route",concurrenciesHeaderText:"Choose the concurrent route(s) that you would like to save the event(s) to. The dominant route is shown in blue.",dateRange:"Date Range",toStr:"to",dateToDate:"{fromDate} to {toDate}",nullStr:"null",typeLabel:"Type",eventLayerLabel:"Event",networkLabel:"Network",methodLabel:"Method",routeNameRequiredLabel:"Route Name *",routeIdRequiredLabel:"Route Id *",measureWithUnits:"Measure ({units}) *",startDateRequiredLabel:"Start Date *",endDateLabel:"End Date",nextLabel:"Next",singleOperation:"Single Point",multipleOperation:"Multiple Point",useStartDateLabel:"Use route start date",useEndDateLabel:"Use route end date",routeAndMeasure:"Route and Measure",coordinate:"Coordinate",locationOffset:"Location Offset",backLabel:"Back",saveLabel:"Save",selectAllLabel:"Select All",attributeLabel:"Attribute",valueLabel:"Value",resetForm:"Reset",attributeError:"{fieldValue}: {message}",eventCreated:"Event Created",routeNotFound:"Route not found",invalidFromDateBefore:"From date is before route's from date",invalidFromDateAfter:"From date is after route's to date",invalidToDateBefore:"To date is before route's from date",invalidToDateAfter:"To date is after route's to date",invalidDatesOrder:"Selected from date is greater than selected to date",invalidDatesSameDay:"From and to dates cannot be the same",measureLessError:"Selected measure is less than route's from measure",measureGreaterError:"Selected measure is greater than route's to measure",invalidMeasureError:"Input measure is invalid",noResult:"No results",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Inches",attributeSetLabel:"Attribute Set",invalidContingentValues:"Attribute do not satisfy a required Contingent Value: {groupNames}",contingentValueError:"Invalid contingent value in the field",addMultiplePointEvents:"Add Multiple Point Events"};var o=f(14321),i=f(40643),s=f.n(i),r=f(62686),c=f(47626);function l(){const e=a.hooks.useTranslation(n);return(0,t.jsx)("div",{className:"add-point-event-form-header",children:(0,t.jsx)("div",{className:"add-single-point-event-form-header__header pt-3 px-3 align-items-center",children:(0,t.jsx)("div",{className:"add-single-point-event_title d-flex align-items-center text-truncate",css:a.css`font-weight: 500; font-size: 14px;`,children:(0,t.jsx)("div",{className:"text-truncate",children:e("_widgetLabel")})})})})}const u=function(){this.__data__=[],this.size=0};const d=function(e,t){return e===t||e!=e&&t!=t};const p=function(e,t){for(var a=e.length;a--;)if(d(e[a][0],t))return a;return-1};var m=Array.prototype.splice;const v=function(e){var t=this.__data__,a=p(t,e);return!(a<0)&&(a==t.length-1?t.pop():m.call(t,a,1),--this.size,!0)};const D=function(e){var t=this.__data__,a=p(t,e);return a<0?void 0:t[a][1]};const b=function(e){return p(this.__data__,e)>-1};const g=function(e,t){var a=this.__data__,n=p(a,e);return n<0?(++this.size,a.push([e,t])):a[n][1]=t,this};function y(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var n=e[t];this.set(n[0],n[1])}}y.prototype.clear=u,y.prototype.delete=v,y.prototype.get=D,y.prototype.has=b,y.prototype.set=g;const S=y;const I=function(){this.__data__=new S,this.size=0};const R=function(e){var t=this.__data__,a=t.delete(e);return this.size=t.size,a};const w=function(e){return this.__data__.get(e)};const j=function(e){return this.__data__.has(e)};const k="object"==typeof global&&global&&global.Object===Object&&global;var x="object"==typeof self&&self&&self.Object===Object&&self;const N=k||x||Function("return this")();const T=N.Symbol;var C=Object.prototype,A=C.hasOwnProperty,L=C.toString,M=T?T.toStringTag:void 0;const E=function(e){var t=A.call(e,M),a=e[M];try{e[M]=void 0;var n=!0}catch(e){}var o=L.call(e);return n&&(t?e[M]=a:delete e[M]),o};var O=Object.prototype.toString;const _=function(e){return O.call(e)};var F=T?T.toStringTag:void 0;const P=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":F&&F in Object(e)?E(e):_(e)};const V=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const G=function(e){if(!V(e))return!1;var t=P(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const U=N["__core-js_shared__"];var W,B=(W=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"";const z=function(e){return!!B&&B in e};var q=Function.prototype.toString;const Q=function(e){if(null!=e){try{return q.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Z=/^\[object .+?Constructor\]$/,$=Function.prototype,K=Object.prototype,H=$.toString,J=K.hasOwnProperty,Y=RegExp("^"+H.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const X=function(e){return!(!V(e)||z(e))&&(G(e)?Y:Z).test(Q(e))};const ee=function(e,t){return null==e?void 0:e[t]};const te=function(e,t){var a=ee(e,t);return X(a)?a:void 0};const ae=te(N,"Map");const ne=te(Object,"create");const oe=function(){this.__data__=ne?ne(null):{},this.size=0};const ie=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var se=Object.prototype.hasOwnProperty;const re=function(e){var t=this.__data__;if(ne){var a=t[e];return"__lodash_hash_undefined__"===a?void 0:a}return se.call(t,e)?t[e]:void 0};var ce=Object.prototype.hasOwnProperty;const le=function(e){var t=this.__data__;return ne?void 0!==t[e]:ce.call(t,e)};const ue=function(e,t){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=ne&&void 0===t?"__lodash_hash_undefined__":t,this};function de(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var n=e[t];this.set(n[0],n[1])}}de.prototype.clear=oe,de.prototype.delete=ie,de.prototype.get=re,de.prototype.has=le,de.prototype.set=ue;const fe=de;const he=function(){this.size=0,this.__data__={hash:new fe,map:new(ae||S),string:new fe}};const pe=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const me=function(e,t){var a=e.__data__;return pe(t)?a["string"==typeof t?"string":"hash"]:a.map};const ve=function(e){var t=me(this,e).delete(e);return this.size-=t?1:0,t};const De=function(e){return me(this,e).get(e)};const be=function(e){return me(this,e).has(e)};const ge=function(e,t){var a=me(this,e),n=a.size;return a.set(e,t),this.size+=a.size==n?0:1,this};function ye(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var n=e[t];this.set(n[0],n[1])}}ye.prototype.clear=he,ye.prototype.delete=ve,ye.prototype.get=De,ye.prototype.has=be,ye.prototype.set=ge;const Se=ye;const Ie=function(e,t){var a=this.__data__;if(a instanceof S){var n=a.__data__;if(!ae||n.length<199)return n.push([e,t]),this.size=++a.size,this;a=this.__data__=new Se(n)}return a.set(e,t),this.size=a.size,this};function Re(e){var t=this.__data__=new S(e);this.size=t.size}Re.prototype.clear=I,Re.prototype.delete=R,Re.prototype.get=w,Re.prototype.has=j,Re.prototype.set=Ie;const we=Re;const je=function(e,t){for(var a=-1,n=null==e?0:e.length;++a<n&&!1!==t(e[a],a,e););return e};const ke=function(){try{var e=te(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const xe=function(e,t,a){"__proto__"==t&&ke?ke(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a};var Ne=Object.prototype.hasOwnProperty;const Te=function(e,t,a){var n=e[t];Ne.call(e,t)&&d(n,a)&&(void 0!==a||t in e)||xe(e,t,a)};const Ce=function(e,t,a,n){var o=!a;a||(a={});for(var i=-1,s=t.length;++i<s;){var r=t[i],c=n?n(a[r],e[r],r,a,e):void 0;void 0===c&&(c=e[r]),o?xe(a,r,c):Te(a,r,c)}return a};const Ae=function(e,t){for(var a=-1,n=Array(e);++a<e;)n[a]=t(a);return n};const Le=function(e){return null!=e&&"object"==typeof e};const Me=function(e){return Le(e)&&"[object Arguments]"==P(e)};var Ee=Object.prototype,Oe=Ee.hasOwnProperty,_e=Ee.propertyIsEnumerable,Fe=Me(function(){return arguments}())?Me:function(e){return Le(e)&&Oe.call(e,"callee")&&!_e.call(e,"callee")};const Pe=Fe;const Ve=Array.isArray;const Ge=function(){return!1};var Ue="object"==typeof exports&&exports&&!exports.nodeType&&exports,We=Ue&&"object"==typeof module&&module&&!module.nodeType&&module,Be=We&&We.exports===Ue?N.Buffer:void 0;const ze=(Be?Be.isBuffer:void 0)||Ge;var qe=/^(?:0|[1-9]\d*)$/;const Qe=function(e,t){var a=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==a||"symbol"!=a&&qe.test(e))&&e>-1&&e%1==0&&e<t};const Ze=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var $e={};$e["[object Float32Array]"]=$e["[object Float64Array]"]=$e["[object Int8Array]"]=$e["[object Int16Array]"]=$e["[object Int32Array]"]=$e["[object Uint8Array]"]=$e["[object Uint8ClampedArray]"]=$e["[object Uint16Array]"]=$e["[object Uint32Array]"]=!0,$e["[object Arguments]"]=$e["[object Array]"]=$e["[object ArrayBuffer]"]=$e["[object Boolean]"]=$e["[object DataView]"]=$e["[object Date]"]=$e["[object Error]"]=$e["[object Function]"]=$e["[object Map]"]=$e["[object Number]"]=$e["[object Object]"]=$e["[object RegExp]"]=$e["[object Set]"]=$e["[object String]"]=$e["[object WeakMap]"]=!1;const Ke=function(e){return Le(e)&&Ze(e.length)&&!!$e[P(e)]};const He=function(e){return function(t){return e(t)}};var Je="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ye=Je&&"object"==typeof module&&module&&!module.nodeType&&module,Xe=Ye&&Ye.exports===Je&&k.process;const et=function(){try{var e=Ye&&Ye.require&&Ye.require("util").types;return e||Xe&&Xe.binding&&Xe.binding("util")}catch(e){}}();var tt=et&&et.isTypedArray;const at=tt?He(tt):Ke;var nt=Object.prototype.hasOwnProperty;const ot=function(e,t){var a=Ve(e),n=!a&&Pe(e),o=!a&&!n&&ze(e),i=!a&&!n&&!o&&at(e),s=a||n||o||i,r=s?Ae(e.length,String):[],c=r.length;for(var l in e)!t&&!nt.call(e,l)||s&&("length"==l||o&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Qe(l,c))||r.push(l);return r};var it=Object.prototype;const st=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||it)};const rt=function(e,t){return function(a){return e(t(a))}};const ct=rt(Object.keys,Object);var lt=Object.prototype.hasOwnProperty;const ut=function(e){if(!st(e))return ct(e);var t=[];for(var a in Object(e))lt.call(e,a)&&"constructor"!=a&&t.push(a);return t};const dt=function(e){return null!=e&&Ze(e.length)&&!G(e)};const ft=function(e){return dt(e)?ot(e):ut(e)};const ht=function(e,t){return e&&Ce(t,ft(t),e)};const pt=function(e){var t=[];if(null!=e)for(var a in Object(e))t.push(a);return t};var mt=Object.prototype.hasOwnProperty;const vt=function(e){if(!V(e))return pt(e);var t=st(e),a=[];for(var n in e)("constructor"!=n||!t&&mt.call(e,n))&&a.push(n);return a};const Dt=function(e){return dt(e)?ot(e,!0):vt(e)};const bt=function(e,t){return e&&Ce(t,Dt(t),e)};var gt="object"==typeof exports&&exports&&!exports.nodeType&&exports,yt=gt&&"object"==typeof module&&module&&!module.nodeType&&module,St=yt&&yt.exports===gt?N.Buffer:void 0,It=St?St.allocUnsafe:void 0;const Rt=function(e,t){if(t)return e.slice();var a=e.length,n=It?It(a):new e.constructor(a);return e.copy(n),n};const wt=function(e,t){var a=-1,n=e.length;for(t||(t=Array(n));++a<n;)t[a]=e[a];return t};const jt=function(e,t){for(var a=-1,n=null==e?0:e.length,o=0,i=[];++a<n;){var s=e[a];t(s,a,e)&&(i[o++]=s)}return i};const kt=function(){return[]};var xt=Object.prototype.propertyIsEnumerable,Nt=Object.getOwnPropertySymbols;const Tt=Nt?function(e){return null==e?[]:(e=Object(e),jt(Nt(e),function(t){return xt.call(e,t)}))}:kt;const Ct=function(e,t){return Ce(e,Tt(e),t)};const At=function(e,t){for(var a=-1,n=t.length,o=e.length;++a<n;)e[o+a]=t[a];return e};const Lt=rt(Object.getPrototypeOf,Object);const Mt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)At(t,Tt(e)),e=Lt(e);return t}:kt;const Et=function(e,t){return Ce(e,Mt(e),t)};const Ot=function(e,t,a){var n=t(e);return Ve(e)?n:At(n,a(e))};const _t=function(e){return Ot(e,ft,Tt)};const Ft=function(e){return Ot(e,Dt,Mt)};const Pt=te(N,"DataView");const Vt=te(N,"Promise");const Gt=te(N,"Set");const Ut=te(N,"WeakMap");var Wt="[object Map]",Bt="[object Promise]",zt="[object Set]",qt="[object WeakMap]",Qt="[object DataView]",Zt=Q(Pt),$t=Q(ae),Kt=Q(Vt),Ht=Q(Gt),Jt=Q(Ut),Yt=P;(Pt&&Yt(new Pt(new ArrayBuffer(1)))!=Qt||ae&&Yt(new ae)!=Wt||Vt&&Yt(Vt.resolve())!=Bt||Gt&&Yt(new Gt)!=zt||Ut&&Yt(new Ut)!=qt)&&(Yt=function(e){var t=P(e),a="[object Object]"==t?e.constructor:void 0,n=a?Q(a):"";if(n)switch(n){case Zt:return Qt;case $t:return Wt;case Kt:return Bt;case Ht:return zt;case Jt:return qt}return t});const Xt=Yt;var ea=Object.prototype.hasOwnProperty;const ta=function(e){var t=e.length,a=new e.constructor(t);return t&&"string"==typeof e[0]&&ea.call(e,"index")&&(a.index=e.index,a.input=e.input),a};const aa=N.Uint8Array;const na=function(e){var t=new e.constructor(e.byteLength);return new aa(t).set(new aa(e)),t};const oa=function(e,t){var a=t?na(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)};var ia=/\w*$/;const sa=function(e){var t=new e.constructor(e.source,ia.exec(e));return t.lastIndex=e.lastIndex,t};var ra=T?T.prototype:void 0,ca=ra?ra.valueOf:void 0;const la=function(e){return ca?Object(ca.call(e)):{}};const ua=function(e,t){var a=t?na(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)};const da=function(e,t,a){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return na(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return oa(e,a);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ua(e,a);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return sa(e);case"[object Symbol]":return la(e)}};var fa=Object.create;const ha=function(){function e(){}return function(t){if(!V(t))return{};if(fa)return fa(t);e.prototype=t;var a=new e;return e.prototype=void 0,a}}();const pa=function(e){return"function"!=typeof e.constructor||st(e)?{}:ha(Lt(e))};const ma=function(e){return Le(e)&&"[object Map]"==Xt(e)};var va=et&&et.isMap;const Da=va?He(va):ma;const ba=function(e){return Le(e)&&"[object Set]"==Xt(e)};var ga=et&&et.isSet;const ya=ga?He(ga):ba;var Sa="[object Arguments]",Ia="[object Function]",Ra="[object Object]",wa={};wa[Sa]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa[Ra]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa[Ia]=wa["[object WeakMap]"]=!1;const ja=function e(t,a,n,o,i,s){var r,c=1&a,l=2&a,u=4&a;if(n&&(r=i?n(t,o,i,s):n(t)),void 0!==r)return r;if(!V(t))return t;var d=Ve(t);if(d){if(r=ta(t),!c)return wt(t,r)}else{var f=Xt(t),h=f==Ia||"[object GeneratorFunction]"==f;if(ze(t))return Rt(t,c);if(f==Ra||f==Sa||h&&!i){if(r=l||h?{}:pa(t),!c)return l?Et(t,bt(r,t)):Ct(t,ht(r,t))}else{if(!wa[f])return i?t:{};r=da(t,f,c)}}s||(s=new we);var p=s.get(t);if(p)return p;s.set(t,r),ya(t)?t.forEach(function(o){r.add(e(o,a,n,o,t,s))}):Da(t)&&t.forEach(function(o,i){r.set(i,e(o,a,n,i,t,s))});var m=d?void 0:(u?l?Ft:_t:l?Dt:ft)(t);return je(m||t,function(o,i){m&&(o=t[i=o]),Te(r,i,e(o,a,n,i,t,s))}),r};const ka=function(e){return ja(e,5)};var xa=function(e,t,a,n){return new(a||(a=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}c((n=n.apply(e,t||[])).next())})};let Na=[];function Ta(e){var i;const s=a.hooks.useTranslation(n),{intl:r,widgetId:l,networkDS:u,network:d,eventDS:f,eventLayer:h,routeInfo:p,reset:m,jimuMapView:v,hoverGraphic:D,conflictPreventionEnabled:b,onNavBack:g,hasConcurrencies:y,addToDominantRoute:S,concurrenciesResponse:I}=e,[R,w]=a.React.useState(),[j,k]=a.React.useState(!1),[x,N]=a.React.useState(),[T,C]=a.React.useState(""),[A,L]=a.React.useState(!1),[M,E]=a.React.useState(!1),[O,_]=a.React.useState(),{sessionId:F,startEditSession:P,addEdit:V}=(0,c.useVmsManager)(),{supportsEditSession:G}=(0,c.useEditSession)();a.React.useEffect(()=>{m&&w(U())},[m]),a.React.useEffect(()=>{w(U())},[f,h]),a.React.useEffect(()=>{if(b){const e=Object.assign({},O);(0,c.isDefined)(d)&&(e.networkId=[d.networkInfo.lrsNetworkId]),(0,c.isDefined)(h)&&(e.eventServiceLayerIds=[h.serviceId]),(0,c.isDefined)(p)&&(e.routeInfo=p,e.routeOrLineId=[]),_(e)}},[u,d,h,p]);const U=()=>{const e=[];if((0,c.isDefined)(h)&&(0,c.isDefined)(f)&&(0,c.isDefined)(h.eventInfo)&&(0,c.isDefined)(h.eventInfo.attributeFields)){const t=f,a=(null==t?void 0:t.layer).fields;h.eventInfo.attributeFields.forEach(t=>{if(t.enabled){const n=a.find(e=>e.name===t.field.name);if(n){let a;a=(0,c.isDate)(n.type)?(0,c.isDefined)(n.defaultValue)?new Date(n.defaultValue):null:n.defaultValue;const o={index:e.length,name:n.name,alias:n.alias,type:n.type,hasDomain:(0,c.isDefined)(n.domain),value:a,error:"",nullable:n.nullable,default:"number"==typeof a?Number(a).toString():a,length:n.length,editable:t.editable};e.push(o)}}})}return e},W=e=>e.findIndex(e=>e.error.length>0)>-1,B=(e,t)=>{const a=ka(e);w(a),L(W(a))},z=(e,t,a)=>{g(e,!e&&t,a)},q=(e,t,a,n)=>{const o={},i=h.eventInfo.eventIdFieldName;o[i]="{"+(0,c.getUUID)()+"}";const s=h.eventInfo.routeIdFieldName;o[s]=t.routeId;const r=h.eventInfo.fromMeasureFieldName;o[r]=t.fromMeasure;const l=h.eventInfo.fromDateFieldName;if(!a&&(0,c.isDefined)(t.fromDate)){const e=(0,c.getDateWithoutTZOffset)(t.fromDate.valueOf(),u);o[l]=(0,c.getDateToUTC)(e)}else o[l]=t.fromDate;const d=h.eventInfo.toDateFieldName;if(!n&&(0,c.isDefined)(t.toDate)){const e=(0,c.getDateWithoutTZOffset)(t.toDate.valueOf(),u);o[d]=(0,c.getDateToUTC)(e)}else o[d]=t.toDate;R.forEach(e=>{const t=e.name;if((0,c.isDefined)(e.value)&&(0,c.isDate)(e.type)){const a=(0,c.getDateWithoutTZOffset)(e.value.valueOf(),u);o[t]=(0,c.getDateToUTC)(a)}else(0,c.isNumber)(e.type)?!(0,c.isDefined)(e.value)||""===e.value||isNaN(Number(e.value))?o[t]=null:o[t]=Number(e.value):o[t]=e.value});const f={attributes:o};e.push(f)},Q=e=>xa(this,void 0,void 0,function*(){const t=f,n=t.getPopupInfo(),o=t.getLayerDefinition(),i=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==o?void 0:o.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==n?void 0:n.fieldInfos)||[]).filter(e=>e.visible));let s=null;yield(0,a.loadArcGISJSAPIModules)(["esri/Graphic"]).then(e=>{[s]=e}).then(()=>{const a=new s({geometry:e.edits[0].adds[0].geometry,attributes:e.edits[0].adds[0].attributes}),n=t.buildRecord(a);t.afterAddRecord(n)}),t.updateQueryParams({returnGeometry:!0},l);const r=new a.DataRecordSetChangeMessage(l,a.RecordSetChangeType.CreateUpdate,[{records:t.getRecords(),fields:i.map(e=>e.fieldName),dataSource:t,name:t.id}]);a.MessageManager.getInstance().publishMessage(r)}),Z=e=>xa(this,void 0,void 0,function*(){var t;const a={edits:[]};if((()=>{const e=ka(R);let t=!1;return e.forEach((a,n)=>{let o;if(o=a.hasDomain?(0,c.validateRangeDomain)(a.value,a.name,f):((0,c.isDate)(a.type),(0,c.validateField)(a.value,a.name,f)),(0,c.isDefined)(Na)){let t=[];const i=(0,c.validateContingencyConstraints)(a.value,"",n,e,Na);(null==i?void 0:i.length)>0&&(i.forEach(e=>{var a;const n=null===(a=null==e?void 0:e.fieldGroup)||void 0===a?void 0:a.fields;t.push(n)}),t=t.flat(),t.includes(a.name)&&(E(!0),o={hasError:!0,message:"contingentValueError"}))}if(o.hasError){let e;if("contingentValueError"===o.message){const t=[];Na.forEach(e=>{t.push(e.name)});let a=s("invalidContingentValues");a=a.replace("{groupNames}",t.join(",")),e=a}else{const t=h.useFieldAlias?a.alias:a.name;e=s("attributeError",{fieldValue:t,message:s(o.message)})}N("error"),C(e),k(!0),setTimeout(()=>{k(!1)},5e3),t=!0,a.error=s(o.message)}}),t&&B(e),t})())return;const n=f,o=[];if((0,c.isDefined)(h)){if((0,c.isDefined)(I)&&I.locations.length>0)null===(t=I.locations)||void 0===t||t.forEach(e=>{var t;if(0===e.concurrencies.length){const t={routeId:e.routeId,fromMeasure:e.fromMeasure,fromDate:(0,c.getDateWithRouteTime)(p.selectedFromDate,p.fromDate),toDate:(0,c.getDateWithRouteTime)(p.selectedToDate,p.toDate)};q(o,t,!1,!1)}else null===(t=e.concurrencies)||void 0===t||t.forEach(e=>{if(e.isChosen){const t={routeId:e.routeId,fromMeasure:e.fromMeasure,fromDate:e.fromDate,toDate:e.toDate},a=!(0,c.isDefined)(p.selectedFromDate)||e.fromDate.valueOf()!==p.selectedFromDate.valueOf(),n=!(0,c.isDefined)(p.selectedToDate)||e.toDate.valueOf()!==p.selectedToDate.valueOf();q(o,t,a,n)}})});else{const e={routeId:p.routeId,fromMeasure:p.selectedMeasure,fromDate:(0,c.getDateWithRouteTime)(p.selectedFromDate,p.fromDate),toDate:(0,c.getDateWithRouteTime)(p.selectedToDate,p.toDate)};q(o,e,!1,!1)}(0,c.isDefined)(p.selectedPoint.spatialReference.wkid)||(p.selectedPoint.spatialReference.wkid=v.view.spatialReference.wkid);const e={id:h.serviceId,adds:o,allowMerge:!1,retireMeasureOverlap:!1,retireByEventId:!1};a.edits.push(e)}if(G){const e=yield P();if(!e.success)return N("error"),C(e.error),k(!0),void setTimeout(()=>{k(!1)},5e3)}yield(0,c.LrsApplyEdits)(n,h,F,a,null,null).then(t=>{t.success?(G&&V(t,s("_widgetLabel")),N("success"),C(s("eventCreated")),k(!0),Q(a),setTimeout(()=>xa(this,void 0,void 0,function*(){if(k(!1),b&&(0,c.isDefined)(e)){yield(0,c.tryReleaseLockOnDefault)(u,e);const t=Object.assign(Object.assign({},O),{lockAction:c.LockAction.Clear});_(t)}else z(!0,!1,S)}),5e3)):(N("error"),C(`${t.message} \n ${t.details}`),k(!0),setTimeout(()=>{k(!1)},5e3))})});return(0,t.jsxs)("div",{className:"h-100",css:a.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-point-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-point-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-point-event-edit-attributes__action {
      height: auto;
    }
    .add-point-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsxs)("div",{className:"add-point-event-edit-attributes__content",children:[b&&(0,t.jsx)(c.LockManagerComponent,{intl:r,featureDS:u,lockInfo:O,showAlert:!0,networkName:null===(i=null==d?void 0:d.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:b,onQueryAndAcquireComplete:(e,t,a)=>{_(e),a&&Z(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},O),{lockAction:c.LockAction.None});_(e),z(!0,!1,S)}}),(0,t.jsx)("div",{className:"attribute-picker d-flex w-100 px-3",children:(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(c.CopyAttributeTool,{disabled:!1,networkDs:u,eventDataSources:[f],jimuMapView:v,hoverGraphic:D,onAttributesCopied:e=>{const t=ka(R);e.forEach(e=>{e.layerId===h.serviceId.toString()&&e.fieldValuePair.forEach(e=>{const a=t.findIndex(t=>t.name===e.name);if(a>-1){let n=e.value;(0,c.isDate)(t[a].type)&&(n=(0,c.isDefined)(e.value)?new Date(e.value):null),t[a].value=n}})}),w(t)}})})}),(0,t.jsxs)("div",{className:"h-100",children:[M&&(0,t.jsx)(o.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){E(!1)},open:M,text:T,type:"warning",closable:!0,withIcon:!0}),(0,t.jsx)(c.AttributeTable,{tableIndex:0,eventDS:f,eventLayer:h,fieldInfos:R,collapable:!1,useAlias:!(0,c.isDefined)(h)||h.useFieldAlias,onUpdateItem:(e,t,a,n)=>{const o=ka(R);o[a].value=e,o[a].error=t,w(o),L(W(o))},onUpdateAll:B,isReset:m,onFieldGrpUpdated:(e,t)=>{Na=e,Na&&0!==(null==Na?void 0:Na.length)||E(!1)}})]}),j&&(0,t.jsx)("div",{className:"add-point-event-edit-attributes__toast-container px-3 w-100",children:(0,t.jsx)(o.Alert,{className:"add-point-event-edit-attributes__toast w-100",type:x,text:T,closable:!0,withIcon:!0,open:j,onClose:()=>{k(!1)}})})]}),(0,t.jsx)("div",{className:"add-point-attributes-footer w-100",children:(0,t.jsxs)("div",{className:"add-point-event-edit-attributes__action w-100 d-flex",children:[(0,t.jsx)("div",{className:"mt-auto mr-auto",children:(0,t.jsx)(o.Button,{"aria-label":s("backLabel"),size:"sm",type:"secondary",onClick:()=>{z(!1,y,S)},children:s("backLabel")})}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(o.Button,{type:"primary",className:"active","aria-label":s("saveLabel"),size:"sm",disabled:A||M,onClick:()=>{var e;if(b){const t=Object.assign(Object.assign({},O),{lockAction:c.LockAction.QueryAndAcquire});(0,c.isDefined)(I)&&(t.isLine=[],t.routeOrLineId=[],t.eventServiceLayerIds=[],null===(e=null==I?void 0:I.locations)||void 0===e||e.forEach(e=>{var a;null===(a=null==e?void 0:e.concurrencies)||void 0===a||a.forEach(e=>{e.isChosen&&(t.isLine.push(d.networkInfo.supportsLines),t.routeOrLineId.push(d.networkInfo.supportsLines?e.lineId:e.routeId),t.eventServiceLayerIds.push(h.serviceId))})})),_(t)}else Z()},children:s("saveLabel")})})]})})]})}function Ca(e){var i;const s=a.hooks.useTranslation(n),{intl:r,networkDS:l,network:u,routeInfo:d,reset:f,conflictPreventionEnabled:h,onNavBack:p,onNavNext:m,concurrenciesResponse:v,onConcurrenciesResponseUpdated:D,onResetClicked:b,eventLayer:g,dateRanges:y}=e,[S,I]=a.React.useState(null),[R,w]=a.React.useState();a.React.useEffect(()=>{(null==y?void 0:y.length)>0&&I(y[0])},[y]);const j=a.React.useCallback(e=>{var t;(0,c.isDefined)(e)&&(null===(t=null==e?void 0:e.locations)||void 0===t||t.forEach(e=>{var t;null===(t=e.concurrencies)||void 0===t||t.forEach(e=>{e.isChosen=e.isDominant})}),D(e),b(!0))},[]);a.React.useEffect(()=>{if(h){const e=Object.assign({},R);(0,c.isDefined)(u)&&(e.networkId=[u.networkInfo.lrsNetworkId]),(0,c.isDefined)(g)&&(e.eventServiceLayerIds=[g.serviceId]),(0,c.isDefined)(d)&&(e.routeInfo=d,e.routeOrLineId=[]),w(e)}},[l,u,g,d]);const k=e=>{for(let t=0;t<v.locations.length;t++){const a=v.locations[t];if(a.routeId===e.routeId&&a.fromMeasure===e.fromMeasure){v.locations[t]=e;break}}D(v)};return(0,t.jsxs)("div",{className:"h-100",css:a.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-point-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-point-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-point-event-edit-attributes__action {
      height: auto;
    }
    .add-point-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsxs)("div",{className:"add-point-event-edit-attributes__content",children:[h&&(0,t.jsx)(c.LockManagerComponent,{intl:r,featureDS:l,lockInfo:R,showAlert:!0,networkName:null===(i=null==u?void 0:u.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:h,onQueryAndAcquireComplete:(e,t,a)=>{w(e),a&&m(d)},onMessageClear:()=>{const e=Object.assign(Object.assign({},R),{lockAction:c.LockAction.None});w(e)}}),(0,t.jsxs)("div",{className:"reset px-3",children:[(0,t.jsx)("hr",{css:a.css`
                border: none;
                height: 1px;
                background-color: var(--ref-palette-neutral-400);
              `}),(0,t.jsx)("div",{children:s("concurrenciesHeaderText")}),(0,t.jsx)("hr",{css:a.css`
                border: none;
                height: 1px;
                background-color: var(--ref-palette-neutral-400);
              `}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(o.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",float:"right",textAlign:"right",color:"var(--sys-color-primary-main)"},onClick:()=>{j(v)},children:s("resetForm")})})]}),(0,t.jsxs)("div",{className:"h-100",children:[(0,t.jsxs)("div",{className:"time-range px-3",children:[(0,t.jsx)("div",{children:(0,t.jsx)(o.Label,{size:"sm",centric:!0,className:"text-truncate mb-0 pt-2 w-100",style:{textOverflow:"ellipsis",fontWeight:500},children:s("dateRange")})}),(0,t.jsx)("div",{children:(0,t.jsx)(o.Select,{size:"sm",value:S,onChange:e=>{(e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;I(a)})(e)},disabled:(null==y?void 0:y.length)<2,children:null==y?void 0:y.map((e,a)=>(0,t.jsxs)(Option,{title:s("dateToDate",{fromDate:(0,c.isDefined)(e.fromDate)?(0,c.getDateWithTZOffset)(e.fromDate,l).toLocaleDateString():s("nullStr"),toDate:(0,c.isDefined)(e.toDate)?(0,c.getDateWithTZOffset)(e.toDate,l).toLocaleDateString():s("nullStr")}),value:e,children:[(0,t.jsx)("span",{children:(0,c.isDefined)(e.fromDate)?(0,c.getDateWithTZOffset)(e.fromDate,l).toLocaleDateString():s("nullStr")}),(0,t.jsx)("span",{style:{paddingLeft:"0.3rem",paddingRight:"0.3rem"},children:s("toStr")}),(0,t.jsx)("span",{children:(0,c.isDefined)(e.toDate)?(0,c.getDateWithTZOffset)(e.toDate,l).toLocaleDateString():s("nullStr")})]},a))})})]}),(0,c.isDefined)(v)&&(null==v?void 0:v.locations.length)>0&&(null==v?void 0:v.locations.map((e,a)=>(null==v?void 0:v.locations[a].concurrencies.length)>0?e.concurrencies.map((e,n)=>(!(0,c.isDefined)(e.fromDate)||(0,c.isDefined)(null==S?void 0:S.fromDate)&&e.fromDate<=(null==S?void 0:S.fromDate))&&(!(0,c.isDefined)(e.toDate)||(0,c.isDefined)(null==S?void 0:S.toDate)&&(null==S?void 0:S.toDate)<=e.toDate)&&e.routeId===(null==v?void 0:v.locations[a].routeId)?(0,t.jsx)("div",{children:(0,t.jsx)(c.PointConcurrencyTable,{intl:r,network:null==u?void 0:u.networkInfo,isReset:f,concurrenciesLocation:null==v?void 0:v.locations[a],concurrenciesDateRange:S,locationConcurrency:e,onConcurrenciesLocationUpdated:k},n)},n):""):""))]})]}),(0,t.jsx)("div",{className:"add-point-attributes-footer w-100",children:(0,t.jsxs)("div",{className:"add-point-event-edit-attributes__action w-100 d-flex",children:[(0,t.jsx)("div",{className:"mt-auto mr-auto",children:(0,t.jsx)(o.Button,{"aria-label":s("backLabel"),size:"sm",type:"secondary",onClick:()=>{(e=>{p(e)})(!1)},children:s("backLabel")})}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(o.Button,{type:"primary",className:"active","aria-label":s("nextLabel"),size:"sm",onClick:()=>{var e;if(h){const t=Object.assign(Object.assign({},R),{lockAction:c.LockAction.QueryAndAcquire});(0,c.isDefined)(v)&&(t.isLine=[],t.routeOrLineId=[],t.eventServiceLayerIds=[],null===(e=null==v?void 0:v.locations)||void 0===e||e.forEach(e=>{var a;null===(a=null==e?void 0:e.concurrencies)||void 0===a||a.forEach(e=>{e.isChosen&&(t.isLine.push(u.networkInfo.supportsLines),t.routeOrLineId.push(u.networkInfo.supportsLines?e.lineId:e.routeId),t.eventServiceLayerIds.push(g.serviceId))})})),w(t)}else m(d)},children:s("nextLabel")})})]})})]})}function Aa(e){const{network:n,event:o,dataSourcesReady:i,onCreateNetworkDs:s,onCreateEventDs:r}=e,[c,l]=a.React.useState(null!=n?n:null),[u,d]=a.React.useState(null!=o?o:null),[f,h]=a.React.useState(!1),[p,m]=a.React.useState(!1);a.React.useEffect(()=>{n&&l(n)},[n]),a.React.useEffect(()=>{o&&d(o)},[o]),a.React.useEffect(()=>{i(f&&p)},[i,p,f]);const v=a.React.useCallback(e=>{s(e)},[s]),D=a.React.useCallback(e=>{r(e)},[r]),b=a.React.useCallback(e=>{if(e){const{status:t,instanceStatus:n}=e;n===a.DataSourceStatus.NotCreated||n===a.DataSourceStatus.CreateError||t===a.DataSourceStatus.LoadError||t===a.DataSourceStatus.NotReady?h(!1):h(!0)}},[h]),g=a.React.useCallback(e=>{if(e){const{status:t,instanceStatus:n}=e;n===a.DataSourceStatus.NotCreated||n===a.DataSourceStatus.CreateError||t===a.DataSourceStatus.LoadError||t===a.DataSourceStatus.NotReady?m(!1):m(!0)}},[m]),y=a.React.useCallback(()=>{h(!1)},[h]),S=a.React.useCallback(()=>{m(!1)},[m]);return(0,t.jsxs)("div",{children:[c&&(0,t.jsx)(a.DataSourceComponent,{useDataSource:c.useDataSource,onDataSourceInfoChange:()=>b,onCreateDataSourceFailed:y,onDataSourceCreated:v}),u&&(0,t.jsx)(a.DataSourceComponent,{useDataSource:u.useDataSource,onDataSourceInfoChange:g,onCreateDataSourceFailed:S,onDataSourceCreated:D})]})}const La=function(){return N.Date.now()};var Ma=/\s/;const Ea=function(e){for(var t=e.length;t--&&Ma.test(e.charAt(t)););return t};var Oa=/^\s+/;const _a=function(e){return e?e.slice(0,Ea(e)+1).replace(Oa,""):e};const Fa=function(e){return"symbol"==typeof e||Le(e)&&"[object Symbol]"==P(e)};var Pa=/^[-+]0x[0-9a-f]+$/i,Va=/^0b[01]+$/i,Ga=/^0o[0-7]+$/i,Ua=parseInt;const Wa=function(e){if("number"==typeof e)return e;if(Fa(e))return NaN;if(V(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=V(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=_a(e);var a=Va.test(e);return a||Ga.test(e)?Ua(e.slice(2),a?2:8):Pa.test(e)?NaN:+e};var Ba=Math.max,za=Math.min;const qa=function(e,t,a){var n,o,i,s,r,c,l=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var a=n,i=o;return n=o=void 0,l=t,s=e.apply(i,a)}function p(e){var a=e-c;return void 0===c||a>=t||a<0||d&&e-l>=i}function m(){var e=La();if(p(e))return v(e);r=setTimeout(m,function(e){var a=t-(e-c);return d?za(a,i-(e-l)):a}(e))}function v(e){return r=void 0,f&&n?h(e):(n=o=void 0,s)}function D(){var e=La(),a=p(e);if(n=arguments,o=this,c=e,a){if(void 0===r)return function(e){return l=e,r=setTimeout(m,t),u?h(e):s}(c);if(d)return clearTimeout(r),r=setTimeout(m,t),h(c)}return void 0===r&&(r=setTimeout(m,t)),s}return t=Wa(t)||0,V(a)&&(u=!!a.leading,i=(d="maxWait"in a)?Ba(Wa(a.maxWait)||0,t):i,f="trailing"in a?!!a.trailing:f),D.cancel=function(){void 0!==r&&clearTimeout(r),l=0,n=c=o=r=void 0},D.flush=function(){return void 0===r?s:v(La())},D};var Qa=1/0;const Za=function(e){return e?(e=Wa(e))===Qa||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const $a=function(e){var t=Za(e),a=t%1;return t==t?a?t-a:t:0};const Ka=function(e,t){for(var a=-1,n=null==e?0:e.length,o=Array(n);++a<n;)o[a]=t(e[a],a,e);return o};var Ha=T?T.prototype:void 0,Ja=Ha?Ha.toString:void 0;const Ya=function e(t){if("string"==typeof t)return t;if(Ve(t))return Ka(t,e)+"";if(Fa(t))return Ja?Ja.call(t):"";var a=t+"";return"0"==a&&1/t==-1/0?"-0":a};const Xa=function(e){return null==e?"":Ya(e)};var en=N.isFinite,tn=Math.min;const an=function(e){var t=Math[e];return function(e,a){if(e=Wa(e),(a=null==a?0:tn($a(a),292))&&en(e)){var n=(Xa(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+a));return+((n=(Xa(o)+"e").split("e"))[0]+"e"+(+n[1]-a))}return t(e)}}("round");var nn=function(e,t,a,n){return new(a||(a=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}c((n=n.apply(e,t||[])).next())})};function on(e){const i=a.hooks.useTranslation(n),{intl:s,widgetId:r,isReady:l,network:u,networkDS:d,routeInfo:f,jimuMapView:h,hoverGraphic:p,reset:m,routeInfoFromDataAction:v,revalidateRouteFromDataAction:D,onResetDataAction:b,clearPickedGraphic:g,onRouteInfoUpdated:y}=e,[S,I]=a.React.useState(!1),[R,w]=a.React.useState(!1),[j,k]=a.React.useState(""),[x,N]=a.React.useState(!1),[T,C]=a.React.useState([]),[A,L]=a.React.useState(),M=a.React.useRef(null),E=a.React.useRef(e=>{}),O=a.React.useRef(null),_=a.React.useRef(null),F=a.React.useRef(null),P=a.React.useRef(null),V=a.React.useRef(null),G=a.React.useRef(!1),U=a.React.useRef(!1),[W,B]=a.React.useState(null),[z,q]=a.React.useState(!1),[Q,Z]=a.React.useState([]);a.React.useEffect(()=>{E.current=qa($,400)},[]),a.React.useEffect(()=>{m&&ee()},[m]);const $=a.hooks.useEventCallback(e=>{const t=u.useRouteName?u.routeNameFieldSchema.jimuName:u.routeIdFieldSchema.jimuName,a=(0,c.getSuggestions)(t,e,d);Promise.all([a]).then(e=>{const t=null==e?void 0:e[0];t&&Z(t),O.current&&q(!0)})}),K=e=>{B(e),O.current=e},H=()=>{(0,a.focusElementInKeyboardMode)(_.current),J(!0,!1)},J=(e=!1,t=!0)=>{e||(U.current=!1)};a.React.useEffect(()=>{D&&u&&(K(u.useRouteName?v.routeName:v.routeId),isNaN(v.selectedMeasure)||k(v.selectedMeasure.toString()),y(v),ee(),b())},[D]),a.React.useEffect(()=>{(0,c.isDefined)(u)&&(B(""),k(""),I(!1),w(!1),g())},[u]),a.React.useEffect(()=>{(0,c.isDefined)(h)&&L(null==h?void 0:h.view.popupEnabled)},[h]),a.React.useEffect(()=>{(0,c.isDefined)(u)&&u.useRouteName?B(f.routeName):B(f.routeId),isNaN(f.selectedMeasure)?k(""):k(f.selectedMeasure.toString())},[u,f]),a.React.useEffect(()=>{isNaN(f.selectedMeasure)?k(""):k(f.selectedMeasure.toString())},[u,f.selectedMeasure]);const Y=(e,t)=>nn(this,void 0,void 0,function*(){const t=(0,c.getNetworkOutFields)(u),a=u.useRouteName?e.attributes[t.routeNameFieldName]:"",n=e.attributes[t.routeIdFieldName],o=e.attributes[t.fromDateFieldName],i=e.attributes[t.toDateFieldName],s=e.geometry,r=(0,c.getRouteFromEndMeasures)(s),l=e.attributes[t.lineIdFieldName],h=e.attributes[t.lineNameFieldName];let p=new Date(Date.now());(0,c.isDefined)(i)&&p>i?p=(0,c.getDateWithTZOffset)(o,d):p.setHours(0,0,0,0);let m=new Date(Date.now());return(0,c.isDefined)(i)&&m>i?m=(0,c.getDateWithTZOffset)(i,d):m.setHours(0,0,0,0),(0,c.isDefined)(i)||(m=null),yield(0,c.QueryRouteMeasures)(d,u,r,o,n).then(e=>{const t=Math.min(...e),r=Math.max(...e);return Object.assign(Object.assign({},f),{routeName:a,routeId:n,fromDate:(0,c.isDefined)(o)?(0,c.getDateWithTZOffset)(o,d):null,toDate:(0,c.isDefined)(i)?(0,c.getDateWithTZOffset)(i,d):null,selectedPolyline:s,fromMeasure:an(t,u.measurePrecision),toMeasure:an(r,u.measurePrecision),validRoute:!0,selectedFromDate:p,selectedToDate:m,lineName:h,lineId:l})})}),X=(e,t)=>(0,c.QueryMeasureOnRoute)(d,u,e.routeId,e.fromDate,j).then(a=>{if(a){return Object.assign(Object.assign({},e),{selectedPoint:a,selectedMeasure:parseFloat(t?e.selectedMeasure.toString():j)})}return Object.assign(Object.assign({},e),{selectedPoint:null})}),ee=()=>{setTimeout(()=>{_.current&&(_.current.select(),(0,a.focusElementInKeyboardMode)(_.current),_.current.blur()),F.current&&(F.current.select(),(0,a.focusElementInKeyboardMode)(F.current),F.current.blur())},200)},te=a.React.useCallback((e,t=!1)=>{y(e,t),V.current=null,ee()},[y]),ae=e=>{k(e)},ne=a.React.useCallback(e=>{e.length&&(N(!0),C(e))},[]),oe=a.React.useCallback(e=>{(0,c.isDefined)(e)&&(e.selectedFromDate=e.fromDate,e.selectedToDate=e.toDate,y(e,!0),ee()),N(!1)},[y]),ie=a.React.useCallback(()=>{N(!1)},[]);return(0,t.jsx)("div",{className:"route-and-measure-form d-flex w-100 px-3",children:u&&(0,t.jsxs)("div",{className:"w-100",children:[(0,t.jsx)(o.Label,{size:"sm",className:"w-100 mb-0 pt-3 title3",centric:!0,style:{width:100},children:u.useRouteName?i("routeNameRequiredLabel"):i("routeIdRequiredLabel")}),(0,t.jsxs)("div",{ref:M,className:"d-flex w-100",children:[(0,t.jsx)(o.TextInput,{"aria-label":u.useRouteName?i("routeNameRequiredLabel"):i("routeIdRequiredLabel"),type:"text",className:"w-100",size:"sm",allowClear:!0,disabled:!l,onBlur:()=>{P.current=setTimeout(()=>{G.current||q(!1),U.current||J(!1)},200)},value:W||"",ref:_,onChange:e=>{var t;V.current=null;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==a?void 0:a.length)>2;if(K(a),!n)return q(!1),!1;E.current(a)},checkValidityOnAccept:(e,t=!1)=>new Promise(a=>{setTimeout(()=>{V.current&&(e=V.current);const n=[],o=(0,c.queryRouteIdOrName)(e,u,d).then(a=>nn(this,void 0,void 0,function*(){if((0,c.isDefined)(a)){if(!t&&(m||e===f.routeId||e===f.routeName))return{valid:!0};if(yield Promise.all(a.features.map(t=>nn(this,void 0,void 0,function*(){const a=Y(t,e);n.push(yield a)}))),n.length>1&&!t)ne(n);else{if(j.length>0||t&&!isNaN(f.selectedMeasure))return X(n[0],t).then(e=>(y(e,!0),{valid:!0}));y(n[0],!0)}return{valid:!0}}})).catch(t=>{if(u.useRouteName){const t=Object.assign(Object.assign({},f),{routeName:e,validRoute:!1});y(t)}else{const t=Object.assign(Object.assign({},f),{routeId:e,validRoute:!1});y(t)}if(e.length){return{valid:!1,msg:"Route '"+e.replace(/ /g,"\xa0")+"' not found"}}return{valid:!0}});a(o)},200)})}),W&&(0,t.jsx)(c.Intellisense,{isOpen:(z||(G.current=!1),z),reference:M,searchText:W,searchSuggestion:Q,onRecordItemClick:(e,t)=>{if(t)return H(),!1;V.current=e,K(e)},id:r,searchInputRef:_}),(0,t.jsx)(c.RoutePicker,{type:"route-measure",active:S,networkDs:d,network:u,routeInfo:f,disabled:!l,jimuMapView:h,symbolColor:null,hoverGraphic:p,isFrom:!0,onActiveChange:()=>{const e=!S;I(e),e?(w(!1),h.view.popupEnabled=!1):setTimeout(()=>{h.view.popupEnabled=A&&!R},800)},onRouteInfoUpdated:te,onMultiRouteSelect:ne})]}),(0,t.jsx)(o.Label,{size:"sm",className:"w-100 mb-0 pt-3 title3",centric:!0,style:{width:100},children:i("measureWithUnits",{units:(0,c.GetUnits)(u.unitsOfMeasure,s)})}),(0,t.jsxs)("div",{className:"d-flex w-100",children:[(0,t.jsx)(o.TextInput,{ref:F,"aria-label":i("measureWithUnits",{units:(0,c.GetUnits)(u.unitsOfMeasure,s)}),className:"w-100",size:"sm",value:j,disabled:!l,onChange:e=>{ae(e.target.value)},checkValidityOnAccept:e=>nn(this,void 0,void 0,function*(){let t=NaN;if(""===e){t=NaN;const e=Object.assign(Object.assign({},f),{selectedMeasure:NaN,selectedPoint:null});return y(e),ae(""),{valid:!0}}if(t=isNaN(Number(e))?(0,c.convertStationToNumber)(e):Number(e),isNaN(t)){g();const e=Object.assign(Object.assign({},f),{selectedMeasure:NaN,selectedPoint:null});return y(e),ae(""),{valid:!0}}if((0,c.isDefined)(f.selectedPolyline)){t=an(t,u.measurePrecision);let e=Object.assign(Object.assign({},f),{selectedMeasure:t});if(t<f.fromMeasure)return y(e),{valid:!1,msg:i("measureLessError")};if(t>f.toMeasure)return y(e),{valid:!1,msg:i("measureGreaterError")};if((0,c.isDefined)(f.selectedPoint)&&!isNaN(f.selectedMeasure)&&t===f.selectedMeasure)return{valid:!0};e.routeId.length?yield(0,c.QueryMeasureOnRoute)(d,u,e.routeId,e.fromDate,t.toString()).then(t=>{(0,c.isDefined)(t)&&(e=Object.assign(Object.assign({},e),{selectedPoint:t}),y(e))}):y(e)}return{valid:!0}})}),(0,t.jsx)(c.RoutePicker,{type:"measure",active:R,networkDs:d,network:u,routeInfo:f,disabled:!l,jimuMapView:h,symbolColor:null,hoverGraphic:p,isFrom:!0,onActiveChange:()=>{const e=!R;w(e),e?(I(!1),h.view.popupEnabled=!1):setTimeout(()=>{h.view.popupEnabled=A&&!S},800)},onRouteInfoUpdated:te,onMultiRouteSelect:ne})]}),(0,t.jsx)(c.RoutePickerPopup,{isOpen:x,routeInfos:T,useRouteName:u.useRouteName,onRouteSelect:oe,onRouteSelectCancel:ie,measurePrecision:u.measurePrecision,isFrom:!0,jimuMapView:h,graphicLayer:p})]})})}var sn=f(99037);function rn(e){const i=a.hooks.useTranslation(n),{routeInfo:s,reset:r,hideDates:l,useRouteStartEndDate:u,onUpdateRouteInfo:d}=e,[f,h]=a.React.useState(!1),[p,m]=a.React.useState(!1),[v,D]=a.React.useState("idle"),[b,g]=a.React.useState("idle"),[y,S]=a.React.useState(""),[I,R]=a.React.useState("");a.React.useEffect(()=>{r&&(h(!1),m(!1),D("idle"),g("idle"),S(""),R(""))},[r]),a.React.useEffect(()=>{h(u),m(u)},[l]),a.React.useEffect(()=>{let e=!1;const t=Object.assign({},s);"idle"===v&&S(""),"idle"===b&&R(""),(0,c.isDefined)(s.selectedFromDate)&&f&&s.selectedFromDate!==s.fromDate&&(t.selectedFromDate=s.fromDate,e=!0),p&&s.selectedToDate!==s.toDate&&(t.selectedToDate=s.toDate,e=!0),e&&d(t)},[d,s,f,p]);const w=(e,t)=>{const a=e;if(!(0,c.isDefined)(a))return t?D("idle"):g("idle"),t?S(""):R(""),!0;let n=!0;const o=(0,c.getDateWithoutTime)(a),r=(0,c.getDateWithoutTime)(s.fromDate),l=(0,c.getDateWithoutTime)(s.toDate),u=(0,c.getDateWithoutTime)(s.selectedFromDate),d=(0,c.getDateWithoutTime)(s.selectedToDate);return(0,c.isDefined)(s.fromDate)&&o<r?(t?D("invalid"):g("invalid"),t?S(i("invalidFromDateBefore")):R(i("invalidToDateBefore")),n=!1,!1):(0,c.isDefined)(s.toDate)&&o>l?(t?D("invalid"):g("invalid"),t?S(i("invalidFromDateAfter")):R(i("invalidToDateAfter")),n=!1,!1):((0,c.isDefined)(s.selectedToDate)&&t&&(o>d&&(D("invalid"),t?S(i("invalidDatesOrder")):R(i("invalidDatesOrder")),n=!1),I===i("invalidDatesOrder")?o<d&&(g("idle"),R("")):I===i("invalidDatesSameDay")&&o!==u&&(g("idle"),R(""))),(0,c.isDefined)(s.selectedToDate)&&t&&o.getTime()===d.getTime()&&(D("invalid"),t?S(i("invalidDatesSameDay")):R(i("invalidDatesSameDay")),n=!1),(0,c.isDefined)(s.selectedFromDate)&&(t||(o<u&&(g("invalid"),t?S(i("invalidDatesOrder")):R(i("invalidDatesOrder")),n=!1),y===i("invalidDatesOrder")?o>u&&(D("idle"),S("")):y===i("invalidDatesSameDay")&&o!==u&&(D("idle"),S("")))),(0,c.isDefined)(s.selectedFromDate)&&(t||o.getTime()!==u.getTime()||(g("invalid"),t?S(i("invalidDatesSameDay")):R(i("invalidDatesSameDay")),n=!1)),n&&(t?D("idle"):g("idle"),t?S(""):R("")),!0)};return(0,t.jsx)("div",{className:"add-point-event-date-form px-3 w-100",css:(0,c.getCalciteBasicTheme)(),children:!l&&(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{size:"sm",centric:!0,className:"text-truncate mb-0 pt-3 title3",style:{width:100,textOverflow:"ellipsis"},children:i("startDateRequiredLabel")}),(0,t.jsx)(o.Tooltip,{title:y,children:(0,t.jsx)(sn.CalciteInputDatePicker,{scale:"s",disabled:!!f||void 0,valueAsDate:s.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const a=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;w(a,!0);const n=Object.assign(Object.assign({},s),{selectedFromDate:a});d(n)}},status:v,placement:"top",overlayPositioning:"fixed"})}),(0,t.jsxs)(o.Label,{size:"sm",className:"text-truncate w-100 pt-2 label3",centric:!0,check:!0,style:{textOverflow:"ellipsis"},children:[(0,t.jsx)(o.Checkbox,{checked:f,className:"mr-2",onChange:(e,t)=>{w(s.fromDate,!0),h(t)}}),i("useStartDateLabel")]}),(0,t.jsx)(o.Label,{size:"sm",centric:!0,className:"text-truncate mb-0 pt-2 w-100 title3",style:{textOverflow:"ellipsis"},children:i("endDateLabel")}),(0,t.jsx)(o.Tooltip,{title:I,children:(0,t.jsx)(sn.CalciteInputDatePicker,{scale:"s",disabled:!!p||void 0,valueAsDate:s.selectedToDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const a=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;w(a,!1);const n=Object.assign(Object.assign({},s),{selectedToDate:a});d(n)}},status:b,placement:"top",overlayPositioning:"fixed"})}),(0,t.jsxs)(o.Label,{size:"sm",className:"text-truncate w-100 pt-2 label2",centric:!0,check:!0,style:{textOverflow:"ellipsis"},children:[(0,t.jsx)(o.Checkbox,{checked:p,className:"mr-2",onChange:(e,t)=>{w(s.toDate,!1),m(t)}}),i("useEndDateLabel")]})]})})}var cn=f(68972),ln=function(e,t,a,n){return new(a||(a=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}c((n=n.apply(e,t||[])).next())})};const un=a.React.forwardRef((e,n)=>{const{intl:o,widgetId:i,network:s,isReady:r,networkDS:l,routeInfoFromDataAction:u,method:d,reset:f,jimuMapView:h,hoverGraphic:p,pickedGraphic:m,flashGraphic:v,lockAquired:D,hideDates:b,useRouteStartEndDate:g,revalidateRouteFromDataAction:y,onResetDataAction:S,onsubmit:I,onRouteInfoUpdate:R,onValidationChanged:w,addToDominantRoute:j}=e,[k,x]=a.React.useState((0,c.getInitialRouteInfoState)());(0,cn.useImperativeHandle)(n,()=>({handleNextClicked:N})),a.React.useEffect(()=>{(0,c.isDefined)(s)&&!y&&(x((0,c.getInitialRouteInfoState)()),T())},[s]),a.React.useEffect(()=>{f&&(x((0,c.getInitialRouteInfoState)()),T())},[f]);const N=()=>{I(k,l,s,j)},T=()=>{(0,c.isDefined)(m)&&m.removeAll()},C=(e,t)=>ln(void 0,void 0,void 0,function*(){var a;(0,c.isDefined)(e.selectedPolyline)&&t&&(a=yield(0,c.getGeometryGraphic)(yield(0,c.getSimpleLineGraphic)(e.selectedPolyline),"#00FFFF"),(0,c.isDefined)(a)&&(v.add(a),setTimeout(()=>{v.removeAll(),setTimeout(()=>{v.add(a),setTimeout(()=>{v.removeAll(),setTimeout(()=>{v.add(a),setTimeout(()=>{v.removeAll()},800)},800)},800)},800)},800))),(0,c.isDefined)(e.selectedPoint)?(e=>{(0,c.isDefined)(e)?(m.removeAll(),m.add(e)):T()})(yield(0,c.getGeometryGraphic)(yield(0,c.getSimplePointGraphic)(e.selectedPoint),"#008000")):T(),(0,c.isDefined)(h)&&setTimeout(()=>{h.clearSelectedFeatures()},100)}),A=(e,t=!1)=>{x(e),R(e),C(e,t)},L=a.React.useCallback(()=>{var e;if(!D)return!1;if(!k.validRoute)return!1;if(0===(null===(e=k.routeId)||void 0===e?void 0:e.length))return!1;if(isNaN(k.selectedMeasure))return!1;if(isNaN(k.fromMeasure))return!1;if(k.selectedMeasure<k.fromMeasure)return!1;if(isNaN(k.toMeasure))return!1;if(k.selectedMeasure>k.toMeasure)return!1;if(!(0,c.isDefined)(k.selectedFromDate)&&!(0,c.isDefined)(k.selectedToDate))return!1;const t=(0,c.getDateWithoutTime)(k.fromDate),a=(0,c.getDateWithoutTime)(k.toDate),n=(0,c.getDateWithoutTime)(k.selectedFromDate),o=(0,c.getDateWithoutTime)(k.selectedToDate);if((0,c.isDefined)(k.selectedFromDate)&&!(0,c.isDefined)(k.selectedToDate)){if((0,c.isDefined)(k.fromDate)&&n<t)return!1;if((0,c.isDefined)(k.toDate)&&n>a)return!1}if(!(0,c.isDefined)(k.selectedFromDate)&&(0,c.isDefined)(k.selectedToDate)){if((0,c.isDefined)(k.fromDate)&&o<t)return!1;if((0,c.isDefined)(k.toDate)&&o>a)return!1}if((0,c.isDefined)(k.selectedFromDate)&&(0,c.isDefined)(k.selectedToDate)){if(n>o)return!1;if((0,c.isDefined)(k.fromDate)&&n<t)return!1;if((0,c.isDefined)(k.toDate)&&o>a)return!1}return!0},[k,D]);return a.React.useEffect(()=>{w(L()&&r)},[r,L,w]),(0,t.jsxs)("div",{className:"add-single-point-event-route-selection-form__content h-100 d-flex",css:a.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-single-point-event-route-selection-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-single-point-event-route-selection-form__actions {
      height: 100%;
    }
  `,children:[(0,t.jsxs)("div",{className:"d-flex w-100",children:[d===c.SearchMethod.Measure&&(0,t.jsx)(on,{intl:o,widgetId:i,isReady:r,network:s,networkDS:l,routeInfo:k,jimuMapView:h,hoverGraphic:p,reset:f,routeInfoFromDataAction:u,revalidateRouteFromDataAction:y,onResetDataAction:S,clearPickedGraphic:T,onRouteInfoUpdated:A}),d===c.SearchMethod.Coordinate&&(0,t.jsx)("div",{}),d===c.SearchMethod.LocationOffset&&(0,t.jsx)("div",{})]}),(0,t.jsx)("div",{className:"d-flex w-100 h-100",children:(0,t.jsx)(rn,{hideDates:b,useRouteStartEndDate:g,routeInfo:k,reset:f,onUpdateRouteInfo:A})})]})});function dn(i){const s=a.hooks.useTranslation(n),{operationType:r,onOperationTypeChanged:c}=i,l=a.React.useMemo(()=>r,[r]);return(0,t.jsxs)("div",{className:"add-point-event-operation-type",children:[(0,t.jsx)(o.Label,{size:"default",className:"pt-2 mb-0 px-3 title3",children:s("typeLabel")}),(0,t.jsxs)(o.Select,{"aria-label":s("typeLabel"),className:"w-100 px-3",size:"sm",value:l,onChange:e=>{c(e.target.value)},children:[(0,t.jsxs)("option",{value:e.single,children:[" ",s("singleOperation")]}),(0,t.jsxs)("option",{value:e.multiple,children:[" ",s("multipleOperation")]})]})]})}function fn(e){const i=a.hooks.useTranslation(n),{addToDominantRoute:s,onUpdateAddToDominantRoute:r}=e;a.React.useEffect(()=>{r(s)},[]);return(0,t.jsxs)("div",{className:"merge-retire-form px-3 h-100",children:[(0,t.jsx)("hr",{css:a.css`
            border: none;
            height: 1px;
            background-color: var(--ref-palette-neutral-400);
          `}),(0,t.jsxs)(o.Label,{size:"sm",className:"w-100 pt-0",centric:!0,check:!0,children:[(0,t.jsx)(o.Checkbox,{className:"mr-2",checked:s,onChange:(e,t)=>{r(t)}}),i("addToDominantRouteLabel")]})]})}var hn=f(1888),pn=function(e,t,a,n){return new(a||(a=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}c((n=n.apply(e,t||[])).next())})};function mn(e){var i,s;const r=a.hooks.useTranslation(n),{intl:u,widgetId:d,lrsLayers:f,eventLayers:h,networkLayers:p,defaultEvent:m,defaultMethod:v,JimuMapView:D,operationType:b,hoverGraphic:g,pickedGraphic:y,flashGraphic:S,conflictPreventionEnabled:I,hideEvent:R,hideNetwork:w,hideType:j,hideMethod:k,hideDates:x,hideTitle:N,useRouteStartEndDate:T,networkDataSourceFromDataAction:C,routeInfoFromDataAction:A,onResetDataAction:L,onClearGraphic:M,onOperationTypeChanged:E,hideAddToDominantRouteOption:O,enableAddToDominantRouteOption:_,notAllowOverrideEventReplacement:F}=e,[P,V]=a.React.useState(0),[G,U]=a.React.useState(null),[W,B]=a.React.useState(null),[z,q]=a.React.useState(null),[Q,Z]=a.React.useState(null),[$,K]=a.React.useState(!1),[H,J]=a.React.useState(v),[Y,X]=a.React.useState(!1),[ee,te]=a.React.useState((0,c.getInitialRouteInfoState)()),[ae,ne]=a.React.useState((0,c.getIntialLocksInfo)()),[oe,ie]=a.React.useState(!I),[se,re]=a.React.useState(!1),ce=a.React.useRef(null),[le,ue]=a.React.useState(!0),[de,fe]=a.React.useState(!1),he=a.React.useRef(null),[pe,me]=a.React.useState(null),[ve,De]=a.React.useState(_),[be,ge]=a.React.useState(!1),[ye,Se]=a.React.useState(!1),[Ie,Re]=a.React.useState([]),we=a.React.useCallback(e=>{U(e)},[U]),je=a.React.useCallback(e=>{B(e)},[B]),ke=a.React.useCallback(()=>{K(!0)},[K]);a.React.useEffect(()=>{(0,a.focusElementInKeyboardMode)(ce.current)},[]),a.React.useEffect(()=>{V(0),X(!0),(0,c.waitTime)(800).then(()=>{X(!1)})},[f]),a.React.useEffect(()=>{if((0,c.isDefined)(Q)&&f.some(e=>e.name===Q.name)){const e=f.find(e=>(0,c.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===Q.eventInfo.parentNetworkId);e&&e.layerType===c.LrsLayerType.Network?q((0,a.Immutable)(e)):q(null)}else{const e=f.find(e=>e.name===m.name);Z((0,a.Immutable)(e))}},[m,f,Q]),a.React.useEffect(()=>{if((0,c.isDefined)(C)&&C.id!==(null==z?void 0:z.id)){U(C);let e,t=C;(C.id.includes("output_point")||C.id.includes("output_line"))&&(t=C.getOriginDataSources()[0]),f.forEach(a=>{a.id===t.id&&(0,c.isDefined)(a.networkInfo)&&(e=a)});const a=f.find(t=>t.eventInfo.parentNetworkId===(null==e?void 0:e.networkInfo.lrsNetworkId));(0,c.isDefined)(a)&&Ne(a.name)}},[C]),a.React.useEffect(()=>{re((0,c.isDefined)(A))},[A]),a.React.useEffect(()=>{xe(c.LockAction.None)},[G,Q,z]);const xe=a.React.useCallback((e=c.LockAction.None,t)=>{if(I){const a=Object.assign({},ae);(0,c.isDefined)(z)&&(0,c.isDefined)(Q)&&(0,c.isDefined)(t)?(a.networkId=[z.networkInfo.lrsNetworkId],a.eventServiceLayerIds=[Q.serviceId],a.routeInfo=t,a.routeOrLineId=[],a.lockAction=e,ne(a)):e!==c.LockAction.None&&(a.lockAction=e,ne(a))}},[I,ae,Q,z]),Ne=a.React.useCallback(e=>{const t=f.find(t=>t.name===e);if(t){const e=f.find(e=>(0,c.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===t.eventInfo.parentNetworkId);e&&e.layerType===c.LrsLayerType.Network&&q((0,a.Immutable)(e)),fe(!0),Z((0,a.Immutable)(t))}},[f]),Te=a.React.useCallback(e=>{const t=f.find(t=>t.name===e);(0,c.isDefined)(t)&&q((0,a.Immutable)(t))},[f]),Ce=a.React.useCallback(e=>{J(e)},[]),Ae=a.React.useCallback((e,t,a,n)=>pn(this,void 0,void 0,function*(){if(te(e),fe(!1),ge(!1),n){const n={routeId:e.routeId,fromMeasure:e.selectedMeasure,toMeasure:e.selectedMeasure},o=e.selectedFromDate,i=(0,c.isDefined)(e.selectedToDate)?e.selectedToDate:new Date(0xe677d21fdbff),s=yield(0,c.QueryRouteConcurrencies)(t,a,o,i,[n]),r=[];let l=!0,u=!0;const d=[];if(null==s||s.locations.forEach(t=>{d.includes(t.routeId)||d.push(t.routeId),t.concurrencies.forEach(t=>{d.includes(t.routeId)||d.push(t.routeId),t.isChosen=t.isDominant,t.isAdded=!1,(0,c.isDefined)(t.fromDate)&&!r.includes(t.fromDate)&&((!(0,c.isDefined)(e.selectedFromDate)||t.fromDate>=e.selectedFromDate)&&r.push(t.fromDate),(0,c.isDefined)(e.selectedFromDate)&&t.fromDate===e.selectedFromDate.getTime()&&(l=!1)),(0,c.isDefined)(t.toDate)&&!r.includes(t.toDate)&&((!(0,c.isDefined)(e.selectedToDate)||t.toDate<=e.selectedToDate)&&r.push(t.toDate),(0,c.isDefined)(e.selectedToDate)&&t.toDate===e.selectedToDate.getTime()&&(u=!1))})}),l&&(0,c.isDefined)(e.selectedFromDate)&&!r.includes(e.selectedFromDate)){const t=new Date(e.selectedFromDate.getFullYear(),e.selectedFromDate.getMonth(),e.selectedFromDate.getDate());r.push(t)}if(u&&(0,c.isDefined)(e.selectedToDate)&&!r.includes(e.selectedToDate)){const t=new Date(e.selectedToDate.getFullYear(),e.selectedToDate.getMonth(),e.selectedToDate.getDate());r.push(t)}r.sort((e,t)=>Number(e)-Number(t)),(0,c.isDefined)(e.selectedToDate)||r.push(null);const f=[];for(let e=0;e<r.length-1;e++){const t={fromDate:r[e],toDate:r[e+1]};f.push(t)}Re(f);const h=new Map;if(d.length>0&&((null==a?void 0:a.useRouteName)||(null==a?void 0:a.supportsLines))){const e=(0,c.getRoutesByRouteIds)(d,a,t);yield Promise.all([e]).then(e=>{const t=null==e?void 0:e[0];(0,c.isDefined)(t)&&t.features.forEach(e=>{const t={};(null==a?void 0:a.useRouteName)&&(t.routeName=e.attributes[a.routeNameFieldSchema.jimuName]),(null==a?void 0:a.supportsLines)&&(t.lineId=e.attributes[a.lineIdFieldSchema.jimuName]);const n=e.attributes[a.routeIdFieldSchema.jimuName];h.has(n)||h.set(n,t)})})}const p={locations:[]};p.locations.push({routeId:null==s?void 0:s.locations[0].routeId,fromMeasure:null==s?void 0:s.locations[0].fromMeasure,toMeasure:null==s?void 0:s.locations[0].toMeasure,concurrencies:[]}),f.forEach(e=>{null==s||s.locations.forEach((t,n)=>{let o=!1;if(t.concurrencies.sort((e,t)=>e.fromMeasure-t.fromMeasure),t.concurrencies.forEach(t=>{if((!(0,c.isDefined)(t.fromDate)||(0,c.isDefined)(e.fromDate)&&t.fromDate<=e.fromDate)&&(!(0,c.isDefined)(t.toDate)||(0,c.isDefined)(e.toDate)&&e.toDate<=t.toDate)){const i={routeId:t.routeId,fromMeasure:an(t.fromMeasure,a.measurePrecision),toMeasure:an(t.toMeasure,a.measurePrecision),fromDate:e.fromDate,toDate:e.toDate,sectionId:t.sectionId,isDominant:t.isDominant,isChosen:t.isDominant,isAdded:!1};p.locations[n].concurrencies.push(i),o=!0}}),!o){const a={routeId:t.routeId,fromMeasure:t.fromMeasure,toMeasure:t.toMeasure,fromDate:e.fromDate,toDate:e.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};p.locations[n].concurrencies.push(a)}})}),h.size>0&&(null==p||p.locations.forEach(e=>{const t=h.get(e.routeId);e.routeName=t.routeName,e.lineId=t.lineId,e.concurrencies.forEach(e=>{const t=h.get(e.routeId);e.routeName=t.routeName,e.lineId=t.lineId})})),me(p),s.locations.length>0&&s.locations[0].concurrencies.length>0&&!F?(Se(!0),V(1)):(Se(!1),V(2))}else V(2)}),[]),Le=a.React.useCallback(e=>{te(e),fe(!1),ge(!1),V(2)},[]),Me=a.React.useCallback(()=>{const e=(0,c.getInitialRouteInfoState)();te(e),xe(c.LockAction.Clear,e),re(!1),De(_),X(!0),ge(!0),setTimeout(()=>{X(!1),ge(!1)},800)},[xe]),Ee=a.React.useCallback(e=>{e&&(M(),Me()),V(0),ce.current&&(0,a.focusElementInKeyboardMode)(ce.current)},[Me,M]),Oe=a.React.useCallback((e,t,n)=>{e&&(M(),Me()),V(t&&n&&!F?1:0),ce.current&&(0,a.focusElementInKeyboardMode)(ce.current)},[Me,M]),_e=a.React.useCallback(e=>{e&&(ge(e),setTimeout(()=>{ge(!1)},800))},[]),Fe=a.React.useCallback(e=>{te(e),xe(c.LockAction.QueryAndAcquire,e)},[xe]),Pe=a.React.useMemo(()=>!(!$||!(0,c.isDefined)(null==D?void 0:D.view)),[null==D?void 0:D.view,$]),Ve=a.React.useCallback((e,t,a)=>{ie(!!a),ne(e)},[]),Ge=a.React.useCallback(()=>{var e;null===(e=he.current)||void 0===e||e.handleNextClicked()},[]),Ue=a.React.useCallback(e=>{ue(e)},[]),We=a.React.useCallback(e=>{De(e)},[]),Be=a.React.useCallback(e=>{me(e)},[]);return(0,t.jsxs)("div",{className:"add-single-point-event h-100 d-flex",ref:ce,tabIndex:-1,css:a.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-single-point-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsx)(Aa,{network:z,event:Q,dataSourcesReady:ke,onCreateNetworkDs:we,onCreateEventDs:je}),!N&&(0,t.jsx)(l,{}),(0,t.jsxs)("div",{className:(0,a.classNames)("add-single-point-event__content",{"d-none":0!==P,[o.FOCUSABLE_CONTAINER_CLASS]:0===P}),children:[I&&(0,t.jsx)(c.LockManagerComponent,{intl:u,featureDS:G,showAlert:!0,lockInfo:ae,networkName:null===(i=null==z?void 0:z.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:I,onQueryAndAcquireComplete:Ve,onMessageClear:()=>{xe(c.LockAction.None)}}),!j&&(0,t.jsx)(dn,{operationType:b,onOperationTypeChanged:E}),!R&&(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100 title3",children:r("eventLayerLabel")}),(0,t.jsx)(o.Select,{"aria-label":r("eventLayerLabel"),className:"w-100 px-3",size:"sm",value:Q?Q.name:"",disabled:1===h.length,onChange:e=>{Ne(e.target.value)},children:h.map((e,a)=>(0,t.jsx)(o.Option,{value:e,children:e},a))})]}),!w&&(0,t.jsx)(c.InlineEditableDropdown,{label:r("networkLabel"),isDisabled:!0,defaultItem:(0,c.isDefined)(z)?z.name:"",listItems:p,onSelectionChanged:Te}),!k&&(0,t.jsx)(c.InlineEditableDropdown,{label:r("methodLabel"),isDisabled:!0,defaultItem:H,listItems:[c.SearchMethod.Measure],altItemDescriptions:[r("routeAndMeasure")],onSelectionChanged:Ce}),(0,t.jsx)(un,{ref:he,intl:u,widgetId:d,network:z?z.networkInfo:null,routeInfoFromDataAction:A,isReady:Pe,networkDS:G,method:H,reset:Y,jimuMapView:D,hoverGraphic:g,pickedGraphic:y,flashGraphic:S,lockAquired:oe,hideDates:x,useRouteStartEndDate:T,revalidateRouteFromDataAction:se,onResetDataAction:L,onsubmit:Ae,onRouteInfoUpdate:Fe,onValidationChanged:Ue,addToDominantRoute:ve}),!O&&(0,t.jsx)(fn,{addToDominantRoute:ve,onUpdateAddToDominantRoute:We})]}),(0,t.jsxs)("div",{className:(0,a.classNames)("add-point-footer w-100",{"d-none":0!==P,[o.FOCUSABLE_CONTAINER_CLASS]:0===P}),children:[(0,t.jsx)(o.Label,{size:"sm",className:" mt-auto mr-auto title3",centric:!0,style:{color:null===(s=(0,hn.getTheme)())||void 0===s?void 0:s.sys.color.primary.main},onClick:Me,children:r("resetForm")}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(o.Button,{type:"primary",className:"active","aria-label":r("nextLabel"),size:"sm",disabled:!le,onClick:Ge,children:r("nextLabel")})})]}),(0,t.jsx)("div",{className:(0,a.classNames)("add-single-point-event__content",{"d-none":1!==P,[o.FOCUSABLE_CONTAINER_CLASS]:1===P}),children:(0,t.jsx)(Ca,{intl:u,networkDS:G,network:z,eventLayer:Q,routeInfo:ee,reset:Y||de||be,conflictPreventionEnabled:I,onNavBack:Ee,onNavNext:Le,concurrenciesResponse:pe,onConcurrenciesResponseUpdated:Be,onResetClicked:_e,dateRanges:Ie})}),(0,t.jsx)("div",{className:(0,a.classNames)("add-single-point-event__content",{"d-none":2!==P,[o.FOCUSABLE_CONTAINER_CLASS]:2===P}),children:(0,t.jsx)(Ta,{intl:u,widgetId:d,networkDS:G,network:z,eventDS:W,eventLayer:Q,routeInfo:ee,reset:Y||de,jimuMapView:D,hoverGraphic:g,conflictPreventionEnabled:I,onNavBack:Oe,hasConcurrencies:ye,addToDominantRoute:ve,concurrenciesResponse:pe})})]})}var vn=function(e,t,a,n){return new(a||(a=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}c((n=n.apply(e,t||[])).next())})};let Dn=[];function bn(e){var i;const s=a.hooks.useTranslation(n),{intl:r,widgetId:l,networkDS:u,network:d,eventLayers:f,routeInfo:h,attributeSet:p,reset:m,isReady:v,jimuMapView:D,hoverGraphic:b,conflictPreventionEnabled:g,onNavBack:y,hasConcurrencies:S,addToDominantRoute:I,concurrenciesResponse:R}=e,[w,j]=a.React.useState([]),[k,x]=a.React.useState([]),[N,T]=a.React.useState([]),[C,A]=a.React.useState([]),[L,M]=a.React.useState(!1),[E,O]=a.React.useState(),[_,F]=a.React.useState(""),[P,V]=a.React.useState(!1),[G,U]=a.React.useState(!1),[W,B]=a.React.useState(!0),[z,q]=a.React.useState((0,c.getIntialLocksInfo)()),[Q,Z]=a.React.useState(!1),[$,K]=a.React.useState(!1),{sessionId:H,startEditSession:J,addEdit:Y}=(0,c.useVmsManager)(),{supportsEditSession:X}=(0,c.useEditSession)();a.React.useEffect(()=>{m&&te(f)},[m]),a.React.useEffect(()=>{(0,c.isDefined)(p)&&(0,c.isDefined)(f)&&v&&te(f)},[p,f,v]),a.React.useEffect(()=>{ee()},[u,d,f,h]);const ee=(e=c.LockAction.None,t,a)=>{if(g){const n=Object.assign({},z);if((0,c.isDefined)(d)&&(n.networkId=[d.networkInfo.lrsNetworkId]),(0,c.isDefined)(f)){const e=(0,c.isDefined)(a)?a:C;if((0,c.isDefined)(R))n.isLine=[],n.routeOrLineId=[],n.eventServiceLayerIds=[],N.forEach((t,a)=>{var o;e[a]&&(null===(o=null==R?void 0:R.locations)||void 0===o||o.forEach(e=>{var a;null===(a=null==e?void 0:e.concurrencies)||void 0===a||a.forEach(e=>{e.isChosen&&(n.isLine.push(d.networkInfo.supportsLines),n.routeOrLineId.push(d.networkInfo.supportsLines?e.lineId:e.routeId),n.eventServiceLayerIds.push(t.serviceId))})}))});else{const t=[];N.forEach((a,n)=>{e[n]&&t.push(a.serviceId)}),n.eventServiceLayerIds=t}}(0,c.isDefined)(t)&&(n.routeInfo=t,(0,c.isDefined)(R)&&(n.routeOrLineId=[])),n.lockAction=e,q(n)}},te=e=>{if((0,c.isDefined)(e)){const t=[],a=[],n=[],o=[];e.forEach(e=>{const i=ae(e),s=ne(e,i);t.push(i),a.push(s),n.push(e.asMutable({deep:!0})),o.push(!0)}),j(t),x(a),T(n),A(o),ee(c.LockAction.None,h,o),B(!0),0===o.length?U(!0):U(!1)}},ae=e=>{if((0,c.isDefined)(e)&&(0,c.isDefined)(e.useDataSource)){const t=a.DataSourceManager.getInstance().getDataSource(e.useDataSource.dataSourceId);if((0,c.isDefined)(t))return t}},ne=(e,t)=>{const a=[];if((0,c.isDefined)(t)){const n=t,o=(null==n?void 0:n.layer).fields,i=p.layers.find(t=>t.layerId===e.serviceId);(0,c.isDefined)(i)&&i.fields.forEach(e=>{const t=o.find(t=>t.name===e.name);if(t){let n;""!==e.value&&(n=(0,c.isDate)(t.type)?(0,c.isDefined)(e.value)?new Date(e.value):null:(0,c.isNumber)(t.type)?Number(e.value):e.value);const o={index:a.length,name:t.name,alias:t.alias,type:t.type,hasDomain:(0,c.isDefined)(t.domain),value:n,error:"",nullable:t.nullable,default:"number"==typeof n?Number(n).toString():n,length:t.length,editable:t.editable};a.push(o)}})}return a},oe=e=>e.findIndex(e=>e.error.length>0)>-1,ie=(e,t,a,n)=>{const o=ka(k),i=ka(o[n]);i[a].value=e,i[a].error=t,o[n]=i,x(o),V(oe(o[n]))},se=(e,t)=>{const a=ka(k);a[t]=e,x(a),V(oe(e))},re=(e,t)=>{var a;if(void 0===t)return;const n=Object.assign(Dn);n[t]=e,Dn=n,Dn[t]&&0!==(null===(a=Dn[t])||void 0===a?void 0:a.length)||K(!1)},ce=(e,t)=>{const a=C;a[t]=e,A(a),he(a),ee(c.LockAction.None,h,a),a.every(e=>!e)?U(!0):U(!1)},le=(e,t,a)=>{g?(Z(!1),ee(c.LockAction.Clear)):y(e,!e&&t,a)},ue=()=>{w.forEach(e=>vn(this,void 0,void 0,function*(){var t;const n=e,o=n.getPopupInfo(),i=n.getLayerDefinition(),s=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==i?void 0:i.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==o?void 0:o.fieldInfos)||[]).filter(e=>e.visible)),r=n.mergeQueryParams(null!==(t=n.getCurrentQueryParams())&&void 0!==t?t:{},{where:"1=1",sqlExpression:null}),c=Object.assign({returnGeometry:!0},r);yield n.load(c,{widgetId:l});const u=new a.DataRecordSetChangeMessage(l,a.RecordSetChangeType.CreateUpdate,[{records:n.getRecords(),fields:s.map(e=>e.fieldName),dataSource:n,name:n.id}]);a.MessageManager.getInstance().publishMessage(u)}))},de=(e,t,a,n,o,i)=>{const s={},r=t.eventInfo.eventIdFieldName;s[r]="{"+(0,c.getUUID)()+"}";const l=t.eventInfo.routeIdFieldName;s[l]=n.routeId;const d=t.eventInfo.fromMeasureFieldName;s[d]=n.fromMeasure;const f=t.eventInfo.fromDateFieldName;if(!o&&(0,c.isDefined)(n.fromDate)){const e=(0,c.getDateWithoutTZOffset)(n.fromDate.valueOf(),u);s[f]=(0,c.getDateToUTC)(e)}else s[f]=n.fromDate;const h=t.eventInfo.toDateFieldName;if(!i&&(0,c.isDefined)(n.toDate)){const e=(0,c.getDateWithoutTZOffset)(n.toDate.valueOf(),u);s[h]=(0,c.getDateToUTC)(e)}else s[h]=n.toDate;k[a].forEach(e=>{const t=e.name;if((0,c.isDefined)(e.value)&&(0,c.isDate)(e.type)){const a=(0,c.getDateWithoutTZOffset)(e.value.valueOf(),u);s[t]=(0,c.getDateToUTC)(a)}else(0,c.isNumber)(e.type)?!(0,c.isDefined)(e.value)||""===e.value||isNaN(Number(e.value))?s[t]=null:s[t]=Number(e.value):s[t]=e.value});const p={attributes:s};e.push(p)},fe=e=>vn(this,void 0,void 0,function*(){const t={edits:[]};if((()=>{const e=ka(k);let t=!1;return e.forEach((a,n)=>{if(C[n]){const o=ka(a);o.forEach((i,r)=>{let l;if(l=i.hasDomain?(0,c.validateRangeDomain)(i.value,i.name,w[n]):((0,c.isDate)(i.type),(0,c.validateField)(i.value,i.name,w[n])),(0,c.isDefined)(Dn[n])){const e=(0,c.validateContingencyConstraints)(i.value,"",r,a,Dn[n]);if((null==e?void 0:e.length)>0){let t=[];e.forEach(e=>{var a;const n=null===(a=null==e?void 0:e.fieldGroup)||void 0===a?void 0:a.fields;t.push(n)}),t=t.flat(),t.includes(i.name)&&(K(!0),l={hasError:!0,message:"contingentValueError"})}}if(l.hasError){let a;if("contingentValueError"===l.message){const e=[];Dn[n].forEach(t=>{e.push(t.name)});let t=s("invalidContingentValues");t=t.replace("{groupNames}",e.join(",")),a=t}else{const e=N[n].useFieldAlias?i.alias:i.name;a=s("attributeError",{fieldValue:e,message:s(l.message)})}O("error"),F(a),M(!0),setTimeout(()=>{M(!1)},5e3),t=!0,i.error=s(l.message),e[n]=o}})}}),t&&x(e),t})())return;const n=w[0];let o=n.getGDBVersion();if(o||(o=""),N.forEach((e,a)=>{var n;if(C[a]&&(0,c.isDefined)(e)){const o=[];if((0,c.isDefined)(R)&&R.locations.length>0)null===(n=R.locations)||void 0===n||n.forEach(t=>{var n;if(0===t.concurrencies.length){const n={routeId:t.routeId,fromMeasure:t.fromMeasure,fromDate:(0,c.getDateWithRouteTime)(h.selectedFromDate,h.fromDate),toDate:(0,c.getDateWithRouteTime)(h.selectedToDate,h.toDate)};de(o,e,a,n,!1,!1)}else null===(n=t.concurrencies)||void 0===n||n.forEach(t=>{if(t.isChosen){const n={routeId:t.routeId,fromMeasure:t.fromMeasure,fromDate:t.fromDate,toDate:t.toDate},i=!(0,c.isDefined)(h.selectedFromDate)||t.fromDate.valueOf()!==h.selectedFromDate.valueOf(),s=!(0,c.isDefined)(h.selectedToDate)||t.toDate.valueOf()!==h.selectedToDate.valueOf();de(o,e,a,n,i,s)}})});else{const t={routeId:h.routeId,fromMeasure:h.selectedMeasure,fromDate:(0,c.getDateWithRouteTime)(h.selectedFromDate,h.fromDate),toDate:(0,c.getDateWithRouteTime)(h.selectedToDate,h.toDate)};de(o,e,a,t,!1,!1)}const i={id:e.serviceId,adds:o,allowMerge:!1,retireMeasureOverlap:!1,retireByEventId:!1};t.edits.push(i)}}),(0,c.isDefined)(h.selectedPoint.spatialReference.wkid)||(h.selectedPoint.spatialReference.wkid=D.view.spatialReference.wkid),X){const e=yield J();if(!e.success)return O("error"),F(e.error),M(!0),void setTimeout(()=>{M(!1)},5e3)}yield(0,c.LrsApplyEdits)(n,(0,a.Immutable)(N[0]),H,t,null,null).then(t=>{t.success?(X&&Y(t,s("addMultiplePointEvents")),O("success"),F(s("eventCreated")),M(!0),ue(),setTimeout(()=>vn(this,void 0,void 0,function*(){if(M(!1),g){Z(!0),yield(0,c.tryReleaseLockOnDefault)(u,e);const t=Object.assign(Object.assign({},e),{lockAction:c.LockAction.Clear});q(t)}else le(!0,!1,I)}),5e3)):(O("error"),F(`${t.message} \n ${t.details}`),M(!0),setTimeout(()=>{M(!1)},5e3))})}),he=e=>{e.every(e=>e)?B(!0):(e.every(e=>!e),B(!1))};return(0,t.jsxs)("div",{className:"h-100",css:a.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-multiple-point-events-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-point-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-multiple-point-events-edit-attributes__action {
      height: auto;
    }
    .add-point-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsxs)("div",{className:"add-multiple-point-events-edit-attributes__content",children:[g&&(0,t.jsx)(c.LockManagerComponent,{intl:r,featureDS:u,lockInfo:z,showAlert:!0,networkName:null===(i=null==d?void 0:d.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:g,onQueryAndAcquireComplete:(e,t,a)=>{q(e),a&&fe(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},z),{lockAction:c.LockAction.None});q(e),y(Q,!Q&&S,I),Z(!1)}}),(0,t.jsxs)("div",{className:"attribute-picker d-flex w-100 px-3",children:[(0,t.jsx)("div",{className:"mr-auto",children:(0,t.jsxs)(o.Label,{size:"sm",className:"text-truncate w-100 pt-2 title3",centric:!0,check:!0,style:{textOverflow:"ellipsis"},children:[(0,t.jsx)(o.Checkbox,{checked:W,className:"mr-2",onChange:e=>{const t=e.target.checked,a=C;a.forEach((e,n)=>{a[n]=t}),ee(c.LockAction.None,h,a),A(a),he(a),a.every(e=>!e)?U(!0):U(!1)}}),s("selectAllLabel")]})}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(c.CopyAttributeTool,{disabled:!1,networkDs:u,eventDataSources:w,jimuMapView:D,hoverGraphic:b,onAttributesCopied:e=>{const t=ka(k);e.forEach(e=>{const a=f.findIndex(t=>t.serviceId.toString()===e.layerId);if(a>-1){const n=ka(t[a]);e.fieldValuePair.forEach(e=>{const t=n.findIndex(t=>t.name===e.name);if(t>-1){let a=e.value;(0,c.isDate)(n[t].type)&&(a=(0,c.isDefined)(e.value)?new Date(e.value):null),n[t].value=a}}),t[a]=n}}),x(t)}})})]}),$&&(0,t.jsx)(o.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){K(!1)},open:$,text:_,type:"warning",closable:!0,withIcon:!0}),(0,c.isDefined)(k)&&k.map((e,n)=>(0,t.jsx)("div",{children:(0,t.jsx)(c.AttributeTable,{tableIndex:n,eventDS:w[n],eventLayer:(0,a.Immutable)(N[n]),fieldInfos:e,useAlias:!0,collapable:!0,isExpanded:C[n],onItemChecked:ce,onUpdateItem:ie,onUpdateAll:se,onFieldGrpUpdated:re},n)},n)),L&&(0,t.jsx)("div",{className:"add-point-event-edit-attributes__toast-container px-3 w-100",children:(0,t.jsx)(o.Alert,{className:"add-point-event-edit-attributes__toast w-100",type:E,text:_,closable:!0,withIcon:!0,open:L,onClose:()=>{M(!1)}})})]}),(0,t.jsx)("div",{className:"add-point-attributes-footer w-100",children:(0,t.jsxs)("div",{className:"add-multiple-point-events-edit-attributes__action w-100 d-flex",children:[(0,t.jsx)("div",{className:"mt-auto mr-auto",children:(0,t.jsx)(o.Button,{"aria-label":s("backLabel"),size:"sm",type:"secondary",onClick:()=>{le(!1,S,I)},children:s("backLabel")})}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(o.Button,{type:"primary",className:"active","aria-label":s("saveLabel"),size:"sm",disabled:P||G||$,onClick:()=>{g?ee(c.LockAction.QueryAndAcquire,h,C):fe()},children:s("saveLabel")})})]})})]})}function gn(e){const{events:n,dataSourcesReady:o}=e,[i,s]=a.React.useState(null!=n?n:null),[r,l]=a.React.useState([]);a.React.useEffect(()=>{if(n&&n.length>0){s(n);const e=Array(n.length).fill(!1);l(e)}else s(null),l([]),o(!0)},[o,n]);const u=a.React.useCallback((e,t)=>{const a=r;a[e]=t,l(a),o(a.every(e=>e))},[o,r]),d=a.React.useCallback((e,t)=>{u(t,!0)},[u]),f=a.React.useCallback((e,t)=>{if(e){const{status:n,instanceStatus:o}=e;o===a.DataSourceStatus.NotCreated||o===a.DataSourceStatus.CreateError||n===a.DataSourceStatus.LoadError||n===a.DataSourceStatus.NotReady?u(t,!1):u(t,!0)}},[u]),h=a.React.useCallback(e=>{u(e,!1)},[u]);return(0,t.jsx)("div",{children:(0,c.isDefined)(i)&&i.map((e,n)=>(0,t.jsx)(a.DataSourceComponent,{useDataSource:e.useDataSource,onDataSourceInfoChange:e=>{f(e,n)},onCreateDataSourceFailed:e=>{h(n)},onDataSourceCreated:e=>{d(e,n)}},n))})}var yn=function(e,t,a,n){return new(a||(a=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}c((n=n.apply(e,t||[])).next())})};function Sn(e){var i,s;const r=a.hooks.useTranslation(n),{intl:u,widgetId:d,lrsLayers:f,jimuMapView:h,operationType:p,networkLayers:m,defaultNetwork:v,defaultMethod:D,defaultAttributeSet:b,attributeSets:g,hoverGraphic:y,pickedGraphic:S,flashGraphic:I,conflictPreventionEnabled:R,hideNetwork:w,hideMethod:j,hideType:k,hideAttributeSet:x,hideDates:N,hideTitle:T,useRouteStartEndDate:C,networkDataSourceFromDataAction:A,routeInfoFromDataAction:L,onResetDataAction:M,onClearGraphic:E,onOperationTypeChanged:O,hideAddToDominantRouteOption:_,enableAddToDominantRouteOption:F,notAllowOverrideEventReplacement:P}=e,[V,G]=a.React.useState(0),[U,W]=a.React.useState(null),[B,z]=a.React.useState(null),[q,Q]=a.React.useState(null),[Z,$]=a.React.useState(!1),[K,H]=a.React.useState(!1),[J,Y]=a.React.useState(D),[X,ee]=a.React.useState(b),[te,ae]=a.React.useState(null),[ne,oe]=a.React.useState(!1),[ie,se]=a.React.useState(null),[re,ce]=a.React.useState(!1),[le,ue]=a.React.useState((0,c.getIntialLocksInfo)()),de=a.React.useRef(null),[fe,he]=a.React.useState(!0),pe=a.React.useRef(null),[me,ve]=a.React.useState(null),[De,be]=a.React.useState(F),[ge,ye]=a.React.useState(!1),[Se,Ie]=a.React.useState(!1),[Re,we]=a.React.useState([]),je=a.React.useCallback(e=>{W(e)},[W]),ke=a.React.useCallback(()=>{$(!0)},[$]),xe=a.React.useCallback(()=>{H(!0)},[H]),Ne=a.React.useCallback(e=>{const t=f.find(t=>t.name===e);(0,c.isDefined)(t)&&z((0,a.Immutable)(t))},[f]);a.React.useEffect(()=>{G(0),oe(!0),(0,c.waitTime)(800).then(()=>{oe(!1)})},[f]),a.React.useEffect(()=>{(0,a.focusElementInKeyboardMode)(de.current)},[]),a.React.useEffect(()=>{ce((0,c.isDefined)(L))},[L]),a.React.useEffect(()=>{if((0,c.isDefined)(A)&&A.id!==(null==B?void 0:B.id)){W(A);let e,t=A;(A.id.includes("output_point")||A.id.includes("output_line"))&&(t=A.getOriginDataSources()[0]),f.forEach(a=>{a.id===t.id&&(0,c.isDefined)(a.networkInfo)&&(e=a)});const a=e.name;Ne(a)}},[A]),a.React.useEffect(()=>{ce((0,c.isDefined)(L))},[L]),a.React.useEffect(()=>{if(!(0,c.isDefined)(B))if((0,c.isDefined)(v)){const e=f.find(e=>e.name===v.name);z(e?(0,a.Immutable)(e):null)}else{const e=f.find(e=>e.layerType===c.LrsLayerType.Network);z(e?(0,a.Immutable)(e):null)}if(!(0,c.isDefined)(te)){const e=g.attributeSet.find(e=>e.title===X);e?ae(e):1===g.attributeSet.length&&(ae(g.attributeSet[0].asMutable({deep:!0})),ee(g.attributeSet[0].title))}},[f,v]),a.React.useEffect(()=>{R&&Te()},[U,te,B]);const Te=a.React.useCallback((e=c.LockAction.None,t)=>{const a=Object.assign({},le);if((0,c.isDefined)(B)&&(a.networkId=[B.networkInfo.lrsNetworkId]),(0,c.isDefined)(te)){const e=te.layers.map(e=>e.layerId);a.eventServiceLayerIds=e}(0,c.isDefined)(t)&&(a.routeInfo=t,a.routeOrLineId=[]),a.lockAction=e,ue(a)},[B,te,le]);a.React.useEffect(()=>{if((0,c.isDefined)(te)&&(0,c.isDefined)(B)){const e=[];te.layers.forEach(t=>{const a=f.find(e=>e.serviceId===t.layerId);a&&B.networkInfo.lrsNetworkId===a.eventInfo.parentNetworkId&&e.push(a)}),Q((0,a.Immutable)(e))}},[te,B]);const Ce=a.React.useCallback(e=>{const t=g.attributeSet.find(t=>t.title===e);t&&ae(t),ee(e)},[]),Ae=a.React.useCallback(e=>{Y(e)},[]),Le=a.React.useMemo(()=>!!(Z&&K&&(0,c.isDefined)(h)&&(0,c.isDefined)(null==h?void 0:h.view)&&(null==h?void 0:h.view.ready)),[Z,K,h]),Me=a.React.useCallback(e=>{se(e),ye(!1),G(2)},[]),Ee=a.React.useCallback(e=>{e&&(E(),Oe()),G(0),de.current&&(0,a.focusElementInKeyboardMode)(de.current)},[]),Oe=a.React.useCallback(()=>{const e=(0,c.getInitialRouteInfoState)();se(e),Te(c.LockAction.Clear,e),oe(!0),setTimeout(()=>{oe(!1)},800)},[Te]),_e=a.React.useCallback(e=>{se(e),Te(c.LockAction.Release,e)},[Te]),Fe=a.React.useCallback((e,t)=>{ue(e)},[]),Pe=a.React.useCallback(()=>{var e;null===(e=pe.current)||void 0===e||e.handleNextClicked()},[]),Ve=a.React.useCallback(e=>{he(e)},[]),Ge=a.React.useCallback(e=>{be(e)},[]),Ue=a.React.useCallback(e=>{ve(e)},[]),We=a.React.useCallback(e=>{e&&(ye(e),setTimeout(()=>{ye(!1)},800))},[]),Be=a.React.useCallback((e,t,n)=>{e&&(E(),Oe()),G(t&&n&&!P?1:0),de.current&&(0,a.focusElementInKeyboardMode)(de.current)},[Oe,E]),ze=a.React.useCallback((e,t,a,n)=>yn(this,void 0,void 0,function*(){if(se(e),ye(!1),n){const n={routeId:e.routeId,fromMeasure:e.selectedMeasure,toMeasure:e.selectedMeasure},o=e.selectedFromDate,i=(0,c.isDefined)(e.selectedToDate)?e.selectedToDate:new Date(0xe677d21fdbff),s=yield(0,c.QueryRouteConcurrencies)(t,a,o,i,[n]),r=[];let l=!0,u=!0;const d=[];if(null==s||s.locations.forEach(t=>{d.includes(t.routeId)||d.push(t.routeId),t.concurrencies.forEach(t=>{d.includes(t.routeId)||d.push(t.routeId),t.isChosen=t.isDominant,t.isAdded=!1,(0,c.isDefined)(t.fromDate)&&!r.includes(t.fromDate)&&((!(0,c.isDefined)(e.selectedFromDate)||t.fromDate>=e.selectedFromDate)&&r.push(t.fromDate),(0,c.isDefined)(e.selectedFromDate)&&t.fromDate===e.selectedFromDate.getTime()&&(l=!1)),(0,c.isDefined)(t.toDate)&&!r.includes(t.toDate)&&((!(0,c.isDefined)(e.selectedToDate)||t.toDate<=e.selectedToDate)&&r.push(t.toDate),(0,c.isDefined)(e.selectedToDate)&&t.toDate===e.selectedToDate.getTime()&&(u=!1))})}),l&&(0,c.isDefined)(e.selectedFromDate)&&!r.includes(e.selectedFromDate)){const t=new Date(e.selectedFromDate.getFullYear(),e.selectedFromDate.getMonth(),e.selectedFromDate.getDate());r.push(t)}if(u&&(0,c.isDefined)(e.selectedToDate)&&!r.includes(e.selectedToDate)){const t=new Date(e.selectedToDate.getFullYear(),e.selectedToDate.getMonth(),e.selectedToDate.getDate());r.push(t)}r.sort((e,t)=>Number(e)-Number(t)),(0,c.isDefined)(e.selectedToDate)||r.push(null);const f=[];for(let e=0;e<r.length-1;e++){const t={fromDate:r[e],toDate:r[e+1]};f.push(t)}we(f);const h=new Map;if(d.length>0&&((null==a?void 0:a.useRouteName)||(null==a?void 0:a.supportsLines))){const e=(0,c.getRoutesByRouteIds)(d,a,t);yield Promise.all([e]).then(e=>{const t=null==e?void 0:e[0];(0,c.isDefined)(t)&&t.features.forEach(e=>{const t={};(null==a?void 0:a.useRouteName)&&(t.routeName=e.attributes[a.routeNameFieldSchema.jimuName]),(null==a?void 0:a.supportsLines)&&(t.lineId=e.attributes[a.lineIdFieldSchema.jimuName]);const n=e.attributes[a.routeIdFieldSchema.jimuName];h.has(n)||h.set(n,t)})})}const p={locations:[]};p.locations.push({routeId:null==s?void 0:s.locations[0].routeId,fromMeasure:null==s?void 0:s.locations[0].fromMeasure,toMeasure:null==s?void 0:s.locations[0].toMeasure,concurrencies:[]}),f.forEach(e=>{null==s||s.locations.forEach((t,n)=>{let o=!1;if(t.concurrencies.sort((e,t)=>e.fromMeasure-t.fromMeasure),t.concurrencies.forEach(t=>{if((!(0,c.isDefined)(t.fromDate)||(0,c.isDefined)(e.fromDate)&&t.fromDate<=e.fromDate)&&(!(0,c.isDefined)(t.toDate)||(0,c.isDefined)(e.toDate)&&e.toDate<=t.toDate)){const i={routeId:t.routeId,fromMeasure:an(t.fromMeasure,a.measurePrecision),toMeasure:an(t.toMeasure,a.measurePrecision),fromDate:e.fromDate,toDate:e.toDate,sectionId:t.sectionId,isDominant:t.isDominant,isChosen:t.isDominant,isAdded:!1};p.locations[n].concurrencies.push(i),o=!0}}),!o){const a={routeId:t.routeId,fromMeasure:t.fromMeasure,toMeasure:t.toMeasure,fromDate:e.fromDate,toDate:e.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};p.locations[n].concurrencies.push(a)}})}),h.size>0&&(null==p||p.locations.forEach(e=>{const t=h.get(e.routeId);e.routeName=t.routeName,e.lineId=t.lineId,e.concurrencies.forEach(e=>{const t=h.get(e.routeId);e.routeName=t.routeName,e.lineId=t.lineId})})),ve(p),s.locations.length>0&&s.locations[0].concurrencies.length>0&&!P?(Ie(!0),G(1)):(Ie(!1),G(2))}else G(2)}),[]);return(0,t.jsxs)("div",{className:"add-multiple-point-event h-100 d-flex",ref:de,tabIndex:-1,css:a.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .add-multiple-point-event-form {
      height: 100%;
    }
    .add-multiple-point-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-point-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsx)(Aa,{network:B,dataSourcesReady:ke,onCreateNetworkDs:je}),(0,t.jsx)(gn,{events:q,dataSourcesReady:xe}),!T&&(0,t.jsx)(l,{}),(0,t.jsxs)("div",{className:(0,a.classNames)("add-multiple-point-event__content",{"d-none":0!==V,[o.FOCUSABLE_CONTAINER_CLASS]:0===V}),children:[R&&(0,t.jsx)(c.LockManagerComponent,{intl:u,showAlert:!1,featureDS:U,lockInfo:le,networkName:null===(i=null==B?void 0:B.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:R,onQueryAndReleaseComplete:Fe,onMessageClear:()=>{Te(c.LockAction.None)}}),!k&&(0,t.jsx)(dn,{operationType:p,onOperationTypeChanged:O}),!w&&(0,t.jsx)(c.InlineEditableDropdown,{label:r("networkLabel"),isDisabled:1===m.length,defaultItem:(0,c.isDefined)(B)?B.name:"",listItems:m,onSelectionChanged:Ne}),!x&&(0,t.jsx)(c.InlineEditableDropdown,{label:r("attributeSetLabel"),isDisabled:1===g.attributeSet.length,defaultItem:X,listItems:(()=>{const e=[];return g.attributeSet.forEach(t=>{e.push(t.title)}),e})(),onSelectionChanged:Ce}),!j&&(0,t.jsx)(c.InlineEditableDropdown,{label:r("methodLabel"),isDisabled:!0,defaultItem:J,listItems:[c.SearchMethod.Measure],altItemDescriptions:[r("routeAndMeasure")],onSelectionChanged:Ae}),(0,t.jsx)(un,{ref:pe,intl:u,widgetId:d,network:B?B.networkInfo:null,routeInfoFromDataAction:L,isReady:Le,networkDS:U,method:J,reset:ne,jimuMapView:h,hoverGraphic:y,pickedGraphic:S,flashGraphic:I,lockAquired:!0,hideDates:N,useRouteStartEndDate:C,revalidateRouteFromDataAction:re,onResetDataAction:M,onsubmit:ze,onRouteInfoUpdate:_e,onValidationChanged:Ve,addToDominantRoute:De}),!_&&(0,t.jsx)(fn,{addToDominantRoute:De,onUpdateAddToDominantRoute:Ge})]}),(0,t.jsx)("div",{className:(0,a.classNames)("add-point-footer w-100",{"d-none":0!==V,[o.FOCUSABLE_CONTAINER_CLASS]:0===V}),children:(0,t.jsxs)("div",{className:"add-point-footer__action w-100 d-flex",children:[(0,t.jsx)(o.Label,{size:"sm",className:" mt-auto mr-auto title3",centric:!0,style:{color:null===(s=(0,hn.getTheme)())||void 0===s?void 0:s.sys.color.primary.main},onClick:Oe,children:r("resetForm")}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(o.Button,{className:"active",type:"primary","aria-label":r("nextLabel"),size:"sm",disabled:!fe,onClick:Pe,children:r("nextLabel")})})]})}),(0,t.jsx)("div",{className:(0,a.classNames)("add-multiple-point-event__content",{"d-none":1!==V,[o.FOCUSABLE_CONTAINER_CLASS]:1===V}),children:(0,t.jsx)(Ca,{intl:u,networkDS:U,network:B,routeInfo:ie,reset:ne||ge,conflictPreventionEnabled:!1,onNavBack:Ee,onNavNext:Me,concurrenciesResponse:me,onConcurrenciesResponseUpdated:Ue,onResetClicked:We,dateRanges:Re})}),(0,t.jsx)("div",{className:(0,a.classNames)("add-multiple-point-event__content",{"d-none":2!==V,[o.FOCUSABLE_CONTAINER_CLASS]:2===V}),children:(0,t.jsx)(bn,{intl:u,widgetId:d,networkDS:U,network:B,eventLayers:q,attributeSet:te,routeInfo:ie,reset:ne,isReady:Le,jimuMapView:h,hoverGraphic:y,conflictPreventionEnabled:R,onNavBack:Be,hasConcurrencies:Se,addToDominantRoute:De,concurrenciesResponse:me})})]})}var In=f(59620),Rn=function(e,t,a,n){return new(a||(a=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}c((n=n.apply(e,t||[])).next())})};function wn(){const t={networkLayers:[],eventLayers:[],intersectionLayers:[],attributeSets:{attributeSet:[]},defaultMethod:c.SearchMethod.Measure,defaultType:e.single,defaultAttributeSet:"",defaultEvent:{index:-1,name:""},defaultNetwork:{index:-1,name:""},hideMethod:!1,hideEvent:!1,hideNetwork:!1,hideType:!1,hideAttributeSet:!1,hideDates:!1,useRouteStartEndDate:!1,hideAddToDominantRouteOption:!1,enableAddToDominantRouteOption:!1,notAllowOverrideEventReplacement:!1};return(0,a.Immutable)(t)}var jn=f(4108),kn=function(e,t,a,n){return new(a||(a=Promise))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(s,r)}c((n=n.apply(e,t||[])).next())})};class xn extends a.React.PureComponent{constructor(t){super(t),this.supportedLrsLayerTypes=(0,a.Immutable)([c.LrsLayerType.Network,c.LrsLayerType.Event,c.LrsLayerType.PointEvent,c.LrsLayerType.Intersection]),this.setSettingsPerView=()=>kn(this,void 0,void 0,function*(){var t,n;const{config:o}=this.props,i=o.mode&&o.mode!==c.ModeType.Map?o.lrsLayers:this.state.activeLrsLayers,s=!(0,c.isDefined)(null===(t=o.settingsPerView)||void 0===t?void 0:t[this.state.activeMapViewId]);let r=(null===(n=o.settingsPerView)||void 0===n?void 0:n[this.state.activeMapViewId])||wn();if(i&&i.length>0){r=yield function(t,n,o){return Rn(this,arguments,void 0,function*(t,n,o,i=!1){if(o){const e=n.filter(e=>e.layerType===c.LrsLayerType.Network).map(e=>e.name),a=n.filter(e=>(0,c.isPointEvent)(e)).map(e=>e.name),o=n.filter(e=>e.layerType===c.LrsLayerType.Intersection).map(e=>e.name);t=t.set("networkLayers",e).set("eventLayers",a).set("intersectionLayers",o)}if(i){const e=n.find(e=>e.layerType===c.LrsLayerType.Network);if((0,c.isDefined)(e)){const n=(0,a.getAppStore)().getState().portalUrl,o=yield(0,c.getAttributeSets)(e.lrsUrl,n,!0,!0);t=t.setIn(["attributeSets"],o)}}const s=(0,c.getDefaultEvent)(n,t.defaultEvent,!0),r=(0,c.getDefaultNetwork)(n,t.defaultNetwork),l=(0,c.getDefaultAttributeSet)(null==t?void 0:t.attributeSets,t.defaultAttributeSet,!0);return t.set("defaultNetwork",r).set("defaultEvent",s).set("defaultAttributeSet",l).set("defaultMethod",t.defaultMethod||c.SearchMethod.Measure).set("defaultType",t.defaultType||e.single).set("hideMethod",t.hideMethod||!1).set("hideEvent",t.hideEvent||!1).set("hideNetwork",t.hideNetwork||!1).set("hideType",t.hideType||!1).set("hideAttributeSet",t.hideAttributeSet||!1).set("hideDates",t.hideDates||!1).set("useRouteStartEndDate",t.useRouteStartEndDate||!1).set("attributeSets",t.attributeSets||(0,a.Immutable)({attributeSet:[]}))})}(r,i,!0,s),this.setState({settingPerView:r});const t=o.setIn(["settingsPerView",this.state.activeMapViewId],r);(0,jn.getAppConfigAction)().editWidgetConfig(this.props.id,t).exec()}}),this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally(()=>{this.setState({jimuMapView:e})})},this.waitForChildDataSourcesReady=e=>kn(this,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const t=a.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==t?void 0:t.isDataSourceSet())&&!t.areChildDataSourcesCreated()?t.childDataSourcesReady().then(()=>t).catch(e=>t):Promise.resolve(t)}),this.handleOperationTypeChange=e=>{this.setState({operationType:e}),this.clearGraphics()},this.getI18nMessage=(e,t)=>{const a=Object.assign({},n,o.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:a[e]},t)},this.handleLrsLayersChanged=e=>{this.setState({activeLrsLayers:e})},this.handleViewChange=t=>{t&&this.setState({activeMapViewId:t.id});const a=(0,c.getConfigValue)(this.props.config,"defaultType",this.state.activeMapViewId,e.single);this.setState({operationType:a})},this.state={hideTitle:!1,jimuMapView:void 0,operationType:e.single,hoverGraphic:null,pickedGraphic:null,flashGraphic:null,routeInfoFromDataAction:null,networkDataSourceFromDataAction:null,activeMapViewId:"",activeLrsLayers:this.props.config.lrsLayers,settingPerView:wn(),isConflictPreventionEnabled:!1},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentDidMount(){var t,a;(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.selectedDataSource)?this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource}):(null===(a=this.props.mutableStatePropsVersion)||void 0===a?void 0:a.selectedRouteInfo)&&this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo});const n=(0,c.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:n}),this.setState({operationType:this.props.config.defaultType||e.single}),this.setSettingsPerView()}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(t,n){var o,i,s,r,l,u,d,f,h,p;n.jimuMapView!==this.state.jimuMapView&&(0,c.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers());const m=null===(s=null===(i=null===(o=(0,a.getAppStore)())||void 0===o?void 0:o.getState())||void 0===i?void 0:i.widgetsRuntimeInfo[this.props.id])||void 0===s?void 0:s.state;if((m===a.WidgetState.Opened||!m)&&((null===(r=this.props)||void 0===r?void 0:r.selectedNetworkDataSource)&&(t&&t.mutableStatePropsVersion&&t.mutableStatePropsVersion.selectedNetworkDataSource&&(null===(l=null==t?void 0:t.mutableStatePropsVersion)||void 0===l?void 0:l.selectedNetworkDataSource)===(null===(u=this.props.mutableStatePropsVersion)||void 0===u?void 0:u.selectedNetworkDataSource)||this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource})),null===(d=this.props)||void 0===d?void 0:d.selectedRouteInfo)){!(null===(f=this.props)||void 0===f?void 0:f.selectedRouteInfo)||t&&t.mutableStatePropsVersion&&t.mutableStatePropsVersion.selectedRouteInfo&&(null===(h=null==t?void 0:t.mutableStatePropsVersion)||void 0===h?void 0:h.selectedRouteInfo)===(null===(p=this.props.mutableStatePropsVersion)||void 0===p?void 0:p.selectedRouteInfo)||this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo})}if(this.state.activeLrsLayers!==n.activeLrsLayers){const t=(0,c.getConfigValue)(this.props.config,"defaultType",this.state.activeMapViewId,e.single);this.setState({operationType:t})}this.state.activeLrsLayers!==n.activeLrsLayers&&this.setSettingsPerView();const{config:v}=this.props,D=v.mode&&v.mode!==c.ModeType.Map?v.lrsLayers:this.state.activeLrsLayers;D.length>0&&(0,c.checkConflictPrevention)(D[0].lrsUrl).then(e=>{const t=null!==e&&e;this.state.isConflictPreventionEnabled!==t&&this.setState({isConflictPreventionEnabled:t})})}removeGraphicLayers(){(0,c.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,c.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,c.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,c.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const a=new In.default({listMode:"hide"}),n=new In.default({listMode:"hide"}),o=new In.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([n,o,a]),this.setState({hoverGraphic:a}),this.setState({pickedGraphic:n}),this.setState({flashGraphic:o})}}clearGraphics(){(0,c.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,c.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,c.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}resetDataAction(){this.setState({routeInfoFromDataAction:null}),this.setState({networkDataSourceFromDataAction:null})}getConfigValues(e,t,a){const n={networkLayers:t.networkLayers,eventLayers:t.eventLayers,intersectionLayers:t.intersectionLayers,defaultEvent:t.defaultEvent,defaultNetwork:t.defaultNetwork,defaultMethod:t.defaultMethod,defaultAttributeSet:t.defaultAttributeSet,attributeSets:t.attributeSets,hideEvent:t.hideEvent,hideNetwork:t.hideNetwork,hideType:t.hideType,hideMethod:t.hideMethod,hideAttributeSet:t.hideAttributeSet,hideMeasures:t.hideMeasures,hideDates:t.hideDates,useRouteStartEndDate:t.useRouteStartEndDate,hideAddToDominantRouteOption:t.hideAddToDominantRouteOption,enableAddToDominantRouteOption:t.enableAddToDominantRouteOption,notAllowOverrideEventReplacement:t.notAllowOverrideEventReplacement};return Object.entries(n).reduce((t,[n,o])=>(t[n]=(0,c.getConfigValue)(e,n,a,o),t),{})}render(){var n,i;const{config:l,id:u,intl:d}=this.props;let{useMapWidgetIds:f}=this.props;const{mapViewsConfig:h}=l,p=l.mode&&l.mode!==c.ModeType.Map?l.lrsLayers:this.state.activeLrsLayers,m=this.getConfigValues(l,this.state.settingPerView,this.state.activeMapViewId),{networkLayers:v,eventLayers:D,intersectionLayers:b,defaultEvent:g,defaultNetwork:y,defaultMethod:S,defaultAttributeSet:I,attributeSets:R,hideEvent:w,hideNetwork:j,hideType:k,hideMethod:x,hideAttributeSet:N,hideDates:T,useRouteStartEndDate:C,hideAddToDominantRouteOption:A,enableAddToDominantRouteOption:L,notAllowOverrideEventReplacement:M}=m,E=(0,c.getModeType)(l.mode,p),{jimuMapView:O,operationType:_}=this.state,F=v&&v.length>0&&D&&D.length>0;if(!f){const e=null===(i=null===(n=(0,a.getAppStore)())||void 0===n?void 0:n.getState())||void 0===i?void 0:i.appConfig;f=(0,c.findFirstArcgisMapWidgetId)(e)}return(0,t.jsx)(o.Paper,{variant:"flat",shape:"none",className:"jimu-widget runtime-add-point-event surface-1 border-0",children:(0,t.jsxs)("div",{id:this.widgetOuterDivId,className:"widget-outer-div h-100 w-100 d-flex",children:[(0,t.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null==f?void 0:f[0],onActiveViewChange:this.onActiveViewChange}),E&&(0,t.jsx)(c.MapViewLoader,{config:l,widgetId:u,supportedLrsLayerTypes:this.supportedLrsLayerTypes,useMapWidgetIds:f,mapViewsConfig:h,jimuMapView:O,outputDataSourceType:"none",onLrsLayersChanged:this.handleLrsLayersChanged,onViewChange:this.handleViewChange}),_===e.single&&F&&(0,t.jsx)(mn,{intl:d,widgetId:u,lrsLayers:p,JimuMapView:O,operationType:_,onOperationTypeChanged:this.handleOperationTypeChange,eventLayers:D,networkLayers:v,instersectionLayers:b,defaultEvent:g,defaultMethod:S,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:this.state.isConflictPreventionEnabled,hideEvent:w,hideNetwork:j,hideType:k,hideMethod:x,hideDates:T,hideTitle:this.state.hideTitle,useRouteStartEndDate:C,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphic:this.clearGraphics.bind(this),hideAddToDominantRouteOption:A,enableAddToDominantRouteOption:L,notAllowOverrideEventReplacement:M}),_===e.multiple&&F&&(0,t.jsx)(Sn,{intl:d,widgetId:u,lrsLayers:p,jimuMapView:this.state.jimuMapView,operationType:_,onOperationTypeChanged:this.handleOperationTypeChange,networkLayers:v,defaultNetwork:y,defaultMethod:S,defaultAttributeSet:I,attributeSets:R,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:this.state.isConflictPreventionEnabled,hideNetwork:j,hideMethod:x,hideType:k,hideAttributeSet:N,hideDates:T,hideTitle:this.state.hideTitle,useRouteStartEndDate:C,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphic:this.clearGraphics.bind(this),hideAddToDominantRouteOption:A,enableAddToDominantRouteOption:L,notAllowOverrideEventReplacement:M}),!F&&(0,t.jsx)(o.WidgetPlaceholder,{icon:s(),widgetId:u,message:this.getI18nMessage("_widgetLabel")})]})})}}xn.mapExtraStateProps=(e,t)=>{var a,n;return{selectedRouteInfo:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedRouteInfo,selectedNetworkDataSource:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.selectedNetworkDataSource}};const Nn=xn;function Tn(e){f.p=e}})(),h})())}}});