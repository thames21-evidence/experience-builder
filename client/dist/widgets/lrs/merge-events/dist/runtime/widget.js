System.register(["jimu-core/emotion","jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-arcgis","jimu-core/react","esri/geometry/operators/disjointOperator","jimu-ui/basic/list-tree","calcite-components","jimu-theme","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/Graphic","jimu-for-builder"],function(e,t){var n={},i={},a={},s={},r={},o={},c={},l={},u={},d={},f={},v={},h={},p={};return{setters:[function(e){n.jsx=e.jsx,n.jsxs=e.jsxs},function(e){i.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceSelectionMode=e.DataSourceSelectionMode,i.DataSourceStatus=e.DataSourceStatus,i.Immutable=e.Immutable,i.JSAPILayerTypes=e.JSAPILayerTypes,i.MessageManager=e.MessageManager,i.React=e.React,i.RecordSetChangeType=e.RecordSetChangeType,i.SupportedJSAPILayerTypes=e.SupportedJSAPILayerTypes,i.WidgetState=e.WidgetState,i.css=e.css,i.getAppStore=e.getAppStore,i.hooks=e.hooks},function(e){a.AttributeTable=e.AttributeTable,a.GetUnits=e.GetUnits,a.IsRouteReversed=e.IsRouteReversed,a.LockAction=e.LockAction,a.LockManagerComponent=e.LockManagerComponent,a.LrsApplyEdits=e.LrsApplyEdits,a.LrsLayerType=e.LrsLayerType,a.MapViewLoader=e.MapViewLoader,a.ModeType=e.ModeType,a.checkConflictPrevention=e.checkConflictPrevention,a.findFirstArcgisMapWidgetId=e.findFirstArcgisMapWidgetId,a.flash=e.flash,a.formatMessage=e.formatMessage,a.getCalciteBasicTheme=e.getCalciteBasicTheme,a.getConfigValue=e.getConfigValue,a.getDateToUTC=e.getDateToUTC,a.getDateWithRouteTime=e.getDateWithRouteTime,a.getDateWithTZOffset=e.getDateWithTZOffset,a.getDateWithoutTZOffset=e.getDateWithoutTZOffset,a.getDateWithoutTime=e.getDateWithoutTime,a.getDefaultEvent=e.getDefaultEvent,a.getGeometryGraphic=e.getGeometryGraphic,a.getInitialRouteInfoState=e.getInitialRouteInfoState,a.getIntialLocksInfo=e.getIntialLocksInfo,a.getModeType=e.getModeType,a.getNetworkOutFields=e.getNetworkOutFields,a.getSimpleLineGraphic=e.getSimpleLineGraphic,a.getSimplePointGraphic=e.getSimplePointGraphic,a.isDate=e.isDate,a.isDefined=e.isDefined,a.isInWidgetController=e.isInWidgetController,a.isLineEvent=e.isLineEvent,a.isNumber=e.isNumber,a.queryAllRoutesByLineIdAndFromDate=e.queryAllRoutesByLineIdAndFromDate,a.queryEventsByEventObjectIds=e.queryEventsByEventObjectIds,a.queryRouteId=e.queryRouteId,a.queryRouteIds=e.queryRouteIds,a.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,a.useEditSession=e.useEditSession,a.useVmsManager=e.useVmsManager,a.validateField=e.validateField,a.validateRangeDomain=e.validateRangeDomain,a.waitTime=e.waitTime},function(e){s.Alert=e.Alert,s.Button=e.Button,s.Checkbox=e.Checkbox,s.Label=e.Label,s.Option=e.Option,s.Paper=e.Paper,s.Select=e.Select,s.Tooltip=e.Tooltip,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.useImperativeHandle=e.useImperativeHandle},function(){},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType},function(e){u.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){d.getTheme=e.getTheme},function(e){f.default=e.default},function(e){v.default=e.default},function(e){h.default=e.default},function(e){p.getAppConfigAction=e.getAppConfigAction}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=d},4108:e=>{"use strict";e.exports=p},10624:e=>{"use strict";e.exports=v},14321:e=>{"use strict";e.exports=s},22089:e=>{"use strict";e.exports=h},36614:e=>{"use strict";e.exports=c},40828:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M2 1h8a1 1 0 0 1 1 1h1a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h4.5v-1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1M11 12h-1v3h7v2h1v-3h-7z"></path><path fill="#000" d="M7.5 6H9v2h1V5H7.5zM4.5 5H3V3H2v3h2.5zM5.5 2v7h1V2zM11 4.5h3A1.5 1.5 0 0 1 15.5 6v2.293l-1.646-1.647-.707.708L16 10.207l2.854-2.853-.707-.708L16.5 8.293V6A2.5 2.5 0 0 0 14 3.5h-3z"></path><path fill="#000" d="M19 11a1 1 0 0 0-.81-.982l.771-.772A2 2 0 0 1 20 11v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3l1 1h-4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1z"></path></svg>'},47626:e=>{"use strict";e.exports=a},59620:e=>{"use strict";e.exports=f},62686:e=>{"use strict";e.exports=r},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=n},68972:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i},98640:e=>{"use strict";e.exports=l},99037:e=>{"use strict";e.exports=u}},t={};function m(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,m),a.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var n in t)m.o(t,n)&&!m.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var y={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(y),m.d(y,{__set_webpack_public_path__:()=>Oi,default:()=>Ri});var e=m(67386),t=m(79244),n=m(47626);function i(e,t,i,a,s,r,o,c,l,u){let d;if(1===t.length)d=i("selectAtLeastTwoEvents");else if(t.length>0)if(a.eventInfo.canSpanRoutes){const o=[];for(let e=0;e<t.length;e++){const n=t[e].attributes[a.eventInfo.routeIdFieldName];o.push(n);const i=t[e].attributes[a.eventInfo.toRouteIdFieldName];o.push(i)}const c={};(0,n.queryRouteIds)(o,s.networkInfo,r).then(r=>{if((0,n.isDefined)(r)){let o;const l=(0,n.getNetworkOutFields)(s.networkInfo);for(let e=0;e<r.features.length;e++){const t=r.features[e].attributes[l.lineIdFieldName],a=r.features[e].attributes[l.lineOrderFieldName],s=r.features[e].attributes[l.routeIdFieldName];if(c[s]=a,(0,n.isDefined)(o)){if(o!==t){d=i("eventsNotOnSameLine");break}}else o=t}e&&(t.forEach(e=>{e.attributes.fromLineOrder=c[e.attributes[a.eventInfo.routeIdFieldName]],e.attributes.toLineOrder=c[e.attributes[a.eventInfo.toRouteIdFieldName]]}),t.sort((e,t)=>e.attributes.fromLineOrder-t.attributes.fromLineOrder||e.attributes.toLineOrder-t.attributes.toLineOrder||e.attributes[a.eventInfo.fromMeasureFieldName]-t.attributes[a.eventInfo.fromMeasureFieldName]))}})}else{let s;for(let e=0;e<t.length;e++){const r=t[e].attributes[a.eventInfo.routeIdFieldName];if((0,n.isDefined)(s)){if(s!==r){d=i("eventsNotOnSameRoute");break}}else s=r}e&&t.sort((e,t)=>e.attributes[a.eventInfo.fromMeasureFieldName]-t.attributes[a.eventInfo.fromMeasureFieldName])}return(0,n.isDefined)(d)&&d.length>0&&"success"!==o?(c("error"),l(d),u(!0),setTimeout(()=>{u(!1)},5e3),Promise.resolve(!1)):Promise.resolve(!0)}const a={_widgetLabel:"Merge Events",eventLabel:"Event",eventListLabel:"Events to Merge *",preserveLabel:" (preserve)",selectButtonLabel:"Change event selection",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",startDateLabel:"Start Date",endDateLabel:"End Date",useStartDateLabel:"Use route start date",useEndDateLabel:"Use route end date",mergeLabel:"Merge",eventMerged:"Event Merged",invalidFromDateBefore:"From date is before route's from date",invalidFromDateAfter:"From date is after route's to date",invalidToDateBefore:"To date is before route's from date",invalidToDateAfter:"To date is after route's to date",invalidDatesOrder:"Selected from date is greater than selected to date",invalidDatesSameDay:"From and to dates cannot be the same",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",mergedEventAttributesLabel:"Merged Event Attributes",eventsNotCoincident:"Unable to merge non-coincident events.",eventNotOverlapMergeDates:"The following event object ID(s) must overlap between Merge Dates:\n{objectIds}",eventsNotOnSameRoute:"The selected events are not on the same route.",eventsNotOnSameLine:"The selected events are not on the same line.",selectAtLeastTwoEvents:"Select at least two events to merge.",eventsToDateNotNull:"The following event object ID(s) must have null in To Date:\n{objectIds}",eventsNotActiveToday:"The following event object ID(s) must be active today:\n{objectIds}",chooseEventsFromMap:"(Choose events from map)",invalidContingentValues:"Attribute do not satisfy a required Contingent Value: {groupNames}",contingentValueError:"Invalid contingent value in the field"};var s=m(14321),r=m(40828),o=m.n(r),c=m(62686);function l(){const n=t.hooks.useTranslation(a);return(0,e.jsx)("div",{className:"merge-events-form-header",children:(0,e.jsx)("div",{className:"merge-events-form-header__header pt-3 px-3 align-items-center",children:(0,e.jsx)("div",{className:"merge-events_title d-flex align-items-center text-truncate",css:t.css`font-weight: 500; font-size: 14px;`,children:(0,e.jsx)("div",{className:"text-truncate",children:n("_widgetLabel")})})})})}const u=function(){this.__data__=[],this.size=0};const d=function(e,t){return e===t||e!=e&&t!=t};const f=function(e,t){for(var n=e.length;n--;)if(d(e[n][0],t))return n;return-1};var v=Array.prototype.splice;const h=function(e){var t=this.__data__,n=f(t,e);return!(n<0)&&(n==t.length-1?t.pop():v.call(t,n,1),--this.size,!0)};const p=function(e){var t=this.__data__,n=f(t,e);return n<0?void 0:t[n][1]};const g=function(e){return f(this.__data__,e)>-1};const b=function(e,t){var n=this.__data__,i=f(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this};function I(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}I.prototype.clear=u,I.prototype.delete=h,I.prototype.get=p,I.prototype.has=g,I.prototype.set=b;const D=I;const S=function(){this.__data__=new D,this.size=0};const w=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const L=function(e){return this.__data__.get(e)};const j=function(e){return this.__data__.has(e)};const T="object"==typeof global&&global&&global.Object===Object&&global;var E="object"==typeof self&&self&&self.Object===Object&&self;const k=T||E||Function("return this")();const N=k.Symbol;var F=Object.prototype,M=F.hasOwnProperty,x=F.toString,A=N?N.toStringTag:void 0;const R=function(e){var t=M.call(e,A),n=e[A];try{e[A]=void 0;var i=!0}catch(e){}var a=x.call(e);return i&&(t?e[A]=n:delete e[A]),a};var O=Object.prototype.toString;const C=function(e){return O.call(e)};var P=N?N.toStringTag:void 0;const _=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":P&&P in Object(e)?R(e):C(e)};const G=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const V=function(e){if(!G(e))return!1;var t=_(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const U=k["__core-js_shared__"];var W,B=(W=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"";const z=function(e){return!!B&&B in e};var q=Function.prototype.toString;const J=function(e){if(null!=e){try{return q.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Q=/^\[object .+?Constructor\]$/,Z=Function.prototype,H=Object.prototype,$=Z.toString,K=H.hasOwnProperty,X=RegExp("^"+$.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Y=function(e){return!(!G(e)||z(e))&&(V(e)?X:Q).test(J(e))};const ee=function(e,t){return null==e?void 0:e[t]};const te=function(e,t){var n=ee(e,t);return Y(n)?n:void 0};const ne=te(k,"Map");const ie=te(Object,"create");const ae=function(){this.__data__=ie?ie(null):{},this.size=0};const se=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var re=Object.prototype.hasOwnProperty;const oe=function(e){var t=this.__data__;if(ie){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return re.call(t,e)?t[e]:void 0};var ce=Object.prototype.hasOwnProperty;const le=function(e){var t=this.__data__;return ie?void 0!==t[e]:ce.call(t,e)};const ue=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ie&&void 0===t?"__lodash_hash_undefined__":t,this};function de(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}de.prototype.clear=ae,de.prototype.delete=se,de.prototype.get=oe,de.prototype.has=le,de.prototype.set=ue;const fe=de;const ve=function(){this.size=0,this.__data__={hash:new fe,map:new(ne||D),string:new fe}};const he=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const pe=function(e,t){var n=e.__data__;return he(t)?n["string"==typeof t?"string":"hash"]:n.map};const me=function(e){var t=pe(this,e).delete(e);return this.size-=t?1:0,t};const ye=function(e){return pe(this,e).get(e)};const ge=function(e){return pe(this,e).has(e)};const be=function(e,t){var n=pe(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this};function Ie(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}Ie.prototype.clear=ve,Ie.prototype.delete=me,Ie.prototype.get=ye,Ie.prototype.has=ge,Ie.prototype.set=be;const De=Ie;const Se=function(e,t){var n=this.__data__;if(n instanceof D){var i=n.__data__;if(!ne||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new De(i)}return n.set(e,t),this.size=n.size,this};function we(e){var t=this.__data__=new D(e);this.size=t.size}we.prototype.clear=S,we.prototype.delete=w,we.prototype.get=L,we.prototype.has=j,we.prototype.set=Se;const Le=we;const je=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e};const Te=function(){try{var e=te(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const Ee=function(e,t,n){"__proto__"==t&&Te?Te(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var ke=Object.prototype.hasOwnProperty;const Ne=function(e,t,n){var i=e[t];ke.call(e,t)&&d(i,n)&&(void 0!==n||t in e)||Ee(e,t,n)};const Fe=function(e,t,n,i){var a=!n;n||(n={});for(var s=-1,r=t.length;++s<r;){var o=t[s],c=i?i(n[o],e[o],o,n,e):void 0;void 0===c&&(c=e[o]),a?Ee(n,o,c):Ne(n,o,c)}return n};const Me=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i};const xe=function(e){return null!=e&&"object"==typeof e};const Ae=function(e){return xe(e)&&"[object Arguments]"==_(e)};var Re=Object.prototype,Oe=Re.hasOwnProperty,Ce=Re.propertyIsEnumerable,Pe=Ae(function(){return arguments}())?Ae:function(e){return xe(e)&&Oe.call(e,"callee")&&!Ce.call(e,"callee")};const _e=Pe;const Ge=Array.isArray;const Ve=function(){return!1};var Ue="object"==typeof exports&&exports&&!exports.nodeType&&exports,We=Ue&&"object"==typeof module&&module&&!module.nodeType&&module,Be=We&&We.exports===Ue?k.Buffer:void 0;const ze=(Be?Be.isBuffer:void 0)||Ve;var qe=/^(?:0|[1-9]\d*)$/;const Je=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&qe.test(e))&&e>-1&&e%1==0&&e<t};const Qe=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Ze={};Ze["[object Float32Array]"]=Ze["[object Float64Array]"]=Ze["[object Int8Array]"]=Ze["[object Int16Array]"]=Ze["[object Int32Array]"]=Ze["[object Uint8Array]"]=Ze["[object Uint8ClampedArray]"]=Ze["[object Uint16Array]"]=Ze["[object Uint32Array]"]=!0,Ze["[object Arguments]"]=Ze["[object Array]"]=Ze["[object ArrayBuffer]"]=Ze["[object Boolean]"]=Ze["[object DataView]"]=Ze["[object Date]"]=Ze["[object Error]"]=Ze["[object Function]"]=Ze["[object Map]"]=Ze["[object Number]"]=Ze["[object Object]"]=Ze["[object RegExp]"]=Ze["[object Set]"]=Ze["[object String]"]=Ze["[object WeakMap]"]=!1;const He=function(e){return xe(e)&&Qe(e.length)&&!!Ze[_(e)]};const $e=function(e){return function(t){return e(t)}};var Ke="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xe=Ke&&"object"==typeof module&&module&&!module.nodeType&&module,Ye=Xe&&Xe.exports===Ke&&T.process;const et=function(){try{var e=Xe&&Xe.require&&Xe.require("util").types;return e||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}();var tt=et&&et.isTypedArray;const nt=tt?$e(tt):He;var it=Object.prototype.hasOwnProperty;const at=function(e,t){var n=Ge(e),i=!n&&_e(e),a=!n&&!i&&ze(e),s=!n&&!i&&!a&&nt(e),r=n||i||a||s,o=r?Me(e.length,String):[],c=o.length;for(var l in e)!t&&!it.call(e,l)||r&&("length"==l||a&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Je(l,c))||o.push(l);return o};var st=Object.prototype;const rt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||st)};const ot=function(e,t){return function(n){return e(t(n))}};const ct=ot(Object.keys,Object);var lt=Object.prototype.hasOwnProperty;const ut=function(e){if(!rt(e))return ct(e);var t=[];for(var n in Object(e))lt.call(e,n)&&"constructor"!=n&&t.push(n);return t};const dt=function(e){return null!=e&&Qe(e.length)&&!V(e)};const ft=function(e){return dt(e)?at(e):ut(e)};const vt=function(e,t){return e&&Fe(t,ft(t),e)};const ht=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var pt=Object.prototype.hasOwnProperty;const mt=function(e){if(!G(e))return ht(e);var t=rt(e),n=[];for(var i in e)("constructor"!=i||!t&&pt.call(e,i))&&n.push(i);return n};const yt=function(e){return dt(e)?at(e,!0):mt(e)};const gt=function(e,t){return e&&Fe(t,yt(t),e)};var bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,It=bt&&"object"==typeof module&&module&&!module.nodeType&&module,Dt=It&&It.exports===bt?k.Buffer:void 0,St=Dt?Dt.allocUnsafe:void 0;const wt=function(e,t){if(t)return e.slice();var n=e.length,i=St?St(n):new e.constructor(n);return e.copy(i),i};const Lt=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t};const jt=function(e,t){for(var n=-1,i=null==e?0:e.length,a=0,s=[];++n<i;){var r=e[n];t(r,n,e)&&(s[a++]=r)}return s};const Tt=function(){return[]};var Et=Object.prototype.propertyIsEnumerable,kt=Object.getOwnPropertySymbols;const Nt=kt?function(e){return null==e?[]:(e=Object(e),jt(kt(e),function(t){return Et.call(e,t)}))}:Tt;const Ft=function(e,t){return Fe(e,Nt(e),t)};const Mt=function(e,t){for(var n=-1,i=t.length,a=e.length;++n<i;)e[a+n]=t[n];return e};const xt=ot(Object.getPrototypeOf,Object);const At=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Mt(t,Nt(e)),e=xt(e);return t}:Tt;const Rt=function(e,t){return Fe(e,At(e),t)};const Ot=function(e,t,n){var i=t(e);return Ge(e)?i:Mt(i,n(e))};const Ct=function(e){return Ot(e,ft,Nt)};const Pt=function(e){return Ot(e,yt,At)};const _t=te(k,"DataView");const Gt=te(k,"Promise");const Vt=te(k,"Set");const Ut=te(k,"WeakMap");var Wt="[object Map]",Bt="[object Promise]",zt="[object Set]",qt="[object WeakMap]",Jt="[object DataView]",Qt=J(_t),Zt=J(ne),Ht=J(Gt),$t=J(Vt),Kt=J(Ut),Xt=_;(_t&&Xt(new _t(new ArrayBuffer(1)))!=Jt||ne&&Xt(new ne)!=Wt||Gt&&Xt(Gt.resolve())!=Bt||Vt&&Xt(new Vt)!=zt||Ut&&Xt(new Ut)!=qt)&&(Xt=function(e){var t=_(e),n="[object Object]"==t?e.constructor:void 0,i=n?J(n):"";if(i)switch(i){case Qt:return Jt;case Zt:return Wt;case Ht:return Bt;case $t:return zt;case Kt:return qt}return t});const Yt=Xt;var en=Object.prototype.hasOwnProperty;const tn=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&en.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const nn=k.Uint8Array;const an=function(e){var t=new e.constructor(e.byteLength);return new nn(t).set(new nn(e)),t};const sn=function(e,t){var n=t?an(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var rn=/\w*$/;const on=function(e){var t=new e.constructor(e.source,rn.exec(e));return t.lastIndex=e.lastIndex,t};var cn=N?N.prototype:void 0,ln=cn?cn.valueOf:void 0;const un=function(e){return ln?Object(ln.call(e)):{}};const dn=function(e,t){var n=t?an(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const fn=function(e,t,n){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return an(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return sn(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return dn(e,n);case"[object Map]":case"[object Set]":return new i;case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return on(e);case"[object Symbol]":return un(e)}};var vn=Object.create;const hn=function(){function e(){}return function(t){if(!G(t))return{};if(vn)return vn(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const pn=function(e){return"function"!=typeof e.constructor||rt(e)?{}:hn(xt(e))};const mn=function(e){return xe(e)&&"[object Map]"==Yt(e)};var yn=et&&et.isMap;const gn=yn?$e(yn):mn;const bn=function(e){return xe(e)&&"[object Set]"==Yt(e)};var In=et&&et.isSet;const Dn=In?$e(In):bn;var Sn="[object Arguments]",wn="[object Function]",Ln="[object Object]",jn={};jn[Sn]=jn["[object Array]"]=jn["[object ArrayBuffer]"]=jn["[object DataView]"]=jn["[object Boolean]"]=jn["[object Date]"]=jn["[object Float32Array]"]=jn["[object Float64Array]"]=jn["[object Int8Array]"]=jn["[object Int16Array]"]=jn["[object Int32Array]"]=jn["[object Map]"]=jn["[object Number]"]=jn[Ln]=jn["[object RegExp]"]=jn["[object Set]"]=jn["[object String]"]=jn["[object Symbol]"]=jn["[object Uint8Array]"]=jn["[object Uint8ClampedArray]"]=jn["[object Uint16Array]"]=jn["[object Uint32Array]"]=!0,jn["[object Error]"]=jn[wn]=jn["[object WeakMap]"]=!1;const Tn=function e(t,n,i,a,s,r){var o,c=1&n,l=2&n,u=4&n;if(i&&(o=s?i(t,a,s,r):i(t)),void 0!==o)return o;if(!G(t))return t;var d=Ge(t);if(d){if(o=tn(t),!c)return Lt(t,o)}else{var f=Yt(t),v=f==wn||"[object GeneratorFunction]"==f;if(ze(t))return wt(t,c);if(f==Ln||f==Sn||v&&!s){if(o=l||v?{}:pn(t),!c)return l?Rt(t,gt(o,t)):Ft(t,vt(o,t))}else{if(!jn[f])return s?t:{};o=fn(t,f,c)}}r||(r=new Le);var h=r.get(t);if(h)return h;r.set(t,o),Dn(t)?t.forEach(function(a){o.add(e(a,n,i,a,t,r))}):gn(t)&&t.forEach(function(a,s){o.set(s,e(a,n,i,s,t,r))});var p=d?void 0:(u?l?Pt:Ct:l?yt:ft)(t);return je(p||t,function(a,s){p&&(a=t[s=a]),Ne(o,s,e(a,n,i,s,t,r))}),o};const En=function(e){return Tn(e,5)};var kn=/\s/;const Nn=function(e){for(var t=e.length;t--&&kn.test(e.charAt(t)););return t};var Fn=/^\s+/;const Mn=function(e){return e?e.slice(0,Nn(e)+1).replace(Fn,""):e};const xn=function(e){return"symbol"==typeof e||xe(e)&&"[object Symbol]"==_(e)};var An=/^[-+]0x[0-9a-f]+$/i,Rn=/^0b[01]+$/i,On=/^0o[0-7]+$/i,Cn=parseInt;const Pn=function(e){if("number"==typeof e)return e;if(xn(e))return NaN;if(G(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=G(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Mn(e);var n=Rn.test(e);return n||On.test(e)?Cn(e.slice(2),n?2:8):An.test(e)?NaN:+e};var _n=1/0;const Gn=function(e){return e?(e=Pn(e))===_n||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Vn=function(e){var t=Gn(e),n=t%1;return t==t?n?t-n:t:0};const Un=function(e,t){for(var n=-1,i=null==e?0:e.length,a=Array(i);++n<i;)a[n]=t(e[n],n,e);return a};var Wn=N?N.prototype:void 0,Bn=Wn?Wn.toString:void 0;const zn=function e(t){if("string"==typeof t)return t;if(Ge(t))return Un(t,e)+"";if(xn(t))return Bn?Bn.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const qn=function(e){return null==e?"":zn(e)};var Jn=k.isFinite,Qn=Math.min;const Zn=function(e){var t=Math[e];return function(e,n){if(e=Pn(e),(n=null==n?0:Qn(Vn(n),292))&&Jn(e)){var i=(qn(e)+"e").split("e"),a=t(i[0]+"e"+(+i[1]+n));return+((i=(qn(a)+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}("round"),Hn="#00FFFF",$n="#008000";var Kn=m(68972);var Xn;!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(Xn||(Xn={}));var Yn,ei,ti,ni,ii,ai,si,ri;!function(e){e.Layer="Layer",e.Map="MAP"}(Yn||(Yn={})),function(e){e.Network="NETWORK",e.Event="EVENT",e.LineEvent="LINEEVENT",e.PointEvent="POINTEVENT",e.Intersection="INTERSECTION",e.Centerline="CENTERLINE",e.CalibrationPoint="CALIBRATIONPOINT",e.UtilityNetwork="UTILITYNETWORK",e.Addressing="ADDRESSING",e.NonLrs="NONLRS",e.NonLrsPoint="NONLRSPOINTS",e.NonLrsLine="NONLRSLINES"}(ei||(ei={})),function(e){e.Measure="ROUTEANDMEASURE",e.Coordinate="COORDINATE",e.LocationOffset="LOCATIONOFFSET",e.Referent="REFERENT",e.LineAndMeasure="LINEANDMEASURE"}(ti||(ti={})),function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(ni||(ni={})),function(e){e.LineId="LINEID",e.LineName="LINENAME"}(ii||(ii={})),function(e){e.Map="MAP",e.Lrs="LRS"}(ai||(ai={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(si||(si={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(ri||(ri={}));m(36614);function oi(e,t=!0){return null!=e&&("string"==typeof e?""!==e.trim()||!t:"number"==typeof e?!isNaN(e):Array.isArray(e)?!t||0!==e.length:Boolean(e))}t.JSAPILayerTypes.FeatureLayer,t.JSAPILayerTypes.SceneLayer,t.JSAPILayerTypes.BuildingComponentSublayer,t.JSAPILayerTypes.OrientedImageryLayer,t.JSAPILayerTypes.ImageryLayer,t.JSAPILayerTypes.SubtypeSublayer;var ci=function(e,t,n,i){return new(n||(n=Promise))(function(a,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((i=i.apply(e,t||[])).next())})};let li=[];const ui=t.React.forwardRef((r,o)=>{const l=t.hooks.useTranslation(a),{widgetId:u,jimuMapView:d,network:f,eventDS:v,networkDS:h,eventLayer:p,networkLayer:m,routeInfo:y,reset:g,eventFeatures:b,preservedEventIndex:I,flashGraphic:D,onSubmit:S,toastMsgType:w,onUpdateToastMsgType:L,onUpdateToastMsg:j,onUpdateToastOpen:T,onUpdateStopQuery:E,onValidationChanged:k,intl:N,lockAquired:F,conflictPreventionEnabled:M}=r,[x,A]=t.React.useState(),[R,O]=t.React.useState(!1),[C,P]=t.React.useState(),[_,G]=t.React.useState(),[V,U]=t.React.useState(!1),{sessionId:W,startEditSession:B,addEdit:z}=(0,n.useVmsManager)(),{supportsEditSession:q}=(0,n.useEditSession)();(0,Kn.useImperativeHandle)(o,()=>({onSubmitClicked:te})),t.React.useEffect(()=>{I>-1&&b.length>0&&J()},[I]),t.React.useEffect(()=>{(g||0===b.length)&&A(Q())},[g,b]),t.React.useEffect(()=>{A(Q()),U(!1)},[v,p]),t.React.useEffect(()=>{if(M){const e=Object.assign({},C);(0,n.isDefined)(f)&&(e.networkId=[f.networkInfo.lrsNetworkId]),(0,n.isDefined)(p)&&(e.eventServiceLayerIds=[p.serviceId]),(0,n.isDefined)(y)&&(e.routeInfo=y,e.routeOrLineId=[]),P(e)}},[h,f,p,y]);const J=()=>{const e=[];if((0,n.isDefined)(p)&&(0,n.isDefined)(v)&&(0,n.isDefined)(p.eventInfo)&&(0,n.isDefined)(p.eventInfo.attributeFields)){const t=v,i=(null==t?void 0:t.layer).fields;p.eventInfo.attributeFields.forEach(t=>{if(t.enabled){const a=i.find(e=>e.name===t.field.name);if(a&&a.editable){let i,s=b[I].attributes[a.name];(0,n.isDate)(a.type)&&(0,n.isDefined)(s)?s=new Date(s):i=(0,n.isDate)(a.type)?(0,n.isDefined)(a.defaultValue)?new Date(a.defaultValue):null:a.defaultValue;const r={index:e.length,name:a.name,alias:a.alias,type:a.type,hasDomain:(0,n.isDefined)(a.domain),value:s,error:"",nullable:a.nullable,default:"number"==typeof i?Number(i).toString():i,length:a.length,editable:t.editable};e.push(r)}}})}setTimeout(()=>{A(e)},500)},Q=()=>{const e=[];if((0,n.isDefined)(p)&&(0,n.isDefined)(v)&&(0,n.isDefined)(p.eventInfo)&&(0,n.isDefined)(p.eventInfo.attributeFields)){const t=v,i=(null==t?void 0:t.layer).fields;p.eventInfo.attributeFields.forEach(t=>{if(t.enabled){const a=i.find(e=>e.name===t.field.name);if(a){let i;i=(0,n.isDate)(a.type)?(0,n.isDefined)(a.defaultValue)?new Date(a.defaultValue):null:a.defaultValue;const s={index:e.length,name:a.name,alias:a.alias,type:a.type,hasDomain:(0,n.isDefined)(a.domain),value:i,error:"",nullable:a.nullable,default:"number"==typeof i?Number(i).toString():i,length:a.length,editable:t.editable};e.push(s)}}})}return e},Z=e=>e.findIndex(e=>e.error.length>0)>-1,H=e=>{const t=En(e);A(t),O(Z(t))},$=e=>{let t=!0;const i=e.attributes[p.eventInfo.fromDateFieldName],a=(0,n.getDateWithRouteTime)(y.selectedFromDate,y.fromDate),s=(0,n.getDateWithRouteTime)(y.selectedToDate,y.fromDate),r=(0,n.getDateToUTC)(a),o=(0,n.getDateToUTC)(s);return(0,n.isDefined)(y.selectedFromDate)&&!(0,n.isDefined)(y.selectedToDate)&&(0,n.isDefined)(i)&&(t=t&&r>=i),!(0,n.isDefined)(y.selectedFromDate)&&(0,n.isDefined)(y.selectedToDate)&&(0,n.isDefined)(i)&&(t=t&&o>i),(0,n.isDefined)(y.selectedFromDate)&&(0,n.isDefined)(y.selectedToDate)&&(t=t&&r<o,(0,n.isDefined)(i)&&(t=t&&(r>=i||o>i))),t},K=()=>{const e=En(x);let t=!1;return e.forEach((i,a)=>{let s;if(s=i.hasDomain?(0,n.validateRangeDomain)(i.value,i.name,v):((0,n.isDate)(i.type),(0,n.validateField)(i.value,i.name,v)),(0,n.isDefined)(li)){let t=[];const n=function(e,t,n,i,a,s,r){const o={};if(oi(i))if(-1===e&&-1===n)i.forEach(e=>{o[e.name]=e.value});else{const t=i[n];i.forEach(n=>{o[n.name]=n.value,n.name===t.name&&(o[n.name]=e)})}else r.forEach(e=>{const t=s.attributes[e.name],n=e.alias.split(".")[1];o[n]=t});const c=[];for(const e of a){const t=e.isEditingRestrictive?"error":"warning";let n=!1;const i=e.contingencies.filter(e=>!e.isRetired);if(!i||0===i.length)return[];for(const e of i){let t=!0;for(const n in e.values){const i=e.values[n];if("any"!==i.objectType)if("null"===i.objectType){if(null!=o[n]){t=!1;break}}else if("code"===i.objectType){if(null!=i.codedValue&&o[n]!==i.codedValue.code){t=!1;break}}else if("range"===i.objectType){const e=o[n];if(null!=i.minValue&&null!=i.maxValue&&(e<i.minValue||e>i.maxValue)){t=!1;break}}}if(t){n=!0;break}}n||c.push({fieldGroup:e,type:t})}return c}(i.value,0,a,e,li);(null==n?void 0:n.length)>0&&(n.forEach(e=>{var n;const i=null===(n=null==e?void 0:e.fieldGroup)||void 0===n?void 0:n.fields;t.push(i)}),t=t.flat(),t.includes(i.name)&&(U(!0),s={hasError:!0,message:"contingentValueError"}))}if(s.hasError){let e;if("contingentValueError"===s.message){const t=[];li.forEach(e=>{t.push(e.name)});let n=l("invalidContingentValues");n=n.replace("{groupNames}",t.join(",")),e=n,G(e)}else{const t=p.useFieldAlias?i.alias:i.name;e=(0,n.formatMessage)(N,"attributeError",{fieldValue:t,message:(0,n.formatMessage)(N,s.message)})}L("error"),j(e),T(!0),setTimeout(()=>{T(!1)},5e3),t=!0,i.error=l(s.message)}}),t&&H(e),t},X=()=>ci(void 0,void 0,void 0,function*(){var e;const n=v,i=n.getPopupInfo(),a=n.getLayerDefinition(),s=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==a?void 0:a.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==i?void 0:i.fieldInfos)||[]).filter(e=>e.visible)),r=n.mergeQueryParams(null!==(e=n.getCurrentQueryParams())&&void 0!==e?e:{},{where:"1=1",sqlExpression:null}),o=Object.assign({returnGeometry:!0},r);yield n.load(o,{widgetId:u});const c=new t.DataRecordSetChangeMessage(u,t.RecordSetChangeType.CreateUpdate,[{records:n.getRecords(),fields:s.map(e=>e.fieldName),dataSource:n,name:n.id}]);t.MessageManager.getInstance().publishMessage(c)}),Y=e=>ci(void 0,void 0,void 0,function*(){var t;if(!(yield i(!1,b,l,p,m,h,w,L,j,T)))return;if(!(yield ci(void 0,void 0,void 0,function*(){let e=!0;return(0,c.loadArcGISJSAPIModules)(["esri/geometry/operators/disjointOperator"]).then(t=>{let n=null;[n]=t;for(let t=0;t<b.length;t++){for(let i=0;i<b.length;i++)if(i!==t){if(!n.execute(b[t].geometry,b[i].geometry)||b[t].attributes[p.eventInfo.routeIdFieldName]===b[i].attributes[p.eventInfo.routeIdFieldName]&&(b[t].attributes[p.eventInfo.fromMeasureFieldName]===b[i].attributes[p.eventInfo.toMeasureFieldName]||b[t].attributes[p.eventInfo.toMeasureFieldName]===b[i].attributes[p.eventInfo.fromMeasureFieldName]))break;i===b.length-1&&(e=!1)}if(!e){L("error"),j(l("eventsNotCoincident")),T(!0),setTimeout(()=>{T(!1)},5e3);break}}return e})})))return;if(K())return;if(!(()=>{let e="";const t=[],i=[],a=[];for(let e=0;e<b.length;e++){const s=b[e],r=s.attributes[v.getSchema().idField];null!=s.attributes[p.eventInfo.toDateFieldName]?t.push(r):null!=s.attributes[p.eventInfo.fromDateFieldName]&&s.attributes[p.eventInfo.fromDateFieldName]>(0,n.getDateToUTC)(new Date(Date.now()))?i.push(r):$(s)||a.push(r)}return t.length>0?e=l("eventsToDateNotNull",{objectIds:t.join(", ")}):i.length>0?e=l("eventsNotActiveToday",{objectIds:i.join(", ")}):a.length>0&&(e=l("eventNotOverlapMergeDates",{objectIds:a.join(", ")})),!(e.length>0&&(L("error"),j(e),T(!0),setTimeout(()=>{T(!1)},5e3),1))})())return;const a={};if((0,n.isDefined)(p)&&I>-1&&b.length>0){const e={},i=p.eventInfo.eventIdFieldName;if(e[i]=b[I].attributes[p.eventInfo.eventIdFieldName],(0,n.isDefined)(b)&&(0,n.isDefined)(y)&&(0,n.isDefined)(f)&&(0,n.isDefined)(y.lineId)&&y.lineId.length>0){const t=b[0].attributes[p.eventInfo.routeIdFieldName],i=b[b.length-1].attributes[p.eventInfo.routeIdFieldName];if(t!==i){const a=f.networkInfo.routeIdFieldSchema.jimuName,s=f.networkInfo.lineOrderFieldSchema.jimuName,r=yield(0,n.queryAllRoutesByLineIdAndFromDate)(y.lineId,f.networkInfo,h,y.selectedFromDate);if((0,n.isDefined)(r)){const o=r.features.sort((e,t)=>e.attributes[s]-t.attributes[s]);let c=-1,l=-1;const u=[];o.forEach((e,n)=>{u.push(e.geometry),e.attributes[a]===t&&(c=n),e.attributes[a]===i&&(l=n)});const d=(0,n.IsRouteReversed)(u,c),v=(0,n.IsRouteReversed)(u,l);if((0,n.isDefined)(f)){let t=Zn(b[0].attributes[p.eventInfo.fromMeasureFieldName],f.networkInfo.measurePrecision);if(d)t=Zn(b[0].attributes[p.eventInfo.toMeasureFieldName],f.networkInfo.measurePrecision);else{const e=b[0].attributes[p.eventInfo.routeIdFieldName],n=b[b.length-1].attributes[p.eventInfo.routeIdFieldName],i=Zn(b[b.length-1].attributes[p.eventInfo.fromMeasureFieldName],f.networkInfo.measurePrecision);e===n&&i<t&&(t=i)}let n=Zn(b[b.length-1].attributes[p.eventInfo.toMeasureFieldName],f.networkInfo.measurePrecision);if(v)n=Zn(b[b.length-1].attributes[p.eventInfo.fromMeasureFieldName],f.networkInfo.measurePrecision);else{const e=b[0].attributes[p.eventInfo.toRouteIdFieldName],t=b[b.length-1].attributes[p.eventInfo.toRouteIdFieldName],i=Zn(b[0].attributes[p.eventInfo.toMeasureFieldName],f.networkInfo.measurePrecision);e===t&&i>n&&(n=i)}const i=p.eventInfo.fromMeasureFieldName;e[i]=t;const a=p.eventInfo.toMeasureFieldName;e[a]=n}}}}else{const t=b[0].attributes[p.eventInfo.routeIdFieldName],n=b[b.length-1].attributes[p.eventInfo.routeIdFieldName];let i=Zn(b[0].attributes[p.eventInfo.fromMeasureFieldName],f.networkInfo.measurePrecision);const a=Zn(b[b.length-1].attributes[p.eventInfo.fromMeasureFieldName],f.networkInfo.measurePrecision);t===n&&a<i&&(i=a);const s=p.eventInfo.fromMeasureFieldName;e[s]=i;const r=b[0].attributes[p.eventInfo.toRouteIdFieldName],o=b[b.length-1].attributes[p.eventInfo.toRouteIdFieldName],c=Zn(b[0].attributes[p.eventInfo.toMeasureFieldName],f.networkInfo.measurePrecision);let l=Zn(b[b.length-1].attributes[p.eventInfo.toMeasureFieldName],f.networkInfo.measurePrecision);r===o&&c>l&&(l=c);const u=p.eventInfo.toMeasureFieldName;e[u]=l}x.forEach(t=>{const i=t.name;if((0,n.isDefined)(t.value)&&(0,n.isDate)(t.type)){const a=(0,n.getDateWithoutTZOffset)(t.value.valueOf(),v);e[i]=(0,n.getDateToUTC)(a)}else(0,n.isNumber)(t.type)?!(0,n.isDefined)(t.value)||isNaN(Number(t.value))?e[i]=null:e[i]=Number(t.value):e[i]=t.value});const s=null===(t=v.getSchema())||void 0===t?void 0:t.idField,r=[];if(b.forEach(e=>{r.push(e.attributes[s])}),a.attributes=e,a.objectIdToPreserve=b[I].attributes[s],a.objectIds=r,(0,n.isDefined)(y.selectedFromDate)){const e=(0,n.getDateWithRouteTime)(y.selectedFromDate,y.fromDate),t=(0,n.getDateWithoutTZOffset)(e.valueOf(),v);a.fromDate=t}else a.fromDate=y.selectedFromDate;if((0,n.isDefined)(y.selectedToDate)){const e=(0,n.getDateWithRouteTime)(y.selectedToDate,y.fromDate),t=(0,n.getDateWithoutTZOffset)(e.valueOf(),v);a.toDate=t}else a.toDate=y.selectedToDate}const s=v;if(q){const e=yield B();if(!e.success)return L("error"),j(e.error),T(!0),void setTimeout(()=>{T(!1)},5e3)}yield(0,n.LrsApplyEdits)(s,p,W,null,null,a).then(t=>{if(t.success){if(q&&z(t,l("_widgetLabel")),(0,n.isDefined)(p)&&(0,n.isDefined)(v)){const e=v;(0,n.queryEventsByEventObjectIds)(e,t.editResults[0].mergeEventsResult.objectIds).then(e=>{e.forEach((e,t)=>ci(void 0,void 0,void 0,function*(){const t=e.geometry;(0,n.isDefined)(t)&&(0,n.flash)(D,yield(0,n.getGeometryGraphic)(yield(0,n.getSimpleLineGraphic)(t),Hn))}))})}L("success"),j(l("eventMerged")),T(!0),X(),setTimeout(()=>ci(void 0,void 0,void 0,function*(){T(!1),L("error"),E(!1);const t=d.jimuLayerViews,i=Object.keys(t);for(let e=0;e<i.length;e++){const n=t[i[e]];n.layer.title===p.name&&n.selectFeaturesByIds([])}if(M&&(0,n.isDefined)(e)){yield(0,n.tryReleaseLockOnDefault)(h,e);const t=Object.assign(Object.assign({},C),{lockAction:n.LockAction.Clear});P(t)}else S()}),5e3)}else L("error"),j(t.message),T(!0),setTimeout(()=>{T(!1)},5e3)})}),ee=t.React.useCallback(()=>{if(!(0,n.isDefined)(y.selectedFromDate)&&!(0,n.isDefined)(y.selectedToDate))return!1;const e=(0,n.getDateWithoutTime)(y.selectedFromDate),t=(0,n.getDateWithoutTime)(y.selectedToDate),i=(0,n.getDateWithoutTime)(y.fromDate),a=(0,n.getDateWithoutTime)(y.toDate);if((0,n.isDefined)(y.selectedFromDate)&&!(0,n.isDefined)(y.selectedToDate)){if((0,n.isDefined)(y.fromDate)&&e<i)return!1;if((0,n.isDefined)(y.toDate)&&e>a)return!1}if(!(0,n.isDefined)(y.selectedFromDate)&&(0,n.isDefined)(y.selectedToDate)){if((0,n.isDefined)(y.fromDate)&&t<i)return!1;if((0,n.isDefined)(y.toDate)&&t>a)return!1}if((0,n.isDefined)(y.selectedFromDate)&&(0,n.isDefined)(y.selectedToDate)){if(e>t)return!1;if((0,n.isDefined)(y.fromDate)&&e<i)return!1;if((0,n.isDefined)(y.toDate)&&t>a)return!1}return!R&&(0!==b.length&&(-1!==I&&!!F))},[y]),te=()=>{if(M){const e=Object.assign(Object.assign({},C),{lockAction:n.LockAction.QueryAndAcquire});P(e)}else Y()};return t.React.useEffect(()=>{k(ee())},[ee,k]),(0,e.jsx)("div",{className:"merge-events-edit-attributes__content",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .merge-events-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .merge-events-edit-attributes__action {
      height: 100%;
    }
  `,children:(0,e.jsxs)("div",{className:"h-100",children:[M&&(0,e.jsx)(n.LockManagerComponent,{intl:N,featureDS:h,lockInfo:C,showAlert:!1,conflictPreventionEnabled:M,onQueryAndAcquireComplete:(e,t,i)=>{const a=Object.assign(Object.assign({},e),{lockAction:n.LockAction.None});P(a),i&&Y(a)},onMessageClear:()=>{const e=Object.assign(Object.assign({},C),{lockAction:n.LockAction.None});P(e),S()}}),V&&(0,e.jsx)("div",{style:{marginTop:"1.2rem"},children:(0,e.jsx)(s.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){U(!1)},open:V,text:_,type:"warning",closable:!0,withIcon:!0})}),(0,e.jsx)(n.AttributeTable,{tableIndex:0,collapable:!1,eventDS:v,eventLayer:p,fieldInfos:x,useAlias:!(0,n.isDefined)(p)||p.useFieldAlias,onUpdateItem:(e,t,n)=>{const i=En(x);i[n].value=e,i[n].error=t,A(i),O(Z(i))},onUpdateAll:H,onFieldGrpUpdated:(e,t)=>{li=e,li&&0!==(null==li?void 0:li.length)||U(!1)},tableLabel:l("mergedEventAttributesLabel")})]})})});function di(n){const{network:i,event:a,dataSourcesReady:s,onCreateNetworkDs:r,onCreateEventDs:o}=n,[c,l]=t.React.useState(null!=i?i:null),[u,d]=t.React.useState(null!=a?a:null),[f,v]=t.React.useState(!1),[h,p]=t.React.useState(!1);t.React.useEffect(()=>{i&&l(i)},[i]),t.React.useEffect(()=>{a&&d(a)},[a]),t.React.useEffect(()=>{s(f&&h)},[s,h,f]);const m=t.React.useCallback(e=>{r(e)},[r]),y=t.React.useCallback(e=>{o(e)},[o]),g=t.React.useCallback(e=>{if(e){const{status:n,instanceStatus:i}=e;i===t.DataSourceStatus.NotCreated||i===t.DataSourceStatus.CreateError||n===t.DataSourceStatus.LoadError||n===t.DataSourceStatus.NotReady?v(!1):v(!0)}},[v]),b=t.React.useCallback(e=>{if(e){const{status:n,instanceStatus:i}=e;i===t.DataSourceStatus.NotCreated||i===t.DataSourceStatus.CreateError||n===t.DataSourceStatus.LoadError||n===t.DataSourceStatus.NotReady?p(!1):p(!0)}},[p]),I=t.React.useCallback(()=>{v(!1)},[v]),D=t.React.useCallback(()=>{p(!1)},[p]);return(0,e.jsxs)("div",{children:[c&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:c.useDataSource,onDataSourceInfoChange:g,onCreateDataSourceFailed:I,onDataSourceCreated:m}),u&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:u.useDataSource,onDataSourceInfoChange:b,onCreateDataSourceFailed:D,onDataSourceCreated:y})]})}var fi=m(98640),vi=function(e,t,n,i){return new(n||(n=Promise))(function(a,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((i=i.apply(e,t||[])).next())})};const hi=m(62838);function pi(i){const r=t.hooks.useTranslation(a),{network:o,eventDS:c,eventLayer:l,clearPickedGraphic:u,eventFeatures:d,onEventRemoved:f,onPreservedEventIndexChanged:v,preservedEventIndex:h,flashGraphic:p}=i;t.React.useEffect(()=>{(0,n.isDefined)(o)&&u()},[o]);const m={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:fi.TreeItemActionType.RenderOverrideItem,children:[{name:fi.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:fi.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:fi.TreeItemActionType.RenderOverrideItemBody,children:[{name:fi.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:fi.TreeItemActionType.RenderOverrideItemDragHandle},{name:fi.TreeItemActionType.RenderOverrideItemTitle},{name:fi.TreeItemActionType.RenderOverrideItemDetailToggle},{name:fi.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},y=e=>{var t;if((0,n.isDefined)(l)&&(0,n.isDefined)(c)){const i=c,a=null===(t=c.getSchema())||void 0===t?void 0:t.idField;(0,n.queryEventsByEventObjectIds)(i,[d[e].attributes[a]]).then(e=>{e.forEach(e=>vi(this,void 0,void 0,function*(){const t=e.geometry;(0,n.isDefined)(t)&&(0,n.flash)(p,yield(0,n.getGeometryGraphic)(yield(0,n.getSimpleLineGraphic)(t),Hn))}))})}};return(0,e.jsx)("div",{className:"merge-events-list-form d-flex w-100 pt-1 px-3",children:o&&(0,e.jsxs)("div",{className:"w-100",children:[(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0 pt-3 title3",centric:!0,style:{width:100},children:r("eventListLabel")}),(0,e.jsx)("div",{className:"setting-ui-unit-list w-100",children:(0,e.jsx)(fi.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:Array.from(d).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:h===t,itemStateTitle:e.attributes[c.getSchema().idField],itemStateCommands:[{label:r("remove"),iconProps:()=>({icon:hi,size:12}),action:({data:e})=>{f(t)}}]})),renderOverrideItemDetailToggle:(t,n)=>n.props.itemJsons[0].itemStateChecked?(0,e.jsx)("div",{className:"title3",children:r("preserveLabel")}):"",onClickItemBody:(e,t)=>{const{itemJsons:[n]}=t.props;v(+n.itemKey),y(+n.itemKey)}},m))})]})})}function mi(i){const r=t.hooks.useTranslation(a),{routeInfo:o,reset:c,onUpdateRouteInfo:l,currentSketchVM:u,isEventPickerActive:d,onUpdateIsEventPickerActive:f}=i,[v,h]=t.React.useState(!1),[p,m]=t.React.useState(!1),[y,g]=t.React.useState(!0);t.React.useEffect(()=>{c&&(h(!1),m(!1))},[c]),t.React.useEffect(()=>{let e=!1;const t=Object.assign({},o);(0,n.isDefined)(o.selectedFromDate)&&v&&o.selectedFromDate!==o.fromDate&&(t.selectedFromDate=o.fromDate,e=!0),p&&o.selectedToDate!==o.toDate&&(t.selectedToDate=o.toDate,e=!0),e&&l(t)},[l,o,v,p]);const b=()=>{u&&(y&&u.cancel(),u.create("rectangle"))};return(0,e.jsx)("div",{className:"merge-events-change-event-selection-form px-3 w-100 pt-3",children:(0,e.jsx)(s.Button,{role:"button","aria-label":r("selectButtonLabel"),title:r("selectButtonLabel"),size:"sm",type:d?"primary":"secondary",className:"w-100 px-3",onClick:()=>{g(!0),b();f(!d)},children:r("selectButtonLabel")})})}var yi=function(e,t,n,i){return new(n||(n=Promise))(function(a,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((i=i.apply(e,t||[])).next())})};function gi(i){const{widgetId:a,network:s,networkDS:r,eventDS:o,eventLayer:c,reset:l,jimuMapView:u,hoverGraphic:d,pickedGraphic:f,flashGraphic:v,currentSketchVM:h,eventFeatures:p,onEventRemoved:m,onPreservedEventIndexChanged:y,preservedEventIndex:g,isEventPickerActive:b,onUpdateIsEventPickerActive:I}=i,[D,S]=t.React.useState((0,n.getInitialRouteInfoState)());t.React.useEffect(()=>{(0,n.isDefined)(s)&&(S((0,n.getInitialRouteInfoState)()),w())},[s]),t.React.useEffect(()=>{l&&(S((0,n.getInitialRouteInfoState)()),w())},[l]);const w=()=>{(0,n.isDefined)(f)&&f.removeAll()},L=(e,t)=>yi(this,void 0,void 0,function*(){var i;(0,n.isDefined)(e.selectedPolyline)&&t&&(i=yield(0,n.getGeometryGraphic)(yield(0,n.getSimpleLineGraphic)(e.selectedPolyline),Hn),(0,n.isDefined)(i)&&(v.add(i),setTimeout(()=>{v.removeAll(),setTimeout(()=>{v.add(i),setTimeout(()=>{v.removeAll(),setTimeout(()=>{v.add(i),setTimeout(()=>{v.removeAll()},800)},800)},800)},800)},800))),(0,n.isDefined)(e.selectedPoint)?(e=>{(0,n.isDefined)(e)?(f.removeAll(),f.add(e)):w()})(yield(0,n.getGeometryGraphic)(yield(0,n.getSimplePointGraphic)(e.selectedPoint),$n)):w()});return(0,e.jsxs)("div",{className:"merge-events-event-selection-form__content d-flex",css:t.css`
    display: flex;
    flex-direction: column;

    .merge-events-event-selection-form__content {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    flex: 1 1 auto;
    overflow: auto;
    }
    .merge-events-event-selection-form__actions {
    height: 100%;
    }
`,children:[(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(pi,{widgetId:a,network:s,networkDS:r,eventDS:o,eventLayer:c,routeInfo:D,jimuMapView:u,hoverGraphic:d,reset:l,clearPickedGraphic:w,eventFeatures:p,onEventRemoved:m,onPreservedEventIndexChanged:y,preservedEventIndex:g,flashGraphic:v})}),(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(mi,{routeInfo:D,reset:l,onUpdateRouteInfo:(e,t=!1)=>{S(e),L(e,t)},networkDS:r,jimuMapView:u,currentSketchVM:h,isEventPickerActive:b,onUpdateIsEventPickerActive:I})})]})}var bi=function(e,t,n,i){return new(n||(n=Promise))(function(a,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((i=i.apply(e,t||[])).next())})};function Ii(i){const r=t.hooks.useTranslation(a),{network:o,networkDS:c,routeInfo:l,reset:u,clearPickedGraphic:d,eventLayer:f,eventFeatures:v,intl:h,resetForDataAction:p}=i,[m,y]=t.React.useState(r("chooseEventsFromMap")),[g,b]=t.React.useState(r("chooseEventsFromMap"));return t.React.useEffect(()=>{(0,n.isDefined)(f)&&(y(r("chooseEventsFromMap")),b(r("chooseEventsFromMap")),d())},[f]),t.React.useEffect(()=>()=>{(()=>{bi(this,void 0,void 0,function*(){if((0,n.isDefined)(v)&&(0,n.isDefined)(l)&&(0,n.isDefined)(o)&&(0,n.isDefined)(l.lineId)&&l.lineId.length>0){const e=v[0].attributes[f.eventInfo.routeIdFieldName],t=v[v.length-1].attributes[f.eventInfo.routeIdFieldName];if(e!==t){const i=o.routeIdFieldSchema.jimuName,a=o.lineOrderFieldSchema.jimuName,s=yield(0,n.queryAllRoutesByLineIdAndFromDate)(l.lineId,o,c,l.selectedFromDate);if((0,n.isDefined)(s)){const c=s.features.sort((e,t)=>e.attributes[a]-t.attributes[a]);let l=-1,u=-1;const h=[];c.forEach((n,a)=>{h.push(n.geometry),n.attributes[i]===e&&(l=a),n.attributes[i]===t&&(u=a)});const p=(0,n.IsRouteReversed)(h,l),m=(0,n.IsRouteReversed)(h,u);if(d(),(0,n.isDefined)(v)&&0!==v.length){if((0,n.isDefined)(o)){let e=Zn(v[0].attributes[f.eventInfo.fromMeasureFieldName],o.measurePrecision);if(p)e=Zn(v[0].attributes[f.eventInfo.toMeasureFieldName],o.measurePrecision);else{const t=v[0].attributes[f.eventInfo.routeIdFieldName],n=v[v.length-1].attributes[f.eventInfo.routeIdFieldName],i=Zn(v[v.length-1].attributes[f.eventInfo.fromMeasureFieldName],o.measurePrecision);t===n&&i<e&&(e=i)}let t=Zn(v[v.length-1].attributes[f.eventInfo.toMeasureFieldName],o.measurePrecision);if(m)t=Zn(v[v.length-1].attributes[f.eventInfo.fromMeasureFieldName],o.measurePrecision);else{const e=v[0].attributes[f.eventInfo.toRouteIdFieldName],n=v[v.length-1].attributes[f.eventInfo.toRouteIdFieldName],i=Zn(v[0].attributes[f.eventInfo.toMeasureFieldName],o.measurePrecision);e===n&&i>t&&(t=i)}y(e.toString()),b(t.toString())}}else y(r("chooseEventsFromMap")),b(r("chooseEventsFromMap"))}}}else if(d(),(0,n.isDefined)(v)&&0!==v.length){if((0,n.isDefined)(o)){const e=v[0].attributes[f.eventInfo.routeIdFieldName],t=v[v.length-1].attributes[f.eventInfo.routeIdFieldName];let n=Zn(v[0].attributes[f.eventInfo.fromMeasureFieldName],o.measurePrecision);const i=Zn(v[v.length-1].attributes[f.eventInfo.fromMeasureFieldName],o.measurePrecision);e===t&&i<n&&(n=i);const a=v[0].attributes[f.eventInfo.toRouteIdFieldName],s=v[v.length-1].attributes[f.eventInfo.toRouteIdFieldName],r=Zn(v[0].attributes[f.eventInfo.toMeasureFieldName],o.measurePrecision);let c=Zn(v[v.length-1].attributes[f.eventInfo.toMeasureFieldName],o.measurePrecision);a===s&&r>c&&(c=r),y(n.toString()),b(c.toString())}}else y(r("chooseEventsFromMap")),b(r("chooseEventsFromMap"))})})()},[o,c,l,v]),t.React.useEffect(()=>{u&&!p&&(y(r("chooseEventsFromMap")),b(r("chooseEventsFromMap")))},[u]),(0,e.jsx)("div",{className:"route-and-measure-form d-flex w-100 pt-1 px-3",children:o&&(0,e.jsxs)("div",{className:"w-100",children:[(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0 pt-3 title3",centric:!0,style:{width:100},children:r("fromMeasureWithUnits",{units:(0,n.GetUnits)(o.unitsOfMeasure,h)})}),(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0 label2",style:{width:100,alignItems:"center"},children:m})}),(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0 pt-3 title3",centric:!0,style:{width:100},children:r("toMeasureWithUnits",{units:(0,n.GetUnits)(o.unitsOfMeasure,h)})}),(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0 label2",style:{width:100,alignItems:"center"},children:g})})]})})}var Di=m(99037);function Si(i){const r=t.hooks.useTranslation(a),{routeInfo:o,reset:c,onUpdateRouteInfo:l,eventLayer:u,intl:d}=i,[f,v]=t.React.useState(!1),[h,p]=t.React.useState(!1),[m,y]=t.React.useState("idle"),[g,b]=t.React.useState("idle"),[I,D]=t.React.useState(""),[S,w]=t.React.useState(""),[L,j]=t.React.useState(!0);t.React.useEffect(()=>{c&&(v(!1),p(!1),y("idle"),b("idle"),D(""),w(""),j(!1))},[c]),t.React.useEffect(()=>{let e=!1;const t=Object.assign({},o);"idle"===m&&D(""),"idle"===g&&w(""),(0,n.isDefined)(o.selectedFromDate)&&f&&o.selectedFromDate!==o.fromDate&&(t.selectedFromDate=o.fromDate,e=!0),h&&o.selectedToDate!==o.toDate&&(t.selectedToDate=o.toDate,e=!0),e&&l(t)},[l,o,f,h]),t.React.useEffect(()=>{j(!(null==u?void 0:u.eventInfo.canSpanRoutes))},[u]);const T=(e,t)=>{const i=e;if(!(0,n.isDefined)(i))return t?y("idle"):b("idle"),t?D(""):w(""),!0;let a=!0;const s=(0,n.getDateWithoutTime)(i),c=(0,n.getDateWithoutTime)(o.fromDate),l=(0,n.getDateWithoutTime)(o.toDate),u=(0,n.getDateWithoutTime)(o.selectedFromDate),d=(0,n.getDateWithoutTime)(o.selectedToDate);return(0,n.isDefined)(o.fromDate)&&s<c?(t?y("invalid"):b("invalid"),t?D(r("invalidFromDateBefore")):w(r("invalidToDateBefore")),a=!1,!1):(0,n.isDefined)(o.toDate)&&s>l?(t?y("invalid"):b("invalid"),t?D(r("invalidFromDateAfter")):w(r("invalidToDateAfter")),a=!1,!1):((0,n.isDefined)(o.selectedToDate)&&t&&(s>d&&(y("invalid"),t?D(r("invalidDatesOrder")):w(r("invalidDatesOrder")),a=!1),S===r("invalidDatesOrder")?s<d&&(b("idle"),w("")):S===r("invalidDatesSameDay")&&s!==u&&(b("idle"),w(""))),(0,n.isDefined)(o.selectedToDate)&&t&&s.getTime()===d.getTime()&&(y("invalid"),t?D(r("invalidDatesSameDay")):w(r("invalidDatesSameDay")),a=!1),(0,n.isDefined)(o.selectedFromDate)&&(t||(s<u&&(b("invalid"),t?D(r("invalidDatesOrder")):w(r("invalidDatesOrder")),a=!1),I===r("invalidDatesOrder")?s>u&&(y("idle"),D("")):I===r("invalidDatesSameDay")&&s!==u&&(y("idle"),D("")))),(0,n.isDefined)(o.selectedFromDate)&&(t||s.getTime()!==u.getTime()||(b("invalid"),t?D(r("invalidDatesSameDay")):w(r("invalidDatesSameDay")),a=!1)),a&&(t?y("idle"):b("idle"),t?D(""):w("")),!0)};return(0,e.jsxs)("div",{className:"merge-events-date-form px-3 w-100",css:(0,n.getCalciteBasicTheme)(),children:[(0,e.jsx)(s.Label,{size:"sm",className:"mb-0 pt-3 title3",centric:!0,style:{width:100},children:(0,n.formatMessage)(d,"startDateRequiredLabel")}),(0,e.jsx)(s.Tooltip,{title:I,children:(0,e.jsx)(Di.CalciteInputDatePicker,{scale:"s",disabled:!!f||void 0,valueAsDate:o.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const n=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(T(n,!0),n){const e=Object.assign(Object.assign({},o),{selectedFromDate:n});l(e)}else{const e=Object.assign(Object.assign({},o),{selectedFromDate:null});l(e)}}},status:m,placement:"top",overlayPositioning:"fixed"})}),(0,e.jsxs)(s.Label,{size:"sm",className:"w-100 pt-2 label2",centric:!0,check:!0,children:[(0,e.jsx)(s.Checkbox,{checked:f,className:"mr-2",disabled:!L,onChange:(e,t)=>{T(o.fromDate,!0),v(t)}}),r("useStartDateLabel")]}),(0,e.jsx)(s.Label,{size:"sm",className:"mb-0 pt-1 title3",centric:!0,style:{width:100},children:r("endDateLabel")}),(0,e.jsx)(s.Tooltip,{title:S,children:(0,e.jsx)(Di.CalciteInputDatePicker,{scale:"s",disabled:!!h||void 0,valueAsDate:o.selectedToDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const n=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(T(n,!1),n){const e=Object.assign(Object.assign({},o),{selectedToDate:n});l(e)}else{const e=Object.assign(Object.assign({},o),{selectedToDate:null});l(e)}}},status:g,placement:"top",overlayPositioning:"fixed"})}),(0,e.jsxs)(s.Label,{size:"sm",className:"w-100 pt-2 label2",centric:!0,check:!0,children:[(0,e.jsx)(s.Checkbox,{checked:h,className:"mr-2",disabled:!L,onChange:(e,t)=>{T(o.toDate,!1),p(t)}}),r("useEndDateLabel")]})]})}var wi=function(e,t,n,i){return new(n||(n=Promise))(function(a,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((i=i.apply(e,t||[])).next())})};function Li(i){const{widgetId:a,network:s,networkDS:r,reset:o,jimuMapView:c,hoverGraphic:l,pickedGraphic:u,flashGraphic:d,eventLayer:f,eventFeatures:v,routeInfo:h,onUpdateRouteInfo:p,intl:m,resetForDataAction:y}=i;t.React.useEffect(()=>{(0,n.isDefined)(s)&&g()},[s]),t.React.useEffect(()=>{o&&g()},[o]);const g=()=>{(0,n.isDefined)(u)&&u.removeAll()},b=(e,t)=>wi(this,void 0,void 0,function*(){var i;(0,n.isDefined)(e.selectedPolyline)&&t&&(0,n.flash)(d,yield(0,n.getGeometryGraphic)(yield(0,n.getSimpleLineGraphic)(e.selectedPolyline),Hn)),(0,n.isDefined)(e.selectedPoint)?(i=yield(0,n.getGeometryGraphic)(yield(0,n.getSimplePointGraphic)(e.selectedPoint),$n),(0,n.isDefined)(i)?(u.removeAll(),u.add(i)):g()):g()}),I=(e,t=!1)=>{p(e),b(e,t)};return(0,e.jsxs)("div",{className:"merge-events-route-selection-form__content d-flex",css:t.css`
    display: flex;
    flex-direction: column;

    .merge-events-route-selection-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .merge-events-route-selection-form__actions {
      height: 100%;
    }
  `,children:[(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(Ii,{widgetId:a,network:s,networkDS:r,routeInfo:h,jimuMapView:c,hoverGraphic:l,reset:o,clearPickedGraphic:g,onRouteInfoUpdated:I,eventLayer:f,eventFeatures:v,intl:m,resetForDataAction:y})}),(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(Si,{routeInfo:h,reset:o,eventLayer:f,onUpdateRouteInfo:I,intl:m})})]})}var ji=m(1888);function Ti(i){var r,o,c,u;const{widgetId:d,lrsLayers:f,hideTitle:v,eventLayers:h,defaultEvent:p,JimuMapView:m,hoverGraphic:y,pickedGraphic:g,flashGraphic:b,conflictPreventionEnabled:I,onClearGraphic:D,displayConfig:S,currentSketchVM:w,onUpdateSelectedEventLayer:L,onUpdateSelectedNetworkLayer:j,eventFeatures:T,onEventRemoved:E,preservedEventIndex:k,onPreservedEventIndexChanged:N,onUpdateEventFeatures:F,routeInfo:M,onUpdateRouteInfo:x,eventDS:A,eventLayer:R,onUpdateEventDS:O,networkDS:C,onUpdateNetworkDS:P,intl:_,isEventPickerActive:G,onUpdateIsEventPickerActive:V,onUpdateToastMsgType:U,onUpdateToastMsg:W,onUpdateToastOpen:B,onUpdateStopQuery:z,toastMsgType:q,toastMsg:J,toastOpen:Q,resetForDataAction:Z,onUpdateResetForDataAction:H}=i,[$,K]=t.React.useState(null),[X,Y]=t.React.useState(!1),[ee,te]=t.React.useState(!1),[ne,ie]=t.React.useState((0,n.getIntialLocksInfo)()),[ae,se]=t.React.useState(!I),[re,oe]=t.React.useState(!0),ce=t.React.useRef(null),le=t.hooks.useTranslation(a);t.React.useEffect(()=>{(0,n.isDefined)($)&&x((0,n.getInitialRouteInfoState)())},[$]),t.React.useEffect(()=>{te(!0),(0,n.waitTime)(800).then(()=>{te(!1)})},[f]),t.React.useEffect(()=>{ee&&(x((0,n.getInitialRouteInfoState)()),Z?T.length>0&&N(0):F([]))},[ee]);const ue=t.React.useCallback(()=>{Y(!0)},[Y]);t.React.useEffect(()=>{if((0,n.isDefined)(R)&&f.some(e=>e.name===R.name)){const e=f.find(e=>(0,n.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===R.eventInfo.parentNetworkId);e&&e.layerType===n.LrsLayerType.Network?(K((0,t.Immutable)(e)),j((0,t.Immutable)(e))):K(null)}else{const e=f.find(e=>e.name===p.name);L((0,t.Immutable)(e))}},[p,f,R,L,j]),t.React.useEffect(()=>{de(n.LockAction.QueryAndAcquire,M)},[M]),t.React.useEffect(()=>{de(n.LockAction.None)},[C,R,$]);const de=t.React.useCallback((e=n.LockAction.None,t)=>{if(I){const i=Object.assign({},ne);(0,n.isDefined)($)&&(i.networkId=[$.networkInfo.lrsNetworkId]),(0,n.isDefined)(R)&&(i.eventServiceLayerIds=[R.serviceId]),(0,n.isDefined)(t)&&(i.routeInfo=t,i.routeOrLineId=[]),i.lockAction=e,ie(i)}},[I,R,ne,$]),fe=t.React.useCallback(e=>{const i=f.find(t=>t.name===e);if(i){const e=f.find(e=>(0,n.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===i.eventInfo.parentNetworkId);e&&e.layerType===n.LrsLayerType.Network&&(K((0,t.Immutable)(e)),j((0,t.Immutable)(e))),L((0,t.Immutable)(i))}},[f,L,j]),ve=t.React.useCallback(e=>{x(e)},[x]),he=t.React.useCallback(()=>{x((0,n.getInitialRouteInfoState)()),de(n.LockAction.Clear,(0,n.getInitialRouteInfoState)()),te(!0),setTimeout(()=>{te(!1)},800)},[de,x]),pe=t.React.useCallback(()=>{he(),m.clearSelectedFeatures()},[m,he]);t.React.useEffect(()=>{Z&&(N(-1),he(),setTimeout(()=>{H(!1)},100))},[Z,he,H,N]);const me=t.React.useMemo(()=>!!(X&&(0,n.isDefined)(m)&&(0,n.isDefined)(null==m?void 0:m.view)),[m,X]),ye=t.React.useCallback(()=>{D(),he()},[]),ge=t.React.useCallback((e,t,n)=>{se(!!n),ie(e)},[]),be=t.React.useCallback(e=>{oe(e)},[]);return(0,e.jsxs)("div",{className:"merge-events h-100 d-flex",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .merge-events-form {
      height: 100%;
    }

    .merge-events__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .merge-events__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .merge-events__toast {
      position: relative;
      top: 4%;
    }
    .merge-events-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[!v&&(0,e.jsx)(l,{}),(0,e.jsxs)("div",{className:"merge-events__content",children:[(0,e.jsx)(di,{network:$,event:R,dataSourcesReady:ue,onCreateNetworkDs:P,onCreateEventDs:O}),I&&(0,e.jsx)(n.LockManagerComponent,{intl:_,featureDS:C,showAlert:!0,lockInfo:ne,networkName:null===(r=null==$?void 0:$.networkInfo)||void 0===r?void 0:r.datasetName,conflictPreventionEnabled:I,onQueryAndAcquireComplete:ge,onMessageClear:()=>{de(n.LockAction.None)}}),!S.hideEvent&&(0,e.jsxs)("div",{children:[(0,e.jsx)(s.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100 title3",children:(0,n.formatMessage)(_,"eventRequiredLabel")}),(0,e.jsx)(s.Select,{"aria-label":(0,n.formatMessage)(_,"eventRequiredLabel"),className:"w-100 px-3",size:"sm",value:R?R.name:"",disabled:1===h.length,onChange:e=>{fe(e.target.value)},children:h.map((t,n)=>(0,e.jsx)(s.Option,{value:t,children:t},n))})]}),(0,e.jsx)(gi,{widgetId:d,network:$?$.networkInfo:null,isReady:me&&(null===(o=null==m?void 0:m.view)||void 0===o?void 0:o.ready),networkDS:C,eventDS:A,eventLayer:R,reset:ee,jimuMapView:m,hoverGraphic:y,pickedGraphic:g,flashGraphic:b,onsubmit:ve,onReset:he,currentSketchVM:w,eventFeatures:T,onEventRemoved:E,onPreservedEventIndexChanged:N,preservedEventIndex:k,isEventPickerActive:G,onUpdateIsEventPickerActive:V}),(0,e.jsx)(Li,{widgetId:d,network:$?$.networkInfo:null,isReady:me&&(null===(c=null==m?void 0:m.view)||void 0===c?void 0:c.ready),networkDS:C,reset:ee,jimuMapView:m,hoverGraphic:y,pickedGraphic:g,flashGraphic:b,onsubmit:ve,onReset:he,eventLayer:R,eventFeatures:T,routeInfo:M,onUpdateRouteInfo:x,intl:_,resetForDataAction:Z}),C&&A&&(0,e.jsx)(ui,{ref:ce,widgetId:d,network:$,jimuMapView:m,eventDS:A,networkDS:C,eventLayer:R,networkLayer:$,routeInfo:M,reset:ee,eventFeatures:T,preservedEventIndex:k,flashGraphic:b,onSubmit:ye,onUpdateToastMsgType:U,onUpdateToastMsg:W,onUpdateToastOpen:B,onUpdateStopQuery:z,onValidationChanged:be,intl:_,lockAquired:ae,conflictPreventionEnabled:I,toastMsgType:q})]}),(0,e.jsx)("div",{className:"merge-events-footer w-100",children:(0,e.jsxs)("div",{className:"merge-events-edit-attributes__action w-100 d-flex",children:[(0,e.jsx)(s.Label,{size:"sm",className:" mt-auto mr-auto title3",centric:!0,style:{color:null===(u=(0,ji.getTheme)())||void 0===u?void 0:u.sys.color.primary.main},onClick:pe,children:"Reset"}),(0,e.jsx)(s.Tooltip,{title:le("mergeLabel"),children:(0,e.jsx)("div",{className:"mt-auto ml-auto",children:(0,e.jsx)(s.Button,{type:"primary",className:"active","aria-label":le("mergeLabel"),size:"sm",disabled:!re,onClick:()=>{var e;null===(e=ce.current)||void 0===e||e.onSubmitClicked()},children:le("mergeLabel")})})})]})}),Q&&(0,e.jsx)("div",{className:"merge-events__toast-container px-3 w-100",children:(0,e.jsx)(s.Alert,{className:"merge-events__toast w-100",type:q,text:J,closable:!0,withIcon:!0,open:Q,onClose:()=>{B(!1)}})})]})}var Ei=m(59620),ki=m(10624),Ni=m(22089);function Fi(){return(0,t.Immutable)({networkLayers:[],eventLayers:[],intersectionLayers:[],defaultEvent:{index:-1,name:""},displayConfig:{hideEvent:!1}})}var Mi=m(4108),xi=function(e,t,n,i){return new(n||(n=Promise))(function(a,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,o)}c((i=i.apply(e,t||[])).next())})};class Ai extends t.React.PureComponent{constructor(e){super(e),this.supportedLrsLayerTypes=(0,t.Immutable)([n.LrsLayerType.Network,n.LrsLayerType.Event,n.LrsLayerType.LineEvent,n.LrsLayerType.Intersection]),this.componentDidMount=()=>{var e;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedEventLyr)&&this.setState({selectedEventLayer:this.props.selectedEventLyr,resetForDataAction:!0});const t=(0,n.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:t}),this.setSettingsPerView()},this.setSettingsPerView=()=>{var e;const{config:t}=this.props,i=t.mode&&t.mode!==n.ModeType.Map?t.lrsLayers:this.state.activeLrsLayers;let a=(null===(e=t.settingsPerView)||void 0===e?void 0:e[this.state.activeMapViewId])||Fi();if(i&&i.length>0){a=function(e,t,i){if(i){const i=t.filter(e=>e.layerType===n.LrsLayerType.Network).map(e=>e.name),a=t.filter(e=>(0,n.isLineEvent)(e)).map(e=>e.name),s=t.filter(e=>e.layerType===n.LrsLayerType.Intersection).map(e=>e.name);e=e.set("networkLayers",i).set("eventLayers",a).set("intersectionLayers",s)}const a=(0,n.getDefaultEvent)(t,e.defaultEvent,!1);return e.set("defaultEvent",a).set("displayConfig",e.displayConfig||{hideEvent:!1})}(a,i,!0),this.setState({settingPerView:a});const e=t.setIn(["settingsPerView",this.state.activeMapViewId],a);(0,Mi.getAppConfigAction)().editWidgetConfig(this.props.id,e).exec()}},this.selectFeaturesByGraphic=(e,n,i,...a)=>xi(this,[e,n,i,...a],void 0,function*(e,n,i,a=!1){return(0,c.loadArcGISJSAPIModules)(["esri/geometry/operators/bufferOperator"]).then(s=>xi(this,void 0,void 0,function*(){const r=s[0];let o=e.geometry;if("point"===o.type||"polyline"===o.type){const e=2.54*this.state.jimuMapView.view.scale/9600;o=r.execute(o,10*e,{unit:"meters"})}const c={geometry:o,spatialRelationship:n,returnGeometry:!0,returnZ:!0};a&&(c.outFields=["*"]);const l=this.state.jimuMapView.jimuLayerViews,u=Object.keys(l),d=[];for(let e=0;e<u.length;e++){const n=l[u[e]];if((n.type===t.SupportedJSAPILayerTypes.FeatureLayer||n.type===t.SupportedJSAPILayerTypes.SceneLayer)&&n.layer.title===this.state.selectedEventLayer.name&&n.selectFeaturesByQuery){const e=n.selectFeaturesByQuery(c,i);d.push(e)}}return this.state.jimuMapView.onSelectByQueryProgressChange(),Promise.all(d)}))}),this.onUpdateStopQuery=e=>{this.setState({stopQuery:e})},this.onJimuLayerViewSelectedFeaturesChange=e=>{this.state.stopQuery||e.layer.title===this.state.selectedEventLayer.name&&setTimeout(()=>{this.querySelectedFeatures(this.state.jimuMapView)},100)},this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally(()=>{this.state.jimuMapView&&this.state.jimuMapView.removeJimuLayerViewSelectedFeaturesChangeListener(this.onJimuLayerViewSelectedFeaturesChange),this.setState({jimuMapView:e}),e&&e.addJimuLayerViewSelectedFeaturesChangeListener(this.onJimuLayerViewSelectedFeaturesChange),setTimeout(()=>{this.querySelectedFeatures(e)},100)})},this.waitForChildDataSourcesReady=e=>xi(this,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const n=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==n?void 0:n.isDataSourceSet())&&!n.areChildDataSourcesCreated()?n.childDataSourcesReady().then(()=>n).catch(e=>n):Promise.resolve(n)}),this.getI18nMessage=(e,t)=>{const n=Object.assign({},a,s.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:n[e]},t)},this.handleSelectedEventLayerUpdate=e=>{this.setState({selectedEventLayer:e})},this.handleSelectedNetworkLayerUpdate=e=>{this.setState({selectedNetworkLayer:e})},this.removeEvent=e=>xi(this,void 0,void 0,function*(){var t;this.state.flashGraphic.removeAll();const n=[],i=[],a=null===(t=this.state.eventDS.getSchema())||void 0===t?void 0:t.idField;this.state.eventFeatures.forEach((t,s)=>{s!==e&&(n.push(t),i.push(t.attributes[a]))}),this.setState({preservedEventIndex:-1,routeInfo:this.getInitialRouteInfoState()});const s=this.state.jimuMapView.jimuLayerViews,r=Object.keys(s);for(let e=0;e<r.length;e++){const t=s[r[e]];if(t.layer.title===this.state.selectedEventLayer.name){const e=i.map(e=>Number(e));if(e.length>0){if(this.state.eventDS){const n=(yield this.state.eventDS.query({objectIds:e.slice().map(e=>e+""),returnGeometry:!0,returnZ:!0})).records;n&&n.length>0&&t.selectFeaturesByIds(e,n)}}else t.selectFeaturesByIds([])}}}),this.onUpdateEventFeatures=e=>{this.setState({eventFeatures:e})},this.onPreservedEventIndexChanged=e=>{this.setState({preservedEventIndex:e})},this.onUpdateRouteInfo=e=>{this.setState({routeInfo:e})},this.queryEvents=e=>{const t=this.state.eventDS;(0,n.queryEventsByEventObjectIds)(t,e).then(e=>xi(this,void 0,void 0,function*(){if(this.state.flashGraphic.removeAll(),yield i(!0,e,this.getI18nMessage,this.state.selectedEventLayer,this.state.selectedNetworkLayer,this.state.networkDS,this.state.toastMsgType,this.onUpdateToastMsgType,this.onUpdateToastMsg,this.onUpdateToastOpen),e.length>0){this.setState({preservedEventIndex:0,eventFeatures:e});const t=e[0].attributes[this.state.selectedEventLayer.eventInfo.routeIdFieldName];(0,n.queryRouteId)(t.trim(),this.state.selectedNetworkLayer.networkInfo,this.state.networkDS).then(e=>{(0,n.isDefined)(e)&&e.features.map(e=>{const t=e.attributes[this.state.selectedNetworkLayer.networkInfo.routeIdFieldSchema.name],i=e.attributes[this.state.selectedNetworkLayer.networkInfo.fromDateFieldSchema.name],a=e.attributes[this.state.selectedNetworkLayer.networkInfo.toDateFieldSchema.name],s=this.state.selectedNetworkLayer.networkInfo.useRouteName?e.attributes[this.state.selectedNetworkLayer.networkInfo.routeNameFieldSchema.name]:"",r=this.state.selectedNetworkLayer.networkInfo.supportsLines?e.attributes[this.state.selectedNetworkLayer.networkInfo.lineIdFieldSchema.name]:"",o=this.state.selectedNetworkLayer.networkInfo.supportsLines?e.attributes[this.state.selectedNetworkLayer.networkInfo.lineNameFieldSchema.name]:"";let c=new Date(Date.now());(0,n.isDefined)(a)&&c>a?c=(0,n.getDateWithTZOffset)(i,this.state.networkDS):c.setHours(0,0,0,0);let l=new Date(Date.now());(0,n.isDefined)(a)&&l>a?l=(0,n.getDateWithTZOffset)(a,this.state.networkDS):l.setHours(0,0,0,0),(0,n.isDefined)(a)||(l=null);const u={routeId:t,fromDate:(0,n.isDefined)(i)?(0,n.getDateWithTZOffset)(i,this.state.networkDS):null,toDate:(0,n.isDefined)(a)?(0,n.getDateWithTZOffset)(a,this.state.networkDS):null,selectedFromDate:c,selectedToDate:l,routeName:s,fromMeasure:NaN,toMeasure:NaN,selectedMeasure:NaN,lineId:r,lineName:o};return this.setState({routeInfo:u}),e})})}else this.setState({eventFeatures:[]})}))},this.querySelectedFeatures=e=>xi(this,void 0,void 0,function*(){var t;if(null==e?void 0:e.view){this.setState({preservedEventIndex:-1,routeInfo:this.getInitialRouteInfoState()});const n=yield this.getSelectedGraphics(e);if(n.length>0){const e=[],i=null===(t=this.state.eventDS.getSchema())||void 0===t?void 0:t.idField;n.forEach(t=>{var n,a;"polyline"===(null===(n=t.geometry)||void 0===n?void 0:n.type)&&(null===(a=t.layer)||void 0===a?void 0:a.layerId)===this.state.selectedEventLayer.serviceId&&e.push(t.attributes[i])}),this.queryEvents(e)}else"error"===this.state.toastMsgType&&this.onUpdateToastOpen(!1),this.setState({eventFeatures:[]})}}),this.onUpdateEventDS=e=>{this.setState({eventDS:e,preservedEventIndex:-1,eventFeatures:[],routeInfo:this.getInitialRouteInfoState()}),this.querySelectedFeatures(this.state.jimuMapView)},this.onUpdateNetworkDS=e=>{this.setState({networkDS:e})},this.onUpdateIsEventPickerActive=e=>{e||this.state.currentSketchVM.cancel(),this.setState({isEventPickerActive:e})},this.onUpdateToastMsgType=e=>{this.setState({toastMsgType:e})},this.onUpdateToastMsg=e=>{this.setState({toastMsg:e})},this.onUpdateToastOpen=e=>{this.setState({toastOpen:e})},this.onUpdateResetForDataAction=e=>{this.setState({resetForDataAction:e})},this.handleLrsLayersChanged=e=>{this.setState({activeLrsLayers:e})},this.handleViewChange=e=>{e&&this.setState({activeMapViewId:e.id})},this.state={hideTitle:!1,jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null,initialStage:!0,resultStage:!1,selectModeActive:!0,addToSelectionTool:!1,drawModeActive:!1,onDrawingComplete:!1,currentSketchVM:null,noFeaturesError:!1,noGraphicAfterFirstSelection:!1,onWidgetLoadShowLoadingIndicator:!0,loadingIndicator:!1,nextPossibleloadingIndicator:!1,selectedFeatureRecord:null,selectedEventLayer:null,selectedNetworkLayer:null,eventFeatures:[],preservedEventIndex:-1,routeInfo:this.getInitialRouteInfoState(),eventDS:null,networkDS:null,isEventPickerActive:!1,featuresByLayer:null,toastOpen:!1,toastMsgType:"info",toastMsg:"",stopQuery:!1,resetForDataAction:!1,activeMapViewId:"",activeLrsLayers:this.props.config.lrsLayers,settingPerView:Fi(),isConflictPreventionEnabled:!1},this.widgetOuterDivId="widget-outer-div-"+this.props.id}getInitialRouteInfoState(){return{routeId:"",routeName:"",fromMeasure:NaN,toMeasure:NaN,fromDate:null,toDate:null,selectedMeasure:NaN,selectedFromDate:new Date(Date.now()),selectedToDate:null}}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,i){var a,s,r,o,c,l;i.jimuMapView!==this.state.jimuMapView&&(0,n.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers(),this.createApiWidget(this.state.jimuMapView));const u=null===(r=null===(s=null===(a=(0,t.getAppStore)())||void 0===a?void 0:a.getState())||void 0===s?void 0:s.widgetsRuntimeInfo[this.props.id])||void 0===r?void 0:r.state;u!==t.WidgetState.Opened&&u||(null===(o=this.props)||void 0===o?void 0:o.selectedEventLyr)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedEventLyr&&(null===(c=null==e?void 0:e.mutableStatePropsVersion)||void 0===c?void 0:c.selectedEventLyr)===(null===(l=this.props.mutableStatePropsVersion)||void 0===l?void 0:l.selectedEventLyr)||this.setState({selectedEventLayer:this.props.selectedEventLyr,resetForDataAction:!0})),this.state.activeLrsLayers!==i.activeLrsLayers&&this.setSettingsPerView();const{config:d}=this.props,f=d.mode&&d.mode!==n.ModeType.Map?d.lrsLayers:this.state.activeLrsLayers;f.length>0&&(0,n.checkConflictPrevention)(f[0].lrsUrl).then(e=>{const t=null!==e&&e;this.state.isConflictPreventionEnabled!==t&&this.setState({isConflictPreventionEnabled:t})})}removeGraphicLayers(){(0,n.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,n.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,n.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,n.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const n=new Ei.default({listMode:"hide"}),i=new Ei.default({listMode:"hide"}),a=new Ei.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([i,a,n]),this.setState({hoverGraphic:n}),this.setState({pickedGraphic:i}),this.setState({flashGraphic:a})}}clearGraphics(){(0,n.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,n.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,n.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}queryForNewSelection(e,t){this.setState({featuresByLayer:e});let n=null;e.length>0&&e.forEach(e=>{var t,i,a,s,r;if(e.length>0&&"polyline"===(null===(t=e[0].geometry)||void 0===t?void 0:t.type)&&e[0].layer.layerId===this.state.selectedEventLayer.serviceId){this.setState({isEventPickerActive:!1});const t=null===(i=this.state.eventDS.getSchema())||void 0===i?void 0:i.idField,o=[];return e.forEach(e=>{o.push(e.attributes[t])}),this.queryEvents(o),n=new Ni.default({geometry:null===(a=e[0])||void 0===a?void 0:a.geometry,attributes:(null===(s=e[0])||void 0===s?void 0:s.attributes)?null===(r=e[0])||void 0===r?void 0:r.attributes:{}}),!0}}),n||this.state.selectModeActive&&this.state.currentSketchVM.create("rectangle")}createApiWidget(e){var n;const i=new ki.default({view:e?e.view:null,layer:new Ei.default,updateOnGraphicClick:!1,defaultCreateOptions:{mode:"hybrid",hasZ:"3d"===(null===(n=null==e?void 0:e.view)||void 0===n?void 0:n.type)},polylineSymbol:{type:"simple-line",width:5},defaultUpdateOptions:{toggleToolOnClick:!1}});i.on("create",e=>{if("start"===e.state){const e={type:"simple-line",width:5};this.state.currentSketchVM.set("polylineSymbol",e)}else"complete"===e.state&&(this.setState({noFeaturesError:!1}),this.state.selectModeActive&&(this.setState({loadingIndicator:!0}),this.selectFeaturesByGraphic(e.graphic,"intersects",t.DataSourceSelectionMode.New).then(e=>{this.queryForNewSelection(e,!0)})))}),this.setState({currentSketchVM:i})}getSelectedGraphics(e){return xi(this,void 0,void 0,function*(){let t=[];return e&&(t=yield e.getSelectedFeatures()),t})}getConfigValues(e,t,i){const a={networkLayers:t.networkLayers,eventLayers:t.eventLayers,intersectionLayers:t.intersectionLayers,defaultEvent:t.defaultEvent,displayConfig:t.displayConfig};return Object.entries(a).reduce((t,[a,s])=>(t[a]=(0,n.getConfigValue)(e,a,i,s),t),{})}render(){var i,a;const{config:r,id:l}=this.props;let{useMapWidgetIds:u}=this.props;const{mapViewsConfig:d}=r,f=r.mode&&r.mode!==n.ModeType.Map?r.lrsLayers:this.state.activeLrsLayers,v=this.getConfigValues(r,this.state.settingPerView,this.state.activeMapViewId),{networkLayers:h,eventLayers:p,intersectionLayers:m,defaultEvent:y,displayConfig:g}=v,b=(0,n.getModeType)(r.mode,f),{jimuMapView:I}=this.state,D=(null==h?void 0:h.length)>0&&(null==p?void 0:p.length)>0;if(!u){const e=null===(a=null===(i=(0,t.getAppStore)())||void 0===i?void 0:i.getState())||void 0===a?void 0:a.appConfig;u=(0,n.findFirstArcgisMapWidgetId)(e)}return(0,e.jsx)(s.Paper,{variant:"flat",shape:"none",className:"jimu-widget runtime-merge-events surface-1 border-0",children:(0,e.jsxs)("div",{id:this.widgetOuterDivId,className:"widget-outer-div h-100 w-100 d-flex",children:[(0,e.jsx)(c.JimuMapViewComponent,{useMapWidgetId:null==u?void 0:u[0],onActiveViewChange:this.onActiveViewChange}),b&&(0,e.jsx)(n.MapViewLoader,{config:r,widgetId:l,supportedLrsLayerTypes:this.supportedLrsLayerTypes,useMapWidgetIds:u,mapViewsConfig:d,jimuMapView:I,outputDataSourceType:"none",onLrsLayersChanged:this.handleLrsLayersChanged,onViewChange:this.handleViewChange}),D&&(0,e.jsx)(Ti,{widgetId:l,intl:this.props.intl,hideTitle:this.state.hideTitle,lrsLayers:f,JimuMapView:I,eventLayers:p,networkLayers:h,instersectionLayers:m,defaultEvent:y,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:this.state.isConflictPreventionEnabled,onClearGraphic:this.clearGraphics.bind(this),displayConfig:g,currentSketchVM:this.state.currentSketchVM,onUpdateSelectedEventLayer:this.handleSelectedEventLayerUpdate,onUpdateSelectedNetworkLayer:this.handleSelectedNetworkLayerUpdate,eventFeatures:this.state.eventFeatures,preservedEventIndex:this.state.preservedEventIndex,onEventRemoved:this.removeEvent,onPreservedEventIndexChanged:this.onPreservedEventIndexChanged,onUpdateEventFeatures:this.onUpdateEventFeatures,routeInfo:this.state.routeInfo,onUpdateRouteInfo:this.onUpdateRouteInfo,eventDS:this.state.eventDS,eventLayer:this.state.selectedEventLayer,networkDS:this.state.networkDS,onUpdateEventDS:this.onUpdateEventDS,onUpdateNetworkDS:this.onUpdateNetworkDS,isEventPickerActive:this.state.isEventPickerActive,onUpdateIsEventPickerActive:this.onUpdateIsEventPickerActive,onUpdateToastMsgType:this.onUpdateToastMsgType,onUpdateToastMsg:this.onUpdateToastMsg,onUpdateToastOpen:this.onUpdateToastOpen,toastMsgType:this.state.toastMsgType,toastMsg:this.state.toastMsg,toastOpen:this.state.toastOpen,onUpdateStopQuery:this.onUpdateStopQuery,resetForDataAction:this.state.resetForDataAction,onUpdateResetForDataAction:this.onUpdateResetForDataAction}),!D&&(0,e.jsx)(s.WidgetPlaceholder,{icon:o(),widgetId:l,message:this.getI18nMessage("_widgetLabel")})]})})}}Ai.mapExtraStateProps=(e,t)=>{var n;return{selectedEventLyr:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.selectedEventLyr}};const Ri=Ai;function Oi(e){m.p=e}})(),y})())}}});