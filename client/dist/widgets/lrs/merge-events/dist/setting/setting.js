System.register(["jimu-core/emotion","jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree"],function(e,t){var a={},n={},s={},i={},r={},l={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){n.Immutable=e.Immutable,n.React=e.React,n.ReactRedux=e.ReactRedux,n.css=e.css,n.hooks=e.hooks},function(e){s.EmptyPlaceholder=e.EmptyPlaceholder,s.LrsLayerType=e.LrsLayerType,s.LrsLoader=e.LrsLoader,s.ModeType=e.ModeType,s.getConfigValue=e.getConfigValue,s.getDefaultEvent=e.getDefaultEvent,s.getLayersByType=e.getLayersByType,s.isLineEvent=e.isLineEvent,s.lrsDefaultMessages=e.lrsDefaultMessages,s.updateConfig=e.updateConfig,s.updateDefaultForMapMode=e.updateDefaultForMapMode},function(e){i.Checkbox=e.Checkbox,i.CollapsablePanel=e.CollapsablePanel,i.Select=e.Select,i.Switch=e.Switch,i.TextInput=e.TextInput,i.defaultMessages=e.defaultMessages,i.hooks=e.hooks},function(e){r.SettingRow=e.SettingRow,r.SettingSection=e.SettingSection},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType}],execute:function(){e((()=>{var e={8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=i},47626:e=>{"use strict";e.exports=s},51334:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 3.5a3.5 3.5 0 1 0-7 0V6H3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-2V3.5l.005-.164A2.5 2.5 0 0 1 12.5 1l.164.005A2.5 2.5 0 0 1 15 3.5a.5.5 0 0 0 1 0M9 7H3v8h9V7H9m-1.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=a},79244:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=r},98640:e=>{"use strict";e.exports=l}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,o),s.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var d={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(d),o.d(d,{__set_webpack_public_path__:()=>h,default:()=>v});var e=o(67386),t=o(79244),a=o(47626),n=o(14321);const s={blankStatus:"Select a map to import LRS networks",defaultSettings:"Default Settings",defaultEvent:"Event",defaultMethod:"Method",defaultType:"Type",methodMeasure:"Route and Measure",methodCoordinate:"Coordinate",methodLocationOffset:"Location Offset",operationTypeSingle:"Single Point",operationTypeMultiple:"Multiple Point",loadLayers:"Load Layers",clearLayers:"Clear Layers",useFieldAlias:"Use field alias",configureFields:"Configure Fields",layerConfig:"Layer Configuration",selectMap:"Select Map",noNetworkLayersTips:"No Network layers in the map",noPointEventLayersTips:"No Point event layers in the map",missingParentNetwork:"Parent network is missing",attributeEditable:"Editable",attributeNotEditable:"Not editable"};var i=o(79298);function r(){return(0,t.Immutable)({networkLayers:[],eventLayers:[],intersectionLayers:[],defaultEvent:{index:-1,name:""},displayConfig:{hideEvent:!1}})}function l(e,t,n){if(n){const n=t.filter(e=>e.layerType===a.LrsLayerType.Network).map(e=>e.name),s=t.filter(e=>(0,a.isLineEvent)(e)).map(e=>e.name),i=t.filter(e=>e.layerType===a.LrsLayerType.Intersection).map(e=>e.name);e=e.set("networkLayers",n).set("eventLayers",s).set("intersectionLayers",i)}const s=(0,a.getDefaultEvent)(t,e.defaultEvent,!1);return e.set("defaultEvent",s).set("displayConfig",e.displayConfig||{hideEvent:!1})}function c(e,t){return e.set("mode",t).set("lrsLayers",[]).set("mapViewsConfig",{}).set("settingsPerView",{}).set("networkLayers",[]).set("eventLayers",[]).set("intersectionLayers",[]).set("defaultEvent",{index:-1,name:""}).set("displayConfig",{hideEvent:!1})}var u=o(98640);const p=o(8547),g=o(51334);function m(r){var l;const{widgetId:o,index:d,config:c,activeMapViewId:m,onSettingChange:f}=r,y=(v="lrsLayers",h=[],t.React.useMemo(()=>(0,a.getConfigValue)(c,v,m)||h,[c,m]));var v,h;const b=y[d],w=t.hooks.useTranslation(s),[L,S]=t.React.useState(null==b?void 0:b.name),x=function(e){const{widgetId:a,useDataSourceId:n}=e;return t.ReactRedux.useSelector(e=>{var t;let s;return s=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(t=s.widgets[a].useDataSources)&&void 0!==t?t:[]).some(e=>e.dataSourceId===n)})}({widgetId:o,useDataSourceId:null===(l=null==b?void 0:b.useDataSource)||void 0===l?void 0:l.dataSourceId});t.React.useEffect(()=>{(null==b?void 0:b.name)&&L!==(null==b?void 0:b.name)&&S(null==b?void 0:b.name)},[null==b?void 0:b.name]);const C=t.React.useCallback((e,n,s=!1)=>{var i;let r=null!=y?y:(0,t.Immutable)([]);if(r=t.Immutable.set(r,e,n),c.mode===a.ModeType.Map){const e=m,t=(null===(i=c.mapViewsConfig)||void 0===i?void 0:i[e]).set("lrsLayers",r),a=c.setIn(["mapViewsConfig",e],t);f({id:o,config:a})}else f({id:o,config:c.set("lrsLayers",r)})},[y,c,m,f,o]),I=t.React.useCallback((e,t,a=!1)=>{let n;n=null==t?b.without(e):b.set(e,t),C(d,n,a)},[C,d,b]),T=t.React.useCallback((e,t,a=!1)=>{const n=b.eventInfo.set(e,t),s=b.set("eventInfo",n);C(d,s,a)},[C,d,b]),j=t.React.useCallback(e=>{S(e.target.value)},[]),M=t.React.useCallback(e=>{e.trim().length>0?I("name",e,!0):S(null==b?void 0:b.name)},[null==b?void 0:b.name,I]),R=e=>b.eventInfo.attributeFields[e].enabled,E=e=>{const t=b.eventInfo.attributeFields.asMutable({deep:!0});t[e].enabled=!t[e].enabled,T("attributeFields",t,!0)},k={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:u.TreeItemActionType.RenderOverrideItem,children:[{name:u.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:u.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:u.TreeItemActionType.RenderOverrideItemBody,children:[{name:u.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:u.TreeItemActionType.RenderOverrideItemDragHandle},{name:u.TreeItemActionType.RenderOverrideItemDetailToggle},{name:u.TreeItemActionType.RenderOverrideItemTitle},{name:u.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,e.jsx)("div",{className:"h-100",children:(0,e.jsx)("div",{css:t.css`height: 100%; overflow:auto;`,children:b&&(x||c.mode===a.ModeType.Map)&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(i.SettingSection,{role:"group","aria-label":w("label"),title:w("label"),children:[(0,e.jsx)(i.SettingRow,{children:(0,e.jsx)(n.TextInput,{size:"sm",type:"text",className:"w-100",value:L,onChange:j,onAcceptValue:M,"aria-label":w("label")})}),(0,a.isLineEvent)(b)&&(0,e.jsx)(i.SettingRow,{flow:"no-wrap",tag:"label",label:w("useFieldAlias"),children:(0,e.jsx)(n.Switch,{checked:b.useFieldAlias,onChange:(e,t)=>{I("useFieldAlias",t,!1)}})})]}),(0,a.isLineEvent)(b)&&(0,e.jsx)(i.SettingSection,{role:"group",children:(0,e.jsx)(i.SettingRow,{flow:"wrap",label:w("configureFields"),children:(0,e.jsx)(u.List,Object.assign({className:"list-routeid-fields pt-2 w-100",showCheckbox:!0,itemsJson:Array.from(b.eventInfo.attributeFields).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:R(t),itemStateTitle:b.useFieldAlias?e.field.alias:e.field.name,itemStateCommands:[{label:e.editable?w("attributeEditable"):w("attributeNotEditable"),iconProps:()=>({icon:e.editable?g:p,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e;(e=>{const t=b.eventInfo.attributeFields.asMutable({deep:!0});t[e].editable=!t[e].editable,T("attributeFields",t,!0)})(+t.itemKey)}}]})),renderOverrideItemDetailToggle:(t,a)=>{const{itemJsons:s,itemJsons:[{itemStateDetailVisible:i,itemStateDetailContent:r}]}=a.props,[l]=s,o=+l.itemKey;return r?(0,e.jsx)(n.Checkbox,{"aria-expanded":!!i,className:"jimu-tree-item__detail-toggle mr-2",checked:b.eventInfo.attributeFields[o].enabled,onClick:e=>{E(o)}}):null},dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,n]=a;var s;s=n.map(e=>e.itemStateDetailContent),T("attributeFields",s,!0)},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;E(+a.itemKey)}},k))})})]})})})}function f(r){const{widgetId:l,config:o,activeMapViewId:d,onSettingChange:c}=r,u=t.hooks.useTranslation(s,a.lrsDefaultMessages),p=(e,n)=>t.React.useMemo(()=>(0,a.getConfigValue)(o,e,d)||n,[o,d]),g=p("lrsLayers",(0,t.Immutable)([])),m=p("eventLayers",[]),f=p("defaultEvent",{index:-1,name:""}),y=p("displayConfig",{hideEvent:!1});return(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(i.SettingSection,{className:"px-4",children:(0,e.jsx)(n.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:u("defaultSettings"),defaultIsOpen:!0,disabled:!1,"aria-label":u("defaultSettings"),children:(0,e.jsx)(i.SettingRow,{flow:"wrap",label:u("defaultEvent"),children:(0,e.jsx)(n.Select,{"aria-label":u("defaultEvent"),className:"w-100",size:"sm",value:f.name,onChange:e=>{(e=>{const t=g.findIndex(t=>t.name===e),n={index:t,name:g[t].name};(0,a.updateConfig)(l,o,"defaultEvent",n,d,c)})(e.target.value)},children:m.map((t,a)=>(0,e.jsx)("option",{value:t,children:t},a))})})})}),(0,e.jsx)(i.SettingSection,{className:"px-4",children:(0,e.jsx)(n.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:u("displaySettings"),defaultIsOpen:!0,disabled:!1,"aria-label":u("displaySettings"),children:(0,e.jsx)(i.SettingRow,{flow:"no-wrap",tag:"label",label:u("hideEvent"),children:(0,e.jsx)(n.Switch,{checked:y.hideEvent,onChange:()=>{(()=>{const e=Object.assign({},y);e.hideEvent=!e.hideEvent,(0,a.updateConfig)(l,o,"displayConfig",e,d,c)})()}})})})})]})}var y=function(e,t,a,n){return new(a||(a=Promise))(function(s,i){function r(e){try{o(n.next(e))}catch(e){i(e)}}function l(e){try{o(n.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,l)}o((n=n.apply(e,t||[])).next())})};const v=o=>{const{id:d,intl:u,widgetId:p,config:g,useMapWidgetIds:v,portalUrl:h,theme:b,onSettingChange:w}=o,[L,S]=t.React.useState(-1),[x,C]=t.React.useState(""),[I,T]=t.React.useState(""),[j,M]=t.React.useState({}),R=t.React.useRef(g),E=g.mode===a.ModeType.Map,k=(null==v?void 0:v.length)>0,V=!E&&g.lrsLayers.length>0||E&&g.mapViewsConfig&&Object.keys(g.mapViewsConfig).length>0,D=!E&&g.lrsLayers&&0!==g.lrsLayers.length||E&&g.settingsPerView&&g.settingsPerView[x],P=(0,t.Immutable)([a.LrsLayerType.Event,a.LrsLayerType.LineEvent,a.LrsLayerType.Network,a.LrsLayerType.Intersection]),O=(0,t.Immutable)([a.LrsLayerType.LineEvent,a.LrsLayerType.Network]),F=n.hooks.useTranslate(s,n.defaultMessages,a.lrsDefaultMessages);t.React.useEffect(()=>{if(void 0===g.mode){const e=g.lrsLayers.length>0?a.ModeType.Layer:a.ModeType.Map;o.onSettingChange({id:p,config:g.set("mode",e)})}},[]),t.React.useEffect(()=>{g&&(R.current=g)},[g]);const N=t.React.useCallback((...e)=>{const[t,...a]=e,n=Object.assign(Object.assign({id:d},t));w(n,...a)},[d,w]),A=t.React.useCallback(e=>{const t=e.target.value;C(t)},[]),_=t.React.useCallback(e=>{w({id:p,config:c(g,e),useDataSources:[]})},[g,w,p]),B=t.React.useCallback((e,t)=>{S(e),E&&""!==t&&T(t)},[E]),U=t.React.useCallback((e,n)=>{let s=g.set("lrsLayers",e);const{networks:i,lineEvents:r,intersections:l}=(0,a.getLayersByType)(e,(0,t.Immutable)([]));s=s.set("networkLayers",i).set("eventLayers",r).set("intersectionLayers",l);const o=(0,a.getDefaultEvent)(s.lrsLayers,s.defaultEvent,!1);s=s.set("defaultEvent",o),N({config:s,useDataSources:Object.values(n.useDataSourceMap)})},[g,N]),z=t.React.useRef(!1),H=t.React.useCallback((e,n,s,i)=>y(void 0,void 0,void 0,function*(){var o;yield y(void 0,void 0,void 0,function*(){for(;z.current;)yield new Promise(e=>setTimeout(e,10))}),z.current=!0;let d=R.current;try{for(const s in e)if(i){d=d.set("mapViewsConfig",e);const i=e[s];let c=(null===(o=R.current.settingsPerView)||void 0===o?void 0:o[s])||r();const{networks:u,lineEvents:p,intersections:g}=(0,a.getLayersByType)(i.lrsLayers,i.disabledLayerIds);c=c.setIn(["networkLayers"],u).setIn(["eventLayers"],p).setIn(["intersectionLayers"],g),c=l(c,i.lrsLayers,!1),c=(0,a.updateDefaultForMapMode)(c,i,a.LrsLayerType.Event,"defaultEvent",!1),(null==d?void 0:d.settingsPerView)||(d=d.set("settingsPerView",(0,t.Immutable)({})));const m=d.settingsPerView.set(s,c);d=d.set("settingsPerView",m),""===x&&C(s),M(n)}else""===x&&C(s),M(n);N({config:d,useDataSources:Object.values(s.useDataSourceMap)})}finally{R.current=d,z.current=!1}}),[x,N]);return(0,e.jsx)("div",{className:"setting-add-point-event h-100",children:(0,e.jsxs)("div",{className:"jimu-widget-setting setting-add-point-event__setting-content h-100",children:[(0,e.jsx)(a.LrsLoader,{intl:u,portalUrl:h,theme:b,widgetId:p,mode:g.mode,useMapWidgetIds:v,lrsLayers:g.lrsLayers,mapViewsConfig:g.mapViewsConfig,supportedLrsTypes:P,requiredLrsTypes:O,outputDataSourceWidgetType:"sld",onLrsLayersUpdated:U,onMapViewsConfigUpdated:H,onMapWidgetSelected:(e,t)=>{o.onSettingChange({id:p,config:c(g,t),useMapWidgetIds:e})},onReset:_,onSelectionChanged:B,children:L>-1&&(0,e.jsx)(m,{widgetId:p,config:g,index:L,activeMapViewId:I,onSettingChange:w})}),k&&D&&(0,e.jsx)(t.React.Fragment,{children:Object.keys(j).length>1&&(0,e.jsx)(i.SettingSection,{role:"none",children:(0,e.jsx)(i.SettingRow,{flow:"wrap",label:F("selectMapToEditSettings"),children:(0,e.jsx)(n.Select,{className:"w-100",size:"sm",value:x,onChange:A,children:Object.keys(j).map(t=>(0,e.jsx)("option",{value:t,children:j[t]},t))})})})}),V&&D&&(0,e.jsx)(t.React.Fragment,{children:(0,e.jsx)(f,{intl:u,widgetId:p,config:g,activeMapViewId:x,onSettingChange:w})}),!E&&!V&&!D&&(0,e.jsx)(a.EmptyPlaceholder,{isMapMode:!1}),E&&!k&&(0,e.jsx)(a.EmptyPlaceholder,{isMapMode:!0})]})})};function h(e){o.p=e}})(),d})())}}});