System.register(["jimu-core","widgets/shared-code/lrs"],function(e,t){var r={},o={};return{setters:[function(e){r.AbstractDataAction=e.AbstractDataAction,r.DataLevel=e.DataLevel,r.DataSourceStatus=e.DataSourceStatus,r.DataSourceTypes=e.DataSourceTypes,r.Immutable=e.Immutable,r.MutableStoreManager=e.MutableStoreManager,r.getAppStore=e.getAppStore},function(e){o.findEventInfoFromMapViewsConfigAndEventDS=e.findEventInfoFromMapViewsConfigAndEventDS,o.isDefined=e.isDefined}],execute:function(){e((()=>{var e={47626:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=r}},t={};function a(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var n={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(n),a.d(n,{default:()=>r});var e=a(79244),t=a(47626);class r extends e.AbstractDataAction{isSupported(r,a){var n;if(r.length>1)return Promise.resolve(!1);const i=r[0];if(1!==i.records.length)return Promise.resolve(!1);const{dataSource:s,records:d}=i,u=s.type===e.DataSourceTypes.FeatureLayer||s.type===e.DataSourceTypes.SceneLayer,l=s.isDataSourceSet(),c=a!==e.DataLevel.Records,f=a===e.DataLevel.Records&&0===(null==d?void 0:d.length),v=!s.isInAppConfig()&&!u;if(l||c||f||v)return Promise.resolve(!1);if(!s||s.getStatus()===e.DataSourceStatus.NotReady)return Promise.resolve(!1);const g=s;if(!(0,t.isDefined)(g))return Promise.resolve(!1);const p=o(),S=null===(n=null==p?void 0:p.widgets)||void 0===n?void 0:n[this.widgetId];let m,D;if(S.config.lrsLayers.forEach(e=>{e.id===g.id&&(D=e,m=e.eventInfo)}),!(0,t.isDefined)(m)){const e=S.config.mapViewsConfig;for(const t in e)if(e[t].lrsLayers)for(const r of e[t].lrsLayers)r.id===g.id&&(D=r,m=r.eventInfo)}return(0,t.isDefined)(D)&&"NETWORK"===D.layerType?Promise.resolve(!1):m?Promise.resolve(!0):Promise.resolve(!1)}onExecute(r,a){var n;const i=r[0],s=i.dataSource,d=o(),u=null===(n=null==d?void 0:d.widgets)||void 0===n?void 0:n[this.widgetId];let l;if(u.config.lrsLayers.forEach(e=>{e.id===s.id&&(l=e)}),!(0,t.isDefined)(l)){const e=u.config.mapViewsConfig,r=i.dataSource;l=(0,t.findEventInfoFromMapViewsConfigAndEventDS)(e,r)}return setTimeout(()=>{e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventLyr",(0,e.Immutable)(l));const t=i.records[0].getData();e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventObjectId",t[i.dataSource.getSchema().idField]),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventRouteId",t[l.eventInfo.routeIdFieldName]),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventFromDate",new Date(t[l.eventInfo.fromDateFieldName]))},1e3),Promise.resolve(!0)}}function o(){var t,r,o;return window.jimuConfig.isBuilder?null===(r=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===r?void 0:r.appConfig:null===(o=(0,e.getAppStore)().getState())||void 0===o?void 0:o.appConfig}})(),n})())}}});