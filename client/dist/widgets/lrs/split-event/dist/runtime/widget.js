System.register(["jimu-core/emotion","jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-arcgis","jimu-core/react","esri/geometry/operators/disjointOperator","calcite-components","jimu-theme","esri/layers/GraphicsLayer","jimu-for-builder"],function(e,t){var n={},a={},i={},o={},r={},s={},l={},c={},u={},d={},f={};return{setters:[function(e){n.jsx=e.jsx,n.jsxs=e.jsxs},function(e){a.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.Immutable=e.Immutable,a.JSAPILayerTypes=e.JSAPILayerTypes,a.MessageManager=e.MessageManager,a.React=e.React,a.RecordSetChangeType=e.RecordSetChangeType,a.WidgetState=e.WidgetState,a.css=e.css,a.focusElementInKeyboardMode=e.focusElementInKeyboardMode,a.getAppStore=e.getAppStore,a.hooks=e.hooks},function(e){i.AttributeTable=e.AttributeTable,i.GetUnits=e.GetUnits,i.InlineEditableDropdown=e.InlineEditableDropdown,i.Intellisense=e.Intellisense,i.LockAction=e.LockAction,i.LockManagerComponent=e.LockManagerComponent,i.LrsApplyEdits=e.LrsApplyEdits,i.LrsLayerType=e.LrsLayerType,i.MapViewLoader=e.MapViewLoader,i.ModeType=e.ModeType,i.QueryMapPointWithMeasureOnRoute=e.QueryMapPointWithMeasureOnRoute,i.QueryMeasureOnRoute=e.QueryMeasureOnRoute,i.QueryRouteMeasures=e.QueryRouteMeasures,i.RoutePicker=e.RoutePicker,i.RoutePickerPopup=e.RoutePickerPopup,i.checkConflictPrevention=e.checkConflictPrevention,i.convertStationToNumber=e.convertStationToNumber,i.findFirstArcgisMapWidgetId=e.findFirstArcgisMapWidgetId,i.flash=e.flash,i.formatMessage=e.formatMessage,i.getCalciteBasicTheme=e.getCalciteBasicTheme,i.getConfigValue=e.getConfigValue,i.getDateToUTC=e.getDateToUTC,i.getDateWithRouteTime=e.getDateWithRouteTime,i.getDateWithTZOffset=e.getDateWithTZOffset,i.getDateWithoutTZOffset=e.getDateWithoutTZOffset,i.getDateWithoutTime=e.getDateWithoutTime,i.getDefaultEvent=e.getDefaultEvent,i.getGeometryGraphic=e.getGeometryGraphic,i.getInitialRouteInfoState=e.getInitialRouteInfoState,i.getIntialLocksInfo=e.getIntialLocksInfo,i.getModeType=e.getModeType,i.getNetworkOutFields=e.getNetworkOutFields,i.getRouteFromEndMeasures=e.getRouteFromEndMeasures,i.getSimpleLineGraphic=e.getSimpleLineGraphic,i.getSimplePointGraphic=e.getSimplePointGraphic,i.getSuggestions=e.getSuggestions,i.isDate=e.isDate,i.isDefined=e.isDefined,i.isInWidgetController=e.isInWidgetController,i.isLineEvent=e.isLineEvent,i.isNumber=e.isNumber,i.isWithinTolerance=e.isWithinTolerance,i.queryEventsByEventObjectIds=e.queryEventsByEventObjectIds,i.queryEventsByRouteIdOrEventObjectId=e.queryEventsByRouteIdOrEventObjectId,i.queryLineId=e.queryLineId,i.queryRouteIdOrName=e.queryRouteIdOrName,i.setRouteInfoByRouteIdOrName=e.setRouteInfoByRouteIdOrName,i.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,i.useEditSession=e.useEditSession,i.useVmsManager=e.useVmsManager,i.validateField=e.validateField,i.validateRangeDomain=e.validateRangeDomain,i.waitTime=e.waitTime},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Label=e.Label,o.Option=e.Option,o.Paper=e.Paper,o.Select=e.Select,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.useImperativeHandle=e.useImperativeHandle},function(){},function(e){c.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){u.getTheme=e.getTheme},function(e){d.default=e.default},function(e){f.getAppConfigAction=e.getAppConfigAction}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=u},4108:e=>{"use strict";e.exports=f},14321:e=>{"use strict";e.exports=o},19027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M9 1h1v1H9zm0 2H8V0h3v3h-1v14h1v3H8v-3h1zm0 15h1v1H9zM8 4H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h6v-1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6zm0 5.5H3.5v-2h-1v3H8zm9 6.5h-6v-1h6a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-6V4h6a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2m-6-5.5h4.5v2h1v-3H11z" clip-rule="evenodd"></path></svg>'},36614:e=>{"use strict";e.exports=l},47626:e=>{"use strict";e.exports=i},59620:e=>{"use strict";e.exports=d},62686:e=>{"use strict";e.exports=r},67386:e=>{"use strict";e.exports=n},68972:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=a},99037:e=>{"use strict";e.exports=c}},t={};function v(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,v),i.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var n in t)v.o(t,n)&&!v.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var p={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(p),v.d(p,{__set_webpack_public_path__:()=>Na,default:()=>Ta});var e=v(67386),t=v(79244),n=v(47626);const a={_widgetLabel:"Split Event",routeIdLabel:"Route ID",eventOidLabel:"Event OID",routeNameLabel:"Route Name",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",measureWithUnits:"Measure ({units}) *",splitMeasureWithUnits:"Split Measure ({units}) *",selectRouteLabel:"Select Route",routePicker:"Route Picker",splitDateLabel:"Split Date *",useStartDateLabel:"Use route start date",attributeLabel:"Attribute",valueLabel:"Value",resetForm:"Reset",nullLabel:"null",trueLabel:"true",falseLabel:"false",attributeError:"{fieldValue}: {message} ({event1or2})",eventSplit:"Event Split",splitLabel:"Split",routeNotFound:"Route not found",invalidFromDateBefore:"From date is before route's from date",invalidFromDateAfter:"From date is after route's to date",invalidToDateBefore:"To date is before route's from date",invalidToDateAfter:"To date is after route's to date",invalidDatesOrder:"Selected from date is greater than selected to date",invalidDatesSameDay:"From and to dates cannot be the same",measureLessError:"Selected measure is less than route's from measure",measureGreaterError:"Selected measure is greater than route's to measure",invalidMeasureError:"Input measure is invalid",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Valid exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",noResult:"No results",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Inches",event1Label:"Event 1",event2Label:"Event 2",noEventFound:"Event does not exist for the selected event layer in this location.",multipleEventsFound:"More than one event exists at the split location.",unableToSplitAtStartOrEnd:"Unable to split at the start or end of an event.",chooseEventLocationFromMap:"(Choose event location from map)",invalidContingentValues:"Attribute do not satisfy a required Contingent Value: {groupNames}",contingentValueError:"Invalid contingent value in the field"};var i=v(14321),o=v(19027),r=v.n(o),s=v(62686);function l(){const n=t.hooks.useTranslation(a);return(0,e.jsx)("div",{className:"split-event-form-header",children:(0,e.jsx)("div",{className:"split-event-form-header__header pt-3 px-3 align-items-center",children:(0,e.jsx)("div",{className:"split-event_title d-flex align-items-center text-truncate",css:t.css`font-weight: 500; font-size: 14px;`,children:(0,e.jsx)("div",{className:"text-truncate",children:n("_widgetLabel")})})})})}const c=function(){this.__data__=[],this.size=0};const u=function(e,t){return e===t||e!=e&&t!=t};const d=function(e,t){for(var n=e.length;n--;)if(u(e[n][0],t))return n;return-1};var f=Array.prototype.splice;const h=function(e){var t=this.__data__,n=d(t,e);return!(n<0)&&(n==t.length-1?t.pop():f.call(t,n,1),--this.size,!0)};const m=function(e){var t=this.__data__,n=d(t,e);return n<0?void 0:t[n][1]};const b=function(e){return d(this.__data__,e)>-1};const y=function(e,t){var n=this.__data__,a=d(n,e);return a<0?(++this.size,n.push([e,t])):n[a][1]=t,this};function g(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}g.prototype.clear=c,g.prototype.delete=h,g.prototype.get=m,g.prototype.has=b,g.prototype.set=y;const D=g;const I=function(){this.__data__=new D,this.size=0};const S=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const R=function(e){return this.__data__.get(e)};const w=function(e){return this.__data__.has(e)};const j="object"==typeof global&&global&&global.Object===Object&&global;var E="object"==typeof self&&self&&self.Object===Object&&self;const L=j||E||Function("return this")();const T=L.Symbol;var N=Object.prototype,O=N.hasOwnProperty,k=N.toString,x=T?T.toStringTag:void 0;const M=function(e){var t=O.call(e,x),n=e[x];try{e[x]=void 0;var a=!0}catch(e){}var i=k.call(e);return a&&(t?e[x]=n:delete e[x]),i};var A=Object.prototype.toString;const F=function(e){return A.call(e)};var C=T?T.toStringTag:void 0;const _=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":C&&C in Object(e)?M(e):F(e)};const P=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const V=function(e){if(!P(e))return!1;var t=_(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const G=L["__core-js_shared__"];var U,W=(U=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+U:"";const z=function(e){return!!W&&W in e};var B=Function.prototype.toString;const q=function(e){if(null!=e){try{return B.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var J=/^\[object .+?Constructor\]$/,Q=Function.prototype,H=Object.prototype,Z=Q.toString,$=H.hasOwnProperty,K=RegExp("^"+Z.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const X=function(e){return!(!P(e)||z(e))&&(V(e)?K:J).test(q(e))};const Y=function(e,t){return null==e?void 0:e[t]};const ee=function(e,t){var n=Y(e,t);return X(n)?n:void 0};const te=ee(L,"Map");const ne=ee(Object,"create");const ae=function(){this.__data__=ne?ne(null):{},this.size=0};const ie=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var oe=Object.prototype.hasOwnProperty;const re=function(e){var t=this.__data__;if(ne){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return oe.call(t,e)?t[e]:void 0};var se=Object.prototype.hasOwnProperty;const le=function(e){var t=this.__data__;return ne?void 0!==t[e]:se.call(t,e)};const ce=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ne&&void 0===t?"__lodash_hash_undefined__":t,this};function ue(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}ue.prototype.clear=ae,ue.prototype.delete=ie,ue.prototype.get=re,ue.prototype.has=le,ue.prototype.set=ce;const de=ue;const fe=function(){this.size=0,this.__data__={hash:new de,map:new(te||D),string:new de}};const ve=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const pe=function(e,t){var n=e.__data__;return ve(t)?n["string"==typeof t?"string":"hash"]:n.map};const he=function(e){var t=pe(this,e).delete(e);return this.size-=t?1:0,t};const me=function(e){return pe(this,e).get(e)};const be=function(e){return pe(this,e).has(e)};const ye=function(e,t){var n=pe(this,e),a=n.size;return n.set(e,t),this.size+=n.size==a?0:1,this};function ge(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}ge.prototype.clear=fe,ge.prototype.delete=he,ge.prototype.get=me,ge.prototype.has=be,ge.prototype.set=ye;const De=ge;const Ie=function(e,t){var n=this.__data__;if(n instanceof D){var a=n.__data__;if(!te||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new De(a)}return n.set(e,t),this.size=n.size,this};function Se(e){var t=this.__data__=new D(e);this.size=t.size}Se.prototype.clear=I,Se.prototype.delete=S,Se.prototype.get=R,Se.prototype.has=w,Se.prototype.set=Ie;const Re=Se;const we=function(e,t){for(var n=-1,a=null==e?0:e.length;++n<a&&!1!==t(e[n],n,e););return e};const je=function(){try{var e=ee(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const Ee=function(e,t,n){"__proto__"==t&&je?je(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var Le=Object.prototype.hasOwnProperty;const Te=function(e,t,n){var a=e[t];Le.call(e,t)&&u(a,n)&&(void 0!==n||t in e)||Ee(e,t,n)};const Ne=function(e,t,n,a){var i=!n;n||(n={});for(var o=-1,r=t.length;++o<r;){var s=t[o],l=a?a(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),i?Ee(n,s,l):Te(n,s,l)}return n};const Oe=function(e,t){for(var n=-1,a=Array(e);++n<e;)a[n]=t(n);return a};const ke=function(e){return null!=e&&"object"==typeof e};const xe=function(e){return ke(e)&&"[object Arguments]"==_(e)};var Me=Object.prototype,Ae=Me.hasOwnProperty,Fe=Me.propertyIsEnumerable,Ce=xe(function(){return arguments}())?xe:function(e){return ke(e)&&Ae.call(e,"callee")&&!Fe.call(e,"callee")};const _e=Ce;const Pe=Array.isArray;const Ve=function(){return!1};var Ge="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ue=Ge&&"object"==typeof module&&module&&!module.nodeType&&module,We=Ue&&Ue.exports===Ge?L.Buffer:void 0;const ze=(We?We.isBuffer:void 0)||Ve;var Be=/^(?:0|[1-9]\d*)$/;const qe=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Be.test(e))&&e>-1&&e%1==0&&e<t};const Je=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Qe={};Qe["[object Float32Array]"]=Qe["[object Float64Array]"]=Qe["[object Int8Array]"]=Qe["[object Int16Array]"]=Qe["[object Int32Array]"]=Qe["[object Uint8Array]"]=Qe["[object Uint8ClampedArray]"]=Qe["[object Uint16Array]"]=Qe["[object Uint32Array]"]=!0,Qe["[object Arguments]"]=Qe["[object Array]"]=Qe["[object ArrayBuffer]"]=Qe["[object Boolean]"]=Qe["[object DataView]"]=Qe["[object Date]"]=Qe["[object Error]"]=Qe["[object Function]"]=Qe["[object Map]"]=Qe["[object Number]"]=Qe["[object Object]"]=Qe["[object RegExp]"]=Qe["[object Set]"]=Qe["[object String]"]=Qe["[object WeakMap]"]=!1;const He=function(e){return ke(e)&&Je(e.length)&&!!Qe[_(e)]};const Ze=function(e){return function(t){return e(t)}};var $e="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ke=$e&&"object"==typeof module&&module&&!module.nodeType&&module,Xe=Ke&&Ke.exports===$e&&j.process;const Ye=function(){try{var e=Ke&&Ke.require&&Ke.require("util").types;return e||Xe&&Xe.binding&&Xe.binding("util")}catch(e){}}();var et=Ye&&Ye.isTypedArray;const tt=et?Ze(et):He;var nt=Object.prototype.hasOwnProperty;const at=function(e,t){var n=Pe(e),a=!n&&_e(e),i=!n&&!a&&ze(e),o=!n&&!a&&!i&&tt(e),r=n||a||i||o,s=r?Oe(e.length,String):[],l=s.length;for(var c in e)!t&&!nt.call(e,c)||r&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||qe(c,l))||s.push(c);return s};var it=Object.prototype;const ot=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||it)};const rt=function(e,t){return function(n){return e(t(n))}};const st=rt(Object.keys,Object);var lt=Object.prototype.hasOwnProperty;const ct=function(e){if(!ot(e))return st(e);var t=[];for(var n in Object(e))lt.call(e,n)&&"constructor"!=n&&t.push(n);return t};const ut=function(e){return null!=e&&Je(e.length)&&!V(e)};const dt=function(e){return ut(e)?at(e):ct(e)};const ft=function(e,t){return e&&Ne(t,dt(t),e)};const vt=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var pt=Object.prototype.hasOwnProperty;const ht=function(e){if(!P(e))return vt(e);var t=ot(e),n=[];for(var a in e)("constructor"!=a||!t&&pt.call(e,a))&&n.push(a);return n};const mt=function(e){return ut(e)?at(e,!0):ht(e)};const bt=function(e,t){return e&&Ne(t,mt(t),e)};var yt="object"==typeof exports&&exports&&!exports.nodeType&&exports,gt=yt&&"object"==typeof module&&module&&!module.nodeType&&module,Dt=gt&&gt.exports===yt?L.Buffer:void 0,It=Dt?Dt.allocUnsafe:void 0;const St=function(e,t){if(t)return e.slice();var n=e.length,a=It?It(n):new e.constructor(n);return e.copy(a),a};const Rt=function(e,t){var n=-1,a=e.length;for(t||(t=Array(a));++n<a;)t[n]=e[n];return t};const wt=function(e,t){for(var n=-1,a=null==e?0:e.length,i=0,o=[];++n<a;){var r=e[n];t(r,n,e)&&(o[i++]=r)}return o};const jt=function(){return[]};var Et=Object.prototype.propertyIsEnumerable,Lt=Object.getOwnPropertySymbols;const Tt=Lt?function(e){return null==e?[]:(e=Object(e),wt(Lt(e),function(t){return Et.call(e,t)}))}:jt;const Nt=function(e,t){return Ne(e,Tt(e),t)};const Ot=function(e,t){for(var n=-1,a=t.length,i=e.length;++n<a;)e[i+n]=t[n];return e};const kt=rt(Object.getPrototypeOf,Object);const xt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ot(t,Tt(e)),e=kt(e);return t}:jt;const Mt=function(e,t){return Ne(e,xt(e),t)};const At=function(e,t,n){var a=t(e);return Pe(e)?a:Ot(a,n(e))};const Ft=function(e){return At(e,dt,Tt)};const Ct=function(e){return At(e,mt,xt)};const _t=ee(L,"DataView");const Pt=ee(L,"Promise");const Vt=ee(L,"Set");const Gt=ee(L,"WeakMap");var Ut="[object Map]",Wt="[object Promise]",zt="[object Set]",Bt="[object WeakMap]",qt="[object DataView]",Jt=q(_t),Qt=q(te),Ht=q(Pt),Zt=q(Vt),$t=q(Gt),Kt=_;(_t&&Kt(new _t(new ArrayBuffer(1)))!=qt||te&&Kt(new te)!=Ut||Pt&&Kt(Pt.resolve())!=Wt||Vt&&Kt(new Vt)!=zt||Gt&&Kt(new Gt)!=Bt)&&(Kt=function(e){var t=_(e),n="[object Object]"==t?e.constructor:void 0,a=n?q(n):"";if(a)switch(a){case Jt:return qt;case Qt:return Ut;case Ht:return Wt;case Zt:return zt;case $t:return Bt}return t});const Xt=Kt;var Yt=Object.prototype.hasOwnProperty;const en=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Yt.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const tn=L.Uint8Array;const nn=function(e){var t=new e.constructor(e.byteLength);return new tn(t).set(new tn(e)),t};const an=function(e,t){var n=t?nn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var on=/\w*$/;const rn=function(e){var t=new e.constructor(e.source,on.exec(e));return t.lastIndex=e.lastIndex,t};var sn=T?T.prototype:void 0,ln=sn?sn.valueOf:void 0;const cn=function(e){return ln?Object(ln.call(e)):{}};const un=function(e,t){var n=t?nn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const dn=function(e,t,n){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return nn(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return an(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return un(e,n);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return rn(e);case"[object Symbol]":return cn(e)}};var fn=Object.create;const vn=function(){function e(){}return function(t){if(!P(t))return{};if(fn)return fn(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const pn=function(e){return"function"!=typeof e.constructor||ot(e)?{}:vn(kt(e))};const hn=function(e){return ke(e)&&"[object Map]"==Xt(e)};var mn=Ye&&Ye.isMap;const bn=mn?Ze(mn):hn;const yn=function(e){return ke(e)&&"[object Set]"==Xt(e)};var gn=Ye&&Ye.isSet;const Dn=gn?Ze(gn):yn;var In="[object Arguments]",Sn="[object Function]",Rn="[object Object]",wn={};wn[In]=wn["[object Array]"]=wn["[object ArrayBuffer]"]=wn["[object DataView]"]=wn["[object Boolean]"]=wn["[object Date]"]=wn["[object Float32Array]"]=wn["[object Float64Array]"]=wn["[object Int8Array]"]=wn["[object Int16Array]"]=wn["[object Int32Array]"]=wn["[object Map]"]=wn["[object Number]"]=wn[Rn]=wn["[object RegExp]"]=wn["[object Set]"]=wn["[object String]"]=wn["[object Symbol]"]=wn["[object Uint8Array]"]=wn["[object Uint8ClampedArray]"]=wn["[object Uint16Array]"]=wn["[object Uint32Array]"]=!0,wn["[object Error]"]=wn[Sn]=wn["[object WeakMap]"]=!1;const jn=function e(t,n,a,i,o,r){var s,l=1&n,c=2&n,u=4&n;if(a&&(s=o?a(t,i,o,r):a(t)),void 0!==s)return s;if(!P(t))return t;var d=Pe(t);if(d){if(s=en(t),!l)return Rt(t,s)}else{var f=Xt(t),v=f==Sn||"[object GeneratorFunction]"==f;if(ze(t))return St(t,l);if(f==Rn||f==In||v&&!o){if(s=c||v?{}:pn(t),!l)return c?Mt(t,bt(s,t)):Nt(t,ft(s,t))}else{if(!wn[f])return o?t:{};s=dn(t,f,l)}}r||(r=new Re);var p=r.get(t);if(p)return p;r.set(t,s),Dn(t)?t.forEach(function(i){s.add(e(i,n,a,i,t,r))}):bn(t)&&t.forEach(function(i,o){s.set(o,e(i,n,a,o,t,r))});var h=d?void 0:(u?c?Ct:Ft:c?mt:dt)(t);return we(h||t,function(i,o){h&&(i=t[o=i]),Te(s,o,e(i,n,a,o,t,r))}),s};const En=function(e){return jn(e,5)},Ln="#00FFFF";var Tn=v(68972);var Nn;!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(Nn||(Nn={}));var On,kn,xn,Mn,An,Fn,Cn,_n;!function(e){e.Layer="Layer",e.Map="MAP"}(On||(On={})),function(e){e.Network="NETWORK",e.Event="EVENT",e.LineEvent="LINEEVENT",e.PointEvent="POINTEVENT",e.Intersection="INTERSECTION",e.Centerline="CENTERLINE",e.CalibrationPoint="CALIBRATIONPOINT",e.UtilityNetwork="UTILITYNETWORK",e.Addressing="ADDRESSING",e.NonLrs="NONLRS",e.NonLrsPoint="NONLRSPOINTS",e.NonLrsLine="NONLRSLINES"}(kn||(kn={})),function(e){e.Measure="ROUTEANDMEASURE",e.Coordinate="COORDINATE",e.LocationOffset="LOCATIONOFFSET",e.Referent="REFERENT",e.LineAndMeasure="LINEANDMEASURE"}(xn||(xn={})),function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(Mn||(Mn={})),function(e){e.LineId="LINEID",e.LineName="LINENAME"}(An||(An={})),function(e){e.Map="MAP",e.Lrs="LRS"}(Fn||(Fn={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(Cn||(Cn={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(_n||(_n={}));v(36614);function Pn(e,t=!0){return null!=e&&("string"==typeof e?""!==e.trim()||!t:"number"==typeof e?!isNaN(e):Array.isArray(e)?!t||0!==e.length:Boolean(e))}t.JSAPILayerTypes.FeatureLayer,t.JSAPILayerTypes.SceneLayer,t.JSAPILayerTypes.BuildingComponentSublayer,t.JSAPILayerTypes.OrientedImageryLayer,t.JSAPILayerTypes.ImageryLayer,t.JSAPILayerTypes.SubtypeSublayer;var Vn=function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,s)}l((a=a.apply(e,t||[])).next())})};let Gn=[],Un=[];const Wn=t.React.forwardRef((o,r)=>{const s=t.hooks.useTranslation(a),{widgetId:l,resetClick:c,networkDS:u,network:d,eventDS:f,eventLayer:v,routeInfo:p,table1Label:h,table2Label:m,onUpdateEventOid:b,networkLayer:y,onSubmit:g,flashGraphic:D,onUpdateToastMsgType:I,onUpdateToastMsg:S,onUpdateToastOpen:R,intl:w,selectedEventObjectId:j,lockAquired:E,conflictPreventionEnabled:L,onValidationChanged:T,revalidateRouteFromDataAction:N,routeInfoFromDataAction:O,resetEventOid:k,currentEventOid:x}=o,[M,A]=t.React.useState(),[F,C]=t.React.useState(),[_,P]=t.React.useState(!1),[V,G]=t.React.useState(""),[U,W]=t.React.useState(!0),[z,B]=t.React.useState(!1),[q,J]=t.React.useState(!1),[Q,H]=t.React.useState(null),[Z,$]=t.React.useState(null),[K,X]=t.React.useState(),[Y,ee]=t.React.useState(!1),[te,ne]=t.React.useState(!1),[ae,ie]=t.React.useState(null),{sessionId:oe,startEditSession:re,addEdit:se}=(0,n.useVmsManager)(),{supportsEditSession:le}=(0,n.useEditSession)();(0,Tn.useImperativeHandle)(r,()=>({onSubmitClicked:ge})),t.React.useEffect(()=>{N&&de()},[N]),t.React.useEffect(()=>{T(!_&&!Y&&!te&&E)},[_,E,Y,te,T]),t.React.useEffect(()=>{(0,n.isDefined)(p)&&((0,n.isDefined)(p.selectedPoint)||j)&&de()},[p]),t.React.useEffect(()=>{ce(),ee(!1),ne(!1)},[f,v]),t.React.useEffect(()=>{c&&ce()},[c]),t.React.useEffect(()=>{if(L){const e=Object.assign({},K);(0,n.isDefined)(d)&&(e.networkId=[d.networkInfo.lrsNetworkId]),(0,n.isDefined)(v)&&(e.eventServiceLayerIds=[v.serviceId]),(0,n.isDefined)(p)&&(e.routeInfo=p,e.routeOrLineId=[]),X(e)}},[u,d,v,p]);const ce=()=>{const e=fe();ue(e,!0),ue(e,!1)},ue=(e,t)=>{t?A(e):C(e)},de=()=>Vn(void 0,void 0,void 0,function*(){let e=[];if((0,n.isDefined)(v)&&(0,n.isDefined)(f)&&(0,n.isDefined)(v.eventInfo)&&(0,n.isDefined)(v.eventInfo.attributeFields)&&((0,n.isDefined)(p)||(0,n.isDefined)(O))){const t=f,a=N?O:p,i=u,o=[];v.eventInfo.canSpanRoutes&&(yield(0,n.queryLineId)(i,y.networkInfo,a.lineId).then(e=>{e.forEach(e=>{const t=e.getFieldValue(y.networkInfo.routeIdFieldSchema.name);o.push(t)})})),(0,n.queryEventsByRouteIdOrEventObjectId)(y.networkInfo.xyTolerance,t,v,a,o,j).then(t=>{const i=f,o=(null==i?void 0:i.getLayerDefinition()).fields.find(e=>"esriFieldTypeOID"===e.type).name;let r=!1,l=!1,c=!1;if(1===t.length){const r=t[0].attributes[o];G(r),b(r);const s=(null==i?void 0:i.layer).fields;v.eventInfo.attributeFields.forEach(i=>{if(i.enabled){const o=s.find(e=>e.name===i.field.name);if(o&&o.editable){let r,s=t[0].attributes[o.name];(0,n.isDate)(o.type)&&(0,n.isDefined)(s)?s=(0,n.getDateWithTZOffset)(s,f):r=(0,n.isDate)(o.type)?(0,n.isDefined)(o.defaultValue)?new Date(o.defaultValue):null:o.defaultValue;const l={index:e.length,name:o.name,alias:o.alias,type:o.type,hasDomain:(0,n.isDefined)(o.domain),value:s,error:"",nullable:o.nullable,default:"number"==typeof r?Number(r).toString():r,length:o.length,editable:i.editable};e.push(l);const u=t[0].attributes[v.eventInfo.fromMeasureFieldName],d=t[0].attributes[v.eventInfo.toMeasureFieldName];if(v.eventInfo.canSpanRoutes){const e=t[0].attributes[v.eventInfo.routeIdFieldName],i=t[0].attributes[v.eventInfo.toRouteIdFieldName];a.routeId===e&&(0,n.isWithinTolerance)(a.selectedMeasure,u,y.networkInfo.mTolerance)||a.routeId===i&&(0,n.isWithinTolerance)(a.selectedMeasure,d,y.networkInfo.mTolerance)?(c=!0,J(!0)):(c=!1,J(!1))}else(0,n.isWithinTolerance)(a.selectedMeasure,u,y.networkInfo.mTolerance)||(0,n.isWithinTolerance)(a.selectedMeasure,d,y.networkInfo.mTolerance)?(c=!0,J(!0)):(c=!1,J(!1));H(t[0].attributes[v.eventInfo.fromDateFieldName]),$(t[0].attributes[v.eventInfo.toDateFieldName])}}}),W(!1),l=!1,B(!1)}else if(t.length>1){for(let e=0;e<t.length;e++){const n=t[e].attributes[o];if(x===n){r=!0;break}}r||(e=fe(),W(!1),l=!0,B(!0),G(null),k())}else a.isNearestCoordinate||(e=fe(),W(!0),l=!1,B(!1),r=!1,G(null),k());if(r||a.isNearestCoordinate||(setTimeout(()=>{ue(e,!0)},500),setTimeout(()=>{ue(e,!1)},500)),l||c){const e=s(l?"multipleEventsFound":"unableToSplitAtStartOrEnd");I("error"),S(e),R(!0),setTimeout(()=>{R(!1)},5e3)}})}}),fe=()=>{const e=[];if((0,n.isDefined)(v)&&(0,n.isDefined)(f)&&(0,n.isDefined)(v.eventInfo)&&(0,n.isDefined)(v.eventInfo.attributeFields)){const t=f,a=(null==t?void 0:t.layer).fields;v.eventInfo.attributeFields.forEach(t=>{if(t.enabled){const i=a.find(e=>e.name===t.field.name);if(i){let a;a=(0,n.isDate)(i.type)?(0,n.isDefined)(i.defaultValue)?new Date(i.defaultValue):null:i.defaultValue;const o={index:e.length,name:i.name,alias:i.alias,type:i.type,hasDomain:(0,n.isDefined)(i.domain),value:a,error:"",nullable:i.nullable,default:"number"==typeof a?Number(a).toString():a,length:i.length,editable:t.editable};e.push(o)}}})}return e},ve=(e,t)=>e.findIndex(e=>e.error.length>0)>-1||t.findIndex(e=>e.error.length>0)>-1,pe=e=>{const t=En(e);ue(t,!0),P(ve(t,F))},he=e=>{const t=En(e);ue(t,!1),P(ve(t,M))},me=(e,t,a,i)=>{const o=En(e);let r=!1;return o.forEach((e,t)=>{let l;if(l=e.hasDomain?(0,n.validateRangeDomain)(e.value,e.name,f):((0,n.isDate)(e.type),(0,n.validateField)(e.value,e.name,f)),(0,n.isDefined)(i)){let n=[];const r=function(e,t,n,a,i,o,r){const s={};if(Pn(a))if(-1===e&&-1===n)a.forEach(e=>{s[e.name]=e.value});else{const t=a[n];a.forEach(n=>{s[n.name]=n.value,n.name===t.name&&(s[n.name]=e)})}else r.forEach(e=>{const t=o.attributes[e.name],n=e.alias.split(".")[1];s[n]=t});const l=[];for(const e of i){const t=e.isEditingRestrictive?"error":"warning";let n=!1;const a=e.contingencies.filter(e=>!e.isRetired);if(!a||0===a.length)return[];for(const e of a){let t=!0;for(const n in e.values){const a=e.values[n];if("any"!==a.objectType)if("null"===a.objectType){if(null!=s[n]){t=!1;break}}else if("code"===a.objectType){if(null!=a.codedValue&&s[n]!==a.codedValue.code){t=!1;break}}else if("range"===a.objectType){const e=s[n];if(null!=a.minValue&&null!=a.maxValue&&(e<a.minValue||e>a.maxValue)){t=!1;break}}}if(t){n=!0;break}}n||l.push({fieldGroup:e,type:t})}return l}(e.value,0,t,o,i);(null==r?void 0:r.length)>0&&(r.forEach(e=>{var t;const a=null===(t=null==e?void 0:e.fieldGroup)||void 0===t?void 0:t.fields;n.push(a)}),n=n.flat(),n.includes(e.name)&&(a?ee(!0):ne(!0),l={hasError:!0,message:"contingentValueError"}))}if(l.hasError){let t;if("contingentValueError"===l.message){const n=[];i.forEach(e=>{(null==e?void 0:e.name)&&n.push(e.name)});let a=s("invalidContingentValues");a=a.replace("{groupNames}",n.join(",")),t=a,e.error=s(l.message),ie(t)}else{const i=v.useFieldAlias?e.alias:e.name;t=(0,n.formatMessage)(w,"attributeError",{fieldValue:i,message:(0,n.formatMessage)(w,l.message),event1or2:s(a?"event1Label":"event2Label")}),e.error=(0,n.formatMessage)(w,l.message)}I("error"),S(t),R(!0),setTimeout(()=>{R(!1)},5e3),r=!0}}),r&&(a?pe(o):he(o)),r},be=()=>Vn(void 0,void 0,void 0,function*(){var e;const n=f,a=n.getPopupInfo(),i=n.getLayerDefinition(),o=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==i?void 0:i.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==a?void 0:a.fieldInfos)||[]).filter(e=>e.visible)),r=n.mergeQueryParams(null!==(e=n.getCurrentQueryParams())&&void 0!==e?e:{},{where:"1=1",sqlExpression:null}),s=Object.assign({returnGeometry:!0},r);yield n.load(s,{widgetId:l});const c=new t.DataRecordSetChangeMessage(l,t.RecordSetChangeType.CreateUpdate,[{records:n.getRecords(),fields:o.map(e=>e.fieldName),dataSource:n,name:n.id}]);t.MessageManager.getInstance().publishMessage(c)}),ye=e=>Vn(void 0,void 0,void 0,function*(){const t={},a=me(M,0,!0,Gn),i=me(F,0,!1,Un);if(a||i)return;if(!(()=>{let e="";return(0,n.isDefined)(Z)?e="Event must have null To Date.":(0,n.isDefined)(Q)&&Q>(0,n.getDateToUTC)(new Date(Date.now()))&&(e="Event must be active today."),!(e.length>0&&(I("error"),S(e),R(!0),setTimeout(()=>{R(!1)},5e3),1))})())return;let o=!1;const r=(0,n.getDateWithRouteTime)(p.selectedFromDate,p.fromDate).getTime();if(o=!!((0,n.isDefined)(Q)&&r<Q||(0,n.isDefined)(Z)&&r>Z),U||z||q||o){const e=s(U||o?"noEventFound":z?"multipleEventsFound":"unableToSplitAtStartOrEnd");return I("error"),S(e),R(!0),void setTimeout(()=>{R(!1)},5e3)}if((0,n.isDefined)(v)){const e={};M.forEach(t=>{const a=t.name;if((0,n.isDefined)(t.value)&&(0,n.isDate)(t.type)){const i=(0,n.getDateWithoutTZOffset)(t.value.valueOf(),f);e[a]=(0,n.getDateToUTC)(i)}else(0,n.isNumber)(t.type)?!(0,n.isDefined)(t.value)||isNaN(Number(t.value))?e[a]=null:e[a]=Number(t.value):e[a]=t.value});const a={};if(F.forEach(e=>{const t=e.name;if((0,n.isDefined)(e.value)&&(0,n.isDate)(e.type)){const i=(0,n.getDateWithoutTZOffset)(e.value.valueOf(),f);a[t]=(0,n.getDateToUTC)(i)}else(0,n.isNumber)(e.type)?!(0,n.isDefined)(e.value)||isNaN(Number(e.value))?a[t]=null:a[t]=Number(e.value):a[t]=e.value}),t.attributes=e,t.attributes2=a,t.eventOid=V,t.routeId=p.routeId,t.measure=p.selectedMeasure,(0,n.isDefined)(p.selectedFromDate)){const e=(0,n.getDateWithRouteTime)(p.selectedFromDate,p.fromDate),a=(0,n.getDateWithoutTZOffset)(e.valueOf(),f);t.fromDate=a}else t.fromDate=p.selectedFromDate;t.measure=p.selectedMeasure}const l=f;if(le){const e=yield re();if(!e.success)return I("error"),S(e.error),R(!0),void setTimeout(()=>{R(!1)},5e3)}yield(0,n.LrsApplyEdits)(l,v,oe,null,t,null).then(t=>{if(t.success){if(le&&se(t,s("_widgetLabel")),(0,n.isDefined)(v)&&(0,n.isDefined)(f)){const e=f;(0,n.queryEventsByEventObjectIds)(e,t.editResults[0].splitEventResult.objectIds).then(e=>{e.forEach((e,t)=>Vn(void 0,void 0,void 0,function*(){const a=e.geometry;(0,n.isDefined)(a)&&(0===t?(0,n.flash)(D,yield(0,n.getGeometryGraphic)(yield(0,n.getSimpleLineGraphic)(a),Ln)):setTimeout(()=>Vn(void 0,void 0,void 0,function*(){(0,n.flash)(D,yield(0,n.getGeometryGraphic)(yield(0,n.getSimpleLineGraphic)(a),Ln))}),5e3))}))})}I("success"),S(s("eventSplit")),R(!0),be(),setTimeout(()=>Vn(void 0,void 0,void 0,function*(){if(R(!1),L&&(0,n.isDefined)(e)){yield(0,n.tryReleaseLockOnDefault)(u,e);const t=Object.assign(Object.assign({},K),{lockAction:n.LockAction.Clear});X(t)}else ce(),g()}),5e3)}else I("error"),S(t.message),R(!0),setTimeout(()=>{R(!1)},5e3)})}),ge=()=>{if(L){const e=Object.assign(Object.assign({},K),{lockAction:n.LockAction.QueryAndAcquire});X(e)}else ye()};return(0,e.jsx)("div",{className:"split-event-edit-attributes__content",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .split-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event-edit-attributes__action {
      height: 100%;
    }
  `,children:(0,e.jsxs)("div",{className:"h-100",children:[L&&(0,e.jsx)(n.LockManagerComponent,{intl:w,featureDS:u,lockInfo:K,showAlert:!1,conflictPreventionEnabled:L,onQueryAndAcquireComplete:(e,t,a)=>{const i=Object.assign(Object.assign({},e),{lockAction:n.LockAction.None});X(i),a&&ye(i)},onMessageClear:()=>{const e=Object.assign(Object.assign({},K),{lockAction:n.LockAction.None});X(e),g()}}),(Y||te)&&(0,e.jsx)("div",{style:{marginTop:"1.2rem"},children:(0,e.jsx)(i.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){Y&&ee(!1),te&&ne(!1)},open:Y||te,text:ae,type:"warning",closable:!0,withIcon:!0})}),(0,e.jsx)(n.AttributeTable,{tableIndex:0,collapable:!1,eventDS:f,eventLayer:v,fieldInfos:M,useAlias:!(0,n.isDefined)(v)||v.useFieldAlias,onUpdateItem:(e,t,n)=>{const a=En(M);a[n].value=e,a[n].error=t,ue(a,!0),P(ve(a,M))},onUpdateAll:pe,tableLabel:h,onFieldGrpUpdated:(e,t)=>{Gn=e,Gn&&0!==(null==Gn?void 0:Gn.length)||ee(!1)}}),(0,e.jsx)(n.AttributeTable,{tableIndex:1,collapable:!1,eventDS:f,eventLayer:v,fieldInfos:F,useAlias:!(0,n.isDefined)(v)||v.useFieldAlias,onUpdateItem:(e,t,n)=>{const a=En(F);a[n].value=e,a[n].error=t,ue(a,!1),P(ve(a,M))},onUpdateAll:he,tableLabel:m,onFieldGrpUpdated:(e,t)=>{Un=e,Un&&0!==(null==Un?void 0:Un.length)||ne(!1)}})]})})});function zn(n){const{network:a,event:i,dataSourcesReady:o,onCreateNetworkDs:r,onCreateEventDs:s}=n,[l,c]=t.React.useState(null!=a?a:null),[u,d]=t.React.useState(null!=i?i:null),[f,v]=t.React.useState(!1),[p,h]=t.React.useState(!1);t.React.useEffect(()=>{a&&c(a)},[a]),t.React.useEffect(()=>{i&&d(i)},[i]),t.React.useEffect(()=>{o(f&&p)},[o,p,f]);const m=t.React.useCallback(e=>{r(e)},[r]),b=t.React.useCallback(e=>{s(e)},[s]),y=t.React.useCallback(e=>{if(e){const{status:n,instanceStatus:a}=e;a===t.DataSourceStatus.NotCreated||a===t.DataSourceStatus.CreateError||n===t.DataSourceStatus.LoadError||n===t.DataSourceStatus.NotReady?v(!1):v(!0)}},[v]),g=t.React.useCallback(e=>{if(e){const{status:n,instanceStatus:a}=e;a===t.DataSourceStatus.NotCreated||a===t.DataSourceStatus.CreateError||n===t.DataSourceStatus.LoadError||n===t.DataSourceStatus.NotReady?h(!1):h(!0)}},[h]),D=t.React.useCallback(()=>{v(!1)},[v]),I=t.React.useCallback(()=>{h(!1)},[h]);return(0,e.jsxs)("div",{children:[l&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:l.useDataSource,onDataSourceInfoChange:y,onCreateDataSourceFailed:D,onDataSourceCreated:m}),u&&(0,e.jsx)(t.DataSourceComponent,{useDataSource:u.useDataSource,onDataSourceInfoChange:g,onCreateDataSourceFailed:I,onDataSourceCreated:b})]})}const Bn=function(){return L.Date.now()};var qn=/\s/;const Jn=function(e){for(var t=e.length;t--&&qn.test(e.charAt(t)););return t};var Qn=/^\s+/;const Hn=function(e){return e?e.slice(0,Jn(e)+1).replace(Qn,""):e};const Zn=function(e){return"symbol"==typeof e||ke(e)&&"[object Symbol]"==_(e)};var $n=/^[-+]0x[0-9a-f]+$/i,Kn=/^0b[01]+$/i,Xn=/^0o[0-7]+$/i,Yn=parseInt;const ea=function(e){if("number"==typeof e)return e;if(Zn(e))return NaN;if(P(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=P(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Hn(e);var n=Kn.test(e);return n||Xn.test(e)?Yn(e.slice(2),n?2:8):$n.test(e)?NaN:+e};var ta=Math.max,na=Math.min;const aa=function(e,t,n){var a,i,o,r,s,l,c=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var n=a,o=i;return a=i=void 0,c=t,r=e.apply(o,n)}function p(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=o}function h(){var e=Bn();if(p(e))return m(e);s=setTimeout(h,function(e){var n=t-(e-l);return d?na(n,o-(e-c)):n}(e))}function m(e){return s=void 0,f&&a?v(e):(a=i=void 0,r)}function b(){var e=Bn(),n=p(e);if(a=arguments,i=this,l=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(h,t),u?v(e):r}(l);if(d)return clearTimeout(s),s=setTimeout(h,t),v(l)}return void 0===s&&(s=setTimeout(h,t)),r}return t=ea(t)||0,P(n)&&(u=!!n.leading,o=(d="maxWait"in n)?ta(ea(n.maxWait)||0,t):o,f="trailing"in n?!!n.trailing:f),b.cancel=function(){void 0!==s&&clearTimeout(s),c=0,a=l=i=s=void 0},b.flush=function(){return void 0===s?r:m(Bn())},b};var ia=1/0;const oa=function(e){return e?(e=ea(e))===ia||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const ra=function(e){var t=oa(e),n=t%1;return t==t?n?t-n:t:0};const sa=function(e,t){for(var n=-1,a=null==e?0:e.length,i=Array(a);++n<a;)i[n]=t(e[n],n,e);return i};var la=T?T.prototype:void 0,ca=la?la.toString:void 0;const ua=function e(t){if("string"==typeof t)return t;if(Pe(t))return sa(t,e)+"";if(Zn(t))return ca?ca.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const da=function(e){return null==e?"":ua(e)};var fa=L.isFinite,va=Math.min;const pa=function(e){var t=Math[e];return function(e,n){if(e=ea(e),(n=null==n?0:va(ra(n),292))&&fa(e)){var a=(da(e)+"e").split("e"),i=t(a[0]+"e"+(+a[1]+n));return+((a=(da(i)+"e").split("e"))[0]+"e"+(+a[1]-n))}return t(e)}}("round");var ha=function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,s)}l((a=a.apply(e,t||[])).next())})};function ma(o){const r=t.hooks.useTranslation(a),{intl:s,widgetId:l,isReady:c,network:u,networkDS:d,routeInfo:f,jimuMapView:v,hoverGraphic:p,reset:h,routeInfoFromDataAction:m,revalidateRouteFromDataAction:b,onResetDataAction:y,clearPickedGraphic:g,onRouteInfoUpdated:D,measureLabelId:I}=o,[S,R]=t.React.useState(!1),[w,j]=t.React.useState(""),[E,L]=t.React.useState(!1),[T,N]=t.React.useState([]),[O,k]=t.React.useState(),x=t.React.useRef(null),M=t.React.useRef(e=>{}),A=t.React.useRef(null),F=t.React.useRef(null),C=t.React.useRef(null),_=t.React.useRef(null),P=t.React.useRef(null),V=t.React.useRef(!1),G=t.React.useRef(!1),[U,W]=t.React.useState(null),[z,B]=t.React.useState(!1),[q,J]=t.React.useState([]);t.React.useEffect(()=>{M.current=aa(Q,400)},[]),t.React.useEffect(()=>{h&&Y()},[h]);const Q=t.hooks.useEventCallback(e=>{const t=u.useRouteName?u.routeNameFieldSchema.jimuName:u.routeIdFieldSchema.jimuName,a=(0,n.getSuggestions)(t,e,d);Promise.all([a]).then(e=>{const t=null==e?void 0:e[0];t&&J(t),A.current&&B(!0)})}),H=e=>{W(e),A.current=e},Z=()=>{(0,t.focusElementInKeyboardMode)(F.current),$(!0,!1)},$=(e=!1,t=!0)=>{e||(G.current=!1)};t.React.useEffect(()=>{b&&setTimeout(()=>{H(u.useRouteName?m.routeName:m.routeId),j(""),D(m),Y(),y()},500)},[b]),t.React.useEffect(()=>{(0,n.isDefined)(u)&&(W(""),j(""),R(!1),g())},[u]),t.React.useEffect(()=>{(0,n.isDefined)(v)&&k(null==v?void 0:v.view.popupEnabled)},[v]),t.React.useEffect(()=>{(0,n.isDefined)(u)&&u.useRouteName?W(f.routeName):W(f.routeId),isNaN(f.selectedMeasure)?j(""):j(f.selectedMeasure.toString())},[u,f]),t.React.useEffect(()=>{isNaN(f.selectedMeasure)?j(""):j(f.selectedMeasure.toString())},[u,f.selectedMeasure]);const K=(e,t)=>ha(this,void 0,void 0,function*(){const t=(0,n.getNetworkOutFields)(u),a=u.useRouteName?e.attributes[t.routeNameFieldName]:"",i=e.attributes[t.routeIdFieldName],o=e.attributes[t.fromDateFieldName],r=e.attributes[t.toDateFieldName],s=e.geometry,l=(0,n.getRouteFromEndMeasures)(s),c=e.attributes[t.lineIdFieldName],v=e.attributes[t.lineNameFieldName];let p=new Date(Date.now());(0,n.isDefined)(r)&&p>r?p=(0,n.getDateWithTZOffset)(o,d):p.setHours(0,0,0,0);let h=new Date(Date.now());return(0,n.isDefined)(r)&&h>r?h=(0,n.getDateWithTZOffset)(r,d):h.setHours(0,0,0,0),(0,n.isDefined)(r)||(h=null),yield(0,n.QueryRouteMeasures)(d,u,l,o,i).then(e=>{const t=Math.min(...e),l=Math.max(...e);return Object.assign(Object.assign({},f),{routeName:a,routeId:i,fromDate:(0,n.isDefined)(o)?(0,n.getDateWithTZOffset)(o,d):null,toDate:(0,n.isDefined)(r)?(0,n.getDateWithTZOffset)(r,d):null,selectedPolyline:s,fromMeasure:pa(t,u.measurePrecision),toMeasure:pa(l,u.measurePrecision),validRoute:!0,selectedFromDate:p,selectedToDate:h,lineName:v,lineId:c})})}),X=(e,t)=>(0,n.QueryMeasureOnRoute)(d,u,e.routeId,e.fromDate,w).then(n=>{if(n){return Object.assign(Object.assign({},e),{selectedPoint:n,selectedMeasure:parseFloat(t?e.selectedMeasure.toString():w)})}return Object.assign(Object.assign({},e),{selectedPoint:null})}),Y=()=>{setTimeout(()=>{F.current&&(F.current.select(),(0,t.focusElementInKeyboardMode)(F.current,!0),F.current.blur()),_.current&&(C.current.select(),(0,t.focusElementInKeyboardMode)(C.current,!0),C.current.blur())},200)},ee=t.React.useCallback((e,t=!1)=>{D(e,t),P.current=null,Y()},[D]),te=e=>{j(e)},ne=t.React.useCallback(e=>{e.length&&(L(!0),N(e))},[]),ae=t.React.useCallback(e=>{(0,n.isDefined)(e)&&(D(e,!0),P.current=null,Y()),L(!1)},[D]),ie=t.React.useCallback(()=>{L(!1)},[]);return(0,e.jsx)("div",{className:"route-and-measure-form d-flex w-100 px-3",children:u&&(0,e.jsxs)("div",{className:"w-100",children:[(0,e.jsx)(i.Label,{size:"sm",className:"w-100 mb-0 pt-3 title3",centric:!0,style:{width:100},children:u.useRouteName?(0,n.formatMessage)(s,"routeNameRequiredLabel"):(0,n.formatMessage)(s,"routeIdRequiredLabel")}),(0,e.jsxs)("div",{ref:x,className:"d-flex w-100",children:[(0,e.jsx)(i.TextInput,{"aria-label":u.useRouteName?(0,n.formatMessage)(s,"routeNameRequiredLabel"):(0,n.formatMessage)(s,"routeIdRequiredLabel"),type:"text",className:"w-100",size:"sm",allowClear:!0,disabled:!c,onBlur:()=>{_.current=setTimeout(()=>{V.current||B(!1),G.current||$(!1)},200)},value:U||"",ref:F,onChange:e=>{var t;P.current=null;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=(null==n?void 0:n.length)>2;if(H(n),!a)return B(!1),!1;M.current(n)},checkValidityOnAccept:(e,t=!1)=>new Promise(a=>{setTimeout(()=>{P.current&&(e=P.current);const i=[],o=(0,n.queryRouteIdOrName)(e,u,d).then(a=>ha(this,void 0,void 0,function*(){if((0,n.isDefined)(a)){if(!t&&(h||e===f.routeId||e===f.routeName))return{valid:!0};if(yield Promise.all(a.features.map(t=>ha(this,void 0,void 0,function*(){const n=K(t,e);i.push(yield n)}))),i.length>1&&!t)ne(i);else{if(w.length>0||t&&!isNaN(f.selectedMeasure))return X(i[0],t).then(e=>(D(e,!0),{valid:!0}));D(i[0],!0)}return{valid:!0}}})).catch(t=>{if(u.useRouteName){const t=Object.assign(Object.assign({},f),{routeName:e,validRoute:!1});D(t)}else{const t=Object.assign(Object.assign({},f),{routeId:e,validRoute:!1});D(t)}if(e.length){return{valid:!1,msg:"Route '"+e.replace(/ /g,"\xa0")+"' not found"}}return{valid:!0}});a(o)},200)})}),U&&(0,e.jsx)(n.Intellisense,{isOpen:(z||(V.current=!1),z),reference:x,searchText:U,searchSuggestion:q,onRecordItemClick:(e,t)=>{if(t)return Z(),!1;P.current=e,H(e)},id:l,searchInputRef:F}),(0,e.jsx)(n.RoutePicker,{type:"route-measure",active:S,networkDs:d,network:u,routeInfo:f,disabled:!c,jimuMapView:v,symbolColor:null,hoverGraphic:p,isFrom:!0,onActiveChange:()=>{const e=!S;R(e),e?v.view.popupEnabled=!1:setTimeout(()=>{v.view.popupEnabled=O},800)},onRouteInfoUpdated:ee,onMultiRouteSelect:ne})]}),(0,e.jsx)(i.Label,{size:"sm",className:"w-100 mb-0 pt-3 title3",style:{width:100},children:r(I||"measureWithUnits",{units:(0,n.GetUnits)(u.unitsOfMeasure,s)})}),(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(i.TextInput,{ref:C,"aria-label":r("measureWithUnits",{units:(0,n.GetUnits)(u.unitsOfMeasure,s)}),className:"w-100",size:"sm",value:w,disabled:!c,onChange:e=>{te(e.target.value)},checkValidityOnAccept:e=>ha(this,void 0,void 0,function*(){let t=NaN;if(""===e){t=NaN;const e=Object.assign(Object.assign({},f),{selectedMeasure:NaN,selectedPoint:null});return D(e),te(""),{valid:!0}}if(t=isNaN(Number(e))?(0,n.convertStationToNumber)(e):Number(e),isNaN(t)){g();const e=Object.assign(Object.assign({},f),{selectedMeasure:NaN,selectedPoint:null});return D(e),te(""),{valid:!0}}if((0,n.isDefined)(f.selectedPolyline)){t=pa(t,u.measurePrecision);let e=Object.assign(Object.assign({},f),{selectedMeasure:t});if(t<f.fromMeasure)return D(e),{valid:!1,msg:r("measureLessError")};if(t>f.toMeasure)return D(e),{valid:!1,msg:r("measureGreaterError")};e.routeId.length?yield(0,n.QueryMapPointWithMeasureOnRoute)(d,u,e.routeId,e.fromDate,t.toString()).then(t=>{(0,n.isDefined)(t)&&(e=Object.assign(Object.assign({},e),{selectedPoint:t,isNearestCoordinate:!1}),D(e))}):D(e)}return{valid:!0}})})}),(0,e.jsx)(n.RoutePickerPopup,{isOpen:E,routeInfos:T,useRouteName:u.useRouteName,onRouteSelect:ae,onRouteSelectCancel:ie,measurePrecision:u.measurePrecision,isFrom:!0,jimuMapView:v,graphicLayer:p})]})})}var ba=v(99037);function ya(o){const r=t.hooks.useTranslation(a),{routeInfo:s,reset:l,onUpdateRouteInfo:c,hideDate:u,useRouteStartDate:d,revalidateRouteFromDataAction:f}=o,[v,p]=t.React.useState(!1),[h,m]=t.React.useState(!1),[b,y]=t.React.useState("idle"),[g,D]=t.React.useState("idle"),[I,S]=t.React.useState(""),[R,w]=t.React.useState("");t.React.useEffect(()=>{f&&(p(!1),m(!1),S(""),w(""))},[f]),t.React.useEffect(()=>{p(d),m(d)},[u]),t.React.useEffect(()=>{l&&(p(d),m(d),y("idle"),D("idle"),S(""),w(""))},[l]),t.React.useEffect(()=>{let e=!1;const t=Object.assign({},s);"idle"===b&&S(""),"idle"===g&&w(""),(0,n.isDefined)(s.selectedFromDate)&&v&&s.selectedFromDate!==s.fromDate&&(t.selectedFromDate=s.fromDate,e=!0),h&&s.selectedToDate!==s.toDate&&(t.selectedToDate=s.toDate,e=!0),e&&c(t)},[c,s,v,h]);const j=(e,t)=>{const a=e;if(!(0,n.isDefined)(a))return t?y("idle"):D("idle"),t?S(""):w(""),!0;let i=!0;const o=(0,n.getDateWithoutTime)(a),l=(0,n.getDateWithoutTime)(s.fromDate),c=(0,n.getDateWithoutTime)(s.toDate),u=(0,n.getDateWithoutTime)(s.selectedFromDate),d=(0,n.getDateWithoutTime)(s.selectedToDate);return(0,n.isDefined)(s.fromDate)&&o<l?(t?y("invalid"):D("invalid"),t?S(r("invalidFromDateBefore")):w(r("invalidToDateBefore")),i=!1,!1):(0,n.isDefined)(s.toDate)&&o>c?(t?y("invalid"):D("invalid"),t?S(r("invalidFromDateAfter")):w(r("invalidToDateAfter")),i=!1,!1):((0,n.isDefined)(s.selectedToDate)&&t&&(o>d&&(y("invalid"),t?S(r("invalidDatesOrder")):w(r("invalidDatesOrder")),i=!1),R===r("invalidDatesOrder")?o<d&&(D("idle"),w("")):R===r("invalidDatesSameDay")&&o!==u&&(D("idle"),w(""))),(0,n.isDefined)(s.selectedToDate)&&t&&o.getTime()===d.getTime()&&(y("invalid"),t?S(r("invalidDatesSameDay")):w(r("invalidDatesSameDay")),i=!1),(0,n.isDefined)(s.selectedFromDate)&&(t||(o<u&&(D("invalid"),t?S(r("invalidDatesOrder")):w(r("invalidDatesOrder")),i=!1),I===r("invalidDatesOrder")?o>u&&(y("idle"),S("")):I===r("invalidDatesSameDay")&&o!==u&&(y("idle"),S("")))),(0,n.isDefined)(s.selectedFromDate)&&(t||o.getTime()!==u.getTime()||(D("invalid"),t?S(r("invalidDatesSameDay")):w(r("invalidDatesSameDay")),i=!1)),i&&(t?y("idle"):D("idle"),t?S(""):w("")),!0)};return(0,e.jsx)("div",{className:"split-event-date-form px-3 w-100",css:(0,n.getCalciteBasicTheme)(),children:!u&&(0,e.jsxs)("div",{children:[(0,e.jsx)(i.Label,{size:"sm",className:"mb-0 pt-3 title3",centric:!0,style:{width:100},children:r("splitDateLabel")}),(0,e.jsx)(i.Tooltip,{title:I,children:(0,e.jsx)(ba.CalciteInputDatePicker,{scale:"s",disabled:!!v||void 0,valueAsDate:s.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const n=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;j(n,!0);const a=Object.assign(Object.assign({},s),{selectedFromDate:n});c(a)}},status:b,placement:"top",overlayPositioning:"fixed"})}),(0,e.jsxs)(i.Label,{size:"sm",className:"w-100 pt-2 label2",centric:!0,check:!0,children:[(0,e.jsx)(i.Checkbox,{checked:v,className:"mr-2",onChange:(e,t)=>{j(s.fromDate,!0),p(t)}}),r("useStartDateLabel")]})]})})}var ga=function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,s)}l((a=a.apply(e,t||[])).next())})};function Da(a){const{widgetId:i,network:o,networkDS:r,reset:s,jimuMapView:l,hoverGraphic:c,pickedGraphic:u,flashGraphic:d,onUpdateRouteInfo:f,intl:v,hideDate:p,useRouteStartDate:h,routeInfoFromDataAction:m,revalidateRouteFromDataAction:b,onResetDataAction:y,isReady:g,onValidationChanged:D}=a,[I,S]=t.React.useState((0,n.getInitialRouteInfoState)());t.React.useEffect(()=>{(0,n.isDefined)(o)&&!b&&(S((0,n.getInitialRouteInfoState)()),R())},[o]),t.React.useEffect(()=>{s&&(S((0,n.getInitialRouteInfoState)()),R())},[s]);const R=()=>{(0,n.isDefined)(u)&&u.removeAll()},w=(e,t)=>ga(this,void 0,void 0,function*(){var a;(0,n.isDefined)(e.selectedPolyline)&&t&&(0,n.flash)(d,yield(0,n.getGeometryGraphic)(yield(0,n.getSimpleLineGraphic)(e.selectedPolyline),Ln)),(0,n.isDefined)(e.selectedPoint)?(a=yield(0,n.getGeometryGraphic)(yield(0,n.getSimplePointGraphic)(e.selectedPoint),"#008000"),(0,n.isDefined)(a)?(u.removeAll(),u.add(a)):R()):R()}),j=(e,t=!1)=>{S(e),f(e),w(e,t)},E=t.React.useCallback(()=>{var e;if(!I.validRoute)return!1;if(0===(null===(e=I.routeId)||void 0===e?void 0:e.length))return!1;if(isNaN(I.selectedMeasure))return!1;if(isNaN(I.fromMeasure))return!1;if(I.selectedMeasure<I.fromMeasure)return!1;if(!(0,n.isDefined)(I.selectedFromDate)&&!(0,n.isDefined)(I.selectedToDate))return!1;if((0,n.isDefined)(I.selectedFromDate)&&!(0,n.isDefined)(I.selectedToDate)){const e=(0,n.getDateWithoutTime)(I.selectedFromDate),t=(0,n.getDateWithoutTime)(I.fromDate),a=(0,n.getDateWithoutTime)(I.toDate);if((0,n.isDefined)(I.fromDate)&&e<t)return!1;if((0,n.isDefined)(I.toDate)&&e>a)return!1}return!0},[I]);return t.React.useEffect(()=>{D(E()&&g)},[g,E,D]),(0,e.jsxs)("div",{className:"split-event-route-selection-form__content d-flex",css:t.css`
    display: flex;
    flex-direction: column;

    .split-event-route-selection-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event-route-selection-form__actions {
      height: 100%;
    }
  `,children:[(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(ma,{widgetId:i,isReady:g,network:o,networkDS:r,routeInfo:I,jimuMapView:l,hoverGraphic:c,reset:s,clearPickedGraphic:R,onRouteInfoUpdated:j,routeInfoFromDataAction:m,revalidateRouteFromDataAction:b,onResetDataAction:y,intl:v,measureLabelId:"splitMeasureWithUnits"})}),(0,e.jsx)("div",{className:"d-flex w-100",children:(0,e.jsx)(ya,{routeInfo:I,reset:s,onUpdateRouteInfo:j,hideDate:p,useRouteStartDate:h,revalidateRouteFromDataAction:b})})]})}var Ia=v(1888);function Sa(o){var r,s,c;const u=t.hooks.useTranslation(a),{widgetId:d,hideTitle:f,lrsLayers:v,eventLayers:p,networkLayers:h,defaultEvent:m,JimuMapView:b,hoverGraphic:y,pickedGraphic:g,flashGraphic:D,conflictPreventionEnabled:I,onClearGraphic:S,hideEvent:R,hideNetwork:w,hideDate:j,useRouteStartDate:E,intl:L,selectedEventLyr:T,selectedEventObjectId:N,routeInfoFromDataAction:O,onUpdateNetworkDS:k,onResetDataAction:x}=o,[M,A]=t.React.useState(null),[F,C]=t.React.useState(null),[_,P]=t.React.useState(null),[V,G]=t.React.useState(null),[U,W]=t.React.useState(!1),[z,B]=t.React.useState(!1),[q,J]=t.React.useState(null),[Q,H]=t.React.useState(u("chooseEventLocationFromMap")),[Z,$]=t.React.useState(!1),[K,X]=t.React.useState(),[Y,ee]=t.React.useState(""),[te,ne]=t.React.useState((0,n.getIntialLocksInfo)()),[ae,ie]=t.React.useState(!I),[oe,re]=t.React.useState(!0),[se,le]=t.React.useState(!1),ce=t.React.useRef(null);t.React.useEffect(()=>{B(!0),(0,n.waitTime)(800).then(()=>{B(!1)})},[v]),t.React.useEffect(()=>{(0,n.isDefined)(N)&&(G(T),H(null==N?void 0:N.toString())),le((0,n.isDefined)(O))},[O]),t.React.useEffect(()=>{(0,n.isDefined)(T)&&T.id!==(null==V?void 0:V.id)&&(0,n.isDefined)(T)&&be(T.name)},[T]);const ue=t.React.useCallback(e=>{A(e),k(e)},[A,k]),de=t.React.useCallback(e=>{C(e)},[C]),fe=t.React.useCallback(()=>{W(!0)},[W]),ve=t.React.useCallback(()=>{H(u("chooseEventLocationFromMap"))},[u]),pe=t.React.useCallback(()=>{S(),he()},[]),he=t.React.useCallback(()=>{J((0,n.getInitialRouteInfoState)()),me(n.LockAction.Clear,(0,n.getInitialRouteInfoState)()),ve(),B(!0),setTimeout(()=>{B(!1)},800)},[]);t.React.useEffect(()=>{if((0,n.isDefined)(V)&&v.some(e=>e.name===V.name)){const e=v.find(e=>(0,n.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===V.eventInfo.parentNetworkId);e&&e.layerType===n.LrsLayerType.Network?P((0,t.Immutable)(e)):P(null)}else{const e=v.find(e=>e.name===m.name);G((0,t.Immutable)(e))}he()},[m,v,V,he]),t.React.useEffect(()=>{me(n.LockAction.None)},[M,V,_]);const me=(e=n.LockAction.None,t)=>{if(I){const a=Object.assign({},te);(0,n.isDefined)(_)&&(a.networkId=[_.networkInfo.lrsNetworkId]),(0,n.isDefined)(V)&&(a.eventServiceLayerIds=[V.serviceId]),(0,n.isDefined)(t)&&(a.routeInfo=t,a.routeOrLineId=[]),a.lockAction=e,ne(a)}},be=t.React.useCallback(e=>{const a=v.find(t=>t.name===e);if(a){const e=v.find(e=>(0,n.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===a.eventInfo.parentNetworkId);e&&e.layerType===n.LrsLayerType.Network&&P((0,t.Immutable)(e)),G((0,t.Immutable)(a))}},[v]),ye=t.React.useCallback(e=>{const a=v.find(t=>t.name===e);(0,n.isDefined)(a)&&P((0,t.Immutable)(a))},[v]),ge=t.React.useMemo(()=>!!(U&&(0,n.isDefined)(b)&&(0,n.isDefined)(null==b?void 0:b.view)),[b,U]),De=t.React.useCallback((e,t,n)=>{ie(!!n),ne(e)},[]),Ie=t.React.useCallback(e=>{re(e)},[]);return(0,e.jsxs)("div",{className:"split-event h-100 d-flex",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .split-event-form {
      height: 100%;
    }

    .split-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .split-event__toast {
      position: relative;
      top: 4%;
    }
    .split-event-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[!f&&(0,e.jsx)(l,{}),(0,e.jsxs)("div",{className:"split-event__content",children:[(0,e.jsx)(zn,{network:_,event:V,dataSourcesReady:fe,onCreateNetworkDs:ue,onCreateEventDs:de}),I&&(0,e.jsx)(n.LockManagerComponent,{intl:L,showAlert:!0,featureDS:M,lockInfo:te,networkName:null===(r=null==_?void 0:_.networkInfo)||void 0===r?void 0:r.datasetName,conflictPreventionEnabled:I,onQueryAndAcquireComplete:De,onMessageClear:()=>{me(n.LockAction.None)}}),!R&&(0,e.jsxs)("div",{children:[(0,e.jsx)(i.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100 title3",children:(0,n.formatMessage)(L,"eventRequiredLabel")}),(0,e.jsx)(i.Select,{"aria-label":(0,n.formatMessage)(L,"eventRequiredLabel"),className:"w-100 px-3",size:"sm",value:V?V.name:"",disabled:1===p.length,onChange:e=>{be(e.target.value)},children:p.map((t,n)=>(0,e.jsx)(i.Option,{value:t,children:t},n))})]}),!w&&(0,e.jsx)("div",{children:(0,e.jsx)(n.InlineEditableDropdown,{label:(0,n.formatMessage)(L,"networkRequiredLabel"),isDisabled:!0,defaultItem:(0,n.isDefined)(_)?_.name:"",listItems:h,onSelectionChanged:ye})}),(0,e.jsx)(Da,{widgetId:d,network:_?_.networkInfo:null,isReady:ge&&(null===(s=null==b?void 0:b.view)||void 0===s?void 0:s.ready),reset:z,networkDS:M,jimuMapView:b,hoverGraphic:y,pickedGraphic:g,flashGraphic:D,onUpdateRouteInfo:e=>{J(e),me(n.LockAction.QueryAndAcquire,e)},hideDate:j,useRouteStartDate:E,intl:L,routeInfoFromDataAction:O,revalidateRouteFromDataAction:se,onResetDataAction:x,onValidationChanged:Ie}),(0,e.jsx)(i.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100 title3",children:u("eventOidLabel")+" *"}),(0,e.jsx)("div",{className:"d-flex w-100 px-3",children:(0,e.jsx)(i.Label,{size:"sm",className:"d-flex mb-0 w-100 label2",centric:!0,style:{width:100},children:Q})}),M&&F&&(0,e.jsx)(Wn,{resetClick:z,ref:ce,intl:L,table1Label:u("event1Label"),table2Label:u("event2Label"),widgetId:d,networkDS:M,network:_,eventDS:F,eventLayer:V,routeInfo:q,onUpdateEventOid:e=>{H(e)},networkLayer:_,flashGraphic:D,onSubmit:pe,onUpdateToastMsgType:X,onUpdateToastMsg:ee,onUpdateToastOpen:$,selectedEventObjectId:N,lockAquired:ae,conflictPreventionEnabled:I,onValidationChanged:Ie,revalidateRouteFromDataAction:se,routeInfoFromDataAction:O,resetEventOid:ve,currentEventOid:Q})]}),(0,e.jsx)("div",{className:"split-event-footer w-100",children:(0,e.jsxs)("div",{className:"split-event-footer__action w-100 d-flex",children:[(0,e.jsx)(i.Label,{size:"sm",className:" mt-auto mr-auto title3",centric:!0,style:{color:null===(c=(0,Ia.getTheme)())||void 0===c?void 0:c.sys.color.primary.main},onClick:he,children:"Reset"}),(0,e.jsx)(i.Tooltip,{title:u("splitLabel"),children:(0,e.jsx)("div",{className:"mt-auto ml-auto",children:(0,e.jsx)(i.Button,{type:"primary",className:"active","aria-label":u("splitLabel"),size:"sm",disabled:!oe||!(0,n.isDefined)(Q)||Q===u("chooseEventLocationFromMap"),onClick:()=>{var e;null===(e=ce.current)||void 0===e||e.onSubmitClicked()},children:u("splitLabel")})})})]})}),Z&&(0,e.jsx)("div",{className:"split-event__toast-container px-3 w-100",children:(0,e.jsx)(i.Alert,{className:"split-event__toast w-100",type:K,text:Y,closable:!0,withIcon:!0,open:Z,onClose:()=>{$(!1)}})})]})}var Ra=v(59620);function wa(){return(0,t.Immutable)({networkLayers:[],eventLayers:[],defaultEvent:{index:-1,name:""},hideEvent:!1,hideNetwork:!1,hideDate:!1,useRouteStartDate:!1})}var ja=v(4108),Ea=function(e,t,n,a){return new(n||(n=Promise))(function(i,o){function r(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,s)}l((a=a.apply(e,t||[])).next())})};class La extends t.React.PureComponent{constructor(e){super(e),this.supportedLrsLayerTypes=(0,t.Immutable)([n.LrsLayerType.Network,n.LrsLayerType.Event,n.LrsLayerType.LineEvent]),this.componentDidMount=()=>{var e,t,a,i;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedEventLyr)&&this.setState({selectedEventLyr:this.props.selectedEventLyr}),(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.selectedEventObjectId)&&this.setState({selectedEventObjectId:this.props.selectedEventObjectId}),(null===(a=this.props.mutableStatePropsVersion)||void 0===a?void 0:a.selectedEventRouteId)&&this.setState({selectedEventRouteId:this.props.selectedEventRouteId}),(null===(i=this.props.mutableStatePropsVersion)||void 0===i?void 0:i.selectedEventFromDate)&&this.setState({selectedEventFromDate:this.props.selectedEventFromDate});const o=(0,n.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:o}),this.setSettingsPerView()},this.setSettingsPerView=()=>{var e;const{config:t}=this.props,a=t.mode&&t.mode!==n.ModeType.Map?t.lrsLayers:this.state.activeLrsLayers;let i=(null===(e=t.settingsPerView)||void 0===e?void 0:e[this.state.activeMapViewId])||wa();if(a&&a.length>0){i=function(e,t,a){if(a){const a=t.filter(e=>e.layerType===n.LrsLayerType.Network).map(e=>e.name),i=t.filter(e=>(0,n.isLineEvent)(e)).map(e=>e.name);e=e.set("networkLayers",a).set("eventLayers",i)}const i=(0,n.getDefaultEvent)(t,e.defaultEvent,!1);return e.set("defaultEvent",i).set("hideEvent",e.hideEvent).set("hideNetwork",e.hideNetwork).set("hideDate",e.hideDate).set("useRouteStartDate",e.useRouteStartDate)}(i,a,!0),this.setState({settingPerView:i});const e=t.setIn(["settingsPerView",this.state.activeMapViewId],i);(0,ja.getAppConfigAction)().editWidgetConfig(this.props.id,e).exec()}},this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally(()=>{this.setState({jimuMapView:e})})},this.waitForChildDataSourcesReady=e=>Ea(this,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const n=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==n?void 0:n.isDataSourceSet())&&!n.areChildDataSourcesCreated()?n.childDataSourcesReady().then(()=>n).catch(e=>n):Promise.resolve(n)}),this.getI18nMessage=(e,t)=>{const n=Object.assign({},a,i.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:n[e]},t)},this.handleLrsLayersChanged=e=>{this.setState({activeLrsLayers:e})},this.handleViewChange=e=>{e&&this.setState({activeMapViewId:e.id})},this.state={hideTitle:!1,jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null,selectedEventLyr:null,selectedEventObjectId:null,selectedEventRouteId:null,selectedEventFromDate:null,routeInfoFromDataAction:null,networkDataSourceFromDataAction:null,activeMapViewId:"",activeLrsLayers:this.props.config.lrsLayers,settingPerView:wa(),isConflictPreventionEnabled:!1},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,a){var i,o,r,s,l,c,u,d,f,v,p,h,m,b,y;a.jimuMapView!==this.state.jimuMapView&&(0,n.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers());const g=null===(r=null===(o=null===(i=(0,t.getAppStore)())||void 0===i?void 0:i.getState())||void 0===o?void 0:o.widgetsRuntimeInfo[this.props.id])||void 0===r?void 0:r.state;if(g===t.WidgetState.Opened||!g){let t=!1;(null===(s=this.props)||void 0===s?void 0:s.selectedEventLyr)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedEventLyr&&(null===(l=null==e?void 0:e.mutableStatePropsVersion)||void 0===l?void 0:l.selectedEventLyr)===(null===(c=this.props.mutableStatePropsVersion)||void 0===c?void 0:c.selectedEventLyr)||(this.setState({selectedEventLyr:this.props.selectedEventLyr}),t=!0)),(null===(u=this.props)||void 0===u?void 0:u.selectedEventObjectId)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedEventObjectId&&(null===(d=null==e?void 0:e.mutableStatePropsVersion)||void 0===d?void 0:d.selectedEventObjectId)===(null===(f=this.props.mutableStatePropsVersion)||void 0===f?void 0:f.selectedEventObjectId)||(this.setState({selectedEventObjectId:this.props.selectedEventObjectId}),t=!0)),(null===(v=this.props)||void 0===v?void 0:v.selectedEventRouteId)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedEventRouteId&&(null===(p=null==e?void 0:e.mutableStatePropsVersion)||void 0===p?void 0:p.selectedEventRouteId)===(null===(h=this.props.mutableStatePropsVersion)||void 0===h?void 0:h.selectedEventRouteId)||(this.setState({selectedEventRouteId:this.props.selectedEventRouteId}),t=!0)),(null===(m=this.props)||void 0===m?void 0:m.selectedEventFromDate)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedEventFromDate&&(null===(b=null==e?void 0:e.mutableStatePropsVersion)||void 0===b?void 0:b.selectedEventRouteId)===(null===(y=this.props.mutableStatePropsVersion)||void 0===y?void 0:y.selectedEventRouteId)||(this.setState({selectedEventFromDate:this.props.selectedEventFromDate}),t=!0)),t&&this.setRouteInfoFromDataAction(this.props.selectedEventLyr,this.props.selectedEventRouteId,this.props.selectedEventFromDate)}this.state.activeLrsLayers!==a.activeLrsLayers&&this.setSettingsPerView();const{config:D}=this.props,I=D.mode&&D.mode!==n.ModeType.Map?D.lrsLayers:this.state.activeLrsLayers;I.length>0&&(0,n.checkConflictPrevention)(I[0].lrsUrl).then(e=>{const t=null!==e&&e;this.state.isConflictPreventionEnabled!==t&&this.setState({isConflictPreventionEnabled:t})})}removeGraphicLayers(){(0,n.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,n.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,n.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,n.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const n=new Ra.default({listMode:"hide"}),a=new Ra.default({listMode:"hide"}),i=new Ra.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([a,i,n]),this.setState({hoverGraphic:n}),this.setState({pickedGraphic:a}),this.setState({flashGraphic:i})}}clearGraphics(){(0,n.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,n.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,n.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}resetDataAction(){this.setState({selectedEventLyr:null,selectedEventObjectId:null,selectedEventRouteId:null,selectedEventFromDate:null,routeInfoFromDataAction:null})}setRouteInfoFromDataAction(e,a,i){if((0,n.isDefined)(e)&&(0,n.isDefined)(a)&&(0,n.isDefined)(i)){let o;(0,n.isDefined)(this.props.config.lrsLayers)&&this.props.config.lrsLayers.length>0?o=this.props.config.lrsLayers.find(t=>(0,n.isDefined)(t.networkInfo)&&t.networkInfo.lrsNetworkId===e.eventInfo.parentNetworkId):(0,n.isDefined)(this.state.activeLrsLayers)&&this.state.activeLrsLayers.length>0&&(o=this.state.activeLrsLayers.find(t=>(0,n.isDefined)(t.networkInfo)&&t.networkInfo.lrsNetworkId===e.eventInfo.parentNetworkId)),o&&o.layerType===n.LrsLayerType.Network&&(0,n.queryRouteIdOrName)(a.trim(),(0,t.Immutable)(o.networkInfo),this.state.networkDataSourceFromDataAction,!1,!0,"",i,!0).then(e=>Ea(this,void 0,void 0,function*(){(0,n.isDefined)(e)&&(yield Promise.all(e.features.map(e=>Ea(this,void 0,void 0,function*(){const t=(0,n.getInitialRouteInfoState)(),a=yield(0,n.setRouteInfoByRouteIdOrName)(t,o.networkInfo,this.state.networkDataSourceFromDataAction,e);this.setState({routeInfoFromDataAction:a})}))))}))}}onUpdateNetworkDS(e){this.setState({networkDataSourceFromDataAction:e})}getConfigValues(e,t,a){const i={networkLayers:t.networkLayers,eventLayers:t.eventLayers,defaultEvent:t.defaultEvent,hideEvent:t.hideEvent,hideNetwork:t.hideNetwork,hideDate:t.hideDate,useRouteStartDate:t.useRouteStartDate};return Object.entries(i).reduce((t,[i,o])=>(t[i]=(0,n.getConfigValue)(e,i,a,o),t),{})}render(){var a,o;const{config:l,id:c}=this.props;let{useMapWidgetIds:u}=this.props;const{mapViewsConfig:d}=l,f=l.mode&&l.mode!==n.ModeType.Map?l.lrsLayers:this.state.activeLrsLayers,v=this.getConfigValues(l,this.state.settingPerView,this.state.activeMapViewId),{networkLayers:p,eventLayers:h,defaultEvent:m,hideEvent:b,hideNetwork:y,hideDate:g,useRouteStartDate:D}=v,I=(0,n.getModeType)(l.mode,f),{jimuMapView:S}=this.state,R=(null==p?void 0:p.length)>0&&(null==h?void 0:h.length)>0;if(!u){const e=null===(o=null===(a=(0,t.getAppStore)())||void 0===a?void 0:a.getState())||void 0===o?void 0:o.appConfig;u=(0,n.findFirstArcgisMapWidgetId)(e)}return(0,e.jsx)(i.Paper,{variant:"flat",shape:"none",className:"jimu-widget runtime-split-event surface-1 border-0",children:(0,e.jsxs)("div",{id:this.widgetOuterDivId,className:"widget-outer-div h-100 w-100 d-flex",children:[(0,e.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null==u?void 0:u[0],onActiveViewChange:this.onActiveViewChange}),I&&(0,e.jsx)(n.MapViewLoader,{config:l,widgetId:c,supportedLrsLayerTypes:this.supportedLrsLayerTypes,useMapWidgetIds:u,mapViewsConfig:d,jimuMapView:S,outputDataSourceType:"none",onLrsLayersChanged:this.handleLrsLayersChanged,onViewChange:this.handleViewChange}),R&&(0,e.jsx)(Sa,{widgetId:c,hideTitle:this.state.hideTitle,lrsLayers:f,JimuMapView:S,eventLayers:h,networkLayers:p,defaultEvent:m,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:this.state.isConflictPreventionEnabled,onClearGraphic:this.clearGraphics.bind(this),hideEvent:b,hideNetwork:y,hideDate:g,useRouteStartDate:D,intl:this.props.intl,selectedEventLyr:this.state.selectedEventLyr,selectedEventObjectId:this.state.selectedEventObjectId,selectedEventRouteId:this.state.selectedEventRouteId,selectedEventFromDate:this.state.selectedEventFromDate,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onUpdateNetworkDS:this.onUpdateNetworkDS.bind(this)}),!R&&(0,e.jsx)(i.WidgetPlaceholder,{icon:r(),widgetId:c,message:this.getI18nMessage("_widgetLabel")})]})})}}La.mapExtraStateProps=(e,t)=>{var n,a,i,o;return{selectedEventLyr:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.selectedEventLyr,selectedEventObjectId:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedEventObjectId,selectedEventRouteId:null===(i=null==t?void 0:t.mutableStateProps)||void 0===i?void 0:i.selectedEventRouteId,selectedEventFromDate:null===(o=null==t?void 0:t.mutableStateProps)||void 0===o?void 0:o.selectedEventFromDate}};const Ta=La;function Na(e){v.p=e}})(),p})())}}});