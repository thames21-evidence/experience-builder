System.register(["jimu-core/emotion","jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree"],function(e,t){var a={},n={},i={},s={},o={},l={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){n.Immutable=e.Immutable,n.React=e.React,n.ReactRedux=e.ReactRedux,n.css=e.css,n.hooks=e.hooks},function(e){i.EmptyPlaceholder=e.EmptyPlaceholder,i.LrsLayerType=e.LrsLayerType,i.LrsLoader=e.LrsLoader,i.ModeType=e.ModeType,i.getConfigValue=e.getConfigValue,i.getDefaultEvent=e.getDefaultEvent,i.getLayersByType=e.getLayersByType,i.isLineEvent=e.isLineEvent,i.lrsDefaultMessages=e.lrsDefaultMessages,i.updateConfig=e.updateConfig,i.updateDefaultForMapMode=e.updateDefaultForMapMode,i.waitTime=e.waitTime},function(e){s.Checkbox=e.Checkbox,s.CollapsablePanel=e.CollapsablePanel,s.Select=e.Select,s.Switch=e.Switch,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.defaultMessages=e.defaultMessages,s.hooks=e.hooks},function(e){o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType}],execute:function(){e((()=>{var e={8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=s},47626:e=>{"use strict";e.exports=i},51334:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 3.5a3.5 3.5 0 1 0-7 0V6H3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-2V3.5l.005-.164A2.5 2.5 0 0 1 12.5 1l.164.005A2.5 2.5 0 0 1 15 3.5a.5.5 0 0 0 1 0M9 7H3v8h9V7H9m-1.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=a},79244:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=o},98640:e=>{"use strict";e.exports=l}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var d={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(d),r.d(d,{__set_webpack_public_path__:()=>y,default:()=>h});var e=r(67386),t=r(79244),a=r(47626),n=r(14321);const i={blankStatus:"Select a map to import LRS networks",defaultSettings:"Default Settings",defaultEvent:"Event",defaultMethod:"Method",defaultType:"Type",methodMeasure:"Route and Measure",methodCoordinate:"Coordinate",methodLocationOffset:"Location Offset",operationTypeSingle:"Single Point",operationTypeMultiple:"Multiple Point",loadLayers:"Load Layers",clearLayers:"Clear Layers",useFieldAlias:"Use field alias",configureFields:"Configure Fields",layerConfig:"Layer Configuration",selectMap:"Select Map",noNetworkLayersTips:"No Network layers in the map",noLineEventLayersTips:"No Line event layers in the map",missingParentNetwork:"Parent network is missing",attributeEditable:"Editable",attributeNotEditable:"Not editable"};var s=r(79298);function o(){return(0,t.Immutable)({networkLayers:[],eventLayers:[],defaultEvent:{index:-1,name:""},hideEvent:!1,hideNetwork:!1,hideDate:!1,useRouteStartDate:!1})}function l(e,t,n){if(n){const n=t.filter(e=>e.layerType===a.LrsLayerType.Network).map(e=>e.name),i=t.filter(e=>(0,a.isLineEvent)(e)).map(e=>e.name);e=e.set("networkLayers",n).set("eventLayers",i)}const i=(0,a.getDefaultEvent)(t,e.defaultEvent,!1);return e.set("defaultEvent",i).set("hideEvent",e.hideEvent).set("hideNetwork",e.hideNetwork).set("hideDate",e.hideDate).set("useRouteStartDate",e.useRouteStartDate)}function c(e,t){return e.set("mode",t).set("lrsLayers",[]).set("mapViewsConfig",{}).set("settingsPerView",{}).set("networkLayers",[]).set("eventLayers",[]).set("defaultEvent",{index:-1,name:""}).set("hideEvent",!1).set("hideNetwork",!1).set("hideDate",!1).set("useRouteStartDate",!1)}var u=r(98640);const p=r(8547),g=r(51334);function m(o){var l;const{widgetId:r,index:d,config:c,activeMapViewId:m,onSettingChange:f}=o,v=(h="lrsLayers",y=[],t.React.useMemo(()=>(0,a.getConfigValue)(c,h,m)||y,[c,m]));var h,y;const w=v[d],b=t.hooks.useTranslation(i),[S,L]=t.React.useState(null==w?void 0:w.name),x=function(e){const{widgetId:a,useDataSourceId:n}=e;return t.ReactRedux.useSelector(e=>{var t;let i;return i=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(t=i.widgets[a].useDataSources)&&void 0!==t?t:[]).some(e=>e.dataSourceId===n)})}({widgetId:r,useDataSourceId:null===(l=null==w?void 0:w.useDataSource)||void 0===l?void 0:l.dataSourceId});t.React.useEffect(()=>{(null==w?void 0:w.name)&&S!==(null==w?void 0:w.name)&&L(null==w?void 0:w.name)},[null==w?void 0:w.name]);const C=t.React.useCallback((e,n,i=!1)=>{var s;let o=null!=v?v:(0,t.Immutable)([]);if(o=t.Immutable.set(o,e,n),c.mode===a.ModeType.Map){const e=m,t=(null===(s=c.mapViewsConfig)||void 0===s?void 0:s[e]).set("lrsLayers",o),a=c.setIn(["mapViewsConfig",e],t);f({id:r,config:a})}else f({id:r,config:c.set("lrsLayers",o)})},[v,c,m,f,r]),I=t.React.useCallback((e,t,a=!1)=>{let n;n=null==t?w.without(e):w.set(e,t),C(d,n,a)},[C,d,w]),T=t.React.useCallback((e,t,a=!1)=>{const n=w.eventInfo.set(e,t),i=w.set("eventInfo",n);C(d,i,a)},[C,d,w]),R=t.React.useCallback(e=>{L(e.target.value)},[]),j=t.React.useCallback(e=>{e.trim().length>0?I("name",e,!0):L(null==w?void 0:w.name)},[null==w?void 0:w.name,I]),k=e=>w.eventInfo.attributeFields[e].enabled,M=e=>{const t=w.eventInfo.attributeFields.asMutable({deep:!0});t[e].enabled=!t[e].enabled,T("attributeFields",t,!0)},E={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:u.TreeItemActionType.RenderOverrideItem,children:[{name:u.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:u.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:u.TreeItemActionType.RenderOverrideItemBody,children:[{name:u.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:u.TreeItemActionType.RenderOverrideItemDragHandle},{name:u.TreeItemActionType.RenderOverrideItemDetailToggle},{name:u.TreeItemActionType.RenderOverrideItemTitle},{name:u.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,e.jsx)("div",{className:"h-100",children:(0,e.jsx)("div",{css:t.css`height: 100%; overflow:auto;`,children:w&&(x||c.mode===a.ModeType.Map)&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingSection,{role:"group","aria-label":b("label"),title:b("label"),children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(n.TextInput,{size:"sm",type:"text",className:"w-100",value:S,onChange:R,onAcceptValue:j,"aria-label":b("label")})}),(0,a.isLineEvent)(w)&&(0,e.jsx)(s.SettingRow,{flow:"no-wrap",tag:"label",label:b("useFieldAlias"),children:(0,e.jsx)(n.Switch,{checked:w.useFieldAlias,onChange:(e,t)=>{I("useFieldAlias",t,!1)}})})]}),(0,a.isLineEvent)(w)&&(0,e.jsx)(s.SettingSection,{role:"group",children:(0,e.jsx)(s.SettingRow,{flow:"wrap",label:b("configureFields"),children:(0,e.jsx)(u.List,Object.assign({className:"list-routeid-fields pt-2 w-100",showCheckbox:!0,itemsJson:Array.from(w.eventInfo.attributeFields).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:k(t),itemStateTitle:w.useFieldAlias?e.field.alias:e.field.name,itemStateCommands:[{label:e.editable?b("attributeEditable"):b("attributeNotEditable"),iconProps:()=>({icon:e.editable?g:p,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e;(e=>{const t=w.eventInfo.attributeFields.asMutable({deep:!0});t[e].editable=!t[e].editable,T("attributeFields",t,!0)})(+t.itemKey)}}]})),renderOverrideItemDetailToggle:(t,a)=>{const{itemJsons:i,itemJsons:[{itemStateDetailVisible:s,itemStateDetailContent:o}]}=a.props,[l]=i,r=+l.itemKey;return o?(0,e.jsx)(n.Checkbox,{"aria-expanded":!!s,className:"jimu-tree-item__detail-toggle mr-2",checked:w.eventInfo.attributeFields[r].enabled,onClick:e=>{M(r)}}):null},dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,n]=a;var i;i=n.map(e=>e.itemStateDetailContent),T("attributeFields",i,!0)},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;M(+a.itemKey)}},E))})})]})})})}function f(o){const{widgetId:l,config:r,activeMapViewId:d,onSettingChange:c}=o,u=t.hooks.useTranslation(i,a.lrsDefaultMessages),p=(e,n)=>t.React.useMemo(()=>(0,a.getConfigValue)(r,e,d)||n,[r,d]),g=p("lrsLayers",[]),m=p("eventLayers",[]),f=p("defaultEvent",{index:-1,name:""}),v=p("hideEvent",!1),h=p("hideNetwork",!1),y=p("hideDate",!1),w=p("useRouteStartDate",!1);return(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(s.SettingSection,{className:"px-4",children:(0,e.jsx)(n.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:u("defaultSettings"),defaultIsOpen:!0,disabled:!1,"aria-label":u("defaultSettings"),children:(0,e.jsx)(s.SettingRow,{flow:"wrap",label:u("defaultEvent"),children:(0,e.jsx)(n.Select,{"aria-label":u("defaultEvent"),className:"w-100",size:"sm",value:f.name,onChange:e=>{(e=>{const t=g.findIndex(t=>t.name===e),n={index:t,name:g[t].name};(0,a.updateConfig)(l,r,"defaultEvent",n,d,c)})(e.target.value)},children:m.map((t,a)=>(0,e.jsx)("option",{value:t,children:t},a))})})})}),(0,e.jsx)(s.SettingSection,{className:"px-4",children:(0,e.jsxs)(n.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:u("displaySettings"),defaultIsOpen:!0,disabled:!1,"aria-label":u("displaySettings"),children:[(0,e.jsx)(s.SettingRow,{flow:"no-wrap",tag:"label",label:u("hideEvent"),children:(0,e.jsx)(n.Switch,{checked:v,onChange:(e,t)=>{(0,a.updateConfig)(l,r,"hideEvent",t,d,c)}})}),(0,e.jsx)(s.SettingRow,{flow:"no-wrap",tag:"label",label:u("hideNetwork"),children:(0,e.jsx)(n.Switch,{checked:h,onChange:(e,t)=>{(0,a.updateConfig)(l,r,"hideNetwork",t,d,c)}})}),(0,e.jsxs)("div",{style:{display:"none"},children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:"Hide Date",children:(0,e.jsx)(n.Switch,{checked:y,onChange:(e,t)=>{t||w&&(0,a.updateConfig)(l,r,"useRouteStartDate",!1,d,c),(0,a.waitTime)(200).then(()=>{(0,a.updateConfig)(l,r,"hideDate",t,d,c)})}})}),y&&(0,e.jsx)(s.SettingRow,{tag:"label",label:"Use Route Start Date",children:(0,e.jsx)(n.Tooltip,{title:"Route start date will be used for new events. If disabled, the current date will be used.",children:(0,e.jsx)(n.Switch,{checked:w,onChange:(e,t)=>{(0,a.updateConfig)(l,r,"useRouteStartDate",t,d,c)}})})})]})]})})]})}var v=function(e,t,a,n){return new(a||(a=Promise))(function(i,s){function o(e){try{r(n.next(e))}catch(e){s(e)}}function l(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,l)}r((n=n.apply(e,t||[])).next())})};const h=r=>{const{id:d,intl:u,widgetId:p,config:g,useMapWidgetIds:h,portalUrl:y,theme:w,onSettingChange:b}=r,[S,L]=t.React.useState(-1),[x,C]=t.React.useState(""),[I,T]=t.React.useState(""),[R,j]=t.React.useState({}),k=t.React.useRef(g),M=g.mode===a.ModeType.Map,E=(null==h?void 0:h.length)>0,D=!M&&g.lrsLayers.length>0||M&&g.mapViewsConfig&&Object.keys(g.mapViewsConfig).length>0,V=!M&&g.lrsLayers&&0!==g.lrsLayers.length||M&&g.settingsPerView&&g.settingsPerView[x],N=(0,t.Immutable)([a.LrsLayerType.Event,a.LrsLayerType.Event,a.LrsLayerType.LineEvent,a.LrsLayerType.Network,a.LrsLayerType.Intersection]),O=(0,t.Immutable)([a.LrsLayerType.LineEvent,a.LrsLayerType.Network]),P=n.hooks.useTranslate(i,n.defaultMessages,a.lrsDefaultMessages);t.React.useEffect(()=>{if(void 0===g.mode){const e=g.lrsLayers.length>0?a.ModeType.Layer:a.ModeType.Map;r.onSettingChange({id:p,config:g.set("mode",e)})}},[]),t.React.useEffect(()=>{g&&(k.current=g)},[g]);const F=t.React.useCallback((...e)=>{const[t,...a]=e,n=Object.assign(Object.assign({id:d},t));b(n,...a)},[d,b]),A=t.React.useCallback(e=>{const t=e.target.value;C(t)},[]),_=t.React.useCallback(e=>{b({id:p,config:c(g,e),useDataSources:[]})},[g,b,p]),B=t.React.useCallback((e,t)=>{L(e),M&&""!==t&&T(t)},[M]),U=t.React.useCallback((e,n)=>{let i=g.set("lrsLayers",e);const{networks:s,lineEvents:o,intersections:l}=(0,a.getLayersByType)(e,(0,t.Immutable)([]));i=i.set("networkLayers",s).set("eventLayers",o).set("intersectionLayers",l);const r=(0,a.getDefaultEvent)(i.lrsLayers,i.defaultEvent,!1);i=i.set("defaultEvent",r),F({config:i,useDataSources:Object.values(n.useDataSourceMap)})},[g,F]),H=t.React.useRef(!1),z=t.React.useCallback((e,n,i,s)=>v(void 0,void 0,void 0,function*(){var r;yield v(void 0,void 0,void 0,function*(){for(;H.current;)yield new Promise(e=>setTimeout(e,10))}),H.current=!0;let d=k.current;try{for(const i in e)if(s){d=d.set("mapViewsConfig",e);const s=e[i];let c=(null===(r=k.current.settingsPerView)||void 0===r?void 0:r[i])||o();const{networks:u,lineEvents:p,intersections:g}=(0,a.getLayersByType)(s.lrsLayers,s.disabledLayerIds);c=c.setIn(["networkLayers"],u).setIn(["eventLayers"],p).setIn(["intersectionLayers"],g),c=l(c,s.lrsLayers,!1),c=(0,a.updateDefaultForMapMode)(c,s,a.LrsLayerType.Event,"defaultEvent",!1),(null==d?void 0:d.settingsPerView)||(d=d.set("settingsPerView",(0,t.Immutable)({})));const m=d.settingsPerView.set(i,c);d=d.set("settingsPerView",m),""===I&&C(i),j(n)}else""===I&&C(i),j(n);F({config:d,useDataSources:Object.values(i.useDataSourceMap)})}finally{k.current=d,H.current=!1}}),[I,F]);return(0,e.jsx)("div",{className:"setting-add-point-event h-100",children:(0,e.jsxs)("div",{className:"jimu-widget-setting setting-add-point-event__setting-content h-100",children:[(0,e.jsx)(a.LrsLoader,{intl:u,portalUrl:y,theme:w,widgetId:p,mode:g.mode,useMapWidgetIds:h,lrsLayers:g.lrsLayers,mapViewsConfig:g.mapViewsConfig,supportedLrsTypes:N,requiredLrsTypes:O,outputDataSourceWidgetType:"sld",onLrsLayersUpdated:U,onMapViewsConfigUpdated:z,onMapWidgetSelected:(e,t)=>{r.onSettingChange({id:p,config:c(g,t),useMapWidgetIds:e})},onReset:_,onSelectionChanged:B,children:S>-1&&(0,e.jsx)(m,{widgetId:p,config:g,index:S,activeMapViewId:I,onSettingChange:b})}),E&&V&&(0,e.jsx)(t.React.Fragment,{children:Object.keys(R).length>1&&(0,e.jsx)(s.SettingSection,{role:"none",children:(0,e.jsx)(s.SettingRow,{flow:"wrap",label:P("selectMapToEditSettings"),children:(0,e.jsx)(n.Select,{className:"w-100",size:"sm",value:x,onChange:A,children:Object.keys(R).map(t=>(0,e.jsx)("option",{value:t,children:R[t]},t))})})})}),D&&V&&(0,e.jsx)(t.React.Fragment,{children:(0,e.jsx)(f,{intl:u,widgetId:p,config:g,activeMapViewId:x,onSettingChange:b})}),!M&&!D&&!V&&(0,e.jsx)(a.EmptyPlaceholder,{isMapMode:!1}),M&&!E&&(0,e.jsx)(a.EmptyPlaceholder,{isMapMode:!0})]})})};function y(e){r.p=e}})(),d})())}}});