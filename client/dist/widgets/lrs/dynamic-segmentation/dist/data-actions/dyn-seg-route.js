System.register(["jimu-core","widgets/shared-code/lrs"],function(e,t){var r={},n={};return{setters:[function(e){r.AbstractDataAction=e.AbstractDataAction,r.DataLevel=e.DataLevel,r.DataSourceStatus=e.DataSourceStatus,r.DataSourceTypes=e.DataSourceTypes,r.MutableStoreManager=e.MutableStoreManager,r.getAppStore=e.getAppStore,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){n.findNetworkInfoFromMapViewsConfig=e.findNetworkInfoFromMapViewsConfig,n.isDefined=e.isDefined}],execute:function(){e((()=>{var e={47626:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=r}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var i={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(i),o.d(i,{default:()=>R});var e=o(79244),t=o(47626);const r="object"==typeof global&&global&&global.Object===Object&&global;var n="object"==typeof self&&self&&self.Object===Object&&self;const a=r||n||Function("return this")();var s=/\s/;const u=function(e){for(var t=e.length;t--&&s.test(e.charAt(t)););return t};var c=/^\s+/;const l=function(e){return e?e.slice(0,u(e)+1).replace(c,""):e};const f=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const d=a.Symbol;var g=Object.prototype,v=g.hasOwnProperty,p=g.toString,S=d?d.toStringTag:void 0;const y=function(e){var t=v.call(e,S),r=e[S];try{e[S]=void 0;var n=!0}catch(e){}var o=p.call(e);return n&&(t?e[S]=r:delete e[S]),o};var m=Object.prototype.toString;const b=function(e){return m.call(e)};var h=d?d.toStringTag:void 0;const D=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":h&&h in Object(e)?y(e):b(e)};const w=function(e){return null!=e&&"object"==typeof e};const M=function(e){return"symbol"==typeof e||w(e)&&"[object Symbol]"==D(e)};var I=/^[-+]0x[0-9a-f]+$/i,O=/^0b[01]+$/i,P=/^0o[0-7]+$/i,j=parseInt;const N=function(e){if("number"==typeof e)return e;if(M(e))return NaN;if(f(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=f(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=l(e);var r=O.test(e);return r||P.test(e)?j(e.slice(2),r?2:8):I.test(e)?NaN:+e};var A=1/0;const k=function(e){return e?(e=N(e))===A||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const F=function(e){var t=k(e),r=t%1;return t==t?r?t-r:t:0};const x=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o};const C=Array.isArray;var L=d?d.prototype:void 0,T=L?L.toString:void 0;const V=function e(t){if("string"==typeof t)return t;if(C(t))return x(t,e)+"";if(M(t))return T?T.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r};const J=function(e){return null==e?"":V(e)};var G=a.isFinite,$=Math.min;const E=function(e){var t=Math[e];return function(e,r){if(e=N(e),(r=null==r?0:$(F(r),292))&&G(e)){var n=(J(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+r));return+((n=(J(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");var B=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}u((n=n.apply(e,t||[])).next())})};class R extends e.AbstractDataAction{isSupported(r,n){var o;if(r.length>1)return Promise.resolve(!1);const i=r[0];if(1!==i.records.length)return Promise.resolve(!1);const a=i.records[0].getData(),s=JSON.parse(JSON.stringify(a)),{dataSource:u,records:c}=i,l=u.type===e.DataSourceTypes.FeatureLayer||u.type===e.DataSourceTypes.SceneLayer,f=n!==e.DataLevel.Records,d=n===e.DataLevel.Records&&0===(null==c?void 0:c.length),g=!u.isInAppConfig()&&!l;if(f||d||g)return Promise.resolve(!1);if(!u||u.getStatus()===e.DataSourceStatus.NotReady)return Promise.resolve(!1);const v=(0,t.isDefined)(u.getOriginDataSources()[0])?u.getOriginDataSources()[0]:u,p=_(),S=null===(o=null==p?void 0:p.widgets)||void 0===o?void 0:o[this.widgetId];if(!(0,t.isDefined)(v))return Promise.resolve(!1);let y;if(S.config.lrsLayers.forEach(e=>{e.id===v.id&&(y=e.networkInfo)}),!(0,t.isDefined)(y)){const e=S.config.mapViewsConfig;y=(0,t.findNetworkInfoFromMapViewsConfig)(e,v)}return y&&(0,t.isDefined)(s[y.routeIdFieldSchema.name])&&""!==s[y.routeIdFieldSchema.name]?Promise.resolve(!0):Promise.resolve(!1)}onExecute(r,n){return B(this,void 0,void 0,function*(){var n;const o=r[0],{records:i,dataSource:a}=o,s=_(),u=null===(n=null==s?void 0:s.widgets)||void 0===n?void 0:n[this.widgetId],c=(0,t.isDefined)(a.getOriginDataSources()[0])?a.getOriginDataSources()[0]:a;let l;if(u.config.lrsLayers.forEach(e=>{e.id===c.id&&(l=e.networkInfo)}),!(0,t.isDefined)(l)){const e=u.config.mapViewsConfig;l=(0,t.findNetworkInfoFromMapViewsConfig)(e,c)}const f=i[0].getData(),d=JSON.parse(JSON.stringify(f)),g={networkInfo:l,routeId:"",routeName:"",fromMeasure:null,toMeasure:null},v=Object.keys(d).find(e=>e===l.routeIdFieldSchema.name),p=Object.keys(d).find(e=>{var t;return e===(null===(t=l.routeNameFieldSchema)||void 0===t?void 0:t.name)}),S=Object.keys(d).find(e=>"Measure"===e),y=Object.keys(d).find(e=>"ToMeasure"===e);if(g.routeId=(0,t.isDefined)(v)?d[v]:null,g.routeName=(0,t.isDefined)(p)?d[p]:null,g.fromMeasure=(0,t.isDefined)(S)?d[S]:null,g.toMeasure=(0,t.isDefined)(y)?d[y]:null,isNaN(g.fromMeasure)||isNaN(g.toMeasure)||null===g.fromMeasure||null===g.toMeasure){const r=c.getIdField(),n=Object.keys(d).find(e=>"Network_OBJECTID"===e);let o=null;if(o=(0,t.isDefined)(n)?d[n]:d[r],null===o)return Promise.resolve(!1);const i=c,a={returnGeometry:!0,returnM:!0,where:`${c.getIdField()} = ${o}`};yield i.query(a).then(r=>B(this,void 0,void 0,function*(){if(!(r.records.length>0))return Promise.resolve(!1);{let n=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Polyline"]).then(o=>{n=o[0];const i=new n(r.records[0].getGeometry());if(!(0,t.isDefined)(i))return Promise.resolve(!1);const a=i.getPoint(0,0),s=i.paths[i.paths.length-1].length-1,u=i.getPoint(i.paths.length-1,s);g.fromMeasure=E(a.m,l.measurePrecision),g.toMeasure=E(u.m,l.measurePrecision),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedNetworkDataSource",c),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"routeLocationParams",g)})}}))}else e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedNetworkDataSource",c),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"routeLocationParams",g);return Promise.resolve(!0)})}}function _(){var t,r,n;return window.jimuConfig.isBuilder?null===(r=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===r?void 0:r.appConfig:null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig}})(),i})())}}});