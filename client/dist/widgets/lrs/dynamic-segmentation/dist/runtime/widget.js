/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-arcgis","esri/layers/GraphicsLayer","widgets/shared-code/lrs","calcite-components","jimu-theme","esri/Graphic","jimu-core/react","esri/widgets/FeatureForm","esri/form/FormTemplate","esri/form/elements/FieldElement","esri/form/elements/inputs/DateTimePickerInput","esri/layers/FeatureLayer","esri/geometry","esri/geometry/operators/disjointOperator","esri/geometry/operators/clipOperator","esri/core/reactiveUtils.js","esri/geometry/Point","jimu-for-builder"],function(e,t){var n={},a={},i={},r={},o={},s={},l={},c={},u={},d={},f={},p={},m={},g={},h={},y={},v={},b={},w={},S={},x={};return{setters:[function(e){n.jsx=e.jsx,n.jsxs=e.jsxs},function(e){a.DataActionManager=e.DataActionManager,a.DataLevel=e.DataLevel,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.React=e.React,a.SessionManager=e.SessionManager,a.WidgetState=e.WidgetState,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.useIntl=e.useIntl,a.utils=e.utils},function(e){i.AdvancedSelect=e.AdvancedSelect,i.Button=e.Button,i.Dropdown=e.Dropdown,i.DropdownButton=e.DropdownButton,i.DropdownItem=e.DropdownItem,i.DropdownMenu=e.DropdownMenu,i.Icon=e.Icon,i.Label=e.Label,i.Loading=e.Loading,i.Modal=e.Modal,i.ModalBody=e.ModalBody,i.ModalHeader=e.ModalHeader,i.NumericInput=e.NumericInput,i.Paper=e.Paper,i.Select=e.Select,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip,i.WidgetPlaceholder=e.WidgetPlaceholder,i.defaultMessages=e.defaultMessages},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent,r.MapViewManager=e.MapViewManager,r.geometryUtils=e.geometryUtils},function(e){o.default=e.default},function(e){s.GetUnits=e.GetUnits,s.IntellisenseTextInput=e.IntellisenseTextInput,s.LockAcquireStatus=e.LockAcquireStatus,s.LockAction=e.LockAction,s.LrsApplyEdits=e.LrsApplyEdits,s.LrsLayerType=e.LrsLayerType,s.MapViewLoader=e.MapViewLoader,s.ModeType=e.ModeType,s.QueryLock=e.QueryLock,s.QueryMeasureOnRoute=e.QueryMeasureOnRoute,s.RoutePickerPopup=e.RoutePickerPopup,s.acquireLock=e.acquireLock,s.atOrBetween=e.atOrBetween,s.checkConflictPrevention=e.checkConflictPrevention,s.createFeatureLayer=e.createFeatureLayer,s.createField=e.createField,s.fetchEnterpriseContingentValues=e.fetchEnterpriseContingentValues,s.fetchEnterpriseFieldGroup=e.fetchEnterpriseFieldGroup,s.fieldsWithContingentValues=e.fieldsWithContingentValues,s.findFieldByName=e.findFieldByName,s.findFieldByType=e.findFieldByType,s.findFirstArcgisMapWidgetId=e.findFirstArcgisMapWidgetId,s.formatMessage=e.formatMessage,s.getAllDatasourceFromMapWidgetId=e.getAllDatasourceFromMapWidgetId,s.getAttributeSets=e.getAttributeSets,s.getCalciteBasicTheme=e.getCalciteBasicTheme,s.getCalciteNoticeTheme=e.getCalciteNoticeTheme,s.getConfigValue=e.getConfigValue,s.getContingentOptions=e.getContingentOptions,s.getDataSourceById=e.getDataSourceById,s.getDateWithTZOffset=e.getDateWithTZOffset,s.getDateWithoutTZOffset=e.getDateWithoutTZOffset,s.getDefaultAttributeSet=e.getDefaultAttributeSet,s.getExistingFieldNames=e.getExistingFieldNames,s.getGDBVersion=e.getGDBVersion,s.getGeometryGraphic=e.getGeometryGraphic,s.getInitialRouteInfoState=e.getInitialRouteInfoState,s.getLayer=e.getLayer,s.getModeType=e.getModeType,s.getRouteFromEndMeasures=e.getRouteFromEndMeasures,s.isCodedDomain=e.isCodedDomain,s.isConflictPreventionEnabled=e.isConflictPreventionEnabled,s.isDate=e.isDate,s.isDefined=e.isDefined,s.isInWidgetController=e.isInWidgetController,s.isNumber=e.isNumber,s.isRangeDomain=e.isRangeDomain,s.isWithinTolerance=e.isWithinTolerance,s.normalizeFieldName=e.normalizeFieldName,s.queryRouteId=e.queryRouteId,s.queryRouteIdOrName=e.queryRouteIdOrName,s.requestService=e.requestService,s.resolveFieldName=e.resolveFieldName,s.setContingentValues=e.setContingentValues,s.shouldTryAcquireLock=e.shouldTryAcquireLock,s.tryAutoReconcile=e.tryAutoReconcile,s.useEditSession=e.useEditSession,s.useLrsDate=e.useLrsDate,s.useVmsManager=e.useVmsManager,s.validateContingencyConstraints=e.validateContingencyConstraints,s.validateField=e.validateField,s.validateRangeDomain=e.validateRangeDomain,s.waitTime=e.waitTime},function(e){l.CalciteAction=e.CalciteAction,l.CalciteActionBar=e.CalciteActionBar,l.CalciteActionGroup=e.CalciteActionGroup,l.CalciteButton=e.CalciteButton,l.CalciteIcon=e.CalciteIcon,l.CalciteInputDatePicker=e.CalciteInputDatePicker,l.CalciteNotice=e.CalciteNotice,l.CalciteOption=e.CalciteOption,l.CalcitePanel=e.CalcitePanel,l.CalcitePopover=e.CalcitePopover,l.CalciteSelect=e.CalciteSelect,l.CalciteTable=e.CalciteTable,l.CalciteTableCell=e.CalciteTableCell,l.CalciteTableHeader=e.CalciteTableHeader,l.CalciteTableRow=e.CalciteTableRow},function(e){c.colorUtils=e.colorUtils,c.getTheme=e.getTheme,c.useTheme=e.useTheme},function(e){u.default=e.default},function(e){d.default=e.default},function(e){f.default=e.default},function(e){p.default=e.default},function(e){m.default=e.default},function(e){g.default=e.default},function(e){h.default=e.default},function(e){y.Polyline=e.Polyline},function(e){v.execute=e.execute},function(e){b.execute=e.execute},function(e){w.watch=e.watch},function(e){S.default=e.default},function(e){x.getAppConfigAction=e.getAppConfigAction}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=c},4108:e=>{"use strict";e.exports=x},14321:e=>{"use strict";e.exports=i},22089:e=>{"use strict";e.exports=u},26435:e=>{"use strict";e.exports=y},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},36614:e=>{"use strict";e.exports=v},38252:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},38410:e=>{"use strict";e.exports=p},44927:e=>{"use strict";e.exports=g},46420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},46942:(e,t)=>{var n;!function(){"use strict";var a={}.hasOwnProperty;function i(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=o(e,r(n)))}return e}function r(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return i.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)a.call(e,n)&&e[n]&&(t=o(t,n));return t}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(i.default=i,e.exports=i):void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}()},47626:e=>{"use strict";e.exports=s},49419:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M16 0H0v1h16z"></path><path fill="#000" fill-rule="evenodd" d="M5 11a3 3 0 1 0 6 0 3 3 0 0 0-6 0m3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 6q3.874 0 7.75 4.349a.97.97 0 0 1 0 1.302Q11.874 16.001 8 16T.25 11.651a.97.97 0 0 1 0-1.302Q4.126 5.999 8 6m0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.698 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7" clip-rule="evenodd"></path><path fill="#000" d="M0 3h13v1H0zM3 6H0v1h3z"></path></svg>'},54312:e=>{"use strict";e.exports=w},59620:e=>{"use strict";e.exports=o},62686:e=>{"use strict";e.exports=r},67386:e=>{"use strict";e.exports=n},68972:e=>{"use strict";e.exports=d},73387:e=>{"use strict";e.exports=f},79244:e=>{"use strict";e.exports=a},82228:e=>{"use strict";e.exports=m},85633:e=>{"use strict";e.exports=h},90422:e=>{"use strict";e.exports=S},97552:e=>{"use strict";e.exports=b},99037:e=>{"use strict";e.exports=l}},t={};function I(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,I),i.exports}I.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return I.d(t,{a:t}),t},I.d=(e,t)=>{for(var n in t)I.o(t,n)&&!I.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},I.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),I.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},I.p="";var D={};return I.p=window.jimuConfig.baseUrl,(()=>{"use strict";I.r(D),I.d(D,{__set_webpack_public_path__:()=>Sa,default:()=>wa});var e=I(67386),t=I(79244);const n={_widgetLabel:"Dynamic Segmentation",_action_dynSeg_label:"Dynamic Segmentation",measureRange:"Measure Range",routeIdLabel:"Route ID:",routeNameLabel:"Route Name:",dateLabel:"View Date: {date} ",measureRangeNoValue:"Measure Range:",measureRangeValue:"Measure Range: {fromM} - {toM} {units} ",measuresRange:"{fromM}   -   {toM}",saveSuccess:"Success",saveError:"Error",saveSuccessMessage:"Successfully edited {editCount} event records",saveEdits:"Save",navStart:"Navigate to start",navEnd:"Navigate to end",navBack:"Navigate back",navForward:"Navigate forward",diagramLabel:"Diagram",tableLabel:"Table",fieldsLabel:"Fields",editableFields:"Editable Fields",nonEditableFields:"Non-Editable Fields",applyLabel:"Apply",exportLabel:"Export",exportGeoJson:"Export to GeoJSON",exportJson:"Export to JSON",exportCsv:"Export to CSV",selectLayers:"Select Layers",selectFields:"Select Fields",fieldCalculatorLabel:"Field Calculator",updateField:"Update Field",fieldValue:"Field Value",update:"Update",eventLayer:"Event Layer",discardEdits:"Discard Edits",showFields:"Show Fields",dynamicSeg:"Dynamic Segmentation",historicalFirstLabel:"Historical First",historicalLastLabel:"Historical Last",historicalMinimumLabel:"Minimum",historicalMaximumLabel:"Maximum",meanLabel:"Mean",medianLabel:"Median",tableLabelDisabled:"Table: Save/Discard edits to switch",diagramLabelDisabled:"Diagram: Save/Discard edits to switch",applyEditTitle:"Apply Edits",applyEditMessage:"Edits made have not been applied. Would you like to discard or apply these changes?",sldEditSuccessful:"Changes applied successfully.",editFieldSuccess:"Field updated successfully",dataActionMessage:"Search for the route or use data actions to generate dynamic segmentation",routeDoesNotExist:"Route does not exist in selected view date",errorLoadingRecords:"Error loading records",noResults:"No results for selected route",queryAttributeSetError:"Error performing dynamic segmentation",mapInteractLabel:"Map Interact",noAttributeSetEvents:"No events are present in the selected map with the provided attribute set. Make sure events are visible in the map and try again."};var a,i,r,o=I(14321),s=I(38252),l=I.n(s),c=I(62686),u=I(59620),d=I(47626);!function(e){e.Table="Table",e.Diagram="Diagram"}(a||(a={})),function(e){e.LineOnly="LineOnly",e.LineAndPoint="LineAndPoint"}(i||(i={})),function(e){e.Point="Point",e.Line="Line",e.Undefined="Undefined"}(r||(r={}));const f={pendingEdits:new Map,records:[],originalRecords:[],selectedRecordIds:[],fieldInfo:[],errorCount:0,isLoading:!1,display:a.Table,routeInfo:{networkInfo:void 0,fromMeasure:0,toMeasure:0},currentRouteInfo:{networkInfo:void 0,fromMeasure:0,toMeasure:0},jimuMapView:void 0,highlightLayer:null,highlightColor:"#65adff",selectedSldId:"",outputDataSources:[],networkDS:void 0,conflictPreventionEnabled:!1,syncToMap:!0},p=(e,t)=>{switch(t.type){case"SET_EDITS":return Object.assign(Object.assign({},e),{pendingEdits:t.value});case"SET_RECORDS":return Object.assign(Object.assign({},e),{records:t.value});case"SET_ORIGINAL_RECORDS":return Object.assign(Object.assign({},e),{originalRecords:t.value});case"SET_SELECTED_RECORD_IDS":return Object.assign(Object.assign({},e),{selectedRecordIds:t.value});case"SET_FIELD_INFO":return Object.assign(Object.assign({},e),{fieldInfo:t.value});case"SET_ERROR_COUNT":return Object.assign(Object.assign({},e),{errorCount:t.value});case"SET_IS_LOADING":return Object.assign(Object.assign({},e),{isLoading:t.value});case"SET_DISPLAY":return Object.assign(Object.assign({},e),{display:t.value});case"SET_ROUTE_INFO":return Object.assign(Object.assign({},e),{routeInfo:t.value});case"SET_CURRENT_ROUTE_INFO":return Object.assign(Object.assign({},e),{currentRouteInfo:t.value});case"SET_JIMU_MAP_VIEW":return Object.assign(Object.assign({},e),{jimuMapView:t.value});case"SET_HIGHLIGHT_LAYER":return Object.assign(Object.assign({},e),{highlightLayer:t.value});case"SET_HIGHLIGHT_COLOR":return Object.assign(Object.assign({},e),{highlightColor:t.value});case"SET_SELECTED_SLD_ID":return Object.assign(Object.assign({},e),{selectedSldId:t.value});case"SET_OUTPUT_DATA_SOURCES":return Object.assign(Object.assign({},e),{outputDataSources:t.value});case"SET_NETWORK_DS":return Object.assign(Object.assign({},e),{networkDS:t.value});case"SET_CONFLICT_PREVENTION_ENABLED":return Object.assign(Object.assign({},e),{conflictPreventionEnabled:t.value});case"SET_SYNC_TO_MAP":return Object.assign(Object.assign({},e),{syncToMap:t.value});case"RESET_STATE":return Object.assign(Object.assign({},f),{isLoading:!0,display:e.display,jimuMapView:e.jimuMapView,highlightLayer:e.highlightLayer,highlightColor:e.highlightColor,outputDataSources:e.outputDataSources,currentRouteInfo:e.currentRouteInfo,networkDS:e.networkDS,conflictPreventionEnabled:e.conflictPreventionEnabled});default:return e}},m=t.React.createContext(void 0),g=t.React.createContext(void 0),h=n=>{const{defaultState:a,children:i}=n,[r,o]=t.React.useReducer(p,a||f);return(0,e.jsx)(m.Provider,{value:r,children:(0,e.jsx)(g.Provider,{value:o,children:i})})},y=()=>t.React.useContext(m),v=()=>t.React.useContext(g);function b(t){const{isLoading:n}=t;return(0,e.jsx)("div",{children:n&&(0,e.jsx)("div",{className:"d-flex h-100 w-100",style:{position:"absolute"},children:(0,e.jsx)("div",{style:{height:"80px",position:"relative",width:"200px",margin:"auto"},children:(0,e.jsx)(o.Loading,{})})})})}const w={routeIdName:"route_id",routeIdAlias:"Route ID",fromDateName:"from_date",fromDateAlias:"From Date",toDateName:"to_date",toDateAlias:"To Date",fromMeasureName:"from_measure",fromMeasureAlias:"From Measure",toMeasureName:"to_measure",toMeasureAlias:"To Measure",objectIdName:"OBJECTID",typeName:"event_type",typeAlias:"Type"},S=34,x=22,N=18,M=10,k=34,L="transparent";var E=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function R(e,t,n,a){return E(this,void 0,void 0,function*(){if(!(0,d.isDefined)(e)||!(0,d.isDefined)(t)||!(0,d.isDefined)(a))return null;const i=yield function(e,t,n){return E(this,void 0,void 0,function*(){const a=[],i=(0,d.getExistingFieldNames)(),r=t.find(t=>(0,d.isDefined)(t.networkInfo)&&t.networkInfo.datasetName===e.datasetName);return yield(0,d.getLayer)(r.useDataSource).then(e=>E(this,void 0,void 0,function*(){const r=(0,d.findFieldByType)(e.fields,"oid");(0,d.isDefined)(r)&&(i.push(r.name.toUpperCase()),a.push(r));const o=(0,d.findFieldByType)(e.fields,"geometry");(0,d.isDefined)(o)&&(i.push(o.name.toUpperCase()),a.push(o));const s=yield(0,d.createField)(w.routeIdName,w.routeIdAlias,"string",!0);i.push(s.name.toUpperCase()),a.push(s);const l=yield(0,d.createField)(w.fromDateName,w.fromDateAlias,"date",!0);i.push(l.name.toUpperCase()),a.push(l);const c=yield(0,d.createField)(w.toDateName,w.toDateAlias,"date",!0);i.push(c.name.toUpperCase()),a.push(c);const u=yield(0,d.createField)(w.fromMeasureName,w.fromMeasureAlias,"double",!0);i.push(u.name.toUpperCase()),a.push(u);const f=yield(0,d.createField)(w.toMeasureName,w.toMeasureAlias,"double",!0);i.push(f.name.toUpperCase()),a.push(f);const p=yield(0,d.createField)(w.typeName,w.typeAlias,"string",!0);return i.push(p.name.toUpperCase()),a.push(p),n.forEach(e=>E(this,void 0,void 0,function*(){const n=t.find(t=>t.serviceId.toString()===e.layerId);yield(0,d.getLayer)(n.useDataSource).then(t=>{e.fields.forEach(e=>{const r=(0,d.findFieldByName)(t.fields,e);if((0,d.isDefined)(r)){const t=(0,d.resolveFieldName)(i,r.name);r.name=t,r.alias=n.eventInfo.datasetName+"."+e,r.nullable=!0,r.defaultValue=null,"oid"===r.type&&(r.type="integer",r.editable=!0),i.push(t.toUpperCase()),a.push(r)}})})})),a})).catch(()=>[])})}(e,t,n);return yield(0,d.createFeatureLayer)(i,"polyline","hide",a,"dynamic-segmentation",!1)})}function T(e,t){return E(this,void 0,void 0,function*(){const n=[];return yield Promise.all(t.map(t=>E(this,void 0,void 0,function*(){const a=e.find(e=>e.serviceId.toString()===t.layerId);(0,d.isDefined)(a)&&(yield(0,d.getLayer)(a.useDataSource).then(e=>{(0,d.isDefined)(e.subtypes)&&n.push({id:a.serviceId.toString(),subtypes:e.subtypes,subtypeField:e.subtypeField})}))}))),n})}const C=(e,t,n)=>E(void 0,void 0,void 0,function*(){const a=n.message,i=a.substring(a.indexOf("field: "),a.length),r=i.substring(0,i.indexOf(",")),o=r.substring(7,r.length);return t.attributes[o]=null,yield e.applyEdits({addFeatures:[t.clone()]}).then(e=>e.addFeatureResults.length>0?e.addFeatureResults[0].error:null).catch(e=>(console.error("Failed to add feature",e),null))}),j=(e,t)=>{const n=e.view.map.layers.length-1;e.view.map.layers.findIndex(e=>e===t)!==n&&e.view.map.reorder(t,e.view.map.layers.length-1)};var F=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function O(e,n,a){const i=[],r=t.DataSourceManager.getInstance(),o=e.networkInfo.lrsNetworkId;return a&&a.layers.forEach(e=>{var t;const a=n.find(t=>t.serviceId===e.layerId);if((0,d.isDefined)(a)){const n=null===(t=null==a?void 0:a.eventInfo)||void 0===t?void 0:t.parentNetworkId;if(o===n){const t={layerId:e.layerId.toString(),fields:[]};e.fields.forEach(e=>{t.fields.push(e.name)}),t.fields.push(a.eventInfo.eventIdFieldName);const n=r.getDataSource(a.useDataSource.dataSourceId);t.fields.push(n.getIdField()),i.push(t)}}}),i}function A(e,n,a,i,r){return F(this,void 0,void 0,function*(){if(!n.routeId.length)return null;const o=n.networkInfo.networkUrl,s=`${o}/queryAttributeSet`,l=yield t.SessionManager.getInstance().getSessionByUrl(o).getToken(o),c=function(e){const t=[];if(e.routeId){const n={routeId:e.routeId};(0,d.isDefined)(e.fromMeasure)&&!isNaN(e.fromMeasure)&&(n.fromMeasure=e.fromMeasure),(0,d.isDefined)(e.toMeasure)&&!isNaN(e.toMeasure)&&(n.toMeasure=e.toMeasure),t.push(n)}return t}(n);let u=e.getGDBVersion();u||(u="");const f=[a.getTime(),a.getTime()],p={f:"json",token:l,locations:c,attributeSet:i,temporalViewDate:JSON.stringify(f),gdbVersion:u,historicMoment:-1!==r?r:""};return(0,d.requestService)({method:"POST",url:s,params:p}).then(e=>e||null)})}var P=I(99037),_=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function V(a){const{allowMerge:i,lrsLayers:r,networkDS:s,networkInfo:l,onSave:c}=a,{pendingEdits:u,errorCount:f}=y(),p=t.hooks.useTranslation(n),m=v(),{sessionId:g,startEditSession:h,addEdit:b}=(0,d.useVmsManager)(),{supportsEditSession:S}=(0,d.useEditSession)(),x=t.React.useMemo(()=>u.size>0&&0===f,[f,u]),I=(e,n,a)=>(0,d.getLayer)(e.useDataSource).then(i=>{const r={},o=e.eventInfo;if(n.attributes.forEach((e,n)=>{switch(n){case w.routeIdName:r[o.routeIdFieldName]=e;break;case w.fromDateName:r[o.fromDateFieldName]=e;break;case w.toDateName:r[o.toDateFieldName]=e;break;case w.fromMeasureName:r[o.fromMeasureFieldName]=e;break;case w.toMeasureName:o.isPointEvent||(r[o.toMeasureFieldName]=e);break;case o.eventIdFieldName:(0,d.isDefined)(e)?r[n]=e:r[n]="{"+t.utils.getUUID()+"}";break;default:r[n]=e}}),o.fromReferentMethodFieldName){const e=i.fields.find(e=>e.name===o.fromReferentMethodFieldName);if((0,d.isDefined)(e)&&(0,d.isDefined)(e.domain)&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find(e=>e.name===a);t&&(r[o.fromReferentMethodFieldName]=t.code)}}if(o.fromReferentLocationFieldName&&(r[o.fromReferentLocationFieldName]=r[o.routeIdFieldName]),o.fromReferentOffsetFieldName){const e=r[o.fromMeasureFieldName];r[o.fromReferentOffsetFieldName]=(0,d.isDefined)(e)?e.toString():null}if(o.toReferentMethodFieldName){const e=i.fields.find(e=>e.name===o.toReferentMethodFieldName);if((0,d.isDefined)(e)&&(0,d.isDefined)(e.domain)&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find(e=>e.name===a);t&&(r[o.toReferentMethodFieldName]=t.code)}}if(o.toReferentLocationFieldName&&(r[o.toReferentLocationFieldName]=r[o.routeIdFieldName]),o.toReferentOffsetFieldName){const e=r[o.toMeasureFieldName];r[o.toReferentOffsetFieldName]=(0,d.isDefined)(e)?e.toString():null}return r});return(0,e.jsx)(o.Tooltip,{placement:"auto",title:p("saveEdits"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)(P.CalciteAction,{text:p("saveEdits"),icon:"save",scale:"m",disabled:!x||void 0,onClick:()=>_(this,void 0,void 0,function*(){const e={edits:[]},t=s,n=[];u.forEach(e=>{n.push(e)});let a="";yield Promise.all(n.map((t,n)=>_(this,void 0,void 0,function*(){const n=r.find(e=>e.serviceId.toString()===t.layerId);""===a&&(a=n.lrsUrl);const o=[],s={attributes:yield I(n,t,l.datasetName)};o.push(s);const c={id:n.serviceId,adds:o,allowMerge:i,retireMeasureOverlap:!0,retireByEventId:!1};e.edits.push(c)}))).then(()=>_(this,void 0,void 0,function*(){if(S){const e=yield h();if(!e.success){const t={title:p("saveError"),body:e.error,type:"danger"};return void c(t)}}yield(0,d.LrsApplyEdits)(t,r[0],g,e,null,null).then(e=>{if(e.success){S&&b(e,p("_widgetLabel"));const t=u.size;m({type:"SET_EDITS",value:new Map});const n={title:p("saveSuccess"),body:p("saveSuccessMessage",{editCount:t}),type:"success"};c(n)}else{const t={title:p("saveError"),body:e.message,details:e.details,type:"danger"};c(t)}})}))})})})}var $=I(1888);function z(){const i=t.hooks.useTranslation(n),r=(0,$.getTheme)(),{display:s,records:l,pendingEdits:c}=y(),u=v(),f=e=>{if((0,d.isDefined)(c)&&c.size>0){if(s===a.Diagram&&e===a.Table)return!0;if(s===a.Table&&e===a.Diagram)return!0}return!1};return(0,e.jsxs)(P.CalciteActionGroup,{scale:"m",children:[(0,e.jsx)(o.Tooltip,{placement:"auto",title:f(a.Table)?i("tableLabelDisabled"):i("tableLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)(P.CalciteAction,{text:i("tableLabel"),icon:"table",scale:"m",indicator:s===a.Table||void 0,disabled:!!f(a.Table)||void 0,css:t.css`
            --calcite-action-indicator-color: ${r.sys.color.primary.main};
          `,onClick:()=>{s!==a.Table&&(u({type:"SET_DISPLAY",value:a.Table}),l.length>0&&u({type:"SET_IS_LOADING",value:!0}))}})}),(0,e.jsx)(o.Tooltip,{placement:"auto",title:f(a.Diagram)?i("diagramLabelDisabled"):i("diagramLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)(P.CalciteAction,{text:i("diagramLabel"),icon:"graph-bar",scale:"m",indicator:s===a.Diagram||void 0,disabled:!!f(a.Diagram)||void 0,css:t.css`
            --calcite-action-indicator-color: ${r.sys.color.primary.main};
          `,onClick:()=>{s!==a.Diagram&&(u({type:"SET_DISPLAY",value:a.Diagram}),l.length>0&&u({type:"SET_IS_LOADING",value:!0}))}})})]})}var B=I(22089),G=I(68972),U=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function W(a){const i=t.hooks.useTranslation(n),{records:r,selectedRecordIds:s,display:l}=y(),{jimuMapView:u,networkDS:d}=a,[f,p]=G.default.useState(!1);G.default.useEffect(()=>{0===s.length?p(!1):p(!0)},[s,l]);return(0,e.jsx)(o.Tooltip,{placement:"auto",title:i("ZoomLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)(P.CalciteAction,{text:i("ZoomLabel"),icon:"zoom-to-object",scale:"m",onClick:()=>U(this,void 0,void 0,function*(){const e=yield(0,t.loadArcGISJSAPIModule)("esri/geometry/operators/unionOperator"),n=[],a=d.layerDefinition.objectIdField;s&&s.length>0&&r.forEach(e=>{const t=null==e?void 0:e.attributes[a];s.includes(t)&&n.push(e.geometry)});const i=e.executeMany(n);c.geometryUtils.projectToSpatialReference([i],u.view.spatialReference).then(e=>{var t;const n=new B.default({geometry:e[0]});if("point"===(null===(t=null==n?void 0:n.geometry)||void 0===t?void 0:t.type))null==u||u.view.goTo({target:e,zoom:100});else{const e=n.geometry.extent.expand(1.25);null==u||u.view.goTo({center:e})}})}),disabled:!f||void 0})})}var H=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};const q=["long","big-integer","integer","single","double","small-integer"],J=["global-id","guid","string"];function Y(a){const{dynSegFeatureLayer:i,widgetId:r,routeId:s,jimuMapView:l}=a,c=t.hooks.useTranslation(n),{records:u,display:f}=y(),[p,m]=t.React.useState(!1);t.React.useEffect(()=>{0===(null==u?void 0:u.length)?m(!1):m(!0)},[u,f]);const g=e=>{let n;return q.includes(e.type)?n=t.JimuFieldType.Number:"date"===e.type?n=t.JimuFieldType.Date:J.includes(e.type)&&(n=t.JimuFieldType.String),n?{jimuName:e.name,name:e.name,type:n,esriType:e.type,alias:e.alias,format:"oid"===e.type?{digitSeparator:!1,places:0}:null}:null},h=e=>{if(!e)return null;const t={};return e.forEach(e=>{const n=g(e);n&&n.name&&(t[e.name]=n)}),t},v=()=>{const e=h(i.fields);return Object.keys(e)},b=()=>{const e=(e=>{if(!e)return null;const t={};return e.forEach(e=>{const n=g(e);n&&n.name&&(t[e.alias]=n)}),t})(i.fields);return Object.keys(e)};return(0,e.jsx)(t.React.Fragment,{children:(0,e.jsxs)(o.Dropdown,{className:"float-right",direction:"down",size:"sm",useKeyUpEvent:!0,children:[(0,e.jsx)(o.DropdownButton,{icon:!0,arrow:!1,size:"sm",type:"link",children:(0,e.jsx)(o.Tooltip,{placement:"auto",title:c("exportLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)(P.CalciteAction,{text:c("exportLabel"),icon:"export",scale:"m",disabled:!p||void 0})})}),(0,e.jsxs)(o.DropdownMenu,{children:[(0,e.jsx)(o.DropdownItem,{onClick:()=>{t.DataSourceManager.getInstance().createDataSource((0,t.Immutable)({id:"downloadCsv_layer"+(new Date).getTime(),type:t.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:s+"_dynseg_export",schema:{idField:(0,d.findFieldByType)(i.fields,"oid"),fields:Object.assign({},h(i.fields))},geometryType:"esriGeometryPolyline"})).then(e=>{const n=[];u.forEach(t=>{const a=e.buildRecord(t);n.push(a)});const a={records:n,dataSource:e,name:c("dynamicSeg"),fields:v()};t.DataActionManager.getInstance().getSupportedActions(r,[a],t.DataLevel.Records).then(e=>H(this,void 0,void 0,function*(){const n=e.export;if((null==n?void 0:n.length)>0){const e=n.filter(e=>"export-csv"===e.id);yield t.DataActionManager.getInstance().executeDataAction(e[0],[a],t.DataLevel.Records,r)}})).catch(e=>{console.error(e)})})},children:c("exportCsv")}),(0,e.jsx)(o.DropdownItem,{onClick:()=>{t.DataSourceManager.getInstance().createDataSource((0,t.Immutable)({id:"downloadJson_layer"+(new Date).getTime(),type:t.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:s+"_dynseg_export",schema:{idField:(0,d.findFieldByType)(i.fields,"oid"),fields:Object.assign({},h(i.fields))},geometryType:"esriGeometryPolyline"})).then(e=>{const n=[],a=(()=>{const e=i.fields,t={};return e.forEach(e=>{t[e.name]=e.alias}),t})();u.forEach(t=>{const i=t.clone(),r=i.attributes;Object.keys(r).forEach(e=>{const t=a[e];r[t]=r[e],delete r.key});const o=e.buildRecord(i);n.push(o)});const o={records:n,dataSource:e,name:c("dynamicSeg"),fields:b()};t.DataActionManager.getInstance().getSupportedActions(r,[o],t.DataLevel.Records).then(e=>H(this,void 0,void 0,function*(){const n=e.export;if((null==n?void 0:n.length)>0){const e=n.filter(e=>"export-json"===e.id);yield t.DataActionManager.getInstance().executeDataAction(e[0],[o],t.DataLevel.Records,r)}})).catch(e=>{console.error(e)})})},children:c("exportJson")}),(0,e.jsx)(o.DropdownItem,{onClick:()=>{t.DataSourceManager.getInstance().createDataSource((0,t.Immutable)({id:"downloadGeoJson_layer"+(new Date).getTime(),type:t.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,sourceLabel:s+"_dynseg_export",schema:{idField:(0,d.findFieldByType)(i.fields,"oid"),fields:Object.assign({},h(i.fields))},geometryType:"esriGeometryPolyline"})).then(e=>H(this,void 0,void 0,function*(){const n=[],a=u,i=l.view.spatialReference,o=yield(0,t.loadArcGISJSAPIModule)("esri/geometry/projection");o.load().then(()=>{a.forEach(e=>{"Point"===e.attributes[w.typeName]&&(e.geometry=null)}),a.forEach(e=>{e.geometry&&(e.geometry=o.project(e.geometry,i))}),a.forEach(t=>{const a=e.buildRecord(t);n.push(a)});const s={records:n,dataSource:e,name:c("dynamicSeg"),fields:v()};t.DataActionManager.getInstance().getSupportedActions(r,[s],t.DataLevel.Records).then(e=>H(this,void 0,void 0,function*(){const n=e.export;if((null==n?void 0:n.length)>0){const e=n.filter(e=>"export-geojson"===e.id);yield t.DataActionManager.getInstance().executeDataAction(e[0],[s],t.DataLevel.Records,r)}})).catch(e=>{console.error(e)})})}))},children:c("exportGeoJson")})]})]})})}function Z(a){const i=t.hooks.useTranslation(n),{fieldInfo:r,display:s}=y(),[l,c]=t.React.useState(!0);return t.React.useEffect(()=>{r&&0!==r.length?c(void 0):c(!0)},[r,s]),(0,e.jsx)(o.Tooltip,{placement:"auto",title:i("fieldCalculatorLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)(P.CalciteAction,{disabled:l,text:i("fieldCalculatorLabel"),icon:"calculator",scale:"m",id:"field-calculator"})})}function Q(a){const i=t.hooks.useTranslation(n),{dynSegFeatureLayer:r}=a,{pendingEdits:s,originalRecords:l}=y(),c=v();return(0,e.jsx)(o.Tooltip,{placement:"auto",title:i("discardEdits"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)(P.CalciteAction,{text:i("discardEdits"),icon:"read-only-non-editable",scale:"m",onClick:()=>{if(s){c({type:"SET_RECORDS",value:l}),c({type:"SET_EDITS",value:new Map}),c({type:"SET_ERROR_COUNT",value:0});const e={updateFeatures:l};r.applyEdits(e)}},disabled:!(s.size>0)||void 0})})}var K=I(49419),X=I.n(K),ee=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(n[a[i]]=e[a[i]])}return n};const te=n=>{const a=window.SVG,{className:i}=n,r=ee(n,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:o,src:X()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};function ne(a){const i=t.hooks.useTranslation(n),{fieldInfo:r,display:s}=y(),{networkDS:l}=a,c=v(),[u,d]=t.React.useState(),[f,p]=t.React.useState([]),[m,g]=t.React.useState([]),[h,b]=t.React.useState(!0);t.React.useEffect(()=>{const e=w();d(e),p(e),g(r),r&&0!==r.length?b(!1):b(!0)},[r,s]);const w=()=>{const e=[];return r&&0!==r.length?(r.forEach(t=>{if(t.isEventIdField||t.isOidField||t.exclude);else{const n={label:t.featureFieldAlias,value:t.featureFieldAlias};e.push(n)}}),e):[]},S=e=>{m.forEach(e=>{e.visible=!0}),g(m);const t=e,n=f.filter(e=>!t.some(t=>t.value===e.value)),a=m;n.forEach(e=>{const t=e.value;a.find(e=>e.featureFieldAlias===t).visible=!1}),c({type:"SET_FIELD_INFO",value:a})},x=t.css`
    .advance-select-lrs,
    .advance-select-lrs .jimu-dropdown,
    .advance-select-lrs .jimu-dropdown button {
      padding: 0;
      margin: 0;
      border: none;
    }

    .advance-select-lrs,
    .advance-select-lrs .jimu-dropdown {
      padding: 0;
      margin: 0;
      border: none;
      height: 100%;
    }

    .advance-select-lrs .jimu-dropdown button  {
      padding-inline: 1rem;
    }

    .advance-select-lrs .jimu-dropdown button: disabled{
      background-color: transparent;
      color: #6a6a6a;
      opacity: 0.5;
    }

  `;return(0,e.jsx)("span",{css:x,children:l&&(0,e.jsx)(o.AdvancedSelect,{className:"advance-select-lrs",size:"sm",title:i("showFields"),dataSource:l,sortList:!1,selectedValues:u,isMultiple:!0,icon:!0,arrow:!1,disabled:h,strategy:"absolute",customDropdownButtonContent:()=>(0,e.jsx)(te,{}),onChange:e=>{e&&0!==e.length?(d(e),S(e)):(m.forEach(e=>{e.visible=!1}),g(m),c({type:"SET_FIELD_INFO",value:m}),d([]))},staticValues:w()})})}function ae(a){const i=t.hooks.useTranslation(n),r=(0,$.getTheme)(),[s,l]=G.default.useState(!0),c=v(),{syncToMap:u}=y();return(0,e.jsx)(o.Tooltip,{placement:"auto",title:i("mapInteractLabel"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)(P.CalciteAction,{indicator:u,css:t.css`--calcite-action-indicator-color: ${r.sys.color.primary.main};`,text:i("mapInteractLabel"),icon:"browser-map",scale:"m",onClick:()=>{(()=>{const e=!s;l(e),c({type:"SET_SYNC_TO_MAP",value:e})})()}})})}var ie=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function re(n){const{routeInfo:i,intl:r,routeId:o,allowMerge:s,allowEditing:l,widgetId:c,jimuMapView:u,highlightColor:f,lrsLayers:p,networkDS:m,networkInfo:g,dynSegFeatureLayer:h,onSave:v,attributeSet:b}=n,{records:S,selectedRecordIds:x,selectedSldId:I,display:D,highlightLayer:N}=y();return t.React.useEffect(()=>{!function(e){(0,d.isDefined)(N)&&(N.removeAll(),(0,d.isDefined)(S)&&(0,d.isDefined)(e)&&e.forEach(e=>ie(this,void 0,void 0,function*(){const t=S.find(t=>t.getObjectId()===e);if((0,d.isDefined)(t)){j(u,N);const e="Point"===t.attributes[w.typeName],n=yield(0,d.getGeometryGraphic)(t,f,4,!e);N.add(n)}})))}(x)},[x]),t.React.useEffect(()=>{""===I&&(0,d.isDefined)(N)&&N.removeAll(),0===x.length&&(0,d.isDefined)(N)&&N.removeAll()},[I,x]),(0,e.jsxs)(P.CalciteActionBar,{slot:"header-actions-end",layout:"horizontal",scale:"m",className:"header-actions",expandDisabled:!0,children:[(0,e.jsx)(z,{}),(0,e.jsxs)(P.CalciteActionGroup,{scale:"m",children:[l&&(0,e.jsx)(V,{lrsLayers:p,networkDS:m,networkInfo:g,onSave:v,allowMerge:s}),D===a.Diagram&&(0,e.jsx)(ae,{routeInfo:i,networkDS:m,networkInfo:g,jimuMapView:u}),D===a.Table&&l&&(0,e.jsx)(Q,{dynSegFeatureLayer:h}),D===a.Table&&(0,e.jsx)(W,{jimuMapView:u,networkDS:m}),D===a.Table&&(0,e.jsx)(ne,{networkDS:m}),D===a.Table&&l&&(0,e.jsx)(Z,{intl:r,attributeSet:b,lrsLayers:p,dynSegFeatureLayer:h}),D===a.Table&&(0,e.jsx)(Y,{dynSegFeatureLayer:h,widgetId:c,routeId:o,jimuMapView:u})]})]})}function oe(n){const{open:a,messageProp:i,onClose:r}=n;t.React.useEffect(()=>{let e=null==i?void 0:i.time;e||(e=5e3),a&&setTimeout(()=>{r()},e)},[a,r,null==i?void 0:i.time]);return(0,e.jsx)("div",{className:"toast-container h-100 w-100 d-flex",children:(0,e.jsx)("div",{className:"toast m-auto",children:(0,e.jsxs)(P.CalciteNotice,{className:"toast-notice",kind:i.type,closable:!0,icon:(e=>{switch(e){case"brand":default:return"information";case"success":return"checkCircle";case"error":case"danger":case"warning":return"exclamationMarkTriangle"}})(i.type),open:!0,scale:"m",onCalciteNoticeClose:()=>{r()},children:[(0,e.jsx)("div",{slot:"title",children:i.title}),(0,e.jsxs)("div",{slot:"message",children:[(0,e.jsx)("span",{children:i.body}),i.details&&(0,e.jsx)("div",{children:(0,e.jsx)("span",{children:i.details})})]})]})})})}function se(a){const{fieldInfo:i}=a,r=t.hooks.useTranslation(n);return(0,e.jsxs)(P.CalciteTableRow,{slot:"table-header",className:"dyn-seg-table-header",children:[(0,e.jsx)(P.CalciteTableHeader,{heading:r("measureRange"),className:"dyn-seg-column-header"}),i.map((t,n)=>t.visible&&!t.exclude?(0,e.jsx)(P.CalciteTableHeader,{heading:t.originalFieldAlias,description:t.eventAlias,className:"dyn-seg-column-header"},n):null)]})}var le=I(28996),ce=I.n(le),ue=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function de(e,n,a){if(!(0,d.isDefined)(e))return[];const i=t.DataSourceManager.getInstance(),o=new Set,s=new Map;n.forEach(e=>{if(e.eventInfo){o.add(e.eventInfo.eventIdFieldName);const t=i.getDataSource(e.useDataSource.dataSourceId);s.set(e.eventInfo.datasetName,t.getIdField())}});const l=[],c=e.fields;let u=0;return c.forEach(e=>{var t,i,c,f,p,m,g,h,y;if(e.alias.includes(".")){if(e.alias.includes(".")){const v=e.alias.split(".")[0],b=e.alias.split(".")[1],w=n.find(e=>(0,d.isDefined)(e.eventInfo)&&e.eventInfo.datasetName===v),S=null===(i=null===(t=w.eventInfo)||void 0===t?void 0:t.attributeFields)||void 0===i?void 0:i.find(e=>e.field.name===b),x=null===(f=null===(c=w.eventInfo)||void 0===c?void 0:c.lrsFields)||void 0===f?void 0:f.find(e=>e.name===b),I=o.has(b),D=s.get(null===(p=null==w?void 0:w.eventInfo)||void 0===p?void 0:p.datasetName)===b,N={index:u,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:v,eventAlias:null===(m=w.eventInfo)||void 0===m?void 0:m.datasetName,originalFieldName:b,originalFieldAlias:(0,d.isDefined)(S)?null===(g=null==S?void 0:S.field)||void 0===g?void 0:g.alias:null==x?void 0:x.alias,eventLayerId:w.serviceId.toString(),visible:!0,exclude:I||D,editable:!I&&!D,EventType:(null===(h=w.eventInfo)||void 0===h?void 0:h.isPointEvent)?r.Point:r.Line,isSubtypeField:fe(w.serviceId.toString(),e.name,a),isEventIdField:(null===(y=w.eventInfo)||void 0===y?void 0:y.eventIdFieldName)===b,isOidField:D,displayField:w.displayField};l.push(N)}}else if(e.alias===w.typeAlias){const t={index:u,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:"",originalFieldName:e.alias,eventLayerId:"",visible:!0,exclude:!1,editable:!1,EventType:r.Undefined,isSubtypeField:!1,isEventIdField:!1,isOidField:!1,displayField:"",originalFieldAlias:e.alias,eventAlias:""};l.push(t)}else{const t={index:u,featureFieldName:e.name,featureFieldAlias:e.alias,eventName:"",originalFieldName:e.alias,eventLayerId:"",visible:!1,exclude:!0,editable:!1,EventType:r.Undefined,isSubtypeField:!1,isEventIdField:!1,isOidField:!1,displayField:"",originalFieldAlias:"",eventAlias:""};l.push(t)}u++}),l}function fe(e,t,n){if(!(0,d.isDefined)(n))return!1;const a=n.find(t=>t.id===e);return!!(0,d.isDefined)(a)&&(!!(0,d.isDefined)(a.subtypeField)&&a.subtypeField.toUpperCase()===t.toUpperCase())}function pe(e,t,n,a){const i=new Map;return e.forEach(e=>{e.eventName===n&&(e.isOidField?a&&i.set(e.featureFieldName,t.attributes[e.featureFieldName]):i.set(e.originalFieldName,t.attributes[e.featureFieldName]))}),i.set(w.routeIdName,t.attributes[w.routeIdName]),i.set(w.fromDateName,t.attributes[w.fromDateName]),i.set(w.toDateName,t.attributes[w.toDateName]),i.set(w.fromMeasureName,t.attributes[w.fromMeasureName]),i.set(w.toMeasureName,t.attributes[w.toMeasureName]),i}function me(e,t,n,a){const i=new Map;if(t.isSubtypeField){const r=a.find(e=>e.id===t.eventLayerId);if((0,d.isDefined)(r)&&(0,d.isDefined)(r.subtypes)){const t=r.subtypes.find(t=>t.code===e).defaultValues;if((0,d.isDefined)(t))return Object.keys(t).forEach(e=>{if(e in n.attributes){n.attributes[e]!==t[e]&&i.set(e,t[e])}}),i}}return i}function ge(e,t){return`${e.attributes[w.objectIdName]}.${t}`}var he=I(46942),ye=I.n(he),ve=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function be(a){const{intl:i,featureLayer:s,allowEditing:l,record:c,fieldInfo:u,subTypeInfo:f,layerMap:p,fieldGroups:m,contingentValues:g,networkDS:h,updateRecord:b}=a,[S,x]=t.React.useState(c.attributes[u.featureFieldName]),[I,D]=t.React.useState(c.attributes[u.featureFieldName]),[N,M]=t.React.useState(c.attributes[u.featureFieldName]),[k,L]=t.React.useState(!1),[E,R]=t.React.useState(""),[T,C]=t.React.useState(!1),[j,F]=t.React.useState(!1),O=t.React.useRef(null),[A,_]=t.React.useState([]),[V,$]=t.React.useState([]),{errorCount:z,pendingEdits:B}=y(),G=v();t.React.useEffect(()=>{0===z&&se("")},[z]);const U=t.React.useMemo(()=>{const e=s.fields.find(e=>e.name===u.featureFieldName);return e||null},[s,u]),W=t.React.useMemo(()=>s.fields.filter(e=>e.alias.includes(".")&&e.alias.split(".")[0]===u.eventName),[s,u]),H=t.React.useMemo(()=>{const e=f.find(e=>e.id===u.eventLayerId);return(0,d.isDefined)(e)?c.attributes[e.subtypeField]:NaN},[f,u,c]),q=t.React.useMemo(()=>{const e=p.get(u.eventLayerId),t=m.get(u.eventLayerId),n=g.get(u.eventLayerId);return(0,d.setContingentValues)(n,t,e,H)},[p,m,g,u,H]),J=t.React.useMemo(()=>{if((0,d.isDefined)(U)&&(0,d.isDefined)(U.domain)&&"coded-value"===U.domain.type){const e=U.domain.codedValues.some(e=>null===e.code&&"null"===e.name);return U.nullable&&!e&&U.domain.codedValues.unshift({code:null,name:"null"}),U.domain}return null},[U]),Y=t.React.useMemo(()=>{const e=f.find(e=>e.id===u.eventLayerId);if((0,d.isDefined)(e)&&(0,d.isDefined)(e.subtypes)){const t=e.subtypes.map(e=>({value:e.code,label:e.name}));if(t)return t}return[]},[f]),Z=t.React.useMemo(()=>u.isSubtypeField?"subtype":(0,d.isDefined)(U.domain)&&(0,d.isCodedDomain)(U.domain.type)?"domain":(0,d.isDefined)(U.domain)&&(0,d.isRangeDomain)(U.domain.type)?"range":(0,d.isDate)(U.type)?"date":(0,d.isNumber)(U.type)?"number":"text",[u,U]),Q=t.React.useMemo(()=>{if(U.editable&&u.editable&&(0,d.isDefined)(c)){if(!l)return!1;const e=c.attributes[w.typeName];return("Point"!==e||u.EventType!==r.Line)&&("Line"!==e||u.EventType!==r.Point)}},[U,u]),K=t.React.useMemo(()=>E.length>0,[E]),X=t.React.useMemo(()=>!(!(0,d.isDefined)(N)&&""===S)&&(S!==N&&0===E.length),[N,S,E]);t.React.useEffect(()=>{if((0,d.isDefined)(c)&&(0,d.isDefined)(u))if((0,d.isDate)(U.type)){const e=(0,d.getDateWithTZOffset)(c.attributes[u.featureFieldName],h);M(e?e.valueOf():null)}else M(c.attributes[u.featureFieldName])},[]),t.React.useEffect(()=>{const e=new IntersectionObserver(([e])=>{C(e.isIntersecting)},{root:null,rootMargin:"0px",threshold:0});return O.current&&e.observe(O.current),()=>{O.current&&e.unobserve(O.current)}}),t.React.useEffect(()=>{function e(e){O.current&&!O.current.contains(e.target)&&F(!1)}if(j)return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[j,O]),t.React.useEffect(()=>{if((0,d.isDefined)(c)&&(0,d.isDefined)(u))if((0,d.isDate)(U.type)){const e=(0,d.getDateWithTZOffset)(c.attributes[u.featureFieldName],h);x(e?e.valueOf():null)}else x(c.attributes[u.featureFieldName])},[c,u]),t.React.useEffect(()=>{const e=(0,d.getContingentOptions)(u.originalFieldName,q),t=function(e,t,n,a){const i=[];if(!(0,d.fieldsWithContingentValues)(e).has(a))return[];if(!e||0===e.length)return[];const r=[];if((null==e?void 0:e.length)>0)for(const o of e){const e=null==o?void 0:o.contingencies,s=null==o?void 0:o.fields;if(e&&(null==s?void 0:s.includes(a)))for(const o of e){let e=null,s=!1;const l=Object.keys(o.values);null==l||l.forEach(i=>{const r=o.values[i];if(i===a)"code"===r.objectType&&(e=r.codedValue.code);else if("code"===r.objectType){const e=r.codedValue.code;t.some(t=>{if(t.alias.split(".")[1]===i){const a=n.attributes[t.name];return(a===e||null===a)&&(s=!0),!0}return!1})}}),null!==e&&(s?i.push(e):r.push(e))}}return i}(q,W,c,u.originalFieldName);_(e),$(t)},[W,q,u,c]),t.React.useEffect(()=>{if(q.length>0){const e=ge(c,u.eventName),t=B.get(e);if((0,d.isDefined)(t)){const e=(0,d.validateContingencyConstraints)(-1,"",-1,null,q,c,W);if(e.length>0){const t=[];for(let n=0;n<(null==e?void 0:e.length);n++){const a=e[n];t.push(null==a?void 0:a.fieldGroup)}null==t||t.forEach(e=>{const t=null==e?void 0:e.fields;(null==t?void 0:t.find(e=>e===(null==u?void 0:u.originalFieldName)))&&(se((0,d.formatMessage)(i,"contingentValueError",n)),L(!0))})}else k&&(se(""),L(!1))}}},[B,c]);const ee=(e,t)=>(0,d.isDefined)(t)?`${t} - ${e}`:e,te=()=>{if((0,d.isDefined)(S)){const e=Y.find(e=>"string"==typeof e.value&&"string"==typeof S?e.value.toLowerCase()===S.toLowerCase():e.value===S);return(0,d.isDefined)(e)?ee(e.label):""}return""},ne=()=>{if((0,d.isDefined)(S)){const e=J.codedValues.find(e=>"string"==typeof e.code&&"string"==typeof S?e.code.toLowerCase()===S.toLowerCase():e.code===S);return(0,d.isDefined)(e)?ee(e.name):""}return""},ae=()=>U.name===w.typeName?"75px":"125px",ie=j&&(0,d.isDefined)(U.domain)&&"domain"===Z,re=e=>{e.target.value!==S&&(x(e.target.value),ue(e.target.value,""))},oe=(e,t)=>ve(this,void 0,void 0,function*(){const t=c.clone(),n=me(e,u,t,f);n.size>0?n.forEach((e,n)=>{t.attributes[n]=e}):t.attributes[u.featureFieldName]=e;const a={updateFeatures:[t]};yield s.applyEdits(a).then(e=>{e.updateFeatureResults.length>0&&(e.updateFeatureResults[0].error?se(e.updateFeatureResults[0].error.message):b(t,u))}).catch(e=>{se(e.message)})}),se=e=>{const t=E.length>0;let n=z;t&&0===e.length&&n--,!t&&e.length>0&&n++,G({type:"SET_ERROR_COUNT",value:n}),R(e)},le=e=>{x(e)},ue=(e,t)=>{oe(e),D(e),F(!1)};return(0,e.jsx)(P.CalciteTableCell,{className:ye()("dyn-seg-cell",X?"edited":"",Q?"":"non-editable",K?"error":""),children:(0,e.jsx)("div",{ref:O,style:{minWidth:ae(),maxWidth:"224px"},children:T&&(0,e.jsxs)("div",{className:"dyn-seg-cell-content h-100 d-flex",tabIndex:-1,children:[!j&&(0,e.jsxs)("div",{onDoubleClick:()=>{Q&&F(!0)},className:"d-flex",children:[(0,e.jsx)(o.Label,{size:"sm",className:"text-truncate w-100 label2",style:{textOverflow:"ellipse",minWidth:ae(),maxWidth:"200px",textWrap:"nowrap",marginBottom:0,alignItems:"center",textAlign:"left"},children:(()=>{switch(Z){case"subtype":return te();case"domain":return ne();case"date":return(0,d.isDefined)(S)?new Date(S).toLocaleDateString():"";case"range":case"number":case"text":return(0,d.isDefined)(S)?S.toString():"";default:return""}})()}),E.length>0&&(0,e.jsx)(o.Icon,{icon:ce(),size:16,title:E,color:"red",style:{alignSelf:"center",marginLeft:"4px",marginRight:"4px"}})]}),j&&"text"===Z&&(0,e.jsx)(o.TextInput,{size:"sm",style:{minWidth:ae()},className:"w-100",autoFocus:!0,required:!U.nullable,value:S,type:"text",onChange:e=>{le(e.currentTarget.value)},checkValidityOnAccept:e=>{let t=e;if("number"===Z&&(t=parseFloat(e)),N===t||I===S)return E.length>0&&se(""),Promise.resolve({valid:!0});const a=E.length>0,r=(0,d.validateField)(e,u.featureFieldName,void 0,U);return r.hasError?a?Promise.resolve({valid:!1,msg:r.message}):(se((0,d.formatMessage)(i,r.message,n)),ue(t,(0,d.formatMessage)(i,r.message,n)),Promise.resolve({valid:!1,msg:(0,d.formatMessage)(i,r.message,n)})):(se(""),ue(t,""),Promise.resolve({valid:!0}))}}),j&&"number"===Z&&(0,e.jsx)(o.NumericInput,{size:"sm",style:{minWidth:ae()},className:"w-100",autoFocus:!0,showHandlers:!1,required:!U.nullable,value:S,onAcceptValue:e=>{e!==S&&(x(e),ue(e,""))}}),j&&"date"===Z&&(0,e.jsx)(P.CalciteInputDatePicker,{scale:"s",style:{minWidth:ae()},valueAsDate:(0,d.isDefined)(S)?new Date(S):null,onCalciteInputDatePickerChange:e=>{var t;const a=null===(t=e.target)||void 0===t?void 0:t.valueAsDate,r=(0,d.getDateWithoutTZOffset)(a.valueOf(),h).valueOf();if(N===r)return E.length>0&&se(""),{valid:!0};const o=E.length>0,s=(0,d.validateField)(a,u.featureFieldName,void 0,U);return s.hasError?o?{valid:!1,msg:s.message}:(se((0,d.formatMessage)(i,s.message,n)),ue(r,(0,d.formatMessage)(i,s.message,n)),{valid:!1,msg:(0,d.formatMessage)(i,s.message,n)}):(se(""),ue(r,""),{valid:!0})},placement:"top",overlayPositioning:"fixed",focusTrapDisabled:!0}),j&&"domain"===Z&&(0,e.jsx)(o.Select,{size:"sm",className:"w-100",style:{minWidth:ae()},value:S,onChange:e=>{re(e)},children:(()=>{var t;if(ie)return(null==A?void 0:A.length)>0?A.map((t,n)=>{var a;const i=(a=t.code,!(!V||!V.includes(a)))?{}:{color:"#a0a0a0",background:"#d5d5d5"};return(0,e.jsx)("option",{value:t.code,style:i,children:ee(t.name,t.code)},n)}):null===(t=null==J?void 0:J.codedValues)||void 0===t?void 0:t.map((t,n)=>(0,e.jsx)("option",{value:t.code,children:ee(t.name,t.code)},n))})()}),j&&"subtype"===Z&&(0,e.jsx)(o.Select,{size:"sm",style:{minWidth:ae()},className:"w-100",value:S,onChange:e=>{re(e)},children:Y.map((t,n)=>(0,e.jsx)("option",{value:t.value,children:ee(t.label,t.value)},n))}),j&&"range"===Z&&(0,e.jsx)(o.TextInput,{size:"sm",className:"w-100",style:{minWidth:ae()},autoFocus:!0,required:!U.nullable,value:S,onChange:e=>{le(e.currentTarget.value)},checkValidityOnAccept:e=>{if((0,d.isNumber)(U.type)&&(e=parseFloat(e)),N===e||I===S)return E.length>0&&se(""),{valid:!0};const t=E.length>0,a=(0,d.validateRangeDomain)(e,u.featureFieldName,void 0,U);return a.hasError?t?{valid:!1,msg:a.message}:(se((0,d.formatMessage)(i,a.message,n)),ue(e,(0,d.formatMessage)(i,a.message,n)),{valid:!1,msg:(0,d.formatMessage)(i,a.message,n)}):(se(""),ue(e,""),{valid:!0})}})]})})})}var we=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function Se(e,t,n){return we(this,void 0,void 0,function*(){const a=yield(0,d.QueryLock)(t,e,!1);let i;if((0,d.shouldTryAcquireLock)(t,a)){if(i=yield(0,d.acquireLock)(t,a),i.acquireStatus===d.LockAcquireStatus.EsriReconcileRequired){if(!(yield(0,d.tryAutoReconcile)(t)))return xe(i,e,t,n);i=yield(0,d.acquireLock)(t,a)}return xe(i,e,t,n)}if(a.status!==d.LockAcquireStatus.EsriSuccess)return xe(i,e,t,n)})}function xe(e,t,n,a){var i;let r="",o="info",s="";const l=null===(i=null==t?void 0:t.details[0])||void 0===i?void 0:i.lrsNetworkName,c=(0,d.getGDBVersion)(n);switch(e.acquireStatus){case d.LockAcquireStatus.EsriSuccess:s=""!==(f=t.routeInfo).lineId&&""===f.lineName?f.lineId:""!==f.lineId&&""!==f.lineName?f.lineName:""!==f.routeName?f.routeName:f.routeId,r=""!==t.routeInfo.lineId?(0,d.formatMessage)(a,"YouAcquiredLockOnLine",{nameOrId:s,networkName:l,version:c}):(0,d.formatMessage)(a,"YouAcquiredLockOnRoute",{nameOrId:s,networkName:l,version:c}),o="info";break;case d.LockAcquireStatus.EsriReconcileRequired:r=(0,d.formatMessage)(a,"ReconcileRequired"),o="danger";break;case d.LockAcquireStatus.EsriCouldNotAcquireAllLocks:const n=e.unavailableLocks[0].versionName,i=e.unavailableLocks[0].user;u=e.unavailableLocks[0],s=(0,d.isDefined)(u.routeName)&&""!==u.routeName?u.routeName:(0,d.isDefined)(u.lineName)&&""!==u.lineName?u.lineName:(0,d.isDefined)(u.routeId)&&""!==u.routeId?u.routeId:(0,d.isDefined)(u.lineId)&&""!==u.lineId?u.lineId:void 0,r=""===n?""!==t.routeInfo.lineId?(0,d.formatMessage)(a,"UnavailableLockOnLineWithoutVersion",{nameOrId:s,networkName:l,lockUser:i}):(0,d.formatMessage)(a,"UnavailableLockOnRouteWithoutVersion",{nameOrId:s,networkName:l,lockUser:i}):""!==t.routeInfo.lineId?(0,d.formatMessage)(a,"UnavailableLockOnLine",{nameOrId:s,networkName:l,lockUser:i,version:n}):(0,d.formatMessage)(a,"UnavailableLockOnRoute",{nameOrId:s,networkName:l,lockUser:i,version:n}),o="danger";break;default:r="",o="info"}var u,f;return{toastMsg:r,toastMsgType:o,toastOpen:open}}function Ie(e,t,n){return we(this,void 0,void 0,function*(){var a;const i=e.routeIdFieldSchema.name,r=e.lineIdFieldSchema.name;let o="";const s=[t];s.length>0&&(o=i+" IN ('"+s.join("','")+"')");const l={where:o,outFields:["*"]},c=yield n.query(l);if(0===(null===(a=null==c?void 0:c.records)||void 0===a?void 0:a.length))return null;return null==c?void 0:c.records[0].feature.attributes[r]})}function De(e,t){const n=`TIMESTAMP '${Ne(e,t).toISOString().slice(0,10)}'`;return`(((${w.fromDateName.toUpperCase()} <= ${n}) AND (${w.toDateName.toUpperCase()} IS NULL)) OR ((${w.fromDateName.toUpperCase()} IS NULL) AND (${w.toDateName.toUpperCase()} >= ${n})) OR ((${w.fromDateName.toUpperCase()} < ${n}) AND (${w.toDateName.toUpperCase()} > ${n})))`}function Ne(e,t){if((0,d.isDefined)(t))return t;if((0,d.isDefined)(e)){const t=e.getCurrentQueryParams().time;let n=new Date(Date.now());return t&&(n=new Date(t[0])),n}return null}function Me(e,t,n,a,i){return we(this,void 0,void 0,function*(){const r=[],o=[],s=[];if(!t.find(e=>String(e.serviceId)===String(i)))return;let l,c;e.networkInfo.supportsLines?(l=yield Ie(e.networkInfo,n,a),c=!0):(l=n,c=!1),r.includes(l)||(r.push(l),o.push(c),s.push(i));const u={routeId:e.routeId,routeName:e.routeName,fromMeasure:e.fromMeasure,toMeasure:e.toMeasure,fromDate:null,toDate:null,selectedMeasure:NaN,selectedFromDate:null,selectedToDate:null};return{networkId:[e.networkInfo.lrsNetworkId],routeOrLineId:r,eventServiceLayerIds:s,isLine:o,status:d.LockAcquireStatus.EsriSuccess,details:[],routeInfo:u,lockAction:d.LockAction.Query}})}var ke=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function Le(n){const{networkDS:a,intl:i,routeId:r,allowEditing:s,lrsLayers:l,currentRouteInfo:c,rowIndex:u,handleLockToast:f,featureLayer:p,record:m,rangeHeader:g,fieldInfos:h,lastIndex:b,subTypeInfo:w,layerMap:S,fieldGroups:x,contingentValues:I}=n,[D,N]=t.React.useState(!1),[M,k]=t.React.useState(m),{pendingEdits:L,selectedRecordIds:E,conflictPreventionEnabled:R}=y(),T=v();t.React.useEffect(()=>{if(L.size>0){let e=!1;if(h.forEach(t=>{const n=ge(m,t.eventName);L.get(n)&&(e=!0)}),e){const e=p.objectIdField+" = "+m.getObjectId();p.queryFeatures({where:e}).then(e=>{k(e.features[0])})}}else k(m)},[L]),t.React.useEffect(()=>{if(E.length>0){const e=E.find(e=>e===m.getObjectId());N(!!(e&&!D||!e&&D)&&(0,d.isDefined)(e))}},[E]),t.React.useEffect(()=>{u===b&&T({type:"SET_IS_LOADING",value:!1})},[]);const C=(e,t)=>{const n=ge(t,e.eventName),a=L.get(n),i=pe(h,t,e.eventName,!1),r=new Map(L);if((0,d.isDefined)(a))a.attributes=i,r.set(n,a);else{const t={layerId:e.eventLayerId,attributes:i};r.set(n,t)}T({type:"SET_EDITS",value:r})},j=(e,t)=>ke(this,void 0,void 0,function*(){let n;if(R){const o=yield Me(c,l,r,a,t.eventLayerId),s=a;if(n=yield Se(o,s,i),n){const a={title:n.toastMsg,body:"",type:n.toastMsgType};f(a,!1),C(t,e),k(e)}else{f({title:"Field updated successfully",body:"",type:"success"},!1),C(t,e),k(e)}}else C(t,e),k(e)});return(0,e.jsxs)(P.CalciteTableRow,{className:"dyn-seg-row",onClick:e=>{e.stopPropagation();let t=[...E];if(e.shiftKey){const e=t[t.length-1],n=m.getObjectId();if(e<n){Array.from({length:n-e+1},(t,n)=>n+e).forEach(e=>{const n=t.findIndex(e=>e===m.getObjectId());-1===n&&t.push(e)})}else if(e>n){Array.from({length:e-n+1},(e,t)=>t+n).forEach(e=>{const n=t.findIndex(e=>e===m.getObjectId());-1===n&&t.push(e)})}}else if(e.ctrlKey){const e=t.findIndex(e=>e===m.getObjectId());e>-1?t.splice(e,1):t.push(m.getObjectId())}else{t[t.length-1]===m.getObjectId()?(t=[],N(!1)):t=[m.getObjectId()]}T({type:"SET_SELECTED_RECORD_IDS",value:t})},children:[(0,e.jsx)(P.CalciteTableCell,{className:ye()("dyn-seg-row-header",D?"selected":""),children:(0,e.jsx)("div",{className:"h-100 d-flex",children:(0,e.jsx)(o.Label,{size:"sm",className:"w-100 label2",centric:!0,style:{minWidth:"100px",textWrap:"nowrap",marginBottom:0,textAlign:"left",whiteSpace:"pre"},children:g})})}),h.map((t,n)=>t.visible&&!t.exclude?(0,e.jsx)(be,{intl:i,allowEditing:s,rowIndex:n,fieldInfo:t,featureLayer:p,record:M,subTypeInfo:w,layerMap:S,fieldGroups:x,contingentValues:I,networkDS:a,updateRecord:j},n):null)]})}function Ee(n){const{intl:a,networkDS:i,allowEditing:r,routeId:o,lrsLayers:s,currentRouteInfo:l,networkInfo:c,featureLayer:u,records:d,measureHeaders:f,fieldInfo:p,subTypeInfo:m,layerMap:g,fieldGroups:h,contingentValues:v,handleLockToast:b}=n,{isLoading:w}=y(),S=(0,$.useTheme)();return t.React.useEffect(()=>{if(!w){let e=!1,t=0;for(;!e;){let n=!1,a=!1,i=!1,r=!1,o=!1;setTimeout(()=>{const e=document.querySelector(".dyn-seg-table");if(e&&e.shadowRoot){const t=e.shadowRoot.querySelector(".table-container");t&&(t.style.height="100%",n=!0)}const t=document.querySelector(".dyn-seg-table-header");if(t&&t.shadowRoot){const e=t.shadowRoot.querySelector(".interaction-container");if(e){const t=e.firstChild;t&&t&&t.style&&(t.style.position="sticky",t.style.top="0",t.style.zIndex="10",t.style.backgroundColor=S.sys.color.surface.background,a=!0)}}const s=document.querySelectorAll(".dyn-seg-column-header");s&&s.forEach(e=>{const t=e.shadowRoot.querySelector(".content-cell");t&&"1"===t.ariaColIndex&&(t.style.position="sticky",t.style.left="0",t.style.zIndex="10",i=!0)});const l=document.querySelectorAll(".dyn-seg-row-header");l&&l.forEach(e=>{const t=e.shadowRoot.querySelector(".interaction-container");if(t){const e=t.childNodes[0];e&&e.style&&(e.style.position="sticky",e.style.left="0",e.style.zIndex="5",e.style.userSelect="none")}r=!0});const c=document.querySelectorAll(".dyn-seg-row"),u=c[c.length-1];if(u){const e=u.shadowRoot.querySelector(".interaction-container");if(e){const t=e.lastChild;t&&(t.className="",t.style.borderBlockEnd=`1px solid ${S.sys.color.surface.background};`)}o=!0}},1e3),t++,t>10&&(e=!0),n&&a&&i&&r&&o&&(e=!0)}}},[w]),(0,e.jsxs)(P.CalciteTable,{caption:"Dynamic Segmentation Table",className:"dyn-seg-table",bordered:!0,scale:"s",layout:"auto",style:{height:"100%",width:"100%"},children:[(0,e.jsx)(se,{fieldInfo:p}),d.map((t,n)=>(0,e.jsx)(Le,{intl:a,allowEditing:r,rowIndex:n,featureLayer:u,record:t,rangeHeader:f[n],fieldInfos:p,lastIndex:d.length-1,subTypeInfo:m,layerMap:g,fieldGroups:h,contingentValues:v,networkInfo:c,currentRouteInfo:l,lrsLayers:s,routeId:o,networkDS:i,handleLockToast:b},n))]})}const Re="object"==typeof global&&global&&global.Object===Object&&global;var Te="object"==typeof self&&self&&self.Object===Object&&self;const Ce=Re||Te||Function("return this")();var je=/\s/;const Fe=function(e){for(var t=e.length;t--&&je.test(e.charAt(t)););return t};var Oe=/^\s+/;const Ae=function(e){return e?e.slice(0,Fe(e)+1).replace(Oe,""):e};const Pe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const _e=Ce.Symbol;var Ve=Object.prototype,$e=Ve.hasOwnProperty,ze=Ve.toString,Be=_e?_e.toStringTag:void 0;const Ge=function(e){var t=$e.call(e,Be),n=e[Be];try{e[Be]=void 0;var a=!0}catch(e){}var i=ze.call(e);return a&&(t?e[Be]=n:delete e[Be]),i};var Ue=Object.prototype.toString;const We=function(e){return Ue.call(e)};var He=_e?_e.toStringTag:void 0;const qe=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":He&&He in Object(e)?Ge(e):We(e)};const Je=function(e){return null!=e&&"object"==typeof e};const Ye=function(e){return"symbol"==typeof e||Je(e)&&"[object Symbol]"==qe(e)};var Ze=/^[-+]0x[0-9a-f]+$/i,Qe=/^0b[01]+$/i,Ke=/^0o[0-7]+$/i,Xe=parseInt;const et=function(e){if("number"==typeof e)return e;if(Ye(e))return NaN;if(Pe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Pe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ae(e);var n=Qe.test(e);return n||Ke.test(e)?Xe(e.slice(2),n?2:8):Ze.test(e)?NaN:+e};var tt=1/0;const nt=function(e){return e?(e=et(e))===tt||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const at=function(e){var t=nt(e),n=t%1;return t==t?n?t-n:t:0};const it=function(e,t){for(var n=-1,a=null==e?0:e.length,i=Array(a);++n<a;)i[n]=t(e[n],n,e);return i};const rt=Array.isArray;var ot=_e?_e.prototype:void 0,st=ot?ot.toString:void 0;const lt=function e(t){if("string"==typeof t)return t;if(rt(t))return it(t,e)+"";if(Ye(t))return st?st.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const ct=function(e){return null==e?"":lt(e)};var ut=Ce.isFinite,dt=Math.min;const ft=function(e){var t=Math[e];return function(e,n){if(e=et(e),(n=null==n?0:dt(at(n),292))&&ut(e)){var a=(ct(e)+"e").split("e"),i=t(a[0]+"e"+(+a[1]+n));return+((a=(ct(i)+"e").split("e"))[0]+"e"+(+a[1]-n))}return t(e)}}("round");var pt=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function mt(a){const{intl:i,allowEditing:r,routeId:o,networkDS:s,featureLayer:l,records:c,lrsLayers:u,attributeSet:f,networkInfo:p,currentRouteInfo:m,handleLockToast:g}=a,h=t.hooks.useTranslation(n),[b,w]=t.React.useState(!1),[S,x]=t.React.useState([]),[I,D]=t.React.useState([]),[N,M]=t.React.useState(new Map),[k,L]=t.React.useState(new Map),[E,R]=t.React.useState(new Map),{fieldInfo:C}=y(),j=v();t.React.useEffect(()=>{(0,d.isDefined)(c)?(e=>{j({type:"SET_SELECTED_RECORD_IDS",value:[]}),e.length>0?F():O()})(c):O()},[c]);const F=()=>pt(this,void 0,void 0,function*(){const e=yield T(u,f),t=de(l,u,e),n=yield function(e,t){return ue(this,void 0,void 0,function*(){const n=new Map;return yield Promise.all(t.map(t=>ue(this,void 0,void 0,function*(){const a=e.find(e=>e.serviceId.toString()===t.layerId);(0,d.isDefined)(a)&&(yield(0,d.getLayer)(a.useDataSource).then(e=>{n.set(a.serviceId.toString(),e)}))}))),n})}(u,f),a=A(c,p),i=yield function(e,t,n){return ue(this,void 0,void 0,function*(){const a=new Map;return yield Promise.all(n.map(n=>ue(this,void 0,void 0,function*(){const i=t.find(e=>e.serviceId.toString()===n.layerId),r=e.get(i.serviceId.toString());(0,d.isDefined)(i)&&(0,d.isDefined)(r)&&(yield(0,d.fetchEnterpriseFieldGroup)(r).then(e=>{if((null==e?void 0:e.length)>0){const t=e.map(e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map(e=>(0,d.normalizeFieldName)(null==e?void 0:e.toLocaleUpperCase()))}));a.set(i.serviceId.toString(),t)}}))}))),a})}(n,u,f),r=yield function(e,t,n){return ue(this,void 0,void 0,function*(){const a=new Map;return yield Promise.all(n.map(n=>ue(this,void 0,void 0,function*(){const i=t.find(e=>e.serviceId.toString()===n.layerId),r=e.get(i.serviceId.toString());(0,d.isDefined)(i)&&(0,d.isDefined)(r)&&(yield(0,d.fetchEnterpriseContingentValues)(r).then(e=>{a.set(i.serviceId.toString(),e)}))}))),a})}(n,u,f);x(a),D(e),M(n),L(i),R(r),w(!0),j({type:"SET_FIELD_INFO",value:t}),j({type:"SET_SELECTED_RECORD_IDS",value:[]})}),O=()=>{w(!1),x([]),D([]),M(new Map),L(new Map),R(new Map),j({type:"SET_SELECTED_RECORD_IDS",value:[]}),j({type:"SET_IS_LOADING",value:!1}),j({type:"SET_FIELD_INFO",value:[]})},A=(e,t)=>{if((0,d.isDefined)(e)&&e.length>0){const n=[];return e.forEach(e=>{const a=ft(e.attributes.from_measure,t.measurePrecision).toFixed(t.measurePrecision),i=ft(e.attributes.to_measure,t.measurePrecision).toFixed(t.measurePrecision);n.push(h("measuresRange",{fromM:a,toM:i}))}),n}return[]};return(0,e.jsx)("div",{className:"dyn-seg-table-container h-100 w-100 d-flex",children:b&&(0,e.jsx)(Ee,{intl:i,featureLayer:l,records:c,allowEditing:r,measureHeaders:S,fieldInfo:C,subTypeInfo:I,layerMap:N,fieldGroups:k,contingentValues:E,networkInfo:p,networkDS:s,currentRouteInfo:m,lrsLayers:u,routeId:o,handleLockToast:g})})}var gt=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function ht(e,n,a,i,r,o){return gt(this,void 0,void 0,function*(){const s=new Map;let l=0;n.forEach(e=>{if(""!==e.eventName){const t={index:l++,layerId:e.eventLayerId,layerName:e.eventName,eventType:e.EventType,records:[],visible:!0,isActive:!0};s.set(e.eventName,t)}});let c=0;return e.forEach(e=>{s.forEach(t=>{if(function(e,t,n){let a=!1;const i=wt(e,t,n),r=t.attributes[w.typeName];i&&"Line"===r&&(a=!0);i||"Point"!==r||(a=!0);return a}(n,e,t.layerName,o.mTolerance))return;const s=a.find(e=>(0,d.isDefined)(e.eventInfo)&&e.eventInfo.datasetName===t.layerName),l=n.filter(e=>e.eventName===t.layerName),u=e.attributes[w.fromMeasureName]<r.from?r.from:e.attributes[w.fromMeasureName],f=e.attributes[w.toMeasureName]>r.to?r.to:e.attributes[w.toMeasureName],p={index:c++,objectId:e.attributes[w.objectIdName],attributes:pe(n,e,t.layerName,!0),fromMeasure:u,toMeasure:f,geometry:e.geometry,selected:!1,hasValue:St(n,e,t.layerName),isPoint:wt(n,e,t.layerName),displayField:bt(s.displayField,t.layerId,i),fieldInfos:l};t.records.push(p)})}),yield function(e){return gt(this,void 0,void 0,function*(){const n=yield(0,t.loadArcGISJSAPIModule)("esri/geometry/operators/unionOperator"),a=new Map(e);return a.forEach(e=>{const t=[];let a=null;e.records.sort((e,t)=>e.fromMeasure-t.fromMeasure),e.records.forEach(e=>{a?!function(e,t){if(e.isPoint)return!1;let n=!0;return e.attributes.forEach((e,a)=>{if(a!==w.fromMeasureName&&a!==w.toMeasureName&&t.attributes.has(a)){const i=(0,d.isDefined)(e),r=(0,d.isDefined)(t.attributes.get(a));(!i&&r||i&&!r||e!==t.attributes.get(a))&&(n=!1)}}),n}(a,e)?(t.push(a),a=e):(a.attributes.set(w.toMeasureName,e.toMeasure),a.toMeasure=e.toMeasure,a.geometry=function(e,t,n){return!(0,d.isDefined)(t)&&(0,d.isDefined)(n)?n:(0,d.isDefined)(t)&&!(0,d.isDefined)(n)?t:(0,d.isDefined)(t)||(0,d.isDefined)(n)?e.execute(t,n):null}(n,a.geometry,e.geometry)):a=e}),a&&t.push(a),e.records=t}),a})}(s)})}function yt(e){const t=e.fieldInfos.find(e=>e.isOidField);return(0,d.isDefined)(t)?t.featureFieldName:""}function vt(e){var t;return null!==(t=e.attributes.get(yt(e)))&&void 0!==t?t:NaN}function bt(e,t,n){const a=n.find(e=>e.layerId===t);if((0,d.isDefined)(a)){const t=a.fields.find(t=>t===e);return(0,d.isDefined)(t)?t:a.fields[0]}return""}function wt(e,t,n){let a=!1;return e.forEach(e=>{e.eventName===n&&e.EventType===r.Point&&(a=!0)}),a}function St(e,t,n){let a=!1;return e.forEach(e=>{if(e.eventName===n&&e.isOidField){const n=t.attributes[e.featureFieldName];(0,d.isDefined)(n)&&""!==n&&!isNaN(n)&&(a=!0)}}),a}function xt(e,t,n){if(isNaN(e))return NaN;const a=t.to-t.from,i=n,r=(e-t.from)/a*i;return Math.floor(r)}function It(e,t,n){if(isNaN(e))return NaN;return e/n*(t.to-t.from)+t.from}function Dt(e,t,n){for(let a=0;a<t;++a)if(0!==e.data[n*t*4+4*a+3])return!1;return!0}function Nt(e,t,n,a,i){for(let r=a;r<i;++r)if(0!==e.data[r*t*4+4*n+3])return!1;return!0}function Mt(e,t){const n=function(e,t){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const a=n.getContext("2d");return(0,d.isDefined)(t)?a.drawImage(e,0,0,t,t):a.drawImage(e,0,0),n}(e,t),a=function(e,t){const n=e.getContext("2d"),a=(0,d.isDefined)(t)?t:e.width,i=(0,d.isDefined)(t)?t:e.height,r=n.getImageData(0,0,a,i);let o=0,s=r.height,l=0,c=r.width;for(;o<s&&Dt(r,a,o);)++o;for(;s-1>o&&Dt(r,a,s-1);)--s;for(;l<c&&Nt(r,a,l,o,s);)++l;for(;c-1>l&&Nt(r,a,c-1,o,s);)--c;const u=c-l===0?1:c-l,f=s-o===0?1:s-o,p=n.getImageData(l,o,u,f),m=e.ownerDocument.createElement("canvas"),g=m.getContext("2d");return m.width=p.width,m.height=p.height,g.putImageData(p,0,0),m}(n,t);return a.toDataURL("image/png")}function kt(e,t,n,a,i){if((0,d.isDefined)(e)){const i=function(e,t,n,a){if((0,d.isDefined)(e)&&(0,d.isDefined)(n)){if((0,d.isDefined)(t)){const e=n.find(e=>e.id===t.eventLayerId);if((0,d.isDefined)(e)&&(0,d.isDefined)(e.subtypes)){const t=e.subtypes.map(e=>({value:e.code,label:e.name}));if(t)return t}return[]}return a.subtypes.map(e=>({value:e.code,label:e.name}))||[]}return[]}(t,n,a),r=i.find(t=>"string"==typeof t.value&&"string"==typeof e?t.value.toLowerCase()===e.toLowerCase():t.value===e);return(0,d.isDefined)(r)?r.label:""}return""}function Lt(e,t){if((0,d.isDefined)(e)){const a=(n=t,(0,d.isDefined)(n)&&(0,d.isDefined)(n.domain)&&"coded-value"===n.domain.type?n.domain:null).codedValues.find(t=>"string"==typeof t.code&&"string"==typeof e?t.code.toLowerCase()===e.toLowerCase():t.code===e);return(0,d.isDefined)(a)?a.name:""}var n;return""}function Et(e,t,n,a){const i=function(e,t){return e.find(e=>e.alias.split(".")[1]===t.displayField)}(e,n),r=Ct(t,n);if((0,d.isDefined)(i)&&(0,d.isDefined)(r)){return Rt(Tt(i,r),i,r,n.attributes.get(n.displayField),a)}return""}function Rt(e,t,n,a,i,r,o){switch(e){case"subtype":return kt(a,t,n,i);case"domain":return Lt(a,t);case"date":return(0,d.isDefined)(a)?o?(0,d.getDateWithTZOffset)(a.valueOf(),o).toLocaleDateString():new Date(a).toLocaleDateString():"";case"range":case"number":case"text":return(0,d.isDefined)(a)?a.toString():""}}function Tt(e,t,n){if((0,d.isDefined)(t)){if(t.isSubtypeField)return"subtype"}else if(n.subtypeField===e.name)return"subtype";return(0,d.isDefined)(e.domain)&&(0,d.isCodedDomain)(e.domain.type)?"domain":(0,d.isDefined)(e.domain)&&(0,d.isRangeDomain)(e.domain.type)?"range":(0,d.isDate)(e.type)?"date":(0,d.isNumber)(e.type)?"number":"text"}function Ct(e,t){return e.find(e=>e.originalFieldName===t.displayField)}function jt(e,t){return e.find(e=>e.isEventIdField)}function Ft(e,n,a=!1){return(0,t.loadArcGISJSAPIModules)(["esri/Graphic"]).then(t=>{let i=null;[i]=t;const r=[...e.attributes.keys()],o={};return r.forEach(t=>{o[t]=e.attributes.get(t),!a||(0,d.isDefined)(o[t])&&"null"!==o[t]||(o[t]="<Null>")}),(0,d.isDefined)(n)?new i({geometry:e.geometry,attributes:o,layer:n.layer}):new i({geometry:e.geometry,attributes:o})})}function Ot(e,t,n,a){const i=new Map;return e.forEach(e=>{e.eventName===n&&(e.isOidField?a&&i.set(e.featureFieldName,t.attributes.get(e.featureFieldName)):i.set(e.originalFieldName,t.attributes.get(e.originalFieldName)))}),i.set(w.routeIdName,t.attributes.get(w.routeIdName)),i.set(w.fromDateName,t.attributes.get(w.fromDateName)),i.set(w.toDateName,t.attributes.get(w.toDateName)),i.set(w.fromMeasureName,t.attributes.get(w.fromMeasureName)),i.set(w.toMeasureName,t.attributes.get(w.toMeasureName)),i}function At(n){const{trackKey:a,track:i,onTrackClicked:r}=n;return(0,e.jsx)("div",{className:(0,t.classNames)("sidebar-item",i.isActive?"active":"inactive"),onClick:()=>{i.isActive=!i.isActive,r(i,a)},children:(0,e.jsx)(o.Label,{className:"label2",centric:!0,style:{marginBottom:"0"},children:i.layerName})})}function Pt(t){const{trackMap:n,width:a,onTrackChanged:i}=t,r=(e,t)=>{const a=new Map(n);a.set(t,e),i(a)};return(0,e.jsxs)("div",{className:"sidebar-body h-100",style:{width:a},children:[[...n.keys()].filter(e=>n.get(e).isActive).map(t=>(0,e.jsx)(At,{trackKey:t,track:n.get(t),onTrackClicked:r},t)),[...n.keys()].filter(e=>!n.get(e).isActive).map(t=>(0,e.jsx)(At,{trackKey:t,track:n.get(t),onTrackClicked:r},t))]})}function _t(t){const{width:n,height:a,trackMap:i,onTrackChanged:r}=t;return(0,e.jsx)("div",{className:"sidebar d-flex",style:{width:n,height:a},children:(0,e.jsx)(Pt,{trackMap:i,width:n,onTrackChanged:r})})}function Vt(){return Vt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Vt.apply(null,arguments)}function $t(e,t){return $t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$t(e,t)}function zt(e){return zt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zt(e)}function Bt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Bt=function(){return!!e})()}function Gt(e){var t="function"==typeof Map?new Map:void 0;return Gt=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(Bt())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,t);var i=new(e.bind.apply(e,a));return n&&$t(i,n.prototype),i}(e,arguments,zt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),$t(n,e)},Gt(e)}var Ut=function(e){var t,n;function a(t){return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this)}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,$t(t,n),a}(Gt(Error));function Wt(e,t){return e.substr(-t.length)===t}var Ht=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function qt(e){return"string"!=typeof e?e:e.match(Ht)?parseFloat(e):e}var Jt=function(e){return function(t,n){void 0===n&&(n="16px");var a=t,i=n;if("string"==typeof t){if(!Wt(t,"px"))throw new Ut(69,e,t);a=qt(t)}if("string"==typeof n){if(!Wt(n,"px"))throw new Ut(70,e,n);i=qt(n)}if("string"==typeof a)throw new Ut(71,t,e);if("string"==typeof i)throw new Ut(72,n,e);return""+a/i+e}};Jt("em");Jt("rem");function Yt(e){return Math.round(255*e)}function Zt(e,t,n){return Yt(e)+","+Yt(t)+","+Yt(n)}function Qt(e,t,n,a){if(void 0===a&&(a=Zt),0===t)return a(n,n,n);var i=(e%360+360)%360/60,r=(1-Math.abs(2*n-1))*t,o=r*(1-Math.abs(i%2-1)),s=0,l=0,c=0;i>=0&&i<1?(s=r,l=o):i>=1&&i<2?(s=o,l=r):i>=2&&i<3?(l=r,c=o):i>=3&&i<4?(l=o,c=r):i>=4&&i<5?(s=o,c=r):i>=5&&i<6&&(s=r,c=o);var u=n-r/2;return a(s+u,l+u,c+u)}var Kt={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var Xt=/^#[a-fA-F0-9]{6}$/,en=/^#[a-fA-F0-9]{8}$/,tn=/^#[a-fA-F0-9]{3}$/,nn=/^#[a-fA-F0-9]{4}$/,an=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,rn=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,on=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,sn=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function ln(e){if("string"!=typeof e)throw new Ut(3);var t=function(e){if("string"!=typeof e)return e;var t=e.toLowerCase();return Kt[t]?"#"+Kt[t]:e}(e);if(t.match(Xt))return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16)};if(t.match(en)){var n=parseFloat((parseInt(""+t[7]+t[8],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16),alpha:n}}if(t.match(tn))return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16)};if(t.match(nn)){var a=parseFloat((parseInt(""+t[4]+t[4],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16),alpha:a}}var i=an.exec(t);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var r=rn.exec(t.substring(0,50));if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10),alpha:parseFloat(""+r[4])>1?parseFloat(""+r[4])/100:parseFloat(""+r[4])};var o=on.exec(t);if(o){var s="rgb("+Qt(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",l=an.exec(s);if(!l)throw new Ut(4,t,s);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var c=sn.exec(t.substring(0,50));if(c){var u="rgb("+Qt(parseInt(""+c[1],10),parseInt(""+c[2],10)/100,parseInt(""+c[3],10)/100)+")",d=an.exec(u);if(!d)throw new Ut(4,t,u);return{red:parseInt(""+d[1],10),green:parseInt(""+d[2],10),blue:parseInt(""+d[3],10),alpha:parseFloat(""+c[4])>1?parseFloat(""+c[4])/100:parseFloat(""+c[4])}}throw new Ut(5)}function cn(e){return function(e){var t,n=e.red/255,a=e.green/255,i=e.blue/255,r=Math.max(n,a,i),o=Math.min(n,a,i),s=(r+o)/2;if(r===o)return void 0!==e.alpha?{hue:0,saturation:0,lightness:s,alpha:e.alpha}:{hue:0,saturation:0,lightness:s};var l=r-o,c=s>.5?l/(2-r-o):l/(r+o);switch(r){case n:t=(a-i)/l+(a<i?6:0);break;case a:t=(i-n)/l+2;break;default:t=(n-a)/l+4}return t*=60,void 0!==e.alpha?{hue:t,saturation:c,lightness:s,alpha:e.alpha}:{hue:t,saturation:c,lightness:s}}(ln(e))}var un=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function dn(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function fn(e){return dn(Math.round(255*e))}function pn(e,t,n){return un("#"+fn(e)+fn(t)+fn(n))}function mn(e,t,n){return Qt(e,t,n,pn)}function gn(e,t,n){if("number"==typeof e&&"number"==typeof t&&"number"==typeof n)return mn(e,t,n);if("object"==typeof e&&void 0===t&&void 0===n)return mn(e.hue,e.saturation,e.lightness);throw new Ut(1)}function hn(e,t,n,a){if("number"==typeof e&&"number"==typeof t&&"number"==typeof n&&"number"==typeof a)return a>=1?mn(e,t,n):"rgba("+Qt(e,t,n)+","+a+")";if("object"==typeof e&&void 0===t&&void 0===n&&void 0===a)return e.alpha>=1?mn(e.hue,e.saturation,e.lightness):"rgba("+Qt(e.hue,e.saturation,e.lightness)+","+e.alpha+")";throw new Ut(2)}function yn(e,t,n){if("number"==typeof e&&"number"==typeof t&&"number"==typeof n)return un("#"+dn(e)+dn(t)+dn(n));if("object"==typeof e&&void 0===t&&void 0===n)return un("#"+dn(e.red)+dn(e.green)+dn(e.blue));throw new Ut(6)}function vn(e,t,n,a){if("string"==typeof e&&"number"==typeof t){var i=ln(e);return"rgba("+i.red+","+i.green+","+i.blue+","+t+")"}if("number"==typeof e&&"number"==typeof t&&"number"==typeof n&&"number"==typeof a)return a>=1?yn(e,t,n):"rgba("+e+","+t+","+n+","+a+")";if("object"==typeof e&&void 0===t&&void 0===n&&void 0===a)return e.alpha>=1?yn(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new Ut(7)}function bn(e){if("object"!=typeof e)throw new Ut(8);if(function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&"number"==typeof e.alpha}(e))return vn(e);if(function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&("number"!=typeof e.alpha||void 0===e.alpha)}(e))return yn(e);if(function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&"number"==typeof e.alpha}(e))return hn(e);if(function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&("number"!=typeof e.alpha||void 0===e.alpha)}(e))return gn(e);throw new Ut(8)}function wn(e,t,n){return function(){var a=n.concat(Array.prototype.slice.call(arguments));return a.length>=t?e.apply(this,a):wn(e,t,a)}}function Sn(e){return wn(e,e.length,[])}Sn(function(e,t){if("transparent"===t)return t;var n=cn(t);return bn(Vt({},n,{hue:n.hue+parseFloat(e)}))});function xn(e,t,n){return Math.max(e,Math.min(t,n))}Sn(function(e,t){if("transparent"===t)return t;var n=cn(t);return bn(Vt({},n,{lightness:xn(0,1,n.lightness-parseFloat(e))}))});Sn(function(e,t){if("transparent"===t)return t;var n=cn(t);return bn(Vt({},n,{saturation:xn(0,1,n.saturation-parseFloat(e))}))});Sn(function(e,t){if("transparent"===t)return t;var n=cn(t);return bn(Vt({},n,{lightness:xn(0,1,n.lightness+parseFloat(e))}))});var In=Sn(function(e,t,n){if("transparent"===t)return n;if("transparent"===n)return t;if(0===e)return n;var a=ln(t),i=Vt({},a,{alpha:"number"==typeof a.alpha?a.alpha:1}),r=ln(n),o=Vt({},r,{alpha:"number"==typeof r.alpha?r.alpha:1}),s=i.alpha-o.alpha,l=2*parseFloat(e)-1,c=((l*s===-1?l:l+s)/(1+l*s)+1)/2,u=1-c;return vn({red:Math.floor(i.red*c+o.red*u),green:Math.floor(i.green*c+o.green*u),blue:Math.floor(i.blue*c+o.blue*u),alpha:i.alpha*parseFloat(e)+o.alpha*(1-parseFloat(e))})});Sn(function(e,t){if("transparent"===t)return t;var n=ln(t);return vn(Vt({},n,{alpha:xn(0,1,(100*("number"==typeof n.alpha?n.alpha:1)+100*parseFloat(e))/100)}))});Sn(function(e,t){if("transparent"===t)return t;var n=cn(t);return bn(Vt({},n,{saturation:xn(0,1,n.saturation+parseFloat(e))}))});Sn(function(e,t){return"transparent"===t?t:bn(Vt({},cn(t),{hue:parseFloat(e)}))});Sn(function(e,t){return"transparent"===t?t:bn(Vt({},cn(t),{lightness:parseFloat(e)}))});Sn(function(e,t){return"transparent"===t?t:bn(Vt({},cn(t),{saturation:parseFloat(e)}))});Sn(function(e,t){return"transparent"===t?t:In(parseFloat(e),"rgb(0, 0, 0)",t)});Sn(function(e,t){return"transparent"===t?t:In(parseFloat(e),"rgb(255, 255, 255)",t)});Sn(function(e,t){if("transparent"===t)return t;var n=ln(t);return vn(Vt({},n,{alpha:xn(0,1,+(100*("number"==typeof n.alpha?n.alpha:1)-100*parseFloat(e)).toFixed(2)/100)}))});var Dn=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function Nn(n){const{eventDS:a,record:i,fieldInfos:r,fields:s,isActive:l,contentWidth:c,measureRange:u,trackIndex:f,subtypeLayers:p,onItemClick:m,onItemHover:g,onItemHoverExit:h}=n,b=t.React.useRef(null),w=(0,$.getTheme)(),[S,x]=t.React.useState(null),[I,D]=t.React.useState(null),[M,k]=t.React.useState(null),[L,E]=t.React.useState(!1),[R,T]=t.React.useState(!1),[C,j]=t.React.useState(null),F=.75,[O,A]=t.React.useState(!1),{selectedSldId:_,pendingEdits:V}=y(),z=v(),B=e=>{e.stopPropagation(),z({type:"SET_SELECTED_SLD_ID",value:re()}),m(i,r,re(),!1)},G=e=>{e.stopPropagation(),z({type:"SET_SELECTED_SLD_ID",value:re()}),m(i,r,re(),!0)},U=e=>{e.stopPropagation();const t=H();g(t,re())},W=e=>{e.stopPropagation(),h()},H=()=>{if((0,d.isDefined)(C)&&!V.has(re()))return C;const e=new Map,t=Ct(r,i),n=jt(r);e.set(t.originalFieldName,Et(s,r,i,p)),e.set(n.originalFieldName,i.attributes.get(n.originalFieldName));const a={attributes:e,fromMeasure:i.fromMeasure,toMeasure:i.toMeasure,index:i.index,isPoint:i.isPoint,hasValue:i.hasValue,selected:i.selected,displayField:i.displayField,geometry:i.geometry,objectId:i.objectId,fieldInfos:r,attributeBackgrounds:q()};return j(a),a},q=()=>{const e=new Map,t=Ct(r,i),n=jt(r);return e.set(t.originalFieldName,vn(M.r,M.g,M.b,.5)),e.set(n.originalFieldName,"transparent"),e};t.React.useEffect(()=>{l&&(()=>{Dn(this,void 0,void 0,function*(){i.isPoint&&!L?(yield J(),E(!0)):i.isPoint||(yield Y(),E(!0))})})()},[l,c]),t.React.useEffect(()=>{const e=()=>Dn(this,void 0,void 0,function*(){i.isPoint?yield J(!0):i.isPoint||(yield Y(!0))});V.has(re())&&(e(),A(!0))},[V]);const J=e=>Dn(this,void 0,void 0,function*(){if(!i.hasValue)return;const[t,n,r]=yield Promise.all([ee(),te(),Ft(i,null,!0)]);x(t),D(n);const o=a;yield t.getDisplayedSymbol(r,{renderer:o.layer.renderer}).then(a=>Dn(this,void 0,void 0,function*(){var i,s;if(Z(r,o,t,e),!(0,d.isDefined)(a))return;const l=a.toJSON(),c=null!==(s=null===(i=null==l?void 0:l.symbol)||void 0===i?void 0:i.symbolLayers)&&void 0!==s?s:null;if((0,d.isDefined)(c)){l.symbolLayers=K(c,!1),a=n.fromJSON(l);const e=document.getElementById(re()),i=e.getElementsByTagName("img");i.length>0&&e.removeChild(i[0]);const r=yield t.renderPreviewHTML(a,{node:e,size:13.5});r.style.width="18px",r.style.height="18px";const o=e.getElementsByTagName("img")[0],s=Mt(o,N);o.src=s,e.style.backgroundImage=`url(${s})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.removeChild(o)}else if("picture-marker"===a.type){const e=document.getElementById(re()),t=document.createElement("img");t.src=null==a?void 0:a.url,e.style.backgroundImage=`url(${t.src})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.style.backgroundSize="contain"}else if((0,d.isDefined)(l)){l.size=N,a=n.fromJSON(l);const e=document.getElementById(re()),i=e.getElementsByTagName("img");i.length>0&&e.removeChild(i[0]);const r=yield t.renderPreviewHTML(a,{node:e,size:13.5});r.style.width="18px",r.style.height="18px";const o=e.getElementsByTagName("img")[0],s=Mt(o,N);o.src=s,e.style.backgroundImage=`url(${s})`,e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="center",e.removeChild(o)}}))}),Y=e=>Dn(this,void 0,void 0,function*(){if(!i.hasValue)return;const t=document.getElementById(re());if((0,d.isDefined)(t)){const n=a,[r,o,s]=yield Promise.all([ee(),te(),Ft(i,n,!0)]);x(r),D(o),yield r.getDisplayedSymbol(s,{renderer:n.layer.renderer}).then(a=>Dn(this,void 0,void 0,function*(){var i,l;if(Q(t,s,n,r,e),!(0,d.isDefined)(a))return;const c=a.toJSON(),u=null!==(l=null===(i=null==c?void 0:c.symbol)||void 0===i?void 0:i.symbolLayers)&&void 0!==l?l:null;if((0,d.isDefined)(u)&&u.length>1){c.symbolLayers=K(u,!1),a=o.fromJSON(c);const e=t.getElementsByTagName("img");e.length>0&&t.removeChild(e[0]),yield r.renderPreviewHTML(a,{node:t,size:{width:t.getBoundingClientRect().width*F,height:21},symbolConfig:{isSquareFill:!0}});const n=t.getElementsByTagName("img")[0];if(""===n.src||0===n.width)return void t.removeChild(n);const i=Mt(n);n.src=i,t.style.backgroundImage=`url(${i})`,t.style.backgroundPosition="center",t.removeChild(n),T(!0)}}))}}),Z=(e,t,n,a)=>Dn(this,void 0,void 0,function*(){if(!(0,d.isDefined)(M)||a){const a=yield n.getDisplayedColor(e,{renderer:t.layer.renderer});if((0,d.isDefined)(a))k(a);else{k({r:255,g:255,b:255,a:0})}}}),Q=(e,t,n,a,i)=>Dn(this,void 0,void 0,function*(){if(!(0,d.isDefined)(M)||i){const i=yield a.getDisplayedColor(t,{renderer:n.layer.renderer});if((0,d.isDefined)(i))e.style.background=vn(i.r,i.g,i.b,i.a),k(i);else{const t={r:255,g:255,b:255,a:0};e.style.background=vn(t.a,t.g,t.b,t.a),k(t)}}else e.style.background=vn(M.r,M.g,M.b,M.a)}),K=(e,t)=>{if(t)e.forEach(e=>{e.width=N});else{let t=0;e.forEach(e=>{e.width>t&&(t=e.width)}),e.forEach(e=>{e.width=28-(t-e.width),e.capStyle="Butt",e.joinStyle="Round"})}return e},X=(e,t,n)=>1-(.299*e+.587*t+.114*n)/255<.5,ee=()=>Dn(this,void 0,void 0,function*(){if(S)return S;{const e=yield(0,t.loadArcGISJSAPIModule)("esri/symbols/support/symbolUtils");return x(e),e}}),te=()=>Dn(this,void 0,void 0,function*(){if(I)return I;{const e=yield(0,t.loadArcGISJSAPIModule)("esri/symbols/support/jsonUtils");return D(e),e}}),ne=()=>{const e=ae(),t=ie();return t-e>0?t-e:1},ae=()=>{const e=i.fromMeasure;if(!isNaN(e)){const t=xt(e,u,c);return i.isPoint?t-9:t}return 0},ie=()=>{const e=i.toMeasure;return isNaN(e)?ae():xt(e,u,c)},re=()=>f+"-"+i.index;return(0,e.jsxs)("div",{children:[l&&i.hasValue&&i.isPoint&&(0,e.jsx)("div",{id:re(),className:(0,t.classNames)("sld-item-point-active",_===re()?"sld-item-selected-point":"",O?"sld-item-edited-point":""),ref:b,style:{left:ae(),background:"transparent"},onMouseEnter:U,onMouseLeave:W,onClick:B,onDoubleClick:G}),l&&i.hasValue&&!i.isPoint&&(0,e.jsx)("div",{id:re(),ref:b,className:(0,t.classNames)("sld-item-line-active",_===re()?"sld-item-selected-line":"",O?"sld-item-edited-line":""),onMouseEnter:U,onMouseLeave:W,onClick:B,onDoubleClick:G,style:{width:ne(),left:ae()},children:(0,e.jsx)("div",{className:"sld-item-label-wrapper",children:(0,e.jsx)(o.Label,{className:"sld-item-label title3",centric:!0,style:{color:(0,d.isDefined)(M)?X(M.r,M.g,M.b)?"#000":"#fff":"#000",background:R&&(0,d.isDefined)(M)?vn(M.r,M.g,M.b,M.a):"transparent",visibility:""!==Et(s,r,i,p)?"visible":"hidden"},children:Et(s,r,i,p)})})}),!l&&i.hasValue&&i.isPoint&&(0,e.jsx)("div",{id:re(),className:"sld-item-point-inactive",style:{width:"24px",left:ae(),background:"transparent"},children:(0,e.jsx)(P.CalciteIcon,{icon:"bullet-point-large",scale:"m",css:t.css`--calcite-ui-icon-color: ${w.sys.color.action.disabled.text};`})}),!l&&i.hasValue&&!i.isPoint&&(0,e.jsx)("div",{id:re(),className:"sld-item-line-inactive",style:{width:ne(),left:ae()}})]})}function Mn(n){const{rowIndex:a,allLayersDS:i,trackMap:r,contentWidth:o,measureRange:s,isActive:l,featureLayer:c,subtypeLayers:u,onItemClick:f,onItemHover:p,onItemHoverExit:m}=n,{fieldInfo:g}=y(),h=()=>{if((0,d.isDefined)(i)&&i.length){const e=i.find(e=>e.layer.layerId.toString()===r.layerId);if((0,d.isDefined)(e))return e}return null},v=(e,t,n,a)=>{f(e,r,t,n,a)},b=(e,t)=>{p(e,r,t)},w=t.React.useMemo(()=>g.filter(e=>e.eventName===r.layerName||""===e.eventName),[g,r.layerName]),S=t.React.useMemo(()=>(0,d.isDefined)(c)?c.fields.filter(e=>e.alias.includes(".")&&(e.alias.split(".")[0]===r.layerName||""===e.alias.split(".")[0])):null,[c,r.layerName]);return(0,e.jsx)("div",{"data-row-id":"sld-row-"+a,className:(0,t.classNames)("sld-row d-flex",l?"active":"inactive"),style:{width:o,flexDirection:"row",position:"relative"},children:r.records.map(t=>(0,e.jsx)(Nn,{eventDS:h(),record:t,fieldInfos:w,fields:S,featureLayer:c,isActive:l,contentWidth:o,measureRange:s,trackIndex:r.index,subtypeLayers:u,onItemClick:v,onItemHover:b,onItemHoverExit:m},t.index))},"sld-row-"+a)}const kn=function(){return Ce.Date.now()};var Ln=Math.max,En=Math.min;const Rn=function(e,t,n){var a,i,r,o,s,l,c=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=a,r=i;return a=i=void 0,c=t,o=e.apply(r,n)}function m(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=r}function g(){var e=kn();if(m(e))return h(e);s=setTimeout(g,function(e){var n=t-(e-l);return d?En(n,r-(e-c)):n}(e))}function h(e){return s=void 0,f&&a?p(e):(a=i=void 0,o)}function y(){var e=kn(),n=m(e);if(a=arguments,i=this,l=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(g,t),u?p(e):o}(l);if(d)return clearTimeout(s),s=setTimeout(g,t),p(l)}return void 0===s&&(s=setTimeout(g,t)),o}return t=et(t)||0,Pe(n)&&(u=!!n.leading,r=(d="maxWait"in n)?Ln(et(n.maxWait)||0,t):r,f="trailing"in n?!!n.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,a=l=i=s=void 0},y.flush=function(){return void 0===s?o:h(kn())},y};var Tn=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function Cn(n){const{allLayersDS:a,trackMap:i,contentWidth:r,measureRange:s,featureLayer:l,subtypeLayers:c,onItemClick:u}=n,[f,p]=t.React.useState(""),[m,g]=t.React.useState(new Map),[h,b]=t.React.useState(!1),[w,S]=t.React.useState(new Map),{highlightColor:x,highlightLayer:I,selectedSldId:D,jimuMapView:N}=y(),[M,k]=t.React.useState(null),[L,E]=t.React.useState(null),[R,T]=t.React.useState(null),C=(0,$.getTheme)(),F=v(),O=()=>{""!==D&&D!==R||(T(null),g(new Map),S(new Map),E(null),b(!1))},A=(e,t,n)=>{""!==D&&D!==n||(k(e),E(t),T(n),V())},_=(e,t,n,a,i)=>Tn(this,void 0,void 0,function*(){b(!1),i||D!==a?i?(yield z(e),u(e,t,n)):(yield z(e),u(null,null,null)):F({type:"SET_SELECTED_SLD_ID",value:""})});t.React.useEffect(()=>{""===D&&I.removeAll()},[D]);const V=(e=>{const n=t.React.useRef(null);return t.React.useEffect(()=>{n.current=e},[e]),t.React.useMemo(()=>Rn(()=>{var e;null===(e=n.current)||void 0===e||e.call(n)},1e3),[])})(()=>{(0,d.isDefined)(M)&&(0,d.isDefined)(L)&&(0,d.isDefined)(R)&&(""!==D&&D!==R||(b(!0),p(R),g(M.attributes),S(M.attributeBackgrounds),E(L)))}),z=e=>Tn(this,void 0,void 0,function*(){if((0,d.isDefined)(e)&&(0,d.isDefined)(I)){j(N,I),I.removeAll();const t=yield Ft(e),n=yield(0,d.getGeometryGraphic)(t,x,4,!e.isPoint);I.add(n)}}),B=()=>(0,d.isDefined)(L)?L.layerName:"",G=e=>{if(!(0,d.isDefined)(M))return"";const t=M.fieldInfos.find(t=>t.originalFieldName===e);return(0,d.isDefined)(t)?t.originalFieldAlias:e};return(0,e.jsxs)("div",{className:"sld-body h-100",style:{width:r},children:[[...i.keys()].filter(e=>i.get(e).isActive).map((t,n)=>(0,e.jsx)(Mn,{rowIndex:n,allLayersDS:a,featureLayer:l,trackMap:i.get(t),contentWidth:r,measureRange:s,isActive:!0,subtypeLayers:c,onItemClick:_,onItemHover:A,onItemHoverExit:O},i.get(t).index)),[...i.keys()].filter(e=>!i.get(e).isActive).map((t,n)=>(0,e.jsx)(Mn,{rowIndex:n,allLayersDS:a,featureLayer:l,trackMap:i.get(t),contentWidth:r,measureRange:s,isActive:!1,subtypeLayers:c,onItemClick:u,onItemHover:A,onItemHoverExit:O},i.get(t).index)),(0,e.jsx)(P.CalcitePopover,{autoClose:void 0,closable:void 0,open:!!h||void 0,overlayPositioning:"absolute",placement:"auto",scale:"s",label:B(),heading:B(),referenceElement:f,style:{borderRadius:"5px",boxShadow:"4px 4px 8px 2px rgba(0, 0, 0, 0.3)",border:`1px solid ${$.colorUtils.colorMixOpacity(C.sys.color.surface.overlayHint,.5)}`},children:(0,e.jsx)("div",{style:{margin:"10px"},children:[...m.keys()].map(t=>(0,e.jsx)("span",{children:(0,e.jsx)("div",{style:{background:w.get(t),marginBottom:"3px"},children:(0,e.jsx)(o.Label,{className:"label2",centric:!0,style:{margin:"2px 5px"},children:`${G(t)}: ${m.get(t)}`})})},t))})})]})}function jn(n){const{trackMap:a,height:i,containerWidth:r,contentWidth:o,measureRange:s,featureLayer:l,subtypeLayers:c,onItemClick:u}=n,{jimuMapView:f}=y(),p=t.React.useMemo(()=>{if(f)return(0,d.getAllDatasourceFromMapWidgetId)(f.mapWidgetId)},[f]);return(0,e.jsx)("div",{className:"sld",style:{width:r,height:i},children:(0,e.jsx)(Cn,{allLayersDS:p,trackMap:a,contentWidth:o,measureRange:s,featureLayer:l,subtypeLayers:c,onItemClick:u})})}function Fn(a){const{sidebarWidth:i,zoom:r,measureRange:s,scrollPosition:l,onZoomChange:c,onNavForwardOrBack:u,onNavStartOrEnd:d}=a,f=t.hooks.useTranslation(n);return(0,e.jsxs)("div",{className:"sidebar-header d-flex",style:{width:i},children:[(0,e.jsx)(o.Tooltip,{placement:"auto",title:f("navStart"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)("div",{className:"sidebar-icon",children:(0,e.jsx)(P.CalciteIcon,{icon:"chevron-start",scale:"m",textLabel:f("navStart"),onClick:()=>{d(!1)}})})}),(0,e.jsx)(o.Tooltip,{placement:"auto",title:f("navBack"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)("div",{className:"sidebar-icon",children:(0,e.jsx)(P.CalciteIcon,{icon:"chevron-left",scale:"m",textLabel:f("navBack"),onClick:()=>{u(!1)}})})}),(0,e.jsx)(o.Tooltip,{placement:"auto",title:f("zoomOut"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)("div",{className:"sidebar-icon",children:(0,e.jsx)(P.CalciteIcon,{icon:"minus-circle",scale:"m",textLabel:f("zoomOut"),onClick:()=>{c(r/2<1?1:r/2)}})})}),(0,e.jsx)(o.Tooltip,{placement:"auto",title:f("zoomIn"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)("div",{className:"sidebar-icon",children:(0,e.jsx)(P.CalciteIcon,{icon:"plus-circle",scale:"m",textLabel:f("zoomIn"),onClick:()=>{const e=s.to-s.from,t=r*(i/e),n=l/r;c((n*r+i)/t-n*r/t<1?r:2*r)}})})}),(0,e.jsx)(o.Tooltip,{placement:"auto",title:f("navForward"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)("div",{className:"sidebar-icon",children:(0,e.jsx)(P.CalciteIcon,{icon:"chevron-right",scale:"m",textLabel:f("navForward"),onClick:()=>{u(!0)}})})}),(0,e.jsx)(o.Tooltip,{placement:"auto",title:f("navEnd"),showArrow:!0,enterDelay:300,enterNextDelay:1e3,children:(0,e.jsx)("div",{className:"sidebar-icon",children:(0,e.jsx)(P.CalciteIcon,{icon:"chevron-end",scale:"m",textLabel:f("navEnd"),onClick:()=>{d(!0)}})})})]})}function On(t){const n=(0,$.getTheme)(),{width:a=0,zoom:i=1,range:r=[-1/0,1/0],scrollPosition:o=0,onClickOrHover:s}=t,l=G.default.useRef(null),[c,u]=G.default.useState(!1),[d,f]=G.default.useState(!1);G.default.useEffect(()=>{function e(e){l.current&&!l.current.contains(e.target)&&(u(!1),f(!1),s(null,!1,!1))}return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[l,s]),G.default.useEffect(()=>{y(o,i)},[o,i,a]);const p=e=>{const t=document.createElement("div");return t.style.display="none",t.style.color=e,document.body.appendChild(t),window.getComputedStyle(t,null).getPropertyValue("color")},m=G.default.useMemo(()=>r[0]<0,[r]),g=G.default.useMemo(()=>p(n.sys.color.surface.background),[n]),h=G.default.useMemo(()=>p(n.sys.color.surface.backgroundHint),[n]),y=(e,t)=>{const n=l.current.getContext("2d");if(!n)return;n.rect(0,0,a,S),n.fillStyle=g,n.fill(),n.save(),n.scale(1,1),n.strokeStyle=h,n.lineWidth=1,n.font="12px sans-serif",n.fillStyle=h,n.textAlign="left",n.textBaseline="bottom",n.translate(.5,0),n.beginPath();const i=r[1]-r[0],o=t*(a/i),s=e/t===0?Number.MIN_VALUE:e/t,c=s*t/o,u=(s*t+a)/o;let d=Math.floor(c);const f=u-c;let p;p=f<1?f:ft(f,0);const y=Math.ceil(p/10);if(d%y!==0){const e=d%y;d-=e,p+=e}const v=Math.max(["left","center","right"].indexOf("left")-1,-1),b=[];for(let e=0;e<=p;++e){if(e%y!==0)continue;const t=(e+d)*(a/i),o=`${ft(i/a*t+r[0],3)}`,s=n.measureText(o).width;b.push({color:h,backgroundColor:L,value:t,text:o,textSize:s,isLast:!1})}for(let l=0;l<=p;++l){const c=l+d;if(!m&&c<0)continue;const u=(c*(a/i)-s)*t;if(p>=10){const e=y/M;if(l%y!==0)continue;for(let t=0;t<M;++t){const i=u+t*e*o;if(i<0||i>=a)continue;let r=k;r=0===t?k:t%5==0?17:8;const s=34-r,[l,c]=[i,s],[d,f]=[l,c+r];n.moveTo(l,c),n.lineTo(d,f)}}else if(p<1){b.length=0;const i=(r[1]-r[0])/9;for(let o=0;o<M;++o){const s=ft(r[0]+o*i,3),l=o/9*(t*a)-e;if(l<0||l>a)continue;let c=k;c=0===o?k:o%5==0?17:8;const u=34-c,[d,f]=[l,u],[p,m]=[d,f+c];n.moveTo(d,f),n.lineTo(p,m);const g=s.toString(),y=n.measureText(g).width;b.push({color:h,backgroundColor:L,value:l,text:g,textSize:y,isLast:o===M})}}else for(let e=0;e<M;++e){const t=u+e/M*o;if(t<0||t>=a)continue;let i=k;i=0===e&&l%y===0?k:e%5==0?17:8;const r=34-i,[s,c]=[t,r],[d,f]=[s,c+i];n.moveTo(s,c),n.lineTo(d,f)}}if(n.stroke(),n.beginPath(),0===b.length){const i=ft(r[0]+e/(t*a)*(r[1]-r[0]),3),o=ft(r[0]+(e+a)/(t*a)*(r[1]-r[0]),3);b.push({color:h,backgroundColor:L,value:0,text:i.toString(),textSize:n.measureText(i.toString()).width,isLast:!1}),b.push({color:h,backgroundColor:L,value:a,text:o.toString(),textSize:n.measureText(o.toString()).width,isLast:!0})}else if(1===b.length){const i=ft(r[0]+e/(t*a)*(r[1]-r[0]),3),o=ft(r[0]+(e+a)/(t*a)*(r[1]-r[0]),3);Math.abs(b[0].value-0)<Math.abs(b[0].value-a)?b.push({color:h,backgroundColor:L,value:a,text:o.toString(),textSize:n.measureText(o.toString()).width,isLast:!0}):b.push({color:h,backgroundColor:L,value:0,text:i.toString(),textSize:n.measureText(i.toString()).width,isLast:!1})}b.forEach(({value:e,backgroundColor:r,color:l,text:c,textSize:u,isLast:d})=>{if(!m&&e<0)return;let f;if(f=p<1?e:(e-s)*t,f<-o||f>=a+a/i*t)return;const g=d?17:18,h=d?u/2:v,[y,b]=[f+-3*h,g];if(r){let e=0;e=d?-u:0,n.save(),n.fillStyle=r,n.fillRect(y+e,0,u,k),n.restore()}n.save(),n.fillStyle=l,n.fillText(c,y,b),n.restore()}),n.restore()},v=G.default.useCallback(e=>{d&&(u(!c),s(e,!c,d))},[d,c,s]),b=G.default.useCallback(e=>{d&&s(e,c,d)},[d,c,s]),w=G.default.useCallback(e=>{f(!0)},[]),x=G.default.useCallback(e=>{f(!1),s(e,c,!1)},[c,s]),I=G.default.useCallback(e=>{var n;null===(n=t.onDoubleClick)||void 0===n||n.call(t,e)},[t]);return(0,e.jsx)("div",{className:"dyn-seg-ruler",style:{width:a},onMouseDown:v,onMouseMove:b,onMouseEnter:w,onMouseLeave:x,onDoubleClick:I,children:(0,e.jsx)("canvas",{ref:l,width:a,height:S})})}function An(n){const{sidebarWidth:a,bodyWidth:i,contentWidth:r,measureRange:o,zoom:s,scrollPosition:l,onZoomChange:c,onNavForwardOrBack:u,onNavStartOrEnd:d,onClickOrHover:f,onDoubleClick:p}=n,[m,g]=t.React.useState(s);t.React.useEffect(()=>{g(s)},[s]);const h=t.React.useCallback(e=>{g(e),c(e)},[c]);return(0,e.jsxs)("div",{className:"header w-100 d-flex",children:[(0,e.jsx)(Fn,{sidebarWidth:a,bodyWidth:i,contentWidth:r,zoom:m,measureRange:o,scrollPosition:l,onZoomChange:h,onNavForwardOrBack:u,onNavStartOrEnd:d}),(0,e.jsx)(On,{width:i,range:[o.from,o.to],zoom:m,scrollPosition:l,onClickOrHover:f,onDoubleClick:p})]})}var Pn=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function _n(n){const{x:a,m:i,snapTolerance:r,isPopupActive:s,isHoverActive:l,trackMap:c,featureLayer:f,subtypeLayers:p,maxHeight:m,networkInfo:g,measureRange:h,contentWidth:v,sidebarWidth:b,scrollPos:w,networkDS:S,routeId:x,temporalViewDate:I}=n,[D,N]=t.React.useState(new Map),{fieldInfo:M}=y(),[k,L]=t.React.useState(null),{jimuMapView:E,syncToMap:R}=y(),[T,C]=t.React.useState(a),[j,F]=t.React.useState(i),O=t.React.useRef(null),A=(0,$.getTheme)();t.React.useEffect(()=>{const e=()=>Pn(this,void 0,void 0,function*(){const e=new Map;if(!isNaN(i)){const t=H();C(t[0]),F(t[1]),yield Promise.all([...c.keys()].map(n=>Pn(this,void 0,void 0,function*(){return c.get(n).isActive&&(yield Promise.all(c.get(n).records.map(a=>Pn(this,void 0,void 0,function*(){if(a.hasValue&&J(a,t[1])){const t=G(c.get(n).layerName),i=z(c.get(n).layerName),r=c.get(n).index.toString()+"-"+a.index.toString(),o=yield U(c.get(n),a),s={displayField:Ct(i,a).originalFieldAlias,displayValue:Et(t,M,a,p),background:o,order:c.get(n).index};e.set(r,s)}})))),n}))).then(()=>{N(e)})}});isNaN(i)||e()},[i]);const _=t.React.useMemo(()=>{if(E)return(0,d.getAllDatasourceFromMapWidgetId)(E.mapWidgetId)},[E]),V=()=>Pn(this,void 0,void 0,function*(){if(k)return k;{const e=yield(0,t.loadArcGISJSAPIModule)("esri/symbols/support/symbolUtils");return L(e),e}}),z=e=>M.filter(t=>t.eventName===e),G=e=>(0,d.isDefined)(f)?f.fields.filter(t=>t.alias.includes(".")&&t.alias.split(".")[0]===e):null,U=(e,t)=>Pn(this,void 0,void 0,function*(){const[n,a]=yield Promise.all([V(),Ft(t,null,!0)]),i=W(e),r=yield n.getDisplayedColor(a,{renderer:i.layer.renderer});return(0,d.isDefined)(r)?vn(r.r,r.g,r.b,.5):vn(255,255,255,0)}),W=e=>{if((0,d.isDefined)(_)&&_.length){const t=_.find(t=>t.layer.layerId.toString()===e.layerId);if((0,d.isDefined)(t))return t}return null},H=()=>{const e=null==g?void 0:g.mTolerance,t=[...c.keys()];for(let n=0;n<t.length;n++){const a=c.get(t[n]);if(a.isActive)for(let t=0;t<a.records.length;t++){const n=a.records[t];if(n.isPoint&&n.hasValue&&(0,d.atOrBetween)([i-r,i+r],n.fromMeasure,e))return[q(n.fromMeasure),n.fromMeasure]}}return[a,i]},q=e=>{if(isNaN(e))return NaN;const t=xt(e,h,v)+b-w;return Math.floor(t)},J=(e,t)=>{const n=null==g?void 0:g.mTolerance;return!(!(0,d.isWithinTolerance)(t,e.fromMeasure,n)&&!(0,d.isWithinTolerance)(t,e.toMeasure,n))||!e.isPoint&&t>e.fromMeasure&&t<e.toMeasure},Y=()=>(0,d.isDefined)(g)?g.measurePrecision:0,Z=()=>s||l,Q=t.React.useCallback(()=>{const e=E.view.map.findLayerById("marker-layer");e&&(e.removeAll(),E.view.map.remove(e))},[E.view.map]),K=t.React.useCallback(()=>{Q();const e=new u.default({id:"marker-layer",listMode:"hide"});return E.view.map.add(e),e},[E.view.map,Q]);return t.React.useEffect(()=>{if(R&&s){let e=K();(0,d.QueryMeasureOnRoute)(S,g,x,I,j.toString()).then(t=>{if(t){const n={type:"cim",data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0},offsetX:0,offsetY:10,size:25,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:21,ymax:21},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[17.17,14.33],[16.97,12.96],[16.38,11.37],[12.16,3.98],[11.2,1.94],[10.5,0],[9.8,1.96],[8.84,4.02],[4.61,11.41],[4.02,12.98],[3.83,14.33],[3.96,15.63],[4.34,16.88],[4.95,18.03],[5.78,19.04],[6.8,19.88],[7.95,20.49],[9.2,20.87],[10.5,21],[11.8,20.87],[13.05,20.5],[14.2,19.88],[15.22,19.05],[16.05,18.03],[16.66,16.88],[17.04,15.63],[17.17,14.33]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:0,color:[110,110,110,255]},{type:"CIMSolidFill",enable:!0,color:[47,87,167,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}],animations:[]}}},a=new B.default({geometry:t,symbol:n});(0,d.isDefined)(e)||(e=K()),e.add(a)}}).catch(e=>{console.log("error",e)})}else{const e=E.view.map.findLayerById("marker-layer");(0,d.isDefined)(e)&&Q()}},[j,s,R,S,g,x,I,E.view.map,K,Q]),t.React.useEffect(()=>()=>{Q()},[Q]),t.React.useEffect(()=>{R||Q()},[Q,R]),(0,e.jsx)("div",{ref:O,id:"sld-marker",className:`sld-marker sld-marker--pointer ${Z()?"sld-is-visible":""} `,style:{left:isNaN(T)?0:T},children:(0,e.jsx)(P.CalcitePopover,{id:"sld-marker-popover",style:{minWidth:14*(isNaN(j)?0:j.toFixed(Y()).toString().length)+"px",borderRadius:"5px",boxShadow:"4px 4px 8px 2px rgba(0, 0, 0, 0.3)",border:`1px solid ${$.colorUtils.colorMixOpacity(A.sys.color.surface.overlayHint,.5)}`},autoClose:void 0,closable:void 0,open:!!Z()||void 0,overlayPositioning:"absolute",placement:"auto-start",offsetDistance:15,offsetSkidding:10,scale:"s",label:j.toFixed(Y()),heading:j.toFixed(Y()),referenceElement:"sld-marker",children:s&&D.size>0&&(0,e.jsx)("div",{style:{padding:"10px",textWrap:"nowrap",maxHeight:m,overflow:"auto"},children:[...new Map([...D.entries()].sort((e,t)=>e[1].order-t[1].order)).keys()].map(t=>(0,e.jsx)("span",{children:(0,e.jsx)("div",{style:{background:D.get(t).background,marginBottom:"3px"},children:(0,e.jsx)(o.Label,{className:"label2",centric:!0,style:{margin:"2px 5px"},children:`${D.get(t).displayField}: ${D.get(t).displayValue}`})})},t))})})})}var Vn=I(73387),$n=I(38410),zn=I(82228),Bn=I(44927);const Gn=t.React.forwardRef((a,i)=>{const{trackRecord:r,eventInfo:s,eventRecords:l,featureLayer:c,eventFields:u,currentRecord:f,onApply:p}=a,[m,g]=t.React.useState(!1),[h,v]=t.React.useState(!1),[b,w]=t.React.useState(f),S=t.React.useRef(null),x=(0,$.getTheme)(),I=t.hooks.useTranslation(n),{networkDS:D}=y();t.React.useImperativeHandle(i,()=>({isEditPending:()=>!k(),applyEdit:()=>{L()}}));const N=t.React.useCallback((e,t,n)=>((0,d.isDefined)(e)&&(0,d.isDefined)(e.attributes)&&Object.keys(e.attributes).forEach(a=>{const i=t.find(e=>e.name===a),r=e.attributes[a];if("date"===(null==i?void 0:i.type)&&(0,d.isDefined)(r)){const t=new Date(r),i=(0,d.getDateWithTZOffset)(t.valueOf(),n).valueOf();e.attributes[a]=i}}),e),[]);t.React.useEffect(()=>{w(N(f,u,D))},[N,f]);const M=()=>{const e=[];let t=[...r.attributes.keys()];t=t.filter(e=>e!==s.eventIdFieldName);for(let n=0;n<u.length;n++)if(u[n].editable&&t.includes(u[n].name))if("date"===u[n].type){const t=new zn.default({fieldName:u[n].name,label:u[n].alias,input:new Bn.default({includeTime:!1})});e.push(t)}else{const t=new zn.default({fieldName:u[n].name,label:u[n].alias,editableExpression:"true"});e.push(t)}return new $n.default({elements:e})};t.React.useEffect(()=>{if((0,d.isDefined)(c)&&(0,d.isDefined)(b)&&c&&l.length>0){const e=document.getElementById("formDiv");S.current=new Vn.default({container:e,layer:c,feature:b,formTemplate:M()}),S.current.on("submit",e=>{const{invalid:t,values:n}=e;if(t.length)return;Object.keys(n).forEach(e=>{var t;if(r.attributes.has(e))if("date"===(null===(t=u.find(t=>t.name===e))||void 0===t?void 0:t.type)){const t=(0,d.getDateWithoutTZOffset)(n[e],D).valueOf();r.attributes.set(e,t)}else r.attributes.set(e,n[e])}),b.attributes=n,g(!1),w(b),p(r)}),S.current.on("value-change",e=>{var t,n;const{feature:a,fieldName:i,value:r}=e,o=null===(t=S.current.viewModel)||void 0===t?void 0:t.submittable;v(o),r!==(null===(n=null==a?void 0:a.attributes)||void 0===n?void 0:n[i])?g(!0):g(!1)})}},[b]);const k=()=>!m||!h,L=()=>{var e;null===(e=S.current.viewModel)||void 0===e||e.submit()};return(0,e.jsx)("div",{className:"editable-fields d-flex w-100 h-100",style:{flexDirection:"column"},children:(0,e.jsxs)("div",{style:{background:x.sys.color.surface.paper},css:(0,d.getCalciteBasicTheme)(),children:[(0,e.jsx)(o.Label,{size:"lg",centric:!0,className:"title3",style:{paddingLeft:"15px",margin:"0px"},children:I("editableFields")}),(0,e.jsx)("div",{id:"formDiv",style:{width:"100%",backgroundColor:x.sys.color.surface.paper}}),(0,e.jsx)(P.CalciteButton,{style:{padding:"0px 15px 15px 15px"},appearance:"solid",scale:"m",width:"full",alignment:"center",kind:"brand",disabled:!!k()||void 0,label:I("apply"),onClick:L,children:I("apply")})]})})});function Un(a){const{eventInfo:i,allowEditing:r,eventFields:s,subtypeLayers:l,featureLayer:c,currentRecord:u}=a,f=t.hooks.useTranslation(n),{networkDS:p}=y(),m=(0,$.getTheme)(),g=e=>{if((0,d.isDefined)(u)){const t=u.attributes[e.name];return function(e,t,n,a,i){return Rt(Tt(e,null,t),e,null,n,a,0,i)}(e,c,t,l,p)}};return(0,e.jsx)("div",{className:"non-editable-fields d-flex w-100 h-100",style:{flexDirection:"column",paddingTop:"15px"},children:(0,e.jsxs)("div",{style:{background:m.sys.color.surface.paper,padding:"0px 15px 15px 15px"},css:(0,d.getCalciteBasicTheme)(),children:[(0,e.jsx)(o.Label,{size:"lg",centric:!0,className:"title3",style:{margin:"0px"},children:f(r?"nonEditableFields":"fieldsLabel")}),(0,e.jsxs)(P.CalciteTable,{caption:f("nonEditableFields"),bordered:!0,className:"table-container",scale:"m",layout:"fixed",children:[(0,e.jsxs)(P.CalciteTableRow,{slot:"table-header",children:[(0,e.jsx)(P.CalciteTableHeader,{heading:f("attribute")}),(0,e.jsx)(P.CalciteTableHeader,{heading:f("value")})]}),(()=>{var e,t,n,a;if(!(0,d.isDefined)(u))return[];let o=(0,d.getExistingFieldNames)().map(e=>e.toUpperCase());o=o.concat([null===(e=null==c?void 0:c.editFieldsInfo)||void 0===e?void 0:e.creationDateField,null===(t=null==c?void 0:c.editFieldsInfo)||void 0===t?void 0:t.creatorField,null===(n=null==c?void 0:c.editFieldsInfo)||void 0===n?void 0:n.editorField,null===(a=null==c?void 0:c.editFieldsInfo)||void 0===a?void 0:a.editDateField,null==c?void 0:c.objectIdField,null==c?void 0:c.globalIdField].filter(Boolean).map(e=>e.toUpperCase()));const l=s.filter(e=>!(o.includes(e.name.toUpperCase())||o.includes(e.alias.toUpperCase())));if(r){const e=l.filter(e=>!e.editable),t=i.lrsFields.map(e=>e.alias);let n=s.filter(e=>t.includes(e.alias));return n=n.concat(e),n}return l})().map((t,n)=>(0,e.jsxs)(P.CalciteTableRow,{children:[(0,e.jsx)(P.CalciteTableCell,{alignment:"center",children:(0,e.jsx)("div",{className:"w-100 d-flex",children:(0,e.jsx)(o.Label,{title:t.alias,className:"text-truncate label2",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"},children:t.alias})})}),(0,e.jsx)(P.CalciteTableCell,{alignment:"center",children:(0,e.jsx)("div",{className:"w-100 d-flex",children:(0,e.jsx)(o.Label,{title:g(t),className:"text-truncate label2",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"},children:g(t)})})})]},n))]})]})})}var Wn=I(46420),Hn=I.n(Wn),qn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(n[a[i]]=e[a[i]])}return n};const Jn=n=>{const a=window.SVG,{className:i}=n,r=qn(n,["className"]),o=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:o,src:Hn()},r)):(0,e.jsx)("svg",Object.assign({className:o},r))};var Yn=I(85633);const Zn=t.React.forwardRef((a,i)=>{const{track:r,trackRecord:s,eventEsriFields:l,eventInfo:c,currentRecord:u,allRecords:f,networkInfo:p,featureLayer:m,refresh:g}=a,[h,y]=t.React.useState(null),[v,b]=t.React.useState([]),[w,S]=t.React.useState([]),x=t.hooks.useTranslation(n),I=(0,$.getTheme)();t.React.useImperativeHandle(i,()=>({getStats:()=>w})),t.React.useEffect(()=>{if((0,d.isDefined)(c)&&(0,d.isDefined)(l)){const e=D();M(e)}},[r,s,c,l,u]),t.React.useEffect(()=>{if(g){const e=D();M(e)}},[g]);const D=()=>{const e=c.lrsFields.map(e=>e.alias),t=(0,d.getExistingFieldNames)(),n=l.filter(n=>(0,d.isNumber)(n.type)&&!e.includes(n.alias)&&!t.includes(n.name.toUpperCase())&&!(0,d.isDefined)(n.domain)&&s.attributes.has(n.name));return b(n),n.length?(y(n[0]),n[0]):null},N=(e,t,n,a,i,r)=>{var o,s,l,c,u,d;const f=[];return f.push([x("historicalFirstLabel"),null!==(o=null==e?void 0:e.toString())&&void 0!==o?o:""]),f.push([x("historicalLastLabel"),null!==(s=null==t?void 0:t.toString())&&void 0!==s?s:""]),f.push([x("historicalMinimumLabel"),null!==(l=null==n?void 0:n.toString())&&void 0!==l?l:""]),f.push([x("historicalMaximumLabel"),null!==(c=null==a?void 0:a.toString())&&void 0!==c?c:""]),f.push([x("meanLabel"),null!==(u=null==i?void 0:i.toString())&&void 0!==u?u:""]),f.push([x("medianLabel"),null!==(d=null==r?void 0:r.toString())&&void 0!==d?d:""]),f},M=e=>{var t,n;let a=N();if((0,d.isDefined)(f)&&(0,d.isDefined)(u)&&(0,d.isDefined)(p)&&(0,d.isDefined)(e)&&f.length){const i=null===(t=null==m?void 0:m.editFieldsInfo)||void 0===t?void 0:t.creationDateField,o=new Map;r.records.forEach(e=>{const t=vt(e);isNaN(t)||o.set(t,e)});let s=null,l=null,c=NaN,u=NaN,p=NaN,g=NaN,h=NaN,y=NaN;const v=[];if(f.forEach(t=>{let n=t.attributes[e.name];const a=t.getObjectId();if(o.has(a)){n=o.get(a).attributes.get(e.name)}if((0,d.isDefined)(n)&&!isNaN(n)){const e=t.attributes[i];if((0,d.isDefined)(e)){const t=new Date(e);(!(0,d.isDefined)(s)||t<s)&&(c=n,s=t),(!(0,d.isDefined)(l)||t>l)&&(u=n,l=t)}v.push(n)}}),v.length>0){const e=k(v);g=ft(Math.min(...v),e),h=ft(Math.max(...v),e),y=ft(v.reduce((e,t)=>e+t,0)/v.length,e);const t=[...v].sort((e,t)=>e-t),i=null!==(n=Math.floor(t.length/2))&&void 0!==n?n:0;p=t.length%2?ft(t[i],e):ft((t[i-1]+t[i])/2,e),a=N(c,u,g,h,y,p)}}S(a)},k=e=>{let t=0;return e.forEach(e=>{const n=L(e);n>t&&(t=n)}),t},L=e=>{if(!isFinite(e))return 0;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n},E=v&&v.length;return(0,e.jsx)("div",{className:"statistics d-flex w-100 h-100",style:{flexDirection:"column",paddingTop:"15px"},children:E?(0,e.jsxs)("div",{style:{margin:"0px",background:I.sys.color.surface.paper,padding:"0px 15px 15px 15px"},css:(0,d.getCalciteBasicTheme)(),children:[(0,e.jsx)(o.Label,{className:"statistic-label text-truncate title3",size:"lg",centric:!0,style:{margin:"0px"},children:x("statistics")}),(0,e.jsx)(o.Select,{className:"statistics-select",style:{marginBottom:"15px"},value:h.alias,onChange:e=>{(e=>{const t=l.find(t=>t.alias===e);y(t),M(t)})(e.target.value)},children:v.map((t,n)=>(0,e.jsx)("option",{value:t.alias,children:t.alias},t.alias))}),(0,e.jsxs)(P.CalciteTable,{caption:x("statistics"),bordered:!0,className:"table-container",scale:"m",layout:"fixed",children:[(0,e.jsxs)(P.CalciteTableRow,{slot:"table-header",children:[(0,e.jsx)(P.CalciteTableHeader,{heading:x("attribute")}),(0,e.jsx)(P.CalciteTableHeader,{heading:x("value")})]}),w.map((t,n)=>(0,e.jsxs)(P.CalciteTableRow,{children:[(0,e.jsx)(P.CalciteTableCell,{alignment:"center",children:(0,e.jsx)("div",{className:"w-100 d-flex",children:(0,e.jsx)(o.Label,{title:t[0],className:"text-truncate label2",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"},children:t[0]})})}),(0,e.jsx)(P.CalciteTableCell,{alignment:"center",children:(0,e.jsx)("div",{className:"w-100 d-flex",children:(0,e.jsx)(o.Label,{title:t[1],className:"text-truncate label2",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"},children:t[1]})})})]},n))]})]}):(0,e.jsx)("div",{})})});var Qn=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function Kn(a){const{widgetId:i,track:r,allowEditing:s,trackRecord:l,trackFieldInfos:c,lrsLayers:u,subtypeLayers:f,networkInfo:p,showEventStatistics:m,featureLayer:g,onApply:h,onClose:b}=a,[S,x]=t.React.useState(!1),[I,D]=t.React.useState(!1),[N,M]=t.React.useState(""),[k,L]=t.React.useState("info"),[E,R]=t.React.useState(!1),[T,C]=t.React.useState(!1),[j,F]=t.React.useState(null),[O,A]=t.React.useState([]),[_,V]=t.React.useState(null),[z,G]=t.React.useState([]),[U,W]=t.React.useState(null),[H,q]=t.React.useState(null),[J,Y]=t.React.useState(null),[Z,Q]=t.React.useState(null),K=t.React.useRef(null),X=t.React.useRef(null),{pendingEdits:ee,selectedSldId:te,outputDataSources:ne,conflictPreventionEnabled:ae,networkDS:ie,currentRouteInfo:re}=y(),oe=v(),se=t.hooks.useTranslation(n),le=(0,$.getTheme)(),ce=(0,t.useIntl)();t.React.useEffect(()=>{(0,d.isDefined)(r)&&(0,d.isDefined)(l)?(x(!0),ue()):x(!1)},[r,l]),t.React.useEffect(()=>{(0,d.isDefined)(ne)&&2===ne.length&&(Y(ne[0]),Q(ne[1]))},[ne]),t.React.useEffect(()=>{E&&setTimeout(()=>{R(!1),M(""),L("success")},1e4)},[E]);const ue=()=>Qn(this,void 0,void 0,function*(){var e,n;const a=u.find(e=>e.serviceId.toString()===r.layerId);if((0,d.isDefined)(a)&&(0,d.isDefined)(a.eventInfo)){F(a.eventInfo);const i=t.DataSourceManager.getInstance().getDataSource(a.useDataSource.dataSourceId);if((0,d.isDefined)(i)){let r=i.getGDBVersion();r||(r="");const o=yield(0,d.getLayer)(a.useDataSource),s=o.createQuery(),c=l.attributes.get(w.routeIdName),f=null===(e=o.fields.find(e=>e.name===a.eventInfo.routeIdFieldName))||void 0===e?void 0:e.type;let m=[];if(null===(n=null==a?void 0:a.eventInfo)||void 0===n?void 0:n.canSpanRoutes){const e=u.find(e=>{var t;return(null===(t=null==e?void 0:e.networkInfo)||void 0===t?void 0:t.lrsNetworkId)===p.lrsNetworkId}),n=t.DataSourceManager.getInstance().getDataSource(e.useDataSource.dataSourceId);m=yield function(e,t,n){return we(this,void 0,void 0,function*(){var a,i;const r=e.routeIdFieldSchema.name,o=e.lineIdFieldSchema.name;let s=r+" = '"+t+"'";const l={where:s,outFields:[o]},c=yield n.query(l);if(0===(null===(a=null==c?void 0:c.records)||void 0===a?void 0:a.length))return null;s=o+" IN ('"+(null==c?void 0:c.records[0].getFieldValue(o))+"')";const u={where:s,outFields:[r]},d=yield n.query(u);return 0===(null===(i=null==d?void 0:d.records)||void 0===i?void 0:i.length)?null:null==d?void 0:d.records.map(e=>e.getFieldValue(r))})}(p,c,n)}s.outFields=["*"],"string"===f?m.length>1?s.where=`LOWER(${a.eventInfo.routeIdFieldName}) IN ('${m.join("','")}')`:s.where=`LOWER(${a.eventInfo.routeIdFieldName}) = LOWER('${c}')`:m.length>1?s.where=`${a.eventInfo.routeIdFieldName} IN ('${m.join("','")}')`:s.where=`${a.eventInfo.routeIdFieldName} = '${c}'`,s.gdbVersion=r,s.start=0;let g=[];yield o.queryFeatureCount(s).then(e=>Qn(this,void 0,void 0,function*(){for(;s.start<e;)s.num=2e3,yield o.queryFeatures(s).then(e=>{0===s.start?(W(i),G(o.fields),V(o),g=e.features):g=g.concat(e.features)}),s.start+=2e3;A(g),de(g,i,a.eventInfo)}))}}}),de=(e,t,n)=>{0===e.length?q(null):1===O.length?q(fe(O[0],l,n)):e.forEach(e=>{e.attributes[n.eventIdFieldName]===l.attributes.get(jt(c).originalFieldName)&&q(fe(e,l,n))})},fe=(e,t,n)=>{const a=e.attributes,i=Object.keys(a),r=t.attributes.get(w.fromMeasureName);if(a[n.fromMeasureFieldName]=!(0,d.isDefined)(r)||""===r||isNaN(Number(r))?r:ft(Number(r),p.measurePrecision),n.toMeasureFieldName&&n.toMeasureFieldName.length>0){const e=t.attributes.get(w.toMeasureName);a[n.toMeasureFieldName]=!(0,d.isDefined)(e)||""===e||isNaN(Number(e))?e:ft(Number(e),p.measurePrecision)}return i.forEach(e=>{t.attributes.has(e)&&(a[e]=t.attributes.get(e))}),e.attributes=a,e},pe=(e,n)=>Qn(this,void 0,void 0,function*(){var a,i,r;const o=j.isPointEvent?J:Z;let s=t.DataSourceManager.getInstance().getDataSource(o);if(s||(s=yield t.DataSourceManager.getInstance().createDataSource(o)),!s)return;const l=me(e);s.setSchema(l);const c=ge(),u=Object.assign(s.getDataSourceJson()),d=e.getLabel()+"_export";t.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(s,(0,t.Immutable)(Object.assign(Object.assign({},u),{label:d,disableExport:!1})));const f=[];null==n||n.forEach((e,t)=>{const n={},a=e.getFeature();if(a.attributes)for(const e in a.attributes){const t=a.attributes[e];null!=t&&(n[e]=t)}const i=new B.default({attributes:n,geometry:e.geometry});f.push(i)});const p=[],m=[],g=Object.keys(null==l?void 0:l.fields).filter(e=>c.includes(e)).reduce((e,t)=>(e[t]=null==l?void 0:l.fields[t],e),{});for(const e in g){let n="";n=g[e].type===t.JimuFieldType.Number?"double":g[e].type===t.JimuFieldType.Date?"date":"string";const a={alias:g[e].alias,name:g[e].name,type:n},i={fieldName:g[e].name,label:g[e].alias};m.push(a),p.push(i)}const h=new Yn.default({id:o+"_layer",title:o,fields:m,geometryType:j.isPointEvent?"point":"polyline",source:f,objectIdField:s.getSchema().idField,popupTemplate:{title:s.getLabel(),fieldInfos:p,content:[{type:"fields",fieldInfos:p}]},visible:!1,listMode:"hide"}),y=t.DataSourceManager.getInstance().getDataSource(o);h&&y&&(y.layer=h);const v=[];return v.push({records:n,dataSource:s,name:s.getLabel(),fields:c}),null===(a=t.DataSourceManager.getInstance().getDataSource(o))||void 0===a||a.setStatus(t.DataSourceStatus.Unloaded),null===(i=t.DataSourceManager.getInstance().getDataSource(o))||void 0===i||i.setCountStatus(t.DataSourceStatus.Unloaded),null===(r=t.DataSourceManager.getInstance().getDataSource(o))||void 0===r||r.addSourceVersion(),[o,v]}),me=e=>{const n={},a=e,i=null==a?void 0:a.getSchema().fields.asMutable({deep:!0}),r=he(),o=ye(),s=ve(),l=[];Object.keys(i).forEach(e=>{r.includes(e)&&l.push(i[e]),o.includes(e)&&l.push(i[e])}),s.forEach(e=>{l.push({alias:e[0],type:t.JimuFieldType.Number,jimuName:e[0],name:e[0]})}),null==l||l.forEach(e=>{n[null==e?void 0:e.jimuName]=e});return{label:e.getLabel()+"_export",idField:"OBJECTID",fields:n}},ge=()=>{const e=j.lrsFields.map(e=>e.name),t=ve().map(e=>e[0]),n=Object.values(w),a=[...l.attributes.keys()],i=c.filter(e=>e.isOidField).map(e=>e.featureFieldName);return[...e,...t,...a.filter(e=>!n.includes(e)&&e!==j.eventIdFieldName&&!i.includes(e))]},he=()=>j.lrsFields.map(e=>e.name),ye=()=>{const e=[];return Object.keys(H.attributes).forEach(t=>{l.attributes.has(t)&&e.push(t)}),e},ve=()=>K.current?K.current.getStats():[],be=(e,t)=>{const n={},a=he(),i=ve();return Object.keys(t.attributes).forEach(e=>{a.includes(e)&&(n[e]=t.attributes[e]),l.attributes.has(e)&&(n[e]=l.attributes.get(e))}),i.forEach(e=>{n[e[0]]=e[1]}),e.buildRecord({attributes:n,geometry:t.geometry})},xe=e=>{X.current&&X.current.isEditPending()&&!e?D(!0):(D(!1),R(!1),x(!1),F(null),A([]),V(null),G([]),q(null),oe({type:"SET_SELECTED_SLD_ID",value:""}),b())},Ie=t.React.useCallback(e=>Qn(this,void 0,void 0,function*(){let t=null;if(ae){const e=l.attributes.get(w.routeIdName),n=yield Me(re,u,e,ie,r.layerId);if(t=yield Se(n,ie,ce),t){if(M(t.toastMsg),"danger"===t.toastMsgType)return L("danger"),void R(!0);"info"===t.toastMsgType&&L("info")}}const n=new Map(ee),a={layerId:r.layerId,attributes:Ot(c,e,null==j?void 0:j.datasetName,!1)};n.set(te,a),oe({type:"SET_EDITS",value:n});const i=g.createQuery();i.outFields=["*"],i.where=yt(e)+` = ${vt(e)}`,g.queryFeatures(i).then(t=>{if(t.features.length>0){for(const n of t.features){const t=e.attributes.keys();for(const a of t){const t=e.fieldInfos.find(e=>e.originalFieldName===a);t&&(n.attributes[t.featureFieldName]=e.attributes.get(a))}}g.applyEdits({updateFeatures:t.features}).then(e=>{e.updateFeatureResults.length>0&&console.log("Feature updated successfully")}).catch(e=>{console.error("Error updating feature:",e)})}});const o=r.records.findIndex(e=>e.index===l.index);o>-1&&(r.records[o]=e,t||L("success"),R(!0),h(r),De())}),[oe,j,h,ee,te,r,c,l]),De=()=>{C(!0),setTimeout(()=>{C(!1)},200)};return(0,e.jsxs)(o.Modal,{size:"sm",isOpen:S,centered:!0,scrollable:!0,toggle:()=>{xe()},backdrop:"static",children:[(0,e.jsx)(o.ModalHeader,{title:null==r?void 0:r.layerName,toggle:()=>{xe()},children:(0,e.jsxs)("div",{className:"d-flex w-100",children:[null==r?void 0:r.layerName,(0,e.jsx)(o.Tooltip,{title:se("dataAction_ExportCSV"),children:(0,e.jsx)(o.Button,{style:{marginLeft:"auto",border:"none"},icon:!0,size:"sm",onClick:()=>Qn(this,void 0,void 0,function*(){if((0,d.isDefined)(U)&&(0,d.isDefined)(H)){const e=be(U,H);if(!(0,d.isDefined)(e))return;const n=yield pe(U,[e]);if(!(0,d.isDefined)(n))return;const a=n[0];if(a){const r=n[1],o=t.DataSourceManager.getInstance(),s=null==o?void 0:o.getDataSource(a);o.createDataSource((0,t.Immutable)({id:U.id+"_export",type:t.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:s.getSchema(),disableExport:!1})).then(n=>{n.setSourceRecords([e]);t.DataActionManager.getInstance().getSupportedActions(i,r,t.DataLevel.Records).then(e=>Qn(this,void 0,void 0,function*(){const n=e.export;if((null==n?void 0:n.length)>0){const e=n.filter(e=>"export-csv"===e.id);yield t.DataActionManager.getInstance().executeDataAction(e[0],r,t.DataLevel.Records,i)}})).catch(e=>{console.error(e)})})}}}),children:(0,e.jsx)(Jn,{})})})]})}),(0,e.jsxs)(o.ModalBody,{style:{maxHeight:"70vh",overflow:"auto",background:le.sys.color.surface.background},children:[(0,e.jsx)(P.CalciteNotice,{css:(0,d.getCalciteNoticeTheme)(le),style:{position:"sticky",top:0,zIndex:1,marginBottom:E?"15px":"0px",borderTop:E?`1px solid ${$.colorUtils.colorMixOpacity(le.sys.color.surface.overlayHint,.5)}`:"none",borderRight:E?`1px solid ${$.colorUtils.colorMixOpacity(le.sys.color.surface.overlayHint,.5)}`:"none",borderBottom:E?`1px solid ${$.colorUtils.colorMixOpacity(le.sys.color.surface.overlayHint,.5)}`:"none",borderLeft:0},open:!!E||void 0,icon:"check-circle",kind:k,scale:"s",width:"auto",closable:!0,onCalciteNoticeClose:e=>{R(!1)},children:(0,e.jsx)("div",{slot:"title",children:N.length>0?N:se("sldEditSuccessful")})}),(0,e.jsxs)(P.CalciteNotice,{css:(0,d.getCalciteNoticeTheme)(le),style:{position:"sticky",top:0,zIndex:1,marginBottom:I?"15px":"0px",borderTop:I?`1px solid ${$.colorUtils.colorMixOpacity(le.sys.color.surface.overlayHint,.5)}`:"none",borderRight:I?`1px solid ${$.colorUtils.colorMixOpacity(le.sys.color.surface.overlayHint,.5)}`:"none",borderBottom:I?`1px solid ${$.colorUtils.colorMixOpacity(le.sys.color.surface.overlayHint,.5)}`:"none",borderLeft:0},open:!!I||void 0,icon:"exclamation-mark-triangle",kind:"warning",scale:"s",width:"auto",children:[(0,e.jsx)("div",{slot:"title",children:se("applyEditTitle")}),(0,e.jsx)("div",{slot:"message",children:se("applyEditMessage")}),(0,e.jsx)("div",{slot:"actions-end",children:(0,e.jsxs)("div",{className:"d-flex",style:{flexDirection:"column",backgroundColor:le.sys.color.primary.main},children:[(0,e.jsx)(P.CalciteAction,{scale:"m",icon:"read-only-non-editable",text:"Discard","text-enabled":!0,appearance:"transparent",onClick:()=>{xe(!0)},style:{border:`2px solid ${le.sys.color.surface.paper}`}}),(0,e.jsx)(P.CalciteAction,{scale:"m",icon:"save",text:"Apply","text-enabled":!0,appearance:"transparent",onClick:()=>{var e;null===(e=X.current)||void 0===e||e.applyEdit(),setTimeout(()=>{X.current.isEditPending()||(D(!1),xe())},200)},style:{border:`2px solid ${le.sys.color.surface.paper}`,borderTop:0}})]})})]}),s&&(0,e.jsx)(Gn,{ref:X,trackRecord:l,eventInfo:j,eventRecords:O,eventFields:z,featureLayer:_,currentRecord:H,onApply:Ie}),(0,e.jsx)(Un,{eventInfo:j,allowEditing:s,eventFields:z,subtypeLayers:f,featureLayer:_,currentRecord:H}),m&&(0,e.jsx)(Zn,{ref:K,track:r,trackRecord:l,eventEsriFields:z,eventInfo:j,currentRecord:H,allRecords:O,networkInfo:p,featureLayer:_,refresh:T})]})]})}var Xn=I(26435),ea=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function ta(e,t,n,a,i){const r={type:"cim",data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,colorLocked:!0,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",fontFamilyName:"Arial",fontStyleName:"Bold",height:10,horizontalAlignment:"Center",offsetX:0,offsetY:23,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[0,0,0,255]}]},verticalAlignment:"Bottom",haloSize:1.5,haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}},textString:e.toString()}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0,z:0},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:25,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:66,ymax:133},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[33,132],[25.4,131.6],[18.8,130.3],[13.1,128.2],[8.5,125.3],[4.9,121.5],[2.4,117],[.8,111.6],[.3,105.4],[.3,35.8],[33,1],[65.8,35.8],[65.8,105.4],[65.3,111.6],[63.7,117],[61.2,121.5],[57.5,125.3],[52.9,128.2],[47.3,130.3],[40.6,131.6],[33,132]],[[33,73],[29.9,73.3],[26.8,74.1],[24,75.5],[21.4,77.3],[19.2,79.5],[17.4,82.1],[16.1,84.9],[15.3,88],[15,91.1],[16.3,98.1],[20.2,104.1],[26,108.1],[33,109.5],[35.9,109.3],[38.6,108.6],[41.3,107.5],[43.7,105.9],[45.8,104.1],[47.7,101.9],[49.1,99.4],[50.2,96.7],[50.8,94],[51,91.1],[50.7,88],[49.9,84.9],[48.6,82.1],[46.8,79.5],[44.6,77.3],[42,75.5],[39.2,74.1],[36.1,73.3],[33,73]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[0,196,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[66,0],[66,133],[0,133],[0,0]]]}},offsetY:10}],animations:[]}}},o={type:"cim",data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0,z:0},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:25,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:66,ymax:133},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[33,132],[25.4,131.6],[18.8,130.3],[13.1,128.2],[8.5,125.3],[4.9,121.5],[2.4,117],[.8,111.6],[.3,105.4],[.3,35.8],[33,1],[65.8,35.8],[65.8,105.4],[65.3,111.6],[63.7,117],[61.2,121.5],[57.5,125.3],[52.9,128.2],[47.3,130.3],[40.6,131.6],[33,132]],[[33,73],[29.9,73.3],[26.8,74.1],[24,75.5],[21.4,77.3],[19.2,79.5],[17.4,82.1],[16.1,84.9],[15.3,88],[15,91.1],[16.3,98.1],[20.2,104.1],[26,108.1],[33,109.5],[35.9,109.3],[38.6,108.6],[41.3,107.5],[43.7,105.9],[45.8,104.1],[47.7,101.9],[49.1,99.4],[50.2,96.7],[50.8,94],[51,91.1],[50.7,88],[49.9,84.9],[48.6,82.1],[46.8,79.5],[44.6,77.3],[42,75.5],[39.2,74.1],[36.1,73.3],[33,73]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,127,0,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,offsetY:10,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[66,0],[66,133],[0,133],[0,0]]]}}},{type:"CIMVectorMarker",enable:!0,size:10,colorLocked:!0,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",fontFamilyName:"Arial",fontStyleName:"Bold",height:10,horizontalAlignment:"Center",offsetX:0,offsetY:23,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[0,0,0,255]}]},verticalAlignment:"Bottom",haloSize:1.5,haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]},strikethrough:!1,underline:!1,angle:0},textString:t.toString()}],scaleSymbolsProportionally:!0,respectFrame:!0}],animations:[]}}},s=new B.default({geometry:n,symbol:r}),l=new B.default({geometry:a,symbol:o});i.addMany([s,l])}var na=I(36614),aa=I(97552),ia=I(54312),ra=I(90422),oa=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function sa(n){const{jimuMapView:a,widgetId:i,allowEditing:r,trackMap:o,measureRange:s,defaultRange:l,featureLayer:f,subtypeLayers:p,networkInfo:m,networkDS:g,lrsLayers:h,showEventStatistics:v,routeId:b,temporalViewDate:w}=n,[I,D]=t.React.useState(200),[N,M]=t.React.useState(!1),[k,L]=t.React.useState(!1),[E,R]=t.React.useState(0),[T,C]=t.React.useState(0),j=t.React.useRef(null),F=t.React.useRef(null),O=t.React.useRef(null),{refWidth:A}=(e=>{const[n,a]=t.React.useState({refWidth:0,refHeight:0});return t.React.useEffect(()=>{const t=e=>({refWidth:e.contentRect.width,refHeight:e.contentRect.offsetHeight});if(e.current){const n=new ResizeObserver(e=>{for(const n of e)a(t(n))});return n.observe(e.current),()=>{n.disconnect()}}},[e]),n})(j),P=t.React.useRef({startX:0,startY:0,scrollLeft:0,scrollTop:0}),[_,V]=t.React.useState(o),[$,z]=t.React.useState(0),[G,U]=t.React.useState(NaN),[W,H]=t.React.useState(0),[q,J]=t.React.useState(!1),[Y,Z]=t.React.useState(!1),[Q,K]=t.React.useState(null),[X,ee]=t.React.useState(null),[te,ne]=t.React.useState([]),{syncToMap:ae}=y(),ie=t.React.useRef(null),[re,oe]=t.React.useState(NaN),[se,le]=t.React.useState(NaN),ce=t.React.useRef(0),ue=t.React.useRef(0),de=t.React.useRef(!1),fe=t.React.useRef(null);t.React.useEffect(()=>{V(o)},[o]),t.React.useEffect(()=>{const e=(s.to-s.from)/l;R(e<1?1:e)},[l,s]);const pe=t.React.useCallback(e=>{fe.current||(fe.current="range"),R(e)},[]),me=e=>{if(M(!1),k){if(L(!1),!F.current)return;document.body.style.cursor="default"}},ge=e=>{if(N&&!k){if(e.pageX<140)return;D(e.pageX)}if(!N&&k&&F.current){e.preventDefault();const t=F.current,n=O.current,a=e.pageX-t.offsetLeft,i=e.pageY-n.offsetTop,r=1.5*(a-P.current.startX),o=1.5*(i-P.current.startY);t.scrollLeft=P.current.scrollLeft-r,n.scrollTop=P.current.scrollTop-o}},he=(e,t)=>{if(isNaN(e))return NaN;let n=T;(0,d.isDefined)(t)&&(n=t);let a=n+(e-I);return a<0&&(a=0),It(a,s,xe)},ye=e=>{if(!e||!e.currentTarget)return NaN;const t=e.currentTarget.getBoundingClientRect();return e.clientX-t.left+I},ve=t.React.useMemo(()=>{const e=document.createElement("div");e.style.cssText="overflow:scroll; visibility:hidden; position:absolute;",document.body.appendChild(e);const t=e.offsetWidth-e.clientWidth;return e.remove(),t},[]),be=t.React.useMemo(()=>{let e=0;return _.forEach(t=>{t.isActive?e+=S:e+=x}),e+ve},[ve,_]),we=t.React.useMemo(()=>{let e=0;return _.forEach(t=>{t.isActive?e+=S:e+=x}),e},[_]),Se=t.React.useMemo(()=>A-I-ve,[ve,A,I]),xe=t.React.useMemo(()=>(A-I-ve)*E,[ve,A,I,E]);t.React.useEffect(()=>{ce.current=A},[A]),t.React.useEffect(()=>{ue.current=E},[E]),t.React.useEffect(()=>{const e=ia.watch(()=>[a.view.stationary,a.view.extent],([e,t])=>{ae&&e&&(!fe.current&&de.current?(fe.current="extent",ke(t)):fe.current=null)});return()=>{e.remove()}},[a.view,ae,s]),t.React.useEffect(()=>{var e;if(!(0,d.isDefined)(n.routeId)||!(0,d.isDefined)(n.networkDS))return;const t=null===(e=n.jimuMapView.view)||void 0===e?void 0:e.spatialReference;(0,d.queryRouteId)(n.routeId,m,n.networkDS,t).then(e=>{var t;const n=null===(t=null==e?void 0:e.features[0])||void 0===t?void 0:t.geometry;ie.current=n}).catch(e=>{console.error(e)})},[n.routeId,n.networkDS,m]);const Ie=t.React.useCallback(Rn((e,i)=>oa(this,void 0,void 0,function*(){const r=yield function(e,n,a,i,r,o){return ea(this,void 0,void 0,function*(){let s="";s=a.getGDBVersion(),s||(s="");const l=i.networkUrl,c=`${l}/measureToGeometry`,u={f:"json",token:yield t.SessionManager.getInstance().getSessionByUrl(l).getToken(l),locations:[{routeId:r,fromMeasure:e,toMeasure:n}],temporalViewDate:(0,d.isDefined)(o)&&0!==o.valueOf()?o:"",gdbVersion:s};return yield(0,d.requestService)({method:"POST",url:c,params:u}).then(e=>e).catch(e=>{throw console.error("Error in getGeometryToMeasure:",e),new Error(e)})})}(e,i,n.networkDS,m,n.routeId,n.temporalViewDate);if(0===r.locations.length)return;let o=a.view.map.findLayerById("highlight-layer");o?o.removeAll():o=De();const s=r.locations[0].geometry;s&&(s.spatialReference=null==r?void 0:r.spatialReference,function(e,t,n,a,i){const{locations:r,spatialReference:o}=e,s=r[0].geometry;s&&(s.spatialReference=o);const l=new Xn.Polyline(s);c.geometryUtils.projectToSpatialReference([l],t.view.spatialReference).then(e=>{const r=new B.default({geometry:e[0]}).geometry.extent.expand(1.25);return null==t?void 0:t.view.goTo({center:r}).then(()=>{const e=l.getPoint(0,0),t=l.getPoint(0,l.paths[0].length-1);return ta(ft(a,3),ft(i,3),e,t,n),!0}).catch(e=>(console.error("Error in measureToGeometry:",e),!0))}).catch(e=>(console.error("Error in zoomToGeometry:",e),!0))}(r,a,o,e,i))}),1e3),[n.networkDS,m,n.routeId,n.temporalViewDate,a]),De=()=>{Ne();const e=new u.default({id:"highlight-layer",listMode:"hide"});return a.view.map.add(e),e},Ne=()=>{const e=n.jimuMapView.view.map.findLayerById("highlight-layer");e&&(e.removeAll(),a.view.map.remove(e))},Me=t.React.useCallback((e,t)=>{let n=function(e,t,n){const a=(t-e)/n;return a<1?1:a}(s.from,s.to,t-e);n<ue.current&&n<1?(R(1),n=1):R(n);const a=(ce.current-I-ve)*n,i=ce.current-I-ve;let r=xt(e,s,a);r>a-i&&(r=a-i),F.current.scrollLeft=r,C(r)},[s,ce,I,ve]),ke=e=>{try{if(n.jimuMapView.view.stationary&&ie.current){if(!na.execute(ie.current,e)){const t=e.expand(.75),a=aa.execute(ie.current,t);if(a){const e=a.getPoint(0,0),t=a.paths[a.paths.length-1].length-1,i=a.getPoint(a.paths.length-1,t);let r=n.jimuMapView.view.map.findLayerById("highlight-layer");r||(r=De()),r.removeAll();const o=ft(e.m,m.measurePrecision),s=ft(i.m,m.measurePrecision);ta(ft(e.m,3),ft(i.m,3),e,i,r),Me(o,s)}}}}catch(e){console.log(e)}};return t.React.useEffect(()=>()=>{Ne()},[]),t.React.useEffect(()=>{if(!ae)return Ne(),de.current=!1,void(fe.current=null);de.current?"range"===fe.current?Ie(re,se):"extent"===fe.current?setTimeout(()=>{fe.current=null},0):"ignore"===fe.current&&(fe.current="range"):(de.current=!0,Ie(re,se),fe.current="range")},[ae,re,se]),t.React.useEffect(()=>{const e=T,t=It(e,s,xe),n=It(e+Se,s,xe);oe(t),le(n)},[Se,xe,s,T]),(0,e.jsxs)("div",{ref:j,className:"dyn-seg-diagram-container h-100 w-100 d-flex",style:{flexDirection:"column"},onMouseUp:me,onMouseMove:ge,children:[(0,e.jsx)(Kn,{widgetId:i,track:Q,allowEditing:r,trackRecord:X,trackFieldInfos:te,lrsLayers:h,subtypeLayers:p,networkInfo:m,showEventStatistics:v,featureLayer:f,onApply:e=>{const t=new Map(_);t.set(e.layerName,e),V(t)},onClose:()=>{K(null),ee(null),ne(null)}}),(0,e.jsx)(_n,{x:$,m:G,snapTolerance:W,isPopupActive:q,isHoverActive:Y,trackMap:_,featureLayer:f,subtypeLayers:p,maxHeight:j.current?j.current.clientHeight-.3*j.current.clientHeight:0,networkInfo:m,measureRange:s,contentWidth:xe,sidebarWidth:I,scrollPos:T,networkDS:n.networkDS,routeId:n.routeId,temporalViewDate:n.temporalViewDate}),(0,e.jsx)(An,{sidebarWidth:I,bodyWidth:Se,contentWidth:xe,measureRange:s,zoom:E,scrollPosition:T,onZoomChange:pe,onNavForwardOrBack:e=>{if(!F.current)return;fe.current||(fe.current="range");const t=F.current,n=t.scrollLeft,a=t.clientWidth;t.scrollLeft=e?n+a:n-a},onNavStartOrEnd:e=>{if(!F.current)return;fe.current||(fe.current="range");const t=F.current;t.scrollLeft=e?t.scrollWidth:0},onClickOrHover:(e,t,n)=>{const a=ye(e),i=he(a),r=he(a+10);isNaN(a)||z(a),isNaN(i)||U(i),r&&i&&H(r-i),J(t),Z(n)},onDoubleClick:e=>oa(this,void 0,void 0,function*(){fe.current||(fe.current="ignore");const n=ye(e),i=he(n),r=yield function(e,n,a,i,r){return ea(this,void 0,void 0,function*(){let o="";o=n.getGDBVersion(),o||(o="");const s=a.networkUrl,l=`${s}/measureToGeometry`,c={f:"json",token:yield t.SessionManager.getInstance().getSessionByUrl(s).getToken(s),locations:[{routeId:i,measure:e}],temporalViewDate:(0,d.isDefined)(r)&&0!==r.valueOf()?r:"",gdbVersion:o};return yield(0,d.requestService)({method:"POST",url:l,params:c}).then(e=>e).catch(e=>{throw console.error("Error in getGeometryToMeasure:",e),new Error(e)})})}(i,g,m,b,w),{locations:o,spatialReference:s}=r,l=o[0].geometry;l.spatialReference=s;const u=new ra.default(l);return c.geometryUtils.projectToSpatialReference([u],a.view.spatialReference).then(e=>{const t=new B.default({geometry:e[0]});null==a||a.view.goTo({center:t})}).catch(e=>{console.log("error",e)})})}),(0,e.jsxs)("div",{className:"diagram-container h-100 w-100 d-flex",children:[(0,e.jsxs)("div",{ref:O,className:"sidebar-container h-100 d-flex",onScroll:e=>{F.current&&(F.current.scrollTop=e.target.scrollTop)},children:[(0,e.jsx)(_t,{trackMap:_,width:I,height:be,onTrackChanged:e=>{V(e)}}),(0,e.jsx)("div",{className:"sidebar-resizer d-flex",style:{height:be},onMouseDown:e=>{M(!0),e.preventDefault()},onMouseUp:me,onMouseMove:ge})]}),(0,e.jsx)("div",{ref:F,className:"sld-container h-100",onScroll:e=>{fe.current||(fe.current="range"),C(e.target.scrollLeft),O.current&&(O.current.scrollTop=e.target.scrollTop),F.current&&(F.current.scrollTop=e.target.scrollTop),U(he($))},onMouseDown:e=>{if(!F.current)return;const t=F.current,n=O.current,a=e.pageX-t.offsetLeft,i=e.pageY-n.offsetTop,r=t.scrollLeft,o=n.scrollTop;P.current={startX:a,startY:i,scrollLeft:r,scrollTop:o},L(!0),document.body.style.cursor="grabbing"},onMouseUp:me,onMouseMove:ge,children:(0,e.jsx)(jn,{trackMap:_,containerWidth:Se,height:we,contentWidth:xe,measureRange:s,featureLayer:f,subtypeLayers:p,onItemClick:(e,t,n)=>{K(t),ee(e),ne(n),J(!1),Z(!1)}})})]})]})}var la=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function ca(n){const{jimuMapView:a,allowEditing:i,temporalViewDate:r,widgetId:o,featureLayer:s,records:l,lrsLayers:c,attributeSet:u,measureRange:f,defaultRange:p,networkInfo:m,showEventStatistics:g}=n,[h,y]=t.React.useState(!0),[b,w]=t.React.useState(new Map),[S,x]=t.React.useState([]),I=v();t.React.useEffect(()=>{(0,d.isDefined)(l)?D(l):N()},[]);const D=e=>la(this,void 0,void 0,function*(){const t=yield T(c,u),n=de(s,c,t),a=yield ht(e,n,c,u,f,m);I({type:"SET_FIELD_INFO",value:n}),I({type:"SET_IS_LOADING",value:!1}),w(a),y(!0),x(t)}),N=()=>{I({type:"SET_FIELD_INFO",value:[]}),y(!1)};return(0,e.jsx)("div",{className:"dyn-seg-diagram h-100 w-100 d-flex",children:h&&(0,e.jsx)(sa,{widgetId:o,trackMap:b,allowEditing:i,measureRange:f,defaultRange:p,featureLayer:s,subtypeLayers:S,networkInfo:m,networkDS:n.networkDS,routeId:n.routeId,jimuMapView:a,temporalViewDate:r,lrsLayers:c,showEventStatistics:g})})}var ua=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function da(a){const{dynSegFeatureLayer:i,lrsLayers:r,attributeSet:s,intl:l,networkDS:c,routeId:u,currentRouteInfo:f,networkInfo:p,handleLockToast:m}=a,{fieldInfo:g,pendingEdits:h}=y(),[b,S]=t.React.useState(),[x,I]=t.React.useState(),[D,N]=t.React.useState([]),[M,k]=t.React.useState(),[L,E]=t.React.useState([]),[R,C]=t.React.useState([]),[j,F]=t.React.useState(""),[O,A]=t.React.useState(),[_,V]=t.React.useState(),{activeDate:$}=(0,d.useLrsDate)(),z=v(),B=t.hooks.useTranslation(n);t.React.useEffect(()=>{Q()},[c,p,g,r]),t.React.useEffect(()=>{T(r,s).then(e=>{C(e)})},[s,r]),t.React.useEffect(()=>{(null==p?void 0:p.supportsLines)&&Ie(p,u,c).then(e=>{e&&A(e)}).catch(e=>{console.error(e)})},[c,p,u]);const G=e=>{if(!D)return null;const t=D.find(t=>t.eventLayerId===b&&t.originalFieldName===e),n=i.fields.find(e=>e.name===t.featureFieldName);return n||null},U=(e,t)=>(0,d.isDefined)(t)?`${t} - ${e}`:e,W=e=>{V(e)},H=e=>{if(!x||!D)return Promise.resolve({valid:!0});const t=D.find(e=>e.eventLayerId===b&&e.originalFieldName===x),a=G(x);let i=e;const r=j.length>0,o=(0,d.validateField)(e,t.featureFieldName,void 0,a);return o.hasError?r?Promise.resolve({valid:!1,msg:o.message}):(F((0,d.formatMessage)(l,o.message,n)),W(i),Promise.resolve({valid:!1,msg:(0,d.formatMessage)(l,o.message,n)})):(a&&(0,d.isNumber)(a.type)&&(i=parseFloat(i)),F(""),W(i),Promise.resolve({valid:!0}))},q=e=>{const t=x,a=D.find(e=>e.eventLayerId===b&&e.originalFieldName===t),i=G(t),r=j.length>0,o=(0,d.validateRangeDomain)(e,a.featureFieldName,void 0,i);return o.hasError?r?{valid:!1,msg:o.message}:(F((0,d.formatMessage)(l,o.message,n)),W(e),{valid:!1,msg:(0,d.formatMessage)(l,o.message,n)}):(F(""),W(e),{valid:!0})},J=e=>{var t;const a=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(!a||isNaN(a.getTime()))return V(null),F(""),{valid:!0};const i=a.valueOf();if(!i)return V(null),F(""),{valid:!0};const r=x,o=D.find(e=>e.eventLayerId===b&&e.originalFieldName===r),s=G(r),c=j.length>0,u=(0,d.validateField)(a,o.featureFieldName,void 0,s);return u.hasError?c?{valid:!1,msg:u.message}:(F((0,d.formatMessage)(l,u.message,n)),W(i),{valid:!1,msg:(0,d.formatMessage)(l,u.message,n)}):(F(""),W(i),{valid:!0})},Y=e=>{W(e.target.value)},Z=(t,n)=>{const a=(()=>{const e=R.find(e=>e.id===b);if((0,d.isDefined)(e)&&(0,d.isDefined)(e.subtypes)){const t=e.subtypes.map(e=>({value:e.code,label:e.name}));if(t)return t}return[]})();if("text"===t||"number"===t)return(0,e.jsx)(o.TextInput,{style:{height:"32px"},autoFocus:!0,type:"text",size:"sm",value:_,onChange:e=>{W(e.currentTarget.value)},checkValidityOnAccept:H});if("date"===t)return(0,e.jsx)(P.CalciteInputDatePicker,{scale:"s",style:{height:"32px"},onCalciteInputDatePickerChange:J,placement:"top",overlayPositioning:"fixed",focusTrapDisabled:!0});if("domain"===t){const t=(i=n.domain,null===(r=null==i?void 0:i.codedValues)||void 0===r?void 0:r.map((t,n)=>{let a=t.code;return null===a&&(a="<null>"),(0,e.jsx)("option",{value:a,children:U(t.name,t.code)},n)}));return(0,e.jsx)(o.Select,{value:_,size:"sm",onChange:e=>{Y(e)},children:t})}return"subtype"===t?(0,e.jsx)(o.Select,{value:_,onChange:e=>{Y(e)},size:"sm",children:a.map((t,n)=>(0,e.jsx)("option",{value:t.value,children:U(t.label,t.value)},n))}):"range"===t?(0,e.jsx)(o.TextInput,{style:{height:"32px"},autoFocus:!0,size:"sm",value:_,onChange:e=>{W(e.currentTarget.value)},checkValidityOnAccept:q}):void 0;var i,r},Q=()=>{const e={},t=[];if(!g||0===g.length||!e)return{};g.forEach(n=>{const a=n.isEventIdField,i=n.exclude;!n.eventLayerId||a||i||(e[n.eventLayerId]?e[n.eventLayerId].push(n):(e[n.eventLayerId]=[n],t.push(n.eventLayerId)))}),e&&k(e);const n=e[t[0]];return N(n),E(t),S(t[0]),I(n[0].originalFieldName),e},K=(e,t)=>ua(this,void 0,void 0,function*(){const n=e.createQuery();return n.outFields=["*"],n.returnGeometry=!0,n.where=De(t,$),e.queryFeatures(n).then(e=>e.features).catch(e=>[])}),X=()=>ua(this,void 0,void 0,function*(){let e=_;"<null>"===e&&(e=null);const t=yield K(i,c),n=[],a=D.find(e=>e.eventLayerId===b&&e.originalFieldName===x);t.forEach(t=>{const i=t.clone();if(i.attributes[w.typeName]===a.EventType){const t=me(e,a,i,R);t.size>0?t.forEach((e,t)=>{i.attributes[t]=e}):i.attributes[a.featureFieldName]=e,n.push(i)}});const r={updateFeatures:n};yield i.applyEdits(r).then(e=>{if(e.updateFeatureResults.length>0){let e=new Map(h);n.forEach(t=>{t.attributes[w.typeName]===a.EventType&&(e=function(e,t,n,a){const i=ge(t,e.eventName),r=a.get(i),o=pe(n,t,e.eventName,!1),s=new Map(a);if((0,d.isDefined)(r))r.attributes=o,s.set(i,r);else{const t={layerId:e.eventLayerId,attributes:o};s.set(i,t)}return s}(a,t,D,e),z({type:"SET_EDITS",value:e}))})}}).catch(e=>{F(e.message)})});return(0,e.jsxs)("div",{style:{margin:"1rem",display:"flex",flexDirection:"column",width:"300px"},children:[(0,e.jsxs)(o.Label,{className:"title3",children:[B("eventLayer"),(0,e.jsx)(P.CalciteSelect,{scale:"s",label:B("eventLayer"),value:b,onCalciteSelectChange:e=>{S(e.target.value);const t=M[e.target.value];N(t),I(t[0].originalFieldName),V(null)},children:(()=>{const t=[];return L&&0!==L.length?(L.forEach(n=>{const a=M[n],i=a[0].eventName,r=a[0].eventLayerId;t.push((0,e.jsxs)(P.CalciteOption,{value:r,children:[" ",i||r," "]}))}),t):[]})()})]}),(0,e.jsxs)(o.Label,{className:"title3",style:{marginTop:"0.3rem"},children:[B("updateField"),(0,e.jsx)(P.CalciteSelect,{scale:"s",label:B("updateField"),value:x,onCalciteSelectChange:e=>{V(null),I(e.target.value)},children:(()=>{if(!b)return[];const t=[],n=M[b];return n&&0!==n.length?(n.forEach((n,a)=>{t.push((0,e.jsxs)(P.CalciteOption,{value:n.originalFieldName,children:[" ",n.originalFieldName," "]}))}),t):[]})()})]}),(0,e.jsxs)(o.Label,{className:"title3",style:{marginTop:"0.3rem"},children:[B("fieldValue"),(()=>{if(!x||!D)return null;const e=D.find(e=>e.eventLayerId===b&&e.originalFieldName===x),t=G(x),n=((e,t)=>{var n,a;return(null==t?void 0:t.isSubtypeField)?"subtype":(0,d.isDefined)(null==e?void 0:e.domain)&&(0,d.isCodedDomain)(null===(n=null==e?void 0:e.domain)||void 0===n?void 0:n.type)?"domain":(0,d.isDefined)(null==e?void 0:e.domain)&&(0,d.isRangeDomain)(null===(a=null==e?void 0:e.domain)||void 0===a?void 0:a.type)?"range":(0,d.isDate)(null==e?void 0:e.type)?"date":(0,d.isNumber)(null==e?void 0:e.type)?"number":"text"})(t,e);return Z(n,t)})()]}),(0,e.jsx)(P.CalciteButton,{onClick:()=>ua(this,void 0,void 0,function*(){let e;if(yield(0,d.isConflictPreventionEnabled)(c._url)){const t=(()=>{const e=p.lrsNetworkId,t=[],n=[],a=[],i=f;return L.forEach(t=>{const n=r.find(e=>e.serviceId.toString()===t.toString());n&&n.eventInfo.parentNetworkId===e&&a.push(t)}),a.forEach(e=>{p.supportsLines&&O?t.push(O):t.push(u),n.push(p.supportsLines)}),{networkId:[e],routeOrLineId:t,eventServiceLayerIds:a,isLine:n,status:d.LockAcquireStatus.EsriSuccess,details:[],routeInfo:i,lockAction:d.LockAction.Query}})(),n=c;if(e=yield Se(t,n,l),e){const t={title:e.toastMsg,body:"",type:e.toastMsgType};m(t,!1),yield X()}else{const e={title:B("editFieldSuccess"),body:"",type:"success"};m(e,!1),yield X()}}else yield X()}),disabled:(null==j?void 0:j.length)>0||void 0,style:{alignSelf:"flex-end",width:"50%",marginTop:"0.5rem"},children:B("update")})]})}var fa=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function pa(r){var s,u;const{widgetId:f,allowMerge:p,allowEditing:m,conflictPreventionEnabled:g,intl:h,selectedNetworkDataSource:S,routeInfo:x,lrsLayers:I,defaultNetwork:D,attributeSets:N,defaultPointAttributeSet:M,defaultLineAttributeSet:k,attributeInputType:L,mapHighlightColor:T,graphicsLayer:j,defaultDisplayType:F,defaultDiagramScale:_,jimuMapView:V,outputDataSources:z,showEventStatistics:B,useMapWidgetIds:G,onResetDataAction:U}=r,W=t.hooks.useTranslation(n),[H,q]=t.React.useState(I.find(e=>e.name===D)),[J,Y]=t.React.useState(null),[Z,Q]=t.React.useState(null),[K,X]=t.React.useState(null),[ee,te]=t.React.useState([]),[ne,ae]=t.React.useState([]),[ie,se]=t.React.useState(null),[le,ce]=t.React.useState(!1),[ue,de]=t.React.useState(!1),[fe,pe]=t.React.useState({title:"",body:"",type:"brand"}),[me,ge]=t.React.useState(!1),{isLoading:he,pendingEdits:ye,records:ve,display:be,selectedRecordIds:we,selectedSldId:Se,networkDS:xe}=y(),[Ie,Me]=t.React.useState(""),{activeDate:ke}=(0,d.useLrsDate)(),Le=(0,d.useVmsManager)(),Ee=v(),Re=(0,$.getTheme)();t.React.useEffect(()=>{const e=e=>{if(ye.size>0){const t=e;return t.preventDefault(),t&&(t.returnValue=""),""}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[ye]),t.React.useEffect(()=>{F&&Ee({type:"SET_DISPLAY",value:F}),S&&Ee({type:"SET_NETWORK_DS",value:S}),z&&Ee({type:"SET_OUTPUT_DATA_SOURCES",value:z}),(0,d.isDefined)(V)&&(Ee({type:"SET_CONFLICT_PREVENTION_ENABLED",value:g}),Ee({type:"SET_JIMU_MAP_VIEW",value:V})),(0,d.isDefined)(j)&&Ee({type:"SET_HIGHLIGHT_LAYER",value:j}),(0,d.isDefined)(T)&&Ee({type:"SET_HIGHLIGHT_COLOR",value:T})},[F,S,z,V,g,j,T,Ee]);const Te=t.React.useRef({stack:[],forwardStack:[]});t.React.useEffect(()=>{const e=Te.current.stack,t=Te.current.forwardStack,n=Le.stack||[],a=Le.forwardStack||[],i=W("_widgetLabel"),r=(e,t)=>e.filter(e=>e===t).length,o=r(e,i),s=r(t,i),l=r(n,i),c=r(a,i);(o>l&&c>s||s>c&&l>o||o+s>0&&l+c===0)&&je(Z),Te.current={stack:n,forwardStack:a}},[Le.stack,Le.forwardStack]),t.React.useEffect(()=>{(0,d.isDefined)(ke)&&(0,d.isDefined)(Z)&&je(Z)},[ke]),t.React.useEffect(()=>{if((0,d.isDefined)(S)&&(0,d.isDefined)(x)){const e=x.networkInfo.useRouteName;Ee({type:"SET_NETWORK_DS",value:S}),q(I.find(e=>e.layerType===d.LrsLayerType.Network&&e.networkInfo.lrsNetworkId===x.networkInfo.lrsNetworkId)),Y(e?x.routeName:x.routeId),je(x,S)}},[x]);const Ce=t.React.useCallback(()=>{var e;let t=I.find(e=>e.name===D);if(t||(t=I.find(e=>e.layerType===d.LrsLayerType.Network)),t){const n=(0,d.getDataSourceById)(null===(e=t.useDataSource)||void 0===e?void 0:e.dataSourceId);(0,d.isDefined)(n)&&(0,d.isDefined)(xe)&&n.id!==xe.id&&(Ee({type:"RESET_STATE",value:""}),Ee({type:"SET_IS_LOADING",value:!1}),Ee({type:"SET_NETWORK_DS",value:n}),q(t),Y(null),Q(null),Oe(null,[],null,!1,""))}},[I,D,xe,Ee]);t.React.useEffect(()=>{Ce()},[I,D]);const je=(e,t)=>fa(this,void 0,void 0,function*(){Ee({type:"RESET_STATE",action:""}),yield Fe(e,t)}),Fe=(e,n)=>fa(this,void 0,void 0,function*(){const a=Ne(xe,ke),i=yield _e(e),r=n||xe;if(0===i.length)return Oe(null,[],null,!1,W("noAttributeSetEvents")),Promise.resolve();let o=V;(0,d.isDefined)(o)||(o=(()=>{let e=null;if((null==G?void 0:G.length)>0){const t=c.MapViewManager.getInstance().getJimuMapViewGroup(null==G?void 0:G[0]);if(t&&t.jimuMapViews)for(const n in t.jimuMapViews)t.jimuMapViews[n].dataSourceId&&(t.jimuMapViews[n].isActive||void 0===t.jimuMapViews[n].isActive)&&(e=t.jimuMapViews[n])}return e})()),(0,d.isDefined)(o)||Ee({type:"SET_IS_LOADING",value:!1}),yield Ae(r,e,a).then(n=>fa(this,void 0,void 0,function*(){n?yield A(r,e,a,i,(null==Le?void 0:Le.historicMoment)||-1).then(n=>fa(this,void 0,void 0,function*(){const a=yield R(e.networkInfo,I,i,o);yield function(e,n,a){return E(this,void 0,void 0,function*(){if(!e||!n)return;let i=null,r=null,o=null;yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/Graphic","esri/geometry/SpatialReference"]).then(e=>{[i,r,o]=e}).then(()=>E(this,void 0,void 0,function*(){yield Promise.all(e.features.map(t=>E(this,void 0,void 0,function*(){const s=new o({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt}),l=new i(t.geometry);if(l.spatialReference=s,"Point"===t.attributes[w.typeName]&&1===l.paths.length&&2===l.paths[0].length){const e=l.getPoint(0,0),t=l.getPoint(0,1);e.x===t.x&&e.y===t.y&&(t.x+=a.xyTolerance,t.y+=a.xyTolerance,l.setPoint(0,1,t))}const c=Object.keys(t.attributes).filter(e=>(0,d.isDefined)(t.attributes[e])).reduce((e,n)=>(e[n]=t.attributes[n],e),{}),u=new r({geometry:l,attributes:c});yield n.applyEdits({addFeatures:[u.clone()]}).then(e=>E(this,void 0,void 0,function*(){if(e.addFeatureResults.length>0){let t=e.addFeatureResults[0].error,a=0;for(;(0,d.isDefined)(t)&&(t=yield C(n,u,t),(0,d.isDefined)(t)&&!(a>10));)a++}else console.error("Failed to add feature",e.addFeatureResults)})).catch(e=>{console.error("Failed to add feature",e)})})))}))})}(n,a,e.networkInfo).then(()=>{Oe(a,i,e,!0,"")})})).catch(e=>{Oe(null,[],null,!1,W("queryAttributeSetError"))}):Oe(null,[],null,!1,W("routeDoesNotExist"))}))}),Oe=(e,t,n,a,i)=>{X(e),ae(t),Q(n),Me(i),Ee({type:"SET_CURRENT_ROUTE_INFO",value:n}),a?(se({from:n.fromMeasure,to:n.toMeasure}),U(),Pe(e)):(Ee({type:"SET_RECORDS",value:[]}),Ee({type:"SET_ORIGINAL_RECORDS",value:[]}),Ee({type:"SET_IS_LOADING",value:!1}))},Ae=(e,t,n)=>new Promise(function(a,i){const r=e;(0,d.isDefined)(r)||a(!1);const o=t.networkInfo.useRouteName?t.routeName:t.routeId;(0,d.queryRouteIdOrName)(o.trim(),t.networkInfo,e,!1,!0,"",n).then(e=>{(0,d.isDefined)(e)&&e.features.length>0&&a(!0),a(!1)}).catch(e=>{a(!1)})}),Pe=e=>{if(!(0,d.isDefined)(e))return;const t=e.createQuery();t.outFields=["*"],t.returnGeometry=!0,t.where=De(xe,ke),t.orderByFields=[w.fromMeasureName],e.queryFeatures(t).then(e=>{Ee({type:"SET_RECORDS",value:e.features}),Ee({type:"SET_ORIGINAL_RECORDS",value:e.features}),0===e.features.length?(Me(W("noResults")),Ee({type:"SET_IS_LOADING",value:!1})):Me("")}).catch(e=>{Me(W("errorLoadingRecords")),Ee({type:"SET_RECORDS",value:[]}),Ee({type:"SET_ORIGINAL_RECORDS",value:[]}),Ee({type:"SET_IS_LOADING",value:!1})})},_e=e=>fa(this,void 0,void 0,function*(){var n;let a=N;if(!(0,d.isDefined)(a)){const i=null===(n=I.find(t=>t.id===e.networkInfo.id))||void 0===n?void 0:n.lrsUrl;a=(0,t.Immutable)(yield(0,d.getAttributeSets)(i,i))}const r=a.attributeSet.find(e=>e.title===M),o=a.attributeSet.find(e=>e.title===k);let s=[];L===i.LineAndPoint&&(s=O(e,I,r));const l=O(e,I,o);return s.concat(l)}),Ve=()=>(0,d.isDefined)(Z)?Z.networkInfo:null,$e=(e,t)=>{"danger"===e.type&&(e.time=6e4),pe(e),ce(!0),ge(t)},ze=(e,t,n)=>{var a,i,r,o,s,l,c,u;const f=e.geometry,p=(0,d.getRouteFromEndMeasures)(f),m=null!==(i=e.attributes[null===(a=null==t?void 0:t.networkInfo)||void 0===a?void 0:a.routeIdFieldName])&&void 0!==i?i:"",g=null!==(o=e.attributes[null===(r=null==t?void 0:t.networkInfo)||void 0===r?void 0:r.routeNameFieldName])&&void 0!==o?o:"",h=null!==(l=e.attributes[null===(s=null==t?void 0:t.networkInfo)||void 0===s?void 0:s.fromDateFieldName])&&void 0!==l?l:"",y=null!==(u=e.attributes[null===(c=null==t?void 0:t.networkInfo)||void 0===c?void 0:c.toDateFieldName])&&void 0!==u?u:"",v=(0,d.isDefined)(h)?(0,d.getDateWithTZOffset)(h,n):null,b=(0,d.isDefined)(y)?(0,d.getDateWithTZOffset)(y,n):null;return Object.assign(Object.assign({},(0,d.getInitialRouteInfoState)()),{routeId:m,routeName:g,fromMeasure:p[0].m,toMeasure:p[1].m,fromDate:v,toDate:b})},Be=e=>{0===(null==e?void 0:e.length)&&(Ce(),Q(null),Y(null))},Ge=(e,n)=>{var a;if(!n)return void Oe(null,[],null,!1,W("routeDoesNotExist"));if(""===e.trim())return Me(""),Ee({type:"RESET_STATE",value:""}),void Ee({type:"SET_IS_LOADING",value:!1});const i=null===(a=null==H?void 0:H.networkInfo)||void 0===a?void 0:a.useRouteName,r=(0,t.Immutable)(null==H?void 0:H.networkInfo);(0,d.queryRouteIdOrName)(e,r,xe,!1,!0,"",ke,!i,!0).then(n=>{var a,i,r,o;if(0===(null===(a=null==n?void 0:n.features)||void 0===a?void 0:a.length))return void Oe(null,[],null,!1,W("routeDoesNotExist"));if(1===(null===(i=null==n?void 0:n.features)||void 0===i?void 0:i.length)){const a=ze(null==n?void 0:n.features[0],H,xe),i={routeId:null!==(r=a.routeId)&&void 0!==r?r:"",routeName:null!==(o=a.routeName)&&void 0!==o?o:"",networkInfo:(0,t.Immutable)(null==H?void 0:H.networkInfo),fromMeasure:a.fromMeasure,toMeasure:a.toMeasure};return je(i),void Y(e)}const s=n.features.map(e=>ze(e,H,xe));te(s)})};return(0,e.jsxs)(P.CalcitePanel,{onClick:e=>{we.length>0&&Ee({type:"SET_SELECTED_RECORD_IDS",value:[]}),""!==Se&&Ee({type:"SET_SELECTED_SLD_ID",value:""})},children:[(0,e.jsxs)("div",{slot:"header-content",className:"d-flex",style:{flexDirection:"column",height:"40px"},children:[(()=>{var t,n,a,i,r,s;const l=(null===(t=null==H?void 0:H.networkInfo)||void 0===t?void 0:t.useRouteName)?null===(n=null==H?void 0:H.networkInfo)||void 0===n?void 0:n.routeNameFieldSchema.name:null===(a=null==H?void 0:H.networkInfo)||void 0===a?void 0:a.routeIdFieldSchema.name,c=(null===(i=null==H?void 0:H.networkInfo)||void 0===i?void 0:i.useRouteName)?null===(r=null==H?void 0:H.networkInfo)||void 0===r?void 0:r.routeNameFieldSchema.type:null===(s=null==H?void 0:H.networkInfo)||void 0===s?void 0:s.routeIdFieldSchema.type;return(0,e.jsxs)("div",{className:"d-flex",style:{flexDirection:"row"},children:[(0,e.jsx)(o.Label,{className:"title3",size:"sm",centric:!0,style:{marginBottom:"0px",marginRight:"5px"},children:(0,d.isDefined)(H)&&H.networkInfo.useRouteName?W("routeNameLabel"):W("routeIdLabel")}),(0,e.jsx)(d.IntellisenseTextInput,{defaultValue:J,value:J,dataSource:xe,widgetId:f,fieldName:l,fieldType:c,isDataSourceReady:(0,d.isDefined)(xe),onChange:Be,onAccept:Ge})]})})(),(0,e.jsxs)("div",{className:"d-flex",style:{flexDirection:"row"},children:[(0,e.jsx)(o.Label,{className:"label3",size:"sm",centric:!0,style:{marginBottom:"0px"},children:(()=>{const e=(0,d.isDefined)(xe)?Ne(xe,ke):null,t=(0,d.isDefined)(e)?e.toLocaleDateString():"";return W("dateLabel",{date:t})})()}),(0,e.jsx)(o.Label,{className:"label3",size:"sm",centric:!0,style:{paddingLeft:"10px",marginBottom:"0px"},children:(()=>{let e=NaN,t=NaN;if((0,d.isDefined)(Z)&&(0,d.isDefined)(H)&&(e=ft(Z.fromMeasure,H.networkInfo.measurePrecision),t=ft(Z.toMeasure,H.networkInfo.measurePrecision)),isNaN(e)||isNaN(t))return W("measureRangeNoValue");const n=(0,d.GetUnits)(Z.networkInfo.unitsOfMeasure,h);return W("measureRangeValue",{fromM:e,toM:t,units:n})})()})]})]}),be===a.Table&&K&&(0,e.jsx)(P.CalcitePopover,{placement:"auto-start",overlayPositioning:"fixed",label:W("fieldCalculatorLabel"),heading:W("fieldCalculatorLabel"),referenceElement:"field-calculator",children:(0,e.jsx)(da,{dynSegFeatureLayer:K,intl:h,lrsLayers:I,attributeSet:ne,networkDS:xe,networkInfo:Ve(),currentRouteInfo:Z,routeId:(0,d.isDefined)(Z)?Z.routeId:"",handleLockToast:$e})}),(0,e.jsx)(re,{attributeSet:ne,widgetId:f,allowEditing:m,highlightColor:T,onSave:e=>{pe(e),ce(!0),ge(!0),de(!0)},lrsLayers:I,networkDS:xe,networkInfo:Ve(),jimuMapView:V,dynSegFeatureLayer:K,intl:h,allowMerge:p,routeId:(0,d.isDefined)(Z)?Z.routeId:"",routeInfo:Z}),(0,e.jsxs)("div",{className:"h-100",children:[(0,e.jsx)(b,{isLoading:he}),le&&(0,e.jsx)(oe,{open:le,messageProp:fe,onClose:()=>{ce(!1),"success"===fe.type&&(pe({title:"",body:"",type:"brand"}),me&&(ue?(de(!1),(0,d.waitTime)(300).then(()=>{je(Z)})):(0,d.isDefined)(K)&&(Ee({type:"SET_RECORDS",value:[]}),Ee({type:"SET_ORIGINAL_RECORDS",value:[]}),(0,d.waitTime)(100).then(()=>{Pe(K)})),ge(!1)))}}),(0,d.isDefined)(K)&&(0,d.isDefined)(Z)&&ve.length>0&&(be===a.Table?(0,e.jsx)(mt,{intl:h,allowEditing:m,featureLayer:K,records:ve,lrsLayers:I,attributeSet:ne,networkInfo:Z.networkInfo,networkDS:xe,currentRouteInfo:Z,routeId:(0,d.isDefined)(Z)?Z.routeId:"",handleLockToast:$e}):(0,e.jsx)(ca,{intl:h,allowEditing:m,widgetId:f,featureLayer:K,records:ve,lrsLayers:I,attributeSet:ne,measureRange:ie,defaultRange:_,networkInfo:Z.networkInfo,networkDS:xe,routeId:(0,d.isDefined)(Z)?Z.routeId:"",temporalViewDate:Ne(xe,ke),jimuMapView:V,showEventStatistics:B})),0===ve.length&&!he&&(0,e.jsxs)("div",{className:"d-flex",style:{padding:"2.5%",width:"100%",height:"100%",flexDirection:"column"},children:[!Ie&&(0,e.jsx)(o.Icon,{icon:l(),color:Re.sys.color.surface.overlayHint,className:"w-50 h-50",style:{margin:"auto auto 0px auto"}}),(0,e.jsxs)(o.Label,{className:"w-50 ml-auto label1",style:{color:Re.sys.color.surface.overlayHint,textAlign:"center",margin:"10px auto auto auto"},children:[!Ie&&(0,e.jsx)("p",{children:W("dataActionMessage")}),(0,e.jsx)("p",{children:Ie})]})]}),ee.length>1&&(0,e.jsx)(d.RoutePickerPopup,{routeInfos:ee,onRouteSelect:e=>{var n;te([]);const a=null===(n=null==H?void 0:H.networkInfo)||void 0===n?void 0:n.useRouteName;Y(a?e.routeName:e.routeId);const i={routeId:e.routeId,routeName:e.routeName,networkInfo:(0,t.Immutable)(null==H?void 0:H.networkInfo),fromMeasure:e.fromMeasure,toMeasure:e.toMeasure};je(i)},isOpen:ee.length>1,useRouteName:null===(s=null==H?void 0:H.networkInfo)||void 0===s?void 0:s.useRouteName,measurePrecision:null===(u=null==H?void 0:H.networkInfo)||void 0===u?void 0:u.measurePrecision,isFrom:!0,jimuMapView:V,showMeasure:!1,onRouteSelectCancel:()=>{te([])}})]})]})}function ma(e,n){return t.css`
    .table-indent {
      background-color: ${e.sys.color.surface.paper};
      width: calc(100% - 32px);
      height: calc(100% - 26px);
      margin: 0px 16px 16px;
      display: inline-block;
    }
    .dyn-seg-table-container {
      background-color: ${e.sys.color.surface.paper};
      -webkit-user-select: none; /* Safari */
      -moz-user-select: none; /* Firefox */
      -ms-user-select: none; /* IE10+/Edge */
      user-select: none; /* Standard */
    }
    .dyn-seg-row {
       --calcite-table-row-border-color: ${e.sys.color.surface.background};
    }
    .dyn-seg-cell.edited {
      --calcite-table-cell-background: ${$.colorUtils.colorMixOpacity(e.sys.color.warning.light,.4)};
    }
    .dyn-seg-cell.non-editable {
      --calcite-table-cell-background: ${$.colorUtils.colorMixOpacity(e.sys.color.action.disabled.default,.2)};
    }
    .dyn-seg-cell.error {
      --calcite-table-cell-background: ${$.colorUtils.colorMixOpacity(e.sys.color.error.main,.2)};
    }
    .dyn-seg-column-header {
       --calcite-table-header-background: ${e.sys.color.surface.background};
    }
    .dyn-seg-row-header {
      --calcite-table-cell-background: ${e.sys.color.surface.background};
    }
    .dyn-seg-row-header.selected {
      --calcite-table-cell-background: ${n};
    }
    .header-divider {
      border-left: 1px solid red;
      height: auto;
    }
    .header-divider::hover {
      border-left: 1px solid ${$.colorUtils.colorMixOpacity(e.sys.color.primary.light,.3)};
      height: 100%;
    }
    .toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      top: 0;
      z-index: 5;
    }
    .toast {
      position: relative;
      z-index: 999;
      }
    .toast-notice {
      transform: translateY(100px);
    }
    .sidebar-header {
      background-color: ${e.sys.color.surface.background};
      border: 1px solid ${e.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${S}px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sidebar-icon {
      width: 24px;
      height: 24px;
    }
    .sidebar-icon:hover {
      cursor: pointer;
      border: 1px solid ${e.sys.color.primary.main};
    }
    .header-actions {
      align-content: center;
    }
    .sidebar-item.active {
      background-color: ${e.sys.color.surface.background};
      border: 1px solid ${e.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${S}px;
      display: flex;
      align-items: center;
      font-weight: 500;
    }
    .sidebar-item.inactive {
      background-color: ${e.sys.color.surface.background};
      border: 1px solid ${e.sys.color.divider.primary};
      padding: 0px 16px;
      height: ${x}px;
      display: flex;
      align-items: center;
      font-weight: 500;
    }
    .sidebar-item:hover {
      cursor: pointer;
      border: 1px solid ${e.sys.color.primary.main};
      background-color: ${e.sys.color.action.hover};
    }
    .sidebar-resizer {
      width: 10px;
      margin: 0px -5px;
      z-index: 1;
    }
    .sidebar-resizer:hover {
      border-left: 5px solid ${$.colorUtils.colorMixOpacity(e.sys.color.divider.inputField,.5)};
      border-right: 5px solid ${$.colorUtils.colorMixOpacity(e.sys.color.divider.inputField,.5)};
      cursor: col-resize;
      }
    .header {
      height: ${S}px;
    }
    .diagram-container {
      overflow: hidden;
      -webkit-user-select: none; /* Safari */
      -moz-user-select: none; /* Firefox */
      -ms-user-select: none; /* IE10+/Edge */
      user-select: none; /* Standard */
    }
    .sidebar-container {
      overflow: auto;
      scrollbar-width: none;
      flex-direction: row;
    }
    .sld-container {
      flex-direction: row;
      overflow: auto;
    }
    .sld-row.active {
      border: 1px solid ${e.sys.color.divider.primary};
      background-color: ${e.sys.color.surface.paper};
      height: ${S}px;
    }
    .sld-row.inactive {
      border: 1px solid ${e.sys.color.divider.primary};
      background-color: ${e.sys.color.surface.paper};
      height: ${x}px;
    }
    .sld-body {
      overflow: hidden;
    }
    .sld-item-line-active {
      height: ${28}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
      border-radius: 5px;
      border: 1px solid ${e.sys.color.divider.primary};
    }
    .sld-item-point-active {
      height: ${N}px;
      width: ${N}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
    }
    .sld-item-line-inactive {
      height: ${12}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
      border-radius: 5px;
      border: 1px solid ${e.sys.color.divider.primary};
      background: ${e.sys.color.action.disabled.text};
    }
    .sld-item-point-inactive {
      height: ${x}px;
      width: ${x}px;
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: auto;
      margin-bottom: auto;
    }
    .sld-item-label-wrapper {
      overflow: hidden;
      height: ${x}px;
      line-height: ${x}px;
      margin: 4px;
      text-align: center;
    }
    .sld-item-selected-line {
      z-index: 1;
      border: 1px solid ${e.sys.color.primary.main};
      box-shadow: 0 0 3px 1px ${e.sys.color.primary.main};
    }
    .sld-item-selected-point {
      z-index: 1;
      filter: drop-shadow(0 0 4px ${e.sys.color.primary.main});
    }
    .sld-item-edited-point {
      border-radius: 2px;
      filter: drop-shadow(0 0 4px ${e.sys.color.warning.main});
    }
    .sld-item-edited-line {
      border: 1px solid ${e.sys.color.warning.main};
      box-shadow: 0 0 3px 1px ${e.sys.color.warning.main};
    }
    .sld-item-label-wrapper::before {
      content: '';
      display: inline-block;
    }
    .sld-item-label {
      display: inline-block;
      height: ${x}px;
      margin: 0px;
      padding: 0px 5px;
      text-align: center;
      align-content: center;
      font-weight: 700;
      border-radius: 5px;
    }
    .sld-item-line-active:hover{
      z-index: 1;
      border: 1px solid ${e.sys.color.primary.main};
      box-shadow: 0 0 3px 1px ${e.sys.color.primary.main};
    }
    .sld-item-point-active:hover {
      z-index: 1;
      filter: drop-shadow(0 0 3px ${e.sys.color.primary.main});
    }
    .sld-marker {
      position: absolute;
      z-index: 2;
      top: 60px;
      bottom: 0;
      margin-left: 1px;
      border-left: 2px dashed;
      opacity: 0;
      pointer-events: none;
    }
    .sld-marker--pointer {
      color: ${e.sys.color.action.focus};
    }
    .sld-marker.sld-is-visible {
      opacity: 1;
    }
    &.formDiv{
      .esri-feature-form {
        background-color: ${e.sys.color.surface.paper};
      }
    }
  `}var ga=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function ha(){const e={defaultDisplayType:a.Table,attributeInputType:i.LineOnly,defaultPointAttributeSet:"",defaultLineAttributeSet:"",attributeSets:{attributeSet:[]},mapHighlightColor:"#65adff",tableHighlightColor:"#65adff",defaultDiagramScale:3,showEventStatistics:!1,allowMerge:!1,allowEditing:!0,defaultNetwork:""};return(0,t.Immutable)(e)}var ya=I(4108),va=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};class ba extends t.React.PureComponent{constructor(e){super(e),this.supportedLrsLayerTypes=(0,t.Immutable)([d.LrsLayerType.Network,d.LrsLayerType.Event,d.LrsLayerType.LineEvent,d.LrsLayerType.PointEvent]),this.setSettingsPerView=()=>va(this,void 0,void 0,function*(){var e,n;const{config:r}=this.props,o=!(0,d.isDefined)(null===(e=r.settingsPerView)||void 0===e?void 0:e[this.state.activeMapViewId]);let s=(null===(n=r.settingsPerView)||void 0===n?void 0:n[this.state.activeMapViewId])||ha();if(this.state.activeLrsLayers&&this.state.activeLrsLayers.length>0){s=yield function(e,n){return ga(this,arguments,void 0,function*(e,n,r=!1){var o;const s=n.find(e=>e.layerType===d.LrsLayerType.Network);if((0,d.isDefined)(s)&&r){const n=(0,t.getAppStore)().getState().portalUrl,a=yield(0,d.getAttributeSets)(s.lrsUrl,n),i=(0,d.getDefaultAttributeSet)((0,t.Immutable)(a),e.defaultLineAttributeSet,!1),r=(0,d.getDefaultAttributeSet)((0,t.Immutable)(a),e.defaultPointAttributeSet,!0),l=function(e){switch(e){case"esriInches":return 190080;case"esriFeet":case"esriIntFeet":return 15840;case"esriYards":return 5280;case"esriMiles":case"esriDecimalDegrees":default:return 3;case"esriNauticalMiles":return 2.6;case"esriMillimeters":return 4828e3;case"esriCentimeters":return 482800;case"esriDecimeters":return 48280;case"esriMeters":return 4828;case"esriKilometers":return 4.828}}(null===(o=s.networkInfo)||void 0===o?void 0:o.unitsOfMeasure);e=e.setIn(["attributeSets"],a).setIn(["defaultLineAttributeSet"],i).setIn(["defaultPointAttributeSet"],r).setIn(["defaultDiagramScale"],l)}return e.set("defaultDisplayType",e.defaultDisplayType||a.Table).set("attributeInputType",e.attributeInputType||i.LineOnly).set("defaultPointAttributeSet",e.defaultPointAttributeSet||"").set("defaultLineAttributeSet",e.defaultLineAttributeSet||"").set("attributeSets",e.attributeSets||(0,t.Immutable)({attributeSet:[]})).set("mapHighlightColor",e.mapHighlightColor||"#65adff").set("tableHighlightColor",e.tableHighlightColor||"#65adff").set("allowMerge",e.allowMerge).set("allowEditing",e.allowEditing).set("defaultDiagramScale",e.defaultDiagramScale||3).set("showEventStatistics",e.showEventStatistics).set("defaultNetwork",e.defaultNetwork||s.name)})}(s,this.state.activeLrsLayers,o),this.setState({settingPerView:s});const e=r.setIn(["settingsPerView",this.state.activeMapViewId],s);(0,ya.getAppConfigAction)().editWidgetConfig(this.props.id,e).exec()}}),this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally(()=>{this.setState({jimuMapView:e})})},this.waitForChildDataSourcesReady=e=>va(this,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const n=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==n?void 0:n.isDataSourceSet())&&!n.areChildDataSourcesCreated()?n.childDataSourcesReady().then(()=>n).catch(e=>n):Promise.resolve(n)}),this.getI18nMessage=(e,t)=>{const a=Object.assign({},n,o.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:a[e]},t)},this.handleLrsLayersChanged=e=>{this.setState({activeLrsLayers:e})},this.handleViewChange=e=>{e&&this.setState({activeMapViewId:e.id})},this.state={hideTitle:!1,jimuMapView:void 0,highlightGraphicLayer:null,locationInfoFromDataAction:null,networkDataSourceFromDataAction:null,activeMapViewId:"",activeLrsLayers:null==e?void 0:e.config.lrsLayers,settingPerView:ha(),isConflictPreventionEnabled:!1},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentDidMount(){var e,t;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedDataSource)?this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource}):(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.routeLocationParams)&&this.setState({locationInfoFromDataAction:this.props.routeLocationParams});const n=(0,d.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:n}),this.setSettingsPerView(),this.setZIndex("21")}componentDidUpdate(e,n){var a,i,r,o,s,l,c,u,f,p;n.jimuMapView!==this.state.jimuMapView&&this.state.jimuMapView&&(this.removeGraphicLayer(),this.createGraphicLayer());const m=null===(r=null===(i=null===(a=(0,t.getAppStore)())||void 0===a?void 0:a.getState())||void 0===i?void 0:i.widgetsRuntimeInfo[this.props.id])||void 0===r?void 0:r.state;if((m===t.WidgetState.Opened||!m)&&((null===(o=this.props)||void 0===o?void 0:o.selectedNetworkDataSource)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedNetworkDataSource&&(null===(s=null==e?void 0:e.mutableStatePropsVersion)||void 0===s?void 0:s.selectedNetworkDataSource)===(null===(l=this.props.mutableStatePropsVersion)||void 0===l?void 0:l.selectedNetworkDataSource)||this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource})),null===(c=this.props)||void 0===c?void 0:c.routeLocationParams)){!(null===(u=this.props)||void 0===u?void 0:u.routeLocationParams)||e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.routeLocationParams&&(null===(f=null==e?void 0:e.mutableStatePropsVersion)||void 0===f?void 0:f.routeLocationParams)===(null===(p=this.props.mutableStatePropsVersion)||void 0===p?void 0:p.routeLocationParams)||this.setState({locationInfoFromDataAction:this.props.routeLocationParams})}this.state.activeLrsLayers!==n.activeLrsLayers&&this.setSettingsPerView();const{config:g}=this.props,h=g.mode&&g.mode!==d.ModeType.Map?g.lrsLayers:this.state.activeLrsLayers;h.length>0&&(0,d.checkConflictPrevention)(h[0].lrsUrl).then(e=>{const t=null!==e&&e;this.state.isConflictPreventionEnabled!==t&&this.setState({isConflictPreventionEnabled:t})})}resetDataAction(){this.setState({networkDataSourceFromDataAction:null}),this.setState({locationInfoFromDataAction:null})}componentWillUnmount(){this.removeGraphicLayer(),this.setZIndex()}setZIndex(e=""){const t=document.getElementById(this.widgetOuterDivId);if(t){const n=t.closest(".widget-renderer");n&&(n.style.zIndex=e)}}removeGraphicLayer(){(0,d.isDefined)(this.state.highlightGraphicLayer)&&(this.state.highlightGraphicLayer.removeAll(),this.state.highlightGraphicLayer.destroy(),this.setState({highlightGraphicLayer:null}))}createGraphicLayer(){var e;if((0,d.isDefined)(this.state.jimuMapView)){this.removeGraphicLayer();const t=new u.default({listMode:"hide"});null===(e=this.state.jimuMapView.view)||void 0===e||e.map.add(t),this.setState({highlightGraphicLayer:t})}}getConfigValues(e,t,n){const a={defaultDisplayType:t.defaultDisplayType,attributeInputType:t.attributeInputType,defaultPointAttributeSet:t.defaultPointAttributeSet,defaultLineAttributeSet:t.defaultLineAttributeSet,attributeSets:t.attributeSets,mapHighlightColor:t.mapHighlightColor,tableHighlightColor:t.tableHighlightColor,defaultDiagramScale:t.defaultDiagramScale,showEventStatistics:t.showEventStatistics,allowEditing:t.allowEditing,allowMerge:t.allowMerge,defaultNetwork:t.defaultNetwork};return Object.entries(a).reduce((t,[a,i])=>(t[a]=(0,d.getConfigValue)(e,a,n,i),t),{})}render(){var n,a;const{config:i,id:r,routeLocationParams:s,selectedNetworkDataSource:u,outputDataSources:f}=this.props;let p=this.props.useMapWidgetIds;const{mapViewsConfig:m}=i,g=i.mode&&i.mode!==d.ModeType.Map?i.lrsLayers:this.state.activeLrsLayers,y=this.getConfigValues(i,this.state.settingPerView,this.state.activeMapViewId),{defaultDisplayType:v,allowEditing:b,attributeInputType:w,defaultPointAttributeSet:S,defaultLineAttributeSet:x,attributeSets:I,mapHighlightColor:D,defaultDiagramScale:N,showEventStatistics:M,allowMerge:k,defaultNetwork:L}=y,{highlightGraphicLayer:E,jimuMapView:R}=this.state,T=this.props.theme,C=(0,d.getModeType)(i.mode,g),j=null==g?void 0:g.filter(e=>e.layerType===d.LrsLayerType.Network).length,F=null==g?void 0:g.filter(e=>e.layerType===d.LrsLayerType.Event).length,O=(null==g?void 0:g.length)>0&&j>0&&F>0;if(!p){const e=null===(a=null===(n=(0,t.getAppStore)())||void 0===n?void 0:n.getState())||void 0===a?void 0:a.appConfig;p=(0,d.findFirstArcgisMapWidgetId)(e)}return(0,e.jsx)(h,{children:(0,e.jsx)(o.Paper,{variant:"flat",shape:"none",className:"jimu-widget runtime-dynamic-segmentation surface-1 border-0 d-flex",css:ma(T,i.tableHighlightColor),children:(0,e.jsxs)("div",{id:this.widgetOuterDivId,className:"table-indent",children:[(0,e.jsx)(c.JimuMapViewComponent,{useMapWidgetId:null==p?void 0:p[0],onActiveViewChange:this.onActiveViewChange}),C&&(0,e.jsx)(d.MapViewLoader,{config:i,widgetId:r,supportedLrsLayerTypes:this.supportedLrsLayerTypes,useMapWidgetIds:p,mapViewsConfig:m,jimuMapView:R,outputDataSourceType:"sld",onLrsLayersChanged:this.handleLrsLayersChanged,onViewChange:this.handleViewChange}),O&&(0,e.jsx)(pa,{widgetId:r,allowMerge:k,allowEditing:b,conflictPreventionEnabled:this.state.isConflictPreventionEnabled,intl:this.props.intl,selectedNetworkDataSource:u,routeInfo:s,lrsLayers:g,defaultNetwork:L,attributeSets:I,defaultPointAttributeSet:S,defaultLineAttributeSet:x,attributeInputType:w,mapHighlightColor:D,graphicsLayer:E,defaultDisplayType:v,defaultDiagramScale:N,jimuMapView:R,outputDataSources:f,showEventStatistics:M,useMapWidgetIds:this.props.useMapWidgetIds,onResetDataAction:this.resetDataAction.bind(this)}),!O&&(0,e.jsx)(o.WidgetPlaceholder,{icon:l(),widgetId:r,message:this.getI18nMessage("_widgetLabel")})]})})})}}ba.mapExtraStateProps=(e,t)=>{var n,a;return{routeLocationParams:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.routeLocationParams,selectedNetworkDataSource:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedNetworkDataSource}};const wa=ba;function Sa(e){I.p=e}})(),D})())}}});