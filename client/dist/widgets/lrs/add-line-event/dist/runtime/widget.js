System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-arcgis","widgets/shared-code/lrs","esri/geometry/operators/disjointOperator","jimu-core/react","calcite-components","jimu-theme","esri/layers/GraphicsLayer","jimu-for-builder"],function(e,t){var o={},a={},n={},i={},s={},r={},u={},l={},c={},d={},f={};return{setters:[function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){a.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.Immutable=e.Immutable,a.JSAPILayerTypes=e.JSAPILayerTypes,a.MessageManager=e.MessageManager,a.React=e.React,a.RecordSetChangeType=e.RecordSetChangeType,a.WidgetState=e.WidgetState,a.classNames=e.classNames,a.css=e.css,a.focusElementInKeyboardMode=e.focusElementInKeyboardMode,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.utils=e.utils},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,n.Label=e.Label,n.Option=e.Option,n.Paper=e.Paper,n.Select=e.Select,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.WidgetPlaceholder=e.WidgetPlaceholder,n.defaultMessages=e.defaultMessages},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.AttributeTable=e.AttributeTable,s.CopyAttributeTool=e.CopyAttributeTool,s.GetUnits=e.GetUnits,s.InlineEditableDropdown=e.InlineEditableDropdown,s.Intellisense=e.Intellisense,s.LineConcurrencyTable=e.LineConcurrencyTable,s.LockAction=e.LockAction,s.LockManagerComponent=e.LockManagerComponent,s.LrsApplyEdits=e.LrsApplyEdits,s.LrsLayerType=e.LrsLayerType,s.MapViewLoader=e.MapViewLoader,s.ModeType=e.ModeType,s.QueryMeasureOnRoute=e.QueryMeasureOnRoute,s.QueryPolylineOnRoute=e.QueryPolylineOnRoute,s.QueryRouteConcurrencies=e.QueryRouteConcurrencies,s.QueryRouteMeasures=e.QueryRouteMeasures,s.RoutePicker=e.RoutePicker,s.RoutePickerPopup=e.RoutePickerPopup,s.SearchMethod=e.SearchMethod,s.atOrAfter=e.atOrAfter,s.atOrBefore=e.atOrBefore,s.atOrBetween=e.atOrBetween,s.checkConflictPrevention=e.checkConflictPrevention,s.convertStationToNumber=e.convertStationToNumber,s.findFirstArcgisMapWidgetId=e.findFirstArcgisMapWidgetId,s.getAttributeSets=e.getAttributeSets,s.getCalciteBasicTheme=e.getCalciteBasicTheme,s.getConfigValue=e.getConfigValue,s.getDateToUTC=e.getDateToUTC,s.getDateWithRouteTime=e.getDateWithRouteTime,s.getDateWithTZOffset=e.getDateWithTZOffset,s.getDateWithoutTZOffset=e.getDateWithoutTZOffset,s.getDateWithoutTime=e.getDateWithoutTime,s.getDefaultAttributeSet=e.getDefaultAttributeSet,s.getDefaultEvent=e.getDefaultEvent,s.getDefaultNetwork=e.getDefaultNetwork,s.getGeometryGraphic=e.getGeometryGraphic,s.getInitialEventInfoState=e.getInitialEventInfoState,s.getInitialRouteInfoState=e.getInitialRouteInfoState,s.getInitialRouteMeasurePickerInfoState=e.getInitialRouteMeasurePickerInfoState,s.getIntialLocksInfo=e.getIntialLocksInfo,s.getModeType=e.getModeType,s.getNetworkOutFields=e.getNetworkOutFields,s.getPolylineStartEndMValues=e.getPolylineStartEndMValues,s.getRouteFromEndMeasures=e.getRouteFromEndMeasures,s.getRouteMeasures=e.getRouteMeasures,s.getRoutesByRouteIds=e.getRoutesByRouteIds,s.getSimpleLineGraphic=e.getSimpleLineGraphic,s.getSimplePointGraphic=e.getSimplePointGraphic,s.getSuggestions=e.getSuggestions,s.getUUID=e.getUUID,s.isDate=e.isDate,s.isDefined=e.isDefined,s.isInWidgetController=e.isInWidgetController,s.isLineEvent=e.isLineEvent,s.isNumber=e.isNumber,s.queryAllRoutesByLineId=e.queryAllRoutesByLineId,s.queryAllRoutesByLineIdAndFromDate=e.queryAllRoutesByLineIdAndFromDate,s.queryRouteIdOrName=e.queryRouteIdOrName,s.queryRoutesByLineId=e.queryRoutesByLineId,s.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,s.useEditSession=e.useEditSession,s.useVmsManager=e.useVmsManager,s.validateField=e.validateField,s.validateRangeDomain=e.validateRangeDomain,s.waitTime=e.waitTime},function(){},function(e){u.useImperativeHandle=e.useImperativeHandle},function(e){l.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){c.getTheme=e.getTheme},function(e){d.default=e.default},function(e){f.getAppConfigAction=e.getAppConfigAction}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=c},4108:e=>{"use strict";e.exports=f},14321:e=>{"use strict";e.exports=n},26623:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M17 3H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h9v1H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h15a2 2 0 0 1 2 2v6h-1V4a1 1 0 0 0-1-1"></path><path fill="#000" d="M5.5 6.5v-2h-1v2H3v1h10.5v2h1v-2H16v-1zM13 12.5H3v-1h10zM16 18v-3h-3v-1h3v-3h1v3h3v1h-3v3z"></path></svg>'},36614:e=>{"use strict";e.exports=r},47626:e=>{"use strict";e.exports=s},59620:e=>{"use strict";e.exports=d},62686:e=>{"use strict";e.exports=i},67386:e=>{"use strict";e.exports=o},68972:e=>{"use strict";e.exports=u},79244:e=>{"use strict";e.exports=a},99037:e=>{"use strict";e.exports=l}},t={};function m(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,m),n.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var o in t)m.o(t,o)&&!m.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var h={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(h),m.d(h,{__set_webpack_public_path__:()=>Qa,default:()=>za});var e,t=m(67386),o=m(79244);!function(e){e.single="SINGLE",e.multiple="MULTIPLE"}(e||(e={}));const a={_widgetLabel:"Add Line Event",addToDominantRouteLabel:"Add event to dominant route",concurrenciesHeaderText:"Choose the concurrent route(s) that you would like to save the event(s) to. The dominant route is shown in blue.",dateRange:"Date Range",toStr:"to",dateToDate:"{fromDate} to {toDate}",nullStr:"null",typeLabel:"Type",eventLayerLabel:"Event",networkLabel:"Network",fromMethodLabel:"From Method",toMethodLabel:"To Method",fromRouteIdLabel:"From Route ID *",toRouteIdLabel:"To Route ID *",fromRouteNameLabel:"From Route Name *",toRouteNameLabel:"To Route Name *",fromMeasureLabel:"From Measure *",fromMeasureWithUnits:"From Measure ({units}) *",toMeasureWithUnits:"To Measure ({units}) *",selectRouteLabel:"Select Route",toMeasureLabel:"To Measure *",startDateLabel:"Start Date *",endDateLabel:"End Date",fromDateLabel:"From Date",toDateLabel:"To Date",routeIdLabel:"Route ID",measureLabel:"Measure",routeNameLabel:"Route Name",datesLabel:"Dates",nextLabel:"Next",singleOperation:"Single Line",multipleOperation:"Multiple Line",useStartDateLabel:"Use route start date",useEndDateLabel:"Use route end date",useStartMeasureLabel:"Use route start measure",useEndMeasureLabel:"Use route end measure",routeAndMeasure:"Route and Measure",coordinate:"Coordinate",locationOffset:"Location Offset",backLabel:"Back",saveLabel:"Save",selectAllLabel:"Select All",useMergeEventsLabel:"Merge coincident events",useRetireEventsLabel:"Retire overlapping events",resetForm:"Reset",nullLabel:"null",trueLabel:"true",falseLabel:"false",attributeError:"{fieldValue}: {message}",eventCreated:"Event Created",routeNotFound:"Route not found",routeNotOnSameLine:"From Route and To Route are not in the same line.",measureLessError:"Selected measure is less than route's from measure",measureGreaterError:"Selected measure is greater than route's to measure",fromMeasureGreaterThanToMeasureError:"From measure is greater than to measure",invalidMeasureError:"Input measure is invalid",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Valid exceeds maximum length of field: {value}.",invalidDate:"Invalid date.",invalidFromDateBefore:"Start date is before route start date",invalidFromDateAfter:"Start date is after route end date",invalidToDateBefore:"End date is before route start date",invalidToDateAfter:"End date is after route end date",invalidDatesOrder:"Selected start date is greater than selected end date",invalidDatesSameDay:"Start and end dates cannot be the same",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",noResult:"No results",attributeSetLabel:"Attribute Set",invalidContingentValues:"Attribute do not satisfy a required Contingent Value: {groupNames}",contingentValueError:"Invalid contingent value in the field",addMultipleLineEvents:"Add Multiple Line Events"};var n=m(14321),i=m(26623),s=m.n(i),r=m(62686),u=m(47626);function l(){const e=o.hooks.useTranslation(a);return(0,t.jsx)("div",{className:"add-line=event-form-header",children:(0,t.jsx)("div",{className:"add-single-line-event-form__header pt-3 px-3 align-items-center",children:(0,t.jsx)("div",{className:"add-single-line-event_title d-flex align-items-center text-truncate",css:o.css`
            font-weight: 500;
            font-size: 14px;
          `,children:(0,t.jsx)("div",{className:"text-truncate",children:e("_widgetLabel")})})})})}const c=function(){this.__data__=[],this.size=0};const d=function(e,t){return e===t||e!=e&&t!=t};const f=function(e,t){for(var o=e.length;o--;)if(d(e[o][0],t))return o;return-1};var p=Array.prototype.splice;const v=function(e){var t=this.__data__,o=f(t,e);return!(o<0)&&(o==t.length-1?t.pop():p.call(t,o,1),--this.size,!0)};const D=function(e){var t=this.__data__,o=f(t,e);return o<0?void 0:t[o][1]};const g=function(e){return f(this.__data__,e)>-1};const b=function(e,t){var o=this.__data__,a=f(o,e);return a<0?(++this.size,o.push([e,t])):o[a][1]=t,this};function I(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}I.prototype.clear=c,I.prototype.delete=v,I.prototype.get=D,I.prototype.has=g,I.prototype.set=b;const R=I;const y=function(){this.__data__=new R,this.size=0};const M=function(e){var t=this.__data__,o=t.delete(e);return this.size=t.size,o};const S=function(e){return this.__data__.get(e)};const T=function(e){return this.__data__.has(e)};const N="object"==typeof global&&global&&global.Object===Object&&global;var k="object"==typeof self&&self&&self.Object===Object&&self;const w=N||k||Function("return this")();const j=w.Symbol;var A=Object.prototype,L=A.hasOwnProperty,x=A.toString,O=j?j.toStringTag:void 0;const E=function(e){var t=L.call(e,O),o=e[O];try{e[O]=void 0;var a=!0}catch(e){}var n=x.call(e);return a&&(t?e[O]=o:delete e[O]),n};var C=Object.prototype.toString;const P=function(e){return C.call(e)};var F=j?j.toStringTag:void 0;const _=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":F&&F in Object(e)?E(e):P(e)};const G=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const V=function(e){if(!G(e))return!1;var t=_(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const U=w["__core-js_shared__"];var B,W=(B=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"";const z=function(e){return!!W&&W in e};var Q=Function.prototype.toString;const Z=function(e){if(null!=e){try{return Q.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var q=/^\[object .+?Constructor\]$/,H=Function.prototype,J=Object.prototype,$=H.toString,K=J.hasOwnProperty,X=RegExp("^"+$.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Y=function(e){return!(!G(e)||z(e))&&(V(e)?X:q).test(Z(e))};const ee=function(e,t){return null==e?void 0:e[t]};const te=function(e,t){var o=ee(e,t);return Y(o)?o:void 0};const oe=te(w,"Map");const ae=te(Object,"create");const ne=function(){this.__data__=ae?ae(null):{},this.size=0};const ie=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var se=Object.prototype.hasOwnProperty;const re=function(e){var t=this.__data__;if(ae){var o=t[e];return"__lodash_hash_undefined__"===o?void 0:o}return se.call(t,e)?t[e]:void 0};var ue=Object.prototype.hasOwnProperty;const le=function(e){var t=this.__data__;return ae?void 0!==t[e]:ue.call(t,e)};const ce=function(e,t){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=ae&&void 0===t?"__lodash_hash_undefined__":t,this};function de(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}de.prototype.clear=ne,de.prototype.delete=ie,de.prototype.get=re,de.prototype.has=le,de.prototype.set=ce;const fe=de;const me=function(){this.size=0,this.__data__={hash:new fe,map:new(oe||R),string:new fe}};const he=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const pe=function(e,t){var o=e.__data__;return he(t)?o["string"==typeof t?"string":"hash"]:o.map};const ve=function(e){var t=pe(this,e).delete(e);return this.size-=t?1:0,t};const De=function(e){return pe(this,e).get(e)};const ge=function(e){return pe(this,e).has(e)};const be=function(e,t){var o=pe(this,e),a=o.size;return o.set(e,t),this.size+=o.size==a?0:1,this};function Ie(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}Ie.prototype.clear=me,Ie.prototype.delete=ve,Ie.prototype.get=De,Ie.prototype.has=ge,Ie.prototype.set=be;const Re=Ie;const ye=function(e,t){var o=this.__data__;if(o instanceof R){var a=o.__data__;if(!oe||a.length<199)return a.push([e,t]),this.size=++o.size,this;o=this.__data__=new Re(a)}return o.set(e,t),this.size=o.size,this};function Me(e){var t=this.__data__=new R(e);this.size=t.size}Me.prototype.clear=y,Me.prototype.delete=M,Me.prototype.get=S,Me.prototype.has=T,Me.prototype.set=ye;const Se=Me;const Te=function(e,t){for(var o=-1,a=null==e?0:e.length;++o<a&&!1!==t(e[o],o,e););return e};const Ne=function(){try{var e=te(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const ke=function(e,t,o){"__proto__"==t&&Ne?Ne(e,t,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[t]=o};var we=Object.prototype.hasOwnProperty;const je=function(e,t,o){var a=e[t];we.call(e,t)&&d(a,o)&&(void 0!==o||t in e)||ke(e,t,o)};const Ae=function(e,t,o,a){var n=!o;o||(o={});for(var i=-1,s=t.length;++i<s;){var r=t[i],u=a?a(o[r],e[r],r,o,e):void 0;void 0===u&&(u=e[r]),n?ke(o,r,u):je(o,r,u)}return o};const Le=function(e,t){for(var o=-1,a=Array(e);++o<e;)a[o]=t(o);return a};const xe=function(e){return null!=e&&"object"==typeof e};const Oe=function(e){return xe(e)&&"[object Arguments]"==_(e)};var Ee=Object.prototype,Ce=Ee.hasOwnProperty,Pe=Ee.propertyIsEnumerable,Fe=Oe(function(){return arguments}())?Oe:function(e){return xe(e)&&Ce.call(e,"callee")&&!Pe.call(e,"callee")};const _e=Fe;const Ge=Array.isArray;const Ve=function(){return!1};var Ue="object"==typeof exports&&exports&&!exports.nodeType&&exports,Be=Ue&&"object"==typeof module&&module&&!module.nodeType&&module,We=Be&&Be.exports===Ue?w.Buffer:void 0;const ze=(We?We.isBuffer:void 0)||Ve;var Qe=/^(?:0|[1-9]\d*)$/;const Ze=function(e,t){var o=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==o||"symbol"!=o&&Qe.test(e))&&e>-1&&e%1==0&&e<t};const qe=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var He={};He["[object Float32Array]"]=He["[object Float64Array]"]=He["[object Int8Array]"]=He["[object Int16Array]"]=He["[object Int32Array]"]=He["[object Uint8Array]"]=He["[object Uint8ClampedArray]"]=He["[object Uint16Array]"]=He["[object Uint32Array]"]=!0,He["[object Arguments]"]=He["[object Array]"]=He["[object ArrayBuffer]"]=He["[object Boolean]"]=He["[object DataView]"]=He["[object Date]"]=He["[object Error]"]=He["[object Function]"]=He["[object Map]"]=He["[object Number]"]=He["[object Object]"]=He["[object RegExp]"]=He["[object Set]"]=He["[object String]"]=He["[object WeakMap]"]=!1;const Je=function(e){return xe(e)&&qe(e.length)&&!!He[_(e)]};const $e=function(e){return function(t){return e(t)}};var Ke="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xe=Ke&&"object"==typeof module&&module&&!module.nodeType&&module,Ye=Xe&&Xe.exports===Ke&&N.process;const et=function(){try{var e=Xe&&Xe.require&&Xe.require("util").types;return e||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}();var tt=et&&et.isTypedArray;const ot=tt?$e(tt):Je;var at=Object.prototype.hasOwnProperty;const nt=function(e,t){var o=Ge(e),a=!o&&_e(e),n=!o&&!a&&ze(e),i=!o&&!a&&!n&&ot(e),s=o||a||n||i,r=s?Le(e.length,String):[],u=r.length;for(var l in e)!t&&!at.call(e,l)||s&&("length"==l||n&&("offset"==l||"parent"==l)||i&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Ze(l,u))||r.push(l);return r};var it=Object.prototype;const st=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||it)};const rt=function(e,t){return function(o){return e(t(o))}};const ut=rt(Object.keys,Object);var lt=Object.prototype.hasOwnProperty;const ct=function(e){if(!st(e))return ut(e);var t=[];for(var o in Object(e))lt.call(e,o)&&"constructor"!=o&&t.push(o);return t};const dt=function(e){return null!=e&&qe(e.length)&&!V(e)};const ft=function(e){return dt(e)?nt(e):ct(e)};const mt=function(e,t){return e&&Ae(t,ft(t),e)};const ht=function(e){var t=[];if(null!=e)for(var o in Object(e))t.push(o);return t};var pt=Object.prototype.hasOwnProperty;const vt=function(e){if(!G(e))return ht(e);var t=st(e),o=[];for(var a in e)("constructor"!=a||!t&&pt.call(e,a))&&o.push(a);return o};const Dt=function(e){return dt(e)?nt(e,!0):vt(e)};const gt=function(e,t){return e&&Ae(t,Dt(t),e)};var bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,It=bt&&"object"==typeof module&&module&&!module.nodeType&&module,Rt=It&&It.exports===bt?w.Buffer:void 0,yt=Rt?Rt.allocUnsafe:void 0;const Mt=function(e,t){if(t)return e.slice();var o=e.length,a=yt?yt(o):new e.constructor(o);return e.copy(a),a};const St=function(e,t){var o=-1,a=e.length;for(t||(t=Array(a));++o<a;)t[o]=e[o];return t};const Tt=function(e,t){for(var o=-1,a=null==e?0:e.length,n=0,i=[];++o<a;){var s=e[o];t(s,o,e)&&(i[n++]=s)}return i};const Nt=function(){return[]};var kt=Object.prototype.propertyIsEnumerable,wt=Object.getOwnPropertySymbols;const jt=wt?function(e){return null==e?[]:(e=Object(e),Tt(wt(e),function(t){return kt.call(e,t)}))}:Nt;const At=function(e,t){return Ae(e,jt(e),t)};const Lt=function(e,t){for(var o=-1,a=t.length,n=e.length;++o<a;)e[n+o]=t[o];return e};const xt=rt(Object.getPrototypeOf,Object);const Ot=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Lt(t,jt(e)),e=xt(e);return t}:Nt;const Et=function(e,t){return Ae(e,Ot(e),t)};const Ct=function(e,t,o){var a=t(e);return Ge(e)?a:Lt(a,o(e))};const Pt=function(e){return Ct(e,ft,jt)};const Ft=function(e){return Ct(e,Dt,Ot)};const _t=te(w,"DataView");const Gt=te(w,"Promise");const Vt=te(w,"Set");const Ut=te(w,"WeakMap");var Bt="[object Map]",Wt="[object Promise]",zt="[object Set]",Qt="[object WeakMap]",Zt="[object DataView]",qt=Z(_t),Ht=Z(oe),Jt=Z(Gt),$t=Z(Vt),Kt=Z(Ut),Xt=_;(_t&&Xt(new _t(new ArrayBuffer(1)))!=Zt||oe&&Xt(new oe)!=Bt||Gt&&Xt(Gt.resolve())!=Wt||Vt&&Xt(new Vt)!=zt||Ut&&Xt(new Ut)!=Qt)&&(Xt=function(e){var t=_(e),o="[object Object]"==t?e.constructor:void 0,a=o?Z(o):"";if(a)switch(a){case qt:return Zt;case Ht:return Bt;case Jt:return Wt;case $t:return zt;case Kt:return Qt}return t});const Yt=Xt;var eo=Object.prototype.hasOwnProperty;const to=function(e){var t=e.length,o=new e.constructor(t);return t&&"string"==typeof e[0]&&eo.call(e,"index")&&(o.index=e.index,o.input=e.input),o};const oo=w.Uint8Array;const ao=function(e){var t=new e.constructor(e.byteLength);return new oo(t).set(new oo(e)),t};const no=function(e,t){var o=t?ao(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)};var io=/\w*$/;const so=function(e){var t=new e.constructor(e.source,io.exec(e));return t.lastIndex=e.lastIndex,t};var ro=j?j.prototype:void 0,uo=ro?ro.valueOf:void 0;const lo=function(e){return uo?Object(uo.call(e)):{}};const co=function(e,t){var o=t?ao(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)};const fo=function(e,t,o){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return ao(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return no(e,o);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return co(e,o);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return so(e);case"[object Symbol]":return lo(e)}};var mo=Object.create;const ho=function(){function e(){}return function(t){if(!G(t))return{};if(mo)return mo(t);e.prototype=t;var o=new e;return e.prototype=void 0,o}}();const po=function(e){return"function"!=typeof e.constructor||st(e)?{}:ho(xt(e))};const vo=function(e){return xe(e)&&"[object Map]"==Yt(e)};var Do=et&&et.isMap;const go=Do?$e(Do):vo;const bo=function(e){return xe(e)&&"[object Set]"==Yt(e)};var Io=et&&et.isSet;const Ro=Io?$e(Io):bo;var yo="[object Arguments]",Mo="[object Function]",So="[object Object]",To={};To[yo]=To["[object Array]"]=To["[object ArrayBuffer]"]=To["[object DataView]"]=To["[object Boolean]"]=To["[object Date]"]=To["[object Float32Array]"]=To["[object Float64Array]"]=To["[object Int8Array]"]=To["[object Int16Array]"]=To["[object Int32Array]"]=To["[object Map]"]=To["[object Number]"]=To[So]=To["[object RegExp]"]=To["[object Set]"]=To["[object String]"]=To["[object Symbol]"]=To["[object Uint8Array]"]=To["[object Uint8ClampedArray]"]=To["[object Uint16Array]"]=To["[object Uint32Array]"]=!0,To["[object Error]"]=To[Mo]=To["[object WeakMap]"]=!1;const No=function e(t,o,a,n,i,s){var r,u=1&o,l=2&o,c=4&o;if(a&&(r=i?a(t,n,i,s):a(t)),void 0!==r)return r;if(!G(t))return t;var d=Ge(t);if(d){if(r=to(t),!u)return St(t,r)}else{var f=Yt(t),m=f==Mo||"[object GeneratorFunction]"==f;if(ze(t))return Mt(t,u);if(f==So||f==yo||m&&!i){if(r=l||m?{}:po(t),!u)return l?Et(t,gt(r,t)):At(t,mt(r,t))}else{if(!To[f])return i?t:{};r=fo(t,f,u)}}s||(s=new Se);var h=s.get(t);if(h)return h;s.set(t,r),Ro(t)?t.forEach(function(n){r.add(e(n,o,a,n,t,s))}):go(t)&&t.forEach(function(n,i){r.set(i,e(n,o,a,i,t,s))});var p=d?void 0:(c?l?Ft:Pt:l?Dt:ft)(t);return Te(p||t,function(n,i){p&&(n=t[i=n]),je(r,i,e(n,o,a,i,t,s))}),r};const ko=function(e){return No(e,5)};var wo;!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(wo||(wo={}));var jo,Ao,Lo,xo,Oo,Eo,Co,Po;!function(e){e.Layer="Layer",e.Map="MAP"}(jo||(jo={})),function(e){e.Network="NETWORK",e.Event="EVENT",e.LineEvent="LINEEVENT",e.PointEvent="POINTEVENT",e.Intersection="INTERSECTION",e.Centerline="CENTERLINE",e.CalibrationPoint="CALIBRATIONPOINT",e.UtilityNetwork="UTILITYNETWORK",e.Addressing="ADDRESSING",e.NonLrs="NONLRS",e.NonLrsPoint="NONLRSPOINTS",e.NonLrsLine="NONLRSLINES"}(Ao||(Ao={})),function(e){e.Measure="ROUTEANDMEASURE",e.Coordinate="COORDINATE",e.LocationOffset="LOCATIONOFFSET",e.Referent="REFERENT",e.LineAndMeasure="LINEANDMEASURE"}(Lo||(Lo={})),function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(xo||(xo={})),function(e){e.LineId="LINEID",e.LineName="LINENAME"}(Oo||(Oo={})),function(e){e.Map="MAP",e.Lrs="LRS"}(Eo||(Eo={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(Co||(Co={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(Po||(Po={}));m(36614);function Fo(e,t=!0){return null!=e&&("string"==typeof e?""!==e.trim()||!t:"number"==typeof e?!isNaN(e):Array.isArray(e)?!t||0!==e.length:Boolean(e))}function _o(e){return Fo(e)?new Date(e.getFullYear(),e.getMonth(),e.getDate()):e}o.JSAPILayerTypes.FeatureLayer,o.JSAPILayerTypes.SceneLayer,o.JSAPILayerTypes.BuildingComponentSublayer,o.JSAPILayerTypes.OrientedImageryLayer,o.JSAPILayerTypes.ImageryLayer,o.JSAPILayerTypes.SubtypeSublayer;function Go(e,t,o,a,n,i,s){const r={};if(Fo(a))if(-1===e&&-1===o)a.forEach(e=>{r[e.name]=e.value});else{const t=a[o];a.forEach(o=>{r[o.name]=o.value,o.name===t.name&&(r[o.name]=e)})}else s.forEach(e=>{const t=i.attributes[e.name],o=e.alias.split(".")[1];r[o]=t});const u=[];for(const e of n){const t=e.isEditingRestrictive?"error":"warning";let o=!1;const a=e.contingencies.filter(e=>!e.isRetired);if(!a||0===a.length)return[];for(const e of a){let t=!0;for(const o in e.values){const a=e.values[o];if("any"!==a.objectType)if("null"===a.objectType){if(null!=r[o]){t=!1;break}}else if("code"===a.objectType){if(null!=a.codedValue&&r[o]!==a.codedValue.code){t=!1;break}}else if("range"===a.objectType){const e=r[o];if(null!=a.minValue&&null!=a.maxValue&&(e<a.minValue||e>a.maxValue)){t=!1;break}}}if(t){o=!0;break}}o||u.push({fieldGroup:e,type:t})}return u}var Vo=function(e,t,o,a){return new(o||(o=Promise))(function(n,i){function s(e){try{u(a.next(e))}catch(e){i(e)}}function r(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}u((a=a.apply(e,t||[])).next())})};let Uo=[];function Bo(e){var i;const s=o.hooks.useTranslation(a),{intl:r,widgetId:l,networkDS:c,network:d,eventDS:f,eventLayer:m,routeInfo:h,eventInfo:p,reset:v,jimuMapView:D,hoverGraphic:g,conflictPreventionEnabled:b,onNavBack:I,hasConcurrencies:R,addToDominantRoute:y,concurrenciesResponse:M}=e,[S,T]=o.React.useState(),[N,k]=o.React.useState(!1),[w,j]=o.React.useState(),[A,L]=o.React.useState(""),[x,O]=o.React.useState((0,u.getIntialLocksInfo)()),[E,C]=o.React.useState(!1),[P,F]=o.React.useState(!1),{sessionId:_,startEditSession:G,addEdit:V}=(0,u.useVmsManager)(),{supportsEditSession:U}=(0,u.useEditSession)();o.React.useEffect(()=>{T(B())},[f,m]),o.React.useEffect(()=>{v&&T(B())},[v]),o.React.useEffect(()=>{if(b){const e=Object.assign({},x);(0,u.isDefined)(d)&&(e.networkId=[d.networkInfo.lrsNetworkId]),(0,u.isDefined)(m)&&(e.eventServiceLayerIds=[m.serviceId]),(0,u.isDefined)(h)&&(e.routeInfo=h,e.routeOrLineId=[]),O(e)}},[c,d,m,h]);const B=()=>{const e=[];if((0,u.isDefined)(m)&&(0,u.isDefined)(f)&&(0,u.isDefined)(m.eventInfo)&&(0,u.isDefined)(m.eventInfo.attributeFields)){const t=f,o=(null==t?void 0:t.layer).fields;m.eventInfo.attributeFields.forEach(t=>{if(t.enabled){const a=o.find(e=>e.name===t.field.name);if(a){let o;o=(0,u.isDate)(a.type)?(0,u.isDefined)(a.defaultValue)?new Date(a.defaultValue):null:a.defaultValue;const n={index:e.length,name:a.name,alias:a.alias,type:a.type,hasDomain:(0,u.isDefined)(a.domain),value:o,error:"",nullable:a.nullable,default:"number"==typeof o?Number(o).toString():o,length:a.length,editable:t.editable};e.push(n)}}})}return e},W=e=>e.findIndex(e=>e.error.length>0)>-1,z=e=>{const t=ko(e);T(t),C(W(t))},Q=(e,t,o)=>{I(e,!e&&t,o)},Z=()=>{const e=[];if((0,u.isDefined)(m)&&(0,u.isDefined)(f)){const t=f,o=(null==t?void 0:t.layer).fields;m.eventInfo.attributeFields.forEach(t=>{const a=o.find(e=>e.name===t.field.name);if(a){let o;if("date"===a.type&&(0,u.isDefined)(a.defaultValue)){const e=new Date(a.defaultValue);(0,u.isDefined)(e)&&(o=e.toISOString().substring(0,10))}else o=a.defaultValue;const n={index:e.length,name:a.name,alias:a.alias,type:a.type,hasDomain:(0,u.isDefined)(a.domain),value:o,error:"",nullable:a.nullable,default:"number"==typeof o?Number(o).toString():o,length:a.length,editable:t.editable};e.push(n)}}),T(e)}},q=(e,t,o,a)=>{const n={};let i=!1,s=!1;m.eventInfo.canSpanRoutes?h.routeLineOrder>h.toRouteLineOrder?i=!0:h.routeId===h.toRouteId&&h.selectedMeasure>h.selectedToMeasure&&(s=!0):h.selectedMeasure>h.selectedToMeasure&&(s=!0);const r=m.eventInfo.eventIdFieldName;n[r]="{"+(0,u.getUUID)()+"}";const l=m.eventInfo.routeIdFieldName;n[l]=t.routeId;const d=m.eventInfo.fromMeasureFieldName;n[d]=t.fromMeasure;const f=m.eventInfo.fromDateFieldName;if(!o&&t.fromDate){const e=(0,u.isDefined)(t.fromDate)?(0,u.getDateWithoutTZOffset)(t.fromDate.valueOf(),c):null;n[f]=(0,u.getDateToUTC)(e)}else n[f]=t.fromDate;const p=m.eventInfo.toDateFieldName;if(!a&&t.toDate){const e=(0,u.isDefined)(t.toDate)?(0,u.getDateWithoutTZOffset)(t.toDate.valueOf(),c):null;n[p]=(0,u.getDateToUTC)(e)}else n[p]=t.toDate;if(m.eventInfo.toRouteIdFieldName&&m.eventInfo.toRouteIdFieldName.length>0){const e=m.eventInfo.toRouteIdFieldName;n[e]=t.toRouteId,i&&(n[l]=t.toRouteId,n[e]=t.routeId)}if(m.eventInfo.toMeasureFieldName&&m.eventInfo.toMeasureFieldName.length>0){const e=m.eventInfo.toMeasureFieldName;n[e]=t.toMeasure,(i||s)&&(n[d]=t.toMeasure,n[e]=t.fromMeasure)}S.forEach(e=>{const t=e.name;if((0,u.isDefined)(e.value)&&(0,u.isDate)(e.type)){const o=(0,u.getDateWithoutTZOffset)(e.value.valueOf(),c);n[t]=(0,u.getDateToUTC)(o)}else(0,u.isNumber)(e.type)?!(0,u.isDefined)(e.value)||""===e.value||isNaN(Number(e.value))?n[t]=null:n[t]=Number(e.value):n[t]=e.value});const v={attributes:n};e.push(v)},H=e=>Vo(this,void 0,void 0,function*(){const t={edits:[]};if((()=>{const e=ko(S);let t=!1;return e.forEach((o,a)=>{let n;if(n=o.hasDomain?(0,u.validateRangeDomain)(o.value,o.name,f):(0,u.validateField)(o.value,o.name,f),(0,u.isDefined)(Uo)){let t=[];const i=Go(o.value,0,a,e,Uo);(null==i?void 0:i.length)>0&&(i.forEach(e=>{var o;const a=null===(o=null==e?void 0:e.fieldGroup)||void 0===o?void 0:o.fields;t.push(a)}),t=t.flat(),t.includes(o.name)&&(F(!0),n={hasError:!0,message:"contingentValueError"}))}if(n.hasError){let e;if("contingentValueError"===n.message){const t=[];Uo.forEach(e=>{t.push(e.name)});let o=s("invalidContingentValues");o=o.replace("{groupNames}",t.join(",")),e=o}else{const t=m.useFieldAlias?o.alias:o.name;e=s("attributeError",{fieldValue:t,message:s(n.message)})}j("error"),L(e),k(!0),setTimeout(()=>{k(!1)},5e3),t=!0,o.error=s(n.message)}}),t&&z(e),t})())return;const o=f;if((0,u.isDefined)(m)){const e=[];if((0,u.isDefined)(M)&&M.locations.length>0){for(const t of M.locations)if(0===t.concurrencies.length){const o={routeId:t.routeId,fromMeasure:t.fromMeasure,toMeasure:t.toMeasure,fromDate:(0,u.getDateWithRouteTime)(h.selectedFromDate,h.fromDate),toDate:(0,u.getDateWithRouteTime)(h.selectedToDate,h.toDate)};q(e,o,!1,!1)}else for(const o of t.concurrencies)if(o.isChosen){const t={routeId:o.routeId,fromMeasure:o.fromMeasure,toMeasure:o.toMeasure,fromDate:o.fromDate,toDate:o.toDate},a=!(0,u.isDefined)(h.selectedFromDate)||o.fromDate.valueOf()!==h.selectedFromDate.valueOf(),n=!(0,u.isDefined)(h.selectedToDate)||o.toDate.valueOf()!==h.selectedToDate.valueOf();q(e,t,a,n)}}else{const t={routeId:h.routeId,fromMeasure:h.selectedMeasure,toMeasure:h.selectedToMeasure,fromDate:(0,u.getDateWithRouteTime)(h.selectedFromDate,h.fromDate),toDate:(0,u.getDateWithRouteTime)(h.selectedToDate,h.toDate)};q(e,t,!1,!1)}const o={id:m.serviceId,adds:e,allowMerge:p.mergeCoincident,retireMeasureOverlap:p.retireOverlapping,retireByEventId:!1};t.edits.push(o)}if(U){const e=yield G();if(!e.success)return j("error"),L(e.error),k(!0),void setTimeout(()=>{k(!1)},5e3)}yield(0,u.LrsApplyEdits)(o,m,_,t,null,null).then(o=>{o.success?(U&&V(o,s("_widgetLabel")),j("success"),L(s("eventCreated")),k(!0),J(t),setTimeout(()=>Vo(this,void 0,void 0,function*(){if(k(!1),b&&(0,u.isDefined)(e)){yield(0,u.tryReleaseLockOnDefault)(c,e);const t=Object.assign(Object.assign({},x),{lockAction:u.LockAction.Clear});O(t)}else Q(!0,!1,y),Z()}),5e3)):(j("error"),L(`${o.message} \n ${o.details}`),k(!0),setTimeout(()=>{k(!1)},5e3))})}),J=e=>Vo(this,void 0,void 0,function*(){const t=f,a=t.getPopupInfo(),n=t.getLayerDefinition(),i=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==n?void 0:n.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==a?void 0:a.fieldInfos)||[]).filter(e=>e.visible));let s=null;yield(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then(e=>{[s]=e}).then(()=>{const o=new s({geometry:e.edits[0].adds[0].geometry,attributes:e.edits[0].adds[0].attributes}),a=t.buildRecord(o);t.afterAddRecord(a)}),t.updateQueryParams({returnGeometry:!0},l);const r=new o.DataRecordSetChangeMessage(l,o.RecordSetChangeType.CreateUpdate,[{records:t.getRecords(),fields:i.map(e=>e.fieldName),dataSource:t,name:t.id}]);o.MessageManager.getInstance().publishMessage(r)});return(0,t.jsxs)("div",{className:"h-100",css:o.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-line-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-line-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-line-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-line=event-edit-attributes__action {
      height: auto;
    }
    .add-line-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsxs)("div",{className:"add-line-event-edit-attributes__content",children:[b&&(0,t.jsx)(u.LockManagerComponent,{intl:r,featureDS:c,lockInfo:x,showAlert:!0,networkName:null===(i=null==d?void 0:d.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:b,onQueryAndAcquireComplete:(e,t,o)=>{O(e),o&&H(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},x),{lockAction:u.LockAction.None});O(e),Q(!0,!1,y),Z()}}),(0,t.jsx)("div",{className:"attribute-picker d-flex w-100 px-3",children:(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(u.CopyAttributeTool,{disabled:!1,networkDs:c,eventDataSources:[f],jimuMapView:D,hoverGraphic:g,onAttributesCopied:e=>{const t=ko(S);e.forEach(e=>{e.layerId===m.serviceId.toString()&&e.fieldValuePair.forEach(e=>{const o=t.findIndex(t=>t.name===e.name);if(o>-1){let a=e.value;(0,u.isDate)(t[o].type)&&(a=new Date(e.value)),t[o].value=a}})}),T(t)}})})}),(0,t.jsxs)("div",{className:"h-100",children:[P&&(0,t.jsx)(n.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){F(!1)},open:P,text:A,type:"warning",closable:!0,withIcon:!0}),(0,t.jsx)(u.AttributeTable,{tableIndex:0,eventDS:f,eventLayer:m,fieldInfos:S,collapable:!1,useAlias:!(0,u.isDefined)(m)||m.useFieldAlias,onUpdateItem:(e,t,o)=>{const a=ko(S);a[o].value=e,a[o].error=t,T(a),C(W(a))},onUpdateAll:z,onFieldGrpUpdated:(e,t)=>{Uo=e,Uo&&0!==(null==Uo?void 0:Uo.length)||F(!1)},isReset:v})]}),N&&(0,t.jsx)("div",{className:"add-line-event-edit-attributes__toast-container w-100 p-3",children:(0,t.jsx)(n.Alert,{className:"add-line-event-edit-attributes__toast w-100",type:w,text:A,closable:!0,withIcon:!0,open:N,onClose:()=>{k(!1)}})})]}),(0,t.jsx)("div",{className:"add-line-attributes-footer w-100",children:(0,t.jsxs)("div",{className:"add-line=event-edit-attributes__action w-100 d-flex",children:[(0,t.jsx)("div",{className:"mt-auto mr-auto",children:(0,t.jsx)(n.Button,{"aria-label":s("backLabel"),size:"sm",type:"secondary",onClick:()=>{Q(!1,R,y)},children:s("backLabel")})}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(n.Button,{type:"primary",className:"active","aria-label":s("saveLabel"),size:"sm",disabled:P||E,onClick:()=>{var e;if(b){const t=Object.assign(Object.assign({},x),{lockAction:u.LockAction.QueryAndAcquire});(0,u.isDefined)(M)&&(t.isLine=[],t.routeOrLineId=[],t.eventServiceLayerIds=[],null===(e=null==M?void 0:M.locations)||void 0===e||e.forEach(e=>{var o;null===(o=null==e?void 0:e.concurrencies)||void 0===o||o.forEach(e=>{e.isChosen&&(t.isLine.push(d.networkInfo.supportsLines),t.routeOrLineId.push(d.networkInfo.supportsLines?e.lineId:e.routeId),t.eventServiceLayerIds.push(m.serviceId))})})),O(t)}else H()},children:s("saveLabel")})})]})})]})}function Wo(e){const{network:a,event:n,dataSourcesReady:i,onCreateNetworkDs:s,onCreateEventDs:r}=e,[u,l]=o.React.useState(null!=a?a:null),[c,d]=o.React.useState(null!=n?n:null),[f,m]=o.React.useState(!1),[h,p]=o.React.useState(!1);o.React.useEffect(()=>{a&&l(a)},[a]),o.React.useEffect(()=>{n&&d(n)},[n]),o.React.useEffect(()=>{i(f&&h)},[i,h,f]);const v=o.React.useCallback(e=>{s(e)},[s]),D=o.React.useCallback(e=>{r(e)},[r]),g=o.React.useCallback(e=>{if(e){const{status:t,instanceStatus:a}=e;a===o.DataSourceStatus.NotCreated||a===o.DataSourceStatus.CreateError||t===o.DataSourceStatus.LoadError||t===o.DataSourceStatus.NotReady?m(!1):m(!0)}},[m]),b=o.React.useCallback(e=>{if(e){const{status:t,instanceStatus:a}=e;a===o.DataSourceStatus.NotCreated||a===o.DataSourceStatus.CreateError||t===o.DataSourceStatus.LoadError||t===o.DataSourceStatus.NotReady?p(!1):p(!0)}},[p]),I=o.React.useCallback(()=>{m(!1)},[m]),R=o.React.useCallback(()=>{p(!1)},[p]);return(0,t.jsxs)("div",{children:[u&&(0,t.jsx)(o.DataSourceComponent,{useDataSource:u.useDataSource,onDataSourceInfoChange:g,onCreateDataSourceFailed:I,onDataSourceCreated:v}),c&&(0,t.jsx)(o.DataSourceComponent,{useDataSource:c.useDataSource,onDataSourceInfoChange:b,onCreateDataSourceFailed:R,onDataSourceCreated:D})]})}const zo=function(){return w.Date.now()};var Qo=/\s/;const Zo=function(e){for(var t=e.length;t--&&Qo.test(e.charAt(t)););return t};var qo=/^\s+/;const Ho=function(e){return e?e.slice(0,Zo(e)+1).replace(qo,""):e};const Jo=function(e){return"symbol"==typeof e||xe(e)&&"[object Symbol]"==_(e)};var $o=/^[-+]0x[0-9a-f]+$/i,Ko=/^0b[01]+$/i,Xo=/^0o[0-7]+$/i,Yo=parseInt;const ea=function(e){if("number"==typeof e)return e;if(Jo(e))return NaN;if(G(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=G(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ho(e);var o=Ko.test(e);return o||Xo.test(e)?Yo(e.slice(2),o?2:8):$o.test(e)?NaN:+e};var ta=Math.max,oa=Math.min;const aa=function(e,t,o){var a,n,i,s,r,u,l=0,c=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var o=a,i=n;return a=n=void 0,l=t,s=e.apply(i,o)}function h(e){var o=e-u;return void 0===u||o>=t||o<0||d&&e-l>=i}function p(){var e=zo();if(h(e))return v(e);r=setTimeout(p,function(e){var o=t-(e-u);return d?oa(o,i-(e-l)):o}(e))}function v(e){return r=void 0,f&&a?m(e):(a=n=void 0,s)}function D(){var e=zo(),o=h(e);if(a=arguments,n=this,u=e,o){if(void 0===r)return function(e){return l=e,r=setTimeout(p,t),c?m(e):s}(u);if(d)return clearTimeout(r),r=setTimeout(p,t),m(u)}return void 0===r&&(r=setTimeout(p,t)),s}return t=ea(t)||0,G(o)&&(c=!!o.leading,i=(d="maxWait"in o)?ta(ea(o.maxWait)||0,t):i,f="trailing"in o?!!o.trailing:f),D.cancel=function(){void 0!==r&&clearTimeout(r),l=0,a=u=n=r=void 0},D.flush=function(){return void 0===r?s:v(zo())},D};var na=1/0;const ia=function(e){return e?(e=ea(e))===na||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const sa=function(e){var t=ia(e),o=t%1;return t==t?o?t-o:t:0};const ra=function(e,t){for(var o=-1,a=null==e?0:e.length,n=Array(a);++o<a;)n[o]=t(e[o],o,e);return n};var ua=j?j.prototype:void 0,la=ua?ua.toString:void 0;const ca=function e(t){if("string"==typeof t)return t;if(Ge(t))return ra(t,e)+"";if(Jo(t))return la?la.call(t):"";var o=t+"";return"0"==o&&1/t==-1/0?"-0":o};const da=function(e){return null==e?"":ca(e)};var fa=w.isFinite,ma=Math.min;const ha=function(e){var t=Math[e];return function(e,o){if(e=ea(e),(o=null==o?0:ma(sa(o),292))&&fa(e)){var a=(da(e)+"e").split("e"),n=t(a[0]+"e"+(+a[1]+o));return+((a=(da(n)+"e").split("e"))[0]+"e"+(+a[1]-o))}return t(e)}}("round");var pa=function(e,t,o,a){return new(o||(o=Promise))(function(n,i){function s(e){try{u(a.next(e))}catch(e){i(e)}}function r(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}u((a=a.apply(e,t||[])).next())})};function va(e){var i,s,r,l,c,d;const f=o.hooks.useTranslation(a),{intl:m,widgetId:h,network:p,event:v,networkDS:D,routeInfo:g,jimuMapView:b,hoverGraphic:I,clearPickedGraphic:R,clearHoverGraphic:y,onRouteInfoUpdated:M,onRouteMeasurePickerInfoUpdated:S,routeMeasurePickerInfo:T,isFrom:N,canSpanRoutes:k,reset:w,revalidateRouteFromDataAction:j,onResetDataAction:A,hideMeasures:L,useStartMeasure:x,useEndMeasure:O}=e,[E,C]=o.React.useState(!1),[P,F]=o.React.useState(!1),[_,G]=o.React.useState(!1),[V,U]=o.React.useState(!1),[B,W]=o.React.useState(""),[z,Q]=o.React.useState(""),[Z,q]=o.React.useState(!1),[H,J]=o.React.useState([]),[$,K]=o.React.useState(),X=o.React.useRef(null),Y=o.React.useRef(e=>{}),ee=o.React.useRef(null),te=o.React.useRef(null),oe=o.React.useRef(null),ae=o.React.useRef(null),ne=o.React.useRef(null),ie=o.React.useRef(!1),se=o.React.useRef(!1),[re,ue]=o.React.useState(null),[le,ce]=o.React.useState(null),[de,fe]=o.React.useState(!1),[me,he]=o.React.useState([]);o.React.useEffect(()=>{Y.current=aa(ve,400)},[]),o.React.useEffect(()=>{if(j){const e=N?p.useRouteName?g.routeName:g.routeId:p.useRouteName?g.toRouteName:g.toRouteId;De(e),N?((()=>{pa(this,void 0,void 0,function*(){yield Ie(e,!0),isNaN(g.selectedMeasure)||W(g.selectedMeasure.toString())})})(),g.selectedToMeasure||A()):(()=>{pa(this,void 0,void 0,function*(){yield Ie(e,!0),g.selectedToMeasure&&Q(g.selectedToMeasure.toString()),A()})})()}},[j]),o.React.useEffect(()=>{w&&(W(""),Q(""),ne.current=null,Te())},[w]),o.React.useEffect(()=>{N?p&&p.useRouteName?ue(g.routeName):p&&!p.useRouteName&&ue(g.routeId):p&&p.useRouteName?ce(g.toRouteName):p&&!p.useRouteName&&ce(g.toRouteId)},[p,g.routeId,g.toRouteId,g.routeName,g.toRouteName]);const pe=o.React.useCallback((e,t=!1)=>{M(e,t),ne.current=null},[M]);o.React.useEffect(()=>{N&&(isNaN(g.selectedMeasure)?W(""):W(g.selectedMeasure.toString()),Te(!1,!0))},[p,g.selectedMeasure]),o.React.useEffect(()=>{N&&x&&Te(!1,!0)},[g.selectedPoint]),o.React.useEffect(()=>{N||O&&Te(!1,!0)},[g.selectedToPoint]),o.React.useEffect(()=>{N||(isNaN(g.selectedToMeasure)?Q(""):Q(g.selectedToMeasure.toString()),Te(!1,!0))},[p,g.selectedToMeasure]),o.React.useEffect(()=>{if(!N&&k&&g.validRoute&&(p.useRouteName?ce(g.toRouteName):ce(g.toRouteId)),!N&&!k&&g.validRoute&&(p.useRouteName?ce(g.routeName):ce(g.routeId),g.routeId!==g.toRouteId||g.routeName!==g.toRouteName)){const e=Object.assign(Object.assign({},g),{toRouteId:g.routeId,toRouteName:g.routeName});M(e)}N&&Te()},[g.routeName,g.routeId]),o.React.useEffect(()=>{N||Te()},[g.toRouteName,g.toRouteId]),o.React.useEffect(()=>{g.routeName&&g.routeId&&g.routeName.length<1&&g.routeId.length<1&&De("")},[v,p]);const ve=o.hooks.useEventCallback(e=>{const t=p.useRouteName?p.routeNameFieldSchema.jimuName:p.routeIdFieldSchema.jimuName,o=(0,u.getSuggestions)(t,e,D);Promise.all([o]).then(e=>pa(this,void 0,void 0,function*(){const o=null==e?void 0:e[0];if(!N&&g.lineId){const e=[];o.forEach(t=>{t.suggestionItem.forEach(t=>{e.push(t.suggestion)})});const a=[],n=(0,u.queryRoutesByLineId)(e,g.lineId,p,D);yield Promise.all([n]).then(e=>{const n=null==e?void 0:e[0];if((0,u.isDefined)(n)){for(let e=0;e<n.features.length;e++){const o=n.features[e].attributes[t];a.push(o)}a.length>0?o.forEach(e=>{const t=e.suggestionItem.filter(e=>a.includes(e.suggestion));e.suggestionItem=t}):o.forEach(e=>{e.suggestionItem=[]})}}).catch(e=>{o.forEach(e=>{e.suggestionItem=[]})})}o&&he(o),ee.current&&fe(!0)}))}),De=e=>{N?ue(e):ce(e),ee.current=e,ne.current=e},ge=()=>{(0,o.focusElementInKeyboardMode)(te.current),be(!0,!1)},be=(e=!1,t=!0)=>{e||(se.current=!1)};o.React.useEffect(()=>{(0,u.isDefined)(p)&&((0,u.isDefined)(j)||(ue(""),ce("")),W(""),Q(""),C(!1),F(!1),G(!1),U(!1),R(),y())},[p]),o.React.useEffect(()=>{(0,u.isDefined)(b)&&b.view&&K(b.view.popupEnabled)},[b]);const Ie=(e,t=!1)=>new Promise(o=>{setTimeout(()=>{ne.current&&!t&&(e=ne.current),ne.current=null;const a=[],n=(0,u.isDefined)(g.lineId)?N?"":g.lineId:"",i=(0,u.queryRouteIdOrName)(e,p,D,k,N,n).then(o=>pa(this,void 0,void 0,function*(){if((0,u.isDefined)(o)){if(!t&&(w||N&&(e===g.routeId||e===g.routeName)||!N&&(e===g.toRouteId||e===g.toRouteName)))return{valid:!0};if(yield Promise.all(o.features.map(t=>pa(this,void 0,void 0,function*(){const o=N?yield Re(t,e):yield ye(t,e);a.push(o)}))),a.length>1&&!t)Ne(a);else if(a.length>0){let o=a[0];if(t&&(o=a.find(e=>(0,u.getDateWithoutTime)(e.fromDate).getTime()===(0,u.getDateWithoutTime)(g.fromDate).getTime())),N){if(B.length>0||t&&!isNaN(g.selectedMeasure))return Me(o,t).then(t=>(k||e===g.toRouteId||e===g.toRouteName||x||(t.selectedToMeasure=NaN),M(t,!0),{valid:!0}));k||e===g.toRouteId||e===g.toRouteName||O||(o.selectedToMeasure=NaN),M(o,!0)}else{if(z.length>0||t&&!isNaN(g.selectedToMeasure))return Se(o,t).then(e=>(M(e,!0),{valid:!0}));M(o,!0)}}return{valid:!0}}})).catch(t=>{if(w)return De(""),{valid:!0};{const o=k?g.toRouteId:"",a=k||""===e?NaN:g.selectedToMeasure,n=isNaN(a)?null:g.selectedToPoint,i=k?g.selectedToPolyline:null;if((0,u.isDefined)(p)&&p.useRouteName)if(N){const t=k?g.toRouteName:""===e?"":g.toRouteName,s=Object.assign(Object.assign({},g),{routeName:e,toRouteName:t,routeId:"",toRouteId:o,selectedMeasure:NaN,selectedToMeasure:a,selectedPolyline:null,selectedToPolyline:i,selectedPoint:null,selectedToPoint:n,validRoute:!1});M(s)}else{const t=Object.assign(Object.assign({},g),{toRouteName:e,toRouteId:"",selectedToPolyline:null,selectedToMeasure:NaN,selectedToPoint:null,validToRoute:!1});M(t)}else if(N){const t=Object.assign(Object.assign({},g),{routeId:e,toRouteId:o,selectedMeasure:NaN,selectedToMeasure:a,selectedPolyline:null,selectedToPolyline:i,selectedPoint:null,selectedToPoint:n,validRoute:!1});M(t)}else{const t=Object.assign(Object.assign({},g),{toRouteId:e,selectedToMeasure:NaN,selectedToPolyline:null,selectedToPoint:null,validToRoute:!1});M(t)}if(e.length>0){if("Error: routeNotOnSameLine"===t.message)return{valid:!1,msg:f("routeNotOnSameLine")};return{valid:!1,msg:"Route '"+e.replace(/ /g,"\xa0")+"' not found"}}return De(""),{valid:!0}}});o(i)},200)}),Re=(e,t)=>pa(this,void 0,void 0,function*(){const t=(0,u.getNetworkOutFields)(p),o=p.useRouteName?e.attributes[t.routeNameFieldName]:"",a=e.attributes[t.routeIdFieldName],n=e.attributes[t.fromDateFieldName],i=e.attributes[t.toDateFieldName],s=e.geometry,r=(0,u.getRouteFromEndMeasures)(e.geometry),l=e.attributes[t.lineIdFieldName],c=e.attributes[t.lineOrderFieldName],d=e.attributes[t.lineNameFieldName];let f=j?g.fromDate:new Date(Date.now());(0,u.isDefined)(f)&&((0,u.isDefined)(i)&&f>i?f=(0,u.getDateWithTZOffset)(n,D):f.setHours(0,0,0,0));let m=j?g.toDate:new Date(Date.now());(0,u.isDefined)(m)&&((0,u.isDefined)(i)&&m>i?m=(0,u.getDateWithTZOffset)(i,D):m.setHours(0,0,0,0)),(0,u.isDefined)(i)||j||(m=null);let h=!1;return k&&!g.validToRoute||l&&g.toLineId!==l?h=!0:k||(h=!0),yield(0,u.QueryRouteMeasures)(D,p,r,n,a).then(e=>{const t=Math.min(...e),v=Math.max(...e),b=Object.assign(Object.assign({},g),{routeId:a,toRouteId:h?a:g.toRouteId,routeName:o,toRouteName:h?o:g.toRouteName,routeLineOrder:c,toRouteLineOrder:h?c:g.toRouteLineOrder,lineId:l,toLineId:l,lineName:d,toLineName:d,fromMeasure:ha(t,p.measurePrecision),toMeasure:ha(v,p.measurePrecision),toRouteFromMeasure:h?ha(t,p.measurePrecision):g.toRouteFromMeasure,toRouteToMeasure:h?ha(v,p.measurePrecision):g.toRouteToMeasure,selectedToMeasure:h?NaN:g.selectedToMeasure,fromDate:(0,u.isDefined)(n)?(0,u.getDateWithTZOffset)(n,D):null,toDate:(0,u.isDefined)(i)?(0,u.getDateWithTZOffset)(i,D):null,toRouteFromDate:h?(0,u.isDefined)(n)?(0,u.getDateWithTZOffset)(n,D):null:g.toRouteFromDate,toRouteToDate:h?(0,u.isDefined)(i)?(0,u.getDateWithTZOffset)(i,D):null:g.toRouteToDate,selectedToPoint:h?null:g.selectedToPoint,selectedPolyline:s,selectedToPolyline:h?s:g.selectedToPolyline,selectedFromDate:f,selectedToDate:m,validRoute:!0,validToRoute:!0});return x&&(b.selectedMeasure=ha(t,p.measurePrecision),b.selectedPoint=r[0],W(ha(t,p.measurePrecision).toString())),(!N&&O||g.lineId!==l&&O||!g.lineId&&!l&&O)&&(b.selectedToMeasure=ha(v,p.measurePrecision),b.selectedToPoint=r[1],Q(ha(v,p.measurePrecision).toString())),b})}),ye=(e,t)=>pa(this,void 0,void 0,function*(){const t=(0,u.getNetworkOutFields)(p),o=p.useRouteName?e.attributes[t.routeNameFieldName]:"",a=e.attributes[t.fromDateFieldName],n=e.attributes[t.routeIdFieldName],i=e.attributes[t.toDateFieldName],s=e.geometry,r=(0,u.getRouteFromEndMeasures)(e.geometry),l=e.attributes[t.lineOrderFieldName];let c=j?g.fromDate:new Date(Date.now());(0,u.isDefined)(i)&&(0,u.isDefined)(c)&&c>i?c=(0,u.getDateWithTZOffset)(a,D):(0,u.isDefined)(c)||c.setHours(0,0,0,0);let d=j?g.toDate:new Date(Date.now());return(0,u.isDefined)(i)&&(0,u.isDefined)(d)&&d>i?d=(0,u.getDateWithTZOffset)(i,D):(0,u.isDefined)(d)&&d.setHours(0,0,0,0),(0,u.isDefined)(i)||j||(d=null),yield(0,u.QueryRouteMeasures)(D,p,r,a,n).then(e=>{const t=Math.min(...e),c=Math.max(...e),d=Object.assign(Object.assign({},g),{toRouteName:k?o:g.routeName,toRouteId:k?n:g.routeId,toRouteFromDate:k?(0,u.isDefined)(a)?(0,u.getDateWithTZOffset)(a,D):null:(0,u.isDefined)(a)?(0,u.getDateWithTZOffset)(a,D):g.toRouteFromDate,toRouteToDate:k?(0,u.isDefined)(i)?(0,u.getDateWithTZOffset)(i,D):null:(0,u.isDefined)(i)?(0,u.getDateWithTZOffset)(i,D):g.toRouteToDate,selectedToPolyline:k?s:g.selectedToPolyline,toRouteFromMeasure:k?ha(t,p.measurePrecision):g.toRouteFromMeasure,toRouteToMeasure:k?ha(c,p.measurePrecision):g.toRouteToMeasure,toRouteLineOrder:k?l:g.toRouteLineOrder,validToRoute:!0});return O&&(d.selectedToMeasure=ha(c,p.measurePrecision),d.selectedToPoint=r[1],Q(ha(c,p.measurePrecision).toString())),d})}),Me=(e,t)=>(0,u.QueryMeasureOnRoute)(D,p,e.routeId,e.fromDate,t||x?e.selectedMeasure.toString():B).then(o=>{if(o){return Object.assign(Object.assign({},e),{selectedPoint:o,selectedMeasure:parseFloat(t||x?e.selectedMeasure.toString():B)})}return Object.assign(Object.assign({},e),{selectedPoint:null,selectedMeasure:NaN})}),Se=(e,t)=>(0,u.QueryMeasureOnRoute)(D,p,e.toRouteId,e.toRouteFromDate,t||O?e.selectedToMeasure.toString():z).then(o=>{if(o){return Object.assign(Object.assign({},e),{selectedToPoint:o,selectedToMeasure:parseFloat(t||O?e.selectedToMeasure.toString():z)})}return Object.assign(Object.assign({},e),{selectedToMeasure:NaN})});o.React.useEffect(()=>{if(N&&k&&g.toRouteId.length<1&&g.toRouteName.length<1&&g.validRoute){const e=Object.assign(Object.assign({},g),{toRouteId:g.routeId,toRouteName:g.routeName});M(e)}N||k||p&&!p.useRouteName&&!g.routeId.length&&g.validToRoute&&ce(g.routeId)},[g.routeId,g.routeName]),o.React.useEffect(()=>{if(k&&!j&&!O)if(N){const e=Object.assign(Object.assign({},g),{toRouteId:g.routeId,toRouteName:g.routeName,selectedToMeasure:NaN,selectedToPoint:null});M(e)}else R()},[g.lineId]);const Te=(e=!0,t=!0)=>{j||setTimeout(()=>{if(w&&(te.current.disabled=!1,L||(oe.current.disabled=!1)),e&&te.current&&(te.current.select(),(0,o.focusElementInKeyboardMode)(te.current,!0),te.current.blur()),t&&!L&&oe.current){const e=oe.current.disabled;oe.current.disabled=!1,(0,o.focusElementInKeyboardMode)(oe.current,!0),oe.current.blur(),oe.current.disabled=e}w&&(te.current.disabled=!N,L||(oe.current.disabled=!0))},600)},Ne=o.React.useCallback(e=>{e.length&&(q(!0),J(e))},[]),ke=o.React.useCallback(e=>{(0,u.isDefined)(e)&&(e.selectedFromDate=e.fromDate,e.selectedToDate=e.toDate,M(e,!0),Te()),q(!1)},[M]),we=o.React.useCallback(()=>{q(!1)},[]);return(0,t.jsx)("div",{className:"route-and-measure-form d-flex w-100 pt-1 px-3",children:p&&(0,t.jsxs)("div",{className:"w-100",children:[(0,t.jsx)(n.Label,{size:"sm",className:"w-100 title3",centric:!0,style:{padding:0,paddingTop:5,width:100},children:N?p.useRouteName?f("fromRouteNameLabel"):f("fromRouteIdLabel"):p.useRouteName?f("toRouteNameLabel"):f("toRouteIdLabel")}),(0,t.jsxs)("div",{ref:X,className:"d-flex w-100",style:{paddingBottom:3},children:[(0,t.jsx)(n.TextInput,{type:"text",className:"w-100",size:"sm",allowClear:!0,disabled:!(0,u.isDefined)(D)||!N&&(!k||g.routeId.length<1&&g.routeName.length<1&&g.toRouteId.length<1&&g.toRouteName.length<1),onBlur:()=>{ae.current=setTimeout(()=>{ie.current||fe(!1),se.current||be(!1)},200)},value:N?re||"":le||"",ref:te,onChange:e=>{var t;ne.current=null;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=(null==o?void 0:o.length)>2;if(De(o),!a)return fe(!1),!1;Y.current(o)},checkValidityOnAccept:Ie}),(N?re:le)&&(0,t.jsx)(u.Intellisense,{isOpen:(de||(ie.current=!1),de),reference:X,searchText:N?re:le,searchSuggestion:me,onRecordItemClick:(e,t)=>{if(t)return ge(),!1;ne.current=e,De(e)},id:h,searchInputRef:te}),(0,t.jsx)(u.RoutePicker,{type:"route-measure",active:N?T.fromRoutePickerActive:T.toRoutePickerActive,networkDs:D,network:p,routeInfo:g,disabled:!(0,u.isDefined)(D)||!N&&(!k||(null===(i=g.routeId)||void 0===i?void 0:i.length)<1&&(null===(s=g.routeName)||void 0===s?void 0:s.length)<1),jimuMapView:b,symbolColor:null,hoverGraphic:I,onActiveChange:N?()=>{const e=!T.fromRoutePickerActive;if(C(e),e){G(!1);const e=Object.assign(Object.assign({},T),{fromRoutePickerActive:!0,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},T),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),y(),setTimeout(()=>{b.view.popupEnabled=$&&!P&&!_&&!V},800)}}:()=>{const e=!T.toRoutePickerActive;if(F(e),e){U(!1);const e=Object.assign(Object.assign({},T),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!0,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},T),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),y(),setTimeout(()=>{b.view.popupEnabled=$&&!E&&!_&&!V},800)}},onRouteInfoUpdated:pe,onMultiRouteSelect:Ne,isFrom:N,canSpanRoutes:k,useRouteStartMeasure:x,useRouteEndMeasure:O})]}),!L&&(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{size:"sm",className:"w-100 title3",centric:!0,style:{padding:0,paddingTop:5,width:100},children:f(N?"fromMeasureWithUnits":"toMeasureWithUnits",{units:(0,u.GetUnits)(p.unitsOfMeasure,m)})}),(0,t.jsxs)("div",{className:"d-flex w-100",children:[(0,t.jsx)(n.TextInput,{ref:oe,"aria-label":f(N?"fromMeasureWithUnits":"toMeasureWithUnits",{units:(0,u.GetUnits)(p.unitsOfMeasure,m)}),className:"w-100",size:"sm",value:N?B:z,disabled:!(0,u.isDefined)(D)||(N?x:O)||(N?g.routeId.length<1&&(null===(r=g.routeName)||void 0===r?void 0:r.length)<1:g.toRouteId.length<1&&(null===(l=g.toRouteName)||void 0===l?void 0:l.length)<1),onChange:e=>{var t;t=e.target.value,N?W(t):Q(t)},checkValidityOnAccept:e=>pa(this,void 0,void 0,function*(){let t=NaN;if(""===e){t=NaN;const e=Object.assign({},g);return N?(e.selectedMeasure=NaN,e.selectedPoint=null):(e.selectedToMeasure=NaN,e.selectedToPoint=null),M(e),{valid:!0}}if(t=isNaN(Number(e))?(0,u.convertStationToNumber)(e):Number(e),t=ha(t,p.measurePrecision),isNaN(t)){R();const e=Object.assign({},g);return N?(e.selectedMeasure=NaN,e.selectedPoint=null,W("")):(e.selectedToMeasure=NaN,e.selectedToPoint=null,Q("")),M(e),{valid:!0}}{const e=!k&&(0,u.isDefined)(g.selectedPolyline)||k&&g.routeId===g.toRouteId&&(0,u.isDefined)(g.selectedPolyline)||k&&g.routeId!==g.toRouteId&&(0,u.isDefined)(g.selectedToPolyline);if(N&&(0,u.isDefined)(g.selectedPolyline)||!N&&e){if(N){if(t<g.fromMeasure)return{valid:!1,msg:f("measureLessError")};if(t>g.toMeasure)return{valid:!1,msg:f("measureGreaterError")}}else{const e=k?g.routeId===g.toRouteId?g.fromMeasure:g.toRouteFromMeasure:g.fromMeasure,o=k?g.routeId===g.toRouteId?g.toMeasure:g.toRouteToMeasure:g.toMeasure;if(t<e)return{valid:!1,msg:f("measureLessError")};if(t>o)return{valid:!1,msg:f("measureGreaterError")}}let e=Object.assign({},g);if(N){if(t>g.selectedToMeasure&&e.routeId===e.toRouteId)return e=Object.assign(Object.assign({},e),{selectedMeasure:parseFloat(t.toString())}),M(e),{valid:!1,msg:f("fromMeasureGreaterThanToMeasureError")};e.routeId.length?yield(0,u.QueryMeasureOnRoute)(D,p,e.routeId,e.fromDate,t.toString()).then(o=>{(0,u.isDefined)(o)&&(!(0,u.isDefined)(e.selectedPoint)||o.x!==e.selectedPoint.x&&o.y!==e.selectedPoint.y?(e=Object.assign(Object.assign({},e),{selectedPoint:o,selectedMeasure:parseFloat(t.toString())}),M(e)):(e=Object.assign(Object.assign({},e),{selectedMeasure:parseFloat(t.toString())}),M(e)))}):(e=Object.assign(Object.assign({},e),{selectedMeasure:parseFloat(t.toString())}),M(e))}else{if(!N&&t<g.selectedMeasure&&e.routeId===e.toRouteId)return e=Object.assign(Object.assign({},e),{selectedToMeasure:parseFloat(t.toString())}),M(e),{valid:!1,msg:f("fromMeasureGreaterThanToMeasureError")};e.toRouteId.length?yield(0,u.QueryMeasureOnRoute)(D,p,e.toRouteId,e.toRouteFromDate,t.toString()).then(o=>{!(0,u.isDefined)(e.selectedToPoint)||o.x!==e.selectedToPoint.x&&o.y!==e.selectedToPoint.y?(e=Object.assign(Object.assign({},e),{selectedToPoint:o,selectedToMeasure:parseFloat(t.toString())}),M(e)):(e=Object.assign(Object.assign({},e),{selectedToMeasure:parseFloat(t.toString())}),M(e))}):(e=Object.assign(Object.assign({},e),{selectedToMeasure:parseFloat(t.toString())}),M(e))}}return{valid:!0}}})}),(0,t.jsx)(u.RoutePicker,{type:"measure",active:N?T.fromMeasurePickerActive:T.toMeasurePickerActive,networkDs:D,network:p,routeInfo:g,disabled:!(0,u.isDefined)(D)||(N?x:O)||(N?g.routeId.length<1&&(null===(c=g.routeName)||void 0===c?void 0:c.length)<1:g.toRouteId.length<1&&(null===(d=g.toRouteName)||void 0===d?void 0:d.length)<1),jimuMapView:b,symbolColor:null,hoverGraphic:I,onActiveChange:N?()=>{const e=!T.fromMeasurePickerActive;if(G(e),e){C(!1);const e=Object.assign(Object.assign({},T),{fromRoutePickerActive:!1,fromMeasurePickerActive:!0,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},T),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),y(),setTimeout(()=>{b.view.popupEnabled=$&&!E&&!P&&!V},800)}}:()=>{const e=!T.toMeasurePickerActive;if(U(e),e){F(!1);const e=Object.assign(Object.assign({},T),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!0});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},T),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),y(),setTimeout(()=>{b.view.popupEnabled=$&&!E&&!P&&!_},800)}},onRouteInfoUpdated:pe,onMultiRouteSelect:Ne,isFrom:N,canSpanRoutes:k})]})]}),(0,t.jsx)(u.RoutePickerPopup,{isOpen:Z,routeInfos:H,useRouteName:p.useRouteName,onRouteSelect:ke,onRouteSelectCancel:we,isFrom:N,measurePrecision:p.measurePrecision,jimuMapView:b,graphicLayer:I})]})})}var Da=m(68972);const ga=o.React.forwardRef((e,a)=>{const{intl:n,widgetId:i,network:s,event:r,networkDS:l,method:c,jimuMapView:d,hoverGraphic:f,pickedGraphic:m,isFrom:h,routeInfo:p,routeMeasurePickerInfo:v,reset:D,revalidateRouteFromDataAction:g,canSpanRoutes:b,onResetDataAction:I,useStartMeasure:R,useEndMeasure:y,hideMeasures:M,onUpdateRouteInfo:S,onUpdateRouteMeasurePickerInfo:T,onsubmit:N,addToDominantRoute:k}=e;(0,Da.useImperativeHandle)(a,()=>({handleNextClicked:w}));const w=()=>{N(p,l,s,k)};return(0,t.jsx)("div",{className:"add-line-event-route-selection-form d-flex",css:o.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-line-event-route-selection-form {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
      fontWeight: 500;
    }
  `,children:(0,t.jsxs)("div",{className:"d-flex w-100",children:[c===u.SearchMethod.Measure&&(0,t.jsx)(va,{intl:n,widgetId:i,network:s,event:r,networkDS:l,routeInfo:p,jimuMapView:d,hoverGraphic:f,clearPickedGraphic:()=>{(0,u.isDefined)(m)&&m.removeAll()},clearHoverGraphic:()=>{(0,u.isDefined)(f)&&f.removeAll()},onRouteInfoUpdated:(e,t=!1)=>{S(e,t)},onRouteMeasurePickerInfoUpdated:e=>{T(e)},routeMeasurePickerInfo:v,isFrom:h,canSpanRoutes:b,reset:D,revalidateRouteFromDataAction:g,onResetDataAction:I,useStartMeasure:R,useEndMeasure:y,hideMeasures:M}),c===u.SearchMethod.Coordinate&&(0,t.jsx)("div",{}),c===u.SearchMethod.LocationOffset&&(0,t.jsx)("div",{})]})})});var ba=m(99037);function Ia(e){const i=o.hooks.useTranslation(a),{intl:s,routeInfo:r,eventInfo:l,network:c,revalidateRouteFromDataAction:d,hideDates:f,useRouteStartEndDate:m,onUpdateRouteInfo:h}=e,[p,v]=o.React.useState(!1),[D,g]=o.React.useState(!1),[b,I]=o.React.useState("idle"),[R,y]=o.React.useState("idle"),[M,S]=o.React.useState(""),[T,N]=o.React.useState(""),[k,w]=o.React.useState(!1);o.React.useEffect(()=>{d&&(v(!1),g(!1),S(""),N(""))},[d]),o.React.useEffect(()=>{v(m),g(m)},[f]),o.React.useEffect(()=>{let e=!1;const t=Object.assign({},r);if(d||("idle"===b&&S(""),"idle"===R&&N("")),!(0,u.isDefined)(l)&&(0,u.isDefined)(null==c?void 0:c.lineIdFieldSchema)||(null==l?void 0:l.canSpanRoutes)||""===r.routeId&&""===r.routeName?w(!1):w(!0),""===r.routeId&&""===r.toRouteId&&""===r.routeName&&""===r.toRouteName)return v(!1),g(!1),I("idle"),y("idle"),S(""),void N("");(0,u.isDefined)(l)&&l.canSpanRoutes&&(v(!1),g(!1)),(0,u.isDefined)(r.selectedFromDate)&&p&&r.selectedFromDate!==r.fromDate&&(t.selectedFromDate=r.fromDate,e=!0),D&&r.selectedToDate!==r.toDate&&(t.selectedToDate=r.toDate,e=!0);j(r.selectedFromDate,!0)&&j(r.selectedToDate,!1),e&&h(t)},[h,r,l,p,D]);const j=(e,t)=>{const o=function(e,t,o,n,i,s){const r={setFromDateStatus:"",setToDateStatus:"",setFromDateToolTip:"",setToDateToolTip:"",validDate:!0},u=e;if(!Fo(u))return t?r.setFromDateStatus="idle":r.setToDateStatus="idle",t?r.setFromDateToolTip="":r.setToDateToolTip="",r;const l=_o(u),c=_o(null==o?void 0:o.fromDate),d=_o(null==o?void 0:o.toDate),f=_o(null==o?void 0:o.selectedFromDate),m=_o(null==o?void 0:o.selectedToDate),h=_o(null==o?void 0:o.toRouteFromDate),p=_o(null==o?void 0:o.toRouteToDate);return Fo(null==o?void 0:o.fromDate)&&l<c||Fo(null==o?void 0:o.toRouteFromDate)&&l<h?(t?r.setFromDateStatus="invalid":r.setToDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidFromDateBefore",defaultMessage:a.invalidFromDateBefore}):r.setToDateToolTip=s.formatMessage({id:"invalidToDateBefore",defaultMessage:a.invalidToDateBefore}),r.validDate=!1,r):Fo(null==o?void 0:o.toDate)&&l>d||Fo(null==o?void 0:o.toRouteToDate)&&l>p?(t?r.setFromDateStatus="invalid":r.setToDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidFromDateAfter",defaultMessage:a.invalidFromDateAfter}):r.setToDateToolTip=s.formatMessage({id:"invalidToDateAfter",defaultMessage:a.invalidToDateAfter}),r.validDate=!1,r):(Fo(null==o?void 0:o.selectedToDate)&&t&&(l>m&&(r.setFromDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidDatesOrder",defaultMessage:a.invalidDatesOrder}):r.setToDateToolTip=s.formatMessage({id:"invalidDatesOrder",defaultMessage:a.invalidDatesOrder}),r.validDate=!1),i===s.formatMessage({id:"invalidDatesOrder",defaultMessage:a.invalidDatesOrder})?l<m&&(r.setToDateStatus="idle",r.setToDateToolTip=""):i===s.formatMessage({id:"invalidDatesSameDay",defaultMessage:a.invalidDatesSameDay})&&l!==f&&(r.setToDateStatus="idle",r.setToDateToolTip="")),Fo(null==o?void 0:o.selectedToDate)&&t&&l.getTime()===m.getTime()&&(r.setFromDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidDatesSameDay",defaultMessage:a.invalidDatesSameDay}):r.setToDateToolTip=s.formatMessage({id:"invalidDatesSameDay",defaultMessage:a.invalidDatesSameDay}),r.validDate=!1),Fo(null==o?void 0:o.selectedFromDate)&&(t||(l<f&&(r.setToDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidDatesOrder",defaultMessage:a.invalidDatesOrder}):r.setToDateToolTip=s.formatMessage({id:"invalidDatesOrder",defaultMessage:a.invalidDatesOrder}),r.validDate=!1),n===s.formatMessage({id:"invalidDatesOrder",defaultMessage:a.invalidDatesOrder})?l>f&&(r.setFromDateStatus="idle",r.setFromDateToolTip=""):n===s.formatMessage({id:"invalidDatesSameDay",defaultMessage:a.invalidDatesSameDay})&&l!==f&&(r.setFromDateStatus="idle",r.setFromDateToolTip=""))),Fo(null==o?void 0:o.selectedFromDate)&&(t||l.getTime()!==f.getTime()||(r.setToDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidDatesSameDay",defaultMessage:a.invalidDatesSameDay}):r.setToDateToolTip=s.formatMessage({id:"invalidDatesSameDay",defaultMessage:a.invalidDatesSameDay}),r.validDate=!1)),r.validDate&&(t?r.setFromDateStatus="idle":r.setToDateStatus="idle",t?r.setFromDateToolTip="":r.setToDateToolTip=""),r)}(e,t,r,M,T,s);return o&&(I(o.setFromDateStatus),y(o.setToDateStatus),S(o.setFromDateToolTip),N(o.setToDateToolTip)),o.validDate};return(0,t.jsx)("div",{className:"add-line=event-form-header px-3",css:(0,u.getCalciteBasicTheme)(),children:!f&&(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{size:"sm",className:"mb-0 pt-3 title3",centric:!0,children:i("startDateLabel")}),(0,t.jsx)(n.Tooltip,{title:M,children:(0,t.jsx)(ba.CalciteInputDatePicker,{scale:"s",disabled:!!p||void 0,valueAsDate:r.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const o=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(j(o,!0),o){const e=Object.assign(Object.assign({},r),{selectedFromDate:o});h(e)}else{const e=Object.assign(Object.assign({},r),{selectedFromDate:null});h(e)}}},status:b,placement:"top",overlayPositioning:"fixed"})}),(0,t.jsxs)(n.Label,{size:"sm",className:"w-100 pt-2 label2",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{checked:p,className:"mr-2",disabled:!k,onChange:(e,t)=>{j(r.fromDate,!0),v(t)}}),i("useStartDateLabel")]}),(0,t.jsx)(n.Label,{size:"sm",className:"mb-0 pt-1 title3",centric:!0,children:i("endDateLabel")}),(0,t.jsx)(n.Tooltip,{title:T,children:(0,t.jsx)(ba.CalciteInputDatePicker,{scale:"s",disabled:!!D||void 0,valueAsDate:r.selectedToDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const o=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(j(o,!1),o){const e=Object.assign(Object.assign({},r),{selectedToDate:o});h(e)}else{const e=Object.assign(Object.assign({},r),{selectedToDate:null});h(e)}}},status:R,placement:"top",overlayPositioning:"fixed"})}),(0,t.jsxs)(n.Label,{size:"sm",className:"w-100 pt-2 label2",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{checked:D,className:"mr-2",disabled:!k,onChange:(e,t)=>{j(r.toDate,!1),g(t)}}),i("useEndDateLabel")]})]})})}const Ra="#00FFFF",ya="#008000",Ma="#FF0000";function Sa(e){const i=o.hooks.useTranslation(a),{eventInfo:s,onUpdateEventInfo:r,hideAddToDominantRouteOption:u,addToDominantRoute:l,onUpdateAddToDominantRoute:c}=e,[d,f]=o.React.useState(!1),[m,h]=o.React.useState(!1);o.React.useEffect(()=>{const e=Object.assign(Object.assign({},s),{mergeCoincident:!1,retireOverlapping:!1});r(e)},[]),o.React.useEffect(()=>{f(s.mergeCoincident),h(s.retireOverlapping)},[s]);o.React.useEffect(()=>{c(l)},[]);return(0,t.jsxs)("div",{className:"merge-retire-form px-3 h-100",children:[(0,t.jsx)("hr",{css:o.css`
            border: none;
            height: 1px;
            background-color: var(--sys-color-divider-secondary);
          `}),(0,t.jsxs)(n.Label,{size:"sm",className:"w-100 pt-1 label2",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{checked:d,className:"mr-2",onChange:(e,t)=>{f(t);const o=Object.assign(Object.assign({},s),{mergeCoincident:t});r(o)}}),i("useMergeEventsLabel")]}),(0,t.jsxs)(n.Label,{size:"sm",className:"w-100 pt-0 label2",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{checked:m,className:"mr-2",onChange:(e,t)=>{h(t);const o=Object.assign(Object.assign({},s),{retireOverlapping:t});r(o)}}),i("useRetireEventsLabel")]}),!u&&(0,t.jsxs)(n.Label,{size:"sm",className:"w-100 pt-0",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{className:"mr-2",checked:l,onChange:(e,t)=>{c(t)}}),i("addToDominantRouteLabel")]})]})}function Ta(i){const s=o.hooks.useTranslation(a),{operationType:r,onOperationTypeChanged:u}=i,l=o.React.useMemo(()=>r,[r]);return(0,t.jsxs)("div",{className:"add-line-event-operation-type",children:[(0,t.jsx)(n.Label,{size:"default",className:"pt-2 mb-0 px-3 title3",children:s("typeLabel")}),(0,t.jsxs)(n.Select,{"aria-label":s("typeLabel"),className:"w-100 px-3",size:"sm",value:l,onChange:e=>{u(e.target.value)},children:[(0,t.jsxs)("option",{value:e.single,children:[" ",s("singleOperation")]}),(0,t.jsxs)("option",{value:e.multiple,children:[" ",s("multipleOperation")]})]})]})}function Na(e){var i;const s=o.hooks.useTranslation(a),{intl:r,networkDS:l,network:c,eventLayer:d,routeInfo:f,reset:m,conflictPreventionEnabled:h,onNavBack:p,onNavNext:v,concurrenciesResponse:D,onConcurrenciesResponseUpdated:g,onResetClicked:b,dateRanges:I,pickedConcurrencyGraphic:R}=e,[y,M]=o.React.useState(null),[S,T]=o.React.useState((0,u.getIntialLocksInfo)());o.React.useEffect(()=>{(null==I?void 0:I.length)>0&&M(I[0])},[I]);const N=o.React.useCallback(e=>{var t;(0,u.isDefined)(e)&&(null===(t=null==e?void 0:e.locations)||void 0===t||t.forEach(e=>{var t;null===(t=e.concurrencies)||void 0===t||t.forEach(e=>{e.isChosen=e.isDominant})}),g(e),b(!0))},[]),k=e=>{for(let t=0;t<D.locations.length;t++){const o=D.locations[t];if(o.routeId===e.routeId&&o.fromMeasure===e.fromMeasure){D.locations[t]=e;break}}g(D)};o.React.useEffect(()=>{if(h){const e=Object.assign({},S);(0,u.isDefined)(c)&&(e.networkId=[c.networkInfo.lrsNetworkId]),(0,u.isDefined)(d)&&(e.eventServiceLayerIds=[d.serviceId]),(0,u.isDefined)(f)&&(e.routeInfo=f),T(e)}},[l,c,d,f]);return(0,t.jsxs)("div",{className:"h-100",css:o.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-line-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-line-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-line-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-line-event-edit-attributes__action {
      height: auto;
    }
    .add-line-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsxs)("div",{className:"add-line-event-edit-attributes__content",children:[h&&(0,t.jsx)(u.LockManagerComponent,{intl:r,featureDS:l,lockInfo:S,showAlert:!0,networkName:null===(i=null==c?void 0:c.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:h,onQueryAndAcquireComplete:(e,t,o)=>{T(e),o&&v(f)},onMessageClear:()=>{const e=Object.assign(Object.assign({},S),{lockAction:u.LockAction.None});T(e)}}),(0,t.jsxs)("div",{className:"reset px-3",children:[(0,t.jsx)("hr",{css:o.css`
                border: none;
                height: 1px;
                background-color: var(--ref-palette-neutral-400);
              `}),(0,t.jsx)("div",{children:s("concurrenciesHeaderText")}),(0,t.jsx)("hr",{css:o.css`
                border: none;
                height: 1px;
                background-color: var(--ref-palette-neutral-400);
              `}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(n.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",float:"right",textAlign:"right",color:"var(--sys-color-primary-main)"},onClick:()=>{N(D)},children:s("resetForm")})})]}),(0,t.jsxs)("div",{className:"h-100",children:[(0,t.jsxs)("div",{className:"time-range px-3",children:[(0,t.jsx)("div",{children:(0,t.jsx)(n.Label,{size:"sm",centric:!0,className:"text-truncate mb-0 pt-2 w-100",style:{textOverflow:"ellipsis",fontWeight:500},children:s("dateRange")})}),(0,t.jsx)("div",{children:(0,t.jsx)(n.Select,{size:"sm",value:y,onChange:e=>{(e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;M(o)})(e)},disabled:(null==I?void 0:I.length)<2,children:null==I?void 0:I.map((e,o)=>(0,t.jsxs)(Option,{title:s("dateToDate",{fromDate:(0,u.isDefined)(e.fromDate)?(0,u.getDateWithTZOffset)(e.fromDate,l).toLocaleDateString():s("nullStr"),toDate:(0,u.isDefined)(e.toDate)?(0,u.getDateWithTZOffset)(e.toDate,l).toLocaleDateString():s("nullStr")}),value:e,children:[(0,t.jsx)("span",{children:(0,u.isDefined)(e.fromDate)?(0,u.getDateWithTZOffset)(e.fromDate,l).toLocaleDateString():s("nullStr")}),(0,t.jsx)("span",{style:{paddingLeft:"0.3rem",paddingRight:"0.3rem"},children:s("toStr")}),(0,t.jsx)("span",{children:(0,u.isDefined)(e.toDate)?(0,u.getDateWithTZOffset)(e.toDate,l).toLocaleDateString():s("nullStr")})]},o))})})]}),(0,u.isDefined)(D)&&(null==D?void 0:D.locations.length)>0&&(null==D?void 0:D.locations.map((e,o)=>(null==D?void 0:D.locations[o].concurrencies.length)>0?e.concurrencies.map((e,a)=>(!(0,u.isDefined)(e.fromDate)||(0,u.isDefined)(null==y?void 0:y.fromDate)&&e.fromDate<=(null==y?void 0:y.fromDate))&&(!(0,u.isDefined)(e.toDate)||(0,u.isDefined)(null==y?void 0:y.toDate)&&(null==y?void 0:y.toDate)<=e.toDate)&&e.routeId===(null==D?void 0:D.locations[o].routeId)?(0,t.jsx)("div",{children:(0,t.jsx)(u.LineConcurrencyTable,{intl:r,network:null==c?void 0:c.networkInfo,isReset:m,concurrenciesLocation:null==D?void 0:D.locations[o],concurrenciesDateRange:y,locationConcurrency:e,onConcurrenciesLocationUpdated:k,networkDS:l,pickedConcurrencyGraphic:R},a)},a):""):""))]})]}),(0,t.jsx)("div",{className:"add-line-attributes-footer w-100",children:(0,t.jsxs)("div",{className:"add-line-event-edit-attributes__action w-100 d-flex",children:[(0,t.jsx)("div",{className:"mt-auto mr-auto",children:(0,t.jsx)(n.Button,{"aria-label":s("backLabel"),size:"sm",type:"secondary",onClick:()=>{(e=>{p(e)})(!1)},children:s("backLabel")})}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(n.Button,{type:"primary",className:"active","aria-label":s("nextLabel"),size:"sm",onClick:()=>{var e;if((0,u.isDefined)(R)&&R.removeAll(),h){const t=Object.assign(Object.assign({},S),{lockAction:u.LockAction.QueryAndAcquire});(0,u.isDefined)(D)&&(t.isLine=[],t.routeOrLineId=[],t.eventServiceLayerIds=[],null===(e=null==D?void 0:D.locations)||void 0===e||e.forEach(e=>{var o;null===(o=null==e?void 0:e.concurrencies)||void 0===o||o.forEach(e=>{e.isChosen&&(t.isLine.push(c.networkInfo.supportsLines),t.routeOrLineId.push(c.networkInfo.supportsLines?e.lineId:e.routeId),t.eventServiceLayerIds.push(d.serviceId))})})),T(t)}else v(f)},children:s("nextLabel")})})]})})]})}var ka=function(e,t,o,a){return new(o||(o=Promise))(function(n,i){function s(e){try{u(a.next(e))}catch(e){i(e)}}function r(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}u((a=a.apply(e,t||[])).next())})};function wa(e,t,o){return ka(this,void 0,void 0,function*(){const a=[];if(e.routeId!==e.toRouteId){const n=t.routeIdFieldSchema.jimuName,i=t.lineOrderFieldSchema.jimuName,s=yield(0,u.queryAllRoutesByLineIdAndFromDate)(e.lineId,t,o,e.selectedFromDate);if((0,u.isDefined)(s)){const t=s.features.sort((e,t)=>e.attributes[i]-t.attributes[i]);t.forEach(o=>{const s=(0,u.getPolylineStartEndMValues)(o.geometry);if(o.attributes[n]===e.routeId&&2===s.length){const t={routeId:o.attributes[n],fromMeasure:e.selectedMeasure,toMeasure:s[1]};a.push(t)}else if(o.attributes[n]===e.toRouteId&&2===s.length){const t={routeId:o.attributes[n],fromMeasure:s[0],toMeasure:e.selectedToMeasure};a.push(t)}else if(o.attributes[i]>t[0].attributes[i]&&o.attributes[i]<t[t.length-1].attributes[i]){const e={routeId:o.attributes[n],fromMeasure:s[0],toMeasure:s[1]};a.push(e)}})}}else{const t={routeId:e.routeId,fromMeasure:e.selectedMeasure,toMeasure:e.selectedToMeasure};a.push(t)}const n=e.selectedFromDate,i=(0,u.isDefined)(e.selectedToDate)?e.selectedToDate:new Date(0xe677d21fdbff),s=yield(0,u.QueryRouteConcurrencies)(o,t,n,i,a),r=[];let l=!0,c=!0;const d=[];if(null==s||s.locations.forEach(t=>{d.includes(t.routeId)||d.push(t.routeId),t.concurrencies.forEach(t=>{if(d.includes(t.routeId)||d.push(t.routeId),t.isChosen=t.isDominant,t.isAdded=!1,t.fromMeasure>t.toMeasure){const e=t.fromMeasure;t.fromMeasure=t.toMeasure,t.toMeasure=e}(0,u.isDefined)(t.fromDate)&&!r.includes(t.fromDate)&&((!(0,u.isDefined)(e.selectedFromDate)||t.fromDate>=e.selectedFromDate)&&r.push(t.fromDate),(0,u.isDefined)(e.selectedFromDate)&&t.fromDate===e.selectedFromDate.getTime()&&(l=!1)),(0,u.isDefined)(t.toDate)&&!r.includes(t.toDate)&&((!(0,u.isDefined)(e.selectedToDate)||t.toDate<=e.selectedToDate)&&r.push(t.toDate),(0,u.isDefined)(e.selectedToDate)&&t.toDate===e.selectedToDate.getTime()&&(c=!1))})}),l&&(0,u.isDefined)(e.selectedFromDate)&&!r.includes(e.selectedFromDate)){const t=new Date(e.selectedFromDate.getFullYear(),e.selectedFromDate.getMonth(),e.selectedFromDate.getDate());r.push(t)}if(c&&(0,u.isDefined)(e.selectedToDate)&&!r.includes(e.selectedToDate)){const t=new Date(e.selectedToDate.getFullYear(),e.selectedToDate.getMonth(),e.selectedToDate.getDate());r.push(t)}r.sort((e,t)=>Number(e)-Number(t)),(0,u.isDefined)(e.selectedToDate)||r.push(null);const f=[];for(let e=0;e<r.length-1;e++){const t={fromDate:r[e],toDate:r[e+1]};f.push(t)}const m=new Map;if(d.length>0&&((null==t?void 0:t.useRouteName)||(null==t?void 0:t.supportsLines))){const e=(0,u.getRoutesByRouteIds)(d,t,o);yield Promise.all([e]).then(e=>{const o=null==e?void 0:e[0];(0,u.isDefined)(o)&&o.features.forEach(e=>{const o={};(null==t?void 0:t.useRouteName)&&(o.routeName=e.attributes[t.routeNameFieldSchema.jimuName]),(null==t?void 0:t.supportsLines)&&(o.lineId=e.attributes[t.lineIdFieldSchema.jimuName]);const a=e.attributes[t.routeIdFieldSchema.jimuName];m.has(a)||m.set(a,o)})})}const h={locations:[]};e.routeId===e.toRouteId?h.locations.push({routeId:null==s?void 0:s.locations[0].routeId,fromMeasure:null==s?void 0:s.locations[0].fromMeasure,toMeasure:null==s?void 0:s.locations[0].toMeasure,concurrencies:[]}):null==s||s.locations.forEach(e=>{h.locations.push({routeId:e.routeId,fromMeasure:ha(e.fromMeasure,t.measurePrecision),toMeasure:ha(e.toMeasure,t.measurePrecision),concurrencies:[]})});let p=!1;f.forEach(o=>{null==s||s.locations.forEach((a,n)=>{let i,s=!1;if(a.concurrencies.sort((e,t)=>e.fromMeasure-t.fromMeasure),a.concurrencies.forEach((r,l)=>{if((!(0,u.isDefined)(r.fromDate)||(0,u.isDefined)(o.fromDate)&&r.fromDate<=o.fromDate)&&(!(0,u.isDefined)(r.toDate)||(0,u.isDefined)(o.toDate)&&o.toDate<=r.toDate))if(r.routeId===a.routeId)if((0,u.isDefined)(i)){if(i!==ha(r.fromMeasure,t.measurePrecision)){if(e.selectedPolyline.paths.length>1)for(let s=0;s<e.selectedPolyline.paths.length;s++){const c=e.selectedPolyline.paths[s];if(c.length>0){const e=c[0].length-1,s=c[0][e],d=c[c.length-1][e];if((0,u.atOrBetween)([s,d],i,t.mTolerance)&&(0,u.atOrBetween)([s,d],r.fromMeasure,t.mTolerance)){const e={routeId:a.routeId,fromMeasure:i,toMeasure:ha(r.fromMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e);break}if((0,u.atOrBetween)([s,d],i,t.mTolerance)&&i!==ha(d,t.measurePrecision)){const e={routeId:a.routeId,fromMeasure:i,toMeasure:ha(d,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-1*l,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e)}else if((0,u.atOrBetween)([s,d],r.fromMeasure,t.mTolerance)&&ha(s,t.measurePrecision)!==ha(r.fromMeasure,t.measurePrecision)){const e={routeId:a.routeId,fromMeasure:ha(s,t.measurePrecision),toMeasure:ha(r.fromMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-1*l,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e)}else if((0,u.atOrBefore)(i,s,t.mTolerance)&&(0,u.atOrAfter)(r.fromMeasure,d,t.mTolerance)){const e={routeId:a.routeId,fromMeasure:ha(s,t.measurePrecision),toMeasure:ha(d,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-1*l,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e)}}}else{const e={routeId:a.routeId,fromMeasure:i,toMeasure:ha(r.fromMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-1*l,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e)}p=!0}const c={routeId:r.routeId,fromMeasure:ha(r.fromMeasure,t.measurePrecision),toMeasure:ha(r.toMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:r.sectionId,isDominant:r.isDominant,isChosen:r.isDominant,isAdded:!1};h.locations[n].concurrencies.push(c),s=!0,p=!0,i=ha(r.toMeasure,t.measurePrecision)}else{if(ha(a.fromMeasure,t.measurePrecision)!==ha(r.fromMeasure,t.measurePrecision)){const e={routeId:a.routeId,fromMeasure:ha(a.fromMeasure,t.measurePrecision),toMeasure:ha(r.fromMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-1*l,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e),p=!0}const e={routeId:r.routeId,fromMeasure:ha(r.fromMeasure,t.measurePrecision),toMeasure:ha(r.toMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:r.sectionId,isDominant:r.isDominant,isChosen:r.isDominant,isAdded:!1};h.locations[n].concurrencies.push(e),s=!0,p=!0,i=ha(r.toMeasure,t.measurePrecision)}else{const e={routeId:r.routeId,fromMeasure:ha(r.fromMeasure,t.measurePrecision),toMeasure:ha(r.toMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:r.sectionId,isDominant:r.isDominant,isChosen:r.isDominant,isAdded:!1};h.locations[n].concurrencies.push(e),s=!0,p=!0}}),(0,u.isDefined)(i)&&i!==ha(a.toMeasure,t.measurePrecision)){if(e.selectedPolyline.paths.length>1)for(let s=0;s<e.selectedPolyline.paths.length;s++){const r=e.selectedPolyline.paths[s];if(r.length>0){const e=r[0].length-1,s=r[0][e],l=r[r.length-1][e];if((0,u.atOrBetween)([s,l],i,t.mTolerance)&&(0,u.atOrBetween)([s,l],a.toMeasure,t.mTolerance)){const e={routeId:a.routeId,fromMeasure:i,toMeasure:ha(a.toMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e);break}if((0,u.atOrBetween)([s,l],i,t.mTolerance)&&i!==ha(l,t.measurePrecision)){const e={routeId:a.routeId,fromMeasure:i,toMeasure:ha(l,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e)}else if((0,u.atOrBetween)([s,l],a.toMeasure,t.mTolerance)&&ha(s,t.measurePrecision)!==ha(a.toMeasure,t.measurePrecision)){const e={routeId:a.routeId,fromMeasure:ha(s,t.measurePrecision),toMeasure:ha(a.toMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e)}else if((0,u.atOrBefore)(i,s,t.mTolerance)&&(0,u.atOrAfter)(a.toMeasure,l,t.mTolerance)){const e={routeId:a.routeId,fromMeasure:ha(s,t.measurePrecision),toMeasure:ha(l,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e)}p=!0}}else{const e={routeId:a.routeId,fromMeasure:i,toMeasure:ha(a.toMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e)}s=!0,p=!0}if(!s){const e={routeId:a.routeId,fromMeasure:ha(a.fromMeasure,t.measurePrecision),toMeasure:ha(a.toMeasure,t.measurePrecision),fromDate:o.fromDate,toDate:o.toDate,sectionId:-Number.MAX_VALUE,isDominant:!0,isChosen:!0,isAdded:!0};h.locations[n].concurrencies.push(e),p=!0}})}),m.size>0&&(null==h||h.locations.forEach(e=>{const t=m.get(e.routeId);e.routeName=t.routeName,e.lineId=t.lineId,e.concurrencies.forEach(e=>{const t=m.get(e.routeId);e.routeName=t.routeName,e.lineId=t.lineId})}));return{newResponse:h,response:s,concurrenciesAdded:p,dateRanges:f}})}var ja=m(1888),Aa=function(e,t,o,a){return new(o||(o=Promise))(function(n,i){function s(e){try{u(a.next(e))}catch(e){i(e)}}function r(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}u((a=a.apply(e,t||[])).next())})};function La(e){var i,s;const r=o.hooks.useTranslation(a),{intl:c,widgetId:d,lrsLayers:f,lineEventLayers:m,networkLayers:h,defaultEvent:p,defaultFromMethod:v,defaultToMethod:D,JimuMapView:g,operationType:b,hoverGraphic:I,pickedFromGraphic:R,pickedToGraphic:y,pickedConcurrencyGraphic:M,flashGraphic:S,hideEvent:T,hideNetwork:N,hideType:k,hideMethod:w,hideMeasures:j,hideDates:A,hideTitle:L,useRouteStartEndDate:x,conflictPreventionEnabled:O,networkDataSourceFromDataAction:E,routeInfoFromDataAction:C,onResetDataAction:P,onClearGraphics:F,onClearHoverGraphic:_,onOperationTypeChanged:G,hideAddToDominantRouteOption:V,enableAddToDominantRouteOption:U,notAllowOverrideEventReplacement:B}=e,[W,z]=o.React.useState(0),[Q,Z]=o.React.useState(null),[q,H]=o.React.useState(null),[J,$]=o.React.useState(null),[K,X]=o.React.useState(null),[Y,ee]=o.React.useState(!1),[te,oe]=o.React.useState(v),[ae,ne]=o.React.useState(D),[ie,se]=o.React.useState(!1),[re,ue]=o.React.useState((0,u.getInitialRouteInfoState)()),[le,ce]=o.React.useState(!1),[de,fe]=o.React.useState(!1),[me,he]=o.React.useState(!1),[pe,ve]=o.React.useState((0,u.getIntialLocksInfo)()),[De,ge]=o.React.useState(!O),be=o.React.useRef(null),[Ie,Re]=o.React.useState(!1),[ye,Me]=o.React.useState(null),[Se,Te]=o.React.useState(U),[Ne,ke]=o.React.useState(!1),[we,je]=o.React.useState(!1),[Ae,Le]=o.React.useState([]),xe=o.React.useRef(null),Oe=o.React.useCallback(e=>{Z(e)},[Z]),Ee=o.React.useCallback(e=>{H(e)},[H]),Ce=o.React.useCallback(()=>{ee(!0)},[ee]);o.React.useEffect(()=>{(0,o.focusElementInKeyboardMode)(be.current)},[]),o.React.useEffect(()=>{z(0),se(!0),(0,u.waitTime)(800).then(()=>{se(!1)})},[f]),o.React.useEffect(()=>{if(me){const e=re;e.selectedToMeasure=e.toRouteToMeasure,Qe(e)}if(de){const e=re;e.selectedMeasure=e.fromMeasure,Qe(e)}},[re,de,me]),o.React.useEffect(()=>{if((0,u.isDefined)(K)&&f.some(e=>e.name===K.name)){const e=f.find(e=>(0,u.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===K.eventInfo.parentNetworkId);e&&e.layerType===u.LrsLayerType.Network?$((0,o.Immutable)(e)):$(null)}else{const e=f.find(e=>e.name===p.name);X((0,o.Immutable)(e))}},[p,f,K]),o.React.useEffect(()=>{!function(){Aa(this,void 0,void 0,function*(){if((0,u.isDefined)(C)&&(isNaN(C.fromMeasure)||isNaN(C.toRouteToMeasure))){const e=yield(0,u.getRouteMeasures)(C,J,Q);(0,u.isDefined)(e.fromMeasure)&&(0,u.isDefined)(e.toRouteToMeasure)&&(C.fromMeasure=e.fromMeasure,C.toRouteToMeasure=e.toRouteToMeasure)}})}()},[E,C]),o.React.useEffect(()=>{const e=(0,u.isDefined)(E)||(0,u.isDefined)(C);e&&We(),e&&setTimeout(()=>{if((0,u.isDefined)(E)&&E.id!==(null==J?void 0:J.id)){Z(E);let e,t=E;(E.id.includes("output_point")||E.id.includes("output_line"))&&(t=E.getOriginDataSources()[0]),f.forEach(o=>{o.id===t.id&&(0,u.isDefined)(o.networkInfo)&&(e=o)});const o=f.find(t=>t.eventInfo.parentNetworkId===e.networkInfo.lrsNetworkId&&!t.eventInfo.isPointEvent);(0,u.isDefined)(o)&&Fe(o.name)}(0,u.isDefined)(C)&&(K.eventInfo.canSpanRoutes||C.routeId===C.toRouteId||(C.toRouteId=C.routeId,C.toRouteName=C.routeName,C.toRouteFromMeasure=C.fromMeasure,C.toRouteToMeasure=C.toMeasure,C.selectedToPolyline=C.selectedPolyline,C.toRouteFromDate=C.fromDate,C.toRouteToDate=C.toDate),Qe(C),ce(!0))},2e3)},[E,C]),o.React.useEffect(()=>{O&&Pe()},[K,J]);const Pe=(e=u.LockAction.None,t)=>{const o=Object.assign({},pe);(0,u.isDefined)(J)&&(o.networkId=[J.networkInfo.lrsNetworkId]),(0,u.isDefined)(K)&&(o.eventServiceLayerIds=[K.serviceId]),(0,u.isDefined)(t)&&(o.routeInfo=t,o.routeOrLineId=[]),o.lockAction=e,ve(o)},Fe=o.React.useCallback(e=>{const t=f.find(t=>t.name===e);if(t){const e=f.find(e=>(0,u.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===t.eventInfo.parentNetworkId),a=(0,u.getInitialRouteMeasurePickerInfoState)();if(Ke(a),e&&e.layerType===u.LrsLayerType.Network&&K&&(K.eventInfo.parentNetworkId!==t.eventInfo.parentNetworkId||t.eventInfo.canSpanRoutes||K.eventInfo.canSpanRoutes&&!t.eventInfo.canSpanRoutes)){if($((0,o.Immutable)(e)),!(0,u.isDefined)(C)){const e=(0,u.getInitialRouteInfoState)();Qe(e)}j||(fe(!1),he(!1))}Re(!0),X((0,o.Immutable)(t)),_()}},[f,K,J,C]),_e=o.React.useCallback(e=>{const t=f.find(t=>t.name===e);(0,u.isDefined)(t)&&$((0,o.Immutable)(t))},[f]),Ge=o.React.useCallback(e=>{oe(e)},[]),Ve=o.React.useCallback(e=>{ne(e)},[]),Ue=o.React.useCallback(e=>{e&&We(),z(0),be.current&&(0,o.focusElementInKeyboardMode)(be.current)},[]),Be=o.React.useCallback((e,t,a)=>{e&&We(),z(t&&a&&!B?1:0),be.current&&(0,o.focusElementInKeyboardMode)(be.current)},[]);o.React.useEffect(()=>{fe(j),he(j)},[j]),o.React.useEffect(()=>{j&&(fe(j),he(j))},[]);const We=()=>{F();const e=(0,u.getInitialRouteInfoState)();Qe(e,!1,!0);const t=(0,u.getInitialEventInfoState)();He(t);const o=(0,u.getInitialRouteMeasurePickerInfoState)();Ke(o),j||(fe(!1),he(!1)),Te(U),ke(!0),se(!0),setTimeout(()=>{ke(!1),se(!1)},800)},ze=()=>{ce(!1),P()},Qe=(e,t=!1,o=!1)=>{if(void 0!==e&&(ue(t=>Object.assign(Object.assign({},t),e)),et(e,t),O)){const t=o?u.LockAction.Clear:u.LockAction.QueryAndAcquire;Pe(t,e)}},[Ze,qe]=o.React.useState((0,u.getInitialEventInfoState)()),He=e=>{qe(e)},[Je,$e]=o.React.useState((0,u.getInitialRouteMeasurePickerInfoState)()),Ke=e=>{$e(e)};o.React.useEffect(()=>{(0,u.isDefined)(J)&&!(0,u.isDefined)(E)&&(ue((0,u.getInitialRouteInfoState)()),qe((0,u.getInitialEventInfoState)()))},[J]);const Xe=()=>{(0,u.isDefined)(R)&&R.removeAll()},Ye=()=>{(0,u.isDefined)(y)&&y.removeAll()},et=(e,t)=>Aa(this,void 0,void 0,function*(){var o;(0,u.isDefined)(e.selectedPolyline)&&t&&(o=yield(0,u.getGeometryGraphic)(yield(0,u.getSimpleLineGraphic)(e.selectedPolyline),Ra),(0,u.isDefined)(o)&&(S.add(o),setTimeout(()=>{S.removeAll(),setTimeout(()=>{S.add(o),setTimeout(()=>{S.removeAll(),setTimeout(()=>{S.add(o),setTimeout(()=>{S.removeAll()},800)},800)},800)},800)},800))),(0,u.isDefined)(e.selectedPoint)?(e=>{(0,u.isDefined)(e)?(R.removeAll(),R.add(e)):Xe()})(yield(0,u.getGeometryGraphic)(yield(0,u.getSimplePointGraphic)(e.selectedPoint),ya)):Xe(),(0,u.isDefined)(e.selectedToPoint)?(e=>{(0,u.isDefined)(e)?(y.removeAll(),y.add(e)):Ye()})(yield(0,u.getGeometryGraphic)(yield(0,u.getSimplePointGraphic)(e.selectedToPoint),Ma)):Ye(),(0,u.isDefined)(g)&&g.clearSelectedFeatures()}),tt=o.React.useCallback(()=>function(e,t,o,a){var n,i,s;if(!Fo(e))return!1;let r=!0;if(r=r&&(null===(n=e.routeId)||void 0===n?void 0:n.length)>0,r=r&&(null===(i=e.toRouteId)||void 0===i?void 0:i.length)>0,!o)return!1;if(!Fo(a)||!Fo(a.networkInfo))return!1;const u=ha(e.fromMeasure,a.networkInfo.measurePrecision),l=ha(e.toMeasure,a.networkInfo.measurePrecision),c=ha(e.selectedMeasure,a.networkInfo.measurePrecision),d=ha(e.selectedToMeasure,a.networkInfo.measurePrecision);if(isNaN(u)||isNaN(c))return!1;if(r=r&&c>=u&&(c<d||e.routeId!==e.toRouteId),null===(s=t.eventInfo)||void 0===s?void 0:s.canSpanRoutes){const t=ha(e.toRouteFromMeasure,a.networkInfo.measurePrecision),o=ha(e.toRouteToMeasure,a.networkInfo.measurePrecision);if(isNaN(t)||isNaN(d))return!1;if(r=r&&d>=t,isNaN(o)||isNaN(d))return!1;r=r&&d<=o}else{if(isNaN(l)||isNaN(d))return!1;r=r&&d<=l&&(c<d||e.routeId!==e.toRouteId)}const f=_o(e.fromDate),m=_o(e.toDate),h=_o(e.selectedFromDate),p=_o(e.selectedToDate),v=_o(null==e?void 0:e.toRouteFromDate),D=_o(null==e?void 0:e.toRouteToDate);return Fo(e.selectedFromDate)&&!Fo(e.selectedToDate)&&(Fo(e.fromDate)&&(r=r&&h>=f),Fo(e.toDate)&&(r=r&&h<m)),!Fo(e.selectedFromDate)&&Fo(e.selectedToDate)&&(Fo(e.fromDate)&&(r=r&&p>=f),Fo(e.toDate)&&(r=r&&p<m)),Fo(e.selectedFromDate)&&Fo(e.selectedToDate)&&(r=r&&h<p,Fo(e.fromDate)&&(r=r&&h>=f),Fo(e.toDate)&&(r=r&&p<=m)),!(!Fo(e.selectedFromDate)&&!Fo(e.selectedToDate))&&!(e.routeId!==e.toRouteId&&Fo(e.fromDate)&&Fo(e.toRouteFromDate)&&(h<f||Fo(e.toDate)&&h>m||h<v||Fo(e.toRouteToDate)&&h>D))&&r}(re,K,De,J),[re,De]),ot=o.React.useCallback((e,t,o)=>{ge(!!o),ve(e)},[]),at=o.React.useCallback(e=>{Te(e)},[]),nt=o.React.useCallback(e=>{Me(e)},[]),it=o.React.useCallback(e=>{e&&(ke(!0),setTimeout(()=>{ke(!1)},800))},[]),st=o.React.useCallback((e,t,o,a)=>Aa(this,void 0,void 0,function*(){if(ue(e),Re(!1),ke(!1),a){const a=yield wa(e,o,t);Le(a.dateRanges),Me(a.newResponse),a.response.locations.length>0&&a.concurrenciesAdded&&!B?(je(!0),z(1)):(je(!1),z(2))}else z(2)}),[]),rt=o.React.useCallback(()=>{var e;null===(e=xe.current)||void 0===e||e.handleNextClicked()},[]);return(0,t.jsxs)("div",{className:"add-single-line-event h-100 d-flex",ref:be,tabIndex:-1,css:o.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .add-single-line-event-form {
      height: 100%;
    }
    .add-single-line-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-single-line-event__actions {
      height: 100%;
    }
    .add-line-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsx)(Wo,{network:J,event:K,dataSourcesReady:Ce,onCreateNetworkDs:Oe,onCreateEventDs:Ee}),!L&&(0,t.jsx)(l,{}),(0,t.jsxs)("div",{className:(0,o.classNames)("add-single-line-event__content",{"d-none":0!==W,[n.FOCUSABLE_CONTAINER_CLASS]:0===W}),children:[O&&(0,t.jsx)(u.LockManagerComponent,{intl:c,showAlert:!0,featureDS:Q,lockInfo:pe,networkName:null===(i=null==J?void 0:J.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:O,onQueryAndAcquireComplete:ot,onMessageClear:()=>{Pe(u.LockAction.None)}}),!k&&(0,t.jsx)(Ta,{operationType:b,onOperationTypeChanged:G}),!T&&(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100 title3",children:r("eventLayerLabel")}),(0,t.jsx)(n.Select,{"aria-label":r("eventLayerLabel"),className:"w-100 px-3",size:"sm",value:K?K.name:"",disabled:1===m.length,onChange:e=>{Fe(e.target.value)},children:m.map((e,o)=>(0,t.jsx)(n.Option,{value:e,children:e},o))})]}),!N&&(0,t.jsx)(u.InlineEditableDropdown,{label:r("networkLabel"),isDisabled:!0,defaultItem:(0,u.isDefined)(J)?J.name:"",listItems:h,onSelectionChanged:_e}),!w&&(0,t.jsx)(u.InlineEditableDropdown,{label:r("fromMethodLabel"),defaultItem:te,isDisabled:!0,listItems:[u.SearchMethod.Measure],altItemDescriptions:[r("routeAndMeasure")],onSelectionChanged:Ge}),(0,t.jsx)(ga,{intl:c,widgetId:d,network:J?J.networkInfo:null,event:K,dsReady:!Y,networkDS:Q,method:te,jimuMapView:g,hoverGraphic:I,pickedGraphic:R,isFrom:!0,routeInfo:re,routeMeasurePickerInfo:Je,reset:ie,hideMeasures:j,revalidateRouteFromDataAction:le,onResetDataAction:ze,canSpanRoutes:!(!(0,u.isDefined)(K)||!(0,u.isDefined)(K.eventInfo))&&K.eventInfo.canSpanRoutes,onUpdateRouteInfo:Qe,onUpdateRouteMeasurePickerInfo:Ke,useStartMeasure:de,useEndMeasure:me,onsubmit:st,ref:xe,addToDominantRoute:Se}),!j&&(0,t.jsxs)(n.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100 label2",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{checked:de,className:"mr-2",disabled:!(0,u.isDefined)(re)||isNaN(re.fromMeasure),onChange:(e,t)=>{if(t){const e=re;e.selectedMeasure=e.fromMeasure,Qe(e)}fe(t)}}),r("useStartMeasureLabel")]}),!w&&(0,t.jsx)(u.InlineEditableDropdown,{label:r("toMethodLabel"),defaultItem:ae,isDisabled:!0,listItems:[u.SearchMethod.Measure],altItemDescriptions:[r("routeAndMeasure")],onSelectionChanged:Ve}),(0,t.jsx)(ga,{intl:c,widgetId:d,network:J?J.networkInfo:null,event:K,dsReady:!Y,networkDS:Q,method:ae,jimuMapView:g,hoverGraphic:I,pickedGraphic:y,isFrom:!1,routeInfo:re,routeMeasurePickerInfo:Je,reset:ie,hideMeasures:j,revalidateRouteFromDataAction:le,onResetDataAction:ze,canSpanRoutes:!(!(0,u.isDefined)(K)||!(0,u.isDefined)(K.eventInfo))&&K.eventInfo.canSpanRoutes,onUpdateRouteInfo:Qe,onUpdateRouteMeasurePickerInfo:Ke,useStartMeasure:de,useEndMeasure:me,onsubmit:st,ref:xe,addToDominantRoute:Se}),!j&&(0,t.jsxs)(n.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100 label2",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{checked:me,className:"mr-2",disabled:!(0,u.isDefined)(null==re?void 0:re.toRouteToMeasure)||isNaN(re.toRouteToMeasure),onChange:(e,t)=>{if(t){const e=re;e.selectedToMeasure=e.toRouteToMeasure,Qe(e)}he(t)}}),r("useEndMeasureLabel")]}),(0,t.jsx)(Ia,{intl:c,hideDates:A,useRouteStartEndDate:x,routeInfo:re,eventInfo:K?K.eventInfo:null,network:J?J.networkInfo:null,revalidateRouteFromDataAction:le,onUpdateRouteInfo:Qe}),(0,t.jsx)(Sa,{eventInfo:Ze,onUpdateEventInfo:He,hideAddToDominantRouteOption:V,addToDominantRoute:Se,onUpdateAddToDominantRoute:at})]}),(0,t.jsxs)("div",{className:(0,o.classNames)("add-line-footer w-100",{"d-none":0!==W,[n.FOCUSABLE_CONTAINER_CLASS]:0===W}),children:[(0,t.jsx)(n.Label,{size:"sm",className:"mt-auto mr-auto title3",centric:!0,style:{color:null===(s=(0,ja.getTheme)())||void 0===s?void 0:s.sys.color.primary.main},onClick:We,children:r("resetForm")}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(n.Button,{type:"primary",className:"active","aria-label":r("nextLabel"),size:"sm",disabled:!tt()&&Y,onClick:rt,children:r("nextLabel")})})]}),(0,t.jsx)("div",{className:(0,o.classNames)("add-single-line-event__content",{"d-none":1!==W,[n.FOCUSABLE_CONTAINER_CLASS]:1===W}),children:(0,t.jsx)(Na,{intl:c,networkDS:Q,network:J,eventLayer:K,routeInfo:re,reset:ie||Ie||Ne,conflictPreventionEnabled:O,onNavBack:Ue,onNavNext:()=>{Re(!1),ke(!1),z(2)},concurrenciesResponse:ye,onConcurrenciesResponseUpdated:nt,onResetClicked:it,dateRanges:Ae,pickedConcurrencyGraphic:M})}),(0,t.jsx)("div",{className:(0,o.classNames)("add-single-line-event__content",{"d-none":2!==W,[n.FOCUSABLE_CONTAINER_CLASS]:2===W}),children:Q&&q&&(0,t.jsx)(Bo,{intl:c,widgetId:d,networkDS:Q,network:J,eventDS:q,eventLayer:K,routeInfo:re,eventInfo:Ze,reset:ie||Ie,jimuMapView:g,hoverGraphic:I,conflictPreventionEnabled:O,onNavBack:Be,hasConcurrencies:we,addToDominantRoute:Se,concurrenciesResponse:ye})})]})}var xa=function(e,t,o,a){return new(o||(o=Promise))(function(n,i){function s(e){try{u(a.next(e))}catch(e){i(e)}}function r(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}u((a=a.apply(e,t||[])).next())})};let Oa=[];function Ea(e){const i=o.hooks.useTranslation(a),{intl:s,widgetId:r,networkDS:l,network:c,eventLayers:d,routeInfo:f,eventInfo:m,attributeSet:h,reset:p,isReady:v,jimuMapView:D,hoverGraphic:g,conflictPreventionEnabled:b,onNavBack:I,hasConcurrencies:R,addToDominantRoute:y,concurrenciesResponse:M}=e,[S,T]=o.React.useState([]),[N,k]=o.React.useState([]),[w,j]=o.React.useState([]),[A,L]=o.React.useState([]),[x,O]=o.React.useState(!1),[E,C]=o.React.useState(),[P,F]=o.React.useState(""),[_,G]=o.React.useState(!1),[V,U]=o.React.useState(!1),[B,W]=o.React.useState(!1),[z,Q]=o.React.useState((0,u.getIntialLocksInfo)()),[Z,q]=o.React.useState(!0),[H,J]=o.React.useState(!1),{sessionId:$,startEditSession:K,addEdit:X}=(0,u.useVmsManager)(),{supportsEditSession:Y}=(0,u.useEditSession)();o.React.useEffect(()=>{p&&te(d)},[p]),o.React.useEffect(()=>{(0,u.isDefined)(h)&&(0,u.isDefined)(d)&&v&&te(d)},[h,d,v]),o.React.useEffect(()=>{ee()},[l,c,d,f]);const ee=(e=u.LockAction.None,t,o)=>{if(b){const a=Object.assign({},z);if((0,u.isDefined)(c)&&(a.networkId=[c.lrsNetworkId]),(0,u.isDefined)(d)){const e=(0,u.isDefined)(o)?o:A;if((0,u.isDefined)(M))a.isLine=[],a.routeOrLineId=[],a.eventServiceLayerIds=[],w.forEach((t,o)=>{var n;e[o]&&(null===(n=null==M?void 0:M.locations)||void 0===n||n.forEach(e=>{var o;null===(o=null==e?void 0:e.concurrencies)||void 0===o||o.forEach(e=>{e.isChosen&&(a.isLine.push(c.supportsLines),a.routeOrLineId.push(c.supportsLines?e.lineId:e.routeId),a.eventServiceLayerIds.push(t.serviceId))})}))});else{const t=[];w.forEach((o,a)=>{e[a]&&t.push(o.serviceId)}),a.eventServiceLayerIds=t}}(0,u.isDefined)(t)&&(a.routeInfo=t,(0,u.isDefined)(M)||(a.routeOrLineId=[])),a.lockAction=e,Q(a)}},te=e=>{if((0,u.isDefined)(e)){const t=[],o=[],a=[],n=[];e.forEach(e=>{const i=oe(e),s=ae(e,i);t.push(i),o.push(s),a.push(e.asMutable({deep:!0})),n.push(!0)}),T(t),k(o),j(a),W(0===a.length),L(n),ee(u.LockAction.None,f,n),q(!0)}},oe=e=>{if((0,u.isDefined)(e)&&(0,u.isDefined)(e.useDataSource)){const t=o.DataSourceManager.getInstance().getDataSource(e.useDataSource.dataSourceId);if((0,u.isDefined)(t))return t}},ae=(e,t)=>{const o=[];if((0,u.isDefined)(t)){const a=t,n=(null==a?void 0:a.layer).fields,i=h.layers.find(t=>t.layerId===e.serviceId);(0,u.isDefined)(i)&&i.fields.forEach(e=>{const t=n.find(t=>t.name===e.name);if(t){let a;""!==e.value&&(a=(0,u.isDate)(t.type)?(0,u.isDefined)(e.value)?new Date(e.value):null:(0,u.isNumber)(t.type)?Number(e.value):e.value);const n={index:o.length,name:t.name,alias:t.alias,type:t.type,hasDomain:(0,u.isDefined)(t.domain),value:a,error:"",nullable:t.nullable,default:"number"==typeof a?Number(a).toString():a,length:t.length,editable:t.editable};o.push(n)}})}return o},ne=e=>e.findIndex(e=>e.error.length>0)>-1,ie=(e,t,o,a)=>{const n=ko(N),i=ko(n[a]);i[o].value=e,i[o].error=t,n[a]=i,k(n),G(ne(n[a]))},se=(e,t)=>{const o=ko(N);o[t]=e,k(o),G(ne(e))},re=(e,t)=>{var o;const a=ko(Oa);a[t]=e,Oa=a,Oa[t]&&0!==(null===(o=Oa[t])||void 0===o?void 0:o.length)||U(!1)},ue=(e,t)=>{const o=A;o[t]=e,L(o),ee(u.LockAction.None,f,o),o.every(e=>!e)?W(!0):W(!1)},le=(e,t,o)=>{b?(J(!1),ee(u.LockAction.Clear)):I(e,!e&&t,o)},ce=()=>{S.forEach(e=>xa(this,void 0,void 0,function*(){var t;const a=e,n=a.getPopupInfo(),i=a.getLayerDefinition(),s=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==i?void 0:i.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==n?void 0:n.fieldInfos)||[]).filter(e=>e.visible)),u=a.mergeQueryParams(null!==(t=a.getCurrentQueryParams())&&void 0!==t?t:{},{where:"1=1",sqlExpression:null}),l=Object.assign({returnGeometry:!0},u);yield a.load(l,{widgetId:r});const c=new o.DataRecordSetChangeMessage(r,o.RecordSetChangeType.CreateUpdate,[{records:a.getRecords(),fields:s.map(e=>e.fieldName),dataSource:a,name:a.id}]);o.MessageManager.getInstance().publishMessage(c)}))},de=(e,t,a,n,i,s,r)=>xa(this,void 0,void 0,function*(){const d={};let m=!1,h=!1;t.eventInfo.canSpanRoutes?f.routeLineOrder>f.toRouteLineOrder?m=!0:f.routeId===f.toRouteId&&f.selectedMeasure>f.selectedToMeasure&&(h=!0):f.selectedMeasure>f.selectedToMeasure&&(h=!0);const p=t.eventInfo.eventIdFieldName;d[p]="{"+(0,u.getUUID)()+"}";const v=t.eventInfo.routeIdFieldName;d[v]=n.routeId;const D=t.eventInfo.fromMeasureFieldName;d[D]=n.fromMeasure;const g=t.eventInfo.fromDateFieldName;if(!s&&n.fromDate){const e=(0,u.isDefined)(n.fromDate)?(0,u.getDateWithoutTZOffset)(n.fromDate.valueOf(),l):null;d[g]=(0,u.getDateToUTC)(e)}else d[g]=n.fromDate;const b=t.eventInfo.toDateFieldName;if(!r&&n.toDate){const e=(0,u.isDefined)(n.toDate)?(0,u.getDateWithoutTZOffset)(n.toDate.valueOf(),l):null;d[b]=(0,u.getDateToUTC)(e)}else d[b]=n.toDate;if(t.eventInfo.toRouteIdFieldName&&t.eventInfo.toRouteIdFieldName.length>0){const e=t.eventInfo.toRouteIdFieldName;d[e]=n.toRouteId,m&&(d[v]=n.toRouteId,d[e]=n.routeId)}if(t.eventInfo.toMeasureFieldName&&t.eventInfo.toMeasureFieldName.length>0){const e=t.eventInfo.toMeasureFieldName;d[e]=n.toMeasure,(m||h)&&(d[D]=n.toMeasure,d[e]=n.fromMeasure)}N[a].forEach(e=>{const t=e.name;if((0,u.isDefined)(e.value)&&(0,u.isDate)(e.type)){const o=(0,u.getDateWithoutTZOffset)(e.value.valueOf(),l);d[t]=(0,u.getDateToUTC)(o)}else(0,u.isNumber)(e.type)?!(0,u.isDefined)(e.value)||""===e.value||isNaN(Number(e.value))?d[t]=null:d[t]=Number(e.value):d[t]=e.value});const I={};if(i||t.eventInfo.canSpanRoutes||f.routeId===f.toRouteId){const t={attributes:d};e.push(t)}else{const a=c.routeIdFieldSchema.jimuName,n=c.routeNameFieldSchema.jimuName,i=c.lineOrderFieldSchema.jimuName,s=c.fromDateFieldSchema.jimuName,r=yield(0,u.queryAllRoutesByLineId)(f.lineId,c,l);if((0,u.isDefined)(r)&&(yield Promise.all(r.features.map(e=>{const t=e.attributes[a],o={routeId:"",routeName:"",fromMeasure:0,toMeasure:0,fromDate:void 0,toDate:void 0,selectedMeasure:0,selectedFromDate:void 0,selectedToDate:void 0,routeLineOrder:0,selectedPolyline:null};return o.routeId=t,o.routeName=e.attributes[n],o.routeLineOrder=e.attributes[i],o.fromDate=e.attributes[s],o.selectedPolyline=e.geometry,I[t]=o,I}))),Object.keys(I).length){const a=Object.keys(I).sort((e,t)=>I[e].routeLineOrder-I[t].routeLineOrder),n=Object.fromEntries(a.map(e=>[e,I[e]])),i=t.eventInfo.toMeasureFieldName;for(const[a,s]of Object.entries(n)){const n=structuredClone(d),r=s.routeLineOrder;if(r<f.routeLineOrder)continue;let m=!1,h=null,g=!1,b=NaN,I=NaN,R="",y="";if(a===f.routeId)R=a,y=f.routeName,b=f.selectedMeasure,I=f.toMeasure,h=yield(0,u.QueryPolylineOnRoute)(l,c,R,a,f.fromDate,b.toString(),I.toString()),m=!0;else if(r>f.routeLineOrder&&r<f.toRouteLineOrder){h=s.selectedPolyline;const e=(0,u.getRouteFromEndMeasures)(h),t=yield(0,u.QueryRouteMeasures)(l,c,e,s.fromDate,a);b=ha(Math.min(...t),c.measurePrecision),I=ha(Math.max(...t),c.measurePrecision),R=a,m=!0}else a===f.toRouteId&&(R=a,y=f.toRouteName,b=f.toRouteFromMeasure,I=f.selectedToMeasure,h=yield(0,u.QueryPolylineOnRoute)(l,c,a,a,f.fromDate,b.toString(),I.toString()),m=!0,g=!0);if(m){if(n[p]="{"+o.utils.getUUID()+"}",n[v]=R,n[D]=b,n[i]=I,t.eventInfo.routeNameFieldName&&t.eventInfo.routeNameFieldName.length>0){n[t.eventInfo.routeNameFieldName]=y}const a={attributes:n,geometry:h};if(e.push(a),g)break}}}}}),fe=e=>xa(this,void 0,void 0,function*(){if((()=>{const e=ko(N);let t=!1;return e.forEach((o,a)=>{if(A[a]){const n=ko(o);n.forEach((s,r)=>{let l;if(l=s.hasDomain?(0,u.validateRangeDomain)(s.value,s.name,S[a]):((0,u.isDate)(s.type),(0,u.validateField)(s.value,s.name,S[a])),(0,u.isDefined)(Oa[a])){const e=Go(s.value,0,r,o,Oa[a]);if((null==e?void 0:e.length)>0){let t=[];e.forEach(e=>{var o;const a=null===(o=null==e?void 0:e.fieldGroup)||void 0===o?void 0:o.fields;t.push(a)}),t=t.flat(),t.includes(s.name)&&(U(!0),G(!0),l={hasError:!0,message:"contingentValueError"})}}if(l.hasError){let o;if("contingentValueError"===l.message){const e=[];Oa[a].forEach(t=>{e.push(t.name)});let t=i("invalidContingentValues");t=t.replace("{groupNames}",e.join(",")),o=t}else{const e=w[a].useFieldAlias?s.alias:s.name;o=i("attributeError",{fieldValue:e,message:i(l.message)})}C("error"),F(o),O(!0),setTimeout(()=>{O(!1)},5e3),t=!0,s.error=i(l.message),e[a]=n}})}}),t&&k(e),t})())return;const t=S[0];let a=t.getGDBVersion();a||(a="");const n={edits:[]};if(yield Promise.all(w.map((e,t)=>xa(this,void 0,void 0,function*(){if(A[t]&&(0,u.isDefined)(e)){const o=[];if((0,u.isDefined)(M)&&M.locations.length>0){for(const a of M.locations)if(0===a.concurrencies.length){const n={routeId:a.routeId,fromMeasure:a.fromMeasure,toMeasure:a.toMeasure,fromDate:(0,u.getDateWithRouteTime)(f.selectedFromDate,f.fromDate),toDate:(0,u.getDateWithRouteTime)(f.selectedToDate,f.toDate)};yield de(o,e,t,n,!0,!1,!1)}else for(const n of a.concurrencies)if(n.isChosen){const a={routeId:n.routeId,fromMeasure:n.fromMeasure,toMeasure:n.toMeasure,fromDate:n.fromDate,toDate:n.toDate},i=!(0,u.isDefined)(f.selectedFromDate)||n.fromDate.valueOf()!==f.selectedFromDate.valueOf(),s=!(0,u.isDefined)(f.selectedToDate)||n.toDate.valueOf()!==f.selectedToDate.valueOf();yield de(o,e,t,a,!0,i,s)}}else{const a={routeId:f.routeId,fromMeasure:f.selectedMeasure,toMeasure:f.selectedToMeasure,fromDate:(0,u.getDateWithRouteTime)(f.selectedFromDate,f.fromDate),toDate:(0,u.getDateWithRouteTime)(f.selectedToDate,f.toDate)};yield de(o,e,t,a,!1,!1,!1)}const a={id:e.serviceId,adds:o,allowMerge:m.mergeCoincident,retireMeasureOverlap:m.retireOverlapping,retireByEventId:!1};n.edits.push(a)}return n}))),Y){const e=yield K();if(!e.success)return C("error"),F(e.error),O(!0),void setTimeout(()=>{O(!1)},5e3)}yield(0,u.LrsApplyEdits)(t,(0,o.Immutable)(w[0]),$,n,null,null).then(t=>{t.success?(Y&&X(t,i("addMultipleLineEvents")),C("success"),F(i("eventCreated")),O(!0),ce(),setTimeout(()=>xa(this,void 0,void 0,function*(){if(O(!1),b){J(!0),yield(0,u.tryReleaseLockOnDefault)(l,e);const t=Object.assign(Object.assign({},e),{lockAction:u.LockAction.Clear});Q(t)}else le(!0,!1,y)}),5e3)):(C("error"),F(`${t.message} \n ${t.details}`),O(!0),setTimeout(()=>{O(!1)},5e3))})}),me=e=>{e.every(e=>e)?q(!0):(e.every(e=>!e),q(!1))};return(0,t.jsxs)("div",{className:"h-100",css:o.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-multiple-line-events-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-multiple-line-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-multiple-line-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-multiple-line-events-edit-attributes__action {
      height: auto;
    }
    .add-multiline-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsxs)("div",{className:"add-multiple-line-events-edit-attributes__content",children:[b&&(0,t.jsx)(u.LockManagerComponent,{intl:s,featureDS:l,lockInfo:z,showAlert:!0,networkName:null==c?void 0:c.datasetName,conflictPreventionEnabled:b,onQueryAndAcquireComplete:(e,t,o)=>{Q(e),o&&fe(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},z),{lockAction:u.LockAction.None});Q(e),I(H,!H&&R,y),J(!1)}}),(0,t.jsxs)("div",{className:"attribute-picker d-flex w-100 px-3",children:[(0,t.jsx)("div",{className:"mr-auto",children:(0,t.jsxs)(n.Label,{size:"sm",className:"text-truncate w-100 pt-2 title3",centric:!0,check:!0,style:{textOverflow:"ellipsis"},children:[(0,t.jsx)(n.Checkbox,{checked:Z,className:"mr-2",onChange:e=>{const t=e.target.checked,o=A;o.forEach((e,a)=>{o[a]=t}),L(o),me(o),o.every(e=>!e)?W(!0):W(!1)}}),i("selectAllLabel")]})}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(u.CopyAttributeTool,{disabled:!1,networkDs:l,eventDataSources:S,jimuMapView:D,hoverGraphic:g,onAttributesCopied:e=>{const t=ko(N);e.forEach(e=>{const o=d.findIndex(t=>t.serviceId.toString()===e.layerId);if(o>-1){const a=ko(t[o]);e.fieldValuePair.forEach(e=>{const t=a.findIndex(t=>t.name===e.name);if(t>-1){let o=e.value;(0,u.isDate)(a[t].type)&&(o=(0,u.isDefined)(e.value)?new Date(e.value):null),a[t].value=o}}),t[o]=a}}),k(t)}})})]}),V&&(0,t.jsx)(n.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){U(!1)},open:V,text:P,type:"warning",closable:!0,withIcon:!0}),(0,u.isDefined)(N)&&N.map((e,a)=>(0,t.jsx)(u.AttributeTable,{tableIndex:a,eventDS:S[a],eventLayer:(0,o.Immutable)(w[a]),fieldInfos:e,useAlias:!0,collapable:!0,isExpanded:A[a],onItemChecked:ue,onUpdateItem:ie,onFieldGrpUpdated:re,onUpdateAll:se},a)),x&&(0,t.jsx)("div",{className:"add-multiple-line-event-edit-attributes__toast-container w-100 p-3",children:(0,t.jsx)(n.Alert,{className:"add-multiple-line-event-edit-attributes__toast w-100",type:E,text:P,closable:!0,withIcon:!0,open:x,onClose:()=>{O(!1)}})})]}),(0,t.jsx)("div",{className:"add-multiline-attributes-footer w-100",children:(0,t.jsxs)("div",{className:"add-multiple-line-events-edit-attributes__action w-100 d-flex",children:[(0,t.jsx)("div",{className:"mt-auto mr-auto",children:(0,t.jsx)(n.Button,{"aria-label":i("backLabel"),size:"sm",type:"secondary",onClick:()=>{le(!1,R,y)},children:i("backLabel")})}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(n.Button,{type:"primary",className:"active","aria-label":i("saveLabel"),size:"sm",disabled:_||B||V,onClick:()=>{b?ee(u.LockAction.QueryAndAcquire,f,A):fe()},children:i("saveLabel")})})]})})]})}function Ca(e){const{events:a,dataSourcesReady:n}=e,[i,s]=o.React.useState(null!=a?a:null),[r,l]=o.React.useState([]);o.React.useEffect(()=>{if(a){s(a);const e=Array(a.length).fill(!1);l(e)}},[a]),o.React.useEffect(()=>{n(e=>e.every(Boolean))},[n,r]);const c=o.React.useCallback((e,t)=>{const o=Object.assign({},r);o[e]=t,l(o)},[r]),d=o.React.useCallback((e,t)=>{c(t,!0)},[c]),f=o.React.useCallback((e,t)=>{if(e){const{status:a,instanceStatus:n}=e;n===o.DataSourceStatus.NotCreated||n===o.DataSourceStatus.CreateError||a===o.DataSourceStatus.LoadError||a===o.DataSourceStatus.NotReady?c(t,!1):c(t,!0)}},[c]),m=o.React.useCallback(e=>{c(e,!1)},[c]);return(0,t.jsx)("div",{children:(0,u.isDefined)(i)&&i.map((e,a)=>(0,t.jsx)(o.DataSourceComponent,{useDataSource:e.useDataSource,onDataSourceInfoChange:e=>{f(e,a)},onCreateDataSourceFailed:e=>{m(a)},onDataSourceCreated:e=>{d(e,a)}}))})}var Pa=function(e,t,o,a){return new(o||(o=Promise))(function(n,i){function s(e){try{u(a.next(e))}catch(e){i(e)}}function r(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}u((a=a.apply(e,t||[])).next())})};function Fa(e){var i,s;const r=o.hooks.useTranslation(a),{intl:c,widgetId:d,lrsLayers:f,jimuMapView:m,operationType:h,networkLayers:p,defaultNetwork:v,defaultFromMethod:D,defaultToMethod:g,defaultAttributeSet:b,attributeSets:I,hoverGraphic:R,pickedFromGraphic:y,pickedToGraphic:M,pickedConcurrencyGraphic:S,flashGraphic:T,hideMethod:N,hideNetwork:k,hideType:w,hideAttributeSet:j,hideMeasures:A,hideDates:L,hideTitle:x,useRouteStartEndDate:O,conflictPreventionEnabled:E,networkDataSourceFromDataAction:C,routeInfoFromDataAction:P,onResetDataAction:F,onClearGraphics:_,onClearHoverGraphic:G,onOperationTypeChanged:V,hideAddToDominantRouteOption:U,enableAddToDominantRouteOption:B,notAllowOverrideEventReplacement:W}=e,[z,Q]=o.React.useState(0),[Z,q]=o.React.useState(null),[H,J]=o.React.useState(null),[$,K]=o.React.useState(null),[X,Y]=o.React.useState(!1),[ee,te]=o.React.useState(!1),[oe,ae]=o.React.useState(D),[ne,ie]=o.React.useState(g),[se,re]=o.React.useState(b),[ue,le]=o.React.useState(null),[ce,de]=o.React.useState(!1),[fe,me]=o.React.useState((0,u.getInitialRouteInfoState)()),[he,pe]=o.React.useState(!1),[ve,De]=o.React.useState((0,u.getIntialLocksInfo)()),[ge,be]=o.React.useState(!1),[Ie,Re]=o.React.useState(!1),ye=o.React.useRef(null),[Me,Se]=o.React.useState(null),[Te,Ne]=o.React.useState(B),[ke,we]=o.React.useState(!1),[je,Ae]=o.React.useState(!1),[Le,xe]=o.React.useState([]),Oe=o.React.useRef(null),Ee=o.React.useCallback(e=>{q(e)},[q]),Ce=o.React.useCallback(()=>{Y(!0)},[Y]),Pe=o.React.useCallback(()=>{te(!0)},[te]),Fe=o.React.useCallback(e=>{const t=f.find(t=>t.name===e);(0,u.isDefined)(t)&&J((0,o.Immutable)(t)),A||(be(!1),Re(!1))},[f]);o.React.useEffect(()=>{(0,o.focusElementInKeyboardMode)(ye.current)},[]),o.React.useEffect(()=>{Q(0),de(!0),(0,u.waitTime)(800).then(()=>{de(!1)})},[f]),o.React.useEffect(()=>{if(!(0,u.isDefined)(H))if((0,u.isDefined)(v)){const e=f.find(e=>e.name===v.name);J((0,o.Immutable)(e))}else{const e=f.find(e=>e.layerType===u.LrsLayerType.Network);J(e?(0,o.Immutable)(e):null)}if(!(0,u.isDefined)(ue)){const e=I.attributeSet.find(e=>e.title===se);e?le(e):I.attributeSet.length>0&&(le(I.attributeSet[0].asMutable({deep:!0})),re(I.attributeSet[0].title))}},[f,v]),o.React.useEffect(()=>{!function(){Pa(this,void 0,void 0,function*(){if((0,u.isDefined)(P)&&(isNaN(P.fromMeasure)||isNaN(P.toRouteToMeasure))){const e=yield(0,u.getRouteMeasures)(P,H,Z);(0,u.isDefined)(e.fromMeasure)&&(0,u.isDefined)(e.toRouteToMeasure)&&(P.fromMeasure=e.fromMeasure,P.toRouteToMeasure=e.toRouteToMeasure)}})}()},[C,P]),o.React.useEffect(()=>{const e=(0,u.isDefined)(C)||(0,u.isDefined)(P);e&&ze(),e&&setTimeout(()=>{if((0,u.isDefined)(C)&&C.id!==(null==H?void 0:H.id)){q(C);let e,t=C;(C.id.includes("output_point")||C.id.includes("output_line"))&&(t=C.getOriginDataSources()[0]),f.forEach(o=>{o.id===t.id&&(0,u.isDefined)(o.networkInfo)&&(e=o)});const o=e.name;Fe(o)}(0,u.isDefined)(P)&&(qe.canSpanRoutes||P.routeId===P.toRouteId||(P.toRouteId=P.routeId,P.toRouteName=P.routeName,P.toRouteFromMeasure=P.fromMeasure,P.toRouteToMeasure=P.toMeasure,P.selectedToPolyline=P.selectedPolyline,P.toRouteFromDate=P.fromDate,P.toRouteToDate=P.toDate),Ze(P),pe(!0))},2e3)},[C,P]),o.React.useEffect(()=>{E&&_e()},[Z,ue,H]);const _e=(e=u.LockAction.None,t)=>{const o=Object.assign({},ve);if((0,u.isDefined)(H)&&(o.networkId=[H.networkInfo.lrsNetworkId]),(0,u.isDefined)(ue)){const e=ue.layers.map(e=>e.layerId);o.eventServiceLayerIds=e}(0,u.isDefined)(t)&&(o.routeInfo=t),o.lockAction=e,De(o)};o.React.useEffect(()=>{if((0,u.isDefined)(ue)&&(0,u.isDefined)(H)){const e=[];ue.layers.forEach(t=>{const o=f.find(e=>e.serviceId===t.layerId);o&&H.networkInfo.lrsNetworkId===o.eventInfo.parentNetworkId&&e.push(o)}),K((0,o.Immutable)(e))}},[ue,H]),o.React.useEffect(()=>{be(A),Re(A)},[A]),o.React.useEffect(()=>{A&&(be(A),Re(A))},[]);const Ge=o.React.useCallback(e=>{const t=I.attributeSet.find(t=>t.title===e);t&&le(t),re(e)},[]),Ve=o.React.useCallback(e=>{ae(e)},[]),Ue=o.React.useCallback(e=>{ie(e)},[]),Be=o.React.useMemo(()=>!!(X&&ee&&(0,u.isDefined)(m)&&(0,u.isDefined)(null==m?void 0:m.view)&&(null==m?void 0:m.view.ready)),[X,ee,m]),We=o.React.useCallback(e=>{e&&ze(),Q(0),ye.current&&(0,o.focusElementInKeyboardMode)(ye.current)},[]),ze=()=>{let e=!1;(0,u.isDefined)(H)&&(0,u.isDefined)(H.networkInfo)&&(0,u.isDefined)(H.networkInfo.lineIdFieldSchema)&&(e=!0),_();const t=(0,u.getInitialRouteInfoState)();Ze(t,!1,!0);const o=(0,u.getInitialEventInfoState)();o.canSpanRoutes=e,Je(o);const a=(0,u.getInitialRouteMeasurePickerInfoState)();Xe(a),A||(be(!1),Re(!1)),G(),de(!0),setTimeout(()=>{de(!1)},800)},Qe=()=>{pe(!1),F()},Ze=(e,t=!1,o=!1)=>{if(me(e),tt(e,t),E){const t=o?u.LockAction.Clear:u.LockAction.Release;_e(t,e)}},[qe,He]=o.React.useState((0,u.getInitialEventInfoState)()),Je=e=>{He(e)},[$e,Ke]=o.React.useState((0,u.getInitialRouteMeasurePickerInfoState)()),Xe=e=>{Ke(e)};o.React.useEffect(()=>{if((0,u.isDefined)(H)){me((0,u.getInitialRouteInfoState)());const e=(0,u.getInitialEventInfoState)();(0,u.isDefined)(H.networkInfo)&&(0,u.isDefined)(H.networkInfo.lineIdFieldSchema)&&(e.canSpanRoutes=!0),Je(e)}},[H,ce]);const Ye=()=>{(0,u.isDefined)(y)&&y.removeAll()},et=()=>{(0,u.isDefined)(M)&&M.removeAll()},tt=(e,t)=>Pa(this,void 0,void 0,function*(){var o;(0,u.isDefined)(e.selectedPolyline)&&t&&(o=yield(0,u.getGeometryGraphic)(yield(0,u.getSimpleLineGraphic)(e.selectedPolyline),Ra),(0,u.isDefined)(o)&&(T.add(o),setTimeout(()=>{T.removeAll(),setTimeout(()=>{T.add(o),setTimeout(()=>{T.removeAll(),setTimeout(()=>{T.add(o),setTimeout(()=>{T.removeAll()},800)},800)},800)},800)},800))),(0,u.isDefined)(e.selectedPoint)?(e=>{(0,u.isDefined)(e)?(y.removeAll(),y.add(e)):Ye()})(yield(0,u.getGeometryGraphic)(yield(0,u.getSimplePointGraphic)(e.selectedPoint),ya)):Ye(),(0,u.isDefined)(e.selectedToPoint)?(e=>{(0,u.isDefined)(e)?(M.removeAll(),M.add(e)):et()})(yield(0,u.getGeometryGraphic)(yield(0,u.getSimplePointGraphic)(e.selectedToPoint),Ma)):et(),(0,u.isDefined)(m)&&m.clearSelectedFeatures()}),ot=o.React.useCallback(()=>function(e,t,o){var a,n;if(!Fo(e))return!1;let i=!0;if(i=i&&(null===(a=e.routeId)||void 0===a?void 0:a.length)>0,i=i&&(null===(n=e.toRouteId)||void 0===n?void 0:n.length)>0,!Fo(o)||!Fo(o.networkInfo))return!1;const s=ha(e.fromMeasure,o.networkInfo.measurePrecision),r=ha(e.toMeasure,o.networkInfo.measurePrecision),u=ha(e.selectedMeasure,o.networkInfo.measurePrecision),l=ha(e.selectedToMeasure,o.networkInfo.measurePrecision);if(isNaN(s)||isNaN(u))return!1;if(i=i&&u>=s,null==t?void 0:t.canSpanRoutes){const t=ha(e.toRouteFromMeasure,o.networkInfo.measurePrecision),a=ha(e.toRouteToMeasure,o.networkInfo.measurePrecision);if(isNaN(t)||isNaN(l))return!1;if(i=i&&l>=t,isNaN(a)||isNaN(l))return!1;i=i&&l<=a}else{if(isNaN(r)||isNaN(l))return!1;i=i&&l<=r}const c=_o(e.fromDate),d=_o(e.toDate),f=_o(e.selectedFromDate),m=_o(e.selectedToDate);return Fo(e.selectedFromDate)&&!Fo(e.selectedToDate)&&(Fo(e.fromDate)&&(i=i&&f>=c),Fo(e.toDate)&&(i=i&&f<d)),!Fo(e.selectedFromDate)&&Fo(e.selectedToDate)&&(Fo(e.fromDate)&&(i=i&&m>=c),Fo(e.toDate)&&(i=i&&m<d)),Fo(e.selectedFromDate)&&Fo(e.selectedToDate)&&(i=i&&f<m,Fo(e.fromDate)&&(i=i&&f>=c),Fo(e.toDate)&&(i=i&&m<=d)),!(!Fo(e.selectedFromDate)&&!Fo(e.selectedToDate))&&i}(fe,qe,H),[fe]),at=o.React.useCallback((e,t)=>{De(e)},[]),nt=o.React.useCallback(e=>{Ne(e)},[]),it=o.React.useCallback(e=>{Se(e)},[]),st=o.React.useCallback(e=>{e&&(we(e),setTimeout(()=>{we(!1)},800))},[]),rt=o.React.useCallback((e,t,o,a)=>Pa(this,void 0,void 0,function*(){if(me(e),we(!1),a){const a=yield wa(e,o,t);xe(a.dateRanges),Se(a.newResponse),a.response.locations.length>0&&a.concurrenciesAdded&&!W?(Ae(!0),Q(1)):(Ae(!1),Q(2))}else Q(2)}),[]),ut=o.React.useCallback(()=>{var e;null===(e=Oe.current)||void 0===e||e.handleNextClicked()},[]),lt=o.React.useCallback((e,t,a)=>{e&&ze(),Q(t&&a&&!W?1:0),ye.current&&(0,o.focusElementInKeyboardMode)(ye.current)},[]);return(0,t.jsxs)("div",{className:"add-multiple-line-event h-100 d-flex",ref:ye,tabIndex:-1,css:o.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .add-multiple-line-event-form {
      height: 100%;
    }
    .add-multiple-line-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-line-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,t.jsx)(Wo,{network:H,dataSourcesReady:Ce,onCreateNetworkDs:Ee}),(0,t.jsx)(Ca,{events:$,dataSourcesReady:Pe}),!x&&(0,t.jsx)(l,{}),(0,t.jsxs)("div",{className:(0,o.classNames)("add-multiple-line-event__content",{"d-none":0!==z,[n.FOCUSABLE_CONTAINER_CLASS]:0===z}),children:[E&&(0,t.jsx)(u.LockManagerComponent,{intl:c,showAlert:!1,featureDS:Z,lockInfo:ve,networkName:null===(i=null==H?void 0:H.networkInfo)||void 0===i?void 0:i.datasetName,conflictPreventionEnabled:E,onQueryAndReleaseComplete:at,onMessageClear:()=>{_e(u.LockAction.None)}}),!w&&(0,t.jsx)(Ta,{operationType:h,onOperationTypeChanged:V}),!k&&(0,t.jsx)(u.InlineEditableDropdown,{label:r("networkLabel"),isDisabled:1===p.length,defaultItem:(0,u.isDefined)(H)?H.name:"",listItems:p,onSelectionChanged:Fe}),!j&&(0,t.jsx)(u.InlineEditableDropdown,{label:r("attributeSetLabel"),isDisabled:1===I.attributeSet.length,defaultItem:se,listItems:(()=>{const e=[];return I.attributeSet.forEach(t=>{e.push(t.title)}),e})(),onSelectionChanged:Ge}),!N&&(0,t.jsx)(u.InlineEditableDropdown,{label:r("fromMethodLabel"),defaultItem:oe,isDisabled:!0,listItems:[u.SearchMethod.Measure],altItemDescriptions:[r("routeAndMeasure")],onSelectionChanged:Ve}),(0,t.jsx)(ga,{intl:c,widgetId:d,network:H?H.networkInfo:null,dsReady:Be,networkDS:Z,method:oe,jimuMapView:m,hoverGraphic:R,pickedGraphic:y,isFrom:!0,routeInfo:fe,routeMeasurePickerInfo:$e,reset:ce,hideMeasures:A,revalidateRouteFromDataAction:he,onResetDataAction:Qe,canSpanRoutes:!!H&&(0,u.isDefined)(H.networkInfo.lineIdFieldSchema),onUpdateRouteInfo:Ze,onUpdateRouteMeasurePickerInfo:Xe,useStartMeasure:ge,useEndMeasure:Ie,onsubmit:rt,ref:Oe,addToDominantRoute:Te}),!A&&(0,t.jsxs)(n.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100 label2",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{checked:ge,className:"mr-2",disabled:!(0,u.isDefined)(fe)||isNaN(fe.fromMeasure),onChange:(e,t)=>{if(t){const e=fe;e.selectedMeasure=e.fromMeasure,e.selectedPoint=null,Ze(e)}be(t)}}),r("useStartMeasureLabel")]}),!N&&(0,t.jsx)(u.InlineEditableDropdown,{label:r("toMethodLabel"),defaultItem:ne,isDisabled:!0,listItems:[u.SearchMethod.Measure],altItemDescriptions:[r("routeAndMeasure")],onSelectionChanged:Ue}),(0,t.jsx)(ga,{intl:c,widgetId:d,network:H?H.networkInfo:null,dsReady:Be,networkDS:Z,method:ne,jimuMapView:m,hoverGraphic:R,pickedGraphic:M,isFrom:!1,routeInfo:fe,routeMeasurePickerInfo:$e,reset:ce,hideMeasures:A,revalidateRouteFromDataAction:he,onResetDataAction:Qe,canSpanRoutes:!!H&&(0,u.isDefined)(H.networkInfo.lineIdFieldSchema),onUpdateRouteInfo:Ze,onUpdateRouteMeasurePickerInfo:Xe,useStartMeasure:ge,useEndMeasure:Ie,onsubmit:rt,ref:Oe,addToDominantRoute:Te}),!A&&(0,t.jsxs)(n.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100 label2",centric:!0,check:!0,children:[(0,t.jsx)(n.Checkbox,{checked:Ie,className:"mr-2",disabled:!(0,u.isDefined)(null==fe?void 0:fe.toRouteToMeasure)||isNaN(fe.toRouteToMeasure),onChange:(e,t)=>{if(t){const e=fe;e.selectedToMeasure=e.toRouteToMeasure,e.selectedToPoint=null,Ze(e)}Re(t)}}),r("useEndMeasureLabel")]}),(0,t.jsx)(Ia,{intl:c,hideDates:L,useRouteStartEndDate:O,routeInfo:fe,network:H?H.networkInfo:null,revalidateRouteFromDataAction:he,onUpdateRouteInfo:Ze}),(0,t.jsx)(Sa,{eventInfo:qe,onUpdateEventInfo:Je,hideAddToDominantRouteOption:U,addToDominantRoute:Te,onUpdateAddToDominantRoute:nt})]}),(0,t.jsxs)("div",{className:(0,o.classNames)("add-line-footer w-100",{"d-none":0!==z,[n.FOCUSABLE_CONTAINER_CLASS]:0===z}),children:[(0,t.jsx)(n.Label,{size:"sm",className:"mt-auto mr-auto title3",centric:!0,style:{color:null===(s=(0,ja.getTheme)())||void 0===s?void 0:s.sys.color.primary.main},onClick:ze,children:r("resetForm")}),(0,t.jsx)("div",{className:"mt-auto ml-auto",children:(0,t.jsx)(n.Button,{type:"primary",className:"active","aria-label":r("nextLabel"),size:"sm",disabled:!ot()&&Be,onClick:ut,children:r("nextLabel")})})]}),(0,t.jsx)("div",{className:(0,o.classNames)("add-multiple-line-event__content",{"d-none":1!==z,[n.FOCUSABLE_CONTAINER_CLASS]:1===z}),children:(0,t.jsx)(Na,{intl:c,networkDS:Z,network:H,routeInfo:fe,reset:ce||ke,conflictPreventionEnabled:!1,onNavBack:We,onNavNext:()=>{we(!1),Q(2)},concurrenciesResponse:Me,onConcurrenciesResponseUpdated:it,onResetClicked:st,dateRanges:Le,pickedConcurrencyGraphic:S})}),(0,t.jsx)("div",{className:(0,o.classNames)("add-multiple-line-event__content",{"d-none":2!==z,[n.FOCUSABLE_CONTAINER_CLASS]:2===z}),children:(0,t.jsx)(Ea,{intl:c,widgetId:d,networkDS:Z,network:H?H.networkInfo:null,eventLayers:$,attributeSet:ue,routeInfo:fe,eventInfo:qe,reset:ce,isReady:Be,jimuMapView:m,hoverGraphic:R,conflictPreventionEnabled:E,onNavBack:lt,hasConcurrencies:je,addToDominantRoute:Te,concurrenciesResponse:Me})})]})}var _a=m(59620),Ga=function(e,t,o,a){return new(o||(o=Promise))(function(n,i){function s(e){try{u(a.next(e))}catch(e){i(e)}}function r(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}u((a=a.apply(e,t||[])).next())})};function Va(){return(0,o.Immutable)({networkLayers:[],eventLayers:[],intersectionLayers:[],attributeSets:{attributeSet:[]},defaultAttributeSet:"",defaultEvent:{index:-1,name:""},defaultNetwork:{index:-1,name:""},hideMethod:!1,hideEvent:!1,hideNetwork:!1,hideType:!1,hideAttributeSet:!1,hideMeasures:!1,hideDates:!1,useRouteStartEndDate:!1,hideAddToDominantRouteOption:!1,enableAddToDominantRouteOption:!1,notAllowOverrideEventReplacement:!1})}var Ua=m(4108),Ba=function(e,t,o,a){return new(o||(o=Promise))(function(n,i){function s(e){try{u(a.next(e))}catch(e){i(e)}}function r(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,r)}u((a=a.apply(e,t||[])).next())})};class Wa extends o.React.PureComponent{constructor(t){super(t),this.supportedLrsLayerTypes=(0,o.Immutable)([u.LrsLayerType.Network,u.LrsLayerType.Event,u.LrsLayerType.LineEvent,u.LrsLayerType.Intersection]),this.componentDidMount=()=>{var t,o;(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.selectedDataSource)?this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource}):(null===(o=this.props.mutableStatePropsVersion)||void 0===o?void 0:o.selectedRouteInfo)&&this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo});const a=(0,u.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:a}),this.setState({operationType:this.props.config.defaultType||e.single}),this.setSettingsPerView()},this.setSettingsPerView=()=>Ba(this,void 0,void 0,function*(){var t,a;const{config:n}=this.props,i=n.mode&&n.mode!==u.ModeType.Map?n.lrsLayers:this.state.activeLrsLayers,s=!(0,u.isDefined)(null===(t=n.settingsPerView)||void 0===t?void 0:t[this.state.activeMapViewId]);let r=(null===(a=n.settingsPerView)||void 0===a?void 0:a[this.state.activeMapViewId])||Va();if(i&&i.length>0){r=yield function(t,a,n){return Ga(this,arguments,void 0,function*(t,a,n,i=!1){if(n){const e=a.filter(e=>e.layerType===u.LrsLayerType.Network).map(e=>e.name),o=a.filter(e=>(0,u.isLineEvent)(e)).map(e=>e.name),n=a.filter(e=>e.layerType===u.LrsLayerType.Intersection).map(e=>e.name);t=t.set("networkLayers",e).set("eventLayers",o).set("intersectionLayers",n)}if(i){const e=a.find(e=>e.layerType===u.LrsLayerType.Network);if((0,u.isDefined)(e)){const a=(0,o.getAppStore)().getState().portalUrl,n=yield(0,u.getAttributeSets)(e.lrsUrl,a,!0);t=t.setIn(["attributeSets"],n)}}const s=(0,u.getDefaultEvent)(a,t.defaultEvent,!1),r=(0,u.getDefaultNetwork)(a,t.defaultNetwork),l=(0,u.getDefaultAttributeSet)(null==t?void 0:t.attributeSets,t.defaultAttributeSet,!1);return t.set("defaultNetwork",r||(0,o.Immutable)({index:-1,name:""})).set("defaultEvent",s||(0,o.Immutable)({index:-1,name:""})).set("defaultAttributeSet",l||"").set("defaultFromMethod",t.defaultFromMethod||u.SearchMethod.Measure).set("defaultToMethod",t.defaultToMethod||u.SearchMethod.Measure).set("defaultType",t.defaultType||e.single).set("hideMethod",t.hideMethod||!1).set("hideEvent",t.hideEvent||!1).set("hideNetwork",t.hideNetwork||!1).set("hideType",t.hideType||!1).set("hideAttributeSet",t.hideAttributeSet||!1).set("hideMeasures",t.hideMeasures||!1).set("hideDates",t.hideDates||!1).set("useRouteStartEndDate",t.useRouteStartEndDate||!1).set("attributeSets",t.attributeSets||(0,o.Immutable)({attributeSet:[]}))})}(r,i,!0,s),this.setState({settingPerView:r});const t=n.setIn(["settingsPerView",this.state.activeMapViewId],r);(0,Ua.getAppConfigAction)().editWidgetConfig(this.props.id,t).exec()}}),this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally(()=>{this.setState({jimuMapView:e})})},this.waitForChildDataSourcesReady=e=>Ba(this,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const t=o.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==t?void 0:t.isDataSourceSet())&&!t.areChildDataSourcesCreated()?t.childDataSourcesReady().then(()=>t).catch(e=>t):Promise.resolve(t)}),this.handleOperationTypeChange=e=>{this.setState({operationType:e}),this.clearGraphics()},this.getI18nMessage=(e,t)=>{const o=Object.assign({},a,n.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},t)},this.handleLrsLayersChanged=e=>{this.setState({activeLrsLayers:e})},this.handleViewChange=t=>{t&&this.setState({activeMapViewId:t.id});const o=(0,u.getConfigValue)(this.props.config,"defaultType",this.state.activeMapViewId,e.single);this.setState({operationType:o})},this.state={hideTitle:!1,jimuMapView:void 0,operationType:e.single,hoverGraphic:null,pickedFromGraphic:null,pickedToGraphic:null,pickedConcurrencyGraphic:null,flashGraphic:null,routeInfoFromDataAction:null,networkDataSourceFromDataAction:null,activeMapViewId:"",activeLrsLayers:this.props.config.lrsLayers,settingPerView:Va(),isConflictPreventionEnabled:!1},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(t,a){var n,i,s,r,l,c,d,f,m,h;a.jimuMapView!==this.state.jimuMapView&&(0,u.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers());const p=null===(s=null===(i=null===(n=(0,o.getAppStore)())||void 0===n?void 0:n.getState())||void 0===i?void 0:i.widgetsRuntimeInfo[this.props.id])||void 0===s?void 0:s.state;if((p===o.WidgetState.Opened||!p)&&((null===(r=this.props)||void 0===r?void 0:r.selectedNetworkDataSource)&&(t&&t.mutableStatePropsVersion&&t.mutableStatePropsVersion.selectedNetworkDataSource&&(null===(l=null==t?void 0:t.mutableStatePropsVersion)||void 0===l?void 0:l.selectedNetworkDataSource)===(null===(c=this.props.mutableStatePropsVersion)||void 0===c?void 0:c.selectedNetworkDataSource)||this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource})),null===(d=this.props)||void 0===d?void 0:d.selectedRouteInfo)){!(null===(f=this.props)||void 0===f?void 0:f.selectedRouteInfo)||t&&t.mutableStatePropsVersion&&t.mutableStatePropsVersion.selectedRouteInfo&&(null===(m=null==t?void 0:t.mutableStatePropsVersion)||void 0===m?void 0:m.selectedRouteInfo)===(null===(h=this.props.mutableStatePropsVersion)||void 0===h?void 0:h.selectedRouteInfo)||this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo})}if(this.state.activeLrsLayers!==a.activeLrsLayers){const t=(0,u.getConfigValue)(this.props.config,"defaultType",this.state.activeMapViewId,e.single);this.setState({operationType:t})}this.state.activeLrsLayers!==a.activeLrsLayers&&this.setSettingsPerView();const{config:v}=this.props,D=v.mode&&v.mode!==u.ModeType.Map?v.lrsLayers:this.state.activeLrsLayers;D.length>0&&(0,u.checkConflictPrevention)(D[0].lrsUrl).then(e=>{const t=null!==e&&e;this.state.isConflictPreventionEnabled!==t&&this.setState({isConflictPreventionEnabled:t})})}removeGraphicLayers(){(0,u.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,u.isDefined)(this.state.pickedFromGraphic)&&(this.state.pickedFromGraphic.removeAll(),this.state.pickedFromGraphic.destroy(),this.setState({pickedFromGraphic:null})),(0,u.isDefined)(this.state.pickedToGraphic)&&(this.state.pickedToGraphic.removeAll(),this.state.pickedToGraphic.destroy(),this.setState({pickedToGraphic:null})),(0,u.isDefined)(this.state.pickedConcurrencyGraphic)&&(this.state.pickedConcurrencyGraphic.removeAll(),this.state.pickedConcurrencyGraphic.destroy(),this.setState({pickedConcurrencyGraphic:null})),(0,u.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,u.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const o=new _a.default({listMode:"hide"}),a=new _a.default({listMode:"hide"}),n=new _a.default({listMode:"hide"}),i=new _a.default({listMode:"hide"}),s=new _a.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([a,n,i,s,o]),this.setState({hoverGraphic:o}),this.setState({pickedFromGraphic:a}),this.setState({pickedToGraphic:n}),this.setState({pickedConcurrencyGraphic:i}),this.setState({flashGraphic:s})}}resetDataAction(){this.setState({routeInfoFromDataAction:null}),this.setState({networkDataSourceFromDataAction:null})}clearGraphics(){this&&this.state&&((0,u.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,u.isDefined)(this.state.pickedFromGraphic)&&this.state.pickedFromGraphic.removeAll(),(0,u.isDefined)(this.state.pickedToGraphic)&&this.state.pickedToGraphic.removeAll(),(0,u.isDefined)(this.state.pickedConcurrencyGraphic)&&this.state.pickedConcurrencyGraphic.removeAll(),(0,u.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll())}clearHoverGraphic(){this&&this.state&&(0,u.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll()}getConfigValues(e,t,o){const a={networkLayers:t.networkLayers,eventLayers:t.eventLayers,intersectionLayers:t.intersectionLayers,defaultEvent:t.defaultEvent,defaultNetwork:t.defaultNetwork,defaultFromMethod:t.defaultFromMethod,defaultToMethod:t.defaultToMethod,defaultAttributeSet:t.defaultAttributeSet,attributeSets:t.attributeSets,hideEvent:t.hideEvent,hideNetwork:t.hideNetwork,hideType:t.hideType,hideMethod:t.hideMethod,hideAttributeSet:t.hideAttributeSet,hideMeasures:t.hideMeasures,hideDates:t.hideDates,useRouteStartEndDate:t.useRouteStartEndDate,hideAddToDominantRouteOption:t.hideAddToDominantRouteOption,enableAddToDominantRouteOption:t.enableAddToDominantRouteOption,notAllowOverrideEventReplacement:t.notAllowOverrideEventReplacement};return Object.entries(a).reduce((t,[a,n])=>(t[a]=(0,u.getConfigValue)(e,a,o,n),t),{})}render(){var a,i;const{config:l,id:c,intl:d}=this.props;let{useMapWidgetIds:f}=this.props;const{mapViewsConfig:m}=l,h=l.mode&&l.mode!==u.ModeType.Map?l.lrsLayers:this.state.activeLrsLayers,p=this.getConfigValues(l,this.state.settingPerView,this.state.activeMapViewId),{networkLayers:v,eventLayers:D,intersectionLayers:g,defaultEvent:b,defaultNetwork:I,defaultFromMethod:R,defaultToMethod:y,defaultAttributeSet:M,attributeSets:S,hideEvent:T,hideNetwork:N,hideType:k,hideMethod:w,hideAttributeSet:j,hideMeasures:A,hideDates:L,useRouteStartEndDate:x,hideAddToDominantRouteOption:O,enableAddToDominantRouteOption:E,notAllowOverrideEventReplacement:C}=p,P=(0,u.getModeType)(l.mode,h),{jimuMapView:F,operationType:_}=this.state,G=v&&v.length>0&&D&&D.length>0;if(!f){const e=null===(i=null===(a=(0,o.getAppStore)())||void 0===a?void 0:a.getState())||void 0===i?void 0:i.appConfig;f=(0,u.findFirstArcgisMapWidgetId)(e)}return(0,t.jsx)(n.Paper,{variant:"flat",shape:"none",className:"jimu-widget runtime-add-line-event surface-1 border-0",children:(0,t.jsxs)("div",{id:this.widgetOuterDivId,className:"widget-outer-div h-100 w-100 d-flex",children:[(0,t.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null==f?void 0:f[0],onActiveViewChange:this.onActiveViewChange}),P&&(0,t.jsx)(u.MapViewLoader,{config:l,widgetId:c,supportedLrsLayerTypes:this.supportedLrsLayerTypes,useMapWidgetIds:f,mapViewsConfig:m,jimuMapView:F,outputDataSourceType:"none",onLrsLayersChanged:this.handleLrsLayersChanged,onViewChange:this.handleViewChange}),_===e.single&&G&&(0,t.jsx)(La,{intl:d,widgetId:c,lrsLayers:h,JimuMapView:F,operationType:_,onOperationTypeChanged:this.handleOperationTypeChange,lineEventLayers:(0,o.Immutable)(D),networkLayers:v,intersectionLayers:g,defaultEvent:b,defaultFromMethod:R,defaultToMethod:y,hoverGraphic:this.state.hoverGraphic,pickedFromGraphic:this.state.pickedFromGraphic,pickedToGraphic:this.state.pickedToGraphic,pickedConcurrencyGraphic:this.state.pickedConcurrencyGraphic,flashGraphic:this.state.flashGraphic,hideEvent:T,hideNetwork:N,hideType:k,hideMethod:w,hideMeasures:A,hideDates:L,hideTitle:this.state.hideTitle,useRouteStartEndDate:x,conflictPreventionEnabled:this.state.isConflictPreventionEnabled,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphics:this.clearGraphics.bind(this),onClearHoverGraphic:this.clearHoverGraphic.bind(this),hideAddToDominantRouteOption:O,enableAddToDominantRouteOption:E,notAllowOverrideEventReplacement:C}),_===e.multiple&&G&&(0,t.jsx)(Fa,{intl:d,widgetId:c,lrsLayers:h,jimuMapView:F,operationType:_,onOperationTypeChanged:this.handleOperationTypeChange,lineEventLayers:D,networkLayers:v,instersectionLayers:g,defaultEvent:b,defaultNetwork:I,defaultFromMethod:R,defaultToMethod:y,defaultAttributeSet:M,attributeSets:S,hoverGraphic:this.state.hoverGraphic,pickedFromGraphic:this.state.pickedFromGraphic,pickedToGraphic:this.state.pickedToGraphic,pickedConcurrencyGraphic:this.state.pickedConcurrencyGraphic,flashGraphic:this.state.flashGraphic,hideNetwork:N,hideMethod:w,hideType:k,hideAttributeSet:j,hideMeasures:A,hideDates:L,hideTitle:this.state.hideTitle,useRouteStartEndDate:x,conflictPreventionEnabled:this.state.isConflictPreventionEnabled,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphics:this.clearGraphics.bind(this),onClearHoverGraphic:this.clearHoverGraphic.bind(this),hideAddToDominantRouteOption:O,enableAddToDominantRouteOption:E,notAllowOverrideEventReplacement:C}),!G&&(0,t.jsx)(n.WidgetPlaceholder,{icon:s(),widgetId:c,message:this.getI18nMessage("_widgetLabel")})]})})}}Wa.mapExtraStateProps=(e,t)=>{var o,a;return{selectedRouteInfo:null===(o=null==t?void 0:t.mutableStateProps)||void 0===o?void 0:o.selectedRouteInfo,selectedNetworkDataSource:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedNetworkDataSource}};const za=Wa;function Qa(e){m.p=e}})(),h})())}}});