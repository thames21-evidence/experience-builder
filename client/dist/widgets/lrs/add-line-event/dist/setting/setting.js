System.register(["jimu-core/emotion","jimu-core","jimu-ui","widgets/shared-code/lrs","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree"],function(e,t){var a={},n={},i={},s={},l={},o={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){n.Immutable=e.Immutable,n.React=e.React,n.ReactRedux=e.ReactRedux,n.css=e.css,n.defaultMessages=e.defaultMessages,n.getAppStore=e.getAppStore,n.hooks=e.hooks},function(e){i.Checkbox=e.Checkbox,i.CollapsablePanel=e.CollapsablePanel,i.Option=e.Option,i.Select=e.Select,i.Switch=e.Switch,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip,i.defaultMessages=e.defaultMessages,i.hooks=e.hooks},function(e){s.EmptyPlaceholder=e.EmptyPlaceholder,s.LrsLayerType=e.LrsLayerType,s.LrsLoader=e.LrsLoader,s.ModeType=e.ModeType,s.SearchMethod=e.SearchMethod,s.advancedActionMap=e.advancedActionMap,s.formatMessage=e.formatMessage,s.getAttributeSets=e.getAttributeSets,s.getConfigValue=e.getConfigValue,s.getDefaultAttributeSet=e.getDefaultAttributeSet,s.getDefaultEvent=e.getDefaultEvent,s.getDefaultNetwork=e.getDefaultNetwork,s.getLayersByType=e.getLayersByType,s.isDefined=e.isDefined,s.isLineEvent=e.isLineEvent,s.lrsDefaultMessages=e.lrsDefaultMessages,s.updateConfig=e.updateConfig,s.updateDefaultForMapMode=e.updateDefaultForMapMode,s.waitTime=e.waitTime},function(e){l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection},function(e){o.List=e.List}],execute:function(){e((()=>{var e={8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=i},47626:e=>{"use strict";e.exports=s},51334:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 3.5a3.5 3.5 0 1 0-7 0V6H3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-2V3.5l.005-.164A2.5 2.5 0 0 1 12.5 1l.164.005A2.5 2.5 0 0 1 15 3.5a.5.5 0 0 0 1 0M9 7H3v8h9V7H9m-1.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=a},79244:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=l},98640:e=>{"use strict";e.exports=o}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var d={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(d),r.d(d,{__set_webpack_public_path__:()=>M,default:()=>y});var e=r(67386),t=r(79244),a=r(14321),n=r(47626);const i={blankStatus:"Select a map to import LRS networks",defaultSettings:"Default Settings",defaultEvent:"Event",defaultFromMethod:"From Method",defaultToMethod:"To Method",defaultType:"Type",methodMeasure:"Route and Measure",methodCoordinate:"Coordinate",methodLocationOffset:"Location Offset",operationTypeSingle:"Single Line",operationTypeMultiple:"Multiple Line",loadLayers:"Load Layers",clearLayers:"Clear Layers",useFieldAlias:"Use field alias",configureFields:"Configure Fields",layerConfig:"Layer Configuration",selectMap:"Select Map",noNetworkLayersTips:"No LRS Network layers are present in the selected map. Select a map with LRS network layer/s present in the webmap.",noLineEventLayersTips:"No Line Event layer is present in the selected map. Select a map with Line Event layer/s present in the webmap.",missingParentNetwork:"Parent network is missing",attributeEditable:"Editable",attributeNotEditable:"Not editable",defaultAttributeSet:"Attribute Set",defaultEventSingle:"Event (Single Line)",defaultNetworkMultiple:"Network (Multiple Line)",hideMeasureTooltip:"Routes start/end measures will be used for new events."};var s=r(79298);var l=r(98640);const o=r(8547),u=r(51334);function c(r){var d;const{widgetId:c,index:g,config:f,activeMapViewId:p,onSettingChange:h}=r,m=(v="lrsLayers",S=[],t.React.useMemo(()=>(0,n.getConfigValue)(f,v,p)||S,[f,p]));var v,S;const b=m[g],w=t.hooks.useTranslation(i,n.lrsDefaultMessages,t.defaultMessages),[y,M]=t.React.useState(null==b?void 0:b.name),x=function(e){const{widgetId:a,useDataSourceId:n}=e;return t.ReactRedux.useSelector(e=>{var t;let i;return i=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(t=i.widgets[a].useDataSources)&&void 0!==t?t:[]).some(e=>e.dataSourceId===n)})}({widgetId:c,useDataSourceId:null===(d=null==b?void 0:b.useDataSource)||void 0===d?void 0:d.dataSourceId});t.React.useEffect(()=>{(null==b?void 0:b.name)&&y!==(null==b?void 0:b.name)&&M(null==b?void 0:b.name)},[null==b?void 0:b.name]);const L=t.React.useCallback((e,a,i=!1)=>{var s;let l=null!=m?m:(0,t.Immutable)([]);if(l=t.Immutable.set(l,e,a),f.mode===n.ModeType.Map){const e=p,t=(null===(s=f.mapViewsConfig)||void 0===s?void 0:s[e]).set("lrsLayers",l),a=f.setIn(["mapViewsConfig",e],t);h({id:c,config:a})}else h({id:c,config:f.set("lrsLayers",l)})},[m,f,p,h,c]),C=t.React.useCallback((e,t,a=!1)=>{let n;n=null==t?b.without(e):b.set(e,t),L(g,n,a)},[L,g,b]),j=t.React.useCallback((e,t,a=!1)=>{const n=b.eventInfo.set(e,t),i=b.set("eventInfo",n);L(g,i,a)},[L,g,b]),T=t.React.useCallback(e=>{M(e.target.value)},[]),R=t.React.useCallback(e=>{e.trim().length>0?C("name",e,!0):M(null==b?void 0:b.name)},[null==b?void 0:b.name,C]),k=e=>b.eventInfo.attributeFields[e].enabled,I=e=>{const t=b.eventInfo.attributeFields.asMutable({deep:!0});t[e].enabled=!t[e].enabled,j("attributeFields",t,!0)};return(0,e.jsx)("div",{className:"h-100",children:(0,e.jsx)("div",{css:t.css`height: 100%; overflow:auto;`,children:b&&(x||f.mode===n.ModeType.Map)&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsxs)(s.SettingSection,{role:"group","aria-label":w("label"),title:w("label"),children:[(0,e.jsx)(s.SettingRow,{children:(0,e.jsx)(a.TextInput,{size:"sm",type:"text",className:"w-100",value:y,onChange:T,onAcceptValue:R,"aria-label":w("label")})}),(0,n.isLineEvent)(b)&&(0,e.jsx)(s.SettingRow,{tag:"label",flow:"no-wrap",label:w("useFieldAlias"),children:(0,e.jsx)(a.Switch,{checked:b.useFieldAlias,onChange:(e,t)=>{C("useFieldAlias",t,!1)}})})]}),(0,n.isLineEvent)(b)&&(0,e.jsx)(s.SettingSection,{role:"group",children:(0,e.jsx)(s.SettingRow,{flow:"wrap",label:w("configureFields"),children:(0,e.jsx)(l.List,Object.assign({className:"list-routeid-fields pt-2 w-100",itemsJson:Array.from(b.eventInfo.attributeFields).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:k(t),itemStateTitle:b.useFieldAlias?e.field.alias:e.field.name,itemStateCommands:[{label:e.editable?w("attributeEditable"):w("attributeNotEditable"),iconProps:()=>({icon:e.editable?u:o,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e;(e=>{const t=b.eventInfo.attributeFields.asMutable({deep:!0});t[e].editable=!t[e].editable,j("attributeFields",t,!0)})(+t.itemKey)}}]})),renderOverrideItemDetailToggle:(t,n)=>{const{itemJsons:i,itemJsons:[{itemStateDetailVisible:s,itemStateDetailContent:l}]}=n.props,[o]=i,r=+o.itemKey;return l?(0,e.jsx)(a.Checkbox,{"aria-expanded":!!s,className:"jimu-tree-item__detail-toggle mr-2",checked:b.eventInfo.attributeFields[r].enabled,onClick:e=>{I(r)}}):null},dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,n]=a;var i;i=n.map(e=>e.itemStateDetailContent),j("attributeFields",i,!0)},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;I(+a.itemKey)}},n.advancedActionMap))})})]})})})}var g;function f(l){var o;const{widgetId:r,config:d,activeMapViewId:u,onSettingChange:c}=l,f=t.hooks.useTranslation(i),p=(e,a)=>t.React.useMemo(()=>(0,n.getConfigValue)(d,e,u)||a,[d,u]),h=p("lrsLayers",[]),m=p("networkLayers",[]),v=p("eventLayers",[]),S=p("attributeSets",{attributeSet:[]}),b=p("defaultEvent",""),w=p("defaultNetwork",""),y=p("defaultFromMethod",n.SearchMethod.Measure),M=p("defaultToMethod",n.SearchMethod.Measure),x=p("defaultType",g.single),L=p("defaultAttributeSet",(null===(o=S.attributeSet[0])||void 0===o?void 0:o.title)||"");return(0,e.jsx)(t.React.Fragment,{children:(0,e.jsx)(s.SettingSection,{className:"px-4",children:(0,e.jsxs)(a.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:f("defaultSettings"),defaultIsOpen:!0,disabled:!1,"aria-label":f("defaultSettings"),children:[(0,e.jsx)(s.SettingRow,{flow:"wrap",label:f("defaultEventSingle"),children:(0,e.jsx)(a.Select,{"aria-label":f("defaultEventSingle"),className:"w-100",size:"sm",value:(()=>{var e;if(!(b&&b.index>=0)){return h.find(e=>(0,n.isLineEvent)(e)).name}{const t=b.index,a=b.name;if(a===(null===(e=h[t])||void 0===e?void 0:e.name))return a}})(),onChange:e=>{(e=>{let t=-1;e.length>0&&h.length>0&&(t=h.findIndex(t=>t.name===e));const a={index:t,name:t>=0?h[t].name:""};(0,n.updateConfig)(r,d,"defaultEvent",a,u,c)})(e.target.value)},children:v.map((t,a)=>(0,e.jsx)("option",{value:t,children:t},a))})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",label:f("defaultNetworkMultiple"),children:(0,e.jsx)(a.Select,{"aria-label":f("defaultNetworkMultiple"),className:"w-100",size:"sm",value:(()=>{var e;if(!w||-1===w.index){return h.find(e=>e.layerType===n.LrsLayerType.Network).name}{const t=w.index,a=w.name;if(a===(null===(e=h[t])||void 0===e?void 0:e.name))return a}})(),onChange:e=>{(e=>{var t;let a=-1;e.length>0&&h.length>0&&(a=h.findIndex(t=>t.name===e));const i={index:a,name:null===(t=h[a])||void 0===t?void 0:t.name};(0,n.updateConfig)(r,d,"defaultNetwork",i,u,c)})(e.target.value)},children:m.map((t,a)=>(0,e.jsx)("option",{value:t,children:t},a))})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",label:f("defaultFromMethod"),children:(0,e.jsx)(a.Select,{"aria-label":f("defaultFromMethod"),className:"w-100",size:"sm",value:y,onChange:e=>{var t;t=e.target.value,(0,n.updateConfig)(r,d,"defaultNetwork",t,u,c)},children:(0,e.jsx)("option",{value:n.SearchMethod.Measure,children:f("methodMeasure")})})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",label:f("defaultToMethod"),children:(0,e.jsx)(a.Select,{"aria-label":f("defaultToMethod"),className:"w-100",size:"sm",value:M,onChange:e=>{var t;t=e.target.value,(0,n.updateConfig)(r,d,"defaultNetwork",t,u,c)},children:(0,e.jsx)("option",{value:n.SearchMethod.Measure,children:f("methodMeasure")})})}),(0,e.jsx)(s.SettingRow,{flow:"wrap",label:f("defaultType"),children:(0,e.jsxs)(a.Select,{"aria-label":f("defaultType"),className:"w-100",size:"sm",value:x,onChange:e=>{var t;t=e.target.value,(0,n.updateConfig)(r,d,"defaultType",t,u,c)},children:[(0,e.jsx)("option",{value:g.single,children:f("operationTypeSingle")}),(0,e.jsx)("option",{value:g.multiple,children:f("operationTypeMultiple")})]})}),(0,n.isDefined)(S)&&(0,n.isDefined)(S.attributeSet)&&(0,e.jsx)(s.SettingRow,{flow:"wrap",label:f("defaultAttributeSet"),children:(0,e.jsx)(a.Select,{"aria-label":f("defaultAttributeSet"),className:"w-100",size:"sm",value:L,onChange:e=>{var t;t=e.target.value,(0,n.updateConfig)(r,d,"defaultAttributeSet",t,u,c)},children:S.attributeSet.map((t,n)=>(0,e.jsx)(a.Option,{value:t.title,children:t.title},n))})})]})})})}!function(e){e.single="SINGLE",e.multiple="MULTIPLE"}(g||(g={}));var p=function(e,t,a,n){return new(a||(a=Promise))(function(i,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function o(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,o)}r((n=n.apply(e,t||[])).next())})};function h(){return(0,t.Immutable)({networkLayers:[],eventLayers:[],intersectionLayers:[],attributeSets:{attributeSet:[]},defaultAttributeSet:"",defaultEvent:{index:-1,name:""},defaultNetwork:{index:-1,name:""},hideMethod:!1,hideEvent:!1,hideNetwork:!1,hideType:!1,hideAttributeSet:!1,hideMeasures:!1,hideDates:!1,useRouteStartEndDate:!1,hideAddToDominantRouteOption:!1,enableAddToDominantRouteOption:!1,notAllowOverrideEventReplacement:!1})}function m(e,a,i){return p(this,arguments,void 0,function*(e,a,i,s=!1){if(i){const t=a.filter(e=>e.layerType===n.LrsLayerType.Network).map(e=>e.name),i=a.filter(e=>(0,n.isLineEvent)(e)).map(e=>e.name),s=a.filter(e=>e.layerType===n.LrsLayerType.Intersection).map(e=>e.name);e=e.set("networkLayers",t).set("eventLayers",i).set("intersectionLayers",s)}if(s){const i=a.find(e=>e.layerType===n.LrsLayerType.Network);if((0,n.isDefined)(i)){const a=(0,t.getAppStore)().getState().portalUrl,s=yield(0,n.getAttributeSets)(i.lrsUrl,a,!0);e=e.setIn(["attributeSets"],s)}}const l=(0,n.getDefaultEvent)(a,e.defaultEvent,!1),o=(0,n.getDefaultNetwork)(a,e.defaultNetwork),r=(0,n.getDefaultAttributeSet)(null==e?void 0:e.attributeSets,e.defaultAttributeSet,!1);return e.set("defaultNetwork",o||(0,t.Immutable)({index:-1,name:""})).set("defaultEvent",l||(0,t.Immutable)({index:-1,name:""})).set("defaultAttributeSet",r||"").set("defaultFromMethod",e.defaultFromMethod||n.SearchMethod.Measure).set("defaultToMethod",e.defaultToMethod||n.SearchMethod.Measure).set("defaultType",e.defaultType||g.single).set("hideMethod",e.hideMethod||!1).set("hideEvent",e.hideEvent||!1).set("hideNetwork",e.hideNetwork||!1).set("hideType",e.hideType||!1).set("hideAttributeSet",e.hideAttributeSet||!1).set("hideMeasures",e.hideMeasures||!1).set("hideDates",e.hideDates||!1).set("useRouteStartEndDate",e.useRouteStartEndDate||!1).set("attributeSets",e.attributeSets||(0,t.Immutable)({attributeSet:[]}))})}function v(e,a){return e.set("mode",a).set("lrsLayers",[]).set("mapViewsConfig",{}).set("settingsPerView",{}).set("networkLayers",[]).set("eventLayers",[]).set("intersectionLayers",[]).set("attributeSets",(0,t.Immutable)({attributeSet:[]})).set("defaultAttributeSet","").set("defaultEvent",(0,t.Immutable)({index:-1,name:""})).set("defaultNetwork",(0,t.Immutable)({index:-1,name:""})).set("defaultFromMethod",n.SearchMethod.Measure).set("defaultToMethod",n.SearchMethod.Measure).set("defaultType",g.single).set("hideMethod",!1).set("hideEvent",!1).set("hideNetwork",!1).set("hideType",!1).set("hideAttributeSet",!1).set("hideMeasures",!1).set("hideDates",!1).set("useRouteStartEndDate",!1).set("hideAddToDominantRouteOption",!1).set("enableAddToDominantRouteOption",!1).set("notAllowOverrideEventReplacement",!1)}function S(l){const{intl:o,widgetId:r,config:d,activeMapViewId:u,onSettingChange:c}=l,g=t.hooks.useTranslation(i,n.lrsDefaultMessages),f=(e,a)=>t.React.useMemo(()=>(0,n.getConfigValue)(d,e,u)||a,[d,u]),p=f("hideMethod",!1),h=f("hideEvent",!1),m=f("hideNetwork",!1),v=f("hideType",!1),S=f("hideAttributeSet",!1),b=f("hideMeasures",!1),w=f("hideDates",!1),y=f("useRouteStartEndDate",!1);return(0,e.jsx)(t.React.Fragment,{children:(0,e.jsx)(s.SettingSection,{className:"px-4 ",children:(0,e.jsxs)(a.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:(0,n.formatMessage)(o,"displaySettings"),defaultIsOpen:!0,disabled:!1,"aria-label":(0,n.formatMessage)(o,"displaySettings"),children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(o,"hideType"),children:(0,e.jsx)(a.Switch,{checked:v,onChange:(e,t)=>{(0,n.updateConfig)(r,d,"hideType",t,u,c)}})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(o,"hideEvent"),children:(0,e.jsx)(a.Switch,{checked:h,onChange:(e,t)=>{(0,n.updateConfig)(r,d,"hideEvent",t,u,c)}})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(o,"hideNetwork"),children:(0,e.jsx)(a.Switch,{checked:m,onChange:(e,t)=>{(0,n.updateConfig)(r,d,"hideNetwork",t,u,c)}})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(o,"hideMethod"),children:(0,e.jsx)(a.Switch,{checked:p,onChange:(e,t)=>{(0,n.updateConfig)(r,d,"hideMethod",t,u,c)}})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(o,"hideAttributeSet"),children:(0,e.jsx)(a.Switch,{checked:S,onChange:(e,t)=>{(0,n.updateConfig)(r,d,"hideAttributeSet",t,u,c)}})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(o,"hideMeasures"),children:(0,e.jsx)(a.Tooltip,{title:g("hideMeasureTooltip"),children:(0,e.jsx)(a.Switch,{checked:b,onChange:(e,t)=>{(0,n.updateConfig)(r,d,"hideMeasures",t,u,c)}})})}),(0,e.jsxs)("div",{style:{display:"none"},children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(o,"hideDates"),children:(0,e.jsx)(a.Switch,{checked:w,onChange:(e,t)=>{t||y&&(0,n.updateConfig)(r,d,"useRouteStartEndDate",t,u,c),(0,n.waitTime)(200).then(()=>{(0,n.updateConfig)(r,d,"hideDates",t,u,c)})}})}),w&&(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(o,"useRoutesStartEndDates"),children:(0,e.jsx)(a.Tooltip,{title:(0,n.formatMessage)(o,"useRoutesStartEndDatesTooltip"),children:(0,e.jsx)(a.Switch,{checked:y,onChange:(e,t)=>{(0,n.updateConfig)(r,d,"useRouteStartEndDate",t,u,c)}})})})]})]})})})}function b(i){const{intl:l,widgetId:o,config:r,activeMapViewId:d,onSettingChange:u}=i,c=(e,a)=>t.React.useMemo(()=>(0,n.getConfigValue)(r,e,d)||a,[r,d]),g=c("hideAddToDominantRouteOption",!1),f=c("enableAddToDominantRouteOption",!1),p=c("notAllowOverrideEventReplacement",!1);return(0,e.jsx)(t.React.Fragment,{children:(0,e.jsx)(s.SettingSection,{className:"px-4 ",children:(0,e.jsxs)(a.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:(0,n.formatMessage)(l,"concurrencySettings"),defaultIsOpen:!0,disabled:!1,"aria-label":(0,n.formatMessage)(l,"concurrencySettings"),children:[(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(l,"hideAddToDominantRouteOption"),children:(0,e.jsx)(a.Switch,{checked:g,onChange:(e,t)=>{(0,n.updateConfig)(o,r,"hideAddToDominantRouteOption",t,d,u)}})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(l,"enableAddToDominantRouteOption"),children:(0,e.jsx)(a.Switch,{checked:f,onChange:(e,t)=>{(0,n.updateConfig)(o,r,"enableAddToDominantRouteOption",t,d,u)}})}),(0,e.jsx)(s.SettingRow,{tag:"label",label:(0,n.formatMessage)(l,"notAllowOverrideEventReplacement"),children:(0,e.jsx)(a.Switch,{checked:p,onChange:(e,t)=>{(0,n.updateConfig)(o,r,"notAllowOverrideEventReplacement",t,d,u)}})})]})})})}var w=function(e,t,a,n){return new(a||(a=Promise))(function(i,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function o(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,o)}r((n=n.apply(e,t||[])).next())})};const y=l=>{const{id:o,intl:r,widgetId:d,config:u,useMapWidgetIds:g,portalUrl:p,theme:y,onSettingChange:M}=l,[x,L]=t.React.useState(-1),[C,j]=t.React.useState(""),[T,R]=t.React.useState(""),[k,I]=t.React.useState({}),E=t.React.useRef(u),D=u.mode===n.ModeType.Map,N=(null==g?void 0:g.length)>0,A=!D&&u.lrsLayers.length>0||D&&u.mapViewsConfig&&Object.keys(u.mapViewsConfig).length>0,V=!D&&u.eventLayers&&0!==u.eventLayers.length||D&&u.settingsPerView&&u.settingsPerView[C]&&u.settingsPerView[C].eventLayers.length>0,O=(0,t.Immutable)([n.LrsLayerType.Event,n.LrsLayerType.LineEvent,n.LrsLayerType.Network,n.LrsLayerType.Intersection]),F=(0,t.Immutable)([n.LrsLayerType.LineEvent,n.LrsLayerType.Network]),P=a.hooks.useTranslate(i,a.defaultMessages,n.lrsDefaultMessages);t.React.useEffect(()=>{if(void 0===u.mode){const e=u.lrsLayers.length>0?n.ModeType.Layer:n.ModeType.Map;l.onSettingChange({id:d,config:u.set("mode",e)})}},[]),t.React.useEffect(()=>{u&&(E.current=u,console.log("useConfigRef.current",E.current))},[u]);const _=t.React.useCallback((...e)=>{const[t,...a]=e,n=Object.assign(Object.assign({id:o},t));M(n,...a)},[o,M]),U=t.React.useCallback(e=>{M({id:d,config:v(u,e),useDataSources:[]})},[u,M,d]),z=t.React.useCallback((e,t)=>{L(e),D&&""!==t&&R(t)},[D]),B=t.React.useCallback(e=>{const t=e.target.value;j(t)},[]),J=t.React.useCallback((e,a)=>w(void 0,void 0,void 0,function*(){let i=u.set("lrsLayers",e);const{networks:s,lineEvents:l,intersections:o}=(0,n.getLayersByType)(e,(0,t.Immutable)([]));if(i=i.set("networkLayers",s).set("eventLayers",l).set("intersectionLayers",o),s.length>0){const e=i.lrsLayers.find(e=>e.layerType===n.LrsLayerType.Network);if((0,n.isDefined)(e)){const a=yield(0,n.getAttributeSets)(e.lrsUrl,p,!0),s=(0,n.getDefaultAttributeSet)((0,t.Immutable)(a),"",!1);i=i.setIn(["attributeSets"],a).setIn(["defaultAttributeSet"],s)}}const r=(0,n.getDefaultNetwork)(i.lrsLayers,i.defaultNetwork),d=(0,n.getDefaultEvent)(i.lrsLayers,i.defaultEvent,!1);i=i.set("defaultNetwork",r).set("defaultEvent",d),_({config:i,useDataSources:Object.values(a.useDataSourceMap)})}),[u,p,_]),H=t.React.useRef(!1),K=t.React.useCallback((e,a,i,s)=>w(void 0,void 0,void 0,function*(){var l;yield w(void 0,void 0,void 0,function*(){for(;H.current;)yield new Promise(e=>setTimeout(e,1e3))}),H.current=!0;let o=E.current;try{for(const i in e)if(s){o=o.set("mapViewsConfig",e);const s=e[i];let r=(null===(l=E.current.settingsPerView)||void 0===l?void 0:l[i])||h();const{networks:d,lineEvents:u,intersections:c}=(0,n.getLayersByType)(s.lrsLayers,s.disabledLayerIds);if(r=r.setIn(["networkLayers"],d).setIn(["eventLayers"],u).setIn(["intersectionLayers"],c),d.length>0){const e=s.lrsLayers.find(e=>e.layerType===n.LrsLayerType.Network);if((0,n.isDefined)(e))try{const a=yield(0,n.getAttributeSets)(e.lrsUrl,p,!0),i=(0,n.getDefaultAttributeSet)((0,t.Immutable)(a),"",!1);r=r.setIn(["attributeSets"],a).setIn(["defaultAttributeSet"],i)}catch(e){console.error("Error fetching conflict prevention or attribute sets:",e)}}r=yield m(r,s.lrsLayers,!1),r=(0,n.updateDefaultForMapMode)(r,s,n.LrsLayerType.Network,"defaultNetwork"),r=(0,n.updateDefaultForMapMode)(r,s,n.LrsLayerType.Event,"defaultEvent",!1),(null==o?void 0:o.settingsPerView)||(o=o.set("settingsPerView",(0,t.Immutable)({})));const g=o.settingsPerView.set(i,r);o=o.set("settingsPerView",g),""===T&&j(i),I(a)}else""===T&&j(i),I(a);_({config:o,useDataSources:Object.values(i.useDataSourceMap)})}finally{E.current=o,console.log("useConfigRef.current load",E.current),H.current=!1}}),[T,p,_]);return(0,e.jsx)("div",{className:"setting-add-line-event h-100",children:(0,e.jsxs)("div",{className:"jimu-widget-setting setting-add-line-event__setting-content h-100",children:[(0,e.jsx)(n.LrsLoader,{intl:r,portalUrl:p,theme:y,widgetId:d,mode:u.mode,useMapWidgetIds:g,lrsLayers:u.lrsLayers,mapViewsConfig:u.mapViewsConfig,supportedLrsTypes:O,requiredLrsTypes:F,onLrsLayersUpdated:J,onMapViewsConfigUpdated:K,onMapWidgetSelected:(e,t)=>{l.onSettingChange({id:d,config:v(u,t),useMapWidgetIds:e})},onReset:U,onSelectionChanged:z,children:x>-1&&(0,e.jsx)(c,{widgetId:d,config:u,index:x,activeMapViewId:T,onSettingChange:M})}),N&&V&&(0,e.jsxs)(t.React.Fragment,{children:[Object.keys(k).length>1&&(0,e.jsx)(s.SettingSection,{role:"none",children:(0,e.jsx)(s.SettingRow,{flow:"wrap",label:P("selectMapToEditSettings"),children:(0,e.jsx)(a.Select,{className:"w-100",size:"sm",value:C,onChange:B,children:Object.keys(k).map(t=>(0,e.jsx)("option",{value:t,children:k[t]},t))})})}),(0,e.jsx)(f,{intl:r,widgetId:d,config:u,activeMapViewId:C,onSettingChange:M}),(0,e.jsx)(S,{intl:r,widgetId:d,config:u,activeMapViewId:C,onSettingChange:M}),(0,e.jsx)(b,{intl:r,widgetId:d,config:u,activeMapViewId:C,onSettingChange:M})]}),!D&&!A&&!V&&(0,e.jsx)(n.EmptyPlaceholder,{isMapMode:!1}),D&&!N&&(0,e.jsx)(n.EmptyPlaceholder,{isMapMode:!0})]})})};function M(e){r.p=e}})(),d})())}}});