System.register(["jimu-core/emotion","jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-arcgis","calcite-components","jimu-core/react","esri/Graphic","jimu-theme","esri/layers/GraphicsLayer"],function(e,t){var a={},o={},n={},i={},r={},s={},l={},u={},d={},c={};return{setters:[function(e){a.jsx=e.jsx,a.jsxs=e.jsxs},function(e){o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.SessionManager=e.SessionManager,o.classNames=e.classNames,o.css=e.css,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.injectIntl=e.injectIntl,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){n.ConvertUnits=e.ConvertUnits,n.Coordinate=e.Coordinate,n.GetUnits=e.GetUnits,n.Identifiers=e.Identifiers,n.InlineEditableDropdown=e.InlineEditableDropdown,n.Intellisense=e.Intellisense,n.IntellisenseTextInput=e.IntellisenseTextInput,n.LineIdentifiers=e.LineIdentifiers,n.LrsLayerType=e.LrsLayerType,n.MapViewLoader=e.MapViewLoader,n.ModeType=e.ModeType,n.SearchMeasuresType=e.SearchMeasuresType,n.SearchMethod=e.SearchMethod,n.SpatialReferenceFrom=e.SpatialReferenceFrom,n.colorBlack=e.colorBlack,n.convertStationToNumber=e.convertStationToNumber,n.coordinateGraphicColor=e.coordinateGraphicColor,n.createLabelLayer=e.createLabelLayer,n.derivedFields=e.derivedFields,n.distanceField=e.distanceField,n.findFirstArcgisMapWidgetId=e.findFirstArcgisMapWidgetId,n.formatMessage=e.formatMessage,n.getCalciteBasicTheme=e.getCalciteBasicTheme,n.getConfigValue=e.getConfigValue,n.getDateWithTZOffset=e.getDateWithTZOffset,n.getGeometryGraphic=e.getGeometryGraphic,n.getModeType=e.getModeType,n.getPolylineMidPoint=e.getPolylineMidPoint,n.getSimplePointGraphic=e.getSimplePointGraphic,n.getSuggestions=e.getSuggestions,n.highlightColor=e.highlightColor,n.isDefined=e.isDefined,n.isInWidgetController=e.isInWidgetController,n.isWithinTolerance=e.isWithinTolerance,n.measureFields=e.measureFields,n.networkObjectIdField=e.networkObjectIdField,n.removeLabelLayer=e.removeLabelLayer,n.requestService=e.requestService,n.stationField=e.stationField,n.toRouteField=e.toRouteField},function(e){i.Alert=e.Alert,i.Button=e.Button,i.DataActionList=e.DataActionList,i.DataActionListStyle=e.DataActionListStyle,i.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,i.Label=e.Label,i.Loading=e.Loading,i.LoadingType=e.LoadingType,i.NumericInput=e.NumericInput,i.Pagination=e.Pagination,i.Paper=e.Paper,i.Select=e.Select,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip,i.WidgetPlaceholder=e.WidgetPlaceholder,i.defaultMessages=e.defaultMessages},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent,r.geometryUtils=e.geometryUtils,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){s.CalciteSegmentedControl=e.CalciteSegmentedControl,s.CalciteSegmentedControlItem=e.CalciteSegmentedControlItem},function(e){l.useImperativeHandle=e.useImperativeHandle},function(e){u.default=e.default},function(e){d.getTheme=e.getTheme,d.withTheme=e.withTheme},function(e){c.default=e.default}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=d},14321:e=>{"use strict";e.exports=i},22089:e=>{"use strict";e.exports=u},23001:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m4 2 8 6-8 6z"></path></svg>'},35737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m14 4-6 8-6-8z"></path></svg>'},37264:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M5 4.5h3.5V0h1v4.5H20v1h-4.5V10h-1V5.5H5z"></path><path fill="#000" fill-rule="evenodd" d="M8.682 9.318a4.5 4.5 0 0 1 .334 5.991l3.97 3.97-.708.706-3.969-3.969a4.5 4.5 0 1 1 .373-6.698m-.707 5.657a3.5 3.5 0 1 0-4.95-4.95 3.5 3.5 0 0 0 4.95 4.95" clip-rule="evenodd"></path></svg>'},47626:e=>{"use strict";e.exports=n},59620:e=>{"use strict";e.exports=c},62686:e=>{"use strict";e.exports=r},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},67386:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=l},79244:e=>{"use strict";e.exports=o},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},99037:e=>{"use strict";e.exports=s}},t={};function f(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,f),n.exports}f.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return f.d(t,{a:t}),t},f.d=(e,t)=>{for(var a in t)f.o(t,a)&&!f.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.p="";var m={};return f.p=window.jimuConfig.baseUrl,(()=>{"use strict";f.r(m),f.d(m,{__set_webpack_public_path__:()=>ot,default:()=>at});var e=f(67386),t=f(79244),a=f(47626);const o={_widgetLabel:"Search By Route",method:"Method *",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",lineAndMeasure:"Line And Measure",network:"Network *",referent:"Referent",referentRequired:"Referent *",routeIdLabel:"Route Id",routeNameLabel:"Route Name",invalidMeasure:"Invalid measure value",invalidCoordinate:"Invalid coordinate value",invalidRouteField:"Route could not be found with provided value",measureWithUnits:"Measure ({units})",measuresWithUnits:"Measures ({units})",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",backLabel:"Back",checkResult:"Check results",clearResult:"Clear results",resultsDisplay:"Results:",searchLabel:"Search",resetLabel:"Reset",results:"Results",searchDisabled:"Provide route",coordinateSearchDisabled:"Provide coordinate",lineMeasureSearchDisabled:"Provide line",xCoordinateRequiredLabel:"X Coordinate *",yCoordinateRequiredLabel:"Y Coordinate *",zCoordinateLabel:"Z Coordinate",searchRadiusResultsError:"No routes found in search radius.",offsetlabel:"Offset ({unit})",invalidOffset:"Invalid Offset",invalidReferent:"Invalid Referent",searchReferentTooltip:"Search By Referent",referentDisplayName:"{displayName} *",noResultReferent:"No routes found for the given offset value",addAnotherMeasure:"Add another measure",range:"Range",noResults:"No results with provided values",noResultsMeasure:"No results found with provided measure(s)",fieldNameRequired:"{field} *",measureType:"Measure Type"};var n=f(14321),i=f(37264),r=f.n(i),s=f(62686);function l(i){const r=t.hooks.useTranslation(o),{defaultReferent:s,defaultNetwork:l,lrsLayers:u,resultConfig:d,hideMethod:c,hideNetwork:f,onMethodChanged:m,onNetworkChanged:h,onReferentChanged:v}=i,[p,g]=t.React.useState(u[0]),[y,I]=t.React.useState(null==d?void 0:d.defaultReferentLayer),[w,S]=t.React.useState(p.networkInfo.defaultMethod),[R,N]=t.React.useState([]),k=t.React.useMemo(()=>u.some(e=>e.isReferent),[u]);t.React.useEffect(()=>{I(s)},[s]),t.React.useEffect(()=>{const e=u.find(e=>e.name===l&&!(null==e?void 0:e.isReferent));(0,a.isDefined)(e)&&(g((0,t.Immutable)(e)),e.networkInfo.defaultMethod!==a.SearchMethod.Referent||k?S(e.networkInfo.defaultMethod):e.networkInfo.useMeasure?S(a.SearchMethod.Measure):e.networkInfo.useCoordinate?S(a.SearchMethod.Coordinate):S(a.SearchMethod.Referent))},[l,k,u]);const b=(e,t)=>{const a=u.findIndex(t=>t.name===e);"network"===t?(g(u[a]),h(u[a]),S(u[a].networkInfo.defaultMethod),m(u[a].networkInfo.defaultMethod)):(I(u[a]),v(u[a]))};t.React.useEffect(()=>{const e=u.filter(e=>!e.isReferent&&e.layerType===a.LrsLayerType.Network).map(e=>e.name).asMutable();N(e)},[u]);const F=t.React.useMemo(()=>{let e=0;return p.networkInfo.useMeasure&&e++,p.networkInfo.useCoordinate&&e++,p.networkInfo.useReferent&&e++,p.networkInfo.useLineAndMeasure&&e++,e},[p]);return(0,e.jsxs)("div",{className:"search-method-form",children:[!c&&(0,e.jsx)(a.InlineEditableDropdown,{label:r("method"),isDisabled:1===F,defaultItem:w,altItemDescriptions:(()=>{const e=[];return p.networkInfo.useMeasure&&e.push(r("measure")),p.networkInfo.useCoordinate&&e.push(r("coordinate")),p.networkInfo.useReferent&&e.push(r("referent")),p.networkInfo.useLineAndMeasure&&e.push(r("lineAndMeasure")),e})(),listItems:(()=>{const e=[];return p.networkInfo.useMeasure&&e.push(a.SearchMethod.Measure),p.networkInfo.useCoordinate&&e.push(a.SearchMethod.Coordinate),p.networkInfo.useReferent&&k&&e.push(a.SearchMethod.Referent),p.networkInfo.useLineAndMeasure&&e.push(a.SearchMethod.LineAndMeasure),e})(),onSelectionChanged:e=>{let t=a.SearchMethod.Measure;e===a.SearchMethod.Coordinate?t=a.SearchMethod.Coordinate:e===a.SearchMethod.Referent?t=a.SearchMethod.Referent:e===a.SearchMethod.LineAndMeasure&&(t=a.SearchMethod.LineAndMeasure),S(t),m(t)}}),!f&&(0,e.jsx)(a.InlineEditableDropdown,{label:r("network"),isDisabled:1===u.length,defaultItem:(0,a.isDefined)(p)?p.name:"",listItems:R,onSelectionChanged:e=>{b(e,"network")}}),w===a.SearchMethod.Referent&&y&&(0,e.jsxs)("div",{className:"search-method-form__network-label px-3",style:{paddingTop:"12px"},children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-1 title3",centric:!0,style:{width:100},children:r("referentRequired")}),(0,e.jsx)(n.Select,{"aria-label":r("referent"),className:"w-100",size:"sm",disabled:1===u.length,value:y.name,onChange:e=>{b(e.target.value,"point")},children:u.map((t,a)=>(null==t?void 0:t.isReferent)?(0,e.jsx)("option",{value:t.name,children:t.name},a):null)})]})]})}const u=t.React.memo(i=>{const{intl:r,reset:s,hideRoute:l,widgetId:u,type:d,lrsLayer:c,dataSource:f,isDataSourceReady:m,routeAndMeasureRequest:h,onChange:v,onAccept:p}=i,{routeIdFieldSchema:g,routeNameFieldSchema:y,routeIdFields:I}=c.networkInfo,w=t.hooks.useTranslation(o),[S,R]=t.React.useState({}),N=c.networkInfo||{};t.React.useEffect(()=>{(0,a.isDefined)(I)&&I.length>0&&R(Object.fromEntries(I.map((e,t)=>{var a,o;return[t,null!==(o=null===(a=null==h?void 0:h.routeIdFields)||void 0===a?void 0:a[t])&&void 0!==o?o:""]})))},[h,I]);const k=t.React.useMemo(()=>f,[f]),b=(e,t)=>{j(e,t)},F=(e,t,a)=>{D(e,t,a)},D=(e,t,o)=>{const n=h;N.defaultIdentifer===a.Identifiers.RouteId&&"string"==typeof e?(n.routeId=e,p(n,t)):N.defaultIdentifer===a.Identifiers.RouteName&&"string"==typeof e?(n.routeName=e,p(n,t)):(n.routeIdFields[o]=e,p(n,t,o))},M=(e,t)=>{C(e,t)},x=(e,t,a)=>{L(e,t,a)},L=(e,t,o)=>{const n=h;N.defaultLineIdentifier===a.LineIdentifiers.LineId&&"string"==typeof e?(n.lineId=e,p(n,t)):N.defaultLineIdentifier===a.LineIdentifiers.LineName&&"string"==typeof e&&(n.lineName=e,p(n,t))},j=(e,t)=>{const o=h;N.defaultIdentifer===a.Identifiers.RouteId&&"string"==typeof e?(o.routeId=e,v(o)):N.defaultIdentifer===a.Identifiers.RouteName&&"string"==typeof e?(o.routeName=e,v(o)):(o.routeIdFields[t]=e,v(o,t))},C=(e,t)=>{const o=h;N.defaultLineIdentifier===a.LineIdentifiers.LineId&&"string"==typeof e?(o.lineId=e,v(o)):N.defaultLineIdentifier===a.LineIdentifiers.LineName&&"string"==typeof e&&(o.lineName=e,v(o))},O=t.React.useMemo(()=>{const e={};return I&&I.length>1&&k&&I.forEach((t,a)=>{const o=null==k?void 0:k.getFieldCodedValueList(t.field.jimuName);o&&(e[a]=o)}),e},[k,I]),T={paddingTop:"0px"};return"lineMeasure"===d&&(T.paddingTop="12px"),(0,e.jsxs)("div",{className:"route-input-control",children:["lineMeasure"===d&&N.defaultLineIdentifier===a.LineIdentifiers.LineId&&(0,e.jsxs)("div",{className:"search-by-measure-form__route-id-label px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:w("fieldNameRequired",{field:N.lineIdFieldSchema.alias})}),(0,e.jsx)(a.IntellisenseTextInput,{reset:s,widgetId:u,fieldName:N.lineIdFieldSchema.name,fieldType:N.lineIdFieldSchema.type,dataSource:f,isDataSourceReady:m,onChange:M,onAccept:x})]}),"lineMeasure"===d&&N.defaultLineIdentifier===a.LineIdentifiers.LineName&&(0,e.jsxs)("div",{className:"search-by-measure-form__route-id-label px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:w("fieldNameRequired",{field:N.lineNameFieldSchema.alias})}),(0,e.jsx)(a.IntellisenseTextInput,{reset:s,widgetId:u,fieldName:N.lineNameFieldSchema.name,fieldType:N.lineNameFieldSchema.type,dataSource:f,isDataSourceReady:m,onChange:M,onAccept:x})]}),N.defaultIdentifer===a.Identifiers.RouteId&&(N.supportsLines&&!l&&"lineMeasure"===d||"lineMeasure"!==d)&&(0,e.jsxs)("div",{className:"search-by-measure-form__route-id-label px-3",style:T,children:["lineMeasure"!==d?(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:w("fieldNameRequired",{field:g.alias})}):(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:g.alias}),(0,e.jsx)(a.IntellisenseTextInput,{reset:s,widgetId:u,fieldName:N.routeIdFieldSchema.name,fieldType:N.routeIdFieldSchema.type,dataSource:f,isDataSourceReady:m,onChange:b,onAccept:F})]}),N.defaultIdentifer===a.Identifiers.RouteName&&(N.supportsLines&&!l&&"lineMeasure"===d||"lineMeasure"!==d)&&(0,e.jsxs)("div",{className:"search-by-measure-form__route-name-label px-3",style:T,children:["lineMeasure"!==d?(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:w("fieldNameRequired",{field:y.alias})}):(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:y.alias}),(0,e.jsx)(a.IntellisenseTextInput,{reset:s,widgetId:u,fieldName:N.routeNameFieldSchema.name,fieldType:N.routeNameFieldSchema.type,dataSource:f,isDataSourceReady:m,onChange:b,onAccept:F})]}),N.defaultIdentifer===a.Identifiers.MultiField&&I.filter(e=>e.enabled).map((o,i)=>{var l,d;return(0,e.jsxs)("div",{className:"search-by-measure-form__multi-field-id px-3",children:[O[i]&&(0,e.jsxs)("div",{className:(0,t.classNames)("search-by-measure-form__coded-domain-label",{"pt-2":i>0}),children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:o.field.alias}),(0,e.jsxs)(n.Select,{"aria-label":o.field.name,size:"sm",style:{width:"100%"},value:S[i],onChange:e=>{((e,t)=>{R(a=>Object.assign(Object.assign({},a),{[t]:e.target.value})),D(e.target.value,!0,t)})(e,i)},children:[(0,e.jsx)("option",{value:"",children:(0,a.formatMessage)(r,"nullLabel")},-1),O[i].map((t,a)=>(0,e.jsx)("option",{value:t.value,children:`${t.value} - ${t.label}`},a))]},`${i}-${(null===(l=null==h?void 0:h.routeIdFields)||void 0===l?void 0:l[i])||"reset"}-${Date.now()}`)]}),!O[i]&&o.field.type===t.JimuFieldType.Number&&(0,e.jsxs)("div",{className:(0,t.classNames)("search-by-measure-form__numeric-label",{"pt-2":i>0}),children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:o.field.alias}),(0,e.jsx)(n.NumericInput,{value:null===(d=null==h?void 0:h.routeIdFields)||void 0===d?void 0:d[i],"aria-label":o.field.name,size:"sm",style:{width:"100%"},step:1,disabled:!m,onAcceptValue:e=>{((e,t)=>{D(e,!0,t)})(e,i)}})]}),!O[i]&&o.field.type===t.JimuFieldType.String&&(0,e.jsxs)("div",{className:(0,t.classNames)("search-by-measure-form__text-label",{"pt-2":i>0}),children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:o.field.alias}),(0,e.jsx)(a.IntellisenseTextInput,{reset:s,widgetId:u,fieldName:o.field.name,fieldType:o.field.type,dataSource:f,isDataSourceReady:m,onChange:e=>{b(e,i)},onAccept:(e,t)=>{F(e,t,i)}})]})]},i)})]})});var d=f(99037);const c=t.React.memo(i=>{const{lrsLayer:r,searchMeasureBy:s,onChange:l}=i,u=(null==r?void 0:r.networkInfo)||{},c=t.hooks.useTranslation(o);return(0,e.jsx)("div",{className:"measures-segment-control",children:(()=>{let e=0;return u.searchSingle&&e++,u.searchMultiple&&e++,u.searchRange&&e++,e>1})()&&(0,e.jsxs)("div",{className:"w-100 px-3 pt-2",css:(0,a.getCalciteBasicTheme)(),children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100title3",centric:!0,children:c("measureType")}),(0,e.jsxs)(d.CalciteSegmentedControl,{width:"full",value:s,appearance:"outline-fill",scale:"s",onCalciteSegmentedControlChange:e=>{l(e.target.value)},children:[u.searchSingle&&(0,e.jsx)(d.CalciteSegmentedControlItem,{checked:s===a.SearchMeasuresType.Single||void 0,value:a.SearchMeasuresType.Single,children:c("single")}),u.searchMultiple&&(0,e.jsx)(d.CalciteSegmentedControlItem,{checked:s===a.SearchMeasuresType.Multiple||void 0,value:a.SearchMeasuresType.Multiple,children:c("multiple")}),u.searchRange&&(0,e.jsx)(d.CalciteSegmentedControlItem,{checked:s===a.SearchMeasuresType.Range||void 0,value:a.SearchMeasuresType.Range,children:c("range")})]})]})})});var h=f(62838),v=f.n(h),p=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a};const g=a=>{const o=window.SVG,{className:n}=a,i=p(a,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",n);return o?(0,e.jsx)(o,Object.assign({className:r,src:v()},i)):(0,e.jsx)("svg",Object.assign({className:r},i))};function y(i){const{reset:r,lrsLayer:s,isDataSourceReady:l,searchMeasureBy:u,routeAndMeasureRequest:d,intl:c,onChange:f}=i,m=t.hooks.useTranslation(o),h=(null==s?void 0:s.networkInfo)||{},v=(0,a.GetUnits)(h.unitsOfMeasure,c),[p,y]=t.React.useState(""),[I,w]=t.React.useState(""),[S,R]=t.React.useState(""),[N,k]=t.React.useState(new Array(1).fill(""));t.React.useEffect(()=>{y(""),w(""),R(""),k(new Array(1).fill(""))},[r]);const b=(e,t,o)=>{if(isNaN(Number(e))){const n=(0,a.convertStationToNumber)(e);return isNaN(n)?(F(NaN,t,!1,o,""),{valid:!1,msg:m("invalidMeasure")}):(F(n,t,!0,o,e),{valid:!0})}return F(Number(""===e?NaN:e),t,!0,o,""),{valid:!0}},F=(e,t,o,n,i)=>{const r=d;r.searchMeasureBy===a.SearchMeasuresType.Single?(r.measure=e,r.station=i):r.searchMeasureBy===a.SearchMeasuresType.Multiple?(r.measures[n]=e,r.stations[n]=i):r.searchMeasureBy===a.SearchMeasuresType.Range&&(t?(r.fromMeasure=e,r.fromStation=i):(r.toMeasure=e,r.toStation=i)),f(r,o)};return(0,e.jsx)("div",{className:"measure-input-control",children:(0,e.jsxs)("div",{className:"measure-input-control__content pt-2",children:[u===a.SearchMeasuresType.Single&&(0,e.jsxs)("div",{className:"measure-input-control__single px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:m("measureWithUnits",{units:v})}),(0,e.jsx)(n.TextInput,{"aria-label":m("measureWithUnits",{units:v}),type:"text",size:"sm",style:{width:"100%"},disabled:!l,allowClear:!0,value:p,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;y(a)},checkValidityOnAccept:e=>b(e,!0)})]}),u===a.SearchMeasuresType.Multiple&&(0,e.jsxs)("div",{className:"measure-input-control__multiple",children:[(0,e.jsxs)("div",{className:"measure-input-control__multiple-measure px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:m("measuresWithUnits",{units:v})}),N&&N.map((t,a)=>(0,e.jsxs)("div",{className:"d-flex w-100",children:[(0,e.jsx)(n.TextInput,{"aria-label":m("measuresWithUnits",{units:v}),type:"text",className:"mb-1",size:"sm",style:{width:"93%",float:"left"},disabled:!l,allowClear:!0,checkValidityOnAccept:e=>b(e,!0,a),onChange:e=>{((e,t)=>{N[t]=e.target.value;const a=[];N.forEach((e,t)=>{a.push(e)}),k(a)})(e,a)},value:t}),a>0&&(0,e.jsx)(n.Button,{className:"text-input-clear clear-content",style:{float:"left",width:"7%"},type:"tertiary","aria-label":m("clear"),title:m("clear"),icon:!0,size:"sm",onClick:()=>{(e=>{d.measures.splice(e,1),d.stations.splice(e,1),N.splice(e,1);const t=[];N.forEach((e,a)=>{t.push(e)}),k(t)})(a)},children:(0,e.jsx)(g,{size:"s"})})]},a))]}),(0,e.jsx)("div",{className:"measure-input-control__multiple-add-input pt-2 px-3",children:(0,e.jsx)(n.Button,{type:"secondary",size:"sm",style:{width:"93%"},onClick:()=>{let e=[];e.push(""),N&&(e=N.concat(e)),d.measures.push(Number(NaN)),d.stations.push(""),k(e)},children:m("addAnotherMeasure")})})]}),u===a.SearchMeasuresType.Range&&(0,e.jsxs)("div",{className:"measure-input-control__range",children:[(0,e.jsxs)("div",{className:"measure-input-control__range-from-measure px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:m("fromMeasureWithUnits",{units:v})}),(0,e.jsx)(n.TextInput,{"aria-label":m("fromMeasureWithUnits",{units:v}),type:"text",size:"sm",style:{width:"100%"},disabled:!l,allowClear:!0,value:I,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;w(a)},checkValidityOnAccept:e=>b(e,!0)})]}),(0,e.jsxs)("div",{className:"measure-input-control__range-to-measure pt-2 px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-0 w-100 title3",centric:!0,children:m("toMeasureWithUnits",{units:v})}),(0,e.jsx)(n.TextInput,{"aria-label":m("toMeasureWithUnits",{units:v}),type:"text",size:"sm",style:{width:"100%"},disabled:!l,allowClear:!0,value:S,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;R(a)},checkValidityOnAccept:e=>b(e,!1)})]})]})]})})}var I=f(68972);const w=t.React.forwardRef((o,n)=>{var i;const{widgetId:r,reset:s,lrsLayer:l,dataSource:d,isDataSourceReady:f,intl:m,hideRoute:h,onSubmit:v,onValidationChanged:p}=o,g=(null==l?void 0:l.networkInfo)||{},[w,S]=t.React.useState({}),[R,N]=t.React.useState(!1),[k,b]=t.React.useState(new Array(null===(i=null==g?void 0:g.routeIdFields)||void 0===i?void 0:i.length).fill(!0)),[F,D]=t.React.useState(!0),[M,x]=t.React.useState(a.SearchMeasuresType.Single);(0,I.useImperativeHandle)(n,()=>({submitForm:L})),t.React.useEffect(()=>{var e,t;let o=a.SearchMeasuresType.Single;l.networkInfo.searchSingle?o=a.SearchMeasuresType.Single:l.networkInfo.searchMultiple?o=a.SearchMeasuresType.Multiple:l.networkInfo.searchRange&&(o=a.SearchMeasuresType.Range),x(o);const n={routeId:"",routeName:"",routeIdFields:new Array(null===(t=null===(e=l.networkInfo)||void 0===e?void 0:e.routeIdFields)||void 0===t?void 0:t.length).fill(""),measure:NaN,station:"",fromMeasure:NaN,fromStation:"",toMeasure:NaN,toStation:"",measures:[NaN],stations:[""],isPoint:!1,searchMeasureBy:o};S(n)},[l.networkInfo,s]);const L=()=>{const e=Object.assign({},w);e.isMeasureToGeometryOperation=!1,e.isPoint=!1,e.searchMeasureBy===a.SearchMeasuresType.Single?isNaN(e.measure)||(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):e.searchMeasureBy===a.SearchMeasuresType.Multiple?e.measures.some(e=>!isNaN(e))&&(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):(e.isPoint=!1,isNaN(e.fromMeasure)&&isNaN(e.toMeasure)||(isNaN(e.fromMeasure)&&!isNaN(e.toMeasure)&&(e.fromMeasure=e.toMeasure,e.toMeasure=NaN,e.isPoint=!0),!isNaN(e.fromMeasure)&&isNaN(e.toMeasure)&&(e.isPoint=!0),e.fromMeasure===e.toMeasure&&(e.toMeasure=NaN,e.isPoint=!0),e.isMeasureToGeometryOperation=!0)),v(e)},j=t.React.useMemo(()=>f&&R&&F,[f,R,F]);t.React.useEffect(()=>{p(j)},[j,p]);const C=t.React.useCallback((e,t)=>{S(e)},[]),O=t.React.useCallback((e,t,o)=>{if(S(e),l.networkInfo.defaultIdentifer===a.Identifiers.RouteId&&""===e.routeId)N(!1);else if(l.networkInfo.defaultIdentifer===a.Identifiers.RouteName&&""===e.routeName)N(!1);else if(l.networkInfo.defaultIdentifer===a.Identifiers.MultiField&&o>-1){let a=!0;const n=k;n[o]=t,n.forEach((t,o)=>{t||""===e.routeIdFields[o]||(a=!1),e.routeIdFields.every(e=>""===e)&&(a=!1)}),N(a),b(n)}else N(t)},[k,l.networkInfo]),T=t.React.useCallback(e=>{const t=w;t.searchMeasureBy=e,S(t),x(e)},[w]),P=t.React.useCallback((e,t)=>{S(e),D(t)},[]);return(0,e.jsx)("div",{className:"search-by-measure-form",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-measure-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `,children:(0,e.jsxs)("div",{className:"search-by-measure-form__content pt-3",children:[(0,e.jsx)(u,{reset:s,intl:m,hideRoute:h,widgetId:r,lrsLayer:l,dataSource:d,routeAndMeasureRequest:w,isDataSourceReady:f,onChange:C,onAccept:O}),(0,e.jsx)(c,{lrsLayer:l,searchMeasureBy:M,onChange:T}),(0,e.jsx)(y,{reset:s,intl:m,lrsLayer:l,dataSource:d,isDataSourceReady:f,searchMeasureBy:M,routeAndMeasureRequest:w,onChange:P})]})})});function S(e,t,o,n,i,r,s){const l=o.getSchema(),u=(null==l?void 0:l.fields)?Object.values(l.fields):[],d=n.networkInfo.lrsNetworkId.toString(),c=s.find(e=>e.networkInfo&&d===e.networkInfo.derivedFromNetworkId&&e.networkInfo.isDerived);let f;n.networkInfo.showAdditionalFields?(f=function(e,t,o,n){var i,r,s,l,u;const d=[],c=e.networkInfo.lrsFields,f=e.networkInfo.additionalFields,m=e.networkInfo.layerFields;if(!c||!f)return"additionalFieldsNotConfig";c.includes(e.networkInfo.routeIdFieldSchema.jimuName)&&d.push(e.networkInfo.routeIdFieldSchema.alias);e.networkInfo.useRouteName&&c.includes(e.networkInfo.routeNameFieldSchema.jimuName)&&d.push(e.networkInfo.routeNameFieldSchema.alias);const h=[e.networkInfo.lineIdFieldName,e.networkInfo.lineNameFieldName,e.networkInfo.lineOrderFieldName];m.forEach(e=>{const t=e.jimuName;h.includes(t)||!c.includes(t)||d.includes(e.alias)||d.push(e.alias)}),e.networkInfo.defaultIdentifer===a.Identifiers.MultiField&&e.networkInfo.routeIdFields.forEach(e=>{const t=e.field.jimuName;c.includes(t)&&d.push(e.field.alias)});const v=t.attributes[a.measureFields.at(1).value],p=t.attributes[a.stationField.at(0).value],g=t.attributes[a.stationField.at(1).value],y=t.attributes[a.stationField.at(2).value],I=t.attributes[a.distanceField.value],w=t.attributes[a.toRouteField.at(0).value];f.includes(a.measureFields.at(0).value)&&d.push(a.measureFields.at(0).value);!isNaN(v)&&null!=v&&f.includes(a.measureFields.at(1).value)&&d.push(a.measureFields.at(1).value);null!=p&&f.includes(a.stationField.at(0).value)&&d.push(a.stationField.at(0).value);null!=g&&f.includes(a.stationField.at(1).value)&&d.push(a.stationField.at(1).value);null!=y&&f.includes(a.stationField.at(2).value)&&d.push(a.stationField.at(2).value);null!=I&&f.includes(a.distanceField.value)&&d.push(a.distanceField.value);(0,a.isDefined)(n)&&(f.includes(a.derivedFields.at(0).value)&&d.push(a.derivedFields.at(0).value),f.includes(a.derivedFields.at(1).value)&&d.push(a.derivedFields.at(1).value),f.includes(a.derivedFields.at(2).value)&&d.push(a.derivedFields.at(2).value),f.includes(a.derivedFields.at(3).value)&&d.push(a.derivedFields.at(3).value));o===a.SearchMethod.LineAndMeasure&&(e.networkInfo.lineIdFieldName&&c.includes(e.networkInfo.lineIdFieldName)&&d.push(e.networkInfo.lineIdFieldSchema.alias),e.networkInfo.lineNameFieldName&&c.includes(e.networkInfo.lineNameFieldName)&&d.push(e.networkInfo.lineNameFieldSchema.alias),e.networkInfo.lineOrderFieldName&&c.includes(e.networkInfo.lineOrderFieldName)&&d.push(e.networkInfo.lineOrderFieldSchema.alias),null!=w&&(f.includes(a.toRouteField.at(0).value)&&d.push(null===(i=a.toRouteField.at(0))||void 0===i?void 0:i.value),f.includes(a.toRouteField.at(1).value)&&d.push(null===(r=a.toRouteField.at(1))||void 0===r?void 0:r.value),f.includes(a.toRouteField.at(2).value)&&d.push(null===(s=a.toRouteField.at(2))||void 0===s?void 0:s.value),f.includes(a.toRouteField.at(3).value)&&d.push(null===(l=a.toRouteField.at(3))||void 0===l?void 0:l.value),f.includes(a.toRouteField.at(4).value)&&d.push(null===(u=a.toRouteField.at(4))||void 0===u?void 0:u.value)));return d}(n,t,i,c),0===f.length&&(f=function(e){const t=[],a=e.routeNameFieldSchema.alias,o=e.routeIdFieldSchema.alias;a?t.push(a):t.push(o);return t}(n.networkInfo))):f=function(e,t,o){var n,i,r,s,l;const u=[];u.push(e.networkInfo.routeIdFieldSchema.alias),e.networkInfo.useRouteName&&u.push(e.networkInfo.routeNameFieldSchema.alias);e.networkInfo.defaultIdentifer===a.Identifiers.MultiField&&e.networkInfo.routeIdFields.forEach(e=>{u.push(e.field.alias)});const d=t.attributes[a.measureFields.at(1).value],c=t.attributes[a.stationField.at(0).value],f=t.attributes[a.stationField.at(1).value],m=t.attributes[a.stationField.at(2).value],h=t.attributes[a.distanceField.value],v=t.attributes[a.toRouteField.at(0).value];u.push(a.measureFields.at(0).value),null==v&&(isNaN(d)||null==d||u.push(a.measureFields.at(1).value));null!=c&&u.push(a.stationField.at(0).value);null!=f&&u.push(a.stationField.at(1).value);null!=m&&u.push(a.stationField.at(2).value);null!=h&&u.push(a.distanceField.value);e.networkInfo.fromDateFieldName&&u.push(e.networkInfo.fromDateFieldSchema.alias);e.networkInfo.toDateFieldName&&u.push(e.networkInfo.toDateFieldSchema.alias);o===a.SearchMethod.LineAndMeasure&&(e.networkInfo.lineIdFieldName&&u.push(e.networkInfo.lineIdFieldSchema.alias),e.networkInfo.lineNameFieldName&&u.push(e.networkInfo.lineNameFieldSchema.alias),e.networkInfo.lineOrderFieldName&&u.push(e.networkInfo.lineOrderFieldSchema.alias),null!=v&&(u.push(null===(n=a.toRouteField.at(0))||void 0===n?void 0:n.value),isNaN(d)||null==d||u.push(a.measureFields.at(1).value),u.push(null===(i=a.toRouteField.at(1))||void 0===i?void 0:i.value),u.push(null===(r=a.toRouteField.at(2))||void 0===r?void 0:r.value),u.push(null===(s=a.toRouteField.at(3))||void 0===s?void 0:s.value),u.push(null===(l=a.toRouteField.at(4))||void 0===l?void 0:l.value)));return u}(n,t,i);const m=a.toRouteField.at(0).value;let h=`{${function(e){if(e.networkInfo.defaultIdentifer===a.Identifiers.RouteName)return e.networkInfo.routeNameFieldSchema.jimuName;return e.networkInfo.routeIdFieldSchema.jimuName}(n)}}`;if(i===a.SearchMethod.LineAndMeasure&&r===a.SearchMeasuresType.Range&&t.attributes[m]&&(h=function(e,t){const o=t.attributes[a.toRouteField.at(0).value],n=t.attributes[a.toRouteField.at(1).value],i=e.networkInfo.routeNameFieldSchema&&t.attributes[e.networkInfo.routeNameFieldSchema.jimuName],r=e.networkInfo.routeIdFieldSchema&&t.attributes[e.networkInfo.routeIdFieldSchema.jimuName];if(e.networkInfo.defaultIdentifer===a.Identifiers.RouteName&&i&&n)return i+" - "+n;return r+" - "+o}(n,t)),u){const t=[];return f.forEach(n=>{var i,r;const s=u.find(e=>e.alias===n);if((0,a.isDefined)(s))if(n===a.distanceField.value){const n=o.getOriginDataSources()[0],l=null===(r=null===(i=null==n?void 0:n.layerDefinition)||void 0===i?void 0:i.geometryProperties)||void 0===r?void 0:r.units,u="esriDecimalDegrees"===l;t.push({fieldName:s.name,label:s.alias+(u?" ("+(0,a.GetUnits)("esriMeters",e)+")":(0,a.isDefined)(l)?" ("+(0,a.GetUnits)(l,e)+")":"")})}else t.push({fieldName:s.name,label:s.alias})}),{fieldInfos:t,content:[{type:"fields"}],title:h}}return null}function R(e,t){let o="";return o=t?e.networkInfo.useRouteName?`'${e.networkInfo.routeNameFieldSchema.alias}: ' + $feature.${e.networkInfo.routeNameFieldSchema.name} + textformatting.NewLine +\n                    '${a.measureFields.at(0).label}: ' + $feature.Measure`:`'${e.networkInfo.routeIdFieldSchema.alias}: ' + $feature.${e.networkInfo.routeIdFieldSchema.name} + textformatting.NewLine +\n                    '${a.measureFields.at(0).label}: ' + $feature.Measure`:e.networkInfo.useRouteName?`'${e.networkInfo.routeNameFieldSchema.alias}: ' + $feature.${e.networkInfo.routeNameFieldSchema.name} + textformatting.NewLine +\n                    '${a.measureFields.at(0).label}: ' + $feature.Measure + textformatting.NewLine +\n                    '${a.measureFields.at(1).label}: ' + $feature.ToMeasure`:`'${e.networkInfo.routeIdFieldSchema.alias}: ' + $feature.${e.networkInfo.routeIdFieldSchema.name} + textformatting.NewLine +\n                    '${a.measureFields.at(0).label}: ' + $feature.Measure + textformatting.NewLine +\n                    '${a.measureFields.at(1).label}: ' + $feature.ToMeasure`,o}function N(e){if(!e||0===e.length)return e;const t=[...e],o=t.find(e=>e.name===a.measureFields.at(0).value);if(!(0,a.isDefined)(o)){const o=e.at(0).clone();o.name=a.measureFields.at(0).value,o.alias=a.measureFields.at(0).label,o.type="double",o.nullable=!0,o.editable=!0,t.push(o)}const n=t.find(e=>e.name===a.measureFields.at(1).value);if(!(0,a.isDefined)(n)){const o=e.at(0).clone();o.name=a.measureFields.at(1).value,o.alias=a.measureFields.at(1).label,o.type="double",o.nullable=!0,o.editable=!0,t.push(o)}return t}function k(e){const t=new Set;e.forEach(e=>{0!==e.valueOf()&&(t.has(e.valueOf())||t.add(e.valueOf()))});const a=Array.from(t).map(e=>new Date(e));return Array.from(a).sort((e,t)=>e.getTime()-t.getTime())}const b=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const F="object"==typeof global&&global&&global.Object===Object&&global;var D="object"==typeof self&&self&&self.Object===Object&&self;const M=F||D||Function("return this")();const x=function(){return M.Date.now()};var L=/\s/;const j=function(e){for(var t=e.length;t--&&L.test(e.charAt(t)););return t};var C=/^\s+/;const O=function(e){return e?e.slice(0,j(e)+1).replace(C,""):e};const T=M.Symbol;var P=Object.prototype,E=P.hasOwnProperty,A=P.toString,G=T?T.toStringTag:void 0;const z=function(e){var t=E.call(e,G),a=e[G];try{e[G]=void 0;var o=!0}catch(e){}var n=A.call(e);return o&&(t?e[G]=a:delete e[G]),n};var V=Object.prototype.toString;const _=function(e){return V.call(e)};var B=T?T.toStringTag:void 0;const $=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":B&&B in Object(e)?z(e):_(e)};const W=function(e){return null!=e&&"object"==typeof e};const U=function(e){return"symbol"==typeof e||W(e)&&"[object Symbol]"==$(e)};var J=/^[-+]0x[0-9a-f]+$/i,q=/^0b[01]+$/i,Z=/^0o[0-7]+$/i,K=parseInt;const H=function(e){if("number"==typeof e)return e;if(U(e))return NaN;if(b(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=b(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=O(e);var a=q.test(e);return a||Z.test(e)?K(e.slice(2),a?2:8):J.test(e)?NaN:+e};var Q=Math.max,Y=Math.min;const X=function(e,t,a){var o,n,i,r,s,l,u=0,d=!1,c=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var a=o,i=n;return o=n=void 0,u=t,r=e.apply(i,a)}function h(e){var a=e-l;return void 0===l||a>=t||a<0||c&&e-u>=i}function v(){var e=x();if(h(e))return p(e);s=setTimeout(v,function(e){var a=t-(e-l);return c?Y(a,i-(e-u)):a}(e))}function p(e){return s=void 0,f&&o?m(e):(o=n=void 0,r)}function g(){var e=x(),a=h(e);if(o=arguments,n=this,l=e,a){if(void 0===s)return function(e){return u=e,s=setTimeout(v,t),d?m(e):r}(l);if(c)return clearTimeout(s),s=setTimeout(v,t),m(l)}return void 0===s&&(s=setTimeout(v,t)),r}return t=H(t)||0,b(a)&&(d=!!a.leading,i=(c="maxWait"in a)?Q(H(a.maxWait)||0,t):i,f="trailing"in a?!!a.trailing:f),g.cancel=function(){void 0!==s&&clearTimeout(s),u=0,o=l=n=s=void 0},g.flush=function(){return void 0===s?r:p(x())},g};const ee=t.React.forwardRef((i,r)=>{const[s,l]=t.React.useState({}),[u,d]=t.React.useState(!1),[c,f]=t.React.useState(!0),[m,h]=t.React.useState(),v=t.hooks.useTranslation(o),{widgetId:p,referentItem:g,isDataSourceReady:y,resultConfig:w,onSubmit:S,onValidationChanged:R,intl:N,reset:k}=i,b=t.React.useRef(null),F=t.React.useRef(e=>{}),D=t.React.useMemo(()=>(e=>{if(!e)return(0,t.Immutable)({});switch(e.layerType){case a.LrsLayerType.Event:return e.eventInfo.referentProperties;case a.LrsLayerType.Intersection:return e.intersectionInfo.referentProperties;case a.LrsLayerType.CalibrationPoint:return e.calibrationPointInfo.referentProperties;case a.LrsLayerType.Addressing:return e.addressingInfo.referentProperties;case a.LrsLayerType.NonLrs:return e.nonLrsInfo.referentProperties;default:return(0,t.Immutable)({})}})(g),[g]);(0,I.useImperativeHandle)(r,()=>({submitForm:oe}));const M=t.React.useMemo(()=>y&&c&&u,[y,c,u]);t.React.useEffect(()=>{W()},[k]),t.React.useEffect(()=>{R(M)},[M,R]);const x=t.React.useRef(null),L=t.React.useRef(null),j=t.React.useRef(null),C=t.React.useRef(null),O=t.React.useRef(null),T=t.React.useRef(!1),P=t.React.useRef(!1),[E,A]=t.React.useState(null),[G,z]=t.React.useState(null),[V,_]=t.React.useState(!1),[B,$]=t.React.useState([]);t.React.useEffect(()=>{W(),F.current=X(U,400)},[g]);const W=()=>{A(null),z(null),setTimeout(()=>{L.current&&(L.current.select(),(0,t.focusElementInKeyboardMode)(L.current,!0),L.current.blur()),j.current&&(j.current.select(),(0,t.focusElementInKeyboardMode)(j.current,!0),j.current.blur())},200)},U=t.hooks.useEventCallback(e=>{const t=null==g?void 0:g.displayField,o=m,n=(0,a.getSuggestions)(t,e,o);Promise.all([n]).then(e=>{const t=null==e?void 0:e[0];t&&$(t),x.current&&_(!0)})}),J=e=>{A(e),x.current=e},q=()=>{(0,t.focusElementInKeyboardMode)(L.current),Z(!0,!1)},Z=(e=!1,t=!0)=>{e||(P.current=!1)},K=e=>{if(isNaN(Number(e))){const t=function(e){if(null!=e&&/^-?\d+\+\d{2}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),a=e.split("+");let o=100*parseInt(a[0],10);return isNaN(o)?o=NaN:2===a.length&&(t?o-=parseFloat(a[1]):o+=parseFloat(a[1])),o}if(null!=e&&/^-?\d+\+\d{3}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),a=e.split("+");let o=1e3*parseInt(a[0],10);return isNaN(o)?o=NaN:2===a.length&&(t?o-=parseFloat(a[1]):o+=parseFloat(a[1])),o}return NaN}(e);return isNaN(t)?(Q(NaN,!1),{valid:!1,msg:v("invalidOffset")}):(Q(t,!0),{valid:!0})}return Q(Number(""===e?NaN:e),!0),{valid:!0}},H=e=>e?new Promise(t=>{setTimeout(()=>{var o,n;const i=[];O.current&&(e=O.current);const r=m,s={},l=te(null==g?void 0:g.displayField),u=ae(e);u&&(e=u),"NUMBER"===l?s.where=`${null==g?void 0:g.displayField} = ${e}`:"STRING"===l&&(s.where=`${null==g?void 0:g.displayField} = '${e}'`),s.outFields=[r.getIdField()],(0,a.isDefined)(null===(o=null==g?void 0:g.eventInfo)||void 0===o?void 0:o.fromDateFieldName)&&s.outFields.push(null===(n=null==g?void 0:g.eventInfo)||void 0===n?void 0:n.fromDateFieldName);const d=r.query(s).then(e=>{var t;const a=null==e?void 0:e.records,o=[],n=r.getIdField(),s=null===(t=null==g?void 0:g.eventInfo)||void 0===t?void 0:t.fromDateFieldName;return(null==a?void 0:a.length)>0&&a.forEach(e=>{const t=null==e?void 0:e.getFieldValue(n);o.push(t)}),(null==a?void 0:a.length)>0&&(a.forEach(e=>{const t=null==e?void 0:e.getFieldValue(n),a=null==e?void 0:e.getFieldValue(s);i[t]=a}),ee(i)),(null==o?void 0:o.length)>0?(Y(o,!0),{valid:!0}):(Y(o,!1),{valid:!1,msg:v("invalidReferent")})}).catch(e=>(console.error(e),{valid:!1,msg:v("invalidReferent")}));t(d)},200)}):(d(!1),{valid:!0}),Q=(e,t)=>{const a=s;a.offset=e,f(t),l(a)},Y=(e,t)=>{const a=s;a.objectId=e,d(t),l(a)},ee=e=>{const t=s;t.objectIdFromDt=e,l(t)},te=e=>{const t=null==D?void 0:D.layerFields;for(let a=0;a<t.length;a++)if(t[a].name===e)return t[a].type},ae=e=>{var a;const o=t.DataSourceManager.getInstance().getDataSource(null==g?void 0:g.useDataSource.dataSourceId),n=null===(a=null==o?void 0:o.getLayerDefinition())||void 0===a?void 0:a.fields;let i,r=[];return(null==n?void 0:n.length)>0&&n.forEach(e=>{var t,a;(null==e?void 0:e.name)===(null==g?void 0:g.displayField)&&"codedValue"===(null===(t=null==e?void 0:e.domain)||void 0===t?void 0:t.type)&&(r=null===(a=null==e?void 0:e.domain)||void 0===a?void 0:a.codedValues)}),(null==r?void 0:r.length)>0&&r.forEach(t=>{t.name===e&&(i=t.code)}),i||null},oe=()=>{(()=>{const e=G||0,t=E;setTimeout(()=>{K(e),setTimeout(()=>{H(t),setTimeout(()=>{const e=[],t=null==s?void 0:s.objectId,a=null==g?void 0:g.serviceId,o=(null==s?void 0:s.offset)||0,n=null==s?void 0:s.objectIdFromDt;null==t||t.forEach(t=>{e.push({layerId:a,offset:o,objectId:t})}),S(e,n)},200)},200)},200)})()},ne=(0,a.GetUnits)(null==w?void 0:w.defaultOffsetUnit,N),ie=v("offsetlabel",{unit:ne}),re=v("referentDisplayName",{displayName:null==g?void 0:g.displayField});return(0,e.jsx)("div",{className:"search-method-form h-100",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-referent-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `,children:(0,e.jsxs)("div",{className:"search-by-referent-form__content",children:[(0,e.jsx)(t.DataSourceComponent,{useDataSource:null==g?void 0:g.useDataSource,onDataSourceCreated:e=>{h(e)}}),(0,e.jsxs)("div",{className:"search-method-form__method-label px-3 pt-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-1 title3",centric:!0,children:re}),(0,e.jsxs)("div",{ref:b,children:[(0,e.jsx)(n.TextInput,{"aria-label":re,size:"sm",type:"text",style:{width:"100%"},ref:L,allowClear:!!E,value:E||"",onChange:e=>{var t;O.current=null;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=(null==a?void 0:a.length)>2;if(J(a),!o)return _(!1),!1;F.current(a)},onBlur:()=>{C.current=setTimeout(()=>{T.current||_(!1),P.current||Z(!1)},200)},disabled:!y,checkValidityOnAccept:e=>H(e)}),E&&(0,e.jsx)(a.Intellisense,{isOpen:(V||(T.current=!1),V),reference:b,searchText:E,searchSuggestion:B,onRecordItemClick:(e,t)=>{if(t)return q(),!1;O.current=e,J(e)},id:p,searchInputRef:L})]})]}),(0,e.jsxs)("div",{className:"search-method-form__method-label px-3 pt-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-1 w-100 title3",children:ie}),(0,e.jsx)(n.TextInput,{"aria-label":ie,size:"sm",type:"text",style:{width:"100%"},ref:j,allowClear:G,value:G||"",onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;z(a)},disabled:!y,checkValidityOnAccept:e=>K(e)})]})]})})});var te=function(e,t,a,o){return new(a||(a=Promise))(function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,s)}l((o=o.apply(e,t||[])).next())})};const ae=t.React.forwardRef((i,r)=>{const{reset:s,isDataSourceReady:l,onSubmit:u,lrsLayer:d,onValidationChanged:c,coordinateGraphic:f}=i,[m,h]=t.React.useState({}),[v,p]=t.React.useState(!1),[g,y]=t.React.useState(!1),[w,S]=t.React.useState(!0),[R,N]=t.React.useState(null),[k,b]=t.React.useState(null),[F,D]=t.React.useState(null),M=t.React.useRef(null),x=t.React.useRef(null),L=t.React.useRef(null),j=t.hooks.useTranslation(o);(0,I.useImperativeHandle)(r,()=>({submitForm:C}));const C=()=>{u(m)},O=t.React.useMemo(()=>v&&g&&w,[v,g,w]);t.React.useEffect(()=>{c(O)},[O,c]),t.React.useEffect(()=>{N(""),b(""),D("");h({xCoordinate:NaN,yCoordinate:NaN,zCoordinate:NaN})},[d,s]),t.React.useEffect(()=>{setTimeout(()=>{M.current.select(),(0,t.focusElementInKeyboardMode)(M.current,!0),M.current.blur(),x.current.select(),(0,t.focusElementInKeyboardMode)(x.current,!0),x.current.blur(),L.current.select(),(0,t.focusElementInKeyboardMode)(L.current,!0),L.current.blur()},200)},[s]);const T=(e,o)=>{if(isNaN(Number(e)))return A(NaN,!1,o),E(),{valid:!1,msg:j("invalidCoordinate")};""===e?A(Number(NaN),o===a.Coordinate.Z,o):A(Number(e),!0,o);let n=null,i=null;return(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then(e=>{[n,i]=e}).then(()=>te(void 0,void 0,void 0,function*(){const e=new n;e.x=Number(R),e.y=Number(k),e.z=F?Number(F):0,d.networkInfo.defaultSpatialReferenceFrom===a.SpatialReferenceFrom.Map?e.spatialReference=new i({wkid:102100}):e.spatialReference=new i({wkid:d.networkInfo.spatialReferenceInfo.wkid,wkt:d.networkInfo.spatialReferenceInfo.wkt}),P(yield(0,a.getGeometryGraphic)(yield(0,a.getSimplePointGraphic)(e),a.coordinateGraphicColor))})),{valid:!0}},P=e=>{(0,a.isDefined)(e)?(0,a.isDefined)(f)&&(f.removeAll(),f.add(e)):E()},E=()=>{(0,a.isDefined)(f)&&f.removeAll()},A=(e,t,o)=>{const n=m;switch(o){case a.Coordinate.X:n.xCoordinate=e,p(t);break;case a.Coordinate.Y:n.yCoordinate=e,y(t);break;case a.Coordinate.Z:n.zCoordinate=e,S(t)}h(n)},G=(e,t)=>{var o;const n=null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.value;switch(t){case a.Coordinate.X:N(n);break;case a.Coordinate.Y:b(n);break;case a.Coordinate.Z:D(n)}};return(0,e.jsx)("div",{className:"search-by-coordinates-form",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-coordinates-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `,children:(0,e.jsxs)("div",{className:"search-by-coordinates-form__content my-2",children:[(0,e.jsxs)("div",{className:"search-by-coordinates-form__x-coordinate-label pt-2 px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-1 title3",style:{width:"100%"},children:j("xCoordinateRequiredLabel")}),(0,e.jsx)(n.TextInput,{"aria-label":j("xCoordinateRequiredLabel"),type:"text",size:"sm",style:{width:"100%"},ref:M,disabled:!l,allowClear:!!R,value:R||"",onChange:e=>{G(e,a.Coordinate.X)},checkValidityOnAccept:e=>T(e,a.Coordinate.X)})]}),(0,e.jsxs)("div",{className:"search-by-coordinates-form__y-coordinate-label pt-2 px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-1 title3",style:{width:"100%"},children:j("yCoordinateRequiredLabel")}),(0,e.jsx)(n.TextInput,{"aria-label":j("yCoordinateRequiredLabel"),type:"text",size:"sm",style:{width:"100%"},ref:x,disabled:!l,allowClear:!!k,value:k||"",onChange:e=>{G(e,a.Coordinate.Y)},checkValidityOnAccept:e=>T(e,a.Coordinate.Y)})]}),(0,e.jsxs)("div",{className:"search-by-coordinates-form__z-coordinate-label pt-2 px-3",children:[(0,e.jsx)(n.Label,{size:"default",className:"mb-1 title3",style:{width:"100%"},children:j("zCoordinateLabel")}),(0,e.jsx)(n.TextInput,{"aria-label":j("zCoordinateLabel"),type:"text",size:"sm",style:{width:"100%"},ref:L,disabled:!l,allowClear:!!F,value:F||"",onChange:e=>{G(e,a.Coordinate.Z)},checkValidityOnAccept:e=>T(e,a.Coordinate.Z)})]})]})})});var oe=f(23001),ne=f.n(oe),ie=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a};const re=a=>{const o=window.SVG,{className:n}=a,i=ie(a,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",n);return o?(0,e.jsx)(o,Object.assign({className:r,src:ne()},i)):(0,e.jsx)("svg",Object.assign({className:r},i))};var se=f(35737),le=f.n(se),ue=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a};const de=a=>{const o=window.SVG,{className:n}=a,i=ue(a,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",n);return o?(0,e.jsx)(o,Object.assign({className:r,src:le()},i)):(0,e.jsx)("svg",Object.assign({className:r},i))},ce=t.css`
  border: 1px solid var(--sys-color-surface-background);
  .esri-widget__heading {
    font-size: 0.875rem !important;
    font-weight: 500 !important;
    margin: 0;
    color: var(--sys-color-surface-paper-text);
  }

  .esri-feature__content-element {
    padding: 0;
  }

  .jimu-btn.expanded {
    align-self: flex-start;
  }

  .esri-feature.esri-widget {
    background-color: transparent;
  }
`;class fe extends t.React.PureComponent{constructor(e){super(e),this.toggleExpanded=e=>{e.stopPropagation(),this.setState({showContent:!this.state.showContent})};const{expanded:t=!1}=this.props;this.state={showContent:t}}componentDidMount(){this.createFeature()}componentDidUpdate(){this.feature&&(this.feature.graphic.popupTemplate=this.props.popupTemplate,this.feature.visibleElements=this.getVisibleElements())}destoryFeature(){this.feature&&!this.feature.destroyed&&this.feature.destroy()}getVisibleElements(){const{togglable:e=!1}=this.props,{showContent:t}=this.state,a=!e||t;return{title:!0,content:{fields:a,text:a},lastEditedInfo:!1}}createFeature(){let e;return e=this.Feature?Promise.resolve():(0,s.loadArcGISJSAPIModules)(["esri/widgets/Feature"]).then(e=>{[this.Feature]=e}),e.then(()=>{var e,t,a;const o=document&&document.createElement("div");o.className="jimu-widget",this.refs.featureContainer.appendChild(o);const n=this.props.dataSource.getOriginDataSources(),i=null===(e=null==n?void 0:n[0])||void 0===e?void 0:e.getRootDataSource();this.destoryFeature(),this.props.graphic.popupTemplate=this.props.popupTemplate,this.feature=new this.Feature({container:o,defaultPopupTemplateEnabled:!0,spatialReference:(null===(a=null===(t=this.props.dataSource)||void 0===t?void 0:t.layer)||void 0===a?void 0:a.spatialReference)||null,map:(null==i?void 0:i.map)||null,graphic:this.props.graphic,visibleElements:this.getVisibleElements()})})}render(){const{togglable:a=!1,intl:o}=this.props,{showContent:i}=this.state;return(0,e.jsxs)("div",{className:"item-feature-info-component d-flex align-items-center p-2",css:ce,children:[a&&(0,e.jsx)(n.Button,{"aria-label":o.formatMessage({id:i?"collapse":"expand"}),className:(0,t.classNames)("p-0 jimu-outline-inside",{expanded:i}),type:"tertiary",icon:!0,size:"sm",onClick:this.toggleExpanded,children:i?(0,e.jsx)(de,{size:"s"}):(0,e.jsx)(re,{size:"s",autoFlip:!0})}),(0,e.jsx)("div",{className:"flex-grow-1",ref:e=>{this.refs.featureContainer=e}})]})}}const me=(0,t.injectIntl)(fe);var he=f(22089),ve=1/0;const pe=function(e){return e?(e=H(e))===ve||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const ge=function(e){var t=pe(e),a=t%1;return t==t?a?t-a:t:0};const ye=function(e,t){for(var a=-1,o=null==e?0:e.length,n=Array(o);++a<o;)n[a]=t(e[a],a,e);return n};const Ie=Array.isArray;var we=T?T.prototype:void 0,Se=we?we.toString:void 0;const Re=function e(t){if("string"==typeof t)return t;if(Ie(t))return ye(t,e)+"";if(U(t))return Se?Se.call(t):"";var a=t+"";return"0"==a&&1/t==-1/0?"-0":a};const Ne=function(e){return null==e?"":Re(e)};var ke=M.isFinite,be=Math.min;const Fe=function(e){var t=Math[e];return function(e,a){if(e=H(e),(a=null==a?0:be(ge(a),292))&&ke(e)){var o=(Ne(e)+"e").split("e"),n=t(o[0]+"e"+(+o[1]+a));return+((o=(Ne(n)+"e").split("e"))[0]+"e"+(+o[1]-a))}return t(e)}}("round");var De=function(e,t,a,o){return new(a||(a=Promise))(function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,s)}l((o=o.apply(e,t||[])).next())})};function Me(e,o,n,i){return De(this,void 0,void 0,function*(){var r,s,l,u;const d=[];let c="";if((null==n?void 0:n.lineName)||(null==n?void 0:n.lineId)?((null===(r=n.lineName)||void 0===r?void 0:r.length)>0?c=`LOWER(${o.networkInfo.lineNameFieldSchema.jimuName}) LIKE LOWER('${n.lineName}')`:(null===(s=null==n?void 0:n.lineId)||void 0===s?void 0:s.length)>0&&(c=`LOWER(${o.networkInfo.lineIdFieldSchema.jimuName}) LIKE LOWER('${n.lineId}')`),n.routeId.length>0?c+=` AND LOWER(${o.networkInfo.routeIdFieldSchema.jimuName}) LIKE LOWER('${n.routeId}')`:n.routeName.length>0?c+=` AND LOWER(${o.networkInfo.routeNameFieldSchema.jimuName}) LIKE LOWER('${n.routeName}')`:n.routeIdFields.forEach((e,a)=>{e&&(o.networkInfo.routeIdFields[a].field.type===t.JimuFieldType.Number?(c.length>0&&(c+=" AND "),c+=`${o.networkInfo.routeIdFields[a].field.name} LIKE ${n.routeIdFields[a]}`):e.length>0&&(c.length>0&&(c+=" AND "),c+=`LOWER(${o.networkInfo.routeIdFields[a].field.name}) LIKE LOWER('${n.routeIdFields[a]}')`))})):n.routeId.length>0?c=`LOWER(${o.networkInfo.routeIdFieldSchema.jimuName}) LIKE LOWER('${n.routeId}')`:n.routeName.length>0?c=`LOWER(${o.networkInfo.routeNameFieldSchema.jimuName}) LIKE LOWER('${n.routeName}')`:n.routeIdFields.forEach((e,a)=>{e&&(o.networkInfo.routeIdFields[a].field.type===t.JimuFieldType.Number?(c.length>0&&(c+=" AND "),c+=`${o.networkInfo.routeIdFields[a].field.name} LIKE ${n.routeIdFields[a]}`):e.length>0&&(c.length>0&&(c+=" AND "),c+=`LOWER(${o.networkInfo.routeIdFields[a].field.name}) LIKE LOWER('${n.routeIdFields[a]}')`))}),(0,a.isDefined)(e&&(0,a.isDefined)(e.layer)))return yield(0,t.loadArcGISJSAPIModules)(["esri/time/TimeExtent"]).then(t=>{var n,r;let s=null;s=t[0];const l=e.layer.createQuery();l.spatialRelationship="intersects",l.outSpatialReference=i.view.spatialReference,l.returnGeometry=!0,l.outFields=["*"],l.returnM=!0,l.returnZ=!0,l.where=c,l.orderByFields=[];const u=null===(r=null===(n=o.networkInfo)||void 0===n?void 0:n.sortOptions)||void 0===r?void 0:r.filter(e=>(0,a.isDefined)(e.jimuFieldName));(null==u?void 0:u.length)>0&&Object.assign(l.orderByFields,o.networkInfo.sortOptions.map(e=>`${e.jimuFieldName} ${e.order}`));const f=e.getCurrentQueryParams();return(null==f?void 0:f.time)&&(l.timeExtent=new s({start:f.time[0],end:f.time[1]})),e.layer.queryFeatures(l).then(t=>{var a;return(null===(a=t.features)||void 0===a?void 0:a.length)>0?t.features.map(t=>e.buildRecord(t)):d}).catch(e=>d)});{const t=e.getCurrentQueryParams(),n={returnGeometry:!0,returnM:!0,returnZ:!0,where:c,time:null==t?void 0:t.time,outFields:["*"],notAddFieldsToClient:!0},i=null===(u=null===(l=o.networkInfo)||void 0===l?void 0:l.sortOptions)||void 0===u?void 0:u.filter(e=>(0,a.isDefined)(e.jimuFieldName));return(null==i?void 0:i.length)>0&&Object.assign(n,{orderByFields:o.networkInfo.sortOptions.map(e=>`${e.jimuFieldName} ${e.order}`)}),e.query(n).then(e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:d}).catch(e=>d)}})}function xe(e,o,n,i,r,s,l,u,d){return De(this,void 0,void 0,function*(){return new Promise((c,f)=>{try{const f=l.routeIdFieldName,m=l.routeNameFieldName,h=l.fromDateFieldName,v=[];if(!o||!o.layer)return void c(null);const p=o.layer.createQuery();p.geometry=e,p.units="meters",p.spatialRelationship="intersects",p.outFields=[f,m,h],p.timeExtent=new r({start:n,end:i});let g=0;o.layer.queryFeatures(p).then(o=>De(this,void 0,void 0,function*(){const n=[],i=[];o.features.forEach(t=>{const a=t.attributes[f],o=t.attributes[m],r=s.getData()[d],l=t.attributes[h];n.includes(a)||r!==a||(l>g&&(g=l),v[a]=o,n.push(a),i.push({routeId:a,geometry:e}))});const r=e.spatialReference.wkid;if(!i||0===i.length)return void c(null);const p=yield function(e,o,n,i,r){return De(this,void 0,void 0,function*(){const s=o.networkInfo.networkUrl,l={f:"json",token:yield t.SessionManager.getInstance().getSessionByUrl(s).getToken(s),locations:e,inSR:i,gdbVersion:n,temporalViewDate:(0,a.isDefined)(r)&&0!==r.valueOf()?r:""};n&&(l.gdbVersion=n),r&&(l.temporalViewDate=r);const u=`${s}/geometryToMeasure`;return yield(0,a.requestService)({method:"POST",url:u,params:l})})}(i,l,u,r,g),y=p.locations;y&&0!==y.length||c(null),y.forEach(e=>{const t=e.status;if("esriLocatingOK"===t||"esriLocatingMultipleLocation"===t){e.results.forEach(e=>{const t={routeId:e.routeId,routeName:v[e.routeId],measure:e.measure};return c(t),t})}}),c(null)}))}catch(e){console.error(e)}})})}function Le(e,o,n,i,r){return De(this,void 0,void 0,function*(){const s=o.networkInfo.networkUrl,l={f:"json",token:yield t.SessionManager.getInstance().getSessionByUrl(s).getToken(s),locations:e,offsetUnit:n};i&&(l.gdbVersion=i),r&&(l.temporalViewDate=r);const u=`${s}/referentToGeometry`;return yield(0,a.requestService)({method:"POST",url:u,params:l})})}function je(e,t){var o,n;const i=e.getData(),r=i[t.fromDateFieldName],s=i[t.toDateFieldName]||null,l=(null===(o=new Date(i[a.toRouteField.at(3).value]))||void 0===o?void 0:o.getTime())||null,u=(null===(n=new Date(i[a.toRouteField.at(4).value]))||void 0===n?void 0:n.getTime())||null;return r<=l&&(l<s||null===s)||l<=r&&(r<u||null===u)}function Ce(e,o,n,i,r,s,l,u,d,c,f,m){return De(this,void 0,void 0,function*(){const l=[],m=i.getOriginDataSources()[0],h=yield Oe(m);let v=null,p=null;return(0,t.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/Graphic"]).then(e=>{[v,p]=e}).then(()=>De(this,void 0,void 0,function*(){return yield Promise.all(n.map((e,t)=>De(this,void 0,void 0,function*(){var n,m;const h=e.getData(),g=e.getGeometry(),y=new v(g),I=y.getPoint(0,0),w=y.paths[y.paths.length-1].length-1,S=y.getPoint(y.paths.length-1,w);h[a.measureFields.at(0).value]=Fe(I.m,r),h[a.measureFields.at(1).value]=Fe(S.m,r),h[a.networkObjectIdField.value]=e.getId(),h.OBJECTID=t+1;const R=h[o.networkInfo.fromDateFieldName],N=h[o.networkInfo.toDateFieldName],k=o.networkInfo.lineIdFieldName;if((0,a.isDefined)(d)){const t=yield xe(I,c,R,N,u,e,d,f,k),o=yield xe(S,c,R,N,u,e,d,f,k);t&&(h[a.derivedFields.at(0).value]=t.routeName,h[a.derivedFields.at(1).value]=t.routeId,h[a.derivedFields.at(2).value]=Fe(t.measure,r)),o&&(h[a.derivedFields.at(3).value]=Fe(o.measure,r))}N&&(h[o.networkInfo.toDateFieldName]=null===(n=(0,a.getDateWithTZOffset)(N,i.getOriginDataSources()[0]))||void 0===n?void 0:n.valueOf()),R&&(h[o.networkInfo.fromDateFieldName]=null===(m=(0,a.getDateWithTZOffset)(R,i.getOriginDataSources()[0]))||void 0===m?void 0:m.valueOf());const b=new p({geometry:y,attributes:h});if((0,a.isDefined)(s)){const e=yield(0,a.getPolylineMidPoint)(y),t=new p({geometry:e,attributes:h});yield s.applyEdits({addFeatures:[t.clone()]})}const F=i.buildRecord(b);l.push(F)}))),l.forEach(e=>{const t=e.feature;t.sourceLayer=h.associatedLayer||h,t.layer=t.sourceLayer}),i.setSourceRecords(l),i.setStatus(t.DataSourceStatus.Unloaded),i.setCountStatus(t.DataSourceStatus.Unloaded),Te(i,e),yield Pe(i,l,o)}))})}function Oe(e){return De(this,void 0,void 0,function*(){if(null==e?void 0:e.layer)return yield e.layer.load(),e.layer;{const t=yield e.createJSAPILayerByDataSource();return yield t.load(),t}})}function Te(e,a){if(!e)return;const o=e.getOriginDataSources()[0],n=o.getPopupInfo(),i=o.getLayerDefinition(),r=(e=>{return e.length?e:[{fieldName:null!==(t=null==i?void 0:i.objectIdField)&&void 0!==t?t:"objectid",label:"OBJECTID",tooltip:"",visible:!0}];var t})(((null==n?void 0:n.fieldInfos)||[]).filter(e=>e.visible)),s=new t.DataRecordSetChangeMessage(a,t.RecordSetChangeType.CreateUpdate,[{records:e.getRecords(),fields:r.map(e=>e.fieldName),dataSource:e,name:e.id}]);t.MessageManager.getInstance().publishMessage(s)}const Pe=(e,t,o)=>De(void 0,void 0,void 0,function*(){var n,i;const r={returnGeometry:!0,where:"1=1",outFields:["*"],notAddFieldsToClient:!0},s=null===(i=null===(n=o.networkInfo)||void 0===n?void 0:n.sortOptions)||void 0===i?void 0:i.filter(e=>(0,a.isDefined)(e.jimuFieldName));return(null==s?void 0:s.length)>0?(Object.assign(r,{orderByFields:o.networkInfo.sortOptions.map(e=>`${e.jimuFieldName} ${e.order}`)}),yield e.query(r).then(e=>{var a;return(null===(a=e.records)||void 0===a?void 0:a.length)>0?e.records:t}).catch(e=>t)):t});function Ee(e,t){const a={};t.allFieldsDetails.forEach(e=>{a[e.jimuName]=e.alias});return Object.keys(e).forEach(t=>{const o=a[t];e[o]=e[t],delete e.key}),e}const Ae=t.css`
  overflow: auto;
  flex-flow: row;
  cursor: pointer;
  flex-shrink: 0;
  min-height: 2rem;
  &.selected {
    .item-feature-info-component {
      border-color: var(--sys-color-primary-main);
      border-width: 2px;
    }
  }
`,Ge=t.React.memo(o=>{const{lrsLayers:n,measureType:i,widgetId:r,autoSelect:l,lrsLayer:u,data:d,outputDS:c,inputDS:f,highlightGraphicLayer:m,flashGraphicsLayer:h,highlightStyle:v,jimuMapView:p,intl:g,selectedMethod:y}=o,I=t.ReactRedux.useSelector(e=>{var t,a,o;return null===(o=null===(a=null===(t=e.dataSourcesInfo)||void 0===t?void 0:t[c.id])||void 0===a?void 0:a.selectedIds)||void 0===o?void 0:o.includes(d.getId())}),w=t.React.useMemo(()=>S(g,d.feature,c,u,y,i,n),[g,d.feature,c,u,y,i,n]);t.React.useEffect(()=>{l&&F()},[l]);const R=t.React.useCallback(e=>{const t=e;(0,a.getGeometryGraphic)(null==t?void 0:t.getFeature(),"#FFFF00",v.size,!0).then(e=>{h&&e&&(h.removeAll(),h.add(e),setTimeout(()=>{h.removeAll(),setTimeout(()=>{h.add(e),setTimeout(()=>{h.removeAll()},800)},800)},800))})},[h,v.size]),N=t.React.useCallback(e=>{s.geometryUtils.projectToSpatialReference([e.geometry],p.view.spatialReference).then(t=>{const a=new he.default({geometry:t[0],symbol:e.symbol});"point"===a.geometry.type?null==p||p.view.goTo({target:t,zoom:100}):null==p||p.view.goTo({center:a.geometry.extent.expand(1.25)})})},[p.view]),k=t.React.useCallback(e=>{(function(e,t,o,n){return De(this,void 0,void 0,function*(){const i=e.getFieldValue(o.networkInfo.routeIdFieldSchema.name),r=`${o.networkInfo.routeIdFieldSchema.name} = '${i}'`;if((0,a.isDefined)(t&&(0,a.isDefined)(t.layer))){const o=t.layer.createQuery();o.spatialRelationship="intersects",o.outSpatialReference=n.view.spatialReference,o.returnGeometry=!0,o.outFields=["*"],o.returnM=!0,o.returnZ=!0,o.where=r;const i=e.getFieldValue(a.networkObjectIdField.value);return t.layer.queryFeatures(o).then(e=>{var a;return(null===(a=e.features)||void 0===a?void 0:a.length)>0?e.features.map(e=>t.buildRecord(e)).find(e=>e.getId()===i):null}).catch(e=>null)}{const o={returnGeometry:!0,returnM:!0,returnZ:!0,where:r,spatialRel:"esriSpatialRelIntersects"},n=e.getFieldValue(a.networkObjectIdField.value);return t.query(o).then(e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records.find(e=>e.getId()===n):null}).catch(e=>null)}})})(e,f,u,p).then(t=>{(0,a.isDefined)(t)&&R(t);const o=e;(0,a.getGeometryGraphic)(null==o?void 0:o.getFeature(),v.color,v.size,!0).then(e=>{m&&e&&(m.removeAll(),m.add(e),N(e))})})},[R,m,v.color,v.size,f,p,u,N]),b=t.React.useCallback(()=>{m&&m.removeAll()},[m]),F=t.React.useCallback(()=>{var e,a;const o=c.id,n=d.getId(),i=(null!==(e=c.getSelectedRecordIds())&&void 0!==e?e:[]).includes(n)?[]:[d];o&&(null==i?void 0:i.length)>0?(t.MessageManager.getInstance().publishMessage(new t.DataRecordsSelectionChangeMessage(r,i,[o])),null===(a=c.selectRecordsByIds)||void 0===a||a.call(c,i.map(e=>e.getId())),k(d)):b()},[d,c,r,k,b]);return(0,e.jsx)("div",{className:(0,t.classNames)("search-by-route-result-item",{selected:I}),onClick:F,css:Ae,role:"option","aria-selected":I,tabIndex:0,children:(0,e.jsx)(me,{graphic:d.feature,togglable:!0,dataSource:c,popupTemplate:w,expanded:u.networkInfo.expandByDefault,selectedMethod:y})})});var ze,Ve=f(1888);!function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(ze||(ze={}));(0,Ve.withTheme)(a=>{const{theme:o,className:n,title:i,statusType:r}=a;return r&&(0,e.jsx)("div",{className:`${null!=n?n:""} ui-unit-status-indicator ui-unit-status-indicator_status-type-${r}`,title:i,css:t.css`
    &.ui-unit-status-indicator {
      display: flex;
      &.ui-unit-status-indicator_status-type-loading {
        &:before {
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          content: '';
          width: 1rem;
          height: 1rem;
          display: block;
          border: 1px solid ${null===(l=null===(s=null==o?void 0:o.ref.palette)||void 0===s?void 0:s.neutral)||void 0===l?void 0:l[500]};
          border-radius: 50%;
          border-top: 1px solid ${null===(d=null===(u=null==o?void 0:o.sys.color)||void 0===u?void 0:u.primary)||void 0===d?void 0:d.main};
          box-sizing: border-box;
          animation: loading 2s infinite linear;
          margin-right: .25rem;
        }
      }
    }
  `});var s,l,u,d});const{useRef:_e,useState:Be}=t.React;function $e(a){const{lrsLayers:o,widgetId:i,lrsLayer:r,selectedMethod:s,outputDS:l,inputDS:u,resultCount:d,records:c,highlightGraphicsLayer:f,flashGraphicsLayer:m,highlightStyle:h,jimuMapView:v,onRenderDone:p,intl:g,measureType:y,defaultPageSize:I=25}=a,[w,S]=Be(c),[R,N]=Be(ze.Init),k=_e(1),b=_e(I),[F,D]=Be(I);t.React.useEffect(()=>{k.current=1,S(c),D(b.current)},[c]);const M=t.React.useCallback((e,t)=>{k.current=e,N(ze.Loading);const a=l.getRecordsByPage(e,t);S(a),null==p||p({dataItems:a,pageSize:t,page:k.current}),N(ze.Loaded)},[p,l]);return t.React.useEffect(()=>{I!==b.current&&(I<b.current?S(w.slice(0,I)):M(1,I),b.current=I,D(I))},[I,w,M]),(0,e.jsxs)("div",{className:"list",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .list_items {
      flex: 1 1 auto;
      max-height: auto;
      overflow: auto;
      display: flex;
      flex-direction: row;
    }

    .search-by-route-result-item + .search-by-route-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.list {
      .list_items {
        flex-direction: column;
      }
      .feature-info-component {
        width: 100%;
      }
      .search-by-route-result-item + .search-by-route-result-item {
        margin-top: 0.5rem;
        margin-left: 0;
      }
    }
  `,children:[(0,e.jsx)("div",{className:"list_items mb-2 px-3",role:"listbox",children:null==w?void 0:w.map((t,a)=>(0,e.jsx)(Ge,{lrsLayers:o,autoSelect:1===c.length,lrsLayer:r,data:t,outputDS:l,inputDS:u,widgetId:i,highlightGraphicLayer:f,flashGraphicsLayer:m,highlightStyle:h,jimuMapView:v,intl:g,selectedMethod:s,measureType:y},t.getId()+a))}),R===ze.Loading&&(0,e.jsx)(n.Loading,{type:n.LoadingType.Donut}),d>0&&(0,e.jsx)("div",{className:"d-flex justify-content-s align-items-center px-3 pb-3",style:{justifyContent:"space-evenly"},children:(0,e.jsx)(n.Pagination,{className:"d-flex justify-content-end",disabled:R===ze.Loading,current:k.current,totalPage:Math.ceil(d/F),onChangePage:e=>{M(e,F)},pageSize:F,showQuickJumper:Math.ceil(d/F)>1})})]})}var We=f(96300),Ue=f.n(We),Je=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a};const qe=a=>{const o=window.SVG,{className:n}=a,i=Je(a,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",n);return o?(0,e.jsx)(o,Object.assign({className:r,src:Ue()},i)):(0,e.jsx)("svg",Object.assign({className:r},i))};var Ze=f(59620);const Ke=t.css`
  display: flex;
  flex-direction: column;

  .search-by-route-result__header {
    color: var(--sys-color-surface-backgroundHint);
    font-weight: 500;
    font-size: 14px;
    line-height: 18px;
  }

  .search-by-route-result-container {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    overflow: auto
  }

  .search-by-route-result-info {
    height: 18px;
  }
`;function He(i){var r,s;const{lrsLayers:l,lrsLayer:u,selectedMethod:d,resultCount:c,maxPerPage:f,records:m,routeRecords:h,defaultPageSize:v,widgetId:p,outputDS:g,inputDS:y,isPoint:I,jimuMapView:w,highlightStyle:S,intl:R,measureType:N,onNavBack:k}=i,b=t.hooks.useTranslation(o),[F,D]=t.React.useState(null),[M,x]=t.React.useState([]),[L,j]=t.React.useState(null),[C,O]=t.React.useState(null),T=t.React.useRef(null),P=t.ReactRedux.useSelector(e=>{var t;return null===(t=e.appConfig.widgets[p].enableDataAction)||void 0===t||t}),E=t.React.useMemo(()=>{const e=null==g?void 0:g.getOriginDataSources()[0],t=null==e?void 0:e.getLayerDefinition();let o=!1;const n=[];return null==h||h.forEach(e=>{const i=e.clone();i.getFieldValue(a.networkObjectIdField.value)&&i.getFieldValue(a.networkObjectIdField.value).length>0&&(i.getData()[t.objectIdField]=i.getFieldValue(a.networkObjectIdField.value),o=!0),n.push(i)}),{dataSource:o?null==g?void 0:g.getOriginDataSources()[0]:g,type:(null==M?void 0:M.length)>0?"selected":"loaded",records:o?n:(null==M?void 0:M.length)>0?M:null==F?void 0:F.records,name:null==g?void 0:g.getLabel()}},[h,M,g,F]);t.hooks.useEffectOnce(()=>{(0,t.focusElementInKeyboardMode)(T.current)}),t.React.useEffect(()=>{var e,t;if(D({records:m,pageSize:v,page:1}),(!L||!C)&&w){const a=new Ze.default({listMode:"hide"}),o=new Ze.default({listMode:"hide"});null===(t=null===(e=null==w?void 0:w.view)||void 0===e?void 0:e.map)||void 0===t||t.addMany([a,o]),j(a),O(o)}},[m,v,null===(r=null==w?void 0:w.view)||void 0===r?void 0:r.map,L,C,w]);const A=t.React.useCallback(({dataItems:e,pageSize:t,page:a})=>{D({records:e,pageSize:t,page:a})},[]),G=t.React.useCallback(()=>{if(F){const e=(F.page-1)*F.pageSize+1,t=e+F.pageSize-1;return c>0?`${b("resultsDisplay")} ${e} - ${Math.min(t,c)} / ${c}`:`${b("resultsDisplay")}: 0 - 0 / 0`}return""},[F,c,b]),z=t.React.useCallback(e=>{"Escape"===e.key&&(e.stopPropagation(),(0,t.focusElementInKeyboardMode)(T.current))},[]),V=()=>{L&&(L.removeAll(),L.destroy(),j(null)),C&&(C.removeAll(),C.destroy(),O(null))},_=t.React.useMemo(()=>(0,t.Immutable)({dataSourceId:I?u.networkInfo.outputPointDsId:u.networkInfo.outputLineDsId,mainDataSourceId:I?u.networkInfo.outputPointDsId:u.networkInfo.outputLineDsId}),[u.networkInfo.outputLineDsId,u.networkInfo.outputPointDsId,I]),B=t.React.useCallback(()=>{var e;if(!(0,a.isDefined)(M,!1))return;const o=t.DataSourceManager.getInstance().getDataSource(null==g?void 0:g.id),n=null==o?void 0:o.getSelectedRecords(),i=null!==(e=null==o?void 0:o.getSelectedRecordIds())&&void 0!==e?e:[];let r=!1;r=i.length!==M.length||i.some(e=>null==M.find(t=>t.getId()===e)),r&&x(n)},[null==g?void 0:g.id,M]);return(0,e.jsxs)("div",{className:"search-by-route-result h-100 pt-3",onKeyUp:z,css:Ke,role:"listbox","aria-label":b("results"),children:[(0,e.jsx)(t.DataSourceComponent,{useDataSource:_,onDataSourceInfoChange:B}),(0,e.jsxs)("div",{className:"search-by-route-result__header d-flex align-items-center px-3",children:[(0,e.jsx)(n.Tooltip,{title:b("backLabel"),children:(0,e.jsx)(n.Button,{ref:T,className:"p-0 mr-2",size:"sm",type:"tertiary",icon:!0,onClick:()=>{V(),k(),D(null)},children:(0,e.jsx)(qe,{autoFlip:!0})})}),u.name,(null===(s=null==F?void 0:F.records)||void 0===s?void 0:s.length)>0&&P&&(0,e.jsx)(t.React.Fragment,{children:(0,e.jsx)("div",{className:"ml-auto",children:(0,e.jsx)(n.DataActionList,{widgetId:p,dataSets:[E],listStyle:n.DataActionListStyle.Dropdown,buttonSize:"sm",buttonType:"tertiary"})})})]}),(0,e.jsxs)("div",{className:"search-by-route-result-container mt-1",children:[(0,e.jsx)("div",{className:"search-by-route-result-info mb-2 px-3",role:"alert","aria-live":"polite",children:G()}),c>0&&(0,e.jsx)($e,{lrsLayers:l,widgetId:p,lrsLayer:u,selectedMethod:d,measureType:N,outputDS:g,inputDS:y,resultCount:c,maxPerPage:f,records:m,highlightGraphicsLayer:L,flashGraphicsLayer:C,highlightStyle:S,jimuMapView:w,onRenderDone:A,defaultPageSize:v,intl:R})]})]})}function Qe(a){const{lrsLayer:o,dataSourceReady:n,onCreateDs:i,onCreatePointDs:r,onCreateLineDs:s}=a,[l,u]=t.React.useState(null!=o?o:null);t.React.useEffect(()=>{o&&u(o)},[o]);const d=t.React.useMemo(()=>(0,t.Immutable)({dataSourceId:l.networkInfo.outputLineDsId,mainDataSourceId:l.networkInfo.outputLineDsId}),[l.networkInfo.outputLineDsId]),c=t.React.useMemo(()=>(0,t.Immutable)({dataSourceId:l.networkInfo.outputPointDsId,mainDataSourceId:l.networkInfo.outputPointDsId}),[l.networkInfo.outputPointDsId]),f=t.React.useCallback(e=>{i(e)},[i]),m=t.React.useCallback(e=>{if(e){const{status:a,instanceStatus:o}=e;o===t.DataSourceStatus.NotCreated||o===t.DataSourceStatus.CreateError||a===t.DataSourceStatus.LoadError||a===t.DataSourceStatus.NotReady?n(!1):n(!0)}},[n]),h=t.React.useCallback(()=>{n(!1)},[n]);return(0,e.jsxs)("div",{children:[(0,e.jsx)(t.DataSourceComponent,{useDataSource:d,onDataSourceCreated:e=>{s(e)}}),(0,e.jsx)(t.DataSourceComponent,{useDataSource:c,onDataSourceCreated:e=>{r(e)},onCreateDataSourceFailed:()=>{}}),(0,e.jsx)(t.DataSourceComponent,{useDataSource:l.useDataSource,onDataSourceInfoChange:m,onCreateDataSourceFailed:h,onDataSourceCreated:f})]})}const Ye=t.React.forwardRef((o,n)=>{const{widgetId:i,reset:r,lrsLayer:s,dataSource:l,isDataSourceReady:d,intl:f,hideRoute:m,onSubmit:h,onValidationChanged:v}=o,p=t.React.useMemo(()=>(null==s?void 0:s.networkInfo)||{},[s]),[g,w]=t.React.useState({}),[S,R]=t.React.useState(!1),[N,k]=t.React.useState(!0),[b,F]=t.React.useState(a.SearchMeasuresType.Single);(0,I.useImperativeHandle)(n,()=>({submitForm:D})),t.React.useEffect(()=>{var e;let t=a.SearchMeasuresType.Single;p.searchSingle?t=a.SearchMeasuresType.Single:p.searchMultiple?t=a.SearchMeasuresType.Multiple:p.searchRange&&(t=a.SearchMeasuresType.Range),F(t);const o={routeId:"",routeName:"",lineId:"",lineName:"",routeIdFields:new Array(null===(e=null==p?void 0:p.routeIdFields)||void 0===e?void 0:e.length).fill(""),measure:NaN,station:"",fromMeasure:NaN,fromStation:"",toMeasure:NaN,toStation:"",measures:[NaN],stations:[""],isPoint:!1,searchMeasureBy:t};w(o)},[p,r]);const D=()=>{const e=Object.assign({},g);e.isMeasureToGeometryOperation=!1,e.isPoint=!1,e.searchMeasureBy===a.SearchMeasuresType.Single?isNaN(e.measure)||(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):e.searchMeasureBy===a.SearchMeasuresType.Multiple?e.measures.some(e=>!isNaN(e))&&(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):(e.isPoint=!1,isNaN(e.fromMeasure)&&isNaN(e.toMeasure)||(isNaN(e.fromMeasure)&&!isNaN(e.toMeasure)&&(e.fromMeasure=e.toMeasure,e.toMeasure=NaN,e.isPoint=!0),!isNaN(e.fromMeasure)&&isNaN(e.toMeasure)&&(e.isPoint=!0),e.isMeasureToGeometryOperation=!0)),h(e)},M=t.React.useMemo(()=>d&&S&&N,[d,S,N]);t.React.useEffect(()=>{v(M)},[M,v]);const x=t.React.useCallback((e,t)=>{w(e)},[]),L=t.React.useCallback((e,t,o)=>{w(e),p.defaultLineIdentifier===a.LineIdentifiers.LineId&&""===e.lineId||p.defaultLineIdentifier===a.LineIdentifiers.LineName&&""===e.lineName?R(!1):R(t)},[p]),j=t.React.useCallback(e=>{const t=g;t.searchMeasureBy=e,w(t),F(e)},[g]),C=t.React.useCallback((e,t)=>{w(e),k(t)},[]);return(0,e.jsx)("div",{className:"search-by-measure-form",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-measure-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `,children:(0,e.jsxs)("div",{className:"search-by-measure-form__content pt-3",children:[(0,e.jsx)(u,{reset:r,intl:f,widgetId:i,lrsLayer:s,dataSource:l,routeAndMeasureRequest:g,isDataSourceReady:d,hideRoute:m,onChange:x,onAccept:L,type:"lineMeasure"}),(0,e.jsx)(c,{lrsLayer:s,searchMeasureBy:b,onChange:j}),(0,e.jsx)(y,{reset:r,intl:f,lrsLayer:s,dataSource:l,isDataSourceReady:d,searchMeasureBy:b,routeAndMeasureRequest:g,onChange:C})]})})});var Xe=function(e,t,a,o){return new(a||(a=Promise))(function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,s)}l((o=o.apply(e,t||[])).next())})};function et(i){var r,s,u;const d=t.hooks.useTranslation(o),{widgetId:c,jimuMapView:f,lrsLayers:m,highlightStyle:h,labelStyle:v,resultConfig:p,defaultNetwork:g,hideMethod:y,hideNetwork:I,hideRoute:S,intl:b,hideTitle:F,coordinateGraphic:D}=i,[M,x]=t.React.useState((0,t.Immutable)(null==m?void 0:m.find(e=>!(null==e?void 0:e.isReferent)))),[L,j]=t.React.useState((0,t.Immutable)(null==m?void 0:m.find(e=>null==e?void 0:e.isReferent))||null),[C,O]=t.React.useState(a.SearchMethod.Measure),[T,P]=t.React.useState(0),[E,A]=t.React.useState(0),[G,z]=t.React.useState(null),[V,_]=t.React.useState(null),[B,$]=t.React.useState(!1),[W,U]=t.React.useState(null),[J,q]=t.React.useState(!1),[Z,K]=t.React.useState(!1),[H,Q]=t.React.useState(!1),[Y,X]=t.React.useState(),[te,oe]=t.React.useState(""),[ne,ie]=t.React.useState(!1),[re,se]=t.React.useState(null),[le,ue]=t.React.useState(g),de=t.React.useRef(null),ce=t.React.useRef(null),fe=function(e){const{widgetId:a,useDataSourceId:o}=e;return t.ReactRedux.useSelector(e=>{var t;let n;return n=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(t=n.widgets[a].useDataSources)&&void 0!==t?t:[]).some(e=>e.dataSourceId===o)})}({widgetId:i.widgetId,useDataSourceId:null===(r=null==M?void 0:M.useDataSource)||void 0===r?void 0:r.dataSourceId}),me="search-by-route-layer-",[he,ve]=t.React.useState(!0),pe=t.React.useRef(null),ge=t.React.useRef(null),ye=t.React.useRef(null),Ie=t.React.useRef(null);t.React.useEffect(()=>{var e;if((null==m?void 0:m.length)>0){const a=null===(e=null==p?void 0:p.defaultReferentLayer)||void 0===e?void 0:e.id,o=m.find(e=>(null==e?void 0:e.id)===a);j((0,t.Immutable)(o));for(let e=0;e<m.length;e++){const t=m[e];if(!(null==t?void 0:t.isReferent)){x(t);break}}}},[]),t.React.useEffect(()=>{if(m){const e=m.find(e=>e.layerType===a.LrsLayerType.Network&&!e.networkInfo.isDerived);ue(e?e.name:"");const o=m.find(e=>e.isReferent);j(o?(0,t.Immutable)(o):null)}},[m]),t.React.useEffect(()=>{if(!m.find(e=>e.name===le)){const e=m.find(e=>e.layerType===a.LrsLayerType.Network&&!e.networkInfo.isDerived);ue(null==e?void 0:e.name)}},[le,m]),t.React.useEffect(()=>{Z&&(X("error"),oe(te),Q(!0),setTimeout(()=>{Q(!1),K(!1)},5e3))},[Z,d,te]),t.React.useEffect(()=>{var e;const o=m.find(e=>(null==e?void 0:e.name)===le&&!(null==e?void 0:e.isReferent));(0,a.isDefined)(o)&&(null===(e=null==o?void 0:o.networkInfo)||void 0===e?void 0:e.defaultMethod)&&(x((0,t.Immutable)(o)),o.networkInfo.defaultMethod!==a.SearchMethod.Referent||m.some(e=>e.isReferent)?O(o.networkInfo.defaultMethod):o.networkInfo.useMeasure?O(a.SearchMethod.Measure):o.networkInfo.useCoordinate?O(a.SearchMethod.Coordinate):O(a.SearchMethod.Referent))},[le,m]),t.React.useEffect(()=>{if((0,a.isDefined)(p.defaultReferentLayer)){const e=m.find(e=>e.name===p.defaultReferentLayer.name);(0,a.isDefined)(e)&&j((0,t.Immutable)(e))}},[p.defaultReferentLayer]);const we=()=>{(0,a.isDefined)(D)&&D.removeAll()},Se=t.React.useCallback(()=>{if(G&&V){const e=B?V.id:G.id,a=new t.DataRecordSetChangeMessage(c,t.RecordSetChangeType.Remove,[e]);t.MessageManager.getInstance().publishMessage(a)}},[G,V,B,c]),Re=t.React.useCallback(e=>Xe(this,void 0,void 0,function*(){let o=null,n=null;const i=W;let r,s;if(e.isPoint?($(!0),r=V):($(!1),r=G),v.size>0){const t=N(((null==i?void 0:i.layer)||(yield i.createJSAPILayerByDataSource())).fields),o=R(M,e.isPoint);s=yield(0,a.createLabelLayer)(t,f,o,me,v.color,v.size)}Se(),de.current=null,yield(0,t.loadArcGISJSAPIModules)(["esri/time/TimeExtent","esri/geometry/Point"]).then(e=>{[o,n]=e}).then(()=>{Me(i,M,e,f).then(n=>{(function(e,o,n,i,r,s,l,u,d){return De(this,void 0,void 0,function*(){const l=n.networkInfo.lrsNetworkId.toString(),c=u.find(e=>e.networkInfo&&l===e.networkInfo.derivedFromNetworkId&&e.networkInfo.isDerived),f=t.DataSourceManager.getInstance(),m=(0,a.isDefined)(c)&&f.getDataSource(c.useDataSource.dataSourceId),h=o.getOriginDataSources()[0],v=yield Oe(h);let p=h.getGDBVersion();if(p||(p=""),!r.isMeasureToGeometryOperation)return Ce(e,n,i,o,n.networkInfo.measurePrecision,s,0,d,c,m,p);const g=n.networkInfo.networkUrl,y=`${g}/measureToGeometry`,I=yield t.SessionManager.getInstance().getSessionByUrl(g).getToken(g),w=[];for(const e of i){const t=e.getData()[n.networkInfo.fromDateFieldName],o=(0,a.isDefined)(t)?new Date(t):new Date(0);w.push(o)}const S=k(w);let R=0;const N=[];yield Promise.all(S.map(e=>De(this,void 0,void 0,function*(){const l=[],u=[];i.forEach(t=>{const o=t.getData()[n.networkInfo.fromDateFieldName],i=(0,a.isDefined)(o)?new Date(o):new Date(0);if(e.valueOf()===i.valueOf()){const e=t.getFieldValue(n.networkInfo.routeIdFieldSchema.jimuName);l.push(e),r.searchMeasureBy===a.SearchMeasuresType.Single?u.push({routeId:e,measure:Fe(r.measure,n.networkInfo.measurePrecision),station:r.station}):r.searchMeasureBy===a.SearchMeasuresType.Multiple?r.measures.forEach((t,a)=>{u.push({routeId:e,measure:Fe(t,n.networkInfo.measurePrecision),station:r.stations.at(a)})}):isNaN(r.toMeasure)?u.push({routeId:e,measure:Fe(r.fromMeasure,n.networkInfo.measurePrecision),station:r.fromStation}):u.push({routeId:e,fromMeasure:Fe(r.fromMeasure,n.networkInfo.measurePrecision),toMeasure:Fe(r.toMeasure,n.networkInfo.measurePrecision),fromStation:r.fromStation,toStation:r.toStation})}});const d={f:"json",token:I,locations:u,gdbVersion:p,temporalViewDate:(0,a.isDefined)(e)&&0!==e.valueOf()?e:""};yield(0,a.requestService)({method:"POST",url:y,params:d}).then(r=>De(this,void 0,void 0,function*(){if(!r||!r.locations)return N;let l=null,u=null,f=null,h=null,v=null;yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/Polyline","esri/geometry/SpatialReference","esri/Graphic","esri/time/TimeExtent"]).then(e=>{[l,u,f,h,v]=e}).then(()=>De(this,void 0,void 0,function*(){yield Promise.all(r.locations.map((t,g)=>De(this,void 0,void 0,function*(){var y,I,w,S,R;if(t&&t.geometry){const k=i.findIndex(e=>e.getFieldValue(n.networkInfo.routeIdFieldSchema.jimuName)===t.routeId&&e.getFieldValue(n.networkInfo.fromDateFieldName)===d.temporalViewDate.valueOf()),b=i[k].clone(!0).getData(),F=new f({wkid:r.spatialReference.wkid,wkt:r.spatialReference.wkt}),D=n.networkInfo.lineIdFieldName;if("esriGeometryPoint"===t.geometryType){const r=new l(t.geometry);r.spatialReference=F,b[a.measureFields.at(0).value]=Fe(r.m,n.networkInfo.measurePrecision),b[a.networkObjectIdField.value]=i[k].getId();const u=b[n.networkInfo.fromDateFieldName],f=b[n.networkInfo.toDateFieldName];if((0,a.isDefined)(c)){const t=yield xe(r,m,e,f,v,i[k],c,p,D);t&&(b[a.derivedFields.at(0).value]=t.routeName,b[a.derivedFields.at(1).value]=t.routeId,b[a.derivedFields.at(2).value]=Fe(t.measure,n.networkInfo.measurePrecision))}f&&(b[n.networkInfo.toDateFieldName]=null===(y=(0,a.getDateWithTZOffset)(f,o.getOriginDataSources()[0]))||void 0===y?void 0:y.valueOf()),u&&(b[n.networkInfo.fromDateFieldName]=null===(I=(0,a.getDateWithTZOffset)(u,o.getOriginDataSources()[0]))||void 0===I?void 0:I.valueOf()),d.locations[g].station&&(b[a.stationField.at(0).value]=d.locations[g].station);const w=new h({geometry:r,attributes:b});(0,a.isDefined)(s)&&(yield s.applyEdits({addFeatures:[w.clone()]}));const S=o.buildRecord(w);N.push(S)}else{const r=new u(t.geometry);if(r.spatialReference=F,(null===(w=r.paths)||void 0===w?void 0:w.length)>0){const t=r.getPoint(0,0),s=r.paths[r.paths.length-1].length-1,l=r.getPoint(r.paths.length-1,s);b[a.measureFields.at(0).value]=Fe(t.m,n.networkInfo.measurePrecision),b[a.measureFields.at(1).value]=Fe(l.m,n.networkInfo.measurePrecision),b[a.networkObjectIdField.value]=i[k].getId();const u=b[n.networkInfo.fromDateFieldName],f=b[n.networkInfo.toDateFieldName];if((0,a.isDefined)(c)){const o=yield xe(t,m,e,f,v,i[k],c,p,D),r=yield xe(l,m,e,f,v,i[k],c,p,D);o&&(b[a.derivedFields.at(0).value]=o.routeName,b[a.derivedFields.at(1).value]=o.routeId,b[a.derivedFields.at(2).value]=Fe(o.measure,n.networkInfo.measurePrecision)),r&&(b[a.derivedFields.at(3).value]=Fe(r.measure,n.networkInfo.measurePrecision))}f&&(b[n.networkInfo.toDateFieldName]=null===(S=(0,a.getDateWithTZOffset)(f,o.getOriginDataSources()[0]))||void 0===S?void 0:S.valueOf()),u&&(b[n.networkInfo.fromDateFieldName]=null===(R=(0,a.getDateWithTZOffset)(u,o.getOriginDataSources()[0]))||void 0===R?void 0:R.valueOf()),d.locations[g].fromStation&&(b[a.stationField.at(1).value]=d.locations[g].fromStation),d.locations[g].toStation&&(b[a.stationField.at(2).value]=d.locations[g].toStation)}const l=new h({geometry:r,attributes:b});if((0,a.isDefined)(s)){const e=yield(0,a.getPolylineMidPoint)(r);e&&F&&(e.spatialReference=F);const t=new h({geometry:e,attributes:b});yield s.applyEdits({addFeatures:[t.clone()]})}const f=o.buildRecord(l);N.push(f)}}})))}))}))})));const b=h.getLayerDefinition();return N.forEach(e=>{const t=e.feature;t.attributes[b.objectIdField]=R++,t.sourceLayer=v.associatedLayer||v,t.layer=t.sourceLayer}),o.setSourceRecords(N),o.setStatus(t.DataSourceStatus.Unloaded),o.setCountStatus(t.DataSourceStatus.Unloaded),Te(o,e),S.length>1?yield Pe(o,N,n):N})})(c,r,M,n,e,s,0,m,o).then(t=>{(null==t?void 0:t.length)>0?(t.forEach(e=>{Ee(e.getData(),M.networkInfo)}),r.setRecords(t),P(null==t?void 0:t.length),de.current=r.getRecordsByPage(1,p.pageSize),K(!1),A(1)):(K(!0),oe(e.isMeasureToGeometryOperation?d("noResultsMeasure"):d("noResults")))}).finally(()=>null)})})}),[W,v,Se,V,G,M,f,c,m,p,d]),Ne=t.React.useCallback(e=>Xe(this,void 0,void 0,function*(){const o=W;let n,i,r=null,s=null;if(e.isPoint?($(!0),n=V):($(!1),n=G),v.size>0){const t=N(((null==o?void 0:o.layer)||(yield o.createJSAPILayerByDataSource())).fields),n=R(M,e.isPoint);i=yield(0,a.createLabelLayer)(t,f,n,me,v.color,v.size)}Se(),de.current=null,yield(0,t.loadArcGISJSAPIModules)(["esri/time/TimeExtent","esri/geometry/Point"]).then(e=>{[r,s]=e}).then(()=>{Me(o,M,e,f).then(o=>{(function(e,o,n,i,r,s,l,u,d){return De(this,void 0,void 0,function*(){const u=n.networkInfo.lrsNetworkId.toString(),c=i.find(e=>e.networkInfo&&u===e.networkInfo.derivedFromNetworkId&&e.networkInfo.isDerived),f=t.DataSourceManager.getInstance(),m=(0,a.isDefined)(c)&&f.getDataSource(c.useDataSource.dataSourceId),h=o.getOriginDataSources()[0],v=yield Oe(h);let p=h.getGDBVersion();if(p||(p=""),!s.isMeasureToGeometryOperation)return Ce(e,n,r,o,n.networkInfo.measurePrecision,l,0,d,c,m,p);const g=n.networkInfo.networkUrl,y=`${g}/measureToGeometry`,I=yield t.SessionManager.getInstance().getSessionByUrl(g).getToken(g),w=[];r=r.sort((e,t)=>e.getData()[n.networkInfo.lineOrderFieldName]-t.getData()[n.networkInfo.lineOrderFieldName]);for(const e of r){const t=e.getData()[n.networkInfo.fromDateFieldName],o=(0,a.isDefined)(t)?new Date(t):new Date(0);w.push(o)}const S=k(w);let R=0;const N=[],b=[],F=[],D=[],M=[],x=[];yield Promise.all(S.map(e=>De(this,void 0,void 0,function*(){var i,u,d,f;const h=[],v=[];if(s.searchMeasureBy===a.SearchMeasuresType.Range){const t=r,o=[];for(let r=0;r<t.length;r++){const l=t[r].getData()[n.networkInfo.fromDateFieldName],c=(0,a.isDefined)(l)?new Date(l):new Date(0),m=t[r].getData()[n.networkInfo.toDateFieldName],p=(0,a.isDefined)(m)?new Date(m):new Date(864e13);if(c.valueOf()<=e.valueOf()&&e.valueOf()<=p.valueOf()){const l=t[r].getFieldValue(n.networkInfo.routeIdFieldSchema.jimuName);h.push(l);for(let l=r;l<t.length;l++){const c=t[l].getData()[n.networkInfo.fromDateFieldName],m=(0,a.isDefined)(c)?new Date(c):new Date(0),h=t[l].getData()[n.networkInfo.toDateFieldName],p=(0,a.isDefined)(h)?new Date(h):new Date(864e13);if(m.valueOf()<=e.valueOf()&&e.valueOf()<=p.valueOf()){const e=null===(u=null===(i=t[r])||void 0===i?void 0:i.feature)||void 0===u?void 0:u.attributes,a=null===(f=null===(d=t[l])||void 0===d?void 0:d.feature)||void 0===f?void 0:f.attributes;if(!b[a[n.networkInfo.routeIdFieldSchema.jimuName]]){const e=a[n.networkInfo.routeIdFieldSchema.jimuName];b[e]=a}isNaN(s.toMeasure)?o.includes(e[n.networkInfo.routeIdFieldSchema.jimuName])||(o.push(e[n.networkInfo.routeIdFieldSchema.jimuName]),v.push({routeId:e[n.networkInfo.routeIdFieldSchema.jimuName],measure:Fe(s.fromMeasure,n.networkInfo.measurePrecision)})):v.push({routeId:e[n.networkInfo.routeIdFieldSchema.jimuName],toRouteId:a[n.networkInfo.routeIdFieldSchema.jimuName],fromMeasure:Fe(s.fromMeasure,n.networkInfo.measurePrecision),toMeasure:Fe(s.toMeasure,n.networkInfo.measurePrecision)})}}}}}else r.forEach(t=>{const o=t.getData()[n.networkInfo.fromDateFieldName],i=(0,a.isDefined)(o)?new Date(o):new Date(0);if(e.valueOf()===i.valueOf()){const e=t.getFieldValue(n.networkInfo.routeIdFieldSchema.jimuName);h.push(e),s.searchMeasureBy===a.SearchMeasuresType.Single?v.push({routeId:e,measure:Fe(s.measure,n.networkInfo.measurePrecision),station:s.station}):s.searchMeasureBy===a.SearchMeasuresType.Multiple?s.measures.forEach((t,a)=>{v.push({routeId:e,measure:Fe(t,n.networkInfo.measurePrecision),station:s.stations.at(a)})}):isNaN(s.toMeasure)?v.push({routeId:e,measure:Fe(s.fromMeasure,n.networkInfo.measurePrecision),station:s.fromStation}):v.push({routeId:e,fromMeasure:Fe(s.fromMeasure,n.networkInfo.measurePrecision),toMeasure:Fe(s.toMeasure,n.networkInfo.measurePrecision),fromStation:s.fromStation,toStation:s.toStation})}});const g={f:"json",token:I,locations:v,gdbVersion:p,temporalViewDate:(0,a.isDefined)(e)&&0!==e.valueOf()?e:""};yield(0,a.requestService)({method:"POST",url:y,params:g}).then(i=>De(this,void 0,void 0,function*(){if(!i||!i.locations)return N;let s=null,u=null,d=null,f=null,h=null;yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/Polyline","esri/geometry/SpatialReference","esri/Graphic","esri/time/TimeExtent"]).then(e=>{[s,u,d,f,h]=e}).then(()=>De(this,void 0,void 0,function*(){yield Promise.all(i.locations.map((t,v)=>De(this,void 0,void 0,function*(){var y,I,w,S,R;const k={};if(i.locations.forEach(e=>{const t=e.status,a=e.routeId;a in k?"esriLocatingOK"!==k[a]&&(k[a]=t):k[a]=t}),t&&t.geometry&&("esriLocatingOK"===t.status||"esriLocatingToPartialMatch"===t.status||"esriLocatingFromPartialMatch"===t.status)){const k=r.findIndex(e=>e.getFieldValue(n.networkInfo.routeIdFieldSchema.jimuName)===t.routeId);if(!r[k])return;const L=r[k].clone(!0).getData();let j,C=t.routeId;if(t.toRouteId&&(C+=t.toRouteId),F[C]){const e=F[C],a=void 0!==t.geometry.m?t.geometry.m:null;if(e.fromDate===L[n.networkInfo.fromDateFieldName]&&e.toDate===L[n.networkInfo.toDateFieldName]&&e.measure===a)return}if(F[C]={fromDate:L[n.networkInfo.fromDateFieldName],toDate:L[n.networkInfo.toDateFieldName],measure:void 0!==t.geometry.m?t.geometry.m:null},i.spatialReference.wkid?j=new d({wkid:i.spatialReference.wkid}):i.spatialReference.wkt&&(j=new d({wkt:i.spatialReference.wkt})),t.toRouteId&&"esriLocatingOK"===t.status){L[a.toRouteField.at(0).value]=t.toRouteId,n.networkInfo.useRouteName&&(L[a.toRouteField.at(1).value]=b[t.toRouteId][n.networkInfo.routeNameFieldSchema.jimuName]),L[a.toRouteField.at(2).value]=b[t.toRouteId][n.networkInfo.lineOrderFieldName];const e=b[t.toRouteId][n.networkInfo.fromDateFieldName],i=b[t.toRouteId][n.networkInfo.toDateFieldName];L[a.toRouteField.at(3).value]=(0,a.isDefined)(e)?(0,a.getDateWithTZOffset)(e,o.getOriginDataSources()[0]).toLocaleString(void 0,{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0}):null,L[a.toRouteField.at(4).value]=(0,a.isDefined)(i)?(0,a.getDateWithTZOffset)(i,o.getOriginDataSources()[0]).toLocaleString(void 0,{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",hour12:!0}):null}const O=n.networkInfo.lineIdFieldName;if("esriGeometryPoint"===t.geometryType){const i=new s(t.geometry);i.spatialReference=j,L[a.measureFields.at(0).value]=Fe(i.m,n.networkInfo.measurePrecision),L[a.networkObjectIdField.value]=r[k].getId();const u=L[n.networkInfo.fromDateFieldName],d=L[n.networkInfo.toDateFieldName];if((0,a.isDefined)(c)){const t=yield xe(i,m,e,d,h,r[k],c,p,O);t&&(L[a.derivedFields.at(0).value]=t.routeName,L[a.derivedFields.at(1).value]=t.routeId,L[a.derivedFields.at(2).value]=Fe(t.measure,n.networkInfo.measurePrecision))}d&&(L[n.networkInfo.toDateFieldName]=null===(y=(0,a.getDateWithTZOffset)(d,o.getOriginDataSources()[0]))||void 0===y?void 0:y.valueOf()),u&&(L[n.networkInfo.fromDateFieldName]=null===(I=(0,a.getDateWithTZOffset)(u,o.getOriginDataSources()[0]))||void 0===I?void 0:I.valueOf()),g.locations[v].station&&(L[a.stationField.at(0).value]=g.locations[v].station);const w=new f({geometry:i,attributes:L});(0,a.isDefined)(l)&&(yield l.applyEdits({addFeatures:[w.clone()]}));const S=o.buildRecord(w);"esriLocatingOK"!==t.status||t.toRouteId?"esriLocatingOK"===t.status&&t.toRouteId?je(S,n)&&x.push(S):D.push(S):M.push(S),N.push(S)}else{const i=new u(t.geometry);if(i.spatialReference=j,(null===(w=i.paths)||void 0===w?void 0:w.length)>0){const t=i.getPoint(0,0),s=i.paths[i.paths.length-1].length-1,l=i.getPoint(i.paths.length-1,s);L[a.measureFields.at(0).value]=Fe(t.m,n.networkInfo.measurePrecision),L[a.measureFields.at(1).value]=Fe(l.m,n.networkInfo.measurePrecision),L[a.networkObjectIdField.value]=r[k].getId();const u=L[n.networkInfo.fromDateFieldName],d=L[n.networkInfo.toDateFieldName];if((0,a.isDefined)(c)){const o=yield xe(t,m,e,d,h,r[k],c,p,O),i=yield xe(l,m,e,d,h,r[k],c,p,O);o&&(L[a.derivedFields.at(0).value]=o.routeName,L[a.derivedFields.at(1).value]=o.routeId,L[a.derivedFields.at(2).value]=Fe(o.measure,n.networkInfo.measurePrecision)),i&&(L[a.derivedFields.at(3).value]=Fe(i.measure,n.networkInfo.measurePrecision))}d&&(L[n.networkInfo.toDateFieldName]=null===(S=(0,a.getDateWithTZOffset)(d,o.getOriginDataSources()[0]))||void 0===S?void 0:S.valueOf()),u&&(L[n.networkInfo.fromDateFieldName]=null===(R=(0,a.getDateWithTZOffset)(u,o.getOriginDataSources()[0]))||void 0===R?void 0:R.valueOf()),g.locations[v].fromStation&&(L[a.stationField.at(1).value]=g.locations[v].fromStation),g.locations[v].toStation&&(L[a.stationField.at(2).value]=g.locations[v].toStation)}const s=new f({geometry:i,attributes:L});if((0,a.isDefined)(l)){const e=yield(0,a.getPolylineMidPoint)(i);e&&j&&(e.spatialReference=j);const t=new f({geometry:e,attributes:L});yield l.applyEdits({addFeatures:[t.clone()]})}const d=o.buildRecord(s);"esriLocatingOK"!==t.status||t.toRouteId?"esriLocatingOK"===t.status&&t.toRouteId?je(d,n)&&x.push(d):D.push(d):M.push(d),N.push(d)}}})))}))}))})));const L={},j=[];M.forEach(e=>{var t;const o=e.feature.attributes[n.networkInfo.routeIdFieldName],i=null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[a.toRouteField.at(0).value];L[o]=i}),D.forEach(e=>{const t=e.feature.attributes[n.networkInfo.routeIdFieldName];t in L?(L[t]&&M.push(e),j.push(t)):j.includes(t)||(M.push(e),j.push(t))}),x.forEach(e=>{M.push(e)});const C=h.getLayerDefinition();return M.forEach(e=>{const t=e.feature;t.attributes[C.objectIdField]=R++,t.sourceLayer=v.associatedLayer||v,t.layer=t.sourceLayer}),o.setSourceRecords(M),o.setStatus(t.DataSourceStatus.Unloaded),o.setCountStatus(t.DataSourceStatus.Unloaded),Te(o,e),S.length>1?yield Pe(o,M,n):M})})(c,n,M,m,o,e,i,0,r).then(t=>{(null==t?void 0:t.length)>0?(t.forEach(e=>{Ee(e.getData(),M.networkInfo)}),n.setRecords(t),P(null==t?void 0:t.length),de.current=n.getRecordsByPage(1,p.pageSize),K(!1),A(1)):(K(!0),oe(e.isMeasureToGeometryOperation?d("noResultsMeasure"):d("noResults"))),se(e.searchMeasureBy)}).finally(()=>null)})})}),[W,v,Se,V,G,M,f,c,m,p,d]),ke=t.React.useCallback(e=>Xe(this,void 0,void 0,function*(){const o=W;$(!0);const n=V;let i;if(v.size>0){const e=N(((null==o?void 0:o.layer)||(yield o.createJSAPILayerByDataSource())).fields),t=R(M,!0);i=yield(0,a.createLabelLayer)(e,f,t,me,v.color,v.size)}Se(),de.current=null,function(e,o,n){return De(this,void 0,void 0,function*(){const i=[];let r,s=null,l=null;return yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then(e=>{[s,l]=e}).then(()=>{var t,i,u,d;const c=new s;c.x=n.xCoordinate,c.y=n.yCoordinate,n.zCoordinate?c.z=n.zCoordinate:c.z=0,o.networkInfo.defaultSpatialReferenceFrom===a.SpatialReferenceFrom.Map?c.spatialReference=new l({wkid:102100}):c.spatialReference=new l({wkid:o.networkInfo.spatialReferenceInfo.wkid,wkt:o.networkInfo.spatialReferenceInfo.wkt});let f=null!==(i=null===(t=e.getTimeInfo())||void 0===t?void 0:t.timeExtent)&&void 0!==i?i:0;const m=e.getCurrentQueryParams();(null==m?void 0:m.time)&&(f=[m.time[0],m.time[1]]),r={returnGeometry:!0,returnM:!0,returnZ:!0,geometry:c.toJSON?c.toJSON():c,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects",time:f,outFields:["*"]};const h=null===(d=null===(u=o.networkInfo)||void 0===u?void 0:u.sortOptions)||void 0===d?void 0:d.filter(e=>(0,a.isDefined)(e.jimuFieldName));(null==h?void 0:h.length)>0&&Object.assign(r,{orderByFields:o.networkInfo.sortOptions.map(e=>`${e.jimuFieldName} ${e.order}`)})}),e.query(r).then(e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i}).catch(e=>i)})}(o,M,e).then(r=>Xe(this,void 0,void 0,function*(){r.length>0?function(e,o,n,i,r,s,l){return De(this,void 0,void 0,function*(){const u=n.networkInfo.networkUrl,d=`${u}/geometryToMeasure`,c=yield t.SessionManager.getInstance().getSessionByUrl(u).getToken(u),f=[],m=[];let h=null;yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point"]).then(e=>{[h]=e}).then(()=>{const e=new h;e.x=r.xCoordinate,e.y=r.yCoordinate,r.zCoordinate?e.z=r.zCoordinate:e.z=0,i.forEach(t=>{const a=t.getFieldValue(n.networkInfo.routeIdFieldSchema.jimuName);f.push(a),m.push({routeId:a,geometry:e.toJSON?e.toJSON():e})})});const v=o.getOriginDataSources()[0],p=yield Oe(v);let g=v.getGDBVersion();g||(g="");const y=v.getCurrentQueryParams();let I=null;(null==y?void 0:y.time)&&(I=null==y?void 0:y.time[0]);const w={f:"json",token:c,locations:m,inSR:n.networkInfo.defaultSpatialReferenceFrom===a.SpatialReferenceFrom.Map?102100:null,gdbVersion:g,temporalViewDate:(0,a.isDefined)(I)&&0!==I.valueOf()?I:""},S=[];return(0,a.requestService)({method:"POST",url:d,params:w}).then(u=>De(this,void 0,void 0,function*(){if(!u||!u.locations)return S;let d=null,c=null,f=null,m=null;return yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic","esri/time/TimeExtent"]).then(e=>{[d,c,f,m]=e}).then(()=>De(this,void 0,void 0,function*(){const h=new d;h.x=r.xCoordinate,h.y=r.yCoordinate,r.zCoordinate?h.z=r.zCoordinate:h.z=0;const v=n.networkInfo.lrsNetworkId.toString(),y=l.find(e=>e.networkInfo&&v===e.networkInfo.derivedFromNetworkId&&e.networkInfo.isDerived),I=t.DataSourceManager.getInstance(),w=(0,a.isDefined)(y)&&I.getDataSource(y.useDataSource.dataSourceId);yield Promise.all(u.locations.map((e,t)=>De(this,void 0,void 0,function*(){e&&(yield Promise.all(e.results.map((e,t)=>De(this,void 0,void 0,function*(){var t,r;if(e){const l=i.findIndex(t=>t.getFieldValue(n.networkInfo.routeIdFieldSchema.jimuName)===e.routeId),h=i[l].getData()[n.networkInfo.fromDateFieldName],v=i[l].getData()[n.networkInfo.toDateFieldName],p=i[l].getData(),I=n.networkInfo.lineIdFieldName;if(p[a.measureFields.at(0).value]=Fe(e.measure,n.networkInfo.measurePrecision),p[a.distanceField.value]=Fe(e.distance,n.networkInfo.measurePrecision),p[a.networkObjectIdField.value]=i[l].getId(),(0,a.isDefined)(y)){let t;u.spatialReference.wkid?t=new c({wkid:u.spatialReference.wkid}):u.spatialReference.wkt&&(t=new c({wkt:u.spatialReference.wkt}));const o=new d(e.geometry);o.spatialReference=t;const r=yield xe(o,w,h,v,m,i[l],y,g,I);r&&(p[a.derivedFields.at(0).value]=r.routeName,p[a.derivedFields.at(1).value]=r.routeId,p[a.derivedFields.at(2).value]=Fe(r.measure,n.networkInfo.measurePrecision))}const R=p[n.networkInfo.fromDateFieldName],N=p[n.networkInfo.toDateFieldName];let k;N&&(p[n.networkInfo.toDateFieldName]=null===(t=(0,a.getDateWithTZOffset)(N,o.getOriginDataSources()[0]))||void 0===t?void 0:t.valueOf()),R&&(p[n.networkInfo.fromDateFieldName]=null===(r=(0,a.getDateWithTZOffset)(R,o.getOriginDataSources()[0]))||void 0===r?void 0:r.valueOf()),u.spatialReference.wkid?k=new c({wkid:u.spatialReference.wkid}):u.spatialReference.wkt&&(k=new c({wkt:u.spatialReference.wkt}));const b=new d(e.geometry);b.spatialReference=k;const F=new f({geometry:b,attributes:p});(0,a.isDefined)(s)&&s.applyEdits({addFeatures:[F.clone()]});const D=o.buildRecord(F);S.push(D)}}))))}))),S.forEach(e=>{const t=e.feature;t.sourceLayer=p.associatedLayer||p,t.layer=t.sourceLayer}),o.setSourceRecords(S),o.setStatus(t.DataSourceStatus.Unloaded),o.setCountStatus(t.DataSourceStatus.Unloaded),Te(o,e)})),S}))})}(c,n,M,r,e,i,m).then(e=>{n.setRecords(e),P(null==e?void 0:e.length)}).finally(()=>{de.current=n.getRecordsByPage(1,p.pageSize),A(1)}):yield function(e,o,n){return De(this,void 0,void 0,function*(){const i=[];let r,s=null,l=null;return yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then(e=>{[s,l]=e}).then(()=>{var t,i,u,d,c,f,m,h,v;const p=new s;p.x=n.xCoordinate,p.y=n.yCoordinate,n.zCoordinate?p.z=n.zCoordinate:p.z=0,o.networkInfo.defaultSpatialReferenceFrom===a.SpatialReferenceFrom.Map?p.spatialReference=new l({wkid:102100}):p.spatialReference=new l({wkid:o.networkInfo.spatialReferenceInfo.wkid,wkt:o.networkInfo.spatialReferenceInfo.wkt});let g=null!==(i=null===(t=e.getTimeInfo())||void 0===t?void 0:t.timeExtent)&&void 0!==i?i:0;const y=e.getCurrentQueryParams();(null==y?void 0:y.time)&&(g=[y.time[0],y.time[1]]);const I=e.getOriginDataSources()[0],w=o.networkInfo.unitsOfMeasure;let S="esriMeters";(null===(u=null==I?void 0:I.layerDefinition)||void 0===u?void 0:u.hasGeometryProperties)&&(null===(c=null===(d=null==I?void 0:I.layerDefinition)||void 0===d?void 0:d.geometryProperties)||void 0===c?void 0:c.units)&&(S=null===(m=null===(f=null==I?void 0:I.layerDefinition)||void 0===f?void 0:f.geometryProperties)||void 0===m?void 0:m.units);const R=(0,a.ConvertUnits)(o.networkInfo.searchRadius,w,S);r={returnGeometry:!0,returnM:!0,returnZ:!0,geometry:p.toJSON?p.toJSON():p,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects",distance:R,units:"esriSRUnit_Meter",time:g,outFields:[o.networkInfo.routeIdFieldName,o.networkInfo.fromDateFieldName],notAddFieldsToClient:!0};const N=null===(v=null===(h=o.networkInfo)||void 0===h?void 0:h.sortOptions)||void 0===v?void 0:v.filter(e=>(0,a.isDefined)(e.jimuFieldName));(null==N?void 0:N.length)>0&&Object.assign(r,{orderByFields:o.networkInfo.sortOptions.map(e=>`${e.jimuFieldName} ${e.order}`)})}),e.query(r).then(e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i}).catch(e=>i)})}(o,M,e).then(r=>Xe(this,void 0,void 0,function*(){if(r.length>0){let s,l=[];yield Promise.all(r.map(o=>Xe(this,void 0,void 0,function*(){yield function(e,o,n,i){return De(this,void 0,void 0,function*(){var r,s,l,u,d;const c=o.getOriginDataSources()[0];let f=c.getGDBVersion();f||(f="");const m=n.networkInfo.unitsOfMeasure;let h=n.networkInfo.unitsOfMeasure;(null===(r=null==c?void 0:c.layerDefinition)||void 0===r?void 0:r.hasGeometryProperties)&&(null===(l=null===(s=null==c?void 0:c.layerDefinition)||void 0===s?void 0:s.geometryProperties)||void 0===l?void 0:l.units)&&(h=null===(d=null===(u=null==c?void 0:c.layerDefinition)||void 0===u?void 0:u.geometryProperties)||void 0===d?void 0:d.units);const v=(0,a.ConvertUnits)(n.networkInfo.searchRadius,m,h),p=[];let g=null,y=null;yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then(e=>{[g,y]=e}).then(()=>{const t=new g;t.x=i.xCoordinate,t.y=i.yCoordinate,i.zCoordinate?t.z=i.zCoordinate:t.z=0,n.networkInfo.defaultSpatialReferenceFrom===a.SpatialReferenceFrom.Map?t.spatialReference=new y({wkid:102100}):t.spatialReference=new y({wkid:n.networkInfo.spatialReferenceInfo.wkid,wkt:n.networkInfo.spatialReferenceInfo.wkt}),p.push({routeId:e.getFieldValue(n.networkInfo.routeIdFieldName),geometry:t.toJSON?t.toJSON():t})});const I=n.networkInfo.networkUrl,w={f:"json",token:yield t.SessionManager.getInstance().getSessionByUrl(I).getToken(I),locations:p,inSR:n.networkInfo.defaultSpatialReferenceFrom===a.SpatialReferenceFrom.Map?102100:null,gdbVersion:f,tolerance:v,temporalViewDate:e.getFieldValue(n.networkInfo.fromDateFieldName)},S=`${I}/geometryToMeasure`;return(0,a.requestService)({method:"POST",url:S,params:w}).then(e=>e&&e.locations?{resultLocations:e.locations,resultWkid:e.spatialReference.wkid}:{resultLocations:[],resultWkid:NaN})})}(o,n,M,e).then(({resultLocations:e,resultWkid:t})=>{l=l.concat(e),s=t})})));let u=null,f=null,h=null;(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/geometry/operators/proximityOperator"]).then(e=>{[u,f,h]=e}).then(()=>{let r=-1;const s=new u;s.x=e.xCoordinate,s.y=e.yCoordinate,e.zCoordinate?s.z=e.zCoordinate:s.z=0,M.networkInfo.defaultSpatialReferenceFrom===a.SpatialReferenceFrom.Map?s.spatialReference=new f({wkid:102100}):M.networkInfo.spatialReferenceInfo.wkid?s.spatialReference=new f({wkid:M.networkInfo.spatialReferenceInfo.wkid}):M.networkInfo.spatialReferenceInfo.wkt&&(s.spatialReference=new f({wkt:M.networkInfo.spatialReferenceInfo.wkt}));let v=[],g=[];l.forEach(e=>{e&&e.results.forEach(e=>{if(e){const t=h.getNearestCoordinate(new u(e.geometry),s).distance;(-1===r||(0,a.isWithinTolerance)(t,r,M.networkInfo.xyTolerance)||t<r)&&((-1===r||!(0,a.isWithinTolerance)(t,r,M.networkInfo.xyTolerance)&&t<r)&&(v=[],g=[],r=t),v.push(e),g.push(e.routeId))}})}),function(e,o,n,i,r,s,l,u,d){return De(this,void 0,void 0,function*(){var l,c,f,m;const h=i.getOriginDataSources()[0],v=yield Oe(h),p=[];let g=null,y=e.getGDBVersion();y||(y="");let I="";if(!(s.length>0))return{newRecords:p};I=o.networkInfo.routeIdFieldSchema.jimuName+" IN ('"+s.join("','")+"')";let w=null!==(c=null===(l=e.getTimeInfo())||void 0===l?void 0:l.timeExtent)&&void 0!==c?c:0;const S=e.getCurrentQueryParams();(null==S?void 0:S.time)&&(w=[S.time[0],S.time[1]]);const R={returnGeometry:!0,returnM:!0,returnZ:!0,where:I,time:w,outFields:["*"],notAddFieldsToClient:!0},N=null===(m=null===(f=o.networkInfo)||void 0===f?void 0:f.sortOptions)||void 0===m?void 0:m.filter(e=>(0,a.isDefined)(e.jimuFieldName));(null==N?void 0:N.length)>0&&Object.assign(R,{orderByFields:o.networkInfo.sortOptions.map(e=>`${e.jimuFieldName} ${e.order}`)});const k=o.networkInfo.lrsNetworkId.toString(),b=n.find(e=>e.networkInfo&&k===e.networkInfo.derivedFromNetworkId&&e.networkInfo.isDerived),F=t.DataSourceManager.getInstance(),D=(0,a.isDefined)(b)&&F.getDataSource(b.useDataSource.dataSourceId);return e.query(R).then(e=>De(this,void 0,void 0,function*(){var n;if((null===(n=e.records)||void 0===n?void 0:n.length)>0){const n=e.records;let s=null,l=null,c=null;return yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic","esri/time/TimeExtent"]).then(e=>{[s,l,c,g]=e}).then(()=>De(this,void 0,void 0,function*(){yield Promise.all(r.map(e=>De(this,void 0,void 0,function*(){var t,r;const u=n.findIndex(t=>t.getFieldValue(o.networkInfo.routeIdFieldSchema.jimuName)===e.routeId);if(u>-1){const f=n[u].getData(),m=n[u].getData()[o.networkInfo.fromDateFieldName],h=n[u].getData()[o.networkInfo.toDateFieldName],v=o.networkInfo.lineIdFieldName;let I;if(o.networkInfo.spatialReferenceInfo.wkid?I=new l({wkid:o.networkInfo.spatialReferenceInfo.wkid}):o.networkInfo.spatialReferenceInfo.wkt&&(I=new l({wkt:o.networkInfo.spatialReferenceInfo.wkt})),(0,a.isDefined)(b)){const t=new s(e.geometry);t.spatialReference=I;const i=yield xe(t,D,m,h,g,n[u],b,y,v);i&&(f[a.derivedFields.at(0).value]=i.routeName,f[a.derivedFields.at(1).value]=i.routeId,f[a.derivedFields.at(2).value]=Fe(i.measure,o.networkInfo.measurePrecision))}f[a.measureFields.at(0).value]=Fe(e.measure,o.networkInfo.measurePrecision),f[a.distanceField.value]=Fe(e.distance,o.networkInfo.measurePrecision),f[a.networkObjectIdField.value]=n[u].getId();const w=f[o.networkInfo.fromDateFieldName],S=f[o.networkInfo.toDateFieldName];S&&(f[o.networkInfo.toDateFieldName]=null===(t=(0,a.getDateWithTZOffset)(S,i.getOriginDataSources()[0]))||void 0===t?void 0:t.valueOf()),w&&(f[o.networkInfo.fromDateFieldName]=null===(r=(0,a.getDateWithTZOffset)(w,i.getOriginDataSources()[0]))||void 0===r?void 0:r.valueOf());const R=new s(e.geometry);R.spatialReference=I;const N=new c({geometry:R,attributes:f});(0,a.isDefined)(d)&&d.applyEdits({addFeatures:[N.clone()]});const k=i.buildRecord(N);p.push(k)}})))})),p.forEach(e=>{const t=e.feature;t.sourceLayer=v.associatedLayer||v,t.layer=t.sourceLayer}),i.setSourceRecords(p),i.setStatus(t.DataSourceStatus.Unloaded),i.setCountStatus(t.DataSourceStatus.Unloaded),Te(i,u),{newRecords:p}}return{newRecords:p}})).catch(e=>({newRecords:p}))})}(o,M,m,n,v,g,0,c,i).then(({newRecords:e})=>{n.setRecords(e),P(null==e?void 0:e.length),(null==e?void 0:e.length)>0?(e.forEach(e=>{Ee(e.getData(),M.networkInfo)}),de.current=n.getRecordsByPage(1,p.pageSize),A(1),K(!1)):(K(!0),oe(d("searchRadiusResultsError")))})})}else K(!0),oe(d("searchRadiusResultsError"))}))}))}),[W,V,v,Se,M,f,c,m,p,d]),be=t.React.useCallback(()=>{de.current=null,B?(null==V||V.clearSelection(),null==V||V.clearRecords(),null==V||V.setCountStatus(t.DataSourceStatus.NotReady),null==V||V.setStatus(t.DataSourceStatus.NotReady)):(null==G||G.clearSelection(),null==G||G.clearRecords(),null==G||G.setCountStatus(t.DataSourceStatus.NotReady),null==G||G.setStatus(t.DataSourceStatus.NotReady)),(0,a.removeLabelLayer)(f,me),P(0),Se(),A(0)},[f,B,G,V,Se]);t.React.useEffect(()=>{be()},[m,be]);const Ae=t.React.useCallback(()=>{var e,t,o,n;C===a.SearchMethod.Measure?null===(e=pe.current)||void 0===e||e.submitForm():C===a.SearchMethod.Referent?null===(t=ge.current)||void 0===t||t.submitForm():C===a.SearchMethod.Coordinate?null===(o=ye.current)||void 0===o||o.submitForm():C===a.SearchMethod.LineAndMeasure&&(null===(n=Ie.current)||void 0===n||n.submitForm())},[C]),Ge=t.React.useCallback(e=>{ve(e)},[]),ze=t.React.useMemo(()=>C===a.SearchMethod.Measure?d(he?"search":"searchDisabled"):C===a.SearchMethod.Referent?d(he?"search":"searchReferentTooltip"):C===a.SearchMethod.Coordinate?d(he?"search":"coordinateSearchDisabled"):C===a.SearchMethod.LineAndMeasure?d(he?"search":"lineMeasureSearchDisabled"):void 0,[d,he,C]);return(0,e.jsxs)("div",{className:"search-by-route-task h-100 d-flex",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .search-by-route-form {
      height: 100%;
    }
    .search-by-route-task__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .toast {
      position: relative;
      top: 4%;
    }
    .search-by-route-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `,children:[(0,e.jsx)("div",{className:(0,t.classNames)("search-by-route-form__header px-3 pt-3 align-items-center",{"d-none":1===E,[n.FOCUSABLE_CONTAINER_CLASS]:1!==E}),children:!F&&(0,e.jsx)("div",{className:"search-by-route_title d-flex align-items-center text-truncate",css:t.css`font-weight: 500; font-size: 14px;`,children:(0,e.jsx)("div",{className:"text-truncate",children:d("_widgetLabel")})})}),(0,e.jsxs)("div",{className:(0,t.classNames)("search-by-route-task__content",{"d-none":1===E,[n.FOCUSABLE_CONTAINER_CLASS]:1!==E}),children:[(0,e.jsx)(Qe,{lrsLayer:M,dataSourceReady:e=>{q(e)},onCreateDs:e=>{U(e)},onCreateLineDs:e=>{z(e)},onCreatePointDs:e=>{_(e)}}),(0,e.jsx)(l,{lrsLayers:m,defaultReferent:L,defaultNetwork:le,resultConfig:p,hideMethod:y,hideNetwork:I,onMethodChanged:e=>{O(e),we()},onNetworkChanged:e=>{q(!1),x(e),we()},onReferentChanged:e=>{q(!1),j(e)}}),J&&fe&&C===a.SearchMethod.Measure&&(0,e.jsx)(w,{ref:pe,intl:b,widgetId:c,lrsLayer:M,dataSource:W,isDataSourceReady:null!=W,hideRoute:S,reset:ne,onSubmit:Re,onValidationChanged:Ge}),J&&fe&&C===a.SearchMethod.LineAndMeasure&&(0,e.jsx)(Ye,{ref:Ie,intl:b,widgetId:c,lrsLayer:M,dataSource:W,isDataSourceReady:null!=W,hideRoute:S,onSubmit:Ne,onValidationChanged:Ge,reset:ne}),C===a.SearchMethod.Coordinate&&(0,e.jsx)(ae,{ref:ye,lrsLayer:M,dataSource:W,isDataSourceReady:null!=W,onSubmit:ke,onValidationChanged:Ge,coordinateGraphic:D,reset:ne}),C===a.SearchMethod.Referent&&(0,e.jsx)(ee,{ref:ge,referentItem:L,dataSource:W,isDataSourceReady:null!=W,resultConfig:p,onSubmit:(e,o)=>Xe(this,void 0,void 0,function*(){const n=W,i=V;let r;if(v.size>0){const e=N(((null==n?void 0:n.layer)||(yield n.createJSAPILayerByDataSource())).fields),t=R(M,!0);r=yield(0,a.createLabelLayer)(e,f,t,me,v.color,v.size)}$(!0),Se(),de.current=null,yield function(e,o,n,i,r,s,l,u,d,c,f){return De(this,void 0,void 0,function*(){const m=[],h=[],v=null==c?void 0:c.defaultOffsetUnit,p=i.networkInfo.lineIdFieldName;let g=0,y=null,I=null,w=null,S=null,R=o.getGDBVersion();R||(R=""),yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic","esri/time/TimeExtent"]).then(e=>{[y,I,w,S]=e});const N=yield Le(n,i,v,R,null);if(!N||!(null==N?void 0:N.locations)||0===(null==N?void 0:N.locations.length))return[];if(N.locations.forEach(e=>{const t=e.results;if("esriLocatingMultipleLocation"===(null==e?void 0:e.status))t.forEach(e=>{const t=e.routeId;m.includes(t)||m.push(t)});else if("esriLocatingOK"===(null==e?void 0:e.status)){const t=e.results[0].routeId;m.includes(t)||m.push(t)}}),!m||0===m.length)return[];const k=(e,t)=>{const a=new w({geometry:t,attributes:e}),o=s.buildRecord(a);h.push(o),l++},b=(e,n,r)=>De(this,void 0,void 0,function*(){var u,c,m,h;const v=o.getLayerDefinition(),g=null==e?void 0:e.results,b=new I({wkid:N.spatialReference.wkid,wkt:N.spatialReference.wkt}),F=i.networkInfo.lrsNetworkId.toString(),D=d.find(e=>e.networkInfo&&F===e.networkInfo.derivedFromNetworkId&&e.networkInfo.isDerived),M=t.DataSourceManager.getInstance(),x=(0,a.isDefined)(D)&&M.getDataSource(D.useDataSource.dataSourceId),L=n.getData()[i.networkInfo.fromDateFieldName],j=n.getData()[i.networkInfo.toDateFieldName];if("esriLocatingMultipleLocation"===(null==e?void 0:e.status))for(const e of g){const t=null==n?void 0:n.getData();if(!t)return;if((null==e?void 0:e.routeId)!==t[i.networkInfo.routeIdFieldName]);else{r.push(e);let o=null==e?void 0:e.measure,d=null;if("esriGeometryPoint"===(null==e?void 0:e.geometryType)&&(d=new y(e.geometry),d.spatialReference=N.spatialReference),(0,a.isDefined)(D)){const e=yield xe(d,x,L,j,S,n,D,R,p);e&&(t[a.derivedFields.at(0).value]=e.routeName,t[a.derivedFields.at(1).value]=e.routeId,t[a.derivedFields.at(2).value]=Fe(e.measure,i.networkInfo.measurePrecision))}o=o<0?0:Fe(o,i.networkInfo.measurePrecision),t[a.measureFields.at(0).value]=o,t[v.objectIdField]=l,t[a.networkObjectIdField.value]=n.getId();const m=t[i.networkInfo.fromDateFieldName],h=t[i.networkInfo.toDateFieldName];if(m||h){const e=(0,a.isDefined)(m)?null===(u=(0,a.getDateWithTZOffset)(m,s.getOriginDataSources()[0]))||void 0===u?void 0:u.valueOf():null,o=(0,a.isDefined)(h)?null===(c=(0,a.getDateWithTZOffset)(h,s.getOriginDataSources()[0]))||void 0===c?void 0:c.valueOf():null;if(t[i.networkInfo.fromDateFieldName]=e,t[i.networkInfo.toDateFieldName]=o,(0,a.isDefined)(f)){const e=new w({geometry:d,attributes:t});yield f.applyEdits({addFeatures:[e.clone()]})}k(t,d)}else{if((0,a.isDefined)(f)){const e=new w({geometry:d,attributes:t});yield f.applyEdits({addFeatures:[e.clone()]})}k(t,d)}}}else if("esriLocatingOK"===(null==e?void 0:e.status)){const t=e.results[0];let o=t.measure;const u=n.getData();let d=null;if(!r.some(e=>JSON.stringify(e)===JSON.stringify(t))&&(null==t?void 0:t.routeId)===u[i.networkInfo.routeIdFieldName]){if(r.push(t),"esriGeometryPoint"===t.geometryType&&(d=new y(t.geometry),d.spatialReference=b),(0,a.isDefined)(D)){const e=yield xe(d,x,L,j,S,n,D,R,p);e&&(u[a.derivedFields.at(0).value]=e.routeName,u[a.derivedFields.at(1).value]=e.routeId,u[a.derivedFields.at(2).value]=Fe(e.measure,i.networkInfo.measurePrecision))}o=o<0?0:Fe(o,i.networkInfo.measurePrecision),u[a.measureFields.at(0).value]=o,u[v.objectIdField]=l,u[a.networkObjectIdField.value]=n.getId();const e=u[i.networkInfo.fromDateFieldName],c=u[i.networkInfo.toDateFieldName];if(e||c){const t=(0,a.isDefined)(e)?null===(m=(0,a.getDateWithTZOffset)(e,s.getOriginDataSources()[0]))||void 0===m?void 0:m.valueOf():null,o=(0,a.isDefined)(c)?null===(h=(0,a.getDateWithTZOffset)(c,s.getOriginDataSources()[0]))||void 0===h?void 0:h.valueOf():null;if(u[i.networkInfo.fromDateFieldName]=t,u[i.networkInfo.toDateFieldName]=o,(0,a.isDefined)(f)){const e=new w({geometry:d,attributes:u});yield f.applyEdits({addFeatures:[e.clone()]})}k(u,d)}else{if((0,a.isDefined)(f)){const e=new w({geometry:d,attributes:u});yield f.applyEdits({addFeatures:[e.clone()]})}k(u,d)}}}});yield(()=>De(this,void 0,void 0,function*(){return new Promise((e,t)=>De(this,void 0,void 0,function*(){var t,s;const l=null===(t=i.networkInfo)||void 0===t?void 0:t.routeIdFieldName,d=[],c=[];let f="";m.length>0&&(f=l+" IN ('"+m.join("','")+"')");const h={where:f,outFields:["*"]},p=yield o.query(h);if(0===(null===(s=null==p?void 0:p.records)||void 0===s?void 0:s.length))return[];p.records.forEach(e=>{var t;c.push(e);const o=e.getData()[null===(t=null==r?void 0:r.eventInfo)||void 0===t?void 0:t.fromDateFieldName];null==n||n.forEach(e=>{const t=e.objectId;let s=u[t];(null==r?void 0:r.layerType)!==a.LrsLayerType.Event&&(s=o),d.push(Le(n,i,v,R,s))})});const g=yield Promise.all(d),y=[];yield Promise.all(g.map((e,t)=>De(this,void 0,void 0,function*(){const a=null==e?void 0:e.locations;if((null==a?void 0:a.length)>0){const e=c[t];for(const t of a)yield b(t,e,y)}}))),e("finish")}))}))(),s.setSourceRecords(h),s.setStatus(t.DataSourceStatus.Unloaded),s.setCountStatus(t.DataSourceStatus.Unloaded),Te(s,e);const F=yield Oe(o),D=o.getLayerDefinition();return h.forEach(e=>{const t=e.feature;t.attributes[D.objectIdField]=g++,t.sourceLayer=F.associatedLayer||F,t.layer=t.sourceLayer}),h})}(c,n,e,M,L,i,1,o,m,p,r).then(e=>{(null==e?void 0:e.length)>0?(e.forEach(e=>{Ee(e.getData(),M.networkInfo)}),i.setSourceRecords(e),i.setRecords(e),P(null==e?void 0:e.length),de.current=i.getRecordsByPage(1,p.pageSize),A(1),K(!1)):(K(!0),oe(d("noResultReferent")))}).finally(()=>null)}),lrsLayers:m,id:c,intl:b,widgetId:c,onValidationChanged:Ge,reset:ne}),H&&(0,e.jsx)("div",{className:"toast-container px-3 w-100",children:(0,e.jsx)(n.Alert,{className:"toast w-100",type:Y,text:te,closable:!0,withIcon:!0,open:H,onClose:()=>{Q(!1),K(!1)}})})]}),(0,e.jsx)("div",{className:(0,t.classNames)("search-by-route-footer_action w-100",{"d-none":1===E,[n.FOCUSABLE_CONTAINER_CLASS]:1!==E}),children:(0,e.jsxs)("div",{className:"search-by-route-footer d-flex",children:[(0,e.jsx)(n.Label,{size:"sm",className:" mt-auto mr-auto title3",centric:!0,style:{color:null===(s=(0,Ve.getTheme)())||void 0===s?void 0:s.sys.color.primary.main},onClick:()=>{ie(!ne)},children:d("resetLabel")}),(0,e.jsx)(n.Tooltip,{title:ze,children:(0,e.jsx)("div",{className:"mt-auto ml-auto",children:(0,e.jsx)(n.Button,{type:"primary",className:"active","aria-label":d("searchLabel"),size:"sm",disabled:!he,onClick:Ae,children:d("searchLabel")})})})]})}),(0,e.jsx)("div",{className:(0,t.classNames)("search-by-route-task__content",{"d-none":1!==E,[n.FOCUSABLE_CONTAINER_CLASS]:1===E}),children:(0,e.jsx)(He,{lrsLayers:m,widgetId:c,lrsLayer:M,selectedMethod:C,isPoint:B,resultCount:T,maxPerPage:null===(u=null==W?void 0:W.getMaxRecordCount)||void 0===u?void 0:u.call(W),records:de.current,routeRecords:ce.current,defaultPageSize:p.pageSize,outputDS:B?V:G,inputDS:W,jimuMapView:f,highlightStyle:h,onNavBack:be,intl:b,measureType:re})})]})}var tt=function(e,t,a,o){return new(a||(a=Promise))(function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,s)}l((o=o.apply(e,t||[])).next())})};class at extends t.React.PureComponent{constructor(e){super(e),this.supportedLrsLayerTypes=(0,t.Immutable)([a.LrsLayerType.Network,a.LrsLayerType.Event,a.LrsLayerType.PointEvent,a.LrsLayerType.Intersection,a.LrsLayerType.Addressing,a.LrsLayerType.CalibrationPoint,a.LrsLayerType.NonLrs,a.LrsLayerType.NonLrsPoint]),this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally(()=>{this.setState({jimuMapView:e})})},this.waitForChildDataSourcesReady=e=>tt(this,void 0,void 0,function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const a=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==a?void 0:a.isDataSourceSet())&&!a.areChildDataSourcesCreated()?a.childDataSourcesReady().then(()=>a).catch(e=>a):Promise.resolve(a)}),this.handleLrsLayersChanged=e=>{this.setState({activeLrsLayers:e})},this.handleViewChange=e=>{e&&this.setState({activeMapViewId:e.id})},this.getI18nMessage=(e,t)=>{const a=Object.assign({},o,n.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:a[e]},t)},this.state={coordinateGraphic:null,jimuMapView:void 0,hideTitle:!1,activeMapViewId:"",activeLrsLayers:this.props.config.lrsLayers||(0,t.Immutable)([])},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentDidMount(){const e=(0,a.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:e})}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,t){t.jimuMapView!==this.state.jimuMapView&&(0,a.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers())}removeGraphicLayers(){(0,a.isDefined)(this.state.coordinateGraphic)&&(this.state.coordinateGraphic.removeAll(),this.state.coordinateGraphic.destroy(),this.setState({coordinateGraphic:null}))}createGraphicLayers(){var e,t;if((0,a.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const a=new Ze.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([a]),this.setState({coordinateGraphic:a})}}getConfigValues(e,t,o){const n={highlightStyle:t.highlightStyle,labelStyle:t.labelStyle,resultConfig:t.resultConfig,defaultNetwork:t.defaultNetwork,hideMethod:t.hideMethod,hideNetwork:t.hideNetwork,hideRoute:t.hideRoute};return Object.entries(n).reduce((t,[n,i])=>(t[n]=(0,a.getConfigValue)(e,n,o,i),t),{})}render(){var o,i,l;const{config:u,id:d,intl:c}=this.props;let{useMapWidgetIds:f}=this.props;const{mapViewsConfig:m}=u,h=u.mode&&u.mode!==a.ModeType.Map?u.lrsLayers:this.state.activeLrsLayers;let v=(null===(o=u.settingsPerView)||void 0===o?void 0:o[this.state.activeMapViewId])||function(){const e={highlightStyle:{color:a.highlightColor,size:2},labelStyle:{color:a.colorBlack,size:12},resultConfig:{pageSize:100,defaultReferentLayer:null,defaultOffsetUnit:""},defaultNetwork:"",hideMethod:!1,hideNetwork:!1,hideRoute:!1};return(0,t.Immutable)(e)}();var p;h&&h.length>0&&(v=(p=v).set("highlightStyle",p.highlightStyle||{color:a.highlightColor,size:2}).set("labelStyle",p.labelStyle||{color:a.colorBlack,size:12}).set("resultConfig",p.resultConfig||{pageSize:100,defaultReferentLayer:null,defaultOffsetUnit:""}).set("defaultNetwork",p.defaultNetwork||"").set("hideMethod",p.hideMethod||!1).set("hideNetwork",p.hideNetwork||!1).set("hideRoute",p.hideMethod||!1));const g=this.getConfigValues(u,v,this.state.activeMapViewId),{highlightStyle:y,labelStyle:I,defaultNetwork:w,hideMethod:S,hideNetwork:R,hideRoute:N}=g;let{resultConfig:k}=g;const b=(0,a.getModeType)(u.mode,h),F=null==h?void 0:h.filter(e=>e.layerType===a.LrsLayerType.Network).length,D=(null==h?void 0:h.length)>0&&F>0;if(h&&h.length>0&&!(null==k?void 0:k.defaultReferentLayer)){const e=h.find(e=>e.isReferent);e&&(k=Object.assign(Object.assign({},k),{defaultReferentLayer:(0,t.Immutable)(e)}))}if(!f){const e=null===(l=null===(i=(0,t.getAppStore)())||void 0===i?void 0:i.getState())||void 0===l?void 0:l.appConfig;f=(0,a.findFirstArcgisMapWidgetId)(e)}return(0,e.jsx)(n.Paper,{variant:"flat",shape:"none",className:"jimu-widget runtime-search-by-route surface-1 border-0",children:(0,e.jsxs)("div",{id:this.widgetOuterDivId,className:"widget-outer-div h-100 w-100 d-flex",children:[(0,e.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null==f?void 0:f[0],onActiveViewChange:this.onActiveViewChange}),b&&(0,e.jsx)(a.MapViewLoader,{config:u,widgetId:d,supportedLrsLayerTypes:this.supportedLrsLayerTypes,useMapWidgetIds:f,mapViewsConfig:m,jimuMapView:this.state.jimuMapView,outputDataSourceType:"searchByRoute",onLrsLayersChanged:this.handleLrsLayersChanged,onViewChange:this.handleViewChange}),D&&(0,e.jsx)(et,{widgetId:d,jimuMapView:this.state.jimuMapView,lrsLayers:h,defaultNetwork:w,hideMethod:S,hideNetwork:R,hideRoute:N,highlightStyle:y,labelStyle:I,resultConfig:k,intl:c,hideTitle:this.state.hideTitle,coordinateGraphic:this.state.coordinateGraphic}),!D&&(0,e.jsx)(n.WidgetPlaceholder,{icon:r(),widgetId:d,message:this.getI18nMessage("_widgetLabel")})]})})}}function ot(e){f.p=e}})(),m})())}}});