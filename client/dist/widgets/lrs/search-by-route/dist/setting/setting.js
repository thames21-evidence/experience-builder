System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-ui/advanced/setting-components","widgets/shared-code/lrs","jimu-ui/basic/list-tree","jimu-ui/advanced/sql-expression-builder","jimu-ui/basic/color-picker","jimu-core/react"],function(e,t){var l={},a={},i={},s={},n={},r={},o={},d={},u={};return{setters:[function(e){l.jsx=e.jsx,l.jsxs=e.jsxs},function(e){a.Immutable=e.Immutable,a.React=e.React,a.ReactRedux=e.ReactRedux,a.css=e.css,a.defaultMessages=e.defaultMessages,a.hooks=e.hooks},function(e){i.Checkbox=e.Checkbox,i.CollapsablePanel=e.CollapsablePanel,i.NumericInput=e.NumericInput,i.Select=e.Select,i.Switch=e.Switch,i.TextInput=e.TextInput,i.defaultMessages=e.defaultMessages,i.hooks=e.hooks},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection},function(e){n.EmptyPlaceholder=e.EmptyPlaceholder,n.GetEsriUnits=e.GetEsriUnits,n.GetUnits=e.GetUnits,n.Identifiers=e.Identifiers,n.LineIdentifiers=e.LineIdentifiers,n.LrsLayerType=e.LrsLayerType,n.LrsLoader=e.LrsLoader,n.ModeType=e.ModeType,n.SearchMethod=e.SearchMethod,n.SpatialReferenceFrom=e.SpatialReferenceFrom,n.advancedActionMap=e.advancedActionMap,n.colorBlack=e.colorBlack,n.colorCyan=e.colorCyan,n.derivedFields=e.derivedFields,n.distanceField=e.distanceField,n.getConfigValue=e.getConfigValue,n.highlightColor=e.highlightColor,n.isDefined=e.isDefined,n.lrsDefaultMessages=e.lrsDefaultMessages,n.measureFields=e.measureFields,n.stationField=e.stationField,n.toRouteField=e.toRouteField,n.updateConfig=e.updateConfig},function(e){r.List=e.List},function(e){o.Sort=e.Sort},function(e){d.ColorPicker=e.ColorPicker},function(e){u.Fragment=e.Fragment}],execute:function(){e((()=>{var e={14321:e=>{"use strict";e.exports=i},47626:e=>{"use strict";e.exports=n},54337:e=>{"use strict";e.exports=d},67386:e=>{"use strict";e.exports=l},68972:e=>{"use strict";e.exports=u},71442:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=a},79298:e=>{"use strict";e.exports=s},98640:e=>{"use strict";e.exports=r}},t={};function c(l){var a=t[l];if(void 0!==a)return a.exports;var i=t[l]={exports:{}};return e[l](i,i.exports,c),i.exports}c.d=(e,t)=>{for(var l in t)c.o(t,l)&&!c.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var f={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(f),c.d(f,{__set_webpack_public_path__:()=>I,default:()=>M});var e=c(67386),t=c(79244),l=c(14321),a=c(79298);const i={blankStatus:"Select a map to import LRS networks",outputDsLabelPoint:"{label} point result",outputDsLabelLine:"{label} line result",layerConfig:"Layer Configuration",importAll:"Import all",selectMap:"Select Map",networkConfig:"Network Configuration",referentConfig:"Referent Configuration",networkLabel:"Label",defaultIdentifier:"Default Identifier",routeIdentifier:"Route",lineIdentifier:"Line",spatialReference:"Spatial Reference",routeId:"Route ID",routeName:"Route name",lineId:"Line ID",lineName:"Line Name",multiField:"Multi field",searchMethod:"Search Methods",identifier:"Identifier",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",referent:"Referent",lineAndMeasure:"Line and Measure",removeNetwork:"Remove",selectionHighlight:"Highlight",graphicWidth:"Width",resultSettings:"Result Settings",resultsPageSize:"Page size",enablePoint:"Enable add point",enableLine:"Enable add line",defaultReferent:"Default Referent",defaultOffsetUnit:"Default Offset Units",routeFields:"Multi field route ID",routeFieldsConfig:"Route ID settings",selectionSettings:"Selection Settings",results:"Results",sortResults:"Sort results by:",radiusWithUnits:"Radius ({units})",resultsAscending:"Ascending",resultsDescending:"Descending",noMapSelected:"Select Map",lrs:"LRS",defaultStr:"Default",configureFields:"Configure Fields",defaultNetwork:"Default Network",searchMeasures:"Search Measures",singleLabel:"Single",multipleLabel:"Multiple",rangeLabel:"Range",expandByDefault:"Expand by default",loadLayers:"Load layers",clearLayers:"Clear layers",labelColor:"Label color",labelSize:"Label size",advancedFieldDisplay:"Advanced field display",networkFields:"Network fields",additionalFields:"Additional fields"};var s=c(47626);const n=(e,l)=>{if(null==l?void 0:l.defaultReferentLayer)return l;const a=e.find(e=>e.isReferent);if(a){const e=Object.assign({},l);return e.defaultOffsetUnit="esriInches",e.defaultReferentLayer=(0,t.Immutable)(a),e.pageSize=25,e}return l},r=(e,t)=>{if(t)return t;const l=e.find(e=>e.layerType===s.LrsLayerType.Network&&!e.networkInfo.isDerived);return l?l.name:void 0};function o(){const e={highlightStyle:{color:s.highlightColor,size:2},labelStyle:{color:s.colorBlack,size:12},resultConfig:{pageSize:100,defaultReferentLayer:null,defaultOffsetUnit:""},defaultNetwork:"",hideMethod:!1,hideNetwork:!1,hideRoute:!1};return(0,t.Immutable)(e)}function d(e,t){return e.set("mode",t).set("lrsLayers",[]).set("mapViewsConfig",{}).set("settingsPerView",{}).set("highlightStyle",{color:s.highlightColor,size:2}).set("labelStyle",{color:s.colorBlack,size:2}).set("resultConfig",{pageSize:100,defaultReferentLayer:null,defaultOffsetUnit:""}).set("defaultNetwork","").set("hideMethod",!1).set("hideNetwork",!1).set("hideRoute",!1)}function u(e){const{widgetId:l,useDataSourceId:a}=e;return t.ReactRedux.useSelector(e=>{var t;let i;i=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig;return(null!==(t=i.widgets[l].useDataSources)&&void 0!==t?t:[]).some(e=>e.dataSourceId===a)})}function h(n){var r,o;const{widgetId:d,index:c,config:f,activeMapViewId:h,onSettingChange:g}=n,p=(v="lrsLayers",m=[],t.React.useMemo(()=>(0,s.getConfigValue)(f,v,h)||m,[f,h]));var v,m;const b=p[c],w=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),[S,y]=t.React.useState(null==b?void 0:b.name),x=u({widgetId:d,useDataSourceId:null===(r=null==b?void 0:b.useDataSource)||void 0===r?void 0:r.dataSourceId}),C=t.React.useMemo(()=>b?(e=>{if(!e)return(0,t.Immutable)({});switch(e.layerType){case s.LrsLayerType.Event:return e.eventInfo.referentProperties;case s.LrsLayerType.Intersection:return e.intersectionInfo.referentProperties;case s.LrsLayerType.CalibrationPoint:return e.calibrationPointInfo.referentProperties;case s.LrsLayerType.Addressing:return e.addressingInfo.referentProperties;case s.LrsLayerType.NonLrs:return e.nonLrsInfo.referentProperties;default:return(0,t.Immutable)({})}})(b):{},[b]),[j,L]=t.React.useState(null===(o=null==C?void 0:C.layerFields[0])||void 0===o?void 0:o.name);t.React.useEffect(()=>{var e;(null==b?void 0:b.name)&&S!==(null==b?void 0:b.name)&&(y(null==b?void 0:b.name),L(null===(e=null==C?void 0:C.layerFields[0])||void 0===e?void 0:e.name)),(null==b?void 0:b.displayField)&&L(null==b?void 0:b.displayField)},[null==b?void 0:b.name]);const k=t.React.useCallback((e,l,a=!1)=>{var i;let n=null!=p?p:(0,t.Immutable)([]);if(n=t.Immutable.set(n,e,l),f.mode===s.ModeType.Map){const e=h,t=(null===(i=f.mapViewsConfig)||void 0===i?void 0:i[e]).set("lrsLayers",n),l=f.setIn(["mapViewsConfig",e],t);g({id:d,config:l})}else g({id:d,config:f.set("lrsLayers",n)})},[p,f,h,g,d]),R=t.React.useCallback((e,t,l=!1)=>{let a;a=null==t?b.without(e):b.set(e,t),k(c,a,l)},[k,c,b]),M=t.React.useCallback(e=>{y(e.target.value)},[]),I=t.React.useCallback(e=>{e.trim().length>0?R("name",e,!0):y(null==b?void 0:b.name)},[null==b?void 0:b.name,R]);return(0,e.jsx)("div",{className:"h-100",children:(0,e.jsx)("div",{css:t.css`height: 100%; overflow:auto;`,children:b&&(x||f.mode===s.ModeType.Map)&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(a.SettingSection,{role:"group","aria-label":w("networkLabel"),title:w("networkLabel"),children:(0,e.jsx)(a.SettingRow,{children:(0,e.jsx)(l.TextInput,{size:"sm",type:"text",className:"w-100",value:S,onChange:M,onAcceptValue:I,"aria-label":w("networkLabel")})})}),(0,e.jsx)(a.SettingSection,{role:"group","aria-label":w("configureFields"),title:w("configureFields"),children:(0,e.jsx)(a.SettingRow,{flow:"wrap",label:w("defaultStr"),children:(0,e.jsx)(l.Select,{"aria-label":w("defaultStr"),className:"w-100",size:"sm",value:j,onChange:e=>{(e=>{L(e);const t=b.set("displayField",e);k(c,t,!1)})(e.target.value)},children:(()=>{const t=null==C?void 0:C.layerFields;if(0===(null==t?void 0:t.length))return[];const l=[];return t.forEach((t,a)=>{l.push((0,e.jsx)("option",{value:t.name,children:t.name},a))}),l})()})})})]})})})}function g(n){var r;const{lrsLayer:o,onPropertyChanged:d,onPropertiesChanged:u}=n,c=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),f=(null===(r=n.lrsLayer)||void 0===r?void 0:r.layerType)===s.LrsLayerType.Network?o.networkInfo:null,h=(e,t)=>{if(e.target)if(g(t)){const l=[],a=[];l.push(t),a.push(e.target.checked),l.push("defaultMethod"),a.push(p(t)),u(l,a,!0)}else d(t,e.target.checked,!0)},g=e=>{let t=!1;switch(e){case"useMeasure":t=f.defaultMethod===s.SearchMethod.Measure;break;case"useCoordinate":t=f.defaultMethod===s.SearchMethod.Coordinate;break;case"useReferent":t=f.defaultMethod===s.SearchMethod.Referent;break;case"useLineAndMeasure":t=f.defaultMethod===s.SearchMethod.LineAndMeasure}return t},p=e=>"useMeasure"!==e&&f.useMeasure&&f.defaultMethod!==s.SearchMethod.Measure?s.SearchMethod.Measure:"useCoordinate"!==e&&f.useCoordinate&&f.defaultMethod!==s.SearchMethod.Coordinate?s.SearchMethod.Coordinate:"useLineAndMeasure"!==e&&f.useLineAndMeasure&&f.defaultMethod!==s.SearchMethod.LineAndMeasure?s.SearchMethod.LineAndMeasure:s.SearchMethod.Referent,v=()=>{let e=0;return f.useMeasure&&e++,f.useCoordinate&&e++,f.useReferent&&e++,f.useLineAndMeasure&&e++,e};return(0,e.jsxs)(a.SettingSection,{role:"group","aria-label":c("searchMethod"),title:c("searchMethod"),children:[(0,e.jsx)(a.SettingRow,{flow:"wrap",label:c("defaultStr"),children:(0,e.jsxs)(l.Select,{"aria-label":c("defaultStr"),className:"w-100",size:"sm",value:f.defaultMethod,disabled:1===v(),onChange:e=>{d("defaultMethod",e.target.value,!0)},children:[f.useMeasure&&(0,e.jsx)("option",{value:s.SearchMethod.Measure,children:c("measure")}),f.useCoordinate&&(0,e.jsx)("option",{value:s.SearchMethod.Coordinate,children:c("coordinate")}),f.useReferent&&(0,e.jsx)("option",{value:s.SearchMethod.Referent,children:c("referent")}),f.useLineAndMeasure&&(0,e.jsx)("option",{value:s.SearchMethod.LineAndMeasure,children:c("lineAndMeasure")})]})}),(0,e.jsx)(a.SettingRow,{tag:"label",label:c("measure"),children:(0,e.jsx)(l.Switch,{checked:f.useMeasure,disabled:1===v()&&f.useMeasure,onChange:e=>{h(e,"useMeasure")}})}),(0,e.jsx)(a.SettingRow,{tag:"label",label:c("coordinate"),children:(0,e.jsx)(l.Switch,{checked:f.useCoordinate,disabled:1===v()&&f.useCoordinate,onChange:e=>{h(e,"useCoordinate")}})}),(0,e.jsx)(a.SettingRow,{tag:"label",label:c("referent"),children:(0,e.jsx)(l.Switch,{checked:f.useReferent,disabled:1===v()&&f.useReferent,onChange:e=>{h(e,"useReferent")}})}),f.showLineAndMeasure&&(0,e.jsx)(a.SettingRow,{tag:"label",label:c("lineAndMeasure"),children:(0,e.jsx)(l.Switch,{checked:f.useLineAndMeasure,disabled:1===v()&&f.useLineAndMeasure,onChange:e=>{h(e,"useLineAndMeasure")}})})]})}var p=c(98640);function v(n){const{lrsLayer:r,onPropertyChanged:o}=n,d=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),u=(null==r?void 0:r.layerType)===s.LrsLayerType.Network?r.networkInfo:null,c=()=>{let e=0;return u.useRouteId&&e++,u.useRouteName&&e++,u.useMultiField&&e++,e},f=e=>u.routeIdFields[e].enabled,h=e=>{const t=u.routeIdFields.asMutable({deep:!0});t[e].enabled=!t[e].enabled,o("routeIdFields",t,!0)};return(0,e.jsxs)(a.SettingSection,{title:d("defaultIdentifier"),children:[(0,e.jsx)(a.SettingRow,{flow:"wrap",label:d("routeIdentifier"),children:(0,e.jsxs)(l.Select,{"aria-label":d("routeIdentifier"),className:"w-100",size:"sm",value:u.defaultIdentifer,disabled:1===c(),onChange:e=>{o("defaultIdentifer",e.target.value,!0)},children:[u.useRouteId&&(0,e.jsx)("option",{value:s.Identifiers.RouteId,children:d("routeId")}),u.useRouteName&&(0,e.jsx)("option",{value:s.Identifiers.RouteName,children:d("routeName")}),u.useMultiField&&(0,e.jsx)("option",{value:s.Identifiers.MultiField,children:d("routeFields")})]})}),u.defaultIdentifer===s.Identifiers.MultiField&&(0,e.jsx)(t.React.Fragment,{children:(0,e.jsx)(p.List,Object.assign({className:"list-routeid-fields pt-2",showCheckbox:!0,dndEnabled:!0,itemsJson:Array.from(u.routeIdFields).map((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:f(t),itemStateTitle:e.field.alias,itemStateCommands:[]})),onUpdateItem:(e,t)=>{const{itemJsons:l}=t.props,[,a]=l;var i;i=a.map(e=>e.itemStateDetailContent),o("routeIdFields",i,!0)},renderOverrideItemDetailToggle:(t,a)=>{const{itemJsons:i,itemJsons:[{itemStateDetailVisible:s,itemStateDetailContent:n}]}=a.props,[r]=i,o=+r.itemKey;return n?(0,e.jsx)(l.Checkbox,{"aria-expanded":!!s,className:"jimu-tree-item__detail-toggle mr-2",checked:f(o),onClick:e=>{h(o)}}):null},onClickItemBody:(e,t)=>{const{itemJsons:[l]}=t.props;h(+l.itemKey)}},s.advancedActionMap))}),u.supportsLines&&(0,e.jsx)("div",{style:{marginTop:"12px"},children:(0,e.jsx)(a.SettingRow,{flow:"wrap",label:d("lineIdentifier"),children:(0,e.jsxs)(l.Select,{"aria-label":d("lineIdentifier"),className:"w-100",size:"sm",value:u.defaultLineIdentifier,disabled:1===c(),onChange:e=>{o("defaultLineIdentifier",e.target.value,!0)},children:[u.useLineId&&(0,e.jsx)("option",{value:s.LineIdentifiers.LineId,children:d("lineId")}),u.useLineName&&(0,e.jsx)("option",{value:s.LineIdentifiers.LineName,children:d("lineName")})]})})})]})}var m=c(71442);function b(n){const{lrsLayer:r,onPropertyChanged:o,onQueryItemChanged:d}=n,u=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),c=(null==r?void 0:r.layerType)===s.LrsLayerType.Network?r.networkInfo:null;return(0,e.jsx)("div",{children:(null==c?void 0:c.sortOptions)&&(0,e.jsxs)(a.SettingSection,{role:"group","aria-label":u("results"),title:u("results"),children:[(0,e.jsx)(a.SettingRow,{"aria-label":u("sortResults"),flow:"wrap",label:u("sortResults"),children:(0,e.jsx)(m.Sort,{onChange:e=>{const{dataSourceId:t,mainDataSourceId:l,dataViewId:a,rootDataSourceId:i}=r.useDataSource,s={dataSourceId:t,mainDataSourceId:l,dataViewId:a,rootDataSourceId:i,fields:r.useDataSource.fields},n=c.set("sortOptions",e),o=r.set("networkInfo",n).set("useDataSource",s);d(o,!0)},value:(0,t.Immutable)(c.sortOptions),useDataSource:r.useDataSource})}),(0,e.jsx)(a.SettingRow,{flow:"no-wrap",tag:"label",label:u("expandByDefault"),children:(0,e.jsx)(l.Switch,{checked:c.expandByDefault,onChange:e=>{o("expandByDefault",e.target.checked,!0)}})})]})})}function w(n){const{lrsLayer:r,onPropertyChanged:o}=n,d=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),u=(null==r?void 0:r.layerType)===s.LrsLayerType.Network?r.networkInfo:null,c=(e,t)=>{e.target&&o(t,e.target.checked,!0)},f=()=>{let e=0;return u.searchSingle&&e++,u.searchMultiple&&e++,u.searchRange&&e++,e};return(0,e.jsxs)(a.SettingSection,{role:"group","aria-label":d("searchMeasures"),title:d("searchMeasures"),children:[(0,e.jsx)(a.SettingRow,{tag:"label",label:d("singleLabel"),children:(0,e.jsx)(l.Switch,{checked:u.searchSingle,disabled:1===f()&&u.searchSingle,onChange:e=>{c(e,"searchSingle")}})}),(0,e.jsx)(a.SettingRow,{tag:"label",label:d("multipleLabel"),children:(0,e.jsx)(l.Switch,{checked:u.searchMultiple,disabled:1===f()&&u.searchMultiple,onChange:e=>{c(e,"searchMultiple")}})}),(0,e.jsx)(a.SettingRow,{tag:"label",label:d("rangeLabel"),children:(0,e.jsx)(l.Switch,{checked:u.searchRange,disabled:1===f()&&u.searchRange,onChange:e=>{c(e,"searchRange")}})})]})}function S(n){const{lrsLayer:r,onPropertyChanged:o}=n,d=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),u=(null==r?void 0:r.layerType)===s.LrsLayerType.Network?r.networkInfo:null;return(0,e.jsx)(a.SettingSection,{title:d("spatialReference"),children:(0,e.jsx)(a.SettingRow,{flow:"wrap",label:d("default"),children:(0,e.jsxs)(l.Select,{"aria-label":d("default"),className:"w-100",size:"sm",value:u.defaultSpatialReferenceFrom,onChange:e=>{o("defaultSpatialReferenceFrom",e.target.value,!0)},children:[(0,e.jsx)("option",{value:s.SpatialReferenceFrom.Map,children:d("map")}),(0,e.jsx)("option",{value:s.SpatialReferenceFrom.Lrs,children:d("lrs")})]})})})}function y(n){const{lrsLayer:r,intl:o,onPropertyChanged:d}=n,u=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),c=(null==r?void 0:r.layerType)===s.LrsLayerType.Network?r.networkInfo:null;return(0,e.jsx)(a.SettingSection,{title:u("search"),children:(0,e.jsx)(a.SettingRow,{flow:"wrap",label:u("radiusWithUnits",{units:(0,s.GetUnits)(c.unitsOfMeasure,o)}),children:(0,e.jsx)(l.NumericInput,{size:"sm",value:c.searchRadius,precision:3,onAcceptValue:e=>{d("searchRadius",e,!0)},"aria-label":u("radiusWithUnits",{units:(0,s.GetUnits)(c.unitsOfMeasure,o)}),className:"w-100"})})})}function x(n){const{lrsLayer:r,lrsLayers:o,onPropertyChanged:d,onPropertiesChanged:u}=n,c=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),[f,h]=t.React.useState(!1),[g,p]=t.React.useState(!1),[v,m]=t.React.useState(!1),[b,w]=t.React.useState(),S=(null==r?void 0:r.layerType)===s.LrsLayerType.Network?r.networkInfo:null;t.React.useEffect(()=>{var e,t,l,a,i;if(!r||!S)return;const s=S.lrsNetworkId.toString(),n=o.find(e=>(null==e?void 0:e.networkInfo)&&s===e.networkInfo.derivedFromNetworkId&&e.networkInfo.isDerived);(null===(e=null==n?void 0:n.networkInfo)||void 0===e?void 0:e.isDerived)?w(!0):w(!1);const d=[],c=[],f=S.lrsFields,g=S.additionalFields;if(f)f.forEach(e=>{d.push(e)});else{const e=S.defaultChecked;if(!e)return;e.forEach(e=>{d.push(e)})}if(g)g.forEach(e=>{c.push(e)});else{const e=C();if(!e)return;e.forEach(e=>{c.push(e.value)})}if((null===(t=null==S?void 0:S.lrsFields)||void 0===t?void 0:t.length)===(null===(l=null==S?void 0:S.layerFields)||void 0===l?void 0:l.length)){p(!0);S.layerFields.forEach(e=>{y(e.jimuName,!0)})}else p(!1);if((null===(a=null==S?void 0:S.additionalFields)||void 0===a?void 0:a.length)===(null===(i=C())||void 0===i?void 0:i.length)){m(!0);C().forEach(e=>{x(e.value,!0)})}else m(!1);h(S.showAdditionalFields);u(["lrsFields","additionalFields"],[d,c],!0)},[r.name,b]);const y=(e,t)=>{var l,a;const i=null==S?void 0:S.lrsFields.asMutable();if(e)if(t&&!(null===(l=S.lrsFields)||void 0===l?void 0:l.includes(e)))i.push(e);else if(!t&&(null===(a=S.lrsFields)||void 0===a?void 0:a.includes(e))){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}d("lrsFields",i,!0),i.length===S.layerFields.length?p(!0):p(!1)},x=(e,t)=>{var l,a;const i=S.additionalFields.asMutable();if(e)if(t&&!(null===(l=S.additionalFields)||void 0===l?void 0:l.includes(e)))i.push(e);else if(!t&&(null===(a=S.additionalFields)||void 0===a?void 0:a.includes(e))){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}d("additionalFields",i,!0),i.length===C().length?m(!0):m(!1)},C=()=>{const e=[];return e.push({label:s.measureFields.at(0).label,value:s.measureFields.at(0).value}),e.push({label:s.measureFields.at(1).label,value:s.measureFields.at(1).value}),b&&(e.push({label:s.derivedFields.at(0).label,value:s.derivedFields.at(0).value}),e.push({label:s.derivedFields.at(1).label,value:s.derivedFields.at(1).value}),e.push({label:s.derivedFields.at(2).label,value:s.derivedFields.at(2).value}),e.push({label:s.derivedFields.at(3).label,value:s.derivedFields.at(3).value})),e.push({label:s.distanceField.label,value:s.distanceField.value}),e.push({label:s.stationField.at(0).label,value:s.stationField.at(0).value}),e.push({label:s.stationField.at(1).label,value:s.stationField.at(1).value}),e.push({label:s.stationField.at(2).label,value:s.stationField.at(2).value}),(null==S?void 0:S.supportsLines)&&(e.push({label:s.toRouteField.at(0).label,value:s.toRouteField.at(0).value}),e.push({label:s.toRouteField.at(1).label,value:s.toRouteField.at(1).value}),e.push({label:s.toRouteField.at(2).label,value:s.toRouteField.at(2).value}),e.push({label:s.toRouteField.at(3).label,value:s.toRouteField.at(3).value}),e.push({label:s.toRouteField.at(4).label,value:s.toRouteField.at(4).value})),e},j=(()=>{var t;const a=null===(t=null==r?void 0:r.networkInfo)||void 0===t?void 0:t.layerFields;if(!a)return;const i=[];return a.forEach(t=>{var a;i.push((0,e.jsxs)("div",{children:[(0,e.jsx)(l.Checkbox,{checked:null===(a=r.networkInfo.lrsFields)||void 0===a?void 0:a.includes(t.jimuName),onClick:e=>{y(t.jimuName,e.currentTarget.checked)}}),(0,e.jsx)("span",{style:{paddingLeft:"0.5rem"},children:t.alias})]}))}),i})(),L=(()=>{const t=[];return C().forEach(a=>{var i;t.push((0,e.jsxs)("div",{children:[(0,e.jsx)(l.Checkbox,{checked:null===(i=S.additionalFields)||void 0===i?void 0:i.includes(a.value),onClick:e=>{x(a.value,e.currentTarget.checked)}}),(0,e.jsx)("span",{style:{paddingLeft:"0.5rem"},children:a.label})]}))}),t})();return(0,e.jsxs)(a.SettingSection,{role:"group",children:[(0,e.jsx)(a.SettingRow,{tag:"label","aria-label":c("advancedFieldDisplay"),flow:"no-wrap",label:c("advancedFieldDisplay"),children:(0,e.jsx)(l.Switch,{checked:f,onChange:e=>{d("showAdditionalFields",e.target.checked,!0),h(e.target.checked)}})}),f&&(0,e.jsxs)("div",{style:{paddingTop:"1rem"},children:[(0,e.jsx)(a.SettingRow,{"aria-label":c("networkFields"),flow:"no-wrap",label:c("networkFields"),children:(0,e.jsx)(l.Checkbox,{checked:g,onClick:e=>{(e=>{p(e);const t=S.lrsFields.asMutable(),l=S.layerFields;l&&(l.forEach(l=>{var a,i;const s=l.jimuName,n=e;if(s)if(n&&!(null===(a=S.lrsFields)||void 0===a?void 0:a.includes(s)))t.push(s);else if(!n&&(null===(i=S.lrsFields)||void 0===i?void 0:i.includes(s))){const e=t.indexOf(s);-1!==e&&t.splice(e,1)}}),u(["lrsFields","checkAllLrsFields"],[t,e],!0))})(e.currentTarget.checked)}})}),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",marginTop:"0.7rem",marginBottom:"0.7rem",marginLeft:"0.7rem"},children:j}),(0,e.jsx)(a.SettingRow,{"aria-label":c("additionalFields"),flow:"no-wrap",label:c("additionalFields"),children:(0,e.jsx)(l.Checkbox,{checked:v,onClick:e=>{(e=>{m(e);const t=S.additionalFields.asMutable(),l=C();l&&(l.forEach(l=>{var a,i;const s=l.value,n=e;if(s)if(n&&!(null===(a=S.additionalFields)||void 0===a?void 0:a.includes(s)))t.push(s);else if(!n&&(null===(i=S.additionalFields)||void 0===i?void 0:i.includes(s))){const e=t.indexOf(s);-1!==e&&t.splice(e,1)}}),u(["additionalFields","checkAllAdditionalFields"],[t,e],!0))})(e.currentTarget.checked)}})}),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",marginTop:"0.7rem",marginLeft:"0.7rem"},children:L})]})]})}function C(n){var r;const{intl:o,widgetId:d,index:c,config:f,activeMapViewId:h,onSettingChange:p}=n,m=(C="lrsLayers",j=[],t.React.useMemo(()=>(0,s.getConfigValue)(f,C,h)||j,[f,h]));var C,j;const L=t.React.useMemo(()=>m[c],[m,c]),k=t.React.useMemo(()=>L.layerType===s.LrsLayerType.Network?L.networkInfo:null,[L]),R=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),[M,I]=t.React.useState(null==L?void 0:L.name),F=u({widgetId:d,useDataSourceId:null===(r=null==L?void 0:L.useDataSource)||void 0===r?void 0:r.dataSourceId});t.React.useEffect(()=>{(null==L?void 0:L.name)&&M!==(null==L?void 0:L.name)&&I(null==L?void 0:L.name)},[null==L?void 0:L.name]);const N=t.React.useCallback((e,l,a=!1)=>{var i;let n=null!=m?m:(0,t.Immutable)([]);if(n=t.Immutable.set(n,e,l),f.mode===s.ModeType.Map){const e=h,t=(null===(i=f.mapViewsConfig)||void 0===i?void 0:i[e]).set("lrsLayers",n),l=f.setIn(["mapViewsConfig",e],t);p({id:d,config:l})}else p({id:d,config:f.set("lrsLayers",n)})},[m,f,h,p,d]),T=t.React.useCallback((e,t,l=!1)=>{let a=L;if(null==t){if(a.networkInfo){const t=a.networkInfo.without(e);a=a.set("networkInfo",t)}}else if(a.networkInfo){const l=a.networkInfo.set(e,t);a=a.set("networkInfo",l)}N(c,a,l)},[N,c,L]),D=t.React.useCallback((e,t,l=!1)=>{if(e.length!==t.length)return;let a=L;e.forEach((e,l)=>{if(null==t[l]){if(a.networkInfo){const t=a.networkInfo.without(e);a=a.set("networkInfo",t)}}else if(a.networkInfo){const i=a.networkInfo.set(e,t[l]);a=a.set("networkInfo",i)}}),N(c,a,l)},[N,c,L]),P=t.React.useCallback(e=>{I(e.target.value)},[]),O=t.React.useCallback(e=>{e.trim().length>0?T("name",e,!0):I(null==L?void 0:L.name)},[null==L?void 0:L.name,T]);return(0,e.jsx)("div",{className:"h-100",children:(0,e.jsx)("div",{css:t.css`height: 100%; overflow:auto;`,children:L&&(F||f.mode===s.ModeType.Map)&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(a.SettingSection,{role:"group","aria-label":R("networkLabel"),title:R("networkLabel"),children:(0,e.jsx)(a.SettingRow,{children:(0,e.jsx)(l.TextInput,{size:"sm",type:"text",className:"w-100",value:M,onChange:P,onAcceptValue:O,"aria-label":R("networkLabel")})})}),(0,e.jsx)(g,{widgetId:d,lrsLayer:L,onPropertyChanged:T,onPropertiesChanged:D}),(k.useMeasure||k.useLineAndMeasure)&&(0,e.jsx)(w,{lrsLayer:L,onPropertyChanged:T}),(0,e.jsx)(v,{widgetId:d,lrsLayer:L,onPropertyChanged:T}),k.useCoordinate&&(0,e.jsx)(S,{lrsLayer:L,onPropertyChanged:T}),k.useCoordinate&&(0,e.jsx)(y,{intl:o,lrsLayer:L,onPropertyChanged:T}),(0,e.jsx)(b,{lrsLayer:L,onPropertyChanged:T,onQueryItemChanged:(e,t=!1)=>{N(c,e,t)}}),(0,e.jsx)(x,{lrsLayer:L,lrsLayers:m,onPropertyChanged:T,onPropertiesChanged:D})]})})})}var j=c(54337),L=c(68972);function k(n){var r,o,d;const{intl:u,widgetId:c,config:f,activeMapViewId:h,onSettingChange:g}=n,p=t.hooks.useTranslation(i,s.lrsDefaultMessages,t.defaultMessages),v=(e,l)=>t.React.useMemo(()=>(0,s.getConfigValue)(f,e,h)||l,[f,h]),m=[p("inches"),p("points"),p("feet"),p("yards"),p("miles"),p("nauticalMiles"),p("millimeters"),p("centimeters"),p("meters"),p("kilometers"),p("decimalDegrees"),p("decimeters"),p("intFeet"),p("intMiles")],b=e=>e?(0,s.GetEsriUnits)(m[e],u):(0,s.GetEsriUnits)(m[0],u),w=v("lrsLayers",[]),S=v("highlightStyle",{color:s.colorCyan,size:3}),y=v("labelStyle",{color:s.colorBlack,size:12}),x=v("resultConfig",{pageSize:25,defaultReferentLayer:null,defaultOffsetUnit:b()}),C=v("defaultNetwork",""),k=v("hideMethod",!1),R=v("hideNetwork",!1),M=v("hideRoute",!1),I=w.some(e=>e.name===C&&e.layerType===s.LrsLayerType.Network&&e.networkInfo.supportsLines);return(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(a.SettingSection,{className:"px-4",children:(0,e.jsxs)(l.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:p("selectionSettings"),defaultIsOpen:!0,disabled:!1,"aria-label":p("selectionSettings"),children:[(0,e.jsx)(a.SettingRow,{label:p("selectionHighlight"),children:(0,e.jsx)(j.ColorPicker,{color:S.color,value:S.color,onChange:e=>{const t=Object.assign(Object.assign({},S),{color:e});(0,s.updateConfig)(c,f,"highlightStyle",t,h,g)},"aria-label":p("selectionHighlight")})}),(0,e.jsx)(a.SettingRow,{flow:"wrap",label:p("graphicWidth"),children:(0,e.jsx)(l.NumericInput,{size:"sm",value:S.size,precision:1,min:0,max:15,step:.1,onChange:e=>{const t=Object.assign(Object.assign({},S),{size:e});(0,s.updateConfig)(c,f,"highlightStyle",t,h,g)},"aria-label":p("graphicWidth"),className:"w-100"})}),(0,e.jsx)(a.SettingRow,{label:p("labelColor"),children:(0,e.jsx)(j.ColorPicker,{color:n.config.labelStyle.color?n.config.labelStyle.color:s.colorBlack,value:y.color,onChange:e=>{const t=Object.assign(Object.assign({},y),{color:e});(0,s.updateConfig)(c,f,"labelStyle",t,h,g)},"aria-label":p("labelColor")})}),(0,e.jsx)(a.SettingRow,{flow:"wrap",label:p("labelSize"),children:(0,e.jsx)(l.NumericInput,{size:"sm",value:y.size,precision:1,min:0,max:30,step:.1,onChange:e=>{const t=Object.assign(Object.assign({},y),{size:e});(0,s.updateConfig)(c,f,"labelStyle",t,h,g)},"aria-label":p("labelSize"),className:"w-100"})})]})}),(0,e.jsx)(a.SettingSection,{className:"px-4",children:(0,e.jsx)(l.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:p("resultSettings"),defaultIsOpen:!0,disabled:!1,"aria-label":p("resultSettings"),children:(0,e.jsx)(a.SettingRow,{flow:"wrap",label:p("resultsPageSize"),children:(0,e.jsx)(l.NumericInput,{size:"sm",value:x.pageSize||25,precision:0,min:5,max:500,onChange:e=>{const t=Object.assign(Object.assign({},x),{pageSize:e});(0,s.updateConfig)(c,f,"resultConfig",t,h,g)},"aria-label":p("resultsPageSize"),className:"w-100"})})})}),(0,e.jsx)(a.SettingSection,{className:"px-4",children:(0,e.jsxs)(l.CollapsablePanel,{role:"group",level:1,type:"default",wrapperClassName:"mt-3",label:p("displaySettings"),defaultIsOpen:!0,disabled:!1,"aria-label":p("displaySettings"),children:[(0,e.jsx)(a.SettingRow,{tag:"label",label:p("hideMethod"),children:(0,e.jsx)(l.Switch,{checked:k,onChange:(e,t)=>{(0,s.updateConfig)(c,f,"hideMethod",t,h,g)}})}),(0,e.jsx)(a.SettingRow,{tag:"label",label:p("hideNetwork"),children:(0,e.jsx)(l.Switch,{checked:R,onChange:(e,t)=>{(0,s.updateConfig)(c,f,"hideNetwork",t,h,g)}})}),I&&(0,e.jsx)(a.SettingRow,{tag:"label",label:p("hideRoute"),children:(0,e.jsx)(l.Switch,{checked:M,onChange:(e,t)=>{(0,s.updateConfig)(c,f,"hideRoute",t,h,g)}})}),(0,e.jsx)(a.SettingRow,{flow:"wrap",label:p("defaultNetwork"),children:(0,e.jsx)(l.Select,{"aria-label":p("defaultNetwork"),className:"w-100",size:"sm",value:C,disabled:1===w.length,onChange:e=>{var t;t=e.target.value,(0,s.updateConfig)(c,f,"defaultNetwork",t,h,g)},children:w.filter(e=>!e.isReferent).map((t,l)=>(0,e.jsx)("option",{value:t.name,children:t.name},l))})}),w&&(null===(r=w.filter(e=>e.isReferent))||void 0===r?void 0:r.length)>0&&(0,e.jsxs)(L.Fragment,{children:[(0,e.jsx)(a.SettingRow,{flow:"wrap",label:p("defaultReferent"),children:(0,e.jsx)(l.Select,{"aria-label":p("defaultReferent"),value:null===(o=null==x?void 0:x.defaultReferentLayer)||void 0===o?void 0:o.id,onChange:e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=w.find(e=>e.id===l),i=Object.assign(Object.assign({},x),{defaultReferentLayer:a});(0,s.updateConfig)(c,f,"resultConfig",i,h,g)},children:null===(d=w.filter(e=>e.isReferent))||void 0===d?void 0:d.map((t,l)=>(0,e.jsx)("option",{value:t.id,children:t.name},l))})}),(0,e.jsx)(a.SettingRow,{flow:"wrap",label:p("defaultOffsetUnit"),children:(0,e.jsx)(l.Select,{"aria-label":p("defaultOffsetUnit"),value:x.defaultOffsetUnit||b(),onChange:e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=Object.assign(Object.assign({},x),{defaultOffsetUnit:l});(0,s.updateConfig)(c,f,"resultConfig",a,h,g)},children:m.map((t,l)=>(0,e.jsx)("option",{value:(0,s.GetEsriUnits)(t,u),children:t},l))})})]})]})})]})}var R=function(e,t,l,a){return new(l||(l=Promise))(function(i,s){function n(e){try{o(a.next(e))}catch(e){s(e)}}function r(e){try{o(a.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof l?t:new l(function(e){e(t)})).then(n,r)}o((a=a.apply(e,t||[])).next())})};const M=u=>{var c,f,g,p,v;const{id:m,intl:b,widgetId:w,config:S,useMapWidgetIds:y,portalUrl:x,theme:j,onSettingChange:L}=u,[M,I]=t.React.useState(-1),[F,N]=t.React.useState(""),[T,D]=t.React.useState(""),[P,O]=t.React.useState({}),V=t.React.useRef(S),z=S.mode===s.ModeType.Map,A=(null==y?void 0:y.length)>0,E=!z&&(null===(c=null==S?void 0:S.lrsLayers)||void 0===c?void 0:c.length)>0||z&&(null==S?void 0:S.mapViewsConfig)&&(null===(f=Object.keys(S.mapViewsConfig))||void 0===f?void 0:f.length)>0&&(0,s.isDefined)(null==S?void 0:S.mapViewsConfig[F]),U=!z&&0!==(null===(g=null==S?void 0:S.lrsLayers)||void 0===g?void 0:g.length)||z&&(null==S?void 0:S.settingsPerView)&&(null==S?void 0:S.settingsPerView[F]),B=(0,t.Immutable)([s.LrsLayerType.Network,s.LrsLayerType.Event,s.LrsLayerType.PointEvent,s.LrsLayerType.Intersection,s.LrsLayerType.Addressing,s.LrsLayerType.CalibrationPoint,s.LrsLayerType.NonLrs,s.LrsLayerType.NonLrsPoint]),_=(0,t.Immutable)([s.LrsLayerType.Network]),W=l.hooks.useTranslate(i,l.defaultMessages,s.lrsDefaultMessages);t.React.useEffect(()=>{var e;if(void 0===S.mode){const t=(null===(e=null==S?void 0:S.lrsLayers)||void 0===e?void 0:e.length)>0?s.ModeType.Layer:s.ModeType.Map;u.onSettingChange({id:w,config:S.set("mode",t)})}},[]),t.React.useEffect(()=>{S&&(V.current=S)},[S]);const G=t.React.useCallback((...e)=>{const[t,...l]=e,a=Object.assign(Object.assign({id:m},t));L(a,...l)},[m,L]),J=t.React.useCallback(e=>{L({id:w,config:d(S,e),useDataSources:[]})},[S,L,w]),H=t.React.useCallback((e,t)=>{I(e),z&&""!==t&&D(t)},[z]),K=t.React.useCallback(e=>{const t=e.target.value;N(t)},[]),q=t.React.useCallback((e,t)=>{let l=S.set("lrsLayers",e);const a=r(e,S.defaultNetwork),i=n(e,S.resultConfig);l=l.set("defaultNetwork",a).set("resultConfig",i),G({config:l,useDataSources:Object.values(t.useDataSourceMap)},t.outputDataSources)},[S,G]),Q=t.React.useRef(!1),$=t.React.useCallback((e,l,a,i)=>R(void 0,void 0,void 0,function*(){var s,d;yield R(void 0,void 0,void 0,function*(){for(;Q.current;)yield new Promise(e=>setTimeout(e,10))}),Q.current=!0;let u=V.current;try{for(const a in e)if(i){u=u.set("mapViewsConfig",e);const i=null===(s=e[a])||void 0===s?void 0:s.lrsLayers;let c=(null===(d=V.current.settingsPerView)||void 0===d?void 0:d[a])||o();const f=r(i,c.defaultNetwork),h=n(i,c.resultConfig);c=c.set("defaultNetwork",f).set("resultConfig",h),(null==u?void 0:u.settingsPerView)||(u=u.set("settingsPerView",(0,t.Immutable)({})));const g=null==u?void 0:u.settingsPerView.set(a,c);u=u.set("settingsPerView",g),""===F&&N(a),O(l)}else""===F&&N(a),O(l);G({config:u,useDataSources:Object.values(a.useDataSourceMap)},a.outputDataSources)}finally{V.current=u,Q.current=!1}}),[F,G]),X=t.React.useMemo(()=>(0,s.getConfigValue)(S,"lrsLayers",T)||[],[S,T]);return(0,e.jsx)("div",{className:"setting-add-line-event h-100",children:(0,e.jsxs)("div",{className:"jimu-widget-setting setting-add-line-event__setting-content h-100",children:[(0,e.jsx)(s.LrsLoader,{intl:b,portalUrl:x,theme:j,widgetId:w,mode:S.mode,useMapWidgetIds:y,lrsLayers:S.lrsLayers,mapViewsConfig:S.mapViewsConfig,supportedLrsTypes:B,requiredLrsTypes:_,outputDataSourceWidgetType:"searchByRoute",onLrsLayersUpdated:q,onMapViewsConfigUpdated:$,onMapWidgetSelected:(e,t)=>{u.onSettingChange({id:w,config:d(S,t),useMapWidgetIds:e})},onReset:J,onSelectionChanged:H,children:M>-1&&(0,e.jsxs)("div",{children:[(null===(p=X[M])||void 0===p?void 0:p.layerType)===s.LrsLayerType.Network&&(0,e.jsx)(C,{intl:b,widgetId:w,index:M,config:S,activeMapViewId:T,onSettingChange:L}),(null===(v=X[M])||void 0===v?void 0:v.isReferent)&&(0,e.jsx)(h,{widgetId:w,index:M,config:S,activeMapViewId:T,onSettingChange:L})]})}),A&&U&&(0,e.jsxs)(t.React.Fragment,{children:[Object.keys(P).length>1&&(0,e.jsx)(a.SettingSection,{role:"none",children:(0,e.jsx)(a.SettingRow,{flow:"wrap",label:W("selectMapToEditSettings"),children:(0,e.jsx)(l.Select,{className:"w-100",size:"sm",value:F,onChange:K,children:Object.keys(P).map(t=>(0,e.jsx)("option",{value:t,children:P[t]},t))})})}),(0,e.jsx)(k,{intl:b,widgetId:w,config:S,activeMapViewId:F,onSettingChange:L})]}),!z&&!E&&!U&&(0,e.jsx)(s.EmptyPlaceholder,{isMapMode:!1}),z&&!A&&(0,e.jsx)(s.EmptyPlaceholder,{isMapMode:!0})]})})};function I(e){c.p=e}})(),f})())}}});